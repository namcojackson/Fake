<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWZC107001">

	<!-- typeAlias alias="NWZC103002PMsg"				type="business.parts.NWZC103002PMsg"/ -->
	<typeAlias alias="SoftAllocationData"			type="com.canon.cusa.s21.api.NWZ.NWZC107001.SoftAllocationData"/>

	
	<!-- statement id="getSumOrderQty" parameterClass="Map" resultClass="BigDecimal" -->
	
    <!-- SELECT -->
    <!--             SUM(SP.ORD_QTY) AS SUM_ORD_QTY -->
    <!--     FROM -->
    <!--             SHPG_PLN SP -->
    <!--     WHERE -->
    <!--        	    SP.GLBL_CMPY_CD 	  	  	= #glblCmpyCd# -->
    <!--        	AND SP.TRX_HDR_NUM 		  	  	= #trxHdrNum# -->
    <!--        	AND SP.TRX_LINE_NUM 		  	= #trxLineNum# -->
    <!--        	AND SP.TRX_LINE_SUB_NUM 	  	= #trxLineSubNum# -->
    <!--        	AND SP.TRX_SRC_TP_CD 		  	= #trxSrcTpCd#	 -->
    <!--        	AND SP.SHPG_STS_CD 				&lt;&gt; #cancelled#		 -->
		    <!-- AND SP.EZCANCELFLAG       	  	= '0' -->
	   
	<!-- /statement -->


	<statement id="getSumOrderQtyForSOPrinted" parameterClass="Map" resultClass="BigDecimal">
	
	
		SELECT
			    SUM(SP.ORD_QTY) AS SUM_ORD_QTY
        FROM
           		SHPG_PLN SP
           	   ,SHPG_STS SPS
        WHERE
           	    SP.GLBL_CMPY_CD 	  	  	= #glblCmpyCd#
           	AND SP.TRX_HDR_NUM 		  	  	= #trxHdrNum#
           	AND SP.TRX_LINE_NUM 		  	= #trxLineNum#
           	AND SP.TRX_LINE_SUB_NUM 	  	= #trxLineSubNum#
           	AND SP.TRX_SRC_TP_CD 		  	= #trxSrcTpCd#	
            AND SP.GLBL_CMPY_CD 		  	= SPS.GLBL_CMPY_CD
           	AND SP.SHPG_STS_CD 				= SPS.SHPG_STS_CD 
			AND SPS.SO_PRINT_FLG  			= #soPtintFlg#  		
		    AND SP.EZCANCELFLAG       	  	= '0'
		    AND SPS.EZCANCELFLAG       	  	= '0'

			   
	</statement>
	
	<statement id="searchShpgPlanCancel" parameterClass="Map" resultClass="Map">
	
	
		SELECT
			    SP.SHPG_PLN_NUM			SHPG_PLN_NUM
			    ,SP.ORD_QTY				ORD_QTY
				,SP.MDSE_CD				MDSE_CD
				,SP.SET_MDSE_CD			SET_MDSE_CD
			    ,SPS.SO_PRINT_FLG		SO_PRINT_FLG
        FROM
           		SHPG_PLN SP
           	   ,SHPG_STS SPS
        WHERE
           	    SP.GLBL_CMPY_CD 			  = #glblCmpyCd#
           	AND SP.TRX_HDR_NUM 			  	  = #trxHdrNum#
           	AND SP.TRX_LINE_NUM 			  = #trxLineNum#
           	AND SP.TRX_LINE_SUB_NUM 		  = #trxLineSubNum#
           	AND SP.TRX_SRC_TP_CD 		  	  = #trxSrcTpCd#
           	<isNotEqual property="trxLineSubNum" compareValue="000">
			AND SP.SHPG_STS_CD				  &lt;&gt; #shpgStsCd#
           	</isNotEqual>
           	AND SP.GLBL_CMPY_CD 			  = SPS.GLBL_CMPY_CD 			
			AND SP.SHPG_STS_CD   			  = SPS.SHPG_STS_CD 
			AND SP.EZCANCELFLAG       	      = '0'
		    AND SPS.EZCANCELFLAG       	      = '0'
		ORDER BY
				SP.SHPG_STS_CD	ASC

	</statement>
	
	<statement id="getMaxDisplayNumber" parameterClass="Map" resultClass="String">
	
	
		SELECT
				MAX(TO_NUMBER(SP.SHPG_PLN_DPLY_LINE_NUM)) AS MAX_NUM
        FROM
           		SHPG_PLN SP
        WHERE
           	    SP.GLBL_CMPY_CD 			= 	#glblCmpyCd#
           	AND SP.TRX_HDR_NUM 				= 	#trxHdrNum#
           	AND SP.TRX_LINE_NUM 			= 	#trxLineNum#
           	AND SP.TRX_LINE_SUB_NUM 		= 	#trxLineSubNum#
           	AND SP.TRX_SRC_TP_CD 			= 	#trxSrcTpCd#
           	AND SP.EZCANCELFLAG     		= 	'0'
	
	
	</statement>
	
	

		
	<!-- statement id="getDistributionInfo" parameterClass="Map" resultMap="result.NWZC103002PMsg" -->
	<!--  -->
	<!-- 	SELECT 	   -->
	<!-- 			  DD.DIST_PLN_NUM 			AS DIST_PLN_NUM -->
	<!-- 			, DD.DIST_PK 				AS DIST_PK -->
	<!-- 			, DD.DIST_TM_FRAME_NUM 		AS DIST_TM_FRAME -->
	<!-- 			, DD.TM_FRAME_FROM_DT 		AS TM_FRAME_FROM_DT -->
	<!-- 			, DD.TM_FRAME_THRU_DT 		AS TM_FRAME_THRU_DT -->
	<!-- 			, DD.DIST_STRU_SEG_PK 		AS DIST_STRU_SEG_PK -->
	<!-- 			, DD.DIST_AVAL_QTY 			AS DIST_AVAL_QTY -->
	<!-- 	FROM 	  -->
	<!-- 			 SOFT_ALLOC_AVAL_SEG SAA -->
	<!-- 			,DIST D -->
	<!-- 			,DIST_PLN_DTL DPD -->
	<!-- 			,DIST_DTL DD -->
	<!-- 	WHERE  -->
	<!-- 			SAA.GLBL_CMPY_CD 			= #glblCmpyCd# -->
	<!-- 		AND SAA.TRX_SRC_TP_CD 			= #trxSrcTpCd# -->
	<!-- 		AND SAA.TRX_HDR_NUM 			= #trxHdrNum# -->
	<!-- 		AND SAA.TRX_LINE_NUM 			= #trxLineNum# -->
	<!-- 		AND SAA.TRX_LINE_SUB_NUM 		= #trxLineSubNum# -->
	<!-- 		AND SAA.GLBL_CMPY_CD 			= D.GLBL_CMPY_CD -->
	<!-- 		AND SAA.DIST_PLN_NUM 			= D.DIST_PLN_NUM -->
			<!-- isEqual property="ordTakeMdseFlg" compareValue="Y" -->
	<!-- 		AND D.ORD_TAKE_MDSE_CD 			= #mdseCd# -->
			<!-- /isEqual -->
			<!-- isEqual property="ordTakeMdseFlg" compareValue="N" -->	
	<!-- 		AND D.MDSE_CD 					= #mdseCd# -->
			<!-- /isEqual -->
			<!-- isNotNull property="whCd" -->          
	<!-- 		AND D.INVTY_LOC_CD				= 	#invtyLocCd#  	 -->
			<!-- /isNotNull -->
			<!-- isNull property="whCd" -->  
	<!-- 		AND( -->
	<!-- 			D.INVTY_LOC_CD				= 	#invtyLocCd#   -->
	<!-- 		 OR D.INVTY_LOC_CD IS NULL -->
	<!-- 		) -->
			<!-- /isNull -->
	<!-- 		AND D.GLBL_CMPY_CD 				= DPD.GLBL_CMPY_CD -->
	<!-- 		AND D.DIST_PK 					= DPD.DIST_PK -->
	<!-- 		AND DPD.DIST_PLN_STS_CD 		= #distPlnStsCd# -->
	<!-- 		AND DPD.GLBL_CMPY_CD 			= DD.GLBL_CMPY_CD -->
	<!-- 		AND DPD.DIST_PLN_NUM 			= DD.DIST_PLN_NUM -->
	<!-- 		AND DPD.DIST_PK 				= DD.DIST_PK -->
	<!-- 		AND DPD.DIST_TM_FRAME_NUM 		= DD.DIST_TM_FRAME_NUM -->
	<!-- 		AND SAA.DIST_STRU_SEG_PK		= DD.DIST_STRU_SEG_PK -->
	<!-- 		AND DD.TM_FRAME_FROM_DT			&lt;= 	#slsDt# -->
	<!-- 		AND SAA.EZCANCELFLAG 			= '0' -->
	<!-- 		AND D.EZCANCELFLAG 				= '0' -->
	<!-- 		AND DPD.EZCANCELFLAG 			= '0' -->
	<!-- 		AND DD.EZCANCELFLAG 			= '0'        -->
            
	<!-- /statement -->
	
	<!-- resultMap id="result.NWZC103002PMsg" class="NWZC103002PMsg" -->

		<!-- result property="distPk"			column="DIST_PK"				javaType="EZDPBigDecimalItem"/ -->
		<!-- result property="distPlnNum"		column="DIST_PLN_NUM"			javaType="EZDPStringItem"/ -->
		<!-- result property="distTmFrameNum"	column="DIST_TM_FRAME"			javaType="EZDPStringItem"/ -->
		<!-- result property="tmFrameFromDt"	column="TM_FRAME_FROM_DT"		javaType="EZDPDateItem"/ -->
		<!-- result property="tmFrameThruDt"	column="TM_FRAME_THRU_DT"		javaType="EZDPDateItem"/ -->
		<!-- result property="distStruSegPk"	column="DIST_STRU_SEG_PK"		javaType="EZDPBigDecimalItem"/ -->
		<!-- result property="avalQty"			column="DIST_AVAL_QTY"			javaType="EZDPBigDecimalItem"/ -->

	<!-- /resultMap -->
	
	
	<statement id="getSoftAllocInfo" parameterClass="Map" resultMap="result.SoftAllocationData">
	
		SELECT
				 SA.SOFT_ALLOC_PK				AS SOFT_ALLOC_PK
				,SA.HARD_ALLOC_MDSE_CD			AS HARD_ALLOC_MDSE_CD
				,SA.HARD_ALLOC_INVTY_LOC_CD		AS HARD_ALLOC_INVTY_LOC_CD
				,SA.HARD_ALLOC_SHPG_SVC_LVL_CD	AS HARD_ALLOC_SHPG_SVC_LVL_CD
				,SA.HARD_ALLOC_AVAL_QTY			AS HARD_ALLOC_AVAL_QTY					
	   	FROM
			    SOFT_ALLOC SA
				,SOFT_ALLOC_AVAL_SEG SAA
        WHERE	
		        SA.GLBL_CMPY_CD             =   #glblCmpyCd# 
		    AND SA.TRX_SRC_TP_CD            =   #trxSrcTpCd#   
		    AND SA.TRX_HDR_NUM              =   #trxHdrNum#         
		    AND SA.TRX_LINE_NUM             =   #trxLineNum#         
		    AND SA.TRX_LINE_SUB_NUM         =   #trxLineSubNum# 
		    AND SA.HARD_ALLOC_AVAL_QTY	   &gt; 0  
		    AND SAA.GLBL_CMPY_CD            =   SA.GLBL_CMPY_CD
		    AND SAA.TRX_SRC_TP_CD           =   SA.TRX_SRC_TP_CD
		    AND SAA.TRX_HDR_NUM             =   SA.TRX_HDR_NUM    
		    AND SAA.TRX_LINE_NUM            =   SA.TRX_LINE_NUM        
		    AND SAA.TRX_LINE_SUB_NUM        =	#settrxLineSubNum#   
		    AND SAA.DIST_PLN_NUM        	=   SA.DIST_PLN_NUM 
		    AND SAA.DIST_STRU_SEG_PK        =   SA.DIST_STRU_SEG_PK 
		    AND SA.EZCANCELFLAG 			= '0'
			AND SAA.EZCANCELFLAG 			= '0'
		    AND EXISTS (
	            	SELECT 
	            			* 
		            FROM 
		                    SHPG_PLN SP 
		            WHERE 
			                SP.SHPG_STS_CD          =   #shpgStsCd# 
			            AND SP.GLBL_CMPY_CD         =   SA.GLBL_CMPY_CD
			            AND SP.TRX_SRC_TP_CD        =   SA.TRX_SRC_TP_CD
			            AND SP.TRX_HDR_NUM          =   SA.TRX_HDR_NUM
			            AND SP.TRX_LINE_NUM         =   SA.TRX_LINE_NUM
			            AND SP.TRX_LINE_SUB_NUM     =   SA.TRX_LINE_SUB_NUM 
			           	AND SP.EZCANCELFLAG 		= '0'
		            )
		ORDER BY     
				SAA.PRTY_NUM	       

	</statement>
	
	<resultMap id="result.SoftAllocationData" class="SoftAllocationData">
		<result property="softAllocPk"		   	column="SOFT_ALLOC_PK"					javaType="BigDecimal"/>
		<result property="mdseCd"   			column="HARD_ALLOC_MDSE_CD" 			javaType="String"/>
		<result property="invtyLocCd"   		column="HARD_ALLOC_INVTY_LOC_CD" 		javaType="String"/>	
		<result property="shpgSvcLvlCd"   		column="HARD_ALLOC_SHPG_SVC_LVL_CD" 	javaType="String"/>		
		<result property="hardAllocAvalQty"   	column="HARD_ALLOC_AVAL_QTY" 			javaType="BigDecimal"/>		
	</resultMap>
	

	<statement id="getATPparameter" parameterClass="Map" resultMap = "String">
	
		
		SELECT
				 SP.SHPG_PLN_NUM		AS 		SHPG_PLN_NUM									
		FROM		
	   		     SHPG_PLN SP
	   	WHERE																				
				SP.GLBL_CMPY_CD					=	#glblCmpyCd#		
			AND SP.TRX_SRC_TP_CD				=	#trxSrcTpCd#   	
			AND SP.TRX_HDR_NUM					=	#trxHdrNum#		    			
			AND SP.TRX_LINE_SUB_NUM				&lt;&gt;#trxLineSubNumSetMdse#
			AND SP.SHPG_STS_CD					=	#shpgStsCdForHardAllocated# 
			AND SP.EZCANCELFLAG 				= '0'	
		<isEqual property="prtlAcptFlg" compareValue="Y">	
		UNION
		SELECT
				 SP.SHPG_PLN_NUM		AS 		SHPG_PLN_NUM									
		FROM		
	   		     SHPG_PLN SP
	   	WHERE																				
				SP.GLBL_CMPY_CD					=	#glblCmpyCd#		
			AND SP.TRX_SRC_TP_CD				=	#trxSrcTpCd#   			
			AND SP.TRX_HDR_NUM					=	#trxHdrNum#       			
			AND SP.TRX_LINE_SUB_NUM				&lt;&gt;#trxLineSubNumSetMdse#		
			AND SP.SHPG_STS_CD					=	#shpgStsCdForValidated# 
			AND SP.EZCANCELFLAG 				= '0'		
		</isEqual>


	</statement>	

	<!-- statement id="getCompMdseCd" parameterClass="Map" resultMap = "String" -->
	
	<!-- 	SELECT -->
	<!-- 		    SP.MDSE_CD			AS 		MDSE_CD			 -->
    <!--     FROM -->
    <!--        		SHPG_PLN  SP -->
    <!--     WHERE -->
    <!--        	    SP.GLBL_CMPY_CD 			= #glblCmpyCd# -->
    <!--        	AND SP.TRX_HDR_NUM 			  	= #trxHdrNum# -->
    <!--        	AND SP.TRX_LINE_NUM 			= #trxLineNum# -->
    <!--        	AND SP.TRX_LINE_SUB_NUM 		= #trxLineSubNum# -->
    <!--        	AND SP.TRX_SRC_TP_CD 		  	= #trxSrcTpCd#			  		 -->
	<!-- 	    AND SP.EZCANCELFLAG       	  	= '0'   -->
	<!-- /statement -->

	<statement id="getCancelImpossibleHardAlloc" parameterClass="Map" resultClass="Map">
		SELECT
			 SP.TRX_LINE_NUM		TRX_LINE_NUM
			,SP.TRX_LINE_SUB_NUM	TRX_LINE_SUB_NUM
			,SP.ORD_QTY				ORD_QTY
			,SP.MDSE_CD				MDSE_CD
			,SP.SET_MDSE_CD			SET_MDSE_CD
		FROM
			SHPG_PLN SP
			,SHPG_STS SPS
		WHERE
			SP.GLBL_CMPY_CD	 		= #glblCmpyCd#
			AND SP.TRX_SRC_TP_CD    = #trxSrcTpCd#
			AND SP.TRX_HDR_NUM      = #trxHdrNum#
			AND SP.TRX_LINE_NUM     = #trxLineNum#
			AND SP.TRX_LINE_SUB_NUM &lt;&gt; #trxLineSubNum#
			AND SP.EZCANCELFLAG = '0'
		
			AND SP.GLBL_CMPY_CD		= SPS.GLBL_CMPY_CD
			AND SP.SHPG_STS_CD		= SPS.SHPG_STS_CD
			AND SPS.SO_PRINT_FLG	= #soPtintFlg#
			AND SPS.EZCANCELFLAG	= '0'
	</statement>
	
	<statement id="getCancelImpossibleSoftAlloc" parameterClass="Map" resultClass="Map">
		SELECT
			 SP.TRX_LINE_NUM		TRX_LINE_NUM
			,SP.TRX_LINE_SUB_NUM	TRX_LINE_SUB_NUM
			,SUM(SA.SOFT_ALLOC_QTY)	SOFT_ALLOC_QTY
			,SP.MDSE_CD				MDSE_CD
			,SP.SET_MDSE_CD			SET_MDSE_CD
			,SUM(SP.ORD_QTY)		ORD_QTY
		FROM
			SHPG_PLN   SP
			,SOFT_ALLOC SA
			,SHPG_STS SPS
		WHERE
			    SP.GLBL_CMPY_CD	 	= #glblCmpyCd#
			AND SP.TRX_SRC_TP_CD    = #trxSrcTpCd#
			AND SP.TRX_HDR_NUM      = #trxHdrNum#
			AND SP.TRX_LINE_NUM     = #trxLineNum#
			AND SP.TRX_LINE_SUB_NUM &lt;&gt; #trxLineSubNum#
			AND SP.EZCANCELFLAG     = '0'
			
			AND SP.GLBL_CMPY_CD		= SA.GLBL_CMPY_CD
			AND SP.SHPG_PLN_NUM		= SA.SHPG_PLN_NUM
			AND SA.EZCANCELFLAG		= '0'

			AND SP.GLBL_CMPY_CD		= SPS.GLBL_CMPY_CD
			AND SP.SHPG_STS_CD		= SPS.SHPG_STS_CD
			AND SPS.SO_PRINT_FLG	= #soPtintFlg#
			AND SPS.EZCANCELFLAG	= '0'
		GROUP BY
			SP.MDSE_CD
			,SP.SET_MDSE_CD
	</statement>
		
</sqlMap>
