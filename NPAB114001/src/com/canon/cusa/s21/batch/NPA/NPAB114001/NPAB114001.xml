<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NPAB114001">

    <statement id="getMrpRunPrm" parameterClass="Map" resultClass="Map">
        SELECT
            MRP.MRP_RUN_PRM_PK
            ,NULL AS MRP_RUN_SCHD_ID
            ,MRP.LINE_BIZ_TP_CD
            ,MRP.RTL_WH_CD
            ,MRP.RTL_SWH_CD
            ,MRP.LOC_TP_CD
        FROM
            MRP_RUN_PRM MRP
        WHERE
            MRP.GLBL_CMPY_CD     = #glblCmpyCd#
        AND MRP.MRP_RUN_SCHD_ID  IS NULL
        <iterate property="mrpRptPrintProcStsCdList" var="mrpRptPrintProcStsCd[]" open="AND MRP.MRP_RPT_PRINT_PROC_STS_CD IN (" conjunction= ", " close=")">
            #mrpRptPrintProcStsCd[]#
        </iterate>
        AND MRP.EZCANCELFLAG     = '0'
        UNION ALL
        SELECT
            NULL AS MRP_RUN_PRM_PK
            ,MRP.MRP_RUN_SCHD_ID
            ,MRP.LINE_BIZ_TP_CD
            ,MRP.RTL_WH_CD
            ,MRP.RTL_SWH_CD
            ,MRP.LOC_TP_CD
        FROM
            MRP_RUN_PRM MRP
        WHERE
            MRP.GLBL_CMPY_CD     = #glblCmpyCd#
        AND MRP.MRP_RUN_SCHD_ID  IS NOT NULL
        <iterate property="mrpRptPrintProcStsCdList" var="mrpRptPrintProcStsCd[]" open="AND MRP.MRP_RPT_PRINT_PROC_STS_CD IN (" conjunction= ", " close=")">
            #mrpRptPrintProcStsCd[]#
        </iterate>
        AND MRP.EZCANCELFLAG     = '0'
        GROUP BY 
             MRP.MRP_RUN_SCHD_ID
            ,MRP.LINE_BIZ_TP_CD
            ,MRP.RTL_WH_CD
            ,MRP.RTL_SWH_CD
            ,MRP.LOC_TP_CD
    </statement>

    <statement id="getDummyMrpPrtWrkInfo" parameterClass="Map" resultClass="Map">
        SELECT WH.RTL_WH_CD
              ,WH.RTL_WH_NM
              ,SWH.RTL_SWH_CD
              ,SWH.RTL_SWH_NM
        FROM   RTL_WH WH
              ,RTL_SWH SWH
        WHERE  1 = 1
        AND    WH.GLBL_CMPY_CD  = #glblCmpyCd#
        AND    WH.RTL_WH_CD     = #rtlWhCd#
        AND    WH.EZCANCELFLAG  = '0'
        AND    WH.GLBL_CMPY_CD  = SWH.GLBL_CMPY_CD
        AND    WH.RTL_WH_CD     = SWH.RTL_WH_CD
        AND    SWH.RTL_SWH_CD   = #rtlSwhCd#
        AND    SWH.EZCANCELFLAG = '0'
    </statement>

    <statement id="getMrpRunPrmGrpPks" parameterClass="Map" resultClass="Map">
        SELECT
            MRP.MRP_RUN_PRM_PK
        FROM
            MRP_RUN_PRM MRP
        WHERE
            MRP.GLBL_CMPY_CD     = #glblCmpyCd#
        AND MRP.MRP_RUN_SCHD_ID  = #mrpRunSchdId#
        <iterate property="mrpRptPrintProcStsCdList" var="mrpRptPrintProcStsCd[]" open="AND MRP.MRP_RPT_PRINT_PROC_STS_CD IN (" conjunction= ", " close=")">
            #mrpRptPrintProcStsCd[]#
        </iterate>
        AND MRP.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getMrpRptWrkPks" parameterClass="Map" resultClass="Map">
        SELECT
            MRW.MRP_RPT_WRK_PK
        FROM
            MRP_RPT_WRK MRW
        WHERE
            MRW.GLBL_CMPY_CD     = #glblCmpyCd#
        AND MRW.MRP_RUN_PRM_PK   = #mrpRunPrmPk#
        <isNotNull property="rtlWhCd">
        AND MRW.RTL_WH_CD        = #rtlWhCd#
        </isNotNull>
        <isNotNull property="mrpRunSchdId">
        AND MRW.MRP_RUN_SCHD_ID  = #mrpRunSchdId#
        </isNotNull>
        AND MRW.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getMrpRunPrmWithSeq" parameterClass="Map" resultClass="Map">
        SELECT
            MRP.MRP_RUN_PRM_PK
        FROM
            MRP_RUN_PRM MRP
        WHERE
            MRP.GLBL_CMPY_CD            = #glblCmpyCd#
        AND MRP.MRP_RPT_PRINT_RQST_SQ   = #mrpRptPrintRqstSq#
        AND MRP.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getMrpInfoWhInfo" parameterClass="Map" resultClass="Map">
        SELECT
             MI.RTL_WH_CD
            ,MI.RTL_SWH_CD
            ,MI.MRP_PLN_NM
        FROM
             MRP_RUN_PRM MRP
            ,MRP_INFO MI
        WHERE
            MRP.GLBL_CMPY_CD        = #glblCmpyCd#
        AND MRP.MRP_RUN_SCHD_ID     IS NULL
        AND MRP.GLBL_CMPY_CD        = MI.GLBL_CMPY_CD
        AND MRP.MRP_RUN_PRM_PK      = #mrpRunPrmPk#
        AND MRP.MRP_RUN_PRM_PK      = MI.MRP_RUN_PRM_PK
        AND MI.MRP_ENBL_FLG         = #mrpEnblFlg#
        AND MI.MRP_INFO_RGTN_STS_CD = #mrpInfoRgtnStsCd#
        AND MRP.EZCANCELFLAG        = '0'
        AND MI.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getRtlWhList" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
             MRW.RTL_WH_CD
            ,MRW.MRP_RUN_SCHD_ID
            ,MRW.MRP_PLN_NM_SRCH_TXT
        FROM
            MRP_RPT_WRK MRW
        WHERE
            MRW.GLBL_CMPY_CD     = #glblCmpyCd#
        AND MRW.MRP_RUN_PRM_PK   = #mrpRunPrmPk#
        AND MRW.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getMrpRunPrmCoverPageData" parameterClass="Map" resultClass="Map">
        SELECT
            MRP.MRP_RUN_PRM_PK
           ,MRP.MRP_PLN_NM
           ,MRP.RTL_WH_CD
           ,MRP.RTL_SWH_CD
           ,MRP.DMND_CTOFF_DT
           ,MRP.DMND_CTOFF_DAYS_AOT
           ,MRP.SPLY_CTOFF_DT
           ,MRP.SPLY_CTOFF_DAYS_AOT
           ,MRP.CRAT_PRCH_REQ_FLG
           ,MRP.PRINT_ITEM_STS_FLG
           ,MRP.PRINT_ITEM_DESC_FLG
        FROM
            MRP_RUN_PRM MRP
        WHERE
            MRP.GLBL_CMPY_CD     = #glblCmpyCd#
        AND MRP.MRP_RUN_PRM_PK   = #mrpRunPrmPk#
        AND MRP.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getNoDataFoundCount" parameterClass="Map" resultClass="Map">
        SELECT
            COUNT(*) CNT
           ,SUM(CASE MRW.MDSE_DESC_SHORT_TXT
                 WHEN 'No Data Found.' THEN 1
                 ELSE 0
            END) NO_DATA_FOUND_CNT
        FROM
            MRP_RPT_WRK MRW
        WHERE
            MRW.GLBL_CMPY_CD            = #glblCmpyCd#
        AND MRW.MRP_RPT_PRINT_RQST_SQ   = #mrpRptPrintRqstSq#
        AND MRW.EZCANCELFLAG            = '0'
    </statement>
    
    <statement id="getMrpInfoPlanName" parameterClass="Map" resultClass="Map">
        SELECT
             MAX(MI.MRP_PLN_NM) MRP_PLN_NM
        FROM
             MRP_INFO MI
        WHERE
            MI.GLBL_CMPY_CD         = #glblCmpyCd#
        AND MI.MRP_RUN_PRM_PK       = #mrpRunPrmPk#
        AND MI.MRP_ENBL_FLG         = #mrpEnblFlg#
        AND MI.MRP_INFO_RGTN_STS_CD = #mrpInfoRgtnStsCd#
        AND MI.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getNoDataReport" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
             MRP.RTL_WH_CD
            ,MRP.MRP_RUN_SCHD_ID
            ,MI.MRP_PLN_NM
        FROM
             MRP_RUN_PRM MRP
            ,MRP_INFO MI
        WHERE
            MRP.GLBL_CMPY_CD     = #glblCmpyCd#
        AND MRP.MRP_RUN_PRM_PK   = #mrpRunPrmPk#
        <iterate property="mrpRptPrintProcStsCdList" var="mrpRptPrintProcStsCd[]" open="AND MRP.MRP_RPT_PRINT_PROC_STS_CD IN (" conjunction= ", " close=")">
            #mrpRptPrintProcStsCd[]#
        </iterate>
        AND MRP.MRP_RPT_PRINT_RQST_SQ IS NULL
        AND MRP.EZCANCELFLAG     = '0'
        AND MRP.GLBL_CMPY_CD        = MI.GLBL_CMPY_CD(+)
        AND MRP.MRP_RUN_PRM_PK      = MI.MRP_RUN_PRM_PK(+)
        AND MI.EZCANCELFLAG(+)      = '0'
    </statement>

</sqlMap>
