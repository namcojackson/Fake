<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL7190Query">

    <typeAlias alias="NMAL7190SMsg"    type="business.blap.NMAL7190.NMAL7190SMsg"/>
    <typeAlias alias="NMAL7190_ASMsg"  type="business.blap.NMAL7190.NMAL7190_ASMsg"/>

    <statement id="getPrcGrp" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM
        <!--2023/04/20 QC#61200 Add Start-->
        (SELECT
            *
         FROM
        <!--2023/04/20 QC#61200 Add End-->
            (SELECT
                PG.PRC_GRP_PK                  AS PRC_GRP_PK
                ,PG.PRC_GRP_NM                 AS PRC_GRP_NM
                ,PG.PRC_GRP_DESC_TXT           AS PRC_GRP_DESC_TXT
                ,PG.PRC_GRP_TP_CD              AS PRC_GRP_TP_CD
                ,PG.PRC_GRP_TRX_TP_CD          AS PRC_GRP_TRX_TP_CD <!-- QC#18785 -->
                ,PG.ACTV_FLG                   AS ACTV_FLG
                ,PG.EFF_FROM_DT                AS EFF_FROM_DT
                ,PG.EFF_THRU_DT                AS EFF_THRU_DT
                ,PG.EZUPTIME                   AS EZUPTIME
                ,PG.EZUPTIMEZONE               AS EZUPTIMEZONE
                ,PGD.PRC_GRP_DTL_PK            AS PRC_GRP_DTL_PK
                ,PGD.PRC_GRP_TRGT_TP_CD        AS PRC_GRP_TRGT_TP_CD
                ,PGD.PRC_GRP_TRGT_ATTRB_CD     AS PRC_GRP_TRGT_ATTRB_CD
                ,PGD.PRC_GRP_OP_CD             AS PRC_GRP_OP_CD
                ,PGD.PRC_GRP_FROM_TXT          AS PRC_GRP_FROM_TXT
                ,PGD.PRC_GRP_THRU_TXT          AS PRC_GRP_THRU_TXT
                ,PGD.PRC_GRP_PRCD_NUM          AS PRC_GRP_PRCD_NUM  <!-- QC#18785 -->
                ,PGD.EFF_FROM_DT               AS DTL_EFF_FROM_DT
                ,PGD.EFF_THRU_DT               AS DTL_EFF_THRU_DT
                ,PGD.EZUPTIME                  AS DTL_EZUPTIME
                ,PGD.EZUPTIMEZONE              AS DTL_EZUPTIMEZONE
                ,PTA.PRC_GRP_OP_EQUAL_FLG      AS PRC_GRP_OP_EQUAL_FLG
                ,PTA.PRC_GRP_OP_NOT_EQUAL_FLG  AS PRC_GRP_OP_NOT_EQUAL_FLG
                ,PTA.PRC_GRP_OP_LIKE_FLG       AS PRC_GRP_OP_LIKE_FLG
                ,PTA.PRC_GRP_OP_BTW_FLG        AS PRC_GRP_OP_BTW_FLG
                ,PTA.PRC_GRP_CONV_FLG          AS PRC_GRP_CONV_FLG
                <!--2023/04/20 QC#61200 Add Start-->
                ,CASE WHEN PGD.PRC_GRP_TRGT_ATTRB_CD = #prcGrpTrgtAttrbCdDisc#
                   THEN
                     CASE WHEN 1 =
                         (SELECT COUNT(A.DS_ACCT_NM) FROM SELL_TO_CUST A
                              WHERE A.GLBL_CMPY_CD = PGD.GLBL_CMPY_CD AND A.SELL_TO_CUST_CD = PGD.PRC_GRP_FROM_TXT AND A.EZCANCELFLAG = 0)
                       THEN
                         (SELECT A.DS_ACCT_NM FROM SELL_TO_CUST A
                              WHERE A.GLBL_CMPY_CD = PGD.GLBL_CMPY_CD AND A.SELL_TO_CUST_CD = PGD.PRC_GRP_FROM_TXT AND A.EZCANCELFLAG = 0)
                       ELSE NULL
                     END
                   ELSE NULL
                 END AS DS_ACCT_NM
                <!--2023/04/20 QC#61200 Add End-->
            FROM
                 PRC_GRP            PG
                ,PRC_GRP_DTL        PGD
                ,PRC_GRP_TRGT_ATTRB PTA
                ,PRC_GRP_TP         PGT
                ,PRC_GRP_TRGT_TP    PTT
                ,PRC_GRP_OP         PGO
            WHERE
                PG.GLBL_CMPY_CD           = #glblCmpyCd#
            AND PG.EZCANCELFLAG           = '0'
            AND PG.PRC_GRP_PK             = #prcGrpPk#

            AND PG.GLBL_CMPY_CD           = PGT.GLBL_CMPY_CD(+)
            AND PGT.EZCANCELFLAG(+)       = '0'
            AND PG.PRC_GRP_TP_CD          = PGT.PRC_GRP_TP_CD(+)

            AND PG.GLBL_CMPY_CD           = PGD.GLBL_CMPY_CD(+)
            AND PGD.EZCANCELFLAG(+)       = '0'
            AND PG.PRC_GRP_PK             = PGD.PRC_GRP_PK(+)

            AND PGD.GLBL_CMPY_CD          = PGO.GLBL_CMPY_CD(+)
            AND PGO.EZCANCELFLAG(+)       = '0'
            AND PGD.PRC_GRP_OP_CD         = PGO.PRC_GRP_OP_CD(+)

            AND PGD.GLBL_CMPY_CD          = PTT.GLBL_CMPY_CD(+)
            AND PTT.EZCANCELFLAG(+)       = '0'
            AND PGD.PRC_GRP_TRGT_TP_CD    = PTT.PRC_GRP_TRGT_TP_CD(+)

            AND PGD.GLBL_CMPY_CD          = PTA.GLBL_CMPY_CD(+)
            AND PTA.EZCANCELFLAG(+)       = '0'
            AND PGD.PRC_GRP_TRGT_TP_CD    = PTA.PRC_GRP_TRGT_TP_CD(+)
            AND PGD.PRC_GRP_TRGT_ATTRB_CD = PTA.PRC_GRP_TRGT_ATTRB_CD(+)
            <!-- 2018/12/05 QC#29324 Add Start -->
            <isNotNull property="prcGrpTrgtTpCd">
                 AND PGD.PRC_GRP_TRGT_TP_CD(+) = #prcGrpTrgtTpCd#
            </isNotNull>
            <isNotNull property="prcGrpTrgtAttrbCd">
                 AND PGD.PRC_GRP_TRGT_ATTRB_CD(+) = #prcGrpTrgtAttrbCd#
            </isNotNull>
            <isNotNull property="xxPrcQlfyValSrchTxt_TF">
                <iterate property="xxPrcQlfyValSrchTxt_TF" var="xxPrcQlfyValSrchTxt_TF[]" open="AND (" close=")" conjunction="OR">
                    PGD.PRC_GRP_FROM_TXT(+) LIKE #xxPrcQlfyValSrchTxt_TF[]#
                </iterate>
            </isNotNull>
            <isNotNull property="xxPrcQlfyValSrchTxt_TT">
                <iterate property="xxPrcQlfyValSrchTxt_TT" var="xxPrcQlfyValSrchTxt_TT[]" open="AND (" close=")" conjunction="OR">
                    PGD.PRC_GRP_THRU_TXT(+) LIKE #xxPrcQlfyValSrchTxt_TT[]#
                </iterate>
            </isNotNull>
            <isNotNull property="prcGrpPrcdNum">
                 AND PGD.PRC_GRP_PRCD_NUM(+) = #prcGrpPrcdNum#
            </isNotNull>
            <isNotNull property="effFromDt_H1">
                 AND PGD.EFF_FROM_DT(+) &gt;= #effFromDt_H1#
            </isNotNull>
            <isNotNull property="effFromDt_H2">
                 AND PGD.EFF_FROM_DT(+) &lt;= #effFromDt_H2#
            </isNotNull>
            <isNotNull property="effThruDt_H1">
                 AND NVL(PGD.EFF_THRU_DT(+), #highValDt#) &gt;= #effThruDt_H1#
            </isNotNull>
            <isNotNull property="effThruDt_H2">
                 AND NVL(PGD.EFF_THRU_DT(+), #highValDt#) &lt;= #effThruDt_H2#
            </isNotNull>
            <!-- 2018/12/05 QC#29324 Add End -->
            ORDER BY
                PGD.PRC_GRP_TRGT_TP_CD
                ,PGD.PRC_GRP_TRGT_ATTRB_CD
                ,PGD.PRC_GRP_FROM_TXT
                ,PGD.PRC_GRP_THRU_TXT
                ,PGD.PRC_GRP_PRCD_NUM
            )
        <!--2023/04/20 QC#61200 Add Start-->
        <isNotNull property="dsAcctNm">
        WHERE
            DS_ACCT_NM   LIKE #dsAcctNm#
        </isNotNull>
        ORDER BY
            PRC_GRP_TRGT_TP_CD
            ,PRC_GRP_TRGT_ATTRB_CD
            ,PRC_GRP_FROM_TXT
            ,PRC_GRP_THRU_TXT
            ,PRC_GRP_PRCD_NUM
        )
        <!--2023/04/20 QC#61200 Add End-->
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getPrcGrpTrgtTp" parameterClass="Map" resultClass="Map">
         SELECT
              TT.PRC_GRP_TRGT_TP_CD       AS PRC_GRP_TRGT_TP_CD
             ,TT.PRC_GRP_TRGT_TP_DESC_TXT AS PRC_GRP_TRGT_TP_DESC_TXT
         FROM
              PRC_GRP_TRGT_TP   TT
             ,PRC_GRP_TRGT_RELN TR
         WHERE
             TR.GLBL_CMPY_CD       = #glblCmpyCd#
         AND TR.EZCANCELFLAG       = '0'
         AND TR.PRC_GRP_TP_CD      = #prcGrpTpCd#
         AND TT.GLBL_CMPY_CD       = #glblCmpyCd#
         AND TT.EZCANCELFLAG       = '0'
         AND TT.PRC_GRP_TRGT_TP_CD = TR.PRC_GRP_TRGT_TP_CD
         ORDER BY TT.PRC_GRP_TRGT_TP_SORT_NUM
    </statement>

    <statement id="getPriceGroupName" parameterClass="Map" resultClass="Map">
         SELECT
              PG.PRC_GRP_PK             AS PRC_GRP_PK
             ,PG.PRC_GRP_NM             AS PRC_GRP_NM
         FROM
             PRC_GRP            PG
         WHERE
             PG.GLBL_CMPY_CD           = #glblCmpyCd#
         AND PG.EZCANCELFLAG           = '0'
         AND PG.PRC_GRP_NM             = #prcGrpNm#
    </statement>
</sqlMap>
