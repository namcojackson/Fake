<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWCB031001">
    <statement id="getInvoiceTargetData" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
              TMP.INV_NUM
            , TMP.INV_TP_CD
            , TMP.TYPE
            , TMP.BILL_TO_CUST_ACCT_CD
            , TMP.DS_EDI_TRD_PTNR_CD
            , TMP.DS_EDI_TRD_PTNR_NUM
            , TMP.DS_EDI_TRD_PTNR_NM
            , TMP.INV_INTFC_ID
            , TMP.SVC_INV_SRC_TP_CD
         FROM (SELECT I.INV_NUM
                    , I.INV_TP_CD
                    , #typeOM#         TYPE
                    , I.BILL_TO_CUST_ACCT_CD
                    , DETP.DS_EDI_TRD_PTNR_CD
                    , DETP.DS_EDI_TRD_PTNR_NUM
                    , DETP.DS_EDI_TRD_PTNR_NM
                    , DETP.INV_INTFC_ID
                    , NULL AS SVC_INV_SRC_TP_CD
                 FROM INV              I
                    , INV_PRT_CTRL     IPC
                    , XTRNL_INTFC_XREF XIX
                    , DS_EDI_TRD_PTNR  DETP
                WHERE I.GLBL_CMPY_CD = IPC.GLBL_CMPY_CD
                  AND I.EZCANCELFLAG = IPC.EZCANCELFLAG
                  AND I.INV_NUM      = IPC.INV_NUM
                  AND I.GLBL_CMPY_CD = XIX.GLBL_CMPY_CD
                  AND I.EZCANCELFLAG = XIX.EZCANCELFLAG
                  AND I.BILL_TO_CUST_ACCT_CD = XIX.TRGT_ATTRB_TXT_01
                  AND XIX.GLBL_CMPY_CD = DETP.GLBL_CMPY_CD
                  AND XIX.EZCANCELFLAG = DETP.EZCANCELFLAG
                  AND XIX.SRC_ATTRB_TXT_01 = DETP.DS_EDI_TRD_PTNR_CD
                  AND I.GLBL_CMPY_CD = #glblCmpyCd#
                  AND I.EZCANCELFLAG = '0'
                  AND I.FNLZ_INV_FLG = #flgY#
                  AND I.INV_TOT_DEAL_NET_AMT &lt;&gt; #amountZero#
                  AND NOT EXISTS
                       ( SELECT '1'
                           FROM SVC_INV SI
                          WHERE SI.GLBL_CMPY_CD = I.GLBL_CMPY_CD
                            AND SI.SVC_INV_NUM = I.INV_NUM
                       )
                  AND IPC.INV_EDI_PROC_STS_CD = #invEdiProcStsCd#
                  AND XIX.INTFC_XREF_CTX_TP_CD = #intfcXrefCtxTpCd#
                  AND XIX.INTFC_ID = #intfcId#
                  AND DETP.SEND_INV_FLG = #flgY#
                  AND (DETP.CM_SEND_FLG = #flgY#
                       OR
                       (DETP.CM_SEND_FLG = #flgN#
                        AND
                        I.INV_TP_CD &lt;&gt; #invTpCreditMemo#
                       )
                      )
                UNION ALL
               SELECT I.INV_NUM
                    , I.INV_TP_CD
                    , #typeSVC#        TYPE
                    , I.BILL_TO_CUST_ACCT_CD
                    , DETP.DS_EDI_TRD_PTNR_CD
                    , DETP.DS_EDI_TRD_PTNR_NUM
                    , DETP.DS_EDI_TRD_PTNR_NM
                    , DETP.INV_INTFC_ID
                    , SI.SVC_INV_SRC_TP_CD
                 FROM INV              I
                    , SVC_INV          SI
                    , INV_PRT_CTRL     IPC
                    , XTRNL_INTFC_XREF XIX
                    , DS_EDI_TRD_PTNR  DETP
                WHERE I.GLBL_CMPY_CD = IPC.GLBL_CMPY_CD
                  AND I.EZCANCELFLAG = IPC.EZCANCELFLAG
                  AND I.INV_NUM      = IPC.INV_NUM
                  AND I.GLBL_CMPY_CD = XIX.GLBL_CMPY_CD
                  AND I.EZCANCELFLAG = XIX.EZCANCELFLAG
                  AND I.BILL_TO_CUST_ACCT_CD = XIX.TRGT_ATTRB_TXT_01
                  AND I.GLBL_CMPY_CD = SI.GLBL_CMPY_CD
                  AND I.EZCANCELFLAG = SI.EZCANCELFLAG
                  AND I.INV_NUM = SI.SVC_INV_NUM
                  AND XIX.GLBL_CMPY_CD = DETP.GLBL_CMPY_CD
                  AND XIX.EZCANCELFLAG = DETP.EZCANCELFLAG
                  AND XIX.SRC_ATTRB_TXT_01 = DETP.DS_EDI_TRD_PTNR_CD
                  AND I.GLBL_CMPY_CD = #glblCmpyCd#
                  AND I.EZCANCELFLAG = '0'
                  AND I.FNLZ_INV_FLG = #flgY#
                  AND I.INV_TOT_DEAL_NET_AMT &lt;&gt; #amountZero#
                  AND IPC.INV_EDI_PROC_STS_CD = #invEdiProcStsCd#
                  AND XIX.INTFC_XREF_CTX_TP_CD = #intfcXrefCtxTpCd#
                  AND XIX.INTFC_ID = #intfcId#
                  AND DETP.SEND_INV_FLG = #flgY#
                  AND ((DETP.CM_SEND_FLG = #flgY#
                        OR
                        (DETP.CM_SEND_FLG = #flgN#
                         AND
                         I.INV_TP_CD &lt;&gt; #invTpCreditMemo#
                        )
                       )
                       AND
                       ((DETP.CONTR_INV_SEND_FLG = #flgY#
                         OR
                         (DETP.CONTR_INV_SEND_FLG = #flgN#
                          AND
                          SI.SVC_INV_SRC_TP_CD &lt;&gt; #svcInvSrcTpContract#
                         )
                        )
                        OR
                        (DETP.DISPT_INV_SEND_FLG = #flgY#
                         OR
                         (DETP.DISPT_INV_SEND_FLG = #flgN#
                          AND
                          SI.SVC_INV_SRC_TP_CD &lt;&gt; #svcInvSrcTpDispatch#
                         )
                        )
                       )
                      )
              ) TMP
        ORDER BY TMP.INV_INTFC_ID
               , TMP.BILL_TO_CUST_ACCT_CD
               , TMP.DS_EDI_TRD_PTNR_CD
               , TMP.INV_NUM
               , TMP.TYPE
    </statement>

    <statement id="getHeaderData" parameterClass="Map" resultClass="Map">
        SELECT I.INV_NUM
             , I.INV_DT
             , I.CUST_ISS_PO_NUM
             , I.CUST_ISS_PO_DT
             , I.CPO_ORD_NUM
             , I.ORD_DT
             , DECODE(I.INV_TP_CD, #invTpCdCr#, #invTpNmCr#, #invTpNmDr#) INV_TYPE
             , I.BILL_TO_CUST_ACCT_CD
             , I.BILL_TO_CUST_ACCT_NM
             , BILL.FIRST_LINE_ADDR
             , BILL.SCD_LINE_ADDR
             , BILL.THIRD_LINE_ADDR
             , BILL.FRTH_LINE_ADDR
             , BILL.CTY_ADDR
             , BILL.ST_CD
             , BILL.POST_CD
             , CNTY.CNTY_NM
             , BILL.CTRY_CD
             , I.BILL_TO_CTAC_PSN_LAST_NM
             , I.BILL_TO_CTAC_PSN_FIRST_NM
             , STC.DS_CUST_SIC_CD
             , (SELECT DS_CTAC_PNT_VAL_TXT
                  FROM (
                 SELECT DCP.DS_CTAC_PNT_VAL_TXT
                   FROM DS_CTAC_PNT DCP
                  WHERE DCP.GLBL_CMPY_CD = I.GLBL_CMPY_CD
                    AND DCP.EZCANCELFLAG = I.EZCANCELFLAG
                    AND DCP.CTAC_PSN_PK  = I.CTAC_PSN_PK
                    AND DCP.DS_CTAC_PNT_TP_CD = #phoneWrk#
                    AND DCP.DS_OPS_OUT_FLG    = #flgN#
                    AND DCP.DS_CTAC_PNT_ACTV_FLG = #flgY#
                  ORDER BY DCP.DS_CTAC_PNT_PK DESC
                       )
                 WHERE ROWNUM = 1
               ) DS_CTAC_PNT_VAL_TXT
             , DXA.DS_XREF_ACCT_CD
             , REM.LOC_NM
             , REM.FIRST_LINE_ADDR     REM_FIRST_LINE_ADDR
             , REM.SCD_LINE_ADDR       REM_SCD_LINE_ADDR
             , REM.THIRD_LINE_ADDR     REM_THIRD_LINE_ADDR
             , REM.FRTH_LINE_ADDR      REM_FRTH_LINE_ADDR
             , REM.CTY_ADDR            REM_CTY_ADDR
             , REM.ST_CD               REM_ST_CD
             , REM.POST_CD             REM_POST_CD
             , XIX.SRC_ATTRB_TXT_01
             , $lpadInvTotDealNetAmt$  INV_TOT_DEAL_NET_AMT
             , $lpadINvTotDealTaxAmt$  INV_TOT_DEAL_TAX_AMT
             , $lpadStTaxAmt$          ST_TAX_AMT
             , $lpadCntyTaxAmt$        CNTY_TAX_AMT
             , $lpadCityTaxAmt$        CITY_TAX_AMT
             , I.NET_DUE_DT
             , TO_CHAR(TO_DATE(I.NET_DUE_DT, #dateFmt#), #dateFmtDD#) AS NET_DUE_DAYS
             , PT.PMT_TERM_NM
             , I.DEAL_CCY_CD
             , I.SYS_SRC_CD
             , SI.FSR_NUM
             , SI.CR_CARD_CUST_REF_NUM
             , PTCD.PMT_CC_FLG
             , I.SELL_TO_CUST_CD
             , DIT.AR_COA_ACCT_CD
             , DIT.INV_SRC_TXT
             , SI.DS_CONTR_CATG_CD
             , I.DS_ORD_CATG_CD
             , I.DS_ORD_TP_CD
             , I.DS_ORD_RSN_CD
          FROM INV           I
             , SVC_INV       SI
             , BILL_TO_CUST  BILL
             , CNTY          CNTY
             , SELL_TO_CUST  STC
             , REM_TO        REM
             , (SELECT DILTD.INV_NUM
                     , SUM(DEAL_SLS_TAX_AMT) DEAL_SLS_TAX_AMT
                  FROM DS_INV_LINE_TAX_DTL DILTD
                 WHERE DILTD.GLBL_CMPY_CD = #glblCmpyCd#
                   AND DILTD.EZCANCELFLAG = '0'
                   AND DILTD.INV_NUM = #invNum#
                   AND DILTD.DS_SLS_TAX_TP_CD IN (#taxTpState#, #taxTpFrtState#)
                 GROUP BY DILTD.INV_NUM
               ) TAX_ST
             , (SELECT DILTD.INV_NUM
                     , SUM(DEAL_SLS_TAX_AMT) DEAL_SLS_TAX_AMT
                  FROM DS_INV_LINE_TAX_DTL DILTD
                 WHERE DILTD.GLBL_CMPY_CD = #glblCmpyCd#
                   AND DILTD.EZCANCELFLAG = '0'
                   AND DILTD.INV_NUM = #invNum#
                   AND DILTD.DS_SLS_TAX_TP_CD IN (#taxTpCounty#, #taxTpFrtCounty#)
                 GROUP BY DILTD.INV_NUM
               ) TAX_CNTY
             , (SELECT DILTD.INV_NUM
                     , SUM(DEAL_SLS_TAX_AMT) DEAL_SLS_TAX_AMT
                  FROM DS_INV_LINE_TAX_DTL DILTD
                 WHERE DILTD.GLBL_CMPY_CD = #glblCmpyCd#
                   AND DILTD.EZCANCELFLAG = '0'
                   AND DILTD.INV_NUM = #invNum#
                   AND DILTD.DS_SLS_TAX_TP_CD IN (#taxTpCity#, #taxTpFrtCity#)
                 GROUP BY DILTD.INV_NUM
               ) TAX_CITY
             , PMT_TERM      PT
             , PMT_TERM_CASH_DISC PTCD
             , DS_INV_TP     DIT
             , DS_XREF_ACCT  DXA
             , XTRNL_INTFC_XREF XIX
         WHERE I.GLBL_CMPY_CD = SI.GLBL_CMPY_CD(+)
           AND I.EZCANCELFLAG = SI.EZCANCELFLAG(+)
           AND I.INV_NUM      = SI.SVC_INV_NUM(+)
           AND I.GLBL_CMPY_CD = BILL.GLBL_CMPY_CD
           AND I.EZCANCELFLAG = BILL.EZCANCELFLAG
           AND I.BILL_TO_CUST_CD = BILL.BILL_TO_CUST_CD
           AND BILL.GLBL_CMPY_CD = CNTY.GLBL_CMPY_CD(+)
           AND BILL.EZCANCELFLAG = CNTY.EZCANCELFLAG(+)
           AND BILL.CNTY_PK      = CNTY.CNTY_PK(+)
           AND I.GLBL_CMPY_CD = STC.GLBL_CMPY_CD
           AND I.EZCANCELFLAG = STC.EZCANCELFLAG
           AND I.BILL_TO_CUST_ACCT_CD = STC.SELL_TO_CUST_CD
           AND BILL.GLBL_CMPY_CD = REM.GLBL_CMPY_CD
           AND BILL.EZCANCELFLAG = REM.EZCANCELFLAG
           AND BILL.REM_ID       = REM.REM_ID
           AND I.INV_NUM      = TAX_ST.INV_NUM(+)
           AND I.INV_NUM      = TAX_CNTY.INV_NUM(+)
           AND I.INV_NUM      = TAX_CITY.INV_NUM(+)
           AND I.GLBL_CMPY_CD = PT.GLBL_CMPY_CD
           AND I.EZCANCELFLAG = PT.EZCANCELFLAG
           AND I.PMT_TERM_CD  = PT.PMT_TERM_CD
           AND I.GLBL_CMPY_CD = PTCD.GLBL_CMPY_CD
           AND I.EZCANCELFLAG = PTCD.EZCANCELFLAG
           AND I.PMT_TERM_CASH_DISC_CD  = PTCD.PMT_TERM_CASH_DISC_CD
           AND I.GLBL_CMPY_CD = DIT.GLBL_CMPY_CD
           AND I.EZCANCELFLAG = DIT.EZCANCELFLAG
           AND I.DS_INV_TP_CD = DIT.DS_INV_TP_CD
           AND BILL.GLBL_CMPY_CD = DXA.GLBL_CMPY_CD(+)
           AND BILL.EZCANCELFLAG = DXA.EZCANCELFLAG(+)
           AND BILL.LOC_NUM      = DXA.LOC_NUM(+)
           AND DXA.DS_XREF_ACCT_TP_CD(+) = #xrefAcctTpOracle#
           AND I.GLBL_CMPY_CD = XIX.GLBL_CMPY_CD(+)
           AND I.EZCANCELFLAG = XIX.EZCANCELFLAG(+)
           AND I.PMT_TERM_CASH_DISC_CD  = XIX.TRGT_ATTRB_TXT_02(+)
           AND XIX.INTFC_ID(+) = #intfcId#
           AND XIX.INTFC_XREF_CTX_TP_CD(+) = #intfcXrefCtxTpCd#
           AND XIX.TRGT_ATTRB_TXT_01(+) = #dsEdiTrdPtnrCd#
           AND I.GLBL_CMPY_CD = #glblCmpyCd#
           AND I.EZCANCELFLAG = '0'
           AND I.INV_NUM = #invNum#
    </statement>

    <statement id="getEasyPack" parameterClass="Map" resultClass="Map">
        SELECT
            '1'
        FROM
             ORD_CATG_BIZ_CTX OCBC
            ,SPLY_PGM_CONTR   SPC
        WHERE
                OCBC.GLBL_CMPY_CD                  = #glblCmpyCd#
            AND OCBC.DS_ORD_CATG_CD                = #dsOrdCatgCd#
            <isNotNull property="dsOrdTpCd" >
            AND
                (
                       OCBC.DS_ORD_TP_CD           = #dsOrdTpCd#
                    OR OCBC.DS_ORD_TP_CD           IS NULL
                )
            </isNotNull>
            <isNull property="dsOrdTpCd" >
            AND OCBC.DS_ORD_TP_CD                  IS NULL
            </isNull>
            <isNotNull property="dsOrdRsnCd" >
            AND
                (
                       OCBC.DS_ORD_RSN_CD           = #dsOrdRsnCd#
                    OR OCBC.DS_ORD_RSN_CD          IS NULL
                )
            </isNotNull>
            <isNull property="dsOrdRsnCd" >
            AND OCBC.DS_ORD_RSN_CD                 IS NULL
            </isNull>
            AND OCBC.ORD_CATG_CTX_TP_CD            IN (#easyPack1#, #easyPack1Return#)
            AND OCBC.GLBL_CMPY_CD                  = SPC.GLBL_CMPY_CD
            AND SPC.BILL_TO_CUST_ACCT_CD           = #billtoCustAcctCd#
            AND SPC.EFF_FROM_DT                   &lt;= #effDt#
            AND NVL(SPC.EFF_THRU_DT, #limitDate#) &gt;= #effDt#
            AND OCBC.EZCANCELFLAG                  = '0'
            AND SPC.EZCANCELFLAG                   = '0'
            AND ROWNUM                             = 1
    </statement>

    <statement id="getShipToInfoOM" parameterClass="Map" resultClass="Map">
        SELECT TMP.SHIP_TO_CUST_ACCT_CD     SELL_TO_CUST_CD
             , TMP.SHIP_TO_CUST_ACCT_NM     DS_ACCT_NM
             , TMP.SHIP_TO_FIRST_LINE_ADDR  FIRST_LINE_ADDR
             , TMP.SHIP_TO_SCD_LINE_ADDR    SCD_LINE_ADDR
             , TMP.SHIP_TO_THIRD_LINE_ADDR  THIRD_LINE_ADDR
             , TMP.SHIP_TO_FRTH_LINE_ADDR   FRTH_LINE_ADDR
             , TMP.SHIP_TO_CTY_ADDR         CTY_ADDR
             , TMP.SHIP_TO_ST_CD            ST_CD
             , TMP.SHIP_TO_CTRY_CD          CTRY_CD
             , TMP.SHIP_TO_POST_CD          POST_CD
             , TMP.DS_CUST_SIC_CD
             , TMP.DS_XREF_ACCT_CD
         FROM (SELECT IB.SHIP_TO_CUST_ACCT_CD
                    , IB.SHIP_TO_CUST_ACCT_NM
                    , IB.SHIP_TO_FIRST_LINE_ADDR
                    , IB.SHIP_TO_SCD_LINE_ADDR
                    , IB.SHIP_TO_THIRD_LINE_ADDR
                    , IB.SHIP_TO_FRTH_LINE_ADDR
                    , IB.SHIP_TO_CTY_ADDR
                    , IB.SHIP_TO_ST_CD
                    , IB.SHIP_TO_CTRY_CD
                    , IB.SHIP_TO_POST_CD
                    , STC.DS_CUST_SIC_CD
                    , DXA.DS_XREF_ACCT_CD
                 FROM INV_BOL      IB
                    , SELL_TO_CUST STC
                    , SHIP_TO_CUST SHIP
                    , DS_XREF_ACCT DXA
                WHERE IB.GLBL_CMPY_CD   = STC.GLBL_CMPY_CD
                  AND IB.EZCANCELFLAG   = STC.EZCANCELFLAG
                  AND IB.SHIP_TO_CUST_ACCT_CD = STC.SELL_TO_CUST_CD
                  AND IB.GLBL_CMPY_CD    = SHIP.GLBL_CMPY_CD
                  AND IB.EZCANCELFLAG    = SHIP.EZCANCELFLAG
                  AND IB.SHIP_TO_CUST_CD = SHIP.SHIP_TO_CUST_CD
                  AND SHIP.GLBL_CMPY_CD    = DXA.GLBL_CMPY_CD(+)
                  AND SHIP.EZCANCELFLAG    = DXA.EZCANCELFLAG(+)
                  AND SHIP.LOC_NUM         = DXA.LOC_NUM(+)
                  AND DXA.DS_XREF_ACCT_TP_CD(+) = #xrefAcctTpOracle#
                  AND IB.GLBL_CMPY_CD = #glblCmpyCd#
                  AND IB.EZCANCELFLAG = '0'
                  AND IB.INV_NUM = #invNum#
                ORDER BY IB.INV_BOL_LINE_NUM
              ) TMP
          WHERE ROWNUM = #numOne#
    </statement>

    <statement id="getShipToInfoSvcContr" parameterClass="Map" resultClass="Map">
        SELECT TMP.SELL_TO_CUST_CD
             , TMP.DS_ACCT_NM
             , TMP.FIRST_LINE_ADDR
             , TMP.SCD_LINE_ADDR
             , TMP.THIRD_LINE_ADDR
             , TMP.FRTH_LINE_ADDR
             , TMP.CTY_ADDR
             , TMP.ST_CD
             , TMP.CTRY_CD
             , TMP.POST_CD
             , TMP.DS_CUST_SIC_CD
             , TMP.DS_XREF_ACCT_CD
         FROM (SELECT STC.SELL_TO_CUST_CD
                    , STC.DS_ACCT_NM
                    , SHIP.FIRST_LINE_ADDR
                    , SHIP.SCD_LINE_ADDR
                    , SHIP.THIRD_LINE_ADDR
                    , SHIP.FRTH_LINE_ADDR
                    , SHIP.CTY_ADDR
                    , SHIP.ST_CD
                    , SHIP.CTRY_CD
                    , SHIP.POST_CD
                    , STC.DS_CUST_SIC_CD
                    , DXA.DS_XREF_ACCT_CD
                 FROM SVC_INV_LINE SIL
                    , SHIP_TO_CUST SHIP
                    , DS_XREF_ACCT DXA
                    , ACCT_LOC     AL
                    , SELL_TO_CUST STC
                WHERE SIL.GLBL_CMPY_CD    = SHIP.GLBL_CMPY_CD
                  AND SIL.EZCANCELFLAG    = SHIP.EZCANCELFLAG
                  AND SIL.SHIP_TO_CUST_CD = SHIP.SHIP_TO_CUST_CD
                  AND SHIP.GLBL_CMPY_CD    = DXA.GLBL_CMPY_CD(+)
                  AND SHIP.EZCANCELFLAG    = DXA.EZCANCELFLAG(+)
                  AND SHIP.LOC_NUM         = DXA.LOC_NUM(+)
                  AND DXA.DS_XREF_ACCT_TP_CD(+) = #xrefAcctTpOracle#
                  AND SHIP.GLBL_CMPY_CD  = AL.GLBL_CMPY_CD(+)
                  AND SHIP.EZCANCELFLAG  = AL.EZCANCELFLAG(+)
                  AND SHIP.LOC_NUM       = AL.LOC_NUM(+)
                  AND AL.GLBL_CMPY_CD  = STC.GLBL_CMPY_CD(+)
                  AND AL.EZCANCELFLAG  = STC.EZCANCELFLAG(+)
                  AND AL.DS_ACCT_NUM   = STC.SELL_TO_CUST_CD(+)
                  AND AL.EFF_FROM_DT(+)  &lt;= #invDt#
                  AND (AL.EFF_THRU_DT(+) &gt;= #invDt#
                       OR
                       AL.EFF_THRU_DT(+) IS NULL
                      )
                  AND SIL.GLBL_CMPY_CD = #glblCmpyCd#
                  AND SIL.EZCANCELFLAG = '0'
                  AND SIL.SVC_INV_NUM = #invNum#
                ORDER BY SIL.SVC_INV_LINE_NUM
              ) TMP
          WHERE ROWNUM = 1
    </statement>

    <statement id="getShipToInfoSvcDspt" parameterClass="Map" resultClass="Map">
        SELECT TMP.SELL_TO_CUST_CD
             , TMP.DS_ACCT_NM
             , TMP.FIRST_LINE_ADDR
             , TMP.SCD_LINE_ADDR
             , TMP.THIRD_LINE_ADDR
             , TMP.FRTH_LINE_ADDR
             , TMP.CTY_ADDR
             , TMP.ST_CD
             , TMP.CTRY_CD
             , TMP.POST_CD
             , TMP.DS_CUST_SIC_CD
             , TMP.DS_XREF_ACCT_CD
         FROM (SELECT STC.SELL_TO_CUST_CD
                    , STC.DS_ACCT_NM
                    , SHIP.FIRST_LINE_ADDR
                    , SHIP.SCD_LINE_ADDR
                    , SHIP.THIRD_LINE_ADDR
                    , SHIP.FRTH_LINE_ADDR
                    , SHIP.CTY_ADDR
                    , SHIP.ST_CD
                    , SHIP.CTRY_CD
                    , SHIP.POST_CD
                    , STC.DS_CUST_SIC_CD
                    , DXA.DS_XREF_ACCT_CD
                 FROM SVC_INV SI
                    , SHIP_TO_CUST SHIP
                    , DS_XREF_ACCT DXA
                    , ACCT_LOC     AL
                    , SELL_TO_CUST STC
                WHERE SI.GLBL_CMPY_CD    = SHIP.GLBL_CMPY_CD
                  AND SI.EZCANCELFLAG    = SHIP.EZCANCELFLAG
                  AND SI.SHIP_TO_CUST_CD = SHIP.SHIP_TO_CUST_CD
                  AND SHIP.GLBL_CMPY_CD    = DXA.GLBL_CMPY_CD(+)
                  AND SHIP.EZCANCELFLAG    = DXA.EZCANCELFLAG(+)
                  AND SHIP.LOC_NUM         = DXA.LOC_NUM(+)
                  AND DXA.DS_XREF_ACCT_TP_CD(+) = #xrefAcctTpOracle#
                  AND SHIP.GLBL_CMPY_CD  = AL.GLBL_CMPY_CD(+)
                  AND SHIP.EZCANCELFLAG  = AL.EZCANCELFLAG(+)
                  AND SHIP.LOC_NUM       = AL.LOC_NUM(+)
                  AND AL.GLBL_CMPY_CD  = STC.GLBL_CMPY_CD(+)
                  AND AL.EZCANCELFLAG  = STC.EZCANCELFLAG(+)
                  AND AL.DS_ACCT_NUM   = STC.SELL_TO_CUST_CD(+)
                  AND AL.EFF_FROM_DT(+)  &lt;= #invDt#
                  AND (AL.EFF_THRU_DT(+) &gt;= #invDt#
                       OR
                       AL.EFF_THRU_DT(+) IS NULL
                      )
                  AND SI.GLBL_CMPY_CD = #glblCmpyCd#
                  AND SI.EZCANCELFLAG = '0'
                  AND SI.SVC_INV_NUM = #invNum#
              ) TMP
          WHERE ROWNUM = 1
    </statement>

    <statement id="getCrCardInfo" parameterClass="Map" resultClass="Map">
        SELECT TMP.CR_CARD_LAST_DIGIT_NUM
             , TMP.CR_CARD_EXPR_YR_MTH
             , TMP.CR_CARD_TP_CD
          FROM (SELECT DCC.CR_CARD_LAST_DIGIT_NUM
                     , DCC.CR_CARD_EXPR_YR_MTH
                     , DCC.CR_CARD_TP_CD
                  FROM DS_CR_CARD  DCC
                     , CR_CARD_TRX CCT
                 WHERE DCC.GLBL_CMPY_CD = CCT.GLBL_CMPY_CD
                   AND DCC.EZCANCELFLAG = CCT.EZCANCELFLAG
                   AND DCC.CR_CARD_CUST_REF_NUM = CCT.CR_CARD_CUST_REF_NUM
                   AND CCT.GLBL_CMPY_CD = #glblCmpyCd#
                   AND CCT.EZCANCELFLAG = '0'
                   AND CCT.CR_CARD_TRX_TP_CD = #crCardTrxTpCd#
                   AND CCT.FIRST_TRX_INFO_TXT = #firstTrxInfoTxt#
                   AND CCT.CR_CARD_AUTH_STS_CD = #crCardAuthStsCd#
                <isNotNull property="crCardCustRefNum">
                   AND CCT.CR_CARD_CUST_REF_NUM = #crCardCustRefNum#
                </isNotNull>
                ORDER BY 
                <isEqual property="crCardAuthStsCd" compareValue="1">
                       CCT.CR_CARD_TRX_PK DESC
                </isEqual>
                <isEqual property="crCardAuthStsCd" compareValue="2">
                       CCT.SETL_CPLT_FLG  ASC
                     , CCT.CR_CARD_TRX_PK DESC
                </isEqual>
               ) TMP
         WHERE ROWNUM = #numOne#
    </statement>

    <statement id="getCrCardInfoCntr" parameterClass="Map" resultClass="Map">
        SELECT DCC.CR_CARD_LAST_DIGIT_NUM
             , DCC.CR_CARD_EXPR_YR_MTH
             , DCC.CR_CARD_TP_CD
          FROM DS_CR_CARD  DCC
         WHERE DCC.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCC.EZCANCELFLAG = '0'
           AND DCC.CR_CARD_CUST_REF_NUM = #crCardCustRefNum#
    </statement>

    <statement id="getInvoiceDetailTargetDataOM" parameterClass="Map" resultClass="Map">
        SELECT T.CUST_ISS_PO_NUM
             , T.UOM_CD
             , $lpadShipQty$            SHIP_QTY
             , $lpadDealNetUnitPrcAmt$  DEAL_NET_UNIT_PRC_AMT
             , T.MDSE_CD
             , T.MDSE_NM
             , T.UPC_CD
             , $lpadInvLineDealNetAmt$  INV_LINE_DEAL_NET_AMT
             , $lpadInvLineDealTaxAmt$  INV_LINE_DEAL_TAX_AMT
             , $lpadTaxPct$             TAX_PCT
             , $lpadOrdQty$             ORD_QTY
             , T.DS_CONTR_NUM
             , $lpadDsContrNum$         DS_CONTR_NUM_35
             , T.SVC_CONTR_BLLG_PK
             , T.CRAT_DRAFT_PSN_CD
             , T.EDI_INV_CUST_CTRL_FLD_TXT
             , T.ITEM_TYPE
             , T.SER_NUM
             , T.BASE_SER_NUM
             , T.SUM_PREV_TOT_COPY_QTY
             , T.SUM_TOT_COPY_QTY
             , T.SUM_TOT_ALWNC
             , T.SUM_BLLG_COPY_QTY
             , T.INV_PER
             , T.USG_COST_PER_COPY
             , T.USG_PER
             , T.BLLG_PER_FROM_DT
             , T.BLLG_PER_THRU_DT
         FROM (
        SELECT IL.CUST_ISS_PO_NUM
             , IL.UOM_CD
             , CASE #isEasyPackFlg#
                   WHEN #flgY# THEN DECODE(I.INV_TP_CD, #invTpCdCr#, NVL(IL.SPLY_PGM_SHIP_QTY, IL.SHIP_QTY) * -1, NVL(IL.SPLY_PGM_SHIP_QTY, IL.SHIP_QTY)) 
                   WHEN #flgN# THEN DECODE(I.INV_TP_CD, #invTpCdCr#, NVL(IL.INV_DPLY_QTY, IL.SHIP_QTY) * -1, NVL(IL.INV_DPLY_QTY, IL.SHIP_QTY))
               END SHIP_QTY
             , CASE #isEasyPackFlg#
                   WHEN #flgY# THEN IL.SPLY_PGM_UNIT_AMT_RATE
                   WHEN #flgN# THEN IL.DEAL_NET_UNIT_PRC_AMT
               END DEAL_NET_UNIT_PRC_AMT
             , IL.MDSE_CD
             , CASE WHEN M.MDSE_CD IS NOT NULL THEN M.MDSE_DESC_SHORT_TXT
                    ELSE IL.MDSE_NM
               END MDSE_NM
             , M.UPC_CD 
             , DECODE(I.INV_TP_CD, #invTpCdCr#, IL.INV_LINE_DEAL_NET_AMT * -1, IL.INV_LINE_DEAL_NET_AMT) INV_LINE_DEAL_NET_AMT
             , DECODE(I.INV_TP_CD, #invTpCdCr#, IL.INV_LINE_DEAL_TAX_AMT * -1, IL.INV_LINE_DEAL_TAX_AMT) INV_LINE_DEAL_TAX_AMT
             , IL.TAX_PCT
             , DECODE(I.INV_TP_CD, #invTpCdCr#, NVL(IL.ORD_QTY, 0) * -1, NVL(IL.ORD_QTY, 0)) ORD_QTY
             , IL.DS_CONTR_NUM
             , NULL  SVC_CONTR_BLLG_PK
             , DC.CRAT_DRAFT_PSN_CD
             , IL.FIRST_BLLG_ATTRB_VAL_TXT
               || IL.SCD_BLLG_ATTRB_VAL_TXT
               || IL.THIRD_BLLG_ATTRB_VAL_TXT
               || IL.FRTH_BLLG_ATTRB_VAL_TXT
               || IL.FIFTH_BLLG_ATTRB_VAL_TXT
               || IL.SIXTH_BLLG_ATTRB_VAL_TXT    EDI_INV_CUST_CTRL_FLD_TXT
             , CASE WHEN EXISTS(SELECT '1' FROM ORD_CATG_BIZ_CTX OCB
                          WHERE OCB.GLBL_CMPY_CD = #glblCmpyCd#
                          AND   OCB.ORD_CATG_CTX_TP_CD = #ordCatgCtxTp# 
                          AND   OCB.DS_ORD_CATG_CD    = I.DS_ORD_CATG_CD
                          AND  (OCB.DS_ORD_TP_CD      is null
                          OR    OCB.DS_ORD_TP_CD      = I.DS_ORD_TP_CD)
                          AND  (OCB.DS_ORD_RSN_CD     is null
                          OR    OCB.DS_ORD_RSN_CD     = I.DS_ORD_RSN_CD)
                          AND   OCB.EZCANCELFLAG      = '0') THEN
                   CASE WHEN IL.MDSE_CD = #mdseShipping# THEN #itemTypeMShipping#
                   ELSE #itemTypeSToner#
                   END
               ELSE 
                   #itemTypeEBaseunit#
               END ITEM_TYPE
             , NULL SER_NUM
             , NULL BASE_SER_NUM
             , #strIntFmt22#  SUM_PREV_TOT_COPY_QTY
             , #strIntFmt22#  SUM_TOT_COPY_QTY
             , #strIntFmt20#  SUM_TOT_ALWNC
             , #strIntFmt22#  SUM_BLLG_COPY_QTY
             , NULL  INV_PER
             , #strDecFmt22#  USG_COST_PER_COPY
             , NULL USG_PER
             , NULL BLLG_PER_FROM_DT
             , NULL BLLG_PER_THRU_DT
          FROM INV_LINE     IL
             , INV          I
             , MDSE         M
             , DS_CONTR     DC
         WHERE IL.GLBL_CMPY_CD = #glblCmpyCd#
           AND IL.EZCANCELFLAG = '0'
           AND IL.INV_NUM = #invNum#
           AND IL.SET_MDSE_CD IS NULL
           <!-- 2018/05/24 QC#21841 Add Start -->
           AND IL.INV_LINE_CATG_CD &lt;&gt; #invLineCatgFrt#
           <!-- 2018/05/24 QC#21841 Add End -->
           AND IL.GLBL_CMPY_CD = I.GLBL_CMPY_CD
           AND IL.EZCANCELFLAG = I.EZCANCELFLAG
           AND IL.INV_NUM      = I.INV_NUM
           AND IL.GLBL_CMPY_CD = M.GLBL_CMPY_CD(+)
           AND IL.EZCANCELFLAG = M.EZCANCELFLAG(+)
           AND IL.MDSE_CD      = M.MDSE_CD(+)
           AND IL.GLBL_CMPY_CD = DC.GLBL_CMPY_CD(+)
           AND IL.EZCANCELFLAG = DC.EZCANCELFLAG(+)
           AND IL.DS_CONTR_NUM = DC.DS_CONTR_NUM(+)
           AND IL.DS_CONTR_SQ_NUM = DC.DS_CONTR_SQ_NUM(+)
              ) T
    </statement>

    <statement id="getInvoiceDetailTargetDataSvcFlt" parameterClass="Map" resultClass="Map">
        SELECT T.CUST_ISS_PO_NUM
             , T.UOM_CD
             , $lpadShipQty$            SHIP_QTY
             , $lpadDealNetUnitPrcAmt$  DEAL_NET_UNIT_PRC_AMT
             , T.MDSE_CD
             , T.MDSE_NM
             , T.UPC_CD
             , $lpadInvLineDealNetAmt$  INV_LINE_DEAL_NET_AMT
             , $lpadInvLineDealTaxAmt$  INV_LINE_DEAL_TAX_AMT
             , $lpadTaxPct$             TAX_PCT
             , $lpadOrdQty$             ORD_QTY
             , T.DS_CONTR_NUM
             , $lpadDsContrNum$         DS_CONTR_NUM_35
             , $lpadSvcContrBllgPk$     SVC_CONTR_BLLG_PK
             , T.CRAT_DRAFT_PSN_CD
             , T.EDI_INV_CUST_CTRL_FLD_TXT
             , T.ITEM_TYPE
             , T.SER_NUM
             , T.BASE_SER_NUM
             , T.SUM_PREV_TOT_COPY_QTY
             , T.SUM_TOT_COPY_QTY
             , T.SUM_TOT_ALWNC
             , T.SUM_BLLG_COPY_QTY
             , T.INV_PER
             , T.USG_COST_PER_COPY
             , T.USG_PER
             , T.BLLG_PER_FROM_DT
             , T.BLLG_PER_THRU_DT
         FROM (
        SELECT IL.CUST_ISS_PO_NUM
             , IL.UOM_CD
             , NVL(IL.INV_DPLY_QTY, IL.SHIP_QTY)   SHIP_QTY
             , DECODE(SI.INV_TP_CD, #invTpCdCr#, IL.DEAL_NET_UNIT_PRC_AMT * -1, IL.DEAL_NET_UNIT_PRC_AMT) DEAL_NET_UNIT_PRC_AMT
             , IL.MDSE_CD
             , IL.MDSE_NM
             , M.UPC_CD
             , DECODE(SI.INV_TP_CD, #invTpCdCr#, IL.INV_LINE_DEAL_NET_AMT * -1, IL.INV_LINE_DEAL_NET_AMT) INV_LINE_DEAL_NET_AMT
             , DECODE(SI.INV_TP_CD, #invTpCdCr#, IL.INV_LINE_DEAL_TAX_AMT * -1, IL.INV_LINE_DEAL_TAX_AMT) INV_LINE_DEAL_TAX_AMT
             , IL.TAX_PCT
             , NVL(IL.ORD_QTY, 0)      ORD_QTY
             , IL.DS_CONTR_NUM
             , SIL.SVC_CONTR_BLLG_PK
             , IL.BLLG_PER_FROM_DT
             , IL.BLLG_PER_THRU_DT
             , DC.CRAT_DRAFT_PSN_CD
             , IL.FIRST_BLLG_ATTRB_VAL_TXT
               || IL.SCD_BLLG_ATTRB_VAL_TXT
               || IL.THIRD_BLLG_ATTRB_VAL_TXT
               || IL.FRTH_BLLG_ATTRB_VAL_TXT
               || IL.FIFTH_BLLG_ATTRB_VAL_TXT
               || IL.SIXTH_BLLG_ATTRB_VAL_TXT    EDI_INV_CUST_CTRL_FLD_TXT
             , CASE WHEN IPSP.INV_PRINT_SVC_PGM_SRC_NM = #srcNmRental# THEN #itemTypeCRental#
               ELSE #itemTypeEBaseunit#
               END  ITEM_TYPE
             , NULL SER_NUM
             , NULL BASE_SER_NUM
             , #strIntFmt22#  SUM_PREV_TOT_COPY_QTY
             , #strIntFmt22#  SUM_TOT_COPY_QTY
             , #strIntFmt20#  SUM_TOT_ALWNC
             , #strIntFmt22#  SUM_BLLG_COPY_QTY
             , #invPer# INV_PER
             , #strDecFmt22#  USG_COST_PER_COPY
             , NULL USG_PER
          FROM INV_LINE          IL
             , SVC_INV           SI
             , SVC_INV_LINE      SIL
             , SVC_INV_LINE_TP   SILT
             , MDSE              M
             , DS_CONTR          DC
             , INV_PRINT_SVC_PGM IPSP
         WHERE IL.GLBL_CMPY_CD = #glblCmpyCd#
           AND IL.EZCANCELFLAG = '0'
           AND IL.INV_NUM = #invNum#
           AND IL.GLBL_CMPY_CD = SI.GLBL_CMPY_CD
           AND IL.EZCANCELFLAG = SI.EZCANCELFLAG
           AND IL.INV_NUM      = SI.SVC_INV_NUM
           AND SI.DS_CONTR_CATG_CD = #dsContrCatgFlt#
           AND IL.GLBL_CMPY_CD = SIL.GLBL_CMPY_CD
           AND IL.EZCANCELFLAG = SIL.EZCANCELFLAG
           AND IL.SVC_INV_LINE_PK = SIL.SVC_INV_LINE_PK
           AND SIL.SVC_INV_CHRG_TP_CD &lt;&gt; #svcInvChrgTpMC#
           AND SIL.GLBL_CMPY_CD = SILT.GLBL_CMPY_CD
           AND SIL.EZCANCELFLAG = SILT.EZCANCELFLAG
           AND SIL.SVC_INV_LINE_TP_CD = SILT.SVC_INV_LINE_TP_CD
           AND SILT.FLEET_LINE_FLG = #flgY#
           AND IL.GLBL_CMPY_CD = M.GLBL_CMPY_CD(+)
           AND IL.EZCANCELFLAG = M.EZCANCELFLAG(+)
           AND IL.MDSE_CD      = M.MDSE_CD(+)
           AND IL.GLBL_CMPY_CD = DC.GLBL_CMPY_CD(+)
           AND IL.EZCANCELFLAG = DC.EZCANCELFLAG(+)
           AND IL.DS_CONTR_NUM = DC.DS_CONTR_NUM(+)
           AND IL.DS_CONTR_SQ_NUM = DC.DS_CONTR_SQ_NUM(+)
           AND SIL.GLBL_CMPY_CD = IPSP.GLBL_CMPY_CD(+)
           AND SIL.EZCANCELFLAG = IPSP.EZCANCELFLAG(+)
           AND SIL.SVC_PGM_MDSE_CD = IPSP.INV_PRINT_SVC_PGM_CD(+)
        UNION ALL
        SELECT IL.CUST_ISS_PO_NUM
             , IL.UOM_CD
             , 1                 SHIP_QTY
             , DECODE(SI.INV_TP_CD, #invTpCdCr#, SILM.MTR_CHRG_DEAL_AMT * -1, SILM.MTR_CHRG_DEAL_AMT) DEAL_NET_UNIT_PRC_AMT
             , IL.MDSE_CD
             , IL.MDSE_NM
             , M.UPC_CD
             , DECODE(SI.INV_TP_CD, #invTpCdCr#, SILM.MTR_CHRG_DEAL_AMT * -1, SILM.MTR_CHRG_DEAL_AMT) INV_LINE_DEAL_NET_AMT
             , DECODE(SI.INV_TP_CD, #invTpCdCr#, ROUND(SILM.MTR_CHRG_DEAL_AMT * IL.TAX_PCT / 100, 2) * -1, ROUND(SILM.MTR_CHRG_DEAL_AMT * IL.TAX_PCT / 100, 2)) INV_LINE_DEAL_TAX_AMT
             , IL.TAX_PCT
             , 1                 ORD_QTY
             , IL.DS_CONTR_NUM
             , SIL.SVC_CONTR_BLLG_PK
             , IL.BLLG_PER_FROM_DT
             , IL.BLLG_PER_THRU_DT
             , DC.CRAT_DRAFT_PSN_CD
             , IL.FIRST_BLLG_ATTRB_VAL_TXT
               || IL.SCD_BLLG_ATTRB_VAL_TXT
               || IL.THIRD_BLLG_ATTRB_VAL_TXT
               || IL.FRTH_BLLG_ATTRB_VAL_TXT
               || IL.FIFTH_BLLG_ATTRB_VAL_TXT
               || IL.SIXTH_BLLG_ATTRB_VAL_TXT    EDI_INV_CUST_CTRL_FLD_TXT
             , #itemTypeU#
               || CASE WHEN ML.BW_MTR_FLG = #flgY#    THEN #itemTypeBW#
                       WHEN ML.COLOR_MTR_FLG = #flgY# THEN #itemTypeColor#
                   ELSE #itemTypeBW#
                   END  ITEM_TYPE
             , NULL SER_NUM
             , NULL BASE_SER_NUM
             , $lpadSumPrevTotCopyQty$  SUM_PREV_TOT_COPY_QTY
             , $lpadSumTotCopyQty$      SUM_TOT_COPY_QTY
             , $lpadSumTotAlwnc$        SUM_TOT_ALWNC
             , $lpadSumBllgCopyQty$     SUM_BLLG_COPY_QTY
             , NULL INV_PER
             , (SELECT TMP.XS_MTR_AMT_RATE
                 FROM (SELECT TO_CHAR (NVL (A.XS_MTR_AMT_RATE, 0), #decFmt22#) XS_MTR_AMT_RATE
                         FROM SVC_INV_LINE_XS_MTR A
                        WHERE A.GLBL_CMPY_CD = SILM.GLBL_CMPY_CD
                          AND A.EZCANCELFLAG = SILM.EZCANCELFLAG
                          AND A.SVC_INV_LINE_MTR_PK = SILM.SVC_INV_LINE_MTR_PK
                        ORDER BY A.XS_MTR_FROM_COPY_QTY
                      ) TMP
                WHERE ROWNUM = 1
               )    USG_COST_PER_COPY
             , #usgPer# USG_PER
          FROM INV_LINE          IL
             , SVC_INV           SI
             , SVC_INV_LINE      SIL
             , SVC_INV_LINE_MTR  SILM
             , DS_CONTR_BLLG_MTR DCBM
             , MTR_LB            ML
             , SVC_INV_LINE_TP   SILT
             , MDSE              M
             , DS_CONTR          DC
         WHERE IL.GLBL_CMPY_CD = #glblCmpyCd#
           AND IL.EZCANCELFLAG = '0'
           AND IL.INV_NUM = #invNum#
           AND IL.GLBL_CMPY_CD = SI.GLBL_CMPY_CD
           AND IL.EZCANCELFLAG = SI.EZCANCELFLAG
           AND IL.INV_NUM      = SI.SVC_INV_NUM
           AND SI.DS_CONTR_CATG_CD = #dsContrCatgFlt#
           AND IL.GLBL_CMPY_CD = SIL.GLBL_CMPY_CD
           AND IL.EZCANCELFLAG = SIL.EZCANCELFLAG
           AND IL.SVC_INV_LINE_PK = SIL.SVC_INV_LINE_PK
           AND SIL.SVC_INV_CHRG_TP_CD = #svcInvChrgTpMC#
           AND SIL.GLBL_CMPY_CD = SILM.GLBL_CMPY_CD
           AND SIL.EZCANCELFLAG = SILM.EZCANCELFLAG
           AND SIL.SVC_INV_LINE_PK = SILM.SVC_INV_LINE_PK
           AND SILM.GLBL_CMPY_CD = DCBM.GLBL_CMPY_CD
           AND SILM.EZCANCELFLAG = DCBM.EZCANCELFLAG
           AND SILM.DS_CONTR_BLLG_MTR_PK = DCBM.DS_CONTR_BLLG_MTR_PK
           AND DCBM.GLBL_CMPY_CD = ML.GLBL_CMPY_CD
           AND DCBM.EZCANCELFLAG = ML.EZCANCELFLAG
           AND DCBM.BLLG_MTR_LB_CD = ML.MTR_LB_CD
           AND SIL.GLBL_CMPY_CD = SILT.GLBL_CMPY_CD
           AND SIL.EZCANCELFLAG = SILT.EZCANCELFLAG
           AND SIL.SVC_INV_LINE_TP_CD = SILT.SVC_INV_LINE_TP_CD
           AND SILT.FLEET_LINE_FLG = #flgY#
           AND IL.GLBL_CMPY_CD = M.GLBL_CMPY_CD(+)
           AND IL.EZCANCELFLAG = M.EZCANCELFLAG(+)
           AND IL.MDSE_CD      = M.MDSE_CD(+)
           AND IL.GLBL_CMPY_CD = DC.GLBL_CMPY_CD(+)
           AND IL.EZCANCELFLAG = DC.EZCANCELFLAG(+)
           AND IL.DS_CONTR_NUM = DC.DS_CONTR_NUM(+)
           AND IL.DS_CONTR_SQ_NUM = DC.DS_CONTR_SQ_NUM(+)
              ) T
    </statement>

    <statement id="getInvoiceDetailTargetDataRegAgg" parameterClass="Map" resultClass="Map">
        SELECT T.CUST_ISS_PO_NUM
             , T.UOM_CD
             , $lpadShipQty$            SHIP_QTY
             , $lpadDealNetUnitPrcAmt$  DEAL_NET_UNIT_PRC_AMT
             , T.MDSE_CD
             , T.MDSE_NM
             , T.UPC_CD
             , $lpadInvLineDealNetAmt$  INV_LINE_DEAL_NET_AMT
             , $lpadInvLineDealTaxAmt$  INV_LINE_DEAL_TAX_AMT
             , $lpadTaxPct$             TAX_PCT
             , $lpadOrdQty$             ORD_QTY
             , T.DS_CONTR_NUM
             , $lpadDsContrNum$         DS_CONTR_NUM_35
             , $lpadSvcContrBllgPk$     SVC_CONTR_BLLG_PK
             , T.CRAT_DRAFT_PSN_CD
             , T.EDI_INV_CUST_CTRL_FLD_TXT
             , T.ITEM_TYPE
             , T.SER_NUM
             , T.BASE_SER_NUM
             , T.SUM_PREV_TOT_COPY_QTY
             , T.SUM_TOT_COPY_QTY
             , T.SUM_TOT_ALWNC
             , T.SUM_BLLG_COPY_QTY
             , T.INV_PER
             , T.USG_COST_PER_COPY
             , T.USG_PER
             , T.BLLG_PER_FROM_DT
             , T.BLLG_PER_THRU_DT
         FROM (
        SELECT IL.CUST_ISS_PO_NUM
             , IL.UOM_CD
             , NVL(IL.INV_DPLY_QTY, IL.SHIP_QTY)   SHIP_QTY
             , DECODE(SI.INV_TP_CD, #invTpCdCr#, IL.DEAL_NET_UNIT_PRC_AMT * -1, IL.DEAL_NET_UNIT_PRC_AMT) DEAL_NET_UNIT_PRC_AMT
             , IL.MDSE_CD
             , IL.MDSE_NM
             , M.UPC_CD
             , DECODE(SI.INV_TP_CD, #invTpCdCr#, IL.INV_LINE_DEAL_NET_AMT * -1, IL.INV_LINE_DEAL_NET_AMT) INV_LINE_DEAL_NET_AMT
             , DECODE(SI.INV_TP_CD, #invTpCdCr#, IL.INV_LINE_DEAL_TAX_AMT * -1, IL.INV_LINE_DEAL_TAX_AMT) INV_LINE_DEAL_TAX_AMT
             , IL.TAX_PCT
             , NVL(IL.ORD_QTY, 0)      ORD_QTY
             , IL.DS_CONTR_NUM
             , SIL.SVC_CONTR_BLLG_PK
             , IL.BLLG_PER_FROM_DT
             , IL.BLLG_PER_THRU_DT
             , DC.CRAT_DRAFT_PSN_CD
             , IL.FIRST_BLLG_ATTRB_VAL_TXT
               || IL.SCD_BLLG_ATTRB_VAL_TXT
               || IL.THIRD_BLLG_ATTRB_VAL_TXT
               || IL.FRTH_BLLG_ATTRB_VAL_TXT
               || IL.FIFTH_BLLG_ATTRB_VAL_TXT
               || IL.SIXTH_BLLG_ATTRB_VAL_TXT    EDI_INV_CUST_CTRL_FLD_TXT
             , CASE WHEN SIL.SVC_INV_LINE_TP_CD = #svcInvLineTpAcsy# THEN #itemTypeCPeri#
               ELSE CASE WHEN IPSP.INV_PRINT_SVC_PGM_SRC_NM = #srcNmRental# THEN #itemTypeCRental#
                    ELSE #itemTypeEBaseunit#
                    END
               END  ITEM_TYPE
             , SILP.SER_NUM || #sepStr# || SILP.MDL_NM SER_NUM
             , SIL.SER_NUM  || #sepStr# || SIL.MDL_NM  BASE_SER_NUM
             , #strIntFmt22#  SUM_PREV_TOT_COPY_QTY
             , #strIntFmt22#  SUM_TOT_COPY_QTY
             , #strIntFmt20#  SUM_TOT_ALWNC
             , #strIntFmt22#  SUM_BLLG_COPY_QTY
             , #invPer# INV_PER
             , #strDecFmt22#  USG_COST_PER_COPY
             , NULL USG_PER
          FROM INV_LINE          IL
             , SVC_INV           SI
             , SVC_INV_LINE      SIL
             , MDSE              M
             , DS_CONTR          DC
             , INV_PRINT_SVC_PGM IPSP
             , SVC_MACH_MSTR     SMM
             , SVC_INV_LINE      SILP
         WHERE IL.GLBL_CMPY_CD  = #glblCmpyCd#
           AND IL.EZCANCELFLAG  = '0'
           AND IL.INV_NUM       = #invNum#
           AND IL.GLBL_CMPY_CD = SI.GLBL_CMPY_CD
           AND IL.EZCANCELFLAG = SI.EZCANCELFLAG
           AND IL.INV_NUM      = SI.SVC_INV_NUM
           AND SI.DS_CONTR_CATG_CD &lt;&gt; #dsContrCatgFlt#
           AND IL.GLBL_CMPY_CD = SIL.GLBL_CMPY_CD
           AND IL.EZCANCELFLAG = SIL.EZCANCELFLAG
           AND IL.SVC_INV_LINE_PK = SIL.SVC_INV_LINE_PK
           AND SIL.SVC_INV_CHRG_TP_CD &lt;&gt; #svcInvChrgTpMC#
           AND IL.GLBL_CMPY_CD = M.GLBL_CMPY_CD(+)
           AND IL.EZCANCELFLAG = M.EZCANCELFLAG(+)
           AND IL.MDSE_CD      = M.MDSE_CD(+)
           AND IL.GLBL_CMPY_CD = DC.GLBL_CMPY_CD(+)
           AND IL.EZCANCELFLAG = DC.EZCANCELFLAG(+)
           AND IL.DS_CONTR_NUM = DC.DS_CONTR_NUM(+)
           AND IL.DS_CONTR_SQ_NUM = DC.DS_CONTR_SQ_NUM(+)
           AND SIL.GLBL_CMPY_CD = IPSP.GLBL_CMPY_CD(+)
           AND SIL.EZCANCELFLAG = IPSP.EZCANCELFLAG(+)
           AND SIL.SVC_PGM_MDSE_CD = IPSP.INV_PRINT_SVC_PGM_CD(+)
           AND SIL.GLBL_CMPY_CD = SMM.GLBL_CMPY_CD(+)
           AND SIL.EZCANCELFLAG = SMM.EZCANCELFLAG(+)
           AND SIL.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK(+)
           AND SIL.GLBL_CMPY_CD = SILP.GLBL_CMPY_CD(+)
           AND SIL.EZCANCELFLAG = SILP.EZCANCELFLAG(+)
           AND SIL.PRNT_SVC_INV_LINE_PK = SILP.SVC_INV_LINE_PK(+)
        UNION ALL
        SELECT IL.CUST_ISS_PO_NUM
             , IL.UOM_CD
             , 1                 SHIP_QTY
             , DECODE(SI.INV_TP_CD, #invTpCdCr#, SILM.MTR_CHRG_DEAL_AMT * -1, SILM.MTR_CHRG_DEAL_AMT) DEAL_NET_UNIT_PRC_AMT
             , IL.MDSE_CD
             , IL.MDSE_NM
             , M.UPC_CD
             , DECODE(SI.INV_TP_CD, #invTpCdCr#, SILM.MTR_CHRG_DEAL_AMT * -1, SILM.MTR_CHRG_DEAL_AMT) INV_LINE_DEAL_NET_AMT
             , DECODE(SI.INV_TP_CD, #invTpCdCr#, ROUND(SILM.MTR_CHRG_DEAL_AMT * IL.TAX_PCT / 100, 2) * -1, ROUND(SILM.MTR_CHRG_DEAL_AMT * IL.TAX_PCT / 100, 2)) INV_LINE_DEAL_TAX_AMT
             , IL.TAX_PCT
             , 1                 ORD_QTY
             , IL.DS_CONTR_NUM
             , SIL.SVC_CONTR_BLLG_PK
             , IL.BLLG_PER_FROM_DT
             , IL.BLLG_PER_THRU_DT
             , DC.CRAT_DRAFT_PSN_CD
             , IL.FIRST_BLLG_ATTRB_VAL_TXT
               || IL.SCD_BLLG_ATTRB_VAL_TXT
               || IL.THIRD_BLLG_ATTRB_VAL_TXT
               || IL.FRTH_BLLG_ATTRB_VAL_TXT
               || IL.FIFTH_BLLG_ATTRB_VAL_TXT
               || IL.SIXTH_BLLG_ATTRB_VAL_TXT    EDI_INV_CUST_CTRL_FLD_TXT
             , #itemTypeU#
               || CASE WHEN ML.BW_MTR_FLG = #flgY#    THEN #itemTypeBW#
                       WHEN ML.COLOR_MTR_FLG = #flgY# THEN #itemTypeColor#
                   ELSE #itemTypeBW#
                   END  ITEM_TYPE
             , SILP.SER_NUM || #sepStr# || SILP.MDL_NM SER_NUM
             , SIL.SER_NUM  || #sepStr# || SIL.MDL_NM  BASE_SER_NUM
             , $lpadSumPrevTotCopyQty$  SUM_PREV_TOT_COPY_QTY
             , $lpadSumTotCopyQty$      SUM_TOT_COPY_QTY
             , $lpadSumTotAlwnc$        SUM_TOT_ALWNC
             , $lpadSumBllgCopyQty$     SUM_BLLG_COPY_QTY
             , NULL INV_PER
             , (SELECT TMP.XS_MTR_AMT_RATE
                 FROM (SELECT TO_CHAR (NVL (A.XS_MTR_AMT_RATE, 0), #decFmt22#) XS_MTR_AMT_RATE
                         FROM SVC_INV_LINE_XS_MTR A
                        WHERE A.GLBL_CMPY_CD = SILM.GLBL_CMPY_CD
                          AND A.EZCANCELFLAG = SILM.EZCANCELFLAG
                          AND A.SVC_INV_LINE_MTR_PK = SILM.SVC_INV_LINE_MTR_PK
                        ORDER BY A.XS_MTR_FROM_COPY_QTY
                      ) TMP
                WHERE ROWNUM = 1
               )    USG_COST_PER_COPY
             , #usgPer# USG_PER
          FROM INV_LINE          IL
             , SVC_INV           SI
             , SVC_INV_LINE      SIL
             , (SELECT SILM2.GLBL_CMPY_CD
                     , SILM2.EZCANCELFLAG
                     , SILM2.SVC_INV_LINE_PK
                     , SUM(SILM2.PREV_TOT_COPY_QTY)  SUM_PREV_TOT_COPY_QTY
                     , SUM(SILM2.TOT_COPY_QTY)       SUM_TOT_COPY_QTY
                     , SUM(SILM2.TEST_COPY_QTY + SILM2.COPY_INCL_QTY)  SUM_TOT_ALWNC
                     , SUM(BLLG_COPY_QTY) SUM_BLLG_COPY_QTY
                 FROM SVC_INV_LINE_MTR  SILM2
                WHERE SILM2.GLBL_CMPY_CD = #glblCmpyCd#
                  AND SILM2.EZCANCELFLAG = '0'
                  AND SILM2.SVC_INV_NUM = #invNum#
                GROUP BY SILM2.GLBL_CMPY_CD
                     , SILM2.EZCANCELFLAG
                     , SILM2.SVC_INV_LINE_PK
               ) SUM_SILM
             , SVC_INV_LINE_MTR  SILM
             , DS_CONTR_BLLG_MTR DCBM
             , MTR_LB            ML
             , MDSE              M
             , DS_CONTR          DC
             , SVC_MACH_MSTR     SMM
             , SVC_INV_LINE      SILP
         WHERE IL.GLBL_CMPY_CD  = #glblCmpyCd#
           AND IL.EZCANCELFLAG  = '0'
           AND IL.INV_NUM       = #invNum#
           AND IL.GLBL_CMPY_CD = SI.GLBL_CMPY_CD
           AND IL.EZCANCELFLAG = SI.EZCANCELFLAG
           AND IL.INV_NUM      = SI.SVC_INV_NUM
           AND SI.DS_CONTR_CATG_CD &lt;&gt; #dsContrCatgFlt#
           AND IL.GLBL_CMPY_CD = SIL.GLBL_CMPY_CD
           AND IL.EZCANCELFLAG = SIL.EZCANCELFLAG
           AND IL.SVC_INV_LINE_PK = SIL.SVC_INV_LINE_PK
           AND SIL.GLBL_CMPY_CD = SILM.GLBL_CMPY_CD
           AND SIL.EZCANCELFLAG = SILM.EZCANCELFLAG
           AND SIL.SVC_INV_LINE_PK = SILM.SVC_INV_LINE_PK
           AND SIL.GLBL_CMPY_CD = SUM_SILM.GLBL_CMPY_CD
           AND SIL.EZCANCELFLAG = SUM_SILM.EZCANCELFLAG
           AND SIL.SVC_INV_LINE_PK = SUM_SILM.SVC_INV_LINE_PK
           AND SILM.GLBL_CMPY_CD = DCBM.GLBL_CMPY_CD
           AND SILM.EZCANCELFLAG = DCBM.EZCANCELFLAG
           AND SILM.DS_CONTR_BLLG_MTR_PK = DCBM.DS_CONTR_BLLG_MTR_PK
           AND DCBM.GLBL_CMPY_CD = ML.GLBL_CMPY_CD
           AND DCBM.EZCANCELFLAG = ML.EZCANCELFLAG
           AND DCBM.BLLG_MTR_LB_CD = ML.MTR_LB_CD
           AND IL.GLBL_CMPY_CD = M.GLBL_CMPY_CD(+)
           AND IL.EZCANCELFLAG = M.EZCANCELFLAG(+)
           AND IL.MDSE_CD      = M.MDSE_CD(+)
           AND IL.GLBL_CMPY_CD = DC.GLBL_CMPY_CD(+)
           AND IL.EZCANCELFLAG = DC.EZCANCELFLAG(+)
           AND IL.DS_CONTR_NUM = DC.DS_CONTR_NUM(+)
           AND IL.DS_CONTR_SQ_NUM = DC.DS_CONTR_SQ_NUM(+)
           AND SIL.GLBL_CMPY_CD = SMM.GLBL_CMPY_CD(+)
           AND SIL.EZCANCELFLAG = SMM.EZCANCELFLAG(+)
           AND SIL.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK(+)
           AND SIL.GLBL_CMPY_CD = SILP.GLBL_CMPY_CD(+)
           AND SIL.EZCANCELFLAG = SILP.EZCANCELFLAG(+)
           AND SIL.PRNT_SVC_INV_LINE_PK = SILP.SVC_INV_LINE_PK(+)
              ) T
    </statement>

    <statement id="getInvoiceDetailTargetDataDspt" parameterClass="Map" resultClass="Map">
        SELECT T.CUST_ISS_PO_NUM
             , T.UOM_CD
             , $lpadShipQty$            SHIP_QTY
             , $lpadDealNetUnitPrcAmt$  DEAL_NET_UNIT_PRC_AMT
             , T.MDSE_CD
             , T.MDSE_NM
             , T.UPC_CD
             , $lpadInvLineDealNetAmt$  INV_LINE_DEAL_NET_AMT
             , $lpadInvLineDealTaxAmt$  INV_LINE_DEAL_TAX_AMT
             , $lpadTaxPct$             TAX_PCT
             , $lpadOrdQty$             ORD_QTY
             , T.DS_CONTR_NUM
             , $lpadDsContrNum$         DS_CONTR_NUM_35
             , T.SVC_CONTR_BLLG_PK
             , T.CRAT_DRAFT_PSN_CD
             , T.EDI_INV_CUST_CTRL_FLD_TXT
             , T.ITEM_TYPE
             , T.SER_NUM
             , T.BASE_SER_NUM
             , T.SUM_PREV_TOT_COPY_QTY
             , T.SUM_TOT_COPY_QTY
             , T.SUM_TOT_ALWNC
             , T.SUM_BLLG_COPY_QTY
             , T.INV_PER
             , T.USG_COST_PER_COPY
             , T.USG_PER
             , T.BLLG_PER_FROM_DT
             , T.BLLG_PER_THRU_DT
         FROM (
        SELECT IL.CUST_ISS_PO_NUM
             , IL.UOM_CD
             , NVL(IL.INV_DPLY_QTY, IL.SHIP_QTY)   SHIP_QTY
             , DECODE(I.INV_TP_CD, #invTpCdCr#, IL.DEAL_NET_UNIT_PRC_AMT * -1, IL.DEAL_NET_UNIT_PRC_AMT) DEAL_NET_UNIT_PRC_AMT
             , IL.MDSE_CD
             , IL.MDSE_NM
             , M.UPC_CD
             , DECODE(I.INV_TP_CD, #invTpCdCr#, IL.INV_LINE_DEAL_NET_AMT * -1, IL.INV_LINE_DEAL_NET_AMT) INV_LINE_DEAL_NET_AMT
             , DECODE(I.INV_TP_CD, #invTpCdCr#, IL.INV_LINE_DEAL_TAX_AMT * -1, IL.INV_LINE_DEAL_TAX_AMT) INV_LINE_DEAL_TAX_AMT
             , IL.TAX_PCT
             , NVL(IL.ORD_QTY, 0)      ORD_QTY
             , IL.DS_CONTR_NUM
             , NULL                    SVC_CONTR_BLLG_PK
             , IL.BLLG_PER_FROM_DT
             , IL.BLLG_PER_THRU_DT
             , DC.CRAT_DRAFT_PSN_CD
             , IL.FIRST_BLLG_ATTRB_VAL_TXT
               || IL.SCD_BLLG_ATTRB_VAL_TXT
               || IL.THIRD_BLLG_ATTRB_VAL_TXT
               || IL.FRTH_BLLG_ATTRB_VAL_TXT
               || IL.FIFTH_BLLG_ATTRB_VAL_TXT
               || IL.SIXTH_BLLG_ATTRB_VAL_TXT    EDI_INV_CUST_CTRL_FLD_TXT
             , #itemTypeMLabor#                   ITEM_TYPE
             , NULL                               SER_NUM
             , SIL.SER_NUM || #sepStr# || SIL.MDL_NM  BASE_SER_NUM
             , #strIntFmt22#  SUM_PREV_TOT_COPY_QTY
             , #strIntFmt22#  SUM_TOT_COPY_QTY
             , #strIntFmt20#  SUM_TOT_ALWNC
             , #strIntFmt22#  SUM_BLLG_COPY_QTY
             , NULL  INV_PER
             , #strDecFmt22#  USG_COST_PER_COPY
             , NULL USG_PER
          FROM INV_LINE          IL
             , INV               I
             , SVC_INV           SI
             , SVC_INV_LINE      SIL
             , MDSE              M
             , DS_CONTR          DC
             , DS_CONTR_DTL      DCD
         WHERE IL.GLBL_CMPY_CD  = #glblCmpyCd#
           AND IL.EZCANCELFLAG  = '0'
           AND IL.INV_NUM       = #invNum#
           AND IL.GLBL_CMPY_CD  = I.GLBL_CMPY_CD
           AND IL.EZCANCELFLAG  = I.EZCANCELFLAG
           AND IL.INV_NUM       = I.INV_NUM
           AND IL.GLBL_CMPY_CD  = SI.GLBL_CMPY_CD
           AND IL.EZCANCELFLAG  = SI.EZCANCELFLAG
           AND IL.INV_NUM       = SI.SVC_INV_NUM
           AND IL.GLBL_CMPY_CD = SIL.GLBL_CMPY_CD
           AND IL.EZCANCELFLAG = SIL.EZCANCELFLAG
           AND IL.SVC_INV_LINE_PK = SIL.SVC_INV_LINE_PK
           AND IL.GLBL_CMPY_CD  = M.GLBL_CMPY_CD(+)
           AND IL.EZCANCELFLAG  = M.EZCANCELFLAG(+)
           AND IL.MDSE_CD       = M.MDSE_CD(+)
           AND IL.GLBL_CMPY_CD = DC.GLBL_CMPY_CD(+)
           AND IL.EZCANCELFLAG = DC.EZCANCELFLAG(+)
           AND IL.DS_CONTR_NUM = DC.DS_CONTR_NUM(+)
           AND IL.DS_CONTR_SQ_NUM = DC.DS_CONTR_SQ_NUM(+)
           AND DC.GLBL_CMPY_CD  = DCD.GLBL_CMPY_CD(+)
           AND DC.EZCANCELFLAG  = DCD.EZCANCELFLAG(+)
           AND DC.DS_CONTR_PK   = DCD.DS_CONTR_PK(+)
              ) T
    </statement>

    <statement id="getInvPrtCtrl" parameterClass="Map" resultClass="BigDecimal">
        SELECT IPC.INV_PRT_CTRL_PK
          FROM INV_PRT_CTRL IPC
         WHERE IPC.GLBL_CMPY_CD = #glblCmpyCd#
           AND IPC.EZCANCELFLAG = '0'
           AND IPC.INV_NUM      = #invNum#
           AND IPC.INV_EDI_PROC_STS_CD = #notProcessed#
    </statement>
</sqlMap>
    