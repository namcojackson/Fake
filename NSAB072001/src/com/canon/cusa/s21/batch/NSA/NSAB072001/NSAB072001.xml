<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<sqlMap namespace="NSAB072001">
    <statement id="getCratDays" parameterClass="Map" resultClass="Map">
        SELECT
            A.RPT_COND_CONST_VAL_NUM_01     AS CRAT_DAYS
        FROM
            RPT_COND_CONST  A
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.RPT_COND_CONST_GRP_ID = #rptGrpId#
    </statement>

    <statement id="getdSplyAcct" parameterClass="Map" resultClass="Map">
        SELECT
            A.RPT_COND_CONST_VAL_TXT_01     AS COA_ACCT_CD
        FROM
            RPT_COND_CONST  A
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.RPT_COND_CONST_GRP_ID = #rptGrpId#
    </statement>

    <statement id="getSlpyOrd" parameterClass="Map" resultClass="Map">
        SELECT
             A.RPT_COND_CONST_VAL_TXT_01    AS ORD_CATG_CD
            ,A.RPT_COND_CONST_VAL_TXT_02    AS ORD_RSN_CD
        FROM
            RPT_COND_CONST  A
        WHERE
                A.GLBL_CMPY_CD              = #glblCmpyCd#
            AND A.EZCANCELFLAG              = '0'
            AND A.RPT_COND_CONST_GRP_ID     = #rptGrpId#
            AND A.RPT_COND_CONST_VAL_TXT_01 IS NOT NULL
    </statement>

    <statement id="getDeleteData" parameterClass="Map" resultClass="Map">
        SELECT
            MLY_SPLY_REV_COST_PK
        FROM
            MLY_SPLY_REV_COST  A
        WHERE
                A.GLBL_CMPY_CD  = #glblCmpyCd#
            AND A.EZCANCELFLAG  = '0'
            AND A.FCT_CRAT_DT   = #cratDt#
    </statement>


    <statement id="getRevenueData" parameterClass="Map" resultClass="Map">
        SELECT
             A.GLBL_CMPY_CD                             AS GLBL_CMPY_CD
            ,M.ACCT_DT                                  AS DWH_TRGT_DT
            ,SUBSTR(M.ACCT_DT,1,6)                      AS DWH_TRGT_YR_MTH
            ,SUBSTR(M.ACCT_DT,1,4)                      AS DWH_TRGT_YR
<!-- START 2017/01/31 K.Ochiai [QC#17320, MOD] -->
            ,TO_CHAR(TO_DATE(M.ACCT_DT, 'YYYYMMDD'), 'Q')   AS DWH_TRGT_QTR_NUM
<!-- END 2017/01/31 K.Ochiai [QC#17320, MOD] -->
            ,F.DS_CONTR_PK                              AS DS_CONTR_PK
            ,N.DS_CONTR_NUM                             AS DS_CONTR_NUM
            ,N.DS_CONTR_DTL_PK                          AS DS_CONTR_DTL_PK
            ,F.DS_CONTR_DTL_TP_CD                       AS DS_CONTR_DTL_TP_CD
            ,G.DS_CONTR_DTL_TP_DESC_TXT                 AS DS_CONTR_DTL_TP_DESC_TXT
            ,D.SVC_CONTR_BR_CD                          AS SVC_CONTR_BR_CD
            ,D.DS_CONTR_CATG_CD                         AS DS_CONTR_CATG_CD
            ,E.DS_CONTR_CATG_DESC_TXT                   AS DS_CONTR_CATG_DESC_TXT
            ,D.SVC_LINE_BIZ_CD                          AS SVC_LINE_BIZ_CD
            ,M.BILL_TO_CUST_ACCT_CD                     AS DS_ACCT_NUM
            ,M.BILL_TO_CUST_ACCT_NM                     AS DS_ACCT_NM
            ,M.BILL_TO_CUST_CD                          AS ALT_PAYER_CUST_CD
            ,S.CUR_LOC_ACCT_NUM                         AS CUR_LOC_ACCT_NUM
            ,C.DS_ACCT_NM                               AS CUR_LOC_ACCT_NM
            ,S.CUR_LOC_NUM                              AS CUR_LOC_NUM
            ,S.IND_CUR_LOC_NUM                          AS IND_CUR_LOC_NUM
            ,F.SVC_MACH_MSTR_PK                         AS SVC_MACH_MSTR_PK
            ,CASE
                WHEN D.DS_CONTR_CATG_CD = #dsContrCatgFlt#
                    THEN NVL(S.SER_NUM, #serNumFlt#)
                ELSE S.SER_NUM
             END                                           SER_NUM
            ,Q.MDL_ID                                   AS MDL_ID
            ,NVL(P.T_MDL_NM, #noMdlNm#)                 AS T_MDL_NM
            ,K.SVC_SEG_CD                               AS SVC_SEG_CD
            ,NVL(T.SVC_SEG_DESC_TXT, #noSvcSegDescTxt#) AS SVC_SEG_DESC_TXT
            ,A.AJE_COA_CMPY_CD                          AS COA_CMPY_CD
            ,A.AJE_COA_AFFL_CD                          AS COA_AFFL_CD
            ,A.AJE_COA_BR_CD                            AS COA_BR_CD
            ,A.AJE_COA_CH_CD                            AS COA_CH_CD
            ,A.AJE_COA_CC_CD                            AS COA_CC_CD
            ,A.AJE_COA_ACCT_CD                          AS COA_ACCT_CD
            ,A.AJE_COA_PROD_CD                          AS COA_PROD_CD
            ,A.AJE_COA_PROJ_CD                          AS COA_PROJ_CD
            ,A.AJE_COA_EXTN_CD                          AS COA_EXTN_CD
            ,N.MDSE_CD                                  AS MDSE_CD
<!-- START 2016/11/22 K.Ochiai [QC#16012, MOD] -->
            ,L.MDSE_DESC_SHORT_TXT                      AS MDSE_DESC_SHORT_TXT
<!-- END 2016/11/22 K.Ochiai [QC#16012, MOD] -->
            ,N.SHIP_QTY                                 AS SHIP_QTY
            ,0                                          AS UNIT_COST_AMT
            ,0                                          AS SHIP_CPLT_COST_AMT
            ,N.SVC_INV_CHRG_TP_CD                       AS SVC_INV_CHRG_TP_CD
            ,R.SVC_INV_CHRG_TP_DESC_TXT                 AS SVC_INV_CHRG_TP_DESC_TXT
            ,M.DS_INV_TP_CD                             AS DS_INV_TP_CD
            ,CASE
                WHEN N.SVC_INV_CHRG_TP_CD = #svcInvChrgTpBc#
                    THEN #invTpDescTxtBc#
                WHEN N.SVC_INV_CHRG_TP_CD = #svcInvChrgTpMc#
                    THEN #invTpDescTxtMc#
                ELSE #invTpDescTxtOthr#
             END                                           INV_TP_DESC_TXT
            ,A.INV_NUM                                  AS INV_NUM
            ,A.INV_BOL_LINE_NUM                         AS INV_BOL_LINE_NUM
            ,A.INV_LINE_NUM                             AS INV_LINE_NUM
            ,A.INV_LINE_SUB_NUM                         AS INV_LINE_SUB_NUM
            ,A.INV_LINE_SUB_TRX_NUM                     AS INV_LINE_SUB_TRX_NUM
            ,N.SVC_INV_LINE_PK                          AS SVC_INV_LINE_PK
            ,M.INV_DT                                   AS INV_DT
            ,M.ACCT_DT                                  AS ACCT_DT
            ,V.BLACK_COLOR_FLG                          AS BLACK_COLOR_FLG
            ,CASE
                WHEN A.DR_CR_TP_CD = #drCrTpCredit#
                    THEN A.JRNL_DEAL_AMT
                ELSE A.JRNL_DEAL_AMT * (-1)
             END                                           MTR_CHRG_DEAL_AMT
            ,NULL                                       AS COST_AMT
            ,N.BLLG_PER_FROM_DT                         AS BLLG_PER_FROM_DT
            ,N.BLLG_PER_THRU_DT                         AS BLLG_PER_THRU_DT
            ,NULL                                       AS ACTL_MACH_QTY
            ,N.ORD_QTY                                  AS ORD_QTY
            ,N.CPO_ORD_NUM                              AS CPO_ORD_NUM
            ,N.CPO_DTL_LINE_NUM                         AS CPO_DTL_LINE_NUM
            ,NULL                                       AS CPO_ORD_DT
            ,L.IMG_SPLY_YIELD_CNT                       AS IMG_SPLY_YIELD_CNT
            ,F.SVC_PGM_MDSE_CD                          AS SVC_PGM_MDSE_CD
            ,J.INV_LINE_SPL_TP_CD                       AS INV_LINE_SPL_TP_CD
            ,O.INV_LINE_SPL_TP_DESC_TXT                 AS INV_LINE_SPL_TP_DESC_TXT
            ,NULL                                       AS PRT_USED_BY_TECH_LOC_CD
            ,NULL                                       AS IMG_SPLY_TP_CD
            ,NULL                                       AS IMG_SPLY_TP_DESC_TXT
            ,NULL                                       AS IMG_SPLY_COLOR_TP_CD
            ,NULL                                       AS IMG_SPLY_COLOR_TP_DESC_TXT
            ,NULL                                       AS USED_MULT_CNT
<!-- START 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            ,W.COA_CMPY_DESC_TXT                        AS COA_CMPY_DESC_TXT
<!-- END 2016/11/22 K.Ochiai [QC#16012, ADD] -->
        FROM
             AJE_INV_ACCT_DIST A
            ,SELL_TO_CUST      C
            ,DS_CONTR          D
            ,DS_CONTR_CATG     E
            ,DS_CONTR_DTL      F
            ,DS_CONTR_DTL_TP   G
            ,DS_INV_SLS_CR     J
            ,DS_MDL            K
            ,MDSE              L
            ,INV               M
            ,INV_LINE          N
            ,INV_LINE_SPL_TP   O
            ,MDL_NM            P
            ,SVC_CONFIG_MSTR   Q
            ,SVC_INV_CHRG_TP   R
            ,SVC_MACH_MSTR     S
            ,SVC_SEG           T
            ,(SELECT
                   U.MDSE_CD
                  ,CT.BLACK_COLOR_FLG
              FROM
                   MDSE               U
                  ,IMG_SPLY_COLOR_TP  CT
              WHERE
                      U.GLBL_CMPY_CD          = #glblCmpyCd#
                  AND U.EZCANCELFLAG          = '0'
                  AND U.GLBL_CMPY_CD          = CT.GLBL_CMPY_CD(+)
                  AND U.EZCANCELFLAG          = CT.EZCANCELFLAG(+)
                  AND U.IMG_SPLY_COLOR_TP_CD  = CT.IMG_SPLY_COLOR_TP_CD(+)) V
<!-- START 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            ,COA_CMPY          W
<!-- END 2016/11/22 K.Ochiai [QC#16012, ADD] -->
        WHERE
                A.INV_NUM                   = N.INV_NUM
            AND A.INV_BOL_LINE_NUM          = N.INV_BOL_LINE_NUM
            AND A.INV_LINE_NUM              = N.INV_LINE_NUM
            AND A.INV_LINE_SUB_NUM          = N.INV_LINE_SUB_NUM
            AND A.INV_LINE_SUB_TRX_NUM      = N.INV_LINE_SUB_TRX_NUM
            AND A.GL_DT                     = #glDt#
            AND A.DFRD_REV_GL_STRG_FLG      = 'N'
            <iterate property="splyAcct" var="splyAcct[]" open="AND A.AJE_COA_ACCT_CD IN (" close=")" conjunction=",">
                #splyAcct[]#
            </iterate>
            AND A.DS_INV_SLS_CR_PK          = J.DS_INV_SLS_CR_PK
<!-- START 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND A.AJE_COA_CMPY_CD           = W.COA_CMPY_CD
<!-- END 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND N.INV_NUM                   = M.INV_NUM
            AND J.INV_LINE_SPL_TP_CD        = O.INV_LINE_SPL_TP_CD(+)
            AND N.SVC_INV_CHRG_TP_CD        = R.SVC_INV_CHRG_TP_CD(+)
            AND N.MDSE_CD                   = L.MDSE_CD(+)
            AND N.SVC_CONFIG_MSTR_PK        = Q.SVC_CONFIG_MSTR_PK(+)
            AND Q.MDL_ID                    = K.MDL_ID(+)
            AND Q.MDL_ID                    = P.T_MDL_ID(+)
            AND K.SVC_SEG_CD                = T.SVC_SEG_CD(+)
            AND Q.SVC_MACH_MSTR_PK          = S.SVC_MACH_MSTR_PK(+)
            AND S.CUR_LOC_ACCT_NUM          = C.SELL_TO_CUST_CD(+)
            AND N.DS_CONTR_DTL_PK           = F.DS_CONTR_DTL_PK(+)
            AND F.DS_CONTR_PK               = D.DS_CONTR_PK(+)
            AND F.DS_CONTR_DTL_TP_CD        = G.DS_CONTR_DTL_TP_CD(+)
            AND D.DS_CONTR_CATG_CD          = E.DS_CONTR_CATG_CD(+)
            AND L.MDSE_CD                   = V.MDSE_CD
            AND A.GLBL_CMPY_CD              = #glblCmpyCd#
            AND A.GLBL_CMPY_CD              = N.GLBL_CMPY_CD
            AND A.GLBL_CMPY_CD              = J.GLBL_CMPY_CD
<!-- START 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND A.GLBL_CMPY_CD              = W.GLBL_CMPY_CD
<!-- END 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND N.GLBL_CMPY_CD              = M.GLBL_CMPY_CD
            AND J.GLBL_CMPY_CD              = O.GLBL_CMPY_CD(+)
            AND N.GLBL_CMPY_CD              = R.GLBL_CMPY_CD(+)
            AND N.GLBL_CMPY_CD              = L.GLBL_CMPY_CD(+)
            AND N.GLBL_CMPY_CD              = Q.GLBL_CMPY_CD(+)
            AND Q.GLBL_CMPY_CD              = K.GLBL_CMPY_CD(+)
            AND Q.GLBL_CMPY_CD              = P.T_GLBL_CMPY_CD(+)
            AND K.GLBL_CMPY_CD              = T.GLBL_CMPY_CD(+)
            AND Q.GLBL_CMPY_CD              = S.GLBL_CMPY_CD(+)
            AND S.GLBL_CMPY_CD              = C.GLBL_CMPY_CD(+)
            AND N.GLBL_CMPY_CD              = F.GLBL_CMPY_CD(+)
            AND F.GLBL_CMPY_CD              = D.GLBL_CMPY_CD(+)
            AND F.GLBL_CMPY_CD              = G.GLBL_CMPY_CD(+)
            AND D.GLBL_CMPY_CD              = E.GLBL_CMPY_CD(+)
            AND A.EZCANCELFLAG              = '0'
            AND J.EZCANCELFLAG              = '0'
            AND M.EZCANCELFLAG              = '0'
            AND N.EZCANCELFLAG              = '0'
<!-- START 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND W.EZCANCELFLAG              = '0'
<!-- END 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND C.EZCANCELFLAG(+)           = '0'
            AND D.EZCANCELFLAG(+)           = '0'
            AND E.EZCANCELFLAG(+)           = '0'
            AND F.EZCANCELFLAG(+)           = '0'
            AND G.EZCANCELFLAG(+)           = '0'
            AND K.EZCANCELFLAG(+)           = '0'
            AND L.EZCANCELFLAG(+)           = '0'
            AND O.EZCANCELFLAG(+)           = '0'
            AND P.EZCANCELFLAG(+)           = '0'
            AND Q.EZCANCELFLAG(+)           = '0'
            AND R.EZCANCELFLAG(+)           = '0'
            AND S.EZCANCELFLAG(+)           = '0'
            AND T.EZCANCELFLAG(+)           = '0'
    </statement>
    <statement id="getCostData" parameterClass="Map" resultClass="Map">
        SELECT
             A.GLBL_CMPY_CD                             AS GLBL_CMPY_CD
            ,A.INVTY_TRX_DT                             AS DWH_TRGT_DT
            ,SUBSTR(A.INVTY_TRX_DT,1,6)                 AS DWH_TRGT_YR_MTH
            ,SUBSTR(A.INVTY_TRX_DT,1,4)                 AS DWH_TRGT_YR
<!-- START 2017/01/31 K.Ochiai [QC#17320, MOD] -->
            ,TO_CHAR(TO_DATE(A.INVTY_TRX_DT, 'YYYYMMDD'), 'Q')    AS DWH_TRGT_QTR_NUM
<!-- END 2017/01/31 K.Ochiai [QC#17320, MOD] -->
            ,D.DS_CONTR_PK                              AS DS_CONTR_PK
            ,J.DS_CONTR_NUM                             AS DS_CONTR_NUM
            ,J.DS_CONTR_DTL_PK                          AS DS_CONTR_DTL_PK
            ,D.DS_CONTR_DTL_TP_CD                       AS DS_CONTR_DTL_TP_CD
            ,E.DS_CONTR_DTL_TP_DESC_TXT                 AS DS_CONTR_DTL_TP_DESC_TXT
            ,C.SVC_CONTR_BR_CD                          AS SVC_CONTR_BR_CD
            ,C.DS_CONTR_CATG_CD                         AS DS_CONTR_CATG_CD
            ,R.DS_CONTR_CATG_DESC_TXT                   AS DS_CONTR_CATG_DESC_TXT
            ,C.SVC_LINE_BIZ_CD                          AS SVC_LINE_BIZ_CD
            ,P.BILL_TO_CUST_ACCT_CD                     AS DS_ACCT_NUM
            ,B.DS_ACCT_NM                               AS DS_ACCT_NM
            ,P.BILL_TO_CUST_CD                          AS ALT_PAYER_CUST_CD
            ,P.SHIP_TO_CUST_ACCT_CD                     AS CUR_LOC_ACCT_NUM
            ,AA.DS_ACCT_NM                              AS CUR_LOC_ACCT_NM
            ,P.ADD_SHIP_TO_CUST_CD                      AS CUR_LOC_NUM
            ,X.LOC_NUM                                  AS IND_CUR_LOC_NUM
            ,D.SVC_MACH_MSTR_PK                         AS SVC_MACH_MSTR_PK
            ,CASE
                WHEN C.DS_CONTR_CATG_CD = #dsContrCatgFlt#
                    THEN NVL(M.SER_NUM, #serNumFlt#)
                ELSE M.SER_NUM
             END                                           SER_NUM
            ,L.MDL_ID                                   AS MDL_ID
            ,NVL(K.T_MDL_NM, #noMdlNm#)                 AS T_MDL_NM
            ,G.SVC_SEG_CD                               AS SVC_SEG_CD
            ,NVL(N.SVC_SEG_DESC_TXT, #noSvcSegDescTxt#) AS SVC_SEG_DESC_TXT
            ,NULL                                       AS COA_CMPY_CD
            ,NULL                                       AS COA_AFFL_CD
            ,NULL                                       AS COA_BR_CD
            ,NULL                                       AS COA_CH_CD
            ,NULL                                       AS COA_CC_CD
            ,NULL                                       AS COA_ACCT_CD
            ,W.COA_PROD_CD                              AS COA_PROD_CD
            ,NULL                                       AS COA_PROJ_CD
            ,NULL                                       AS COA_EXTN_CD
            ,A.MDSE_CD                                  AS MDSE_CD
<!-- START 2016/11/22 K.Ochiai [QC#16012, MOD]  -->
            ,W.MDSE_DESC_SHORT_TXT                      AS MDSE_DESC_SHORT_TXT
<!-- END 2016/11/22 K.Ochiai [QC#16012, MOD] -->
            ,A.INVTY_TRX_QTY                            AS SHIP_QTY
            ,A.UNIT_COST_AMT                            AS UNIT_COST_AMT
            ,A.SHIP_COST_AMT                            AS SHIP_CPLT_COST_AMT
            ,NULL                                       AS SVC_INV_CHRG_TP_CD
            ,NULL                                       AS SVC_INV_CHRG_TP_DESC_TXT
            ,NULL                                       AS DS_INV_TP_CD
            ,NULL                                       AS INV_TP_DESC_TXT
            ,J.INV_NUM                                  AS INV_NUM
            ,J.INV_BOL_LINE_NUM                         AS INV_BOL_LINE_NUM
            ,J.INV_LINE_NUM                             AS INV_LINE_NUM
            ,J.INV_LINE_SUB_NUM                         AS INV_LINE_SUB_NUM
            ,J.INV_LINE_SUB_TRX_NUM                     AS INV_LINE_SUB_TRX_NUM
            ,J.SVC_INV_LINE_PK                          AS SVC_INV_LINE_PK
            ,I.INV_DT                                   AS INV_DT
            ,NULL                                       AS ACCT_DT
            ,AC.BLACK_COLOR_FLG                         AS BLACK_COLOR_FLG
            ,A.UNIT_COST_AMT * A.INVTY_TRX_QTY * (-1)   AS COST_AMT
            ,NULL                                       AS MTR_CHRG_DEAL_AMT
            ,J.BLLG_PER_FROM_DT                         AS BLLG_PER_FROM_DT
            ,J.BLLG_PER_THRU_DT                         AS BLLG_PER_THRU_DT
            ,Q.ORD_QTY                                  AS ORD_QTY
            ,CASE
                WHEN C.DS_CONTR_CATG_CD = #dsContrCatgFlt#
                    THEN (SELECT
                            COUNT(*)
                          FROM
                             DS_CONTR_DTL   AD
                            ,SVC_MACH_MSTR  AE
                          WHERE
                                  AD.DS_CONTR_DTL_TP_CD                     &lt;&gt; 'FLEET'
                              AND D.DS_CONTR_PK                             = AD.DS_CONTR_PK
                              AND AD.CONTR_EFF_FROM_DT                      &lt;= #contrDt#
                              AND NVL(AD.CONTR_CLO_DT,AD.CONTR_EFF_THRU_DT) &gt;= #contrDt#
                              AND AD.SVC_MACH_MSTR_PK                       = AE.SVC_MACH_MSTR_PK
                              AND AE.SVC_MACH_TP_CD                         = #svcMachTpMachine#
                              AND AD.GLBL_CMPY_CD                           = #glblCmpyCd#
                              AND AD.EZCANCELFLAG                           = '0'
                              AND AD.GLBL_CMPY_CD                           = AE.GLBL_CMPY_CD
                              AND AD.EZCANCELFLAG                           = AE.EZCANCELFLAG)
                ELSE 1
             END                                           ACTL_MACH_QTY
            ,Q.CPO_ORD_NUM                              AS CPO_ORD_NUM
            ,Q.CPO_DTL_LINE_NUM                         AS CPO_DTL_LINE_NUM
            ,P.CPO_ORD_TS                               AS CPO_ORD_DT
            ,W.IMG_SPLY_YIELD_CNT                       AS IMG_SPLY_YIELD_CNT
            ,D.SVC_PGM_MDSE_CD                          AS SVC_PGM_MDSE_CD
            ,NULL                                       AS INV_LINE_SPL_TP_CD
            ,NULL                                       AS INV_LINE_SPL_TP_DESC_TXT
            ,A.INVTY_LOC_CD                             AS PRT_USED_BY_TECH_LOC_CD
            ,W.IMG_SPLY_TP_CD                           AS IMG_SPLY_TP_CD
            ,U.IMG_SPLY_TP_DESC_TXT                     AS IMG_SPLY_TP_DESC_TXT
            ,W.IMG_SPLY_COLOR_TP_CD                     AS IMG_SPLY_COLOR_TP_CD
            ,O.IMG_SPLY_COLOR_TP_DESC_TXT               AS IMG_SPLY_COLOR_TP_DESC_TXT
            ,T.STD_YIELD_CNT                            AS USED_MULT_CNT
<!-- START 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            ,NVL(AD.COA_CMPY_DESC_TXT, AE.COA_CMPY_DESC_TXT)    AS COA_CMPY_DESC_TXT
<!-- END 2016/11/22 K.Ochiai [QC#16012, ADD] -->
        FROM
             INVTY_TRX            A
            ,SELL_TO_CUST         B
            ,DS_CONTR             C
            ,DS_CONTR_DTL         D
            ,DS_CONTR_DTL_TP      E
            ,DS_MDL               G
            ,INV                  I
            ,INV_LINE             J
            ,MDL_NM               K
            ,SVC_CONFIG_MSTR      L
            ,SVC_MACH_MSTR        M
            ,SVC_SEG              N
            ,IMG_SPLY_COLOR_TP    O
            ,CPO                  P
            ,CPO_DTL              Q
            ,DS_CONTR_CATG        R
            ,DS_MDL_SPLY_RELN     T
            ,IMG_SPLY_TP          U
            ,MDSE                 W
            ,SHIP_TO_CUST         X
            ,SELL_TO_CUST         AA
            ,(SELECT
                   AB.MDSE_CD
                  ,CT.BLACK_COLOR_FLG
              FROM
                   MDSE               AB
                  ,IMG_SPLY_COLOR_TP  CT
              WHERE
                      AB.GLBL_CMPY_CD          = #glblCmpyCd#
                  AND AB.EZCANCELFLAG          = '0'
                  AND AB.GLBL_CMPY_CD          = CT.GLBL_CMPY_CD(+)
                  AND AB.EZCANCELFLAG          = CT.EZCANCELFLAG(+)
                  AND AB.IMG_SPLY_COLOR_TP_CD  = CT.IMG_SPLY_COLOR_TP_CD(+)) AC
<!-- START 2016/11/22 K.Ochiai [QC#16012, ADD]-->
            ,COA_CMPY             AD
            ,COA_CMPY             AE
<!-- END 2016/11/22 K.Ochiai [QC#16012, ADD] -->
        WHERE
                A.CPO_ORD_NUM                  = Q.CPO_ORD_NUM
            AND A.CPO_DTL_LINE_NUM             = Q.CPO_DTL_LINE_NUM
            AND A.CPO_DTL_LINE_SUB_NUM         = Q.CPO_DTL_LINE_SUB_NUM
            AND A.INVTY_TRX_DT                 = #cratDays#
            AND A.MDSE_CD                      = W.MDSE_CD
<!-- START 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND A.GLBL_CMPY_CD                 = AE.COA_CMPY_CD
<!-- END 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND Q.CPO_ORD_NUM                  = P.CPO_ORD_NUM
            AND ($ordCatgRsn$)
            AND P.BILL_TO_CUST_ACCT_CD         = B.SELL_TO_CUST_CD
            AND P.SHIP_TO_CUST_ACCT_CD         = AA.SELL_TO_CUST_CD
            AND P.ADD_SHIP_TO_CUST_CD          = X.SHIP_TO_CUST_CD
            AND Q.CPO_ORD_NUM                  = J.CPO_ORD_NUM(+)
            AND Q.CPO_DTL_LINE_NUM             = J.CPO_DTL_LINE_NUM(+)
            AND Q.CPO_DTL_LINE_SUB_NUM         = J.CPO_DTL_LINE_SUB_NUM(+)
            AND J.INV_NUM                      = I.INV_NUM(+)
<!-- START 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND J.COA_CMPY_CD                  = AD.COA_CMPY_CD(+)
<!-- END 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND W.IMG_SPLY_TP_CD               = U.IMG_SPLY_TP_CD(+)
            AND W.IMG_SPLY_COLOR_TP_CD         = O.IMG_SPLY_COLOR_TP_CD(+)
            AND Q.SVC_CONFIG_MSTR_PK           = L.SVC_CONFIG_MSTR_PK(+)
            AND L.MDL_ID                       = G.MDL_ID(+)
            AND G.MDL_ID                       = K.T_MDL_ID(+)
            AND G.SVC_SEG_CD                   = N.SVC_SEG_CD(+)
            AND L.SVC_MACH_MSTR_PK             = M.SVC_MACH_MSTR_PK(+)
            AND Q.DS_CONTR_NUM                 = C.DS_CONTR_NUM(+)
            AND C.DS_CONTR_PK                  = D.DS_CONTR_PK(+)
            AND M.SVC_MACH_MSTR_PK             = D.SVC_MACH_MSTR_PK(+)
            AND D.DS_CONTR_DTL_TP_CD           = E.DS_CONTR_DTL_TP_CD(+)
            AND C.DS_CONTR_CATG_CD             = R.DS_CONTR_CATG_CD(+)
            AND (A.MDSE_CD                     = T.MDSE_CD
                OR  SUBSTR(A.MDSE_CD,1,8)      = T.ORD_TAKE_MDSE_CD)
            AND G.MDL_ID                       = T.MDL_ID
            AND T.EFF_FROM_DT                  &lt;= #cratDays#
            AND NVL(T.EFF_THRU_DT, #cratDays#) &gt;= #cratDays#
            AND W.MDSE_CD                      = AC.MDSE_CD
            AND A.GLBL_CMPY_CD                 = #glblCmpyCd#
            AND A.GLBL_CMPY_CD                 = Q.GLBL_CMPY_CD
            AND A.GLBL_CMPY_CD                 = W.GLBL_CMPY_CD
<!-- START 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND A.GLBL_CMPY_CD                 = AE.GLBL_CMPY_CD
<!-- END 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND Q.GLBL_CMPY_CD                 = P.GLBL_CMPY_CD
            AND P.GLBL_CMPY_CD                 = B.GLBL_CMPY_CD
            AND P.GLBL_CMPY_CD                 = AA.GLBL_CMPY_CD
            AND P.GLBL_CMPY_CD                 = X.GLBL_CMPY_CD
            AND Q.GLBL_CMPY_CD                 = J.GLBL_CMPY_CD(+)
            AND J.GLBL_CMPY_CD                 = I.GLBL_CMPY_CD(+)
<!-- START 2016/11/22 K.Ochiai [QC#16012, ADD]  -->
            AND J.GLBL_CMPY_CD                 = AD.GLBL_CMPY_CD(+)
<!-- END 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND W.GLBL_CMPY_CD                 = U.GLBL_CMPY_CD(+)
            AND W.GLBL_CMPY_CD                 = O.GLBL_CMPY_CD(+)
            AND Q.GLBL_CMPY_CD                 = L.GLBL_CMPY_CD(+)
            AND L.GLBL_CMPY_CD                 = G.GLBL_CMPY_CD(+)
            AND L.GLBL_CMPY_CD                 = K.T_GLBL_CMPY_CD(+)
            AND G.GLBL_CMPY_CD                 = N.GLBL_CMPY_CD(+)
            AND L.GLBL_CMPY_CD                 = M.GLBL_CMPY_CD(+)
            AND Q.GLBL_CMPY_CD                 = C.GLBL_CMPY_CD(+)
            AND C.GLBL_CMPY_CD                 = D.GLBL_CMPY_CD(+)
            AND M.GLBL_CMPY_CD                 = D.GLBL_CMPY_CD(+)
            AND D.GLBL_CMPY_CD                 = E.GLBL_CMPY_CD(+)
            AND C.GLBL_CMPY_CD                 = R.GLBL_CMPY_CD(+)
            AND A.GLBL_CMPY_CD                 = T.GLBL_CMPY_CD(+)
            AND A.EZCANCELFLAG                 = '0'
            AND B.EZCANCELFLAG                 = '0'
            AND P.EZCANCELFLAG                 = '0'
            AND Q.EZCANCELFLAG                 = '0'
            AND W.EZCANCELFLAG                 = '0'
            AND X.EZCANCELFLAG                 = '0'
            AND AA.EZCANCELFLAG                = '0'
<!-- START 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND AE.EZCANCELFLAG                = '0'
<!-- END 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND J.EZCANCELFLAG(+)              = '0'
            AND I.EZCANCELFLAG(+)              = '0'
            AND U.EZCANCELFLAG(+)              = '0'
            AND O.EZCANCELFLAG(+)              = '0'
            AND L.EZCANCELFLAG(+)              = '0'
            AND G.EZCANCELFLAG(+)              = '0'
            AND K.EZCANCELFLAG(+)              = '0'
            AND N.EZCANCELFLAG(+)              = '0'
            AND M.EZCANCELFLAG(+)              = '0'
            AND C.EZCANCELFLAG(+)              = '0'
            AND D.EZCANCELFLAG(+)              = '0'
            AND E.EZCANCELFLAG(+)              = '0'
            AND R.EZCANCELFLAG(+)              = '0'
            AND T.EZCANCELFLAG(+)              = '0'
<!-- START 2016/11/22 K.Ochiai [QC#16012, ADD] -->
            AND AD.EZCANCELFLAG(+)              = '0'
<!-- END 2016/11/22 K.Ochiai [QC#16012, ADD] -->
    </statement>
</sqlMap>
