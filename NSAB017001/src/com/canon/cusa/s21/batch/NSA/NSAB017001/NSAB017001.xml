<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAB017001">
<statement id="divAdcvCalcTrgt" parameterClass="Map" resultClass="Map">
SELECT
	SMM.SVC_MACH_MSTR_PK
,	SMM.SER_NUM
,	MOD(SMM.SVC_MACH_MSTR_PK, #parProcTotTaskCnt#)	AS	PAR_PROC_TASK_NUM
FROM
	SVC_MACH_MSTR	SMM
WHERE
	SMM.GLBL_CMPY_CD			=	#glblCmpyCd#
<isNotNull property="svcMachMstrStsCd">
AND	SMM.SVC_MACH_MSTR_STS_CD	=	#svcMachMstrStsCd#
</isNotNull>
AND	SMM.EZCANCELFLAG			=	'0'
<!-- START 2020/07/15 [QC#57375, DEL] -->
<!-- 
AND	EXISTS (
	SELECT
		*
	FROM
		DS_CONTR_DTL	DCD
	,	DS_CONTR_DTL_TP	DDT
	,	DS_CONTR		DCR
	WHERE
		DCD.SVC_MACH_MSTR_PK		=	SMM.SVC_MACH_MSTR_PK
	AND	DCD.GLBL_CMPY_CD			=	SMM.GLBL_CMPY_CD
	<isNotNull property="dsContrDtlStsCd">
	AND	DCD.DS_CONTR_DTL_STS_CD		=	#dsContrDtlStsCd#
	</isNotNull>
	AND	DCD.EZCANCELFLAG			=	SMM.EZCANCELFLAG
	AND	DCR.DS_CONTR_PK				=	DCD.DS_CONTR_PK
	AND	DDT.DS_CONTR_DTL_TP_CD		=	DCD.DS_CONTR_DTL_TP_CD
	AND	DDT.GLBL_CMPY_CD			=	DCD.GLBL_CMPY_CD
	AND	DDT.MAIN_UNIT_LINE_FLG		=	'Y'
	AND	DDT.EZCANCELFLAG			=	'0'
	AND	DCR.GLBL_CMPY_CD			=	DCD.GLBL_CMPY_CD
	<isNotNull property="dsContrStsCd">
	AND	DCR.DS_CONTR_STS_CD			=	#dsContrStsCd#
	</isNotNull>
	AND	DCR.EZCANCELFLAG			=	DCD.EZCANCELFLAG
)
 -->
 <!-- END 2020/07/15 [QC#57375, DEL] -->
<!-- START 2018/06/12 T.Murai [QC#19193, ADD] -->
AND EXISTS (
    SELECT
        *
    FROM 
        SVC_PHYS_MTR SPM
    WHERE
        SPM.GLBL_CMPY_CD            = SMM.GLBL_CMPY_CD
    AND SPM.SVC_MACH_MSTR_PK        = SMM.SVC_MACH_MSTR_PK
    AND SPM.EZCANCELFLAG            = '0' 
)
<!-- END 2018/06/12 T.Murai [QC#19193, ADD] -->
</statement>
</sqlMap>