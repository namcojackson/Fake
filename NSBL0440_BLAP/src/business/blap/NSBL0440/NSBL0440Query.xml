<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSBL0440Query">
    <typeAlias alias="NSBL0440_ASMsg" type="business.blap.NSBL0440.NSBL0440_ASMsg"/>

    <statement id="getDtlInfo" parameterClass="Map" resultMap="result.getDtlInfo">
        <!-- START 2018/06/01 U.Kim [QC#22393, ADD] -->
        SELECT
             SVC_MOD_STS_PK
            ,MDSE_CD
            ,SER_NUM
            ,SVC_MOD_PROC_STS_CD
            ,SVC_MOD_PROC_STS_DESC_TXT
            ,SVC_TASK_NUM
            ,SVC_TASK_CLO_DT
            ,SVC_MOD_OPT_CD
            ,SVC_MOD_OPT_DT
            ,SVC_MOD_NOTE_TXT
            ,EZUPTIME
            ,EZUPTIMEZONE
            ,SVC_MOD_DTL_PK
            ,SVC_MACH_MSTR_PK
            ,SVC_MACH_MSTR_STS_DESC_TXT
            ,SVC_MACH_MSTR_STS_CD
            ,XX_REC_HIST_CRAT_TS
            ,XX_REC_HIST_CRAT_BY_NM
            ,XX_REC_HIST_UPD_TS
            ,XX_REC_HIST_UPD_BY_NM
            ,XX_REC_HIST_TBL_NM
        FROM
            (
        <!-- END 2018/06/01 U.Kim [QC#22393, ADD] -->
        SELECT
             SVC_MOD_STS_PK             AS SVC_MOD_STS_PK
            ,MDSE_CD                    AS MDSE_CD
            ,SER_NUM                    AS SER_NUM
            ,SVC_MOD_PROC_STS_CD        AS SVC_MOD_PROC_STS_CD
            ,SVC_MOD_PROC_STS_DESC_TXT  AS SVC_MOD_PROC_STS_DESC_TXT
            ,SVC_TASK_NUM               AS SVC_TASK_NUM
            ,SVC_TASK_CLO_DT            AS SVC_TASK_CLO_DT
            ,SVC_MOD_OPT_CD             AS SVC_MOD_OPT_CD
            ,SVC_MOD_OPT_DT             AS SVC_MOD_OPT_DT
            ,SVC_MOD_NOTE_TXT           AS SVC_MOD_NOTE_TXT
            ,EZUPTIME                   AS EZUPTIME
            ,EZUPTIMEZONE               AS EZUPTIMEZONE
            ,SVC_MOD_DTL_PK             AS SVC_MOD_DTL_PK
            ,SVC_MACH_MSTR_PK           AS SVC_MACH_MSTR_PK
<!-- START 2018/06/01 U.Kim [QC#22393, ADD] -->
            ,SVC_MACH_MSTR_STS_DESC_TXT AS SVC_MACH_MSTR_STS_DESC_TXT
            ,SVC_MACH_MSTR_STS_CD       AS SVC_MACH_MSTR_STS_CD
            ,MOD_DPLY_SORT_NUM          AS MOD_DPLY_SORT_NUM
            ,SVC_MOD_PROC_STS_SORT_NUM  AS SVC_MOD_PROC_STS_SORT_NUM
<!-- END 2018/06/01 U.Kim [QC#22393, ADD] -->
<!-- START 2016/12/02 N.Arai [QC#14204, ADD] -->
            ,XX_REC_HIST_CRAT_TS        AS XX_REC_HIST_CRAT_TS
            ,XX_REC_HIST_CRAT_BY_NM     AS XX_REC_HIST_CRAT_BY_NM
            ,XX_REC_HIST_UPD_TS         AS XX_REC_HIST_UPD_TS
            ,XX_REC_HIST_UPD_BY_NM      AS XX_REC_HIST_UPD_BY_NM
            ,XX_REC_HIST_TBL_NM         AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/02 N.Arai [QC#14204, ADD] -->
        FROM (
            SELECT
                 SMS.SVC_MOD_STS_PK             AS SVC_MOD_STS_PK
                ,SMM.MDSE_CD                    AS MDSE_CD
                ,SMM.SER_NUM                    AS SER_NUM
                ,SMS.SVC_MOD_PROC_STS_CD        AS SVC_MOD_PROC_STS_CD
                ,SMP.SVC_MOD_PROC_STS_DESC_TXT  AS SVC_MOD_PROC_STS_DESC_TXT
                ,SMS.SVC_TASK_NUM               AS SVC_TASK_NUM
                ,STK.SVC_TASK_CLO_DT            AS SVC_TASK_CLO_DT
                ,SMS.SVC_MOD_OPT_CD             AS SVC_MOD_OPT_CD
                ,SMS.SVC_MOD_OPT_DT             AS SVC_MOD_OPT_DT
                ,SMS.SVC_MOD_NOTE_TXT           AS SVC_MOD_NOTE_TXT
                ,SMS.EZUPTIME                   AS EZUPTIME
                ,SMS.EZUPTIMEZONE               AS EZUPTIMEZONE
                ,SMS.SVC_MOD_DTL_PK             AS SVC_MOD_DTL_PK
                ,SMM.SVC_MACH_MSTR_PK           AS SVC_MACH_MSTR_PK
<!-- START 2018/06/01 U.Kim [QC#22393, ADD] -->
                ,SMMS.SVC_MACH_MSTR_STS_DESC_TXT AS SVC_MACH_MSTR_STS_DESC_TXT
                ,SMMS.MOD_DPLY_SORT_NUM         AS MOD_DPLY_SORT_NUM
                ,SMMS.SVC_MACH_MSTR_STS_CD      AS SVC_MACH_MSTR_STS_CD
                ,SMP.SVC_MOD_PROC_STS_SORT_NUM  AS SVC_MOD_PROC_STS_SORT_NUM
<!-- END 2018/06/01 U.Kim [QC#22393, ADD] -->
<!-- START 2016/12/02 N.Arai [QC#14204, ADD] -->
                ,SMS.EZINTIME                   AS XX_REC_HIST_CRAT_TS
                ,SMS.EZINUSERID                 AS XX_REC_HIST_CRAT_BY_NM
                ,SMS.EZUPTIME                   AS XX_REC_HIST_UPD_TS
                ,SMS.EZUPUSERID                 AS XX_REC_HIST_UPD_BY_NM
                ,SMS.EZTABLEID                  AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/02 N.Arai [QC#14204, ADD] -->
            FROM
                 SVC_MOD_STS       SMS
                ,SVC_MACH_MSTR     SMM
                ,SVC_TASK          STK
                ,SVC_MOD_PROC_STS  SMP
<!-- START 2018/06/01 U.Kim [QC#22393, ADD] -->
                ,SVC_MACH_MSTR_STS SMMS
<!-- END 2018/06/01 U.Kim [QC#22393, ADD] -->
            WHERE
                    SMS.GLBL_CMPY_CD        = #glblCmpyCd#
                AND SMS.SVC_MOD_PK          = #svcModPk#
                AND SMS.SVC_MACH_MSTR_PK    = SMM.SVC_MACH_MSTR_PK
                <!-- START 2022/05/23 E. Sanchez [QC#59930, MOD] -->
                <!-- START 2022/06/03 E. Sanchez [QC#59930, MOD] -->
                <!-- Reverted to version before fix due to detected side effect -->
                AND SMS.SVC_TASK_NUM        = STK.SVC_TASK_NUM
                <!-- END 2022/06/03 E. Sanchez [QC#59930, MOD] -->
                <!-- START 2022/06/03 E. Sanchez [QC#59930, DEL] -->
                <!-- Deleted due to detected side effect -->
                <!-- AND
                (
                    SMS.SVC_TASK_NUM        = STK.SVC_TASK_NUM
                    OR
                    (SMS.SVC_TASK_NUM IS NULL
                     AND STK.SVC_TASK_CLO_DT IS NULL
                    )
                ) -->
                <!-- END 2022/05/23 E. Sanchez [QC#59930, MOD] -->
                <!-- END 2022/06/03 E. Sanchez [QC#59930, DEL] -->
                AND SMS.SVC_MOD_PROC_STS_CD = SMP.SVC_MOD_PROC_STS_CD
<!-- START 2018/06/01 U.Kim [QC#22393, ADD] -->
                AND SMM.SVC_MACH_MSTR_STS_CD = SMMS.SVC_MACH_MSTR_STS_CD
<!-- END 2018/06/01 U.Kim [QC#22393, ADD] -->
                AND SMS.GLBL_CMPY_CD        = SMM.GLBL_CMPY_CD
                AND SMS.GLBL_CMPY_CD        = STK.GLBL_CMPY_CD
                AND SMS.GLBL_CMPY_CD        = SMP.GLBL_CMPY_CD
<!-- START 2018/06/01 U.Kim [QC#22393, ADD] -->
                AND SMM.GLBL_CMPY_CD        = SMMS.GLBL_CMPY_CD
<!-- END 2018/06/01 U.Kim [QC#22393, ADD] -->
                AND SMS.EZCANCELFLAG        = '0'
                AND SMM.EZCANCELFLAG        = '0'
                AND STK.EZCANCELFLAG        = '0'
                AND SMP.EZCANCELFLAG        = '0'
<!-- START 2018/06/01 U.Kim [QC#22393, ADD] -->
                AND SMMS.EZCANCELFLAG       = '0'
<!-- END 2018/06/01 U.Kim [QC#22393, ADD] -->
                <!-- START 2016/04/26 [QC#11681, MOD] -->
                <isEqual property="xxChkBox_OR" compareValue="Y">
                    <isNotNull property="mdseCd">
                    AND (
                        SMM.MDSE_CD &gt;= #mdseCd#
                    <isNotNull property="serNum">
                     OR SMM.SER_NUM &gt;= #serNum#)
                    </isNotNull>
                    <isNull property="serNum">
                     )
                    </isNull>
                    </isNotNull>

                    <isNull property="mdseCd">
                    <isNotNull property="serNum">
                    AND SMM.SER_NUM &gt;= #serNum#
                    </isNotNull>
                    </isNull>
                </isEqual>
                <isNull property="xxChkBox_OR">
                    <isNotNull property="mdseCd">
                    AND SMM.MDSE_CD &gt;= #mdseCd#
                    </isNotNull>
                    <isNotNull property="serNum">
                    AND SMM.SER_NUM &gt;= #serNum#
                    </isNotNull>
                </isNull>
                <!-- END 2016/04/26 [QC#11681, MOD] -->
            UNION

            SELECT
                 STS.SVC_MOD_STS_PK         AS SVC_MOD_STS_PK
                ,SMM.MDSE_CD                AS MDSE_CD
                ,SMM.SER_NUM                AS SER_NUM
                ,STS.SVC_MOD_PROC_STS_CD    AS SVC_MOD_PROC_STS_CD
                ,(
                    SELECT
                        SMPS.SVC_MOD_PROC_STS_DESC_TXT
                    FROM
                        SVC_MOD_PROC_STS SMPS
                    WHERE
                            SMPS.GLBL_CMPY_CD           = #glblCmpyCd#
                        AND SMPS.SVC_MOD_PROC_STS_CD    = CASE
                        <!-- START 2019/03/22 S.Kitamura [QC#30815, ADD] -->
                                                            WHEN STS.SVC_MOD_PROC_STS_CD IS NULL AND EXISTS(
                                                                SELECT 1
                                                                FROM
                                                                    SVC_MOD_DTL SMD
                                                                WHERE
                                                                    SMD.GLBL_CMPY_CD    = #glblCmpyCd#
                                                                AND SMD.SVC_MOD_PK      = #svcModPk#
                                                                AND SMD.EZCANCELFLAG    = '0'
                                                                AND (   SMD.SVC_MOD_CANC_DT &lt;= #slsDt#
                                                                     OR SMD.SVC_MOD_OBSL_DT &lt;= #slsDt#)
                                                                <!-- mod start 2019/04/02 QC#31027 -->
                                                                <!-- AND SMD.MDSE_CD         = SMM.MDSE_CD -->
                                                                AND ((LENGTH(SMD.MDSE_CD) &gt;  #mdseCdLen# AND SMM.MDSE_CD = SMD.MDSE_CD)
                                                                     OR
                                                                     (LENGTH(SMD.MDSE_CD) &lt;= #mdseCdLen# AND SMM.MDSE_CD LIKE SMD.MDSE_CD || '%'))
                                                                <!-- mod end 2019/04/02 QC#31027 -->
                                                                <!-- add start 2019/04/02 QC#31027 -->
                                                                UNION
                                                                SELECT 1
                                                                FROM
                                                                    SVC_MOD_DTL SMD
                                                                    ,MDSE_ITEM_FLIP_SET FLP
                                                                WHERE
                                                                    SMD.GLBL_CMPY_CD    = #glblCmpyCd#
                                                                AND SMD.SVC_MOD_PK      = #svcModPk#
                                                                AND SMD.EZCANCELFLAG    = '0'
                                                                AND (   SMD.SVC_MOD_CANC_DT &lt;= #slsDt#
                                                                     OR SMD.SVC_MOD_OBSL_DT &lt;= #slsDt#)
                                                                AND SMD.GLBL_CMPY_CD    = FLP.GLBL_CMPY_CD
                                                                AND SMD.MDSE_CD         = FLP.MDSE_CD
                                                                AND FLP.EZCANCELFLAG    = '0'
                                                                <iterate property="mdseItemRelnTpCdList" var="mdseItemRelnTpCd[]" open="AND FLP.MDSE_ITEM_RELN_TP_CD (+) IN (" close=")" conjunction=",">
                                                                    #mdseItemRelnTpCd[]#
                                                                </iterate>
                                                                AND ((LENGTH(FLP.RELN_MDSE_CD) &gt; #mdseCdLen# AND SMM.MDSE_CD = FLP.RELN_MDSE_CD)
                                                                     OR
                                                                     (LENGTH(FLP.RELN_MDSE_CD) &lt;= #mdseCdLen# AND SMM.MDSE_CD LIKE FLP.RELN_MDSE_CD || '%'))
                                                                <!-- add end 2019/04/02 QC#31027 -->
                                                            )
                                                            THEN #svcModProcStsCd_canc#
                        <!-- END 2019/03/22 S.Kitamura [QC#30815, ADD] -->
                                                            WHEN STS.SVC_MOD_PROC_STS_CD IS NULL
                                                            THEN #svcModProcStsCd_op#
                                                            ELSE STS.SVC_MOD_PROC_STS_CD
                                                          END
                        AND SMPS.EZCANCELFLAG           = '0'
                 )                          AS SVC_MOD_PROC_STS_DESC_TXT
                ,STS.SVC_TASK_NUM           AS SVC_TASK_NUM
                ,NULL                       AS SVC_TASK_CLO_DT
                ,STS.SVC_MOD_OPT_CD         AS SVC_MOD_OPT_CD
                ,STS.SVC_MOD_OPT_DT         AS SVC_MOD_OPT_DT
                ,STS.SVC_MOD_NOTE_TXT       AS SVC_MOD_NOTE_TXT
                ,STS.EZUPTIME               AS EZUPTIME
                ,STS.EZUPTIMEZONE           AS EZUPTIMEZONE
                <!-- START 2021/12/20 Y.Penequito [QC#59114, MOD] -->
                <!-- ,MDT.SVC_MOD_DTL_PK         AS SVC_MOD_DTL_PK -->
                ,MDT_SVC_MOD_DTL_PK         AS SVC_MOD_DTL_PK
                <!-- END 2021/12/20 Y.Penequito [QC#59114, MOD] -->
                ,SMM.SVC_MACH_MSTR_PK       AS SVC_MACH_MSTR_PK
<!-- START 2018/06/01 U.Kim [QC#22393, ADD] -->
                ,SMMS.SVC_MACH_MSTR_STS_DESC_TXT AS SVC_MACH_MSTR_STS_DESC_TXT
                ,SMMS.MOD_DPLY_SORT_NUM     AS MOD_DPLY_SORT_NUM
                ,SMMS.SVC_MACH_MSTR_STS_CD  AS SVC_MACH_MSTR_STS_CD
                 ,(
                    SELECT
                        SMPS.SVC_MOD_PROC_STS_SORT_NUM
                    FROM
                        SVC_MOD_PROC_STS SMPS
                    WHERE
                            SMPS.GLBL_CMPY_CD           = #glblCmpyCd#
                        AND SMPS.SVC_MOD_PROC_STS_CD    = CASE
                        <!-- START 2019/03/22 S.Kitamura [QC#30815, ADD] -->
                                                            WHEN STS.SVC_MOD_PROC_STS_CD IS NULL AND EXISTS(
                                                                SELECT 1
                                                                FROM
                                                                    SVC_MOD_DTL SMD
                                                                WHERE
                                                                    SMD.GLBL_CMPY_CD    = #glblCmpyCd#
                                                                AND SMD.SVC_MOD_PK      = #svcModPk#
                                                                AND SMD.EZCANCELFLAG    = '0'
                                                                AND (   SMD.SVC_MOD_CANC_DT &lt;= #slsDt#
                                                                     OR SMD.SVC_MOD_OBSL_DT &lt;= #slsDt#)
                                                                <!-- mod start 2019/04/02 QC#31027 -->
                                                                <!-- AND SMD.MDSE_CD         = SMM.MDSE_CD -->
                                                                AND ((LENGTH(SMD.MDSE_CD) &gt;  #mdseCdLen# AND SMM.MDSE_CD = SMD.MDSE_CD)
                                                                     OR
                                                                     (LENGTH(SMD.MDSE_CD) &lt;= #mdseCdLen# AND SMM.MDSE_CD LIKE SMD.MDSE_CD || '%'))
                                                                <!-- mod end 2019/04/02 QC#31027 -->
                                                                <!-- add start 2019/04/02 QC#31027 -->
                                                                UNION
                                                                SELECT 1
                                                                FROM
                                                                    SVC_MOD_DTL SMD
                                                                    ,MDSE_ITEM_FLIP_SET FLP
                                                                WHERE
                                                                    SMD.GLBL_CMPY_CD    = #glblCmpyCd#
                                                                AND SMD.SVC_MOD_PK      = #svcModPk#
                                                                AND SMD.EZCANCELFLAG    = '0'
                                                                AND (   SMD.SVC_MOD_CANC_DT &lt;= #slsDt#
                                                                     OR SMD.SVC_MOD_OBSL_DT &lt;= #slsDt#)
                                                                AND SMD.GLBL_CMPY_CD    = FLP.GLBL_CMPY_CD
                                                                AND SMD.MDSE_CD         = FLP.MDSE_CD
                                                                AND FLP.EZCANCELFLAG    = '0'
                                                                <iterate property="mdseItemRelnTpCdList" var="mdseItemRelnTpCd[]" open="AND FLP.MDSE_ITEM_RELN_TP_CD (+) IN (" close=")" conjunction=",">
                                                                    #mdseItemRelnTpCd[]#
                                                                </iterate>
                                                                AND ((LENGTH(FLP.RELN_MDSE_CD) &gt;  #mdseCdLen# AND SMM.MDSE_CD = FLP.RELN_MDSE_CD)
                                                                     OR
                                                                     (LENGTH(FLP.RELN_MDSE_CD) &lt;= #mdseCdLen# AND SMM.MDSE_CD LIKE FLP.RELN_MDSE_CD || '%'))
                                                                <!-- add end 2019/04/02 QC#31027 -->
                                                            )
                                                            THEN #svcModProcStsCd_canc#
                        <!-- END 2019/03/22 S.Kitamura [QC#30815, ADD] -->
                                                            WHEN STS.SVC_MOD_PROC_STS_CD IS NULL
                                                            THEN #svcModProcStsCd_op#
                                                            ELSE STS.SVC_MOD_PROC_STS_CD
                                                          END
                        AND SMPS.EZCANCELFLAG           = '0'
                 )                          AS SVC_MOD_PROC_STS_SORT_NUM
<!-- END 2018/06/01 U.Kim [QC#22393, ADD] -->
<!-- START 2016/12/02 N.Arai [QC#14204, ADD] -->
                ,STS.EZINTIME               AS XX_REC_HIST_CRAT_TS
                ,STS.EZINUSERID             AS XX_REC_HIST_CRAT_BY_NM
                ,STS.EZUPTIME               AS XX_REC_HIST_UPD_TS
                ,STS.EZUPUSERID             AS XX_REC_HIST_UPD_BY_NM
                ,STS.EZTABLEID              AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/02 N.Arai [QC#14204, ADD] -->
            FROM
<!-- START 2021/12/20 Y.Penequito [QC#59114, MOD] -->
<!-- The following tables were separated to improve SQL performance -->
<!-- Note: Fixes for QC#27460 and QC#25672 were transferred to this separate table as part of QC#59114 fix -->
                (
                    SELECT --+ NO_MERGE USE_CONCAT
                        RNG.MDSE_CD               AS RNG_MDSE_CD
                       ,RNG.GLBL_CMPY_CD          AS RNG_GLBL_CMPY_CD
                       ,RNG.SVC_MOD_DTL_PK        AS RNG_SVC_MOD_DTL_PK
                       ,RNG.SVC_MOD_FROM_SER_NUM  AS RNG_SVC_MOD_FROM_SER_NUM
                       ,RNG.SVC_MOD_TO_SER_NUM    AS RNG_SVC_MOD_TO_SER_NUM
                       ,RNG.LG_SER_NUM            AS RNG_LG_SER_NUM
                       ,MDT.SVC_MOD_DTL_PK        AS MDT_SVC_MOD_DTL_PK
                       ,MDT.SVC_MOD_PK            AS MDT_SVC_MOD_PK
                       ,MDT.GLBL_CMPY_CD          AS MDT_GLBL_CMPY_CD
                       ,MDT.MDSE_CD               AS MDT_MDSE_CD
                       <!-- START 2022/05/27 E.Sanchez [QC#59930, MOD] -->
                       <!-- The following was modified to improve SQL performance -->
                       <!-- ,FLP.RELN_MDSE_CD          AS FLP_RELN_MDSE_CD  -->   
                       ,NVL(FLP.RELN_MDSE_CD, FLP2.RELN_MDSE_CD) AS FLP_RELN_MDSE_CD
                       <!-- END 2022/05/27 E.Sanchez [QC#59930, MOD] -->
                    FROM
                        SVC_MOD_SER_RNG    RNG
                       ,SVC_MOD_DTL        MDT
                       <!-- START 2018/08/08 K.Kitachi [QC#27460, ADD] -->
                       ,MDSE_ITEM_FLIP_SET FLP
                       <!-- END 2018/08/08 K.Kitachi [QC#27460, ADD] -->
                       <!-- START 2022/05/27 E.Sanchez [QC#59930, ADD] -->
                       <!-- The following was added to improve SQL performance -->
                       ,MDSE_ITEM_FLIP_SET FLP2
                       <!-- END 2022/05/27 E.Sanchez [QC#59930, ADD] -->
                    WHERE
                        RNG.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND RNG.SVC_MOD_PK            = #svcModPk#
                    AND RNG.GLBL_CMPY_CD          = MDT.GLBL_CMPY_CD
                    AND RNG.SVC_MOD_PK            = MDT.SVC_MOD_PK
                    <!-- START 2018/05/11 M.Naito [QC#25672, ADD] -->
                    AND RNG.SVC_MOD_DTL_PK        = MDT.SVC_MOD_DTL_PK
                    <!-- END 2018/05/11 M.Naito [QC#25672, ADD] -->
<!-- START 2022/05/27 E.Sanchez [QC#59930, MOD] -->
<!-- The following were modified to improve SQL performance -->
                    <!-- START 2018/08/08 K.Kitachi [QC#27460, ADD] -->
                    <!-- START 2022/04/13 L.Mandanas [QC#59930, MOD] -->
                    <!--  AND MDT.GLBL_CMPY_CD          = FLP.GLBL_CMPY_CD  -->
                    <!--  AND
                    (
                        (MDT.GLBL_CMPY_CD          = FLP.GLBL_CMPY_CD -->
                    <!-- END 2022/04/13 L.Mandanas [QC#59930, MOD] -->
                    <!-- END 2018/08/08 K.Kitachi [QC#27460, ADD] -->
                    <!--  AND (MDT.MDSE_CD              = FLP.MDSE_CD
                             OR MDT.MDSE_CD           = FLP.RELN_MDSE_CD) -->
                    <!-- START 2018/08/08 K.Kitachi [QC#27460, ADD] -->
                    <!--  AND FLP.EZCANCELFLAG          = '0' -->
                    <!-- START 2022/04/13 L.Mandanas [QC#59930, MOD] -->
                    <!-- )
                        OR 
                        MDT.MDSE_CD IS NOT NULL
                    ) -->
                    <!-- END 2022/04/13 L.Mandanas [QC#59930, MOD] -->
                    <!-- END 2018/08/08 K.Kitachi [QC#27460, ADD] -->
                    AND MDT.GLBL_CMPY_CD          = FLP.GLBL_CMPY_CD (+)
                    AND MDT.MDSE_CD               = FLP.MDSE_CD (+)
                    AND FLP.EZCANCELFLAG (+)      = '0'
                    AND MDT.GLBL_CMPY_CD          = FLP2.GLBL_CMPY_CD (+)
                    AND MDT.MDSE_CD               = FLP2.RELN_MDSE_CD (+)
                    AND FLP2.EZCANCELFLAG (+)      = '0'
<!-- END 2022/05/27 E.Sanchez [QC#59930, MOD] -->
                    AND RNG.EZCANCELFLAG          = '0'
                    AND MDT.EZCANCELFLAG          = '0'
                ) SEG
                 <!-- SVC_MOD_SER_RNG    RNG -->
                ,SVC_MACH_MSTR      SMM
                <!-- ,SVC_MOD_DTL        MDT -->
                <!-- START 2018/08/08 K.Kitachi [QC#27460, ADD] -->
                <!-- ,MDSE_ITEM_FLIP_SET FLP -->
                <!-- END 2018/08/08 K.Kitachi [QC#27460, ADD] -->
<!-- END 2021/12/20 Y.Penequito [QC#59114, MOD] -->
                ,SVC_MOD_STS        STS
<!-- START 2018/06/01 U.Kim [QC#22393, ADD] -->
                ,SVC_MACH_MSTR_STS  SMMS
<!-- END 2018/06/01 U.Kim [QC#22393, ADD] -->
<!-- START 2021/12/20 Y.Penequito [QC#59114, ADD] -->
<!-- The following queries were added to improve SQL performance -->
                ,(
                      SELECT
                          DISTINCT SMSR.SVC_MOD_PK
                         ,SMSR.GLBL_CMPY_CD
                         ,SMSR.MDSE_CD
                         ,SMSR.SVC_MOD_FROM_SER_NUM
                         ,SMSR.SVC_MOD_TO_SER_NUM
                      FROM
                          SVC_MOD_SER_RNG SMSR
                      WHERE
                          SMSR.EZCANCELFLAG            = '0'
                          AND LENGTH(SMSR.MDSE_CD) &gt; #mdseCdLen#
                      UNION ALL
                      SELECT
                          DISTINCT SMSR.SVC_MOD_PK
                         ,SMSR.GLBL_CMPY_CD
                         ,SMSR.MDSE_CD
                         ,SMSR.SVC_MOD_FROM_SER_NUM
                         ,SMSR.SVC_MOD_TO_SER_NUM
                      FROM
                          SVC_MOD_SER_RNG SMSR
                      WHERE
                          SMSR.EZCANCELFLAG             = '0'
                          AND LENGTH(SMSR.MDSE_CD) &lt;= #mdseCdLen#
                  ) MDSECD1A
                ,(
                      SELECT
                          DISTINCT MIFS.RELN_MDSE_CD
                         ,MIFS.GLBL_CMPY_CD
                         ,MIFS.MDSE_CD
                      FROM
                          MDSE_ITEM_FLIP_SET MIFS
                      WHERE
                          MIFS.EZCANCELFLAG            = '0'
                          <iterate property="mdseItemRelnTpCdList" var="mdseItemRelnTpCd[]" open="AND MIFS.MDSE_ITEM_RELN_TP_CD (+) IN (" close=")" conjunction=",">
                               #mdseItemRelnTpCd[]#
                          </iterate>
                          AND LENGTH(MIFS.RELN_MDSE_CD) &gt; #mdseCdLen#
                      UNION ALL
                      SELECT
                          DISTINCT MIFS.RELN_MDSE_CD
                         ,MIFS.GLBL_CMPY_CD
                         ,MIFS.MDSE_CD
                      FROM
                          MDSE_ITEM_FLIP_SET MIFS
                      WHERE
                          MIFS.EZCANCELFLAG            = '0'
                          <iterate property="mdseItemRelnTpCdList" var="mdseItemRelnTpCd[]" open="AND MIFS.MDSE_ITEM_RELN_TP_CD (+) IN (" close=")" conjunction=",">
                               #mdseItemRelnTpCd[]#
                          </iterate>
                          AND LENGTH(MIFS.RELN_MDSE_CD) &lt;= #mdseCdLen#
                  ) MDSECD2A
<!-- END 2021/12/20 Y.Penequito [QC#59114, ADD] -->
            <!-- START 2021/12/20 Y.Penequito [QC#59114, MOD] -->
            WHERE
                1 = 1
                  <!--  RNG.GLBL_CMPY_CD          = #glblCmpyCd#
                AND RNG.SVC_MOD_PK            = #svcModPk#
                AND RNG.GLBL_CMPY_CD          = SMM.GLBL_CMPY_CD
                AND RNG.SVC_MOD_FROM_SER_NUM &lt;= SMM.SER_NUM 
                AND RNG.SVC_MOD_TO_SER_NUM   &gt;= SMM.SER_NUM  -->
                AND RNG_GLBL_CMPY_CD          = SMM.GLBL_CMPY_CD
                AND RNG_SVC_MOD_FROM_SER_NUM &lt;= SMM.SER_NUM 
                AND RNG_SVC_MOD_TO_SER_NUM   &gt;= SMM.SER_NUM 
                <!-- AND RNG.GLBL_CMPY_CD          = MDT.GLBL_CMPY_CD
                AND RNG.SVC_MOD_PK            = MDT.SVC_MOD_PK -->
<!-- START 2018/05/11 M.Naito [QC#25672, ADD] -->
                <!-- AND RNG.SVC_MOD_DTL_PK        = MDT.SVC_MOD_DTL_PK -->
<!-- END 2018/05/11 M.Naito [QC#25672, ADD] -->
                <!-- AND RNG.LG_SER_NUM            = LENGTH(SMM.SER_NUM) -->
                AND RNG_LG_SER_NUM            = LENGTH(SMM.SER_NUM)
                <!-- START 2018/08/08 K.Kitachi [QC#27460, ADD] -->
                <!-- AND MDT.GLBL_CMPY_CD          = FLP.GLBL_CMPY_CD (+) -->
<!-- START 2021/11/09 L.Mandanas [QC#59114, MOD] -->
<!--                 AND MDT.MDSE_CD          = FLP.MDSE_CD (+)  -->
                <!-- AND (MDT.MDSE_CD              = FLP.MDSE_CD
                     OR MDT.MDSE_CD           = FLP.RELN_MDSE_CD) -->
<!-- END 2021/11/09 L.Mandanas [QC#59114, MOD] -->
<!-- START 2021/11/09 L.Mandanas [QC#59114, DEL] -->
<!--                 <iterate property="mdseItemRelnTpCdList" var="mdseItemRelnTpCd[]" open="AND FLP.MDSE_ITEM_RELN_TP_CD (+) IN (" close=")" conjunction=",">
                    #mdseItemRelnTpCd[]#
                </iterate>  -->
<!-- END 2021/11/09 L.Mandanas [QC#59114, DEL] -->
                <!-- AND FLP.EZCANCELFLAG      (+) = '0' -->
                <!-- END 2018/08/08 K.Kitachi [QC#27460, ADD] -->
<!-- START 2021/10/18 L.Mandanas [QC#59114, DEL] -->
<!--                 AND ( -->
<!--                   (LENGTH(MDT.MDSE_CD) &gt; #mdseCdLen# AND SMM.MDSE_CD = MDT.MDSE_CD)  -->
<!--                     OR  -->
<!--                   (LENGTH(MDT.MDSE_CD) &lt;= #mdseCdLen# AND SMM.MDSE_CD LIKE MDT.MDSE_CD || '%') -->
                  <!-- START 2018/08/08 K.Kitachi [QC#27460, ADD] -->
<!--                     OR  -->
<!--                   (LENGTH(FLP.RELN_MDSE_CD) &gt; #mdseCdLen# AND SMM.MDSE_CD = FLP.RELN_MDSE_CD)  -->
<!--                     OR  -->
<!--                   (LENGTH(FLP.RELN_MDSE_CD) &lt;= #mdseCdLen# AND SMM.MDSE_CD LIKE FLP.RELN_MDSE_CD || '%')  -->
                  <!-- END 2018/08/08 K.Kitachi [QC#27460, ADD] -->
<!--                ) -->
<!-- END 2021/10/18 L.Mandanas [QC#59114, DEL] -->
                <!-- END 2021/12/20 Y.Penequito [QC#59114, MOD] -->
<!-- START 2021/12/20 Y.Penequito [QC#59114, ADD] -->
                AND MDSECD1A.SVC_MOD_PK(+)                = MDT_SVC_MOD_PK
                AND MDSECD1A.GLBL_CMPY_CD(+)              = MDT_GLBL_CMPY_CD
                AND MDSECD1A.MDSE_CD(+)                   = SMM.MDSE_CD
                AND MDSECD1A.SVC_MOD_FROM_SER_NUM(+)  &lt;= SMM.SER_NUM 
                AND MDSECD1A.SVC_MOD_TO_SER_NUM(+)    &gt;= SMM.SER_NUM
                AND (SMM.MDSE_CD LIKE MDSECD1A.MDSE_CD || '%')
                AND MDSECD2A.MDSE_CD(+)                   = MDT_MDSE_CD
                AND MDSECD2A.GLBL_CMPY_CD(+)              = MDT_GLBL_CMPY_CD
                AND MDSECD2A.RELN_MDSE_CD(+)              = SMM.MDSE_CD
                AND (SMM.MDSE_CD LIKE MDSECD2A.RELN_MDSE_CD || '%')
                AND SMM.MDSE_CD =
                                  CASE
                                      WHEN MDSECD1A.MDSE_CD IS NOT NULL
                                          THEN RNG_MDSE_CD
                                      WHEN MDSECD2A.MDSE_CD IS NOT NULL
                                          THEN FLP_RELN_MDSE_CD
<!-- END 2021/12/20 Y.Penequito [QC#59114, ADD] -->
<!-- START 2021/10/18 L.Mandanas [QC#59114, ADD] -->
                <!-- START 2021/12/20 Y.Penequito [QC#59114, DEL] -->
                <!-- The following items were deleted and replaced with items above to improve SQL performance -->
                <!-- AND SMM.MDSE_CD =
                      CASE
                      WHEN EXISTS (
                              SELECT
                                  1
                              FROM
                                  SVC_MOD_SER_RNG SMSR
                              WHERE
                                  MDT.SVC_MOD_PK               = SMSR.SVC_MOD_PK
                              AND MDT.GLBL_CMPY_CD             = SMSR.GLBL_CMPY_CD
                              AND SMSR.EZCANCELFLAG            = '0'
                              AND (
                                  (LENGTH(SMSR.MDSE_CD) &gt; #mdseCdLen# AND SMM.MDSE_CD = SMSR.MDSE_CD)
                                     OR
                                  (LENGTH(SMSR.MDSE_CD) &lt;= #mdseCdLen# AND SMM.MDSE_CD LIKE SMSR.MDSE_CD || '%')
                              )
                              AND SMSR.SVC_MOD_FROM_SER_NUM &lt;= SMM.SER_NUM 
                              AND SMSR.SVC_MOD_TO_SER_NUM   &gt;= SMM.SER_NUM
                      )
                      THEN RNG.MDSE_CD
                      WHEN EXISTS (
                              SELECT
                                  1
                              FROM
                                  MDSE_ITEM_FLIP_SET MIFS
                              WHERE
                                  MDT.GLBL_CMPY_CD             = MIFS.GLBL_CMPY_CD
                              AND MDT.MDSE_CD                  = MIFS.MDSE_CD 
                               <iterate property="mdseItemRelnTpCdList" var="mdseItemRelnTpCd[]" open="AND MIFS.MDSE_ITEM_RELN_TP_CD (+) IN (" close=")" conjunction=",">
                                   #mdseItemRelnTpCd[]#
                              </iterate>
                              AND MIFS.EZCANCELFLAG            = '0'
                              AND (
                                  (LENGTH(MIFS.RELN_MDSE_CD) &gt; #mdseCdLen# AND SMM.MDSE_CD = MIFS.RELN_MDSE_CD)
                                     OR
                                  (LENGTH(MIFS.RELN_MDSE_CD) &lt;= #mdseCdLen# AND SMM.MDSE_CD LIKE MIFS.RELN_MDSE_CD || '%')
                              )
                      )
                      THEN FLP.RELN_MDSE_CD -->
                      <!-- END 2021/12/20 Y.Penequito [QC#59114, DEL] -->
<!-- START 2021/11/12 L.Mandanas [QC#59114, DEL] -->
<!-- START 2021/11/09 L.Mandanas [QC#59114, ADD] -->
<!-- 
                      WHEN EXISTS (
                              SELECT
                                  1
                              FROM
                                  MDSE_ITEM_FLIP_SET MIFS
                              WHERE
                                  MDT.GLBL_CMPY_CD             = MIFS.GLBL_CMPY_CD
                              AND MDT.MDSE_CD                  = MIFS.RELN_MDSE_CD 
                              <iterate property="mdseItemRelnTpCdList" var="mdseItemRelnTpCd[]" open="AND MIFS.MDSE_ITEM_RELN_TP_CD (+) IN (" close=")" conjunction=",">
                                   #mdseItemRelnTpCd[]#
                              </iterate>
                              AND MIFS.EZCANCELFLAG            = '0'
                              AND (
                                  (LENGTH(MIFS.MDSE_CD) &gt; #mdseCdLen# AND SMM.MDSE_CD = MIFS.MDSE_CD)
                                     OR
                                  (LENGTH(MIFS.MDSE_CD) &lt;= #mdseCdLen# AND SMM.MDSE_CD LIKE MIFS.MDSE_CD || '%')
                              )
                      )
                      THEN FLP.MDSE_CD
-->
<!-- END 2021/11/09 L.Mandanas [QC#59114, ADD] -->
<!-- END 2021/11/12 L.Mandanas [QC#59114, DEL] -->
                      END
<!-- END 2021/10/18 L.Mandanas [QC#59114, ADD] -->
<!-- START 2018/06/01 U.Kim [QC#22393, ADD] -->
                AND SMM.GLBL_CMPY_CD          = SMMS.GLBL_CMPY_CD
                AND SMM.SVC_MACH_MSTR_STS_CD  = SMMS.SVC_MACH_MSTR_STS_CD
                AND SMMS.EZCANCELFLAG         = '0'
<!-- END 2018/06/01 U.Kim [QC#22393, ADD] -->
                <!-- START 2021/12/20 Y.Penequito [QC#59114, MOD] -->
                <!-- AND RNG.EZCANCELFLAG          = '0' -->
                AND SMM.EZCANCELFLAG          = '0'
                <!-- AND MDT.EZCANCELFLAG          = '0'
                AND RNG.GLBL_CMPY_CD          = STS.GLBL_CMPY_CD(+)
                AND RNG.SVC_MOD_DTL_PK        = STS.SVC_MOD_DTL_PK(+) -->
                AND RNG_GLBL_CMPY_CD          = STS.GLBL_CMPY_CD(+)
                AND RNG_SVC_MOD_DTL_PK        = STS.SVC_MOD_DTL_PK(+)
                <!-- END 2021/12/20 Y.Penequito [QC#59114, MOD] -->
                AND STS.SVC_TASK_NUM(+)       IS NULL
                AND STS.SVC_MACH_MSTR_PK(+)   = SMM.SVC_MACH_MSTR_PK
                AND STS.EZCANCELFLAG(+)       = '0'
                <!-- START 2016/04/26 [QC#11681, MOD] -->
                <isEqual property="xxChkBox_OR" compareValue="Y">
                    <isNotNull property="mdseCd">
                    AND (
                        SMM.MDSE_CD &gt;= #mdseCd#
                    <isNotNull property="serNum">
                     OR SMM.SER_NUM &gt;= #serNum#)
                    </isNotNull>
                    <isNull property="serNum">
                     )
                    </isNull>
                    </isNotNull>

                    <isNull property="mdseCd">
                    <isNotNull property="serNum">
                    AND SMM.SER_NUM &gt;= #serNum#
                    </isNotNull>
                    </isNull>
                </isEqual>
                <isNull property="xxChkBox_OR">
                    <isNotNull property="mdseCd">
                    AND SMM.MDSE_CD &gt;= #mdseCd#
                    </isNotNull>
                    <isNotNull property="serNum">
                    AND SMM.SER_NUM &gt;= #serNum#
                    </isNotNull>
                </isNull>
                <!-- END 2016/04/26 [QC#11681, MOD] -->
                <!-- START 2016/07/06 [QC#11349, ADD] -->
                AND NOT EXISTS (
                            SELECT
                                1
                            FROM
                                SVC_MOD_STS SMS
                            WHERE
                                    SMS.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
                                AND SMS.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                                <!-- START 2017/10/23 [QC#21793, ADD] -->
                                AND SMS.SVC_MOD_PK       = #svcModPk#
                                <!-- END 2017/10/23 [QC#21793, ADD] -->
                                AND SMS.SVC_TASK_NUM     IS NOT NULL
                                AND SMS.EZCANCELFLAG     = '0'
                                <!-- START 2022/06/03 E.Sanchez [QC#59930, ADD] -->
                                AND (SMS.SVC_MOD_STS_PK  = STS.SVC_MOD_STS_PK
                                    OR STS.SVC_MOD_STS_PK IS NULL)
                                <!-- END 2022/06/03 E.Sanchez [QC#59930, ADD] -->
                                )
                <!-- END 2016/07/06 [QC#11349, ADD] -->
        )
        WHERE
        <!-- START 2018/06/01 U.Kim [QC#22393, MOD] -->
        <!-- ROWNUM &lt;= #limitCnt# -->
                1 = 1
        <isNotNull property="svcMachMstrStsCd">
            AND SVC_MACH_MSTR_STS_CD = #svcMachMstrStsCd#
        </isNotNull>
        <isNotNull property="svcModProcStsCd">
            AND SVC_MOD_PROC_STS_CD = #svcModProcStsCd#
        </isNotNull>
        <!-- END 2018/06/01 U.Kim [QC#22393, MOD] -->
        ORDER BY
        <!-- START 2018/06/01 U.Kim [QC#22393, MOD] -->
        <!-- MDSE_CD ASC -->
             SVC_MOD_PROC_STS_SORT_NUM ASC
            ,MOD_DPLY_SORT_NUM ASC
            ,MDSE_CD ASC
        <!-- END 2018/06/01 U.Kim [QC#22393, MOD] -->
            ,SER_NUM ASC
        <!-- START 2018/06/01 U.Kim [QC#22393, ADD] -->
        )
        <!-- START 2022/09/08 E. Sanchez [QC#60527, DEL] -->
        <!-- WHERE
             ROWNUM &lt;= #limitCnt# -->
        <!-- END 2022/09/08 E. Sanchez [QC#60527, DEL] -->
        <!-- END 2018/06/01 U.Kim [QC#22393, ADD] -->
    </statement>
    <resultMap id="result.getDtlInfo" class="NSBL0440_ASMsg">
        <result property="svcModStsPk_A"           column="SVC_MOD_STS_PK"             javaType="EZDCBigDecimalItem" />
        <result property="mdseCd_A"                column="MDSE_CD"                    javaType="EZDCStringItem" />
        <result property="serNum_A"                column="SER_NUM"                    javaType="EZDCStringItem" />
<!-- START 2018/06/01 U.Kim [QC#22393, ADD] -->
        <result property="svcMachMstrStsDescTxt_A" column="SVC_MACH_MSTR_STS_DESC_TXT" javaType="EZDCStringItem" />
<!-- END 2018/06/01 U.Kim [QC#22393, ADD] -->
        <result property="svcModProcStsCd_A"       column="SVC_MOD_PROC_STS_CD"        javaType="EZDCStringItem" />
        <result property="svcModProcStsDescTxt_A"  column="SVC_MOD_PROC_STS_DESC_TXT"  javaType="EZDCStringItem" />
        <result property="svcTaskNum_A"            column="SVC_TASK_NUM"               javaType="EZDCStringItem" />
        <result property="svcTaskCloDt_A"          column="SVC_TASK_CLO_DT"            javaType="EZDCStringItem" />
        <result property="svcModOptCd_A"           column="SVC_MOD_OPT_CD"             javaType="EZDCStringItem" />
        <result property="svcModOptDt_A"           column="SVC_MOD_OPT_DT"             javaType="EZDCStringItem" />
        <result property="svcModNoteTxt_A"         column="SVC_MOD_NOTE_TXT"           javaType="EZDCStringItem" />
        <result property="ezUpTime_A"              column="EZUPTIME"                   javaType="EZDCStringItem" />
        <result property="ezUpTimeZone_A"          column="EZUPTIMEZONE"               javaType="EZDCStringItem" />
        <result property="svcModDtlPk_A"           column="SVC_MOD_DTL_PK"             javaType="EZDCBigDecimalItem" />
        <result property="svcMachMstrPk_A"         column="SVC_MACH_MSTR_PK"           javaType="EZDCBigDecimalItem" />
<!-- START 2016/12/02 N.Arai [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_A"       column="XX_REC_HIST_CRAT_TS"        javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_A"     column="XX_REC_HIST_CRAT_BY_NM"     javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_A"        column="XX_REC_HIST_UPD_TS"         javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_A"      column="XX_REC_HIST_UPD_BY_NM"      javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_A"        column="XX_REC_HIST_TBL_NM"         javaType="EZDSStringItem"/>
<!-- END 2016/12/02 N.Arai [QC#14204, ADD] -->
    </resultMap>

<!-- START 2018/02/02 M.Kidokoro [QC#18150, ADD] -->
    <statement id="getDownloadFileData" parameterClass="Map" resultMap="result.getDownloadFileData">
        SELECT
            SER_NUM
           ,SVC_MOD_PLN_ID
           ,T_MDL_NM
           ,SVC_MOD_PROC_STS_DESC_TXT
           ,FLD_SVC_BR_CD
           ,SVC_MNF_MOD_NUM
           ,TECH_NM
           ,SVC_TASK_NUM
           ,SVC_TASK_CLO_DT
           <!-- START 2022/06/03 E.Sanchez [QC#59930, ADD] -->
           ,SVC_MOD_STS_PK
           <!-- END 2022/06/03 E.Sanchez [QC#59930, ADD] -->
           <!-- START 2022/09/08 E.Sanchez [QC#60527, ADD] -->
           ,SVC_MOD_DTL_PK
           <!-- END 2022/09/08 E.Sanchez [QC#60527, ADD] -->
        FROM (
            SELECT
                 SMM.SER_NUM                    AS SER_NUM
                ,SM.SVC_MOD_PLN_ID              AS SVC_MOD_PLN_ID
                ,MN.T_MDL_NM                    AS T_MDL_NM
                ,SMP.SVC_MOD_PROC_STS_DESC_TXT  AS SVC_MOD_PROC_STS_DESC_TXT
                ,SMM.FLD_SVC_BR_CD              AS FLD_SVC_BR_CD
                ,SMD.SVC_MNF_MOD_NUM            AS SVC_MNF_MOD_NUM
                ,TM.TECH_NM                     AS TECH_NM
                ,SMS.SVC_TASK_NUM               AS SVC_TASK_NUM
                ,STK.SVC_TASK_CLO_DT            AS SVC_TASK_CLO_DT
                <!-- START 2022/06/03 E.Sanchez [QC#59930, ADD] -->
                ,SMS.SVC_MOD_STS_PK             AS SVC_MOD_STS_PK
                <!-- END 2022/06/03 E.Sanchez [QC#59930, ADD] -->
                <!-- START 2022/09/08 E.Sanchez [QC#60527, ADD] -->
                ,SMD.SVC_MOD_DTL_PK             AS SVC_MOD_DTL_PK
                <!-- END 2022/09/08 E.Sanchez [QC#60527, ADD] -->
            FROM
                 SVC_MOD_STS      SMS
                ,SVC_MACH_MSTR    SMM
                ,SVC_TASK         STK
                ,SVC_MOD_PROC_STS SMP
                ,SVC_MOD          SM
                ,SVC_CONFIG_MSTR  SCM
                ,MDL_NM           MN
                ,SVC_MOD_DTL      SMD
                ,FSR_VISIT        FV
                ,TECH_MSTR        TM
            WHERE
                    SMS.GLBL_CMPY_CD        = #glblCmpyCd#
                AND SMS.SVC_MOD_PK          = #svcModPk#
                AND SMS.EZCANCELFLAG        = '0'
                AND SMS.GLBL_CMPY_CD        = SMM.GLBL_CMPY_CD
                AND SMS.SVC_MACH_MSTR_PK    = SMM.SVC_MACH_MSTR_PK
                AND SMM.EZCANCELFLAG        = '0'
                AND SMS.GLBL_CMPY_CD        = STK.GLBL_CMPY_CD
                AND SMS.SVC_TASK_NUM        = STK.SVC_TASK_NUM
                AND STK.EZCANCELFLAG        = '0'
                AND SMS.GLBL_CMPY_CD        = SMP.GLBL_CMPY_CD
                AND SMS.SVC_MOD_PROC_STS_CD = SMP.SVC_MOD_PROC_STS_CD
                AND SMP.EZCANCELFLAG        = '0'
                AND SMS.GLBL_CMPY_CD        = SM.GLBL_CMPY_CD
                AND SMS.SVC_MOD_PK          = SM.SVC_MOD_PK
                AND SM.EZCANCELFLAG         = '0'
                AND SMM.GLBL_CMPY_CD        = SCM.GLBL_CMPY_CD
                <!-- START 2022/04/13 L.Mandanas [QC#59930, MOD] -->
                <!-- AND SMM.SVC_CONFIG_MSTR_PK  = SCM.SVC_CONFIG_MSTR_PK  -->
                AND SMM.SVC_MACH_MSTR_PK    = SCM.SVC_MACH_MSTR_PK
                <!-- END 2022/04/13 L.Mandanas [QC#59930, MOD] -->
                AND SCM.EZCANCELFLAG        = '0'
                AND SCM.GLBL_CMPY_CD        = MN.T_GLBL_CMPY_CD
                AND SCM.MDL_ID              = MN.T_MDL_ID
                AND MN.EZCANCELFLAG         = '0'
                AND SMS.GLBL_CMPY_CD        = SMD.GLBL_CMPY_CD(+)
                AND SMS.SVC_MOD_DTL_PK      = SMD.SVC_MOD_DTL_PK(+)
                AND SMD.EZCANCELFLAG(+)     = '0'
                AND STK.GLBL_CMPY_CD        = FV.GLBL_CMPY_CD
                AND STK.FSR_NUM             = FV.FSR_NUM
                AND STK.SVC_TASK_NUM        = FV.SVC_TASK_NUM
                AND FV.EZCANCELFLAG         = '0'
                AND FV.GLBL_CMPY_CD         = TM.GLBL_CMPY_CD(+)
                AND FV.TECH_CD              = TM.TECH_TOC_CD(+)
                AND TM.EZCANCELFLAG(+)      = '0'
                <isEqual property="xxChkBox_OR" compareValue="Y">
                    <isNotNull property="mdseCd">
                    AND (
                        SMM.MDSE_CD &gt;= #mdseCd#
                    <isNotNull property="serNum">
                     OR SMM.SER_NUM &gt;= #serNum#)
                    </isNotNull>
                    <isNull property="serNum">
                     )
                    </isNull>
                    </isNotNull>

                    <isNull property="mdseCd">
                    <isNotNull property="serNum">
                    AND SMM.SER_NUM &gt;= #serNum#
                    </isNotNull>
                    </isNull>
                </isEqual>
                <isNull property="xxChkBox_OR">
                    <isNotNull property="mdseCd">
                    AND SMM.MDSE_CD &gt;= #mdseCd#
                    </isNotNull>
                    <isNotNull property="serNum">
                    AND SMM.SER_NUM &gt;= #serNum#
                    </isNotNull>
                </isNull>
        UNION
            SELECT
                 SMM.SER_NUM                    AS SER_NUM
                ,SM.SVC_MOD_PLN_ID              AS SVC_MOD_PLN_ID
                ,MN.T_MDL_NM                    AS T_MDL_NM
                ,(
                    SELECT
                        SMPS.SVC_MOD_PROC_STS_DESC_TXT
                    FROM
                        SVC_MOD_PROC_STS SMPS
                    WHERE
                            SMPS.GLBL_CMPY_CD           = #glblCmpyCd#
                        AND SMPS.SVC_MOD_PROC_STS_CD    = CASE
                                                            <!-- add start 2019/04/02 QC#31027 -->
                                                            WHEN STS.SVC_MOD_PROC_STS_CD IS NULL AND EXISTS(
                                                                SELECT 1
                                                                FROM
                                                                    SVC_MOD_DTL SMD
                                                                WHERE
                                                                    SMD.GLBL_CMPY_CD    = #glblCmpyCd#
                                                                AND SMD.SVC_MOD_PK      = #svcModPk#
                                                                AND SMD.EZCANCELFLAG    = '0'
                                                                AND (   SMD.SVC_MOD_CANC_DT &lt;= #slsDt#
                                                                     OR SMD.SVC_MOD_OBSL_DT &lt;= #slsDt#)
                                                                AND ((LENGTH(SMD.MDSE_CD) &gt;  #mdseCdLen# AND SMM.MDSE_CD = SMD.MDSE_CD)
                                                                     OR
                                                                     (LENGTH(SMD.MDSE_CD) &lt;= #mdseCdLen# AND SMM.MDSE_CD LIKE SMD.MDSE_CD || '%'))
                                                                UNION
                                                                SELECT 1
                                                                FROM
                                                                    SVC_MOD_DTL SMD
                                                                    ,MDSE_ITEM_FLIP_SET FLP
                                                                WHERE
                                                                    SMD.GLBL_CMPY_CD    = #glblCmpyCd#
                                                                AND SMD.SVC_MOD_PK      = #svcModPk#
                                                                AND SMD.EZCANCELFLAG    = '0'
                                                                AND (   SMD.SVC_MOD_CANC_DT &lt;= #slsDt#
                                                                     OR SMD.SVC_MOD_OBSL_DT &lt;= #slsDt#)
                                                                AND SMD.GLBL_CMPY_CD    = FLP.GLBL_CMPY_CD
                                                                AND SMD.MDSE_CD         = FLP.MDSE_CD
                                                                AND FLP.EZCANCELFLAG    = '0'
                                                                <iterate property="mdseItemRelnTpCdList" var="mdseItemRelnTpCd[]" open="AND FLP.MDSE_ITEM_RELN_TP_CD (+) IN (" close=")" conjunction=",">
                                                                    #mdseItemRelnTpCd[]#
                                                                </iterate>
                                                                AND ((LENGTH(FLP.RELN_MDSE_CD) &gt; #mdseCdLen# AND SMM.MDSE_CD = FLP.RELN_MDSE_CD)
                                                                     OR
                                                                     (LENGTH(FLP.RELN_MDSE_CD) &lt;= #mdseCdLen# AND SMM.MDSE_CD LIKE FLP.RELN_MDSE_CD || '%'))
                                                            )
                                                            THEN #svcModProcStsCd_canc#
                                                            <!-- add end 2019/04/02 QC#31027 -->
                                                            WHEN STS.SVC_MOD_PROC_STS_CD IS NULL
                                                            THEN #svcModProcStsCd_op#
                                                            ELSE STS.SVC_MOD_PROC_STS_CD
                                                          END
                        AND SMPS.EZCANCELFLAG           = '0'
                 )                              AS SVC_MOD_PROC_STS_DESC_TXT
                ,SMM.FLD_SVC_BR_CD              AS FLD_SVC_BR_CD
                ,SMD.SVC_MNF_MOD_NUM            AS SVC_MNF_MOD_NUM
                ,NULL                           AS TECH_NM
                ,NULL                           AS SVC_TASK_NUM
                ,NULL                           AS SVC_TASK_CLO_DT
                <!-- START 2022/06/03 E.Sanchez [QC#59930, ADD] -->
                ,STS.SVC_MOD_STS_PK             AS SVC_MOD_STS_PK
                <!-- END 2022/06/03 E.Sanchez [QC#59930, ADD] -->
                <!-- START 2022/09/08 E.Sanchez [QC#60527, ADD] -->
                ,SMD.SVC_MOD_DTL_PK             AS SVC_MOD_DTL_PK
                <!-- END 2022/09/08 E.Sanchez [QC#60527, ADD] -->
            FROM
                 SVC_MOD_SER_RNG    RNG
                ,SVC_MACH_MSTR      SMM
                ,SVC_MOD_DTL        SMD
                <!-- add start 2019/04/02 QC#31027 -->
                ,MDSE_ITEM_FLIP_SET FLP
                <!-- add end 2019/04/02 QC#31027 -->
                ,SVC_MOD_STS        STS
                ,SVC_MOD            SM
                ,SVC_CONFIG_MSTR    SCM
                ,MDL_NM             MN
            WHERE
                    RNG.GLBL_CMPY_CD           = #glblCmpyCd#
                AND RNG.SVC_MOD_PK             = #svcModPk#
                AND RNG.EZCANCELFLAG           = '0'
                AND RNG.GLBL_CMPY_CD           = SMD.GLBL_CMPY_CD
                AND RNG.SVC_MOD_PK             = SMD.SVC_MOD_PK
                <!-- START 2022/04/13 L.Mandanas [QC#59930, ADD] -->
                AND RNG.SVC_MOD_DTL_PK         = SMD.SVC_MOD_DTL_PK
                <!-- END 2022/04/13 L.Mandanas [QC#59930, ADD] -->
                AND SMD.EZCANCELFLAG           = '0'
                AND RNG.GLBL_CMPY_CD           = SMM.GLBL_CMPY_CD
                AND RNG.SVC_MOD_FROM_SER_NUM  &lt;= SMM.SER_NUM 
                AND RNG.SVC_MOD_TO_SER_NUM    &gt;= SMM.SER_NUM 
                AND RNG.LG_SER_NUM             = LENGTH(SMM.SER_NUM)
                <!-- add start 2019/04/02 QC#31027 -->
                AND SMD.GLBL_CMPY_CD           = FLP.GLBL_CMPY_CD(+)
                AND SMD.MDSE_CD                = FLP.MDSE_CD(+)
                <iterate property="mdseItemRelnTpCdList" var="mdseItemRelnTpCd[]" open="AND FLP.MDSE_ITEM_RELN_TP_CD(+) IN (" close=")" conjunction=",">
                    #mdseItemRelnTpCd[]#
                </iterate>
                AND FLP.EZCANCELFLAG(+)        = '0'
                <!-- add end 2019/04/02 QC#31027 -->
                AND (
                  (LENGTH(SMD.MDSE_CD) &gt; #mdseCdLen# AND SMM.MDSE_CD = SMD.MDSE_CD)
                    OR
                  (LENGTH(SMD.MDSE_CD) &lt;= #mdseCdLen# AND SMM.MDSE_CD LIKE SMD.MDSE_CD || '%')
                <!-- add start 2019/04/02 QC#31027 -->
                    OR
                  (LENGTH(FLP.RELN_MDSE_CD) &gt; #mdseCdLen# AND SMM.MDSE_CD = FLP.RELN_MDSE_CD)
                    OR
                  (LENGTH(FLP.RELN_MDSE_CD) &lt;= #mdseCdLen# AND SMM.MDSE_CD LIKE FLP.RELN_MDSE_CD || '%')
                <!-- add end 2019/04/02 QC#31027 -->
                )
                AND SMM.EZCANCELFLAG           = '0'
                AND RNG.GLBL_CMPY_CD           = STS.GLBL_CMPY_CD(+)
                AND RNG.SVC_MOD_DTL_PK         = STS.SVC_MOD_DTL_PK(+)
                AND STS.SVC_TASK_NUM(+)        IS NULL
                AND STS.SVC_MACH_MSTR_PK(+)    = SMM.SVC_MACH_MSTR_PK
                AND STS.EZCANCELFLAG(+)        = '0'
                AND RNG.GLBL_CMPY_CD           = SM.GLBL_CMPY_CD
                AND RNG.SVC_MOD_PK             = SM.SVC_MOD_PK
                AND SM.EZCANCELFLAG            = '0'
                <!-- mod start 2019/04/02 QC#31027 -->
                AND RNG.GLBL_CMPY_CD           = SCM.GLBL_CMPY_CD(+)
                AND SMM.SVC_CONFIG_MSTR_PK     = SCM.SVC_CONFIG_MSTR_PK(+)
                AND SCM.EZCANCELFLAG(+)        = '0'
                AND SCM.GLBL_CMPY_CD           = MN.T_GLBL_CMPY_CD(+)
                AND SCM.MDL_ID                 = MN.T_MDL_ID(+)
                AND MN.EZCANCELFLAG(+)         = '0'
                <!-- mod end 2019/04/02 QC#31027 -->
                <isEqual property="xxChkBox_OR" compareValue="Y">
                    <isNotNull property="mdseCd">
                    AND (
                        SMM.MDSE_CD &gt;= #mdseCd#
                    <isNotNull property="serNum">
                     OR SMM.SER_NUM &gt;= #serNum#)
                    </isNotNull>
                    <isNull property="serNum">
                     )
                    </isNull>
                    </isNotNull>

                    <isNull property="mdseCd">
                    <isNotNull property="serNum">
                    AND SMM.SER_NUM &gt;= #serNum#
                    </isNotNull>
                    </isNull>
                </isEqual>
                <isNull property="xxChkBox_OR">
                    <isNotNull property="mdseCd">
                    AND SMM.MDSE_CD &gt;= #mdseCd#
                    </isNotNull>
                    <isNotNull property="serNum">
                    AND SMM.SER_NUM &gt;= #serNum#
                    </isNotNull>
                </isNull>
                AND NOT EXISTS (
                            SELECT
                                1
                            FROM
                                SVC_MOD_STS SMS
                            WHERE
                                    SMS.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
                                AND SMS.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                                AND SMS.SVC_MOD_PK       = #svcModPk#
                                AND SMS.SVC_TASK_NUM     IS NOT NULL
                                AND SMS.EZCANCELFLAG     = '0'
                                <!-- START 2022/06/03 E.Sanchez [QC#59930, ADD] -->
                                AND (SMS.SVC_MOD_STS_PK  = STS.SVC_MOD_STS_PK
                                    OR STS.SVC_MOD_STS_PK IS NULL)
                                <!-- END 2022/06/03 E.Sanchez [QC#59930, ADD] -->
                                )
        )
        WHERE
            ROWNUM &lt;= #limitCnt#
        ORDER BY
            SER_NUM ASC
    </statement>
    <resultMap id="result.getDownloadFileData" class="NSBL0440_ASMsg">
        <result property="serNum_A"                column="SER_NUM"                   javaType="EZDCStringItem" />
        <result property="svcModPlnId_A"           column="SVC_MOD_PLN_ID"            javaType="EZDCStringItem" />
        <result property="t_MdlNm_A"               column="T_MDL_NM"                  javaType="EZDCStringItem" />
        <result property="svcModProcStsDescTxt_A"  column="SVC_MOD_PROC_STS_DESC_TXT" javaType="EZDCStringItem" />
        <result property="fldSvcBrCd_A"            column="FLD_SVC_BR_CD"             javaType="EZDCStringItem" />
        <result property="svcMnfModNum_A"          column="SVC_MNF_MOD_NUM"           javaType="EZDCStringItem" />
        <result property="techNm_A"                column="TECH_NM"                   javaType="EZDCStringItem" />
        <result property="svcTaskNum_A"            column="SVC_TASK_NUM"              javaType="EZDCStringItem" />
        <result property="svcTaskCloDt_A"          column="SVC_TASK_CLO_DT"           javaType="EZDCStringItem" />
        <!-- START 2022/09/08 E.Sanchez [QC#60527, ADD] -->
        <result property="svcModDtlPk_A"           column="SVC_MOD_DTL_PK"            javaType="EZDCBigDecimalItem" />
        <!-- END 2022/09/08 E.Sanchez [QC#60527, ADD] -->
    </resultMap>
<!-- END 2018/02/02 M.Kidokoro [QC#18150, ADD] -->
    <!-- START 2022/09/08 E.Sanchez [QC#60527, ADD] -->
    <statement id="getSvcModSerRng" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            RNG.SVC_MOD_DTL_PK
           ,RNG.SVC_MOD_FROM_SER_NUM
           ,RNG.SVC_MOD_TO_SER_NUM
           ,RNG.LG_SER_NUM
           ,RNG.MDSE_CD
        FROM
            SVC_MOD_SER_RNG RNG
        WHERE
                RNG.GLBL_CMPY_CD                = #glblCmpyCd#
            AND RNG.SVC_MOD_PK                  = #svcModPk#
            AND RNG.EZCANCELFLAG                = '0'
    </statement>
    <!-- END 2022/09/08 E.Sanchez [QC#60527, ADD] -->
</sqlMap>
