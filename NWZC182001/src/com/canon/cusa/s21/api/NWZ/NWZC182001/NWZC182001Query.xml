<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWZC182001Query">

    <statement id="getSvcMachMstrbyPk" parameterClass="Map" resultClass="Map">
        SELECT
            SMM.MDSE_CD
           ,SMM.SER_NUM
           ,SMM.SVC_MACH_MSTR_STS_CD
           ,DOT.DS_ORD_CATG_CD
           ,SMM.DS_ORD_TP_CD
           ,SMM.SVC_MACH_MSTR_PK
        FROM
            SVC_MACH_MSTR  SMM
           ,DS_ORD_TP      DOT
           ,ALL_MDSE_V     AMV
           ,RMA_REQ_TP     RRT
        WHERE
            SMM.SVC_CONFIG_MSTR_PK = #pMsg.svcConfigMstrPk#
        AND SMM.GLBL_CMPY_CD       = #pMsg.glblCmpyCd#
        AND SMM.EZCANCELFLAG       = '0'
        AND SMM.SVC_MACH_MSTR_STS_CD NOT IN  <!-- QC#50156 Add 2019/05/23  -->
        <iterate property="svcMathMstrSts" var="svcMathMstrStsCd[]" open="(" close=")" conjunction=",">
            #svcMathMstrStsCd[]#
        </iterate>
        AND SMM.DS_ORD_TP_CD       = DOT.DS_ORD_TP_CD (+)
        AND SMM.GLBL_CMPY_CD       = DOT.GLBL_CMPY_CD (+)
        AND DOT.EZCANCELFLAG (+)   = '0'
        AND SMM.GLBL_CMPY_CD       = AMV.GLBL_CMPY_CD
        AND SMM.MDSE_CD            = AMV.MDSE_CD
        AND AMV.EZCANCELFLAG       = '0'
        AND AMV.GLBL_CMPY_CD       = RRT.GLBL_CMPY_CD
        AND AMV.RMA_REQ_TP_CD      = RRT.RMA_REQ_TP_CD
        AND RRT.RMA_REQ_TP_CD      = #rmaReqTpCd#
        AND RRT.EZCANCELFLAG       = '0'
        ORDER BY
            SMM.SVC_MACH_TP_CD
            , SMM.SVC_MACH_MSTR_PK
    </statement>
    
    <statement id="getSvcMachMstrInfo" parameterClass="Map" resultClass="Map">
        SELECT 
            SMM_C.MDSE_CD
           ,SMM_C.SER_NUM
           ,SMM_C.SVC_MACH_MSTR_STS_CD
           ,DOT.DS_ORD_CATG_CD
           ,SMM_C.DS_ORD_TP_CD
           ,SMM_C.SVC_CONFIG_MSTR_PK
           ,SMM_C.SVC_MACH_MSTR_PK
        FROM
            SVC_MACH_MSTR  SMM
           ,SVC_MACH_MSTR  SMM_C
           ,DS_ORD_TP      DOT
           ,ALL_MDSE_V     AMV
           ,RMA_REQ_TP     RRT
        WHERE
            SMM.SER_NUM             = #pMsg.serNum#
            <!-- 2016/03/02 ADD START -->
        AND SMM.MDSE_CD          LIKE #pMsg.mdseCd# || '%'
            <!-- 2016/03/02 ADD E N D -->
        AND SMM.GLBL_CMPY_CD        = #pMsg.glblCmpyCd#
        AND SMM.EZCANCELFLAG        = '0'
        AND SMM.SVC_MACH_MSTR_STS_CD NOT IN  <!-- QC#50156 Add 2019/05/23  -->
        <iterate property="svcMathMstrSts" var="svcMathMstrStsCd[]" open="(" close=")" conjunction=",">
            #svcMathMstrStsCd[]#
        </iterate>
        AND SMM.GLBL_CMPY_CD        = SMM_C.GLBL_CMPY_CD
        <!-- 2018/11/29 QC#29340 H.Kumagai Mod Start -->
        AND SMM_C.EZCANCELFLAG        = '0'
        <!-- 2018/11/29 QC#29340 H.Kumagai Mod End -->
        AND SMM.SVC_CONFIG_MSTR_PK  = SMM_C.SVC_CONFIG_MSTR_PK
        AND SMM_C.GLBL_CMPY_CD      = DOT.GLBL_CMPY_CD (+)
        AND SMM_C.DS_ORD_TP_CD      = DOT.DS_ORD_TP_CD (+)
        AND DOT.EZCANCELFLAG (+)    = '0'
        AND SMM_C.GLBL_CMPY_CD      = AMV.GLBL_CMPY_CD
        AND SMM_C.MDSE_CD           = AMV.MDSE_CD
        AND AMV.EZCANCELFLAG        = '0'
        AND AMV.GLBL_CMPY_CD        = RRT.GLBL_CMPY_CD
        AND AMV.RMA_REQ_TP_CD       = RRT.RMA_REQ_TP_CD
        AND RRT.RMA_REQ_TP_CD       = #rmaReqTpCd#
        AND RRT.EZCANCELFLAG        = '0'
        ORDER BY
            SMM.SVC_MACH_TP_CD
            , SMM.SVC_MACH_MSTR_PK
    </statement>
</sqlMap>
