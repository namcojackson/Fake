<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPZC127001">

    <!-- Alias Definition -->
    <typeAlias alias="RMNF_TASKTMsg" type="business.db.RMNF_TASKTMsg" />

    <statement id="getRemanTaskNum" parameterClass="Map" resultClass="BigDecimal">
       SELECT
           MAX(TO_NUMBER(RT.RMNF_TASK_NUM)) AS MAX_NUM
         FROM
           RMNF_TASK RT
         WHERE
               RT.GLBL_CMPY_CD  = #glblCmpyCd#
           AND RT.RMNF_ORD_NUM  = #rmnfOrdNum#
    </statement>

    <statement id="getInvty" parameterClass="Map" resultClass="Map">
        SELECT
             DMI.RTRN_REQ_PRT_FLG
            ,DMI.RTRN_DSPL_TP_CD
            ,NVL(I.INVTY_AVAL_QTY, 0) AS INVTY_AVAL_QTY
          FROM
             MDSE         DMI
            ,INVTY        I
          WHERE
                DMI.GLBL_CMPY_CD  = #glblCmpyCd#
            AND DMI.MDSE_CD       = #mdseCd#
            AND DMI.EZCANCELFLAG  = '0'
            AND DMI.GLBL_CMPY_CD  = I.GLBL_CMPY_CD(+)
            AND DMI.MDSE_CD       = I.MDSE_CD(+) 
            AND I.INVTY_LOC_CD(+) = #invtyLocCd#
            AND I.LOC_STS_CD(+)   = #locStsCd#
            AND I.STK_STS_CD(+)   = #stkStsCd#
            AND I.EZCANCELFLAG(+) = '0'
    </statement>

    <statement id="getRemanTaskPk" parameterClass="Map" resultClass="Map">
        SELECT T.RMNF_TASK_PK
        FROM
            RMNF_TASK T
        WHERE
                T.GLBL_CMPY_CD  = #glblCmpyCd#
            AND T.RMNF_ORD_NUM  = #rmnfOrdNum#
            AND T.RMNF_TASK_NUM = #rmnfTaskNum#
            AND T.EZCANCELFLAG  = '0'
    </statement>
    <statement id="getRemanTaskUsgPk" parameterClass="Map" resultClass="Map">
        SELECT U.RMNF_USG_PK
        FROM
            RMNF_USG U
        WHERE
                U.GLBL_CMPY_CD  = #glblCmpyCd#
            AND U.RMNF_ORD_NUM  = #rmnfOrdNum#
            AND U.RMNF_TASK_NUM = #rmnfTaskNum#
            AND U.EZCANCELFLAG  = '0'
    </statement>

    <statement id="getLaborCost" parameterClass="Map" resultClass="BigDecimal">
         SELECT
            R.RMNF_COST_PER_HOUR_AMT
         FROM
            RMNF_COST_PER_HOUR R
         WHERE
                R.GLBL_CMPY_CD  = #glblCmpyCd#
            AND R.EZCANCELFLAG  = '0'
    </statement>

    <statement id="getPartsUsage" parameterClass="Map" resultClass="Map">
        SELECT
            U.RMNF_USG_PK
           ,U.RMNF_TASK_PK
           ,U.RMNF_ORD_NUM
           ,U.RMNF_TASK_NUM
           ,U.RMNF_USG_LINE_NUM
           ,U.RMNF_INVTY_LOC_CD  AS RMNF_USG_INVTY_LOC_CD
           ,U.RMNF_USG_RTRN_INVTY_LOC_CD
           ,U.RTRN_REQ_PRT_FLG
           ,U.MDSE_CD
           ,U.RMNF_PRT_QTY
           ,U.PRT_UNIT_COST_AMT
           ,U.RMNF_PRT_USG_COST_AMT
           ,U.ASSET_RECOV_COST_AMT
           ,M.RTRN_REQ_PRT_FLG
           ,M.RTRN_DSPL_TP_CD
           ,S.INVTY_LOC_CD
        FROM
            RMNF_USG     U
           ,MDSE         M
           ,RTL_SWH      S
        WHERE
            U.GLBL_CMPY_CD     = #glblCmpyCd#
        AND U.RMNF_ORD_NUM     = #rmnfOrdNum#
        AND U.RMNF_TASK_PK     = #rmnfTaskPk#
        AND U.GLBL_CMPY_CD     = M.GLBL_CMPY_CD
        AND U.MDSE_CD          = M.MDSE_CD
        AND M.GLBL_CMPY_CD     = S.GLBL_CMPY_CD (+)
        AND M.RTRN_DSPL_TP_CD  = S.RTL_SWH_CD (+)
        AND S.RTL_WH_CD (+)    = #rtlWhCd#
        AND U.EZCANCELFLAG     = '0'
        AND M.EZCANCELFLAG     = '0'
        AND S.EZCANCELFLAG (+) = '0'
    </statement>
    <statement id="getShippingPlanForSubmit" parameterClass="Map" resultClass="Map">
        SELECT
            S.SHPG_PLN_NUM
            ,S.TRX_LINE_NUM
            ,S.TRX_LINE_SUB_NUM
        FROM
            SHPG_PLN        S
        WHERE
                S.GLBL_CMPY_CD           = #glblCmpyCd#
            AND S.TRX_SRC_TP_CD          = #trxSrcTpCd#
            AND S.TRX_HDR_NUM            = #trxHdrNum#
            AND S.TRX_LINE_NUM           = #trxLineNum#
            AND S.TRX_LINE_SUB_NUM       = #trxLineSubNum#
            AND S.EZCANCELFLAG           = '0'
    </statement>
    <statement id="getWmsAdjInfo" parameterClass="Map" resultClass="Map">
        SELECT
             RO.RMNF_ORD_NUM                AS RMNF_ORD_NUM
            ,RO.WH_LOCTR_CD                 AS WH_LOCTR_CD
            ,RU.MDSE_CD                     AS MDSE_CD
            ,SUM(RU.RMNF_PRT_QTY)           AS RMNF_PRT_QTY
            ,WH.WMS_WH_CD                   AS WMS_WH_CD
            ,WH.RTL_WH_CD || WH.WH_OWNR_CD  AS PACK_CD_TXT
            ,WH.WMS_ADJ_DNLD_INTFC_ID       AS WMS_ADJ_DNLD_INTFC_ID
        FROM
             RMNF_ORD        RO
            ,RMNF_USG        RU
            ,DS_RTL_WH_V     WH
        WHERE
            RO.GLBL_CMPY_CD            = #glblCmpyCd#
        AND RO.RMNF_ORD_NUM            = #rmnfOrdNum#
        AND RO.GLBL_CMPY_CD            = RU.GLBL_CMPY_CD
        AND RO.RMNF_ORD_NUM            = RU.RMNF_ORD_NUM
        AND WH.GLBL_CMPY_CD            = RU.GLBL_CMPY_CD
        AND WH.INVTY_LOC_CD            = RU.RMNF_INVTY_LOC_CD
        AND RO.EZCANCELFLAG            = '0'
        AND RU.EZCANCELFLAG            = '0'
        AND WH.EZCANCELFLAG            = '0'
        GROUP BY
            RO.RMNF_ORD_NUM
           ,RO.WH_LOCTR_CD
           ,RU.MDSE_CD
           ,WH.WMS_WH_CD
           ,WH.RTL_WH_CD||WH.WH_OWNR_CD
           ,WH.WMS_ADJ_DNLD_INTFC_ID
    </statement>
    <statement id="getUnusedParts" parameterClass="Map" resultClass="Map">
        SELECT
            UNUSED_QTY
           ,MDSE_CD
           ,INVTY_LOC_CD
        FROM
            (
                SELECT
                    SUM(R.PRT_RQST_QTY) -
                        (
                            SELECT
                                NVL( SUM(RU.RMNF_PRT_QTY), 0)
                            FROM
                                RMNF_USG RU
                            WHERE
                                    RU.GLBL_CMPY_CD = #glblCmpyCd#
                                AND RU.RMNF_ORD_NUM = #rmnfOrdNum#
                                AND RU.MDSE_CD      = R.MDSE_CD
                                AND RU.EZCANCELFLAG = '0'
                        ) AS UNUSED_QTY
                   ,R.MDSE_CD
                   ,RS.INVTY_LOC_CD
                FROM
                    RMNF_PRT_REQ R
                   ,RMNF_ORD     RO
                   ,RTL_SWH      RS
                WHERE
                    R.GLBL_CMPY_CD         = #glblCmpyCd#
                AND R.RMNF_ORD_NUM         = #rmnfOrdNum#
                AND R.SO_NUM               IS NOT NULL
                AND R.RMNF_PRT_RQST_PROC_CD= #completed#
                AND R.EZCANCELFLAG         = '0'
                AND R.GLBL_CMPY_CD         = RO.GLBL_CMPY_CD
                AND R.RMNF_ORD_NUM         = RO.RMNF_ORD_NUM
                AND RO.EZCANCELFLAG        = '0'
                AND RO.GLBL_CMPY_CD        = RS.GLBL_CMPY_CD
                AND RO.RMNF_USG_RTL_WH_CD  = RS.RTL_WH_CD
                AND RO.RMNF_USG_RTL_SWH_CD = RS.RTL_SWH_CD
                AND RS.EZCANCELFLAG        = '0'
                GROUP BY
                    R.MDSE_CD
                   ,RS.INVTY_LOC_CD
            )
        WHERE
            UNUSED_QTY &gt; 0
    </statement>
    <statement id="getRmnfToCmptMdseCd" parameterClass="Map" resultClass="String">
        SELECT 
            RD.RMNF_TO_CMPT_MDSE_CD
        FROM 
            RMNF_ORD     RO
           ,RMNF_ORD_DTL RD
        WHERE 1 = 1
        AND RO.GLBL_CMPY_CD           = #glblCmpyCd#
        AND RO.RMNF_ORD_NUM           = #rmnfOrdNum#
        AND RO.EZCANCELFLAG           = '0'
        AND RO.RMNF_ORD_NUM           = RD.RMNF_ORD_NUM
        AND RO.RMNF_MAIN_UNIT_MDSE_CD = RD.CMPT_MDSE_CD
        AND RO.GLBL_CMPY_CD           = RD.GLBL_CMPY_CD
        AND RD.EZCANCELFLAG           = '0'
    </statement>
    <statement id="getShippingPlanForPartsUsage" parameterClass="Map" resultClass="Map">
        SELECT
            S.SHPG_PLN_NUM
            ,S.TRX_LINE_NUM
            ,S.TRX_LINE_SUB_NUM
        FROM
            SHPG_PLN        S
        WHERE
                S.GLBL_CMPY_CD           = #glblCmpyCd#
            AND S.TRX_SRC_TP_CD          = #trxSrcTpCd#
            AND S.TRX_HDR_NUM            = #trxHdrNum#
            AND S.TRX_LINE_NUM           = #trxLineNum#
            AND S.TRX_LINE_SUB_NUM       = #trxLineSubNum#
            AND S.EZCANCELFLAG           = '0'
    </statement>
    <statement id="getAssetRecovCostAmt" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            NVL (SUM(RU.ASSET_RECOV_COST_AMT) , 0) AS CAL_ASSET_RECOV_COST_AMT
        FROM 
            RMNF_USG  RU
        WHERE 1=1
        AND RU.EZCANCELFLAG  = '0'
        AND RU.GLBL_CMPY_CD  = #glblCmpyCd#
        AND RMNF_ORD_NUM     = #rmnfOrdNum#

    </statement>
    <statement id="getRmnfPrtUsgCostAmt" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            NVL (SUM( R.RMNF_PRT_QTY * M.THIS_MTH_TOT_STD_COST_AMT) , 0 ) AS CAL_RMNF_PRT_USG_COST_AMT
        FROM
            RMNF_USG R
           ,MDSE     M
        WHERE 1 = 1
        AND R.EZCANCELFLAG  = '0'
        AND R.GLBL_CMPY_CD  = #glblCmpyCd#
        AND R.MDSE_CD       = M.MDSE_CD
        AND R.RMNF_ORD_NUM  = #rmnfOrdNum#
         <isNotNull property="rmnfTaskNum" >
        AND R.RMNF_TASK_NUM = #rmnfTaskNum#
         </isNotNull>
        AND R.GLBL_CMPY_CD  = M.GLBL_CMPY_CD
        AND M.EZCANCELFLAG  = '0'

    </statement>
    <statement id="getRmnTotLborCostAmt" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            NVL (SUM(RT.RMNF_COST_PER_HOUR_AMT * RT.RMNF_LBOR_AOT) , 0 ) AS CAL_RMNF_TOT_LBOR_COST_AMT
        FROM 
            RMNF_TASK RT
        WHERE 1=1
        AND RT.RMNF_ORD_NUM      = #rmnfOrdNum#
        AND RT.GLBL_CMPY_CD      = #glblCmpyCd#
         <isNotNull property="rmnfTaskNum" >
        AND RT.RMNF_TASK_NUM     = #rmnfTaskNum#
         </isNotNull>
        AND RT.RMNF_TASK_STS_CD != #cancel#
        AND RT.EZCANCELFLAG      = '0'
    </statement>
    <statement id="getShippingOrderForSubmit" parameterClass="Map" resultClass="Map">
        SELECT
            S.SO_NUM
           ,S.SO_SLP_NUM
           ,S.MDSE_CD
           ,S.FROM_STK_STS_CD
           ,S.SHPG_QTY
           ,S.INVTY_LOC_CD
        FROM
            SHPG_ORD_DTL     S
        WHERE
            S.GLBL_CMPY_CD = #glblCmpyCd#
        AND S.SO_NUM       = #soNum#
        AND S.EZCANCELFLAG = '0'
        ORDER BY
            S.SO_SLP_NUM
    </statement>
    <statement id="getShippingPlan" parameterClass="Map" resultClass="Map">
        SELECT
            S.SHPG_PLN_NUM
            ,S.TRX_LINE_NUM
        FROM
            SHPG_PLN        S
        WHERE
                S.GLBL_CMPY_CD           = #glblCmpyCd#
            AND S.TRX_SRC_TP_CD          = #trxSrcTpCd#
            AND S.TRX_HDR_NUM            = #trxHdrNum#
            AND S.SHPG_STS_CD            != #shpgStsCd#
            AND S.EZCANCELFLAG           = '0'
    </statement>
</sqlMap>