<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSBB066001">
    <statement id="getInputData" parameterClass="Map" resultClass="Map">
        SELECT
             MODS.MDSE_CD               AS MDSE_CD
            ,MODS.SER_NUM               AS SER_NUM_01
            ,MDLNM.T_MDL_NM             AS T_MDL_NM
            ,MODS.SER_NUM               AS SER_NUM_02
            ,MODS.SVC_CONFIG_MSTR_PK    AS SVC_CONFIG_MSTR_PK
            ,DSMDLG.MDL_GRP_NM          AS MDL_GRP_NM
            ,MOD.SVC_MOD_PLN_ID         AS SVC_MOD_PLN_ID
        FROM
            (
                SELECT
                     SMSR.GLBL_CMPY_CD
                    ,SMSR.SVC_MOD_PK
                    ,MACH.SVC_MACH_MSTR_PK
                    ,MACH.SVC_CONFIG_MSTR_PK
                    ,MACH.MDSE_CD
                    ,MACH.SER_NUM
                FROM
                     SVC_MOD_SER_RNG    SMSR
                    ,SVC_MACH_MSTR      MACH
                WHERE
                        SMSR.GLBL_CMPY_CD           = #glblCmpyCd#
                    AND SMSR.EZUPTIME               &gt; TO_CHAR(TO_TIMESTAMP(ADD_MONTHS(LAST_DAY(TO_DATE(#slsDt#, 'YYYYMMDD')), #addMonth#)), 'YYYYMMDDHH24MISSFF3')
                    AND SMSR.EZUPTIME               &lt; TO_CHAR(TO_TIMESTAMP(TO_DATE(#slsDt#, 'YYYYMMDD') + 1), 'YYYYMMDDHH24MISSFF3')
                    AND SMSR.GLBL_CMPY_CD           = MACH.GLBL_CMPY_CD
                    AND SMSR.SVC_MOD_FROM_SER_NUM   &lt;= MACH.SER_NUM
                    AND SMSR.SVC_MOD_TO_SER_NUM     &gt;= MACH.SER_NUM
                    AND SMSR.LG_SER_NUM             = LENGTH(MACH.SER_NUM)
                    AND SMSR.EZCANCELFLAG           = '0'
                    AND MACH.EZCANCELFLAG           = '0'
            ) MODS
            ,SVC_MOD            MOD
            ,SVC_CONFIG_MSTR    CONF
            ,MDL_NM             MDLNM
            ,DS_MDL             DSMDL
            ,DS_MDL_GRP         DSMDLG
        WHERE
                MODS.GLBL_CMPY_CD       = CONF.GLBL_CMPY_CD
            AND MODS.SVC_MACH_MSTR_PK   = CONF.SVC_MACH_MSTR_PK
            AND CONF.GLBL_CMPY_CD       = MDLNM.T_GLBL_CMPY_CD
            AND CONF.MDL_ID             = MDLNM.T_MDL_ID
            AND CONF.GLBL_CMPY_CD       = DSMDL.GLBL_CMPY_CD
            AND CONF.MDL_ID             = DSMDL.MDL_ID
            AND DSMDL.GLBL_CMPY_CD      = DSMDLG.GLBL_CMPY_CD
            AND DSMDL.MDL_GRP_ID        = DSMDLG.MDL_GRP_ID
            AND MODS.GLBL_CMPY_CD       = MOD.GLBL_CMPY_CD
            AND MODS.SVC_MOD_PK         = MOD.SVC_MOD_PK
            AND MOD.EZCANCELFLAG        = '0'
            AND CONF.EZCANCELFLAG       = '0'
            AND MDLNM.EZCANCELFLAG      = '0'
            AND DSMDL.EZCANCELFLAG      = '0'
            AND DSMDLG.EZCANCELFLAG     = '0'
        ORDER BY
             MODS.MDSE_CD        ASC
            ,MODS.SER_NUM        ASC
            ,MOD.SVC_MOD_PLN_ID  ASC
    </statement>
</sqlMap>
