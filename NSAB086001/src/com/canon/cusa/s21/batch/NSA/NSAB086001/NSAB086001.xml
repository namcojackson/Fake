<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAB086001">
    <statement id="getTargetData" parameterClass="Map" resultClass="Map">
        SELECT
            A.MTR_READ_NTFY_PK
            ,A.CTAC_PSN_FIRST_NM
            ,A.CTAC_PSN_MID_NM
            ,A.CTAC_PSN_LAST_NM
            ,A.CTAC_PSN_EML_ADDR
            ,A.CTAC_PSN_TEL_NUM
            ,A.CTAC_PSN_FAX_NUM
            ,B.DS_CONTR_NUM
            ,B.SER_NUM
            ,B.T_MDL_NM
            ,B.MTR_LB_DESC_TXT
            ,B.READ_MTR_CNT
            ,B.BLLG_SCHD_THRU_DT
            ,C.DS_ACCT_NM
        FROM
            MTR_READ_NTFY A
            ,MTR_READ_NTFY_DTL B
            ,SHIP_TO_CUST C
            ,SVC_MACH_MSTR D
        WHERE
                A.GLBL_CMPY_CD = #glblCmpyCd#
            AND A.EZCANCELFLAG = '0'
            AND (
                    (
                        A.MTR_NTFY_STS_CD = #mtrNtfyStsCd#
                    AND A.MTR_READ_NTFY_SEND_TS IS NULL
                    )
                OR  (
                        A.MTR_NTFY_STS_CD = #mtrNtfyStsCd#
                    AND A.MAN_SEND_FLG    = #manSendFlg#
                    AND (TO_DATE(SUBSTR(A.MTR_READ_NTFY_SEND_TS, 0, 14), #dateFormat#) &lt;= TO_DATE(#salesDate#, #dateFormat#) -1)
                 )
            )
            AND A.MTR_READ_NTFY_PK = B.MTR_READ_NTFY_PK
            AND A.GLBL_CMPY_CD = B.GLBL_CMPY_CD
            AND B.EZCANCELFLAG = '0'
            AND C.EZCANCELFLAG = '0'
            AND B.GLBL_CMPY_CD = C.GLBL_CMPY_CD
            AND D.EZCANCELFLAG = '0'
            AND B.GLBL_CMPY_CD = D.GLBL_CMPY_CD
            AND B.SVC_MACH_MSTR_PK = D.SVC_MACH_MSTR_PK
            AND C.SHIP_TO_CUST_CD = D.CUR_LOC_NUM
            ORDER BY A.MTR_READ_NTFY_PK,B.DS_CONTR_NUM,B.SER_NUM,B.MTR_LB_CD
    </statement>
</sqlMap>
