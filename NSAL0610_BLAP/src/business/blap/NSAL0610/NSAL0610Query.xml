<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL0610Query">
    <typeAlias alias="NSAL0610_BSMsg"  type="business.blap.NSAL0610.NSAL0610_BSMsg"/>
    <resultMap id="result.getMainData"        class="NSAL0610_BSMsg">
        <result property="dsContrDtlPk_A"          column="DS_CONTR_DTL_PK"              javaType="EZDSBigDecimalItem"/>
        <result property="dsContrDtlTpCd_A"        column="DS_CONTR_DTL_TP_CD"           javaType="EZDSStringItem"/>
        <result property="svcMachMstrPk_A"         column="SVC_MACH_MSTR_PK"             javaType="EZDSBigDecimalItem"/>
        <result property="serNum_A"                column="SER_NUM"                      javaType="EZDSStringItem"/>
        <result property="dsContrBllgMtrPk_A"      column="DS_CONTR_BLLG_MTR_PK"         javaType="EZDSBigDecimalItem"/>
        <result property="mtrLbDescTxt_A"          column="MTR_LB_DESC_TXT"              javaType="EZDSStringItem"/>
        <result property="mtrLbSortNum_A"          column="MTR_LB_SORT_NUM"              javaType="EZDSBigDecimalItem"/>
        <result property="prntDsContrDtlPk_A"      column="PRNT_DS_CONTR_DTL_PK"         javaType="EZDSBigDecimalItem"/>
        <result property="xxDplyByCtrlAncrLvlCd_A" column="XX_DPLY_BY_CTRL_ANCR_LVL_CD"  javaType="EZDSStringItem"/>
        <result property="xxRowNum_A"              column="XX_ROW_NUM"                   javaType="EZDSBigDecimalItem"/>
        <result property="xxBtnFlg_A"              column="XX_BTN_FLG"                   javaType="EZDSStringItem"/>
        <result property="xxDplyCtrlFlg_A"         column="XX_DPLY_CTRL_FLG"             javaType="EZDSStringItem"/>
        <result property="xxSelFlg_A"              column="XX_SEL_FLG"                   javaType="EZDSStringItem"/>
        <result property="xxChkBox_A"              column="XX_CHK_BOX"                   javaType="EZDSStringItem"/>
    </resultMap>
    <statement id="getMainData" parameterClass="Map" resultMap="result.getMainData">
       SELECT
            PRNT_DS_CONTR_DTL_PK
            ,XX_DPLY_BY_CTRL_ANCR_LVL_CD
            ,DS_CONTR_DTL_PK
            ,DS_CONTR_DTL_TP_CD
            ,SVC_MACH_MSTR_PK
            ,SER_NUM
            ,DS_CONTR_BLLG_MTR_PK
            ,MTR_LB_DESC_TXT
            ,MTR_LB_SORT_NUM
            ,XX_BTN_FLG
            ,XX_DPLY_CTRL_FLG
            ,XX_SEL_FLG
            ,XX_CHK_BOX
            ,ROWNUM AS XX_ROW_NUM
        FROM
            (
            --3.2.1.MACHINE and Accessory
            SELECT
                CASE WHEN DTL.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd_Fleet# OR DTL.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd_Agg# THEN 0
                     WHEN DTL.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd_Acc#  THEN PRNT_DS_CONTR_DTL_PK
                    ELSE DTL.DS_CONTR_DTL_PK END AS PRNT_DS_CONTR_DTL_PK
                ,CASE WHEN DTL.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd_Acc# THEN #level_4#
                    ELSE #level_1# END AS XX_DPLY_BY_CTRL_ANCR_LVL_CD
                ,DTL.DS_CONTR_DTL_PK
                ,DTL.DS_CONTR_DTL_TP_CD
                ,MAC.SVC_MACH_MSTR_PK
                ,CASE WHEN DTL.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd_Fleet# THEN DCC.DS_CONTR_CATG_ABBR_NM || '_' || CON.DS_CONTR_NUM
                      WHEN DTL.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd_Agg#   THEN DCC.DS_CONTR_CATG_ABBR_NM || '_' || CON.DS_CONTR_NUM
                      ELSE NVL(MAC.SER_NUM, MAC.SVC_MACH_MSTR_PK)
                 END AS SER_NUM
                ,NULL AS DS_CONTR_BLLG_MTR_PK
                ,NULL AS MTR_LB_DESC_TXT
                ,NULL AS MTR_LB_SORT_NUM
                ,'N' AS XX_BTN_FLG
                ,'Y' AS XX_DPLY_CTRL_FLG
                ,'N' AS XX_SEL_FLG
                ,'N' AS XX_CHK_BOX
            FROM
                DS_CONTR            CON
                ,DS_CONTR_DTL       DTL
                ,DS_CONTR_DTL_TP    DTP
                ,SVC_MACH_MSTR      MAC
                ,DS_CONTR_CATG      DCC
            WHERE
                CON.GLBL_CMPY_CD            = #glblCmpyCd#
                AND CON.DS_CONTR_PK         = #dsContrPk#
                AND CON.EZCANCELFLAG        = '0'
                AND CON.GLBL_CMPY_CD        = DTL.GLBL_CMPY_CD
                AND CON.DS_CONTR_PK         = DTL.DS_CONTR_PK
<!-- START 2017/06/19 Y.Osawa [QC#19256,ADD] -->
                AND DTL.DS_CONTR_DTL_STS_CD  &lt;&gt;    #dsContrDtlStsOrdr#
<!-- END   2017/06/19 Y.Osawa [QC#19256,ADD] -->
                AND DTL.EZCANCELFLAG        = '0'
                AND DTL.GLBL_CMPY_CD        = DTP.GLBL_CMPY_CD
                AND DTL.DS_CONTR_DTL_TP_CD  = DTP.DS_CONTR_DTL_TP_CD
                AND DTP.SVC_PRC_FLG         = #flgOffN#
                AND DTP.EZCANCELFLAG        = '0'
                AND DTL.GLBL_CMPY_CD        = MAC.GLBL_CMPY_CD(+)
                AND DTL.SVC_MACH_MSTR_PK    = MAC.SVC_MACH_MSTR_PK(+)
                AND MAC.EZCANCELFLAG(+)     = '0'
                AND CON.GLBL_CMPY_CD        = DCC.GLBL_CMPY_CD(+)
                AND CON.DS_CONTR_CATG_CD    = DCC.DS_CONTR_CATG_CD(+)
                AND DCC.EZCANCELFLAG(+)     = '0'
            --3.2.2.Main MACHINE  Base Chage
            UNION ALL
            SELECT
                CASE WHEN DTL.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd_Fleet# OR DTL.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd_Agg# THEN 0
                     WHEN DTL.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd_Acc#  THEN PRNT_DS_CONTR_DTL_PK
                    ELSE DTL.DS_CONTR_DTL_PK END AS PRNT_DS_CONTR_DTL_PK
                ,#level_2# AS XX_DPLY_BY_CTRL_ANCR_LVL_CD
                ,DTL.DS_CONTR_DTL_PK
                ,DTL.DS_CONTR_DTL_TP_CD
                ,MAC.SVC_MACH_MSTR_PK
                ,MAC.SER_NUM
                ,NULL AS DS_CONTR_BLLG_MTR_PK
                ,#mtrLb_Base# AS MTR_LB_DESC_TXT
                ,NULL AS MTR_LB_SORT_NUM
                ,'N' AS XX_BTN_FLG
                ,'N' AS XX_DPLY_CTRL_FLG
                ,'N' AS XX_SEL_FLG
                ,'N' AS XX_CHK_BOX
            FROM
                DS_CONTR            CON
                ,DS_CONTR_DTL       DTL
                ,SVC_MACH_MSTR      MAC
                ,DS_CONTR_DTL_TP    DTP
            WHERE
                CON.GLBL_CMPY_CD            = #glblCmpyCd#
                AND CON.DS_CONTR_PK         = #dsContrPk#
                AND CON.EZCANCELFLAG        = '0'
                AND CON.GLBL_CMPY_CD        = DTL.GLBL_CMPY_CD
                AND CON.DS_CONTR_PK         = DTL.DS_CONTR_PK
                AND DTL.EZCANCELFLAG        = '0'
                AND DTL.DS_CONTR_DTL_TP_CD  &lt;&gt; #dsContrDtlTpCd_Acc#
<!-- START 2017/06/19 Y.Osawa [QC#19256,ADD] -->
                AND DTL.DS_CONTR_DTL_STS_CD  &lt;&gt;    #dsContrDtlStsOrdr#
<!-- END   2017/06/19 Y.Osawa [QC#19256,ADD] -->
                AND DTL.GLBL_CMPY_CD        = MAC.GLBL_CMPY_CD(+)
                AND DTL.SVC_MACH_MSTR_PK    = MAC.SVC_MACH_MSTR_PK(+)
                AND MAC.EZCANCELFLAG(+)     = '0'
                AND DTL.GLBL_CMPY_CD        = DTP.GLBL_CMPY_CD
                AND DTL.DS_CONTR_DTL_TP_CD  = DTP.DS_CONTR_DTL_TP_CD
                AND DTP.EZCANCELFLAG        = '0'
                AND DTP.BASE_CHRG_FLG       = 'Y'
            --3.2.3.Main MACHINE  Usage Chage
            UNION ALL
            SELECT
                CASE WHEN DTL.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd_Fleet# OR DTL.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd_Agg# THEN 0
                     WHEN DTL.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd_Acc#  THEN PRNT_DS_CONTR_DTL_PK
                    ELSE DTL.DS_CONTR_DTL_PK END AS PRNT_DS_CONTR_DTL_PK
                ,#level_3# AS XX_DPLY_BY_CTRL_ANCR_LVL_CD
                ,DTL.DS_CONTR_DTL_PK
                ,DTL.DS_CONTR_DTL_TP_CD
                ,MAC.SVC_MACH_MSTR_PK
                ,MAC.SER_NUM
                ,DS_CONTR_BLLG_MTR_PK
                ,MTR_LB_DESC_TXT
                ,MTR_LB_SORT_NUM
                ,'N' AS XX_BTN_FLG
                ,'N' AS XX_DPLY_CTRL_FLG
                ,'N' AS XX_SEL_FLG
                ,'N' AS XX_CHK_BOX
            FROM
                DS_CONTR            CON
                ,DS_CONTR_DTL       DTL
                ,SVC_MACH_MSTR      MAC
                ,DS_CONTR_DTL_TP    DTP
                ,DS_CONTR_BLLG_MTR  BMT
                ,MTR_LB             MLB
            WHERE
                CON.GLBL_CMPY_CD            = #glblCmpyCd#
                AND CON.DS_CONTR_PK         = #dsContrPk#
                AND CON.EZCANCELFLAG        = '0'
                AND CON.GLBL_CMPY_CD        = DTL.GLBL_CMPY_CD
                AND CON.DS_CONTR_PK         = DTL.DS_CONTR_PK
                AND DTL.EZCANCELFLAG        = '0'
<!-- START 2017/06/19 Y.Osawa [QC#19256,ADD] -->
                AND DTL.DS_CONTR_DTL_STS_CD  &lt;&gt;    #dsContrDtlStsOrdr#
<!-- END   2017/06/19 Y.Osawa [QC#19256,ADD] -->
                AND DTL.GLBL_CMPY_CD        = MAC.GLBL_CMPY_CD(+)
                AND DTL.SVC_MACH_MSTR_PK    = MAC.SVC_MACH_MSTR_PK(+)
                AND MAC.EZCANCELFLAG(+)     = '0'
                AND DTL.GLBL_CMPY_CD        = DTP.GLBL_CMPY_CD
                AND DTL.DS_CONTR_DTL_TP_CD  = DTP.DS_CONTR_DTL_TP_CD
                AND DTP.EZCANCELFLAG        = '0'
                AND DTP.USG_CHRG_FLG        = 'Y'
                AND DTL.GLBL_CMPY_CD        = BMT.GLBL_CMPY_CD
                AND DTL.DS_CONTR_DTL_PK     = BMT.DS_CONTR_DTL_PK
                AND BMT.EZCANCELFLAG        = '0'
                AND BMT.GLBL_CMPY_CD        = MLB.GLBL_CMPY_CD
                AND BMT.BLLG_MTR_LB_CD      = MLB.MTR_LB_CD
                AND MLB.EZCANCELFLAG        ='0'
            -- 3.2.4.Accessory Base Chage
            UNION ALL
            SELECT
                DTL.PRNT_DS_CONTR_DTL_PK AS PRNT_DS_CONTR_DTL_PK
                ,#level_5# AS XX_DPLY_BY_CTRL_ANCR_LVL_CD
                ,DTL.DS_CONTR_DTL_PK
                ,DTL.DS_CONTR_DTL_TP_CD
                ,MAC.SVC_MACH_MSTR_PK
                ,MAC.SER_NUM
                ,NULL AS DS_CONTR_BLLG_MTR_PK
                ,#mtrLb_Base# AS MTR_LB_DESC_TXT
                ,NULL AS MTR_LB_SORT_NUM
                ,'N' AS XX_BTN_FLG
                ,'N' AS XX_DPLY_CTRL_FLG
                ,'N' AS XX_SEL_FLG
                ,'N' AS XX_CHK_BOX
            FROM
                DS_CONTR            CON
                ,DS_CONTR_DTL       DTL
                ,SVC_MACH_MSTR      MAC
            WHERE
                CON.GLBL_CMPY_CD            = #glblCmpyCd#
                AND CON.DS_CONTR_PK         = #dsContrPk#
                AND CON.EZCANCELFLAG        = '0'
                AND CON.GLBL_CMPY_CD        = DTL.GLBL_CMPY_CD
                AND CON.DS_CONTR_PK         = DTL.DS_CONTR_PK
                AND DTL.DS_CONTR_DTL_TP_CD  = #dsContrDtlTpCd_Acc#
                AND DTL.EZCANCELFLAG        = '0'
<!-- START 2017/06/19 Y.Osawa [QC#19256,ADD] -->
                AND DTL.DS_CONTR_DTL_STS_CD  &lt;&gt;    #dsContrDtlStsOrdr#
<!-- END   2017/06/19 Y.Osawa [QC#19256,ADD] -->
                AND DTL.GLBL_CMPY_CD        = MAC.GLBL_CMPY_CD
                AND DTL.SVC_MACH_MSTR_PK    = MAC.SVC_MACH_MSTR_PK
                AND MAC.EZCANCELFLAG        = '0'
            ORDER BY
                PRNT_DS_CONTR_DTL_PK
                ,XX_DPLY_BY_CTRL_ANCR_LVL_CD
                ,MTR_LB_SORT_NUM
            )
        WHERE
            ROWNUM &lt;= #limitNum#
    </statement>

    <statement id="getTodayMaxSeq" parameterClass="Map"  resultClass="Integer">
        SELECT
            NVL(MAX(DS_CONTR_INTFC_BAT_SQ),0) AS MAX_SEQ
        FROM
            DS_CONTR_INTFC
        WHERE
            GLBL_CMPY_CD            = #glblCmpyCd#
            AND DS_CONTR_INTFC_DT   = #slsDt#
            AND EZCANCELFLAG        = '0'
    </statement>
        
    <statement id="getContractIfData" parameterClass="Map" resultClass="Map">
        SELECT
            CON.DS_CONTR_SRC_TP_CD
            ,CON.DS_ACCT_NUM
            ,DTL.BASE_BILL_TO_CUST_CD AS BILL_TO_CUST_CD
            ,BIL.LOC_NUM
            ,CON.BASE_CHRG_TO_LEASE_CMPY_FLG
            ,CON.USG_CHRG_TO_LEASE_CMPY_FLG
            ,CON.LEASE_CMPY_CD
            ,CON.DS_CONTR_CATG_CD
            ,CON.DS_CONTR_STS_CD
            ,DTL.SVC_MACH_MSTR_PK
            ,CON.SVC_CONTR_BR_CD
            ,CON.TOC_CD
            ,CON.CUST_PO_NUM
            ,CON.PO_DT
            ,CRC.CR_CARD_CUST_REF_NUM
            ,CRC.CR_CARD_EXPR_YR_MTH
            ,CON.CONTR_AUTO_RNW_TP_CD
            ,CON.RNW_PRC_METH_CD
            ,RNE.BEF_END_RNW_DAYS_AOT
            ,CON.BASE_PRC_UP_RATIO AS RNW_PRC_UP_RATIO
            ,CON.CONTR_UPLFT_TP_CD
            ,CON.UPLFT_PRC_METH_CD
            ,RNE.UPLFT_BASE_PRC_UP_RATIO AS UPLFT_PRC_UP_RATIO
            ,DTL.SVC_MACH_MSTR_PK
            ,MAC.MDSE_CD
            ,MAC.SER_NUM
            ,MDL.T_MDL_ID
            ,MDL.T_MDL_NM
            ,DTL.BASE_BLLG_CYCLE_CD AS BLLG_CYCLE_CD
            ,NULL AS BLLG_MTR_LB_NM
            ,NULL AS BLLG_MTR_LB_CD
            ,NULL AS XS_CHRG_TP_CD
            ,NULL AS MTR_READ_METH_CD
            ,NULL AS BLLG_ROLL_OVER_RATIO
            ,DTL.BASE_PRC_DEAL_AMT
            ,DTL.BASE_PRC_TERM_DEAL_AMT_RATE
            ,CON.DS_CONTR_CLS_CD
            ,DTL.CTAC_PSN_PK
            ,RTRIM(CPS.CTAC_PSN_FIRST_NM || ' ' || CPS.CTAC_PSN_LAST_NM) AS CTAC_PSN_NM
            ,CON.MTR_EST_TP_CD
            ,CON.PRC_ALLOC_BY_MACH_QTY_FLG
            ,CON.SVC_PGM_MDSE_CD
            ,CON.INV_SEPT_BASE_USG_FLG
            ,CON.PMT_TERM_CASH_DISC_CD
            ,CON.SVC_LINE_BIZ_CD
            ,DTL.CONTR_CLO_DAY
            ,DTL.CONTR_BLLG_DAY
            ,DTL.BASE_BLLG_TMG_CD AS BLLG_TMG_CD
            ,CON.DS_CONTR_EDI_CD
            ,NULL AS MTR_LB_SORT_NUM
            ,#ifDtlTpBase# AS CONTR_INTFC_DTL_TP_CD
            ,NULL AS XS_MTR_COPY_QTY
            ,NULL AS XS_MTR_AMT_RATE
        FROM
            DS_CONTR                CON
            ,DS_CONTR_DTL           DTL
            ,SVC_MACH_MSTR          MAC
            ,SVC_CONFIG_MSTR        CFG
            ,MDL_NM                 MDL
            ,CTAC_PSN               CPS
            ,DS_CONTR_RNW_ESCL      RNE
            ,DS_CONTR_CR_CARD_PO    CRC
            ,BILL_TO_CUST           BIL
        WHERE
            CON.GLBL_CMPY_CD            = #glblCmpyCd#
            AND CON.DS_CONTR_PK         = #dsContrPk#
            AND CON.EZCANCELFLAG        = '0'
            AND CON.GLBL_CMPY_CD        = DTL.GLBL_CMPY_CD
            AND CON.DS_CONTR_PK         = DTL.DS_CONTR_PK
            AND DTL.DS_CONTR_DTL_PK     = #dsContrDtlPk#
           <isNotNull property="dsContrDtlTp">
            AND DTL.DS_CONTR_DTL_TP_CD  = #dsContrDtlTp#
           </isNotNull>
            AND CON.EZCANCELFLAG        = DTL.EZCANCELFLAG
            AND DTL.GLBL_CMPY_CD        = MAC.GLBL_CMPY_CD(+)
            AND DTL.SVC_MACH_MSTR_PK    = MAC.SVC_MACH_MSTR_PK(+)
            AND DTL.EZCANCELFLAG        = MAC.EZCANCELFLAG(+)
            AND MAC.GLBL_CMPY_CD        = CFG.GLBL_CMPY_CD(+)
            AND MAC.SVC_CONFIG_MSTR_PK  = CFG.SVC_CONFIG_MSTR_PK(+)
            AND MAC.EZCANCELFLAG        = CFG.EZCANCELFLAG(+)
            AND CFG.GLBL_CMPY_CD        = MDL.T_GLBL_CMPY_CD(+)
            AND CFG.MDL_ID              = MDL.T_MDL_ID(+)
            AND CFG.EZCANCELFLAG        = MDL.EZCANCELFLAG(+)
            AND DTL.GLBL_CMPY_CD        = CPS.GLBL_CMPY_CD(+)
            AND DTL.CTAC_PSN_PK         = CPS.CTAC_PSN_PK(+)
            AND DTL.EZCANCELFLAG        = CPS.EZCANCELFLAG(+)
           <isNull property="dsContrDtlTp">
            AND EXISTS(SELECT * FROM DS_CONTR_DTL_TP DTP
                            WHERE DTP.GLBL_CMPY_CD = DTL.GLBL_CMPY_CD
                                AND DTP.DS_CONTR_DTL_TP_CD = DTL.DS_CONTR_DTL_TP_CD
                                AND DTP.EZCANCELFLAG = DTL.EZCANCELFLAG
                                AND DTP.BASE_CHRG_FLG ='Y'
                                AND MAIN_UNIT_LINE_FLG ='Y'  )
           </isNull>
            AND DTL.GLBL_CMPY_CD        = RNE.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK         = RNE.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK     = RNE.DS_CONTR_DTL_PK(+)
            AND DTL.EZCANCELFLAG        = RNE.EZCANCELFLAG(+)
            AND RNE.DS_CONTR_MACH_LVL_NUM(+) = #level3#
            AND RNE.DS_CONTR_BASE_USG_NM(+)  = #base#
            AND DTL.GLBL_CMPY_CD        = CRC.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK         = CRC.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK     = CRC.DS_CONTR_DTL_PK(+)
            AND DTL.EZCANCELFLAG        = CRC.EZCANCELFLAG(+)
            AND CRC.DS_CONTR_BLLG_MTR_PK(+)  IS NULL
            AND CRC.DS_CONTR_MACH_LVL_NUM(+) = #level3#
            AND DTL.GLBL_CMPY_CD        = BIL.GLBL_CMPY_CD(+)
            AND DTL.BASE_BILL_TO_CUST_CD = BIL.BILL_TO_CUST_CD(+)
            AND DTL.EZCANCELFLAG        = BIL.EZCANCELFLAG(+)
        UNION ALL
        SELECT
            CON.DS_CONTR_SRC_TP_CD
            ,CON.DS_ACCT_NUM
            ,DTL.USG_BILL_TO_CUST_CD AS BILL_TO_CUST_CD
            ,BIL.LOC_NUM
            ,CON.BASE_CHRG_TO_LEASE_CMPY_FLG
            ,CON.USG_CHRG_TO_LEASE_CMPY_FLG
            ,CON.LEASE_CMPY_CD
            ,CON.DS_CONTR_CATG_CD
            ,CON.DS_CONTR_STS_CD
            ,DTL.SVC_MACH_MSTR_PK
            ,CON.SVC_CONTR_BR_CD
            ,CON.TOC_CD
            ,CON.CUST_PO_NUM
            ,CON.PO_DT
            ,CRC.CR_CARD_CUST_REF_NUM
            ,CRC.CR_CARD_EXPR_YR_MTH
            ,CON.CONTR_AUTO_RNW_TP_CD
            ,CON.RNW_PRC_METH_CD
            ,RNE.BEF_END_RNW_DAYS_AOT
            ,CON.MTR_PRC_UP_RATIO AS RNW_PRC_UP_RATIO
            ,CON.CONTR_UPLFT_TP_CD
            ,CON.UPLFT_PRC_METH_CD
            ,RNE.UPLFT_MTR_PRC_UP_RATIO AS UPLFT_PRC_UP_RATIO
            ,DTL.SVC_MACH_MSTR_PK
            ,MAC.MDSE_CD
            ,MAC.SER_NUM
            ,MDL.T_MDL_ID
            ,MDL.T_MDL_NM
            ,DTL.MTR_BLLG_CYCLE_CD AS BLLG_CYCLE_CD
            ,MLB.MTR_LB_NM AS BLLG_MTR_LB_NM
            ,BMT.BLLG_MTR_LB_CD
            ,BMT.XS_CHRG_TP_CD
            ,DTL.MTR_READ_METH_CD
            ,BMT.BLLG_ROLL_OVER_RATIO
            ,NULL AS BASE_PRC_DEAL_AMT
            ,NULL AS BASE_PRC_TERM_DEAL_AMT_RATE
            ,CON.DS_CONTR_CLS_CD
            ,DTL.CTAC_PSN_PK
            ,RTRIM(CPS.CTAC_PSN_FIRST_NM || ' ' || CPS.CTAC_PSN_LAST_NM) AS CTAC_PSN_NM
            ,CON.MTR_EST_TP_CD
            ,CON.PRC_ALLOC_BY_MACH_QTY_FLG
            ,CON.SVC_PGM_MDSE_CD
            ,CON.INV_SEPT_BASE_USG_FLG
            ,CON.PMT_TERM_CASH_DISC_CD
            ,CON.SVC_LINE_BIZ_CD
            ,DTL.CONTR_CLO_DAY
            ,DTL.CONTR_BLLG_DAY
            ,DTL.MTR_BLLG_TMG_CD AS BLLG_TMG_CD
            ,CON.DS_CONTR_EDI_CD
            ,MLB.MTR_LB_SORT_NUM
            ,#ifDtlTpUsage# AS CONTR_INTFC_DTL_TP_CD
            ,XSC.XS_MTR_COPY_QTY
            ,XSC.XS_MTR_AMT_RATE
        FROM
            DS_CONTR                CON
            ,DS_CONTR_DTL           DTL
            ,SVC_MACH_MSTR          MAC
            ,SVC_CONFIG_MSTR        CFG
            ,MDL_NM                 MDL
            ,CTAC_PSN               CPS
            ,DS_CONTR_RNW_ESCL      RNE
            ,DS_CONTR_CR_CARD_PO    CRC
            ,BILL_TO_CUST           BIL
            ,DS_CONTR_BLLG_MTR      BMT
            ,MTR_LB                 MLB
            ,CONTR_XS_COPY          XSC
        WHERE
            CON.GLBL_CMPY_CD            = #glblCmpyCd#
            AND CON.DS_CONTR_PK         = #dsContrPk#
            AND CON.EZCANCELFLAG        = '0'
            AND CON.GLBL_CMPY_CD        = DTL.GLBL_CMPY_CD
            AND CON.DS_CONTR_PK         = DTL.DS_CONTR_PK
            AND DTL.DS_CONTR_DTL_PK     = #dsContrDtlPk#
           <isNotNull property="dsContrDtlTp">
            AND DTL.DS_CONTR_DTL_TP_CD  = #dsContrDtlTp#
           </isNotNull>
            AND CON.EZCANCELFLAG        = DTL.EZCANCELFLAG
            AND DTL.GLBL_CMPY_CD        = MAC.GLBL_CMPY_CD(+)
            AND DTL.SVC_MACH_MSTR_PK    = MAC.SVC_MACH_MSTR_PK(+)
            AND DTL.EZCANCELFLAG        = MAC.EZCANCELFLAG(+)
            AND MAC.GLBL_CMPY_CD        = CFG.GLBL_CMPY_CD(+)
            AND MAC.SVC_CONFIG_MSTR_PK  = CFG.SVC_CONFIG_MSTR_PK(+)
            AND MAC.EZCANCELFLAG        = CFG.EZCANCELFLAG(+)
            AND CFG.GLBL_CMPY_CD        = MDL.T_GLBL_CMPY_CD(+)
            AND CFG.MDL_ID              = MDL.T_MDL_ID(+)
            AND CFG.EZCANCELFLAG        = MDL.EZCANCELFLAG(+)
            AND DTL.GLBL_CMPY_CD        = CPS.GLBL_CMPY_CD(+)
            AND DTL.CTAC_PSN_PK         = CPS.CTAC_PSN_PK(+)
            AND DTL.EZCANCELFLAG        = CPS.EZCANCELFLAG(+)
           <isNull property="dsContrDtlTp">
            AND EXISTS(SELECT * FROM DS_CONTR_DTL_TP DTP
                            WHERE DTP.GLBL_CMPY_CD = DTL.GLBL_CMPY_CD
                                AND DTP.DS_CONTR_DTL_TP_CD = DTL.DS_CONTR_DTL_TP_CD
                                AND DTP.EZCANCELFLAG = DTL.EZCANCELFLAG
                                AND DTP.USG_CHRG_FLG ='Y'
                                AND MAIN_UNIT_LINE_FLG ='Y'  )
           </isNull>
            AND DTL.GLBL_CMPY_CD        = RNE.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK         = RNE.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK     = RNE.DS_CONTR_DTL_PK(+)
            AND DTL.EZCANCELFLAG        = RNE.EZCANCELFLAG(+)
            AND RNE.DS_CONTR_MACH_LVL_NUM(+) = #level3#
            AND RNE.DS_CONTR_BASE_USG_NM(+)  = #overage#
            AND DTL.GLBL_CMPY_CD        = CRC.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK         = CRC.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK     = CRC.DS_CONTR_DTL_PK(+)
            AND DTL.EZCANCELFLAG        = CRC.EZCANCELFLAG(+)
            AND CRC.DS_CONTR_BLLG_MTR_PK(+)  = BMT.DS_CONTR_BLLG_MTR_PK
            AND CRC.DS_CONTR_MACH_LVL_NUM(+) = #level3#
            AND DTL.GLBL_CMPY_CD        = BIL.GLBL_CMPY_CD(+)
            AND DTL.USG_BILL_TO_CUST_CD = BIL.BILL_TO_CUST_CD(+)
            AND DTL.EZCANCELFLAG        = BIL.EZCANCELFLAG(+)
            AND DTL.GLBL_CMPY_CD        = BMT.GLBL_CMPY_CD
            AND DTL.DS_CONTR_DTL_PK     = BMT.DS_CONTR_DTL_PK
            AND DTL.EZCANCELFLAG        = BMT.EZCANCELFLAG
            AND BMT.GLBL_CMPY_CD        = MLB.GLBL_CMPY_CD
            AND BMT.BLLG_MTR_LB_CD      = MLB.MTR_LB_CD
            AND BMT.EZCANCELFLAG        = MLB.EZCANCELFLAG
            AND BMT.GLBL_CMPY_CD            = XSC.GLBL_CMPY_CD
            AND BMT.DS_CONTR_BLLG_MTR_PK    = XSC.DS_CONTR_BLLG_MTR_PK
            AND BMT.EZCANCELFLAG            = XSC.EZCANCELFLAG
            AND XSC.XS_MTR_FIRST_FLG        = 'Y'
        ORDER BY 
            MTR_LB_SORT_NUM ASC NULLS FIRST
    </statement>
    
    <statement id="getAccessoriesData" parameterClass="Map" resultClass="Map">
        SELECT
            CON.DS_CONTR_SRC_TP_CD
            ,CON.DS_ACCT_NUM
            ,DTL.BASE_BILL_TO_CUST_CD AS BILL_TO_CUST_CD
            ,BIL.LOC_NUM
            ,CON.BASE_CHRG_TO_LEASE_CMPY_FLG
            ,CON.USG_CHRG_TO_LEASE_CMPY_FLG
            ,CON.LEASE_CMPY_CD
            ,CON.DS_CONTR_CATG_CD
            ,CON.DS_CONTR_STS_CD
            ,DTL.SVC_MACH_MSTR_PK
            ,CON.SVC_CONTR_BR_CD
            ,CON.TOC_CD
            ,CON.CUST_PO_NUM
            ,CON.PO_DT
            ,CRC.CR_CARD_CUST_REF_NUM
            ,CRC.CR_CARD_EXPR_YR_MTH
            ,CON.CONTR_AUTO_RNW_TP_CD
            ,CON.RNW_PRC_METH_CD
            ,RNE.BEF_END_RNW_DAYS_AOT
            ,CON.BASE_PRC_UP_RATIO AS RNW_PRC_UP_RATIO
            ,CON.CONTR_UPLFT_TP_CD
            ,CON.UPLFT_PRC_METH_CD
            ,RNE.UPLFT_BASE_PRC_UP_RATIO AS UPLFT_PRC_UP_RATIO
            ,DTL.SVC_MACH_MSTR_PK
            ,MAC.MDSE_CD
            ,MAC.SER_NUM
            ,MDL.T_MDL_ID
            ,MDL.T_MDL_NM
            ,DTL.BASE_BLLG_CYCLE_CD AS BLLG_CYCLE_CD
            ,NULL AS BLLG_MTR_LB_NM
            ,NULL AS BLLG_MTR_LB_CD
            ,NULL AS XS_CHRG_TP_CD
            ,NULL AS MTR_READ_METH_CD
            ,NULL AS BLLG_ROLL_OVER_RATIO
            ,DTL.BASE_PRC_DEAL_AMT
            ,DTL.BASE_PRC_TERM_DEAL_AMT_RATE
            ,CON.DS_CONTR_CLS_CD
            ,DTL.CTAC_PSN_PK
            ,RTRIM(CPS.CTAC_PSN_FIRST_NM || ' ' || CPS.CTAC_PSN_LAST_NM) AS CTAC_PSN_NM
            ,CON.MTR_EST_TP_CD
            ,CON.PRC_ALLOC_BY_MACH_QTY_FLG
            ,CON.SVC_PGM_MDSE_CD
            ,CON.INV_SEPT_BASE_USG_FLG
            ,CON.PMT_TERM_CASH_DISC_CD
            ,CON.SVC_LINE_BIZ_CD
            ,DTL.CONTR_CLO_DAY
            ,DTL.CONTR_BLLG_DAY
            ,DTL.BASE_BLLG_TMG_CD AS BLLG_TMG_CD
            ,CON.DS_CONTR_EDI_CD
            ,NULL AS MTR_LB_SORT_NUM
            ,#ifDtlTpBase# AS CONTR_INTFC_DTL_TP_CD
            ,NULL AS XS_MTR_COPY_QTY
            ,NULL AS XS_MTR_AMT_RATE
        FROM
            DS_CONTR                CON
            ,DS_CONTR_DTL           DTL
            ,SVC_MACH_MSTR          MAC
            ,SVC_CONFIG_MSTR        CFG
            ,MDL_NM                 MDL
            ,CTAC_PSN               CPS
            ,DS_CONTR_RNW_ESCL      RNE
            ,DS_CONTR_CR_CARD_PO    CRC
            ,BILL_TO_CUST           BIL
        WHERE
            CON.GLBL_CMPY_CD            = #glblCmpyCd#
            AND CON.DS_CONTR_PK         = #dsContrPk#
            AND CON.EZCANCELFLAG        = '0'
            AND CON.GLBL_CMPY_CD        = DTL.GLBL_CMPY_CD
            AND CON.DS_CONTR_PK         = DTL.DS_CONTR_PK
            AND DTL.DS_CONTR_DTL_PK     = #dsContrDtlPk#
            AND DTL.DS_CONTR_DTL_TP_CD  = #dsContrDtlTp#
            AND CON.EZCANCELFLAG        = DTL.EZCANCELFLAG
            AND DTL.GLBL_CMPY_CD        = MAC.GLBL_CMPY_CD
            AND DTL.SVC_MACH_MSTR_PK    = MAC.SVC_MACH_MSTR_PK
            AND DTL.EZCANCELFLAG        = MAC.EZCANCELFLAG
            AND MAC.GLBL_CMPY_CD        = CFG.GLBL_CMPY_CD
            AND MAC.SVC_CONFIG_MSTR_PK  = CFG.SVC_CONFIG_MSTR_PK
            AND MAC.EZCANCELFLAG        = CFG.EZCANCELFLAG
            AND CFG.GLBL_CMPY_CD        = MDL.T_GLBL_CMPY_CD
            AND CFG.MDL_ID              = MDL.T_MDL_ID
            AND CFG.EZCANCELFLAG        = MDL.EZCANCELFLAG
            AND DTL.GLBL_CMPY_CD        = CPS.GLBL_CMPY_CD(+)
            AND DTL.CTAC_PSN_PK         = CPS.CTAC_PSN_PK(+)
            AND DTL.EZCANCELFLAG        = CPS.EZCANCELFLAG(+)
            AND DTL.GLBL_CMPY_CD        = RNE.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK         = RNE.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK     = RNE.DS_CONTR_DTL_PK(+)
            AND DTL.EZCANCELFLAG        = RNE.EZCANCELFLAG(+)
            AND RNE.DS_CONTR_MACH_LVL_NUM(+) = #level2#
            AND DTL.GLBL_CMPY_CD        = CRC.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK         = CRC.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK     = CRC.DS_CONTR_DTL_PK(+)
            AND DTL.EZCANCELFLAG        = CRC.EZCANCELFLAG(+)
            AND CRC.DS_CONTR_MACH_LVL_NUM(+) = #level2#
            AND DTL.GLBL_CMPY_CD        = BIL.GLBL_CMPY_CD(+)
            AND DTL.BASE_BILL_TO_CUST_CD = BIL.BILL_TO_CUST_CD(+)
            AND DTL.EZCANCELFLAG        = BIL.EZCANCELFLAG(+)
    </statement>
    

    <statement id="getAdditionalChargeForContract" parameterClass="Map" resultClass="Map">
        SELECT
            CON.DS_CONTR_SRC_TP_CD
            ,NULL AS SER_NUM
            ,ADC.ADDL_CHRG_TP_CD
            ,ADC.BLLG_CYCLE_CD
            ,ADC.SVC_BILL_BY_TP_CD AS CHRG_LVL_TP_CD
            ,ADC.ADDL_CHRG_FLAT_DEAL_PRC_AMT
            ,ADC.ADDL_CHRG_APLC_PCT
            ,ADC.ADDL_CHRG_INV_TP_CD
            ,ADC.PRINT_DTL_FLG
            ,NULL AS MDSE_CD
            ,NULL AS SVC_MACH_MSTR_PK
        FROM
            DS_CONTR                CON
            ,DS_CONTR_ADDL_CHRG     ADC
        WHERE
            CON.GLBL_CMPY_CD            = #glblCmpyCd#
            AND CON.DS_CONTR_PK         = #dsContrPk#
            AND CON.EZCANCELFLAG        = '0'
            AND CON.GLBL_CMPY_CD        = ADC.GLBL_CMPY_CD
            AND CON.DS_CONTR_PK         = ADC.DS_CONTR_PK
            AND ADC.DS_CONTR_DTL_PK     IS NULL
            AND CON.EZCANCELFLAG        = ADC.EZCANCELFLAG
        ORDER BY ADDL_CHRG_TP_CD
    </statement>
    
    <statement id="getAdditionalChargeForDetail" parameterClass="Map" resultClass="Map">
        SELECT
            CON.DS_CONTR_SRC_TP_CD
            ,MAC.SER_NUM
            ,ADC.ADDL_CHRG_TP_CD
            ,ADC.BLLG_CYCLE_CD
            ,ADC.SVC_BILL_BY_TP_CD AS CHRG_LVL_TP_CD
            ,ADC.ADDL_CHRG_FLAT_DEAL_PRC_AMT
            ,ADC.ADDL_CHRG_APLC_PCT
            ,ADC.ADDL_CHRG_INV_TP_CD
            ,ADC.PRINT_DTL_FLG
            ,MAC.MDSE_CD
            ,MAC.SVC_MACH_MSTR_PK
        FROM
            DS_CONTR                CON
            ,DS_CONTR_DTL           DTL
            ,SVC_MACH_MSTR          MAC
            ,DS_CONTR_ADDL_CHRG     ADC
        WHERE
            CON.GLBL_CMPY_CD            = #glblCmpyCd#
            AND CON.DS_CONTR_PK         = #dsContrPk#
            AND CON.EZCANCELFLAG        = '0'
            AND CON.GLBL_CMPY_CD        = DTL.GLBL_CMPY_CD
            AND CON.DS_CONTR_PK         = DTL.DS_CONTR_PK
            AND DTL.DS_CONTR_DTL_PK     = #dsContrDtlPk#
            AND CON.EZCANCELFLAG        = DTL.EZCANCELFLAG
            AND DTL.GLBL_CMPY_CD        = MAC.GLBL_CMPY_CD(+)
            AND DTL.SVC_MACH_MSTR_PK    = MAC.SVC_MACH_MSTR_PK(+)
            AND DTL.EZCANCELFLAG        = MAC.EZCANCELFLAG(+)
            AND DTL.GLBL_CMPY_CD        = ADC.GLBL_CMPY_CD
            AND DTL.DS_CONTR_PK         = ADC.DS_CONTR_PK
            AND DTL.DS_CONTR_DTL_PK     = ADC.DS_CONTR_DTL_PK
            AND DTL.EZCANCELFLAG        = ADC.EZCANCELFLAG
        ORDER BY ADDL_CHRG_TP_CD
    </statement>

    <statement id="getPhysicalBillingMeterRelation" parameterClass="Map" resultClass="Map">

        SELECT
            CON.DS_CONTR_SRC_TP_CD
            ,MAC.SER_NUM
            ,PMT.MDL_MTR_LB_CD AS PHYS_MTR_LB_CD
            ,REL.BLLBL_FLG
            ,REL.CONTR_MTR_MULT_RATE
            ,REL.BLLG_MTR_LB_CD
            ,MAC.MDSE_CD
            ,MAC.SVC_MACH_MSTR_PK
        FROM
            DS_CONTR                    CON
            ,DS_CONTR_DTL               DTL
            ,SVC_MACH_MSTR              MAC
            ,CONTR_PHYS_BLLG_MTR_RELN   REL
            ,SVC_PHYS_MTR               PMT
        WHERE
            CON.GLBL_CMPY_CD            = #glblCmpyCd#
            AND CON.DS_CONTR_PK         = #dsContrPk#
            AND CON.EZCANCELFLAG        = '0'
            AND CON.GLBL_CMPY_CD        = DTL.GLBL_CMPY_CD
            AND CON.DS_CONTR_PK         = DTL.DS_CONTR_PK
            AND DTL.DS_CONTR_DTL_PK     = #dsContrDtlPk#
            AND CON.EZCANCELFLAG        = DTL.EZCANCELFLAG
            AND DTL.GLBL_CMPY_CD        = MAC.GLBL_CMPY_CD
            AND DTL.SVC_MACH_MSTR_PK    = MAC.SVC_MACH_MSTR_PK
            AND DTL.EZCANCELFLAG        = MAC.EZCANCELFLAG
            AND DTL.GLBL_CMPY_CD        = REL.GLBL_CMPY_CD
            AND DTL.DS_CONTR_DTL_PK     = REL.DS_CONTR_DTL_PK
            AND DTL.EZCANCELFLAG        = REL.EZCANCELFLAG
            AND REL.GLBL_CMPY_CD        = PMT.GLBL_CMPY_CD
            AND REL.SVC_PHYS_MTR_PK     = PMT.SVC_PHYS_MTR_PK
            AND REL.EZCANCELFLAG        = PMT.EZCANCELFLAG
        ORDER BY 
            PHYS_MTR_LB_CD
    </statement>
    
    <statement id="getExcessCopy" parameterClass="Map" resultClass="Map">
        SELECT
            CON.DS_CONTR_SRC_TP_CD
            ,MAC.SER_NUM
            ,MAC.MDSE_CD
            ,MAC.SVC_MACH_MSTR_PK
            ,XSC.XS_MTR_COPY_QTY
            ,XSC.XS_MTR_AMT_RATE
            ,BMT.BLLG_MTR_LB_CD
        FROM
            DS_CONTR                CON
            ,DS_CONTR_DTL           DTL
            ,SVC_MACH_MSTR          MAC
            ,DS_CONTR_BLLG_MTR      BMT
            ,CONTR_XS_COPY          XSC
        WHERE
            CON.GLBL_CMPY_CD                = #glblCmpyCd#
            AND CON.DS_CONTR_PK             = #dsContrPk#
            AND CON.EZCANCELFLAG            = '0'
            AND CON.GLBL_CMPY_CD            = DTL.GLBL_CMPY_CD
            AND CON.DS_CONTR_PK             = DTL.DS_CONTR_PK
            AND DTL.DS_CONTR_DTL_PK         = #dsContrDtlPk#
            AND CON.EZCANCELFLAG            = DTL.EZCANCELFLAG
            AND DTL.GLBL_CMPY_CD            = MAC.GLBL_CMPY_CD(+)
            AND DTL.SVC_MACH_MSTR_PK        = MAC.SVC_MACH_MSTR_PK(+)
            AND DTL.EZCANCELFLAG            = MAC.EZCANCELFLAG(+)
            AND DTL.GLBL_CMPY_CD            = BMT.GLBL_CMPY_CD
            AND DTL.DS_CONTR_DTL_PK         = BMT.DS_CONTR_DTL_PK
            AND DTL.EZCANCELFLAG            = BMT.EZCANCELFLAG
            AND BMT.GLBL_CMPY_CD            = XSC.GLBL_CMPY_CD
            AND BMT.DS_CONTR_BLLG_MTR_PK    = XSC.DS_CONTR_BLLG_MTR_PK
            AND BMT.EZCANCELFLAG            = XSC.EZCANCELFLAG
            AND XSC.XS_MTR_FIRST_FLG        = 'N'
        ORDER BY
            BMT.BLLG_MTR_LB_CD
            ,XSC.XS_MTR_COPY_QTY
    </statement>
    
    <typeAlias alias="DS_CONTR_DTLTMsg" type="business.db.DS_CONTR_DTLTMsg"/>
    <statement id="getDetailInfo" parameterClass="Map" resultMap="result.getDetailInfo">
        SELECT
            DS_CONTR_DTL_PK
            , DS_CONTR_DTL_TP_CD
            , CONTR_CLO_DAY
            , BASE_BLLG_TMG_CD
            , CONTR_BLLG_DAY
            , CONTR_EFF_FROM_DT
            , CONTR_EFF_THRU_DT
            , BASE_BLLG_CYCLE_CD
            , BASE_PRC_DEAL_AMT
            , BASE_PRC_TERM_DEAL_AMT_RATE
            , MTR_CLO_DAY
            , MTR_BLLG_TMG_CD
            , MTR_BLLG_DAY
            , MTR_BLLG_CYCLE_CD
        FROM
            DS_CONTR_DTL DTL
            ,SVC_MACH_MSTR MAC
        WHERE
            DTL.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DTL.DS_CONTR_PK      = #dsContrPk#
            AND DTL.EZCANCELFLAG     = '0'
            AND DTL.GLBL_CMPY_CD     = MAC.GLBL_CMPY_CD(+)
            AND DTL.SVC_MACH_MSTR_PK = MAC.SVC_MACH_MSTR_PK(+)
            AND MAC.EZCANCELFLAG(+)  ='0'
        ORDER BY
           DTL.SVC_CONFIG_MSTR_PK NULLS FIRST
           ,MAC.SVC_MACH_TP_CD
           ,DTL.SVC_MACH_MSTR_PK
    </statement>
    <resultMap id="result.getDetailInfo" class="DS_CONTR_DTLTMsg">
        <result property="dsContrDtlPk"             column="DS_CONTR_DTL_PK"                javaType="EZDTBigDecimalItem"/>
        <result property="dsContrDtlTpCd"           column="DS_CONTR_DTL_TP_CD"             javaType="EZDTStringItem"/>
        <result property="contrCloDay"              column="CONTR_CLO_DAY"                  javaType="EZDTStringItem"/>
        <result property="baseBllgTmgCd"            column="BASE_BLLG_TMG_CD"               javaType="EZDTStringItem"/>
        <result property="contrBllgDay"             column="CONTR_BLLG_DAY"                 javaType="EZDTStringItem"/>
        <result property="contrEffFromDt"           column="CONTR_EFF_FROM_DT"              javaType="EZDTDateItem"/>
        <result property="contrEffThruDt"           column="CONTR_EFF_THRU_DT"              javaType="EZDTDateItem"/>
        <result property="baseBllgCycleCd"          column="BASE_BLLG_CYCLE_CD"             javaType="EZDTStringItem"/>
        <result property="basePrcDealAmt"           column="BASE_PRC_DEAL_AMT"              javaType="EZDTBigDecimalItem"/>
        <result property="basePrcTermDealAmtRate"   column="BASE_PRC_TERM_DEAL_AMT_RATE"    javaType="EZDTBigDecimalItem"/>
        <result property="mtrCloDay"                column="MTR_CLO_DAY"                    javaType="EZDTStringItem"/>
        <result property="mtrBllgTmgCd"             column="MTR_BLLG_TMG_CD"                javaType="EZDTStringItem"/>
        <result property="mtrBllgDay"               column="MTR_BLLG_DAY"                   javaType="EZDTStringItem"/>
        <result property="mtrBllgCycleCd"           column="MTR_BLLG_CYCLE_CD"              javaType="EZDTStringItem"/>
    </resultMap>

    <statement id="getNextThruDt" parameterClass="Map" resultClass="String">
        SELECT
            CASE WHEN MONTHS_BETWEEN(TO_DATE(#oldThruDt#,#dateFormat#) +1, TO_DATE(#oldFromDt#,#dateFormat#))
                        = TRUNC (MONTHS_BETWEEN(TO_DATE(#oldThruDt#,#dateFormat#) +1, TO_DATE(#oldFromDt#,#dateFormat#)))
                 THEN TO_CHAR(ADD_MONTHS(TO_DATE(#nextFromDt#,#dateFormat#) -1, MONTHS_BETWEEN(TO_DATE(#oldThruDt#,#dateFormat#) +1, TO_DATE(#oldFromDt#,#dateFormat#))), #dateFormat#)
                 ELSE TO_CHAR(TO_DATE(#nextFromDt#,#dateFormat#) + (TO_DATE(#oldThruDt#,#dateFormat#) + 1 - TO_DATE(#oldFromDt#,#dateFormat#)) ,#dateFormat#)
            END AS NEW_EFF_THRU_DT
        FROM
            DUAL
    </statement>



</sqlMap>
