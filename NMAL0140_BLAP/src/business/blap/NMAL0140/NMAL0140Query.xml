<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NMAL0140Query">
    <typeAlias alias="NMAL0140_ASMsg"    type="business.blap.NMAL0140.NMAL0140_ASMsg"/>

    <statement id ="getCostTypeList" parameterClass="Map"  resultClass="Map">
        SELECT 
            T.MDSE_CST_UPD_TP_CD 
           ,T.MDSE_CST_UPD_TP_NM
        FROM 
            MDSE_CST_UPD_TP T
        WHERE 
            T.EZCANCELFLAG = '0'
        AND T.GLBL_CMPY_CD = #glblCmpyCd#
        ORDER BY MDSE_CST_UPD_TP_SORT_NUM
    </statement>
    
    <statement id ="getSubWhList" parameterClass="Map"  resultClass="Map">
        SELECT 
            distinct RS.RTL_SWH_NM
        FROM 
            RTL_SWH RS
        WHERE 
            RS.EZCANCELFLAG = '0'
        AND RS.GLBL_CMPY_CD = #glblCmpyCd#
        AND RS.RTL_SWH_CD = #rtlSwhCd#
    </statement>
    
    <resultMap id="result.NMAL0140_ASMsg"         class="NMAL0140_ASMsg">
        <result property="mdseCstUpdHistHdrPk_A1" column="MDSE_CST_UPD_HIST_HDR_PK"  javaType="EZDCBigDecimalItem"      />
        <result property="mdseCd_A1"              column="MDSE_CD"                   javaType="EZDCStringItem"      />
        <result property="mdseDescShortTxt_A1"    column="MDSE_DESC_SHORT_TXT"       javaType="EZDCStringItem"      />
        <result property="mdseCstUpdTpCd_A1"      column="MDSE_CST_UPD_TP_CD"        javaType="EZDCStringItem"      />
        <result property="mdseCstUpdTpNm_A1"      column="MDSE_CST_UPD_TP_NM"        javaType="EZDCStringItem"      />
        <result property="xxScrItem54Txt_A1"      column="COA_PROJ_DESC_TXT"         javaType="EZDCStringItem"      />
        <result property="rqstTotStdCostAmt_A1"   column="RQST_TOT_STD_COST_AMT"     javaType="EZDCBigDecimalItem"      />
        <result property="rqstTotStdCostAmt_SB"   column="SWH_COST_AMT"              javaType="EZDCBigDecimalItem"      />
        <result property="mdseCstUpdEffFromDt_A1" column="MDSE_CST_UPD_EFF_FROM_DT"  javaType="EZDCStringItem"      />
        <result property="mdseCstUpdCratDt_A1"    column="MDSE_CST_UPD_CRAT_DT"      javaType="EZDCStringItem"      />
        <result property="mdseCstUpdStsCd_A1"     column="MDSE_CST_UPD_STS_CD"       javaType="EZDCStringItem"      />
        <result property="mdseCstUpdStsNm_A1"     column="MDSE_CST_UPD_STS_NM"       javaType="EZDCStringItem"      />
        <result property="mdseCstUpdGrpTxt_A1"    column="MDSE_CST_UPD_GRP_TXT"      javaType="EZDCStringItem"      />
        <result property="mdseCstUpdRefTxt_A1"    column="MDSE_CST_UPD_REF_TXT"      javaType="EZDCStringItem"      />
        <result property="mdseCstUpdCratPsnCd_A1" column="MDSE_CST_UPD_CRAT_PSN_CD"  javaType="EZDCStringItem"      />
        <result property="xxFullNm_A1"            column="XX_FULL_NM"                javaType="EZDCStringItem"      />
        <result property="xxDtlCd_A1"             column="XX_DTL_CD"                 javaType="EZDCStringItem"      />
    </resultMap>
    
    <statement id ="search" parameterClass="Map" resultMap="result.NMAL0140_ASMsg">
        SELECT * FROM (
		SELECT
            D.MDSE_CST_UPD_HIST_HDR_PK
		   ,D.MDSE_CD
		   ,M.MDSE_DESC_SHORT_TXT
		   ,H.MDSE_CST_UPD_TP_CD
		   ,T.MDSE_CST_UPD_TP_NM
		   ,D.RQST_TOT_STD_COST_AMT
           <isNotNull property="rtlWhSwhCd">
           <!-- 2018/08/22 QC#25754 Mod Start -->
		   <!-- ,ROUND((D.RQST_TOT_STD_COST_AMT * SWH.MDSE_INVTY_COST_PCT) / 100, 2) SWH_COST_AMT -->
		   ,DECODE(SWH.MDSE_COST_TP_CD, #mdseCostTpAR#, ROUND((M.ASSET_RECOV_COST_AMT * SWH.MDSE_INVTY_COST_PCT) / 100, 2), 
		           ROUND((D.RQST_TOT_STD_COST_AMT * SWH.MDSE_INVTY_COST_PCT) / 100, 2)) SWH_COST_AMT
		   <!-- 2018/08/22 QC#25754 Mod End -->
            </isNotNull>
           <isNull property="rtlWhSwhCd">
           ,NULL SWH_COST_AMT
            </isNull>
		   ,D.MDSE_CST_UPD_EFF_FROM_DT
		   ,H.MDSE_CST_UPD_CRAT_DT
		   ,D.MDSE_CST_UPD_STS_CD
		   ,S.MDSE_CST_UPD_STS_NM
		   ,H.MDSE_CST_UPD_GRP_TXT
		   ,H.MDSE_CST_UPD_REF_TXT
		   ,H.MDSE_CST_UPD_CRAT_PSN_CD
		   ,H.MDSE_CST_UPD_CRAT_PSN_CD || ':' || P.FIRST_NM || ' ' || P.LAST_NM XX_FULL_NM
		   ,CASE WHEN H.MDSE_CST_UPD_TP_CD &lt;&gt; 'SC' THEN '' || D.MDSE_CD ELSE D.MDSE_CD END XX_DTL_CD
		   ,M.COA_MDSE_TP_CD || ':' || CP.COA_PROJ_DESC_TXT COA_PROJ_DESC_TXT
		FROM
		    MDSE_CST_UPD_HIST_HDR H
		   ,MDSE_CST_UPD_HIST_DTL D
		   ,MDSE M
		   ,MDSE_CST_UPD_TP T
		   ,MDSE_CST_UPD_STS S
		   ,AUTH_PSN P
		   <isNotNull property="rtlWhSwhCd">
		   ,(SELECT 
			    RS.GLBL_CMPY_CD
			   ,RS.EZCANCELFLAG
			   ,S.MDSE_INVTY_COST_PCT
			   ,MCT.MDSE_COST_TP_CD <!-- 2018/08/22 QC#25754 Add -->
			FROM 
			    RTL_SWH RS
			   ,SWH S
			   ,MDSE_COST_TP MCT <!-- 2018/08/22 QC#25754 Add -->
			WHERE
			    RS.EZCANCELFLAG = '0'
			AND RS.GLBL_CMPY_CD = 'ADB'
			AND RS.EZCANCELFLAG = S.EZCANCELFLAG
			AND RS.GLBL_CMPY_CD = S.GLBL_CMPY_CD
			AND RS.RTL_SWH_CD = S.RTL_SWH_CD
			<!-- 2018/08/22 QC#25754 Add Start -->
			AND S.EZCANCELFLAG = MCT.EZCANCELFLAG
			AND S.GLBL_CMPY_CD = MCT.GLBL_CMPY_CD
			AND S.MDSE_COST_TP_CD = MCT.MDSE_COST_TP_CD
			<!-- 2018/08/22 QC#25754 Add End -->
			AND RS.RTL_WH_CD = #rtlWhCd#
			AND RS.RTL_SWH_CD = #rtlSwhCd#) SWH
            </isNotNull>
            ,COA_PROJ CP
            
		WHERE
		    H.EZCANCELFLAG = '0'
		AND H.GLBL_CMPY_CD = #glblCmpyCd#
		AND H.EZCANCELFLAG = D.EZCANCELFLAG
		AND H.GLBL_CMPY_CD = D.GLBL_CMPY_CD
		AND H.MDSE_CST_UPD_HIST_HDR_PK = D.MDSE_CST_UPD_HIST_HDR_PK
		
		AND D.EZCANCELFLAG = M.EZCANCELFLAG
		AND D.GLBL_CMPY_CD = M.GLBL_CMPY_CD
		AND D.MDSE_CD = M.MDSE_CD
		
		AND H.EZCANCELFLAG = T.EZCANCELFLAG (+)
		AND H.GLBL_CMPY_CD = T.GLBL_CMPY_CD (+)
		AND H.MDSE_CST_UPD_TP_CD = T.MDSE_CST_UPD_TP_CD (+)
		
		AND D.EZCANCELFLAG = S.EZCANCELFLAG (+)
		AND D.GLBL_CMPY_CD = S.GLBL_CMPY_CD (+)
		AND D.MDSE_CST_UPD_STS_CD = S.MDSE_CST_UPD_STS_CD (+)
		
		AND H.EZCANCELFLAG = P.EZCANCELFLAG (+)
		AND H.GLBL_CMPY_CD = P.GLBL_CMPY_CD (+)
		AND H.MDSE_CST_UPD_CRAT_PSN_CD = P.USR_NM (+)
		
        AND M.EZCANCELFLAG = CP.EZCANCELFLAG (+)
        AND M.GLBL_CMPY_CD = CP.GLBL_CMPY_CD (+)
        AND M.COA_MDSE_TP_CD = CP.COA_PROJ_CD (+)
        
        <isNotNull property="rtlWhSwhCatgCd">
        AND EXISTS (SELECT '1' FROM INVTY I, RTL_SWH RS
        WHERE I.EZCANCELFLAG = '0' AND I.GLBL_CMPY_CD = #glblCmpyCd#
        AND I.LOC_STS_CD = #locStsCd#
        AND I.INVTY_AVAL_QTY &gt; 0
        AND I.INVTY_LOC_CD = RS.INVTY_LOC_CD
        AND RS.EZCANCELFLAG = '0'
        AND RS.GLBL_CMPY_CD = #glblCmpyCd#
        <isNotNull property="rtlWhCd">
        AND RS.RTL_WH_CD = #rtlWhCd#
        </isNotNull>
        <isNotNull property="rtlSwhCd">
        AND RS.RTL_SWH_CD = #rtlSwhCd#
        </isNotNull>
        <isNotNull property="rtlWhCatgCd">
        AND RS.RTL_WH_CATG_CD = #rtlWhCatgCd#
        </isNotNull>
        AND I.MDSE_CD = D.MDSE_CD
        )
        </isNotNull>
        
        <isNotNull property="rtlWhSwhCd">
        AND H.EZCANCELFLAG = SWH.EZCANCELFLAG (+)
        AND H.GLBL_CMPY_CD = SWH.GLBL_CMPY_CD (+)
        </isNotNull>
        
        <isNotNull property="mdseCstUpdTpCd">
		AND H.MDSE_CST_UPD_TP_CD = #mdseCstUpdTpCd#
        </isNotNull>
        <isNotNull property="mdseCstUpdGrpTxt">
		AND H.MDSE_CST_UPD_GRP_TXT like #mdseCstUpdGrpTxt#
        </isNotNull>
        <isNotNull property="mdseCstUpdRefTxt">
		AND H.MDSE_CST_UPD_REF_TXT like #mdseCstUpdRefTxt#
        </isNotNull>
        <isNotNull property="mdseCstUpdRefId">
		AND H.MDSE_CST_UPD_REF_ID like #mdseCstUpdRefId#
        </isNotNull>
        <isNotNull property="mdseCd">
		AND (D.MDSE_CD like #mdseCd#
		OR SUBSTR(D.MDSE_CD, 1, 8) = #mdseCd#)
        </isNotNull>
        <isNotNull property="mdseItemTpCd">
		AND M.MDSE_ITEM_TP_CD = #mdseItemTpCd#
        </isNotNull>
        <isNotNull property="coaMdseTpCd">
		AND M.COA_MDSE_TP_CD = #coaMdseTpCd#
        </isNotNull>
        <isNotNull property="coaProdCd">
		AND M.COA_PROD_CD = #coaProdCd#
        </isNotNull>
        <isNotNull property="defSrcWhCd">
		AND M.DEF_SRC_WH_CD = #"defSrcWhCd"#
        </isNotNull>
        <isNotNull property="defSrcSubWhCd">
		AND M.DEF_SRC_SUB_WH_CD = #defSrcSubWhCd#
        </isNotNull>
        <isNotNull property="mdseCstUpdEffFromDt">
		AND D.MDSE_CST_UPD_EFF_FROM_DT = #mdseCstUpdEffFromDt#
        </isNotNull>
        <isNotNull property="currentCostOnly">
		AND D.MDSE_CST_UPD_STS_CD = 'AC'
        </isNotNull>
        ORDER BY M.MDSE_CD, T.MDSE_CST_UPD_TP_SORT_NUM
        ) TMP
        WHERE ROWNUM &lt;= #rowNum#
    </statement>
    <statement id="getSavedSearchOptionList" parameterClass="Map" resultClass="Map">
        SELECT
                  SSO.SRCH_OPT_PK
                , SSO.SRCH_OPT_NM
            FROM
                SAVE_SRCH_OPT SSO 
            WHERE
                SSO.GLBL_CMPY_CD        = #glblCmpyCd#
                AND SSO.SRCH_OPT_APL_ID = #srchOptAplId#
                AND SSO.SRCH_OPT_USR_ID = #srchOptUsrId#
                AND SSO.EZCANCELFLAG    = '0'
            ORDER BY
                  SSO.SRCH_OPT_NM
    </statement>


</sqlMap>
