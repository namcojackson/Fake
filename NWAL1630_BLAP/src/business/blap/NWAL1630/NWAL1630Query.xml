<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NWAL1630Query">

    <statement id ="getSvcMachMstrPk" parameterClass="Map"  resultClass="BigDecimal">
        SELECT
              SMM.SVC_MACH_MSTR_PK 
        FROM
            DS_CONTR_DTL    DCD
            , SVC_MACH_MSTR SMM
            , DS_CONTR      DC
        WHERE
            DCD.GLBL_CMPY_CD     = #glblCmpyCd#
        AND DCD.EZCANCELFLAG     = '0' 
        AND DCD.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD 
        AND DCD.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK 
        AND SMM.EZCANCELFLAG     = '0' 
        AND SMM.SVC_MACH_TP_CD   = #machine#

        AND DCD.GLBL_CMPY_CD     = DC.GLBL_CMPY_CD 
        AND DCD.DS_CONTR_PK      = DC.DS_CONTR_PK 
        AND DC.EZCANCELFLAG      = '0' 
        AND DC.DS_CONTR_NUM      = #dsContrNum#
        AND SMM.SER_NUM          = #serNum#
    </statement>
    
    <!-- 2019/01/23 S21_NA#29446 Add Start -->
    <statement id="getContrCapInfo" parameterClass="Map" resultClass="Map">
        SELECT
              STCA.SVC_TERM_COND_ATTRB_NM
            , STC.SVC_TERM_ATTRB_MAP_VAL_CD
        FROM
              DS_CONTR DC
            , SVC_TERM_COND STC
            , DS_CONTR_DTL DCD
            , SVC_TERM_COND_ATTRB STCA
        WHERE 
            DC.GLBL_CMPY_CD      = #glblCmpyCd#
        AND DC.DS_CONTR_NUM      = #dsContrNum#           
        AND DC.EZCANCELFLAG      = '0' 
        
        AND DC.GLBL_CMPY_CD      = STC.GLBL_CMPY_CD
        AND DC.DS_CONTR_PK       = STC.DS_CONTR_PK
        AND STC.EZCANCELFLAG     = '0'
        
        AND STC.GLBL_CMPY_CD     = DCD.GLBL_CMPY_CD
        AND STC.DS_CONTR_DTL_PK  = DCD.DS_CONTR_DTL_PK
        AND DCD.SVC_MACH_MSTR_PK = #svcMachMstrPk#
        AND DCD.EZCANCELFLAG     = '0'
        
        AND STC.GLBL_CMPY_CD     = STCA.GLBL_CMPY_CD
        AND STC.SVC_TERM_COND_ATTRB_PK = STCA.SVC_TERM_COND_ATTRB_PK
        <iterate property="svcTermCondAttrbNmList" var="svcTermCondAttrbNm[]" open="AND STCA.SVC_TERM_COND_ATTRB_NM IN (" close=")" conjunction=",">
            #svcTermCondAttrbNm[]#
        </iterate>
        AND STCA.EZCANCELFLAG     = '0'
    </statement>
    
    <statement id ="getMachInfo" parameterClass="Map"  resultClass="Map">
        SELECT
                SMM.SER_NUM
              , SMM.SVC_MACH_MSTR_PK 
              , DC.DS_CONTR_NUM
        FROM
            DS_CONTR_DTL    DCD
            , SVC_MACH_MSTR SMM
            , DS_CONTR      DC
        WHERE
            DCD.GLBL_CMPY_CD     = #glblCmpyCd#
        AND DCD.EZCANCELFLAG     = '0' 
        AND DCD.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD 
        AND DCD.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK 
        AND SMM.EZCANCELFLAG     = '0' 
        AND SMM.SVC_MACH_TP_CD   = #machine#

        AND DCD.GLBL_CMPY_CD     = DC.GLBL_CMPY_CD 
        AND DCD.DS_CONTR_PK      = DC.DS_CONTR_PK 
        AND DC.EZCANCELFLAG      = '0' 
        <isNotNull  property="dsContrNum">
        AND DC.DS_CONTR_NUM      = #dsContrNum#
        </isNotNull>
        <isNotNull  property="serNum">
        AND SMM.SER_NUM          = #serNum#
        </isNotNull>
    </statement>
    <!-- 2019/01/23 S21_NA#29446 Add End -->

</sqlMap>
