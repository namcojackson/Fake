<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAL0840Query">
    <typeAlias alias="NSAL0840_ASMsg" type="business.blap.NSAL0840.NSAL0840_ASMsg"/>

    <statement id="getMainData" parameterClass="Map" resultMap="result.getMainData">
    SELECT
         NULL AS XX_CHK_BOX
        ,DS_CONTR_INTFC_BAT_NUM
        ,DS_CONTR_SRC_REF_NUM
        ,CONTR_INTFC_SRC_TP_CD
        ,DS_CONTR_NUM
        ,DS_CONTR_INTFC_ACT_CD
        ,DS_CONTR_INTFC_ACT_DESC_TXT
        ,SER_NUM
        ,SVC_MACH_MSTR_PK
        ,MDSE_CD
        ,CHRG_LVL_TP_CD
        ,ADDL_CHRG_TP_CD
        ,EFF_FROM_DT
        ,EFF_THRU_DT
        ,BLLG_CYCLE_CD
        ,ADDL_CHRG_FLAT_DEAL_PRC_AMT
        ,ADDL_CHRG_APLC_PCT
        ,ADDL_CHRG_INV_TP_CD
        ,PRINT_DTL_FLG
        ,DS_CONTR_INTFC_STS_CD
        ,INTFC_ERR_MSG_TXT
        ,DS_CONTR_PROC_STS_DESC_TXT
        ,DS_CONTR_PROC_STS_CD
        ,DS_CONTR_INTFC_PK
        ,DS_ADDL_CHRG_INTFC_PK
        ,NULL AS CPO_SVC_DTL_PK
        ,EZUPTIME
        ,EZUPTIMEZONE
        <!-- START 2016/11/28 K.Kojima [QC#14204, ADD] -->
        ,XX_REC_HIST_CRAT_TS_A
        ,XX_REC_HIST_CRAT_BY_NM_A
        ,XX_REC_HIST_UPD_TS_A
        ,XX_REC_HIST_UPD_BY_NM_A
        ,XX_REC_HIST_TBL_NM_A
        <!-- END 2016/11/28 K.Kojima [QC#14204, ADD] -->
    FROM
    (
        (
            SELECT
                 DCI.DS_CONTR_INTFC_BAT_NUM
                ,DCI.DS_CONTR_SRC_REF_NUM
                ,DCI.CONTR_INTFC_SRC_TP_CD
                ,DCI.DS_CONTR_NUM
                ,DCI.DS_CONTR_INTFC_ACT_CD
                ,DCIA.DS_CONTR_INTFC_ACT_DESC_TXT
                ,DCI.SER_NUM
                ,DCI.SVC_MACH_MSTR_PK
                ,DCI.MDSE_CD
                ,DCI.CHRG_LVL_TP_CD
                ,DCI.ADDL_CHRG_TP_CD
                ,DCI.CONTR_FROM_DT AS EFF_FROM_DT
                ,DCI.CONTR_THRU_DT AS EFF_THRU_DT
                ,DCI.BLLG_CYCLE_CD
                ,DCI.ADDL_CHRG_FLAT_DEAL_PRC_AMT
                ,DCI.ADDL_CHRG_APLC_PCT
                ,DCI.ADDL_CHRG_INV_TP_CD
                ,DCI.PRINT_DTL_FLG
                ,DCI.DS_CONTR_INTFC_STS_CD
                ,DCI.INTFC_ERR_MSG_TXT
                ,DCI.DS_CONTR_PROC_STS_CD
                ,DCPS.DS_CONTR_PROC_STS_DESC_TXT
                ,DCI.DS_CONTR_INTFC_PK
                ,NULL AS DS_ADDL_CHRG_INTFC_PK
                ,NULL AS CPO_SVC_DTL_PK
                ,DCI.EZUPTIME
                ,DCI.EZUPTIMEZONE
                ,MAC.SVC_CONFIG_MSTR_PK
                ,MAC.SVC_MACH_TP_CD
                <!-- START 2016/11/28 K.Kojima [QC#14204, ADD] -->
                ,DCI.EZINTIME    AS XX_REC_HIST_CRAT_TS_A
                ,DCI.EZINUSERID  AS XX_REC_HIST_CRAT_BY_NM_A
                ,DCI.EZUPTIME    AS XX_REC_HIST_UPD_TS_A
                ,DCI.EZUPUSERID  AS XX_REC_HIST_UPD_BY_NM_A
                ,DCI.EZTABLEID   AS XX_REC_HIST_TBL_NM_A
                <!-- END 2016/11/28 K.Kojima [QC#14204, ADD] -->
            FROM
                 DS_CONTR_INTFC     DCI
                ,CONTR_INTFC_SRC_TP CIST
                ,DS_CONTR_INTFC_ACT DCIA
                ,DS_CONTR_PROC_STS  DCPS
                ,CHRG_LVL_TP        CLT
                ,ADDL_CHRG_TP       ACT
                ,BLLG_CYCLE         BC
                ,ADDL_CHRG_INV_TP   ACIT
                ,SVC_MACH_MSTR      MAC
            WHERE
                DCI.GLBL_CMPY_CD                = #glblCmpyCd#
            <isNotNull property="dsContrIntfcPkList">
                <iterate property="dsContrIntfcPkList" var="dsContrIntfcPkList[]" open=" AND DCI.DS_CONTR_INTFC_PK IN (" close=")" conjunction=",">
                    #dsContrIntfcPkList[]#
                </iterate>
            </isNotNull>
            <isNotNull property="dsContrNum">
            AND DCI.DS_CONTR_NUM                = #dsContrNum#
            </isNotNull>
            <isNotNull property="dsContrIntfcBatNum">
            AND DCI.DS_CONTR_INTFC_BAT_NUM      = #dsContrIntfcBatNum#
            </isNotNull>
            <isNotNull property="dsContrSrcRefNum">
            AND DCI.DS_CONTR_SRC_REF_NUM        = #dsContrSrcRefNum#
            </isNotNull>
            <isNotNull property="contrIntfcSrcTpCd">
            AND DCI.CONTR_INTFC_SRC_TP_CD       = #contrIntfcSrcTpCd#
            </isNotNull>
            <isNotNull property="xxErrFlgList">
                <iterate property="xxErrFlgList" var="xxErrFlgList[]" open=" AND DCI.DS_CONTR_PROC_STS_CD IN (" close=")" conjunction=",">
                    #xxErrFlgList[]#
                </iterate>
            </isNotNull>
                AND (DCI.ADDL_CHRG_TP_CD                    IS NOT NULL
                         OR DCI.ADDL_CHRG_FLAT_DEAL_PRC_AMT IS NOT NULL
                         OR DCI.ADDL_CHRG_APLC_PCT          IS NOT NULL
                         OR DCI.ADDL_CHRG_INV_TP_CD         IS NOT NULL)
                AND DCI.EZCANCELFLAG                = '0'
                AND DCI.GLBL_CMPY_CD                = CIST.GLBL_CMPY_CD(+)
                AND DCI.CONTR_INTFC_SRC_TP_CD       = CIST.CONTR_INTFC_SRC_TP_CD(+)
                AND DCI.EZCANCELFLAG                = CIST.EZCANCELFLAG(+)
                AND DCI.GLBL_CMPY_CD                = DCIA.GLBL_CMPY_CD(+)
                AND DCI.DS_CONTR_INTFC_ACT_CD       = DCIA.DS_CONTR_INTFC_ACT_CD(+)
                AND DCI.EZCANCELFLAG                = DCIA.EZCANCELFLAG(+)
                AND DCI.GLBL_CMPY_CD                = DCPS.GLBL_CMPY_CD(+)
                AND DCI.DS_CONTR_PROC_STS_CD        = DCPS.DS_CONTR_PROC_STS_CD(+)
                AND DCI.EZCANCELFLAG                = DCPS.EZCANCELFLAG(+)
                AND DCI.GLBL_CMPY_CD                = CLT.GLBL_CMPY_CD(+)
                AND DCI.CHRG_LVL_TP_CD              = CLT.CHRG_LVL_TP_CD(+)
                AND DCI.EZCANCELFLAG                = CLT.EZCANCELFLAG(+)
                AND DCI.GLBL_CMPY_CD                = ACT.GLBL_CMPY_CD(+)
                AND DCI.ADDL_CHRG_TP_CD             = ACT.ADDL_CHRG_TP_CD(+)
                AND DCI.EZCANCELFLAG                = ACT.EZCANCELFLAG(+)
                AND DCI.GLBL_CMPY_CD                = BC.GLBL_CMPY_CD(+)
                AND DCI.BLLG_CYCLE_CD               = BC.BLLG_CYCLE_CD(+)
                AND DCI.EZCANCELFLAG                = BC.EZCANCELFLAG(+)
                AND DCI.GLBL_CMPY_CD                = ACIT.GLBL_CMPY_CD(+)
                AND DCI.ADDL_CHRG_INV_TP_CD         = ACIT.ADDL_CHRG_INV_TP_CD(+)
                AND DCI.EZCANCELFLAG                = ACIT.EZCANCELFLAG(+)
                AND DCI.GLBL_CMPY_CD                = MAC.GLBL_CMPY_CD(+)
                AND DCI.SVC_MACH_MSTR_PK            = MAC.SVC_MACH_MSTR_PK(+)
                AND DCI.EZCANCELFLAG                = MAC.EZCANCELFLAG(+)
        )
        UNION ALL
        (
            SELECT
                 DACI.DS_CONTR_INTFC_BAT_NUM
                ,DACI.DS_CONTR_SRC_REF_NUM
                ,DACI.CONTR_INTFC_SRC_TP_CD
                ,DCI.DS_CONTR_NUM
                ,DCI.DS_CONTR_INTFC_ACT_CD
                ,DCIA.DS_CONTR_INTFC_ACT_DESC_TXT
                ,DACI.SER_NUM
                ,DACI.SVC_MACH_MSTR_PK
                ,DACI.MDSE_CD
                ,DACI.CHRG_LVL_TP_CD
                ,DACI.ADDL_CHRG_TP_CD
                ,DACI.EFF_FROM_DT
                ,DACI.EFF_THRU_DT
                ,DACI.BLLG_CYCLE_CD
                ,DACI.ADDL_CHRG_FLAT_DEAL_PRC_AMT
                ,DACI.ADDL_CHRG_APLC_PCT
                ,DACI.ADDL_CHRG_INV_TP_CD
                ,DACI.PRINT_DTL_FLG
                ,DACI.ADD_CHRG_INTFC_STS_CD AS DS_CONTR_INTFC_STS_CD
                ,DACI.INTFC_ERR_MSG_TXT
                ,DCI.DS_CONTR_PROC_STS_CD
                ,DCPS.DS_CONTR_PROC_STS_DESC_TXT
                ,DCI.DS_CONTR_INTFC_PK
                ,DACI.DS_ADDL_CHRG_INTFC_PK
                ,NULL AS CPO_SVC_DTL_PK
                ,DACI.EZUPTIME
                ,DACI.EZUPTIMEZONE
                ,MAC.SVC_CONFIG_MSTR_PK
                ,MAC.SVC_MACH_TP_CD
                <!-- START 2016/11/28 K.Kojima [QC#14204, ADD] -->
                ,DACI.EZINTIME    AS XX_REC_HIST_CRAT_TS_A
                ,DACI.EZINUSERID  AS XX_REC_HIST_CRAT_BY_NM_A
                ,DACI.EZUPTIME    AS XX_REC_HIST_UPD_TS_A
                ,DACI.EZUPUSERID  AS XX_REC_HIST_UPD_BY_NM_A
                ,DACI.EZTABLEID   AS XX_REC_HIST_TBL_NM_A
                <!-- END 2016/11/28 K.Kojima [QC#14204, ADD] -->
            FROM
                 DS_ADDL_CHRG_INTFC DACI
                ,DS_CONTR_INTFC     DCI
                ,CONTR_INTFC_SRC_TP CIST
                ,DS_CONTR_INTFC_ACT DCIA
                ,DS_CONTR_PROC_STS  DCPS
                ,CHRG_LVL_TP        CLT
                ,ADDL_CHRG_TP       ACT
                ,BLLG_CYCLE         BC
                ,ADDL_CHRG_INV_TP   ACIT
                ,SVC_MACH_MSTR      MAC
            WHERE
                DACI.GLBL_CMPY_CD                   = #glblCmpyCd#
            <isNotNull property="dsContrIntfcBatNum">
                AND DACI.DS_CONTR_INTFC_BAT_NUM     = #dsContrIntfcBatNum#
            </isNotNull>
            <isNotNull property="dsContrSrcRefNum">
                AND DACI.DS_CONTR_SRC_REF_NUM       = #dsContrSrcRefNum#
            </isNotNull>
            <isNotNull property="contrIntfcSrcTpCd">
                AND DACI.CONTR_INTFC_SRC_TP_CD      = #contrIntfcSrcTpCd#
            </isNotNull>
                AND DACI.EZCANCELFLAG               = '0'
                AND DACI.GLBL_CMPY_CD               = DCI.GLBL_CMPY_CD
            <isNotNull property="dsContrIntfcPkList">
                <iterate property="dsContrIntfcPkList" var="dsContrIntfcPkList[]" open=" AND DCI.DS_CONTR_INTFC_PK IN (" close=")" conjunction=",">
                    #dsContrIntfcPkList[]#
                </iterate>
            </isNotNull>
                AND DACI.CONTR_INTFC_SRC_TP_CD      = DCI.CONTR_INTFC_SRC_TP_CD
                AND DACI.DS_CONTR_SRC_REF_NUM       = DCI.DS_CONTR_SRC_REF_NUM
                AND NVL(DACI.SVC_MACH_MSTR_PK,0)    = NVL(DCI.SVC_MACH_MSTR_PK,0)
            <isNotNull property="xxErrFlgList">
                <iterate property="xxErrFlgList" var="xxErrFlgList[]" open=" AND DCI.DS_CONTR_PROC_STS_CD IN (" close=")" conjunction=",">
                    #xxErrFlgList[]#
                </iterate>
            </isNotNull>
            <isNotNull property="dsContrNum">
                AND DCI.DS_CONTR_NUM                = #dsContrNum#
            </isNotNull>
                AND DCI.CONTR_INTFC_DTL_TP_CD       = #base#
                AND DACI.EZCANCELFLAG               = DCI.EZCANCELFLAG
                AND DACI.GLBL_CMPY_CD               = CIST.GLBL_CMPY_CD(+)
                AND DACI.CONTR_INTFC_SRC_TP_CD      = CIST.CONTR_INTFC_SRC_TP_CD(+)
                AND DACI.EZCANCELFLAG               = CIST.EZCANCELFLAG(+)
                AND DCI.GLBL_CMPY_CD                = DCIA.GLBL_CMPY_CD(+)
                AND DCI.DS_CONTR_INTFC_ACT_CD       = DCIA.DS_CONTR_INTFC_ACT_CD(+)
                AND DCI.EZCANCELFLAG                = DCIA.EZCANCELFLAG(+)
                AND DCI.GLBL_CMPY_CD                = DCPS.GLBL_CMPY_CD(+)
                AND DCI.DS_CONTR_PROC_STS_CD        = DCPS.DS_CONTR_PROC_STS_CD(+)
                AND DCI.EZCANCELFLAG                = DCPS.EZCANCELFLAG(+)
                AND DCI.GLBL_CMPY_CD                = CLT.GLBL_CMPY_CD(+)
                AND DCI.CHRG_LVL_TP_CD              = CLT.CHRG_LVL_TP_CD(+)
                AND DCI.EZCANCELFLAG                = CLT.EZCANCELFLAG(+)
                AND DCI.GLBL_CMPY_CD                = ACT.GLBL_CMPY_CD(+)
                AND DCI.ADDL_CHRG_TP_CD             = ACT.ADDL_CHRG_TP_CD(+)
                AND DCI.EZCANCELFLAG                = ACT.EZCANCELFLAG(+)
                AND DCI.GLBL_CMPY_CD                = BC.GLBL_CMPY_CD(+)
                AND DCI.BLLG_CYCLE_CD               = BC.BLLG_CYCLE_CD(+)
                AND DCI.EZCANCELFLAG                = BC.EZCANCELFLAG(+)
                AND DCI.GLBL_CMPY_CD                = ACIT.GLBL_CMPY_CD(+)
                AND DCI.ADDL_CHRG_INV_TP_CD         = ACIT.ADDL_CHRG_INV_TP_CD(+)
                AND DCI.EZCANCELFLAG                = ACIT.EZCANCELFLAG(+)
                AND DACI.GLBL_CMPY_CD               = MAC.GLBL_CMPY_CD(+)
                AND DACI.SVC_MACH_MSTR_PK           = MAC.SVC_MACH_MSTR_PK(+)
                AND DACI.EZCANCELFLAG               = MAC.EZCANCELFLAG(+)
        )
        ORDER BY
             DS_CONTR_SRC_REF_NUM ASC
            ,CONTR_INTFC_SRC_TP_CD ASC
            ,DS_CONTR_INTFC_BAT_NUM ASC
       <!-- ,CPO_SVC_DTL_PK ASC -->
            ,DS_CONTR_NUM ASC
            ,SVC_CONFIG_MSTR_PK NULLS FIRST
            ,SVC_MACH_TP_CD
            ,SVC_MACH_MSTR_PK ASC
    )
    WHERE
        ROWNUM &lt;= #limitNum#
    </statement>

    <resultMap id="result.getMainData" class="NSAL0840_ASMsg">
        <result property="xxChkBox_A"               column="XX_CHK_BOX"                     javaType="EZDSStringItem" />
        <result property="dsContrIntfcBatNum_A"     column="DS_CONTR_INTFC_BAT_NUM"         javaType="EZDSStringItem" />
        <result property="dsContrSrcRefNum_A"       column="DS_CONTR_SRC_REF_NUM"           javaType="EZDSStringItem" />
        <result property="contrIntfcSrcTpCd_A"      column="CONTR_INTFC_SRC_TP_CD"          javaType="EZDSStringItem" />
        <result property="dsContrNum_A"             column="DS_CONTR_NUM"                   javaType="EZDSStringItem" />
        <result property="dsContrIntfcActCd_A"      column="DS_CONTR_INTFC_ACT_CD"          javaType="EZDSStringItem" />
        <result property="dsContrIntfcActDescTxt_A" column="DS_CONTR_INTFC_ACT_DESC_TXT"    javaType="EZDSStringItem" />
        <result property="serNum_A"                 column="SER_NUM"                        javaType="EZDSStringItem" />
        <result property="svcMachMstrPk_A"          column="SVC_MACH_MSTR_PK"               javaType="EZDSBigDecimalItem" />
        <result property="mdseCd_A"                 column="MDSE_CD"                        javaType="EZDSStringItem" />
        <result property="chrgLvlTpCd_A"            column="CHRG_LVL_TP_CD"                 javaType="EZDSStringItem" />
        <result property="addlChrgTpCd_A"           column="ADDL_CHRG_TP_CD"                javaType="EZDSStringItem" />
        <result property="effFromDt_A"              column="EFF_FROM_DT"                    javaType="EZDSDateItem" />
        <result property="effThruDt_A"              column="EFF_THRU_DT"                    javaType="EZDSDateItem" />
        <result property="bllgCycleCd_A"            column="BLLG_CYCLE_CD"                  javaType="EZDSStringItem" />
        <result property="addlChrgFlatDealPrcAmt_A" column="ADDL_CHRG_FLAT_DEAL_PRC_AMT"    javaType="EZDSBigDecimalItem" />
        <result property="addlChrgAplcPct_A"        column="ADDL_CHRG_APLC_PCT"             javaType="EZDSBigDecimalItem" />
        <result property="addlChrgInvTpCd_A"        column="ADDL_CHRG_INV_TP_CD"            javaType="EZDSStringItem" />
        <result property="printDtlFlg_A"            column="PRINT_DTL_FLG"                  javaType="EZDSStringItem" />
        <result property="dsContrIntfcStsCd_A"      column="DS_CONTR_INTFC_STS_CD"          javaType="EZDSStringItem" />
        <result property="intfcErrMsgTxt_A"         column="INTFC_ERR_MSG_TXT"              javaType="EZDSStringItem" />
        <result property="dsContrProcStsDescTxt_A"  column="DS_CONTR_PROC_STS_DESC_TXT"     javaType="EZDSStringItem" />
        <result property="dsContrProcStsCd_A"       column="DS_CONTR_PROC_STS_CD"           javaType="EZDSStringItem" />
        <result property="dsContrIntfcPk_A"         column="DS_CONTR_INTFC_PK"              javaType="EZDSBigDecimalItem" />
        <result property="dsAddlChrgIntfcPk_A"      column="DS_ADDL_CHRG_INTFC_PK"          javaType="EZDSBigDecimalItem" />
        <result property="ezUpTime"                 column="EZUPTIME"                       javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone"             column="EZUPTIMEZONE"                   javaType="EZDSStringItem"/>
        <!-- START 2016/11/28 K.Kojima [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_A"        column="XX_REC_HIST_CRAT_TS_A"          javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_A"      column="XX_REC_HIST_CRAT_BY_NM_A"       javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_A"         column="XX_REC_HIST_UPD_TS_A"           javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_A"       column="XX_REC_HIST_UPD_BY_NM_A"        javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_A"         column="XX_REC_HIST_TBL_NM_A"           javaType="EZDSStringItem"/>
        <!-- END 2016/11/28 K.Kojima [QC#14204, ADD] -->
   </resultMap>

    <statement id="getDsAddlChrgIntfc" parameterClass="Map" resultClass="Map">
        SELECT
             DCI.DS_CONTR_NUM
            ,DACI.ADD_CHRG_INTFC_STS_CD AS DS_CONTR_INTFC_STS_CD
            ,DACI.INTFC_ERR_MSG_TXT
            ,DCP.DS_CONTR_PROC_STS_DESC_TXT
            ,DCI.DS_CONTR_PROC_STS_CD
            ,DCI.DS_CONTR_INTFC_PK
            ,DCI.DS_CONTR_INTFC_ACT_CD
            ,DCIA.DS_CONTR_INTFC_ACT_DESC_TXT
            ,DACI.DS_ADDL_CHRG_INTFC_PK
            ,DACI.EZUPTIME
            ,DACI.EZUPTIMEZONE
        FROM
             DS_ADDL_CHRG_INTFC DACI
            ,DS_CONTR_INTFC     DCI
            ,DS_CONTR_INTFC_ACT DCIA
            ,DS_CONTR_PROC_STS  DCP
        WHERE
                DACI.GLBL_CMPY_CD               = #glblCmpyCd#
            AND DACI.DS_CONTR_INTFC_BAT_NUM     = #dsContrIntfcBatNum#
            AND DACI.DS_CONTR_SRC_REF_NUM       = #dsContrSrcRefNum#
            AND DACI.CONTR_INTFC_SRC_TP_CD      = #contrIntfcSrcTpCd#
            AND DACI.CHRG_LVL_TP_CD             = #chrgLvlTpCd#
            AND DACI.ADDL_CHRG_TP_CD            = #addlChrgTpCd#
            <isNotNull property="serNum">
            AND DACI.SER_NUM                 = #serNum# 
            </isNotNull>
            <isNull property="serNum">
            AND DACI.SER_NUM IS NULL 
            </isNull>
            <isNotNull property="mdseCd">
            AND DACI.MDSE_CD                 = #mdseCd#
            </isNotNull>
            <isNull property="mdseCd">
            AND DACI.MDSE_CD IS NULL
            </isNull>
            AND DACI.EZCANCELFLAG               = '0'
            AND DACI.GLBL_CMPY_CD               = DCI.GLBL_CMPY_CD
            AND DACI.DS_CONTR_INTFC_BAT_NUM     = DCI.DS_CONTR_INTFC_BAT_NUM
            AND DACI.CONTR_INTFC_SRC_TP_CD      = DCI.CONTR_INTFC_SRC_TP_CD
            AND DACI.DS_CONTR_SRC_REF_NUM       = DCI.DS_CONTR_SRC_REF_NUM
            AND DACI.EZCANCELFLAG               = DCI.EZCANCELFLAG
            AND NVL(DACI.SVC_MACH_MSTR_PK,0)    = NVL(DCI.SVC_MACH_MSTR_PK,0)
            AND DCI.GLBL_CMPY_CD                = DCIA.GLBL_CMPY_CD(+)
            AND DCI.DS_CONTR_INTFC_ACT_CD       = DCIA.DS_CONTR_INTFC_ACT_CD(+)
            AND DCI.EZCANCELFLAG                = DCIA.EZCANCELFLAG(+)
            AND DCI.GLBL_CMPY_CD                = DCP.GLBL_CMPY_CD(+)
            AND DCI.DS_CONTR_PROC_STS_CD        = DCP.DS_CONTR_PROC_STS_CD(+)
            AND DCI.EZCANCELFLAG                = DCP.EZCANCELFLAG(+)
            AND ROWNUM                          = 1
    </statement>
    <statement id="getDsContrIntfcPk" parameterClass="Map" resultClass="Map">
        SELECT
             DCI.DS_CONTR_NUM
            ,DCI.DS_CONTR_PROC_STS_CD
            ,DCI.DS_CONTR_INTFC_PK
            ,DCI.DS_CONTR_INTFC_ACT_CD
            ,DCP.DS_CONTR_PROC_STS_DESC_TXT
            ,DCIA.DS_CONTR_INTFC_ACT_DESC_TXT
        FROM
             DS_CONTR_INTFC     DCI
            ,DS_CONTR_INTFC_ACT DCIA
            ,DS_CONTR_PROC_STS  DCP
        WHERE
                DCI.GLBL_CMPY_CD               = #glblCmpyCd#
            AND DCI.EZCANCELFLAG               = '0'
            AND DCI.DS_CONTR_INTFC_BAT_NUM     = #dsContrIntfcBatNum#
            AND DCI.DS_CONTR_SRC_REF_NUM       = #dsContrSrcRefNum#
            AND DCI.CONTR_INTFC_SRC_TP_CD      = #contrIntfcSrcTpCd#
            <isNotNull property="svcMachMstrPk">
            AND DCI.SVC_MACH_MSTR_PK        = #svcMachMstrPk#
            </isNotNull>
            <isNull property="svcMachMstrPk">
            AND DCI.SVC_MACH_MSTR_PK IS NULL
            </isNull>
            AND DCI.GLBL_CMPY_CD                = DCIA.GLBL_CMPY_CD(+)
            AND DCI.DS_CONTR_INTFC_ACT_CD       = DCIA.DS_CONTR_INTFC_ACT_CD(+)
            AND DCI.EZCANCELFLAG                = DCIA.EZCANCELFLAG(+)
            AND DCI.GLBL_CMPY_CD                = DCP.GLBL_CMPY_CD(+)
            AND DCI.DS_CONTR_PROC_STS_CD        = DCP.DS_CONTR_PROC_STS_CD(+)
            AND DCI.EZCANCELFLAG                = DCP.EZCANCELFLAG(+)
            AND ROWNUM                          = 1
    </statement>
    <statement id="getStatusUpdateTarget" parameterClass="Map" resultClass="Map">
         SELECT
            DCI.GLBL_CMPY_CD
           ,DCI.DS_CONTR_INTFC_PK
        FROM
            DS_CONTR_INTFC        DCI
        WHERE
            DCI.GLBL_CMPY_CD                = #glblCmpyCd#
            AND DCI.EZCANCELFLAG            = '0'
            AND DCI.DS_CONTR_PROC_STS_CD IN(#inProcess#, #reProcess#)
            AND (EXISTS(SELECT 1 FROM DS_CONTR_INTFC DCI2
                        WHERE
                        DCI2.GLBL_CMPY_CD                = DCI.GLBL_CMPY_CD
                        AND DCI2.DS_CONTR_INTFC_BAT_NUM  = DCI.DS_CONTR_INTFC_BAT_NUM
                        AND DCI2.CONTR_INTFC_SRC_TP_CD   = DCI.CONTR_INTFC_SRC_TP_CD
                        AND DCI2.DS_CONTR_SRC_REF_NUM    = DCI.DS_CONTR_SRC_REF_NUM
                   <!-- AND NVL(DCI2.CPO_SVC_DTL_PK, 0)  = NVL(DCI.CPO_SVC_DTL_PK, 0) -->
                        <iterate property="dsCntIntfcPkList" var="dsCntIntfcPkList[]" open="                AND DCI2.DS_CONTR_INTFC_PK IN (" close=")" conjunction=",">
                            #dsCntIntfcPkList[]#
                        </iterate>
                        AND DCI2.DS_CONTR_INTFC_STS_CD   = #intfcStsError#
                        AND DCI2.EZCANCELFLAG            = '0')
              OR EXISTS(SELECT 1 FROM DS_ADDL_CHRG_INTFC DACI
                        WHERE
                        DCI.GLBL_CMPY_CD                = DACI.GLBL_CMPY_CD
                        AND DCI.DS_CONTR_INTFC_BAT_NUM  = DACI.DS_CONTR_INTFC_BAT_NUM
                        AND DCI.CONTR_INTFC_SRC_TP_CD   = DACI.CONTR_INTFC_SRC_TP_CD
                        AND DCI.DS_CONTR_SRC_REF_NUM    = DACI.DS_CONTR_SRC_REF_NUM
                   <!-- AND NVL(DCI.CPO_SVC_DTL_PK, 0)  = NVL(DACI.CPO_SVC_DTL_PK, 0) -->
                        AND DACI.ADD_CHRG_INTFC_STS_CD  = #intfcStsError#
                        <iterate property="dsAddlChrgIntfcPkList" var="dsAddlChrgIntfcPkList[]" open="                AND DACI.DS_ADDL_CHRG_INTFC_PK IN (" close=")" conjunction=",">
                            #dsAddlChrgIntfcPkList[]#
                        </iterate>
                        AND DACI.EZCANCELFLAG            = '0')
            )
        ORDER BY DCI.DS_CONTR_INTFC_PK
    </statement>

<!-- START 2016/07/28 M.Gotou [QC#12141, ADD] -->
    <statement id="countCpltData" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            DS_CONTR_INTFC     CON
        WHERE
                CON.GLBL_CMPY_CD          = #glblCmpyCd#
            AND CON.DS_CONTR_PROC_STS_CD  = #dsContrProcStsCd#
            AND CON.EZCANCELFLAG          = '0'
            <iterate property="dsContrIntfcPkList" var="dsContrIntfcPkList[]" open="AND CON.DS_CONTR_INTFC_PK IN (" close=")" conjunction=",">
                #dsContrIntfcPkList[]#
            </iterate>
    </statement>
    <statement id="getDsContrIntfcActDescTxt" parameterClass="Map" resultClass="String">
        SELECT
            DS_CONTR_INTFC_ACT_DESC_TXT
        FROM
        (
            SELECT
                ACT.DS_CONTR_INTFC_ACT_DESC_TXT
            FROM
                 DS_CONTR_INTFC     CON
                ,DS_CONTR_INTFC_ACT ACT
            WHERE
                    CON.GLBL_CMPY_CD          = #glblCmpyCd#
                AND CON.EZCANCELFLAG          = '0'
                AND CON.GLBL_CMPY_CD          = ACT.GLBL_CMPY_CD
                AND CON.DS_CONTR_INTFC_ACT_CD = ACT.DS_CONTR_INTFC_ACT_CD
                AND CON.EZCANCELFLAG          = ACT.EZCANCELFLAG
                <iterate property="dsContrIntfcPkList" var="dsContrIntfcPkList[]" open="AND CON.DS_CONTR_INTFC_PK IN (" close=")" conjunction=",">
                    #dsContrIntfcPkList[]#
                </iterate>
            ORDER BY
                CON.DS_CONTR_INTFC_PK
        )
        WHERE
            ROWNUM = 1
    </statement>
<!-- END 2016/07/28 M.Gotou [QC#12141, ADD] -->
    <statement id="getAddlChrgTpV" parameterClass="Map" resultClass="Map">
        SELECT
             ADDL_CHRG_TP_CD
            ,ADDL_CHRG_TP_DESC_TXT
        FROM
            ADDL_CHRG_TP_V
        A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
        ORDER BY
             ADDL_CHRG_TP_DESC_TXT
    </statement>
</sqlMap>
