<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NSAB077001">

    <statement id="getConvOrd" parameterClass="Map" resultClass="String">
        SELECT DISTINCT
            A.CPO_ORD_NUM
        FROM
            CPO_DTL      A
        WHERE
                A.GLBL_CMPY_CD       = #glblCmpyCd#
            AND A.CONV_PROC_STS_CD   = #inProcess#
            AND A.EZCANCELFLAG       = '0'
        ORDER BY
             A.CPO_ORD_NUM
    </statement>

    <statement id="getDsContrDtlForTrmn" parameterClass="Map" resultClass="Map">
        SELECT
             C.DS_CONTR_PK
            ,C.DS_CONTR_DTL_PK
            ,C.CONTR_EFF_FROM_DT
            ,C.SUPPR_CR_FLG
            ,E.DS_CONTR_CATG_CD
        FROM
             CPO_DTL            A
            ,SVC_CONFIG_MSTR    B
            ,DS_CONTR_DTL       C
            ,DS_CONTR_DTL_STS_V D
            ,DS_CONTR           E
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.CONV_PROC_STS_CD      = #inProcess#
            AND A.CPO_ORD_NUM           = #cpoOrdNum#
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.SVC_CONFIG_MSTR_PK    = B.SVC_CONFIG_MSTR_PK
            AND A.SVC_MACH_MSTR_PK      = B.SVC_MACH_MSTR_PK
            AND B.EZCANCELFLAG          = '0'
            AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND B.SVC_MACH_MSTR_PK      = C.SVC_MACH_MSTR_PK
            AND C.EZCANCELFLAG          = '0'
            AND C.GLBL_CMPY_CD          = D.GLBL_CMPY_CD
            AND C.DS_CONTR_DTL_PK       = D.DS_CONTR_DTL_PK
            <!-- START 2018/01/15 K.Kojima [QC#23255,MOD] -->
            <!-- <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCd[]" open="AND D.DS_CONTR_CTRL_STS_CD NOT IN (" close=")" conjunction=","> -->
            <!--     #dsContrCtrlStsCd[]# -->
            <!-- </iterate> -->
            AND D.CONTR_TRMN_AVAL_FLG   = #flgOnY#
            <!-- END 2018/01/15 K.Kojima [QC#23255,MOD] -->
            AND D.EZCANCELFLAG          = '0'
            AND C.GLBL_CMPY_CD          = E.GLBL_CMPY_CD
            AND C.DS_CONTR_PK           = E.DS_CONTR_PK
            AND E.DS_CONTR_CATG_CD      &lt;&gt; #warranty#
            AND E.EZCANCELFLAG          = '0'
        ORDER BY
             C.DS_CONTR_PK
            ,C.DS_CONTR_DTL_PK
    </statement>

    <statement id="getDsContrDtlAccForTrmn" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_DTL_PK
            ,A.SUPPR_CR_FLG
        FROM
             DS_CONTR_DTL       A
            ,DS_CONTR_DTL_STS_V B
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.DS_CONTR_PK           = #dsContrPk#
            AND A.PRNT_DS_CONTR_DTL_PK  = #dsContrDtlPk#
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK       = B.DS_CONTR_DTL_PK
            <!-- START 2018/01/15 K.Kojima [QC#23255,MOD] -->
            <!-- <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCd[]" open="AND B.DS_CONTR_CTRL_STS_CD NOT IN (" close=")" conjunction=","> -->
            <!--     #dsContrCtrlStsCd[]# -->
            <!-- </iterate> -->
            AND B.CONTR_TRMN_AVAL_FLG   = #flgOnY#
            <!-- END 2018/01/15 K.Kojima [QC#23255,MOD] -->
            AND B.EZCANCELFLAG          = '0'
        ORDER BY 
            A.DS_CONTR_DTL_PK
    </statement>

<!-- START 2019/02/28 [QC#30503,MOD] -->
    <statement id="getShellContrDaily" parameterClass="Map" resultClass="BigDecimal">
        WITH SHELL_HEADER_INFO AS (
                SELECT
                     A.DS_CONTR_PK
                    ,A.CPO_ORD_NUM
                    ,A.FROM_PER_MTH_NUM
                    ,A.DS_CONTR_DTL_PK
                    ,A.PRNT_DS_CONTR_DTL_PK
                    ,A.DS_CONTR_DTL_TP_CD
                    ,A.DS_CONTR_DTL_STS_CD
                    ,H.MAIN_UNIT_LINE_FLG
                    ,E.SHPG_STS_CD
                    <!-- START 2019/04/09 [QC#31134,ADD] -->
                    ,A.SVC_CONFIG_MSTR_PK
                    <!-- END 2019/04/09 [QC#31134,ADD] -->
                FROM
                     DS_CONTR_DTL       A
                    ,SHPG_PLN           E
                    ,CPO_DTL            F
                    ,SVC_MACH_MSTR      G
                    ,DS_CONTR_DTL_TP    H
                WHERE
                        A.GLBL_CMPY_CD              = #glblCmpyCd#
                    AND A.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = E.GLBL_CMPY_CD
                    AND A.CPO_ORD_NUM               = E.TRX_HDR_NUM
                    AND A.CPO_DTL_LINE_NUM          = E.TRX_LINE_NUM
                    AND A.CPO_DTL_LINE_SUB_NUM      = E.TRX_LINE_SUB_NUM
                    AND E.SHPG_STS_CD               IN(#arrived#, #installed#, #invoiced#)
                    AND E.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = F.GLBL_CMPY_CD
                    AND A.CPO_ORD_NUM               = F.CPO_ORD_NUM
                    AND A.CPO_DTL_LINE_NUM          = F.CPO_DTL_LINE_NUM
                    AND A.CPO_DTL_LINE_SUB_NUM      = F.CPO_DTL_LINE_SUB_NUM
                    AND F.CONV_PROC_STS_CD          IS NULL
                    AND F.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = G.GLBL_CMPY_CD
                    AND A.CPO_ORD_NUM               = G.CPO_ORD_NUM
                    AND A.CPO_DTL_LINE_NUM          = G.CPO_DTL_LINE_NUM
                    AND A.CPO_DTL_LINE_SUB_NUM      = G.CPO_DTL_LINE_SUB_NUM
                    AND G.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = H.GLBL_CMPY_CD
                    AND A.DS_CONTR_DTL_TP_CD        = H.DS_CONTR_DTL_TP_CD
                    AND H.EZCANCELFLAG              = '0'
        )
        SELECT
             DS_CONTR_PK
        FROM (
                SELECT
                     A.DS_CONTR_PK
                    ,A.CPO_ORD_NUM
                    ,A.FROM_PER_MTH_NUM
                FROM
                     SHELL_HEADER_INFO  A
                WHERE
                        A.DS_CONTR_DTL_STS_CD     = #order#
                    AND A.MAIN_UNIT_LINE_FLG      = 'Y'
                    AND A.SHPG_STS_CD             IN(#arrived#, #installed#)

                UNION ALL
                SELECT
                     A.DS_CONTR_PK
                    ,A.CPO_ORD_NUM
                    ,A.FROM_PER_MTH_NUM
                FROM
                     SHELL_HEADER_INFO  A
                WHERE
                        A.DS_CONTR_DTL_TP_CD      = #accessories#
                    AND A.DS_CONTR_DTL_STS_CD     = #order#
                    AND A.MAIN_UNIT_LINE_FLG      = 'N'
                    AND A.SHPG_STS_CD             IN(#arrived#, #installed#)
                    AND EXISTS (
                        SELECT
                             1
                        FROM
                             SHELL_HEADER_INFO  B
                        WHERE
                                B.DS_CONTR_PK         = A.DS_CONTR_PK
                            AND B.DS_CONTR_DTL_PK     = A.PRNT_DS_CONTR_DTL_PK
                            AND B.CPO_ORD_NUM         = A.CPO_ORD_NUM
                            <!-- START 2019/04/09 [QC#31134,ADD] -->
                            AND B.SVC_CONFIG_MSTR_PK  = A.SVC_CONFIG_MSTR_PK
                            <!-- END 2019/04/09 [QC#31134,ADD] -->
                            AND B.MAIN_UNIT_LINE_FLG  = 'Y'
                            AND B.SHPG_STS_CD         = #invoiced#
                        )

                UNION ALL
                SELECT
                     A.DS_CONTR_PK
                    ,A.CPO_ORD_NUM
                    ,A.FROM_PER_MTH_NUM
                FROM
                     SHELL_HEADER_INFO  A
                WHERE
                        A.DS_CONTR_DTL_TP_CD      = #accessories#
                    AND A.DS_CONTR_DTL_STS_CD     = #order#
                    AND A.MAIN_UNIT_LINE_FLG      = 'N'
                    AND A.SHPG_STS_CD             IN(#arrived#, #installed#, #invoiced#)
                    AND EXISTS (
                        SELECT
                             1
                        FROM
                             SHELL_HEADER_INFO  B
                        WHERE
                                B.DS_CONTR_PK         = A.DS_CONTR_PK
                            AND B.DS_CONTR_DTL_PK     = A.PRNT_DS_CONTR_DTL_PK
                            AND B.CPO_ORD_NUM         = A.CPO_ORD_NUM
                            <!-- START 2019/04/09 [QC#31134,ADD] -->
                            AND B.SVC_CONFIG_MSTR_PK  = A.SVC_CONFIG_MSTR_PK
                            <!-- END 2019/04/09 [QC#31134,ADD] -->
                            AND B.MAIN_UNIT_LINE_FLG  = 'Y'
                            AND B.SHPG_STS_CD         IN(#arrived#, #installed#)
                        )

                UNION ALL
                SELECT
                     A.DS_CONTR_PK
                    ,A.CPO_ORD_NUM
                    ,A.FROM_PER_MTH_NUM
                FROM
                     SHELL_HEADER_INFO  A
                WHERE
                        A.DS_CONTR_DTL_TP_CD      = #accessories#
                    AND A.DS_CONTR_DTL_STS_CD     = #order#
                    AND A.MAIN_UNIT_LINE_FLG      = 'N'
                    AND A.SHPG_STS_CD             IN(#arrived#, #installed#)
                    AND NOT EXISTS (
                        SELECT
                             1
                        FROM
                             CPO_DTL  B
                        WHERE
                                B.GLBL_CMPY_CD      = #glblCmpyCd#
                            AND B.CPO_ORD_NUM       = A.CPO_ORD_NUM
                            <!-- START 2019/04/09 [QC#31134,ADD] -->
                            AND B.SVC_CONFIG_MSTR_PK = A.SVC_CONFIG_MSTR_PK
                            <!-- END 2019/04/09 [QC#31134,ADD] -->
                            AND B.BASE_CMPT_FLG     = 'Y'
                            AND B.EZCANCELFLAG      = '0'
                        )
        )
        GROUP BY
             CPO_ORD_NUM
            ,FROM_PER_MTH_NUM
            ,DS_CONTR_PK
        ORDER BY
             CPO_ORD_NUM
            ,FROM_PER_MTH_NUM
            ,DS_CONTR_PK
    </statement>

    <statement id="getShellContrDtlDaily" parameterClass="Map" resultClass="Map">
        WITH SHELL_DTL_INFO AS (
                SELECT
                     G.SVC_MACH_MSTR_PK
                    ,A.DS_CONTR_DTL_PK
                    ,A.CPO_ORD_NUM
                    ,NVL(A.SVC_PGM_MDSE_CD, I.SVC_PGM_MDSE_CD)  AS SVC_PGM_MDSE_CD
                    ,A.DS_CONTR_DTL_TP_CD
                    ,A.BASE_DPLY_PER_END_DAY
                    ,A.MTR_DPLY_PER_END_DAY
                    ,A.FROM_PER_MTH_NUM
                    ,A.TO_PER_MTH_NUM
                    ,A.PRNT_DS_CONTR_DTL_PK
                    ,C.DS_CONTR_PK
                    ,C.DS_CONTR_NUM
                    ,C.DS_CONTR_CATG_CD
                    ,C.CONTR_VRSN_EFF_FROM_DT
                    ,C.CONTR_VRSN_EFF_THRU_DT
                    ,C.DS_CONTR_STS_CD
                    ,C.DS_CONTR_SRC_TP_CD
                    ,C.DS_CONTR_CLS_CD
                    ,C.SVC_LINE_BIZ_CD
                    ,D.DS_CONTR_STS_NM
                    ,CASE
                         WHEN A.DS_CONTR_DTL_TP_CD = #accessories# THEN A.PRNT_DS_CONTR_DTL_PK
                         ELSE A.DS_CONTR_DTL_PK
                     END AS SORT_DS_CONTR_DTL_PK
                    ,A.ADD_CONTR_FLG
                    ,B.USG_CHRG_FLG
                    ,NVL(H.OVRD_MNF_WTY_FLG, J.OVRD_MNF_WTY_FLG) AS OVRD_MNF_WTY_FLG
                    ,G.SVC_MACH_MSTR_STS_CD
                    ,NVL(H.SVC_PGM_TP_CD, J.SVC_PGM_TP_CD) AS SVC_PGM_TP_CD
                    ,A.DS_CONTR_DTL_STS_CD
                    ,B.MAIN_UNIT_LINE_FLG
                    ,E.SHPG_STS_CD
                    ,B.DS_CONTR_DTL_TP_SORT_NUM
                    <!-- START 2019/04/09 [QC#31134,ADD] -->
                    ,A.SVC_CONFIG_MSTR_PK
                    <!-- END 2019/04/09 [QC#31134,ADD] -->
                FROM
                     DS_CONTR_DTL       A
                    ,DS_CONTR_DTL_TP    B
                    ,DS_CONTR           C
                    ,DS_CONTR_STS       D
                    ,SHPG_PLN           E
                    ,CPO_DTL            F
                    ,SVC_MACH_MSTR      G
                    ,MDSE               H
                    ,DS_CONTR_DTL       I
                    ,MDSE               J
                WHERE
                        A.GLBL_CMPY_CD              = #glblCmpyCd#
                    AND A.DS_CONTR_PK               = #dsContrPk#
                    AND A.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
                    AND A.DS_CONTR_DTL_TP_CD        = B.DS_CONTR_DTL_TP_CD
                    AND B.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = C.GLBL_CMPY_CD
                    AND A.DS_CONTR_PK               = C.DS_CONTR_PK
                    AND C.EZCANCELFLAG              = '0'
                    AND C.GLBL_CMPY_CD              = D.GLBL_CMPY_CD
                    AND C.DS_CONTR_STS_CD           = D.DS_CONTR_STS_CD
                    AND D.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = E.GLBL_CMPY_CD
                    AND A.CPO_ORD_NUM               = E.TRX_HDR_NUM
                    AND A.CPO_DTL_LINE_NUM          = E.TRX_LINE_NUM
                    AND A.CPO_DTL_LINE_SUB_NUM      = E.TRX_LINE_SUB_NUM
                    AND E.SHPG_STS_CD               IN(#arrived#, #installed#, #invoiced#)
                    AND E.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = F.GLBL_CMPY_CD
                    AND A.CPO_ORD_NUM               = F.CPO_ORD_NUM
                    AND A.CPO_DTL_LINE_NUM          = F.CPO_DTL_LINE_NUM
                    AND A.CPO_DTL_LINE_SUB_NUM      = F.CPO_DTL_LINE_SUB_NUM
                    AND F.CONV_PROC_STS_CD          IS NULL
                    AND F.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = G.GLBL_CMPY_CD
                    AND A.CPO_ORD_NUM               = G.CPO_ORD_NUM
                    AND A.CPO_DTL_LINE_NUM          = G.CPO_DTL_LINE_NUM
                    AND A.CPO_DTL_LINE_SUB_NUM      = G.CPO_DTL_LINE_SUB_NUM
                    AND G.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = H.GLBL_CMPY_CD       (+)
                    AND A.SVC_PGM_MDSE_CD           = H.MDSE_CD            (+)
                    AND H.EZCANCELFLAG          (+) = '0'
                    AND A.GLBL_CMPY_CD              = I.GLBL_CMPY_CD       (+)
                    AND A.PRNT_DS_CONTR_DTL_PK      = I.DS_CONTR_DTL_PK    (+)
                    AND I.DS_CONTR_DTL_TP_CD    (+) = #dsContrDtlTpFlt#
                    AND I.EZCANCELFLAG          (+) = '0'
                    AND I.GLBL_CMPY_CD              = J.GLBL_CMPY_CD       (+)
                    AND I.SVC_PGM_MDSE_CD           = J.MDSE_CD            (+)
                    AND J.EZCANCELFLAG          (+) = '0'
        )
        SELECT
             SVC_MACH_MSTR_PK
            ,DS_CONTR_DTL_PK
            ,CPO_ORD_NUM
            ,SVC_PGM_MDSE_CD
            ,DS_CONTR_DTL_TP_CD
            ,BASE_DPLY_PER_END_DAY
            ,MTR_DPLY_PER_END_DAY
            ,FROM_PER_MTH_NUM
            ,TO_PER_MTH_NUM
            ,PRNT_DS_CONTR_DTL_PK
            ,DS_CONTR_PK
            ,DS_CONTR_NUM
            ,DS_CONTR_CATG_CD
            ,CONTR_VRSN_EFF_FROM_DT
            ,CONTR_VRSN_EFF_THRU_DT
            ,DS_CONTR_STS_CD
            ,DS_CONTR_SRC_TP_CD
            ,DS_CONTR_CLS_CD
            ,SVC_LINE_BIZ_CD
            ,DS_CONTR_STS_NM
            ,SORT_DS_CONTR_DTL_PK
            ,ADD_CONTR_FLG
            ,USG_CHRG_FLG
            ,OVRD_MNF_WTY_FLG
            ,SVC_MACH_MSTR_STS_CD
            ,SVC_PGM_TP_CD
        FROM (
                SELECT
                     A.SVC_MACH_MSTR_PK
                    ,A.DS_CONTR_DTL_PK
                    ,A.CPO_ORD_NUM
                    ,A.SVC_PGM_MDSE_CD
                    ,A.DS_CONTR_DTL_TP_CD
                    ,A.BASE_DPLY_PER_END_DAY
                    ,A.MTR_DPLY_PER_END_DAY
                    ,A.FROM_PER_MTH_NUM
                    ,A.TO_PER_MTH_NUM
                    ,A.PRNT_DS_CONTR_DTL_PK
                    ,A.DS_CONTR_PK
                    ,A.DS_CONTR_NUM
                    ,A.DS_CONTR_CATG_CD
                    ,A.CONTR_VRSN_EFF_FROM_DT
                    ,A.CONTR_VRSN_EFF_THRU_DT
                    ,A.DS_CONTR_STS_CD
                    ,A.DS_CONTR_SRC_TP_CD
                    ,A.DS_CONTR_CLS_CD
                    ,A.SVC_LINE_BIZ_CD
                    ,A.DS_CONTR_STS_NM
                    ,A.SORT_DS_CONTR_DTL_PK
                    ,A.ADD_CONTR_FLG
                    ,A.USG_CHRG_FLG
                    ,A.OVRD_MNF_WTY_FLG
                    ,A.SVC_MACH_MSTR_STS_CD
                    ,A.SVC_PGM_TP_CD
                    ,A.DS_CONTR_DTL_TP_SORT_NUM
                FROM
                     SHELL_DTL_INFO A
                WHERE
                        A.DS_CONTR_DTL_STS_CD     = #order#
                    AND A.MAIN_UNIT_LINE_FLG      = 'Y'
                    AND A.SHPG_STS_CD             IN(#arrived#, #installed#)

                UNION ALL
                SELECT
                     A.SVC_MACH_MSTR_PK
                    ,A.DS_CONTR_DTL_PK
                    ,A.CPO_ORD_NUM
                    ,A.SVC_PGM_MDSE_CD
                    ,A.DS_CONTR_DTL_TP_CD
                    ,A.BASE_DPLY_PER_END_DAY
                    ,A.MTR_DPLY_PER_END_DAY
                    ,A.FROM_PER_MTH_NUM
                    ,A.TO_PER_MTH_NUM
                    ,A.PRNT_DS_CONTR_DTL_PK
                    ,A.DS_CONTR_PK
                    ,A.DS_CONTR_NUM
                    ,A.DS_CONTR_CATG_CD
                    ,A.CONTR_VRSN_EFF_FROM_DT
                    ,A.CONTR_VRSN_EFF_THRU_DT
                    ,A.DS_CONTR_STS_CD
                    ,A.DS_CONTR_SRC_TP_CD
                    ,A.DS_CONTR_CLS_CD
                    ,A.SVC_LINE_BIZ_CD
                    ,A.DS_CONTR_STS_NM
                    ,A.SORT_DS_CONTR_DTL_PK
                    ,A.ADD_CONTR_FLG
                    ,A.USG_CHRG_FLG
                    ,A.OVRD_MNF_WTY_FLG
                    ,A.SVC_MACH_MSTR_STS_CD
                    ,A.SVC_PGM_TP_CD
                    ,A.DS_CONTR_DTL_TP_SORT_NUM
                FROM
                     SHELL_DTL_INFO A
                WHERE
                        A.DS_CONTR_DTL_STS_CD     = #order#
                    AND A.MAIN_UNIT_LINE_FLG      = 'N'
                    AND A.SHPG_STS_CD             IN(#arrived#, #installed#)
                    AND EXISTS (
                        SELECT
                             1
                        FROM
                             SHELL_DTL_INFO  B
                        WHERE
                                B.DS_CONTR_PK         = A.DS_CONTR_PK
                            AND B.DS_CONTR_DTL_PK     = A.PRNT_DS_CONTR_DTL_PK
                            AND B.CPO_ORD_NUM         = A.CPO_ORD_NUM
                            <!-- START 2019/04/09 [QC#31134,ADD] -->
                            AND B.SVC_CONFIG_MSTR_PK  = A.SVC_CONFIG_MSTR_PK
                            <!-- END 2019/04/09 [QC#31134,ADD] -->
                            AND B.MAIN_UNIT_LINE_FLG  = 'Y'
                            AND B.SHPG_STS_CD         = #invoiced#
                        )

                UNION ALL
                SELECT
                     A.SVC_MACH_MSTR_PK
                    ,A.DS_CONTR_DTL_PK
                    ,A.CPO_ORD_NUM
                    ,A.SVC_PGM_MDSE_CD
                    ,A.DS_CONTR_DTL_TP_CD
                    ,A.BASE_DPLY_PER_END_DAY
                    ,A.MTR_DPLY_PER_END_DAY
                    ,A.FROM_PER_MTH_NUM
                    ,A.TO_PER_MTH_NUM
                    ,A.PRNT_DS_CONTR_DTL_PK
                    ,A.DS_CONTR_PK
                    ,A.DS_CONTR_NUM
                    ,A.DS_CONTR_CATG_CD
                    ,A.CONTR_VRSN_EFF_FROM_DT
                    ,A.CONTR_VRSN_EFF_THRU_DT
                    ,A.DS_CONTR_STS_CD
                    ,A.DS_CONTR_SRC_TP_CD
                    ,A.DS_CONTR_CLS_CD
                    ,A.SVC_LINE_BIZ_CD
                    ,A.DS_CONTR_STS_NM
                    ,A.SORT_DS_CONTR_DTL_PK
                    ,A.ADD_CONTR_FLG
                    ,A.USG_CHRG_FLG
                    ,A.OVRD_MNF_WTY_FLG
                    ,A.SVC_MACH_MSTR_STS_CD
                    ,A.SVC_PGM_TP_CD
                    ,A.DS_CONTR_DTL_TP_SORT_NUM
                FROM
                     SHELL_DTL_INFO A
                WHERE
                        A.DS_CONTR_DTL_STS_CD     = #order#
                    AND A.MAIN_UNIT_LINE_FLG      = 'N'
                    AND A.SHPG_STS_CD             IN(#arrived#, #installed#, #invoiced#)
                    AND EXISTS (
                        SELECT
                             1
                        FROM
                             SHELL_DTL_INFO  B
                        WHERE
                                B.DS_CONTR_PK         = A.DS_CONTR_PK
                            AND B.DS_CONTR_DTL_PK     = A.PRNT_DS_CONTR_DTL_PK
                            AND B.CPO_ORD_NUM         = A.CPO_ORD_NUM
                            <!-- START 2019/04/09 [QC#31134,ADD] -->
                            AND B.SVC_CONFIG_MSTR_PK  = A.SVC_CONFIG_MSTR_PK
                            <!-- END 2019/04/09 [QC#31134,ADD] -->
                            AND B.MAIN_UNIT_LINE_FLG  = 'Y'
                            AND B.SHPG_STS_CD         IN(#arrived#, #installed#)
                        )

                UNION ALL
                SELECT
                     A.SVC_MACH_MSTR_PK
                    ,A.DS_CONTR_DTL_PK
                    ,A.CPO_ORD_NUM
                    ,A.SVC_PGM_MDSE_CD
                    ,A.DS_CONTR_DTL_TP_CD
                    ,A.BASE_DPLY_PER_END_DAY
                    ,A.MTR_DPLY_PER_END_DAY
                    ,A.FROM_PER_MTH_NUM
                    ,A.TO_PER_MTH_NUM
                    ,A.PRNT_DS_CONTR_DTL_PK
                    ,A.DS_CONTR_PK
                    ,A.DS_CONTR_NUM
                    ,A.DS_CONTR_CATG_CD
                    ,A.CONTR_VRSN_EFF_FROM_DT
                    ,A.CONTR_VRSN_EFF_THRU_DT
                    ,A.DS_CONTR_STS_CD
                    ,A.DS_CONTR_SRC_TP_CD
                    ,A.DS_CONTR_CLS_CD
                    ,A.SVC_LINE_BIZ_CD
                    ,A.DS_CONTR_STS_NM
                    ,A.SORT_DS_CONTR_DTL_PK
                    ,A.ADD_CONTR_FLG
                    ,A.USG_CHRG_FLG
                    ,A.OVRD_MNF_WTY_FLG
                    ,A.SVC_MACH_MSTR_STS_CD
                    ,A.SVC_PGM_TP_CD
                    ,A.DS_CONTR_DTL_TP_SORT_NUM
                FROM
                     SHELL_DTL_INFO A
                WHERE
                        A.DS_CONTR_DTL_STS_CD     = #order#
                    AND A.MAIN_UNIT_LINE_FLG      = 'N'
                    AND A.SHPG_STS_CD             IN(#arrived#, #installed#)
                    AND NOT EXISTS (
                        SELECT
                             1
                        FROM
                             CPO_DTL  B
                        WHERE
                                B.GLBL_CMPY_CD    = #glblCmpyCd#
                            AND B.CPO_ORD_NUM     = A.CPO_ORD_NUM
                            <!-- START 2019/04/09 [QC#31134,ADD] -->
                            AND B.SVC_CONFIG_MSTR_PK = A.SVC_CONFIG_MSTR_PK
                            <!-- END 2019/04/09 [QC#31134,ADD] -->
                            AND B.BASE_CMPT_FLG   = 'Y'
                            AND B.EZCANCELFLAG    = '0'
                        )
        )
        ORDER BY
             CPO_ORD_NUM
            ,FROM_PER_MTH_NUM
            ,SORT_DS_CONTR_DTL_PK
            ,DS_CONTR_DTL_TP_SORT_NUM
            ,DS_CONTR_DTL_PK
    </statement>
<!-- END 2019/02/28 [QC#30503,MOD] -->

    <statement id="getShellContrNightly" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            DS_CONTR_PK
        FROM
            (
                SELECT
                     A.DS_CONTR_PK
                    ,A.CPO_ORD_NUM
                    ,A.FROM_PER_MTH_NUM
                FROM
                     DS_CONTR_DTL       A
                    ,CPO_DTL            F
                    ,SVC_MACH_MSTR      G
                WHERE
                        A.GLBL_CMPY_CD              = #glblCmpyCd#
                    AND A.DS_CONTR_DTL_STS_CD       = #order#
                    AND A.CPO_ORD_NUM               = #cpoOrdNum#
                    AND A.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = F.GLBL_CMPY_CD
                    AND A.CPO_ORD_NUM               = F.CPO_ORD_NUM
                    AND A.CPO_DTL_LINE_NUM          = F.CPO_DTL_LINE_NUM
                    AND A.CPO_DTL_LINE_SUB_NUM      = F.CPO_DTL_LINE_SUB_NUM
                    AND F.CONV_PROC_STS_CD          = #inProcess#
                    AND F.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = G.GLBL_CMPY_CD
                    AND A.CPO_ORD_NUM               = G.CPO_ORD_NUM
                    AND A.CPO_DTL_LINE_NUM          = G.CPO_DTL_LINE_NUM
                    AND A.CPO_DTL_LINE_SUB_NUM      = G.CPO_DTL_LINE_SUB_NUM
                    AND G.EZCANCELFLAG              = '0'
                GROUP BY
                     A.CPO_ORD_NUM
                    ,A.FROM_PER_MTH_NUM
                    ,A.DS_CONTR_PK
            )
        ORDER BY
             CPO_ORD_NUM
            ,FROM_PER_MTH_NUM
            ,DS_CONTR_PK
    </statement>

    <statement id="getShellContrDtlNightly" parameterClass="Map" resultClass="Map">
        SELECT
             G.SVC_MACH_MSTR_PK
            ,A.DS_CONTR_DTL_PK
            ,A.CPO_ORD_NUM
            <!-- START 2017/09/22 [QC#18534, ADD] -->
            ,NVL(A.SVC_PGM_MDSE_CD, I.SVC_PGM_MDSE_CD)  AS SVC_PGM_MDSE_CD
            <!-- END   2017/09/22 [QC#18534, ADD] -->
            ,A.DS_CONTR_DTL_TP_CD
            ,A.BASE_DPLY_PER_END_DAY
            ,A.MTR_DPLY_PER_END_DAY
            ,A.FROM_PER_MTH_NUM
            ,A.TO_PER_MTH_NUM
            ,A.PRNT_DS_CONTR_DTL_PK
            ,C.DS_CONTR_PK
            ,C.DS_CONTR_NUM
            ,C.DS_CONTR_CATG_CD
            ,C.CONTR_VRSN_EFF_FROM_DT
            ,C.CONTR_VRSN_EFF_THRU_DT
            ,C.DS_CONTR_STS_CD
            ,C.DS_CONTR_SRC_TP_CD
            ,C.DS_CONTR_CLS_CD
            ,C.SVC_LINE_BIZ_CD
            ,D.DS_CONTR_STS_NM
            ,CASE
                 WHEN A.DS_CONTR_DTL_TP_CD = #accessories# THEN A.PRNT_DS_CONTR_DTL_PK
                 ELSE A.DS_CONTR_DTL_PK
             END AS SORT_DS_CONTR_DTL_PK
            <!-- START 2017/11/08 [QC#22377, ADD] -->
            ,A.ADD_CONTR_FLG
            ,B.USG_CHRG_FLG
            <!-- END 2017/11/08 [QC#22377, ADD] -->
            <!-- START 2017/09/22 [QC#18534, ADD] -->
            ,NVL(H.OVRD_MNF_WTY_FLG, J.OVRD_MNF_WTY_FLG) AS OVRD_MNF_WTY_FLG
            <!-- END   2017/09/22 [QC#18534, ADD] -->
            <!-- add start 2017/10/06 QC#21639 -->
            ,G.SVC_MACH_MSTR_STS_CD
            <!-- add end 2017/10/06 QC#21639 -->
        FROM
             DS_CONTR_DTL       A
            ,DS_CONTR_DTL_TP    B
            ,DS_CONTR           C
            ,DS_CONTR_STS       D
            ,CPO_DTL            F
            ,SVC_MACH_MSTR      G
            <!-- START 2017/09/22 [QC#18534, ADD] -->
            ,MDSE               H
            ,DS_CONTR_DTL       I
            ,MDSE               J
            <!-- END   2017/09/22 [QC#18534, ADD] -->
        WHERE
                A.GLBL_CMPY_CD              = #glblCmpyCd#
            AND A.DS_CONTR_DTL_STS_CD       = #order#
            AND A.CPO_ORD_NUM               = #cpoOrdNum#
            AND A.DS_CONTR_PK               = #dsContrPk#
            AND A.EZCANCELFLAG              = '0'
            AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_TP_CD        = B.DS_CONTR_DTL_TP_CD
            AND B.EZCANCELFLAG              = '0'
            AND A.GLBL_CMPY_CD              = C.GLBL_CMPY_CD
            AND A.DS_CONTR_PK               = C.DS_CONTR_PK
            AND C.EZCANCELFLAG              = '0'
            AND C.GLBL_CMPY_CD              = D.GLBL_CMPY_CD
            AND C.DS_CONTR_STS_CD           = D.DS_CONTR_STS_CD
            AND D.EZCANCELFLAG              = '0'
            AND A.GLBL_CMPY_CD              = F.GLBL_CMPY_CD
            AND A.CPO_ORD_NUM               = F.CPO_ORD_NUM
            AND A.CPO_DTL_LINE_NUM          = F.CPO_DTL_LINE_NUM
            AND A.CPO_DTL_LINE_SUB_NUM      = F.CPO_DTL_LINE_SUB_NUM
<!-- QC#56136 Mod Start  -->
            <!-- AND F.CONV_PROC_STS_CD          = #inProcess# -->
            AND ( F.CONV_PROC_STS_CD = #inProcess# 
                  OR F.CONV_PROC_STS_CD IS NULL )
<!-- QC#56136 Mod End  -->
            AND F.EZCANCELFLAG              = '0'
            AND A.GLBL_CMPY_CD              = G.GLBL_CMPY_CD
            AND A.CPO_ORD_NUM               = G.CPO_ORD_NUM
            AND A.CPO_DTL_LINE_NUM          = G.CPO_DTL_LINE_NUM
            AND A.CPO_DTL_LINE_SUB_NUM      = G.CPO_DTL_LINE_SUB_NUM
            AND G.EZCANCELFLAG              = '0'
            <!-- START 2017/09/22 [QC#18534, ADD] -->
            AND A.GLBL_CMPY_CD              = H.GLBL_CMPY_CD       (+)
            AND A.SVC_PGM_MDSE_CD           = H.MDSE_CD            (+)
            AND H.EZCANCELFLAG          (+) = '0'
            AND A.GLBL_CMPY_CD              = I.GLBL_CMPY_CD       (+)
            AND A.PRNT_DS_CONTR_DTL_PK      = I.DS_CONTR_DTL_PK    (+)
            AND I.DS_CONTR_DTL_TP_CD    (+) = #dsContrDtlTpFlt#
            AND I.EZCANCELFLAG          (+) = '0'
            AND I.GLBL_CMPY_CD              = J.GLBL_CMPY_CD       (+)
            AND I.SVC_PGM_MDSE_CD           = J.MDSE_CD            (+)
            AND J.EZCANCELFLAG          (+) = '0'
            <!-- END   2017/09/22 [QC#18534, ADD] -->
        ORDER BY
             CPO_ORD_NUM
            ,FROM_PER_MTH_NUM
            ,SORT_DS_CONTR_DTL_PK
            ,DS_CONTR_DTL_TP_SORT_NUM
            ,DS_CONTR_DTL_PK
    </statement>

    <statement id="getStartDtForNewContr" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_ORD_CATG_CD
            ,SUBSTR(A.ORD_BOOK_TS, 1, #dtLen#)  AS START_DT_BY_BOOK
            ,CASE
                WHEN A.CPO_ORD_TS IS NOT NULL AND A.CPO_ORD_TS &gt; #salesDate# THEN A.CPO_ORD_TS
                ELSE #salesDate#
             END                                AS START_DT_BY_ORD
            <!-- START 2019/06/17 W.Honda [QC#50842, ADD] -->
            ,A.DS_ORD_TP_CD
            <!-- END 2019/06/17 W.Honda [QC#50842, ADD] -->
        FROM
            CPO       A
        WHERE
                A.GLBL_CMPY_CD    = #glblCmpyCd#
            AND A.CPO_ORD_NUM     = #cpoOrdNum#
            AND A.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getStartDtForAddContr" parameterClass="Map" resultClass="String">
        SELECT
            B.CONTR_EFF_FROM_DT
        FROM
             DS_CONTR             A
            ,DS_CONTR_DTL         B
            ,DS_CONTR_EXCL_STS    C
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_PK          = #dsContrPk#
            AND A.EZCANCELFLAG         = '0'
            AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK          = B.DS_CONTR_PK 
            AND B.EZCANCELFLAG         = '0'
            AND A.GLBL_CMPY_CD         = C.GLBL_CMPY_CD
            AND A.DS_CONTR_STS_CD      = C.DS_CONTR_STS_CD 
            AND B.DS_CONTR_DTL_STS_CD  = C.DS_CONTR_DTL_STS_CD 
            AND C.ENBL_FLG             = 'Y'
            AND C.EZCANCELFLAG         = '0'
    </statement>

    <!-- START 2017/07/27 K.Kasai [QC#18882, ADD] -->
    <statement id="getStartDtForAddContrForFlt" parameterClass="Map" resultClass="String">
        SELECT
            MAX(A.ACTL_ARV_DT)
        FROM
             SHPG_PLN             A
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.TRX_HDR_NUM          = #cpoOrdNum#
            AND A.ACTL_ARV_DT          IS NOT NULL
            AND A.EZCANCELFLAG         = '0'
    </statement>
    <statement id="getEffDtFromOthContrDtlForFlt" parameterClass="Map" resultClass="Map">
        SELECT
            MAX(A.CONTR_EFF_FROM_DT)   AS MAX_CONTR_EFF_FROM_DT
           ,MAX(A.CONTR_EFF_THRU_DT)   AS MAX_CONTR_EFF_THRU_DT
        FROM
             DS_CONTR_DTL         A
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_PK          = #dsContrPk#
            AND A.CONTR_EFF_FROM_DT    IS NOT NULL
            AND A.EZCANCELFLAG         = '0'
    </statement>
    <statement id="getDsContrDtlFromDtIsNotNull" parameterClass="Map" resultClass="Map">
        SELECT
            A.DS_CONTR_DTL_PK
        FROM
             DS_CONTR_DTL         A
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_PK          = #dsContrPk#
            AND A.CONTR_EFF_FROM_DT    IS NOT NULL
            AND A.EZCANCELFLAG         = '0'
    </statement>
    <statement id="getContrVldErrorWithoutAllArvMachChk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             DS_CONTR_VLD_RSLT_WRK       A
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_PK          = #dsContrPk#
            AND A.DS_CONTR_VLD_PK      &lt;&gt; #dsContrVldPk#
            AND A.DS_CONTR_VLD_STS_CD  &lt;&gt; #dsContrVldStsCd#
            AND A.EZCANCELFLAG         = '0'
    </statement>
    <!-- END 2017/07/27 K.Kasai [QC#18882, ADD] -->
    <!-- START 2017/09/22 [QC#18534, ADD] -->
    <!--
    <statement id="countContrVldErrorWithoutMachInstlChk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             DS_CONTR_VLD_RSLT_WRK       A
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_PK          = #dsContrPk#
            AND A.DS_CONTR_DTL_PK      = #dsContrDtlPk#
            AND A.DS_CONTR_VLD_PK      &lt;&gt; #dsContrVldPk#
            AND A.DS_CONTR_VLD_STS_CD  &lt;&gt; #dsContrVldStsCd#
            AND A.EZCANCELFLAG         = '0'
    </statement>
     -->
    <!-- END   2017/09/22 [QC#18534, ADD] -->

    <statement id="countOrdCatgBizCtx" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            ORD_CATG_BIZ_CTX     A
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_ORD_CATG_CD       = #dsOrdCatgCd#
            <!-- START 2019/06/17 W.Honda [QC#50842, ADD] -->
            AND (A.DS_ORD_TP_CD        = #dsOrdTpCd#
                OR  A.DS_ORD_TP_CD     IS NULL)
            <!-- END 2019/06/17 W.Honda [QC#50842, ADD] -->
            AND A.ORD_CATG_CTX_TP_CD   = #ordCatgCtxTpCd#
            AND A.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getEffThruDtByWtyContr" parameterClass="Map" resultClass="String">
        SELECT
            A.CONTR_EFF_THRU_DT
        FROM
             DS_CONTR_DTL        A
            ,DS_CONTR            B
        WHERE
                A.GLBL_CMPY_CD        = #glblCmpyCd#
            AND A.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
            <iterate property="dsContrDtlStsCdList" var="dsContrDtlStsCd[]" open="AND A.DS_CONTR_DTL_STS_CD NOT IN (" close=")" conjunction=",">
                #dsContrDtlStsCd[]#
            </iterate>
            AND A.EZCANCELFLAG        = '0'
            AND A.GLBL_CMPY_CD        = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK         = B.DS_CONTR_PK
            AND B.DS_CONTR_CATG_CD    = #warranty#
            <iterate property="dsContrStsCdList" var="dsContrStsCd[]" open="AND B.DS_CONTR_STS_CD NOT IN (" close=")" conjunction=",">
                #dsContrStsCd[]#
            </iterate>
            AND B.EZCANCELFLAG        = '0'
    </statement>

    <statement id="getEffThruDtByWtyIntfc" parameterClass="Map" resultClass="String">
        SELECT
            A.CONTR_THRU_DT
        FROM
            DS_CONTR_INTFC      A
        WHERE
                A.GLBL_CMPY_CD           = #glblCmpyCd#
            AND A.SVC_MACH_MSTR_PK       = #svcMachMstrPk#
            AND A.DS_CONTR_CATG_CD       = #warranty#
            AND A.DS_CONTR_INTFC_STS_CD  &lt;&gt; #success#
            AND A.EZCANCELFLAG           = '0'
    </statement>

    <statement id="addMonths" parameterClass="Map" resultClass="String">
        SELECT
            TO_CHAR(ADD_MONTHS(TO_DATE(#targetDate#, #dateFormat#), TO_NUMBER(#addMth#)), #dateFormat#)
        FROM
            DUAL
    </statement>

    <statement id="getSvcPhysMtrPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.SVC_PHYS_MTR_PK
        FROM
            SVC_PHYS_MTR      A
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.SVC_MACH_MSTR_PK     = #svcMachMstrPk#
            AND A.MDL_MTR_LB_CD        = #mtrLbCd#
            AND A.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getEffDtByDsContrDtl" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_PK
            ,MIN(A.CONTR_EFF_FROM_DT)  AS CONTR_EFF_FROM_DT
            ,MAX(A.CONTR_EFF_THRU_DT)  AS CONTR_EFF_THRU_DT
        FROM
            DS_CONTR_DTL       A
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_PK          = #dsContrPk#
            <iterate property="dsContrDtlStsCdList" var="dsContrDtlStsCd[]" open="AND A.DS_CONTR_DTL_STS_CD NOT IN (" close=")" conjunction=",">
                #dsContrDtlStsCd[]#
            </iterate>
            <!-- START 2017/09/22 [QC#18534, ADD] -->
            AND A.DS_CONTR_DTL_TP_CD   NOT IN (#fleet#, #aggregate#)
            <!-- END 2017/09/22 [QC#18534, ADD] -->
            AND A.EZCANCELFLAG         = '0'
        GROUP BY
            A.DS_CONTR_PK
    </statement>

    <statement id="getDsContrDtlPkFltAggLine" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.DS_CONTR_DTL_PK
        FROM
            DS_CONTR_DTL      A
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_PK          = #dsContrPk#
            AND A.DS_CONTR_DTL_TP_CD   IN (#fleet#, #aggregate#)
            AND A.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getSvcPhysMtr" parameterClass="Map" resultClass="Map">
        <!-- START 2017/06/26 K.Kojima [QC#18532, ADD] -->
        SELECT
             SVC_PHYS_MTR_PK
            ,READ_MTR_CNT
        FROM
            (
        <!-- END 2017/06/26 K.Kojima [QC#18532, ADD] -->
        SELECT
             SVC_PHYS_MTR_PK
            ,NVL(READ_MTR_CNT, START_MTR_CNT) AS READ_MTR_CNT
        FROM
            (
             SELECT
                  A.SVC_PHYS_MTR_PK
                 ,C.READ_MTR_CNT
                 ,B.START_MTR_CNT
                 ,ROW_NUMBER() OVER (PARTITION BY A.SVC_PHYS_MTR_PK ORDER BY C.MTR_READ_DT DESC, C.SVC_PHYS_MTR_READ_GRP_SQ DESC) AS ROW_NUM
             FROM
                  SVC_PHYS_MTR       A
                 ,START_READ_MAP     B
                 ,SVC_PHYS_MTR_READ  C
             WHERE
                     A.GLBL_CMPY_CD         = #glblCmpyCd#
                 AND A.SVC_MACH_MSTR_PK     = #svcMachMstrPk#
                 AND A.ACTV_FLG             = 'Y'
                 AND A.EZCANCELFLAG         = '0'
                 AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD    (+)
                 AND A.MDL_MTR_LB_CD        = B.MTR_LB_CD       (+)
<!-- add start 2017/09/15 QC#19775 -->
                 AND A.MTR_GRP_PK           = B.MTR_GRP_PK      (+)
<!-- add end 2017/09/15 QC#19775 -->
                 AND B.EZCANCELFLAG (+)     = '0'
                 AND A.GLBL_CMPY_CD         = C.GLBL_CMPY_CD    (+)
                 AND A.SVC_PHYS_MTR_PK      = C.SVC_PHYS_MTR_PK (+)
                 AND C.VLD_MTR_FLG  (+)     = 'Y'
                 AND C.EZCANCELFLAG (+)     = '0'
<!-- START 2017/09/22 [QC#18534, DEL] -->
<!--
                 AND NOT EXISTS (
                         SELECT
                             1
                         FROM
                             SVC_PHYS_MTR_READ  D
                         WHERE
                                 D.GLBL_CMPY_CD        = A.GLBL_CMPY_CD
                             AND D.SVC_PHYS_MTR_PK     = A.SVC_PHYS_MTR_PK
                             AND D.DS_CONTR_DTL_PK     = #dsContrDtlPk#
                             AND D.EZCANCELFLAG        = '0'
                     )
-->
<!-- END 2017/09/22 [QC#18534, DEL] -->
            )
        WHERE
            ROW_NUM = 1
        <!-- START 2017/06/26 K.Kojima [QC#18532, ADD] -->
            )
        WHERE
            READ_MTR_CNT IS NOT NULL
        <!-- END 2017/06/26 K.Kojima [QC#18532, ADD] -->
        ORDER BY
            SVC_PHYS_MTR_PK
    </statement>

    <!-- add start 2017/08/08 QC#18799 -->
    <statement id="getSvcPhysMtrIstlCall" parameterClass="Map" resultClass="Map">
        SELECT
             SVC_PHYS_MTR_PK
            ,READ_MTR_CNT
            ,MTR_READ_DT
        FROM
            (
             SELECT
                  A.SVC_PHYS_MTR_PK
                 ,C.READ_MTR_CNT
                 ,C.MTR_READ_DT
                 ,ROW_NUMBER() OVER (PARTITION BY A.SVC_PHYS_MTR_PK ORDER BY C.MTR_READ_DT DESC, C.SVC_PHYS_MTR_READ_GRP_SQ DESC) AS ROW_NUM
             FROM
                  SVC_PHYS_MTR       A
                 ,SVC_PHYS_MTR_READ  C
                 ,FSR                E
             WHERE
                     A.GLBL_CMPY_CD         = #glblCmpyCd#
                 AND A.SVC_MACH_MSTR_PK     = #svcMachMstrPk#
                 AND A.ACTV_FLG             = 'Y'
                 AND A.EZCANCELFLAG         = '0'
                 AND A.GLBL_CMPY_CD         = C.GLBL_CMPY_CD
                 AND A.SVC_PHYS_MTR_PK      = C.SVC_PHYS_MTR_PK
                 AND C.VLD_MTR_FLG          = 'Y'
                 AND C.DS_CONTR_DTL_PK      IS NULL
                 AND C.EZCANCELFLAG         = '0'
                 AND C.GLBL_CMPY_CD         = E.GLBL_CMPY_CD
                 AND C.FSR_NUM              = E.FSR_NUM
                 AND E.FSR_TP_CD            = #fsrTpCd#
                 AND E.EZCANCELFLAG         = '0'
<!-- START 2017/10/24 U.Kim [QC#21864, ADD] -->
                 AND E.FSR_CRAT_DT          &gt;= #cpoOrdTs#
<!-- END 2017/10/24 U.Kim [QC#21864, ADD] -->
<!-- START 2017/09/22 [QC#18534, DEL] -->
<!--
                 AND NOT EXISTS (
                         SELECT
                             1
                         FROM
                             SVC_PHYS_MTR_READ  D
                         WHERE
                                 D.GLBL_CMPY_CD        = A.GLBL_CMPY_CD
                             AND D.SVC_PHYS_MTR_PK     = A.SVC_PHYS_MTR_PK
                             AND D.DS_CONTR_DTL_PK     = #dsContrDtlPk#
                             AND D.EZCANCELFLAG        = '0'
                     )
-->
<!-- END 2017/09/22 [QC#18534, DEL] -->
            )
        WHERE
            ROW_NUM = 1
        ORDER BY
            SVC_PHYS_MTR_PK
    </statement>
    <!-- add end 2017/08/08 QC#18799 -->

    <statement id="getDsContrDtlPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.DS_CONTR_DTL_PK
        FROM
             DS_CONTR_DTL        A
            ,DS_CONTR_DTL_STS_V  B
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_PK          = #dsContrPk#
            AND A.EZCANCELFLAG         = '0'
            AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK      = B.DS_CONTR_DTL_PK
            <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCd[]" open="AND B.DS_CONTR_CTRL_STS_CD NOT IN (" close=")" conjunction=",">
                #dsContrCtrlStsCd[]#
            </iterate>
            AND B.EZCANCELFLAG         = '0'
        ORDER BY
            A.DS_CONTR_DTL_PK
    </statement>

    <statement id="getDsContrBllgMtrPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.DS_CONTR_BLLG_MTR_PK
        FROM
             DS_CONTR_BLLG_MTR        A
            ,DS_CONTR_BLLG_MTR_STS_V  B
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_DTL_PK      = #dsContrDtlPk#
            AND A.EZCANCELFLAG         = '0'
            AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD
            AND A.DS_CONTR_BLLG_MTR_PK = B.DS_CONTR_BLLG_MTR_PK
            <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCd[]" open="AND B.DS_CONTR_CTRL_STS_CD NOT IN (" close=")" conjunction=",">
                #dsContrCtrlStsCd[]#
            </iterate>
            AND B.EZCANCELFLAG         = '0'
        ORDER BY
            A.DS_CONTR_BLLG_MTR_PK
    </statement>

    <statement id="getDsContrPrcEffPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.DS_CONTR_PRC_EFF_PK
        FROM
             DS_CONTR_PRC_EFF        A
            ,DS_CONTR_PRC_EFF_STS_V  B
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_DTL_PK      = #dsContrDtlPk#
            AND A.EZCANCELFLAG         = '0'
            AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PRC_EFF_PK  = B.DS_CONTR_PRC_EFF_PK
            <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCd[]" open="AND B.DS_CONTR_CTRL_STS_CD NOT IN (" close=")" conjunction=",">
                #dsContrCtrlStsCd[]#
            </iterate>
            AND B.EZCANCELFLAG         = '0'
        ORDER BY
            A.DS_CONTR_PRC_EFF_PK
    </statement>

    <statement id="getOrdSchInfo" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_PK
            ,A.DS_CONTR_NUM
            ,A.DS_CONTR_SQ_NUM
            ,B.DS_CONTR_DTL_PK
            ,B.CONTR_EFF_FROM_DT
            ,B.CONTR_EFF_THRU_DT
            ,B.CPO_ORD_NUM
            ,C.SVC_MACH_MSTR_PK
            ,C.SER_NUM
            ,C.MDSE_CD
            ,D.SVC_CONFIG_MSTR_PK
            ,D.MDL_ID
        FROM
             DS_CONTR         A
            ,DS_CONTR_DTL     B
            ,SVC_MACH_MSTR    C
            ,SVC_CONFIG_MSTR  D
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_PK          = #dsContrPk#
            AND A.EZCANCELFLAG         = '0'
            AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK          = B.DS_CONTR_PK
<!-- START 2017/10/24 U.Kim [QC#21865, ADD] -->
            AND A.DS_CONTR_CATG_CD     &lt;&gt; #dsContrCatgCdWty#
<!-- END 2017/10/24 U.Kim [QC#21865, ADD] -->
            AND B.EZCANCELFLAG         = '0'
            AND B.GLBL_CMPY_CD         = C.GLBL_CMPY_CD
            AND B.SVC_MACH_MSTR_PK     = C.SVC_MACH_MSTR_PK
            AND C.SVC_MACH_TP_CD       = #machine#
<!-- START 2017/10/24 U.Kim [QC#21865, ADD] -->
            AND C.SVC_MACH_MSTR_STS_CD = #installed#
<!-- END 2017/10/24 U.Kim [QC#21865, ADD] -->
            AND C.EZCANCELFLAG         = '0'
            AND C.GLBL_CMPY_CD         = D.GLBL_CMPY_CD
            AND C.SVC_CONFIG_MSTR_PK   = D.SVC_CONFIG_MSTR_PK
            AND D.EZCANCELFLAG        = '0'
<!-- START 2017/10/24 U.Kim [QC#21865, ADD] -->
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                    SCHD_AGMT E
                WHERE
                    E.GLBL_CMPY_CD       = A.GLBL_CMPY_CD
                AND E.DS_CONTR_NUM       = A.DS_CONTR_NUM
                AND E.SVC_CONFIG_MSTR_PK = D.SVC_CONFIG_MSTR_PK
                AND E.EZCANCELFLAG       = '0'
            )
<!-- END 2017/10/24 U.Kim [QC#21865, ADD] -->
       ORDER BY
            B.DS_CONTR_DTL_PK
    </statement>

    <statement id="getConvOrdByCpoOrdNum" parameterClass="Map" resultClass="Map">
        SELECT
             A.CPO_ORD_NUM
            ,A.CPO_DTL_LINE_NUM
            ,A.CPO_DTL_LINE_SUB_NUM
        FROM
            CPO_DTL A
        WHERE
                A.GLBL_CMPY_CD       = #glblCmpyCd#
            AND A.CONV_PROC_STS_CD   = #inProcess#
            AND A.CPO_ORD_NUM        = #cpoOrdNum#
            AND A.EZCANCELFLAG       = '0'
        ORDER BY
             A.CPO_ORD_NUM
            ,A.CPO_DTL_LINE_NUM
            ,A.CPO_DTL_LINE_SUB_NUM
    </statement>

    <statement id="getBasePrcDealAmtForFlt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            NVL(SUM(A.BASE_PRC_DEAL_AMT), 0)
        FROM
            DS_CONTR_DTL A
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_PK          = #dsContrPk#
            AND A.CPO_ORD_NUM          = #cpoOrdNum#
            AND A.DS_CONTR_DTL_TP_CD   = #shell#
            AND A.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getBasePrcDealAmtForAgg" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            NVL(SUM(A.BASE_PRC_DEAL_AMT), 0)
        FROM
            DS_CONTR_DTL A
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_PK          = #dsContrPk#
            AND A.DS_CONTR_DTL_TP_CD   NOT IN (#aggregate#, #shell#)
            AND A.DS_CONTR_DTL_STS_CD  NOT IN (#terminated#, #expired#, #cancelled#, #order#)
            AND A.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getMaxContrEffThruDt" parameterClass="Map" resultClass="String">
        SELECT
            MAX(B.CONTR_VRSN_EFF_THRU_DT)
        FROM
             DS_CONTR_DTL A
            ,DS_CONTR     B
        WHERE
                A.GLBL_CMPY_CD            = #glblCmpyCd#
            AND A.CPO_ORD_NUM             = #cpoOrdNum#
            AND A.SVC_MACH_MSTR_PK        = #svcMachMstrPk#
            AND A.EZCANCELFLAG            = '0'
            AND A.GLBL_CMPY_CD            = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK             = B.DS_CONTR_PK
            AND B.DS_CONTR_CATG_CD &lt;&gt; #dsContrCatg#
            AND B.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getBasePrcTermDealAmtRate" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            BASE_PRC_DEAL_AMT * MULTIPLY AS BASE_PRC_TERM_DEAL_AMT_RATE
        FROM
            (
                SELECT
                     NVL(A.BASE_PRC_DEAL_AMT, 0) AS BASE_PRC_DEAL_AMT
                    ,(
                        CASE 
                            WHEN B.BASE_BLLG_CYCLE_CD = #baseBllgCycleCd# THEN
                                (A.TO_PER_MTH_NUM - A.FROM_PER_MTH_NUM + 1)
                            ELSE
                                (A.TO_PER_MTH_NUM - A.FROM_PER_MTH_NUM + 1) / NVL(C.BLLG_CYCLE_MTH_AOT, 1)
                        END
                     ) AS MULTIPLY
                FROM
                     DS_CONTR_DTL A
                    ,DS_CONTR     B
                    ,BLLG_CYCLE   C
                WHERE
                    A.GLBL_CMPY_CD       = #glblCmpyCd#
                AND A.DS_CONTR_DTL_PK    = #dsContrDtlPk#
                AND A.EZCANCELFLAG       = '0'
                AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD
                AND A.DS_CONTR_PK        = B.DS_CONTR_PK
                AND B.EZCANCELFLAG       = '0'
                AND B.GLBL_CMPY_CD       = C.GLBL_CMPY_CD
                AND B.BASE_BLLG_CYCLE_CD = C.BLLG_CYCLE_CD
                AND C.EZCANCELFLAG       = '0'
            )
    </statement>

    <!-- START 2017/07/11 K.Kojima [QC#19822,MOD] -->
    <!-- <statement id="getBasePrcTermDealAmtRateForFltLine" parameterClass="Map" resultClass="BigDecimal"> -->
    <statement id="getBasePrcTermDealAmtRateForFltAggLine" parameterClass="Map" resultClass="BigDecimal">
    <!-- END 2017/07/11 K.Kojima [QC#19822,MOD] -->
        SELECT
            BASE_PRC_DEAL_AMT * MULTIPLY AS BASE_PRC_TERM_DEAL_AMT_RATE
        FROM
            (
                SELECT
                     NVL(#basePrcDealAmt#, 0) AS BASE_PRC_DEAL_AMT
                    ,(
                        CASE 
                            WHEN B.BASE_BLLG_CYCLE_CD = #baseBllgCycleCd# THEN
                                (A.TO_PER_MTH_NUM - A.FROM_PER_MTH_NUM + 1)
                            ELSE
                                (A.TO_PER_MTH_NUM - A.FROM_PER_MTH_NUM + 1) / NVL(C.BLLG_CYCLE_MTH_AOT, 1)
                        END
                     ) AS MULTIPLY
                FROM
                     DS_CONTR_DTL A
                    ,DS_CONTR     B
                    ,BLLG_CYCLE   C
                WHERE
                    A.GLBL_CMPY_CD       = #glblCmpyCd#
                AND A.DS_CONTR_DTL_PK    = #dsContrDtlPk#
                AND A.EZCANCELFLAG       = '0'
                AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD
                AND A.DS_CONTR_PK        = B.DS_CONTR_PK
                AND B.EZCANCELFLAG       = '0'
                AND B.GLBL_CMPY_CD       = C.GLBL_CMPY_CD
                AND B.BASE_BLLG_CYCLE_CD = C.BLLG_CYCLE_CD
                AND C.EZCANCELFLAG       = '0'
            )
    </statement>

    <!-- Mod Start 2017/11/14 QC#22526 -->
    <statement id="getActiveDetailList" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.DS_CONTR_DTL_PK
            ,CASE
                WHEN A.DS_CONTR_DTL_TP_CD = #accessories# THEN A.PRNT_DS_CONTR_DTL_PK
                ELSE A.DS_CONTR_DTL_PK
            END AS SORT_DS_CONTR_DTL_PK
        FROM
            DS_CONTR_DTL      A
           ,DS_CONTR_DTL_TP   B
        WHERE
                A.GLBL_CMPY_CD = #glblCmpyCd#
            AND A.DS_CONTR_PK  = #dsContrPk#
            <iterate property="dsContrDtlTpCdList" var="dsContrDtlTpCd[]" open="AND A.DS_CONTR_DTL_TP_CD NOT IN (" close=")" conjunction=",">
            #dsContrDtlTpCd[]#
            </iterate>
            <iterate property="dsContrDtlStsCdList" var="dsContrDtlStsCd[]" open="AND A.DS_CONTR_DTL_STS_CD NOT IN (" close=")" conjunction=",">
            #dsContrDtlStsCd[]#
            </iterate>
            <iterate property="dsContrDtlPkList" var="dsContrDtlPk[]" open="AND A.DS_CONTR_DTL_PK NOT IN (" close=")" conjunction=",">
            #dsContrDtlPk[]#
            </iterate>
            AND A.EZCANCELFLAG = '0'
            AND A.GLBL_CMPY_CD = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_TP_CD = B.DS_CONTR_DTL_TP_CD
            AND B.EZCANCELFLAG = '0'
        ORDER BY 
            SORT_DS_CONTR_DTL_PK
           ,DS_CONTR_DTL_TP_SORT_NUM
    </statement>
    <!-- Mod End   2017/11/14 QC#22526 -->

    <statement id="getActiveBllgMtrList" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            B.DS_CONTR_BLLG_MTR_PK
        FROM
             DS_CONTR_DTL A
            ,DS_CONTR_BLLG_MTR B
        WHERE
                A.GLBL_CMPY_CD = #glblCmpyCd#
            AND A.DS_CONTR_PK  = #dsContrPk#
            <iterate property="dsContrDtlTpCdList" var="dsContrDtlTpCd[]" open="AND A.DS_CONTR_DTL_TP_CD NOT IN (" close=")" conjunction=",">
            #dsContrDtlTpCd[]#
            </iterate>
            <iterate property="dsContrDtlStsCdList" var="dsContrDtlStsCd[]" open="AND A.DS_CONTR_DTL_STS_CD NOT IN (" close=")" conjunction=",">
            #dsContrDtlStsCd[]#
            </iterate>
            <iterate property="dsContrDtlPkList" var="dsContrDtlPk[]" open="AND A.DS_CONTR_DTL_PK NOT IN (" close=")" conjunction=",">
            #dsContrDtlPk[]#
            </iterate>
            AND A.GLBL_CMPY_CD    = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK = B.DS_CONTR_DTL_PK
            AND A.EZCANCELFLAG    = '0'
            AND B.EZCANCELFLAG    = '0'
    </statement>
    <!-- START 2017/09/22 [QC#18534, ADD] -->
    <!-- del start 2017/10/06 QC#21639 -->
    <!--
    <statement id="getFsrNumForNotInstl" parameterClass="Map" resultClass="String">
        SELECT
            A.FSR_NUM
        FROM
             FSR           A
            ,SVC_TASK      B
            ,DS_COND_CONST C
        WHERE
            A.GLBL_CMPY_CD         =  #glblCmpyCd#
        AND A.SVC_MACH_MSTR_PK     =  #svcMachMstrPk#
        AND A.FSR_STS_CD           &lt;&gt; #fsrStsCd#
        AND A.FSR_CPLT_DT          IS NULL
        AND A.EZCANCELFLAG         =  '0'
        AND A.GLBL_CMPY_CD         =  B.GLBL_CMPY_CD
        AND A.FSR_NUM              =  B.FSR_NUM
        AND B.EZCANCELFLAG         =  '0'
        AND B.GLBL_CMPY_CD         =  C.GLBL_CMPY_CD
        AND B.DS_SVC_CALL_TP_CD    =  C.DS_COND_CONST_CD
        AND C.DS_COND_CONST_GRP_ID =  #dsCondConstGrpId#
        AND C.EZCANCELFLAG         =  '0'
        ORDER BY
            A.FSR_CRAT_DT ASC
    </statement>
    -->
    <!-- del end 2017/10/06 QC#21639 -->

    <!-- mod start 2017/10/06 QC#21639 -->
    <statement id="getContrHdrForInstlComp" parameterClass="Map" resultClass="BigDecimal">
        SELECT DISTINCT
            B.DS_CONTR_PK
        FROM
             WAIT_ISTL_CONTR  A
            ,DS_CONTR_DTL     B
            ,SVC_MACH_MSTR    C
            ,DS_CONTR         D
        WHERE
            A.GLBL_CMPY_CD            =  #glblCmpyCd#
        AND A.EZCANCELFLAG            =  '0'
        AND A.GLBL_CMPY_CD            =  B.GLBL_CMPY_CD
        AND A.DS_CONTR_DTL_PK         =  B.DS_CONTR_DTL_PK
        AND B.EZCANCELFLAG            =  '0'
        AND B.GLBL_CMPY_CD            =  C.GLBL_CMPY_CD
        AND B.SVC_MACH_MSTR_PK        =  C.SVC_MACH_MSTR_PK
        AND C.SVC_MACH_MSTR_STS_CD    =  #installed#
        AND C.ISTL_DT                 IS NOT NULL
        AND C.EZCANCELFLAG            =  '0'
        AND B.GLBL_CMPY_CD            =  D.GLBL_CMPY_CD
        AND B.DS_CONTR_PK             =  D.DS_CONTR_PK
        AND D.EZCANCELFLAG            =  '0'
        <isEqual property="warrantyFlg" compareValue="Y">
        AND D.DS_CONTR_CATG_CD        = #warranty#
        </isEqual>
        <isEqual property="warrantyFlg" compareValue="N">
        AND D.DS_CONTR_CATG_CD        &lt;&gt; #warranty#
        </isEqual>
        ORDER BY
             B.DS_CONTR_PK
    </statement>
    <!-- mod end 2017/10/06 QC#21639 -->

    <!-- mod start 2017/10/06 QC#21639 -->
    <statement id="getContrDtlForInstlComp" parameterClass="Map" resultClass="Map">
        SELECT
             B.SVC_MACH_MSTR_PK
            ,B.DS_CONTR_DTL_PK
            ,B.DS_CONTR_DTL_STS_CD
            ,C.ISTL_DT
            ,C.MDSE_CD
            ,D.CPO_ORD_NUM
            ,NVL(B.SVC_PGM_MDSE_CD, F.SVC_PGM_MDSE_CD)   AS SVC_PGM_MDSE_CD
            ,B.DS_CONTR_DTL_TP_CD
            ,B.BASE_DPLY_PER_END_DAY
            ,B.MTR_DPLY_PER_END_DAY
            ,B.FROM_PER_MTH_NUM
            ,B.TO_PER_MTH_NUM
            ,B.PRNT_DS_CONTR_DTL_PK
            ,H.DS_CONTR_PK
            ,H.DS_CONTR_NUM
            ,H.DS_CONTR_CATG_CD
            ,H.CONTR_VRSN_EFF_FROM_DT
            ,H.CONTR_VRSN_EFF_THRU_DT
            ,H.DS_CONTR_STS_CD
            ,H.DS_CONTR_SRC_TP_CD
            ,H.DS_CONTR_CLS_CD
            ,H.SVC_LINE_BIZ_CD
            ,I.DS_CONTR_STS_NM
            ,B.ADD_CONTR_FLG
            ,J.USG_CHRG_FLG
            ,D.DS_ORD_CATG_CD
            ,NVL(E.OVRD_MNF_WTY_FLG, G.OVRD_MNF_WTY_FLG) AS OVRD_MNF_WTY_FLG
            <!-- add start 2017/11/08 QC#22377 -->
            ,C.SVC_MACH_MSTR_STS_CD
            <!-- add end 2017/11/08 QC#22377 -->
            <!-- START 2018/05/09 K.Kitachi [QC#25728, ADD] -->
            ,NVL(E.SVC_PGM_TP_CD, G.SVC_PGM_TP_CD) AS SVC_PGM_TP_CD
            <!-- END 2018/05/09 K.Kitachi [QC#25728, ADD] -->
            <!-- START 2018/08/24 K.Kojima [QC#27919, ADD] -->
            ,CASE
                 WHEN B.DS_CONTR_DTL_TP_CD = #accessories# THEN B.PRNT_DS_CONTR_DTL_PK
                 ELSE B.DS_CONTR_DTL_PK
             END AS SORT_DS_CONTR_DTL_PK
            <!-- END 2018/08/24 K.Kojima [QC#27919, ADD] -->
        FROM
             WAIT_ISTL_CONTR  A
            ,DS_CONTR_DTL     B
            ,SVC_MACH_MSTR    C
            ,CPO              D
            ,MDSE             E
            ,DS_CONTR_DTL     F
            ,MDSE             G
            ,DS_CONTR         H
            ,DS_CONTR_STS     I
            ,DS_CONTR_DTL_TP  J
        WHERE
            A.GLBL_CMPY_CD            =  #glblCmpyCd#
        AND A.EZCANCELFLAG            =  '0'
        AND A.GLBL_CMPY_CD            =  B.GLBL_CMPY_CD
        AND A.DS_CONTR_DTL_PK         =  B.DS_CONTR_DTL_PK
        AND B.DS_CONTR_PK             =  #dsContrPk#
        AND B.EZCANCELFLAG            =  '0'
        AND B.GLBL_CMPY_CD            =  C.GLBL_CMPY_CD
        AND B.SVC_MACH_MSTR_PK        =  C.SVC_MACH_MSTR_PK
        AND C.SVC_MACH_MSTR_STS_CD    =  #installed#
        AND C.ISTL_DT                 IS NOT NULL
        AND C.EZCANCELFLAG            =  '0'
        AND B.GLBL_CMPY_CD            =  D.GLBL_CMPY_CD
        AND B.CPO_ORD_NUM             =  D.CPO_ORD_NUM
        AND D.EZCANCELFLAG            =  '0'
        AND B.GLBL_CMPY_CD            =  E.GLBL_CMPY_CD    (+)
        AND B.SVC_PGM_MDSE_CD         =  E.MDSE_CD         (+)
        AND E.EZCANCELFLAG        (+) =  '0'
        AND B.GLBL_CMPY_CD            =  F.GLBL_CMPY_CD    (+)
        AND B.PRNT_DS_CONTR_DTL_PK    =  F.DS_CONTR_DTL_PK (+)
        AND F.EZCANCELFLAG        (+) =  '0'
        AND F.GLBL_CMPY_CD            =  G.GLBL_CMPY_CD    (+)
        AND F.SVC_PGM_MDSE_CD         =  G.MDSE_CD         (+)
        AND G.EZCANCELFLAG        (+) =  '0'
        AND B.GLBL_CMPY_CD            =  H.GLBL_CMPY_CD
        AND B.DS_CONTR_PK             =  H.DS_CONTR_PK
        AND H.EZCANCELFLAG            =  '0'
        AND H.GLBL_CMPY_CD            =  I.GLBL_CMPY_CD
        AND H.DS_CONTR_STS_CD         =  I.DS_CONTR_STS_CD
        AND I.EZCANCELFLAG            =  '0'
        AND B.GLBL_CMPY_CD            =  J.GLBL_CMPY_CD
        AND B.DS_CONTR_DTL_TP_CD      =  J.DS_CONTR_DTL_TP_CD
        AND J.EZCANCELFLAG            =  '0'
        ORDER BY
             B.CPO_ORD_NUM
            ,B.FROM_PER_MTH_NUM
            <!-- START 2018/08/24 K.Kojima [QC#27919, ADD] -->
            ,SORT_DS_CONTR_DTL_PK
            ,J.DS_CONTR_DTL_TP_SORT_NUM
            <!-- END 2018/08/24 K.Kojima [QC#27919, ADD] -->
            ,B.DS_CONTR_DTL_PK
    </statement>
    <!-- mod end 2017/10/06 QC#21639 -->
    <!-- END   2017/09/22 [QC#18534, ADD] -->

<!-- add start 2017/10/02 QC#21567 -->
    <statement id="getCloDayForAgg" parameterClass="Map" resultClass="Map">
        SELECT
             A.CONTR_CLO_DAY
            ,A.MTR_CLO_DAY
        FROM
            DS_CONTR_DTL  A
        WHERE
                A.GLBL_CMPY_CD              = #glblCmpyCd#
            AND A.DS_CONTR_PK               = #dsContrPk#
            AND A.DS_CONTR_DTL_TP_CD        = #aggregate#
            AND (   A.BASE_DPLY_PER_END_DAY = #initDay#
                 OR A.MTR_DPLY_PER_END_DAY  = #initDay#)
            AND A.EZCANCELFLAG              = '0'
    </statement>

    <statement id="getDsContrDtlForAgg" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             A.DS_CONTR_DTL_PK
        FROM
             DS_CONTR_DTL       A
            ,DS_CONTR_DTL_STS_V B
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.DS_CONTR_PK           = #dsContrPk#
            AND A.DS_CONTR_DTL_TP_CD    &lt;&gt;  #aggregate#
            AND A.CONTR_EFF_FROM_DT     IS NOT NULL
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK       = B.DS_CONTR_DTL_PK
            <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCd[]" open="AND B.DS_CONTR_CTRL_STS_CD NOT IN (" close=")" conjunction=",">
                #dsContrCtrlStsCd[]#
            </iterate>
            AND B.EZCANCELFLAG          = '0'
        ORDER BY 
            A.DS_CONTR_DTL_PK
    </statement>
<!-- add end 2017/10/02 QC#21567 -->

<!-- add start 2017/10/06 QC#21639 -->
    <statement id="getDsContrDtlPkForContrStsChng" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.DS_CONTR_DTL_PK
        FROM
             WAIT_ISTL_CONTR  A
            ,DS_CONTR_DTL     B
            ,SVC_MACH_MSTR    C
        WHERE
            A.GLBL_CMPY_CD            =  #glblCmpyCd#
        AND A.EZCANCELFLAG            =  '0'
        AND A.GLBL_CMPY_CD            =  B.GLBL_CMPY_CD
        AND A.DS_CONTR_DTL_PK         =  B.DS_CONTR_DTL_PK
        AND B.DS_CONTR_PK             =  #dsContrPk#
        AND B.DS_CONTR_DTL_STS_CD     &lt;&gt; #submited#
        AND B.EZCANCELFLAG            =  '0'
        AND B.GLBL_CMPY_CD            =  C.GLBL_CMPY_CD
        AND B.SVC_MACH_MSTR_PK        =  C.SVC_MACH_MSTR_PK
        AND C.SVC_MACH_MSTR_STS_CD    =  #installed#
        AND C.ISTL_DT                 IS NOT NULL
        AND C.EZCANCELFLAG            =  '0'
        ORDER BY
             A.DS_CONTR_DTL_PK
    </statement>
<!-- add end 2017/10/06 QC#21639 -->

<!-- START 2017/10/18 K.Kitachi [QC#21622, ADD] -->
<!-- START 2018/05/09 K.Kitachi [QC#25728, DEL] -->
<!--<statement id="getMinUnbilledFromDt" parameterClass="Map" resultClass="String"> -->
<!--    SELECT -->
<!--        MIN(A.BLLG_SCHD_FROM_DT) -->
<!--    FROM -->
<!--        DS_CONTR_BLLG_SCHD A -->
<!--    WHERE -->
<!--            A.GLBL_CMPY_CD    = #glblCmpyCd# -->
<!--        AND A.EZCANCELFLAG    = '0' -->
<!--        AND A.DS_CONTR_DTL_PK = #dsContrDtlPk# -->
<!--        AND A.BASE_CHRG_FLG   = 'Y' -->
<!--        AND A.INV_FLG         = 'N' -->
<!--        AND A.INV_TP_CD       = #invTpCd# -->
<!--        AND A.SVC_CR_REBIL_PK IS NULL -->
<!--</statement> -->
<!-- END 2018/05/09 K.Kitachi [QC#25728, DEL] -->
<!-- END 2017/10/18 K.Kitachi [QC#21622, ADD] -->
<!-- START 2017/12/04 K.Ochiai [QC#21698, ADD] -->
    <statement id="getEmsdTocd" parameterClass="Map" resultClass="String">
        SELECT
            *
        FROM
            (
            SELECT
                DCSC.SLS_REP_TOC_CD
            FROM
                DS_CPO_SLS_CR       DCSC
               ,CPO                 CPO
               ,ORD_CATG_BIZ_CTX    OCBC
            WHERE
                    DCSC.GLBL_CMPY_CD            = #glblCmpyCd#
                AND DCSC.CPO_ORD_NUM             = #cpoOrdNum#
                AND DCSC.DS_CPO_CONFIG_PK        IS NULL
                AND DCSC.SLS_CR_QUOT_FLG         = 'N'
                AND DCSC.EZCANCELFLAG            = '0'
                AND DCSC.GLBL_CMPY_CD            = CPO.GLBL_CMPY_CD
                AND DCSC.CPO_ORD_NUM             = CPO.CPO_ORD_NUM
                AND CPO.EZCANCELFLAG             = '0'
                AND DCSC.GLBL_CMPY_CD            = OCBC.GLBL_CMPY_CD
                AND DCSC.SLS_REP_ROLE_TP_CD      = OCBC.FIRST_BIZ_CTX_ATTRB_TXT
                AND OCBC.DS_ORD_CATG_CD          = CPO.DS_ORD_CATG_CD
                AND (
                        OCBC.DS_ORD_TP_CD IS NULL
                        OR (
                                OCBC.DS_ORD_TP_CD IS NOT NULL
                            AND OCBC.DS_ORD_TP_CD = CPO.DS_ORD_TP_CD
                        )
                    )
                AND (
                        OCBC.DS_ORD_RSN_CD IS NULL
                        OR (
                                OCBC.DS_ORD_RSN_CD IS NOT NULL
                            AND OCBC.DS_ORD_RSN_CD = CPO.DS_ORD_RSN_CD
                        )
                    )
                AND OCBC.ORD_CATG_CTX_TP_CD       = #emsdContrBrRep#
                AND OCBC.EZCANCELFLAG             = '0'
             ORDER BY OCBC.DS_ORD_CATG_CD,OCBC.DS_ORD_TP_CD,OCBC.DS_ORD_RSN_CD
             )
         WHERE
            ROWNUM = 1
    </statement>
    <statement id="getTocCd" parameterClass="Map" resultClass="String">
        SELECT
            SCBM.TOC_CD
        FROM
            S21_ORG             S21O
           ,SUB_CONTR_BR_MAP    SCBM
        WHERE
                S21O.GLBL_CMPY_CD            = #glblCmpyCd#
            AND S21O.TOC_CD                  = #tocCd#
            AND S21O.EZCANCELFLAG            = '0'
            AND S21O.GLBL_CMPY_CD            = SCBM.GLBL_CMPY_CD
            AND S21O.COA_BR_CD               = SCBM.SVC_CONTR_BR_CD
            <!-- START 2018/01/09 M.Kidokoro [QC#20635,ADD] -->
            AND SCBM.SVC_LINE_BIZ_CD         = #svcLineBizCd#
            <!-- END 2018/01/09 M.Kidokoro [QC#20635,ADD] -->
            AND SCBM.ENBL_FLG                = 'Y'
            AND SCBM.EZCANCELFLAG            = '0'
    </statement>
    <statement id="getEmsdContractBranch" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM
            (
            SELECT
                 OCBC.SCD_BIZ_CTX_ATTRB_TXT   AS SVC_CONTR_BR_CD_OCBC
                ,OCBC.THIRD_BIZ_CTX_ATTRB_TXT AS CONTR_ADMIN_PSN_CD_OCBC
            FROM
                CPO                  CPO
               ,ORD_CATG_BIZ_CTX     OCBC
            WHERE
                    CPO.GLBL_CMPY_CD              = #glblCmpyCd#
                AND CPO.CPO_ORD_NUM               = #cpoOrdNum#
                AND CPO.EZCANCELFLAG              = '0'
                AND CPO.GLBL_CMPY_CD              = OCBC.GLBL_CMPY_CD
                AND CPO.DS_ORD_CATG_CD            = OCBC.DS_ORD_CATG_CD
                AND (
                        OCBC.DS_ORD_TP_CD IS NULL
                        OR (
                                OCBC.DS_ORD_TP_CD IS NOT NULL
                            AND CPO.DS_ORD_TP_CD  = OCBC.DS_ORD_TP_CD
                        )
                    )
                AND (
                        OCBC.DS_ORD_RSN_CD IS NULL
                        OR (
                                OCBC.DS_ORD_RSN_CD IS NOT NULL
                            AND CPO.DS_ORD_RSN_CD = OCBC.DS_ORD_RSN_CD
                        )
                    )
                AND OCBC.ORD_CATG_CTX_TP_CD       = #emsdContrBrRep#
                AND OCBC.EZCANCELFLAG             = '0'
             ORDER BY OCBC.DS_ORD_CATG_CD,OCBC.DS_ORD_TP_CD,OCBC.DS_ORD_RSN_CD
             )
         WHERE
            ROWNUM = 1
    </statement>
    <statement id="getContractBranch" parameterClass="Map" resultClass="Map">
        SELECT
             SCCBM.SVC_CONTR_BR_CD  AS SVC_CONTR_BR_CD_SCCBM
            ,SCCBM.CONTR_ADMIN_PSN_CD
        FROM
            CPO                  DC
           ,S21_ORG              S21O
           ,SVC_CONTR_COA_BR_MAP SCCBM
        WHERE
                DC.GLBL_CMPY_CD              = #glblCmpyCd#
            AND DC.CPO_ORD_NUM               = #cpoOrdNum#
            AND DC.EZCANCELFLAG              = '0'
            AND DC.GLBL_CMPY_CD              = S21O.GLBL_CMPY_CD
            AND DC.SLS_REP_TOC_CD            = S21O.TOC_CD
            AND S21O.EZCANCELFLAG            = '0'
            AND S21O.GLBL_CMPY_CD            = SCCBM.GLBL_CMPY_CD
            AND S21O.COA_BR_CD               = SCCBM.COA_BR_CD
            <!-- START 2018/01/09 M.Kidokoro [QC#20635,ADD] -->
            AND SCCBM.SVC_LINE_BIZ_CD        = #svcLineBizCd#
            <!-- END 2018/01/09 M.Kidokoro [QC#20635,ADD] -->
            AND SCCBM.EZCANCELFLAG           = '0'
    </statement>
<!-- END 2017/12/04 K.Ochiai [QC#21698, ADD] -->
    <statement id="getAcctAdminPsnCd" parameterClass="Map" resultClass="String">
        SELECT
             B.CONTR_ADMIN_PSN_CD
        FROM
             DS_CONTR              A
            ,ACCT_CONTR_ADMIN_RELN B
        WHERE
            A.GLBL_CMPY_CD                     = #glblCmpyCd#
        AND A.DS_CONTR_PK                      = #dsContrPk#
        AND A.EZCANCELFLAG                     = '0'
        AND A.GLBL_CMPY_CD                     = B.GLBL_CMPY_CD
        AND A.DS_ACCT_NUM                      = B.DS_ACCT_NUM
        AND B.EZCANCELFLAG                     = '0'
        AND B.SVC_LINE_BIZ_CD                  = #svcLineBizCd#
        AND B.ACTV_FLG                         = 'Y'
        AND B.EFF_FROM_DT                  &lt;= #slsDt#
        AND NVL(B.EFF_THRU_DT, #slsDt#)    &gt;= #slsDt#
        ORDER BY
             B.EFF_FROM_DT
            ,B.CONTR_ADMIN_PSN_CD
    </statement>
    <statement id="getCtacPsnPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
        <!-- START 2018/04/02 U.Kim [QC#23559(Sol358), MOD] -->
        <!--    A.CTAC_PSN_PK -->
             PSN.CTAC_PSN_PK
        <!-- END 2018/04/02 U.Kim [QC#23559(Sol358), MOD] -->
        FROM
            (
                SELECT
                     DCCP.CTAC_PSN_PK
                     <!-- START 2018/04/02 U.Kim [QC#23559(Sol358), ADD] -->
                     ,CASE WHEN DCPR.CTAC_TP_CD = #billToContactContr# THEN '1' ELSE '2' END AS SORT_NUM
                     <!-- END 2018/04/02 U.Kim [QC#23559(Sol358), ADD] -->
                FROM
                     DS_CPO_CTAC_PSN  DCCP
                    ,DS_CTAC_PSN_RELN DCPR
                    ,BILL_TO_CUST     BTC
                WHERE
                        DCCP.GLBL_CMPY_CD         = #glblCmpyCd#
                    AND DCCP.CPO_ORD_NUM          = #cpoOrdNum#
                    <!-- START 2018/04/02 U.Kim [QC#23559(Sol358), MOD] -->
                    <!--    AND DCCP.CTAC_PSN_TP_CD       = #billToContact# -->
                    <iterate property="ctacTpList" var="ctacTpList[]" open="AND DCCP.CTAC_PSN_TP_CD IN(" close=")" conjunction=",">
                        #ctacTpList[]#
                    </iterate>
                    <!-- END 2018/04/02 U.Kim [QC#23559(Sol358), MOD] -->
                    AND DCCP.EZCANCELFLAG         = '0'
                    AND DCCP.GLBL_CMPY_CD         = DCPR.GLBL_CMPY_CD
                    AND DCCP.CTAC_PSN_PK          = DCPR.CTAC_PSN_PK
                    <!-- START 2018/04/02 U.Kim [QC#23559(Sol358), MOD] -->
                    <!--    AND DCPR.CTAC_TP_CD           = #billToContact# -->
                    <iterate property="ctacTpList" var="ctacTpList[]" open="AND DCPR.CTAC_TP_CD IN(" close=")" conjunction=",">
                        #ctacTpList[]#
                    </iterate>
                    <!-- END 2018/04/02 U.Kim [QC#23559(Sol358), MOD] -->
                    AND DCPR.EZCANCELFLAG         = '0'
                    AND DCPR.GLBL_CMPY_CD         = BTC.GLBL_CMPY_CD
                    AND DCPR.LOC_NUM              = BTC.LOC_NUM
                    AND BTC.BILL_TO_CUST_CD       = #billToCustCd#
                    AND BTC.EZCANCELFLAG = '0'
                ORDER BY
                     SORT_NUM
                    ,DCCP.DS_CPO_CTAC_PSN_PK
            <!-- START 2018/04/02 U.Kim [QC#23559(Sol358), ADD] -->
            ) PSN
            <!-- END 2018/04/02 U.Kim [QC#23559(Sol358), ADD] -->
            WHERE
                ROWNUM = 1
    </statement>
    <!-- START 2018/04/06 U.Kim [QC#23387(Sol320), MOD] -->
    <statement  id="getdfrdAcctgRule" parameterClass="Map" resultClass="Map">
        SELECT
             B.DFRD_ACCTG_RULE_CD
            ,B.DFRD_ACCTG_RULE_DURN_AOT
        FROM
             MDSE                       A
            ,DFRD_ACCTG_RULE            B
        WHERE
                A.GLBL_CMPY_CD                  =  #glblCmpyCd#
            AND A.EZCANCELFLAG                  =  '0'
            AND A.MDSE_CD                       =  #mdseCd#
            AND A.GLBL_CMPY_CD                  =  B.GLBL_CMPY_CD
            AND A.DFRD_ACCTG_RULE_CD            =  B.DFRD_ACCTG_RULE_CD
            AND B.EZCANCELFLAG                  =  '0'
    </statement>

    <statement id="getContrAlloc" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM (
            SELECT
                 A.COA_CMPY_CD
                ,A.COA_AFFL_CD
                ,A.COA_BR_CD
                ,A.COA_CH_CD
                ,A.COA_CC_CD
                ,A.COA_ACCT_CD
                ,A.COA_PROD_CD
                ,A.COA_PROJ_CD
                ,A.COA_EXTN_CD
                ,A.PRC_ALLOC_RATE
                ,DENSE_RANK() OVER (
                    ORDER BY
                         A.SVC_INV_CHRG_TP_CD NULLS LAST
                        ,A.DS_CONTR_DTL_PK    NULLS LAST
                ) AS RANK_NUM
            FROM
                 DS_CONTR_PRC_ALLOC        A
            WHERE
                    A.GLBL_CMPY_CD               =  #glblCmpyCd#
                AND A.EZCANCELFLAG               =  '0'
                AND A.DS_CONTR_PK                =  #dsContrPk#
                AND (
                    (
                            A.DS_CONTR_DTL_PK    =  #dsContrDtlPk#
                        AND A.SVC_INV_CHRG_TP_CD =  #svcInvCrhgTpCd#
                    )
                    OR
                    (
                            A.DS_CONTR_DTL_PK    =  #dsContrDtlPk#
                        AND A.SVC_INV_CHRG_TP_CD IS NULL
                    )
                    OR
                    (
                            A.DS_CONTR_DTL_PK    IS NULL
                        AND A.SVC_INV_CHRG_TP_CD IS NULL
                    )
                )
        ) B
        WHERE
            B.RANK_NUM = 1
        ORDER BY
            B.PRC_ALLOC_RATE DESC
    </statement>

    <statement id="getRntlPrcAmtForFleetline" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            SUM (DCD.RNTL_PRC_AMT) AS RNTL_PRC_AMT
        FROM
             DS_CONTR_DTL DCD
        WHERE
            DCD.GLBL_CMPY_CD               = #glblCmpyCd#
        AND DCD.DS_CONTR_PK                = #dsContrPk#
        AND DCD.DS_CONTR_DTL_TP_CD  &lt;&gt; #dsContrDtlTpFlt#
        AND DCD.DS_CONTR_DTL_TP_CD  &lt;&gt; #dsContrDtlTpCdShell#
        AND DCD.RNTL_PRC_AMT           IS NOT NULL
        AND DCD.EZCANCELFLAG               = '0'
    </statement>

<statement id="getBasePrcDealAmtForFleetline" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            DCD.BASE_PRC_DEAL_AMT
        FROM
             DS_CONTR_DTL DCD
        WHERE
            DCD.GLBL_CMPY_CD               = #glblCmpyCd#
        AND DCD.DS_CONTR_PK                = #dsContrPk#
        AND DCD.DS_CONTR_DTL_TP_CD         = #dsContrDtlTpFlt#
        AND DCD.EZCANCELFLAG               = '0'
    </statement>
    <!-- END 2018/04/06 U.Kim [QC#23387(Sol320), MOD] -->

    <!-- START 2018/05/09 K.Kitachi [QC#25728, ADD] -->
    <statement id="countAfterShellLine" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            DS_CONTR_DTL DCD
        WHERE
                DCD.GLBL_CMPY_CD       =    #glblCmpyCd#
            AND DCD.CPO_ORD_NUM        =    #cpoOrdNum#
            AND DCD.DS_CONTR_DTL_TP_CD =    #dsContrDtlTpCd#
            AND DCD.FROM_PER_MTH_NUM   &gt; #fromPerMthNum#
            AND DCD.EZCANCELFLAG       =    '0'
    </statement>
    <!-- END 2018/05/09 K.Kitachi [QC#25728, ADD] -->

    <statement id="getAggBllgRollOverRatio" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                  MAX(DCBM.BLLG_ROLL_OVER_RATIO)    BLLG_ROLL_OVER_RATIO
            FROM
                DS_CONTR_DTL            DCD
                , DS_CONTR_BLLG_MTR     DCBM
            WHERE
                DCD.GLBL_CMPY_CD            = #glblCmpyCd#
                AND DCD.DS_CONTR_PK         = #dsContrPk#
                AND DCD.DS_CONTR_DTL_TP_CD  = #aggregate#
                AND DCD.EZCANCELFLAG        = '0'
                --
                AND DCD.GLBL_CMPY_CD        = DCBM.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_PK     = DCBM.DS_CONTR_DTL_PK
                AND DCBM.EZCANCELFLAG       = '0'
    </statement>

    <!-- START 2018/07/02 K.Kim [QC#24146, ADD] -->
    <statement id="getSvcContrBrAutoEstFlg" parameterClass="Map" resultClass="String">
        SELECT
            SCB.SVC_CONTR_BR_AUTO_EST_FLG
        FROM
            SVC_CONTR_BR SCB
        WHERE
                SCB.GLBL_CMPY_CD          = #glblCmpyCd#
            AND SCB.SVC_CONTR_BR_CD       = #svcContrBrCd#
            AND SCB.EZCANCELFLAG          = '0'
            AND SCB.SVC_CONTR_BR_ACTV_FLG = #svcContrBrActvFlg#
            AND SCB.EFF_FROM_DT           &lt;= #slsDt#
            AND (SCB.EFF_THRU_DT          &gt;= #slsDt# OR SCB.EFF_THRU_DT IS NULL)
    </statement>
    <!-- END 2018/07/02 K.Kim [QC#24146, ADD] -->

    <!-- START 2018/11/13 K.Kitachi [QC#28638, ADD] -->
    <statement id="getUplftInfo" parameterClass="Map" resultClass="Map">
    <!-- mod start 2020/03/24 QC#54318 -->
<!--
        SELECT
             B.DS_CONTR_RNW_ESCL_PK
            ,A.CONTR_VRSN_EFF_FROM_DT
            ,A.CONTR_VRSN_EFF_THRU_DT
        FROM
             DS_CONTR          A
            ,DS_CONTR_RNW_ESCL B
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.DS_CONTR_PK           = #dsContrPk#
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK           = B.DS_CONTR_PK
            AND B.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvlNum#
            AND B.CONTR_UPLFT_TP_CD     &lt;&gt; #contrUplftTpCd#
            AND B.FIX_TERM_IN_MTH_AOT   &gt; 0
            AND B.EZCANCELFLAG          = '0'
-->
       SELECT
             B.DS_CONTR_RNW_ESCL_PK
            ,B.UPLFT_PCY_DT
            ,A.CONTR_EFF_FROM_DT        CONTR_VRSN_EFF_FROM_DT
            ,A.CONTR_EFF_THRU_DT        CONTR_VRSN_EFF_THRU_DT
        FROM
             DS_CONTR_DTL      A
            ,DS_CONTR_RNW_ESCL B
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.DS_CONTR_PK           = #dsContrPk#
            AND (
            <iterate property="dsContrDtlPkList" var="dsContrDtlPk[]" open="A.DS_CONTR_DTL_PK IN (" close=")" conjunction=",">
                #dsContrDtlPk[]#
            </iterate>
            <isEqual property="addContr" compareValue="N">
                OR A.DS_CONTR_DTL_TP_CD   IN (#dsContrDtlTpFlt#, #dsContrDtlTpAgg#)
            </isEqual>
                )
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK           = B.DS_CONTR_PK
            AND A.DS_CONTR_DTL_PK       = B.DS_CONTR_DTL_PK
            AND B.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl2#
            AND B.CONTR_UPLFT_TP_CD     &lt;&gt; #contrUplftTpCd#
            <!-- del start 2020/06/16 QC#54318-2 -->
            <!-- AND B.FIX_TERM_IN_MTH_AOT   &gt; 0  -->
            <!-- del end 2020/06/16 QC#54318-2 -->
            AND B.EZCANCELFLAG          = '0'
    <!-- mod end 2020/03/24 QC#54318 -->
    <!-- add start 2020/06/16 QC#54318-2 -->
    <isEqual property="addContr" compareValue="N">
        UNION ALL
        SELECT
               B.DS_CONTR_RNW_ESCL_PK
               ,B.UPLFT_PCY_DT
               ,A.CONTR_VRSN_EFF_FROM_DT
               ,A.CONTR_VRSN_EFF_THRU_DT
          FROM
               DS_CONTR          A
              ,DS_CONTR_RNW_ESCL B
         WHERE
                 A.GLBL_CMPY_CD          = #glblCmpyCd#
             AND A.DS_CONTR_PK           = #dsContrPk#
             AND A.EZCANCELFLAG          = '0'
             AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
             AND A.DS_CONTR_PK           = B.DS_CONTR_PK
             AND B.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvlNum#
             AND B.CONTR_UPLFT_TP_CD     &lt;&gt; #contrUplftTpCd#
             AND B.EZCANCELFLAG          = '0'
    </isEqual>
    <!-- add end 2020/06/16 QC#54318-2 -->
    </statement>
    <!-- END 2018/11/13 K.Kitachi [QC#28638, ADD] -->
<!-- START 2019/01/21 [QC#29782, ADD] -->
    <statement id="getPrntSvcPgmMdseCd" parameterClass="Map" resultClass="String">
        SELECT
             A.SVC_PGM_MDSE_CD
        FROM
             DS_CONTR_DTL A
        WHERE
                A.GLBL_CMPY_CD    = #glblCmpyCd#
            AND A.DS_CONTR_DTL_PK = #dsContrDtlPk#
            AND A.EZCANCELFLAG    = '0'
    </statement>
    <statement id="getPrntDsContrDtlPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             DCD.DS_CONTR_DTL_PK
        FROM
             DS_CONTR_DTL   DCD
            ,SVC_MACH_MSTR  MAC
        WHERE
                DCD.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DCD.EZCANCELFLAG        = '0'
            AND DCD.DS_CONTR_PK         = #dsContrPk#
            AND DCD.DS_CONTR_CRAT_TP_CD = #dsContrCratTpCd#
            AND DCD.GLBL_CMPY_CD        = MAC.GLBL_CMPY_CD
            AND DCD.SVC_MACH_MSTR_PK    = MAC.SVC_MACH_MSTR_PK
            AND MAC.EZCANCELFLAG        = '0'
            AND MAC.SVC_CONFIG_MSTR_PK  = #svcConfigMstrPk#
            AND MAC.SVC_MACH_TP_CD      = #svcMachTpCd#
    </statement>
    <statement id="getDsContrRnwEscl" parameterClass="Map" resultClass="Map">
        SELECT
               DS_CONTR_RNW_ESCL_PK
              ,CONTR_AUTO_RNW_TP_CD
              ,RNW_PRC_METH_CD
              ,BEF_END_RNW_DAYS_AOT
        FROM (
               SELECT
                      ESC.DS_CONTR_RNW_ESCL_PK
                     ,ESC.CONTR_AUTO_RNW_TP_CD
                     ,ESC.RNW_PRC_METH_CD
                     ,ESC.BEF_END_RNW_DAYS_AOT
                     ,ROW_NUMBER() OVER (ORDER BY ESC.DS_CONTR_MACH_LVL_NUM DESC) AS ROW_NUM
               FROM (
                      SELECT
                           A.DS_CONTR_RNW_ESCL_PK
                          ,A.CONTR_AUTO_RNW_TP_CD
                          ,A.RNW_PRC_METH_CD
                          ,A.BEF_END_RNW_DAYS_AOT
                          ,A.DS_CONTR_MACH_LVL_NUM
                      FROM
                           DS_CONTR_RNW_ESCL A
                      WHERE 
                              A.GLBL_CMPY_CD          = #glblCmpyCd#
                          AND A.EZCANCELFLAG          = '0'
                          AND A.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                          AND A.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl3#
                          AND A.DS_CONTR_BASE_USG_NM  = #dsContrBaseUsgNmBase#
                      UNION ALL
                      SELECT
                           B.DS_CONTR_RNW_ESCL_PK
                          ,B.CONTR_AUTO_RNW_TP_CD
                          ,B.RNW_PRC_METH_CD
                          ,B.BEF_END_RNW_DAYS_AOT
                          ,B.DS_CONTR_MACH_LVL_NUM
                      FROM
                           DS_CONTR_RNW_ESCL B
                      WHERE
                              B.GLBL_CMPY_CD          = #glblCmpyCd#
                          AND B.EZCANCELFLAG          = '0'
                          AND B.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                          AND B.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl2#
                      UNION ALL
                      SELECT
                           C.DS_CONTR_RNW_ESCL_PK
                          ,C.CONTR_AUTO_RNW_TP_CD
                          ,C.RNW_PRC_METH_CD
                          ,C.BEF_END_RNW_DAYS_AOT
                          ,C.DS_CONTR_MACH_LVL_NUM
                      FROM
                           DS_CONTR_RNW_ESCL C
                      WHERE
                              C.GLBL_CMPY_CD          = #glblCmpyCd#
                          AND C.EZCANCELFLAG          = '0'
                          AND C.DS_CONTR_PK           = #dsContrPk#
                          AND C.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl1#
                    ) ESC
              )
        WHERE
             ROW_NUM = #ROW_NUM#
    </statement>
<!-- END 2019/01/21 [QC#29782, ADD] -->
<!-- START 2019/01/29 [QC#29782-1, ADD] -->
    <statement id="getSplyAgmtBaseAmt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                 NVL(SCT.SPLY_BASE_AMT, 0)  AS SPLY_BASE_AMT
        FROM     SCHD_CRAT_TMPL      SCT
                ,SCHD_CRAT_TMPL_LINE SCL
        WHERE
                 SCT.GLBL_CMPY_CD           = #glblCmpyCd#
             AND SCT.EZCANCELFLAG           = '0'
             AND SCT.GLBL_CMPY_CD           = SCL.GLBL_CMPY_CD
             AND SCT.SCHD_CRAT_TMPL_PK      = SCL.SCHD_CRAT_TMPL_PK
             AND SCL.DS_CONTR_DTL_PK        = #dsContrDtlPk#
             AND SCL.EZCANCELFLAG           = '0'
             AND ROWNUM                     = 1
    </statement>
    
    <statement id="getSplyAgmtMdseCd" parameterClass="Map" resultClass="String">
        WITH SHELL_INFO AS (
            SELECT
                 GLBL_CMPY_CD
                ,MDL_ID
                ,PRC_MTR_PKG_PK
                ,PRC_SVC_PLN_TP_CD
                ,PRC_SVC_CONTR_TP_CD
                ,BLLG_MTR_LB_CD
                ,PRC_CATG_CD
                ,FROM_PER_MTH_NUM
                ,TO_PER_MTH_NUM
                ,PRC_LIST_BAND_DESC_TXT
            FROM (
                SELECT
                     MTR.GLBL_CMPY_CD
                    ,DTL.MDL_ID
                    ,DTL.PRC_MTR_PKG_PK
                    ,HDR.PRC_SVC_PLN_TP_CD
                    ,HDR.PRC_SVC_CONTR_TP_CD
                    ,MTR.BLLG_MTR_LB_CD
                    ,DTL.PRC_CATG_CD
                    ,HDR.FROM_PER_MTH_NUM
                    ,HDR.TO_PER_MTH_NUM
                    ,BAND.PRC_LIST_BAND_DESC_TXT
                FROM
                     DS_CONTR_BLLG_MTR MTR
                    ,MTR_LB            LB
                    ,DS_CONTR_DTL      DTL
                    ,DS_CONTR          HDR
                    ,PRC_LIST_BAND     BAND
                WHERE
                    MTR.GLBL_CMPY_CD     = #glblCmpyCd#
                AND MTR.EZCANCELFLAG     = '0'
                AND MTR.DS_CONTR_DTL_PK  = #dsContrDtlPk#
                AND MTR.GLBL_CMPY_CD     = LB.GLBL_CMPY_CD
                AND MTR.BLLG_MTR_LB_CD   = LB.MTR_LB_CD
                AND LB.EZCANCELFLAG      = '0'
                AND MTR.GLBL_CMPY_CD     = DTL.GLBL_CMPY_CD
                AND MTR.DS_CONTR_DTL_PK  = DTL.DS_CONTR_DTL_PK
                AND DTL.EZCANCELFLAG     = '0'
                AND DTL.GLBL_CMPY_CD     = HDR.GLBL_CMPY_CD
                AND DTL.DS_CONTR_PK      = HDR.DS_CONTR_PK
                AND HDR.EZCANCELFLAG     = '0'
                AND MTR.GLBL_CMPY_CD     = BAND.GLBL_CMPY_CD
                AND MTR.PRC_LIST_BAND_CD = BAND.PRC_LIST_BAND_CD
                AND BAND.EZCANCELFLAG    = '0'
                ORDER BY
                    LB.MTR_LB_SORT_NUM
                )
            WHERE
                ROWNUM = 1
        )
        SELECT
             D.MDSE_CD
        FROM
             SHELL_INFO        A
            ,PRC_LIST_SPLY_PGM B
            ,SPLY_AGMT_PLN     C
            ,SPLY_AGMT_PLN_TP  D
            ,PRC_LIST_BAND     E
        WHERE
            A.GLBL_CMPY_CD                   = B.GLBL_CMPY_CD
        AND A.MDL_ID                         = B.MDL_ID
        AND A.PRC_MTR_PKG_PK                 = B.PRC_MTR_PKG_PK
        AND A.PRC_SVC_PLN_TP_CD              = B.PRC_SVC_PLN_TP_CD
        AND A.PRC_SVC_CONTR_TP_CD            = B.PRC_SVC_CONTR_TP_CD
        AND A.BLLG_MTR_LB_CD                 = B.BLLG_MTR_LB_CD
        AND A.PRC_CATG_CD                    = B.PRC_CATG_CD
        AND A.FROM_PER_MTH_NUM           &gt;= B.TERM_FROM_MTH_AOT
        AND A.TO_PER_MTH_NUM             &lt;= B.TERM_THRU_MTH_AOT
        AND B.EZCANCELFLAG                   = '0'
        AND B.EFF_FROM_DT                &lt;= #slsDt#
        AND NVL(B.EFF_THRU_DT, #slsDt#)  &gt;= #slsDt#
        AND B.GLBL_CMPY_CD                   = C.GLBL_CMPY_CD
        AND B.SPLY_AGMT_PLN_PK               = C.SPLY_AGMT_PLN_PK
        AND C.EZCANCELFLAG                   = '0'
        AND C.GLBL_CMPY_CD                   = D.GLBL_CMPY_CD
        AND C.SPLY_AGMT_PLN_TP_CD            = D.SPLY_AGMT_PLN_TP_CD
        AND D.EZCANCELFLAG                   = '0'
        AND B.GLBL_CMPY_CD                   = E.GLBL_CMPY_CD
        AND B.PRC_LIST_BAND_CD               = E.PRC_LIST_BAND_CD
        AND A.PRC_LIST_BAND_DESC_TXT         = E.PRC_LIST_BAND_DESC_TXT
        AND E.EZCANCELFLAG                   = '0'
	</statement>
    <statement id="getSplyMachMstr" parameterClass="Map" resultClass="Map">
        SELECT
                 SVC_MACH_MSTR_PK
                ,CPO_ORD_NUM
                ,CPO_DTL_LINE_NUM
                ,CPO_DTL_LINE_SUB_NUM
        FROM
                (SELECT
                     A.SVC_MACH_MSTR_PK
                    ,A.CPO_ORD_NUM
                    ,A.CPO_DTL_LINE_NUM
                    ,A.CPO_DTL_LINE_SUB_NUM
                FROM
                     SVC_MACH_MSTR A
                WHERE
                    A.GLBL_CMPY_CD             = #glblCmpyCd#
                AND A.CPO_ORD_NUM              = #cpoOrdNum#
                AND A.SVC_CONFIG_MSTR_PK       = #svcConfigMstrPk#
                AND (A.MDSE_CD = #mdseCd#
                    OR SUBSTR(A.MDSE_CD, 0, 8) = #mdseCd#)
                AND A.SVC_MACH_TP_CD           = #acc#
                AND A.EZCANCELFLAG             = '0'
                ORDER BY
                        A.CPO_ORD_NUM
                        ,A.CPO_DTL_LINE_NUM
                        ,A.CPO_DTL_LINE_SUB_NUM
                ) A
        WHERE
            ROWNUM = 1
    </statement>
<!-- END 2019/01/29 [QC#29782-1, ADD] -->
<!-- START 2019/02/05 [QC#30244, ADD] -->
    <statement id="getSumRntlPrcAmt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             NVL(SUM(A.RNTL_PRC_AMT), 0)
        FROM
             DS_CONTR_DTL A
        WHERE
                A.GLBL_CMPY_CD        = #glblCmpyCd#
            AND A.EZCANCELFLAG        = '0'
            AND A.DS_CONTR_PK         = #dsContrPk#
            AND A.SVC_CONFIG_MSTR_PK  = #svcConfigMstrPk#
    </statement>
<!-- END 2019/02/05 [QC#30244, ADD] -->
</sqlMap>
