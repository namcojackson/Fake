<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPZC109001">
    <statement id="getPo" parameterClass="Map" resultClass="Map">
        SELECT
            A.GLBL_CMPY_CD
            ,A.PO_ORD_NUM
            ,B.PO_ORD_DTL_LINE_NUM
            ,B.MDSE_CD
            ,B.INVTY_LOC_CD
            ,C.INVTY_LOC_NM
            ,A.PO_SUBMT_TS
            ,B.PO_RCV_QTY
            ,B.PO_BAL_QTY
            ,B.ETA_DT
        FROM
            PO              A
            ,PO_DTL         B
            ,DS_INVTY_LOC_V C
        WHERE
            A.GLBL_CMPY_CD            = #glblCmpyCd#
            AND A.EZCANCELFLAG        = '0'
            AND A.PO_ORD_NUM          = #poOrdNum#
            AND A.GLBL_CMPY_CD        = B.GLBL_CMPY_CD
            AND A.PO_ORD_NUM          = B.PO_ORD_NUM
            AND B.EZCANCELFLAG        = '0'
            AND B.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
            AND B.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
            AND B.INVTY_LOC_CD        = C.INVTY_LOC_CD
            AND C.EZCANCELFLAG        = '0'
    </statement>
    <statement id="getNotShipPoAckDtl" parameterClass="Map" resultClass="Map">
        SELECT
            A.GLBL_CMPY_CD
            ,A.PO_ORD_NUM
            ,A.PO_ORD_DTL_LINE_NUM
            ,A.PO_ORD_DTL_SUB_LINE_NUM
            ,A.SHPG_PLN_DPLY_LINE_NUM
            ,A.PO_ACK_LINE_STS_CD
            ,A.MDSE_CD
            ,A.ORD_QTY
            ,A.ETD_DT
            ,A.ETA_DT
            ,A.ORD_DTL_LAST_UPD_TS
            ,A.VND_SO_NUM
            ,CASE A.PO_ACK_LINE_STS_CD
                WHEN #poAckLineStsCdSp# THEN $strOne$
                WHEN #poAckLineStsCdA#  THEN $strTwo$
                WHEN #poAckLineStsCdH#  THEN $strThree$
                WHEN #poAckLineStsCdB#  THEN $strFour$
                WHEN #poAckLineStsCdE#  THEN $strFive$
                else $strSix$
             END SORT_NUM
        FROM
            PO_ACK_DTL A
        WHERE
            A.GLBL_CMPY_CD            =  #glblCmpyCd#
            AND A.EZCANCELFLAG        =  '0'
            AND A.PO_ORD_NUM          =  #poOrdNum#
            AND A.PO_ORD_DTL_LINE_NUM =  #poOrdDtlLineNum#
            AND A.PO_ACK_LINE_STS_CD  IN (#poAckLineStsCdA#, #poAckLineStsCdB#, #poAckLineStsCdSp#, #poAckLineStsCdE#, #poAckLineStsCdH#)
            AND A.PO_ACK_HDR_PK       =
                    ( SELECT PO_ACK_HDR_PK
                      FROM   PO_ACK_HDR
                      WHERE  PO_ACK_NUM =  (
                                                SELECT MAX(H.PO_ACK_NUM)
                                                FROM   PO_ACK_HDR H
                                                      ,PO_ACK_DTL D
                                                WHERE  H.GLBL_CMPY_CD = #glblCmpyCd#
                                                AND    H.PO_ORD_NUM   = #poOrdNum#
                                                AND    H.EZCANCELFLAG = '0'
                                                AND    D.GLBL_CMPY_CD = H.GLBL_CMPY_CD
                                                AND    D.PO_ORD_NUM   = H.PO_ORD_NUM
                                                AND    D.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
                                                AND    D.EZCANCELFLAG = '0'
                                                <!-- QC#20433  -->
                                                <!-- AND    ROWNUM =1 -->
                                            )
                     AND     PO_ORD_NUM    =  #poOrdNum#
                     AND     GLBL_CMPY_CD  =  #glblCmpyCd#
                     AND     EZCANCELFLAG  = '0'
                     AND     ROWNUM =1
                    )
        ORDER BY
            SORT_NUM  ASC
            ,A.ETA_DT ASC
    </statement>
    <statement id="getShippedPoAckDtl" parameterClass="Map" resultClass="Map">
        SELECT
            A.GLBL_CMPY_CD
            ,A.PO_ORD_NUM
            ,A.PO_ORD_DTL_LINE_NUM
            ,A.PO_ORD_DTL_SUB_LINE_NUM
            ,A.SHPG_PLN_DPLY_LINE_NUM
            ,A.PO_ACK_LINE_STS_CD
            ,A.MDSE_CD
            ,A.ORD_QTY
            ,A.ETD_DT
            ,A.ETA_DT
            ,A.ORD_DTL_LAST_UPD_TS
            ,A.VND_SO_NUM
         FROM
            PO_ACK_DTL A
        WHERE
            A.GLBL_CMPY_CD            = #glblCmpyCd#
            AND A.EZCANCELFLAG        = '0'
            AND A.PO_ORD_NUM          = #poOrdNum#
            AND A.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
            AND A.PO_ACK_LINE_STS_CD  = #poAckLineStsCd#
            AND A.PO_ACK_HDR_PK       =
                    ( SELECT PO_ACK_HDR_PK
                      FROM   PO_ACK_HDR
                      WHERE  PO_ACK_NUM =  (
                                                SELECT MAX(H.PO_ACK_NUM)
                                                FROM   PO_ACK_HDR H
                                                      ,PO_ACK_DTL D
                                                WHERE  H.GLBL_CMPY_CD = #glblCmpyCd#
                                                AND    H.PO_ORD_NUM   = #poOrdNum#
                                                AND    H.EZCANCELFLAG = '0'
                                                AND    D.GLBL_CMPY_CD = H.GLBL_CMPY_CD
                                                AND    D.PO_ORD_NUM   = H.PO_ORD_NUM
                                                AND    D.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
                                                AND    D.EZCANCELFLAG = '0'
                                            )
                     AND     PO_ORD_NUM    =  #poOrdNum#
                     AND     GLBL_CMPY_CD  =  #glblCmpyCd#
                     AND     EZCANCELFLAG  = '0'
                    )
        ORDER BY
            ETD_DT   DESC
    </statement>
    <statement id="getRws" parameterClass="Map" resultClass="Map">
        SELECT
            A.GLBL_CMPY_CD
            ,A.RWS_NUM
            ,B.RWS_DTL_LINE_NUM
            ,A.PO_RCV_TRX_HDR_NUM
            ,B.PO_RCV_TRX_LINE_NUM
            ,B.RWS_STS_CD
            ,B.RWS_QTY
            ,B.RWS_PUT_AWAY_QTY
        FROM
            RWS_HDR  A
            ,RWS_DTL B
        WHERE
            A.GLBL_CMPY_CD            =  #glblCmpyCd#
            AND A.EZCANCELFLAG        =  '0'
            AND A.PO_RCV_TRX_HDR_NUM  =  #poOrdNum#
            <!-- QC#20433 -->
            <isNotNull property="rwsRefNum">
	            AND A.RWS_REF_NUM         IN
	            <iterate property="rwsRefNum" var="rwsRefNum[]" open="(" close=")" conjunction=",">
	                #rwsRefNum[]#
	            </iterate>
            </isNotNull>
            AND A.GLBL_CMPY_CD        =  B.GLBL_CMPY_CD
            AND A.RWS_NUM             =  B.RWS_NUM
            AND B.EZCANCELFLAG        =  '0'
            AND B.PO_RCV_TRX_LINE_NUM =  #poOrdDtlLineNum#
            AND B.RWS_STS_CD          IN 
            <iterate property="rwsStsCdList" var="rwsStsCd[]" open="(" close=")" conjunction=",">
                #rwsStsCd[]#
            </iterate>
        ORDER BY
            A.RWS_NUM           ASC
            ,B.RWS_DTL_LINE_NUM ASC
    </statement>
</sqlMap>
