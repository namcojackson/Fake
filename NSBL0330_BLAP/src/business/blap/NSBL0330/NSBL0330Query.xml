<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSBL0330Query">
    <typeAlias alias="NSBL0330_ASMsg"  type="business.blap.NSBL0330.NSBL0330_ASMsg"/>
    <statement id="getMgrList" parameterClass="Map" resultMap="result.getMgrList">
<!-- mod start 2016/10/18 CSA Defect#11030 -->
        SELECT
             SVC_MGR_PSN_CD
        FROM
            (
                SELECT
                    DISTINCT
                     OTD.SVC_MGR_PSN_CD
                    ,PSN.PSN_LAST_NM
                    ,PSN.PSN_FIRST_NM
                FROM
                     OPEN_SVC_TASK_DTL     OTD
                    ,S21_PSN               PSN
                  <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
                    ,DS_SVC_CALL_TP        SCT
                  </isEqual>
                  <isEqual property="svcRqstCritTpCd" compareValue="STS">
                    ,FSR_SVC_TASK_STS_RELN TSR
                  </isEqual>
                WHERE
                        OTD.GLBL_CMPY_CD       = #glblCmpyCd#
                  <isEqual property="mgrOrgLayerNum" compareValue="1">
                    AND OTD.FIRST_ORG_CD       = #orgCd#
                  </isEqual>
                  <isEqual property="mgrOrgLayerNum" compareValue="2">
                    AND OTD.SCD_ORG_CD         = #orgCd#
                  </isEqual>
                  <isEqual property="mgrOrgLayerNum" compareValue="3">
                    AND OTD.THIRD_ORG_CD       = #orgCd#
                  </isEqual>
                  <isEqual property="mgrOrgLayerNum" compareValue="4">
                    AND OTD.FRTH_ORG_CD        = #orgCd#
                  </isEqual>
                  <isEqual property="mgrOrgLayerNum" compareValue="5">
                    AND OTD.FIFTH_ORG_CD       = #orgCd#
                  </isEqual>
                  <isEqual property="mgrOrgLayerNum" compareValue="6">
                    AND OTD.SIXTH_ORG_CD       = #orgCd#
                  </isEqual>
                  <isEqual property="mgrOrgLayerNum" compareValue="7">
                    AND OTD.SVNTH_ORG_CD       = #orgCd#
                  </isEqual>
                  <isEqual property="mgrOrgLayerNum" compareValue="8">
                    AND OTD.EIGHTH_ORG_CD      = #orgCd#
                  </isEqual>
                  <isEqual property="mgrOrgLayerNum" compareValue="9">
                    AND OTD.NINTH_ORG_CD       = #orgCd#
                  </isEqual>
                  <isEqual property="mgrOrgLayerNum" compareValue="10">
                    AND OTD.TENTH_ORG_CD       = #orgCd#
                  </isEqual>
                  <isEqual property="mgrOrgLayerNum" compareValue="11">
                    AND OTD.ELVTH_ORG_CD       = #orgCd#
                  </isEqual>
<!-- START 2016/03/23 K.Yamada [QC#5857, ADD] -->
                  <isNull property="mgrOrgLayerNum">
                    AND (
                            OTD.FIRST_ORG_CD       = #orgCd#
                        OR  OTD.SCD_ORG_CD         = #orgCd#
                        OR  OTD.THIRD_ORG_CD       = #orgCd#
                        OR  OTD.FRTH_ORG_CD        = #orgCd#
                        OR  OTD.FIFTH_ORG_CD       = #orgCd#
                        OR  OTD.SIXTH_ORG_CD       = #orgCd#
                        OR  OTD.SVNTH_ORG_CD       = #orgCd#
                        OR  OTD.EIGHTH_ORG_CD      = #orgCd#
                        OR  OTD.NINTH_ORG_CD       = #orgCd#
                        OR  OTD.TENTH_ORG_CD       = #orgCd#
                        OR  OTD.ELVTH_ORG_CD       = #orgCd#
                    )
                  </isNull>
<!-- END 2016/03/23 K.Yamada [QC#5857, ADD] -->
                    AND OTD.SVC_MGR_TP_CD      = #svcMgrTpCd#
                  <isNotNull property="svcMgrPsnCd">
                    AND OTD.SVC_MGR_PSN_CD     = #svcMgrPsnCd#
                  </isNotNull>
<!-- START 2017/12/04 M.Kidokoro [QC#22483, DEL] -->
<!--                    AND OTD.OPEN_TASK_LTST_FLG = 'Y' -->
<!-- END 2017/12/04 M.Kidokoro [QC#22483, DEL] -->
                  <isEqual property="svcRqstDownTpCd" compareValue="IN">
                    AND OTD.IN_PROC_TASK_FLG   = 'Y'
                  </isEqual>
                  <isEqual property="svcRqstDownTpCd" compareValue="CLO">
                    AND OTD.CLO_TASK_FLG       = 'Y'
                  </isEqual>
                  <isEqual property="svcRqstDownTpCd" compareValue="CNCL">
                    AND OTD.CANC_TASK_FLG      = 'Y'
                  </isEqual>
                  <isEqual property="svcRqstDownTpCd" compareValue="RJCT">
                    AND OTD.REJ_TASK_FLG       = 'Y'
                  </isEqual>
                  <isEqual property="svcRqstDownTpCd" compareValue="RESP">
                    AND OTD.TM_RSP_FLG         = 'Y'
                  </isEqual>
                  <!-- START 2019/03/28 S.Kitamura [QC#30233,ADD] -->
                  <isEqual property="svcRqstDownTpCd" compareValue="TBO">
                    AND OTD.TO_BE_OPTM_TASK_FLG = 'Y'
                  </isEqual>
                  <isEqual property="svcRqstDownTpCd" compareValue="SCHD">
                    AND OTD.SCHD_TASK_FLG       = 'Y'
                  </isEqual>
                  <!-- END 2019/03/28 S.Kitamura [QC#30233,ADD] -->
                  <isEqual property="svcRqstDownTpCd" compareValue="ASSN">
                    AND OTD.ASG_TASK_FLG       = 'Y'
                  </isEqual>
                  <isEqual property="svcRqstDownTpCd" compareValue="OPEN">
                    AND OTD.OPEN_TASK_FLG      = 'Y'
                  </isEqual>
                  <isEqual property="svcRqstDownTpCd" compareValue="HLD">
                    AND OTD.HLD_TASK_FLG       = 'Y'
                  </isEqual>
                  <isEqual property="svcRqstDownTpCd" compareValue="ESCL">
                    AND OTD.ESCL_TASK_FLG      = 'Y'
                  </isEqual>
                  <isEqual property="svcRqstDownTpCd" compareValue="VIP">
                    AND OTD.VIP_TASK_FLG       = 'Y'
                  </isEqual>
                  <isEqual property="svcRqstDownTpCd" compareValue="ERR">
                    AND OTD.ATTN_TASK_FLG      = 'Y'
                  </isEqual>
                    AND OTD.EZCANCELFLAG       = '0'
                    AND OTD.GLBL_CMPY_CD       = PSN.GLBL_CMPY_CD
                    AND OTD.SVC_MGR_PSN_CD     = PSN.PSN_CD
                    AND PSN.EZCANCELFLAG       = '0'
                  <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
                    AND OTD.GLBL_CMPY_CD       = SCT.GLBL_CMPY_CD
                    AND OTD.DS_SVC_CALL_TP_CD  = SCT.DS_SVC_CALL_TP_CD
                    <iterate property="dsSvcCallTpCdList" var="dsSvcCallTpCd[]" open="AND SCT.DS_SVC_CALL_TP_CD IN (" conjunction= "," close=")">
                        #dsSvcCallTpCd[]#
                    </iterate>
                    AND SCT.EZCANCELFLAG       = '0'
                  </isEqual>
                  <isEqual property="svcRqstCritTpCd" compareValue="STS">
                    AND OTD.GLBL_CMPY_CD       = TSR.GLBL_CMPY_CD
                    AND OTD.FSR_STS_CD         = TSR.FSR_STS_CD
                    AND OTD.FSR_VISIT_STS_CD   = TSR.FSR_VISIT_STS_CD
                    <iterate property="fsrSvcTaskStsRelnPkList" var="fsrSvcTaskStsRelnPk[]" open="AND TSR.FSR_SVC_TASK_STS_RELN_PK IN (" conjunction= "," close=")">
                        #fsrSvcTaskStsRelnPk[]#
                    </iterate>
                    AND TSR.EZCANCELFLAG       = '0'
                  </isEqual>
                  <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
                    <!-- START 2019/10/01 K.Kitachi [QC#53819, MOD] -->
                    <iterate property="techCdList" var="techCd[]" open="AND (OTD.TECH_CD, ' ') IN (" conjunction= "," close=")">
                        (#techCd[]#, ' ')
                    </iterate>
                    <!-- END 2019/10/01 K.Kitachi [QC#53819, MOD] -->
                  </isEqual>
                  <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
                    <iterate property="svcCallSrcTpCdList" var="svcCallSrcTpCd[]" open="AND OTD.SVC_CALL_SRC_TP_CD IN (" conjunction= "," close=")">
                        #svcCallSrcTpCd[]#
                    </iterate>
                  </isEqual>
                ORDER BY
                     PSN.PSN_LAST_NM  NULLS LAST
                    ,PSN.PSN_FIRST_NM NULLS LAST
            )
        WHERE
                ROWNUM &lt;= #rowNum#
<!-- mod end 2016/10/18 CSA Defect#11030 --> 
    </statement>
    <resultMap id="result.getMgrList" class="NSBL0330_ASMsg">
        <result property="svcMgrPsnCd"    column="SVC_MGR_PSN_CD"     javaType="EZDCStringItem"/>
    </resultMap>

    <statement id="getDrillDownList" parameterClass="Map" resultClass="Map">
<!-- mod start 2016/10/18 CSA Defect#11030 --> 
        SELECT
            DISTINCT
          <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
             SCT.DS_SVC_CALL_TP_CD
            ,SCT.DS_SVC_CALL_TP_DESC_TXT
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="STS">
             TSR.FSR_SVC_TASK_STS_RELN_PK
            ,TS1.SVC_TASK_STS_DESC_TXT
            ,TS2.SVC_TASK_STS_DESC_TXT
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
             OTD.TECH_CD
            ,TCM.TECH_NM
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
             CST.SVC_CALL_SRC_TP_CD
            ,CST.SVC_CALL_SRC_TP_DESC_TXT
          </isEqual>
        FROM
             OPEN_SVC_TASK_DTL     OTD
          <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
            ,DS_SVC_CALL_TP        SCT
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="STS">
            ,FSR_SVC_TASK_STS_RELN TSR
            ,SVC_TASK_STS          TS1
            ,SVC_TASK_STS          TS2
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
            ,TECH_MSTR             TCM
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
            ,SVC_CALL_SRC_TP       CST
          </isEqual>
        WHERE
                OTD.GLBL_CMPY_CD       = #glblCmpyCd#
          <isEqual property="mgrOrgLayerNum" compareValue="1">
            AND OTD.FIRST_ORG_CD       = #orgCd#
          </isEqual>
          <isEqual property="mgrOrgLayerNum" compareValue="2">
            AND OTD.SCD_ORG_CD         = #orgCd#
          </isEqual>
          <isEqual property="mgrOrgLayerNum" compareValue="3">
            AND OTD.THIRD_ORG_CD       = #orgCd#
          </isEqual>
          <isEqual property="mgrOrgLayerNum" compareValue="4">
            AND OTD.FRTH_ORG_CD        = #orgCd#
          </isEqual>
          <isEqual property="mgrOrgLayerNum" compareValue="5">
            AND OTD.FIFTH_ORG_CD       = #orgCd#
          </isEqual>
          <isEqual property="mgrOrgLayerNum" compareValue="6">
            AND OTD.SIXTH_ORG_CD       = #orgCd#
          </isEqual>
          <isEqual property="mgrOrgLayerNum" compareValue="7">
            AND OTD.SVNTH_ORG_CD       = #orgCd#
          </isEqual>
          <isEqual property="mgrOrgLayerNum" compareValue="8">
            AND OTD.EIGHTH_ORG_CD      = #orgCd#
          </isEqual>
          <isEqual property="mgrOrgLayerNum" compareValue="9">
            AND OTD.NINTH_ORG_CD       = #orgCd#
          </isEqual>
          <isEqual property="mgrOrgLayerNum" compareValue="10">
            AND OTD.TENTH_ORG_CD       = #orgCd#
          </isEqual>
          <isEqual property="mgrOrgLayerNum" compareValue="11">
            AND OTD.ELVTH_ORG_CD       = #orgCd#
          </isEqual>
<!-- START 2016/03/23 K.Yamada [QC#5857, ADD] -->
          <isNull property="mgrOrgLayerNum">
            AND (
                    OTD.FIRST_ORG_CD       = #orgCd#
                OR  OTD.SCD_ORG_CD         = #orgCd#
                OR  OTD.THIRD_ORG_CD       = #orgCd#
                OR  OTD.FRTH_ORG_CD        = #orgCd#
                OR  OTD.FIFTH_ORG_CD       = #orgCd#
                OR  OTD.SIXTH_ORG_CD       = #orgCd#
                OR  OTD.SVNTH_ORG_CD       = #orgCd#
                OR  OTD.EIGHTH_ORG_CD      = #orgCd#
                OR  OTD.NINTH_ORG_CD       = #orgCd#
                OR  OTD.TENTH_ORG_CD       = #orgCd#
                OR  OTD.ELVTH_ORG_CD       = #orgCd#
            )
          </isNull>
<!-- END 2016/03/23 K.Yamada [QC#5857, ADD] -->
            AND OTD.SVC_MGR_TP_CD      = #svcMgrTpCd#
            <iterate property="svcMgrPsnCdList" var="svcMgrPsnCd[]" open="AND OTD.SVC_MGR_PSN_CD IN (" conjunction= "," close=")">
                #svcMgrPsnCd[]#
            </iterate>
<!-- START 2017/12/04 M.Kidokoro [QC#22483, DEL] -->
<!--            AND OTD.OPEN_TASK_LTST_FLG = 'Y' -->
<!-- END 2017/12/04 M.Kidokoro [QC#22483, DEL] -->
          <isEqual property="svcRqstDownTpCd" compareValue="IN">
            AND OTD.IN_PROC_TASK_FLG   = 'Y'
          </isEqual>
          <isEqual property="svcRqstDownTpCd" compareValue="CLO">
            AND OTD.CLO_TASK_FLG       = 'Y'
          </isEqual>
          <isEqual property="svcRqstDownTpCd" compareValue="CNCL">
            AND OTD.CANC_TASK_FLG      = 'Y'
          </isEqual>
          <isEqual property="svcRqstDownTpCd" compareValue="RJCT">
            AND OTD.REJ_TASK_FLG       = 'Y'
          </isEqual>
          <isEqual property="svcRqstDownTpCd" compareValue="RESP">
            AND OTD.TM_RSP_FLG         = 'Y'
          </isEqual>
          <!-- START 2019/03/28 S.Kitamura [QC#30233,ADD] -->
          <isEqual property="svcRqstDownTpCd" compareValue="TBO">
            AND OTD.TO_BE_OPTM_TASK_FLG = 'Y'
          </isEqual>
          <isEqual property="svcRqstDownTpCd" compareValue="SCHD">
            AND OTD.SCHD_TASK_FLG       = 'Y'
          </isEqual>
          <!-- END 2019/03/28 S.Kitamura [QC#30233,ADD] -->
          <isEqual property="svcRqstDownTpCd" compareValue="ASSN">
            AND OTD.ASG_TASK_FLG       = 'Y'
          </isEqual>
          <isEqual property="svcRqstDownTpCd" compareValue="OPEN">
            AND OTD.OPEN_TASK_FLG      = 'Y'
          </isEqual>
          <isEqual property="svcRqstDownTpCd" compareValue="HLD">
            AND OTD.HLD_TASK_FLG       = 'Y'
          </isEqual>
          <isEqual property="svcRqstDownTpCd" compareValue="ESCL">
            AND OTD.ESCL_TASK_FLG      = 'Y'
          </isEqual>
          <isEqual property="svcRqstDownTpCd" compareValue="VIP">
            AND OTD.VIP_TASK_FLG       = 'Y'
          </isEqual>
          <isEqual property="svcRqstDownTpCd" compareValue="ERR">
            AND OTD.ATTN_TASK_FLG      = 'Y'
          </isEqual>
            AND OTD.EZCANCELFLAG       = '0'
          <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
            AND OTD.GLBL_CMPY_CD       = SCT.GLBL_CMPY_CD
            AND OTD.DS_SVC_CALL_TP_CD  = SCT.DS_SVC_CALL_TP_CD
            <iterate property="dsSvcCallTpCdList" var="dsSvcCallTpCd[]" open="AND SCT.DS_SVC_CALL_TP_CD IN (" conjunction= "," close=")">
                #dsSvcCallTpCd[]#
            </iterate>
            AND SCT.EZCANCELFLAG       = '0'
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="STS">
            AND OTD.GLBL_CMPY_CD       = TSR.GLBL_CMPY_CD
            AND OTD.FSR_STS_CD         = TSR.FSR_STS_CD
            AND OTD.FSR_VISIT_STS_CD   = TSR.FSR_VISIT_STS_CD
            <iterate property="fsrSvcTaskStsRelnPkList" var="fsrSvcTaskStsRelnPk[]" open="AND TSR.FSR_SVC_TASK_STS_RELN_PK IN (" conjunction= "," close=")">
                #fsrSvcTaskStsRelnPk[]#
            </iterate>
            AND TSR.EZCANCELFLAG       = '0'
            AND TSR.GLBL_CMPY_CD       = TS1.GLBL_CMPY_CD
            AND TSR.FSR_STS_CD         = TS1.SVC_TASK_STS_CD
            AND TS1.EZCANCELFLAG       = '0'
            AND TSR.GLBL_CMPY_CD       = TS2.GLBL_CMPY_CD
            AND TSR.FSR_VISIT_STS_CD   = TS2.SVC_TASK_STS_CD
            AND TS2.EZCANCELFLAG       = '0'
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
            <!-- START 2019/10/01 K.Kitachi [QC#53819, MOD] -->
            <iterate property="techCdList" var="techCd[]" open="AND (OTD.TECH_CD, ' ') IN (" conjunction= "," close=")">
                (#techCd[]#, ' ')
            </iterate>
            <!-- END 2019/10/01 K.Kitachi [QC#53819, MOD] -->
            AND OTD.GLBL_CMPY_CD       = TCM.GLBL_CMPY_CD
            AND OTD.TECH_CD            = TCM.TECH_TOC_CD
            AND TCM.EZCANCELFLAG       = '0'
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
            <iterate property="svcCallSrcTpCdList" var="svcCallSrcTpCd[]" open="AND OTD.SVC_CALL_SRC_TP_CD IN (" conjunction= "," close=")">
                #svcCallSrcTpCd[]#
            </iterate>
            AND OTD.GLBL_CMPY_CD       = CST.GLBL_CMPY_CD
            AND OTD.SVC_CALL_SRC_TP_CD = CST.SVC_CALL_SRC_TP_CD
            AND CST.EZCANCELFLAG       = '0'
          </isEqual>
        ORDER BY
          <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
             SCT.DS_SVC_CALL_TP_CD
            ,SCT.DS_SVC_CALL_TP_DESC_TXT  NULLS LAST
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="STS">
             TS1.SVC_TASK_STS_DESC_TXT    NULLS LAST
            ,TS2.SVC_TASK_STS_DESC_TXT    NULLS LAST
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
             TCM.TECH_NM                  NULLS LAST
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
             CST.SVC_CALL_SRC_TP_DESC_TXT NULLS LAST
          </isEqual>
<!-- mod start 2016/10/18 CSA Defect#11030 --> 
    </statement>

    <statement id="getSearchList" parameterClass="Map" resultClass="Map">
<!-- mod start 2016/10/18 CSA Defect#11030 -->
        SELECT
             DTL_INFO.XX_SCR_ITEM_130_TXT
          <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
            ,DTL_INFO.DS_SVC_CALL_TP_CD
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="STS">
            ,DTL_INFO.FSR_SVC_TASK_STS_RELN_PK
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
            ,DTL_INFO.TECH_CD
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
            ,DTL_INFO.SVC_CALL_SRC_TP_CD
          </isEqual>
            ,DTL_INFO.XX_SCR_ITEM_81_TXT
            ,DTL_INFO.PSN_CD
            ,NVL(SMRY_CNT.CNT, 0)              AS XX_TOT_CNT
        FROM
            (
                SELECT
                    DISTINCT
                     CRIT_INFO.XX_SCR_ITEM_130_TXT
                  <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
                    ,CRIT_INFO.DS_SVC_CALL_TP_CD
                  </isEqual>
                  <isEqual property="svcRqstCritTpCd" compareValue="STS">
                    ,CRIT_INFO.FSR_SVC_TASK_STS_RELN_PK
                  </isEqual>
                  <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
                    ,CRIT_INFO.TECH_CD
                  </isEqual>
                  <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
                    ,CRIT_INFO.SVC_CALL_SRC_TP_CD
                  </isEqual>
                    ,MGR_INFO.PSN_LAST_NM || #comma# || MGR_INFO.PSN_FIRST_NM AS XX_SCR_ITEM_81_TXT
                    ,MGR_INFO.PSN_CD
                FROM
                    (
                        SELECT
                             OTD.GLBL_CMPY_CD
                          <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
                            ,SCT.DS_SVC_CALL_TP_CD || #hyphen# || SCT.DS_SVC_CALL_TP_DESC_TXT  AS XX_SCR_ITEM_130_TXT
                            ,OTD.DS_SVC_CALL_TP_CD
                          </isEqual>
                          <isEqual property="svcRqstCritTpCd" compareValue="STS">
                            ,TS1.SVC_TASK_STS_DESC_TXT || #slash# || TS2.SVC_TASK_STS_DESC_TXT AS XX_SCR_ITEM_130_TXT
                            ,TSR.FSR_SVC_TASK_STS_RELN_PK
                          </isEqual>
                          <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
                            ,TCM.TECH_NM                                                       AS XX_SCR_ITEM_130_TXT
                            ,OTD.TECH_CD
                          </isEqual>
                          <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
                            ,CST.SVC_CALL_SRC_TP_DESC_TXT                                      AS XX_SCR_ITEM_130_TXT
                            ,OTD.SVC_CALL_SRC_TP_CD
                          </isEqual>
                        FROM
                             OPEN_SVC_TASK_DTL     OTD
                          <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
                            ,DS_SVC_CALL_TP        SCT
                          </isEqual>
                          <isEqual property="svcRqstCritTpCd" compareValue="STS">
                            ,FSR_SVC_TASK_STS_RELN TSR
                            ,SVC_TASK_STS          TS1
                            ,SVC_TASK_STS          TS2
                          </isEqual>
                          <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
                            ,TECH_MSTR             TCM
                          </isEqual>
                          <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
                            ,SVC_CALL_SRC_TP       CST
                          </isEqual>
                        WHERE
                                OTD.GLBL_CMPY_CD       = #glblCmpyCd#
                            AND OTD.EZCANCELFLAG       = '0'
                          <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
                            AND OTD.GLBL_CMPY_CD       = SCT.GLBL_CMPY_CD
                            AND OTD.DS_SVC_CALL_TP_CD  = SCT.DS_SVC_CALL_TP_CD
                            <iterate property="dsSvcCallTpCdList" var="dsSvcCallTpCd[]" open="AND SCT.DS_SVC_CALL_TP_CD IN (" conjunction= "," close=")">
                                #dsSvcCallTpCd[]#
                            </iterate>
                            AND SCT.EZCANCELFLAG       = '0'
                          </isEqual>
                          <isEqual property="svcRqstCritTpCd" compareValue="STS">
                            AND OTD.GLBL_CMPY_CD       = TSR.GLBL_CMPY_CD
                            AND OTD.FSR_STS_CD         = TSR.FSR_STS_CD
                            AND OTD.FSR_VISIT_STS_CD   = TSR.FSR_VISIT_STS_CD
                            <iterate property="fsrSvcTaskStsRelnPkList" var="fsrSvcTaskStsRelnPk[]" open="AND TSR.FSR_SVC_TASK_STS_RELN_PK IN (" conjunction= "," close=")">
                                #fsrSvcTaskStsRelnPk[]#
                            </iterate>
                            AND TSR.EZCANCELFLAG       = '0'
                            AND TSR.GLBL_CMPY_CD       = TS1.GLBL_CMPY_CD
                            AND TSR.FSR_STS_CD         = TS1.SVC_TASK_STS_CD
                            AND TS1.EZCANCELFLAG       = '0'
                            AND TSR.GLBL_CMPY_CD       = TS2.GLBL_CMPY_CD
                            AND TSR.FSR_VISIT_STS_CD   = TS2.SVC_TASK_STS_CD
                            AND TS2.EZCANCELFLAG       = '0'
                          </isEqual>
                          <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
                            <!-- START 2019/10/01 K.Kitachi [QC#53819, MOD] -->
                            <iterate property="techCdList" var="techCd[]" open="AND (OTD.TECH_CD, ' ') IN (" conjunction= "," close=")">
                                (#techCd[]#, ' ')
                            </iterate>
                            <!-- END 2019/10/01 K.Kitachi [QC#53819, MOD] -->
                            AND OTD.GLBL_CMPY_CD       = TCM.GLBL_CMPY_CD
                            AND OTD.TECH_CD            = TCM.TECH_TOC_CD
                            AND TCM.EZCANCELFLAG       = '0'
                          </isEqual>
                          <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
                            <iterate property="svcCallSrcTpCdList" var="svcCallSrcTpCd[]" open="AND OTD.SVC_CALL_SRC_TP_CD IN (" conjunction= "," close=")">
                                #svcCallSrcTpCd[]#
                            </iterate>
                            AND OTD.GLBL_CMPY_CD       = CST.GLBL_CMPY_CD
                            AND OTD.SVC_CALL_SRC_TP_CD = CST.SVC_CALL_SRC_TP_CD
                            AND CST.EZCANCELFLAG       = '0'
                          </isEqual>
                    ) CRIT_INFO
                    ,(
                        SELECT DISTINCT
                             OTD.GLBL_CMPY_CD
                            ,PSN.PSN_LAST_NM
                            ,PSN.PSN_FIRST_NM
                            ,PSN.PSN_CD
                        FROM
                             OPEN_SVC_TASK_DTL     OTD
                            ,S21_PSN               PSN
                        WHERE
                                OTD.GLBL_CMPY_CD       = #glblCmpyCd#
                          <isEqual property="mgrOrgLayerNum" compareValue="1">
                            AND OTD.FIRST_ORG_CD       = #orgCd#
                          </isEqual>
                          <isEqual property="mgrOrgLayerNum" compareValue="2">
                            AND OTD.SCD_ORG_CD         = #orgCd#
                          </isEqual>
                          <isEqual property="mgrOrgLayerNum" compareValue="3">
                            AND OTD.THIRD_ORG_CD       = #orgCd#
                          </isEqual>
                          <isEqual property="mgrOrgLayerNum" compareValue="4">
                            AND OTD.FRTH_ORG_CD        = #orgCd#
                          </isEqual>
                          <isEqual property="mgrOrgLayerNum" compareValue="5">
                            AND OTD.FIFTH_ORG_CD       = #orgCd#
                          </isEqual>
                          <isEqual property="mgrOrgLayerNum" compareValue="6">
                            AND OTD.SIXTH_ORG_CD       = #orgCd#
                          </isEqual>
                          <isEqual property="mgrOrgLayerNum" compareValue="7">
                            AND OTD.SVNTH_ORG_CD       = #orgCd#
                          </isEqual>
                          <isEqual property="mgrOrgLayerNum" compareValue="8">
                            AND OTD.EIGHTH_ORG_CD      = #orgCd#
                          </isEqual>
                          <isEqual property="mgrOrgLayerNum" compareValue="9">
                            AND OTD.NINTH_ORG_CD       = #orgCd#
                          </isEqual>
                          <isEqual property="mgrOrgLayerNum" compareValue="10">
                            AND OTD.TENTH_ORG_CD       = #orgCd#
                          </isEqual>
                          <isEqual property="mgrOrgLayerNum" compareValue="11">
                            AND OTD.ELVTH_ORG_CD       = #orgCd#
                          </isEqual>
<!-- START 2016/03/23 K.Yamada [QC#5857, ADD] -->
                          <isNull property="mgrOrgLayerNum">
                            AND (
                                    OTD.FIRST_ORG_CD       = #orgCd#
                                OR  OTD.SCD_ORG_CD         = #orgCd#
                                OR  OTD.THIRD_ORG_CD       = #orgCd#
                                OR  OTD.FRTH_ORG_CD        = #orgCd#
                                OR  OTD.FIFTH_ORG_CD       = #orgCd#
                                OR  OTD.SIXTH_ORG_CD       = #orgCd#
                                OR  OTD.SVNTH_ORG_CD       = #orgCd#
                                OR  OTD.EIGHTH_ORG_CD      = #orgCd#
                                OR  OTD.NINTH_ORG_CD       = #orgCd#
                                OR  OTD.TENTH_ORG_CD       = #orgCd#
                                OR  OTD.ELVTH_ORG_CD       = #orgCd#
                            )
                          </isNull>
<!-- END 2016/03/23 K.Yamada [QC#5857, ADD] -->
                            AND OTD.SVC_MGR_TP_CD      = #svcMgrTpCd#
                            <iterate property="svcMgrPsnCdList" var="svcMgrPsnCd[]" open="AND OTD.SVC_MGR_PSN_CD IN (" conjunction= "," close=")">
                                #svcMgrPsnCd[]#
                            </iterate>
                            AND OTD.EZCANCELFLAG       = '0'
                            AND OTD.GLBL_CMPY_CD       = PSN.GLBL_CMPY_CD
                            AND OTD.SVC_MGR_PSN_CD     = PSN.PSN_CD
                            AND PSN.EZCANCELFLAG       = '0'
                    ) MGR_INFO
                WHERE
                        CRIT_INFO.GLBL_CMPY_CD = MGR_INFO.GLBL_CMPY_CD
            ) DTL_INFO
            ,(
                SELECT
                  <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
                     DS_SVC_CALL_TP_CD
                  </isEqual>
                  <isEqual property="svcRqstCritTpCd" compareValue="STS">
                     FSR_SVC_TASK_STS_RELN_PK
                  </isEqual>
                  <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
                     TECH_CD
                  </isEqual>
                  <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
                     SVC_CALL_SRC_TP_CD
                  </isEqual>
                    ,PSN_CD
                    ,COUNT(*)                 AS CNT
                FROM
                    (
                        SELECT
                          <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
                             DS_SVC_CALL_TP_CD
                          </isEqual>
                          <isEqual property="svcRqstCritTpCd" compareValue="STS">
                             FSR_SVC_TASK_STS_RELN_PK
                          </isEqual>
                          <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
                             TECH_CD
                          </isEqual>
                          <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
                             SVC_CALL_SRC_TP_CD
                          </isEqual>
                            ,PSN_CD
                        FROM
                            (
                                SELECT
                                  <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
                                     OTD.DS_SVC_CALL_TP_CD
                                  </isEqual>
                                  <isEqual property="svcRqstCritTpCd" compareValue="STS">
                                     TSR.FSR_SVC_TASK_STS_RELN_PK
                                  </isEqual>
                                  <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
                                     OTD.TECH_CD
                                  </isEqual>
                                  <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
                                     OTD.SVC_CALL_SRC_TP_CD
                                  </isEqual>
                                    ,OTD.SVC_MGR_PSN_CD    AS PSN_CD
                                    ,ROW_NUMBER() OVER (PARTITION BY OTD.SVC_MGR_PSN_CD, OTD.SVC_TASK_NUM ORDER BY OTD.OPEN_SVC_TASK_DTL_PK ASC) AS ROW_NUMBER 
                                FROM
                                     OPEN_SVC_TASK_DTL     OTD
                                  <isEqual property="svcRqstCritTpCd" compareValue="STS">
                                    ,FSR_SVC_TASK_STS_RELN TSR
                                  </isEqual>
                                WHERE
                                        OTD.GLBL_CMPY_CD       = #glblCmpyCd#
                                  <isEqual property="mgrOrgLayerNum" compareValue="1">
                                    AND OTD.FIRST_ORG_CD       = #orgCd#
                                  </isEqual>
                                  <isEqual property="mgrOrgLayerNum" compareValue="2">
                                    AND OTD.SCD_ORG_CD         = #orgCd#
                                  </isEqual>
                                  <isEqual property="mgrOrgLayerNum" compareValue="3">
                                    AND OTD.THIRD_ORG_CD       = #orgCd#
                                  </isEqual>
                                  <isEqual property="mgrOrgLayerNum" compareValue="4">
                                    AND OTD.FRTH_ORG_CD        = #orgCd#
                                  </isEqual>
                                  <isEqual property="mgrOrgLayerNum" compareValue="5">
                                    AND OTD.FIFTH_ORG_CD       = #orgCd#
                                  </isEqual>
                                  <isEqual property="mgrOrgLayerNum" compareValue="6">
                                    AND OTD.SIXTH_ORG_CD       = #orgCd#
                                  </isEqual>
                                  <isEqual property="mgrOrgLayerNum" compareValue="7">
                                    AND OTD.SVNTH_ORG_CD       = #orgCd#
                                  </isEqual>
                                  <isEqual property="mgrOrgLayerNum" compareValue="8">
                                    AND OTD.EIGHTH_ORG_CD      = #orgCd#
                                  </isEqual>
                                  <isEqual property="mgrOrgLayerNum" compareValue="9">
                                    AND OTD.NINTH_ORG_CD       = #orgCd#
                                  </isEqual>
                                  <isEqual property="mgrOrgLayerNum" compareValue="10">
                                    AND OTD.TENTH_ORG_CD       = #orgCd#
                                  </isEqual>
                                  <isEqual property="mgrOrgLayerNum" compareValue="11">
                                    AND OTD.ELVTH_ORG_CD       = #orgCd#
                                  </isEqual>
<!-- START 2016/03/23 K.Yamada [QC#5857, ADD] -->
                                  <isNull property="mgrOrgLayerNum">
                                    AND (
                                            OTD.FIRST_ORG_CD   = #orgCd#
                                        OR  OTD.SCD_ORG_CD     = #orgCd#
                                        OR  OTD.THIRD_ORG_CD   = #orgCd#
                                        OR  OTD.FRTH_ORG_CD    = #orgCd#
                                        OR  OTD.FIFTH_ORG_CD   = #orgCd#
                                        OR  OTD.SIXTH_ORG_CD   = #orgCd#
                                        OR  OTD.SVNTH_ORG_CD   = #orgCd#
                                        OR  OTD.EIGHTH_ORG_CD  = #orgCd#
                                        OR  OTD.NINTH_ORG_CD   = #orgCd#
                                        OR  OTD.TENTH_ORG_CD   = #orgCd#
                                        OR  OTD.ELVTH_ORG_CD   = #orgCd#
                                    )
                                  </isNull>
<!-- END 2016/03/23 K.Yamada [QC#5857, ADD] -->
                                    AND OTD.SVC_MGR_TP_CD      = #svcMgrTpCd#
                                    <iterate property="svcMgrPsnCdList" var="svcMgrPsnCd[]" open="AND OTD.SVC_MGR_PSN_CD IN (" conjunction= "," close=")">
                                        #svcMgrPsnCd[]#
                                    </iterate>
<!-- START 2017/12/04 M.Kidokoro [QC#22483, DEL] -->
<!--                                    AND OTD.OPEN_TASK_LTST_FLG = 'Y' -->
<!-- END 2017/12/04 M.Kidokoro [QC#22483, DEL] -->
                                  <isEqual property="svcRqstDownTpCd" compareValue="IN">
                                    AND OTD.IN_PROC_TASK_FLG   = 'Y'
                                  </isEqual>
                                  <isEqual property="svcRqstDownTpCd" compareValue="CLO">
                                    AND OTD.CLO_TASK_FLG       = 'Y'
                                  </isEqual>
                                  <isEqual property="svcRqstDownTpCd" compareValue="CNCL">
                                    AND OTD.CANC_TASK_FLG      = 'Y'
                                  </isEqual>
                                  <isEqual property="svcRqstDownTpCd" compareValue="RJCT">
                                    AND OTD.REJ_TASK_FLG       = 'Y'
                                  </isEqual>
                                  <isEqual property="svcRqstDownTpCd" compareValue="RESP">
                                    AND OTD.TM_RSP_FLG         = 'Y'
                                  </isEqual>
                                  <!-- START 2019/03/28 S.Kitamura [QC#30233,ADD] -->
                                  <isEqual property="svcRqstDownTpCd" compareValue="TBO">
                                    AND OTD.TO_BE_OPTM_TASK_FLG = 'Y'
                                  </isEqual>
                                  <isEqual property="svcRqstDownTpCd" compareValue="SCHD">
                                    AND OTD.SCHD_TASK_FLG       = 'Y'
                                  </isEqual>
                                  <!-- END 2019/03/28 S.Kitamura [QC#30233,ADD] -->
                                  <isEqual property="svcRqstDownTpCd" compareValue="ASSN">
                                    AND OTD.ASG_TASK_FLG       = 'Y'
                                  </isEqual>
                                  <isEqual property="svcRqstDownTpCd" compareValue="OPEN">
                                    AND OTD.OPEN_TASK_FLG      = 'Y'
                                  </isEqual>
                                  <isEqual property="svcRqstDownTpCd" compareValue="HLD">
                                    AND OTD.HLD_TASK_FLG       = 'Y'
                                  </isEqual>
                                  <isEqual property="svcRqstDownTpCd" compareValue="ESCL">
                                    AND OTD.ESCL_TASK_FLG      = 'Y'
                                  </isEqual>
                                  <isEqual property="svcRqstDownTpCd" compareValue="VIP">
                                    AND OTD.VIP_TASK_FLG       = 'Y'
                                  </isEqual>
                                  <isEqual property="svcRqstDownTpCd" compareValue="ERR">
                                    AND OTD.ATTN_TASK_FLG      = 'Y'
                                  </isEqual>
                                    AND OTD.EZCANCELFLAG       = '0'
                                  <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
                                    <iterate property="dsSvcCallTpCdList" var="dsSvcCallTpCd[]" open="AND OTD.DS_SVC_CALL_TP_CD IN (" conjunction= "," close=")">
                                        #dsSvcCallTpCd[]#
                                    </iterate>
                                  </isEqual>
                                  <isEqual property="svcRqstCritTpCd" compareValue="STS">
                                    AND OTD.GLBL_CMPY_CD       = TSR.GLBL_CMPY_CD
                                    AND OTD.FSR_STS_CD         = TSR.FSR_STS_CD
                                    AND OTD.FSR_VISIT_STS_CD   = TSR.FSR_VISIT_STS_CD
                                    <iterate property="fsrSvcTaskStsRelnPkList" var="fsrSvcTaskStsRelnPk[]" open="AND TSR.FSR_SVC_TASK_STS_RELN_PK IN (" conjunction= "," close=")">
                                        #fsrSvcTaskStsRelnPk[]#
                                    </iterate>
                                    AND TSR.EZCANCELFLAG       = '0'
                                  </isEqual>
                                  <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
                                    <!-- START 2019/10/01 K.Kitachi [QC#53819, MOD] -->
                                    <iterate property="techCdList" var="techCd[]" open="AND (OTD.TECH_CD, ' ') IN (" conjunction= "," close=")">
                                        (#techCd[]#, ' ')
                                    </iterate>
                                    <!-- END 2019/10/01 K.Kitachi [QC#53819, MOD] -->
                                  </isEqual>
                                  <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
                                    <iterate property="svcCallSrcTpCdList" var="svcCallSrcTpCd[]" open="AND OTD.SVC_CALL_SRC_TP_CD IN (" conjunction= "," close=")">
                                        #svcCallSrcTpCd[]#
                                    </iterate>
                                  </isEqual>
                            )
                        WHERE
                            ROW_NUMBER = 1
                    )
                GROUP BY
                  <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
                     DS_SVC_CALL_TP_CD
                  </isEqual>
                  <isEqual property="svcRqstCritTpCd" compareValue="STS">
                     FSR_SVC_TASK_STS_RELN_PK
                  </isEqual>
                  <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
                     TECH_CD
                  </isEqual>
                  <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
                     SVC_CALL_SRC_TP_CD
                  </isEqual>
                    ,PSN_CD
            ) SMRY_CNT
        WHERE
          <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
                DTL_INFO.DS_SVC_CALL_TP_CD        = SMRY_CNT.DS_SVC_CALL_TP_CD        (+)
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="STS">
                DTL_INFO.FSR_SVC_TASK_STS_RELN_PK = SMRY_CNT.FSR_SVC_TASK_STS_RELN_PK (+)
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
                DTL_INFO.TECH_CD                  = SMRY_CNT.TECH_CD                  (+)
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
                DTL_INFO.SVC_CALL_SRC_TP_CD       = SMRY_CNT.SVC_CALL_SRC_TP_CD       (+)
          </isEqual>
            AND DTL_INFO.PSN_CD                   = SMRY_CNT.PSN_CD                   (+)
        ORDER BY
             DTL_INFO.XX_SCR_ITEM_130_TXT      NULLS LAST
          <isEqual property="svcRqstCritTpCd" compareValue="CLTP">
            ,DTL_INFO.DS_SVC_CALL_TP_CD
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="STS">
            ,DTL_INFO.FSR_SVC_TASK_STS_RELN_PK
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="ASGN">
            ,DTL_INFO.TECH_CD
          </isEqual>
          <isEqual property="svcRqstCritTpCd" compareValue="CNNL">
            ,DTL_INFO.SVC_CALL_SRC_TP_CD
          </isEqual>
            ,DTL_INFO.XX_SCR_ITEM_81_TXT       NULLS LAST
            ,DTL_INFO.PSN_CD
<!-- mod end 2016/10/18 CSA Defect#11030 -->
    </statement>
</sqlMap>
