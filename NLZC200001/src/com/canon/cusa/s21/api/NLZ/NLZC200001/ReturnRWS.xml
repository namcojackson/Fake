<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="ReturnRWS">
    <!-- ==== Type Aliases ==== -->
    <typeAlias alias="ReturnOrderBean"      type="com.canon.cusa.s21.api.NLZ.NLZC200001.ReturnOrderBean"/>
    <typeAlias alias="ShpgSvcInfoBean"      type="com.canon.cusa.s21.api.NLZ.NLZC200001.ShpgSvcInfoBean"/>
    <!-- START 2017/10/17 S.Katsuma [Sol#454,ADD] -->
    <typeAlias alias="DS_CPO_CTAC_PSNTMsg"          type="business.db.DS_CPO_CTAC_PSNTMsg"/>
    <!-- END 2017/10/17 S.Katsuma [Sol#454,ADD] -->
    <!-- ==== Statement ==== -->
    <!-- ==== Result Mapping ==== -->

    <statement id="getSvcExchgCatgList" parameterClass="Map" resultClass="String">
        SELECT DISTINCT
            DS_ORD_CATG_CD
        FROM
            ORD_CATG_BIZ_CTX
        WHERE
            GLBL_CMPY_CD       = #glblCmpyCd#
        AND ORD_CATG_CTX_TP_CD = #ordCatgCtxTpCd#
        AND EZCANCELFLAG       = '0'
    </statement>

    <!-- QC#50392 Update. Add DS_CPO_ISTL_INFO -->
    <!--<statement id="getReturnOrderDetail" parameterClass="Map" resultMap="result.ReturnOrderBean"> -->
    <statement id="getReturnOrderDetail" parameterClass="Map" resultClass="Map"> 
        SELECT
             DCRD.CPO_ORD_NUM
            ,DCRD.DS_CPO_RTRN_LINE_NUM
            ,DCRD.DS_CPO_RTRN_LINE_SUB_NUM
            ,DCRD.DS_ORD_POSN_NUM
            ,DCRD.DS_CPO_CONFIG_PK
            ,DCRD.RTL_WH_CD
            ,DCRD.RTL_SWH_CD
            ,DCRD.INVTY_LOC_CD
            ,DCRD.SHIP_TO_CUST_CD
            ,DCRD.SHIP_TO_LOC_NM
            ,DCRD.SHIP_TO_ADDL_LOC_NM
            ,DCRD.SHIP_TO_CTY_ADDR
            ,DCRD.SHIP_TO_ST_CD
            ,DCRD.SHIP_TO_CTRY_CD
            ,DCRD.SHIP_TO_FIRST_LINE_ADDR
            ,DCRD.SHIP_TO_SCD_LINE_ADDR
            ,DCRD.SHIP_TO_THIRD_LINE_ADDR
            ,DCRD.SHIP_TO_FRTH_LINE_ADDR
            ,DCRD.SHIP_TO_POST_CD
            ,DCRD.TRX_CD
            ,DCRD.TRX_RSN_CD
            ,DCRD.SVC_CONFIG_MSTR_PK
            ,DCRD.BASE_CMPT_FLG
            ,DCRD.STK_STS_CD
            ,DCRD.MDSE_CD
            ,DCRD.RQST_PICK_UP_DT
            ,DCRD.THIRD_PTY_DSP_TP_CD
            ,DCRD.SVC_MACH_MSTR_PK
            ,M.SHPG_SER_TAKE_FLG
            ,M.RCV_SER_TAKE_FLG
            ,C.ADD_SHPG_SVC_LVL_CD
            ,C.ADD_FRT_CHRG_TO_CD
            ,C.ADD_FRT_CHRG_METH_CD
            ,C.SELL_TO_CUST_CD
            ,DCDI.DELY_ADDL_CMNT_TXT
            ,SSLCR.CARR_CD
            ,SSLCR.SHPG_SVC_LVL_CD
            ,C.ORD_BOOK_TS
            ,C.DS_ORD_CATG_CD
            <!-- START 2017/10/17 S.Katsuma [Sol#454,ADD] -->
            ,C.SELL_TO_FIRST_REF_CMNT_TXT
            <!-- END 2017/10/17 S.Katsuma [Sol#454,ADD] -->
            ,DCI.RQST_ISTL_DT
            ,DCI.RQST_ISTL_TM
            ,SIR.TECH_MEET_TRUCK_DEF_FLG
        FROM
             DS_CPO_RTRN_DTL        DCRD
            ,MDSE                   M
            ,CPO                    C
            ,DS_CPO_DELY_INFO       DCDI
            ,SHPG_SVC_LVL_CARR_RELN SSLCR
            ,DS_CPO_ISTL_INFO       DCI
            ,SVC_ISTL_RULE          SIR
        WHERE
            DCRD.GLBL_CMPY_CD             = #glblCmpyCd#
        AND DCRD.CPO_ORD_NUM              = #cpoOrdNum#
        AND DCRD.DS_ORD_POSN_NUM          = #dsOrdPosnNum#
        AND DCRD.DS_CPO_RTRN_LINE_NUM     = #dsCpoRtrnLineNum#
        AND DCRD.DS_CPO_RTRN_LINE_SUB_NUM = #dsCpoRtrnLineSubNum#
        AND DCRD.EZCANCELFLAG             = '0'
        AND M.GLBL_CMPY_CD                = DCRD.GLBL_CMPY_CD
        AND M.MDSE_CD                     = DCRD.MDSE_CD
        AND M.EZCANCELFLAG                = '0'
        AND C.GLBL_CMPY_CD                = DCRD.GLBL_CMPY_CD
        AND C.CPO_ORD_NUM                 = DCRD.CPO_ORD_NUM
        AND C.EZCANCELFLAG                = '0'
        AND DCDI.GLBL_CMPY_CD(+)          = DCRD.GLBL_CMPY_CD
        AND DCDI.CPO_ORD_NUM(+)           = DCRD.CPO_ORD_NUM
        AND DCDI.DS_CPO_CONFIG_PK(+)      = DCRD.DS_CPO_CONFIG_PK
        AND DCDI.EZCANCELFLAG(+)          = '0'
        AND SSLCR.GLBL_CMPY_CD(+)         = C.GLBL_CMPY_CD
        AND SSLCR.CARR_SVC_LVL_CD(+)      = C.CARR_SVC_LVL_CD
        AND SSLCR.EZCANCELFLAG(+)         = '0'
        AND DCI.GLBL_CMPY_CD(+)           = DCRD.GLBL_CMPY_CD
        AND DCI.CPO_ORD_NUM(+)            = DCRD.CPO_ORD_NUM
        AND DCI.DS_CPO_CONFIG_PK(+)       = DCRD.DS_CPO_CONFIG_PK
        AND DCI.EZCANCELFLAG(+)           = '0'
        AND SIR.GLBL_CMPY_CD(+)           = DCI.GLBL_CMPY_CD
        AND SIR.SVC_ISTL_RULE_NUM(+)      = DCI.SVC_ISTL_RULE_NUM
        AND SIR.EZCANCELFLAG(+)           = '0'
    </statement>

    <resultMap id="result.ReturnOrderBean" class="ReturnOrderBean">
        <result property="cpoOrdNum"             column="CPO_ORD_NUM"                javaType="String"/>
        <result property="dsCpoRtrnLineNum"      column="DS_CPO_RTRN_LINE_NUM"       javaType="String"/>
        <result property="dsCpoRtrnLineSubNum"   column="DS_CPO_RTRN_LINE_SUB_NUM"   javaType="String"/>
        <result property="dsOrdPosnNum"          column="DS_ORD_POSN_NUM"            javaType="String"/>
        <result property="dsCpoConfigPk"         column="DS_CPO_CONFIG_PK"           javaType="BigDecimal"/>
        <result property="rtlWhCd"               column="RTL_WH_CD"                  javaType="String"/>
        <result property="rtlSwhCd"              column="RTL_SWH_CD"                 javaType="String"/>
        <result property="invtyLocCd"            column="INVTY_LOC_CD"               javaType="String"/>
        <result property="shipToCustCd"          column="SHIP_TO_CUST_CD"            javaType="String"/>
        <result property="shipToLocNm"           column="SHIP_TO_LOC_NM"             javaType="String"/>
        <result property="shipToAddlLocNm"       column="SHIP_TO_ADDL_LOC_NM"        javaType="String"/>
        <result property="shipToCtyAddr"         column="SHIP_TO_CTY_ADDR"           javaType="String"/>
        <result property="shipToStCd"            column="SHIP_TO_ST_CD"              javaType="String"/>
        <result property="shipToCtryCd"          column="SHIP_TO_CTRY_CD"            javaType="String"/>
        <result property="shipToFirstLineAddr"   column="SHIP_TO_FIRST_LINE_ADDR"    javaType="String"/>
        <result property="shipToScdLineAddr"     column="SHIP_TO_SCD_LINE_ADDR"      javaType="String"/>
        <result property="shipToThirdLineAddr"   column="SHIP_TO_THIRD_LINE_ADDR"    javaType="String"/>
        <result property="shipToFrthLineAddr"    column="SHIP_TO_FRTH_LINE_ADDR"     javaType="String"/>
        <result property="shipToPostCd"          column="SHIP_TO_POST_CD"            javaType="String"/>
        <result property="trxCd"                 column="TRX_CD"                     javaType="String"/>
        <result property="trxRsnCd"              column="TRX_RSN_CD"                 javaType="String"/>
        <result property="svcConfigMstrPk"       column="SVC_CONFIG_MSTR_PK"         javaType="BigDecimal"/>
        <result property="baseCmptFlg"           column="BASE_CMPT_FLG"              javaType="String"/>
        <result property="stkStsCd"              column="STK_STS_CD"                 javaType="String"/>
        <result property="mdseCd"                column="MDSE_CD"                    javaType="String"/>
        <result property="rqstPickUpDt"          column="RQST_PICK_UP_DT"            javaType="String"/>
        <result property="thirdPtyDspTpCd"       column="THIRD_PTY_DSP_TP_CD"        javaType="String"/>
        <result property="shpgSerTakeFlg"        column="SHPG_SER_TAKE_FLG"          javaType="String"/>
        <result property="rcvSerTakeFlg"         column="RCV_SER_TAKE_FLG"           javaType="String"/>
        <result property="addShpgSvcLvlCd"       column="ADD_SHPG_SVC_LVL_CD"        javaType="String"/>
        <result property="addFrtChrgToCd"        column="ADD_FRT_CHRG_TO_CD"         javaType="String"/>
        <result property="addFrtChrgMethCd"      column="ADD_FRT_CHRG_METH_CD"       javaType="String"/>
        <result property="delyAddlCmntTxt"       column="DELY_ADDL_CMNT_TXT"         javaType="String"/>
        <result property="carrCd"                column="CARR_CD"                    javaType="String"/>
        <result property="shpgSvcLvlCd"          column="SHPG_SVC_LVL_CD"            javaType="String"/>
        <result property="sellToCustCd"          column="SELL_TO_CUST_CD"            javaType="String"/>
        <result property="ordBookTs"             column="ORD_BOOK_TS"                javaType="String"/>
        <result property="dsOrdCatgCd"           column="DS_ORD_CATG_CD"             javaType="String"/>
    </resultMap>

    <!-- <statement id="getShpgSvcLeadTm" parameterClass="Map" resultMap="result.ShpgSvcLeadTm"> -->
    <statement id="getShpgSvcLeadTm" parameterClass="Map" resultClass="Map">
        SELECT
             SLT.DELY_LEAD_AOT
            ,SSL.SHPG_SVC_TP_CD
        FROM
             SHPG_SVC_LEAD_TM SLT
            ,SHPG_SVC_LVL SSL
        WHERE
             SLT.GLBL_CMPY_CD    = #glblCmpyCd#
         AND SLT.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
         AND SLT.EZCANCELFLAG    = '0'
         AND SSL.EZCANCELFLAG    = '0'
         AND SLT.GLBL_CMPY_CD    = SSL.GLBL_CMPY_CD
         AND SLT.SHPG_SVC_LVL_CD = SSL.SHPG_SVC_LVL_CD
    </statement>

    <resultMap id="result.ShpgSvcLeadTm" class="ShpgSvcInfoBean">
        <result property="delyLeadAot"    column="DELY_LEAD_AOT"     javaType="BigDecimal"/>
        <result property="shpgSvcTpCd"    column="SHPG_SVC_TP_CD"    javaType="String"/>
    </resultMap>
    <!-- 09/11/2017 CIT S.Endo Mod Sol#069(QC#18270) START -->
    <statement id="getMaxRwsRefNum" parameterClass="Map" resultClass="String">
        SELECT
            MAX(R.RWS_REF_NUM)     R_RWS_REF_NUM
        FROM
            RWS_HDR                R
        WHERE
                R.GLBL_CMPY_CD     = #glblCmpyCd#
            <!-- AND R.WH_CD            = #whCd# -->
            AND REGEXP_LIKE(R.RWS_REF_NUM, #rwsRefNum#)
            AND R.EZCANCELFLAG     = '0'
        <!-- GROUP BY  -->
        <!-- R.WH_CD  -->
    </statement>
    <!-- 09/11/2017 CIT S.Endo Mod Sol#069(QC#18270) END -->
    <statement id="getDsAcctNm" parameterClass="Map" resultClass="String">
        SELECT
             SELL.DS_ACCT_NM
        FROM
             SELL_TO_CUST SELL
            ,SHIP_TO_CUST SHIP
        WHERE
            SHIP.GLBL_CMPY_CD    = #glblCmpyCd#
        AND SHIP.SHIP_TO_CUST_CD = #shipToCustCd#
        AND SHIP.EZCANCELFLAG    = '0'
        AND SHIP.GLBL_CMPY_CD    = SELL.GLBL_CMPY_CD
        AND SHIP.SELL_TO_CUST_CD = SELL.SELL_TO_CUST_CD
        AND SELL.EZCANCELFLAG    = '0'
    </statement>

    <!-- START 2017/10/17 S.Katsuma [Sol#454,ADD] -->
    <statement id="getContactPerson" parameterClass="Map" resultMap="result.DS_CPO_CTAC_PSNTMsg">
        SELECT
            DCCP.CTAC_PSN_TEL_NUM
           ,DCCP.DS_CPO_CTAC_PSN_PK
           <!-- 2019/02/25 QC#30392 Add Start -->
           ,DCCP.CTAC_PSN_FIRST_NM
           ,DCCP.CTAC_PSN_LAST_NM
           <!-- 2019/02/25 QC#30392 Add End -->
        FROM
            DS_CPO_CTAC_PSN DCCP
        WHERE
            DCCP.GLBL_CMPY_CD     = #glblCmpyCd#
        AND DCCP.EZCANCELFLAG     = '0'
        AND DCCP.CPO_ORD_NUM      = #cpoOrdNum#
        AND DCCP.DS_CPO_CONFIG_PK = #dsCpoConfigPk#
        AND DCCP.CTAC_PSN_TP_CD  IN (#ctacPsnTpDelivIns#, #ctacPsnTpOrdCtac#)
    </statement>
    <resultMap id="result.DS_CPO_CTAC_PSNTMsg" class="DS_CPO_CTAC_PSNTMsg">
         <result property="ctacPsnTelNum" column="CTAC_PSN_TEL_NUM" javaType="EZDTStringItem"/>
         <result property="dsCpoCtacPsnPk" column="DS_CPO_CTAC_PSN_PK" javaType="EZDSBigDecimalItem"/>
         <!-- 2019/02/25 QC#30392 Add Start -->
         <result property="ctacPsnFirstNm" column="CTAC_PSN_FIRST_NM" javaType="EZDTStringItem"/>
         <result property="ctacPsnLastNm" column="CTAC_PSN_LAST_NM" javaType="EZDTStringItem"/>
         <!-- 2019/02/25 QC#30392 Add End -->
    </resultMap>
    <!-- END 2017/10/17 S.Katsuma [Sol#454,ADD] -->

    <!-- QC#21528 2017/10/30 Add SQL -->
    <statement id="getSvcMachTpCd" parameterClass="Map" resultClass="String">
        SELECT
            SMM.SVC_MACH_TP_CD
        FROM 
            SVC_MACH_MSTR SMM
        WHERE
            SMM.GLBL_CMPY_CD       = #glblCmpyCd#
        AND SMM.SVC_CONFIG_MSTR_PK = #svcConfigMstrPk#
        AND SMM.MDSE_CD            = #mdseCd#
        AND SMM.TRX_HDR_NUM        = #trxHdrNum#
        AND SMM.TRX_LINE_NUM       = #trxLinenum#
        AND SMM.TRX_LINE_SUB_NUM   = #trxLineSubNum#
        AND SMM.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getSvcMachTpCdWithPk" parameterClass="Map" resultClass="String">
        SELECT
            SMM.SVC_MACH_TP_CD
        FROM 
            SVC_MACH_MSTR SMM
        WHERE
            SMM.GLBL_CMPY_CD       = #glblCmpyCd#
        AND SMM.SVC_CONFIG_MSTR_PK = #svcConfigMstrPk#
        AND SMM.MDSE_CD            = #mdseCd#
        AND SMM.SVC_MACH_MSTR_PK   = #svcMachMstrPk#
        AND SMM.EZCANCELFLAG       = '0'
    </statement>
</sqlMap>