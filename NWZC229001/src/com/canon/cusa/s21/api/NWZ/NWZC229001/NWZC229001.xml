<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWZC229001">
    <statement id="chkMstrBankAcct" parameterClass="Map" resultClass="Map">
    SELECT
         A.EZCANCELFLAG
        ,A.GLBL_CMPY_CD
        ,A.DS_BANK_ACCT_NUM
        ,A.BANK_RTE_NUM
        ,A.EFF_FROM_DT
        ,A.EFF_THRU_DT
    FROM
        DS_BANK_ACCT A
    WHERE
            A.GLBL_CMPY_CD                      = #glblCmpyCd#
        AND A.EZCANCELFLAG                      = '0'
        AND A.DS_BANK_ACCT_NUM                  = #dsBankAcctNum#
        AND A.BANK_RTE_NUM                      = #bankRteNum#
        AND A.EFF_FROM_DT                   &lt;= #slsDt#
        AND NVL(A.EFF_THRU_DT,'99991231')   &gt;= #slsDt#
    </statement>

    <statement id="relationCheck" parameterClass="Map" resultClass="Map">
    SELECT
         B.DS_CUST_BANK_ACCT_RELN_PK 
        ,A.EFF_FROM_DT
        ,A.EFF_THRU_DT
        ,C.SELL_TO_CUST_CD
    FROM
         DS_BANK_ACCT A
        ,DS_CUST_BANK_ACCT_RELN B
        ,SELL_TO_CUST C
    WHERE
            A.GLBL_CMPY_CD               = #glblCmpyCd#
        AND A.EZCANCELFLAG               = '0'
        AND A.GLBL_CMPY_CD               = B.GLBL_CMPY_CD
        AND A.DS_BANK_ACCT_PK            = B.DS_BANK_ACCT_PK
        AND B.DS_CUST_BANK_ACCT_RELN_PK  = #dsCustBankAcctRelnPk#
        AND B.EZCANCELFLAG               = '0'
        AND B.GLBL_CMPY_CD               = C.GLBL_CMPY_CD
        AND B.DS_ACCT_CUST_PK            = C.SELL_TO_CUST_PK
        AND C.SELL_TO_CUST_CD            = #sellToCustCd#
    </statement>
    
    <statement id="getCustomerInfo" parameterClass="Map" resultClass="Map">
    SELECT
         MAIN.SELL_TO_CUST_CD
        ,MAIN.LOC_NM
        ,MAIN.POST_CD
        ,MAIN.DS_CTAC_PSN_RELN_PK
        ,MAIN.CTAC_PSN_PK
        ,MAIN.DS_ACCT_NUM
        ,MAIN.LOC_NUM
        ,MAIN.TEL_NUM
        ,MAIN.MAIL
    FROM
        (
        SELECT
             STC.SELL_TO_CUST_CD
            ,STC.LOC_NM
            ,STC.POST_CD
            ,CPR.DS_CTAC_PSN_RELN_PK
            ,CPR.CTAC_PSN_PK
            ,CPR.DS_ACCT_NUM
            ,CPR.LOC_NUM
            ,REGEXP_REPLACE(TEL.DS_CTAC_PNT_VAL_TXT, '[^0-9]', '') AS TEL_NUM
            ,MAIL.DS_CTAC_PNT_VAL_TXT   AS MAIL
        FROM
             SELL_TO_CUST           STC
            ,DS_CTAC_PSN_RELN       CPR
            ,DS_CTAC_PNT            TEL
            ,DS_CTAC_PNT            MAIL
        WHERE
                STC.GLBL_CMPY_CD    = #glblCmpyCd#
            AND STC.SELL_TO_CUST_CD = #billToCustAcctCd#
            AND STC.EZCANCELFLAG    = '0'
            
            AND STC.GLBL_CMPY_CD                        = CPR.GLBL_CMPY_CD(+)
            AND STC.SELL_TO_CUST_CD                     = CPR.DS_ACCT_NUM(+)
            AND CPR.CTAC_TP_CD(+)                       IN (#ctacTpCdAp#, #ctacTpCdBillToContact#)
            AND CPR.EFF_FROM_DT(+)                  &lt;= #slsDt#
            AND NVL(CPR.EFF_THRU_DT(+),'99991231')  &gt;= #slsDt#
            AND CPR.EZCANCELFLAG(+)                     = '0'
            
            AND CPR.GLBL_CMPY_CD             = TEL.GLBL_CMPY_CD(+)
            AND CPR.CTAC_PSN_PK              = TEL.CTAC_PSN_PK(+)
            AND TEL.DS_CTAC_PNT_TP_CD(+)     IN(#dsCtacPntTpCd02#, #dsCtacPntTpCd01#)
            AND TEL.DS_CTAC_PNT_ACTV_FLG(+)  = #actvFlg#
            AND TEL.EZCANCELFLAG(+)          = '0'
            
            AND CPR.GLBL_CMPY_CD             = MAIL.GLBL_CMPY_CD(+)
            AND CPR.CTAC_PSN_PK              = MAIL.CTAC_PSN_PK(+)
            AND MAIL.DS_CTAC_PNT_TP_CD(+)    = #dsCtacPntTpCd04#
            AND MAIL.DS_CTAC_PNT_ACTV_FLG(+) = #actvFlg#
            AND MAIL.EZCANCELFLAG(+) = '0'
        ORDER BY
             CPR.CTAC_TP_CD
            ,CPR.CTAC_PSN_PK 
            ,TEL.DS_CTAC_PNT_TP_CD DESC
        ) MAIN
    WHERE
        ROWNUM = 1
    </statement>
</sqlMap>
