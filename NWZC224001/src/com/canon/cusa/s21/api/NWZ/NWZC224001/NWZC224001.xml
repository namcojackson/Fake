<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWZC224001">
    <statement id="getBizDoc" parameterClass="Map" resultClass="Map">
        SELECT
             ''                                        AS POD_NUM
            ,CV.CPO_ORD_NUM                           AS RMA_NUM
            ,(SELECT ATT.ATT_DATA_NM
                FROM ATT_DATA ATT
               WHERE ATT.GLBL_CMPY_CD     = CV.GLBL_CMPY_CD
                 AND ATT.ATT_DATA_GRP_TXT = CV.CPO_ORD_NUM
                 AND ATT.ATT_DATA_NM      IS NOT NULL
                 AND ATT.ATT_DATA_TP_CD   = 'TF'
                 AND ATT.ATT_DOC_TP_CD    = '70'
                 AND ATT.EZCANCELFLAG     = '0'
                 AND ROWNUM               = 1)         AS SLS_ORD_DOC_ID
            ,CV.CPO_ORD_NUM                           AS CPO_ORD_NUM
            ,CV.CPO_ORD_TS                            AS CPO_ORD_TS
            ,CV.CUST_ISS_PO_NUM                       AS CUST_ISS_PO_NUM
            ,CV.CUST_ISS_PO_DT                        AS CUST_ISS_PO_DT
            ,(SELECT OSV.ORD_HDR_STS_NM
                FROM DS_ORD_STS_V OSV
               WHERE OSV.GLBL_CMPY_CD = CV.GLBL_CMPY_CD
                 AND OSV.CPO_ORD_NUM  = CV.CPO_ORD_NUM
                 AND OSV.EZCANCELFLAG = '0'
                 AND ROWNUM           = 1)             AS ORD_HDR_STS_NM
            ,(SELECT ADM.FULL_PSN_NM
                FROM S21_PSN_V ADM
               WHERE ADM.GLBL_CMPY_CD = CV.GLBL_CMPY_CD
                 AND ADM.PSN_CD       = CV.ADMIN_PSN_CD
                 AND ADM.EZCANCELFLAG = '0'
                 AND ROWNUM           = 1)             AS ADMIN_PSN_NM
            ,CV.ADD_RDD_DT                            AS ADD_RDD_DT
            ,CV.CPO_CANC_DT                           AS CPO_CANC_DT
            ,CV.BILL_TO_CUST_CD                       AS BILL_TO_CUST_CD
            ,CV.ADD_SHIP_TO_CUST_CD                   AS ADD_SHIP_TO_CUST_CD
            ,CV.SELL_TO_CUST_CD                       AS SELL_TO_CUST_CD
            ,CV.ADD_PMT_TERM_CASH_DISC_CD             AS ADD_PMT_TERM_CASH_DISC_CD
            ,CV.ORD_SGN_DT                            AS ORD_SGN_DT
            ,CV.ORG_RQST_DELY_DT                      AS ORG_RQST_DELY_DT
            ,CV.CARR_ACCT_NUM                         AS CARR_ACCT_NUM
            ,CV.BILL_TO_CUST_ACCT_CD                  AS BILL_TO_CUST_ACCT_CD
            ,CV.SHIP_TO_CUST_ACCT_CD                  AS SHIP_TO_CUST_ACCT_CD
            ,CV.NEGO_DEAL_AMT                         AS NEGO_DEAL_AMT
            ,CV.COA_BR_CD                             AS COA_BR_CD
            ,CV.COA_EXTN_CD                           AS COA_EXTN_CD
            ,CV.AQU_NUM                               AS AQU_NUM
            ,CV.ORD_SRC_REF_NUM                       AS ORD_SRC_REF_NUM
            ,CV.PRC_CONTR_NM                          AS PRC_CONTR_NM
            ,CV.PRC_CONTR_NUM                         AS PRC_CONTR_NUM
            ,CV.LOAN_PER_DAYS_AOT                     AS LOAN_PER_DAYS_AOT
            ,CV.CSMP_CONTR_NUM                        AS CSMP_CONTR_NUM
            ,CV.LEASE_CMPY_PO_NUM                     AS LEASE_CMPY_PO_NUM
            ,CV.LEASE_TOT_PMT_AMT                     AS LEASE_TOT_PMT_AMT
            ,CV.ORD_BOOK_TS                           AS ORD_BOOK_TS
            ,CV.DLR_REF_NUM                           AS DLR_REF_NUM
            ,CV.DS_ORD_CATG_DESC_TXT                  AS DS_ORD_CATG_DESC_TXT
            ,CV.ORD_TOT_DEAL_NET_AMT                  AS ORD_TOT_DEAL_NET_AMT
            ,CV.BILL_TO_CUST_ACCT_NM                  AS BILL_TO_CUST_ACCT_NM
            ,CV.BILL_TO_CUST_LOC_ADDR                 AS BILL_TO_CUST_LOC_ADDR
            ,CV.SHIP_TO_CUST_ACCT_NM                  AS SHIP_TO_CUST_ACCT_NM
            ,CV.SHIP_TO_CUST_LOC_ADDR                 AS SHIP_TO_CUST_LOC_ADDR
            ,CV.SOLD_TO_CUST_ACCT_NM                  AS SOLD_TO_CUST_ACCT_NM
            ,CV.SOLD_TO_CUST_LOC_ADDR                 AS SOLD_TO_CUST_LOC_ADDR
            ,CV.SLS_REP_TOC_NM                        AS SLS_REP_TOC_NM
            ,CV.COA_BR_DESC_TXT                       AS COA_BR_DESC_TXT
            ,CV.COA_EXTN_DESC_TXT                     AS COA_EXTN_DESC_TXT
            ,CV.PRC_CATG_NM                           AS PRC_CATG_NM
            ,CV.CPO_SRC_TP_DESC_TXT                   AS CPO_SRC_TP_DESC_TXT
            ,CV.FRT_COND_DESC_TXT                     AS FRT_COND_DESC_TXT
            ,CV.CARR_SVC_LVL_DESC_TXT                 AS CARR_SVC_LVL_DESC_TXT
            ,CV.FL_PRC_LIST_NM                        AS FL_PRC_LIST_NM
            ,CV.LINE_BIZ_TP_CD                        AS LINE_BIZ_TP_CD
            ,CV.DS_ORD_TP_DESC_TXT                    AS DS_ORD_TP_DESC_TXT
            ,CV.LEASE_TERM_MTH_AOT                    AS LEASE_TERM_MTH_AOT
            ,(SELECT APV.FULL_PSN_NM
                FROM S21_PSN_V APV
               WHERE APV.GLBL_CMPY_CD = CV.GLBL_CMPY_CD
                 AND APV.PSN_CD       = CV.SLS_REP_PSN_NUM
                 AND APV.EZCANCELFLAG = '0'
                 AND ROWNUM           = 1)             AS SLS_REP_PSN_NM
            ,CV.ORD_BOOK_REQ_TS_DPLY_TXT              AS ORD_BOOK_REQ_TS_DPLY_TXT
            ,CV.ORD_BOOK_REQ_USR_NM                   AS ORD_BOOK_REQ_USR_NM
            ,CV.ORD_SRC_IMPT_TS                       AS ORD_SRC_IMPT_TS
        FROM
            CPO_V     CV
        WHERE
            CV.GLBL_CMPY_CD       = #glblCmpyCd#
        AND CV.CPO_ORD_NUM        = #docMgtPrntDocNum#
        AND CV.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getIdxAttrbInfo" parameterClass="Map" resultClass="Map">
        SELECT
            DMI.IDX_ATTRB_TRGT_COL_NM
            ,DMI.DOC_MGT_FLD_CD
            ,DMF.DOC_MGT_FLD_NUM
            ,DMF.DOC_MGT_FLD_TP_CD
            ,DMC.DOC_MGT_CATG_CD
            ,DMC.DOC_MGT_CATG_NUM
        FROM
            DOC_MGT_IDX_ATTRB_DFN DMI
            ,DOC_MGT_FLD          DMF
            ,DOC_MGT_CATG         DMC
        WHERE
            DMI.GLBL_CMPY_CD              = #glblCmpyCd#
        AND DMI.ACTV_FLG                  = 'Y'
        AND DMI.DOC_MGT_CATG_CD           = #docMgtCatgCd#
        <isNull property="trgtTblNm">
            AND DMI.IDX_ATTRB_TRGT_TBL_NM     IS NULL
        </isNull>
        <isNotNull property="trgtTblNm">
            AND DMI.IDX_ATTRB_TRGT_TBL_NM = #trgtTblNm#
        </isNotNull>
        AND DMI.EZCANCELFLAG              = '0'
        AND DMI.GLBL_CMPY_CD              = DMF.GLBL_CMPY_CD
        AND DMI.DOC_MGT_FLD_CD            = DMF.DOC_MGT_FLD_CD
        AND DMF.EZCANCELFLAG              = '0'
        AND DMI.GLBL_CMPY_CD              = DMC.GLBL_CMPY_CD
        AND DMI.DOC_MGT_CATG_CD           = DMC.DOC_MGT_CATG_CD
        AND DMC.EZCANCELFLAG              = '0'
    </statement>

    <statement id="getPkgPoHdr" parameterClass="Map" resultClass="Map">
        <!-- 2017/02/15 S21_NA#17286 Mod Start -->
        SELECT
            PH.CFS_LEASE_PKG_PO_HDR_PK              AS CFS_LEASE_PKG_PO_HDR_PK
            ,PH.CFS_APP_NUM || '/' || PH.CFS_PO_NUM AS CFS_PO_NUM
            ,PH.DS_ACCT_NM                          AS DS_ACCT_NM
            ,PH.LEASE_CMPY_USR_NM                   AS LEASE_CMPY_USR_NM
            ,CASE WHEN VCC.VAR_CHAR_CONST_VAL IS NULL THEN
                PH.LEASE_CMPY_USR_ID
             ELSE
                VCC.VAR_CHAR_CONST_VAL || PH.LEASE_CMPY_USR_ID 
             END AS LEASE_CMPY_USR_ID
            ,PH.CFS_APP_NUM                         AS CFS_APP_NUM
            ,DMO.DOC_MGT_ORG_DESC_TXT               AS LINE_BIZ_TP_CD
            ,DMO.DOC_MGT_ORG_NUM                    AS LINE_BIZ_TP_NUM
            ,PH.INV_CPLT_TOT_DEAL_NET_AMT           AS INV_CPLT_TOT_DEAL_NET_AMT
            ,PH.CFS_REP_TOC_NM                      AS CFS_REP_TOC_NM
            ,PH.INV_CPLT_AMT_RATE                   AS INV_CPLT_AMT_RATE
            ,(SELECT
                COUNT(INV_NUM)
            FROM
                CFS_LEASE_PKG_PO_DTL PPD
            WHERE
                PPD.GLBL_CMPY_CD = PH.GLBL_CMPY_CD
            AND PPD.CFS_LEASE_PKG_PO_HDR_PK = PH.CFS_LEASE_PKG_PO_HDR_PK
            AND PPD.EZCANCELFLAG = '0'
            GROUP BY
                PPD.CFS_LEASE_PKG_PO_HDR_PK)        AS INV_CNT_NUM
            ,PD.ADMIN_PSN_FIRST_NM || ' ' || PD.ADMIN_PSN_LAST_NM
                                                    AS ADMIN_PSN_NM
            ,CASE WHEN VCC.VAR_CHAR_CONST_VAL IS NULL THEN
                PD.ADMIN_PSN_CD
             ELSE
                VCC.VAR_CHAR_CONST_VAL || PD.ADMIN_PSN_CD 
             END AS ADMIN_PSN_CD
            ,C.AQU_NUM                              AS AQU_NUM
        FROM
            CFS_LEASE_PKG_PO_HDR PH
           ,CFS_LEASE_PKG_PO_DTL PD
           ,CPO                  C
           ,DS_ORD_TP_PROC_DFN   DPD
           ,DOC_MGT_ORG          DMO
           ,VAR_CHAR_CONST       VCC
        WHERE
            PD.GLBL_CMPY_CD = #glblCmpyCd#
        AND PD.CFS_LEASE_PKG_PO_DTL_PK IN (
                SELECT
                    CFS_LEASE_PKG_PO_DTL_PK
                FROM
                    (SELECT
                              CFS_LEASE_PKG_PO_DTL_PK
                      FROM
                              CFS_LEASE_PKG_PO_DTL PD2
                      WHERE
                              PD2.GLBL_CMPY_CD = #glblCmpyCd#
                      AND  PD2.CPO_ORD_NUM  = #docMgtPrntDocNum#
                      AND  PD2.EZCANCELFLAG = '0'
                      ORDER BY
                           PD2.CPO_ORD_NUM
                           ,PD2.INV_NUM)
                WHERE
                      ROWNUM = 1
                )
        AND PD.EZCANCELFLAG = '0'
        AND PD.GLBL_CMPY_CD    = PH.GLBL_CMPY_CD
        AND PD.CFS_LEASE_PKG_PO_HDR_PK = PH.CFS_LEASE_PKG_PO_HDR_PK
        AND PH.EZCANCELFLAG    = '0'
        AND PD.GLBL_CMPY_CD    = C.GLBL_CMPY_CD
        AND PD.CPO_ORD_NUM     = C.CPO_ORD_NUM
        AND C.EZCANCELFLAG     = '0'
        AND C.GLBL_CMPY_CD     = DPD.GLBL_CMPY_CD
        AND C.DS_ORD_TP_CD     = DPD.DS_ORD_TP_CD
        AND DPD.EZCANCELFLAG   = '0'
        AND DPD.GLBL_CMPY_CD   = DMO.GLBL_CMPY_CD
        AND DPD.LINE_BIZ_TP_CD = DMO.DOC_MGT_ORG_DESC_TXT
        AND DMO.EZCANCELFLAG   = '0'
        AND VCC.GLBL_CMPY_CD(+)   = PH.GLBL_CMPY_CD
        AND VCC.EZCANCELFLAG(+)   = '0'
        AND VCC.VAR_CHAR_CONST_NM(+) = 'NWZC2240_HEAD_DEGIT_ACTV_DIR'
        <!-- 2017/02/15 S21_NA#17286 Mod End -->
     </statement>

    <statement id="getPkgPoDtl" parameterClass="Map" resultClass="Map">
        SELECT
            PD.CPO_ORD_NUM            AS CPO_ORD_NUM
            ,PD.INV_NUM               AS INV_NUM
            ,PD.GL_DT                 AS GL_DT
            ,PD.INV_TOT_DEAL_NET_AMT  AS INV_TOT_DEAL_NET_AMT
        FROM
            CFS_LEASE_PKG_PO_DTL PD
        WHERE
            PD.GLBL_CMPY_CD            = #glblCmpyCd#
        AND PD.CFS_LEASE_PKG_PO_HDR_PK = #pkgPoHdrPk#
        AND PD.EZCANCELFLAG            = '0'
        ORDER BY
            PD.CPO_ORD_NUM
            ,PD.INV_NUM
    </statement>

    <statement id="getSearchDocMgtFld" parameterClass="Map" resultClass="Map">
        SELECT
            DMD.DOC_MGT_CATG_CD
            ,DMC.DOC_MGT_CATG_DESC_TXT
            ,DMC.DOC_MGT_CATG_NUM
            ,DMD.DOC_MGT_FLD_CD
            ,DMF.DOC_MGT_FLD_DESC_TXT
            ,DMF.DOC_MGT_FLD_NUM 
        FROM
            DOC_MGT_IDX_ATTRB_DFN DMD
            ,DOC_MGT_CATG         DMC
            ,DOC_MGT_FLD          DMF
        WHERE
            DMD.GLBL_CMPY_CD    = #glblCmpyCd#
        AND DMD.DOC_MGT_CATG_CD = #docMgtCatgCd#
        AND DMD.EZCANCELFLAG    = '0'

        AND DMD.GLBL_CMPY_CD    = DMC.GLBL_CMPY_CD
        AND DMD.DOC_MGT_CATG_CD = DMC.DOC_MGT_CATG_CD
        AND DMC.EZCANCELFLAG    = '0'

        AND DMD.GLBL_CMPY_CD    = DMF.GLBL_CMPY_CD
        AND DMD.DOC_MGT_FLD_CD  = DMF.DOC_MGT_FLD_CD 
            <iterate property="docMgtFldDescTxtList" var="docMgtFldDescTxt[]" open="AND DMF.DOC_MGT_FLD_DESC_TXT IN (" close=")" conjunction= ", " >
                #docMgtFldDescTxt[]#
            </iterate>
        AND DMF.EZCANCELFLAG    = '0'
        ORDER BY
            DMF.DOC_MGT_FLD_CD
    </statement>
</sqlMap>