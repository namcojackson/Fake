<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAB054001">
    <statement id="getMerchandiseItem" parameterClass="Map" resultClass="Map">
    SELECT
         DME.MDL_ID
        ,DME.DS_MDL_EOL_STS_CD
        ,DMC.PRNT_MDSE_CD
        ,DMS.EOL_CONTR_FLG
        ,DMS.EOL_SVC_FLG
        ,DMS.EOL_INAC_FLG
        ,MIS.MDSE_ITEM_STS_CD
        ,MIS.SELL_HLD_FLG
        ,MIS.DSCTN_FLG
        ,MIS.RGTN_STS_CD
    FROM
         DS_MDL_CONFIG  DMC
        ,DS_MDL_EOL     DME
        ,DS_MDL_EOL_STS DMS
        ,MDSE_ITEM_STS  MIS

    WHERE
            DMC.CHILD_MDSE_CD                  IS NULL
        AND DMC.EFF_FROM_DT                 &lt;= #slsDt#
        AND NVL(DMC.EFF_THRU_DT, #maxDate#) &gt;= #slsDt#
        AND DMC.GLBL_CMPY_CD                    = #glblCmpyCd#
        AND DMC.EZCANCELFLAG                    = '0'

        AND DMC.MDL_ID                          = DME.MDL_ID
        AND DMC.GLBL_CMPY_CD                    = DME.GLBL_CMPY_CD
        AND DME.DS_MDL_EOL_DT               &lt;= #slsDt#
        AND DME.MDSE_ITEM_STS_UPD_PROC_FLG      = #mdseItemStsUpdProcFlg#
        AND DME.EZCANCELFLAG                    = '0'

        AND DME.DS_MDL_EOL_STS_CD               = DMS.DS_MDL_EOL_STS_CD
        AND DME.GLBL_CMPY_CD                    = DMS.GLBL_CMPY_CD
        AND DMS.EZCANCELFLAG                    = '0'

        AND DMS.MDSE_ITEM_STS_CD                = MIS.MDSE_ITEM_STS_CD
        AND DMS.GLBL_CMPY_CD                    = MIS.GLBL_CMPY_CD
        AND MIS.EZCANCELFLAG                    = '0'

<!-- START 2016/10/25 T.Tomita [QC#3051, ADD] -->
        AND NOT EXISTS (
            SELECT
                1
            FROM
                DS_MDL_CONFIG X
            WHERE
                    X.GLBL_CMPY_CD                       = DMC.GLBL_CMPY_CD
                AND X.MDL_ID                      &lt;&gt; DMC.MDL_ID
                AND X.PRNT_MDSE_CD                       = DMC.PRNT_MDSE_CD
                AND X.EFF_FROM_DT                    &lt;= #slsDt#
                AND NVL(X.EFF_THRU_DT, #maxDate#)    &gt;= #slsDt#
                AND X.EZCANCELFLAG                       = '0'
                AND NOT EXISTS (
                    SELECT
                        1
                    FROM
                        DS_MDL_EOL Y
                    WHERE
                            Y.GLBL_CMPY_CD                      = X.GLBL_CMPY_CD
                        AND Y.MDL_ID                            = X.MDL_ID
                        AND Y.DS_MDL_EOL_DT                 &lt;= #slsDt#
                        AND Y.MDSE_ITEM_STS_UPD_PROC_FLG        = #mdseItemStsUpdProcFlg#
                        AND Y.EZCANCELFLAG                      = '0'
                )
        )
<!-- END 2016/10/25 T.Tomita [QC#3051, ADD] -->

     ORDER BY 
         PRNT_MDSE_CD ASC
        ,DS_MDL_EOL_STS_CD DESC
    </statement>
</sqlMap>