<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWZC155001">

    <!-- #################### Type Alias #################### -->
    <typeAlias alias="NWZC155001PMsg"     type="business.parts.NWZC155001PMsg"/>
    <typeAlias alias="NWZC155001DiChkBean"     type="com.canon.cusa.s21.api.NWZ.NWZC155001.NWZC155001DiChkBean"/>

    <!-- #################### Statement #################### --> 
    <statement id="getCntOpenOrdDtl" parameterClass="Map" resultMap="Integer">
        SELECT
            COUNT(*)
        FROM
            CPO_DTL CD
        WHERE
            CD.GLBL_CMPY_CD =  #glblCmpyCd#
        AND CD.CPO_ORD_NUM  =  #ordNum#
        AND (
                CD.ORD_LINE_STS_CD !=  #cancelSts#
            OR
                CD.ORD_LINE_STS_CD !=  #closeSts#
            )
        AND EZCANCELFLAG    =  '0'
    </statement>

    <statement id="getDiChkCd" parameterClass="Map" resultClass="Map">
        SELECT
            <isNull property="dsOrdTpCd">
            DISTINCT
            </isNull>
            MSTR.DI_CHK_CD
         ,  MSTR.DI_CHK_LVL_CD
         <!-- 2022/09/20 QC#54883 Mod START -->
         ,  CASE WHEN #ordBookFlg# = 'N'
                THEN MSTR.DI_CHK_RSLT_TP_CD
                ELSE MSTR.AFT_BOOK_DI_CHK_RSLT_TP_CD
            END DI_CHK_RSLT_TP_CD
         <!--,  MSTR.DI_CHK_RSLT_TP_CD -->
         <!-- 2022/09/20 QC#54883 Mod END -->
         ,  CATG.DI_MND_CHK_PRFL_CD
        FROM
            DS_ORD_TP_PROC_DFN      PROC
         ,  DS_DI_CHK_ORD_CATG_DFN  CATG
         ,  DS_CPO_DI_CHK_MSTR      MSTR
        WHERE
            PROC.GLBL_CMPY_CD          =     #glblCmpyCd#
        <isNotNull property="dsOrdTpCd">
        AND PROC.DS_ORD_TP_CD          =     #dsOrdTpCd#
        </isNotNull>
        AND PROC.DI_CHK_NODE_USG_FLG   =     #flgY#
        AND PROC.ACTV_FLG              =     #flgY#
        <!-- AND PROC.EFF_FROM_DT           &lt;= #cpoOrdTs# -->
        AND PROC.EFF_FROM_DT           &lt;= #slsDt#<!-- 2018/08/16 S21_NA#26271 Mod cpoOrdTs→slsDt -->
        AND (
        <!--         PROC.EFF_THRU_DT       &gt;= #cpoOrdTs# -->
                PROC.EFF_THRU_DT       &gt;= #slsDt#<!-- 2018/08/16 S21_NA#26271 Mod cpoOrdTs→slsDt -->
            OR
                PROC.EFF_THRU_DT       IS    NULL
            )
        AND PROC.EZCANCELFLAG          =     '0'

        AND PROC.GLBL_CMPY_CD          =     CATG.GLBL_CMPY_CD
        <isNotNull property="dsOrdTpCd">
        AND PROC.DS_ORD_TP_CD          =     CATG.DS_ORD_TP_CD
        </isNotNull>
        <isNull property="dsOrdTpCd">
        AND CATG.DS_ORD_TP_CD          IS    NULL
        </isNull>
        AND CATG.DS_ORD_CATG_CD        =     #dsOrdCatgCd#
        AND CATG.DI_CHK_INCL_FLG       =     #flgY#
        <!-- AND CATG.EFF_FROM_DT           &lt;= #cpoOrdTs# -->
        AND CATG.EFF_FROM_DT           &lt;= #slsDt#<!-- 2018/08/16 S21_NA#26271 Mod cpoOrdTs→slsDt -->
        AND (
        <!--         CATG.EFF_TO_DT         &gt;= #cpoOrdTs# -->
                CATG.EFF_TO_DT         &gt;= #slsDt#<!-- 2018/08/16 S21_NA#26271 Mod cpoOrdTs→slsDt -->
            OR
                CATG.EFF_TO_DT         IS    NULL
            )
        AND CATG.EZCANCELFLAG          =     '0'

        AND CATG.GLBL_CMPY_CD          =     MSTR.GLBL_CMPY_CD
        AND CATG.DI_CHK_CD             =     MSTR.DI_CHK_CD
        <!-- AND MSTR.EFF_FROM_DT           &lt;= #cpoOrdTs# -->
        AND MSTR.EFF_FROM_DT           &lt;= #slsDt#<!-- 2018/08/16 S21_NA#26271 Mod cpoOrdTs→slsDt -->
        AND (
        <!--         MSTR.EFF_TO_DT         &gt;= #cpoOrdTs# -->
                MSTR.EFF_TO_DT         &gt;= #slsDt#<!-- 2018/08/16 S21_NA#26271 Mod cpoOrdTs→slsDt -->
            OR
                MSTR.EFF_TO_DT         IS    NULL
            )
        AND MSTR.EZCANCELFLAG          =     '0'

        AND PROC.GLBL_CMPY_CD          =     MSTR.GLBL_CMPY_CD
        AND PROC.DI_CHK_NODE_PRFL_CD   =     MSTR.DI_CHK_NODE_PRFL_CD
    </statement>

    <statement id="getDiChckCdWithContrFlg" parameterClass="Map" resultClass="Map">
        SELECT
            <isNull property="dsOrdTpCd">
            DISTINCT
            </isNull>
            MSTR.DI_CHK_CD
         ,  MSTR.DI_CHK_LVL_CD
         ,  CASE WHEN #ordBookFlg# = 'N'
                THEN MSTR.DI_CHK_RSLT_TP_CD
                ELSE MSTR.AFT_BOOK_DI_CHK_RSLT_TP_CD
            END DI_CHK_RSLT_TP_CD
         ,  CATG.DI_MND_CHK_PRFL_CD
        FROM
            DS_ORD_TP_PROC_DFN      PROC
         ,  DS_DI_CHK_ORD_CATG_DFN  CATG
         ,  DS_CPO_DI_CHK_MSTR      MSTR
        WHERE
            PROC.GLBL_CMPY_CD          =     #glblCmpyCd#
        <isNotNull property="dsOrdTpCd">
        AND PROC.DS_ORD_TP_CD          =     #dsOrdTpCd#
        </isNotNull>
        AND PROC.DI_CHK_NODE_USG_FLG   =     #flgY#
        AND PROC.ACTV_FLG              =     #flgY#
        AND PROC.EFF_FROM_DT           &lt;= #slsDt#
        AND (
                PROC.EFF_THRU_DT       &gt;= #slsDt#
            OR
                PROC.EFF_THRU_DT       IS    NULL
            )
        AND PROC.EZCANCELFLAG          =     '0'

        AND PROC.GLBL_CMPY_CD          =     CATG.GLBL_CMPY_CD
        <isNotNull property="dsOrdTpCd">
        AND PROC.DS_ORD_TP_CD          =     CATG.DS_ORD_TP_CD
        </isNotNull>
        <isNull property="dsOrdTpCd">
        AND CATG.DS_ORD_TP_CD          IS    NULL
        </isNull>
        AND CATG.DS_ORD_CATG_CD        =     #dsOrdCatgCd#
        AND CATG.DI_CHK_INCL_FLG       =     #flgY#
        AND CATG.EFF_FROM_DT           &lt;= #slsDt#
        AND (
                CATG.EFF_TO_DT         &gt;= #slsDt#
            OR
                CATG.EFF_TO_DT         IS    NULL
            )
        AND CATG.EZCANCELFLAG          =     '0'

        AND CATG.GLBL_CMPY_CD          =     MSTR.GLBL_CMPY_CD
        AND CATG.DI_CHK_CD             =     MSTR.DI_CHK_CD
        AND MSTR.EFF_FROM_DT           &lt;= #slsDt#
        AND (
                MSTR.EFF_TO_DT         &gt;= #slsDt#
            OR
                MSTR.EFF_TO_DT         IS    NULL
            )
        AND MSTR.EZCANCELFLAG          =     '0'

        AND PROC.GLBL_CMPY_CD          =     MSTR.GLBL_CMPY_CD
        AND PROC.DI_CHK_NODE_PRFL_CD   =     MSTR.DI_CHK_NODE_PRFL_CD
        
        AND MSTR.CONTR_EXEC_FLG = #flgY#
    </statement>

    <statement id="getLastVrsnNum" parameterClass="Map" resultMap="BigDecimal">
        SELECT
            MAX (D.DI_CHK_VRSN_NUM)
        FROM
            DS_CPO_DI_CHK_RSLT_HDR  D
        WHERE
            D.GLBL_CMPY_CD  = #glblCmpyCd#
        AND D.CPO_ORD_NUM   = #ordNum#
        AND D.EZCANCELFLAG  = '0'
    </statement>

    <!-- #################### E099-1000 #################### -->
    <statement id="getPoNumByLocCd" parameterClass="Map" resultClass="Map">
        SELECT
            CPO.CUST_ISS_PO_NUM
        FROM
            CPO                CPO
         ,  BILL_TO_CUST       BTC
         ,  DS_CUST_TRX_RULE   DCTR
         ,  ORD_CATG_BIZ_CTX   OCBC
        WHERE
            CPO.GLBL_CMPY_CD        = #glblCmpyCd#
        AND CPO.CPO_ORD_NUM         = #ordNum#
        AND CPO.EZCANCELFLAG        = '0'

        AND CPO.GLBL_CMPY_CD        = BTC.GLBL_CMPY_CD
        AND CPO.BILL_TO_CUST_CD     = BTC.BILL_TO_CUST_CD
        AND BTC.EZCANCELFLAG        = '0'

        AND BTC.GLBL_CMPY_CD        = DCTR.GLBL_CMPY_CD
        AND BTC.LOC_NUM             = DCTR.LOC_NUM
        AND DCTR.DS_PO_REQ_FLG      = #flgY#
        AND DCTR.EZCANCELFLAG       = '0'

        AND DCTR.GLBL_CMPY_CD       = OCBC.GLBL_CMPY_CD
        AND DCTR.DS_TRX_RULE_TP_CD  = OCBC.FIRST_BIZ_CTX_ATTRB_TXT
        AND OCBC.ORD_CATG_CTX_TP_CD = #equipOrd#
        AND OCBC.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getPoNumByAcctCd" parameterClass="Map" resultClass="Map">
        SELECT
            CPO.CUST_ISS_PO_NUM
        FROM
            CPO                CPO
         ,  DS_CUST_TRX_RULE   DCTR
         ,  ORD_CATG_BIZ_CTX   OCBC
        WHERE
            CPO.GLBL_CMPY_CD         =   #glblCmpyCd#
        AND CPO.CPO_ORD_NUM          =   #ordNum#
        AND CPO.EZCANCELFLAG         =   '0'

        AND CPO.GLBL_CMPY_CD         =   DCTR.GLBL_CMPY_CD
        AND CPO.BILL_TO_CUST_ACCT_CD =   DCTR.DS_ACCT_NUM
        AND DCTR.LOC_NUM             IS  NULL
        AND DCTR.DS_PO_REQ_FLG       =   #flgY#
        AND DCTR.EZCANCELFLAG        =   '0'

        AND DCTR.GLBL_CMPY_CD        =   OCBC.GLBL_CMPY_CD
        AND DCTR.DS_TRX_RULE_TP_CD   =   OCBC.FIRST_BIZ_CTX_ATTRB_TXT
        AND OCBC.ORD_CATG_CTX_TP_CD  =   #equipOrd#
        AND OCBC.EZCANCELFLAG        =   '0'
    </statement>

    <!-- #################### E099-1005 #################### -->
    <statement id="getMaintPoNumByLocCd" parameterClass="Map" resultClass="Map">
        SELECT
            CNTD.SHELL_LINE_NUM
         ,  DCD.DS_CPO_LINE_NUM
         ,  DCD.DS_CPO_LINE_SUB_NUM
         ,  CNTP.CUST_PO_NUM
         ,  DCD.CPO_DTL_LINE_NUM
         ,  CONF.DS_CPO_CONFIG_PK
         ,  CONF.DS_ORD_POSN_NUM
         ,  CONF.CONFIG_CATG_CD
        FROM
            CPO                  DC
         ,  CPO_DTL              DCD
         ,  DS_CONTR             CNT
         ,  DS_CONTR_DTL         CNTD
         ,  DS_CONTR_CR_CARD_PO  CNTP
         ,  BILL_TO_CUST         BTC
         ,  DS_CUST_TRX_RULE     DCTR
         ,  DS_CONTR_DTL_TP      TP
         ,  DS_CPO_CONFIG        CONF
        WHERE
            DC.GLBL_CMPY_CD            = #glblCmpyCd#
        AND DC.CPO_ORD_NUM             = #ordNum#
        AND DC.EZCANCELFLAG            = '0'

        AND DC.GLBL_CMPY_CD            = DCD.GLBL_CMPY_CD
        AND DC.CPO_ORD_NUM             = DCD.CPO_ORD_NUM
        AND DCD.ORD_LINE_STS_CD NOT IN   <!-- QC#22874 -->
        <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
           #ordLineStsCd[]#
        </iterate>
        AND DCD.EZCANCELFLAG           = '0'

        AND CONF.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD
        AND CONF.DS_CPO_CONFIG_PK      = DCD.DS_CPO_CONFIG_PK
        AND CONF.EZCANCELFLAG          = '0'

        AND DC.GLBL_CMPY_CD            = CNTD.GLBL_CMPY_CD(+)
        AND DC.CPO_ORD_NUM             = CNTD.CPO_ORD_NUM(+)
        AND CNTD.EZCANCELFLAG(+)       = '0'
        AND CNTD.SHELL_LINE_NUM        IS NOT NULL

        AND TP.GLBL_CMPY_CD            = CNTD.GLBL_CMPY_CD
        AND TP.DS_CONTR_DTL_TP_CD      = CNTD.DS_CONTR_DTL_TP_CD
        AND TP.MAIN_UNIT_LINE_FLG      = 'Y'
        AND TP.EZCANCELFLAG            = '0'

        AND CNTD.GLBL_CMPY_CD          = CNT.GLBL_CMPY_CD
        AND CNTD.DS_CONTR_PK           = CNT.DS_CONTR_PK
        AND CNT.EZCANCELFLAG           = '0'
        AND CNT.DS_CONTR_CATG_CD       &lt;&gt; #warranty#

        AND CNTD.GLBL_CMPY_CD          = CNTP.GLBL_CMPY_CD(+)
        AND CNTD.DS_CONTR_DTL_PK       = CNTP.DS_CONTR_DTL_PK(+)
        AND CNTP.EZCANCELFLAG(+)       = '0'
        <!-- START 2019/01/17 K.Morita [QC#26928, ADD] -->
        AND CNTP.CR_CARD_FLG(+)        = 'N'
        <!-- START 2019/07/12 M.Ohno [QC#51495, DEL] -->
        <!-- 
        AND CNTP.PO_FROM_DT(+)         &lt;= NVL(SUBSTR(DC.ORD_BOOK_TS, 1, 8), SUBSTR(DC.CPO_ORD_TS, 1, 8))
        AND CNTP.PO_DT(+)              &gt;= NVL(SUBSTR(DC.ORD_BOOK_TS, 1, 8), SUBSTR(DC.CPO_ORD_TS, 1, 8))
        -->
        <!-- END 2019/07/12 M.Ohno [QC#51495, DEL] -->
        <!-- END 2019/01/17 K.Morita [QC#26928, ADD] -->
        AND CNT.GLBL_CMPY_CD           = BTC.GLBL_CMPY_CD
        AND CNT.ALT_PAYER_CUST_CD      = BTC.BILL_TO_CUST_CD
        AND CNT.EZCANCELFLAG           = '0'

        AND BTC.GLBL_CMPY_CD           = DCTR.GLBL_CMPY_CD
        AND BTC.LOC_NUM                = DCTR.LOC_NUM
        AND DCTR.DS_PO_REQ_FLG         = #flgY#
        AND DCTR.DS_TRX_RULE_TP_CD     = #contractCd#
        AND DCTR.EZCANCELFLAG          = '0'

        AND CNTD.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD
        AND CNTD.CPO_DTL_LINE_NUM      = DCD.CPO_DTL_LINE_NUM
        AND CNTD.CPO_DTL_LINE_SUB_NUM  = DCD.CPO_DTL_LINE_SUB_NUM
    </statement>

    <statement id="getMaintPoNumByAcctCd" parameterClass="Map" resultClass="Map">
        SELECT
            CNTD.SHELL_LINE_NUM
         ,  DCD.DS_CPO_LINE_NUM
         ,  DCD.DS_CPO_LINE_SUB_NUM
         ,  CNTP.CUST_PO_NUM
         ,  DCD.CPO_DTL_LINE_NUM
         ,  CONF.DS_CPO_CONFIG_PK
         ,  CONF.DS_ORD_POSN_NUM
         ,  CONF.CONFIG_CATG_CD
        FROM
            CPO                  DC
         ,  CPO_DTL              DCD
         ,  DS_CONTR             CNT
         ,  DS_CONTR_DTL         CNTD
         ,  DS_CONTR_CR_CARD_PO  CNTP
         ,  DS_CUST_TRX_RULE     DCTR
         ,  DS_CONTR_DTL_TP      TP
         ,  DS_CPO_CONFIG        CONF
        WHERE
            DC.GLBL_CMPY_CD            = #glblCmpyCd#
        AND DC.CPO_ORD_NUM             = #ordNum#
        AND DC.EZCANCELFLAG            = '0'

        AND DC.GLBL_CMPY_CD            = DCD.GLBL_CMPY_CD
        AND DC.CPO_ORD_NUM             = DCD.CPO_ORD_NUM
        AND DCD.ORD_LINE_STS_CD NOT IN   <!-- QC#22874 -->
        <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
           #ordLineStsCd[]#
        </iterate>
        AND DCD.EZCANCELFLAG           = '0'

        AND CONF.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD
        AND CONF.DS_CPO_CONFIG_PK      = DCD.DS_CPO_CONFIG_PK
        AND CONF.EZCANCELFLAG          = '0'

        AND DC.GLBL_CMPY_CD            = CNTD.GLBL_CMPY_CD(+)
        AND DC.CPO_ORD_NUM             = CNTD.CPO_ORD_NUM(+)
        AND CNTD.EZCANCELFLAG(+)       = '0'
        AND CNTD.SHELL_LINE_NUM        IS NOT NULL

        AND TP.GLBL_CMPY_CD            = CNTD.GLBL_CMPY_CD
        AND TP.DS_CONTR_DTL_TP_CD      = CNTD.DS_CONTR_DTL_TP_CD
        AND TP.MAIN_UNIT_LINE_FLG      = 'Y'
        AND TP.EZCANCELFLAG            = '0'

        AND CNTD.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD
        AND CNTD.CPO_DTL_LINE_NUM      = DCD.CPO_DTL_LINE_NUM
        AND CNTD.CPO_DTL_LINE_SUB_NUM  = DCD.CPO_DTL_LINE_SUB_NUM

        AND CNTD.GLBL_CMPY_CD          = CNT.GLBL_CMPY_CD
        AND CNTD.DS_CONTR_PK           = CNT.DS_CONTR_PK
        AND CNT.EZCANCELFLAG           = '0'
        AND CNT.DS_CONTR_CATG_CD       &lt;&gt; #warranty#

        AND CNTD.GLBL_CMPY_CD          = CNTP.GLBL_CMPY_CD(+)
        AND CNTD.DS_CONTR_DTL_PK       = CNTP.DS_CONTR_DTL_PK(+)
        AND CNTP.EZCANCELFLAG(+)       = '0'
        <!-- START 2019/01/17 K.Morita [QC#26928, ADD] -->
        AND CNTP.CR_CARD_FLG(+)        = 'N'
        <!-- START 2019/07/12 M.Ohno [QC#51495, DEL] -->
        <!-- 
        AND CNTP.PO_FROM_DT(+)         &lt;= NVL(SUBSTR(DC.ORD_BOOK_TS, 1, 8), SUBSTR(DC.CPO_ORD_TS, 1, 8))
        AND CNTP.PO_DT(+)              &gt;= NVL(SUBSTR(DC.ORD_BOOK_TS, 1, 8), SUBSTR(DC.CPO_ORD_TS, 1, 8))
        -->
        <!-- START 2019/07/12 M.Ohno [QC#51495, DEL] -->
        <!-- END 2019/01/17 K.Morita [QC#26928, ADD] -->

        AND CNT.GLBL_CMPY_CD           = DCTR.GLBL_CMPY_CD
        AND CNT.DS_ACCT_NUM            = DCTR.DS_ACCT_NUM
        AND DCTR.DS_PO_REQ_FLG         = #flgY#
        AND DCTR.DS_TRX_RULE_TP_CD     = #contractCd#
        AND DCTR.EZCANCELFLAG          = '0'
    </statement>

    <!-- #################### E099-1010 #################### -->
    <statement id="getLeasePoNumByLocCd" parameterClass="Map" resultClass="Map">
        SELECT
            C.LEASE_CMPY_PO_NUM
        FROM
            CPO                C
         ,  BILL_TO_CUST       BTC
         ,  DS_CUST_TRX_RULE   DCT
         ,  ORD_CATG_BIZ_CTX   OCB
        WHERE
               C.GLBL_CMPY_CD           =  #glblCmpyCd#
        AND    C.CPO_ORD_NUM            =  #ordNum#
        AND    C.EZCANCELFLAG           =  '0'

        AND    C.GLBL_CMPY_CD           =  BTC.GLBL_CMPY_CD
        AND    C.BILL_TO_CUST_CD        =  BTC.BILL_TO_CUST_CD
        AND    BTC.EZCANCELFLAG         =  '0'

        AND    BTC.GLBL_CMPY_CD         =  DCT.GLBL_CMPY_CD
        AND    BTC.LOC_NUM              =  DCT.LOC_NUM
        AND    DCT.DS_PO_REQ_FLG        =  #flgY#
        AND    DCT.EZCANCELFLAG         =  '0'

        AND    DCT.GLBL_CMPY_CD         =  OCB.GLBL_CMPY_CD
        AND    DCT.DS_TRX_RULE_TP_CD    =  OCB.FIRST_BIZ_CTX_ATTRB_TXT
        AND    OCB.ORD_CATG_CTX_TP_CD   =  #equipOrd#
        AND    OCB.EZCANCELFLAG         =  '0'
    </statement>

    <statement id="getLeasePoNumByAcctCd" parameterClass="Map" resultClass="Map">
        SELECT
            DC.LEASE_CMPY_PO_NUM
        FROM
            CPO                DC
         ,  DS_CUST_TRX_RULE   DCT
         ,  ORD_CATG_BIZ_CTX   OCB
        WHERE
               DC.GLBL_CMPY_CD          =  #glblCmpyCd#
        AND    DC.CPO_ORD_NUM           =  #ordNum#
        AND    DC.EZCANCELFLAG          =  '0'

        AND    DC.GLBL_CMPY_CD          =  DCT.GLBL_CMPY_CD
        AND    DC.BILL_TO_CUST_ACCT_CD  =  DCT.DS_ACCT_NUM
        AND    DCT.LOC_NUM              IS NULL
        AND    DCT.DS_PO_REQ_FLG        =  #flgY#
        AND    DCT.EZCANCELFLAG         =  '0'

        AND    DCT.GLBL_CMPY_CD         =  OCB.GLBL_CMPY_CD
        AND    DCT.DS_TRX_RULE_TP_CD    =  OCB.FIRST_BIZ_CTX_ATTRB_TXT
        AND    OCB.ORD_CATG_CTX_TP_CD   =  #equipOrd#
        AND    OCB.EZCANCELFLAG         =  '0'
    </statement>

    <!-- #################### E099-1015 #################### -->
    <statement id="getDuplicateOrd" parameterClass="Map" resultClass="Map">
        SELECT
            C.CPO_ORD_NUM          AS CPO_ORD_NUM
         ,  C.CUST_ISS_PO_NUM      AS PO_NUM
         ,  C.BILL_TO_CUST_CD      AS BILL_TO_CUST_CD
        FROM
            CPO     C
        WHERE
            C.GLBL_CMPY_CD    =  #glblCmpyCd#
        AND C.CPO_ORD_NUM     != #ordNum#
        AND C.ORD_HDR_STS_CD  != #ordHdrStsCd#
        AND C.EZCANCELFLAG    =  '0'
<!-- QC#14779 Mod Start -->
        AND
            EXISTS (
                SELECT
                    *
                FROM
                     CPO        C1
                    ,CPO_DTL    CD1
                WHERE
                    C1.GLBL_CMPY_CD          =  #glblCmpyCd#
                AND C1.CPO_ORD_NUM           =  #ordNum#
                 <!-- 2019/04/04 QC#30756 Mod Start -->
                <!-- AND C1.CUST_ISS_PO_NUM       =  C.CUST_ISS_PO_NUM -->
                AND UPPER(C1.CUST_ISS_PO_NUM) =  UPPER(C.CUST_ISS_PO_NUM)
                 <!-- 2019/04/04 QC#30756 Mod End -->
                AND C1.EZCANCELFLAG          =  '0'
                AND
                    (
                        C1.BILL_TO_CUST_CD = C.BILL_TO_CUST_CD
                    OR
                        C1.BILL_TO_CUST_ACCT_CD =  C.BILL_TO_CUST_ACCT_CD
                    )

                AND C1.GLBL_CMPY_CD         =  CD1.GLBL_CMPY_CD(+)
                AND C1.CPO_ORD_NUM          =  CD1.CPO_ORD_NUM(+)
                AND CD1.CR_REBIL_CD(+)      IS NULL
                AND CD1.EZCANCELFLAG(+)     =  '0'
            )
<!-- QC#14779 Mod End -->
    </statement>

    <statement id="getDuplicateMaintPo" parameterClass="Map" resultClass="Map">
        SELECT
            CNTD.CPO_ORD_NUM        AS CPO_ORD_NUM
         ,  CNTD.CPO_DTL_LINE_NUM   AS CPO_DTL_LINE_NUM
         ,  CNTP.CUST_PO_NUM        AS PO_NUM
         ,  CP.BILL_TO_CUST_CD      AS BILL_TO_CUST_CD
        FROM
            CPO                   CP
         ,  DS_CONTR_DTL          CNTD
         ,  DS_CONTR_CR_CARD_PO   CNTP
        WHERE
            CNTD.GLBL_CMPY_CD     =  #glblCmpyCd#
        AND CNTD.CPO_ORD_NUM      != #ordNum#
        <!-- 2017/06/22 S21_NA#19464 Add Start -->
        AND CNTD.CPO_DTL_LINE_NUM IS NOT NULL
        <!-- 2017/06/22 S21_NA#19464 Add End -->
        AND CNTD.EZCANCELFLAG     =  '0'
        <!-- START 2019/01/17 K.Morita [QC#26928, ADD] -->
        AND CNTP.CR_CARD_FLG      =  'N'
        AND CP.CUST_ISS_PO_DT     &gt;= CNTP.PO_FROM_DT
        AND CP.CUST_ISS_PO_DT     &lt;= CNTP.PO_DT
        <!-- END 2019/01/17 K.Morita [QC#26928, ADD] -->

        AND CNTD.GLBL_CMPY_CD     =  CNTP.GLBL_CMPY_CD
        AND CNTD.DS_CONTR_DTL_PK  =  CNTP.DS_CONTR_DTL_PK
        AND CNTP.EZCANCELFLAG     =  '0'

        AND CNTD.GLBL_CMPY_CD     =  CP.GLBL_CMPY_CD
        AND CNTD.CPO_ORD_NUM      =  CP.CPO_ORD_NUM
        AND CP.EZCANCELFLAG       =  '0'
        AND EXISTS ( 
            SELECT
                      1
                FROM
                    CPO_DTL     CD
                WHERE
                    CD.GLBL_CMPY_CD             = CNTD.GLBL_CMPY_CD
                    AND CD.CPO_ORD_NUM          = CNTD.CPO_ORD_NUM
                    AND CD.CPO_DTL_LINE_NUM     = CNTD.CPO_DTL_LINE_NUM
                    AND CD.CPO_DTL_LINE_SUB_NUM = CNTD.CPO_DTL_LINE_SUB_NUM
                    AND CD.ORD_LINE_STS_CD     != #ordLineStsCancelled#
                    AND CD.EZCANCELFLAG         = '0'
        )

        AND (EXISTS
                (SELECT
                    *
                 FROM
                     DS_CONTR_DTL          CNTD2
                  ,  DS_CONTR_CR_CARD_PO   CNTP2
                  ,  DS_CONTR              CNT2
                 WHERE
                     CNTD2.GLBL_CMPY_CD    =  #glblCmpyCd#
                 AND CNTD2.CPO_ORD_NUM     =  #ordNum#
                 AND CNTD2.EZCANCELFLAG    =  '0'

                 AND CNTD2.GLBL_CMPY_CD    =  CNTP2.GLBL_CMPY_CD
                 AND CNTD2.DS_CONTR_DTL_PK =  CNTP2.DS_CONTR_DTL_PK
                 AND CNTP2.EZCANCELFLAG    =  '0'
                 <!-- 2019/04/04 QC#30756 Mod Start -->
                 <!-- AND CNTP2.CUST_PO_NUM     =  CNTP.CUST_PO_NUM -->
                 AND UPPER(CNTP2.CUST_PO_NUM) =  UPPER(CNTP.CUST_PO_NUM)
                 <!-- 2019/04/04 QC#30756 Mod End -->
                 <!-- START 2019/01/17 K.Morita [QC#26928, ADD] -->
                 AND CNTP2.CR_CARD_FLG     =  'N'
                 AND CP.CUST_ISS_PO_DT     &gt;= CNTP2.PO_FROM_DT
                 AND CP.CUST_ISS_PO_DT     &lt;= CNTP2.PO_DT
                 <!-- END 2019/01/17 K.Morita [QC#26928, ADD] -->

                 AND CNTD2.GLBL_CMPY_CD    =  CNT2.GLBL_CMPY_CD
                 AND CNTD2.DS_CONTR_PK     =  CNT2.DS_CONTR_PK
                 AND CNT2.CR_REBIL_CD      IS NULL
                 AND CNT2.EZCANCELFLAG     =  '0'
                 AND EXISTS ( 
                     SELECT
                               1
                         FROM
                             CPO_DTL    CD
                         WHERE
                             CD.GLBL_CMPY_CD                = CNTD2.GLBL_CMPY_CD
                             AND CD.CPO_ORD_NUM             = CNTD2.CPO_ORD_NUM
                             AND CD.CPO_DTL_LINE_NUM        = CNTD2.CPO_DTL_LINE_NUM
                             AND CD.CPO_DTL_LINE_SUB_NUM    = CNTD2.CPO_DTL_LINE_SUB_NUM
                             AND CD.ORD_LINE_STS_CD        != #ordLineStsCancelled#
                             AND CD.EZCANCELFLAG            = '0'
                    )
                )
            )
    </statement>

    <statement id="getDuplicateLeasePo" parameterClass="Map" resultClass="Map">
        SELECT
            C.CPO_ORD_NUM          AS CPO_ORD_NUM
         ,  C.LEASE_CMPY_PO_NUM    AS PO_NUM
         ,  C.BILL_TO_CUST_CD      AS BILL_TO_CUST_CD
        FROM
            CPO C
        WHERE
            C.GLBL_CMPY_CD   =  #glblCmpyCd#
        AND C.CPO_ORD_NUM    != #ordNum#
        AND C.EZCANCELFLAG   =  '0'
        AND C.ORD_HDR_STS_CD != #ordHdrStsCd#

        AND (EXISTS
               (SELECT
                    *
                FROM
                    CPO        C1
                 ,  CPO_DTL    CD1
                WHERE
                    C1.GLBL_CMPY_CD          =  #glblCmpyCd#
                AND C1.CPO_ORD_NUM           =  #ordNum#
                 <!-- 2019/04/04 QC#30756 Mod Start -->
                <!-- AND C1.LEASE_CMPY_PO_NUM     =  C.LEASE_CMPY_PO_NUM -->
                AND UPPER(C1.LEASE_CMPY_PO_NUM) =  UPPER(C.LEASE_CMPY_PO_NUM)
                 <!-- 2019/04/04 QC#30756 Mod End -->
                AND C1.BILL_TO_CUST_ACCT_CD  =  C.BILL_TO_CUST_ACCT_CD
                AND C1.EZCANCELFLAG          =  '0'

                AND C1.GLBL_CMPY_CD          =  CD1.GLBL_CMPY_CD
                AND C1.CPO_ORD_NUM           =  CD1.CPO_ORD_NUM
                AND CD1.CR_REBIL_CD          IS NULL
                AND CD1.EZCANCELFLAG         =  '0'
               )
           )
    </statement>

    <!-- #################### E099-1020 #################### -->
    <statement id="getCustCtrlField" parameterClass="Map" resultClass="Map">
       SELECT 
           CD.DS_CPO_LINE_NUM
        ,  CD.DS_CPO_LINE_SUB_NUM
        ,  CD.SHIP_TO_CUST_CD
        ,  DARA.BLLG_ATTRB_NM
        ,  DARA.BLLG_ATTRB_REQ_FLG
       FROM
           CPO_DTL            CD
        ,  MDSE               DMI
        ,  DS_ACCT_REF_ATTRB  DARA
       WHERE 
           CD.GLBL_CMPY_CD               =  #glblCmpyCd#
       AND CD.CPO_ORD_NUM                =  #ordNum#
       AND CD.EZCANCELFLAG               =  '0'

       AND CD.GLBL_CMPY_CD               =  DMI.GLBL_CMPY_CD
       AND CD.MDSE_CD                    =  DMI.MDSE_CD
       AND DMI.COA_MDSE_TP_CD            =  #coaMdseTpCd#
       AND DMI.EZCANCELFLAG              =  '0'

       AND CD.GLBL_CMPY_CD               =  DARA.GLBL_CMPY_CD
       AND CD.BLLG_ATTRB_CUST_ACCT_CD    =  DARA.DS_ACCT_NUM
       AND DARA.EZCANCELFLAG             =  '0'

       UNION ALL

       SELECT 
           CD.DS_CPO_LINE_NUM
        ,  CD.DS_CPO_LINE_SUB_NUM
        ,  CD.SHIP_TO_CUST_CD
        ,  DARA.BLLG_ATTRB_NM
        ,  DARA.BLLG_ATTRB_REQ_FLG
       FROM
           CPO_DTL            CD
        ,  ORD_TAKE_MDSE      OTM
        ,  MDSE               DMI
        ,  DS_ACCT_REF_ATTRB  DARA
       WHERE 
           CD.GLBL_CMPY_CD               =  #glblCmpyCd#
       AND CD.CPO_ORD_NUM                =  #ordNum#
       AND CD.EZCANCELFLAG               =  '0'

       AND CD.GLBL_CMPY_CD               =  OTM.GLBL_CMPY_CD
       AND CD.MDSE_CD                    =  OTM.ORD_TAKE_MDSE_CD
       AND OTM.EZCANCELFLAG              =  '0'

       AND OTM.GLBL_CMPY_CD              =  DMI.GLBL_CMPY_CD
       AND OTM.MDSE_CD                   =  DMI.MDSE_CD
       AND DMI.COA_MDSE_TP_CD            =  #coaMdseTpCd#
       AND DMI.EZCANCELFLAG              =  '0'

       AND CD.GLBL_CMPY_CD               =  DARA.GLBL_CMPY_CD
       AND CD.BLLG_ATTRB_CUST_ACCT_CD    =  DARA.DS_ACCT_NUM
       AND DARA.EZCANCELFLAG             =  '0'
    </statement>

    <!-- #################### E099-1025 #################### -->
    <statement id="getOrdLineRequireShell" parameterClass="Map" resultClass="Map">
      SELECT
            CD.CPO_DTL_LINE_NUM
         ,  CD.CPO_DTL_LINE_SUB_NUM
         ,  CD.DS_ORD_POSN_NUM
         ,  CD.DS_CPO_LINE_NUM
         ,  CD.DS_CPO_LINE_SUB_NUM
         ,  DCC.DCLN_SVC_CD
        FROM
            CPO                DC
         ,  CPO_DTL            CD
         ,  DS_CPO_CONFIG      DCC
         ,  ORD_CATG_BIZ_CTX   OCB
        WHERE
            DC.GLBL_CMPY_CD           =  #glblCmpyCd#
        AND DC.CPO_ORD_NUM            =  #ordNum#
        AND DC.EZCANCELFLAG           =  '0'

        AND DC.GLBL_CMPY_CD           =  CD.GLBL_CMPY_CD
        AND DC.CPO_ORD_NUM            =  CD.CPO_ORD_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM  !=  #cpoDtlLineSubNumSet#
        AND CD.BASE_CMPT_FLG          =  'Y'
        AND CD.ORD_LINE_STS_CD NOT IN   <!-- QC#22874 -->
        <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
           #ordLineStsCd[]#
        </iterate>
        AND CD.EZCANCELFLAG           =  '0'

        AND CD.GLBL_CMPY_CD           =  DCC.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM            =  DCC.CPO_ORD_NUM
        AND CD.DS_CPO_CONFIG_PK       =  DCC.DS_CPO_CONFIG_PK
        AND DCC.EZCANCELFLAG          =  '0'

        AND DC.GLBL_CMPY_CD           =  OCB.GLBL_CMPY_CD
        AND DC.DS_ORD_CATG_CD         =  OCB.DS_ORD_CATG_CD
        AND (DC.DS_ORD_TP_CD          =  OCB.DS_ORD_TP_CD OR OCB.DS_ORD_TP_CD IS NULL)
        AND OCB.ORD_CATG_CTX_TP_CD    =  #ordCatgCtxTp#
        AND OCB.EZCANCELFLAG          =  '0'

        AND NOT EXISTS (
                SELECT
                    1
                FROM
                     DS_CONTR      CNT
                    ,DS_CONTR_DTL  CNTD
                WHERE
                        CNT.GLBL_CMPY_CD            = CNTD.GLBL_CMPY_CD
                    AND CNT.EZCANCELFLAG            = CNTD.EZCANCELFLAG
                    AND CNT.DS_CONTR_PK             = CNTD.DS_CONTR_PK

                    AND CNTD.CPO_ORD_NUM            = CD.CPO_ORD_NUM
                    AND CNTD.EZCANCELFLAG           = CD.EZCANCELFLAG
                    AND CNTD.CPO_DTL_LINE_NUM       = CD.CPO_DTL_LINE_NUM
                    AND CNTD.CPO_DTL_LINE_SUB_NUM   = CD.CPO_DTL_LINE_SUB_NUM
        )
        <!-- 2019/11/22 QC#54213 Add Start -->
        AND NOT EXISTS (
                SELECT 
                    1
                FROM 
                    RTL_WH RW 
                WHERE
                        RW.GLBL_CMPY_CD   = #glblCmpyCd#
                    AND RW.RTL_WH_CD      = #rtlWhCd#
                    AND RW.RTL_WH_CD      = CD.RTL_WH_CD
                    AND RW.EZCANCELFLAG   = '0'
        )
        <!-- 2019/11/22 QC#54213 Add End -->
    </statement>
<!-- QC#16603 Add Start -->
    <statement id="getOrdLineRequireFieldShell" parameterClass="Map" resultClass="Map">
      SELECT
            CD.CPO_DTL_LINE_NUM
         ,  CD.CPO_DTL_LINE_SUB_NUM
         ,  CNT.PRC_SVC_CONTR_TP_CD
         ,  CNT.PRC_SVC_PLN_TP_CD
         ,  CNT.DS_CONTR_CATG_CD
         <!-- ,  CNTD.SHELL_LINE_NUM 2018/05/13 S21_NA#22482 Mod -->
         ,  CNT.SHELL_LINE_NUM
         <!-- S21_NA#19920 2017/07/25 Mod Start -->
         <!-- ,  CNTD.SVC_PGM_MDSE_CD -->
         <!-- ,  CNTD.BASE_BLLG_CYCLE_CD -->
         ,  CNT.SVC_PGM_MDSE_CD
         ,  CNT.BASE_BLLG_CYCLE_CD
         ,  BC.BLLG_CYCLE_MTH_AOT <!-- 2018/05/13 S21_NA#22482 Add -->
         <!-- S21_NA#19920 2017/07/25 Mod End -->
         ,  CNTD.MTR_BLLG_CYCLE_CD
         ,  CD.DS_ORD_POSN_NUM
         ,  CD.DS_CPO_LINE_NUM
         ,  CD.DS_CPO_LINE_SUB_NUM
         ,  DCC.DCLN_SVC_CD
         <!-- 2018/05/13 S21_NA#22482 Add Start -->
         ,  CNT.MAN_CONTR_OVRD_FLG
         ,  CNT.DS_CONTR_PK
         ,  CNTD.DS_CONTR_DTL_PK
         ,  CNT.FROM_PER_MTH_NUM
         ,  CNT.TO_PER_MTH_NUM
         ,  CNT.ALT_PAYER_CUST_CD
         ,  CNT.DS_ACCT_NUM
         ,  CNT.MTR_BLLG_CYCLE_CD AS HD_MTR_BLLG_CYCLE_CD
         ,  BCFU.BLLG_CYCLE_MTH_AOT AS USG_BLLG_CYCLE_MTH_AOT
         ,  CNTD.MTR_READ_METH_CD
         <!-- 2021/06/03 QC#57285 Del
         ,  DCP.CUST_PO_NUM
         ,  DCP.PO_DT
         ,  DCP.CUST_ISS_PO_DT
         -->
         <!-- 2018/05/13 S21_NA#22482 Add End -->
         
        FROM
            CPO                DC
         ,  CPO_DTL            CD
         ,  DS_CPO_CONFIG      DCC
         ,  ORD_CATG_BIZ_CTX   OCB
         ,  DS_CONTR      CNT
         ,  DS_CONTR_DTL  CNTD
        <!-- 2017/12/19 S21_NA#22990 Add Start -->
         ,  DS_CONTR_CATG CNTC
        <!-- 2017/12/19 S21_NA#22990 Add End -->
        <!-- 2018/05/13 S21_NA#22482 Add Start -->
         ,  BLLG_CYCLE    BC
         ,  BLLG_CYCLE    BCFU
         <!-- 2021/06/03 QC#57285 Del
         ,  DS_CONTR_CR_CARD_PO DCP
         -->
         <!-- 2018/05/13 S21_NA#22482 Add End -->
        WHERE
            DC.GLBL_CMPY_CD           =  #glblCmpyCd#
        AND DC.CPO_ORD_NUM            =  #ordNum#
        AND DC.EZCANCELFLAG           =  '0'

        <!-- 2018/05/13 S21_NA#22482 Mod Start -->
        <!-- AND DC.GLBL_CMPY_CD           =  CD.GLBL_CMPY_CD
        AND DC.CPO_ORD_NUM            =  CD.CPO_ORD_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM  !=  #cpoDtlLineSubNumSet#
        AND CD.BASE_CMPT_FLG          =  'Y'
        AND CD.EZCANCELFLAG           =  '0'

        AND CD.GLBL_CMPY_CD           =  DCC.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM            =  DCC.CPO_ORD_NUM
        AND CD.DS_CPO_CONFIG_PK       =  DCC.DS_CPO_CONFIG_PK
        AND DCC.EZCANCELFLAG          =  '0'

        AND DC.GLBL_CMPY_CD           =  OCB.GLBL_CMPY_CD
        AND DC.DS_ORD_CATG_CD         =  OCB.DS_ORD_CATG_CD
        AND (DC.DS_ORD_TP_CD          =  OCB.DS_ORD_TP_CD OR OCB.DS_ORD_TP_CD IS NULL)
        AND OCB.ORD_CATG_CTX_TP_CD    =  #ordCatgCtxTp#
        AND OCB.EZCANCELFLAG          =  '0'

        AND CD.CPO_ORD_NUM            = CNTD.CPO_ORD_NUM
        AND CD.CPO_DTL_LINE_NUM       = CNTD.CPO_DTL_LINE_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM   = CNTD.CPO_DTL_LINE_SUB_NUM
        AND CD.EZCANCELFLAG           = '0'

        AND CNT.GLBL_CMPY_CD          = CNTD.GLBL_CMPY_CD
        AND CNT.DS_CONTR_PK           = CNTD.DS_CONTR_PK
        AND CNT.EZCANCELFLAG          = '0'  -->
        
        AND DC.GLBL_CMPY_CD            =  OCB.GLBL_CMPY_CD
        AND DC.DS_ORD_CATG_CD          =  OCB.DS_ORD_CATG_CD
        AND (DC.DS_ORD_TP_CD           =  OCB.DS_ORD_TP_CD OR OCB.DS_ORD_TP_CD IS NULL)
        AND OCB.ORD_CATG_CTX_TP_CD     =  #ordCatgCtxTp#
        AND OCB.EZCANCELFLAG           =  '0'
        
        AND DC.GLBL_CMPY_CD            = CNT.GLBL_CMPY_CD
        AND DC.CPO_ORD_NUM             = CNT.CPO_ORD_NUM
        AND CNT.EZCANCELFLAG           = '0'
        
        AND CNT.GLBL_CMPY_CD           = CNTD.GLBL_CMPY_CD
        AND CNT.DS_CONTR_PK            = CNTD.DS_CONTR_PK
        AND CNTD.EZCANCELFLAG          = '0'
        AND CNTD.DS_CONTR_CRAT_TP_CD   = #dsContrCratTpCd# <!-- QC#30573 2019/03/06 Add -->
        
        AND CNTD.GLBL_CMPY_CD           = CD.GLBL_CMPY_CD(+)
        AND CNTD.CPO_ORD_NUM            = CD.CPO_ORD_NUM(+)
        AND CNTD.CPO_DTL_LINE_NUM       = CD.CPO_DTL_LINE_NUM(+)
        AND CNTD.CPO_DTL_LINE_SUB_NUM   = CD.CPO_DTL_LINE_SUB_NUM(+)
        AND CD.CPO_DTL_LINE_SUB_NUM(+) !=  #cpoDtlLineSubNumSet#
        AND CD.BASE_CMPT_FLG(+)         =  'Y'
        AND CD.EZCANCELFLAG(+)          = '0'
        
        AND CD.GLBL_CMPY_CD            =  DCC.GLBL_CMPY_CD(+)
        AND CD.CPO_ORD_NUM             =  DCC.CPO_ORD_NUM(+)
        AND CD.DS_CPO_CONFIG_PK        =  DCC.DS_CPO_CONFIG_PK(+)
        AND DCC.EZCANCELFLAG(+)        =  '0'
        <!-- 2018/05/13 S21_NA#22482 Mod End -->

        <!-- 2017/12/19 S21_NA#22990 Add Start -->
        <!-- 2018/05/13 S21_NA#22482 Mod Start -->
        <!-- AND CNT.GLBL_CMPY_CD          = CNTC.GLBL_CMPY_CD
        AND CNT.DS_CONTR_CATG_CD      = CNTC.DS_CONTR_CATG_CD
        AND CNTC.OM_CATG_FLG          = 'Y'
        AND CNTC.EZCANCELFLAG         = '0' -->
        AND CNT.GLBL_CMPY_CD          = CNTC.GLBL_CMPY_CD(+)
        AND CNT.DS_CONTR_CATG_CD      = CNTC.DS_CONTR_CATG_CD(+)
        AND CNTC.OM_CATG_FLG(+)       = 'Y'
        AND CNTC.EZCANCELFLAG(+)      = '0'
        <!-- 2018/05/13 S21_NA#22482 Mod End -->
        <!-- 2017/12/19 S21_NA#22990 Add End -->
        
        <!-- 2018/05/13 S21_NA#22482 Add Start -->
        AND CNT.GLBL_CMPY_CD           = BC.GLBL_CMPY_CD(+)
        AND CNT.BASE_BLLG_CYCLE_CD     = BC.BLLG_CYCLE_CD(+)
        AND BC.BLLG_CYCLE_ACTV_FLG(+)  = 'Y'
        AND BC.OM_CYCLE_FLG(+)         = 'Y'

        AND CNT.GLBL_CMPY_CD            = BCFU.GLBL_CMPY_CD(+)
        AND CNT.MTR_BLLG_CYCLE_CD       = BCFU.BLLG_CYCLE_CD(+)
        AND BCFU.BLLG_CYCLE_ACTV_FLG(+) = 'Y'
        AND BCFU.OM_CYCLE_FLG(+)        = 'Y'
        <!-- 2021/06/03 QC#57285 Del
        AND CNTD.GLBL_CMPY_CD           = DCP.GLBL_CMPY_CD(+)
        AND CNTD.DS_CONTR_DTL_PK        = DCP.DS_CONTR_DTL_PK (+)
        AND DCP.EZCANCELFLAG(+)         = '0'
        -->
      ORDER BY CNT.SHELL_LINE_NUM
        <!-- 2018/05/13 S21_NA#22482 Add End -->
    </statement>
<!-- QC#16603 Add End -->
    <statement id="getOrdLineForAddAccShell" parameterClass="Map" resultClass="Map">
      SELECT
            DCC.CONFIG_CATG_CD
         ,  DCC.DS_ORD_POSN_NUM
         ,  DCC.DCLN_SVC_CD
        FROM
            CPO                DC
         ,  CPO_DTL            CD
         ,  DS_CPO_CONFIG      DCC
         ,  ORD_CATG_BIZ_CTX   OCB
         ,  DS_CONTR           CNT
         ,  DS_CONTR_DTL       CNTD
        WHERE
            DC.GLBL_CMPY_CD           =  #glblCmpyCd#
        AND DC.CPO_ORD_NUM            =  #ordNum#
        AND DC.EZCANCELFLAG           =  '0'

        AND DC.GLBL_CMPY_CD           =  CD.GLBL_CMPY_CD
        AND DC.CPO_ORD_NUM            =  CD.CPO_ORD_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM  !=  #cpoDtlLineSubNumSet#
        AND CD.ORD_LINE_STS_CD NOT IN 
        <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
           #ordLineStsCd[]#
        </iterate>
        AND CD.EZCANCELFLAG           =  '0'

        AND CD.GLBL_CMPY_CD           =  DCC.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM            =  DCC.CPO_ORD_NUM
        AND CD.DS_CPO_CONFIG_PK       =  DCC.DS_CPO_CONFIG_PK
        AND DCC.EZCANCELFLAG          =  '0'
        AND DCC.CONFIG_TP_CD          =  #configTp#
        AND DCC.DCLN_SVC_CD = '0'

        AND DC.GLBL_CMPY_CD           =  OCB.GLBL_CMPY_CD
        AND DC.DS_ORD_CATG_CD         =  OCB.DS_ORD_CATG_CD
        AND (DC.DS_ORD_TP_CD          =  OCB.DS_ORD_TP_CD OR OCB.DS_ORD_TP_CD IS NULL)
        AND OCB.ORD_CATG_CTX_TP_CD    =  #ordCatgCtxTp#
        AND OCB.EZCANCELFLAG          =  '0'

        AND CD.CPO_ORD_NUM            = CNTD.CPO_ORD_NUM
        AND CD.EZCANCELFLAG           = CNTD.EZCANCELFLAG
        AND CD.CPO_DTL_LINE_NUM       = CNTD.CPO_DTL_LINE_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM   = CNTD.CPO_DTL_LINE_SUB_NUM

        AND CNTD.GLBL_CMPY_CD         = CNT.GLBL_CMPY_CD
        AND CNTD.EZCANCELFLAG         = CNT.EZCANCELFLAG
        AND CNTD.DS_CONTR_PK          = CNT.DS_CONTR_PK  

        AND ( CNTD.ADD_CONTR_FLG        &lt;&gt; #addContrFlg# 
            OR CNT.DS_CONTR_NUM IS NULL
            )

        GROUP BY DCC.CONFIG_CATG_CD, DCC.DS_ORD_POSN_NUM, DCC.DCLN_SVC_CD
        ORDER BY CONFIG_CATG_CD, DS_ORD_POSN_NUM
    </statement>
<!-- 2018/05/13 S21_NA#22482 Add Start -->
    <statement id="getBillToCustCount" parameterClass="Map" resultClass="Integer">
        SELECT
                  COUNT(B.GLBL_CMPY_CD) COUNT
            FROM
                BILL_TO_CUST B
            WHERE
                B.GLBL_CMPY_CD          = #glblCmpyCd#
                AND B.BILL_TO_CUST_CD   = #billToCustCd#
                AND B.RGTN_STS_CD       = #rgtnStsCd#
                AND B.EZCANCELFLAG      = '0'
    </statement>

    <statement id="getDsAcctCustCount" parameterClass="Map" resultClass="Integer">
        SELECT
                  COUNT(A.GLBL_CMPY_CD) COUNT 
            FROM
                SELL_TO_CUST A 
            WHERE
                A.GLBL_CMPY_CD        = #glblCmpyCd#
                AND A.SELL_TO_CUST_CD = #dsAcctNum#
                AND A.RGTN_STS_CD     = #rgtnStsCd#
                AND A.EZCANCELFLAG    = '0'
    </statement>
<!-- 2018/05/13 S21_NA#22482 Add End -->
<!-- QC#20374 Add Start -->
    <statement id="getOrdCustAndShellCust" parameterClass="Map" resultClass="Map">
        SELECT
            CNT.SHELL_LINE_NUM
         ,  CD.DS_ORD_POSN_NUM
         ,  CD.DS_CPO_LINE_NUM
         ,  CD.DS_CPO_LINE_SUB_NUM
         ,  CNT.ALT_PAYER_CUST_CD
         ,  CPO.SELL_TO_CUST_CD
        <!-- START 2018/02/26 Hd.Sugawara [QC#22967,ADD] -->
         ,  CPO.SOLD_TO_CUST_LOC_CD
        <!-- END 2018/02/26 Hd.Sugawara [QC#22967,ADD] -->
         ,  DCC.SHIP_TO_CUST_ACCT_CD
        FROM
            CPO            CPO
         ,  CPO_DTL        CD
         ,  DS_CPO_CONFIG  DCC
         ,  DS_CONTR       CNT
         ,  DS_CONTR_DTL   CNTD
        WHERE
            CPO.GLBL_CMPY_CD          = #glblCmpyCd#
        AND CPO.CPO_ORD_NUM           = #cpoOrdNum#
        AND CPO.EZCANCELFLAG          = '0'

        AND CPO.GLBL_CMPY_CD          = CD.GLBL_CMPY_CD
        AND CPO.CPO_ORD_NUM           = CD.CPO_ORD_NUM
        AND CD.BASE_CMPT_FLG          = 'Y'
        AND CD.EZCANCELFLAG           = '0'

        AND CD.GLBL_CMPY_CD           = DCC.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM            = DCC.CPO_ORD_NUM
        AND CD.DS_CPO_CONFIG_PK       = DCC.DS_CPO_CONFIG_PK
        AND DCC.EZCANCELFLAG          = '0'

        AND CD.CPO_ORD_NUM            = CNTD.CPO_ORD_NUM
        AND CD.CPO_DTL_LINE_NUM       = CNTD.CPO_DTL_LINE_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM   = CNTD.CPO_DTL_LINE_SUB_NUM
        AND CD.EZCANCELFLAG           = '0'

        AND CNTD.GLBL_CMPY_CD         = CNT.GLBL_CMPY_CD
        AND CNTD.DS_CONTR_PK          = CNT.DS_CONTR_PK
        <!-- 2018/10/16 QC#28370 Add Start -->
        AND CNTD.EZCANCELFLAG         = '0'
        <!-- 2018/10/16 QC#28370 Add End -->
        AND CNT.EZCANCELFLAG          = '0'

        ORDER BY
            SHELL_LINE_NUM
         ,  DS_ORD_POSN_NUM
         ,  DS_CPO_LINE_NUM
    </statement>
<!-- QC#20374 Add End -->
    <!-- S21_NA#13813 ADD START -->
    <!-- #################### E099-1030 #################### -->
    <statement id="getRentalShellDtlFormOrdConf" parameterClass="Map" resultClass="Map">
        SELECT
            DCC.SVC_CONFIG_MSTR_PK
           ,CNTD.DS_CONTR_DTL_PK
        FROM
                CPO                 DC
             ,  DS_CPO_CONFIG       DCC
             ,  ORD_CATG_BIZ_CTX    OCB
             ,  DS_CONTR            CNT
             ,  DS_CONTR_DTL        CNTD
        WHERE
                DC.GLBL_CMPY_CD           = #glblCmpyCd#
            AND DC.CPO_ORD_NUM            = #ordNum#
            AND DC.EZCANCELFLAG           = '0'

            AND DC.GLBL_CMPY_CD           = DCC.GLBL_CMPY_CD
            AND DC.CPO_ORD_NUM            = DCC.CPO_ORD_NUM
            AND DCC.EZCANCELFLAG          = '0'
            AND EXISTS ( <!-- QC#22874 -->
                SELECT
                          1
                    FROM
                        CPO_DTL     CD
                    WHERE
                        CD.GLBL_CMPY_CD         = DCC.GLBL_CMPY_CD
                        AND CD.CPO_ORD_NUM      = DCC.CPO_ORD_NUM
                        AND CD.DS_ORD_POSN_NUM  = DCC.DS_ORD_POSN_NUM
                        AND CD.ORD_LINE_STS_CD  NOT IN
                        <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
                           #ordLineStsCd[]#
                        </iterate>
                        AND CD.EZCANCELFLAG     = '0'
            ) 

            AND DC.GLBL_CMPY_CD           = OCB.GLBL_CMPY_CD
            AND DC.DS_ORD_CATG_CD         = OCB.DS_ORD_CATG_CD
            AND OCB.ORD_CATG_CTX_TP_CD    = #ordCatgCtxTp#
            AND OCB.EZCANCELFLAG          = '0'

            AND DCC.GLBL_CMPY_CD          = CNTD.GLBL_CMPY_CD
            AND DCC.SVC_CONFIG_MSTR_PK    = CNTD.SVC_CONFIG_MSTR_PK
            AND DCC.CPO_ORD_NUM           = CNTD.CPO_ORD_NUM
            AND CNTD.EZCANCELFLAG         = '0'
            <!-- Add Start 2017/06/12 QC#18549 -->
            AND CNTD.SVC_PRC_CATG_CD      = #svcPrcCatgCd#
            <!-- Add End 2017/06/12 QC#18549 -->

            AND CNTD.GLBL_CMPY_CD         = CNT.GLBL_CMPY_CD
            AND CNTD.DS_CONTR_PK          = CNT.DS_CONTR_PK
            AND CNT.EZCANCELFLAG          = '0'
        ORDER BY
            CNTD.DS_CONTR_DTL_PK
    </statement>
    
    <!-- #################### E099-1030 #################### -->
    <statement id="getOrdLineRequireForRentalShell" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
                  DCD.CPO_DTL_LINE_NUM
                , DCD.CPO_DTL_LINE_SUB_NUM
                , CNT.PRC_SVC_CONTR_TP_CD
                , CNT.PRC_SVC_PLN_TP_CD
                , CNT.DS_CONTR_CATG_CD
                , CNTD.SHELL_LINE_NUM
                , CNTD.SVC_PGM_MDSE_CD
                , CNTD.BASE_BLLG_CYCLE_CD
                , CNTD.MTR_BLLG_CYCLE_CD
                , DCD.DS_ORD_POSN_NUM
                , DCD.DS_CPO_LINE_NUM
                , DCD.DS_CPO_LINE_SUB_NUM
                , DCC.DCLN_SVC_CD DCLN_SVC_CD
            FROM
                <!-- Mod Start 2017/06/09 QC#18549 -->
                DS_CONTR_DTL            CNTD
                , DS_CONTR              CNT
                , CPO_DTL_V             DCD
                , DS_CPO_CONFIG         DCC
                , CPO                   DC
                , ORD_CATG_BIZ_CTX      OCB
                <!-- , DS_CONTR_ADDL_CHRG    CNTA -->
                <!-- , MDSE                  M -->
                , ALL_MDSE_V            M
                <!-- Mod End 2017/06/09 QC#18549 -->
            WHERE
                <!-- Mod Start 2017/06/09 QC#18549 -->
                CNTD.GLBL_CMPY_CD               = #glblCmpyCd#
                AND CNTD.DS_CONTR_DTL_PK        = #cntDtlPk#
                AND CNTD.EZCANCELFLAG           = '0'

                AND CNTD.GLBL_CMPY_CD           = CNT.GLBL_CMPY_CD
                AND CNTD.DS_CONTR_PK            = CNT.DS_CONTR_PK
                AND CNT.EZCANCELFLAG            = '0'

                AND DCD.GLBL_CMPY_CD            = CNTD.GLBL_CMPY_CD 
                AND DCD.DS_CPO_CONFIG_PK        = ( 
                    SELECT
                        CD.DS_CPO_CONFIG_PK 
                    FROM
                        CPO_DTL_V CD 
                    WHERE
                        CD.GLBL_CMPY_CD             = CNTD.GLBL_CMPY_CD 
                        AND CD.CPO_ORD_NUM          = CNTD.CPO_ORD_NUM 
                        AND CD.CPO_DTL_LINE_NUM     = CNTD.CPO_DTL_LINE_NUM 
                        AND CD.CPO_DTL_LINE_SUB_NUM = CNTD.CPO_DTL_LINE_SUB_NUM 
                        AND CD.EZCANCELFLAG         = '0'
                ) 
                AND DCD.COA_MDSE_TP_CD            IN ( 
                    SELECT
                        VS.COA_MDSE_TP_CD 
                    FROM
                        MDSE_TP_VAL_SET VS 
                    WHERE
                        VS.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD 
                        AND VS.MDSE_TP_CTX_TP_CD  IN ( #mdseTpCtxTpCdAddlBase#, #mdseTpCtxTpCdConfig# )
                        AND VS.EZCANCELFLAG = '0'
                )

                AND DCD.GLBL_CMPY_CD            = DCC.GLBL_CMPY_CD 
                AND DCD.CPO_ORD_NUM             = DCC.CPO_ORD_NUM 
                AND DCD.DS_CPO_CONFIG_PK        = DCC.DS_CPO_CONFIG_PK 
                AND DCC.EZCANCELFLAG            = '0'

                AND DC.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD 
                AND DC.CPO_ORD_NUM              = DCD.CPO_ORD_NUM 
                AND DC.EZCANCELFLAG             = '0'

                AND DC.GLBL_CMPY_CD             = OCB.GLBL_CMPY_CD 
                AND DC.DS_ORD_CATG_CD           = OCB.DS_ORD_CATG_CD 
                AND ( 
                    DC.DS_ORD_TP_CD             = OCB.DS_ORD_TP_CD 
                    OR OCB.DS_ORD_TP_CD         IS NULL
                ) 
                AND ( 
                    DC.DS_ORD_RSN_CD            = OCB.DS_ORD_RSN_CD 
                    OR OCB.DS_ORD_RSN_CD        IS NULL
                ) 
                AND OCB.ORD_CATG_CTX_TP_CD      = #ordCatgCtxTp#
                AND OCB.EZCANCELFLAG            = '0'

                AND DCD.GLBL_CMPY_CD            = M.GLBL_CMPY_CD 
                AND DCD.MDSE_CD                 = M.MDSE_CD 
                AND M.INSTL_BASE_CTRL_FLG       = 'Y' 
                AND M.EZCANCELFLAG              = '0'

                AND (
                    (CNT.MAN_CONTR_OVRD_FLG                    = 'N'
                     AND NOT EXISTS ( 
                     <!-- START 2018/03/15 M.Naito [QC#23378,MOD] -->
                            SELECT
                                1
                            FROM
                                 DS_CONTR_DTL DCDC2
                            WHERE
                                DCDC2.GLBL_CMPY_CD             = CNT.GLBL_CMPY_CD 
                                AND DCDC2.DS_CONTR_PK          = CNT.DS_CONTR_PK 
                                AND DCDC2.CPO_ORD_NUM          = DCD.CPO_ORD_NUM 
                                AND DCDC2.CPO_DTL_LINE_NUM     = DCD.CPO_DTL_LINE_NUM 
                                AND DCDC2.CPO_DTL_LINE_SUB_NUM = DCD.CPO_DTL_LINE_SUB_NUM
                                AND DCDC2.RNTL_PRC_AMT         IS NOT NULL
                                AND DCDC2.EZCANCELFLAG         = '0'
                     <!-- END 2018/03/15 M.Naito [QC#23378,MOD] -->
                        )
                    )
                    OR (CNT.MAN_CONTR_OVRD_FLG                 = 'Y'
                    AND NOT EXISTS (
                            SELECT
                                1
                            FROM
                                DS_CONTR_DTL CNTD2
                            WHERE
                                CNTD2.GLBL_CMPY_CD             = CNTD.GLBL_CMPY_CD 
                                AND CNTD2.DS_CONTR_DTL_PK      = CNTD.DS_CONTR_DTL_PK 
                                AND CNTD2.CPO_ORD_NUM          = DCD.CPO_ORD_NUM 
                                AND CNTD2.CPO_DTL_LINE_NUM     = DCD.CPO_DTL_LINE_NUM 
                                AND CNTD2.CPO_DTL_LINE_SUB_NUM = DCD.CPO_DTL_LINE_SUB_NUM 
                                AND CNTD2.EZCANCELFLAG         = '0'
                        )
                    )
                )
                <!-- Mod End 2017/06/09 QC#18549 -->
    </statement>

    <statement id="getRentalShellCheckForIbControl" parameterClass="Map" resultClass="Map">
        SELECT
                  DCDV.CPO_ORD_NUM
                , DCDV.DS_CPO_CONFIG_PK
                , DCDV.DS_ORD_POSN_NUM
                , DCDV.DS_CPO_LINE_NUM
                , DCDV.DS_CPO_LINE_SUB_NUM 
            FROM
                DS_CONTR_DTL                CNTD
                , CPO_DTL_V                 DCDV
                , MDSE                      DMI
            WHERE
                    CNTD.GLBL_CMPY_CD           = #glblCmpyCd#
                AND CNTD.DS_CONTR_DTL_PK        = #cntDtlPk#
                AND CNTD.EZCANCELFLAG           = '0'

                AND CNTD.GLBL_CMPY_CD           = DCDV.GLBL_CMPY_CD
                AND CNTD.CPO_ORD_NUM            = DCDV.CPO_ORD_NUM
                AND CNTD.CPO_DTL_LINE_NUM       = DCDV.CPO_DTL_LINE_NUM
                AND CNTD.CPO_DTL_LINE_SUB_NUM   = DCDV.CPO_DTL_LINE_SUB_NUM

                AND DCDV.EZCANCELFLAG           = '0'
                AND DCDV.GLBL_CMPY_CD           = DMI.GLBL_CMPY_CD
                AND DCDV.MDSE_CD                = DMI.MDSE_CD
                AND DMI.INSTL_BASE_CTRL_FLG    != 'Y'
                AND DMI.EZCANCELFLAG            = '0'
        UNION
        SELECT
                  DCDV.CPO_ORD_NUM
                , DCDV.DS_CPO_CONFIG_PK
                , DCDV.DS_ORD_POSN_NUM
                , DCDV.DS_CPO_LINE_NUM
                , DCDV.DS_CPO_LINE_SUB_NUM 
            FROM
                DS_CONTR_DTL                CNTD
                , CPO_DTL_V                 DCDV
                , ORD_TAKE_MDSE             OTM
                , MDSE                      DMI
            WHERE
                CNTD.GLBL_CMPY_CD               = #glblCmpyCd#
                AND CNTD.DS_CONTR_DTL_PK        = #cntDtlPk#
                AND CNTD.EZCANCELFLAG           = '0'

                AND CNTD.GLBL_CMPY_CD           = DCDV.GLBL_CMPY_CD
                AND CNTD.CPO_ORD_NUM            = DCDV.CPO_ORD_NUM
                AND CNTD.CPO_DTL_LINE_NUM       = DCDV.CPO_DTL_LINE_NUM
                AND CNTD.CPO_DTL_LINE_SUB_NUM   = DCDV.CPO_DTL_LINE_SUB_NUM
                AND DCDV.EZCANCELFLAG           = '0'

                AND DCDV.GLBL_CMPY_CD           = OTM.GLBL_CMPY_CD
                AND DCDV.MDSE_CD                = OTM.ORD_TAKE_MDSE_CD
                AND OTM.EZCANCELFLAG            = '0'

                AND OTM.GLBL_CMPY_CD            = DMI.GLBL_CMPY_CD
                AND OTM.MDSE_CD                 = DMI.MDSE_CD
                AND DMI.INSTL_BASE_CTRL_FLG    != 'Y'
                AND DMI.EZCANCELFLAG            = '0'
    </statement>

    <!-- #################### E099-1035 #################### -->
    <statement id="getTaxExemByLocNum" parameterClass="Map" resultClass="Map">
        SELECT
             BTC.DS_TAX_EXEM_FLG
          ,  BTC.DS_EXEM_EXPR_DT
        FROM
             CPO             CP
          ,  BILL_TO_CUST    BTC
        WHERE
             CP.GLBL_CMPY_CD      =  #glblCmpyCd#
        AND  CP.CPO_ORD_NUM       =  #ordNum#
        AND  CP.EZCANCELFLAG      =  '0'

        AND  CP.GLBL_CMPY_CD      =  BTC.GLBL_CMPY_CD
        AND  CP.BILL_TO_CUST_CD   =  BTC.BILL_TO_CUST_CD
        AND  BTC.EZCANCELFLAG     =  '0'
    </statement>

    <statement id="getTaxExemByAcctNum" parameterClass="Map" resultClass="Map">
        SELECT
             DAC.DS_TAX_EXEM_FLG
          ,  DAC.DS_EXEM_EXPR_DT
        FROM
             CPO             CP
          ,  BILL_TO_CUST    BTC
          ,  SELL_TO_CUST    DAC
        WHERE
             CP.GLBL_CMPY_CD      =  #glblCmpyCd#
        AND  CP.CPO_ORD_NUM       =  #ordNum#
        AND  CP.EZCANCELFLAG      =  '0'

        AND  CP.GLBL_CMPY_CD      =  BTC.GLBL_CMPY_CD
        AND  CP.BILL_TO_CUST_CD   =  BTC.BILL_TO_CUST_CD
        AND  BTC.EZCANCELFLAG     =  '0'

        AND  BTC.GLBL_CMPY_CD     =  DAC.GLBL_CMPY_CD
        AND  BTC.SELL_TO_CUST_CD  =  DAC.SELL_TO_CUST_CD
        AND  DAC.EZCANCELFLAG     =  '0'
    </statement>

    <!-- #################### E099-1040 #################### -->
    <statement id="getMsrpAmt" parameterClass="Map" resultClass="Map">
<!-- 2017/07/13 S21_NA#19888 Mod Start -->
<!--         SELECT -->
<!--             C.ORD_QTY -->
<!--          ,  PL.PRC_LIST_EQUIP_PRC_AMT -->
<!--          ,  PL.PRC_QLFY_VAL_TXT -->
<!--          FROM -->
<!--             CPO_DTL        C -->
<!--          ,  PRC_LIST_EQUIP PL -->
<!--          ,  PRC_CATG       DP -->
<!--         WHERE -->
<!--              C.GLBL_CMPY_CD                   =     #glblCmpyCd# -->
<!--         AND  C.CPO_ORD_NUM                    =     #ordNum# -->
<!--         AND  C.EZCANCELFLAG                   =     '0' -->
<!--         AND  C.GLBL_CMPY_CD                   =     PL.GLBL_CMPY_CD -->
<!--         AND ( -->
<!--               C.MDSE_CD = PL.PRC_QLFY_VAL_TXT -->
<!--             OR -->
<!--               PL.PRC_QLFY_VAL_TXT LIKE DECODE(LENGTH(C.MDSE_CD),8, C.MDSE_CD, SUBSTR(C.MDSE_CD,0,8)||'%') -->
<!--             ) -->
<!--         AND  PL.PRC_QLFY_TP_CD                =     #prcQlfyTpCd# -->
<!--         AND  PL.EFF_FROM_DT                   &lt;= #slsDt# -->
<!--         AND  NVL(PL.EFF_THRU_DT, '99991231')  &gt;= #slsDt# -->
<!--         AND  PL.DEL_FLG                       =     #flgN# -->
<!--         AND  PL.EZCANCELFLAG                  =     '0' -->

<!--         AND  PL.GLBL_CMPY_CD                  =     DP.GLBL_CMPY_CD -->
<!--         AND  PL.PRC_CATG_CD                   =     DP.PRC_CATG_CD -->
<!--         AND  DP.PRC_LIST_TP_CD                =     #prcListTpCd# -->
<!--         AND  DP.ACTV_FLG                      =     #flgY# -->
<!--         AND  DP.EFF_FROM_DT                   &lt;= #slsDt# -->
<!--         AND  NVL(DP.EFF_THRU_DT, '99991231')  &gt;= #slsDt# -->
<!--         AND  DP.EZCANCELFLAG                  =     '0' -->
<!-- 2019/04/10 QC#31128 Mod Start -->
<!--         SELECT
            V.ORD_QTY
         ,  V.PRC_LIST_EQUIP_PRC_AMT
         ,  V.PRC_QLFY_VAL_TXT
        FROM
            (
                SELECT
                    CD.ORD_QTY
                 ,  CD.CPO_DTL_LINE_NUM
                 ,  CD.CPO_DTL_LINE_SUB_NUM
                 ,  PL.PRC_LIST_EQUIP_PRC_AMT 
                 ,  PL.PRC_QLFY_VAL_TXT
                 ,  ROW_NUMBER() OVER (
                        PARTITION BY>
                            CD.CPO_DTL_LINE_NUM
                         ,  CD.CPO_DTL_LINE_SUB_NUM
                        ORDER BY
                            CD.CPO_DTL_LINE_NUM
                         ,  CD.CPO_DTL_LINE_SUB_NUM
                    ) AS ROW_NUM
                 FROM
                    CPO_DTL        CD
                 ,  ORD_TAKE_MDSE  OTM
                 ,  PRC_LIST_EQUIP PL
                 ,  PRC_CATG       DP
                WHERE
                     CD.GLBL_CMPY_CD                  =     #glblCmpyCd#
                AND  CD.CPO_ORD_NUM                   =     #ordNum#
                AND  CD.EZCANCELFLAG                  =     '0'
                AND  CD.GLBL_CMPY_CD                  =     OTM.GLBL_CMPY_CD(+)
                AND  SUBSTR(CD.MDSE_CD,0,8)           =     OTM.ORD_TAKE_MDSE_CD(+)
                AND  CD.EZCANCELFLAG                  =     OTM.EZCANCELFLAG(+)

                AND  CD.GLBL_CMPY_CD                  =     PL.GLBL_CMPY_CD
                AND  (CASE WHEN OTM.ORD_TAKE_MDSE_CD IS NULL
                          THEN CD.MDSE_CD
                          ELSE OTM.ORD_TAKE_MDSE_CD
                      END = PL.PRC_QLFY_VAL_TXT )
                AND  PL.PRC_QLFY_TP_CD                =     #prcQlfyTpCd#
                AND  PL.EFF_FROM_DT                   &lt;= #slsDt#
                AND  NVL(PL.EFF_THRU_DT, '99991231')  &gt;= #slsDt#
                AND  PL.DEL_FLG                       =     #flgN#
                AND  PL.PRC_LIST_EQUIP_PRC_AMT        IS NOT NULL
                AND  PL.EZCANCELFLAG                  =     '0'

                AND  PL.GLBL_CMPY_CD                  =     DP.GLBL_CMPY_CD
                AND  PL.PRC_CATG_CD                   =     DP.PRC_CATG_CD
                AND  DP.PRC_LIST_TP_CD                =     #prcListTpCd#
                AND  DP.ACTV_FLG                      =     #flgY#
                AND  DP.EFF_FROM_DT                   &lt;= #slsDt#
                AND  NVL(DP.EFF_THRU_DT, '99991231')  &gt;= #slsDt#
                AND  DP.EZCANCELFLAG                  =     '0'
                ORDER BY
                    CD.CPO_DTL_LINE_NUM
                 ,  CD.CPO_DTL_LINE_SUB_NUM
                 ,  PL.PRC_CATG_CD
            ) V
        WHERE
            V.ROW_NUM = 1
 -->
     <!-- 2017/07/13 S21_NA#19888 Mod End -->
        SELECT
            V.ORD_QTY
         ,  V.MDSE_CD
         ,  V.PRC_LIST_EQUIP_PRC_AMT
        FROM
            (
                SELECT
                    CD.ORD_QTY
                 ,  CD.CPO_DTL_LINE_NUM
                 ,  CD.CPO_DTL_LINE_SUB_NUM
                 ,  CASE WHEN OTM.ORD_TAKE_MDSE_CD IS NULL
                          THEN CD.MDSE_CD
                          ELSE OTM.ORD_TAKE_MDSE_CD
                    END MDSE_CD
                 ,  P.PRC_CATG_CD
                 ,  P.PRC_LIST_EQUIP_PRC_AMT
                 ,  P.PRC_QLFY_VAL_TXT
                 ,  ROW_NUMBER() OVER (
                        PARTITION BY 
                            CD.CPO_DTL_LINE_NUM
                         ,  CD.CPO_DTL_LINE_SUB_NUM
                        ORDER BY 
                            CD.CPO_DTL_LINE_NUM
                         ,  CD.CPO_DTL_LINE_SUB_NUM
                    ) AS ROW_NUM
                 FROM
                    CPO_DTL        CD
                 ,  ORD_TAKE_MDSE  OTM
                 ,( SELECT
                           PL.GLBL_CMPY_CD
                         , PL.PRC_CATG_CD
                         , PL.PRC_QLFY_VAL_TXT
                         , PRC_LIST_EQUIP_PRC_AMT
                    FROM   
                       PRC_LIST_EQUIP PL
                    ,  PRC_CATG       DP
                    WHERE  PL.GLBL_CMPY_CD                  =     DP.GLBL_CMPY_CD
                      AND  PL.PRC_CATG_CD                   =     DP.PRC_CATG_CD
                      AND  PL.EZCANCELFLAG                  =     '0'
                      AND  PL.PRC_QLFY_TP_CD                =     '01'
                      AND  PL.EFF_FROM_DT                   &lt;= #slsDt#
                      AND  NVL(PL.EFF_THRU_DT, '99991231')  &gt;= #slsDt#
                      AND  PL.DEL_FLG                       =     #flgN#
                      AND  PL.PRC_LIST_EQUIP_PRC_AMT        IS NOT NULL
                      AND  DP.EZCANCELFLAG                  =     '0'
                      AND  DP.PRC_LIST_TP_CD                =     '10'
                      AND  DP.ACTV_FLG                      =     #flgY#
                      AND  DP.EFF_FROM_DT                   &lt;= #slsDt#
                      AND  NVL(DP.EFF_THRU_DT, '99991231')  &gt;= #slsDt#
                ) P
                WHERE
                     CD.GLBL_CMPY_CD                  =     #glblCmpyCd#
                AND  CD.CPO_ORD_NUM                   =     #ordNum#
                AND  CD.EZCANCELFLAG                  =     '0'
                AND  CD.GLBL_CMPY_CD                  =     OTM.GLBL_CMPY_CD(+)
                AND  CD.EZCANCELFLAG                  =     OTM.EZCANCELFLAG(+)
                AND  CD.MDSE_CD                       =     OTM.MDSE_CD(+)
                AND  CD.GLBL_CMPY_CD                  =     P.GLBL_CMPY_CD(+)
                AND  (CASE WHEN OTM.ORD_TAKE_MDSE_CD IS NULL
                          THEN CD.MDSE_CD
                          ELSE OTM.ORD_TAKE_MDSE_CD
                      END = P.PRC_QLFY_VAL_TXT(+) )
                ORDER BY
                    CPO_DTL_LINE_NUM
                 ,  CPO_DTL_LINE_SUB_NUM
                 ,  PRC_CATG_CD
            ) V
        WHERE
            V.ROW_NUM = 1
    </statement>
    <!-- 2017/07/13 S21_NA#19888 Mod E n d -->

    <!-- #################### E099-1045 #################### -->
    <statement id="getSowReqLine" parameterClass="Map" resultClass="Map">
        SELECT
             CD.DS_ORD_POSN_NUM
         ,   CD.DS_CPO_LINE_NUM
         ,   CD.DS_CPO_LINE_SUB_NUM
         ,   CD.MDSE_NM
        FROM
             CPO_DTL          CD
         ,   MDSE             DMI
        WHERE
            CD.GLBL_CMPY_CD          =  #glblCmpyCd#
        AND CD.CPO_ORD_NUM           =  #ordNum#
        AND CD.EZCANCELFLAG          =  '0'

        AND CD.GLBL_CMPY_CD          =  DMI.GLBL_CMPY_CD
        AND CD.MDSE_CD               =  DMI.MDSE_CD
        AND DMI.SOW_REQ_FLG          =  #flgY#
        AND DMI.EZCANCELFLAG         =  '0'

        UNION ALL

        SELECT
             CD.DS_ORD_POSN_NUM
         ,   CD.DS_CPO_LINE_NUM
         ,   CD.DS_CPO_LINE_SUB_NUM
         ,   CD.MDSE_NM
        FROM
             CPO_DTL          CD
         ,   ORD_TAKE_MDSE    OTM
         ,   MDSE             DMI
        WHERE
            CD.GLBL_CMPY_CD          =  #glblCmpyCd#
        AND CD.CPO_ORD_NUM           =  #ordNum#
        AND CD.EZCANCELFLAG          =  '0'

        AND CD.GLBL_CMPY_CD          =  OTM.GLBL_CMPY_CD
        AND CD.MDSE_CD               =  OTM.ORD_TAKE_MDSE_CD
        AND OTM.EZCANCELFLAG         =  '0'

        AND OTM.GLBL_CMPY_CD         =  DMI.GLBL_CMPY_CD
        AND OTM.MDSE_CD              =  DMI.MDSE_CD
        AND DMI.SOW_REQ_FLG          =  #flgY#
        AND DMI.EZCANCELFLAG         =  '0'
    </statement>

    <!-- #################### E099-1050 / E099-1100 #################### -->
    <statement id="getSiteSrvyReqConfig" parameterClass="Map" resultClass="Map">
        SELECT
             DC.DS_CPO_CONFIG_PK
         ,   DC.CONFIG_CATG_CD
         ,   DC.DS_ORD_POSN_NUM
         ,   DM.MDL_DESC_TXT
        FROM
             DS_CPO_CONFIG DC
         ,   DS_MDL DM
         ,   CONFIG_TP CT
        WHERE
            DC.GLBL_CMPY_CD              =  #glblCmpyCd#
        AND DC.CPO_ORD_NUM               =  #ordNum#
        AND DC.EZCANCELFLAG              =  '0'

        AND DC.GLBL_CMPY_CD              =  DM.GLBL_CMPY_CD
        AND DC.MDL_ID                    =  DM.MDL_ID
        AND DM.SITE_SRVY_REQ_FLG         =  #flgY#
        AND DM.EZCANCELFLAG              =  '0'

        AND DC.GLBL_CMPY_CD              =  CT.GLBL_CMPY_CD
        AND DC.CONFIG_TP_CD              =  CT.CONFIG_TP_CD
        <isEqual property="diChckCd" compareValue="E099-1050">
        AND (CT.CONFIG_CATG_CD          !=  #configCatgCd#
        OR   CT.CONFIG_EXST_AT_CUST_FLG  =  #flgN#)
        AND EXISTS ( 
            SELECT
                      1
                FROM
                    DS_CPO_RTRN_DTL     CRD
                WHERE
                    CRD.GLBL_CMPY_CD            = DC.GLBL_CMPY_CD 
                    AND CRD.DS_CPO_CONFIG_PK    = DC.DS_CPO_CONFIG_PK 
                    AND CRD.RTRN_LINE_STS_CD NOT IN
                    <iterate property="rtrnLineStsList" var="rtrnLineStsCd[]" open="(" close=")" conjunction=",">
                       #rtrnLineStsCd[]#
                    </iterate>
                    AND CRD.EZCANCELFLAG        = '0'
        ) 
        </isEqual>
        <isEqual property="diChckCd" compareValue="E099-1100">
        AND CT.CONFIG_CATG_CD            =  #configCatgCd#
        AND CT.CONFIG_EXST_AT_CUST_FLG   =  #flgN#
        AND EXISTS (
            SELECT
                      1
                FROM
                    CPO_DTL     CD
                WHERE
                    CD.GLBL_CMPY_CD            = DC.GLBL_CMPY_CD 
                    AND CD.DS_CPO_CONFIG_PK    = DC.DS_CPO_CONFIG_PK 
                    AND CD.ORD_LINE_STS_CD NOT IN   <!-- QC#22874 -->
                    <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
                       #ordLineStsCd[]#
                    </iterate>
                    AND CD.EZCANCELFLAG        = '0'
        ) 
        </isEqual>
        AND CT.EZCANCELFLAG              =  '0'

        AND NOT EXISTS
            (
              SELECT
                  *
              FROM
                  (
                    SELECT
                        *
                    FROM
                        DS_SITE_SRVY DS
                    WHERE
                        DS.GLBL_CMPY_CD       =  DC.GLBL_CMPY_CD
                    AND DS.DS_CPO_CONFIG_PK   =  DC.DS_CPO_CONFIG_PK
                    AND DS.EZCANCELFLAG       =  '0'
                  )
                  UNION 
                  (
                    SELECT
                        *
                    FROM
                        DS_SITE_SRVY DS
                    WHERE
                        DS.GLBL_CMPY_CD       =  DC.GLBL_CMPY_CD
                    AND DS.CPO_ORD_NUM        =  DC.CPO_ORD_NUM
                    AND DS.DS_CPO_CONFIG_PK   IS NULL
                    AND DS.EZCANCELFLAG       =  '0'
                  )
            )
    </statement>

    <!-- #################### E099-1055 #################### -->
    <statement id="getPriceContract" parameterClass="Map" resultClass="Map">
        SELECT
            CSMP_NUM
           ,PRC_CONTR_PK
           ,PRC_CONTR_NUM
        FROM
            (
             SELECT
                 CC.CSMP_NUM
                ,PC.PRC_CONTR_PK
                ,PC.PRC_CONTR_NUM
                ,CASE
                    WHEN DC.PRC_CONTR_NUM = PC.PRC_CONTR_NUM
                      THEN 0
                    WHEN PC.PRC_CONTR_NUM IS NOT NULL
                      THEN 1
                    ELSE   2
                 END ORDER_BY
             FROM
                 CPO            DC
                ,CSMP_CONTR     CC
                <!-- S21_NA#19847 2017/07/27 Del Start -->
                <!-- ,PRC_CUST_AUDC  PCA -->
                <!-- S21_NA#19847 2017/07/27 Del End -->
                ,PRC_CATG       DPC
                ,PRC_CONTR      PC
             WHERE
                 DC.GLBL_CMPY_CD     = #glblCmpyCd#
             AND DC.CPO_ORD_NUM      = #cpoOrdNum#
             AND DC.EZCANCELFLAG     = '0'

             AND DC.GLBL_CMPY_CD     = CC.GLBL_CMPY_CD
             AND ((DC.CSMP_CONTR_NUM = CC.CSMP_NUM AND DC.DLR_REF_NUM = CC.DLR_REF_NUM)
               OR (DC.CSMP_CONTR_NUM = CC.CSMP_NUM AND DC.DLR_REF_NUM IS NULL)
               OR (DC.CSMP_CONTR_NUM IS NULL       AND DC.DLR_REF_NUM = CC.DLR_REF_NUM))
             AND CC.DS_ACCT_NUM      = #sellToCustCd#
             AND CC.EFF_FROM_DT      &lt;= #slsDt#
             AND (CC.EFF_THRU_DT     &gt;= #slsDt#  OR CC.EFF_THRU_DT    IS NULL)
             AND CC.EZCANCELFLAG     = '0'

             <!-- S21_NA#19847 2017/07/27 Del Start -->
             <!-- AND CC.GLBL_CMPY_CD     = PCA.GLBL_CMPY_CD -->
             <!-- AND (CC.CSMP_NUM        = PCA.CSMP_NUM_01 -->
             <!--      OR CC.CSMP_NUM     = PCA.CSMP_NUM_02 -->
             <!--      OR CC.CSMP_NUM     = PCA.CSMP_NUM_03) -->
             <!-- AND PCA.EFF_FROM_DT     &lt;= #slsDt# -->
             <!-- AND (PCA.EFF_THRU_DT    &gt;= #slsDt#  OR PCA.EFF_THRU_DT   IS NULL) -->
             <!-- AND PCA.EZCANCELFLAG    = '0' -->
             <!-- S21_NA#19847 2017/07/27 Del Start -->

             <!-- S21_NA#19847 2017/07/27 Mod Start -->
             <!-- AND PCA.GLBL_CMPY_CD    = DPC.GLBL_CMPY_CD -->
             <!-- AND PCA.PRC_CATG_CD     = DPC.PRC_CATG_CD -->
             AND CC.GLBL_CMPY_CD     = DPC.GLBL_CMPY_CD
             AND CC.PRC_CATG_CD      = DPC.PRC_CATG_CD
             <!-- S21_NA#19847 2017/07/27 Mod End -->
             AND DPC.EFF_FROM_DT     &lt;= #slsDt#
             AND (DPC.EFF_THRU_DT    &gt;= #slsDt#  OR DPC.EFF_THRU_DT   IS NULL)
             AND DPC.EZCANCELFLAG    = '0'

             AND DPC.GLBL_CMPY_CD    = PC.GLBL_CMPY_CD
             AND DPC.PRC_CONTR_NUM   = PC.PRC_CONTR_NUM
             AND PC.ACTV_FLG         = 'Y'
             AND PC.EFF_FROM_DT      &lt;= #slsDt#
             AND (PC.EFF_THRU_DT     &gt;= #slsDt#  OR PC.EFF_THRU_DT    IS NULL)
             AND PC.EZCANCELFLAG     = '0'
            ) TBL
        ORDER BY
            ORDER_BY ASC NULLS LAST
    </statement>

    <statement id="getRebateItemList" parameterClass="Map" resultClass="String">
        SELECT
            DISTINCT PCTC.MDSE_CD
        FROM
            PRC_CONTR_TRX_CHRG PCTC
        WHERE
            PCTC.GLBL_CMPY_CD      = #glblCmpyCd#
        AND PCTC.PRC_CONTR_PK      = #prcContrPk#
        AND (PCTC.DS_ACCT_NUM      = #sellToCustCd#
         OR PCTC.DS_ACCT_NUM      IS NULL)
        AND PCTC.EFF_FROM_DT   &lt;= #slsDt#
        AND (PCTC.EFF_THRU_DT  &gt;= #slsDt#
         OR PCTC.EFF_THRU_DT      IS NULL)
        AND PCTC.PRC_CONTR_REB_TP_CD IN (
                SELECT
                    OCBC.THIRD_BIZ_CTX_ATTRB_TXT
                FROM
                    ORD_CATG_BIZ_CTX OCBC
                WHERE
                    OCBC.GLBL_CMPY_CD        = #glblCmpyCd#
                AND OCBC.ORD_CATG_CTX_TP_CD IN (#ordCatgCtxTpEquip#, #ordCatgCtxTpSupply#)
                AND OCBC.DS_ORD_CATG_CD      = #dsOrdCatgCd#
                AND (  OCBC.DS_ORD_TP_CD     = #dsOrdTpCd#
                    OR OCBC.DS_ORD_TP_CD    IS NULL)
                AND OCBC.EZCANCELFLAG        = '0'
        )
        AND NOT EXISTS (
            SELECT
                *
            FROM
                CPO_DTL CD
            WHERE
                CD.GLBL_CMPY_CD = #glblCmpyCd#
            AND CD.CPO_ORD_NUM  = #cpoOrdNum#
            AND CD.MDSE_CD      = PCTC.MDSE_CD
            AND CD.EZCANCELFLAG = '0'
        )
        AND PCTC.EZCANCELFLAG      = '0'
        ORDER BY
            PCTC.MDSE_CD
    </statement>

    <!-- 2016/11/01 S21_NA#15665 Add Start -->
    <statement id="getRebateItemForPrcContr" parameterClass="Map" resultClass="String">
        SELECT 
            PCTC.MDSE_CD MDSE_CD
        FROM
            PRC_CONTR PC
            ,PRC_CONTR_TRX_CHRG PCTC
        WHERE
            PC.GLBL_CMPY_CD                     = #glblCmpyCd#
            AND PC.PRC_CONTR_NUM                = #prcContrNum#
            AND PC.ACTV_FLG                     = #flgOnY#
            AND PC.EFF_FROM_DT                  <![CDATA[<=]]> #slsDt#
            AND NVL(PC.EFF_THRU_DT, '99991231') <![CDATA[>=]]> #slsDt#
            AND PC.EZCANCELFLAG                 = '0'

            AND PC.GLBL_CMPY_CD                 = PCTC.GLBL_CMPY_CD
            AND PC.PRC_CONTR_PK                 = PCTC.PRC_CONTR_PK
            AND PCTC.EFF_FROM_DT                <![CDATA[<=]]> #slsDt#
            AND NVL(PCTC.EFF_THRU_DT, '99991231') <![CDATA[>=]]> #slsDt#
            AND PCTC.EZCANCELFLAG               = '0'
    </statement>
    <!-- 2016/11/01 S21_NA#15665 Add End -->

    <!-- #################### E099-1060 #################### -->
    <statement id="getHddReleaseLine" parameterClass="Map" resultClass="Map">
        SELECT
             HDD_RELEASE_TP                        AS HDD_RELEASE_TP
         ,   CONFIG_CATG_CD                        AS CONFIG_CATG_CD
         ,   CONFIG_PK                             AS DS_CPO_CONFIG_PK
         ,   POSN_NUM                              AS DS_ORD_POSN_NUM
         ,   LINE_NUM                              AS DS_CPO_LINE_NUM
         ,   LINE_SUB_NUM                          AS DS_CPO_LINE_SUB_NUM
        FROM
            (
                SELECT
                    #rmvCd#                        AS  HDD_RELEASE_TP
                 ,  DCC.CONFIG_CATG_CD             AS  CONFIG_CATG_CD
                 ,  DCC.DS_CPO_CONFIG_PK           AS  CONFIG_PK
                 ,  DCRD.DS_ORD_POSN_NUM           AS  POSN_NUM
                 ,  DCRD.DS_CPO_LINE_NUM           AS  LINE_NUM
                 ,  DCRD.DS_CPO_LINE_SUB_NUM       AS  LINE_SUB_NUM
<!-- QC8389 delete
                 ,  DCRD.DS_CPO_RTRN_LINE_NUM      AS  LINE_NUM
                 ,  DCRD.DS_CPO_RTRN_LINE_SUB_NUM  AS  LINE_SUB_NUM
-->
                FROM
                    DS_CPO_CONFIG    DCC
                 ,  DS_CPO_RTRN_DTL  DCRD
                 ,  SVC_MACH_MSTR    SMM
                WHERE
                    DCC.GLBL_CMPY_CD               =  #glblCmpyCd#
                AND DCC.CPO_ORD_NUM                =  #ordNum#
                AND DCC.EZCANCELFLAG               =  '0'

                AND DCC.GLBL_CMPY_CD               =  DCRD.GLBL_CMPY_CD
                AND DCC.DS_CPO_CONFIG_PK           =  DCRD.DS_CPO_CONFIG_PK
                AND (DCRD.HDD_RMV_CD               IS NULL
                OR   DCRD.HDD_RMV_CD               != #rmvCd#)
                AND DCRD.EZCANCELFLAG              =  '0'
                AND DCRD.RTRN_LINE_STS_CD NOT IN <!-- QC#22874 -->
                <iterate property="rtrnLineStsList" var="rtrnLineStsCd[]" open="(" close=")" conjunction=",">
                   #rtrnLineStsCd[]#
                </iterate>

                AND DCRD.GLBL_CMPY_CD              =  SMM.GLBL_CMPY_CD
                AND DCRD.SVC_MACH_MSTR_PK          =  SMM.SVC_MACH_MSTR_PK
                AND SMM.HARD_DRIVE_RMV_INCL_FLG    =  #flgY#
                AND SMM.EZCANCELFLAG               =  '0'
            )
              UNION
            (
                SELECT 
                    #eraseCd#                      AS  HDD_RELEASE_TP
                 ,  DCC.CONFIG_CATG_CD             AS  CONFIG_CATG_CD
                 ,  DCC.DS_CPO_CONFIG_PK           AS  CONFIG_PK
                 ,  DCRD.DS_ORD_POSN_NUM           AS  POSN_NUM
                 ,  DCRD.DS_CPO_LINE_NUM           AS  LINE_NUM
                 ,  DCRD.DS_CPO_LINE_SUB_NUM       AS  LINE_SUB_NUM
<!-- QC8389 delete
                 ,  DCRD.DS_CPO_RTRN_LINE_NUM      AS  LINE_NUM
                 ,  DCRD.DS_CPO_RTRN_LINE_SUB_NUM  AS  LINE_SUB_NUM
-->
                FROM
                    DS_CPO_CONFIG    DCC
                 ,  DS_CPO_RTRN_DTL  DCRD
                 ,  SVC_MACH_MSTR    SMM
                WHERE
                    DCC.GLBL_CMPY_CD               =  #glblCmpyCd#
                AND DCC.CPO_ORD_NUM                =  #ordNum#
                AND DCC.EZCANCELFLAG               =  '0'

                AND DCC.GLBL_CMPY_CD               =  DCRD.GLBL_CMPY_CD
                AND DCC.DS_CPO_CONFIG_PK           =  DCRD.DS_CPO_CONFIG_PK
                AND (DCRD.HDD_RMV_CD               IS NULL
                OR   DCRD.HDD_RMV_CD               != #eraseCd#)
                AND DCRD.RTRN_LINE_STS_CD NOT IN <!-- QC#22874 -->
                <iterate property="rtrnLineStsList" var="rtrnLineStsCd[]" open="(" close=")" conjunction=",">
                   #rtrnLineStsCd[]#
                </iterate>
                AND DCRD.EZCANCELFLAG              =  '0'
<!-- QC8389 delete
                AND SMM.HARD_DRIVE_RMV_INCL_FLG    =  #flgY#
-->
                AND DCRD.GLBL_CMPY_CD              =  SMM.GLBL_CMPY_CD
                AND DCRD.SVC_MACH_MSTR_PK          =  SMM.SVC_MACH_MSTR_PK
                AND SMM.HARD_DRIVE_ERASE_INCL_FLG  =  #flgY#
                AND SMM.EZCANCELFLAG               =  '0'
            )
    </statement>

    <!-- #################### E099-1065 #################### -->
    <statement id="getRequiredContactField" parameterClass="Map" resultClass="Map">
        SELECT 
            OCRC.FIRST_NM_REQ_FLG
         ,  OCRC.MID_NM_REQ_FLG
         ,  OCRC.LAST_NM_REQ_FLG
         ,  OCRC.EML_ADDR_REQ_FLG
         ,  OCRC.TEL_NUM_REQ_FLG
         ,  OCRC.FAX_NUM_REQ_FLG
         ,  OCRC.CELL_PHO_NUM_REQ_FLG
        FROM 
            ORD_CTAC_REQ_COND OCRC
        WHERE 
            OCRC.GLBL_CMPY_CD                  =     #glblCmpyCd#
        AND OCRC.DI_CHK_CD                     =     #diChkCd#
        AND OCRC.CTAC_TP_CD                    =     #ctacTpCd#
        AND OCRC.EFF_FROM_DT                   &lt;= #ordDt#
        AND NVL(OCRC.EFF_TO_DT, '99991231')    &gt;= #ordDt#
        AND OCRC.EZCANCELFLAG                  =     '0'
    </statement>

    <statement id="isShellRequireEmanageCtacPsn" parameterClass="Map" resultMap="Integer">
        SELECT 
            COUNT(*)
        FROM
            DS_CONTR_DTL  CNTD
        WHERE 
            CNTD.GLBL_CMPY_CD       = #glblCmpyCd#
        AND CNTD.CPO_ORD_NUM        = #ordNum#
        AND CNTD.MTR_READ_METH_CD   = #mtrReadMethCd#
        AND CNTD.EZCANCELFLAG       = '0'
        AND EXISTS ( <!-- QC#22874 -->
            SELECT
                      1
                FROM
                    CPO_DTL     CD
                WHERE
                    CD.GLBL_CMPY_CD             = CNTD.GLBL_CMPY_CD
                    AND CD.CPO_ORD_NUM          = CNTD.CPO_ORD_NUM
                    AND CD.CPO_DTL_LINE_NUM     = CNTD.CPO_DTL_LINE_NUM
                    AND CD.CPO_DTL_LINE_SUB_NUM = CNTD.CPO_DTL_LINE_SUB_NUM
                    AND CD.ORD_LINE_STS_CD NOT IN
                    <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
                       #ordLineStsCd[]#
                    </iterate>
                    AND CD.EZCANCELFLAG         = '0'
        ) 
        AND ROWNUM                  = #rowNum#
    </statement>

    <statement id="getCtacPsnDtl" parameterClass="Map" resultClass="Map">
        SELECT
            DCCP.DS_CPO_CONFIG_PK
         ,  DCCP.CTAC_PSN_FIRST_NM
         ,  DCCP.CTAC_PSN_LAST_NM
         ,  DCCP.CTAC_PSN_EML_ADDR
         ,  DCCP.CTAC_PSN_TEL_NUM
         ,  DCCP.CTAC_PSN_FAX_NUM
         ,  DCCP.CTAC_PSN_EXTN_NUM
        FROM
            DS_CPO_CTAC_PSN DCCP
        WHERE 
            DCCP.GLBL_CMPY_CD    = #glblCmpyCd#
        AND DCCP.CPO_ORD_NUM     = #ordNum#
        AND DCCP.CTAC_PSN_TP_CD  = #ctacTpCd#
        AND DCCP.EZCANCELFLAG    = '0'
        AND ( <!-- QC#22874 -->
            EXISTS (
                SELECT
                          1
                    FROM
                        CPO_DTL     CD
                    WHERE
                        CD.GLBL_CMPY_CD             = DCCP.GLBL_CMPY_CD
                        AND CD.DS_CPO_CONFIG_PK     = DCCP.DS_CPO_CONFIG_PK
                        AND CD.ORD_LINE_STS_CD NOT IN
                        <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
                           #ordLineStsCd[]#
                        </iterate>
                        AND CD.EZCANCELFLAG         = '0'
            )
            OR DCCP.DS_CPO_CONFIG_PK    IS NULL
        )
    </statement>

    <statement id="getCtacPsnDtlHdrLvl" parameterClass="Map" resultClass="Map">
        SELECT
            DCCP.DS_CPO_CONFIG_PK
         ,  DCCP.CTAC_PSN_FIRST_NM
         ,  DCCP.CTAC_PSN_LAST_NM
         ,  DCCP.CTAC_PSN_EML_ADDR
         ,  DCCP.CTAC_PSN_TEL_NUM
         ,  DCCP.CTAC_PSN_FAX_NUM
         ,  DCCP.CTAC_PSN_EXTN_NUM
        FROM
            DS_CPO_CTAC_PSN DCCP
        WHERE 
            DCCP.GLBL_CMPY_CD     = #glblCmpyCd#
        AND DCCP.CPO_ORD_NUM      = #ordNum#
        AND DCCP.CTAC_PSN_TP_CD   = #ctacTpCd#
        AND DCCP.DS_CPO_CONFIG_PK IS NULL
        AND DCCP.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getCtacPsnDtlOfConfigLvl" parameterClass="Map" resultClass="Map">
        SELECT
            DCCP.DS_CPO_CONFIG_PK
         ,  DCCP.CTAC_PSN_FIRST_NM
         ,  DCCP.CTAC_PSN_LAST_NM
         ,  DCCP.CTAC_PSN_EML_ADDR
         ,  DCCP.CTAC_PSN_TEL_NUM
         ,  DCCP.CTAC_PSN_FAX_NUM
         ,  DCCP.CTAC_PSN_EXTN_NUM
        FROM
            DS_CPO_CTAC_PSN DCCP
        WHERE 
            DCCP.GLBL_CMPY_CD     =  #glblCmpyCd#
        AND DCCP.CPO_ORD_NUM      =  #ordNum#
        AND DCCP.CTAC_PSN_TP_CD   =  #ctacTpCd#
        AND DCCP.DS_CPO_CONFIG_PK =  #cpoConfigPk#
        AND DCCP.EZCANCELFLAG     =  '0'
    </statement>

    <statement id="getLineContainSbscSprtItem" parameterClass="Map" resultClass="Map">
<!-- QC#14779-3 Del Start
        SELECT
            DCC.DS_CPO_CONFIG_PK
         ,  DCC.CONFIG_CATG_CD
         ,  DCC.DS_ORD_POSN_NUM
         ,  CD.DS_CPO_LINE_NUM
         ,  CD.DS_CPO_LINE_SUB_NUM
        FROM
            DS_CPO_CONFIG   DCC
         ,  CPO_DTL         CD
         ,  ALL_MDSE_V      AM
         ,  MDSE_TP_VAL_SET MTV
        WHERE
            DCC.GLBL_CMPY_CD         =  #glblCmpyCd#
        AND DCC.CPO_ORD_NUM          =  #ordNum#
        AND DCC.EZCANCELFLAG         =  '0'

        AND DCC.GLBL_CMPY_CD         =  CD.GLBL_CMPY_CD 
        AND DCC.DS_CPO_CONFIG_PK     =  CD.DS_CPO_CONFIG_PK
        AND CD.EZCANCELFLAG         =  '0'

        AND CD.GLBL_CMPY_CD          =  AM.GLBL_CMPY_CD
        AND CD.MDSE_CD               =  AM.MDSE_CD
        AND AM.EZCANCELFLAG          =  '0'

        AND AM.GLBL_CMPY_CD          =  MTV.GLBL_CMPY_CD
        AND AM.COA_MDSE_TP_CD        =  MTV.COA_MDSE_TP_CD
        AND MTV.MDSE_TP_CTX_TP_CD    =  #mdseTpCtxTp#
        AND MTV.EZCANCELFLAG         =  '0'
     QC#14779-3 Del End -->
<!-- QC#14779-3 Add Start -->
        SELECT
            DCC.DS_CPO_CONFIG_PK
         ,  DCC.CONFIG_CATG_CD
         ,  DCC.DS_ORD_POSN_NUM
         ,  CD.DS_CPO_LINE_NUM
         ,  CD.DS_CPO_LINE_SUB_NUM
        FROM
            DS_CPO_CONFIG   DCC
         ,  CPO_DTL         CD
         ,  MDSE            DMI
         ,  MDSE_TP_VAL_SET MTV
        WHERE
            DCC.GLBL_CMPY_CD         =  #glblCmpyCd#
        AND DCC.CPO_ORD_NUM          =  #ordNum#
        AND DCC.EZCANCELFLAG         =  '0'

        AND DCC.GLBL_CMPY_CD         =  CD.GLBL_CMPY_CD 
        AND DCC.DS_CPO_CONFIG_PK     =  CD.DS_CPO_CONFIG_PK
        AND CD.ORD_LINE_STS_CD NOT IN   <!-- QC#22874 -->
        <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
           #ordLineStsCd[]#
        </iterate>
        AND CD.EZCANCELFLAG          =  '0'

        AND CD.GLBL_CMPY_CD          =  DMI.GLBL_CMPY_CD
        AND CD.MDSE_CD               =  DMI.MDSE_CD
        AND DMI.EZCANCELFLAG         =  '0'

        AND DMI.GLBL_CMPY_CD         =  MTV.GLBL_CMPY_CD
        AND DMI.COA_MDSE_TP_CD       =  MTV.COA_MDSE_TP_CD
        AND MTV.MDSE_TP_CTX_TP_CD    =  #mdseTpCtxTp#
        AND MTV.EZCANCELFLAG         =  '0'

        UNION ALL

        SELECT
            DCC.DS_CPO_CONFIG_PK
         ,  DCC.CONFIG_CATG_CD
         ,  DCC.DS_ORD_POSN_NUM
         ,  CD.DS_CPO_LINE_NUM
         ,  CD.DS_CPO_LINE_SUB_NUM
        FROM
            DS_CPO_CONFIG   DCC
         ,  CPO_DTL         CD
         ,  ORD_TAKE_MDSE   OTM
         ,  MDSE            DMI
         ,  MDSE_TP_VAL_SET MTV
        WHERE
            DCC.GLBL_CMPY_CD         =  #glblCmpyCd#
        AND DCC.CPO_ORD_NUM          =  #ordNum#
        AND DCC.EZCANCELFLAG         =  '0'

        AND DCC.GLBL_CMPY_CD         =  CD.GLBL_CMPY_CD 
        AND DCC.DS_CPO_CONFIG_PK     =  CD.DS_CPO_CONFIG_PK
        AND CD.ORD_LINE_STS_CD NOT IN   <!-- QC#22874 -->
        <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
           #ordLineStsCd[]#
        </iterate>
        AND CD.EZCANCELFLAG          =  '0'

        AND CD.GLBL_CMPY_CD          =  OTM.GLBL_CMPY_CD
        AND CD.MDSE_CD               =  OTM.ORD_TAKE_MDSE_CD
        AND OTM.EZCANCELFLAG         =  '0'

        AND OTM.GLBL_CMPY_CD         =  DMI.GLBL_CMPY_CD
        AND OTM.MDSE_CD              =  DMI.MDSE_CD
        AND DMI.EZCANCELFLAG         =  '0'

        AND DMI.GLBL_CMPY_CD         =  MTV.GLBL_CMPY_CD
        AND DMI.COA_MDSE_TP_CD       =  MTV.COA_MDSE_TP_CD
        AND MTV.MDSE_TP_CTX_TP_CD    =  #mdseTpCtxTp#
        AND MTV.EZCANCELFLAG         =  '0'
<!-- QC#14779-3 Add End -->
    </statement>

    <statement id="getOrdTpCtacReln" parameterClass="Map" resultClass="Map">
        SELECT
            OTCR.CTAC_TP_CD
         ,  CT.CTAC_TP_DESC_TXT
        FROM
            CPO               DC
         ,  ORD_TP_CTAC_RELN  OTCR
         ,  CTAC_TP           CT
        WHERE
            DC.GLBL_CMPY_CD          =     #glblCmpyCd#
        AND DC.CPO_ORD_NUM           =     #ordNum#
        AND DC.EZCANCELFLAG          =     '0'

        AND DC.GLBL_CMPY_CD          =     OTCR.GLBL_CMPY_CD
        AND DC.DS_ORD_CATG_CD        =     OTCR.DS_ORD_CATG_CD
        AND DC.DS_ORD_TP_CD          =     OTCR.DS_ORD_TP_CD
        AND OTCR.EZCANCELFLAG        =     '0'

        AND OTCR.GLBL_CMPY_CD        =     CT.GLBL_CMPY_CD(+)
        AND OTCR.CTAC_TP_CD          =     CT.CTAC_TP_CD(+)
        AND CT.EZCANCELFLAG(+)       =     '0'
    </statement>

    <!-- Mod Start 2018/04/06 QC#24949 -->
    <statement id="getCtacValidationConfig" parameterClass="Map" resultClass="Map">
        SELECT
             DCC.CPO_ORD_NUM                 AS CPO_ORD_NUM
         ,   DCC.CONFIG_CATG_CD              AS CONFIG_CATG_CD
         ,   DCC.DS_CPO_CONFIG_PK            AS DS_CPO_CONFIG_PK
         ,   DCC.DS_ORD_POSN_NUM             AS DS_ORD_POSN_NUM
         ,   DCC.CONFIG_TP_CD                AS CONFIG_TP_CD
         ,   DCC.MDL_ID                      AS MDL_ID
         ,   DM.SVC_MDL_TP_CD                AS SVC_MDL_TP_CD
        FROM
              DS_CPO_CONFIG DCC
            , DS_MDL        DM
        WHERE
            DCC.GLBL_CMPY_CD                 = #glblCmpyCd#
        AND DCC.CPO_ORD_NUM                  = #ordNum#
        AND DCC.EZCANCELFLAG                 = '0'
        <!-- 2019/12/25 QC#54229 Add Start -->
        <isNull  property="rmaFlg">
        <!-- 2019/12/25 QC#54229 Add End -->
        AND EXISTS ( <!-- QC#22874 -->
            SELECT
                     1
                FROM
                    CPO_DTL     CD
                  <!-- START 2023/01/05 R.Azucena [QC#60974,ADD] -->
                  , ALL_MDSE_V  AMV
                  <!-- END 2023/01/05 R.Azucena [QC#60974,ADD] -->
                WHERE
                    CD.GLBL_CMPY_CD         = DCC.GLBL_CMPY_CD
                    AND CD.DS_CPO_CONFIG_PK = DCC.DS_CPO_CONFIG_PK
                    AND CD.ORD_LINE_STS_CD  NOT IN
                    <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
                       #ordLineStsCd[]#
                    </iterate>
                    AND CD.EZCANCELFLAG     = '0'
                    <!-- START 2023/01/05 R.Azucena [QC#60974,ADD] -->
                    AND AMV.GLBL_CMPY_CD    = CD.GLBL_CMPY_CD
                    AND AMV.MDSE_CD         = CD.MDSE_CD
                    AND AMV.INVTY_CTRL_FLG  = #flgY#
                    AND AMV.EZCANCELFLAG    = '0'
                    <!-- END 2023/01/05 R.Azucena [QC#60974,ADD] -->
        )
        <!-- 2019/12/25 QC#54229 Add Start -->
        </isNull>                       
        <isNotNull property="rmaFlg">
        AND EXISTS ( <!-- QC#22874 -->
            SELECT
                     1
                FROM
                    DS_CPO_RTRN_DTL     CD
                WHERE
                    CD.GLBL_CMPY_CD         = DCC.GLBL_CMPY_CD
                    AND CD.DS_CPO_CONFIG_PK = DCC.DS_CPO_CONFIG_PK
                    AND CD.RTRN_LINE_STS_CD  NOT IN
                    <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
                       #ordLineStsCd[]#
                    </iterate>
                    AND CD.EZCANCELFLAG     = '0'
        )
        </isNotNull>
        <!-- 2019/12/25 QC#54229 Add End -->
        AND DCC.MDL_ID                      = DM.MDL_ID(+)
        AND DCC.GLBL_CMPY_CD                = DM.GLBL_CMPY_CD(+)
        AND DCC.EZCANCELFLAG                = DM.EZCANCELFLAG(+)

    </statement>
    <!-- Mod End 2018/04/06 QC#24949 -->

    <!-- #################### E099-1070 #################### -->
    <statement id="getProServiceLine" parameterClass="Map" resultClass="Map">
        SELECT
            DCDV.DS_CPO_LINE_NUM
         ,  DCDV.DS_CPO_LINE_SUB_NUM
         ,  DCDV.DS_ORD_POSN_NUM
         ,  DPC.PRC_LIST_TP_CD
         ,  NVL(MTVS.FIRST_BIZ_CTX_ATTRB_NUM, 0) AS FIRST_BIZ_CTX_ATTRB_NUM
        FROM
            CPO_DTL_V         DCDV
         ,  PRC_CATG          DPC
         ,  MDSE              DMI
         ,  MDSE_TP_VAL_SET   MTVS
        WHERE
            DCDV.GLBL_CMPY_CD        =  #glblCmpyCd#
        AND DCDV.CPO_ORD_NUM         =  #ordNum#
        AND DCDV.EZCANCELFLAG        =  '0'

        AND DCDV.GLBL_CMPY_CD        =  DPC.GLBL_CMPY_CD
        AND DCDV.PRC_CATG_CD         =  DPC.PRC_CATG_CD
        AND DPC.EZCANCELFLAG         =  '0'

        AND DCDV.GLBL_CMPY_CD        =  DMI.GLBL_CMPY_CD
        AND DCDV.MDSE_CD             =  DMI.MDSE_CD
        AND DMI.EZCANCELFLAG         =  '0'

        AND DMI.GLBL_CMPY_CD         =  MTVS.GLBL_CMPY_CD
        AND DMI.COA_MDSE_TP_CD       =  MTVS.COA_MDSE_TP_CD
        AND MTVS.MDSE_TP_CTX_TP_CD   =  #mdseTpCtxTp#
        AND MTVS.EZCANCELFLAG        =  '0'

        UNION ALL

        SELECT
            DCDV.DS_CPO_LINE_NUM
         ,  DCDV.DS_CPO_LINE_SUB_NUM
         ,  DCDV.DS_ORD_POSN_NUM
         ,  DPC.PRC_LIST_TP_CD
         ,  NVL(MTVS.FIRST_BIZ_CTX_ATTRB_NUM, 0) AS FIRST_BIZ_CTX_ATTRB_NUM
        FROM
            CPO_DTL_V         DCDV
         ,  PRC_CATG          DPC
         ,  ORD_TAKE_MDSE     OTM
         ,  MDSE              DMI
         ,  MDSE_TP_VAL_SET   MTVS
        WHERE
            DCDV.GLBL_CMPY_CD        =  #glblCmpyCd#
        AND DCDV.CPO_ORD_NUM         =  #ordNum#
        AND DCDV.EZCANCELFLAG        =  '0'

        AND DCDV.GLBL_CMPY_CD        =  DPC.GLBL_CMPY_CD
        AND DCDV.PRC_CATG_CD         =  DPC.PRC_CATG_CD
        AND DPC.EZCANCELFLAG         =  '0'

        AND DCDV.GLBL_CMPY_CD        =  OTM.GLBL_CMPY_CD
        AND DCDV.MDSE_CD             =  OTM.ORD_TAKE_MDSE_CD
        AND OTM.EZCANCELFLAG         =  '0'  

        AND OTM.GLBL_CMPY_CD         =  DMI.GLBL_CMPY_CD
        AND OTM.MDSE_CD              =  DMI.MDSE_CD
        AND DMI.EZCANCELFLAG         =  '0'
        
        AND DMI.GLBL_CMPY_CD         =  MTVS.GLBL_CMPY_CD
        AND DMI.COA_MDSE_TP_CD       =  MTVS.COA_MDSE_TP_CD
        AND MTVS.MDSE_TP_CTX_TP_CD   =  #mdseTpCtxTp#
        AND MTVS.EZCANCELFLAG        =  '0'
    </statement>

<!-- QC8549 delete
    <statement id="getOrdTotalGpPercent" parameterClass="Map" resultMap="BigDecimal">
        SELECT
            OP.GRS_PRFT_PCT
        FROM
            ORD_PRFT OP
        WHERE
            OP.TRX_HDR_NUM       =  #ordNum#
        AND OP.GLBL_CMPY_CD      =  #glblCmpyCd#
        AND OP.EZCANCELFLAG      =  '0'
        AND OP.ORD_PRFT_VRSN_NUM = 
            (
                SELECT
                    MAX(OP2.ORD_PRFT_VRSN_NUM)
                FROM
                    ORD_PRFT OP2
                WHERE
                    OP2.GLBL_CMPY_CD  =  #glblCmpyCd#
                AND OP2.TRX_HDR_NUM   =  #ordNum#
                AND OP2.EZCANCELFLAG  =  '0'
            )
    </statement>
-->

    <!-- #################### E099-1085 #################### -->
    <statement id="getDiffShipToCustLine" parameterClass="Map" resultClass="Map">
        SELECT 
            DCRD.DS_ORD_POSN_NUM            AS  DS_ORD_POSN_NUM
         ,  DCRD.DS_CPO_LINE_NUM            AS  DS_CPO_LINE_NUM
         ,  DCRD.DS_CPO_LINE_SUB_NUM        AS  DS_CPO_LINE_SUB_NUM
<!-- QC8389 delete
         ,  DCRD.DS_CPO_RTRN_LINE_NUM       AS  DS_CPO_RTRN_LINE_NUM
         ,  DCRD.DS_CPO_RTRN_LINE_SUB_NUM   AS  DS_CPO_RTRN_LINE_SUB_NUM
-->
         ,  DCRD.SHIP_TO_CUST_CD            AS  RTRN_SHIP_TO_CUST_CD
         ,  SMM.CUR_LOC_NUM                 AS  SMM_SHIP_TO_CUST_CD
         <!-- 2018/10/17 QC#28370 Add Start -->
         ,  DCC.DS_CPO_CONFIG_PK            AS  DS_CPO_CONFIG_PK
         <!-- 2018/10/17 QC#28370 Add End -->

         FROM
            DS_CPO_RTRN_DTL  DCRD
         ,  DS_CPO_CONFIG    DCC
         ,  SVC_MACH_MSTR    SMM
        WHERE
            DCRD.GLBL_CMPY_CD        =  #glblCmpyCd#
        AND DCRD.CPO_ORD_NUM         =  #ordNum#
        AND DCRD.EZCANCELFLAG        =  '0'

        AND DCRD.GLBL_CMPY_CD        =  DCC.GLBL_CMPY_CD
        AND DCRD.DS_CPO_CONFIG_PK    =  DCC.DS_CPO_CONFIG_PK
        AND DCC.EZCANCELFLAG         =  '0'

        AND DCRD.GLBL_CMPY_CD        =  SMM.GLBL_CMPY_CD
        AND SMM.SVC_MACH_MSTR_STS_CD IN   <!-- 2019/04/02 S21_NA#31019 Add -->
        <iterate property="svcMachMstrStsList" var="svcMachMstrStsCd[]" open="(" close=")" conjunction=",">
           #svcMachMstrStsCd[]#
        </iterate>
        AND DCRD.SVC_MACH_MSTR_PK    =  SMM.SVC_MACH_MSTR_PK
        AND SMM.EZCANCELFLAG         =  '0'

        AND DCC.GLBL_CMPY_CD         =  SMM.GLBL_CMPY_CD
        AND DCC.SHIP_TO_CUST_LOC_CD  != SMM.CUR_LOC_NUM
    </statement>

    <!-- #################### E099-1090 #################### S21_NA#2391 Modified -->
    <statement id="getDupicateRmaLine" parameterClass="Map" resultClass="Map">
       SELECT 
            DCR.SER_NUM
         ,  DCR.SVC_CONFIG_MSTR_PK
         ,  DCR.CPO_ORD_NUM
       FROM 
            DS_CPO_RTRN_DTL DCR
         ,  SVC_MACH_MSTR   SMM
         ,  CPO             CP
       WHERE
            DCR.GLBL_CMPY_CD           =  #glblCmpyCd#
       AND  DCR.CPO_ORD_NUM            != #ordNum#
            <isNotNull property="configMstrPk">
                <isNotNull property="serNum">
                    AND ( DCR.SVC_CONFIG_MSTR_PK   =  #configMstrPk#
                    OR
                    <!-- 2017/02/28 QC#16575 UPD START  -->
                    (DCR.SER_NUM              =  #serNum#
                    <isNotNull property="mdseCd">
                    AND DCR.MDSE_CD          LIKE #mdseCd# || '%'
                    </isNotNull>
                    ))
                    <!-- 2017/02/28 QC#16575 UPD E N D  -->
                </isNotNull>
            </isNotNull>
            <isNotNull property="configMstrPk">
                <isNull property="serNum">
                    AND DCR.SVC_CONFIG_MSTR_PK   =  #configMstrPk#
                </isNull>
            </isNotNull>
            <isNull property="configMstrPk">
                <isNotNull property="serNum">
                    AND DCR.SER_NUM              =  #serNum#
                    <!-- 2017/02/28 QC#16575 ADD START  -->
                    <isNotNull property="mdseCd">
                    AND DCR.MDSE_CD          LIKE #mdseCd# || '%'
                    </isNotNull>
                    <!-- 2017/02/28 QC#16575 ADD E N D  -->
                </isNotNull>
            </isNull>
       AND  DCR.EZCANCELFLAG           =  '0'

       AND  DCR.GLBL_CMPY_CD           =  SMM.GLBL_CMPY_CD
       AND  DCR.SVC_MACH_MSTR_PK       =  SMM.SVC_MACH_MSTR_PK
       AND  SMM.SVC_MACH_USG_STS_CD    =  #svcMachUsgStsCd#
       AND  SMM.EZCANCELFLAG           =  '0'

       AND  DCR.GLBL_CMPY_CD           =  CP.GLBL_CMPY_CD
       AND  DCR.CPO_ORD_NUM            =  CP.CPO_ORD_NUM
       AND  CP.OPEN_FLG                =  #flgY#
       AND  CP.EZCANCELFLAG            =  '0'
    </statement>

    <!-- #################### E099-IT01 #################### -->
    <statement id="getDiffModelLine" parameterClass="Map" resultClass="Map">
        SELECT 
            DCD.DS_ORD_POSN_NUM
         ,  DCD.DS_CPO_LINE_NUM
         ,  DCD.DS_CPO_LINE_SUB_NUM
         ,  DCC.DCLN_SVC_CD
         <!-- 2018/10/17 QC#28370 Add Start -->
         ,  CNTD.SHELL_LINE_NUM
         <!-- 2018/10/17 QC#28370 Add End -->
        FROM
            CPO_DTL             DCD
         ,  DS_CPO_CONFIG       DCC
         ,  DS_CONTR_DTL        CNTD
        WHERE
            DCD.GLBL_CMPY_CD          =  #glblCmpyCd#
        AND DCD.CPO_ORD_NUM           =  #ordNum#
        AND DCD.EZCANCELFLAG          =  '0'

        AND DCD.GLBL_CMPY_CD          =  CNTD.GLBL_CMPY_CD
        AND DCD.CPO_ORD_NUM           =  CNTD.CPO_ORD_NUM
        AND DCD.CPO_DTL_LINE_NUM      =  CNTD.CPO_DTL_LINE_NUM
        AND DCD.CPO_DTL_LINE_SUB_NUM  =  CNTD.CPO_DTL_LINE_SUB_NUM
        AND CNTD.EZCANCELFLAG         =  '0'

        AND DCD.GLBL_CMPY_CD          =  DCC.GLBL_CMPY_CD
        AND DCD.DS_CPO_CONFIG_PK      =  DCC.DS_CPO_CONFIG_PK
        AND DCC.EZCANCELFLAG          =  '0'
        AND EXISTS (   <!-- QC#22874 -->
            SELECT
                      1
                FROM
                    CPO_DTL     CD
                WHERE
                    CD.GLBL_CMPY_CD            = DCC.GLBL_CMPY_CD
                    AND CD.DS_CPO_CONFIG_PK    = DCC.DS_CPO_CONFIG_PK
                    AND CD.ORD_LINE_STS_CD   NOT IN
                    <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
                       #ordLineStsCd[]#
                    </iterate>
                    AND CD.EZCANCELFLAG        = '0'
        ) 

        AND DCC.MDL_ID                != CNTD.MDL_ID
    </statement>

    <!-- #################### E099-IT02 #################### -->
    <statement id="getAuthAndConfigInfo" parameterClass="Map" resultClass="Map">
<!-- QC#14779-3 Del Start
        SELECT
            CD.DS_ORD_POSN_NUM
          , CD.DS_CPO_LINE_NUM
          , CD.DS_CPO_LINE_SUB_NUM
          , DDA.SLS_AUTH_FLG
          , DDA.SVC_AUTH_FLG
          , DDA.MKT_MDL_CD
          , AMV.MKT_MDL_CD M_MKT_MDL_CD
          , NVL(
                 (
                    SELECT
                        #flgY#
                    FROM
                        DS_MDL_CONFIG DMC
                    WHERE
                        DMC.GLBL_CMPY_CD     =  CD.GLBL_CMPY_CD
                    AND DMC.PRNT_MDSE_CD     =  CD.MDSE_CD
                    AND DMC.EZCANCELFLAG     =     '0'
                  UNION
                    SELECT
                        #flgY#
                    FROM
                        DS_MDL_CONFIG DMC
                     ,  ORD_TAKE_MDSE OTM
                    WHERE
                        OTM.GLBL_CMPY_CD     =  CD.GLBL_CMPY_CD
                    AND OTM.MDSE_CD          =  CD.MDSE_CD
                    AND OTM.EZCANCELFLAG     =     '0'
                    AND DMC.GLBL_CMPY_CD     =  OTM.GLBL_CMPY_CD
                    AND DMC.PRNT_MDSE_CD     =  OTM.ORD_TAKE_MDSE_CD 
                    AND DMC.EZCANCELFLAG     =     '0'
                 )
              , #flgN#
            )  CONFIG_FLG
        from
            CPO_DTL           CD
         ,  ALL_MDSE_V        AMV
         ,  DS_DLR_AUTH_INFO  DDA
        WHERE 
            CD.GLBL_CMPY_CD           =     #glblCmpyCd#
        AND CD.CPO_ORD_NUM            =     #ordNum#
        AND CD.EZCANCELFLAG           =     '0'

        AND CD.GLBL_CMPY_CD           =     AMV.GLBL_CMPY_CD
        AND CD.MDSE_CD                =     AMV.MDSE_CD
        AND AMV.EZCANCELFLAG          =     '0'

        AND AMV.GLBL_CMPY_CD          =     DDA.GLBL_CMPY_CD(+)
        AND AMV.MKT_MDL_CD            =     DDA.MKT_MDL_CD(+)
        AND DDA.DS_ACCT_CUST_NUM(+)   =     #dsAcctNum#
        AND DDA.EFF_FROM_DT(+)        &lt;= #slsDt#
        AND
            (
                DDA.EFF_THRU_DT       &gt;= #slsDt#
            OR
                DDA.EFF_THRU_DT       IS    NULL
            )
        AND DDA.EZCANCELFLAG(+)       =     '0'
     QC#14779-3 Del End -->
<!-- QC#14779-3 Add Start -->
        SELECT
            CD.DS_ORD_POSN_NUM
          , CD.DS_CPO_LINE_NUM
          , CD.DS_CPO_LINE_SUB_NUM
          , DDA.SLS_AUTH_FLG
          , DDA.SVC_AUTH_FLG
          , DDA.MKT_MDL_CD
          , DMI.MKT_MDL_CD M_MKT_MDL_CD
          , NVL(
                 (
                    SELECT
                        #flgY#
                    FROM
                        DS_MDL_CONFIG DMC
                    WHERE
                        DMC.GLBL_CMPY_CD     =  CD.GLBL_CMPY_CD
                    AND DMC.PRNT_MDSE_CD     =  CD.MDSE_CD
                    AND DMC.EZCANCELFLAG     =  '0'
                  UNION
                    SELECT
                        #flgY#
                    FROM
                        DS_MDL_CONFIG DMC
                     ,  ORD_TAKE_MDSE OTM
                    WHERE
                        OTM.GLBL_CMPY_CD     =  CD.GLBL_CMPY_CD
                    AND OTM.MDSE_CD          =  CD.MDSE_CD
                    AND OTM.EZCANCELFLAG     =  '0'
                    AND DMC.GLBL_CMPY_CD     =  OTM.GLBL_CMPY_CD
                    AND DMC.PRNT_MDSE_CD     =  OTM.ORD_TAKE_MDSE_CD 
                    AND DMC.EZCANCELFLAG     =  '0'
                 )
              , #flgN#
            )  CONFIG_FLG
        FROM
            CPO_DTL           CD
         ,  MDSE              DMI
         ,  DS_DLR_AUTH_INFO  DDA
        WHERE 
            CD.GLBL_CMPY_CD           =     #glblCmpyCd#
        AND CD.CPO_ORD_NUM            =     #ordNum#
        AND CD.EZCANCELFLAG           =     '0'

        AND CD.GLBL_CMPY_CD           =     DMI.GLBL_CMPY_CD
        AND CD.MDSE_CD                =     DMI.MDSE_CD
        AND DMI.EZCANCELFLAG          =     '0'

        AND DMI.GLBL_CMPY_CD          =     DDA.GLBL_CMPY_CD(+)
        AND DMI.MKT_MDL_CD            =     DDA.MKT_MDL_CD(+)
        AND DDA.DS_ACCT_CUST_NUM(+)   =     #dsAcctNum#
        AND DDA.EFF_FROM_DT(+)        &lt;= #slsDt#
        AND
            (
                DDA.EFF_THRU_DT(+)    &gt;= #slsDt#
            OR
                DDA.EFF_THRU_DT(+)    IS    NULL
            )
        AND DDA.EZCANCELFLAG(+)       =     '0'

        UNION ALL

        SELECT
            CD.DS_ORD_POSN_NUM
          , CD.DS_CPO_LINE_NUM
          , CD.DS_CPO_LINE_SUB_NUM
          , DDA.SLS_AUTH_FLG
          , DDA.SVC_AUTH_FLG
          , DDA.MKT_MDL_CD
          , DMI.MKT_MDL_CD M_MKT_MDL_CD
          , NVL(
                 (
                    SELECT
                        #flgY#
                    FROM
                        DS_MDL_CONFIG DMC
                    WHERE
                        DMC.GLBL_CMPY_CD     =  CD.GLBL_CMPY_CD
                    AND DMC.PRNT_MDSE_CD     =  CD.MDSE_CD
                    AND DMC.EZCANCELFLAG     =  '0'
                  UNION
                    SELECT
                        #flgY#
                    FROM
                        DS_MDL_CONFIG DMC
                     ,  ORD_TAKE_MDSE OTM
                    WHERE
                        OTM.GLBL_CMPY_CD     =  CD.GLBL_CMPY_CD
                    AND OTM.MDSE_CD          =  CD.MDSE_CD
                    AND OTM.EZCANCELFLAG     =  '0'
                    AND DMC.GLBL_CMPY_CD     =  OTM.GLBL_CMPY_CD
                    AND DMC.PRNT_MDSE_CD     =  OTM.ORD_TAKE_MDSE_CD 
                    AND DMC.EZCANCELFLAG     =  '0'
                 )
              , #flgN#
            )  CONFIG_FLG
        FROM
            CPO_DTL           CD
         ,  ORD_TAKE_MDSE     OTM
         ,  MDSE              DMI
         ,  DS_DLR_AUTH_INFO  DDA
        WHERE 
            CD.GLBL_CMPY_CD           =     #glblCmpyCd#
        AND CD.CPO_ORD_NUM            =     #ordNum#
        AND CD.EZCANCELFLAG           =     '0'

        AND CD.GLBL_CMPY_CD           =     OTM.GLBL_CMPY_CD
        AND CD.MDSE_CD                =     OTM.ORD_TAKE_MDSE_CD
        AND OTM.EZCANCELFLAG          =     '0'

        AND OTM.GLBL_CMPY_CD          =     DMI.GLBL_CMPY_CD
        AND OTM.MDSE_CD               =     DMI.MDSE_CD
        AND DMI.EZCANCELFLAG          =     '0'

        AND DMI.GLBL_CMPY_CD          =     DDA.GLBL_CMPY_CD(+)
        AND DMI.MKT_MDL_CD            =     DDA.MKT_MDL_CD(+)
        AND DDA.DS_ACCT_CUST_NUM(+)   =     #dsAcctNum#
        AND DDA.EFF_FROM_DT(+)        &lt;= #slsDt#
        AND
            (
                DDA.EFF_THRU_DT(+)    &gt;= #slsDt#
            OR
                DDA.EFF_THRU_DT(+)    IS    NULL
            )
        AND DDA.EZCANCELFLAG(+)       =     '0'
<!-- QC#14779-3 Add End -->
    </statement>

    <!-- #################### Accepted Check Serch #################### -->
    <statement id="getMaxVrsnNum" parameterClass="Map" resultMap="String">
        SELECT
            MAX(HDR.DI_CHK_VRSN_NUM)
        FROM
            DS_CPO_DI_CHK_RSLT_HDR   HDR
        WHERE
            HDR.GLBL_CMPY_CD         = #glblCmpyCd#
        AND HDR.CPO_ORD_NUM          = #ordNum#
        AND HDR.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getVrsnNumPresencePrev" parameterClass="Map" resultClass="Map">
        SELECT HDR.DI_CHK_VRSN_NUM 
        FROM 
            DS_CPO_DI_CHK_RSLT_HDR   HDR
        WHERE 
            HDR.GLBL_CMPY_CD         = #glblCmpyCd#
        AND HDR.CPO_ORD_NUM          = #ordNum#
        AND HDR.DI_CHK_VRSN_NUM      = #vrsnNum#
        AND HDR.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getAcceptRsltForPrev" parameterClass="Map" resultClass="Map">
        SELECT 
            DTL.DI_CHK_CD
          , DTL.DI_CHK_LVL_CD
          , DTL.DI_CHK_DTL_STS_CD
          , DTL.DI_CHK_ERR_TXT
          , DTL.DI_ERR_CPO_CONFIG_PK
          , DTL.DI_ERR_CONFIG_CATG_CD
          , DTL.DI_ERR_ORD_POSN_NUM
          , DTL.DI_ERR_CPO_LINE_NUM
          , DTL.DI_ERR_CPO_LINE_SUB_NUM
        FROM 
            DS_CPO_DI_CHK_RSLT_HDR        HDR, 
            DS_CPO_DI_CHK_RSLT_DTL        DTL
        WHERE 
            HDR.GLBL_CMPY_CD              = #glblCmpyCd#
        AND HDR.CPO_ORD_NUM               = #ordNum#
        AND HDR.DI_CHK_VRSN_NUM           = #vrsnNum#
        AND HDR.EZCANCELFLAG              = '0'

        AND HDR.GLBL_CMPY_CD              = DTL.GLBL_CMPY_CD
        AND HDR.DS_CPO_DI_CHK_RSLT_HDR_PK = DTL.DS_CPO_DI_CHK_RSLT_HDR_PK
        AND DTL.DI_CHK_DTL_STS_CD         = #diChkDtlStsCd#
        AND DTL.EZCANCELFLAG              = '0'
    </statement>

    <!-- S21_NA8549 copied from "Profitability Review" -->
    <statement id="getPrftCalcInfoForOrder" parameterClass="Map" resultClass="Map">
        SELECT
                  V.*
            FROM
                (
                 SELECT
                           C.GLBL_CMPY_CD
                         , C.ORD_HDR_STS_CD
                         , LC.DS_ORD_LINE_DRCTN_CD
                         , C.DS_ORD_CATG_CD
                         , C.DS_ORD_TP_CD
                         , C.DS_ORD_RSN_CD
                         , C.PRC_BASE_DT
                         , C.PRC_CALC_DT
                         , C.NEGO_DEAL_AMT
                         , C.CSMP_CONTR_NUM
                         , C.DLR_REF_NUM
                         , CD.CPO_DTL_LINE_NUM           TRX_LINE_NUM
                         , CD.CPO_DTL_LINE_SUB_NUM       TRX_LINE_SUB_NUM
                         , CD.DS_ORD_POSN_NUM
                         , CD.DS_CPO_LINE_NUM
                         , CD.DS_CPO_LINE_SUB_NUM
                         , CD.MDSE_CD
                         , CD.RTL_WH_CD
                         , CD.RTL_SWH_CD
                         , CD.DS_ORD_LINE_CATG_CD
                         , CD.ORD_QTY
                         , CD.CUST_UOM_CD
                         , CD.REF_CPO_DTL_LINE_NUM
                         , CD.REF_CPO_DTL_LINE_SUB_NUM
                         , CD.FL_PRC_LIST_CD
                         , CD.FUNC_PRC_LIST_PRC_AMT
                         , CD.ENT_FUNC_NET_UNIT_PRC_AMT  FUNC_NET_UNIT_PRC_AMT
                         , CD.CPO_DTL_FUNC_NET_AMT       FUNC_NET_AMT
                         , CD.FUNC_MAN_FL_ADJ_AMT
                         , CD.FUNC_SVC_COST_TRNSF_AMT
                         , CD.FUNC_MAN_REP_REV_ADJ_AMT
                         , CD.FUNC_SVC_REV_TRNSF_AMT
                         , DCC.CONFIG_CATG_CD
                         , #ordPrftTrxCatgOutBound#      ORD_PRFT_TRX_CATG_CD
                         , CD.CSMP_PRC_LIST_CD
                         , CD.CPO_DTL_FUNC_NET_AMT       CPO_DTL_FUNC_SLS_AMT
                         , CD.ORD_CUST_UOM_QTY
                         , CD.CSMP_CONTR_NUM             DTL_CSMP_CONTR_NUM
                         , CD.DLR_REF_NUM                DTL_DLR_REF_NUM
                         , CD.PRC_CATG_CD
                         , CP.COA_PROJ_NM AS COA_MDSE_TP_NM
                         , CD.ORD_LINE_STS_CD            LINE_STS_CD
                         , C.BILL_TO_CUST_CD
                         , C.SELL_TO_CUST_CD
                         , CD.SHIP_TO_CUST_CD
                         , DCC.BILL_TO_CUST_ACCT_CD
                         , DCC.BILL_TO_CUST_LOC_CD
                         , DCC.SHIP_TO_CUST_ACCT_CD
                         , DCC.SHIP_TO_CUST_LOC_CD
                         , M.THIS_MTH_TOT_STD_COST_AMT
                     FROM
                         CPO                 C
                         , CPO_DTL           CD
                         , DS_CPO_CONFIG     DCC
                         , DS_ORD_LINE_CATG  LC
                         , MDSE              M
                         , COA_PROJ          CP
                     WHERE
                             C.GLBL_CMPY_CD          = #glblCmpyCd#
                         AND C.CPO_ORD_NUM           = #trxHdrNum#
                         AND C.EZCANCELFLAG          = '0'

                         AND C.GLBL_CMPY_CD          = CD.GLBL_CMPY_CD
                         AND C.CPO_ORD_NUM           = CD.CPO_ORD_NUM
                         AND CD.CPO_DTL_CANC_FLG     = 'N'
                         AND CD.SET_MDSE_CD          IS NULL
                         AND CD.EZCANCELFLAG         = '0'

                         AND CD.GLBL_CMPY_CD         = LC.GLBL_CMPY_CD
                         AND CD.DS_ORD_LINE_CATG_CD  = LC.DS_ORD_LINE_CATG_CD
                         AND LC.EZCANCELFLAG         = '0'

                         AND CD.GLBL_CMPY_CD         = DCC.GLBL_CMPY_CD
                         AND CD.CPO_ORD_NUM          = DCC.CPO_ORD_NUM
                         AND CD.DS_ORD_POSN_NUM      = DCC.DS_ORD_POSN_NUM
                         AND DCC.CONFIG_CATG_CD      = #outBound#
                         AND DCC.EZCANCELFLAG        = '0'

                         AND CD.GLBL_CMPY_CD         = M.GLBL_CMPY_CD
                         AND CD.MDSE_CD              = M.MDSE_CD
                         AND M.EZCANCELFLAG          = '0'

                         AND M.GLBL_CMPY_CD          = CP.GLBL_CMPY_CD
                         AND M.COA_MDSE_TP_CD        = CP.COA_PROJ_CD
                         AND CP.EZCANCELFLAG         = '0'
                 UNION ALL
                 SELECT
                           C.GLBL_CMPY_CD
                         , C.ORD_HDR_STS_CD
                         , LC.DS_ORD_LINE_DRCTN_CD
                         , C.DS_ORD_CATG_CD
                         , C.DS_ORD_TP_CD
                         , C.DS_ORD_RSN_CD
                         , C.PRC_BASE_DT
                         , C.PRC_CALC_DT
                         , C.NEGO_DEAL_AMT
                         , C.CSMP_CONTR_NUM
                         , C.DLR_REF_NUM
                         , CD.CPO_DTL_LINE_NUM           TRX_LINE_NUM
                         , CD.CPO_DTL_LINE_SUB_NUM       TRX_LINE_SUB_NUM
                         , CD.DS_ORD_POSN_NUM
                         , CD.DS_CPO_LINE_NUM
                         , CD.DS_CPO_LINE_SUB_NUM
                         , CD.MDSE_CD
                         , CD.RTL_WH_CD
                         , CD.RTL_SWH_CD
                         , CD.DS_ORD_LINE_CATG_CD
                         , CD.ORD_QTY
                         , CD.CUST_UOM_CD
                         , CD.REF_CPO_DTL_LINE_NUM
                         , CD.REF_CPO_DTL_LINE_SUB_NUM
                         , CD.FL_PRC_LIST_CD
                         , CD.FUNC_PRC_LIST_PRC_AMT
                         , CD.ENT_FUNC_NET_UNIT_PRC_AMT  FUNC_NET_UNIT_PRC_AMT
                         , CD.CPO_DTL_FUNC_NET_AMT       FUNC_NET_AMT
                         , CD.FUNC_MAN_FL_ADJ_AMT
                         , CD.FUNC_SVC_COST_TRNSF_AMT
                         , CD.FUNC_MAN_REP_REV_ADJ_AMT
                         , CD.FUNC_SVC_REV_TRNSF_AMT
                         , DCC.CONFIG_CATG_CD
                         , #ordPrftTrxCatgOutBound#      ORD_PRFT_TRX_CATG_CD
                         , CD.CSMP_PRC_LIST_CD
                         , CD.CPO_DTL_FUNC_NET_AMT       CPO_DTL_FUNC_SLS_AMT
                         , CD.ORD_CUST_UOM_QTY
                         , CD.CSMP_CONTR_NUM             DTL_CSMP_CONTR_NUM
                         , CD.DLR_REF_NUM                DTL_DLR_REF_NUM
                         , CD.PRC_CATG_CD
                         , CP.COA_PROJ_NM AS COA_MDSE_TP_NM
                         , CD.ORD_LINE_STS_CD            LINE_STS_CD
                         , C.BILL_TO_CUST_CD
                         , C.SELL_TO_CUST_CD
                         , CD.SHIP_TO_CUST_CD
                         , DCC.BILL_TO_CUST_ACCT_CD
                         , DCC.BILL_TO_CUST_LOC_CD
                         , DCC.SHIP_TO_CUST_ACCT_CD
                         , DCC.SHIP_TO_CUST_LOC_CD
                         , M.THIS_MTH_TOT_STD_COST_AMT
                     FROM
                         CPO                 C
                         , CPO_DTL           CD
                         , DS_CPO_CONFIG     DCC
                         , DS_ORD_LINE_CATG  LC
                         , ORD_TAKE_MDSE     OTM
                         , MDSE              M
                         , COA_PROJ          CP
                     WHERE
                             C.GLBL_CMPY_CD          = #glblCmpyCd#
                         AND C.CPO_ORD_NUM           = #trxHdrNum#
                         AND C.EZCANCELFLAG          = '0'

                         AND C.GLBL_CMPY_CD          = CD.GLBL_CMPY_CD
                         AND C.CPO_ORD_NUM           = CD.CPO_ORD_NUM
                         AND CD.CPO_DTL_CANC_FLG     = 'N'
                         AND CD.SET_MDSE_CD          IS NULL
                         AND CD.EZCANCELFLAG         = '0'

                         AND CD.GLBL_CMPY_CD         = LC.GLBL_CMPY_CD
                         AND CD.DS_ORD_LINE_CATG_CD  = LC.DS_ORD_LINE_CATG_CD
                         AND LC.EZCANCELFLAG         = '0'

                         AND CD.GLBL_CMPY_CD         = DCC.GLBL_CMPY_CD
                         AND CD.CPO_ORD_NUM          = DCC.CPO_ORD_NUM
                         AND CD.DS_ORD_POSN_NUM      = DCC.DS_ORD_POSN_NUM
                         AND DCC.CONFIG_CATG_CD      = #outBound#
                         AND DCC.EZCANCELFLAG        = '0'

                         AND CD.GLBL_CMPY_CD         = OTM.GLBL_CMPY_CD
                         AND CD.MDSE_CD              = OTM.ORD_TAKE_MDSE_CD
                         AND OTM.EZCANCELFLAG        = '0'

                         AND OTM.GLBL_CMPY_CD        = M.GLBL_CMPY_CD
                         AND OTM.MDSE_CD             = M.MDSE_CD
                         AND M.EZCANCELFLAG          = '0'

                         AND M.GLBL_CMPY_CD          = CP.GLBL_CMPY_CD
                         AND M.COA_MDSE_TP_CD        = CP.COA_PROJ_CD
                         AND CP.EZCANCELFLAG         = '0'
                 UNION ALL
                 SELECT
                           C.GLBL_CMPY_CD
                         , C.ORD_HDR_STS_CD
                         , LC.DS_ORD_LINE_DRCTN_CD
                         , C.DS_ORD_CATG_CD
                         , C.DS_ORD_TP_CD
                         , C.DS_ORD_RSN_CD
                         , C.PRC_BASE_DT
                         , C.PRC_CALC_DT
                         , C.NEGO_DEAL_AMT
                         , C.CSMP_CONTR_NUM
                         , C.DLR_REF_NUM
                         , DCRD.DS_CPO_RTRN_LINE_NUM         TRX_LINE_NUM
                         , DCRD.DS_CPO_RTRN_LINE_SUB_NUM     TRX_LINE_SUB_NUM
                         , DCRD.DS_ORD_POSN_NUM
                         , DCRD.DS_CPO_LINE_NUM
                         , DCRD.DS_CPO_LINE_SUB_NUM
                         , DCRD.MDSE_CD
                         , DCRD.RTL_WH_CD
                         , DCRD.RTL_SWH_CD
                         , DCRD.DS_ORD_LINE_CATG_CD
                         , DCRD.ORD_QTY
                         , DCRD.CUST_UOM_CD
                         , DCRD.REF_CPO_DTL_LINE_NUM
                         , DCRD.REF_CPO_DTL_LINE_SUB_NUM
                         , DCRD.FL_PRC_LIST_CD
                         , DCRD.FUNC_PRC_LIST_PRC_AMT
                         , DCRD.ENT_FUNC_NET_UNIT_PRC_AMT    FUNC_NET_UNIT_PRC_AMT
                         , DCRD.CPO_DTL_FUNC_NET_AMT         FUNC_NET_AMT
                         , DCRD.FUNC_MAN_FL_ADJ_AMT
                         , DCRD.FUNC_SVC_COST_TRNSF_AMT
                         , DCRD.FUNC_MAN_REP_REV_ADJ_AMT
                         , DCRD.FUNC_SVC_REV_TRNSF_AMT
                         , DCC.CONFIG_CATG_CD
                         , #ordPrftTrxCatgInBound#           ORD_PRFT_TRX_CATG_CD
                         , DCRD.CSMP_PRC_LIST_CD
                         , DCRD.CPO_DTL_FUNC_NET_AMT         CPO_DTL_FUNC_SLS_AMT
                         , DCRD.ORD_CUST_UOM_QTY
                         , DCRD.CSMP_CONTR_NUM               DTL_CSMP_CONTR_NUM
                         , DCRD.DLR_REF_NUM                  DTL_DLR_REF_NUM
                         , DCRD.PRC_CATG_CD
                         , CP.COA_PROJ_NM AS COA_MDSE_TP_NM
                         , DCRD.RTRN_LINE_STS_CD             LINE_STS_CD
                         , C.BILL_TO_CUST_CD
                         , C.SELL_TO_CUST_CD
                         , DCRD.SHIP_TO_CUST_CD
                         , DCC.BILL_TO_CUST_ACCT_CD
                         , DCC.BILL_TO_CUST_LOC_CD
                         , DCC.SHIP_TO_CUST_ACCT_CD
                         , DCC.SHIP_TO_CUST_LOC_CD
                         , M.THIS_MTH_TOT_STD_COST_AMT
                     FROM
                         CPO C
                         , DS_CPO_RTRN_DTL  DCRD
                         , DS_CPO_CONFIG    DCC
                         , DS_ORD_LINE_CATG LC
                         , MDSE             M
                         , COA_PROJ         CP
                     WHERE
                         C.GLBL_CMPY_CD               = #glblCmpyCd#
                         AND C.CPO_ORD_NUM            = #trxHdrNum#
                         AND C.EZCANCELFLAG           = '0'

                         AND C.GLBL_CMPY_CD           = DCRD.GLBL_CMPY_CD
                         AND C.CPO_ORD_NUM            = DCRD.CPO_ORD_NUM
                         AND DCRD.CPO_DTL_CANC_FLG    = 'N'
                         AND DCRD.SET_MDSE_CD         IS NULL
                         AND DCRD.EZCANCELFLAG        = '0'

                         AND DCC.GLBL_CMPY_CD         = DCRD.GLBL_CMPY_CD
                         AND DCC.CPO_ORD_NUM          = DCRD.CPO_ORD_NUM
                         AND DCC.DS_ORD_POSN_NUM      = DCRD.DS_ORD_POSN_NUM
                         AND DCC.CONFIG_CATG_CD       = #inBound#
                         AND DCC.EZCANCELFLAG         = '0'

                         AND DCRD.GLBL_CMPY_CD        = LC.GLBL_CMPY_CD
                         AND DCRD.DS_ORD_LINE_CATG_CD = LC.DS_ORD_LINE_CATG_CD
                         AND LC.EZCANCELFLAG          = '0'

                         AND DCRD.GLBL_CMPY_CD        = M.GLBL_CMPY_CD
                         AND DCRD.MDSE_CD             = M.MDSE_CD
                         AND M.EZCANCELFLAG           = '0'

                         AND M.GLBL_CMPY_CD           = CP.GLBL_CMPY_CD
                         AND M.COA_MDSE_TP_CD         = CP.COA_PROJ_CD
                         AND CP.EZCANCELFLAG          = '0'
                ) V
                , ORD_PRFT_TRX_CATG TC 
            WHERE
                TC.GLBL_CMPY_CD             = #glblCmpyCd#
                AND TC.ORD_PRFT_TRX_CATG_CD = V.ORD_PRFT_TRX_CATG_CD
                AND TC.EZCANCELFLAG         = '0'
                AND NOT EXISTS( -- 2016/03/30 S21_NA6292
                               SELECT '1'
                               FROM
                                     DS_ORD_TP_PROC_DFN      PD
                                   , ORD_PRFT_LINE_CATG_RULE LCR
                               WHERE 
                                   PD.GLBL_CMPY_CD  = V.GLBL_CMPY_CD
                               AND PD.DS_ORD_TP_CD  = V.DS_ORD_TP_CD
                               AND PD.EFF_FROM_DT   &lt;= #slsDt#
                               AND ( PD.EFF_THRU_DT &gt;= #slsDt# OR PD.EFF_THRU_DT IS NULL )
                               AND PD.ACTV_FLG      = 'Y'
                               AND PD.EZCANCELFLAG  = '0'
                               AND PD.GLBL_CMPY_CD  = LCR.GLBL_CMPY_CD
                               AND PD.PRFT_APVL_NODE_PRFL_CD = LCR.ORD_PROC_NODE_PRFL_CD
                               AND LCR.DS_ORD_LINE_CATG_CD   = V.DS_ORD_LINE_CATG_CD
                               AND LCR.EFF_FROM_DT   &lt;= #slsDt#
                               AND ( LCR.EFF_THRU_DT &gt;= #slsDt# OR LCR.EFF_THRU_DT IS NULL )
                               AND LCR.ACTV_FLG     = 'Y'
                               AND LCR.EZCANCELFLAG = '0'
                    )
                AND NOT EXISTS( -- 2016/03/30 S21_NA6292
                               SELECT '1'
                               FROM
                                     DS_ORD_TP_PROC_DFN      PD
                                   , ORD_PRFT_WH_RULE        WHR
                               WHERE 
                                   PD.GLBL_CMPY_CD  = V.GLBL_CMPY_CD
                               AND PD.DS_ORD_TP_CD  = V.DS_ORD_TP_CD
                               AND PD.EFF_FROM_DT   &lt;= #slsDt#
                               AND ( PD.EFF_THRU_DT &gt;= #slsDt# OR PD.EFF_THRU_DT IS NULL )
                               AND PD.ACTV_FLG      = 'Y'
                               AND PD.EZCANCELFLAG  = '0'
                               AND PD.GLBL_CMPY_CD  = WHR.GLBL_CMPY_CD
                               AND WHR.ORD_PROC_NODE_PRFL_CD = PD.PRFT_APVL_NODE_PRFL_CD
                               AND WHR.RTL_WH_CD    = V.RTL_WH_CD
                               AND NVL (WHR.RTL_SWH_CD, '1') = NVL (V.RTL_SWH_CD, '1')
                               AND WHR.EFF_FROM_DT   &lt;= #slsDt#
                               AND ( WHR.EFF_THRU_DT &gt;= #slsDt# OR WHR.EFF_THRU_DT IS NULL )
                               AND WHR.ACTV_FLG     = 'Y'
                               AND WHR.EZCANCELFLAG = '0'
                    )
            ORDER BY
                TC.ORD_PRFT_TRX_CATG_SORT_NUM
                , V.TRX_LINE_NUM
                , V.TRX_LINE_SUB_NUM
    </statement>

    <!-- S21_NA#11552 START -->
    <statement id="getDsCpoDtlDsRtrnDtlList" parameterClass="Map" resultClass="Map">
        SELECT
            CD.CR_REBIL_CD
        FROM
            CPO_DTL    CD
        WHERE
            CD.GLBL_CMPY_CD         = #glblCmpyCd#
            AND CD.CPO_ORD_NUM      = #cpoOrdNum#
            AND CD.ORD_LINE_STS_CD != #ordLineStsCancel#
            AND CD.EZCANCELFLAG     = '0'
        UNION ALL
        SELECT
            DCD.CR_REBIL_CD
        FROM
            DS_CPO_RTRN_DTL DCD
        WHERE
            DCD.GLBL_CMPY_CD          = #glblCmpyCd#
            AND DCD.CPO_ORD_NUM       = #cpoOrdNum#
            AND DCD.RTRN_LINE_STS_CD != #rtrnLineStsCancel#
            AND DCD.EZCANCELFLAG      = '0'
    </statement>
    <!-- S21_NA#11552 END -->

    <!-- S21_NA#8388 START -->
    <statement id="getDclnSvcCdInConfig" parameterClass="Map" resultClass="String">
        SELECT
            DISTINCT
            CNFG.DCLN_SVC_CD
        FROM
            DS_CPO_CONFIG CNFG
          , CPO_DTL       CDTL
        WHERE
                CNFG.GLBL_CMPY_CD         = #glblCmpyCd#
            AND CNFG.CPO_ORD_NUM          = #cpoOrdNum#
            AND CNFG.CONFIG_CATG_CD       = #configCatgCdOut#
            AND CNFG.EZCANCELFLAG         = '0'

            AND CNFG.GLBL_CMPY_CD         = CDTL.GLBL_CMPY_CD
            AND CNFG.CPO_ORD_NUM          = CDTL.CPO_ORD_NUM
            AND CNFG.DS_CPO_CONFIG_PK     = CDTL.DS_CPO_CONFIG_PK
            AND CDTL.CPO_DTL_LINE_NUM     = #cpoDtlLineNum#
            AND CDTL.EZCANCELFLAG         = '0'
    </statement>
    <!-- S21_NA#8388 END -->

    <!-- S21_NA#11774 START -->
    <statement id="getSvcShllInf" parameterClass="Map" resultClass="Map">
        <!-- 2020/03/24 QC#56314 Del Start -->
        <!-- QC#50174 ADD Start -->
        <!-- <isNotEqual property="ordBookFlg" compareValue="Y"> -->
        <!-- QC#50174 ADD End -->
        <!-- 2020/03/24 QC#56314 Del End -->
        SELECT
             CNTD.DS_CONTR_DTL_PK
            ,CNTD.SHELL_LINE_NUM
            ,CNTD.ADD_ASRY_FLG
            ,CNT.MTR_BLLG_CYCLE_CD
            ,CNT.DS_CONTR_CATG_CD
            ,CNT.MAN_CONTR_OVRD_FLG
            ,CNT.DS_CONTR_PK
            ,CFG.MDL_ID
            ,MDL.T_MDL_NM
            ,SMM.SVC_MACH_MSTR_STS_CD
            ,CNTD.MTR_READ_METH_CD
            ,DM.MTR_GRP_PK
            ,CNTD.PRC_MTR_PKG_PK
            <!-- 2021/06/03 QC#58846 Add -->
            ,CNTD.MDL_ID AS CNTR_MDL_ID
        FROM
             CPO                 CPO
            ,CPO_DTL             DCD
            ,DS_CPO_CONFIG       CFG
            ,MDL_NM              MDL
            ,DS_CONTR_DTL        CNTD
            ,DS_CONTR            CNT
            ,DS_CONTR_DTL_TP     CNTT
            ,SVC_MACH_MSTR       SMM
            ,DS_MDL              DM
        WHERE
                CPO.GLBL_CMPY_CD          = #glblCmpyCd#
            AND CPO.CPO_ORD_NUM           = #cpoOrdNum#
            AND CPO.EZCANCELFLAG          = '0'

            AND CPO.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD
            AND CPO.CPO_ORD_NUM           = DCD.CPO_ORD_NUM
            AND DCD.ORD_LINE_STS_CD NOT IN   <!-- QC#22874 -->
            <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
               #ordLineStsCd[]#
            </iterate>
            AND DCD.EZCANCELFLAG          = '0'

            AND DCD.GLBL_CMPY_CD          = CFG.GLBL_CMPY_CD
            AND DCD.DS_CPO_CONFIG_PK      = CFG.DS_CPO_CONFIG_PK
            AND CFG.EZCANCELFLAG          = '0'

            <!-- 2020/03/24 QC#56314 Del Start -->
            <!-- AND CFG.GLBL_CMPY_CD          = MDL.T_GLBL_CMPY_CD -->
            <!-- AND CFG.MDL_ID                = MDL.T_MDL_ID -->
            <!-- AND MDL.EZCANCELFLAG          = '0' -->
            <!-- 2020/03/24 QC#56314 Del End -->

            AND DCD.GLBL_CMPY_CD          = CNTD.GLBL_CMPY_CD
            AND DCD.CPO_ORD_NUM           = CNTD.CPO_ORD_NUM
            AND DCD.CPO_DTL_LINE_NUM      = CNTD.CPO_DTL_LINE_NUM
            AND DCD.CPO_DTL_LINE_SUB_NUM  = CNTD.CPO_DTL_LINE_SUB_NUM
            AND CNTD.EZCANCELFLAG         = '0'

            AND CNTD.GLBL_CMPY_CD         = CNT.GLBL_CMPY_CD
            AND CNTD.DS_CONTR_PK          = CNT.DS_CONTR_PK
            AND CNT.DS_CONTR_CATG_CD      &lt;&gt; #dsContrCatgCd#
            AND CNT.EZCANCELFLAG          = '0'

            AND CNTD.GLBL_CMPY_CD         = CNTT.GLBL_CMPY_CD
            AND CNTD.DS_CONTR_DTL_TP_CD   = CNTT.DS_CONTR_DTL_TP_CD
            AND (CNTT.MAIN_UNIT_LINE_FLG  = 'Y'
                 OR CNTT.SPLY_LINE_FLG    = 'Y')
            AND CNTT.EZCANCELFLAG         = '0'

            AND CNTD.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD(+)
            AND CNTD.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK(+)
            AND SMM.EZCANCELFLAG(+)       = '0'

            AND CFG.GLBL_CMPY_CD          = DM.GLBL_CMPY_CD(+)
            AND CFG.MDL_ID                = DM.MDL_ID(+)
            AND DM.EZCANCELFLAG(+)        = '0'

            <!-- 2020/03/24 QC#56314 Add Start -->
            AND CNTD.GLBL_CMPY_CD          = MDL.T_GLBL_CMPY_CD
            AND CNTD.MDL_ID                = MDL.T_MDL_ID
            AND MDL.EZCANCELFLAG           = '0'
            <!-- 2020/03/24 QC#56314 Add End -->

        UNION ALL
        <!-- 2020/01/27 QC#55492 Add Start -->
        SELECT
             CNTD.DS_CONTR_DTL_PK
            ,CNTD.SHELL_LINE_NUM
            ,CNTD.ADD_ASRY_FLG
            ,CNT.MTR_BLLG_CYCLE_CD
            ,CNT.DS_CONTR_CATG_CD
            ,CNT.MAN_CONTR_OVRD_FLG
            ,CNT.DS_CONTR_PK
            ,CFG.MDL_ID
            ,MDL.T_MDL_NM
            ,SMM.SVC_MACH_MSTR_STS_CD
            ,CNTD.MTR_READ_METH_CD
            ,DM.MTR_GRP_PK
            ,CNTD.PRC_MTR_PKG_PK
             <!-- 2021/06/03 QC#58846 Add -->
            ,CNTD.MDL_ID AS CNTR_MDL_ID
        FROM
             CPO                 CPO
            ,CPO_DTL             DCD
            ,DS_CPO_CONFIG       CFG
            ,MDL_NM              MDL
            ,DS_CONTR_DTL        CNTD
            ,DS_CONTR            CNT
            ,SVC_MACH_MSTR       SMM
            ,DS_MDL              DM
            ,MDSE                M
            ,ORD_TAKE_MDSE       OTM
            ,MDSE                M_OTM

        WHERE
                CPO.GLBL_CMPY_CD          = #glblCmpyCd#
            AND CPO.CPO_ORD_NUM           = #cpoOrdNum#
            AND CPO.EZCANCELFLAG          = '0'

            AND CPO.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD
            AND CPO.CPO_ORD_NUM           = DCD.CPO_ORD_NUM
            AND DCD.ORD_LINE_STS_CD NOT IN
            <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
               #ordLineStsCd[]#
            </iterate>
            AND DCD.EZCANCELFLAG          = '0'

            AND DCD.GLBL_CMPY_CD          = CFG.GLBL_CMPY_CD
            AND DCD.DS_CPO_CONFIG_PK      = CFG.DS_CPO_CONFIG_PK
            AND CFG.EZCANCELFLAG          = '0'

            <!-- 2020/03/24 QC#56314 Del Start -->
            <!-- AND CFG.GLBL_CMPY_CD          = MDL.T_GLBL_CMPY_CD -->
            <!-- AND CFG.MDL_ID                = MDL.T_MDL_ID -->
            <!-- AND MDL.EZCANCELFLAG          = '0' -->
            <!-- 2020/03/24 QC#56314 Del End -->

            AND DCD.GLBL_CMPY_CD          = CNTD.GLBL_CMPY_CD
            AND DCD.CPO_ORD_NUM           = CNTD.CPO_ORD_NUM
            AND DCD.CPO_DTL_LINE_NUM      = CNTD.CPO_DTL_LINE_NUM
            AND DCD.CPO_DTL_LINE_SUB_NUM  = CNTD.CPO_DTL_LINE_SUB_NUM
            AND CNTD.EZCANCELFLAG         = '0'
            AND CNTD.ADD_ASRY_FLG         = 'Y'

            AND DCD.GLBL_CMPY_CD          = M.GLBL_CMPY_CD(+)
            AND DCD.MDSE_CD               = M.MDSE_CD(+)
            AND M.EZCANCELFLAG(+)         = '0'
            AND DCD.GLBL_CMPY_CD          = OTM.GLBL_CMPY_CD(+)
            AND DCD.MDSE_CD               = OTM.ORD_TAKE_MDSE_CD(+)
            AND OTM.EZCANCELFLAG(+)       = '0'
            AND OTM.GLBL_CMPY_CD          = M_OTM.GLBL_CMPY_CD(+)
            AND OTM.MDSE_CD               = M_OTM.MDSE_CD(+)
            AND M_OTM.EZCANCELFLAG(+)     = '0'
            AND NVL(M.INVTY_CTRL_FLG, M_OTM.INVTY_CTRL_FLG) = 'Y'

            AND CNTD.GLBL_CMPY_CD         = CNT.GLBL_CMPY_CD
            AND CNTD.DS_CONTR_PK          = CNT.DS_CONTR_PK
            AND CNT.DS_CONTR_CATG_CD      &lt;&gt; #dsContrCatgCd#
            AND CNT.EZCANCELFLAG          = '0'

            AND CNTD.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD(+)
            AND CNTD.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK(+)
            AND SMM.EZCANCELFLAG(+)       = '0'

            AND CFG.GLBL_CMPY_CD          = DM.GLBL_CMPY_CD(+)
            AND CFG.MDL_ID                = DM.MDL_ID(+)
            AND DM.EZCANCELFLAG(+)        = '0'

            <!-- 2020/03/24 QC#56314 Add Start -->
            AND CNTD.GLBL_CMPY_CD          = MDL.T_GLBL_CMPY_CD
            AND CNTD.MDL_ID                = MDL.T_MDL_ID
            AND MDL.EZCANCELFLAG           = '0'
            <!-- 2020/03/24 QC#56314 Add End -->

        UNION ALL
        <!-- 2020/01/27 QC#55492 Add End -->
        <!-- 2020/03/24 QC#56314 Del Start -->
        <!-- QC#50174 ADD Start -->
        <!-- </isNotEqual> -->
        <!-- QC#50174 ADD End -->
        <!-- 2020/03/24 QC#56314 Del End -->
        SELECT DISTINCT
             NULL                    AS DS_CONTR_DTL_PK
            ,CNTD.SHELL_LINE_NUM
            ,CNTD.ADD_ASRY_FLG
            ,CNT.MTR_BLLG_CYCLE_CD
            ,CNT.DS_CONTR_CATG_CD
            ,CNT.MAN_CONTR_OVRD_FLG
            ,CNT.DS_CONTR_PK
            ,CFG.MDL_ID
            ,MDL.T_MDL_NM
            ,SMM.SVC_MACH_MSTR_STS_CD
            ,CNTD.MTR_READ_METH_CD
            ,DM.MTR_GRP_PK
            ,CNTD.PRC_MTR_PKG_PK
            <!-- 2021/06/03 QC#58846 Add -->
            ,CNTD.MDL_ID AS CNTR_MDL_ID
        FROM
             CPO                 CPO
            ,CPO_DTL             DCD
            ,DS_CPO_CONFIG       CFG
            ,MDL_NM              MDL
            ,DS_CONTR_DTL        CNTD
            ,DS_CONTR            CNT
            ,DS_CONTR_DTL_TP     CNTT
            ,SVC_MACH_MSTR       SMM
            ,DS_MDL              DM
        WHERE
                CPO.GLBL_CMPY_CD          = #glblCmpyCd#
            AND CPO.CPO_ORD_NUM           = #cpoOrdNum#
            AND CPO.EZCANCELFLAG          = '0'

            AND CPO.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD
            AND CPO.CPO_ORD_NUM           = DCD.CPO_ORD_NUM
            AND DCD.ORD_LINE_STS_CD NOT IN   <!-- QC#22874 -->
            <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
               #ordLineStsCd[]#
            </iterate>
            AND DCD.EZCANCELFLAG          = '0'

            AND DCD.GLBL_CMPY_CD          = CFG.GLBL_CMPY_CD
            AND DCD.DS_CPO_CONFIG_PK      = CFG.DS_CPO_CONFIG_PK
            AND CFG.EZCANCELFLAG          = '0'

            <!-- 2020/03/24 QC#56314 Del Start -->
            <!-- AND CFG.GLBL_CMPY_CD          = MDL.T_GLBL_CMPY_CD -->
            <!-- AND CFG.MDL_ID                = MDL.T_MDL_ID -->
            <!-- AND MDL.EZCANCELFLAG          = '0' -->
            <!-- 2020/03/24 QC#56314 Del End -->

            AND DCD.GLBL_CMPY_CD          = CNTD.GLBL_CMPY_CD
            AND DCD.CPO_ORD_NUM           = CNTD.CPO_ORD_NUM
            AND DCD.CPO_DTL_LINE_NUM      = CNTD.CPO_DTL_LINE_NUM
            AND DCD.CPO_DTL_LINE_SUB_NUM  = CNTD.CPO_DTL_LINE_SUB_NUM
            AND CNTD.EZCANCELFLAG         = '0'

            AND CNTD.GLBL_CMPY_CD         = CNT.GLBL_CMPY_CD
            AND CNTD.DS_CONTR_PK          = CNT.DS_CONTR_PK
            AND CNT.DS_CONTR_CATG_CD      = #dsContrCatgCd#
            AND CNT.EZCANCELFLAG          = '0'

            AND CNTD.GLBL_CMPY_CD         = CNTT.GLBL_CMPY_CD
            AND CNTD.DS_CONTR_DTL_TP_CD   = CNTT.DS_CONTR_DTL_TP_CD
            AND (CNTT.MAIN_UNIT_LINE_FLG  = 'Y'
                 OR CNTT.SPLY_LINE_FLG    = 'Y')
            AND CNTT.EZCANCELFLAG         = '0'

            AND CNTD.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD(+)
            AND CNTD.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK(+)
            AND SMM.EZCANCELFLAG(+)       = '0'

            AND CFG.GLBL_CMPY_CD          = DM.GLBL_CMPY_CD(+)
            AND CFG.MDL_ID                = DM.MDL_ID(+)
            AND DM.EZCANCELFLAG(+)        = '0'

            <!-- 2020/03/24 QC#56314 Add Start -->
            AND CNTD.GLBL_CMPY_CD          = MDL.T_GLBL_CMPY_CD
            AND CNTD.MDL_ID                = MDL.T_MDL_ID
            AND MDL.EZCANCELFLAG           = '0'
            <!-- 2020/03/24 QC#56314 Add End -->
    </statement>

    <statement id="cntCpoSvcPrc" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(1)
        FROM
             DS_CONTR_DTL         CNTD
        WHERE
                CNTD.GLBL_CMPY_CD           = #glblCmpyCd#
            AND CNTD.DS_CONTR_DTL_PK        = #dsContrDtlPk#
            AND CNTD.CPO_ORD_NUM            = #cpoOrdNum#
            AND CNTD.PRC_CATG_CD            IS NOT NULL
            AND CNTD.MDL_ID                 IS NOT NULL
            AND CNTD.EZCANCELFLAG           = '0'
    </statement>

    <statement id="cntFleetCpoSvcPrc" parameterClass="Map" resultClass="Integer">
        SELECT
             COUNT(1)
        FROM
              DS_CONTR_DTL         CNTD
             ,DS_CONTR_DTL_TP      CNTT
        WHERE
                CNTD.GLBL_CMPY_CD           = #glblCmpyCd#
            AND CNTD.DS_CONTR_PK            = #dsContrPk#
            AND CNTD.CPO_ORD_NUM            = #cpoOrdNum#
            AND CNTD.MDL_ID                 IS NULL
            AND CNTD.EZCANCELFLAG           = '0'

            AND CNTD.GLBL_CMPY_CD         = CNTT.GLBL_CMPY_CD
            AND CNTD.DS_CONTR_DTL_TP_CD   = CNTT.DS_CONTR_DTL_TP_CD
            AND CNTT.SVC_PRC_FLG          = 'Y'
            AND CNTT.EZCANCELFLAG         = '0'
    </statement>

    <statement id="cntCpoSvcUsgPrc" parameterClass="Map" resultClass="Integer">
      <!-- Mod Start 2017/08/15 QC#18193 -->
        SELECT
            COUNT(1)
        FROM
             DS_CONTR_DTL            CNTD
            ,DS_CONTR_BLLG_MTR       CNTM
            ,PRC_MTR_PKG_MTR_STRU_V  STR
            
        WHERE
                CNTD.GLBL_CMPY_CD       = #glblCmpyCd#
            AND CNTD.DS_CONTR_PK        = #dsContrPk#
            AND CNTD.MDL_ID             = #mdlId#
            AND CNTD.EZCANCELFLAG       = '0'

            AND CNTD.GLBL_CMPY_CD       = CNTM.GLBL_CMPY_CD
            AND CNTD.DS_CONTR_DTL_PK    = CNTM.DS_CONTR_DTL_PK
            AND CNTM.EZCANCELFLAG       = '0'

            AND CNTD.GLBL_CMPY_CD       = STR.GLBL_CMPY_CD
            AND CNTD.MDL_ID             = STR.MDL_ID
            AND CNTD.PRC_MTR_PKG_PK     = STR.PRC_MTR_PKG_PK
            AND CNTM.BLLG_MTR_LB_CD     = STR.BLLG_MTR_LB_CD
            AND STR.EZCANCELFLAG        = '0'
      <!-- Mod End 2017/08/15 QC#18193 -->
    </statement>

    <statement id="cntFltCpoSvcUsgPrc" parameterClass="Map" resultClass="Integer">
      <!-- Mod Start 2017/08/15 QC#18193 -->
        SELECT
            COUNT(1)
        FROM
             DS_CONTR_DTL            CNTD
            ,DS_CONTR_DTL_TP         CNTT
            ,DS_CONTR_BLLG_MTR       CNTM
            ,PRC_MTR_PKG_MTR_STRU_V  STR
        WHERE
                CNTD.GLBL_CMPY_CD       = #glblCmpyCd#
            AND CNTD.DS_CONTR_PK        = #dsContrPk#
            AND CNTD.CPO_ORD_NUM        = #cpoOrdNum#
            AND CNTD.EZCANCELFLAG       = '0'

            AND CNTD.GLBL_CMPY_CD       = CNTT.GLBL_CMPY_CD
            AND CNTD.DS_CONTR_DTL_TP_CD = CNTT.DS_CONTR_DTL_TP_CD
            AND CNTT.SVC_PRC_FLG        = 'Y'
            AND CNTT.EZCANCELFLAG       = '0'

            AND CNTD.GLBL_CMPY_CD       = CNTM.GLBL_CMPY_CD
            AND CNTD.DS_CONTR_DTL_PK    = CNTM.DS_CONTR_DTL_PK
            AND CNTM.EZCANCELFLAG       = '0'

            AND CNTD.GLBL_CMPY_CD       = STR.GLBL_CMPY_CD
            AND CNTD.PRC_MTR_PKG_PK     = STR.PRC_MTR_PKG_PK
            AND CNTM.BLLG_MTR_LB_CD     = STR.BLLG_MTR_LB_CD
            AND STR.EZCANCELFLAG        = '0'

            AND STR.MDL_ID              IN (
                SELECT
                    CNF.MDL_ID
                FROM
                     DS_CONTR_DTL   CNT
                    ,CPO_DTL        DCD
                    ,DS_CPO_CONFIG  CNF
                WHERE
                        CNT.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND CNT.DS_CONTR_PK           = #dsContrPk#
                    AND CNT.CPO_ORD_NUM           = #cpoOrdNum#
                    AND CNT.EZCANCELFLAG          = '0'

                    AND CNT.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD
                    AND CNT.CPO_ORD_NUM           = DCD.CPO_ORD_NUM
                    AND CNT.CPO_DTL_LINE_NUM      = DCD.CPO_DTL_LINE_NUM
                    AND CNT.CPO_DTL_LINE_SUB_NUM  = DCD.CPO_DTL_LINE_SUB_NUM
                    AND DCD.EZCANCELFLAG          = '0'

                    AND DCD.GLBL_CMPY_CD          = CNF.GLBL_CMPY_CD
                    AND DCD.DS_CPO_CONFIG_PK      = CNF.DS_CPO_CONFIG_PK
                    AND CNF.EZCANCELFLAG          = '0'
            )
      <!-- Mod End 2017/08/15 QC#18193 -->
    </statement>

      <!-- Add 2018/06/13 QC#24245 -->
    <statement id="getSvcShllInfobyConfig" parameterClass="Map" resultClass="Map">
        <!-- 2018/10/17 QC#28370 Mod Start -->
        SELECT DISTINCT
        <!-- 2018/10/17 QC#28370 Mod End -->
                DCD.SHELL_LINE_NUM
               ,MDL.T_MDL_NM
--               ,DCD.CPO_ORD_NUM
--               ,DCD.MDL_ID                  MDL_ID_1
--               ,DCC.MDL_ID                  MDL_ID_2 
--               ,DCD.SVC_CONFIG_MSTR_PK      SVC_CONFIG_MSTR_PK_1
--               ,DCC.SVC_CONFIG_MSTR_PK      SVC_CONFIG_MSTR_PK_2
        FROM 
               DS_CONTR_DTL  DCD
              ,CPO_DTL       CD
              ,DS_CPO_CONFIG DCC
              ,MDL_NM        MDL
        WHERE DCD.GLBL_CMPY_CD         = #glblCmpyCd#
        AND   DCD.CPO_ORD_NUM          = #cpoOrdNum#
        AND   DCD.EZCANCELFLAG         = '0'
        AND   DCD.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
        AND   DCD.CPO_ORD_NUM          = CD.CPO_ORD_NUM
        AND   DCD.CPO_DTL_LINE_NUM     = CD.CPO_DTL_LINE_NUM
        AND   DCD.CPO_DTL_LINE_SUB_NUM = CD.CPO_DTL_LINE_SUB_NUM
        AND   DCD.EZCANCELFLAG         = CD.EZCANCELFLAG
        AND   CD.ORD_LINE_STS_CD NOT IN
        <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
           #ordLineStsCd[]#
        </iterate>
        AND   CD.GLBL_CMPY_CD          = DCC.GLBL_CMPY_CD
        AND   CD.CPO_ORD_NUM           = DCC.CPO_ORD_NUM
        AND   CD.EZCANCELFLAG          = DCD.EZCANCELFLAG
        AND   CD.DS_CPO_CONFIG_PK      = DCC.DS_CPO_CONFIG_PK
        AND   CD.SVC_CONFIG_MSTR_PK    &lt;&gt; DCD.SVC_CONFIG_MSTR_PK
        AND   DCD.GLBL_CMPY_CD         = MDL.T_GLBL_CMPY_CD
        AND   DCD.MDL_ID               = MDL.T_MDL_ID
        AND   DCD.EZCANCELFLAG         = MDL.EZCANCELFLAG
    </statement>

    <statement id="getMtrReqMdlFlg" parameterClass="Map" resultClass="String">
            SELECT
                MDL.MTR_REQ_MDL_FLG
            FROM
                DS_MDL               MDL
            WHERE
                    MDL.GLBL_CMPY_CD   = #glblCmpyCd#
                AND MDL.MDL_ID         = #mdlId#
                AND MDL.EZCANCELFLAG   = '0'
    </statement>

    <!-- 2016/09/30 ADD START QC#14779 -->
    <statement id="getDsCpoVData" parameterClass="Map" resultClass="Map">
        SELECT
             DCV.DS_ORD_TP_CD,
             DCV.CPO_ORD_TS,
             DCV.DS_ORD_CATG_CD,
             DCV.ORD_HDR_STS_CD,
             DCV.CPO_UPD_VRSN_NUM,
             DCV.SHIP_TO_CUST_ACCT_CD,
             DCV.LEASE_CMPY_PO_NUM,
             DCV.SELL_TO_CUST_CD,
             DCV.BILL_TO_CUST_CD,
             DCV.BILL_TO_CUST_ACCT_CD,  <!-- QC#21471 -->
             DCV.LINE_BIZ_TP_CD,
             DCV.PRE_PMT_AMT,
             DCV.ORD_TOT_DEAL_NET_AMT,
             DCV.PRC_CONTR_NUM,
             DCV.CSMP_CONTR_NUM,
             DCV.DLR_REF_NUM,
             DCV.DCLN_SVC_CD,
             DCV.SLS_REP_TOC_CD,         <!-- QC#19804 ADD -->
             DCV.ADD_SHIP_TO_CUST_CD,         <!-- QC#19804 ADD -->
             DCV.ORD_BOOK_FLG,            <!-- QC#50174 ADD -->
             DCV.SOLD_TO_CUST_LOC_CD     <!-- QC#56638 ADD -->
        FROM
             CPO_V  DCV
        WHERE
             DCV.GLBL_CMPY_CD  = #glblCmpyCd#
         AND DCV.CPO_ORD_NUM   = #cpoOrdNum#
         AND DCV.EZCANCELFLAG  = '0'
    </statement>

    <statement id="getDsCpoDtlVData" parameterClass="Map" resultClass="Map">
        SELECT
             DCDV.DS_CPO_CONFIG_PK,
             DCDV.DS_CPO_LINE_NUM,
             DCDV.DS_CPO_LINE_SUB_NUM,
             DCDV.CPO_DTL_LINE_NUM,
             DCDV.CPO_DTL_LINE_SUB_NUM,
             DCDV.DS_ORD_POSN_NUM,
             DCDV.ORD_QTY,
             DCDV.CPO_DTL_FUNC_NET_AMT,
             DCDV.PRC_CATG_CD,
             DCDV.OPEN_FLG,
             DCDV.MDSE_CD,
             DCDV.CCY_CD,
             DCDV.PRC_LIST_EQUIP_CONFIG_NUM,
             DCDV.DS_ORD_LINE_CATG_CD,
             DCDV.INV_QTY,
             DCDV.SHIP_TO_CTY_ADDR,
             DCDV.SHIP_TO_ST_CD,
             DCDV.SHIP_TO_CTRY_CD,
             DCDV.CUST_UOM_CD,
             DCDV.ORD_CUST_UOM_QTY,
             DCDV.ENT_CPO_DTL_FUNC_NET_AMT,
             DCDV.FIRST_BLLG_ATTRB_NM,
             DCDV.SCD_BLLG_ATTRB_NM,
             DCDV.THIRD_BLLG_ATTRB_NM,
             DCDV.FRTH_BLLG_ATTRB_NM,
             DCDV.FIFTH_BLLG_ATTRB_NM,
             DCDV.FIRST_BLLG_ATTRB_VAL_TXT,
             DCDV.SCD_BLLG_ATTRB_VAL_TXT,
             DCDV.THIRD_BLLG_ATTRB_VAL_TXT,
             DCDV.FRTH_BLLG_ATTRB_VAL_TXT,
             DCDV.FIFTH_BLLG_ATTRB_VAL_TXT,
             DCDV.FL_PRC_LIST_CD,
             DCDV.ENT_FUNC_NET_UNIT_PRC_AMT,
             DCDV.ENT_DEAL_NET_UNIT_PRC_AMT,
             DCDV.FUNC_PRC_LIST_PRC_AMT,
             DCDV.CR_REBIL_CD,
             <!-- 2017/10/24 S21_NA#22035 Add Start -->
             DCDV.RTL_WH_CD,
             DCDV.RTL_SWH_CD
             <!-- 2017/10/24 S21_NA#22035 Add End -->
             , DCDV.ORD_LINE_STS_CD   <!-- QC#22874 -->
             , DCDV.SLS_REP_OR_SLS_TEAM_TOC_CD <!-- QC#19804 ADD -->
             , DCDV.SVC_CONFIG_MSTR_PK <!-- QC#24253 ADD -->
        FROM
             CPO_DTL_V  DCDV
        WHERE
             DCDV.GLBL_CMPY_CD  = #glblCmpyCd#
         AND DCDV.CPO_ORD_NUM  = #cpoOrdNum#
         AND DCDV.EZCANCELFLAG  = '0'
         AND ( DCDV.CR_REBIL_CD  IS NULL OR DCDV.CR_REBIL_CD &lt;&gt; #credit# )
        ORDER BY
             DCDV.CPO_DTL_LINE_NUM,
             DCDV.CPO_DTL_LINE_SUB_NUM
    </statement>

    <statement id="getDsCpoRtrnDtlVData" parameterClass="Map" resultClass="Map">
        SELECT
             DCRV.DS_CPO_CONFIG_PK,
             DCRV.DS_CPO_LINE_NUM,
             DCRV.DS_CPO_LINE_SUB_NUM,
             DCRV.DS_CPO_RTRN_LINE_NUM,
             DCRV.DS_CPO_RTRN_LINE_SUB_NUM,
             DCRV.DS_ORD_POSN_NUM,
             DCRV.ORD_QTY,
             DCRV.CPO_DTL_FUNC_NET_AMT,
             DCRV.HDD_RMV_CD,
             DCRV.SVC_MACH_MSTR_PK,
             DCRV.SVC_CONFIG_MSTR_PK,
             DCRV.SER_NUM,
             DCRV.PRC_CATG_CD,
             DCRV.MDSE_CD,
             DCRV.CCY_CD,
             DCRV.DS_ORD_LINE_CATG_CD,
             DCRV.SHIP_TO_CTY_ADDR,
             DCRV.SHIP_TO_ST_CD,
             DCRV.SHIP_TO_CTRY_CD,
             DCRV.CUST_UOM_CD,
             DCRV.ENT_CPO_DTL_FUNC_NET_AMT,
             DCRV.RTRN_LINE_STS_CD,
             DCRV.SLS_REP_OR_SLS_TEAM_TOC_CD <!-- QC#19804 ADD -->
        FROM
             DS_CPO_RTRN_DTL_V DCRV
        WHERE
             DCRV.GLBL_CMPY_CD  = #glblCmpyCd#
         AND DCRV.CPO_ORD_NUM   = #cpoOrdNum#
         AND DCRV.EZCANCELFLAG  = '0'
         AND ( DCRV.CR_REBIL_CD IS NULL OR DCRV.CR_REBIL_CD &lt;&gt; #credit# )
        ORDER BY 
             DCRV.DS_CPO_LINE_NUM,
             DCRV.DS_CPO_LINE_SUB_NUM
    </statement>
    <!-- 2016/09/30 ADD E N D QC#14779 -->

    <!-- S21_NA#15510 Add Start -->
    <statement id="cntEmsdOrder" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT (DC.CPO_ORD_NUM)
        FROM
            CPO              DC
           ,ORD_CATG_BIZ_CTX OCB
        WHERE
            DC.GLBL_CMPY_CD     = #glblCmpyCd#
            AND DC.CPO_ORD_NUM  = #ordNum#
            AND DC.EZCANCELFLAG = '0'

            AND DC.GLBL_CMPY_CD        = OCB.GLBL_CMPY_CD
            <!-- 2018/03/20 S21_NA#24840 Mod Start -->
            <!-- AND DC.DS_ORD_CATG_CD      = OCB.DS_ORD_CATG_CD -->
            AND (OCB.DS_ORD_CATG_CD    IS NULL
              OR DC.DS_ORD_CATG_CD     = OCB.DS_ORD_CATG_CD
            )
            AND (OCB.DS_ORD_TP_CD      IS NULL
              OR DC.DS_ORD_TP_CD       = OCB.DS_ORD_TP_CD
            )
            <!-- 2018/03/20 S21_NA#24840 Mod End -->
            AND OCB.ORD_CATG_CTX_TP_CD = #ordCatgCtxTp#
            AND OCB.EZCANCELFLAG       = '0'
    </statement>

    <!-- #################### E099-1220 #################### -->
    <statement id="getNonEmsdSalesRepList" parameterClass="Map" resultClass="Map">
        SELECT
            DCC.DS_CPO_CONFIG_PK AS DS_CPO_CONFIG_PK
           ,DCC.DS_ORD_POSN_NUM  AS DS_ORD_POSN_NUM
        FROM
            DS_CPO_CONFIG DCC
        WHERE
            DCC.GLBL_CMPY_CD       = #glblCmpyCd#
            AND DCC.CPO_ORD_NUM    = #ordNum#
            AND DCC.CONFIG_CATG_CD = #outBound#
            AND DCC.EZCANCELFLAG   = '0'
            AND EXISTS (   <!-- QC#22874 -->
                SELECT
                          1
                    FROM
                        CPO_DTL     CD
                    WHERE
                        CD.GLBL_CMPY_CD            = DCC.GLBL_CMPY_CD
                        AND CD.DS_CPO_CONFIG_PK    = DCC.DS_CPO_CONFIG_PK
                        AND CD.ORD_LINE_STS_CD   NOT IN
                        <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
                           #ordLineStsCd[]#
                        </iterate>
                        AND CD.EZCANCELFLAG        = '0'
            ) 

            AND NOT EXISTS (
                            SELECT
                                '1'
                            FROM
                                DS_CPO_SLS_CR DSC
                            WHERE
                                DCC.GLBL_CMPY_CD           = DSC.GLBL_CMPY_CD
                                AND DCC.DS_CPO_CONFIG_PK   = DSC.DS_CPO_CONFIG_PK
                                AND DSC.SLS_REP_ROLE_TP_CD = #emsd#
                                AND DSC.EZCANCELFLAG       = '0'
                           )
    </statement>
    <!-- S21_NA#15510 Add End -->

    <!-- 2017/07/18 S21_NA#19983 Add Start -->
    <statement id="isExistOrdCatg" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(OCBC.ORD_CATG_BIZ_CTX_PK)
        FROM
            ORD_CATG_BIZ_CTX OCBC
        WHERE
            OCBC.GLBL_CMPY_CD           = #glblCmpyCd#
            AND OCBC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTpCd#
            AND OCBC.EZCANCELFLAG       = '0'
            AND (
                 (
                  OCBC.DS_ORD_CATG_CD    = #dsOrdCatgCd#
                  AND OCBC.DS_ORD_TP_CD  IS NULL
                  AND OCBC.DS_ORD_RSN_CD IS NULL
                 )
                 <isNotNull property="dsOrdTpCd">
                 OR
                 (
                  OCBC.DS_ORD_CATG_CD    = #dsOrdCatgCd#
                  AND OCBC.DS_ORD_TP_CD  = #dsOrdTpCd#
                  AND OCBC.DS_ORD_RSN_CD IS NULL
                 )
                 </isNotNull>
                 <isNotNull property="dsOrdTpCd">
                     <isNotNull property="dsOrdRsnCd">
                     OR
                     (
                      OCBC.DS_ORD_CATG_CD    = #dsOrdCatgCd#
                      AND OCBC.DS_ORD_TP_CD  = #dsOrdTpCd#
                      AND OCBC.DS_ORD_RSN_CD = #dsOrdRsnCd#
                     )
                     </isNotNull>
                 </isNotNull>
                )
    </statement>

    <!-- #################### E099-1000 #################### By Sold To-->
    <statement id="getPoNumByLocCdFromSoldTo" parameterClass="Map" resultClass="Map">
        SELECT
            CPO.CUST_ISS_PO_NUM
        FROM
            CPO                CPO
         ,  BILL_TO_CUST       BTC
         ,  DS_CUST_TRX_RULE   DCTR
         ,  ORD_CATG_BIZ_CTX   OCBC
        WHERE
            CPO.GLBL_CMPY_CD        = #glblCmpyCd#
        AND CPO.CPO_ORD_NUM         = #cpoOrdNum#
        AND CPO.EZCANCELFLAG        = '0'

        AND CPO.GLBL_CMPY_CD        = BTC.GLBL_CMPY_CD
        AND CPO.SOLD_TO_CUST_LOC_CD = BTC.BILL_TO_CUST_CD
        AND BTC.EZCANCELFLAG        = '0'

        AND BTC.GLBL_CMPY_CD        = DCTR.GLBL_CMPY_CD
        AND BTC.LOC_NUM             = DCTR.LOC_NUM
        AND DCTR.DS_PO_REQ_FLG      = #flgY#
        AND DCTR.EZCANCELFLAG       = '0'

        AND DCTR.GLBL_CMPY_CD       = OCBC.GLBL_CMPY_CD
        AND DCTR.DS_TRX_RULE_TP_CD  = OCBC.FIRST_BIZ_CTX_ATTRB_TXT
        AND OCBC.ORD_CATG_CTX_TP_CD = #equipOrd#
        AND OCBC.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getPoNumBySoldToAcctCd" parameterClass="Map" resultClass="Map">
        SELECT
            CPO.CUST_ISS_PO_NUM
        FROM
            CPO                CPO
         ,  DS_CUST_TRX_RULE   DCTR
         ,  ORD_CATG_BIZ_CTX   OCBC
        WHERE
            CPO.GLBL_CMPY_CD         =   #glblCmpyCd#
        AND CPO.CPO_ORD_NUM          =   #cpoOrdNum#
        AND CPO.EZCANCELFLAG         =   '0'

        AND CPO.GLBL_CMPY_CD         =   DCTR.GLBL_CMPY_CD
        AND CPO.SELL_TO_CUST_CD      =   DCTR.DS_ACCT_NUM
        AND DCTR.LOC_NUM             IS  NULL
        AND DCTR.DS_PO_REQ_FLG       =   #flgY#
        AND DCTR.EZCANCELFLAG        =   '0'

        AND DCTR.GLBL_CMPY_CD        =   OCBC.GLBL_CMPY_CD
        AND DCTR.DS_TRX_RULE_TP_CD   =   OCBC.FIRST_BIZ_CTX_ATTRB_TXT
        AND OCBC.ORD_CATG_CTX_TP_CD  =   #equipOrd#
        AND OCBC.EZCANCELFLAG        =   '0'
    </statement>
    <!-- 2017/07/18 S21_NA#19983 Add End -->

    <!-- QC#26410 -->
    <!-- #################### E099-1110 #################### -->
    <statement id="isAvalableItemForOrderLine" parameterClass="Map" resultClass="String">
        SELECT
                  CASE COUNT(MDSE_CD) 
                    WHEN 0 THEN 'N' 
                    ELSE        'Y' 
                    END         IS_AVAL 
            FROM
                ALL_MDSE_V  M
            WHERE
                M.GLBL_CMPY_CD      = #glblCmpyCd#
                AND M.MDSE_CD       = #mdseCd#
                AND M.EZCANCELFLAG  = 0 
                AND NOT EXISTS ( 
                    SELECT
                              1 
                        FROM
                            ALL_MDSE_V V 
                        WHERE
                            M.GLBL_CMPY_CD              = V.GLBL_CMPY_CD 
                            AND M.MDSE_CD               = V.MDSE_CD 
                            AND V.SVC_ALLOC_TP_CD    IS NOT NULL 
                            AND V.DFRD_ACCTG_RULE_CD    NOT IN (#OPTIMA_DEFERRAL#, #SUBSCRIPTION_SERVICE#) 
                            AND M.EZCANCELFLAG          = V.EZCANCELFLAG
                )
     </statement>
     
     <!-- 2019/04/05 S21_NA#30819 Add Start -->
     <statement id="getCustIstlInfo" parameterClass="Map" resultClass="Map">
        SELECT
              DCC.DS_CPO_CONFIG_PK
            , DM.CUST_ISTL_FLG
            , SIR.SVC_CUST_ISTL_FLG
        FROM 
              DS_CPO_CONFIG    DCC
            , DS_MDL           DM
            , DS_CPO_ISTL_INFO DCII
            , SVC_ISTL_RULE    SIR
        WHERE 
            DCC.GLBL_CMPY_CD       = #glblCmpyCd#
        AND DCC.CPO_ORD_NUM        = #cpoOrdNum#
        AND DCC.CONFIG_CATG_CD     = #configCatgOut#
        AND DCC.EZCANCELFLAG       = '0'

        AND DCC.GLBL_CMPY_CD       = DM.GLBL_CMPY_CD (+)
        AND DCC.MDL_ID             = DM.MDL_ID (+)
        AND DCC.EZCANCELFLAG (+)   = '0'

        AND DCC.GLBL_CMPY_CD       = DCII.GLBL_CMPY_CD (+)
        AND DCC.CPO_ORD_NUM        = DCII.CPO_ORD_NUM (+)
        AND DCC.DS_CPO_CONFIG_PK   = DCII.DS_CPO_CONFIG_PK (+)
        AND DCII.EZCANCELFLAG (+)  = '0'

        AND DCII.GLBL_CMPY_CD      = SIR.GLBL_CMPY_CD (+)
        AND DCII.SVC_ISTL_RULE_NUM = SIR.SVC_ISTL_RULE_NUM (+)
        AND SIR.EZCANCELFLAG (+)   = '0'
     </statement>
     <!-- 2019/04/05 S21_NA#30819 Add End -->

    <!-- START 2019/04/24 Hd.Sugawara [QC#31125,QC#31126,ADD] -->
    <!-- #################### E099-1300 #################### -->
    <statement id="getActiveSlsRepInfo" parameterClass="Map" resultClass="Map">
        WITH TRGT_PSN AS (
            SELECT
                DISTINCT
                OFA.PSN_CD AS PSN_CD
              , DCSC.SLS_REP_TOC_CD AS SLS_REP_TOC_CD
              , SP.PSN_NUM AS PSN_NUM
            FROM
                DS_CPO_SLS_CR DCSC
              , ORG_FUNC_ASG OFA
              , S21_PSN SP
            WHERE
                    DCSC.GLBL_CMPY_CD    = #glblCmpyCd#
                AND DCSC.EZCANCELFLAG    = '0' 
                AND DCSC.SLS_CR_QUOT_FLG = #slsCrQuotFlg#
                AND DCSC.CPO_ORD_NUM     = #cpoOrdNum#

                AND DCSC.GLBL_CMPY_CD    = OFA.GLBL_CMPY_CD
                AND DCSC.EZCANCELFLAG    = OFA.EZCANCELFLAG
                AND DCSC.SLS_REP_TOC_CD  = OFA.TOC_CD

                AND OFA.GLBL_CMPY_CD     = SP.GLBL_CMPY_CD
                AND OFA.EZCANCELFLAG     = SP.EZCANCELFLAG
                AND OFA.PSN_CD           = SP.PSN_CD
        )
        , ACTV_PSN AS (
            SELECT
                TP.PSN_CD AS PSN_CD
              , TP.SLS_REP_TOC_CD AS SLS_REP_TOC_CD
            FROM
                TOC              TOC
              , ORG_FUNC_ROLE_TP OFRT
              , BIZ_AREA_ORG     BA
              , ORG_FUNC_ASG     OFA
              , S21_PSN          SP
              , S21_ORG          SO
              , TRGT_PSN         TP
            WHERE 
                    TOC.GLBL_CMPY_CD        = #glblCmpyCd#
                AND TOC.EZCANCELFLAG        = '0'

                AND TOC.GLBL_CMPY_CD        = OFRT.GLBL_CMPY_CD
                AND TOC.ORG_FUNC_ROLE_TP_CD = OFRT.ORG_FUNC_ROLE_TP_CD
                AND OFRT.SLS_REP_FLG        = #slsRepFlg#
                AND OFRT.EZCANCELFLAG       = '0'

                AND OFRT.GLBL_CMPY_CD       = BA.GLBL_CMPY_CD
                AND OFRT.FIRST_ORG_CD       = BA.BIZ_AREA_ORG_CD
                AND BA.SLS_FLG              = #slsRepFlg#
                AND BA.ORG_STRU_TP_CD       = #orgStruTpCd#
                AND BA.EZCANCELFLAG         = '0'

                AND TOC.GLBL_CMPY_CD        = OFA.GLBL_CMPY_CD
                AND TOC.TOC_CD              = OFA.TOC_CD
                AND OFA.EZCANCELFLAG        = '0'

                AND OFA.GLBL_CMPY_CD        = SP.GLBL_CMPY_CD
                AND OFA.PSN_CD              = SP.PSN_CD
                <!-- START 2019/07/10 Hd.Sugawara [QC#51286,MOD] -->
                <!-- AND OFA.EFF_FROM_DT     &lt;= #slsDt# -->
                <!-- AND (OFA.EFF_THRU_DT    &gt;= #slsDt# OR OFA.EFF_THRU_DT IS NULL) -->
                <!-- AND SP.EFF_FROM_DT      &lt;= #slsDt# -->
                <!-- AND (SP.EFF_THRU_DT     &gt;= #slsDt# OR SP.EFF_THRU_DT IS NULL) -->
                AND OFA.GNRN_TP_CD          = #gnrnTpCd#
                <!-- END 2019/07/10 Hd.Sugawara [QC#51286,MOD] -->
                AND SP.EZCANCELFLAG         = '0'

                AND TOC.GLBL_CMPY_CD        = SO.GLBL_CMPY_CD
                AND TOC.TOC_CD              = SO.TOC_CD
                AND SO.RGTN_STS_CD         != #rgtnStsCd#
                AND SO.EZCANCELFLAG         = '0'
                AND SP.PSN_CD               = TP.PSN_CD
        )
        SELECT
            DCSC.DS_CPO_CONFIG_PK AS DS_CPO_CONFIG_PK
          , TP.PSN_NUM            AS PSN_NUM
          , AP.SLS_REP_TOC_CD     AS ACTV_TOC_CD
        FROM
            DS_CPO_SLS_CR DCSC
          , TRGT_PSN TP
          , ACTV_PSN AP
        WHERE
                DCSC.GLBL_CMPY_CD    = #glblCmpyCd#
            AND DCSC.EZCANCELFLAG    = '0'
            AND DCSC.SLS_CR_QUOT_FLG = #slsCrQuotFlg#
            AND DCSC.CPO_ORD_NUM     = #cpoOrdNum#

            AND DCSC.SLS_REP_TOC_CD  = TP.SLS_REP_TOC_CD
            AND DCSC.SLS_REP_TOC_CD  = AP.SLS_REP_TOC_CD(+)
    </statement>
    <!-- END 2019/04/24 Hd.Sugawara [QC#31125,QC#31126,ADD] -->

    <!-- 2019/11/22 QC#54213 Add Start -->
    <!-- #################### E099-1310 #################### -->
    <statement id="getOrdLineNoRequireShell" parameterClass="Map" resultClass="Map">
      SELECT
            CD.CPO_DTL_LINE_NUM
         ,  CD.CPO_DTL_LINE_SUB_NUM
         ,  CD.DS_ORD_POSN_NUM
         ,  CD.DS_CPO_LINE_NUM
         ,  CD.DS_CPO_LINE_SUB_NUM
         ,  DCC.DCLN_SVC_CD
        FROM
            CPO                DC
         ,  CPO_DTL            CD
         ,  DS_CPO_CONFIG      DCC
         ,  ORD_CATG_BIZ_CTX   OCB
        WHERE
            DC.GLBL_CMPY_CD           =  #glblCmpyCd#
        AND DC.CPO_ORD_NUM            =  #ordNum#
        AND DC.EZCANCELFLAG           =  '0'

        AND DC.GLBL_CMPY_CD           =  CD.GLBL_CMPY_CD
        AND DC.CPO_ORD_NUM            =  CD.CPO_ORD_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM  !=  #cpoDtlLineSubNumSet#
        AND CD.BASE_CMPT_FLG          =  'Y'
        AND CD.ORD_LINE_STS_CD NOT IN
        <iterate property="ordLineStsList" var="ordLineStsCd[]" open="(" close=")" conjunction=",">
           #ordLineStsCd[]#
        </iterate>
        AND CD.EZCANCELFLAG           =  '0'

        AND CD.GLBL_CMPY_CD           =  DCC.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM            =  DCC.CPO_ORD_NUM
        AND CD.DS_CPO_CONFIG_PK       =  DCC.DS_CPO_CONFIG_PK
        AND DCC.EZCANCELFLAG          =  '0'

        AND DC.GLBL_CMPY_CD           =  OCB.GLBL_CMPY_CD
        AND DC.DS_ORD_CATG_CD         =  OCB.DS_ORD_CATG_CD
        AND (DC.DS_ORD_TP_CD          =  OCB.DS_ORD_TP_CD OR OCB.DS_ORD_TP_CD IS NULL)
        AND OCB.ORD_CATG_CTX_TP_CD    =  #ordCatgCtxTp#
        AND OCB.EZCANCELFLAG          =  '0'

        AND EXISTS (
                SELECT
                    1
                FROM
                     DS_CONTR      CNT
                    ,DS_CONTR_DTL  CNTD
                WHERE
                        CNT.GLBL_CMPY_CD            = CNTD.GLBL_CMPY_CD
                    AND CNT.EZCANCELFLAG            = CNTD.EZCANCELFLAG
                    AND CNT.DS_CONTR_PK             = CNTD.DS_CONTR_PK

                    AND CNTD.CPO_ORD_NUM            = CD.CPO_ORD_NUM
                    AND CNTD.EZCANCELFLAG           = CD.EZCANCELFLAG
                    AND CNTD.CPO_DTL_LINE_NUM       = CD.CPO_DTL_LINE_NUM
                    AND CNTD.CPO_DTL_LINE_SUB_NUM   = CD.CPO_DTL_LINE_SUB_NUM
        )
        AND EXISTS (
                SELECT 
                    1
                FROM 
                    RTL_WH RW 
                WHERE
                        RW.GLBL_CMPY_CD   = #glblCmpyCd#
                    AND RW.RTL_WH_CD      = #rtlWhCd#
                    AND RW.RTL_WH_CD      = CD.RTL_WH_CD
                    AND RW.EZCANCELFLAG   = '0'
        )
    </statement>
    <!-- 2019/11/22 QC#54213 Add End -->

    <!-- 2021/06/03 QC#57285 Add -->
    <statement id="getDsContrCrCrdPo" parameterClass="Map" resultClass="Map">
      SELECT
            CD.CPO_DTL_LINE_NUM
         ,  CD.CPO_DTL_LINE_SUB_NUM
         ,  CNT.PRC_SVC_CONTR_TP_CD
         ,  CNT.PRC_SVC_PLN_TP_CD
         ,  CNT.DS_CONTR_CATG_CD
         ,  CNT.SHELL_LINE_NUM
         ,  CNT.SVC_PGM_MDSE_CD
         ,  CNT.BASE_BLLG_CYCLE_CD
         ,  BC.BLLG_CYCLE_MTH_AOT
         ,  CNTD.MTR_BLLG_CYCLE_CD
         ,  CD.DS_ORD_POSN_NUM
         ,  CD.DS_CPO_LINE_NUM
         ,  CD.DS_CPO_LINE_SUB_NUM
         ,  DCC.DCLN_SVC_CD
         ,  CNT.MAN_CONTR_OVRD_FLG
         ,  CNT.DS_CONTR_PK
         ,  CNTD.DS_CONTR_DTL_PK
         ,  CNT.FROM_PER_MTH_NUM
         ,  CNT.TO_PER_MTH_NUM
         ,  CNT.ALT_PAYER_CUST_CD
         ,  CNT.DS_ACCT_NUM
         ,  CNT.MTR_BLLG_CYCLE_CD AS HD_MTR_BLLG_CYCLE_CD
         ,  BCFU.BLLG_CYCLE_MTH_AOT AS USG_BLLG_CYCLE_MTH_AOT
         ,  CNTD.MTR_READ_METH_CD
         ,  DCP.CUST_PO_NUM
         ,  DCP.PO_DT
         ,  DCP.CUST_ISS_PO_DT
         ,  DCP.DS_CONTR_MACH_LVL_NUM
        FROM
            CPO                DC
         ,  CPO_DTL            CD
         ,  DS_CPO_CONFIG      DCC
         ,  ORD_CATG_BIZ_CTX   OCB
         ,  DS_CONTR      CNT
         ,  DS_CONTR_DTL  CNTD
         ,  DS_CONTR_CATG CNTC
         ,  BLLG_CYCLE    BC
         ,  BLLG_CYCLE    BCFU
         ,  DS_CONTR_CR_CARD_PO DCP
        WHERE
            DC.GLBL_CMPY_CD           =  #glblCmpyCd#
        AND DC.CPO_ORD_NUM            =  #ordNum#
        AND DC.EZCANCELFLAG           =  '0'
        AND DC.GLBL_CMPY_CD            =  OCB.GLBL_CMPY_CD
        AND DC.DS_ORD_CATG_CD          =  OCB.DS_ORD_CATG_CD
        AND (DC.DS_ORD_TP_CD           =  OCB.DS_ORD_TP_CD OR OCB.DS_ORD_TP_CD IS NULL)
        AND OCB.ORD_CATG_CTX_TP_CD     =  #ordCatgCtxTp#
        AND OCB.EZCANCELFLAG           =  '0'
        AND DC.GLBL_CMPY_CD            = CNT.GLBL_CMPY_CD
        AND DC.CPO_ORD_NUM             = CNT.CPO_ORD_NUM
        AND CNT.EZCANCELFLAG           = '0'
        AND CNT.GLBL_CMPY_CD           = CNTD.GLBL_CMPY_CD
        AND CNT.DS_CONTR_PK            = CNTD.DS_CONTR_PK
        AND CNTD.EZCANCELFLAG          = '0'
        AND CNTD.DS_CONTR_CRAT_TP_CD   = #dsContrCratTpCd#
        AND CNTD.GLBL_CMPY_CD           = CD.GLBL_CMPY_CD(+)
        AND CNTD.CPO_ORD_NUM            = CD.CPO_ORD_NUM(+)
        AND CNTD.CPO_DTL_LINE_NUM       = CD.CPO_DTL_LINE_NUM(+)
        AND CNTD.CPO_DTL_LINE_SUB_NUM   = CD.CPO_DTL_LINE_SUB_NUM(+)
        AND CD.CPO_DTL_LINE_SUB_NUM(+) !=  #cpoDtlLineSubNumSet#
        AND CD.BASE_CMPT_FLG(+)         =  'Y'
        AND CD.EZCANCELFLAG(+)          = '0'
        AND CD.GLBL_CMPY_CD            =  DCC.GLBL_CMPY_CD(+)
        AND CD.CPO_ORD_NUM             =  DCC.CPO_ORD_NUM(+)
        AND CD.DS_CPO_CONFIG_PK        =  DCC.DS_CPO_CONFIG_PK(+)
        AND DCC.EZCANCELFLAG(+)        =  '0'
        AND CNT.GLBL_CMPY_CD          = CNTC.GLBL_CMPY_CD(+)
        AND CNT.DS_CONTR_CATG_CD      = CNTC.DS_CONTR_CATG_CD(+)
        AND CNTC.OM_CATG_FLG(+)       = 'Y'
        AND CNTC.EZCANCELFLAG(+)      = '0'
        AND CNT.GLBL_CMPY_CD           = BC.GLBL_CMPY_CD(+)
        AND CNT.BASE_BLLG_CYCLE_CD     = BC.BLLG_CYCLE_CD(+)
        AND BC.BLLG_CYCLE_ACTV_FLG(+)  = 'Y'
        AND BC.OM_CYCLE_FLG(+)         = 'Y'
        AND CNT.GLBL_CMPY_CD            = BCFU.GLBL_CMPY_CD(+)
        AND CNT.MTR_BLLG_CYCLE_CD       = BCFU.BLLG_CYCLE_CD(+)
        AND BCFU.BLLG_CYCLE_ACTV_FLG(+) = 'Y'
        AND BCFU.OM_CYCLE_FLG(+)        = 'Y'
        AND CNTD.GLBL_CMPY_CD           = DCP.GLBL_CMPY_CD(+)
        AND CNTD.DS_CONTR_DTL_PK        = DCP.DS_CONTR_DTL_PK (+)
        AND DCP.EZCANCELFLAG(+)         = '0'
      ORDER BY CNT.SHELL_LINE_NUM
    </statement>
    <!-- 2022/12/22 QC#60398 Add End -->
    <statement id="getTrxRuleTp" parameterClass="Map" resultClass="String">
        SELECT
            DISTINCT FIRST_BIZ_CTX_ATTRB_TXT
        FROM
            ORD_CATG_BIZ_CTX   A
        WHERE
            A.GLBL_CMPY_CD         =   #glblCmpyCd#
        AND A.EZCANCELFLAG         =   '0'
        AND A.ORD_CATG_CTX_TP_CD   =   #equipOrd#
    </statement>
    <!-- 2022/12/22 QC#60398 Add End -->

    <!-- START 2023/01/30 R.Azucena [QC#61094, ADD] -->
    <!-- #################### E099-1330 #################### -->
    <statement id="getLoanOrdersCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS CNT
        FROM
            CPO_DTL CD
        WHERE
            CD.GLBL_CMPY_CD        = #glblCmpyCd#
        AND CD.CPO_ORD_NUM         = #ordNum#
        AND CD.DS_ORD_LINE_CATG_CD = #ordLineCatgCd#
        AND CD.DS_CPO_CONFIG_PK    = #dsCpoConfigPk#
        AND CD.DS_ORD_POSN_NUM     = #dsOrdPosnNum#
        AND CD.EZCANCELFLAG        = '0'
        AND CD.ORD_LINE_STS_CD     != #ordLineSts#
    </statement>

    <statement id="getCpoConfigList" parameterClass="Map" resultClass="Map">
        SELECT
            DCC.DS_CPO_CONFIG_PK
         ,  DCC.DS_ORD_POSN_NUM
         ,  DCC.CONFIG_CATG_CD
        FROM
        <!-- START 2024/03/01 t.aizawa [QC#54186, MOD] -->
             DS_CPO_CONFIG DCC
            ,CPO_DTL       CD
        WHERE
        <!-- START 2023/10/06 K.Watanabe [QC#54186, MOD] -->
        <!--         DCC.GLBL_CMPY_CD = #glblCmpyCd# -->
        <!--     AND DCC.CPO_ORD_NUM  = #ordNum# -->
        <!--     AND DCC.EZCANCELFLAG = '0' -->
                DCC.GLBL_CMPY_CD   = #glblCmpyCd#
            AND DCC.CPO_ORD_NUM    = #ordNum#
        <isNotNull property="configCatgCd">
            AND DCC.CONFIG_CATG_CD = #configCatgCd#
        </isNotNull>
            AND DCC.EZCANCELFLAG   = '0'
        <!-- END 2023/10/06 K.Watanabe [QC#54186, MOD] -->
            AND DCC.GLBL_CMPY_CD     = CD.GLBL_CMPY_CD
            AND DCC.DS_CPO_CONFIG_PK = CD.DS_CPO_CONFIG_PK
            AND CD.CR_REBIL_CD       IS NULL
            AND CD.EZCANCELFLAG      = '0'
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                    DS_COND_CONST X
                WHERE
                        X.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                    AND X.DS_COND_CONST_CD     = CD.DS_ORD_LINE_CATG_CD
                    AND X.DS_COND_CONST_GRP_ID = #dsCondConstGrpId#
                    AND X.EZCANCELFLAG         = '0'
                )
        GROUP BY
             DCC.DS_CPO_CONFIG_PK
            ,DCC.DS_ORD_POSN_NUM
            ,DCC.CONFIG_CATG_CD
        <!-- END 2024/03/01 t.aizawa [QC#54186, MOD] -->
    </statement>
    <!-- END 2023/01/30 R.Azucena [QC#61094, ADD] -->

    <!-- START 2023/10/06 K.Watanabe [QC#54186, ADD] -->
    <statement id="getDsCpoIstlInfo" parameterClass="Map" resultClass="Map">
        SELECT
            ISTL_BY_SVC_PRVD_PTY_CD
           ,SVC_BY_SVC_PRVD_PTY_CD
        FROM
            DS_CPO_ISTL_INFO DCII
        WHERE
                DCII.GLBL_CMPY_CD     = #glblCmpyCd#
            AND DCII.DS_CPO_CONFIG_PK = #dsCpoConfigPk#
            AND DCII.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getCpoConfigSvcPrvdPtyCdCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS CNT
        FROM
            DS_CPO_ISTL_INFO DCII
        WHERE
                DCII.GLBL_CMPY_CD     = #glblCmpyCd#
            AND DCII.CPO_ORD_NUM      = #ordNum#
            AND DCII.DS_CPO_CONFIG_PK = #dsCpoConfigPk#
            AND (
                    DCII.ISTL_BY_SVC_PRVD_PTY_CD IS NULL
                 OR DCII.SVC_BY_SVC_PRVD_PTY_CD IS NULL
                )
            AND ((EXISTS
                    (SELECT
                        1
                    FROM
                        CPO_DTL CD
                       ,ORD_TAKE_MDSE OTM, MDSE M
                    WHERE
                        DCII.DS_CPO_CONFIG_PK = CD.DS_CPO_CONFIG_PK
                    AND CD.MDSE_CD = OTM.ORD_TAKE_MDSE_CD (+)
                    AND NVL(OTM.MDSE_CD, CD.MDSE_CD) = M.MDSE_CD
                    AND M.MDSE_ITEM_TP_CD = #accessory#)
                 AND NOT EXISTS
                    (SELECT
                        1
                    FROM
                        CPO_DTL CD
                       ,ORD_TAKE_MDSE OTM, MDSE M
                    WHERE DCII.DS_CPO_CONFIG_PK = CD.DS_CPO_CONFIG_PK
                   AND CD.MDSE_CD = OTM.ORD_TAKE_MDSE_CD (+)
                   AND NVL(OTM.MDSE_CD, CD.MDSE_CD) = M.MDSE_CD
                   AND M.MDSE_ITEM_TP_CD != #accessory#))
            OR (EXISTS
                  (SELECT
                      1
                  FROM
                      CPO_DTL       CD
                     ,ORD_TAKE_MDSE OTM
                     ,MDSE          M
                  WHERE
                      DCII.DS_CPO_CONFIG_PK = CD.DS_CPO_CONFIG_PK
                  AND CD.MDSE_CD = OTM.ORD_TAKE_MDSE_CD (+)
                  AND NVL(OTM.MDSE_CD, CD.MDSE_CD) = M.MDSE_CD
                  AND M.MDSE_ITEM_TP_CD = #software#)
               AND NOT EXISTS
                  (SELECT
                      1
                  FROM
                      CPO_DTL CD
                     ,ORD_TAKE_MDSE OTM, MDSE M
                  WHERE
                      DCII.DS_CPO_CONFIG_PK = CD.DS_CPO_CONFIG_PK
                  AND CD.MDSE_CD = OTM.ORD_TAKE_MDSE_CD (+)
                  AND NVL(OTM.MDSE_CD, CD.MDSE_CD) = M.MDSE_CD
                  AND M.MDSE_ITEM_TP_CD != #software#)))
           AND DCII.EZCANCELFLAG     = '0'
    </statement>
    <!-- END 2023/10/06 K.Watanabe [QC#54186, ADD] -->
</sqlMap>
