<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NLGB021001">

    <statement id="getSo" parameterClass="Map">
        SELECT
               SO.SO_NUM
              ,SO.TRX_HDR_NUM
              ,SO.PICK_TKT_NUM
              ,SUBSTR(SO.CUST_ISS_PO_NUM,0 , #lgCustIssPoNum#) AS CUST_ISS_PO_NUM
              ,SO.SELL_TO_CUST_CD
              ,SO.BILL_TO_CUST_CD
              ,CASE WHEN SO.DROP_SHIP_FLG = 'Y' THEN #shipToCustCd# ELSE SO.SHIP_TO_CUST_CD END AS SHIP_TO_CUST_CD
              ,CASE WHEN SO.EXPT_SHPG_METH_CD IS NULL THEN SV.S80_SHIP_VIA_CD ELSE SO.EXPT_SHPG_METH_CD END AS EXPT_SHPG_METH_CD
              ,CASE WHEN SO.EXPT_SHPG_METH_CD IS NULL THEN S8.S80_SHIP_VIA_NM ELSE SM.SHPG_METH_NM END AS SHPG_METH_NM
              ,CASE WHEN LENGTH(SO.SO_CRAT_TS) &gt; #lgSoCratTs# THEN SUBSTR(SO.SO_CRAT_TS, 0, #lgSoCratTs#) ELSE SO.SO_CRAT_TS END AS SO_CRAT_TS
              ,CASE WHEN SO.PSD_DT IS NOT NULL THEN SO.PSD_DT || #valTs# END AS PSD_DT
              ,CASE WHEN SO.RDD_DT IS NOT NULL THEN SO.RDD_DT || #valTs# END AS RDD_DT
              ,SO.DNLD_TM_TS
              ,SO.CARR_CD AS WMS_SO_CARR_CD
              ,SO.DROP_SHIP_FLG
              ,SO.PRINT_SCC_LB_FLG
              ,SO.PRINT_UCC_LB_FLG
              ,SO.MIX_PLT_ALLW_FLG
              ,SO.PRINT_PLT_UCC_LB_FLG
              ,SO.PRINT_NON_ASN_UCC_LB_FLG
              ,SO.ASN_REQ_FLG
              ,NVL(SO.UCC_NUM_CD, #val1#) AS UCC_NUM_CD
              ,SO.EDI_TP_CD
              ,SO.CUST_STORE_NUM
              ,SO.SO_DEPT_NUM
              ,CASE WHEN TRUNC(SO.TOT_SHIP_AMT, #val2#) &gt; #maxTotShipAmt# THEN #maxTotShipAmt# ELSE TRUNC(SO.TOT_SHIP_AMT, #val2#) END AS TOT_SHIP_AMT
              ,SO.RTRN_LB_CD
              ,SO.SO_CONFIG_FLG
              ,SO.CARR_ACCT_NUM
              ,SO.WH_CD AS RTL_WH_CD
              ,NVL(SO.SCHD_DELY_DT, SO.RDD_DT) AS SCHD_DELY_DT
              ,NVL(SO.CARR_CD, SO.VND_CD) AS CARR_CD
              ,SO.VND_CD
              ,SO.SHPG_SVC_LVL_CD
              ,SV.SHPG_SVC_LVL_CD AS CONV_SHPG_SVC_LVL_CD
              ,SO.SVC_CONFIG_MSTR_PK
              ,SO.PRE_ISTL_SHOP_RQST_FLG
              ,SO.WMS_RTE_PATH_CD
              ,SO.SRC_ORD_NUM
              ,SO.SCE_ORD_TP_CD
              ,SC.SCE_ORD_TP_CD AS CONV_SCE_ORD_TP_CD
              ,SO.TRX_SRC_TP_CD
              ,OS.TRX_SRC_TP_CD AS CONV_TRX_SRC_TP_CD
              ,SO.FRT_CHRG_TO_CD
              ,SO.FRT_CHRG_METH_CD
              ,ST.FRT_CHRG_TO_CD AS CONV_FRT_CHRG_TO_CD
              ,ST.FRT_CHRG_METH_CD AS CONV_FRT_CHRG_METH_CD
              ,WW.WMS_UNIQ_ID
              ,WW.WMS_SO_DNLD_SO_INTFC_ID
              ,WW.WMS_SO_DNLD_PO_INTFC_ID
              ,WW.WH_CD
              ,CM.S80_CMPY_CD
              ,SC.S80_ORD_TP_CD
              ,SC.S80_TRX_CD
              ,SC.SCE_ORD_TP_NM
              ,OS.S80_ORD_SRC_CD
              ,SV.S80_SHIP_VIA_CD
              ,S8.S80_SHIP_VIA_NM
              ,ST.S80_SHPG_TERM_CD
              ,SS.S80_SHPG_TERM_NM
              ,SUBSTR(OC.DS_ORD_CATG_DESC_TXT, 0, #lgOtbdSrcOrdTpTxt#) AS OTBD_SRC_ORD_TP_TXT
              ,SP.LOC_GRP_CD
              ,SUBSTR(CP_PSN.PSN_FIRST_NM || ' ' || CP_PSN.PSN_LAST_NM, 0, #lgPsnNm#) AS CPO_PSN_NM
              ,SUBSTR(PO_PSN.PSN_FIRST_NM || ' ' || PO_PSN.PSN_LAST_NM, 0, #lgPsnNm#) AS PO_PSN_NM
              ,SUBSTR(SR_PSN.PSN_FIRST_NM || ' ' || SR_PSN.PSN_LAST_NM, 0, #lgPsnNm#) AS SR_PSN_NM
          FROM
               SHPG_ORD        SO
              ,WMS_WH          WW
              ,RTL_WH          RWH
              ,CMPY_CD_CONV    CM
              ,SCE_ORD_TP      SC
              ,ORD_SRC_CONV    OS
              ,SHIP_VIA_CONV   SV
              ,SHPG_METH       SM
              ,S80_SHIP_VIA    S8
              ,SHPG_TERM_CONV  ST
              ,S80_SHPG_TERM   SS
              ,CPO             CP
              ,PO              PO
              ,DS_ORD_CATG     OC
              ,SHIP_TO_CUST    SP
              ,S21_PSN         CP_PSN
              ,S21_PSN         PO_PSN
              ,S21_PSN         SR_PSN
              ,ORG_FUNC_ASG    OG
         WHERE
               SO.GLBL_CMPY_CD        = #glblCmpyCd#
           AND SO.WMS_DROP_FLG        = #notDrop#
           AND SO.WMS_DROP_RQST_FLG   = #dropReady#
           AND SO.GLBL_CMPY_CD        = WW.GLBL_CMPY_CD
           AND WW.WH_CD          IN
           <iterate property="wmsTrgtWhCd" var="elem[]" open="(" close=")" conjunction=",">
               #elem[]#
           </iterate>
           AND WW.GLBL_CMPY_CD        = RWH.GLBL_CMPY_CD
           AND WW.WH_CD               = RWH.WMS_WH_CD
           AND RWH.RTL_WH_CD          = SO.WH_CD
           AND RWH.WH_SYS_TP_CD       = #wms#
           AND RWH.SO_PRIN_REQ_FLG    = #flgY#
           AND SO.GLBL_CMPY_CD        = CM.GLBL_CMPY_CD(+)
           AND SO.GLBL_CMPY_CD        = SC.GLBL_CMPY_CD(+)
           AND SO.SCE_ORD_TP_CD       = SC.SCE_ORD_TP_CD(+)
           AND SC.INBD_OTBD_CD(+)     = #outbound#
           AND SO.GLBL_CMPY_CD        = OS.GLBL_CMPY_CD(+)
           AND SO.TRX_SRC_TP_CD       = OS.TRX_SRC_TP_CD(+)
           AND SO.GLBL_CMPY_CD        = SV.GLBL_CMPY_CD(+)
           AND SO.SHPG_SVC_LVL_CD     = SV.SHPG_SVC_LVL_CD(+)
           AND SO.GLBL_CMPY_CD        = SM.GLBL_CMPY_CD(+)
           AND SO.EXPT_SHPG_METH_CD   = SM.SHPG_METH_CD(+)
           AND SV.GLBL_CMPY_CD        = S8.GLBL_CMPY_CD(+)
           AND SV.S80_SHIP_VIA_CD     = S8.S80_SHIP_VIA_CD(+)
           AND SO.GLBL_CMPY_CD        = ST.GLBL_CMPY_CD(+)
           AND SO.FRT_CHRG_TO_CD      = ST.FRT_CHRG_TO_CD(+)
           AND SO.FRT_CHRG_METH_CD    = ST.FRT_CHRG_METH_CD(+)
           AND ST.GLBL_CMPY_CD        = SS.GLBL_CMPY_CD(+)
           AND ST.S80_SHPG_TERM_CD    = SS.S80_SHPG_TERM_CD(+)
           AND SO.GLBL_CMPY_CD        = CP.GLBL_CMPY_CD(+)
           AND SO.TRX_HDR_NUM         = CP.CPO_ORD_NUM(+)
           AND CP.GLBL_CMPY_CD        = OC.GLBL_CMPY_CD(+)
           AND CP.DS_ORD_CATG_CD      = OC.DS_ORD_CATG_CD(+)
           AND SO.GLBL_CMPY_CD        = SP.GLBL_CMPY_CD(+)
           AND SO.SHIP_TO_CUST_CD     = SP.SHIP_TO_CUST_CD(+)
           AND CP.GLBL_CMPY_CD        = CP_PSN.GLBL_CMPY_CD(+)
           AND CP.ADMIN_PSN_CD        = CP_PSN.PSN_CD(+)
           AND SO.GLBL_CMPY_CD        = PO.GLBL_CMPY_CD(+)
           AND SO.TRX_HDR_NUM         = PO.PO_ORD_NUM(+)
           AND PO.GLBL_CMPY_CD        = PO_PSN.GLBL_CMPY_CD(+)
           AND PO.PO_SUBMT_PSN_CD     = PO_PSN.PSN_CD(+)
           AND CP.GLBL_CMPY_CD        = OG.GLBL_CMPY_CD(+)
           AND CP.SLS_REP_TOC_CD      = OG.TOC_CD(+)
           AND NVL(OG.EFF_FROM_DT(+), #minDt#) &lt;= #slsDt#
           AND NVL(OG.EFF_THRU_DT(+), #maxDt#) &gt;= #slsDt#
           AND OG.GLBL_CMPY_CD        = SR_PSN.GLBL_CMPY_CD(+)
           AND OG.PSN_CD              = SR_PSN.PSN_CD(+)
           AND SO.EZCANCELFLAG        = '0'
           AND WW.EZCANCELFLAG        = '0'
           AND RWH.EZCANCELFLAG       = '0'
           AND CM.EZCANCELFLAG(+)     = '0'
           AND SC.EZCANCELFLAG(+)     = '0'
           AND OS.EZCANCELFLAG(+)     = '0'
           AND SV.EZCANCELFLAG(+)     = '0'
           AND SM.EZCANCELFLAG(+)     = '0'
           AND S8.EZCANCELFLAG(+)     = '0'
           AND ST.EZCANCELFLAG(+)     = '0'
           AND SS.EZCANCELFLAG(+)     = '0'
           AND CP.EZCANCELFLAG(+)     = '0'
           AND OC.EZCANCELFLAG(+)     = '0'
           AND SP.EZCANCELFLAG(+)     = '0'
           AND OG.EZCANCELFLAG(+)     = '0'
           AND CP_PSN.EZCANCELFLAG(+) = '0'
           AND PO_PSN.EZCANCELFLAG(+) = '0'
           AND SR_PSN.EZCANCELFLAG(+) = '0'
         ORDER BY
               SO.SO_NUM
              ,WW.WH_CD
    </statement>

    <statement id="getSoDtl" parameterClass="Map" resultClass="Map">
        SELECT
               TO_NUMBER(SOD.SO_SLP_NUM) AS SO_SLP_NUM
              ,SOD.MDSE_CD
              ,SOD.CUST_MDSE_CD
              ,SOD.RQST_ORD_QTY
              ,SOD.SHPG_BAL_QTY
              ,SOD.SHPG_QTY
              ,CASE WHEN TRUNC(SOD.UNIT_PRC_AMT, #val2#) &gt; #maxQty# THEN #maxQty# ELSE TRUNC(SOD.UNIT_PRC_AMT, #val2#) END AS UNIT_PRC_AMT
              ,CASE WHEN TRUNC(SOD.DISC_PRC_AMT, #val2#) &gt; #maxQty# THEN #maxQty# ELSE TRUNC(SOD.DISC_PRC_AMT, #val2#) END AS DISC_PRC_AMT
              ,CASE WHEN TRUNC(SOD.DISC_UNIT_PRC_AMT, #val2#) &gt; #maxQty# THEN #maxQty# ELSE TRUNC(SOD.DISC_UNIT_PRC_AMT, #val2#) END AS DISC_UNIT_PRC_AMT
              ,SOD.SER_NUM_TAKE_FLG
              ,SOD.SET_MDSE_CD
              ,SOD.SET_MDSE_NM
              ,SOD.SET_SHPG_QTY
              ,SOD.IN_EACH_QTY
              ,SOD.TOT_SHPG_WT
              ,SOD.TOT_SHPG_VOL
              ,SOD.BAT_NUM_TAKE_FLG
              ,SOD.CONFIG_ITEM_FLG
              ,SOD.RTL_WH_CD
              ,SOD.RTL_SWH_CD
              ,SOD.PICK_SVC_CONFIG_MSTR_PK
              ,SOD.BACK_ORD_IMPCT_TP_CD
              ,SOD.TRX_HDR_NUM
              ,SOD.TRX_LINE_NUM
              ,SOD.TRX_LINE_SUB_NUM
              ,SOD.CONFIG_ITEM_FLG
              ,SOD.RMV_CONFIG_FLG
              ,SOD.FROM_STK_STS_CD
              ,STK_FROM.STK_STS_CD AS CONV_FROM_STK_STS_CD
              ,SOD.TO_STK_STS_CD
              ,STK_TO.STK_STS_CD AS CONV_TO_STK_STS_CD
              ,SOD.PRE_ISTL_SHOP_RQST_FLG
              ,SOD.PRCH_REQ_NUM
              ,SOD.PRCH_REQ_LINE_NUM
              ,SOD.PRCH_REQ_LINE_SUB_NUM
              ,STK_FROM.S80_STK_STS_CD AS S80_STK_STS_CD_FROM
              ,STK_TO.S80_STK_STS_CD AS S80_STK_STS_CD_TO
              ,MDS.RTRN_REQ_PRT_FLG
              ,MDS.MDSE_ITEM_TP_CD
          FROM
               SHPG_ORD_DTL             SOD
              ,STK_STS_CONV             STK_FROM
              ,STK_STS_CONV             STK_TO
              ,MDSE                     MDS
         WHERE
               SOD.GLBL_CMPY_CD         = #glblCmpyCd#
           AND SOD.SO_NUM               = #soNum#
           AND SOD.GLBL_CMPY_CD         = STK_FROM.GLBL_CMPY_CD(+)
           AND SOD.FROM_STK_STS_CD      = STK_FROM.STK_STS_CD(+)
           AND SOD.GLBL_CMPY_CD         = STK_TO.GLBL_CMPY_CD(+)
           AND SOD.TO_STK_STS_CD        = STK_TO.STK_STS_CD(+)
           AND SOD.GLBL_CMPY_CD         = MDS.GLBL_CMPY_CD(+)
           AND SOD.MDSE_CD              = MDS.MDSE_CD(+)
           AND SOD.EZCANCELFLAG         = '0'
           AND STK_FROM.EZCANCELFLAG(+) = '0'
           AND STK_TO.EZCANCELFLAG(+)   = '0'
           AND MDS.EZCANCELFLAG(+)      = '0'
         ORDER BY
               SO_SLP_NUM
    </statement>

    <statement id="getCaseAndPallet" parameterClass="Map">
        SELECT
               DECODE(WIM.UNIT_CRTN_QTY, 0, NULL, ROUND(#wmsShipQty#/WIM.UNIT_CRTN_QTY, #qtyDecimalPlace#)) CASES
              ,DECODE(WIM.UNIT_PLT_QTY, 0, NULL, ROUND(#wmsShipQty#/WIM.UNIT_PLT_QTY, #qtyDecimalPlace#)) PALLETS
          FROM
               WMS_INBD_MDSE WIM
         WHERE
               GLBL_CMPY_CD = #glblCmpyCd#
           AND EZCANCELFLAG = '0'
           AND WH_CD        = #whCd#
           AND WMS_MDSE_CD  = #mdseCd#
           AND WMS_SQ_NUM   = (
                   SELECT
                          MAX(WMS_SQ_NUM)
                     FROM
                          WMS_INBD_MDSE WIM2
                    WHERE
                          WIM2.WMS_MDSE_CD  = WIM.WMS_MDSE_CD
                      AND WIM2.GLBL_CMPY_CD = WIM.GLBL_CMPY_CD
                      AND WIM2.WH_CD        = WIM.WH_CD
                      AND WIM2.EZCANCELFLAG = '0'
               )
    </statement>

    <statement id="getStoreKeyTxt" parameterClass="Map">
        SELECT
               WMS_DESC_SHORT_NM WMS_DESC_SHORT_NM
          FROM
               WMS_WH
         WHERE
               GLBL_CMPY_CD = #glblCmpyCd#
           AND EZCANCELFLAG = '0'
           AND WH_CD        = #whCd#
    </statement>
    
    <statement id="getdsOrdCatgCd" parameterClass="Map">
        SELECT
                DS_ORD_CATG_CD DS_ORD_CATG_CD
               ,ORD_BOOK_TS ORD_BOOK_TS
          FROM
               CPO
         WHERE
               GLBL_CMPY_CD = #glblCmpyCd#
           AND EZCANCELFLAG = '0'
           AND CPO_ORD_NUM        = #cpoOrdNum#
    </statement>
    
    <statement id="getSoSer" parameterClass="Map">
        SELECT
               SER_NUM 	SER_NUM
          FROM
               SO_SER
         WHERE
               GLBL_CMPY_CD = #glblCmpyCd#
           AND EZCANCELFLAG = '0'
           AND SO_NUM        = #soNum#
    </statement>

    <statement id="getHazmatMdse" parameterClass="Map">
        SELECT
               WMS_HAZ_MAT_FLG
          FROM
               WMS_INBD_MDSE WIM
         WHERE
               GLBL_CMPY_CD = #glblCmpyCd#
           AND EZCANCELFLAG = '0'
           AND WH_CD        = #whCd#
           AND WMS_MDSE_CD  = #mdseCd#
           AND WMS_SQ_NUM   = (
                   SELECT
                          MAX(WMS_SQ_NUM)
                     FROM
                          WMS_INBD_MDSE WIM2
                    WHERE
                          WIM2.WMS_MDSE_CD  = WIM.WMS_MDSE_CD
                      AND WIM2.GLBL_CMPY_CD = WIM.GLBL_CMPY_CD
                      AND WIM2.WH_CD        = WIM.WH_CD
                      AND WIM2.EZCANCELFLAG = '0'
               )
           AND WMS_HAZ_MAT_FLG = #wmsHazMatFlg#
    </statement>

    <statement id="countWmsInbdSo" parameterClass="Map" resultClass="BigDecimal">
        SELECT
               COUNT(*)
          FROM
               WMS_INBD_SO_HDR WISH
         WHERE
               WISH.GLBL_CMPY_CD = #glblCmpyCd#
           AND WISH.WMS_SO_ID    = #soNum#
           AND WISH.EZCANCELFLAG = '0'
    </statement>

    <statement id="getTechMstrInfo" parameterClass="Map" >
        SELECT
             TM.TECH_TOC_CD TECH_TOC_CD
            ,TM.TECH_NM TECH_NM
            ,TM.EML_ADDR
        FROM
            TECH_MSTR TM 
        WHERE
            TM.GLBL_CMPY_CD = #glblCmpyCd#
        AND TM.TECH_TOC_CD IN
            (
                SELECT
                    TL.TECH_TOC_CD
                FROM
                    TECH_LOC TL
                WHERE
                    TL.GLBL_CMPY_CD = #glblCmpyCd#
                AND TL.TECH_LOC_CD  = #techTocCd#
                AND TL.EZCANCELFLAG = '0'
            )
        AND TM.EZCANCELFLAG = '0'
    </statement>

    <statement id="getTplMoSoTpTxt" parameterClass="Map" resultClass="String">
        SELECT
            PRT.PRCH_REQ_TP_NM 	PRCH_REQ_TP_NM
        FROM
            PRCH_REQ PR,
            PRCH_REQ_TP PRT
        WHERE
            PR.GLBL_CMPY_CD = #glblCmpyCd#
        AND PR.GLBL_CMPY_CD = PRT.GLBL_CMPY_CD
        AND PR.PRCH_REQ_TP_CD = PRT.PRCH_REQ_TP_CD
        AND PR.PRCH_REQ_NUM = #prchReqNum#
        AND PR.EZCANCELFLAG = '0'
        AND PRT.EZCANCELFLAG = '0'
    </statement>

    <statement id="getTplCarrSvcLvl" parameterClass="Map" resultClass="Map">
        SELECT
             MAIN.TPL_CARR_CD
            ,MAIN.TPL_SVC_LVL_CD
        FROM (
                  SELECT
                       TCSL.TPL_CARR_CD         AS TPL_CARR_CD
                      ,TCSL.TPL_SVC_LVL_CD      AS TPL_SVC_LVL_CD
                  FROM
                      TPL_CARR_SVC_LVL  TCSL
                  WHERE
                      TCSL.GLBL_CMPY_CD        = #glblCmpyCd#
                  AND TCSL.WH_OWNR_CD          = #whOwnrCd#
                  <isEqual property="tplSvcLvlCdTpCond" compareValue="0">
                      AND TCSL.TPL_SVC_LVL_CD  = '1.5'
                  </isEqual>
                  <isEqual property="tplSvcLvlCdTpCond" compareValue="1">
                      AND TCSL.TPL_SVC_LVL_CD != '1.5'
                  </isEqual>
                  <isNotNull property="carrCd">
                      AND TCSL.CARR_CD         = #carrCd# 
                  </isNotNull>
                  <isNull property="carrCd">
                      AND TCSL.CARR_CD         IS NULL 
                  </isNull>
                  <isNotNull property="shpgSvcLvlCd">
                      AND TCSL.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
                  </isNotNull>
                  <isNull property="shpgSvcLvlCd">
                      AND TCSL.SHPG_SVC_LVL_CD IS NULL
                  </isNull>
                  AND TCSL.EZCANCELFLAG  = '0'
                  ORDER BY
                      TPL_CARR_SVC_LVL_SORT_NUM ASC
             ) MAIN
        WHERE ROWNUM = 1
    </statement>

    <statement id="getdsCpoCtacPsn" parameterClass="Map" resultClass="Map">
        SELECT
            DCCP.CTAC_PSN_FIRST_NM
           ,DCCP.CTAC_PSN_MID_NM
           ,DCCP.CTAC_PSN_LAST_NM
           ,DCCP.CTAC_PSN_TEL_NUM 
        FROM (
           SELECT * FROM DS_CPO_CTAC_PSN
           WHERE
                CPO_ORD_NUM    = #cpoOrdNum#
            AND CTAC_PSN_TP_CD = #ctacPsnTpCd#
            ORDER BY 
                DS_CPO_CTAC_PSN_PK DESC
        ) DCCP
        WHERE ROWNUM = 1
    </statement>

    <statement id="getHazMatInfo" parameterClass="Map" resultClass="Map">
        SELECT
             WIM.WMS_HAZ_MAT_FLG
            ,WIM.SER_NUM_REQ_TP_CD
            ,MAX(WIM.WMS_SQ_NUM) AS MAX_WMS_SQ_NUM
        FROM
            WMS_INBD_MDSE WIM
        WHERE
            WIM.GLBL_CMPY_CD = #glblCmpyCd#
        AND WIM.WMS_MDSE_CD  = #mdseCd#
        AND WIM.EZCANCELFLAG = '0'
        GROUP BY
             WIM.WMS_HAZ_MAT_FLG
            ,WIM.SER_NUM_REQ_TP_CD
        ORDER BY
            MAX_WMS_SQ_NUM DESC
    </statement>

    <statement id="getSoCustDtl" parameterClass="Map" resultClass="Map">
        SELECT
            SUBSTR(SC.SO_CUST_LINE_LOC_NM_01, 0, #lgLineColNm#) AS SO_CUST_LINE_LOC_NM_01
           ,SUBSTR(SC.SO_CUST_LINE_LOC_NM_02, 0, #lgLineColNm#) AS SO_CUST_LINE_LOC_NM_02
           ,SC.SO_CUST_LINE_ADDR_01
           ,SC.SO_CUST_LINE_ADDR_02
           ,SC.SO_CUST_LINE_ADDR_03
           ,SC.SO_CUST_LINE_ADDR_04
           ,SC.CTY_ADDR
           ,SC.ST_CD
           ,SC.POST_CD
           ,SC.CTRY_CD
           ,SC.CTAC_PTNR_PSN_NM
           ,SUBSTR(SC.CTAC_PTNR_PSN_TEL_NUM, 0, #lgCtacTelNum#) AS CTAC_PTNR_PSN_TEL_NUM
           ,SC.SHIP_TO_CTAC_PSN_NM
          FROM
               SHPG_ORD_CUST_DTL SC
         WHERE
               SC.GLBL_CMPY_CD        = #glblCmpyCd#
           AND SC.SO_NUM              = #soNum#
           AND SC.SO_CUST_DATA_TP_CD  = #soCustDataTpCd#
           AND SC.EZCANCELFLAG        = '0'
    </statement>

    <!-- Add Start 2019/12/20 QC#55070 -->
     <statement id="getShipToCtacPsnNm" parameterClass="Map" resultClass="String">
        SELECT
              PR.CTAC_PSN_NM 
        FROM
              PRCH_REQ      PR 
        WHERE
                PR.GLBL_CMPY_CD = #glblCmpyCd# 
            AND PR.PRCH_REQ_NUM = #trxHdrNum# 
            AND PR.EZCANCELFLAG = '0' 
        UNION 
        SELECT
              PR.CTAC_PSN_NM 
        FROM
              PRCH_REQ      PR 
            , PRCH_REQ_DTL  PRD
            , INVTY_ORD     IO
        WHERE
                PR.GLBL_CMPY_CD   = #glblCmpyCd# 
            AND PR.EZCANCELFLAG   = '0' 
            AND PR.GLBL_CMPY_CD   = PRD.GLBL_CMPY_CD 
            AND PR.PRCH_REQ_NUM   = PRD.PRCH_REQ_NUM 
            AND PRD.EZCANCELFLAG  = '0' 
            AND PRD.GLBL_CMPY_CD  = IO.GLBL_CMPY_CD 
            AND PRD.INVTY_ORD_NUM = IO.INVTY_ORD_NUM 
            AND IO.INVTY_ORD_NUM  = #trxHdrNum# 
            AND IO.EZCANCELFLAG   = '0' 
        GROUP BY
              PR.CTAC_PSN_NM 
        UNION 
        SELECT
              PR.CTAC_PSN_NM 
        FROM
              PRCH_REQ PR
            , CPO      C 
        WHERE
                PR.GLBL_CMPY_CD = #glblCmpyCd# 
            AND PR.EZCANCELFLAG = '0' 
            AND PR.GLBL_CMPY_CD = C.GLBL_CMPY_CD 
            AND PR.PRCH_REQ_NUM = C.ORD_SRC_REF_NUM 
            AND C.CPO_ORD_NUM   = #trxHdrNum# 
            AND C.CPO_SRC_TP_CD = #invtyReqEntry# 
            AND C.EZCANCELFLAG  = '0' 
     </statement>
     <!-- Add End 2019/12/20 QC#55070 -->

</sqlMap>
