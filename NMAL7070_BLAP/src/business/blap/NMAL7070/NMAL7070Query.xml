<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL7070Query">
    <statement id="getSavedSearchOptionList" parameterClass="Map" resultClass="Map">
        SELECT
                  SSO.SRCH_OPT_PK
                , SSO.SRCH_OPT_NM
            FROM
                SAVE_SRCH_OPT SSO 
            WHERE
                SSO.GLBL_CMPY_CD        = #glblCmpyCd#
                AND SSO.SRCH_OPT_APL_ID = #srchOptAplId#
                AND SSO.SRCH_OPT_USR_ID = #srchOptUsrId#
                AND SSO.EZCANCELFLAG    = '0'
            ORDER BY
                  SSO.SRCH_OPT_NM
    </statement>
    
    <statement id="getPriceCategoryCode" parameterClass="Map" resultClass="String">
        SELECT
            PC.PRC_CATG_CD
        FROM
            PRC_CATG PC
            ,PRC_LIST_TP PLT
            ,PRC_CUST_AUDC PCA
            <isNotNull property="acctNm">
            ,SELL_TO_CUST STC01
            ,SELL_TO_CUST STC02
            ,SELL_TO_CUST STC03
            </isNotNull>
        WHERE
                PC.GLBL_CMPY_CD         = #glblCmpyCd#
            AND PC.EZCANCELFLAG         = '0'
        
            <isNotNull property="effFromDt">
            AND PC.EFF_FROM_DT      &gt;= #effFromDt#
            </isNotNull>
            <isNotNull property="effThruDt">
            AND NVL(PC.EFF_THRU_DT,'99991231')  &lt;= #effThruDt#
            </isNotNull>
        
            AND PC.GLBL_CMPY_CD         = PLT.GLBL_CMPY_CD
            AND PC.EZCANCELFLAG         = PLT.EZCANCELFLAG
            AND PC.PRC_LIST_TP_CD       = PLT.PRC_LIST_TP_CD
            AND PLT.PRC_LIST_STRU_TP_CD = #prcListStruTpCd#
        
            AND PC.GLBL_CMPY_CD = PCA.GLBL_CMPY_CD
            AND PC.EZCANCELFLAG = PCA.EZCANCELFLAG
            AND PC.PRC_CATG_CD  = PCA.PRC_CATG_CD
            AND (PCA.PUB_FLG_01 = 'Y'
             OR PCA.PUB_FLG_01 = 'N')
            <isNotNull property="acctNum">
            AND (PCA.DS_ACCT_NUM_01 LIKE #acctNum#
             OR PCA.DS_ACCT_NUM_02 LIKE #acctNum#
             OR PCA.DS_ACCT_NUM_03 LIKE #acctNum#)
            </isNotNull>
            <isNotNull property="bizTpCd">
            <isEqual property="bizTpCd" compareValue="ALL">
            AND PCA.LINE_BIZ_TP_CD_01 IS NOT NULL
            </isEqual>
            <isNotEqual property="bizTpCd" compareValue="ALL">
            AND PCA.LINE_BIZ_TP_CD_01 = #bizTpCd#
            </isNotEqual>
            </isNotNull>
            <isNotNull property="CSMPNum">
            AND (PCA.CSMP_NUM_01 LIKE #CSMPNum#
             OR PCA.CSMP_NUM_02 LIKE #CSMPNum#
             OR PCA.CSMP_NUM_03 LIKE #CSMPNum#)
            </isNotNull>
            <isNotNull property="brCd">
            AND (PCA.COA_BR_CD_01 LIKE #brCd#
             OR PCA.COA_BR_CD_02 LIKE #brCd#
             OR PCA.COA_BR_CD_03 LIKE #brCd#)
            </isNotNull>
            <isNotNull property="acctNm">
            AND PCA.GLBL_CMPY_CD   = STC01.GLBL_CMPY_CD(+)
            AND PCA.EZCANCELFLAG   = STC01.EZCANCELFLAG(+)
            AND PCA.DS_ACCT_NUM_01 = STC01.SELL_TO_CUST_CD(+)
            AND PCA.GLBL_CMPY_CD   = STC02.GLBL_CMPY_CD(+)
            AND PCA.EZCANCELFLAG   = STC02.EZCANCELFLAG(+)
            AND PCA.DS_ACCT_NUM_02 = STC02.SELL_TO_CUST_CD(+)
            AND PCA.GLBL_CMPY_CD   = STC03.GLBL_CMPY_CD(+)
            AND PCA.EZCANCELFLAG   = STC03.EZCANCELFLAG(+)
            AND PCA.DS_ACCT_NUM_03 = STC03.SELL_TO_CUST_CD(+)

            AND (STC01.DS_ACCT_NM LIKE #acctNm#
             OR STC02.DS_ACCT_NM LIKE #acctNm#
             OR STC03.DS_ACCT_NM LIKE #acctNm#)
            </isNotNull>
            
    </statement>
    <statement id="getSupplyAgreementPlan" parameterClass="Map" resultClass="Map">
        SELECT
                SPLY_AGMT_PLN_PK
                ,SPLY_AGMT_PLN_NM
                ,SPLY_AGMT_PLN_SHORT_NM
                ,SPLY_AGMT_PLN_DESC_TXT
                ,ANN_TERM_CAP_NUM
                ,ACTV_FLG
                ,DEL_FLG
                ,EFF_FROM_DT
                ,EFF_THRU_DT
                ,EZINTIME
                ,CREATED_BY
                ,EZUPTIME
                ,UPDATE_BY
                ,SPLY_AGMT_PLN_TP_NM
                ,SPLY_AGMT_DOC_TP_NM
        FROM
            (SELECT
                SAP.SPLY_AGMT_PLN_PK
                ,SAP.SPLY_AGMT_PLN_NM
                ,SAP.SPLY_AGMT_PLN_SHORT_NM
                ,SAP.SPLY_AGMT_PLN_DESC_TXT
                ,SAP.ANN_TERM_CAP_NUM
                ,SAP.ACTV_FLG
                ,SAP.DEL_FLG
                ,SAP.EFF_FROM_DT
                ,SAP.EFF_THRU_DT
                ,SAP.EZINTIME
                ,CASE
                   WHEN AP1.FIRST_NM IS NOT NULL THEN SAP.EZINUSERID || '(' || AP1.FIRST_NM || ' ' || AP1.LAST_NM || ')'
                   ELSE SAP.EZINUSERID
                 END CREATED_BY
                ,SAP.EZUPTIME
                ,CASE
                   WHEN AP2.FIRST_NM IS NOT NULL THEN SAP.EZUPUSERID || '(' || AP2.FIRST_NM || ' ' || AP2.LAST_NM || ')'
                   ELSE SAP.EZUPUSERID
                 END UPDATE_BY
                ,SAPT.SPLY_AGMT_PLN_TP_NM
                ,SADT.SPLY_AGMT_DOC_TP_NM
            FROM
                SPLY_AGMT_PLN SAP
                ,SPLY_AGMT_PLN_TP SAPT
                ,SPLY_AGMT_DOC_TP SADT
                <isNotNull property="prcCatgCd">
                ,PRC_LIST_SPLY_PGM PLSP
                </isNotNull>
                ,AUTH_PSN AP1
                ,AUTH_PSN AP2
            WHERE
                    SAP.GLBL_CMPY_CD = #glblCmpyCd#
                AND SAP.EZCANCELFLAG = '0'
                <isNotNull property="effFromDt">
                AND SAP.EFF_FROM_DT  &gt;= #effFromDt#
                </isNotNull>
                <isNotNull property="effThruDt">
                AND NVL(SAP.EFF_THRU_DT,'99991231')   &lt;= #effThruDt#
                </isNotNull>
                <isNotNull property="plnNm">
                AND SAP.SPLY_AGMT_PLN_NM LIKE #plnNm#
                </isNotNull>
                <isNotNull property="plnShortNm">
                AND SAP.SPLY_AGMT_PLN_SHORT_NM LIKE #plnShortNm#
                </isNotNull>
                <isNotNull property="plnDescTxt">
                AND SAP.SPLY_AGMT_PLN_DESC_TXT LIKE #plnDescTxt#
                </isNotNull>
                <isNotNull property="plnTp">
                AND SAP.SPLY_AGMT_PLN_TP_CD = #plnTp#
                </isNotNull>
                <isNotNull property="docTp">
                AND SAP.SPLY_AGMT_DOC_TP_CD = #docTp#
                </isNotNull>
                <isEqual property="plnSts" compareValue="01">
                AND SAP.EFF_FROM_DT                 &lt;= #salesDt#
                AND NVL(SAP.EFF_THRU_DT,'99991231') &gt;= #salesDt#
                AND SAP.ACTV_FLG = 'Y'
                AND SAP.DEL_FLG = 'N'
                </isEqual>
                <isEqual property="plnSts" compareValue="02">
                AND (SAP.EFF_FROM_DT               &gt; #salesDt#
                 OR NVL(SAP.EFF_THRU_DT,'99991231') &lt; #salesDt#
                 OR SAP.ACTV_FLG = 'N')
                AND SAP.DEL_FLG = 'N'
                </isEqual>
                <isEqual property="plnSts" compareValue="03">
                AND SAP.DEL_FLG = 'Y'
                </isEqual>
                <isEqual property="plnSts" compareValue="04">
                AND SAP.DEL_FLG = 'N'
                </isEqual>
                
                AND SAP.GLBL_CMPY_CD = SAPT.GLBL_CMPY_CD
                AND SAP.EZCANCELFLAG = SAPT.EZCANCELFLAG
                AND SAP.SPLY_AGMT_PLN_TP_CD = SAPT.SPLY_AGMT_PLN_TP_CD
            
                AND SAP.GLBL_CMPY_CD = SADT.GLBL_CMPY_CD
                AND SAP.EZCANCELFLAG = SADT.EZCANCELFLAG
                AND SAP.SPLY_AGMT_DOC_TP_CD = SADT.SPLY_AGMT_DOC_TP_CD
                <isNotNull property="prcCatgCd">
                AND SAP.GLBL_CMPY_CD = PLSP.GLBL_CMPY_CD
                AND SAP.EZCANCELFLAG = PLSP.EZCANCELFLAG
                AND PLSP.EFF_FROM_DT &gt;= #effFromDt#
                <isNotNull property="effThruDt">
                AND NVL(PLSP.EFF_THRU_DT,'99991231') &lt;= #effThruDt#
                </isNotNull>
                <iterate property="prcCatgCd" var="elem[]" open="AND (" close=")" conjunction="OR">
                    PLSP.PRC_CATG_CD = #elem[]#
                </iterate>
                AND SAP.SPLY_AGMT_PLN_PK = PLSP.SPLY_AGMT_PLN_PK
                </isNotNull>
            
                AND SAP.GLBL_CMPY_CD = AP1.GLBL_CMPY_CD(+)
                AND SAP.EZCANCELFLAG = AP1.EZCANCELFLAG(+)
                AND SAP.EZINUSERID   = AP1.USR_NM(+)
            
                AND SAP.GLBL_CMPY_CD = AP2.GLBL_CMPY_CD(+)
                AND SAP.EZCANCELFLAG = AP2.EZCANCELFLAG(+)
                AND SAP.EZUPUSERID   = AP2.USR_NM(+)
            ORDER BY SAP.SPLY_AGMT_PLN_NM)
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>
</sqlMap>
