<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAB069001">

    <statement id="getTrgtYrMth" parameterClass="Map" resultClass="String">
        SELECT
            CAL.DWH_TRGT_YR_MTH
        FROM
            DMN_RPT_CAL            CAL
        WHERE 
            CAL.GLBL_CMPY_CD       = #glblCmpyCd#
        AND CAL.DWH_TRGT_DT        = #trgtDt#
        AND CAL.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getTrgtYrMthRec" parameterClass="Map" resultClass="BigDecimal">
        SELECT COUNT(1)
        FROM
            FCT_MLY_MACH_MSTR         MACH
        WHERE 
            MACH.GLBL_CMPY_CD         = #glblCmpyCd#
        AND MACH.DWH_TRGT_YR_MTH      = #trgtYrMth#
        AND MACH.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getMainData" parameterClass="Map" resultClass="Map">
        SELECT
            SMM.SVC_MACH_MSTR_PK                    AS SVC_MACH_MSTR_PK
           ,SCM.SVC_CONFIG_MSTR_PK                  AS SVC_CONFIG_MSTR_PK
           ,SCM.MDL_ID                              AS MDL_ID
           ,MN.T_MDL_NM                             AS T_MDL_NM
           ,SMM.SER_NUM                             AS SER_NUM
           ,MDSE.MDSE_DESC_SHORT_TXT                AS MDSE_DESC_SHORT_TXT
           ,SMM.MDSE_CD                             AS MDSE_CD
           ,DM.MTR_GRP_PK                           AS MTR_GRP_PK
           ,MG.MTR_GRP_DESC_TXT                     AS MTR_GRP_DESC_TXT
           ,MDSE.COA_PROD_CD                        AS COA_PROD_CD
           ,CP.COA_PROD_DESC_TXT                    AS COA_PROD_DESC_TXT
           ,SMM.EFF_FROM_DT                         AS EFF_FROM_DT
           ,SMM.EFF_THRU_DT                         AS EFF_THRU_DT
           ,SMM.SVC_MACH_MSTR_STS_CD                AS SVC_MACH_MSTR_STS_CD
           ,SMMS.SVC_MACH_MSTR_STS_DESC_TXT         AS SVC_MACH_MSTR_STS_DESC_TXT
           ,NULL                                    AS SVC_CMNT_TXT
           ,SMM.FLD_SVC_BR_CD                       AS SVC_TRTY_CD
           ,SBPX.SVC_BR_CD_DESC_TXT                 AS SVC_TRTY_DESC_TXT
           ,SMM.OWNR_ACCT_NUM                       AS OWNR_ACCT_NUM
           ,DAC1.DS_ACCT_NM                         AS OWNR_ACCT_NM
           ,SMM.OWNR_LOC_NUM                        AS OWNR_LOC_NUM
           ,SMM.BILL_TO_ACCT_NUM                    AS BILL_TO_ACCT_NUM
           ,DAC2.DS_ACCT_NM                         AS BILL_TO_ACCT_NM
           ,SMM.BILL_TO_LOC_NUM                     AS BILL_TO_LOC_NUM
           ,SMM.IND_BILL_TO_LOC_NUM                 AS IND_BILL_TO_LOC_NUM
           ,SMM.CUR_LOC_ACCT_NUM                    AS CUR_LOC_ACCT_NUM
           ,DAC3.DS_ACCT_NM                         AS CUR_LOC_ACCT_NM
           ,SMM.CUR_LOC_NUM                         AS CUR_LOC_NUM
           ,SMM.IND_CUR_LOC_NUM                     AS IND_CUR_LOC_NUM
           ,NVL(SMM.DS_KEY_ACCT_FLG, 'N')           AS DS_KEY_ACCT_FLG
           ,STC.FIRST_LINE_ADDR                     AS FIRST_LINE_ADDR
           ,STC.SCD_LINE_ADDR                       AS SCD_LINE_ADDR
           ,STC.THIRD_LINE_ADDR                     AS THIRD_LINE_ADDR
           ,STC.FRTH_LINE_ADDR                      AS FRTH_LINE_ADDR
           ,STC.CTY_ADDR                            AS CTY_ADDR
           ,STC.CNTY_PK                             AS CNTY_PK
           ,STC.PROV_NM                             AS PROV_NM
           ,STC.ST_CD                               AS ST_CD
           ,STC.POST_CD                             AS POST_CD
           ,STC.CTRY_CD                             AS CTRY_CD
           ,SMM.ISTL_DT                             AS ISTL_DT
           ,NULL                                    AS ISTL_AUTH_NUM
           ,SMM.FLD_SVC_BR_CD                       AS FLD_SVC_BR_CD
           ,SMM.FIN_BR_CD                           AS FIN_BR_CD
           ,SMM.CUST_ISS_PO_NUM                     AS CUST_ISS_PO_NUM
           ,CPO.CUST_ISS_PO_DT                      AS CUST_ISS_PO_DT
           ,SMM.DS_PO_EXPR_DT                       AS DS_PO_EXPR_DT
           ,DC.DS_CONTR_NUM                         AS DS_CONTR_NUM
           ,DC.DS_CONTR_CATG_CD                     AS DS_CONTR_CATG_CD
           ,DCC.DS_CONTR_CATG_DESC_TXT              AS DS_CONTR_CATG_DESC_TXT
           ,DC.CONTR_VRSN_EFF_FROM_DT               AS CONTR_VRSN_EFF_FROM_DT
           ,DC.CONTR_VRSN_EFF_THRU_DT               AS CONTR_VRSN_EFF_THRU_DT
           ,CASE
               WHEN STCD.SVC_TERM_ATTRB_MAP_VAL_CD IS NOT NULL THEN STCD.SVC_TERM_ATTRB_MAP_VAL_CD * 60
               WHEN STCH.SVC_TERM_ATTRB_MAP_VAL_CD IS NOT NULL THEN STCH.SVC_TERM_ATTRB_MAP_VAL_CD * 60
               ELSE NVL(DM.RSP_TM_UP_MN_AOT, 0)
               END                                  AS TRGT_SVC_RSP_VAL_CD
           ,NULL                                    AS TRGT_SVC_RSTR_VAL_CD
           ,SMM.BIZ_HRS_SUN_FROM_TM                 AS BIZ_HRS_SUN_FROM_TM
           ,SMM.BIZ_HRS_SUN_TO_TM                   AS BIZ_HRS_SUN_TO_TM
           ,SMM.BIZ_HRS_MON_FRI_FROM_TM             AS BIZ_HRS_MON_FRI_FROM_TM
           ,SMM.BIZ_HRS_MON_FRI_TO_TM               AS BIZ_HRS_MON_FRI_TO_TM
           ,SMM.BIZ_HRS_SAT_FROM_TM                 AS BIZ_HRS_SAT_FROM_TM
           ,SMM.BIZ_HRS_SAT_TO_TM                   AS BIZ_HRS_SAT_TO_TM
           ,DAMD.LEASE_END_DT                       AS LEASE_END_DT
           ,CASE
               WHEN DAMD.DS_ASSET_MSTR_PK IS NOT NULL
               THEN 'Y'
               ELSE 'N'
               END                                  AS INTFC_TO_FA_FLG
           ,FSR2.FSR_NUM                            AS LTST_FSR_NUM
           ,FSR2.FSR_CRAT_DT                        AS LTST_FSR_CRAT_DT
           ,FV2.FSR_VISIT_ARV_DT                    AS LTST_FSR_VISIT_ARV_DT
           ,FV2.TECH_CD                             AS LTST_VISIT_TECH_CD
           ,SMM.CUST_MACH_CTRL_NUM                  AS CUST_MACH_CTRL_NUM
           ,SMM.SVC_MACH_TP_CD                      AS SVC_MACH_TP_CD
           ,SMM.SHIP_FROM_WH_CD                     AS SHIP_FROM_WH_CD
           ,SMM.SVC_MACH_RMV_DT                     AS SVC_MACH_RMV_DT
           ,SMM.RTRN_TO_WH_CD                       AS RTRN_TO_WH_CD
           ,SMM.DRUM_EXCH_DT                        AS DRUM_EXCH_DT
           ,SMM.EXCH_DRUM_MTR_CNT                   AS EXCH_DRUM_MTR_CNT
           ,SMM.LAST_SVC_CALL_DT                    AS LAST_SVC_CALL_DT
           ,SMM.TOT_SVC_VISIT_CNT                   AS TOT_SVC_VISIT_CNT
           ,SMM.LAST_TECH_VISIT_DT                  AS LAST_TECH_VISIT_DT
           ,SMM.LAST_TECH_VISIT_MTR_CNT             AS LAST_TECH_VISIT_MTR_CNT
           ,SMM.LAST_PRVNT_MAINT_DT                 AS LAST_PRVNT_MAINT_DT
           ,SMM.LAST_PRVNT_MAINT_MTR_CNT            AS LAST_PRVNT_MAINT_MTR_CNT
           ,SMM.LAST_SVC_CALL_VISIT_DT              AS LAST_SVC_CALL_VISIT_DT
           ,SMM.LAST_SVC_CALL_MTR_CNT               AS LAST_SVC_CALL_MTR_CNT
           ,SMM.PRF_TECH_CD                         AS PRF_TECH_CD
           ,SMM.CPO_ORD_NUM                         AS CPO_ORD_NUM
           ,SMM.CPO_DTL_LINE_NUM                    AS CPO_DTL_LINE_NUM
           ,SMM.CPO_DTL_LINE_SUB_NUM                AS CPO_DTL_LINE_SUB_NUM
           ,SMM.SHPG_PLN_NUM                        AS SHPG_PLN_NUM
           ,SMM.SO_NUM                              AS SO_NUM
           ,SMM.SO_SLP_NUM                          AS SO_SLP_NUM
           ,SMM.RMA_NUM                             AS RMA_NUM
           ,SMM.RMA_LINE_NUM                        AS RMA_LINE_NUM
           ,SMM.RMA_LINE_SUB_NUM                    AS RMA_LINE_SUB_NUM
           ,SMM.RMA_LINE_SUB_TRX_NUM                AS RMA_LINE_SUB_TRX_NUM
           ,NVL(SMM.AUTO_CRAT_FLG, 'N')             AS AUTO_CRAT_FLG
           ,SMM.OLD_SER_NUM                         AS OLD_SER_NUM
           ,NVL(SMM.ISTL_STS_UPD_CPLT_FLG, 'N')     AS ISTL_STS_UPD_CPLT_FLG
           ,SMM.SVC_MACH_USG_STS_CD                 AS SVC_MACH_USG_STS_CD
           ,SMUS.SVC_MACH_USG_STS_DESC_TXT          AS SVC_MACH_USG_STS_DESC_TXT
           ,SMM.SVC_BY_LINE_BIZ_TP_CD               AS SVC_BY_LINE_BIZ_TP_CD
           ,SMM.REQ_TECH_CD                         AS REQ_TECH_CD
           ,SMM.STK_STS_CD                          AS STK_STS_CD
           ,SMM.PRNT_SER_NUM                        AS PRNT_SER_NUM
           ,SMM.SVC_MACH_TRX_TP_CD                  AS SVC_MACH_TRX_TP_CD
           ,SMTP.SVC_MACH_TRX_TP_DESC_TXT           AS SVC_MACH_TRX_TP_DESC_TXT
           ,SMM.SVC_MACH_QTY                        AS SVC_MACH_QTY
           ,SMM.CTRL_FLD_TXT_01                     AS CTRL_FLD_TXT_01
           ,SMM.CTRL_FLD_TXT_02                     AS CTRL_FLD_TXT_02
           ,SMM.CTRL_FLD_TXT_03                     AS CTRL_FLD_TXT_03
           ,SMM.CTRL_FLD_TXT_04                     AS CTRL_FLD_TXT_04
           ,SMM.CTRL_FLD_TXT_05                     AS CTRL_FLD_TXT_05
           ,SMM.CTRL_FLD_TXT_06                     AS CTRL_FLD_TXT_06
           ,SMM.PRC_CONTR_NUM                       AS PRC_CONTR_NUM
           ,SMM.CORP_ADVTG_STS_CD                   AS CORP_ADVTG_STS_CD
           ,CAS.SVC_CORP_ADVTG_STS_DESC_TXT         AS SVC_CORP_ADVTG_STS_DESC_TXT
           ,NVL(SMM.HARD_DRIVE_RMV_INCL_FLG, 'N')   AS HARD_DRIVE_RMV_INCL_FLG
           ,NVL(SMM.HARD_DRIVE_ERASE_INCL_FLG, 'N') AS HARD_DRIVE_ERASE_INCL_FLG
           ,NVL(SMM.LEASE_RTRN_FEE_INCL_FLG, 'N')   AS LEASE_RTRN_FEE_INCL_FLG
           ,SMM.SVC_NTWK_CONN_STS_CD                AS SVC_NTWK_CONN_STS_CD
           ,SNCS.SVC_NTWK_CONN_STS_DESC_TXT         AS SVC_NTWK_CONN_STS_DESC_TXT
           ,SMM.SLD_BY_LINE_BIZ_TP_CD               AS SLD_BY_LINE_BIZ_TP_CD
           ,SMM.SVC_LIC_CNT                         AS SVC_LIC_CNT
           ,NVL(SMM.SVC_MACH_MAINT_AVAL_FLG, 'N')   AS SVC_MACH_MAINT_AVAL_FLG
           ,SMM.TRX_HDR_NUM                         AS TRX_HDR_NUM
           ,SMM.TRX_LINE_NUM                        AS TRX_LINE_NUM
           ,SMM.TRX_LINE_SUB_NUM                    AS TRX_LINE_SUB_NUM
           ,SMM.SVC_MACH_MSTR_LOC_STS_CD            AS SVC_MACH_MSTR_LOC_STS_CD
           ,NVL(SMM.SHR_DLR_FLG, 'N')               AS SHR_DLR_FLG
           ,SMM.IWR_RGTN_STS_CD                     AS IWR_RGTN_STS_CD
           ,NVL(SMM.ENET_PLOT_FLG, 'N')             AS ENET_PLOT_FLG
           ,SMM.ENET_CMNT_TXT_01                    AS ENET_CMNT_TXT_01
           ,SMM.ENET_CMNT_TXT_02                    AS ENET_CMNT_TXT_02
           ,DOU.BR_ORG_CD                           AS BR_ORG_CD
           ,CTAC.CTAC_PSN_PK                        AS CTAC_PSN_PK
           ,CTAC.CTAC_PSN_FIRST_NM                  AS CTAC_PSN_FIRST_NM
           ,CTAC.CTAC_PSN_MID_NM                    AS CTAC_PSN_MID_NM
           ,CTAC.CTAC_PSN_LAST_NM                   AS CTAC_PSN_LAST_NM
           ,CTAC.TEL_DS_CTAC_PNT_VAL_TXT            AS TEL_DS_CTAC_PNT_VAL_TXT
           ,CTAC.EXTN_DS_CTAC_PNT_VAL_TXT           AS EXTN_DS_CTAC_PNT_VAL_TXT
           ,CTAC.EML_DS_CTAC_PNT_VAL_TXT            AS EML_DS_CTAC_PNT_VAL_TXT
           ,CTAC.CELL_DS_CTAC_PNT_VAL_TXT           AS CELL_DS_CTAC_PNT_VAL_TXT
           ,CTAC.FAX_DS_CTAC_PNT_VAL_TXT            AS FAX_DS_CTAC_PNT_VAL_TXT
        FROM
            SVC_MACH_MSTR      SMM
           ,SVC_MACH_MSTR_STS  SMMS
           ,SVC_MACH_TRX_TP    SMTP
           ,SVC_MACH_USG_STS   SMUS
           ,SVC_NTWK_CONN_STS  SNCS
           ,SVC_CORP_ADVTG_STS CAS
           ,MDSE               MDSE
           ,COA_PROD           CP
           ,SHIP_TO_CUST       STC
           ,SVC_BR_POST_XREF   SBPX
           ,SELL_TO_CUST       DAC1
           ,SELL_TO_CUST       DAC2
           ,SELL_TO_CUST       DAC3
           ,CPO                CPO
           ,DS_ASSET_MSTR      DAMD
           ,SVC_CONFIG_MSTR    SCM
           ,DS_MDL             DM
           ,MDL_NM             MN
           ,MTR_GRP            MG
           ,DS_CONTR           DC
           ,DS_CONTR_CATG      DCC
           ,SVC_TERM_COND      STCD
           ,SVC_TERM_COND      STCH
           ,(
               SELECT
                   CONTR.GLBL_CMPY_CD
                  ,CONTR.SVC_MACH_MSTR_PK
                  ,CONTR.DS_CONTR_DTL_PK
                  ,CONTR.DS_CONTR_PK
<!--              ,ROW_NUMBER() OVER(PARTITION BY CONTR.SVC_MACH_MSTR_PK ORDER BY CONTR.CONTR_EFF_THRU_DT DESC) IDX -->
                  ,ROW_NUMBER() OVER(PARTITION BY CONTR.SVC_MACH_MSTR_PK ORDER BY CONTR.CONTR_EFF_THRU_DT DESC, CONTR.DS_CONTR_PK) IDX  <!-- QC#15410 mod -->
               FROM
                   DS_CONTR_DTL CONTR
               WHERE
                   CONTR.GLBL_CMPY_CD        = #glblCmpyCd#
               AND CONTR.DS_CONTR_DTL_STS_CD = #dsContrDtlStsCd#
               AND CONTR.EZCANCELFLAG        = '0'
            ) DCD
           ,(SELECT
                FSR1.GLBL_CMPY_CD
               ,FSR1.SVC_MACH_MSTR_PK
               ,FSR1.FSR_NUM
               ,FSR1.FSR_CRAT_DT
               ,FSR1.FSR_CPLT_DT
               ,FSR1.FSR_CLO_DT
               ,ROW_NUMBER() OVER(PARTITION BY FSR1.SVC_MACH_MSTR_PK ORDER BY FSR1.FSR_CRAT_DT, FSR1.FSR_CRAT_TM DESC) IDX
             FROM
                 FSR FSR1
             WHERE
                     FSR1.GLBL_CMPY_CD = #glblCmpyCd#
                 AND FSR1.EZCANCELFLAG = '0'
            ) FSR2
            ,(SELECT
                FV1.GLBL_CMPY_CD
               ,FV1.FSR_NUM
               ,FV1.FSR_VISIT_ARV_DT
               ,FV1.TECH_CD
               ,ROW_NUMBER() OVER(PARTITION BY FV1.FSR_NUM ORDER BY FV1.FSR_VISIT_ARV_DT DESC) IDX
             FROM
                 FSR_VISIT FV1
             WHERE
                     FV1.GLBL_CMPY_CD = #glblCmpyCd#
                 AND FV1.EZCANCELFLAG = '0'
            ) FV2
            ,(SELECT
                  SBPX.SVC_BR_CD
                 ,SBPX.POST_CD
                 ,SBPX.SVC_LINE_BIZ_CD
                 ,MIN(DOU.ORG_CD) AS BR_ORG_CD
              FROM
                  DS_ORG_UNIT DOU
                 ,SVC_BR_POST_XREF SBPX
              WHERE
                  DOU.GLBL_CMPY_CD                     = #glblCmpyCd#
              AND DOU.ORG_STRU_TP_CD                   = #orgStruCd#
              AND DOU.FIRST_ORG_CD                     = #fstOrgCd#
              AND DOU.EFF_FROM_DT                  &lt;= #trgtDt#
              AND NVL(DOU.EFF_THRU_DT, '99991231') &gt;= #trgtDt#
              AND SBPX.GLBL_CMPY_CD                    = DOU.GLBL_CMPY_CD
              AND SBPX.SVC_BR_CD_DESC_TXT              = DOU.ORG_DESC_TXT
              AND DOU.EZCANCELFLAG                     = '0'
              AND SBPX.EZCANCELFLAG                    = '0'
              GROUP BY
                  SBPX.SVC_BR_CD
                 ,SBPX.POST_CD
                 ,SBPX.SVC_LINE_BIZ_CD
            ) DOU
            ,(
              SELECT
                  SMCP.SVC_MACH_MSTR_PK
                 ,CP.CTAC_PSN_PK
                 ,CP.CTAC_PSN_FIRST_NM
                 ,CP.CTAC_PSN_MID_NM
                 ,CP.CTAC_PSN_LAST_NM
                 ,(SELECT DS_CTAC_PNT_VAL_TXT
                   FROM
                     (SELECT DS_CTAC_PNT_VAL_TXT
                      FROM   DS_CTAC_PNT DCP2
                      WHERE  1=1
                      AND    DCP2.GLBL_CMPY_CD         = CP.GLBL_CMPY_CD
                      AND    DCP2.CTAC_PSN_PK          = CP.CTAC_PSN_PK
                      AND    DCP2.DS_CTAC_PNT_TP_CD    = #phoneWork#
                      AND    DCP2.DS_CTAC_PNT_ACTV_FLG = 'Y'
                      AND    DCP2.EZCANCELFLAG         = '0'
                      ORDER BY DCP2.DS_CTAC_PNT_PK)
                   WHERE ROWNUM=1)  AS TEL_DS_CTAC_PNT_VAL_TXT
                 ,(SELECT DS_CTAC_PSN_EXTN_NUM
                   FROM
                     (SELECT DS_CTAC_PSN_EXTN_NUM
                      FROM   DS_CTAC_PNT DCP2
                      WHERE  1=1
                      AND    DCP2.GLBL_CMPY_CD         = CP.GLBL_CMPY_CD
                      AND    DCP2.CTAC_PSN_PK          = CP.CTAC_PSN_PK
                      AND    DCP2.DS_CTAC_PNT_TP_CD    = #phoneWork#
                      AND    DCP2.DS_CTAC_PNT_ACTV_FLG = 'Y'
                      AND    DCP2.EZCANCELFLAG         = '0'
                      ORDER BY DCP2.DS_CTAC_PNT_PK)
                    WHERE ROWNUM=1) AS EXTN_DS_CTAC_PNT_VAL_TXT
                 ,(SELECT DS_CTAC_PNT_VAL_TXT
                   FROM
                     (SELECT DS_CTAC_PNT_VAL_TXT
                      FROM   DS_CTAC_PNT DCP2
                      WHERE  1=1
                      AND    DCP2.GLBL_CMPY_CD         = CP.GLBL_CMPY_CD
                      AND    DCP2.CTAC_PSN_PK          = CP.CTAC_PSN_PK
                      AND    DCP2.DS_CTAC_PNT_TP_CD    = #emailWork#
                      AND    DCP2.DS_CTAC_PNT_ACTV_FLG = 'Y'
                      AND    DCP2.EZCANCELFLAG         = '0'
                      ORDER BY DCP2.DS_CTAC_PNT_PK)
                    WHERE ROWNUM=1) AS EML_DS_CTAC_PNT_VAL_TXT
                 ,(SELECT DS_CTAC_PNT_VAL_TXT
                   FROM
                     (SELECT DS_CTAC_PNT_VAL_TXT
                      FROM   DS_CTAC_PNT DCP2
                      WHERE  1=1
                      AND    DCP2.GLBL_CMPY_CD         = CP.GLBL_CMPY_CD
                      AND    DCP2.CTAC_PSN_PK          = CP.CTAC_PSN_PK
                      AND    DCP2.DS_CTAC_PNT_TP_CD    = #phoneMobile#
                      AND    DCP2.DS_CTAC_PNT_ACTV_FLG = 'Y'
                      AND    DCP2.EZCANCELFLAG         = '0'
                      ORDER BY DCP2.DS_CTAC_PNT_PK)
                    WHERE ROWNUM=1) AS CELL_DS_CTAC_PNT_VAL_TXT
                 ,(SELECT DS_CTAC_PNT_VAL_TXT
                   FROM
                     (SELECT DS_CTAC_PNT_VAL_TXT
                      FROM   DS_CTAC_PNT DCP2
                      WHERE  1=1
                      AND    DCP2.GLBL_CMPY_CD         = CP.GLBL_CMPY_CD
                      AND    DCP2.CTAC_PSN_PK          = CP.CTAC_PSN_PK
                      AND    DCP2.DS_CTAC_PNT_TP_CD    = #faxWork#
                      AND    DCP2.DS_CTAC_PNT_ACTV_FLG = 'Y'
                      AND    DCP2.EZCANCELFLAG         = '0'
                      ORDER BY DCP2.DS_CTAC_PNT_PK)
                    WHERE ROWNUM=1) AS FAX_DS_CTAC_PNT_VAL_TXT
                 ,ROW_NUMBER() OVER(PARTITION BY SMCP.SVC_MACH_MSTR_PK ORDER BY DCPR.DS_PRIM_LOC_FLG DESC) IDX
              FROM
                  SVC_MACH_CTAC_PSN SMCP
                 ,DS_CTAC_PNT DCP
                 ,CTAC_PSN CP
                 ,DS_CTAC_PSN_RELN DCPR
              WHERE 1=1
              AND SMCP.GLBL_CMPY_CD                     = #glblCmpyCd#
              AND SMCP.SVC_CTAC_TP_CD                   = #svckeyOpe#
              AND SMCP.EFF_FROM_DT                  &lt;= #trgtDt#
              AND NVL(SMCP.EFF_THRU_DT, '99991231') &gt;= #trgtDt#
              AND DCP.GLBL_CMPY_CD                      = SMCP.GLBL_CMPY_CD
              AND DCP.DS_CTAC_PNT_PK                    = SMCP.DS_CTAC_PNT_PK
              AND DCP.DS_CTAC_PNT_ACTV_FLG              = 'Y'
              AND CP.GLBL_CMPY_CD                       = DCP.GLBL_CMPY_CD
              AND CP.CTAC_PSN_PK                        = DCP.CTAC_PSN_PK
              AND DCPR.GLBL_CMPY_CD                     = CP.GLBL_CMPY_CD
              AND DCPR.CTAC_PSN_PK                      = CP.CTAC_PSN_PK
              AND DCPR.EFF_FROM_DT                  &lt;= #trgtDt#
              AND NVL(DCPR.EFF_THRU_DT, '99991231') &gt;= #trgtDt#
              AND SMCP.EZCANCELFLAG                     = '0'
              AND DCPR.EZCANCELFLAG                     = '0'
              AND DCP.EZCANCELFLAG                      = '0'
              AND CP.EZCANCELFLAG                       = '0'
             ) CTAC
        WHERE
            SMM.GLBL_CMPY_CD                 = #glblCmpyCd#
        AND SMM.SVC_MACH_TP_CD              != #svcMachTpCd#
        AND ((SMM.SVC_MACH_MSTR_STS_CD IN     (#svcMachMstrSts1#, #svcMachMstrSts2#, #svcMachMstrSts3#, #svcMachMstrSts4#))
        OR   (SMM.SVC_MACH_MSTR_STS_CD       = #svcMachMstrStsTrmn#
        AND  (SUBSTR(FSR2.FSR_CRAT_DT, 0, 6) = #trgtYrMth#
        OR    SUBSTR(FSR2.FSR_CPLT_DT, 0, 6) = #trgtYrMth# OR SUBSTR(FSR2.FSR_CLO_DT, 0, 6) = #trgtYrMth# )))
        AND SMM.GLBL_CMPY_CD                 = SMMS.GLBL_CMPY_CD
        AND SMM.SVC_MACH_MSTR_STS_CD         = SMMS.SVC_MACH_MSTR_STS_CD
        AND SMM.GLBL_CMPY_CD                 = SMTP.GLBL_CMPY_CD(+)
        AND SMM.SVC_MACH_TRX_TP_CD           = SMTP.SVC_MACH_TRX_TP_CD(+)
        AND SMM.GLBL_CMPY_CD                 = SMUS.GLBL_CMPY_CD
        AND SMM.SVC_MACH_USG_STS_CD          = SMUS.SVC_MACH_USG_STS_CD
        AND SMM.GLBL_CMPY_CD                 = SNCS.GLBL_CMPY_CD(+)
        AND SMM.SVC_NTWK_CONN_STS_CD         = SNCS.SVC_NTWK_CONN_STS_CD(+)
        AND SMM.GLBL_CMPY_CD                 = CAS.GLBL_CMPY_CD(+)
        AND SMM.CORP_ADVTG_STS_CD            = CAS.SVC_CORP_ADVTG_STS_CD(+)
        AND SMM.GLBL_CMPY_CD                 = MDSE.GLBL_CMPY_CD
        AND SMM.MDSE_CD                      = MDSE.MDSE_CD
        AND MDSE.GLBL_CMPY_CD                = CP.GLBL_CMPY_CD
        AND MDSE.COA_PROD_CD                 = CP.COA_PROD_CD
        AND SMM.GLBL_CMPY_CD                 = STC.GLBL_CMPY_CD
        AND SMM.CUR_LOC_NUM                  = STC.SHIP_TO_CUST_CD
        AND STC.POST_CD                      = SBPX.POST_CD(+)
        AND SMM.GLBL_CMPY_CD                 = SBPX.GLBL_CMPY_CD(+)
        AND SMM.SVC_BY_LINE_BIZ_TP_CD        = SBPX.SVC_LINE_BIZ_CD(+)
        AND SMM.FLD_SVC_BR_CD                = SBPX.SVC_BR_CD(+)
        AND SMM.GLBL_CMPY_CD                 = DAC1.GLBL_CMPY_CD(+)
        AND SMM.OWNR_ACCT_NUM                = DAC1.SELL_TO_CUST_CD(+)
        AND SMM.GLBL_CMPY_CD                 = DAC2.GLBL_CMPY_CD(+)
        AND SMM.BILL_TO_ACCT_NUM             = DAC2.SELL_TO_CUST_CD(+)
        AND SMM.GLBL_CMPY_CD                 = DAC3.GLBL_CMPY_CD(+)
        AND SMM.CUR_LOC_ACCT_NUM             = DAC3.SELL_TO_CUST_CD(+)
        AND SMM.GLBL_CMPY_CD                 = CPO.GLBL_CMPY_CD(+)
        AND SMM.CPO_ORD_NUM                  = CPO.CPO_ORD_NUM(+)
        AND SMM.GLBL_CMPY_CD                 = DAMD.GLBL_CMPY_CD(+)
        AND SMM.SVC_MACH_MSTR_PK             = DAMD.SVC_MACH_MSTR_PK(+)
        AND SMM.CPO_ORD_NUM                  = DAMD.CPO_ORD_NUM(+)
        AND SMM.GLBL_CMPY_CD                 = SCM.GLBL_CMPY_CD(+)
        AND SMM.SVC_CONFIG_MSTR_PK           = SCM.SVC_CONFIG_MSTR_PK(+)
        AND SCM.GLBL_CMPY_CD                 = DM.GLBL_CMPY_CD(+)
        AND SCM.MDL_ID                       = DM.MDL_ID(+)
        AND SCM.GLBL_CMPY_CD                 = MN.T_GLBL_CMPY_CD(+)
        AND SCM.MDL_ID                       = MN.T_MDL_ID(+)
        AND DM.GLBL_CMPY_CD                  = MG.GLBL_CMPY_CD(+)
        AND DM.MTR_GRP_PK                    = MG.MTR_GRP_PK(+)
        AND SMM.GLBL_CMPY_CD                 = DCD.GLBL_CMPY_CD(+)
        AND SMM.SVC_MACH_MSTR_PK             = DCD.SVC_MACH_MSTR_PK(+)
        AND DCD.IDX(+)                       = 1
        AND DCD.GLBL_CMPY_CD                 = DC.GLBL_CMPY_CD(+)
        AND DCD.DS_CONTR_PK                  = DC.DS_CONTR_PK(+)
        AND DC.GLBL_CMPY_CD                  = DCC.GLBL_CMPY_CD(+)
        AND DC.DS_CONTR_CATG_CD              = DCC.DS_CONTR_CATG_CD(+)
        AND DCD.GLBL_CMPY_CD                 = STCD.GLBL_CMPY_CD(+)
        AND DCD.DS_CONTR_DTL_PK              = STCD.DS_CONTR_DTL_PK(+)
        AND STCD.SVC_TERM_COND_ATTRB_PK(+)   = #svcTermCondAttrb#
        AND DC.GLBL_CMPY_CD                  = STCH.GLBL_CMPY_CD(+)
        AND DC.DS_CONTR_PK                   = STCH.DS_CONTR_PK(+)
        AND STCH.DS_CONTR_DTL_PK(+)          IS NULL
        AND STCH.SVC_TERM_COND_ATTRB_PK(+)   = #svcTermCondAttrb#
        AND SMM.GLBL_CMPY_CD                 = FSR2.GLBL_CMPY_CD(+)
        AND SMM.SVC_MACH_MSTR_PK             = FSR2.SVC_MACH_MSTR_PK(+)
        AND FSR2.IDX(+)                      = 1
        AND FSR2.GLBL_CMPY_CD                = FV2.GLBL_CMPY_CD(+)
        AND FSR2.FSR_NUM                     = FV2.FSR_NUM(+)
        AND FV2.IDX(+)                       = 1
        AND SMM.FLD_SVC_BR_CD                = DOU.SVC_BR_CD(+)
        AND STC.POST_CD                      = DOU.POST_CD(+)
        AND SMM.SVC_BY_LINE_BIZ_TP_CD        = DOU.SVC_LINE_BIZ_CD(+)
        AND SMM.SVC_MACH_MSTR_PK             = CTAC.SVC_MACH_MSTR_PK(+)
        AND CTAC.IDX(+)                      = 1
        AND SMM.EZCANCELFLAG                 = '0'
        AND SMMS.EZCANCELFLAG                = '0'
        AND SMTP.EZCANCELFLAG(+)             = '0'
        AND SMUS.EZCANCELFLAG                = '0'
        AND SNCS.EZCANCELFLAG(+)             = '0'
        AND CAS.EZCANCELFLAG(+)              = '0'
        AND MDSE.EZCANCELFLAG                = '0'
        AND CP.EZCANCELFLAG                  = '0'
        AND STC.EZCANCELFLAG                 = '0'
        AND DAC1.EZCANCELFLAG(+)             = '0'
        AND DAC2.EZCANCELFLAG(+)             = '0'
        AND DAC3.EZCANCELFLAG(+)             = '0'
        AND CPO.EZCANCELFLAG(+)              = '0'
        AND DAMD.EZCANCELFLAG(+)             = '0'
        AND SCM.EZCANCELFLAG(+)              = '0'
        AND DM.EZCANCELFLAG(+)               = '0'
        AND MN.EZCANCELFLAG(+)               = '0'
        AND MG.EZCANCELFLAG(+)               = '0'
        AND DC.EZCANCELFLAG(+)               = '0'
        AND DCC.EZCANCELFLAG(+)              = '0'
        AND STCD.EZCANCELFLAG(+)             = '0'
        AND STCH.EZCANCELFLAG(+)             = '0'
    </statement>

</sqlMap>
