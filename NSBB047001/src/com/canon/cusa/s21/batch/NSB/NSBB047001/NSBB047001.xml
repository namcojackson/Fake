<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSBB047001">

    <!-- #################### Type Alias #################### -->

    <!-- #################### Statement #################### -->
    <statement id="sendTechInfo" parameterClass="Map">
<!-- START 2018/06/25 U.Kim [QC#24961, MOD] -->
<!--WITH TIER AS(  -->
<!--    SELECT -->
<!--        OHSD.ORG_TIER_CD -->
<!--    FROM -->
<!--        STRU_DFN SDF -->
<!--        ,ORG_HRCH_STRU_DFN OHSD -->
<!--    WHERE -->
<!--        SDF.GLBL_CMPY_CD         = #glblCmpyCd# -->
<!--        AND SDF.BR_FLG           = 'Y' -->
<!--        AND SDF.GLBL_CMPY_CD     = OHSD.GLBL_CMPY_CD -->
<!--        AND SDF.STRU_DFN_CD      = OHSD.STRU_DFN_CD -->
<!--        AND OHSD.BIZ_AREA_ORG_CD = #bizAreaOrgCd# -->
<!--        AND SDF.EZCANCELFLAG     = '0' -->
<!--        AND OHSD.EZCANCELFLAG    = '0' -->
<!--        AND OHSD.EFF_FROM_DT               &lt;= #slsDt# -->
<!--        AND NVL(OHSD.EFF_THRU_DT, #slsDt#) &gt;= #slsDt# -->
<!--        AND ROWNUM               = 1 -->
<!--    ) -->
<!--    SELECT DISTINCT -->
<!--          LPAD(TM.TECH_TOC_CD, 6,'0') AS TECH_TOC_CD -->
<!--         ,TTH.TECH_TNG_HIST_PK AS TECH_TNG_HIST_PK -->
<!--         ,TTH.SVC_SKILL_NUM AS SVC_SKILL_NUM -->
<!--         ,PSN.PSN_LAST_NM || ' ' || PSN.PSN_FIRST_NM || NVL2(PSN.PSN_MID_NM, ' ' || PSN.PSN_MID_NM, '') AS TECH_PSN_NM -->
<!--         ,PSN.PSN_CD AS PSN_CD -->
<!--         ,PSN.LINE_BIZ_TP_CD AS LINE_BIZ_TP_CD -->
<!-- START 2017/08/08 K.Kitachi [QC#19798, MOD] -->
<!--         ,DECODE(PSN.DEL_FLG, 'Y', 'N', 'N', 'Y') AS ACTV_FLG -->
<!--         ,CASE WHEN PSN.DEL_FLG = 'N' -->
<!--                AND EXISTS ( -->
<!--                             SELECT 1 -->
<!--                               FROM -->
<!--                                    ORG_FUNC_ROLE_TP  OFR -->
<!--                              WHERE OFR.EZCANCELFLAG                  = '0' -->
<!--                                AND OFR.GLBL_CMPY_CD                  = TOC.GLBL_CMPY_CD -->
<!--                                AND OFR.ORG_FUNC_ROLE_TP_CD           = TOC.ORG_FUNC_ROLE_TP_CD -->
<!--                                AND OFR.TECH_MSTR_REQ_FLG             = 'Y' -->
<!--                           ) -->
<!--                AND EXISTS ( -->
<!--                             SELECT 1 -->
<!--                               FROM -->
<!--                                    RTL_WH            RTL -->
<!--                              WHERE RTL.EZCANCELFLAG                  = '0' -->
<!--                                AND RTL.GLBL_CMPY_CD                  = TM.GLBL_CMPY_CD -->
<!--                                AND RTL.RTL_WH_CD                     = TM.TECH_TOC_CD -->
<!--                                AND RTL.EFF_FROM_DT               &lt;= #slsDt# -->
<!--                                AND NVL(RTL.EFF_THRU_DT, #slsDt#) &gt;= #slsDt# -->
<!--                           ) -->
                   <!-- START 2018/06/21 U.Kim [QC#22124, ADD] -->
<!--               AND EXISTS( -->
<!--                             SELECT 1 -->
<!--                               FROM -->
<!--                                    ORG_FUNC_ASG  OFA -->
<!--                              WHERE OFA.EZCANCELFLAG                  ='0' -->
<!--                                AND OFA.GLBL_CMPY_CD                  = TOC.GLBL_CMPY_CD -->
<!--                                AND OFA.TOC_CD                        = TOC.TOC_CD -->
<!--                                AND OFA.PSN_CD                        = PSN.PSN_CD -->
<!--                                AND OFA.EFF_FROM_DT               &lt;= #slsDt# -->
<!--                                AND NVL(OFA.EFF_THRU_DT ,#slsDt#) &gt;= #slsDt# -->
<!--                           ) -->
                   <!-- END 2018/06/21 U.Kim [QC#22124, ADD] -->
<!--               THEN 'Y' -->
<!--               ELSE 'N' -->
<!--          END AS ACTV_FLG -->
<!-- END 2017/08/08 K.Kitachi [QC#19798, MOD] -->
<!--         ,PSN.CELL_TEL_NUM AS CELL_TEL_NUM -->
<!--         ,CASE WHEN TIER.ORG_TIER_CD = ORG.FIRST_ORG_TIER_CD  AND ORG.FIRST_ORG_CD  IS NOT NULL THEN ORG.FIRST_ORG_NM -->
<!--               WHEN TIER.ORG_TIER_CD = ORG.SCD_ORG_TIER_CD    AND ORG.SCD_ORG_CD    IS NOT NULL THEN ORG.SCD_ORG_NM -->
<!--               WHEN TIER.ORG_TIER_CD = ORG.THIRD_ORG_TIER_CD  AND ORG.THIRD_ORG_CD  IS NOT NULL THEN ORG.THIRD_ORG_NM -->
<!--               WHEN TIER.ORG_TIER_CD = ORG.FRTH_ORG_TIER_CD   AND ORG.FRTH_ORG_CD   IS NOT NULL THEN ORG.FRTH_ORG_NM -->
<!--               WHEN TIER.ORG_TIER_CD = ORG.FIFTH_ORG_TIER_CD  AND ORG.FIFTH_ORG_CD  IS NOT NULL THEN ORG.FIFTH_ORG_NM -->
<!--               WHEN TIER.ORG_TIER_CD = ORG.SIXTH_ORG_TIER_CD  AND ORG.SIXTH_ORG_CD  IS NOT NULL THEN ORG.SIXTH_ORG_NM -->
<!--               WHEN TIER.ORG_TIER_CD = ORG.SVNTH_ORG_TIER_CD  AND ORG.SVNTH_ORG_CD  IS NOT NULL THEN ORG.SVNTH_ORG_NM -->
<!--               WHEN TIER.ORG_TIER_CD = ORG.EIGHTH_ORG_TIER_CD AND ORG.EIGHTH_ORG_CD IS NOT NULL THEN ORG.EIGHTH_ORG_NM -->
<!--               WHEN TIER.ORG_TIER_CD = ORG.NINTH_ORG_TIER_CD  AND ORG.NINTH_ORG_CD  IS NOT NULL THEN ORG.NINTH_ORG_NM -->
<!--               WHEN TIER.ORG_TIER_CD = ORG.TENTH_ORG_TIER_CD  AND ORG.TENTH_ORG_CD  IS NOT NULL THEN ORG.TENTH_ORG_NM -->
<!--               WHEN TIER.ORG_TIER_CD = ORG.ELVTH_ORG_TIER_CD  AND ORG.ELVTH_ORG_CD  IS NOT NULL THEN ORG.ELVTH_ORG_NM -->
<!--          END AS DISTRICT -->
<!--         ,PMIT.SVC_ACCS_PMIT_NUM AS SVC_ACCS_PMIT_NUM -->
<!--         ,PVAL.SVC_ACCS_PMIT_DESC_TXT AS SVC_ACCS_PMIT_DESC_TXT -->
<!--         ,SKL.SVC_SKILL_NM AS SVC_SKILL_NM -->
<!--         ,TPI.PHYS_INVTY_FLG AS PHYS_INVTY_FLG -->
<!--    FROM -->
<!--         TECH_MSTR     TM -->
<!--        ,S21_PSN       PSN -->
<!--        ,TECH_TNG_HIST TTH -->
<!--        ,TOC           TOC -->
<!--        ,SVC_ACCS_PMIT_TECH_RELN RELN -->
<!--        ,SVC_ACCS_PMIT PMIT -->
<!--        ,SVC_ACCS_PMIT_VAL PVAL -->
<!--        ,SVC_SKILL SKL -->
<!--        ,S21_ORG ORG -->
<!--        ,TECH_PHYS_INVTY_V TPI -->
<!--        ,TIER -->
<!-- START 2017/08/08 K.Kitachi [QC#19798, DEL] -->
<!--        ,RTL_WH        RTL -->
<!-- END 2017/08/08 K.Kitachi [QC#19798, DEL] -->
<!--   WHERE -->
<!--         TM.GLBL_CMPY_CD                       = #glblCmpyCd# -->
<!--     AND TM.EZCANCELFLAG                       = '0' -->

<!--     AND TM.GLBL_CMPY_CD                       = PSN.GLBL_CMPY_CD -->
<!--     AND TM.TECH_TOC_CD                        = PSN.PSN_CD -->
<!--     AND PSN.EZCANCELFLAG                      = '0' -->
         <!-- NA#CLICK MOD Start -->
<!--     AND PSN.DEL_FLG                           = 'N' -->
<!--          NA#CLICK MOD End -->
<!-- START 2017/02/09 K.Ochiai [QC#17426, ADD] -->
<!--     AND PSN.PSN_TP_CD                         = #psnTpCd# -->
<!-- END   2017/02/09 K.Ochiai [QC#17426, ADD] -->
<!--     AND TM.GLBL_CMPY_CD                       = TTH.GLBL_CMPY_CD(+) -->
<!--     AND TM.TECH_TOC_CD                        = TTH.TECH_CD(+) -->
<!--     AND TTH.EZCANCELFLAG(+)                   = '0' -->
<!--     AND TTH.TECH_TNG_HIST_ACTV_FLG(+)         = 'Y' -->
<!--     AND TTH.EFF_FROM_DT (+)               &lt;= #slsDt# -->
<!--     AND NVL(TTH.EFF_THRU_DT (+), #slsDt#) &gt;= #slsDt# -->

<!--     AND TM.GLBL_CMPY_CD                       = TOC.GLBL_CMPY_CD -->
<!--     AND TOC.EZCANCELFLAG                      = '0' -->

<!--     AND TM.TECH_TOC_CD                        = RELN.TECH_CD(+) -->
<!--     AND TM.GLBL_CMPY_CD                       = RELN.GLBL_CMPY_CD(+) -->
<!--     AND RELN.EZCANCELFLAG(+)                      = '0' -->

<!--     AND RELN.SVC_ACCS_PMIT_PK                 = PMIT.SVC_ACCS_PMIT_PK(+) -->
<!--     AND RELN.GLBL_CMPY_CD                     = PMIT.GLBL_CMPY_CD(+) -->
<!--     AND PMIT.EZCANCELFLAG(+)                  = '0' -->

<!--     AND PMIT.SVC_ACCS_PMIT_NUM                = PVAL.SVC_ACCS_PMIT_NUM(+) -->
<!--     AND PMIT.GLBL_CMPY_CD                     = PVAL.GLBL_CMPY_CD(+) -->
<!--     AND PVAL.EZCANCELFLAG(+)                  = '0' -->

<!--     AND TTH.GLBL_CMPY_CD                      = SKL.GLBL_CMPY_CD(+) -->
<!--     AND TTH.SVC_SKILL_NUM                     = SKL.SVC_SKILL_NUM(+) -->
<!--     AND SKL.EZCANCELFLAG(+)                   = '0' -->

<!--     AND TOC.GLBL_CMPY_CD                      = ORG.GLBL_CMPY_CD -->
<!--     AND TOC.TOC_CD                            = ORG.TOC_CD -->
<!--     AND ORG.EZCANCELFLAG                      = '0' -->

<!--     AND TM.GLBL_CMPY_CD                       = TPI.GLBL_CMPY_CD (+) -->
<!--     AND TM.TECH_TOC_CD                        = TPI.TECH_TOC_CD (+) -->

<!-- START 2017/08/08 K.Kitachi [QC#19798, DEL] -->
<!--     AND TM.GLBL_CMPY_CD                       = RTL.GLBL_CMPY_CD -->
<!--     AND TM.TECH_TOC_CD                        = RTL.RTL_WH_CD -->
<!--     AND RTL.EFF_FROM_DT                   &lt;= #slsDt# -->
<!--     AND NVL(RTL.EFF_THRU_DT , #slsDt#)    &gt;= #slsDt# -->
<!--     AND RTL.EZCANCELFLAG                      = '0' -->
<!-- END 2017/08/08 K.Kitachi [QC#19798, DEL] -->

<!-- START 2018/06/21 U.Kim [QC#22124, DEL] -->
<!--     AND EXISTS( -->
<!--                  SELECT 1 -->
<!--                    FROM -->
<!--                         ORG_FUNC_ASG  OFA -->
<!--                   WHERE OFA.EZCANCELFLAG='0' -->
<!--                     AND OFA.GLBL_CMPY_CD = TOC.GLBL_CMPY_CD -->
<!--                     AND OFA.TOC_CD = TOC.TOC_CD -->
<!--                     AND OFA.PSN_CD = PSN.PSN_CD -->
<!--                     AND OFA.EFF_FROM_DT &lt;= #slsDt# -->
<!--                     AND NVL(OFA.EFF_THRU_DT , #slsDt#) &gt;= #slsDt# -->
<!--               ) -->
<!-- END 2018/06/21 U.Kim [QC#22124, DEL] -->

<!-- START 2017/08/08 K.Kitachi [QC#19798, DEL] -->
<!--    AND EXISTS( -->
<!--                  SELECT 1 -->
<!--                    FROM -->
<!--                         ORG_FUNC_ROLE_TP  OFR -->
<!--                   WHERE OFR.EZCANCELFLAG        = '0' -->
<!--                     AND OFR.GLBL_CMPY_CD        = TOC.GLBL_CMPY_CD -->
<!--                     AND OFR.ORG_FUNC_ROLE_TP_CD = TOC.ORG_FUNC_ROLE_TP_CD -->
<!--                     AND OFR.TECH_MSTR_REQ_FLG   = 'Y' -->
<!--               ) -->
<!-- END 2017/08/08 K.Kitachi [QC#19798, DEL] -->
<!--<isEqual property="batchMode" compareValue="Y"> -->
<!--     AND ( -->
              <!-- START 2018/06/20 [QC#24961, MOD -->
              <!-- S21_PSN -->
<!--         PSN.EZUPTIME &gt; #lastProcTs# -->
             <!-- TECH_TNG_HIST -->
<!--         OR EXISTS -->
<!--                ( -->
<!--                   SELECT -->
<!--                         1 -->
<!--                    FROM -->
<!--                         TECH_TNG_HIST TNG -->
<!--                   WHERE -->
<!--                         TNG.GLBL_CMPY_CD = TM.GLBL_CMPY_CD -->
<!--                     AND TNG.EZCANCELFLAG = '0' -->
<!--                     AND TNG.TECH_CD      = TM.TECH_TOC_CD -->
<!--                     AND TNG.EZUPTIME     &gt; #lastProcTs# -->
<!--                ) -->
             <!-- TOC -->
<!--         OR EXISTS -->
<!--                ( -->
<!--                   SELECT -->
<!--                         1 -->
<!--                    FROM -->
<!--                         TOC TOC -->
<!--                         ,ORG_FUNC_ASG  OFA -->
<!--                         ,S21_ORG ORG -->
<!--                   WHERE -->
<!--                         OFA.GLBL_CMPY_CD = PSN.GLBL_CMPY_CD -->
<!--                     AND OFA.EZCANCELFLAG = '0' -->
<!--                     AND OFA.PSN_CD       = PSN.PSN_CD -->
<!--                     AND OFA.GLBL_CMPY_CD = TOC.GLBL_CMPY_CD -->
<!--                     AND OFA.TOC_CD       = TOC.TOC_CD -->
                         <!-- In order to detect the difference that include the deleted data,  -->
<!--                          EZCANCELFLAG is not included in the search condition. -->
                         <!--AND TOC.EZCANCELFLAG = '0'  -->
<!--                     AND TOC.GLBL_CMPY_CD = ORG.GLBL_CMPY_CD -->
<!--                     AND TOC.TOC_CD       = ORG.TOC_CD -->
<!--                     AND ORG.EZCANCELFLAG = '0' -->
<!--                     AND (TOC.EZUPTIME     &gt; #lastProcTs# -->
                         <!-- START 2018/06/21 U.Kim [QC#22124, MOD] -->
                         <!-- OR ORG.EZUPTIME   &gt; #lastProcTs#) -->
<!--                          OR ORG.EZUPTIME   &gt; #lastProcTs# -->
<!--                          OR OFA.EZUPTIME   &gt; #lastProcTs#) -->
                         <!-- END 2018/06/21 U.Kim [QC#22124, MOD] -->
<!-- START 2017/08/08 K.Kitachi [QC#19798, DEL] -->
<!--                     AND EXISTS( -->
<!--                                  SELECT 1 -->
<!--                                    FROM -->
<!--                                         ORG_FUNC_ROLE_TP  OFR -->
<!--                                   WHERE OFR.EZCANCELFLAG        = '0' -->
<!--                                     AND OFR.GLBL_CMPY_CD        = TOC.GLBL_CMPY_CD -->
<!--                                     AND OFR.ORG_FUNC_ROLE_TP_CD = TOC.ORG_FUNC_ROLE_TP_CD -->
<!--                                     AND OFR.TECH_MSTR_REQ_FLG   = 'Y' -->
<!--                               ) -->
<!-- END 2017/08/08 K.Kitachi [QC#19798, DEL] -->
<!--                ) -->
             <!-- SVC_ACCS_PMIT_TECH_RELN -->
<!--         OR EXISTS -->
<!--                ( -->
<!--                    SELECT -->
<!--                         1 -->
<!--                    FROM -->
<!--                         SVC_ACCS_PMIT_TECH_RELN RELN -->
<!--                   WHERE -->
<!--                         RELN.GLBL_CMPY_CD = TM.GLBL_CMPY_CD -->
<!--                     AND RELN.TECH_CD     = TM.TECH_TOC_CD -->
                         <!-- In order to detect the difference that include the deleted data,  -->
<!--                          EZCANCELFLAG is not included in the search condition. -->
                         <!--AND RELN.EZCANCELFLAG = '0'  -->
<!--                     AND RELN.EZUPTIME    &gt; #lastProcTs# -->
<!--                ) -->
            <!-- TECH_PHYS_INVTY_V -->
<!--         OR EXISTS -->
<!--                ( -->
<!--                    SELECT -->
<!--                         1 -->
<!--                    FROM -->
<!--                         TECH_PHYS_INVTY_V TPIV -->
<!--                   WHERE -->
<!--                         TPIV.GLBL_CMPY_CD = TM.GLBL_CMPY_CD -->
<!--                     AND TPIV.TECH_TOC_CD = TM.TECH_TOC_CD -->
                         <!-- In order to detect the difference that include the deleted data,  -->
<!--                          EZCANCELFLAG is not included in the search condition. -->
                         <!--AND RELN.EZCANCELFLAG = '0'  -->
<!--                     AND TPIV.UPD_TS   &gt; #lastProcTs# -->
<!--                ) -->
<!--        ) -->
            <!-- END 2018/06/20 [QC#24961, MOD -->
<!--</isEqual> -->
<!--    ORDER BY -->
<!--         TECH_TOC_CD -->
<!--        ,TTH.SVC_SKILL_NUM -->
<!--        ,PMIT.SVC_ACCS_PMIT_NUM -->
    WITH TARGET_TECH AS (
            SELECT DISTINCT
                 TM.GLBL_CMPY_CD         AS GLBL_CMPY_CD
                ,TM.TECH_TOC_CD          AS TECH_TOC_CD
                ,TOC.TOC_CD              AS TOC_CD
                ,TOC.ORG_FUNC_ROLE_TP_CD AS ORG_FUNC_ROLE_TP_CD
                ,PSN.PSN_CD              AS PSN_CD
                ,PSN.PSN_LAST_NM         AS PSN_LAST_NM
                ,PSN.PSN_FIRST_NM        AS PSN_FIRST_NM
                ,PSN.PSN_MID_NM          AS PSN_MID_NM
                ,PSN.DEL_FLG             AS DEL_FLG
                ,PSN.LINE_BIZ_TP_CD      AS LINE_BIZ_TP_CD
                ,PSN.CELL_TEL_NUM        AS CELL_TEL_NUM
                <!-- START 2019/06/19 [QC#50880, ADD] -->
                ,OFA.EFF_FROM_DT         AS EFF_FROM_DT
                ,OFA.EFF_THRU_DT         AS EFF_THRU_DT
                ,OFA.EZUPTIME            AS EZUPTIME
                <!-- END   2019/06/19 [QC#50880, ADD] -->
            FROM
                 TECH_MSTR     TM
                ,S21_PSN       PSN
                ,ORG_FUNC_ASG  OFA
                ,TOC           TOC
            WHERE
                    TM.GLBL_CMPY_CD                       = #glblCmpyCd#
                AND TM.EZCANCELFLAG                       = '0'
                AND TM.GLBL_CMPY_CD                       = PSN.GLBL_CMPY_CD
                AND TM.TECH_TOC_CD                        = PSN.PSN_CD
                AND PSN.PSN_TP_CD                         = #psnTpCd#
                AND PSN.EZCANCELFLAG                      = '0'
                AND PSN.GLBL_CMPY_CD                      = OFA.GLBL_CMPY_CD
                AND PSN.PSN_CD                            = OFA.PSN_CD
                AND OFA.EFF_FROM_DT                   &lt;= #slsDt#
                AND OFA.EZCANCELFLAG                      = '0'
                AND OFA.GLBL_CMPY_CD                      = TOC.GLBL_CMPY_CD
                AND OFA.TOC_CD                            = TOC.TOC_CD
                AND TOC.EZCANCELFLAG                      = '0'
                <!-- START 2018/07/24 K.Kitachi [QC#27266, ADD] -->
                AND EXISTS (
                    SELECT
                        1
                    FROM
                        S21_ORG ORG
                    WHERE
                            TOC.GLBL_CMPY_CD = ORG.GLBL_CMPY_CD
                        AND TOC.TOC_CD       = ORG.TOC_CD
                        AND ORG.EZCANCELFLAG = '0'
                        AND ORG.FIRST_ORG_CD = #bizAreaOrgCd#
                )
                <!-- END 2018/07/24 K.Kitachi [QC#27266, ADD] -->
    <isEqual property="batchMode" compareValue="Y">
                AND (
                       PSN.EZUPTIME &gt; #lastProcTs#
                    OR TOC.EZUPTIME &gt; #lastProcTs#
                    OR OFA.EZUPTIME &gt; #lastProcTs#
                    OR EXISTS
                        (
                            SELECT
                                1
                            FROM
                                TECH_TNG_HIST TNG
                              WHERE
                                    TNG.GLBL_CMPY_CD = TM.GLBL_CMPY_CD
                                AND TNG.TECH_CD      = TM.TECH_TOC_CD
                                AND TNG.EZCANCELFLAG = '0'
                                AND TNG.EZUPTIME  &gt; #lastProcTs#
                        )
                    OR EXISTS
                        (
                            SELECT
                                1
                            FROM
                                S21_ORG ORG
                            WHERE
                                    TOC.GLBL_CMPY_CD = ORG.GLBL_CMPY_CD
                                AND TOC.TOC_CD       = ORG.TOC_CD
                                AND ORG.EZCANCELFLAG = '0'
                                AND ORG.EZUPTIME  &gt; #lastProcTs#
                        )
                    OR EXISTS
                        (
                            SELECT
                                1
                            FROM
                                SVC_ACCS_PMIT_TECH_RELN RELN
                            WHERE
                                    RELN.GLBL_CMPY_CD = TM.GLBL_CMPY_CD
                                AND RELN.TECH_CD      = TM.TECH_TOC_CD
                                AND RELN.EZUPTIME  &gt; #lastProcTs#
                        )
                    OR EXISTS
                        (
                            SELECT
                                1
                            FROM
                                TECH_PHYS_INVTY_V TPIV
                            WHERE
                                    TPIV.GLBL_CMPY_CD = TM.GLBL_CMPY_CD
                                AND TPIV.TECH_TOC_CD  = TM.TECH_TOC_CD
                                AND TPIV.UPD_TS    &gt; #lastProcTs#
                        )
                    )
    </isEqual>
        ) ,TARGET_SEND AS (
        SELECT DISTINCT
              LPAD(TT.TECH_TOC_CD, 6,'0')  AS TECH_TOC_CD
             <!-- START 2019/06/19 [QC#50880, ADD] -->
             ,TT.TOC_CD                    AS TOC_CD
             <!-- END   2019/06/19 [QC#50880, ADD] -->
             ,TTH.TECH_TNG_HIST_PK         AS TECH_TNG_HIST_PK
             ,TTH.SVC_SKILL_NUM            AS SVC_SKILL_NUM
             ,TT.PSN_LAST_NM || ' ' || TT.PSN_FIRST_NM || NVL2(TT.PSN_MID_NM, ' ' || TT.PSN_MID_NM, '') AS TECH_PSN_NM
             <!-- START 2022/09/13 [QC#60566, ADD] -->
             ,TT.PSN_FIRST_NM              AS PSN_FIRST_NM
             ,TT.PSN_LAST_NM               AS PSN_LAST_NM
             <!-- END   2022/09/13 [QC#60566, ADD] -->
             ,TT.PSN_CD                    AS PSN_CD
             ,TT.LINE_BIZ_TP_CD            AS LINE_BIZ_TP_CD
             ,CASE WHEN TT.DEL_FLG = 'N'
                    AND EXISTS (
                                 SELECT 1
                                   FROM
                                        ORG_FUNC_ROLE_TP OFR
                                  WHERE OFR.EZCANCELFLAG                  = '0'
                                    AND OFR.GLBL_CMPY_CD                  = TT.GLBL_CMPY_CD
                                    AND OFR.ORG_FUNC_ROLE_TP_CD           = TT.ORG_FUNC_ROLE_TP_CD
                                    AND OFR.TECH_MSTR_REQ_FLG             = 'Y'
                               )
                    AND EXISTS (
                                 SELECT 1
                                   FROM
                                        RTL_WH RTL
                                  WHERE RTL.EZCANCELFLAG                  = '0'
                                    AND RTL.GLBL_CMPY_CD                  = TT.GLBL_CMPY_CD
                                    AND RTL.RTL_WH_CD                     = TT.TECH_TOC_CD
                                    AND RTL.EFF_FROM_DT               &lt;= #slsDt#
                                    AND NVL(RTL.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
                               )
                    <!-- START 2019/06/19 [QC#50880, DEL]                                       -->
                    <!--AND EXISTS(                                                             -->
                    <!--             SELECT 1                                                   -->
                    <!--               FROM                                                     -->
                    <!--                    ORG_FUNC_ASG OFA                                    -->
                    <!--              WHERE OFA.EZCANCELFLAG                  ='0'              -->
                    <!--                AND OFA.GLBL_CMPY_CD                  = TT.GLBL_CMPY_CD -->
                    <!--                AND OFA.TOC_CD                        = TT.TOC_CD       -->
                    <!--                AND OFA.PSN_CD                        = TT.PSN_CD       -->
                    <!--                AND OFA.EFF_FROM_DT               &lt;= #slsDt#         -->
                    <!--                AND NVL(OFA.EFF_THRU_DT ,#slsDt#) &gt;= #slsDt#         -->
                    <!--           )                                                            -->
                    <!-- END   2019/06/19 [QC#50880, DEL]                                       -->
                    <!-- START 2019/06/19 [QC#50880, ADD] -->
                    AND TT.EFF_FROM_DT               &lt;= #slsDt#
                    AND NVL(TT.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
                    <!-- END   2019/06/19 [QC#50880, ADD] -->
                   THEN 'Y'
                   ELSE 'N'
              END AS ACTV_FLG
             ,TT.CELL_TEL_NUM AS CELL_TEL_NUM
             ,CASE WHEN #orgTierCd# = ORG.FIRST_ORG_TIER_CD  AND ORG.FIRST_ORG_CD  IS NOT NULL THEN ORG.FIRST_ORG_NM
                   WHEN #orgTierCd# = ORG.SCD_ORG_TIER_CD    AND ORG.SCD_ORG_CD    IS NOT NULL THEN ORG.SCD_ORG_NM
                   WHEN #orgTierCd# = ORG.THIRD_ORG_TIER_CD  AND ORG.THIRD_ORG_CD  IS NOT NULL THEN ORG.THIRD_ORG_NM
                   WHEN #orgTierCd# = ORG.FRTH_ORG_TIER_CD   AND ORG.FRTH_ORG_CD   IS NOT NULL THEN ORG.FRTH_ORG_NM
                   WHEN #orgTierCd# = ORG.FIFTH_ORG_TIER_CD  AND ORG.FIFTH_ORG_CD  IS NOT NULL THEN ORG.FIFTH_ORG_NM
                   WHEN #orgTierCd# = ORG.SIXTH_ORG_TIER_CD  AND ORG.SIXTH_ORG_CD  IS NOT NULL THEN ORG.SIXTH_ORG_NM
                   WHEN #orgTierCd# = ORG.SVNTH_ORG_TIER_CD  AND ORG.SVNTH_ORG_CD  IS NOT NULL THEN ORG.SVNTH_ORG_NM
                   WHEN #orgTierCd# = ORG.EIGHTH_ORG_TIER_CD AND ORG.EIGHTH_ORG_CD IS NOT NULL THEN ORG.EIGHTH_ORG_NM
                   WHEN #orgTierCd# = ORG.NINTH_ORG_TIER_CD  AND ORG.NINTH_ORG_CD  IS NOT NULL THEN ORG.NINTH_ORG_NM
                   WHEN #orgTierCd# = ORG.TENTH_ORG_TIER_CD  AND ORG.TENTH_ORG_CD  IS NOT NULL THEN ORG.TENTH_ORG_NM
                   WHEN #orgTierCd# = ORG.ELVTH_ORG_TIER_CD  AND ORG.ELVTH_ORG_CD  IS NOT NULL THEN ORG.ELVTH_ORG_NM
              END AS DISTRICT
             ,PMIT.SVC_ACCS_PMIT_NUM      AS SVC_ACCS_PMIT_NUM
             ,PVAL.SVC_ACCS_PMIT_DESC_TXT AS SVC_ACCS_PMIT_DESC_TXT
             ,SKL.SVC_SKILL_NM            AS SVC_SKILL_NM
             ,TPI.PHYS_INVTY_FLG          AS PHYS_INVTY_FLG
             <!-- START 2019/06/19 [QC#50880, ADD] -->
             ,TT.EFF_FROM_DT              AS EFF_FROM_DT
             ,TT.EFF_THRU_DT              AS EFF_THRU_DT
             ,TT.EZUPTIME                 AS EZUPTIME
             <!-- END   2019/06/19 [QC#50880, ADD] -->
        FROM
             TARGET_TECH             TT
            ,TECH_TNG_HIST           TTH
            ,SVC_ACCS_PMIT_TECH_RELN RELN
            ,SVC_ACCS_PMIT           PMIT
            ,SVC_ACCS_PMIT_VAL       PVAL
            ,SVC_SKILL               SKL
            ,S21_ORG                 ORG
            ,TECH_PHYS_INVTY_V       TPI
            <!-- START 2018/07/24 K.Kitachi [QC#27266, ADD] -->
            ,RTL_WH                  RTL
            <!-- END 2018/07/24 K.Kitachi [QC#27266, ADD] -->
        WHERE
                TT.GLBL_CMPY_CD                       = TTH.GLBL_CMPY_CD(+)
            AND TT.TECH_TOC_CD                        = TTH.TECH_CD(+)
            AND TTH.EZCANCELFLAG(+)                   = '0'
            AND TTH.TECH_TNG_HIST_ACTV_FLG(+)         = 'Y'
            AND TTH.EFF_FROM_DT (+)               &lt;= #slsDt#
            AND NVL(TTH.EFF_THRU_DT (+), #slsDt#) &gt;= #slsDt#
            AND TT.TECH_TOC_CD                        = RELN.TECH_CD(+)
            AND TT.GLBL_CMPY_CD                       = RELN.GLBL_CMPY_CD(+)
            AND RELN.EZCANCELFLAG(+)                  = '0'
            AND RELN.SVC_ACCS_PMIT_PK                 = PMIT.SVC_ACCS_PMIT_PK(+)
            AND RELN.GLBL_CMPY_CD                     = PMIT.GLBL_CMPY_CD(+)
            AND PMIT.EZCANCELFLAG(+)                  = '0'
            AND PMIT.SVC_ACCS_PMIT_NUM                = PVAL.SVC_ACCS_PMIT_NUM(+)
            AND PMIT.GLBL_CMPY_CD                     = PVAL.GLBL_CMPY_CD(+)
            AND PVAL.EZCANCELFLAG(+)                  = '0'
            AND TTH.GLBL_CMPY_CD                      = SKL.GLBL_CMPY_CD(+)
            AND TTH.SVC_SKILL_NUM                     = SKL.SVC_SKILL_NUM(+)
            AND SKL.EZCANCELFLAG(+)                   = '0'
            AND TT.GLBL_CMPY_CD                       = ORG.GLBL_CMPY_CD
            AND TT.TOC_CD                             = ORG.TOC_CD
            AND ORG.EZCANCELFLAG                      = '0'
            AND TT.GLBL_CMPY_CD                       = TPI.GLBL_CMPY_CD (+)
            AND TT.TECH_TOC_CD                        = TPI.TECH_TOC_CD (+)
            <!-- START 2018/07/24 K.Kitachi [QC#27266, ADD] -->
            AND TT.GLBL_CMPY_CD                       = RTL.GLBL_CMPY_CD
            AND TT.TECH_TOC_CD                        = RTL.RTL_WH_CD
            <!-- START 2018/07/30 K.Kitachi [QC#27266, DEL] -->
            <!-- AND RTL.EFF_FROM_DT                   &lt;= #slsDt# -->
            <!-- AND NVL(RTL.EFF_THRU_DT , #slsDt#)    &gt;= #slsDt# -->
            <!-- END 2018/07/30 K.Kitachi [QC#27266, DEL] -->
            AND RTL.EZCANCELFLAG                      = '0'
            <!-- END 2018/07/24 K.Kitachi [QC#27266, ADD] -->
        <!-- START 2019/06/19 [QC#50880, DEL] -->
        <!-- ORDER BY                         -->
        <!--      TECH_TOC_CD                 -->
        <!--     ,TTH.SVC_SKILL_NUM           -->
        <!--     ,PMIT.SVC_ACCS_PMIT_NUM      -->
        <!-- END   2019/06/19 [QC#50880, DEL] -->
        <!-- START 2019/06/19 [QC#50880, ADD] -->
        )
        SELECT DISTINCT
              TS.TECH_TOC_CD             AS TECH_TOC_CD
             ,TS.TECH_TNG_HIST_PK        AS TECH_TNG_HIST_PK
             ,TS.SVC_SKILL_NUM           AS SVC_SKILL_NUM
             ,TS.TECH_PSN_NM             AS TECH_PSN_NM
             <!-- START 2022/09/13 [QC#60566, ADD] -->
             ,TS.PSN_FIRST_NM            AS PSN_FIRST_NM
             ,TS.PSN_LAST_NM             AS PSN_LAST_NM
             <!-- END 2022/09/13 [QC#60566, ADD] -->
             ,TS.PSN_CD                  AS PSN_CD
             ,TS.LINE_BIZ_TP_CD          AS LINE_BIZ_TP_CD
             ,TS.ACTV_FLG                AS ACTV_FLG
             ,TS.CELL_TEL_NUM            AS CELL_TEL_NUM
             ,TS.DISTRICT                AS DISTRICT
             ,TS.SVC_ACCS_PMIT_NUM       AS SVC_ACCS_PMIT_NUM
             ,TS.SVC_ACCS_PMIT_DESC_TXT  AS SVC_ACCS_PMIT_DESC_TXT
             ,TS.SVC_SKILL_NM            AS SVC_SKILL_NM
             ,TS.PHYS_INVTY_FLG          AS PHYS_INVTY_FLG
        FROM TARGET_SEND TS
       WHERE NOT EXISTS (
                          SELECT
                                  1
                            FROM
                                  ORG_FUNC_ASG OFA2
                           WHERE  TS.PSN_CD            =    OFA2.PSN_CD
                             AND  TS.TOC_CD        &lt;&gt; OFA2.TOC_CD
                             AND  ( 
                                    NVL(TS.EFF_THRU_DT, #slsDt#)  &lt; OFA2.EFF_FROM_DT
                                    OR
                                    (
                                         NVL(OFA2.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
                                     AND
                                         TS.EZUPTIME                    &lt;= OFA2.EZUPTIME
                                    )
                                    OR
                                    (
                                          TS.ACTV_FLG = 'N'
                                      AND OFA2.EFF_FROM_DT &lt;= #slsDt#
                                      AND NVL(OFA2.EFF_THRU_DT, #slsDt#) >= #slsDt#
                                    )
                                  )
                             AND  OFA2.GLBL_CMPY_CD              = #glblCmpyCd#
                             AND  OFA2.EZCANCELFLAG              = '0'
                         )
          AND NOT EXISTS (
                          SELECT
                                  1
                            FROM
                                  TARGET_SEND TS2
                           WHERE  TS.PSN_CD    =  TS2.PSN_CD
                             AND  TS.TOC_CD    &lt;&gt; TS2.TOC_CD
                             AND  TS2.ACTV_FLG = 'Y'
                         )
        ORDER BY
             TS.TECH_TOC_CD
            ,TS.DISTRICT
            ,TS.SVC_SKILL_NUM
            ,TS.SVC_ACCS_PMIT_NUM
       <!-- END   2019/06/19 [QC#50880, ADD] -->
<!-- END 2018/06/25 U.Kim [QC#24961, MOD] -->
    </statement>

    <statement id="getLastProcTs" parameterClass="Map" resultClass="Map">
        SELECT
            DS_BIZ_PROC_LOG_PK
           ,DS_BIZ_LAST_PROC_TS
        FROM
            DS_BIZ_PROC_LOG
        WHERE
            GLBL_CMPY_CD     = #glblCmpyCd#
            AND PROC_PGM_ID  = #procPgmId#
            AND EZCANCELFLAG = '0'
        ORDER BY
            DS_BIZ_LAST_PROC_TS DESC
    </statement>

<!-- START 2018/06/25 U.Kim [QC#24961, ADD] -->
    <statement id="getOrgTierCd" parameterClass="Map" resultClass="String">
        SELECT
            OHSD.ORG_TIER_CD
        FROM
             STRU_DFN SDF
            ,ORG_HRCH_STRU_DFN OHSD
        WHERE
                SDF.GLBL_CMPY_CD         = #glblCmpyCd#
            AND SDF.BR_FLG           = 'Y'
            AND SDF.GLBL_CMPY_CD     = OHSD.GLBL_CMPY_CD
            AND SDF.STRU_DFN_CD      = OHSD.STRU_DFN_CD
            AND OHSD.BIZ_AREA_ORG_CD = #bizAreaOrgCd#
            AND SDF.EZCANCELFLAG     = '0'
            AND OHSD.EZCANCELFLAG    = '0'
            AND OHSD.EFF_FROM_DT               &lt;= #slsDt#
            AND NVL(OHSD.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
            AND ROWNUM               = 1
    </statement>
<!-- END 2018/06/25 U.Kim [QC#24961, ADD] -->
</sqlMap>
