<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NFAB091001">

<!-- #################### Type Alias #################### -->
<typeAlias alias="MTH_INVTY_RPT_RVALTMsg" type="business.db.MTH_INVTY_RPT_RVALTMsg"/>

<!-- #################### Statement #################### -->


    <statement id="getResultNFAB091001" parameterClass="Map" resultClass="Map">
		SELECT 
			JE.JRNL_ENTRY_PK				AS JRNL_ENTRY_PK,
			JE.AJE_INTFC_TP_CD				AS AJE_INTFC_TP_CD,
			JE.AJE_INTFC_PK					AS AJE_INTFC_PK,
			JE.PROC_DT						AS PROC_DT,
			JE.GL_DT						AS GL_DT,
			JE.GL_SEND_CPLT_FLG				AS GL_SEND_CPLT_FLG,
			JE.AJE_ID						AS AJE_ID,
			JE.TRX_CD						AS TRX_CD,
			JE.TRX_NM						AS TRX_NM,
			JE.TRX_RSN_CD					AS TRX_RSN_CD,
			JE.TRX_RSN_NM					AS TRX_RSN_NM,
			JE.AJE_ITEM_DESC_TXT			AS AJE_ITEM_DESC_TXT,
			JE.DR_COA_ACCT_CD				AS DR_COA_ACCT_CD,
			JE.DR_COA_PROD_CD				AS DR_COA_PROD_CD,
			JE.DR_AJE_LINE_IDX_DESC_TXT		AS DR_AJE_LINE_IDX_DESC_TXT,
			JE.CR_COA_ACCT_CD				AS CR_COA_ACCT_CD,
			JE.CR_AJE_LINE_IDX_DESC_TXT		AS CR_AJE_LINE_IDX_DESC_TXT,
			JE.AJE_ITEM_CD					AS AJE_ITEM_CD,
			JE.COA_PROD_CD				    AS COA_PROD_CD,
			JE.JRNL_QTY						AS JRNL_QTY,
			JE.JRNL_FUNC_DR_AMT				AS JRNL_FUNC_DR_AMT,
			JE.JRNL_FUNC_CR_AMT				AS JRNL_FUNC_CR_AMT,
			CASE
			  WHEN CR_COA_ACCT_CD = PA_CR.COA_ACCT_CD THEN CR_COA_ACCT_CD
			  ELSE DR_COA_ACCT_CD
			END   AS COA_ACCT_CD
		FROM 	
			JRNL_ENTRY 	  		JE
		  , (SELECT PA.COA_ACCT_CD
			       FROM COA_PROJ_ACCT_TP    PAT
			           ,COA_PROJ_ACCT       PA
			      WHERE PAT.GLBL_CMPY_CD        = #glblCmpyCd#
			        AND PAT.EZCANCELFLAG        = '0'
			        AND PAT.GLBL_CMPY_CD        = PA.GLBL_CMPY_CD
			        AND PAT.EZCANCELFLAG        = PA.EZCANCELFLAG
			        AND PAT.COA_PROJ_ACCT_TP_CD = PA.COA_PROJ_ACCT_TP_CD
			        AND PAT.INVTY_ACCT_FLG      = #flgY#
			      GROUP BY PA.COA_ACCT_CD
			 UNION ALL
			   SELECT #loanAcct# AS COA_ACCT_CD
			     FROM DUAL
			    ) PA_DR
		  , (SELECT PA.COA_ACCT_CD
			       FROM COA_PROJ_ACCT_TP    PAT
			           ,COA_PROJ_ACCT       PA
			      WHERE PAT.GLBL_CMPY_CD        = #glblCmpyCd#
			        AND PAT.EZCANCELFLAG        = '0'
			        AND PAT.GLBL_CMPY_CD        = PA.GLBL_CMPY_CD
			        AND PAT.EZCANCELFLAG        = PA.EZCANCELFLAG
			        AND PAT.COA_PROJ_ACCT_TP_CD = PA.COA_PROJ_ACCT_TP_CD
			        AND PAT.INVTY_ACCT_FLG      = #flgY#
			      GROUP BY PA.COA_ACCT_CD
			 UNION ALL
			   SELECT #loanAcct# AS COA_ACCT_CD
			     FROM DUAL
			    ) PA_CR
		WHERE 	
			JE.EZCANCELFLAG 	= '0'
		AND JE.GLBL_CMPY_CD 	= #glblCmpyCd#
		AND	JE.TRX_CD 			= #trxCdCostCalculation#
		AND	(JE.TRX_RSN_CD 		= #trxRsnCdRevaluation# OR JE.TRX_RSN_CD = #trxRsnCdWriteDown#)
		AND JE.DR_COA_ACCT_CD   = PA_DR.COA_ACCT_CD(+)
		AND JE.CR_COA_ACCT_CD   = PA_CR.COA_ACCT_CD(+)
		AND JE.GL_DT 			LIKE #glYearMonth#
			ORDER BY 
			JE.JRNL_ENTRY_PK
	</statement>
	
	<statement id="getOldData" parameterClass="Map" resultMap="result.queryMTH_INVTY_RPT_RVAL">
	    SELECT GLBL_CMPY_CD
	          ,JRNL_ENTRY_PK
	      FROM MTH_INVTY_RPT_RVAL
	     WHERE GLBL_CMPY_CD = #glblCmpyCd#
	       AND EZCANCELFLAG = '0'
	       AND GL_DT        LIKE #glYearMonth# 
	</statement>
	
	<resultMap id="result.queryMTH_INVTY_RPT_RVAL" class="MTH_INVTY_RPT_RVALTMsg">
		<result property="glblCmpyCd"			column="GLBL_CMPY_CD"			javaType="EZDTStringItem"/>
		<result property="jrnlEntryPk"	        column="JRNL_ENTRY_PK"	        javaType="EZDTBigDecimalItem"/>
	</resultMap>
	
	<statement id="back_getResultNFAB091001" parameterClass="Map" resultClass="Map">
		SELECT 
			JE.JRNL_ENTRY_PK				AS JRNL_ENTRY_PK,
			JE.AJE_INTFC_TP_CD				AS AJE_INTFC_TP_CD,
			JE.AJE_INTFC_PK					AS AJE_INTFC_PK,
			JE.PROC_DT						AS PROC_DT,
			JE.GL_DT						AS GL_DT,
			JE.GL_SEND_CPLT_FLG				AS GL_SEND_CPLT_FLG,
			JE.AJE_ID						AS AJE_ID,
			JE.TRX_CD						AS TRX_CD,
			JE.TRX_NM						AS TRX_NM,
			JE.TRX_RSN_CD					AS TRX_RSN_CD,
			JE.TRX_RSN_NM					AS TRX_RSN_NM,
			JE.AJE_ITEM_DESC_TXT			AS AJE_ITEM_DESC_TXT,
			JE.DR_COA_ACCT_CD				AS DR_COA_ACCT_CD,
			JE.DR_COA_PROD_CD				AS DR_COA_PROD_CD,
			JE.DR_AJE_LINE_IDX_DESC_TXT		AS DR_AJE_LINE_IDX_DESC_TXT,
			JE.CR_COA_ACCT_CD				AS CR_COA_ACCT_CD,
			JE.CR_AJE_LINE_IDX_DESC_TXT		AS CR_AJE_LINE_IDX_DESC_TXT,
			JE.AJE_ITEM_CD					AS AJE_ITEM_CD,
			JE.COA_PROD_CD				    AS COA_PROD_CD,
			JE.JRNL_QTY						AS JRNL_QTY,
			JE.JRNL_FUNC_DR_AMT				AS JRNL_FUNC_DR_AMT,
			JE.JRNL_FUNC_CR_AMT				AS JRNL_FUNC_CR_AMT,
			CASE
			  WHEN MC_DR.COA_ACCT_CD IS NOT NULL THEN DR_COA_ACCT_CD
			  ELSE CR_COA_ACCT_CD
			END   AS COA_ACCT_CD
		FROM 	
			JRNL_ENTRY 	  		JE
		  , (SELECT COA_ACCT_CD
			       FROM MDSE_CATG
			      WHERE GLBL_CMPY_CD = #glblCmpyCd#
			        AND EZCANCELFLAG = '0'
			      GROUP BY COA_ACCT_CD
			 ) MC_DR
		 , (SELECT COA_ACCT_CD
			       FROM MDSE_CATG
			      WHERE GLBL_CMPY_CD = #glblCmpyCd#
			        AND EZCANCELFLAG = '0'
			      GROUP BY COA_ACCT_CD
			 ) MC_CR
		WHERE 	
			JE.EZCANCELFLAG 	= '0'
		AND JE.GLBL_CMPY_CD 	= #glblCmpyCd#
		AND	JE.TRX_CD 			= #trxCdCostCalculation#
		AND	(JE.TRX_RSN_CD 		= #trxRsnCdRevaluation# OR JE.TRX_RSN_CD = #trxRsnCdWriteDown#)
		AND JE.DR_COA_ACCT_CD   = MC_DR.COA_ACCT_CD(+)
		AND JE.CR_COA_ACCT_CD   = MC_CR.COA_ACCT_CD(+)
		AND JE.GL_DT 			= #glDt#
			ORDER BY 
			JE.JRNL_ENTRY_PK
	</statement>
	
	<statement id="getCoaProdCdChange" parameterClass="Map" resultClass="Map">
	
	   SELECT ID.MDSE_CD,
	          MDSE.COA_PROD_CD
	     FROM INVTY_DTL_RPT_SMRY_AMT ID
	         ,MDSE_DLY_SNAP_SHOT MDSE
	    WHERE ID.EZCANCELFLAG 	    = '0'
	      AND ID.GLBL_CMPY_CD 	    = #glblCmpyCd#
	      AND MDSE.GLBL_CMPY_CD     = #glblCmpyCd#
	      AND ID.MDSE_CD            = MDSE.MDSE_CD
	      AND ID.COA_PROD_CD &lt;&gt; MDSE.COA_PROD_CD
	      <!-- QC#22290 Start -->
          AND MDSE.LTST_REC_FLG     = #flgY#
          <!-- QC#22290 End -->
	      AND ID.INVTY_SNAP_SHOT_DT = #lastDate#
	    
	</statement>
	
	<statement id="getMaxPrevDt" parameterClass="Map">
		SELECT MAX(INVTY_SNAP_SHOT_DT) DT_PREV
		FROM   INVTY_DTL_RPT_SMRY_AMT 
		WHERE  EZCANCELFLAG            = '0'
        AND    GLBL_CMPY_CD = #glblCmpyCd#
		AND    INVTY_SNAP_SHOT_DT &lt; #dateProc#
	</statement>
	
<!-- 
	<statement id="getResultNFAB091001_022310" parameterClass="Map" resultClass="Map">
		SELECT 
			JE.JRNL_ENTRY_PK				AS JRNL_ENTRY_PK,
			JE.AJE_INTFC_TP_CD				AS AJE_INTFC_TP_CD,
			JE.AJE_INTFC_PK					AS AJE_INTFC_PK,
			JE.PROC_DT						AS PROC_DT,
			JE.GL_DT						AS GL_DT,
			JE.GL_SEND_CPLT_FLG				AS GL_SEND_CPLT_FLG,
			JE.AJE_ID						AS AJE_ID,
			JE.TRX_CD						AS TRX_CD,
			JE.TRX_NM						AS TRX_NM,
			JE.TRX_RSN_CD					AS TRX_RSN_CD,
			JE.TRX_RSN_NM					AS TRX_RSN_NM,
			JE.AJE_ITEM_DESC_TXT			AS AJE_ITEM_DESC_TXT,
			JE.DR_COA_ACCT_CD				AS DR_COA_ACCT_CD,
			JE.DR_COA_PROD_CD				AS DR_COA_PROD_CD,
			JE.DR_AJE_LINE_IDX_DESC_TXT		AS DR_AJE_LINE_IDX_DESC_TXT,
			JE.CR_COA_ACCT_CD				AS CR_COA_ACCT_CD,
			JE.CR_AJE_LINE_IDX_DESC_TXT		AS CR_AJE_LINE_IDX_DESC_TXT,
			JE.AJE_ITEM_CD					AS AJE_ITEM_CD,
			MDSE.COA_PROD_CD				AS COA_PROD_CD,
			JE.JRNL_QTY						AS JRNL_QTY,
			JE.JRNL_FUNC_DR_AMT				AS JRNL_FUNC_DR_AMT,
			JE.JRNL_FUNC_CR_AMT				AS JRNL_FUNC_CR_AMT
		FROM 	
			JRNL_ENTRY 	  		JE,
			MDSE 		      	MDSE,
			AJE_MDSE_RVAL_INTFC ITF,
			LOC_STS				LS
		WHERE 	
			JE.EZCANCELFLAG 	= '0'
		AND JE.GLBL_CMPY_CD 	= #glblCmpyCd#
		AND (MDSE.EZCANCELFLAG  = '0'  OR MDSE.EZCANCELFLAG IS NULL)
		AND (ITF.EZCANCELFLAG  	= '0'  OR ITF.EZCANCELFLAG IS NULL)
		AND (LS.EZCANCELFLAG  	= '0'  OR LS.EZCANCELFLAG IS NULL)
		AND JE.GLBL_CMPY_CD 	= MDSE.GLBL_CMPY_CD(+)
		AND JE.GLBL_CMPY_CD 	= ITF.GLBL_CMPY_CD(+)
		AND JE.GLBL_CMPY_CD 	= LS.GLBL_CMPY_CD
		AND	JE.AJE_ITEM_CD 		= MDSE.MDSE_CD(+)
		AND	JE.AJE_INTFC_PK   	= ITF.AJE_MDSE_RVAL_INTFC_PK
		AND	ITF.LOC_STS_CD   	= LS.LOC_STS_CD(+)
		AND	JE.TRX_CD 			= #trxCdCostCalculation#
		AND	(JE.TRX_RSN_CD 		= #trxRsnCdRevaluation# OR JE.TRX_RSN_CD = #trxRsnCdWriteDown#)
		AND ITF.LOC_STS_CD  	&lt;&gt;  	#locStsCdInTransit#
		AND LS.ASSET_CD 		&lt;&gt; 	#assetCdF#
		AND JE.GL_DT 			= #glDt#
		ORDER BY 
			JE.JRNL_ENTRY_PK
	</statement>
-->
<!-- 	
	<statement id="getResultNFAB091001_021110" parameterClass="Map" resultClass="Map">
		SELECT 
			JE.JRNL_ENTRY_PK				AS JRNL_ENTRY_PK,
			JE.AJE_INTFC_TP_CD				AS AJE_INTFC_TP_CD,
			JE.AJE_INTFC_PK					AS AJE_INTFC_PK,
			JE.PROC_DT						AS PROC_DT,
			JE.GL_DT						AS GL_DT,
			JE.GL_SEND_CPLT_FLG				AS GL_SEND_CPLT_FLG,
			JE.AJE_ID						AS AJE_ID,
			JE.TRX_CD						AS TRX_CD,
			JE.TRX_NM						AS TRX_NM,
			JE.TRX_RSN_CD					AS TRX_RSN_CD,
			JE.TRX_RSN_NM					AS TRX_RSN_NM,
			JE.AJE_ITEM_DESC_TXT			AS AJE_ITEM_DESC_TXT,
			JE.DR_COA_ACCT_CD				AS DR_COA_ACCT_CD,
			JE.DR_COA_PROD_CD				AS DR_COA_PROD_CD,
			JE.DR_AJE_LINE_IDX_DESC_TXT		AS DR_AJE_LINE_IDX_DESC_TXT,
			JE.CR_COA_ACCT_CD				AS CR_COA_ACCT_CD,
			JE.CR_AJE_LINE_IDX_DESC_TXT		AS CR_AJE_LINE_IDX_DESC_TXT,
			JE.AJE_ITEM_CD					AS AJE_ITEM_CD,
			MDSE.COA_PROD_CD				AS COA_PROD_CD,
			JE.JRNL_QTY						AS JRNL_QTY,
			JE.JRNL_FUNC_DR_AMT				AS JRNL_FUNC_DR_AMT,
			JE.JRNL_FUNC_CR_AMT				AS JRNL_FUNC_CR_AMT
		FROM 	
			JRNL_ENTRY 	  		JE,
			MDSE 		      	MDSE,
			AJE_MDSE_RVAL_INTFC ITF,
			LOC_STS				LS
		WHERE 	
			JE.EZCANCELFLAG 	= '0'
		AND JE.GLBL_CMPY_CD 	= #glblCmpyCd#
		AND (MDSE.EZCANCELFLAG  = '0'  OR MDSE.EZCANCELFLAG IS NULL)
		AND (ITF.EZCANCELFLAG  	= '0'  OR ITF.EZCANCELFLAG IS NULL)
		AND (LS.EZCANCELFLAG  	= '0'  OR LS.EZCANCELFLAG IS NULL)
		AND JE.GLBL_CMPY_CD 	= MDSE.GLBL_CMPY_CD(+)
		AND JE.GLBL_CMPY_CD 	= ITF.GLBL_CMPY_CD(+)
		AND JE.GLBL_CMPY_CD 	= LS.GLBL_CMPY_CD
		AND	JE.AJE_ITEM_CD 		= MDSE.MDSE_CD(+)
		AND	JE.AJE_INTFC_PK   	= ITF.AJE_MDSE_RVAL_INTFC_PK
		AND	ITF.LOC_STS_CD   	= LS.LOC_STS_CD(+)
		AND	JE.TRX_CD 			= #trxCdCostCalculation#
		AND	(JE.TRX_RSN_CD 		= #trxRsnCdRevaluation# OR JE.TRX_RSN_CD = #trxRsnCdWriteDown#)
		AND LS.ASSET_CD 		&lt;&gt; 	#assetCdF#
		AND JE.GL_DT 			= #glDt#
		ORDER BY 
			JE.JRNL_ENTRY_PK
	</statement>
-->	


</sqlMap>	
