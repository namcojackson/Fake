<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL2660Query">

    <typeAlias alias="NMAL2660_ACMsg"  type="business.blap.NMAL2660.NMAL2660_ACMsg"/>
    <statement id="getResourceAssignList" parameterClass="Map" resultMap="result.getResourceAssignment">
SELECT
     PSN_NUM                     AS EMPLOYEE
    ,PSN_FIRST_NM                AS FIRSTNM
    ,PSN_LAST_NM                 AS LASTNM
    ,BIZ_AREA_ORG_DESC_TXT       AS BUSINESS
    ,ORG_FUNC_ROLE_TP_DESC_TXT   AS ROLE
    ,ORG_NM                      AS ORGANI
    ,ACCT_TEAM_ROLE_TP_DESC_TXT  AS TERRITORY
    ,EFF_FROM_DT                 AS STARTDAY
    ,EFF_THRU_DT                 AS ENDDATE
FROM
    (
    SELECT
         SPN.PSN_NUM
        ,SPN.PSN_FIRST_NM
        ,SPN.PSN_LAST_NM
        ,BAO.BIZ_AREA_ORG_DESC_TXT
        ,OFR.ORG_FUNC_ROLE_TP_DESC_TXT
        <!-- 2017/08/17 QC#20595 Mod Start -->
        <!-- ,DSU.ORG_NM -->
        ,ORG.ORG_NM
        <!-- 2017/08/17 QC#20595 Mod End -->
        ,ATR.ACCT_TEAM_ROLE_TP_DESC_TXT
        ,DOR.EFF_FROM_DT
        ,DOR.EFF_THRU_DT
    FROM
         DS_ORG_UNIT       DSU
        ,DS_ORG_RESRC_RELN DOR
        ,S21_PSN           SPN
        ,ORG_FUNC_ASG      OFA
        ,ORG_TOC_CHNG_RQST OTCR
        ,ORG_FUNC_ROLE_TP  OFR
        ,BIZ_AREA_ORG      BAO
        ,ORG_STRU_TP       OST
        ,ACCT_TEAM_ROLE_TP ATR
        <!-- 2017/08/17 QC#20595 Add Start -->
        ,DS_ORG_UNIT       ORG
        <!-- 2017/08/17 QC#20595 Add End -->
    WHERE
            DSU.GLBL_CMPY_CD         = #glblCmpyCd#
        AND DSU.ORG_CD               = #organizationCd#
        AND DSU.EZCANCELFLAG         = '0'

        AND DSU.GLBL_CMPY_CD         = DOR.GLBL_CMPY_CD
        AND DSU.ORG_CD               = DOR.ORG_CD
        AND DOR.EZCANCELFLAG         = '0'
        AND DOR.GNRN_TP_CD          IN
        <iterate property="gnrnList" var="gnrnList[]" open="(" close=")" conjunction=",">
                        #gnrnList[]#
        </iterate>

        AND DOR.GLBL_CMPY_CD         = SPN.GLBL_CMPY_CD
        AND DOR.PSN_CD               = SPN.PSN_CD
        AND SPN.EZCANCELFLAG         = '0'

        AND SPN.GLBL_CMPY_CD         = OFA.GLBL_CMPY_CD
        AND SPN.PSN_CD               = OFA.PSN_CD
        AND OFA.EZCANCELFLAG         = '0'
        AND OFA.GNRN_TP_CD          IN
        <iterate property="gnrnList" var="gnrnList[]" open="(" close=")" conjunction=",">
                        #gnrnList[]#
        </iterate>

        AND OFA.GLBL_CMPY_CD         = OTCR.GLBL_CMPY_CD
        AND OFA.TOC_CD               = OTCR.TOC_CD
        AND OTCR.RGTN_STS_CD        != #stsCd#
        AND OTCR.EZCANCELFLAG        = '0'

        AND OTCR.GLBL_CMPY_CD        = OFR.GLBL_CMPY_CD
        AND OTCR.ORG_FUNC_ROLE_TP_CD = OFR.ORG_FUNC_ROLE_TP_CD
        AND OFR.EZCANCELFLAG         = '0'

        AND OFR.GLBL_CMPY_CD         = BAO.GLBL_CMPY_CD
        AND OFR.FIRST_ORG_CD         = BAO.BIZ_AREA_ORG_CD
        AND BAO.EZCANCELFLAG         = '0'

        AND BAO.GLBL_CMPY_CD         = OST.GLBL_CMPY_CD
        AND BAO.ORG_STRU_TP_CD       = OST.ORG_STRU_TP_CD
        AND OST.TRTY_STRU_FLG        = 'N'
        AND OST.EZCANCELFLAG         = '0'

        AND DOR.GLBL_CMPY_CD         = ATR.GLBL_CMPY_CD(+)
        AND DOR.ACCT_TEAM_ROLE_TP_CD = ATR.ACCT_TEAM_ROLE_TP_CD(+)
        AND ATR.EZCANCELFLAG(+)      = '0'
        
        <!-- 2017/08/17 QC#20595 Add Start -->
        AND OTCR.GLBL_CMPY_CD        = ORG.GLBL_CMPY_CD
        AND OTCR.ORG_CD              = ORG.ORG_CD
        AND OTCR.EZCANCELFLAG        = '0'
        <!-- 2017/08/17 QC#20595 Add End -->
        ORDER BY
                SPN.PSN_NUM
    )
WHERE ROWNUM &lt;= #rowNum#
    </statement>
    <resultMap id="result.getResourceAssignment" class="NMAL2660_ACMsg">
        <result property="psnNum"                  column="EMPLOYEE"             javaType="EZDBStringItem"/>
        <result property="psnFirstNm"              column="FIRSTNM"              javaType="EZDBStringItem"/>
        <result property="psnLastNm"               column="LASTNM"               javaType="EZDBStringItem"/>
        <result property="bizAreaOrgDescTxt"       column="BUSINESS"             javaType="EZDBStringItem"/>
        <result property="orgFuncRoleTpDescTxt"    column="ROLE"                 javaType="EZDBStringItem"/>
        <result property="orgNm"                   column="ORGANI"               javaType="EZDBStringItem"/>
        <result property="acctTeamRoleTpDescTxt"   column="TERRITORY"            javaType="EZDBStringItem"/>
        <result property="effFromDt"               column="STARTDAY"             javaType="EZDBStringItem"/>
        <result property="effThruDt"               column="ENDDATE"              javaType="EZDBStringItem"/>
    </resultMap>
</sqlMap>
