<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL0670Query">
    <typeAlias alias="NSAL0670_ASMsg" type="business.blap.NSAL0670.NSAL0670_ASMsg"/>

    <statement id="getContrInfo" parameterClass="Map" resultMap="result.getContrInfo">
        SELECT
             HDR.DS_CONTR_PK                    DS_CONTR_PK
            ,0                                  DS_CONTR_DTL_PK
            ,HDR.DS_CONTR_CATG_CD               DS_CONTR_CATG_CD
            ,HDR.DS_CONTR_NUM                   DS_CONTR_NUM
            ,TRIM(HDR.DS_CONTR_CATG_CD
                || '-' || HDR.DS_CONTR_NUM)  AS XX_SCR_ITEM_34_TXT
            ,STC.DS_ACCT_NM                     DS_ACCT_NM
            ,''                                 SER_NUM
            ,DCS.DS_CONTR_CTRL_STS_NM           DS_CONTR_STS_NM
            ,''                                 T_MDL_NM
            ,HDR.CONTR_VRSN_EFF_FROM_DT         CONTR_VRSN_EFF_FROM_DT
            ,HDR.CONTR_VRSN_EFF_THRU_DT         CONTR_VRSN_EFF_THRU_DT
            ,DCS.DS_CONTR_CTRL_STS_CD           DS_CONTR_HDR_STS_CD
            ,''                                 DS_CONTR_DTL_STS_CD
            ,CAT.DS_CONTR_CATG_SORT_NUM         CATG_SORT_NUM
            ,HDR.DS_CONTR_SRC_TP_CD             DS_CONTR_SRC_TP_CD
            ,''                                 DS_CONTR_DTL_TP_CD
            ,HDR.EZUPTIME                       HDR_EZUPTIME
            ,HDR.EZUPTIMEZONE                   HDR_EZUPTIMEZONE
            ,''                                 DTL_EZUPTIME
            ,''                                 DTL_EZUPTIMEZONE
            ,1                                  SORT_NUM
        FROM
             DS_CONTR               HDR
            ,SELL_TO_CUST           STC
            ,DS_CONTR_STS_V         DCS
            ,DS_CONTR_CATG          CAT
        WHERE
                HDR.GLBL_CMPY_CD        = #glblCmpyCd#
            <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND HDR.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND HDR.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = STC.GLBL_CMPY_CD
            AND HDR.DS_ACCT_NUM         = STC.SELL_TO_CUST_CD
            AND STC.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = DCS.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK         = DCS.DS_CONTR_PK
            AND DCS.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = CAT.GLBL_CMPY_CD
            AND HDR.DS_CONTR_CATG_CD    = CAT.DS_CONTR_CATG_CD
            AND CAT.EZCANCELFLAG        = '0'
UNION ALL
        SELECT
             HDR.DS_CONTR_PK                    DS_CONTR_PK
            ,DTL.DS_CONTR_DTL_PK                DS_CONTR_DTL_PK
            ,HDR.DS_CONTR_CATG_CD               DS_CONTR_CATG_CD
            ,HDR.DS_CONTR_NUM                   DS_CONTR_NUM
            ,''                                 XX_SCR_ITEM_34_TXT
            ,''                                 DS_ACCT_NM
            ,SMM.SER_NUM                        SER_NUM
            ,DDS.DS_CONTR_CTRL_STS_NM           DS_CONTR_STS_NM
            ,MDL.T_MDL_NM                       T_MDL_NM
            ,DTL.CONTR_EFF_FROM_DT              CONTR_VRSN_EFF_FROM_DT
            ,DTL.CONTR_EFF_THRU_DT              CONTR_VRSN_EFF_THRU_DT
            ,''                                 DS_CONTR_HDR_STS_CD
            ,DDS.DS_CONTR_CTRL_STS_CD           DS_CONTR_DTL_STS_CD
            ,CAT.DS_CONTR_CATG_SORT_NUM         CATG_SORT_NUM
            ,HDR.DS_CONTR_SRC_TP_CD             DS_CONTR_SRC_TP_CD
            ,DTL.DS_CONTR_DTL_TP_CD             DS_CONTR_DTL_TP_CD
            ,HDR.EZUPTIME                       HDR_EZUPTIME
            ,HDR.EZUPTIMEZONE                   HDR_EZUPTIMEZONE
            ,DTL.EZUPTIME                       DTL_EZUPTIME
            ,DTL.EZUPTIMEZONE                   DTL_EZUPTIMEZONE
            ,2                                  SORT_NUM
        FROM
             DS_CONTR               HDR
            ,DS_CONTR_DTL           DTL
            ,SVC_MACH_MSTR          SMM
            ,SVC_CONFIG_MSTR        SCM
            ,MDL_NM                 MDL
            ,DS_CONTR_DTL_STS_V     DDS
            ,DS_CONTR_CATG          CAT
        WHERE
                HDR.GLBL_CMPY_CD        = #glblCmpyCd#
            <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND HDR.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND HDR.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = DTL.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK         = DTL.DS_CONTR_PK
            <iterate property="dsContrDtlPkArray" var="dsContrDtlPk[]" open="AND DTL.DS_CONTR_DTL_PK IN (" close=")" conjunction=",">
                #dsContrDtlPk[]#
            </iterate>
            AND DTL.EZCANCELFLAG        = '0'
            AND DTL.GLBL_CMPY_CD        = SMM.GLBL_CMPY_CD
            AND DTL.SVC_MACH_MSTR_PK    = SMM.SVC_MACH_MSTR_PK
            AND SMM.EZCANCELFLAG        = '0'
            AND SMM.GLBL_CMPY_CD        = SCM.GLBL_CMPY_CD(+)
            AND SMM.SVC_CONFIG_MSTR_PK  = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.EZCANCELFLAG(+)     = '0'
            AND SCM.GLBL_CMPY_CD        = MDL.T_GLBL_CMPY_CD(+)
            AND SCM.MDL_ID              = MDL.T_MDL_ID(+)
            AND MDL.EZCANCELFLAG(+)     = '0'
            AND DTL.GLBL_CMPY_CD        = DDS.GLBL_CMPY_CD
            AND DTL.DS_CONTR_PK         = DDS.DS_CONTR_PK
            AND DTL.DS_CONTR_DTL_PK     = DDS.DS_CONTR_DTL_PK
            AND DDS.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = CAT.GLBL_CMPY_CD
            AND HDR.DS_CONTR_CATG_CD    = CAT.DS_CONTR_CATG_CD
            AND CAT.EZCANCELFLAG        = '0'
        ORDER BY
             DS_CONTR_CATG_CD
            ,DS_CONTR_NUM
            ,SORT_NUM
            ,SER_NUM
    </statement>
    <resultMap id="result.getContrInfo" class="NSAL0670_ASMsg">
        <result property="dsContrPk_A1" column="DS_CONTR_PK"  javaType="EZDSBigDecimalItem" />
        <result property="dsContrDtlPk_A1" column="DS_CONTR_DTL_PK"  javaType="EZDSBigDecimalItem" />
        <result property="xxScrItem34Txt_A1" column="XX_SCR_ITEM_34_TXT"  javaType="EZDSStringItem" />
        <result property="dsContrCatgCd_A1" column="DS_CONTR_CATG_CD"  javaType="EZDSStringItem" />
        <result property="dsContrNum_A1" column="DS_CONTR_NUM"  javaType="EZDSStringItem" />
        <result property="dsAcctNm_A1" column="DS_ACCT_NM"  javaType="EZDSStringItem" />
        <result property="serNum_A1" column="SER_NUM"  javaType="EZDSStringItem" />
        <result property="dsContrCtrlStsNm_AD" column="DS_CONTR_STS_NM"  javaType="EZDSStringItem" />
        <result property="t_MdlNm_A1" column="T_MDL_NM"  javaType="EZDSStringItem" />
        <result property="contrVrsnEffFromDt_A1" column="CONTR_VRSN_EFF_FROM_DT"  javaType="EZDSDateItem" />
        <result property="contrVrsnEffThruDt_A1" column="CONTR_VRSN_EFF_THRU_DT"  javaType="EZDSDateItem" />
        <result property="dsContrCtrlStsCd_AH" column="DS_CONTR_HDR_STS_CD"  javaType="EZDSStringItem" />
        <result property="dsContrCtrlStsCd_AD" column="DS_CONTR_DTL_STS_CD"  javaType="EZDSStringItem" />
        <result property="dsContrSrcTpCd_A1" column="DS_CONTR_SRC_TP_CD"  javaType="EZDSStringItem" />
        <result property="dsContrDtlTpCd_A1" column="DS_CONTR_DTL_TP_CD"  javaType="EZDSStringItem" />
        <result property="ezUpTime_AH"       column="HDR_EZUPTIME"        javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_AH"   column="HDR_EZUPTIMEZONE"    javaType="EZDSStringItem"/>
        <result property="ezUpTime_AD"       column="DTL_EZUPTIME"        javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_AD"   column="DTL_EZUPTIMEZONE"    javaType="EZDSStringItem"/>
    </resultMap>
    <statement id="cntNotUpdateDsContrDtl" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)
        FROM
            DS_CONTR_DTL_STS_V DCD
        WHERE
            DCD.GLBL_CMPY_CD       = #glblCmpyCd#
        AND DCD.EZCANCELFLAG       = '0'
        AND DCD.DS_CONTR_PK        = #dsContrPk#
        <iterate property="dsContrCtrlStsCdArray" var="dsContrCtrlStsCd[]" open="AND DCD.DS_CONTR_CTRL_STS_CD NOT IN (" close=")" conjunction=",">
            #dsContrCtrlStsCd[]#
        </iterate>
    </statement>
<!-- START 2017/05/08 K.Kitachi [QC#18268, ADD] -->
    <statement id="getDsContrDtlPkList" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.DS_CONTR_DTL_PK
        FROM
            DS_CONTR_DTL A
        WHERE
                A.GLBL_CMPY_CD = #glblCmpyCd#
            AND A.DS_CONTR_PK  = #dsContrPk#
            AND A.EZCANCELFLAG = '0'
        ORDER BY
            A.SVC_MACH_MSTR_PK NULLS FIRST
    </statement>
<!-- END 2017/05/08 K.Kitachi [QC#18268, ADD] -->
<!-- START 2017/05/08 K.Kitachi [QC#18268, ADD] -->
    <statement id="getDsContrDtlPkListFromDtlStsV" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.DS_CONTR_DTL_PK
        FROM
             DS_CONTR_DTL       A
            ,DS_CONTR_DTL_STS_V B
        WHERE
                A.GLBL_CMPY_CD    = #glblCmpyCd#
            AND A.DS_CONTR_PK     = #dsContrPk#
            AND A.EZCANCELFLAG    = '0'
            AND A.GLBL_CMPY_CD    = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK = B.DS_CONTR_DTL_PK
            <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCd[]" open="AND B.DS_CONTR_CTRL_STS_CD IN (" close=")" conjunction=",">
                #dsContrCtrlStsCd[]#
            </iterate>
            AND B.EZCANCELFLAG    = '0'
        ORDER BY
            A.SVC_MACH_MSTR_PK NULLS FIRST
    </statement>
<!-- END 2017/05/08 K.Kitachi [QC#18268, ADD] -->
</sqlMap>
