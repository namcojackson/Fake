<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLBB070001">
    <statement id="findSo" parameterClass="Map">
    <![CDATA[
        WITH SO_LIST AS (
            SELECT
                SO_W.GLBL_CMPY_CD
               ,SO_W.SO_NUM
            FROM
                SHPG_ORD SO_W
               ,RTL_WH   RW
            WHERE
                SO_W.GLBL_CMPY_CD      = #GLBL_CMPY_CD#
            AND SO_W.WMS_DROP_RQST_FLG = 'Y'
            AND SO_W.WMS_DROP_FLG      = 'N'
            AND SO_W.GLBL_CMPY_CD      = RW.GLBL_CMPY_CD
            AND SO_W.WH_CD             = RW.RTL_WH_CD
            AND RW.WH_OWNR_CD          = #WH_OWNR_CD# /* APX */
            AND SO_W.EZCANCELFLAG      = '0'
            AND RW.EZCANCELFLAG        = '0'
            UNION
            SELECT
                SO_W.GLBL_CMPY_CD
               ,SO_W.SO_NUM
            FROM
                SHPG_ORD SO_W
               ,VND      VN
               ,CARR_TP  CT
            WHERE
                SO_W.GLBL_CMPY_CD  = #GLBL_CMPY_CD#
            AND SO_W.DELY_REQ_FLG  = 'Y'
            AND SO_W.GLBL_CMPY_CD  = VN.GLBL_CMPY_CD
            AND SO_W.CARR_CD       = VN.VND_CD
            AND VN.GLBL_CMPY_CD    = CT.GLBL_CMPY_CD
            AND VN.CARR_TP_CD      = CT.CARR_TP_CD
            AND CT.CARR_TP_NM      = #CARR_TP_NM# /* APEX */
            AND SO_W.EZCANCELFLAG  = '0'
            AND VN.EZCANCELFLAG    = '0'
            AND CT.EZCANCELFLAG    = '0'
        )
        SELECT
            SO_TGT.GLBL_CMPY_CD
           ,SO_TGT.SO_NUM
           ,SO_TGT.WH_CD
           ,CASE
                WHEN EXISTS(
                         SELECT
                             1
                         FROM
                             RTL_WH   RW
                         WHERE
                             SO_TGT.GLBL_CMPY_CD        = RW.GLBL_CMPY_CD
                         AND SO_TGT.WH_CD               = RW.RTL_WH_CD
                         AND SO_TGT.WMS_DROP_RQST_FLG   = 'Y'
                         AND SO_TGT.WMS_DROP_FLG        = 'N'
                         AND RW.WH_OWNR_CD              = #WH_OWNR_CD# /* APX */
                         AND RW.EZCANCELFLAG            = '0'
                         )
                THEN '1'
                WHEN EXISTS(
                         SELECT
                             1
                         FROM
                             RTL_WH   RW
                            ,VND      VN
                            ,CARR_TP  CT
                         WHERE
                             SO_TGT.GLBL_CMPY_CD        = RW.GLBL_CMPY_CD
                         AND SO_TGT.SHIP_TO_CUST_CD     = RW.RTL_WH_CD
                         AND RW.WH_OWNR_CD              = #WH_OWNR_CD# /* APX */
                         AND RW.EZCANCELFLAG            = '0'
                         AND SO_TGT.GLBL_CMPY_CD        = VN.GLBL_CMPY_CD
                         AND SO_TGT.CARR_CD             = VN.VND_CD
                         AND VN.GLBL_CMPY_CD            = CT.GLBL_CMPY_CD
                         AND VN.CARR_TP_CD              = CT.CARR_TP_CD
                         AND CT.CARR_TP_NM              = #CARR_TP_NM# /* APEX */
                         AND VN.EZCANCELFLAG            = '0'
                         AND CT.EZCANCELFLAG            = '0'
                         )
                THEN '2'
                ELSE '0'
            END HIT_BY_WMS_DROP_FLG
           ,CASE
                WHEN EXISTS(
                         SELECT
                             1
                         FROM
                             VND VN
                            ,CARR_TP CT
                         WHERE
                             SO_TGT.DELY_REQ_FLG  = 'Y'
                         AND SO_TGT.GLBL_CMPY_CD  = VN.GLBL_CMPY_CD
                         AND SO_TGT.CARR_CD       = VN.VND_CD
                         AND VN.GLBL_CMPY_CD      = CT.GLBL_CMPY_CD
                         AND VN.CARR_TP_CD        = CT.CARR_TP_CD
                         AND CT.CARR_TP_NM        = #CARR_TP_NM# /* APEX */
                         AND VN.EZCANCELFLAG      = '0'
                         AND CT.EZCANCELFLAG      = '0'
                         ) 
                THEN 'Y'
                ELSE 'N'
            END HIT_BY_DELY_REQ_FLG
           ,SO_TGT.DROP_SHIP_FLG
           ,SO_TGT.EXPT_SHPG_METH_CD
           ,SO_TGT.PSD_DT
           ,SO_TGT.RDD_DT
           ,SUBSTR(SO_TGT.SO_CRAT_TS,1,14) SO_CRAT_TS
           ,SO_TGT.CARR_CD
           ,SO_TGT.SHPG_SVC_LVL_CD
           ,SO_TGT.TRX_HDR_NUM
           ,SO_TGT.PICK_TKT_NUM
           ,SO_TGT.CUST_ISS_PO_NUM
           ,SO_TGT.DNLD_TM_TS
           ,SO_TGT.PRINT_SCC_LB_FLG
           ,SO_TGT.PRINT_UCC_LB_FLG
           ,SO_TGT.MIX_PLT_ALLW_FLG
           ,SO_TGT.PRINT_PLT_UCC_LB_FLG
           ,SO_TGT.PRINT_NON_ASN_UCC_LB_FLG
           ,SO_TGT.ASN_REQ_FLG
           ,NVL(TRIM(SO_TGT.UCC_NUM_CD),'1') UCC_NUM_CD
           ,SO_TGT.EDI_TP_CD
           ,SO_TGT.CUST_STORE_NUM
           ,SO_TGT.SO_DEPT_NUM
           ,SO_TGT.TOT_SHIP_AMT
           ,SO_TGT.RTRN_LB_CD
           ,SO_TGT.SO_CONFIG_FLG
           ,SO_TGT.CARR_ACCT_NUM
           ,SO_TGT.SVC_CONFIG_MSTR_PK
           ,SO_TGT.PRE_ISTL_SHOP_RQST_FLG
           ,SO_TGT.WMS_RTE_PATH_CD
           ,SO_TGT.SRC_ORD_NUM
           ,CMP_CNV.S80_CMPY_CD
           ,OTP_CNV.S80_ORD_TP_CD
           ,OTP_CNV.S80_TRX_CD
           ,OSR_CNV.S80_ORD_SRC_CD
           ,SHT_CNV.S80_SHPG_TERM_CD
           ,S80_TRM.S80_SHPG_TERM_NM
           ,NVL(SO_TGT.EXPT_SHPG_METH_CD ,VIA_CNV.S80_SHIP_VIA_CD) SO_SHIP_VIA_CD
           ,NVL(SHP_MTH.SHPG_METH_NM     ,S80_VIA.S80_SHIP_VIA_NM) SHIP_VIA_DESC_TXT
           ,SOD_SUM.TOT_SHPG_WT
           ,SOD_SUM.TOT_SHPG_VOL
           ,SOD_SUM.RTRN_REQ_PRT_FLG
           ,NVL(SO_TGT.SCHD_DELY_DT, SO_TGT.RDD_DT) DELY_DT
           ,NVL(SO_TGT.CARR_CD     , SO_TGT.VND_CD) CARR_VND_CD
           ,SO_TGT.SCHD_DELY_TM
           ,CASE WHEN SO_TGT.SCE_ORD_TP_CD IN ('RS', 'DT')
                 THEN ORD_CAT.DS_ORD_CATG_DESC_TXT
                 ELSE SCE_ORD_TYP.SCE_ORD_TP_NM
            END OTBD_SRC_ORD_TP_TXT
           ,SO_TGT.SCE_ORD_TP_CD
           ,CASE WHEN SO_TGT.SCE_ORD_TP_CD = 'TR' AND NVL(SHP_CST.LOC_GRP_CD,' ') = '3' 
                 THEN 'Y'
                 ELSE 'N'
            END PRT_TO_CUST_FLG
           ,CASE WHEN SO_TGT.SCE_ORD_TP_CD IN ('RS', 'DT')                   THEN S21_PSN_CPO.PSN_FIRST_NM || ' ' || S21_PSN_CPO.PSN_LAST_NM
                 WHEN SO_TGT.SCE_ORD_TP_CD IN ('BB')                         THEN S21_PSN_POH.PSN_FIRST_NM || ' ' || S21_PSN_POH.PSN_LAST_NM
                 WHEN SO_TGT.SCE_ORD_TP_CD IN ('DI', 'RP', 'RE', 'RD', 'TR') THEN SOD_SUM.SLS_ORD_ADMIN_NM
            END SLS_ORD_ADMIN_NM
           ,(
               CASE
                   WHEN EXISTS(
                           SELECT
                               1
                           FROM
                               NLBI1210_01 I01
                           WHERE
                               I01.ORD_ID_TXT      = SO_TGT.SO_NUM
                           AND I01.EZCANCELFLAG    = '0')
                   THEN 'CHA'
                   ELSE 'ORI'
               END
           ) TPL_CTRL_ID
           ,(
               CASE
                   WHEN EXISTS(
                           SELECT
                               1
                           FROM
                               WMS_INBD_SO_HDR WMS_SOH
                           WHERE
                               SO_TGT.GLBL_CMPY_CD = WMS_SOH.GLBL_CMPY_CD
                           AND SO_TGT.SO_NUM       = WMS_SOH.WMS_SO_ID
                           AND WMS_SOH.EZCANCELFLAG    = '0') 
                   THEN '2'
                   ELSE '1'
               END 
           ) STAGE_ACT_CD
           -- SHIP_TO_CUST
           ,SO_TGT.SHIP_TO_CUST_CD       SHIP_CUST_TXT
           ,SOCDS.SO_CUST_LINE_LOC_NM_01 SHIP_NM_TXT_01
           ,SOCDS.SO_CUST_LINE_LOC_NM_02 SHIP_NM_TXT_02
           ,SOCDS.SO_CUST_LINE_ADDR_01   SHIP_FIRST_LINE_ADDR_TXT
           ,SOCDS.SO_CUST_LINE_ADDR_02   SHIP_SCD_LINE_ADDR_TXT
           ,SOCDS.SO_CUST_LINE_ADDR_03   SHIP_THIRD_LINE_ADDR_TXT
           ,SOCDS.SO_CUST_LINE_ADDR_04   SHIP_FRTH_LINE_ADDR_TXT
           ,SOCDS.POST_CD                SHIP_ZIP_OR_POST_CD_TXT
           ,SOCDS.CTY_ADDR               SHIP_CTY_TXT
           ,SOCDS.CTRY_CD                SHIP_CTRY_TXT
           ,SOCDS.ST_CD                  SHIP_ST_OR_PROV_TXT
           ,SOCDS.CTAC_PTNR_PSN_NM       SHIP_CTAC_PTNR_PSN_NM
           ,SOCDS.CTAC_PTNR_PSN_TEL_NUM  SHIP_CTAC_PTNR_PSN_TEL_NUM
           -- SELL_TO_CUST
           ,SO_TGT.BILL_TO_CUST_CD
           ,SO_TGT.SELL_TO_CUST_CD       BILL_CUST_TXT
           ,SOCDB.SO_CUST_LINE_LOC_NM_01 BILL_NM_TXT_01
           ,SOCDB.SO_CUST_LINE_LOC_NM_02 BILL_NM_TXT_02
           ,SOCDB.SO_CUST_LINE_ADDR_01   BILL_FIRST_LINE_ADDR_TXT
           ,SOCDB.SO_CUST_LINE_ADDR_02   BILL_SCD_LINE_ADDR_TXT
           ,SOCDB.POST_CD                BILL_ZIP_OR_POST_CD_TXT
           ,SOCDB.CTY_ADDR               BILL_CTY_TXT
           ,SOCDB.CTRY_CD                BILL_CTRY_TXT
           ,SOCDB.ST_CD                  BILL_ST_OR_PROV_TXT
           -- BILL_TO_CUST
           ,SOCDC.CTAC_PTNR_PSN_NM
           ,SOCDC.SHIP_TO_CTAC_PSN_NM
           ,SOCDC.CTAC_PTNR_PSN_TEL_NUM
           ,SLS_PSN.SLS_REP_PSN_NM
        FROM
            SO_LIST           SOL
           ,SHPG_ORD          SO_TGT
           ,SHPG_ORD_CUST_DTL SOCDS
           ,SHPG_ORD_CUST_DTL SOCDB
           ,SHPG_ORD_CUST_DTL SOCDC
           ,CMPY_CD_CONV      CMP_CNV
           ,SCE_ORD_TP        OTP_CNV
           ,ORD_SRC_CONV      OSR_CNV
           ,SHPG_TERM_CONV    SHT_CNV
           ,S80_SHPG_TERM     S80_TRM
           ,SHIP_VIA_CONV     VIA_CNV
           ,S80_SHIP_VIA      S80_VIA
           ,SHPG_METH         SHP_MTH
           ,SHIP_TO_CUST      SHP_CST
           ,CPO               CPO
           ,DS_ORD_CATG       ORD_CAT
           ,SCE_ORD_TP        SCE_ORD_TYP
           ,S21_PSN           S21_PSN_CPO
           ,PO                POH
           ,S21_PSN           S21_PSN_POH
           ,(
                SELECT
                    SOD.GLBL_CMPY_CD
                   ,SOD.SO_NUM
                   ,SUM(SOD.TOT_SHPG_WT) TOT_SHPG_WT
                   ,SUM(SOD.TOT_SHPG_VOL) TOT_SHPG_VOL
                   ,CASE WHEN SUM(CASE WHEN MDS.RTRN_REQ_PRT_FLG = 'Y' THEN 1 ELSE 0 END) > 0 
                         THEN 'Y'
                         ELSE 'N'
                    END RTRN_REQ_PRT_FLG
                   ,MAX(PSN.PSN_FIRST_NM || ' ' || PSN.PSN_LAST_NM)  SLS_ORD_ADMIN_NM
                FROM
                    SO_LIST      SOL
                   ,SHPG_ORD_DTL SOD
                   ,MDSE         MDS
                   ,PRCH_REQ     PRQ
                   ,S21_PSN      PSN
                WHERE
                    SOL.GLBL_CMPY_CD            = SOD.GLBL_CMPY_CD
                AND SOL.SO_NUM                  = SOD.SO_NUM
                AND SOD.GLBL_CMPY_CD            = MDS.GLBL_CMPY_CD
                AND SOD.MDSE_CD                 = MDS.MDSE_CD
                AND SOD.GLBL_CMPY_CD            = PRQ.GLBL_CMPY_CD(+)
                AND SOD.PRCH_REQ_NUM            = PRQ.PRCH_REQ_NUM(+)
                AND PRQ.GLBL_CMPY_CD            = PSN.GLBL_CMPY_CD(+)
                AND PRQ.PRCH_REQ_RQST_BY_PSN_CD = PSN.PSN_CD(+)
                AND SOD.EZCANCELFLAG            = '0'
                AND MDS.EZCANCELFLAG            = '0'
                AND PRQ.EZCANCELFLAG(+)         = '0'
                AND PSN.EZCANCELFLAG(+)         = '0'
                GROUP BY
                    SOD.GLBL_CMPY_CD
                   ,SOD.SO_NUM
            ) SOD_SUM
           ,(
                SELECT
                    SLS_PSN_SUB.GLBL_CMPY_CD
                   ,SLS_PSN_SUB.SO_NUM
                   ,SLS_PSN_SUB.SLS_REP_PSN_NM
                FROM
                   (
                    SELECT
                        SOT.GLBL_CMPY_CD
                       ,SOT.SO_NUM
                       ,SUBSTR(PSN.PSN_FIRST_NM || PSN.PSN_LAST_NM,1,20)                                     SLS_REP_PSN_NM
                       ,ROW_NUMBER() OVER(PARTITION BY SOL.GLBL_CMPY_CD,SOL.SO_NUM ORDER BY ORG.EFF_FROM_DT) ROW_NUM
                       ,COUNT(*)     OVER(PARTITION BY SOL.GLBL_CMPY_CD,SOL.SO_NUM )                         CNT_NUM
                    FROM
                        SO_LIST       SOL
                       ,SHPG_ORD      SOT
                       ,CPO           CPO
                       ,ORG_FUNC_ASG  ORG
                       ,S21_PSN       PSN
                    WHERE
                        SOL.GLBL_CMPY_CD    = SOT.GLBL_CMPY_CD
                    AND SOL.SO_NUM          = SOT.SO_NUM
                    AND SOT.GLBL_CMPY_CD    = CPO.GLBL_CMPY_CD
                    AND SOT.TRX_HDR_NUM     = CPO.CPO_ORD_NUM
                    AND CPO.GLBL_CMPY_CD    = ORG.GLBL_CMPY_CD
                    AND CPO.SLS_REP_TOC_CD  = ORG.TOC_CD
                    AND #salesDate#         BETWEEN ORG.EFF_FROM_DT AND NVL(ORG.EFF_THRU_DT,'99991231')
                    AND ORG.GLBL_CMPY_CD    = PSN.GLBL_CMPY_CD
                    AND ORG.PSN_CD          = PSN.PSN_CD
                    AND SOT.EZCANCELFLAG    = '0'
                    AND CPO.EZCANCELFLAG    = '0'
                    AND ORG.EZCANCELFLAG    = '0'
                    AND PSN.EZCANCELFLAG    = '0'
                   ) SLS_PSN_SUB
                WHERE
                    SLS_PSN_SUB.ROW_NUM = SLS_PSN_SUB.CNT_NUM
            ) SLS_PSN
        WHERE
            SOL.GLBL_CMPY_CD            = SO_TGT.GLBL_CMPY_CD
        AND SOL.SO_NUM                  = SO_TGT.SO_NUM
        AND SO_TGT.GLBL_CMPY_CD         = SOCDS.GLBL_CMPY_CD(+)
        AND SO_TGT.SO_NUM               = SOCDS.SO_NUM (+)
        AND SOCDS.SO_CUST_DATA_TP_CD(+) = '3' /* SHIPTO:3 */
        AND SO_TGT.GLBL_CMPY_CD         = SOCDB.GLBL_CMPY_CD(+)
        AND SO_TGT.SO_NUM               = SOCDB.SO_NUM (+)
        AND SOCDB.SO_CUST_DATA_TP_CD(+) = '2' /* SELLTO:2 */
        AND SO_TGT.GLBL_CMPY_CD         = SOCDC.GLBL_CMPY_CD(+)
        AND SO_TGT.SO_NUM               = SOCDC.SO_NUM (+)
        AND SOCDC.SO_CUST_DATA_TP_CD(+) = '3' /* SHIPTO:3 */
        AND SO_TGT.GLBL_CMPY_CD         = SOD_SUM.GLBL_CMPY_CD(+)
        AND SO_TGT.SO_NUM               = SOD_SUM.SO_NUM(+)
        AND SO_TGT.GLBL_CMPY_CD         = CMP_CNV.GLBL_CMPY_CD(+)
        AND SO_TGT.GLBL_CMPY_CD         = OTP_CNV.GLBL_CMPY_CD(+)
        AND SO_TGT.SCE_ORD_TP_CD        = OTP_CNV.SCE_ORD_TP_CD(+)
        AND OTP_CNV.INBD_OTBD_CD(+)     = '2'
        AND SO_TGT.GLBL_CMPY_CD         = OSR_CNV.GLBL_CMPY_CD(+)
        AND SO_TGT.TRX_SRC_TP_CD        = OSR_CNV.TRX_SRC_TP_CD(+)
        AND SO_TGT.GLBL_CMPY_CD         = SHT_CNV.GLBL_CMPY_CD(+)
        AND SO_TGT.FRT_CHRG_TO_CD       = SHT_CNV.FRT_CHRG_TO_CD(+)
        AND SO_TGT.FRT_CHRG_METH_CD     = SHT_CNV.FRT_CHRG_METH_CD(+)
        AND SHT_CNV.GLBL_CMPY_CD        = S80_TRM.GLBL_CMPY_CD(+)
        AND SHT_CNV.S80_SHPG_TERM_CD    = S80_TRM.S80_SHPG_TERM_CD(+)
        AND SO_TGT.GLBL_CMPY_CD         = VIA_CNV.GLBL_CMPY_CD(+)
        AND SO_TGT.SHPG_SVC_LVL_CD      = VIA_CNV.SHPG_SVC_LVL_CD(+)
        AND VIA_CNV.GLBL_CMPY_CD        = S80_VIA.GLBL_CMPY_CD(+)
        AND VIA_CNV.S80_SHIP_VIA_CD     = S80_VIA.S80_SHIP_VIA_CD(+)
        AND SO_TGT.GLBL_CMPY_CD         = SHP_MTH.GLBL_CMPY_CD(+)
        AND SO_TGT.EXPT_SHPG_METH_CD    = SHP_MTH.SHPG_METH_CD(+)
        AND SO_TGT.GLBL_CMPY_CD         = SHP_CST.GLBL_CMPY_CD(+)
        AND SO_TGT.SHIP_TO_CUST_CD      = SHP_CST.SHIP_TO_CUST_CD(+)
        AND SO_TGT.GLBL_CMPY_CD         = CPO.GLBL_CMPY_CD(+)
        AND SO_TGT.TRX_HDR_NUM          = CPO.CPO_ORD_NUM(+)
        AND CPO.GLBL_CMPY_CD            = ORD_CAT.GLBL_CMPY_CD(+)
        AND CPO.DS_ORD_CATG_CD          = ORD_CAT.DS_ORD_CATG_CD(+)
        AND SO_TGT.GLBL_CMPY_CD         = SCE_ORD_TYP.GLBL_CMPY_CD(+)
        AND SO_TGT.SCE_ORD_TP_CD        = SCE_ORD_TYP.SCE_ORD_TP_CD(+)
        AND SCE_ORD_TYP.INBD_OTBD_CD(+) = '2'
        AND CPO.GLBL_CMPY_CD            = S21_PSN_CPO.GLBL_CMPY_CD(+)
        AND CPO.ADMIN_PSN_CD            = S21_PSN_CPO.PSN_CD(+)
        AND SO_TGT.GLBL_CMPY_CD         = POH.GLBL_CMPY_CD(+)
        AND SO_TGT.TRX_HDR_NUM          = POH.PO_ORD_NUM(+)
        AND POH.GLBL_CMPY_CD            = S21_PSN_POH.GLBL_CMPY_CD(+)
        AND POH.PO_SUBMT_PSN_CD         = S21_PSN_POH.PSN_CD(+)
        AND SO_TGT.GLBL_CMPY_CD         = SLS_PSN.GLBL_CMPY_CD(+)
        AND SO_TGT.SO_NUM               = SLS_PSN.SO_NUM(+)
        AND SOCDS.EZCANCELFLAG(+)       = '0'
        AND SOCDB.EZCANCELFLAG(+)       = '0'
        AND SOCDC.EZCANCELFLAG(+)       = '0'
        AND CMP_CNV.EZCANCELFLAG(+)     = '0'
        AND OTP_CNV.EZCANCELFLAG(+)     = '0'
        AND OSR_CNV.EZCANCELFLAG(+)     = '0'
        AND SHT_CNV.EZCANCELFLAG(+)     = '0'
        AND S80_TRM.EZCANCELFLAG(+)     = '0'
        AND VIA_CNV.EZCANCELFLAG(+)     = '0'
        AND S80_VIA.EZCANCELFLAG(+)     = '0'
        AND SHP_MTH.EZCANCELFLAG(+)     = '0'
        AND SHP_CST.EZCANCELFLAG(+)     = '0'
        AND CPO.EZCANCELFLAG(+)         = '0'
        AND ORD_CAT.EZCANCELFLAG(+)     = '0'
        AND SCE_ORD_TYP.EZCANCELFLAG(+) = '0'
        AND S21_PSN_CPO.EZCANCELFLAG(+) = '0'
        AND S21_PSN_POH.EZCANCELFLAG(+) = '0'
        AND POH.EZCANCELFLAG(+)         = '0'
        ORDER BY
            SO_TGT.SO_NUM ASC
    ]]>
    </statement>

    <statement id="findWmsInbdToCust" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
            SO_TGT.GLBL_CMPY_CD
           ,SO_TGT.WH_CD
           ,SO_TGT.SO_NUM
           -- WMS SHIP_TO_CUST
           ,SO_TGT.SHIP_TO_CUST_CD       SHIP_TO_CUST_CD
           ,SOCDS.SO_CUST_LINE_LOC_NM_01 SHIP_SO_CUST_LINE_LOC_NM_01
           ,SOCDS.SO_CUST_LINE_LOC_NM_02 SHIP_SO_CUST_LINE_LOC_NM_02
           ,SOCDS.SO_CUST_LINE_ADDR_01   SHIP_SO_CUST_LINE_ADDR_01
           ,SOCDS.SO_CUST_LINE_ADDR_02   SHIP_SO_CUST_LINE_ADDR_02
           ,SOCDS.SO_CUST_LINE_ADDR_03   SHIP_SO_CUST_LINE_ADDR_03
           ,SOCDS.SO_CUST_LINE_ADDR_04   SHIP_SO_CUST_LINE_ADDR_04
           ,SOCDS.CTY_ADDR               SHIP_CTY_ADDR
           ,SOCDS.ST_CD                  SHIP_ST_CD
           ,SOCDS.POST_CD                SHIP_POST_CD
           ,SOCDS.CTRY_CD                SHIP_CTRY_CD
           ,SOCDS.CTAC_PTNR_PSN_NM       SHIP_CTAC_PTNR_PSN_NM
           ,SOCDS.CTAC_PTNR_PSN_TEL_NUM  SHIP_CTAC_PTNR_PSN_TEL_NUM
           ,SOCDS.SHIP_TO_CTAC_PSN_NM    SHIP_TO_CTAC_PSN_NM
           -- WMS SELL_TO_CUST
           ,SO_TGT.SELL_TO_CUST_CD       SELL_TO_CUST_CD
           ,SOCDB.SO_CUST_LINE_LOC_NM_01 SELL_SO_CUST_LINE_LOC_NM_01
           ,SOCDB.SO_CUST_LINE_LOC_NM_02 SELL_SO_CUST_LINE_LOC_NM_02
           ,SOCDB.SO_CUST_LINE_ADDR_01   SELL_SO_CUST_LINE_ADDR_01
           ,SOCDB.SO_CUST_LINE_ADDR_02   SELL_SO_CUST_LINE_ADDR_02
           ,SOCDB.SO_CUST_LINE_ADDR_03   SELL_SO_CUST_LINE_ADDR_03
           ,SOCDB.SO_CUST_LINE_ADDR_04   SELL_SO_CUST_LINE_ADDR_04
           ,SOCDB.CTY_ADDR               SELL_CTY_ADDR
           ,SOCDB.ST_CD                  SELL_ST_CD
           ,SOCDB.POST_CD                SELL_POST_CD
           ,SOCDB.CTRY_CD                SELL_CTRY_CD
           ,SOCDB.CTAC_PTNR_PSN_NM       SELL_CTAC_PTNR_PSN_NM
           ,SOCDB.CTAC_PTNR_PSN_TEL_NUM  SELL_CTAC_PTNR_PSN_TEL_NUM
           -- WMS BILL_TO_CUST
           ,SO_TGT.BILL_TO_CUST_CD       BILL_TO_CUST_CD
           ,SOCDC.SO_CUST_LINE_LOC_NM_01 BILL_SO_CUST_LINE_LOC_NM_01
           ,SOCDC.SO_CUST_LINE_LOC_NM_02 BILL_SO_CUST_LINE_LOC_NM_02
           ,SOCDC.SO_CUST_LINE_ADDR_01   BILL_SO_CUST_LINE_ADDR_01
           ,SOCDC.SO_CUST_LINE_ADDR_02   BILL_SO_CUST_LINE_ADDR_02
           ,SOCDC.SO_CUST_LINE_ADDR_03   BILL_SO_CUST_LINE_ADDR_03
           ,SOCDC.SO_CUST_LINE_ADDR_04   BILL_SO_CUST_LINE_ADDR_04
           ,SOCDC.CTY_ADDR               BILL_CTY_ADDR
           ,SOCDC.ST_CD                  BILL_ST_CD
           ,SOCDC.POST_CD                BILL_POST_CD
           ,SOCDC.CTRY_CD                BILL_CTRY_CD
           ,SOCDC.CTAC_PTNR_PSN_NM       BILL_CTAC_PTNR_PSN_NM
           ,SOCDC.CTAC_PTNR_PSN_TEL_NUM  BILL_CTAC_PTNR_PSN_TEL_NUM
        FROM
            SHPG_ORD          SO_TGT
           ,SHPG_ORD_CUST_DTL SOCDS
           ,SHPG_ORD_CUST_DTL SOCDB
           ,SHPG_ORD_CUST_DTL SOCDC
        WHERE
            SO_TGT.GLBL_CMPY_CD         = #GLBL_CMPY_CD#
        AND SO_TGT.SO_NUM               = #SO_NUM#
        AND SO_TGT.GLBL_CMPY_CD         = SOCDS.GLBL_CMPY_CD(+)
        AND SO_TGT.SO_NUM               = SOCDS.SO_NUM (+)
        AND SOCDS.SO_CUST_DATA_TP_CD(+) = '3' /* SHIPTO:3 */
        AND SO_TGT.GLBL_CMPY_CD         = SOCDB.GLBL_CMPY_CD(+)
        AND SO_TGT.SO_NUM               = SOCDB.SO_NUM (+)
        AND SOCDB.SO_CUST_DATA_TP_CD(+) = '2' /* SELLTO:2 */
        AND SO_TGT.GLBL_CMPY_CD         = SOCDC.GLBL_CMPY_CD(+)
        AND SO_TGT.SO_NUM               = SOCDC.SO_NUM (+)
        AND SOCDC.SO_CUST_DATA_TP_CD(+) = '1' /* BILLTO:3 */
        AND SOCDS.EZCANCELFLAG(+)       = '0'
        AND SOCDB.EZCANCELFLAG(+)       = '0'
        AND SOCDC.EZCANCELFLAG(+)       = '0'
        ORDER BY
            SO_TGT.SO_NUM ASC
    ]]>
	</statement>

	<statement id="findSoDetail" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
            SOD.SO_NUM
           ,SOD.SO_SLP_NUM
           ,SOD.MDSE_CD
           ,SOD.RTL_WH_CD
           ,SOD.RTL_SWH_CD
           ,SOD.SHPG_QTY
           ,SOD.TOT_SHPG_WT
           ,SOD.TRX_LINE_NUM
           ,SOD.CUST_MDSE_CD
           ,SOD.RQST_ORD_QTY
           ,SOD.SHPG_BAL_QTY
           ,SOD.UNIT_PRC_AMT
           ,SOD.DISC_PRC_AMT
           ,SOD.DISC_UNIT_PRC_AMT
           ,SOD.SER_NUM_TAKE_FLG
        --   ,SOD.LN_VOID_FLG
           ,SOD.SET_MDSE_CD
           ,SOD.SET_MDSE_NM
           ,SOD.SET_SHPG_QTY
           ,SOD.IN_EACH_QTY
           ,SOD.TOT_SHPG_WT
           ,SOD.TOT_SHPG_VOL
           ,SOD.BAT_NUM_TAKE_FLG
           ,SOD.CONFIG_ITEM_FLG
           ,SOD.PICK_SVC_CONFIG_MSTR_PK
           ,SOD.BACK_ORD_IMPCT_TP_CD
           ,SOD.RMV_CONFIG_FLG
           ,MDS.MDSE_NM            WMS_MDSE_DESC_TXT_01
           ,TL.PLANT_CD
           ,TL.TPL_LOC_NM
           ,STK_STS.S80_STK_STS_CD
           ,NVL(CPD.ORD_QTY,SOD.RQST_ORD_QTY) ORD_QTY
           ,SOD.SHIP_TO_RTL_WH_CD
           ,SOD.SHIP_TO_RTL_SWH_CD
        FROM
            SHPG_ORD_DTL   SOD
           ,TPL_LOC        TL
           ,MDSE           MDS
           ,STK_STS_CONV   STK_STS
           ,CPO_DTL        CPD
        WHERE
            SOD.GLBL_CMPY_CD        = #GLBL_CMPY_CD#
        AND SOD.SO_NUM              = #SO_NUM#
        AND SOD.GLBL_CMPY_CD        = TL.GLBL_CMPY_CD(+)
        AND SOD.RTL_WH_CD           = TL.TPL_LOC_CD(+)
        AND SOD.FROM_STK_STS_CD     = TL.TPL_STK_STS_CD(+)
        AND SOD.GLBL_CMPY_CD        = MDS.GLBL_CMPY_CD(+)
        AND SOD.MDSE_CD             = MDS.MDSE_CD(+)
        AND SOD.GLBL_CMPY_CD        = STK_STS.GLBL_CMPY_CD(+)
        AND SOD.FROM_STK_STS_CD     = STK_STS.STK_STS_CD(+)
        AND SOD.GLBL_CMPY_CD        = CPD.GLBL_CMPY_CD(+)
        AND SOD.TRX_HDR_NUM         = CPD.CPO_ORD_NUM(+)
        AND SOD.TRX_LINE_NUM        = CPD.CPO_DTL_LINE_NUM(+)
        AND SOD.TRX_LINE_SUB_NUM    = CPD.CPO_DTL_LINE_SUB_NUM(+)
        AND SOD.EZCANCELFLAG        = '0'
        AND TL.EZCANCELFLAG(+)      = '0'
        AND MDS.EZCANCELFLAG(+)     = '0'
        AND STK_STS.EZCANCELFLAG(+) = '0'
        AND CPD.EZCANCELFLAG(+) = '0'
        ORDER BY
            SOD.SO_NUM ASC
            ,SOD.SO_SLP_NUM ASC
    ]]>
	</statement>

	<statement id="findSoText" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
            SOM.SO_NUM
            ,SOM.SO_MSG_TP_CD
            ,SOM.TXT_SQ_NUM
            ,SOM.SO_MSG_DESC_TXT
        FROM
            SHPG_ORD_MSG SOM
        WHERE
            SOM.GLBL_CMPY_CD    = #GLBL_CMPY_CD#
        AND SOM.SO_NUM          = #SO_NUM#
        AND SOM.SO_MSG_TP_CD    = 'S'
        AND SOM.EZCANCELFLAG    = '0'
        ORDER BY
            SOM.SO_NUM
            ,SOM.TXT_SQ_NUM
    ]]>
	</statement>

	<statement id="findWmsInbdSoText" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
             SOM.SO_NUM
            ,SOM.SO_MSG_TP_CD
            ,MAX(CASE SOM.TXT_SQ_NUM WHEN '1' THEN SOM.SO_MSG_DESC_TXT END) INBD_SO_MSG_TXT_01 
            ,MAX(CASE SOM.TXT_SQ_NUM WHEN '2' THEN SOM.SO_MSG_DESC_TXT END) INBD_SO_MSG_TXT_02
            ,MAX(CASE SOM.TXT_SQ_NUM WHEN '3' THEN SOM.SO_MSG_DESC_TXT END) INBD_SO_MSG_TXT_03
            ,MAX(CASE SOM.TXT_SQ_NUM WHEN '4' THEN SOM.SO_MSG_DESC_TXT END) INBD_SO_MSG_TXT_04
        FROM
            SHPG_ORD_MSG SOM
        WHERE
            SOM.GLBL_CMPY_CD    = #GLBL_CMPY_CD#
        AND SOM.SO_NUM          = #SO_NUM#
        AND SOM.SO_MSG_TP_CD    = 'S'
        AND SOM.EZCANCELFLAG    = '0'
        GROUP BY 
            SOM.SO_NUM
           ,SOM.SO_MSG_TP_CD
        ORDER BY
            SOM.SO_NUM
           ,SOM.SO_MSG_TP_CD
    ]]>
	</statement>

	<statement id="findSoSiteSurvey" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
            SO.SO_NUM
            ,COALESCE(DSS1.CPO_ORD_NUM, DSS2.CPO_ORD_NUM) CPO_ORD_NUM
            ,COALESCE(DSS1.CPO_DTL_LINE_NUM, DSS2.CPO_DTL_LINE_NUM) CPO_DTL_LINE_NUM
            ,COALESCE(DSS1.CPO_DTL_LINE_SUB_NUM, DSS2.CPO_DTL_LINE_SUB_NUM) CPO_DTL_LINE_SUB_NUM
            ,SOCD.SO_CUST_LINE_LOC_NM_01
            ,SO.SHIP_TO_CUST_CD
            ,SOCD.SO_CUST_LINE_ADDR_01
            ,SOCD.CTY_ADDR
            ,COALESCE(DSS1.CMPY_INFO_APT_BLDG_NM, DSS2.CMPY_INFO_APT_BLDG_NM) CMPY_INFO_APT_BLDG_NM
            ,SOCD.ST_CD
            ,COALESCE(SODI.CMPY_INFO_FL_NM, DSS1.CMPY_INFO_FL_NM, DSS2.CMPY_INFO_FL_NM) CMPY_INFO_FL_NM
            ,SOCD.POST_CD
            ,COALESCE(DSS1.CMPY_INFO_DEPT_NM, DSS2.CMPY_INFO_DEPT_NM) CMPY_INFO_DEPT_NM
            ,COALESCE(DSS1.ELEV_PROT_REQ_FLG, DSS2.ELEV_PROT_REQ_FLG) ELEV_PROT_REQ_FLG
            ,COALESCE(SODI.DELY_INSTN_ADDL_CMNT_TXT, DSS1.SITE_SRVY_ADDL_CMNT_TXT, DSS2.SITE_SRVY_ADDL_CMNT_TXT) SITE_SRVY_ADDL_CMNT_TXT
            ,COALESCE(SODI.OTSD_STEP_NUM, DSS1.OTSD_STEP_NUM, DSS2.OTSD_STEP_NUM) OTSD_STEP_NUM
            ,COALESCE(SODI.INSD_STEP_NUM, DSS1.INSD_STEP_NUM, DSS2.INSD_STEP_NUM) INSD_STEP_NUM
            ,COALESCE(SODI.STAIR_CRAW_REQ_FLG, DSS1.STAIR_CRAW_REQ_FLG, DSS2.STAIR_CRAW_REQ_FLG) STAIR_CRAW_REQ_FLG
            ,COALESCE(DSS1.FLGT_STAIR_NUM, DSS2.FLGT_STAIR_NUM) FLGT_STAIR_NUM
            ,COALESCE(SODI.STAIR_AND_LDG_WDT, DSS1.STAIR_AND_LDG_WDT, DSS2.STAIR_AND_LDG_WDT) STAIR_AND_LDG_WDT
            ,COALESCE(SODI.LOAD_DOCK_AVAL_TXT, DSS1.LOAD_DOCK_AVAL_FLG, DSS2.LOAD_DOCK_AVAL_FLG) LOAD_DOCK_AVAL_FLG
            ,COALESCE(SODI.LOAD_DOCK_HGT, DSS1.LOAD_DOCK_HGT, DSS2.LOAD_DOCK_HGT) LOAD_DOCK_HGT
            ,COALESCE(SODI.OPS_FROM_HOUR_MN, DSS1.LOAD_DOCK_AVAL_FROM_HOUR_MN, DSS2.LOAD_DOCK_AVAL_FROM_HOUR_MN) LOAD_DOCK_AVAL_FROM_HOUR_MN
            ,COALESCE(SODI.OPS_TO_HOUR_MN, DSS1.LOAD_DOCK_AVAL_TO_HOUR_MN, DSS2.LOAD_DOCK_AVAL_TO_HOUR_MN) LOAD_DOCK_AVAL_TO_HOUR_MN
            ,COALESCE(SODI.TRCTR_AND_TRAIL_ACCS_TXT, DSS1.TRCTR_AND_TRAIL_ACCS_FLG, DSS2.TRCTR_AND_TRAIL_ACCS_FLG) TRCTR_AND_TRAIL_ACCS_FLG
            ,NVL(SO.SCHD_DELY_TM, DCII.RQST_ISTL_TM) CARR_DELY_TM_HOUR_MN
            ,COALESCE(SODI.DELY_TRNSP_OPT_CD, DSS1.DELY_TRNSP_OPT_CD, DSS2.DELY_TRNSP_OPT_CD) DELY_TRNSP_OPT_CD
            ,SODI.SEC_CLNC_REQ_TXT
            ,SODI.INS_CERT_REQ_TXT
            ,SODI.FL_COV_TXT
            ,SODI.RAMP_AVAL_TXT
            ,SODI.STEP_AVAL_TXT
            ,SODI.FRONT_DOOR_AVAL_TXT
            ,SODI.BACK_DOOR_AVAL_TXT
            ,SODI.PWR_OTLT_CONFIG_TXT
            ,SODI.SGN_ON_BLDG_RDSD_TXT
            ,SODI.BLDG_STRY_NUM
            ,SODI.BLDG_GURD_NTFY_TXT
            ,SODI.INDL_PARK_TXT
            ,SODI.BIZ_PARK_TXT
            ,SODI.PRO_BLDG_TXT
            ,SODI.SHPNG_CTR_TXT
            ,SODI.PVT_RES_TXT
            ,COALESCE(SODI.ELEV_AVAL_TXT, DSS1.ELEV_AVAL_FLG, DSS2.ELEV_AVAL_FLG) ELEV_AVAL_FLG
            ,COALESCE(SODI.ELEV_AVAL_FROM_HOUR_MN, DSS1.ELEV_AVAL_FROM_HOUR_MN, DSS2.ELEV_AVAL_FROM_HOUR_MN) ELEV_AVAL_FROM_HOUR_MN
            ,COALESCE(SODI.ELEV_AVAL_TO_HOUR_MN, DSS1.ELEV_AVAL_TO_HOUR_MN, DSS2.ELEV_AVAL_TO_HOUR_MN) ELEV_AVAL_TO_HOUR_MN
            ,COALESCE(SODI.ELEV_APPT_REQ_TXT, DSS1.ELEV_APPT_REQ_FLG, DSS2.ELEV_APPT_REQ_FLG) ELEV_APPT_REQ_FLG
            ,COALESCE(SODI.ELEV_CTAC_PSN_NM, DSS1.ELEV_CTAC_PSN_NM, DSS2.ELEV_CTAC_PSN_NM) ELEV_CTAC_PSN_NM
            ,COALESCE(SODI.ELEV_CTAC_TEL_NUM, DSS1.ELEV_CTAC_TEL_NUM, DSS2.ELEV_CTAC_TEL_NUM) ELEV_CTAC_TEL_NUM
            ,COALESCE(SODI.BLDG_ENT_DOOR_HGT, DSS1.BLDG_ENT_DOOR_HGT, DSS2.BLDG_ENT_DOOR_HGT) BLDG_ENT_DOOR_HGT
            ,COALESCE(SODI.BLDG_ENT_DOOR_WDT, DSS1.BLDG_ENT_DOOR_WDT, DSS2.BLDG_ENT_DOOR_WDT) BLDG_ENT_DOOR_WDT
            ,COALESCE(SODI.CRDR_WDT, DSS1.CRDR_WDT, DSS2.CRDR_WDT) CRDR_WDT
            ,COALESCE(SODI.DOOR_WDT, DSS1.DOOR_WDT, DSS2.DOOR_WDT) DOOR_WDT
            ,COALESCE(SODI.ELEV_WDT, DSS1.ELEV_WDT, DSS2.ELEV_WDT) ELEV_WDT
            ,COALESCE(SODI.ELEV_DEPTH_NUM, DSS1.ELEV_DEPTH_NUM, DSS2.ELEV_DEPTH_NUM) ELEV_DEPTH_NUM
            ,COALESCE(SODI.ELEV_CAP_WT, DSS1.ELEV_CAP_WT, DSS2.ELEV_CAP_WT) ELEV_CAP_WT
            ,COALESCE(SODI.ELEV_DOOR_HGT, DSS1.ELEV_DOOR_HGT, DSS2.ELEV_DOOR_HGT) ELEV_DOOR_HGT
            ,COALESCE(SODI.ELEV_DOOR_WDT, DSS1.ELEV_DOOR_WDT, DSS2.ELEV_DOOR_WDT) ELEV_DOOR_WDT
            ,COALESCE(SODI.CUST_INFO_BO_FLG, 'N') CUST_INFO_BO_FLG
            ,COALESCE(SODI.PICK_UP_XTR_TONER_FLG, 'N') PICK_UP_XTR_TONER_FLG
            ,COALESCE(SODI.PICK_UP_AT_SAME_TM_FLG, 'N') PICK_UP_AT_SAME_TM_FLG
        FROM
            SHPG_ORD SO
            ,SHPG_ORD_CUST_DTL SOCD
            ,SHPG_ORD_DELY_INSTN SODI
            ,DS_SITE_SRVY DSS1
            ,DS_SITE_SRVY DSS2
            ,DS_CPO_ISTL_INFO DCII
        WHERE
            SO.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND SO.SO_NUM                   = #SO_NUM#
        AND SO.GLBL_CMPY_CD             = SOCD.GLBL_CMPY_CD(+)
        AND SO.SO_NUM                   = SOCD.SO_NUM(+)
        AND SOCD.SO_CUST_DATA_TP_CD(+)  = '3'
        AND SO.GLBL_CMPY_CD             = SODI.GLBL_CMPY_CD(+)
        AND SO.SO_NUM                   = SODI.SO_NUM(+)
        AND SO.GLBL_CMPY_CD             = DSS1.GLBL_CMPY_CD(+)
        AND SO.TRX_HDR_NUM              = DSS1.CPO_ORD_NUM(+)
        AND SO.DS_CPO_CONFIG_PK         = DSS1.DS_CPO_CONFIG_PK(+)
        AND SO.GLBL_CMPY_CD             = DSS2.GLBL_CMPY_CD(+)
        AND SO.TRX_HDR_NUM              = DSS2.CPO_ORD_NUM(+)
        AND SO.GLBL_CMPY_CD             = DCII.GLBL_CMPY_CD(+)
        AND SO.TRX_HDR_NUM              = DCII.CPO_ORD_NUM(+)
        AND SO.EZCANCELFLAG             = '0'
        AND SOCD.EZCANCELFLAG(+)        = '0'
        AND SODI.EZCANCELFLAG(+)        = '0'
        AND DSS1.EZCANCELFLAG(+)        = '0'
        AND DSS2.EZCANCELFLAG(+)        = '0'
        AND DCII.EZCANCELFLAG(+)        = '0'
        ORDER BY
            SO.SO_NUM ASC
    ]]>
	</statement>

	<statement id="findSoMdseSurvey" parameterClass="Map" resultClass="Map">
	<![CDATA[
        SELECT
            SOD.SO_NUM
            ,SOD.SO_SLP_NUM
            
            ,MD.MDSE_CD
            ,MD.MDSE_NM
            ,MSP.IN_POUND_WT
            ,MSP.IN_INCH_LG
            ,MSP.IN_INCH_WDT
            ,MSP.IN_INCH_HGT
            ,ROUND(
              SQRT(
               POWER(MSP.IN_INCH_LG, 2)
                + POWER(MSP.IN_INCH_WDT, 2)
                + POWER(MSP.IN_INCH_HGT, 2)
              ), 4) IN_INCH_DG
        
        FROM
            SHPG_ORD_DTL SOD
            ,MDSE MD
            ,MDSE_STORE_PKG MSP
        WHERE
            SOD.GLBL_CMPY_CD    = #GLBL_CMPY_CD#
        AND SOD.SO_NUM          = #SO_NUM#
        AND SOD.GLBL_CMPY_CD    = MD.GLBL_CMPY_CD(+)
        AND SOD.MDSE_CD         = MD.MDSE_CD(+)
        AND SOD.GLBL_CMPY_CD    = MSP.GLBL_CMPY_CD(+)
        AND SOD.MDSE_CD         = MSP.MDSE_CD(+)
        AND SOD.EZCANCELFLAG    = '0'
        AND MD.EZCANCELFLAG(+)  = '0'
        AND MSP.EZCANCELFLAG(+) = '0'
        ORDER BY
            SOD.SO_NUM ASC
            ,SOD.SO_SLP_NUM ASC
	]]>
	</statement>

	<statement id="findSoSerial" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
            SS.SER_NUM
        FROM
            (
            SELECT
                SS.SER_NUM
            FROM
                SO_SER SS
            WHERE
                SS.GLBL_CMPY_CD = #GLBL_CMPY_CD#
            AND SS.SO_NUM       = #SO_NUM#
            AND SS.SO_SLP_NUM   = #SO_SLP_NUM#
            AND SS.EZCANCELFLAG = '0'
            ORDER BY
                SS.WH_PICK_FLG DESC NULLS LAST
               ,SS.ORD_ASG_FLG DESC NULLS LAST
               ,SS.EZUPTIME DESC
               ,SS.EZINTIME DESC
           ) SS
       WHERE
           ROWNUM <= #rowNum#
    ]]>
	</statement>

    <statement id="getTplCarrSvcLvl" parameterClass="Map" resultClass="Map">
        SELECT
            TPL_CARR_CD
            ,TPL_CARR_NM
            ,TPL_SVC_LVL_CD
        FROM (
            SELECT
                TC.TPL_CARR_CD
               ,TC.TPL_CARR_NM
               ,TC.TPL_SVC_LVL_CD
            FROM
                TPL_CARR_SVC_LVL TC
            WHERE
                TC.GLBL_CMPY_CD         = #GLBL_CMPY_CD#
            AND TC.WH_OWNR_CD           = #WH_OWNR_CD#
        <isNotNull property="CARR_CD">
            AND TC.CARR_CD              = #CARR_CD#
        </isNotNull>
        <isNull property="CARR_CD">
            AND TC.CARR_CD              IS NULL
        </isNull>
        <isNotNull property="SHPG_SVC_LVL_CD">
            AND TC.SHPG_SVC_LVL_CD      = #SHPG_SVC_LVL_CD#
        </isNotNull>
        <isNull property="SHPG_SVC_LVL_CD">
            AND TC.SHPG_SVC_LVL_CD      IS NULL
        </isNull>
            AND TC.EZCANCELFLAG         = '0'
            ORDER BY
                TC.TPL_CARR_SVC_LVL_SORT_NUM ASC
        )
        WHERE
            ROWNUM&lt;=1
    </statement>

	<statement id="findRws" parameterClass="Map">
    <![CDATA[
       SELECT
           MAIN.*
          ,NVL(
              (
                  SELECT
                      MAX(RD.SCHD_PICK_UP_TM) AS WH_IN_ETA_TM
                  FROM
                      RWS_DTL RD
                  WHERE
                      RD.GLBL_CMPY_CD    = #GLBL_CMPY_CD#
                  AND RD.RWS_NUM         = MAIN.RWS_NUM
                  AND RD.SCHD_PICK_UP_DT = MAIN.WH_IN_ETA_DT
                  AND RD.EZCANCELFLAG    = '0'
              )
              ,
              ''
           ) AS WH_IN_ETA_TM
       FROM
           (WITH RWS_LST AS (
               SELECT
                   RH.GLBL_CMPY_CD
                  ,RH.RWS_NUM
               FROM
                   RWS_HDR RH
                  ,RWS_STS RS
                  ,TPL_LOC TL
               WHERE
                   RH.GLBL_CMPY_CD     = #GLBL_CMPY_CD#
               AND RH.PICK_UP_RQST_FLG = #flgY# /* Requested */
               AND RH.EZCANCELFLAG     = '0'
               AND RH.GLBL_CMPY_CD     = RS.GLBL_CMPY_CD
               AND RH.RWS_STS_CD       = RS.RWS_STS_CD
               AND (RS.RWS_OPEN_FLG = #flgY# OR RS.RCV_FLG = #flgY#)
               AND RS.EZCANCELFLAG     = '0'
               AND RH.GLBL_CMPY_CD     = TL.GLBL_CMPY_CD(+)
               AND RH.WH_CD            = TL.TPL_LOC_CD(+)
               AND TL.EZCANCELFLAG(+)  = '0'
               AND EXISTS(
                   SELECT
                       1
                   FROM
                       RWS_DTL RD
                      ,RWS_STS RSD
                      ,VND     V
                      ,CARR_TP CT
                   WHERE
                       RH.GLBL_CMPY_CD    = RD.GLBL_CMPY_CD
                   AND RH.RWS_NUM         = RD.RWS_NUM
                   AND TL.TPL_STK_STS_CD  = RD.INVTY_STK_STS_CD
                   AND RD.EZCANCELFLAG    = '0'
                   AND RD.GLBL_CMPY_CD    = RSD.GLBL_CMPY_CD
                   AND RD.RWS_STS_CD      = RSD.RWS_STS_CD
                   AND (RSD.RWS_OPEN_FLG  = #flgY# OR RSD.RCV_FLG = #flgY#)
                   AND RSD.EZCANCELFLAG   = '0'
                   AND RD.GLBL_CMPY_CD    = V.GLBL_CMPY_CD
                   AND RD.CARR_CD         = V.VND_CD
                   AND V.EZCANCELFLAG     = '0'
                   AND V.GLBL_CMPY_CD     = CT.GLBL_CMPY_CD
                   AND V.CARR_TP_CD       = CT.CARR_TP_CD
                   AND CT.CARR_TP_NM      = #CARR_TP_NM# /* APEX */
                   AND CT.EZCANCELFLAG    = '0'
                   )
           )
           SELECT
               RWS_TGT.GLBL_CMPY_CD
              ,RWS_TGT.RWS_NUM
              ,RWS_TGT.WH_CD
              ,CASE
                   WHEN EXISTS (
                       SELECT
                           1
                       FROM
                           RWS_HDR RH_CK
                          ,RTL_WH  RW
                       WHERE
                           RWS_TGT.GLBL_CMPY_CD  = RH_CK.GLBL_CMPY_CD
                       AND RWS_TGT.RWS_NUM       = RH_CK.RWS_NUM
                       AND RH_CK.WMS_DROP_STS_CD = '0' /* Requested */
                       AND RH_CK.EZCANCELFLAG    = '0'
                       AND RH_CK.GLBL_CMPY_CD    = RW.GLBL_CMPY_CD
                       AND RH_CK.WH_CD           = RW.RTL_WH_CD
                       AND RW.WH_OWNR_CD         = #WH_OWNR_CD# /* APX */
                       AND RW.EZCANCELFLAG       = '0'
                      )
                   THEN 'Y'
                   ELSE 'N'
               END HIT_BY_WMS_DROP_STS_CD
              ,CASE
                   WHEN EXISTS(
                       SELECT
                           1
                       FROM
                           RWS_DTL RD
                          ,RWS_STS RSD
                          ,VND     V
                          ,CARR_TP CT
                       WHERE
                           RWS_TGT.GLBL_CMPY_CD     = RD.GLBL_CMPY_CD
                       AND RWS_TGT.RWS_NUM          = RD.RWS_NUM
                       AND RWS_TGT.PICK_UP_RQST_FLG = #flgY# /* Requested */
                       AND RD.EZCANCELFLAG          = '0'
                       AND RD.GLBL_CMPY_CD          = RSD.GLBL_CMPY_CD
                       AND RD.RWS_STS_CD            = RSD.RWS_STS_CD
                       AND (RSD.RWS_OPEN_FLG = #flgY# OR RSD.RCV_FLG = #flgY#)
                       AND RSD.EZCANCELFLAG         = '0'
                       AND RD.GLBL_CMPY_CD          = V.GLBL_CMPY_CD
                       AND RD.CARR_CD               = V.VND_CD
                       AND V.EZCANCELFLAG           = '0'
                       AND V.GLBL_CMPY_CD           = CT.GLBL_CMPY_CD
                       AND V.CARR_TP_CD             = CT.CARR_TP_CD
                       AND CT.CARR_TP_NM            = #CARR_TP_NM# /* APEX */
                       AND CT.EZCANCELFLAG          = '0'
                      ) 
                    THEN 'Y'
                    ELSE 'N'
               END HIT_BY_PICK_UP_RQST_FLG
              ,RWS_TGT.RWS_REF_NUM
              ,RWS_TGT.TRX_ORD_NUM
              ,RWS_TGT.SCE_ORD_TP_CD
              ,NVL(
                  (
                      SELECT
                          MAX(RD.SCHD_PICK_UP_DT) AS WH_IN_ETA_DT
                      FROM
                          RWS_DTL RD
                      WHERE
                          RD.GLBL_CMPY_CD = RWS_TGT.GLBL_CMPY_CD
                      AND RD.RWS_NUM      = RWS_TGT.RWS_NUM
                      AND RD.EZCANCELFLAG = '0'
                  )
                  ,
                  RWS_TGT.WH_IN_ETA_DT
               ) AS WH_IN_ETA_DT
               -- SHIP_TO_CUST, BILL_TO_CUST
              ,RWS_TGT.FROM_LOC_CD
              ,RWS_TGT.FROM_LOC_NM_01
              ,RWS_TGT.FROM_LOC_NM_02
              ,RWS_TGT.FROM_LOC_ADDR_01
              ,RWS_TGT.FROM_LOC_ADDR_02
              ,RWS_TGT.FROM_LOC_ADDR_03
              ,RWS_TGT.FROM_LOC_ADDR_04
              ,RWS_TGT.FROM_LOC_POST_CD
              ,RWS_TGT.FROM_LOC_CTY_ADDR
              ,RWS_TGT.FROM_LOC_CTRY_CD
              ,RWS_TGT.FROM_LOC_ST_CD
               -- CTAC_CUST
              ,RWS_TGT.FROM_LOC_PSN_NM
              ,RWS_TGT.FROM_LOC_TEL_NUM
              ,RWS_TGT.IMPT_INV_VESL_NM
              ,RWS_TGT.IMPT_INV_BOL_NUM
              ,RWS_TGT.SVC_CONFIG_MSTR_PK
              ,(
                  CASE
                  WHEN RWS_TGT.SCE_ORD_TP_CD = 'RT'
                      THEN 'RO'
                  ELSE 'XX'
                  END
               ) TPL_ORG_TXT
              ,(
                  CASE
                  WHEN RWS_TGT.SCE_ORD_TP_CD IN ('RT', 'RB')
                      THEN 'LR'
                  ELSE 'LF'
                  END
               ) ORD_TP_TXT
              ,(
                  CASE
                  WHEN EXISTS(
                      SELECT
                          NULL
                      FROM
                          NLBI1210_01 I01
                      WHERE
                          I01.ORD_ID_TXT      = RWS_TGT.RWS_REF_NUM
                      AND I01.EZCANCELFLAG    = '0'
                  ) THEN 'CHA'
                  ELSE 'ORI'
                  END
                ) TPL_CTRL_ID
               ,CMP_CNV.S80_CMPY_CD
               ,OTP_CNV.S80_ORD_TP_CD
               ,OTP_CNV.S80_TRX_CD
               ,CASE WHEN REC_CHK.RWS_NUM IS NULL 
                     THEN '1'
                     ELSE '2'
                END STAGE_ACT_CD
           FROM
               RWS_LST
              ,RWS_HDR       RWS_TGT
              ,CMPY_CD_CONV  CMP_CNV
              ,SCE_ORD_TP    OTP_CNV
              ,(
                   SELECT
                       RWS_LST.GLBL_CMPY_CD
                      ,RWS_LST.RWS_NUM
                   FROM
                       RWS_LST         RWS_LST
                      ,RWS_HDR         RWS_HDR
                      ,WMS_INBD_PO_HDR OUT_DAT
                   WHERE
                       RWS_LST.GLBL_CMPY_CD = RWS_HDR.GLBL_CMPY_CD
                   AND RWS_LST.RWS_NUM      = RWS_HDR.RWS_NUM
                   AND RWS_HDR.GLBL_CMPY_CD = OUT_DAT.GLBL_CMPY_CD
                   AND RWS_HDR.RWS_REF_NUM  = OUT_DAT.WMS_PO_ID
                   AND RWS_HDR.EZCANCELFLAG = '0'
                   AND OUT_DAT.EZCANCELFLAG = '0'
                   GROUP BY
                       RWS_LST.GLBL_CMPY_CD
                      ,RWS_LST.RWS_NUM
               ) REC_CHK
           WHERE
               RWS_LST.GLBL_CMPY_CD    = RWS_TGT.GLBL_CMPY_CD
           AND RWS_LST.RWS_NUM         = RWS_TGT.RWS_NUM
           AND RWS_TGT.GLBL_CMPY_CD    = CMP_CNV.GLBL_CMPY_CD(+)
           AND CMP_CNV.EZCANCELFLAG(+) = '0'
           AND RWS_TGT.GLBL_CMPY_CD    = OTP_CNV.GLBL_CMPY_CD(+)
           AND RWS_TGT.SCE_ORD_TP_CD   = OTP_CNV.SCE_ORD_TP_CD(+)
           AND OTP_CNV.INBD_OTBD_CD(+) = '1'
           AND RWS_TGT.GLBL_CMPY_CD    = REC_CHK.GLBL_CMPY_CD(+)
           AND RWS_TGT.RWS_NUM         = REC_CHK.RWS_NUM(+)
           ORDER BY
               RWS_TGT.RWS_NUM ASC) MAIN
   ]]>
	</statement>

	<statement id="findRwsDetail" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
            RD.RWS_NUM
            ,RD.RWS_DTL_LINE_NUM
            ,RD.MDSE_CD
            ,MDS.MDSE_NM              WMS_MDSE_DESC_TXT_01
            ,TL.PLANT_CD
            ,TL.TPL_LOC_NM
            ,RD.RTL_SWH_CD
            ,RD.RWS_QTY
            ,RD.TRX_LINE_NUM
            ,RD.WH_IN_ETA_DT
            ,RD.IMPT_INV_NUM
            ,RD.IMPT_INV_DO_NUM
            ,RD.OUT_PACK_FROM_CSE_NUM
            ,RD.OUT_PACK_TO_CSE_NUM
      --      ,RD.RWS_TO_WMS_DATA_TXT
            ,RD.THIRD_PTY_DSP_TP_CD
            ,RD.SER_APVL_REQ_FLG
            ,STK_STS.S80_STK_STS_CD
            ,RD.SCHD_PICK_UP_TM
        FROM
            RWS_HDR      RH
           ,RWS_DTL      RD
           ,RWS_STS      RSD
           ,TPL_LOC      TL
           ,MDSE         MDS
           ,STK_STS_CONV STK_STS
        WHERE
            RH.GLBL_CMPY_CD     = #GLBL_CMPY_CD#
        AND RH.RWS_NUM          = #RWS_NUM#
        AND RH.EZCANCELFLAG     = '0'
        AND RH.GLBL_CMPY_CD     = RD.GLBL_CMPY_CD
        AND RH.RWS_NUM          = RD.RWS_NUM
        AND RD.EZCANCELFLAG     = '0'
        AND RD.GLBL_CMPY_CD     = RSD.GLBL_CMPY_CD
        AND RD.RWS_STS_CD       = RSD.RWS_STS_CD
        AND (RSD.RWS_OPEN_FLG = #flgY# OR RSD.RCV_FLG = #flgY#)
        AND RSD.EZCANCELFLAG    = '0'
        AND RD.GLBL_CMPY_CD     = TL.GLBL_CMPY_CD(+)
        AND RD.RTL_WH_CD        = TL.TPL_LOC_CD(+)
        AND RD.INVTY_STK_STS_CD = TL.TPL_STK_STS_CD(+)
        AND TL.EZCANCELFLAG(+)  = '0'
        AND RD.GLBL_CMPY_CD     = MDS.GLBL_CMPY_CD(+)
        AND RD.MDSE_CD          = MDS.MDSE_CD(+)
        AND MDS.EZCANCELFLAG(+) = '0'
        AND RD.GLBL_CMPY_CD     = STK_STS.GLBL_CMPY_CD(+)
        AND RD.INVTY_STK_STS_CD = STK_STS.STK_STS_CD(+)
        AND STK_STS.EZCANCELFLAG(+) = '0'
        ORDER BY
            RD.RWS_NUM ASC
            ,RD.RWS_DTL_LINE_NUM ASC
    ]]>
	</statement>

	<statement id="findRwsText" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
            RM.RWS_NUM
           ,RM.RWS_MSG_SQ_NUM
           ,RM.RWS_MSG_TXT
        FROM
            RWS_MSG RM
        WHERE
            RM.GLBL_CMPY_CD = #GLBL_CMPY_CD#
        AND RM.RWS_NUM      = #RWS_NUM#
        AND RM.EZCANCELFLAG = '0'
        ORDER BY
            RM.RWS_NUM ASC
            ,RM.RWS_MSG_SQ_NUM ASC
    ]]>
	</statement>

	<statement id="findWmsRwsText" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
             RWSM.RWS_NUM
            ,MAX(CASE RWSM.RWS_MSG_SQ_NUM WHEN '1' THEN RWSM.RWS_MSG_TXT END) RWS_MSG_TXT_01 
            ,MAX(CASE RWSM.RWS_MSG_SQ_NUM WHEN '2' THEN RWSM.RWS_MSG_TXT END) RWS_MSG_TXT_02
            ,MAX(CASE RWSM.RWS_MSG_SQ_NUM WHEN '3' THEN RWSM.RWS_MSG_TXT END) RWS_MSG_TXT_03
            ,MAX(CASE RWSM.RWS_MSG_SQ_NUM WHEN '4' THEN RWSM.RWS_MSG_TXT END) RWS_MSG_TXT_04
        FROM
            RWS_MSG  RWSM
        WHERE
            RWSM.GLBL_CMPY_CD = #GLBL_CMPY_CD#
        AND RWSM.RWS_NUM      = #RWS_NUM#
        AND RWSM.EZCANCELFLAG = '0'
        GROUP BY 
            RWSM.RWS_NUM
    ]]>
	</statement>

	<statement id="findRwsSiteSurvey" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
            RH.RWS_NUM
            ,COALESCE(DSS1.CPO_ORD_NUM, DSS2.CPO_ORD_NUM) CPO_ORD_NUM
            ,COALESCE(DSS1.CPO_DTL_LINE_NUM, DSS2.CPO_DTL_LINE_NUM) CPO_DTL_LINE_NUM
            ,COALESCE(DSS1.CPO_DTL_LINE_SUB_NUM, DSS2.CPO_DTL_LINE_SUB_NUM) CPO_DTL_LINE_SUB_NUM
            ,RH.FROM_LOC_NM_01
            ,RH.FROM_LOC_CD
            ,RH.FROM_LOC_ADDR_01
            ,RH.FROM_LOC_CTY_ADDR
            ,COALESCE(DSS1.CMPY_INFO_APT_BLDG_NM, DSS2.CMPY_INFO_APT_BLDG_NM) CMPY_INFO_APT_BLDG_NM
            ,RH.FROM_LOC_ST_CD
            ,COALESCE(RDI.CMPY_INFO_FL_NM, DSS1.CMPY_INFO_FL_NM, DSS2.CMPY_INFO_FL_NM) CMPY_INFO_FL_NM
            ,RH.FROM_LOC_POST_CD
            ,COALESCE(DSS1.CMPY_INFO_DEPT_NM, DSS2.CMPY_INFO_DEPT_NM) CMPY_INFO_DEPT_NM
            ,COALESCE(DSS1.ELEV_PROT_REQ_FLG, DSS2.ELEV_PROT_REQ_FLG) ELEV_PROT_REQ_FLG
            ,COALESCE(RDI.DELY_INSTN_ADDL_CMNT_TXT, DSS1.SITE_SRVY_ADDL_CMNT_TXT, DSS2.SITE_SRVY_ADDL_CMNT_TXT) SITE_SRVY_ADDL_CMNT_TXT
            ,COALESCE(RDI.OTSD_STEP_NUM, DSS1.OTSD_STEP_NUM, DSS2.OTSD_STEP_NUM) OTSD_STEP_NUM
            ,COALESCE(RDI.INSD_STEP_NUM, DSS1.INSD_STEP_NUM, DSS2.INSD_STEP_NUM) INSD_STEP_NUM
            ,COALESCE(RDI.STAIR_CRAW_REQ_FLG, DSS1.STAIR_CRAW_REQ_FLG, DSS2.STAIR_CRAW_REQ_FLG) STAIR_CRAW_REQ_FLG
            ,COALESCE(DSS1.FLGT_STAIR_NUM, DSS2.FLGT_STAIR_NUM) FLGT_STAIR_NUM
            ,COALESCE(RDI.STAIR_AND_LDG_WDT, DSS1.STAIR_AND_LDG_WDT, DSS2.STAIR_AND_LDG_WDT) STAIR_AND_LDG_WDT
            ,COALESCE(RDI.LOAD_DOCK_AVAL_TXT, DSS1.LOAD_DOCK_AVAL_FLG, DSS2.LOAD_DOCK_AVAL_FLG) LOAD_DOCK_AVAL_FLG
            ,COALESCE(RDI.LOAD_DOCK_HGT, DSS1.LOAD_DOCK_HGT, DSS2.LOAD_DOCK_HGT) LOAD_DOCK_HGT
            ,COALESCE(RDI.OPS_FROM_HOUR_MN, DSS1.LOAD_DOCK_AVAL_FROM_HOUR_MN, DSS2.LOAD_DOCK_AVAL_FROM_HOUR_MN) LOAD_DOCK_AVAL_FROM_HOUR_MN
            ,COALESCE(RDI.OPS_TO_HOUR_MN, DSS1.LOAD_DOCK_AVAL_TO_HOUR_MN, DSS2.LOAD_DOCK_AVAL_TO_HOUR_MN) LOAD_DOCK_AVAL_TO_HOUR_MN
            ,COALESCE(RDI.TRCTR_AND_TRAIL_ACCS_TXT, DSS1.TRCTR_AND_TRAIL_ACCS_FLG, DSS2.TRCTR_AND_TRAIL_ACCS_FLG) TRCTR_AND_TRAIL_ACCS_FLG
            ,DCII.RQST_ISTL_TM CARR_DELY_TM_HOUR_MN
            ,COALESCE(RDI.DELY_TRNSP_OPT_CD, DSS1.DELY_TRNSP_OPT_CD, DSS2.DELY_TRNSP_OPT_CD) DELY_TRNSP_OPT_CD
            ,RDI.SEC_CLNC_REQ_TXT
            ,RDI.INS_CERT_REQ_TXT
            ,RDI.FL_COV_TXT
            ,RDI.RAMP_AVAL_TXT
            ,RDI.STEP_AVAL_TXT
            ,RDI.FRONT_DOOR_AVAL_TXT
            ,RDI.BACK_DOOR_AVAL_TXT
            ,RDI.PWR_OTLT_CONFIG_TXT
            ,RDI.SGN_ON_BLDG_RDSD_TXT
            ,RDI.BLDG_STRY_NUM
            ,RDI.BLDG_GURD_NTFY_TXT
            ,RDI.INDL_PARK_TXT
            ,RDI.BIZ_PARK_TXT
            ,RDI.PRO_BLDG_TXT
            ,RDI.SHPNG_CTR_TXT
            ,RDI.PVT_RES_TXT
            ,COALESCE(RDI.ELEV_AVAL_TXT, DSS1.ELEV_AVAL_FLG, DSS2.ELEV_AVAL_FLG) ELEV_AVAL_FLG
            ,COALESCE(RDI.ELEV_AVAL_FROM_HOUR_MN, DSS1.ELEV_AVAL_FROM_HOUR_MN, DSS2.ELEV_AVAL_FROM_HOUR_MN) ELEV_AVAL_FROM_HOUR_MN
            ,COALESCE(RDI.ELEV_AVAL_TO_HOUR_MN, DSS1.ELEV_AVAL_TO_HOUR_MN, DSS2.ELEV_AVAL_TO_HOUR_MN) ELEV_AVAL_TO_HOUR_MN
            ,COALESCE(RDI.ELEV_APPT_REQ_TXT, DSS1.ELEV_APPT_REQ_FLG, DSS2.ELEV_APPT_REQ_FLG) ELEV_APPT_REQ_FLG
            ,COALESCE(RDI.ELEV_CTAC_PSN_NM, DSS1.ELEV_CTAC_PSN_NM, DSS2.ELEV_CTAC_PSN_NM) ELEV_CTAC_PSN_NM
            ,COALESCE(RDI.ELEV_CTAC_TEL_NUM, DSS1.ELEV_CTAC_TEL_NUM, DSS2.ELEV_CTAC_TEL_NUM) ELEV_CTAC_TEL_NUM
            ,COALESCE(RDI.BLDG_ENT_DOOR_HGT, DSS1.BLDG_ENT_DOOR_HGT, DSS2.BLDG_ENT_DOOR_HGT) BLDG_ENT_DOOR_HGT
            ,COALESCE(RDI.BLDG_ENT_DOOR_WDT, DSS1.BLDG_ENT_DOOR_WDT, DSS2.BLDG_ENT_DOOR_WDT) BLDG_ENT_DOOR_WDT
            ,COALESCE(RDI.CRDR_WDT, DSS1.CRDR_WDT, DSS2.CRDR_WDT) CRDR_WDT
            ,COALESCE(RDI.DOOR_WDT, DSS1.DOOR_WDT, DSS2.DOOR_WDT) DOOR_WDT
            ,COALESCE(RDI.ELEV_WDT, DSS1.ELEV_WDT, DSS2.ELEV_WDT) ELEV_WDT
            ,COALESCE(RDI.ELEV_DEPTH_NUM, DSS1.ELEV_DEPTH_NUM, DSS2.ELEV_DEPTH_NUM) ELEV_DEPTH_NUM
            ,COALESCE(RDI.ELEV_CAP_WT, DSS1.ELEV_CAP_WT, DSS2.ELEV_CAP_WT) ELEV_CAP_WT
            ,COALESCE(RDI.ELEV_DOOR_HGT, DSS1.ELEV_DOOR_HGT, DSS2.ELEV_DOOR_HGT) ELEV_DOOR_HGT
            ,COALESCE(RDI.ELEV_DOOR_WDT, DSS1.ELEV_DOOR_WDT, DSS2.ELEV_DOOR_WDT) ELEV_DOOR_WDT
            ,COALESCE(RDI.CUST_INFO_BO_FLG, 'N') CUST_INFO_BO_FLG
            ,COALESCE(RDI.PICK_UP_XTR_TONER_FLG, 'N') PICK_UP_XTR_TONER_FLG
            ,COALESCE(RDI.PICK_UP_AT_SAME_TM_FLG, 'N') PICK_UP_AT_SAME_TM_FLG
        FROM
             RWS_HDR RH
            ,RWS_DELY_INSTN RDI
            ,DS_SITE_SRVY DSS1
            ,DS_SITE_SRVY DSS2
            ,DS_CPO_ISTL_INFO DCII
        WHERE
            RH.GLBL_CMPY_CD         = #GLBL_CMPY_CD#
        AND RH.RWS_NUM              = #RWS_NUM#
        AND RH.SCE_ORD_TP_CD        = #SCE_ORD_TP_CD# /* RT */
        AND RH.GLBL_CMPY_CD         = RDI.GLBL_CMPY_CD(+)
        AND RH.RWS_NUM              = RDI.RWS_NUM(+)
        AND RH.GLBL_CMPY_CD         = DSS1.GLBL_CMPY_CD(+)
        AND RH.TRX_ORD_NUM          = DSS1.CPO_ORD_NUM(+)
        AND RH.DS_CPO_CONFIG_PK     = DSS1.DS_CPO_CONFIG_PK(+)
        AND RH.GLBL_CMPY_CD         = DSS2.GLBL_CMPY_CD(+)
        AND RH.TRX_ORD_NUM          = DSS2.CPO_ORD_NUM(+)
        AND RH.GLBL_CMPY_CD         = DCII.GLBL_CMPY_CD(+)
        AND RH.TRX_ORD_NUM          = DCII.CPO_ORD_NUM(+)
        AND RH.EZCANCELFLAG         = '0'
        AND RDI.EZCANCELFLAG(+)     = '0'
        AND DSS1.EZCANCELFLAG(+)    = '0'
        AND DSS2.EZCANCELFLAG(+)    = '0'
        AND DCII.EZCANCELFLAG(+)    = '0'
        ORDER BY
            RH.RWS_NUM ASC
    ]]>
	</statement>

	<statement id="findRwsMdseSurvey" parameterClass="Map" resultClass="Map">
	<![CDATA[
        SELECT
            RD.RWS_NUM
            ,RD.RWS_DTL_LINE_NUM
            
            ,MD.MDSE_CD
            ,MD.MDSE_NM
            ,MSP.IN_POUND_WT
            ,MSP.IN_INCH_LG
            ,MSP.IN_INCH_WDT
            ,MSP.IN_INCH_HGT
            ,ROUND(
              SQRT(
               POWER(MSP.IN_INCH_LG, 2)
                + POWER(MSP.IN_INCH_WDT, 2)
                + POWER(MSP.IN_INCH_HGT, 2)
              ), 4) IN_INCH_DG
        FROM
            RWS_DTL RD
            ,MDSE MD
            ,MDSE_STORE_PKG MSP
        WHERE
            RD.GLBL_CMPY_CD     = #GLBL_CMPY_CD#
        AND RD.RWS_NUM          = #RWS_NUM#
        AND RD.GLBL_CMPY_CD     = MD.GLBL_CMPY_CD(+)
        AND RD.MDSE_CD          = MD.MDSE_CD(+)
        AND RD.GLBL_CMPY_CD     = MSP.GLBL_CMPY_CD(+)
        AND RD.MDSE_CD          = MSP.MDSE_CD(+)
        AND RD.EZCANCELFLAG     = '0'
        AND MD.EZCANCELFLAG(+)  = '0'
        AND MSP.EZCANCELFLAG(+) = '0'
        ORDER BY
            RD.RWS_NUM ASC
            ,RD.RWS_DTL_LINE_NUM ASC
	]]>
	</statement>

	<statement id="findRwsSerial" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
            RS.SER_NUM
        FROM
            RWS_SER RS
        WHERE
            RS.GLBL_CMPY_CD = #GLBL_CMPY_CD#
        AND RS.RWS_NUM      = #RWS_NUM#
        AND RS.RWS_LINE_NUM = #RWS_LINE_NUM#
        AND RS.EZCANCELFLAG = '0'
        ORDER BY
            RS.SER_NUM ASC
    ]]>
	</statement>
    
    <statement id="getTplCarrSvcLvlByRWS" parameterClass="Map" resultClass="Map">
        WITH SELECTED_TPL_CARR_SVC_LVL AS (
            SELECT
                TPL_CARR_CD
                ,TPL_CARR_NM
                ,TPL_CARR_SVC_LVL_SORT_NUM
            FROM
                TPL_CARR_SVC_LVL TC
                ,RWS_DTL RSD
            WHERE
                TC.GLBL_CMPY_CD		= #GLBL_CMPY_CD#
            AND TC.WH_OWNR_CD       = #WH_OWNR_CD#
            AND TC.GLBL_CMPY_CD     = RSD.GLBL_CMPY_CD
            AND TC.CARR_CD          = RSD.CARR_CD
            AND TC.SHPG_SVC_LVL_CD  = RSD.SHPG_SVC_LVL_CD
            AND RSD.RWS_NUM         = #RWS_NUM#
            AND TC.EZCANCELFLAG     = '0'
            AND RSD.EZCANCELFLAG    = '0'
            UNION
            SELECT
                TPL_CARR_CD
               ,TPL_CARR_NM
               ,TPL_CARR_SVC_LVL_SORT_NUM
            FROM
                TPL_CARR_SVC_LVL TC
               ,RWS_DTL RSD
            WHERE
                TC.GLBL_CMPY_CD		= #GLBL_CMPY_CD#
            AND TC.WH_OWNR_CD       = #WH_OWNR_CD#
            AND TC.GLBL_CMPY_CD     = RSD.GLBL_CMPY_CD
            AND TC.CARR_CD          = RSD.CARR_CD
            AND RSD.RWS_NUM         = #RWS_NUM#
            AND RSD.SHPG_SVC_LVL_CD IS NULL
            AND TC.EZCANCELFLAG     = '0'
            AND RSD.EZCANCELFLAG    = '0'
            UNION
            SELECT
                TPL_CARR_CD
                ,TPL_CARR_NM
                ,TPL_CARR_SVC_LVL_SORT_NUM
            FROM
                TPL_CARR_SVC_LVL TC
                ,RWS_DTL RSD
            WHERE
                TC.GLBL_CMPY_CD		= #GLBL_CMPY_CD#
            AND TC.WH_OWNR_CD       = #WH_OWNR_CD#
            AND TC.GLBL_CMPY_CD     = RSD.GLBL_CMPY_CD
            AND TC.SHPG_SVC_LVL_CD  = RSD.SHPG_SVC_LVL_CD
            AND RSD.RWS_NUM         = #RWS_NUM#
            AND RSD.CARR_CD         IS NULL
            AND TC.EZCANCELFLAG     = '0'
            AND RSD.EZCANCELFLAG    = '0'
        )
        SELECT
            TPL_CARR_CD
            ,TPL_CARR_NM
        FROM (
            SELECT
                STC.TPL_CARR_CD
               ,STC.TPL_CARR_NM
            FROM
                SELECTED_TPL_CARR_SVC_LVL STC
            ORDER BY
                STC.TPL_CARR_SVC_LVL_SORT_NUM ASC
        )
        WHERE
            ROWNUM &lt;= 1
    </statement>

    <statement id="getShpgPntCd" parameterClass="Map" resultClass="String">
        SELECT
            TL.SHPG_PNT_CD
        FROM
            TPL_LOC TL
        WHERE
            TL.GLBL_CMPY_CD = #GLBL_CMPY_CD#
        AND TL.TPL_LOC_CD   = #RTL_WH_CD#
        AND TL.EZCANCELFLAG = '0'
        AND ROWNUM          = 1
    </statement>

    <statement id="getRcvPntCd" parameterClass="Map" resultClass="String">
        SELECT
            TL.RCV_PNT_CD
        FROM
            TPL_LOC TL
        WHERE
            TL.GLBL_CMPY_CD = #GLBL_CMPY_CD#
        AND TL.TPL_LOC_CD   = #RTL_WH_CD#
        AND TL.EZCANCELFLAG = '0'
        AND ROWNUM          = 1
    </statement>

</sqlMap>
