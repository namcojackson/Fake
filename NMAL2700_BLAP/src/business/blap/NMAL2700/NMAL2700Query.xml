<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL2700Query">

    <typeAlias alias="NMAL2700SMsg"    type="business.blap.NMAL2700.NMAL2700SMsg"/>
    <typeAlias alias="NMAL2700_ASMsg"  type="business.blap.NMAL2700.NMAL2700_ASMsg"/>

    <statement id="getRoleMntList" parameterClass="Map" resultClass="Map">
      SELECT
          RML.FIRST_ORG_CD
          , RML.BIZ_AREA
          , RML.ROLE_CD
          , RML.ROLE_NM
          , RML.ROLE_DES
          , RML.ACTIVE
          , RML.EQUIP
          , RML.MGR
          , RML.SPCL
          , RML.CMSN
          , RML.ADMIN
          , RML.GES
          , RML.CREDIT
          , RML.SALES
          , RML.ASG
          , RML.THIRD
          , RML.TECH
          , RML.EXCL
          , RML.PRFL
          , RML.SLS_ASG
          , RML.SLS_ADMIN
          , RML.MULTI_PSN
          , RML.TECH_ASG
          , RML.TOC_REQ
          , RML.ORG_STRU
          , RML.S21_ORG
          , RML.EZUPTIME
          , RML.EZUPTIMEZONE
          <!-- Add Start 2016/11/02 M.Ohno S21_NA#2680 -->
          , RML.XX_REC_HIST_CRAT_TS
          , RML.XX_REC_HIST_CRAT_BY_NM
          , RML.XX_REC_HIST_UPD_TS
          , RML.XX_REC_HIST_UPD_BY_NM
          <!-- Add End   2016/11/02 M.Ohno S21_NA#2680 -->
      FROM (
      SELECT
          OFR.FIRST_ORG_CD              AS FIRST_ORG_CD
          ,BAO.BIZ_AREA_ORG_NM          AS BIZ_AREA
          ,OFR.ORG_FUNC_ROLE_TP_CD      AS ROLE_CD
          ,OFR.ORG_FUNC_ROLE_TP_NM      AS ROLE_NM
          ,OFR.ORG_FUNC_ROLE_TP_DESC_TXT AS  ROLE_DES
          ,OFR.ACTV_FLG                 AS ACTIVE
          ,OFR.EQUIP_FLG                AS EQUIP
          ,OFR.MGR_FLG                  AS MGR
          ,OFR.SPCL_FLG                 AS SPCL
          ,OFR.CMSN_FLG                 AS CMSN
          ,OFR.ADMIN_FLG                AS ADMIN
          ,GT.GES_TP_CD                 AS GES
          ,OFR.APVL_LIMIT_AMT           AS CREDIT
          ,OFR.SLS_REP_FLG              AS SALES
          ,OFR.ASG_CONTR_FLG            AS ASG
          ,OFR.THIRD_PTY_TECH_FLG       AS THIRD
          ,OFR.TECH_MSTR_REQ_FLG        AS TECH
          ,OFR.CRM_SLS_EXCL_FLG         AS EXCL
          ,OFR.CRM_SLS_PRFL_NM          AS PRFL
          ,OFR.SLS_ASG_ELIG_FLG         AS SLS_ASG
          ,OFR.SLS_ADMIN_ELIG_FLG       AS SLS_ADMIN
          ,OFR.MULT_PSN_ASG_FLG         AS MULTI_PSN
          ,OFR.TECH_ASG_ELIG_FLG        AS TECH_ASG
          ,OFR.TOC_REQ_FLG              AS TOC_REQ
          ,OFR.ORG_STRU_TP_CD           AS ORG_STRU
          ,OFR.S21_ORG_REQ_FLG          AS S21_ORG
          ,OFR.EZUPTIME
          ,OFR.EZUPTIMEZONE
          <!-- Add Start 2016/11/02 M.Ohno S21_NA#2680 -->
          ,OFR.EZINTIME                  AS XX_REC_HIST_CRAT_TS
          ,OFR.EZINUSERID                AS XX_REC_HIST_CRAT_BY_NM
          ,OFR.EZUPTIME                  AS XX_REC_HIST_UPD_TS
          ,OFR.EZUPUSERID                AS XX_REC_HIST_UPD_BY_NM
          <!-- Add End   2016/11/02 M.Ohno S21_NA#2680 -->
      FROM
          ORG_FUNC_ROLE_TP OFR
          ,GES_TP GT
          ,BIZ_AREA_ORG BAO
      WHERE
          OFR.GLBL_CMPY_CD   = #glblCmpyCd#
      AND OFR.EZCANCELFLAG   = '0'
      AND OFR.GLBL_CMPY_CD   = GT.GLBL_CMPY_CD(+)
      AND OFR.GES_TP_CD      = GT.GES_TP_CD(+)
      AND GT.EZCANCELFLAG(+) = '0'

      AND OFR.GLBL_CMPY_CD = BAO.GLBL_CMPY_CD(+)
      AND OFR.FIRST_ORG_CD = BAO.BIZ_AREA_ORG_CD(+)
      AND BAO.EZCANCELFLAG(+) = '0'

      <isNotNull property="bizAreaOrgNm">
          AND BAO.BIZ_AREA_ORG_CD = #bizAreaOrgNm#
      </isNotNull>
      <isNotNull property="orgfuncRoleTpCd">
          AND OFR.ORG_FUNC_ROLE_TP_CD LIKE #orgfuncRoleTpCd#
      </isNotNull>
      <isNotNull property="orgfuncRoleTpNm">
          AND UPPER(OFR.ORG_FUNC_ROLE_TP_NM) LIKE UPPER(#orgfuncRoleTpNm#)
      </isNotNull>
      <isNotNull property="orgfuncRoleTpDesc">
          AND UPPER(OFR.ORG_FUNC_ROLE_TP_DESC_TXT) LIKE UPPER(#orgfuncRoleTpDesc#)
      </isNotNull>
      <isNotNull property="mgrFlag">
          AND OFR.MGR_FLG = #mgrFlag#
      </isNotNull>
      <isNotNull property="spclFlg">
          AND OFR.SPCL_FLG = #spclFlg#
      </isNotNull>
      <isNotNull property="equipFlg">
          AND OFR.EQUIP_FLG = #equipFlg#
      </isNotNull>
      <isNotNull property="cmsnFlg">
          AND OFR.CMSN_FLG = #cmsnFlg#
      </isNotNull>
      <isNotNull property="actvFlg">
          AND OFR.ACTV_FLG = #actvFlg# 
      </isNotNull>
      )RML
      <isNotNull property="rowNum">
        WHERE ROWNUM &lt;= #rowNum#
      </isNotNull>
    </statement>
    <statement id="getRoleRequest" parameterClass="Map" resultClass="Map">
    SELECT
        TCR.ORG_FUNC_ROLE_TP_CD
    FROM
        ORG_TOC_CHNG_RQST TCR
    WHERE
        TCR.GLBL_CMPY_CD = #glblCmpyCd#
        AND TCR.EZCANCELFLAG = '0'
        AND TCR.ORG_FUNC_ROLE_TP_CD IN
        <iterate property="roleList" var="roleList[]" open="(" close=")" conjunction=",">
                        #roleList[]#
        </iterate>
        AND TCR.RGTN_STS_CD != #rgtnStsCd#
        Group BY TCR.ORG_FUNC_ROLE_TP_CD
    </statement>

    <statement id="roleCodeDuplicatedCheck" parameterClass="Map" resultClass="Map">
    SELECT
        OFR.ORG_FUNC_ROLE_TP_CD
    FROM
        ORG_FUNC_ROLE_TP OFR
    WHERE
        OFR.GLBL_CMPY_CD = #glblCmpyCd#
        AND OFR.EZCANCELFLAG = '0'
        AND OFR.ORG_FUNC_ROLE_TP_CD IN
        <iterate property="roleList" var="roleList[]" open="(" close=")" conjunction=",">
                        #roleList[]#
        </iterate>
    </statement>

    <statement id="roleNameDuplicatedCheck" parameterClass="Map" resultClass="Map">
    SELECT
        OFR.ORG_FUNC_ROLE_TP_NM
    FROM
        ORG_FUNC_ROLE_TP OFR
    WHERE
        OFR.GLBL_CMPY_CD = #glblCmpyCd#
        AND OFR.EZCANCELFLAG = '0'
        AND OFR.ORG_FUNC_ROLE_TP_NM IN
        <iterate property="roleList" var="roleList[]" open="(" close=")" conjunction=",">
                        #roleList[]#
        </iterate>
    </statement>

    <statement id="checkSfdcProfileName" parameterClass="Map" resultClass="Integer">
        <!-- 2018/04/23 QC#25485-2 del start -->
        <!-- SELECT
            COUNT(1)
        FROM
            CANON_E404_SF_PROFILE_TBL SF
        WHERE
            SF.NAME      =    #name# -->
        <!-- 2018/04/23 QC#25485-2 del end -->
        <!-- 2018/04/23 QC#25485-2 add start -->
        SELECT
            (SELECT
                    COUNT(1)
                FROM
                    CANON_E404_SF_PROFILE_TBL SF
                WHERE
                    SF.NAME      =     #name#)
            +
            (SELECT
                    COUNT(1)
                FROM
                    CANON_E633_LFS_SF_PROFILE_TBL SFLFS
                WHERE
                    SFLFS.NAME   =     #name#)
            +
            (SELECT
                    COUNT(1)
                FROM
                    CANON_E633_PPS_SF_PROFILE_TBL SFPPS
                WHERE
                    SFPPS.NAME   =     #name#) AS COUNT
        FROM
            DUAL
        <!-- 2018/04/23 QC#25485-2 add end -->

    </statement>
    <statement id="getBizAreaOrgPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
               ORG.BIZ_AREA_ORG_CD
              ,ORG.BIZ_AREA_ORG_NM
          FROM
               BIZ_AREA_ORG ORG
              ,ORG_STRU_TP STRU
         WHERE
               ORG.GLBL_CMPY_CD   = #glblCmpyCd#
           AND ORG.EZCANCELFLAG   = '0'
           AND STRU.GLBL_CMPY_CD  = #glblCmpyCd#
           AND STRU.EZCANCELFLAG  = '0'
           AND ORG.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
           AND TRTY_STRU_FLG = #trtyStruFlg#
         ORDER BY
               ORG.BIZ_AREA_ORG_SORT_NUM
    </statement>

</sqlMap>
