<template>

	<variable name="sql00" type="sql" value="
		SELECT
			COUNT(*)	AS	ITEM_CNT
		FROM
			EIP_RPT_INP_PRM
		WHERE
			EIP_RPT_RQST_PK	=	${_VA_EIP_RPT_RQST_PK}
		AND	RPT_RQST_SUB_ID	=	${_VA_RPT_RQST_SUB_ID}
		AND	(
				RPT_PRM_NM	=	'GLBL_CMPY_CD'
			OR	RPT_PRM_NM	=	'USR_ID'
			OR	RPT_PRM_NM	=	'PROC_START_TS'
			OR	RPT_PRM_NM	=	'SELL_TO_CUST_CD'
			OR	RPT_PRM_NM	=	'INTL_LANG_VAL_COL_NM'
		)
	" />

	<variable name="sql0" type="sql" value="
		SELECT
			RPT_PRM_NM
		,	RPT_PRM_VAL_TXT
		FROM
			EIP_RPT_INP_PRM
		WHERE
			EIP_RPT_RQST_PK	=	${_VA_EIP_RPT_RQST_PK}
		AND	RPT_RQST_SUB_ID	=	${_VA_RPT_RQST_SUB_ID}
		AND	(
				RPT_PRM_NM	=	'GLBL_CMPY_CD'
			OR	RPT_PRM_NM	=	'USR_ID'
			OR	RPT_PRM_NM	=	'PROC_START_TS'
			OR	RPT_PRM_NM	=	'SELL_TO_CUST_CD'
			OR	RPT_PRM_NM	=	'INTL_LANG_VAL_COL_NM'
		)
	" />

	<variable name="VA_PROC_START_TS" type="string" value="" />
	<variable name="VA_USR_ID" type="string" value="" />
	<variable name="VA_SELL_TO_CUST_CD" type="string" value="" />
	<variable name="VA_GLBL_CMPY_CD" type="string" value="" />
	<variable name="VA_INTL_LANG_VAL_COL_NM" type="string" value=""/>

	<variable name="sql01" type="sql" value="
		SELECT
			COUNT(*)			AS	REC_CNT
		FROM 
			PO_RNW_LTR_COV_WRK	PCW
		WHERE
			PCW.PROC_START_TS	=	${VA_PROC_START_TS}
		AND	PCW.USR_ID			=	${VA_USR_ID}
		AND	PCW.SELL_TO_CUST_CD	=	${VA_SELL_TO_CUST_CD}
		AND	PCW.GLBL_CMPY_CD	=	${VA_GLBL_CMPY_CD}
		AND	PCW.EZCANCELFLAG	=	'0'
	" />

	<variable name="sql1" type="sql" nonescaped="${VA_INTL_LANG_VAL_COL_NM}" value="
	WITH INTL_LB_V AS (
		SELECT
			*
		FROM
		(
			SELECT
				LANG_KEY_CD
			,	${VA_INTL_LANG_VAL_COL_NM}	AS	VAL_TXT
			FROM
				INTL_LANG_VAL
			WHERE
				GLBL_CMPY_CD	=	${VA_GLBL_CMPY_CD}
			AND	EZCANCELFLAG	=	'0'
		)
		PIVOT (
			MAX(VAL_TXT)
			FOR LANG_KEY_CD IN (
				'502'	AS	C502
			)
		)
	)
	SELECT
		GLBL_CMPY_NM
	,	GLBL_CMPY_FIRST_LINE_ADDR
	,	GLBL_CMPY_SCD_LINE_ADDR
	,	PO_RNW_LTR_DT_RPT_TXT
	,	SELL_TO_LOC_NM
	,	C502
	,	SELL_TO_ATTN_TXT
	,	SELL_TO_ADDL_LOC_NM
	,	SELL_TO_FIRST_LINE_ADDR
	,	SELL_TO_SCD_LINE_ADDR
	,	SELL_TO_THIRD_LINE_ADDR
	,	SELL_TO_FRTH_LINE_ADDR
	,	SELL_TO_FIFTH_LINE_ADDR
	,	PO_RNW_LTR_INSTN_TXT
	,	PO_RNW_LTR_CMNT_TXT
	FROM 
		PO_RNW_LTR_COV_WRK	PCW
	,	INTL_LB_V			ILV
	WHERE
		PCW.PROC_START_TS	=	${VA_PROC_START_TS}
	AND	PCW.USR_ID			=	${VA_USR_ID}
	AND	PCW.SELL_TO_CUST_CD	=	${VA_SELL_TO_CUST_CD}
	AND	PCW.GLBL_CMPY_CD	=	${VA_GLBL_CMPY_CD}
	AND	PCW.EZCANCELFLAG	=	'0'
	ORDER BY
		PO_RNW_LTR_CMNT_SQ_NUM	ASC
	" />

	<variable name="sql02" type="sql" value="
		SELECT
			COUNT(*)			AS	REC_CNT
		FROM 
			PO_RNW_LTR_RPT_WRK	PRW
		WHERE
			PRW.PROC_START_TS	=	${VA_PROC_START_TS}
		AND	PRW.USR_ID			=	${VA_USR_ID}
		AND	PRW.SELL_TO_CUST_CD	=	${VA_SELL_TO_CUST_CD}
		AND	PRW.GLBL_CMPY_CD	=	${VA_GLBL_CMPY_CD}
		AND	PRW.EZCANCELFLAG	=	'0'
	" />

	<variable name="sql2" type="sql" nonescaped="${VA_INTL_LANG_VAL_COL_NM}" value="
	WITH INTL_LB_V AS (
		SELECT
			*
		FROM
		(
			SELECT
				LANG_KEY_CD
			,	${VA_INTL_LANG_VAL_COL_NM}	AS	VAL_TXT
			FROM
				INTL_LANG_VAL
			WHERE
				GLBL_CMPY_CD	=	${VA_GLBL_CMPY_CD}
			AND	EZCANCELFLAG	=	'0'
		)
		PIVOT (
			MAX(VAL_TXT)
			FOR LANG_KEY_CD IN (
				'502'	AS	C502
			,	'22531'	AS	C22531
			,	'22532'	AS	C22532
			,	'22533'	AS	C22533
			,	'6580'	AS	C6580
			,	'22534'	AS	C22534
			,	'22535'	AS	C22535
			,	'22536'	AS	C22536
			,	'630'	AS	C630
			,	'6811'	AS	C6811
			,	'4243'	AS	C4243
			,	'22537'	AS	C22537
			,	'22538'	AS	C22538
			,	'22539'	AS	C22539
			,	'22540'	AS	C22540
			,	'22541'	AS	C22541
			,	'22542'	AS	C22542
			,	'22543'	AS	C22543
			,	'22544'	AS	C22544
			,	'22545'	AS	C22545
			,	'22546'	AS	C22546
			,	'22547'	AS	C22547
			,	'22548'	AS	C22548
			,	'22549'	AS	C22549
			,	'22550'	AS	C22550
			,	'22551'	AS	C22551
			,	'22552'	AS	C22552
			,	'745'	AS	C745
			,	'22553'	AS	C22553
			,	'22554'	AS	C22554
			,	'22555'	AS	C22555
			,	'6775'	AS	C6775
			,	'1727'	AS	C1727
			,	'22556'	AS	C22556
			,	'm'		AS	CM
			,	'22557'	AS	C22557
			,	'22558'	AS	C22558
			)
		)
	)
	SELECT
		C22531
	,	C22532
	,	C22533
	,	C6580
	,	C22534
	,	C22535
	,	C22536
	,	C502
	,	C630
	,	C6811
	,	C4243
	,	C22537
	,	C22538
	,	C22539
	,	C22540
	,	CASE
		WHEN BLLG_MTR_LB_TXT IS NOT NULL
		THEN
			C22541
		ELSE
			''
		END	AS	C22541
	,	CASE
		WHEN BLLG_MTR_LB_TXT IS NOT NULL
		THEN
			C22542
		ELSE
			''
		END	AS	C22542
	,	C22543
	,	C22544
	,	C22545
	,	C22546
	,	C22547
	,	C22548
	,	C22549
	,	C22550
	,	C22551
	,	C22552
	,	C745
	,	C22553
	,	C22554
	,	C502
	,	C22555
	,	C6775
	,	C1727
	,	C22556
	,	CM
	,	C22557
	,	C22558
	,	''	AS	XX_BLANK
	,	CASE WHEN BLLG_MTR_LB_TXT IS NULL
		THEN
			''
		ELSE
			PO_RNW_LTR_CCY_LB_TXT
		END	AS	XX_XS_MTR_CCY_LB_TXT
	,	CASE WHEN EXISTS (
			SELECT
				*
			FROM
				PO_RNW_LTR_RPT_WRK	W
			WHERE
				W.PROC_START_TS		=	PRW.PROC_START_TS
			AND	W.USR_ID			=	PRW.USR_ID
			AND	W.SELL_TO_CUST_CD	=	PRW.SELL_TO_CUST_CD
			AND	W.GLBL_CMPY_CD		=	PRW.GLBL_CMPY_CD
			AND	W.EZCANCELFLAG		=	PRW.EZCANCELFLAG
			AND	W.DS_CONTR_NUM		=	PRW.DS_CONTR_NUM
			AND	W.PO_SQ_NUM			=	PRW.PO_SQ_NUM
			AND	W.BLLG_MTR_LB_TXT	IS NOT NULL
		) THEN
			PO_RNW_LTR_CCY_LB_TXT
		ELSE
			''
		END	AS	XX_TOT_ANN_BASE_PRC_CCY_LB_TXT
	,	CASE WHEN EXISTS (
			SELECT
				*
			FROM
				PO_RNW_LTR_RPT_WRK	W
			WHERE
				W.PROC_START_TS		=	PRW.PROC_START_TS
			AND	W.USR_ID			=	PRW.USR_ID
			AND	W.SELL_TO_CUST_CD	=	PRW.SELL_TO_CUST_CD
			AND	W.GLBL_CMPY_CD		=	PRW.GLBL_CMPY_CD
			AND	W.EZCANCELFLAG		=	PRW.EZCANCELFLAG
			AND	W.DS_CONTR_NUM		=	PRW.DS_CONTR_NUM
			AND	W.PO_SQ_NUM			=	PRW.PO_SQ_NUM
			AND	W.BLLG_MTR_LB_TXT	IS NOT NULL
		) THEN
			PO_RNW_LTR_CCY_LB_TXT
		ELSE
			''
		END	AS	XX_EST_MTR_PRC_CCY_LB_TXT
	,	CASE WHEN EXISTS (
			SELECT
				*
			FROM
				PO_RNW_LTR_RPT_WRK	W
			WHERE
				W.PROC_START_TS		=	PRW.PROC_START_TS
			AND	W.USR_ID			=	PRW.USR_ID
			AND	W.SELL_TO_CUST_CD	=	PRW.SELL_TO_CUST_CD
			AND	W.GLBL_CMPY_CD		=	PRW.GLBL_CMPY_CD
			AND	W.EZCANCELFLAG		=	PRW.EZCANCELFLAG
			AND	W.DS_CONTR_NUM		=	PRW.DS_CONTR_NUM
			AND	W.PO_SQ_NUM			=	PRW.PO_SQ_NUM
			AND	W.BLLG_MTR_LB_TXT	IS NOT NULL
		) THEN
			PO_RNW_LTR_CCY_LB_TXT
		ELSE
			''
		END	AS	XX_TOT_PO_PRC_CCY_LB_TXT
	,	PO_RNW_LTR_QUOTE_LB_TXT
	,	USG_CHRG_CMNT_TXT
	,	EST_MTR_PRC_AMT_LB_TXT
	,	RNW_CUST_PO_NUM_LB_TXT
	,	GLBL_CMPY_NM
	,	GLBL_CMPY_FIRST_LINE_ADDR
	,	GLBL_CMPY_SCD_LINE_ADDR
	,	PO_RNW_LTR_DT_RPT_TXT
	,	SELL_TO_CUST_CD
	,	SELL_TO_LOC_NM
	,	SELL_TO_ATTN_TXT
	,	SELL_TO_ADDL_LOC_NM
	,	SELL_TO_FIRST_LINE_ADDR
	,	SELL_TO_SCD_LINE_ADDR
	,	SELL_TO_THIRD_LINE_ADDR
	,	SELL_TO_FRTH_LINE_ADDR
	,	SELL_TO_FIFTH_LINE_ADDR
	,	BILL_TO_CUST_CD
	,	BILL_TO_LOC_NM
	,	BILL_TO_ATTN_TXT
	,	BILL_TO_ADDL_LOC_NM
	,	BILL_TO_FIRST_LINE_ADDR
	,	BILL_TO_SCD_LINE_ADDR
	,	BILL_TO_THIRD_LINE_ADDR
	,	BILL_TO_FRTH_LINE_ADDR
	,	BILL_TO_FIFTH_LINE_ADDR
	,	RNW_DEPT_FAX_NUM
	,	RNW_DEPT_DESC_TXT
	,	RNW_PO_EFF_FROM_DT_TXT
	,	RNW_PO_EFF_THRU_DT_TXT
	,	PO_EFF_THRU_DT_TXT
	,	PO_SQ_NUM
	,	CUST_PO_NUM
	,	DS_CONTR_NUM
	,	TOT_ANN_BASE_PRC_AMT_TXT
	,	SHIP_TO_LOC_NM
	,	SHIP_TO_ADDR
	,	DS_CONTR_DTL_PK
	,	MDL_DESC_TXT
	,	SER_NUM
	,	CONTR_NUM
	,	BASE_PRC_AMT_TXT
	,	ANN_BLLG_CNT_TXT
	,	ANN_BASE_PRC_AMT_TXT
	,	DS_CONTR_BLLG_MTR_PK
	,	BLLG_MTR_LB_TXT
	,	XS_MTR_LB_TXT
	,	XS_MTR_COPY_QTY_TXT
	,	XS_MTR_AMT_RATE_TXT
	FROM 
		PO_RNW_LTR_RPT_WRK	PRW
	,	INTL_LB_V			ILV
	WHERE
		PRW.PROC_START_TS	=	${VA_PROC_START_TS}
	AND	PRW.USR_ID			=	${VA_USR_ID}
	AND	PRW.SELL_TO_CUST_CD	=	${VA_SELL_TO_CUST_CD}
	AND	PRW.GLBL_CMPY_CD	=	${VA_GLBL_CMPY_CD}
	AND	PRW.EZCANCELFLAG	=	'0'
	ORDER BY
		SELL_TO_CUST_CD			ASC
	,	DS_CONTR_NUM			ASC
	,	PO_SQ_NUM				ASC
	,	MDL_DESC_TXT			ASC
	,	DS_CONTR_DTL_PK			ASC
	,	BLLG_MTR_LB_TXT			ASC
	,	DS_CONTR_BLLG_MTR_PK	ASC
	,	XS_MTR_COPY_QTY_TXT		ASC
	,	XS_MTR_LB_TXT			DESC
	" />

	<doc encoding="UTF-8">

		<condition test="${sql00.ITEM_CNT}" operator="equal" value="0">
			<error message="no data in eip_rpt_inp_prm" />
		</condition>

		<for variable="sql0">
			<condition test="${sql0.RPT_PRM_NM}" operator="equal" value="PROC_START_TS">
				<assign variable="VA_PROC_START_TS" value="${sql0.RPT_PRM_VAL_TXT}" />
			</condition>
			<condition test="${sql0.RPT_PRM_NM}" operator="equal" value="USR_ID">
				<assign variable="VA_USR_ID" value="${sql0.RPT_PRM_VAL_TXT}" />
			</condition>
			<condition test="${sql0.RPT_PRM_NM}" operator="equal" value="SELL_TO_CUST_CD">
				<assign variable="VA_SELL_TO_CUST_CD" value="${sql0.RPT_PRM_VAL_TXT}" />
			</condition>
			<condition test="${sql0.RPT_PRM_NM}" operator="equal" value="GLBL_CMPY_CD">
				<assign variable="VA_GLBL_CMPY_CD" value="${sql0.RPT_PRM_VAL_TXT}" />
			</condition>
			<condition test="${sql0.RPT_PRM_NM}" operator="equal" value="INTL_LANG_VAL_COL_NM">
				<assign variable="VA_INTL_LANG_VAL_COL_NM" value="${sql0.RPT_PRM_VAL_TXT}"/>
			</condition>
		</for>

		<condition test="${sql01.REC_CNT}" operator="equal" value="0">
			<error message="no data in po_rnw_ltr_cov_wrk" />
		</condition>

		<condition test="${sql02.REC_CNT}" operator="equal" value="0">
			<error message="no data in po_rnw_ltr_rpt_wrk" />
		</condition>

		<section name="Control Section">
			<textln>VERSION=8.1</textln>
		</section>

		<section name="Form Section">
			<textln>FORM=..\..\forms\NSAF0010.fcx</textln>
		</section>

		<section name="Table Data Section">

			<for variable="sql1">

				<text>"${sql1.GLBL_CMPY_NM}",</text>
				<text>"${sql1.GLBL_CMPY_FIRST_LINE_ADDR}",</text>
				<text>"${sql1.GLBL_CMPY_SCD_LINE_ADDR}",</text>
				<text>"${sql1.PO_RNW_LTR_DT_RPT_TXT}",</text>
				<text>"${sql1.SELL_TO_LOC_NM}",</text>
				<text>"${sql1.C502}:",</text>
				<text>"${sql1.SELL_TO_ATTN_TXT}",</text>
				<text>"${sql1.SELL_TO_ADDL_LOC_NM}",</text>
				<text>"${sql1.SELL_TO_FIRST_LINE_ADDR}",</text>
				<text>"${sql1.SELL_TO_SCD_LINE_ADDR}",</text>
				<text>"${sql1.SELL_TO_THIRD_LINE_ADDR}",</text>
				<text>"${sql1.SELL_TO_FRTH_LINE_ADDR}",</text>
				<text>"${sql1.SELL_TO_FIFTH_LINE_ADDR}",</text>
				<text>"${sql1.PO_RNW_LTR_INSTN_TXT}",</text>
				<textln>"${sql1.PO_RNW_LTR_CMNT_TXT}"</textln>

			</for>

		</section>

		<section name="Form Section">
			<textln>NEXTPAGE</textln>
		</section>

		<section name="Table Data Section">

			<for variable="sql2">

				<text>"${sql2.C22531}",</text>
				<text>"${sql2.C22532}",</text>
				<text>"${sql2.C22533}",</text>
				<text>"${sql2.C6580}",</text>
				<text>"${sql2.C22534}",</text>
				<text>"${sql2.C22535}:",</text>
				<text>"${sql2.C22536}",</text>
				<text>"${sql2.C502}:",</text>
				<text>"${sql2.C630}:",</text>
				<text>"${sql2.C6811}",</text>
				<text>"${sql2.C4243}",</text>
				<text>"${sql2.C22537}",</text>
				<text>"${sql2.C22538}",</text>
				<text>"${sql2.C22539}",</text>
				<text>"${sql2.C22540}",</text>
				<text>"${sql2.C22541}",</text>
				<text>"${sql2.C22542}",</text>
				<text>"${sql2.C22543}:",</text>
				<text>"${sql2.C22544}:",</text>
				<text>"${sql2.C22545}:",</text>
				<text>"${sql2.C22546}",</text>
				<text>"${sql2.C22547}:",</text>
				<text>"${sql2.C22548}",</text>
				<text>"${sql2.C22549}",</text>
				<text>"${sql2.C22550}",</text>
				<text>"${sql2.C22551}",</text>
				<text>"${sql2.C22552}:",</text>
				<text>"${sql2.C745}:",</text>
				<text>"${sql2.C22553}:",</text>
				<text>"${sql2.C22554}:",</text>
				<text>"${sql2.CM}",</text>
				<text>"${sql2.C22557}",</text>
				<text>"${sql2.C22558}",</text>
				<text>"${sql2.XX_BLANK}",</text>
				<text>"${sql2.XX_XS_MTR_CCY_LB_TXT}",</text>
				<text>"${sql2.XX_TOT_ANN_BASE_PRC_CCY_LB_TXT}",</text>
				<text>"${sql2.XX_EST_MTR_PRC_CCY_LB_TXT}",</text>
				<text>"${sql2.XX_TOT_PO_PRC_CCY_LB_TXT}",</text>
				<text>"${sql2.PO_RNW_LTR_QUOTE_LB_TXT}",</text>
				<text>"${sql2.USG_CHRG_CMNT_TXT}",</text>
				<condition test="${sql2.EST_MTR_PRC_AMT_LB_TXT}" operator="equal" value="">
					<text>"${sql2.EST_MTR_PRC_AMT_LB_TXT}",</text>
				</condition>
				<condition test="${sql2.EST_MTR_PRC_AMT_LB_TXT}" operator="not equal" value="">
					<text>"${sql2.EST_MTR_PRC_AMT_LB_TXT}:",</text>
				</condition>
				<text>"${sql2.RNW_CUST_PO_NUM_LB_TXT}",</text>
				<text>"${sql2.GLBL_CMPY_NM}",</text>
				<text>"${sql2.GLBL_CMPY_FIRST_LINE_ADDR}",</text>
				<text>"${sql2.GLBL_CMPY_SCD_LINE_ADDR}",</text>
				<text>"${sql2.PO_RNW_LTR_DT_RPT_TXT}",</text>
				<text>"${sql2.SELL_TO_CUST_CD}",</text>
				<text>"${sql2.SELL_TO_LOC_NM}",</text>
				<text>"${sql2.SELL_TO_ATTN_TXT}",</text>
				<text>"${sql2.SELL_TO_ADDL_LOC_NM}",</text>
				<text>"${sql2.SELL_TO_FIRST_LINE_ADDR}",</text>
				<text>"${sql2.SELL_TO_SCD_LINE_ADDR}",</text>
				<text>"${sql2.SELL_TO_THIRD_LINE_ADDR}",</text>
				<text>"${sql2.SELL_TO_FRTH_LINE_ADDR}",</text>
				<text>"${sql2.SELL_TO_FIFTH_LINE_ADDR}",</text>
				<text>"${sql2.BILL_TO_CUST_CD}",</text>
				<text>"${sql2.BILL_TO_LOC_NM}",</text>
				<text>"${sql2.BILL_TO_ATTN_TXT}",</text>
				<text>"${sql2.BILL_TO_ADDL_LOC_NM}",</text>
				<text>"${sql2.BILL_TO_FIRST_LINE_ADDR}",</text>
				<text>"${sql2.BILL_TO_SCD_LINE_ADDR}",</text>
				<text>"${sql2.BILL_TO_THIRD_LINE_ADDR}",</text>
				<text>"${sql2.BILL_TO_FRTH_LINE_ADDR}",</text>
				<text>"${sql2.BILL_TO_FIFTH_LINE_ADDR}",</text>
				<text>"${sql2.RNW_DEPT_FAX_NUM}",</text>
				<text>"${sql2.RNW_DEPT_DESC_TXT}",</text>
				<text>"${sql2.RNW_PO_EFF_FROM_DT_TXT}",</text>
				<text>"${sql2.RNW_PO_EFF_THRU_DT_TXT}",</text>
				<text>"${sql2.PO_EFF_THRU_DT_TXT}",</text>
				<text>"${sql2.PO_SQ_NUM}",</text>
				<text>"${sql2.CUST_PO_NUM}",</text>
				<text>"${sql2.DS_CONTR_NUM}",</text>
				<text>"${sql2.TOT_ANN_BASE_PRC_AMT_TXT}",</text>
				<text>"${sql2.SHIP_TO_LOC_NM}",</text>
				<text>"${sql2.SHIP_TO_ADDR}",</text>
				<text>"${sql2.DS_CONTR_DTL_PK}",</text>
				<text>"${sql2.MDL_DESC_TXT}",</text>
				<text>"${sql2.SER_NUM}",</text>
				<text>"${sql2.CONTR_NUM}",</text>
				<text>"${sql2.BASE_PRC_AMT_TXT}",</text>
				<text>"${sql2.ANN_BLLG_CNT_TXT}",</text>
				<text>"${sql2.ANN_BASE_PRC_AMT_TXT}",</text>
				<text>"${sql2.DS_CONTR_BLLG_MTR_PK}",</text>
				<condition test="${sql2.BLLG_MTR_LB_TXT}" operator="equal" value="">
					<text>"${sql2.BLLG_MTR_LB_TXT}",</text>
				</condition>
				<condition test="${sql2.BLLG_MTR_LB_TXT}" operator="not equal" value="">
					<text>"${sql2.BLLG_MTR_LB_TXT}:",</text>
				</condition>
				<text>"${sql2.XS_MTR_LB_TXT}",</text>
				<text>"${sql2.XS_MTR_COPY_QTY_TXT}",</text>
				<textln>"${sql2.XS_MTR_AMT_RATE_TXT}"</textln>

			</for>

		</section>

	</doc>

	<mdatas>
		<mdata key="xcCommonExAttrText1" value="version1.0" />
	</mdatas>

</template>
