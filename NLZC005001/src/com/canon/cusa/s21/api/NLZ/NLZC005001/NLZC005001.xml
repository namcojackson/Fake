<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLZC005001">
    <statement id="getPersonName" parameterClass="Map" resultClass="String">
        SELECT
            AP.FIRST_NM || ' ' || AP.LAST_NM  AS FULL_NAME
        FROM
            AUTH_PSN AP
        WHERE
            AP.GLBL_CMPY_CD = #glblCmpyCd#
        AND AP.USR_NM       = #psnCd#
        AND AP.EZCANCELFLAG = '0'
    </statement>

    <statement id="getInvtyOrdHeaderInfo" parameterClass="Map" resultClass="Map">
<!-- START 01/28/2020 T.Ogura [QC#55569,ADD] -->
        SELECT
            *
        FROM 
            (
<!-- END   01/28/2020 T.Ogura [QC#55569,ADD] -->
            SELECT
                 IO.INVTY_ORD_NUM
                ,IO.INVTY_LOC_CD
                ,IO.INVTY_ORD_TP_CD
                ,IO.TRX_SRC_TP_CD
                ,IOT.INVTY_ORD_TP_DESC_TXT
                ,TST.TRX_SRC_TP_DESC_TXT
<!-- START 01/28/2020 T.Ogura [QC#55569,ADD] -->
                ,IOD.INVTY_ORD_LINE_CMNT_TXT
<!-- END   01/28/2020 T.Ogura [QC#55569,ADD] -->
            FROM
                 INVTY_ORD     IO
<!-- START 01/28/2020 T.Ogura [QC#55569,ADD] -->
                ,INVTY_ORD_DTL IOD
<!-- END   01/28/2020 T.Ogura [QC#55569,ADD] -->
                ,INVTY_ORD_TP  IOT
                ,TRX_SRC_TP    TST
            WHERE
                IO.GLBL_CMPY_CD     = #glblCmpyCd#
            AND IO.INVTY_ORD_NUM    = #invtyOrdNum#
            AND IO.EZCANCELFLAG     = '0'
<!-- START 01/28/2020 T.Ogura [QC#55569,ADD] -->
            AND IO.GLBL_CMPY_CD     = IOD.GLBL_CMPY_CD
            AND IO.INVTY_ORD_NUM    = IOD.INVTY_ORD_NUM
            AND IOD.EZCANCELFLAG    = '0'
<!-- END   01/28/2020 T.Ogura [QC#55569,ADD] -->
            AND IOT.GLBL_CMPY_CD(+)    = IO.GLBL_CMPY_CD
            AND IOT.INVTY_ORD_TP_CD(+) = IO.INVTY_ORD_TP_CD
            AND IOT.EZCANCELFLAG(+)    = '0'
            AND TST.GLBL_CMPY_CD(+)    = IO.GLBL_CMPY_CD
            AND TST.TRX_SRC_TP_CD(+)   = IO.TRX_SRC_TP_CD
            AND TST.EZCANCELFLAG(+)    = '0'
<!-- START 01/28/2020 T.Ogura [QC#55569,ADD] -->
            ORDER BY IOD.INVTY_ORD_LINE_NUM
            ) WHERE ROWNUM = 1
<!-- END   01/28/2020 T.Ogura [QC#55569,ADD] -->
    </statement>

    <statement id="getInvtyOrdDtlInfo" parameterClass="Map" resultClass="Map">
        SELECT
             IOD.INVTY_ORD_NUM
            ,IOD.INVTY_ORD_LINE_NUM
            ,IOD.MDSE_CD
            ,IOD.ORD_QTY
            ,INVTY_LOC_CD
            ,FROM_INVTY_LOC_CD
            ,TO_INVTY_LOC_CD
        FROM
             INVTY_ORD_DTL    IOD
        WHERE
            IOD.GLBL_CMPY_CD     = #glblCmpyCd#
        AND IOD.INVTY_ORD_NUM    = #invtyOrdNum#
        AND IOD.EZCANCELFLAG     = '0'
        ORDER BY
            INVTY_ORD_LINE_NUM    ASC
    </statement>

    <statement id="getApvlTeamTransactions" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            APVL_HIST_SRC_TP_CD
        FROM 
            (
            SELECT
                DISTINCT
                 ATE.APVL_TEAM_PK
                ,ATP.APVL_TEAM_POSN_LAYER_NUM
                ,ATT.APVL_HIST_SRC_TP_CD
            FROM
                 APVL_TEAM         ATE
                ,APVL_TEAM_MBR     ATM
                ,APVL_TEAM_TRX     ATT
                ,APVL_TEAM_LOC     ATL
                ,APVL_LIMIT        ALT
                ,APVL_TEAM_POSN_TP ATP
            WHERE 1=1
            AND ATE.GLBL_CMPY_CD         = #glblCmpyCd#
            AND ATE.APVL_HRCH_TP_CD      = #apvlHrchTpCd#
            AND ATE.EZCANCELFLAG         = '0'
            AND ATE.GLBL_CMPY_CD         = ATM.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK         = ATM.APVL_TEAM_PK
            AND ATM.EZCANCELFLAG         = '0'
            AND ATE.GLBL_CMPY_CD         = ATT.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK         = ATT.APVL_TEAM_PK
            AND ATT.APVL_HIST_SRC_TP_CD  IN (#adjMerchandise#, #adjParts#)
            AND ATT.EZCANCELFLAG         = '0'
            AND ATE.GLBL_CMPY_CD         = ATL.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK         = ATL.APVL_TEAM_PK
            AND ATL.RTL_WH_CD            = #rtlWhCd#
            AND ATL.EZCANCELFLAG         = '0'
            AND ATE.GLBL_CMPY_CD         = ALT.GLBL_CMPY_CD
            AND ATE.APVL_HRCH_TP_CD      = ALT.APVL_HRCH_TP_CD
            AND ALT.APVL_TEAM_POSN_TP_CD = ATM.APVL_TEAM_POSN_TP_CD
            AND ALT.APVL_HIST_SRC_TP_CD  = ATT.APVL_HIST_SRC_TP_CD
            AND ALT.APVL_LIMIT_AMT      &gt;= ABS(#apvlLimitAmt#)
            AND ALT.EZCANCELFLAG         = '0'
            AND ATM.APVL_TEAM_POSN_TP_CD = ATP.APVL_TEAM_POSN_TP_CD
            AND ATE.GLBL_CMPY_CD         = ATP.GLBL_CMPY_CD
            AND ATP.EZCANCELFLAG         = '0'
            ORDER BY 
                ATP.APVL_TEAM_POSN_LAYER_NUM DESC
            ) A
    </statement>

<!-- START 05/19/2020 [QC#56549,ADD] -->
    <statement id="getLimitAmount" parameterClass="Map" resultClass="BigDecimal">
        SELECT DISTINCT
            APVL_LIMIT_AMT
        FROM 
            (
            SELECT
                DISTINCT
                 ALT.APVL_LIMIT_AMT
            FROM
                 APVL_TEAM         ATE
                ,APVL_TEAM_MBR     ATM
                ,APVL_TEAM_TRX     ATT
                ,APVL_TEAM_LOC     ATL
                ,APVL_LIMIT        ALT
            WHERE 1=1
            AND ATE.GLBL_CMPY_CD         = #glblCmpyCd#
            AND ATE.APVL_HRCH_TP_CD      = #apvlHrchTpCd#
            AND ATE.EZCANCELFLAG         = '0'
            AND ATE.GLBL_CMPY_CD         = ATM.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK         = ATM.APVL_TEAM_PK
            AND ATM.PSN_CD               = #system#
            AND ATM.EZCANCELFLAG         = '0'
            AND ATE.GLBL_CMPY_CD         = ATT.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK         = ATT.APVL_TEAM_PK
            AND ATT.APVL_HIST_SRC_TP_CD  = #apvlHistSrcTpCd#
            AND ATT.EZCANCELFLAG         = '0'
            AND ATE.GLBL_CMPY_CD         = ATL.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK         = ATL.APVL_TEAM_PK
            AND ATL.RTL_WH_CD            = #rtlWhCd#
            AND ATL.EZCANCELFLAG         = '0'
            AND ATE.GLBL_CMPY_CD         = ALT.GLBL_CMPY_CD
            AND ATE.APVL_HRCH_TP_CD      = ALT.APVL_HRCH_TP_CD
            AND ALT.APVL_TEAM_POSN_TP_CD = ATM.APVL_TEAM_POSN_TP_CD
            AND ALT.APVL_HIST_SRC_TP_CD  = ATT.APVL_HIST_SRC_TP_CD
            AND ALT.EZCANCELFLAG         = '0'
            ) A
    </statement>
<!-- END   05/19/2020 [QC#56549,ADD] -->
</sqlMap>
