<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLZC010001">

    <!-- ==== Type Aliases ==== -->

    <!-- ==== Result Mapping ==== -->

    <statement id="getSellDirectDataRs" parameterClass="Map">
     SELECT
          PRH.PO_RCV_NUM                    AS PO_RCV_NUM
         ,PRH.WH_CD                         AS WH_CD_PRH
         ,PRH.RWS_REF_NUM                   AS RWS_REF_NUM
         ,PRH.SCE_ORD_TP_CD                 AS SCE_ORD_TP_CD
         ,PRH.PO_RCV_FROM_LOC_TP_CD         AS PO_RCV_FROM_LOC_TP_CD
         ,PRH.PO_RCV_FROM_LOC_CD            AS PO_RCV_FROM_LOC_CD
         ,PRH.PO_RCV_ETA_DT                 AS PO_RCV_ETA_DT
         ,PRH.SYS_SRC_CD                    AS SYS_SRC_CD_PRH
         ,PRH.PO_RCV_TRX_HDR_NUM            AS PO_RCV_TRX_HDR_NUM
         ,PRH.CUST_PO_NUM                   AS CUST_PO_NUM
         ,PRD.GLBL_CMPY_CD                  AS GLBL_CMPY_CD
         ,PRD.PO_RCV_LINE_NUM               AS PO_RCV_LINE_NUM
         ,PRD.STK_STS_CD                    AS STK_STS_CD
         ,PRD.PO_RCV_QTY                    AS PO_RCV_QTY
         ,PRD.PO_RCV_TRX_LINE_NUM           AS PO_RCV_TRX_LINE_NUM
         ,PRD.RWS_STS_CD                    AS RWS_STS_CD
         ,PRD.MDSE_CD                       AS MDSE_CD
         ,SHPG.SHIP_TO_CUST_CD              AS SHIP_TO_CUST_CD
         ,SHPG.TRX_SRC_TP_CD                AS TRX_SRC_TP_CD
         ,SHPG.TRX_HDR_NUM                  AS TRX_HDR_NUM
         ,SHPG.TRX_LINE_NUM                 AS TRX_LINE_NUM
         ,SHPG.TRX_LINE_SUB_NUM             AS TRX_LINE_SUB_NUM
         ,SHPG.SYS_SRC_CD                   AS SYS_SRC_CD_SHPG
         ,SHPG.SHPG_PLN_NUM                 AS SHPG_PLN_NUM
         ,SHPG.SHIP_TO_FIRST_REF_CMNT_TXT   AS SHIP_TO_FIRST_REF_CMNT_TXT
         ,CPO.CPO_ORD_TP_CD                 AS CPO_ORD_TP_CD
         ,NULL                              AS TRIAL_LOAN_RSN_CD_CPO
         ,CPO.ADD_SHIP_TO_LOC_NM            AS ADD_SHIP_TO_LOC_NM
         ,CPO.ADD_SHIP_TO_ADDL_LOC_NM       AS ADD_SHIP_TO_ADDL_LOC_NM
         ,CPO.ADD_SHIP_TO_FIRST_LINE_ADDR   AS ADD_SHIP_TO_FIRST_LINE_ADDR
         ,CPO.ADD_SHIP_TO_SCD_LINE_ADDR     AS ADD_SHIP_TO_SCD_LINE_ADDR
         ,CPO.ADD_SHIP_TO_THIRD_LINE_ADDR   AS ADD_SHIP_TO_THIRD_LINE_ADDR
         ,CPO.ADD_SHIP_TO_FRTH_LINE_ADDR    AS ADD_SHIP_TO_FRTH_LINE_ADDR
         ,CPO.ADD_SHIP_TO_CTRY_CD           AS ADD_SHIP_TO_CTRY_CD
         ,CPO.ADD_SHIP_TO_ST_CD             AS ADD_SHIP_TO_ST_CD
         ,CPO.ADD_SHIP_TO_CTY_ADDR          AS ADD_SHIP_TO_CTY_ADDR
         ,CPO.ADD_SHIP_TO_POST_CD           AS ADD_SHIP_TO_POST_CD
         ,CPO.CPO_ORD_NUM                   AS CPO_ORD_NUM
         ,NULL                              AS TRIAL_FINAL_PRPS_CD
         ,SCE.SCE_ORD_TP_CD                 AS SCE_ORD_TP_CD_DB
         ,SCE.TRX_CD                        AS TRX_CD
         ,SCE.TRX_RSN_CD                    AS TRX_RSN_CD
         ,SCE.SER_NUM_TAKE_FLG              AS SER_NUM_TAKE_FLG
         ,SCE.SER_APVL_REQ_FLG              AS SER_APVL_REQ_FLG
         ,WH.WH_CD                          AS WH_CD_WH
         ,WH.LOC_NM                         AS LOC_NM
         ,WH.WH_PK                          AS WH_PK
         ,SHPG.BILL_TO_CUST_CD              AS BILL_TO_CUST_CD
         ,SHPG.SELL_TO_CUST_CD              AS SELL_TO_CUST_CD
         ,PRD.RTL_WH_CD                     AS RTL_WH_CD
         ,PRD.RTL_SWH_CD                    AS RTL_SWH_CD
         ,PRD.INVTY_LOC_CD                  AS INVTY_LOC_CD
         ,PRD.SHIP_FROM_RTL_WH_CD           AS SHIP_FROM_RTL_WH_CD
         ,PRD.SHIP_FROM_RTL_SWH_CD          AS SHIP_FROM_RTL_SWH_CD
         ,PRD.SHIP_FROM_INVTY_LOC_CD        AS SHIP_FROM_INVTY_LOC_CD
         ,PRD.PRCH_REQ_NUM                  AS PRCH_REQ_NUM
         ,PRD.PRCH_REQ_LINE_NUM             AS PRCH_REQ_LINE_NUM
         ,PRD.PRCH_REQ_LINE_SUB_NUM         AS PRCH_REQ_LINE_SUB_NUM
         ,POD.CPO_ORD_NUM                   AS PD_CPO_ORD_NUM
         ,POD.CPO_DTL_LINE_NUM              AS PD_CPO_DTL_LINE_NUM
         ,POD.CPO_DTL_LINE_SUB_NUM          AS PD_CPO_DTL_LINE_SUB_NUM
         ,POD.PO_ORD_NUM                    AS PD_PO_ORD_NUM
         ,MDSE.RCV_SER_TAKE_FLG             AS RCV_SER_TAKE_FLG
         ,PRH.SVC_CONFIG_MSTR_PK            AS SVC_CONFIG_MSTR_PK
         ,PRH.SHIP_FROM_SO_NUM              AS SHIP_FROM_SO_NUM
         <!-- 2018/12/25 QC#29544 ADD START -->
         ,SHPG.CUST_UOM_CD                  AS CUST_UOM_CD
         ,SHPG.AVAL_SO_QTY                  AS AVAL_SO_QTY
         <!-- 2018/12/25 QC#29544 ADD END -->
         ,PRD.CARR_CD
         ,PRD.PRO_NUM
         ,PRD.BOL_NUM
     FROM
          PO_RCV_HDR      PRH
         ,PO_RCV_DTL      PRD
         ,SHPG_PLN        SHPG
         ,CPO             CPO
         ,PO_DTL          POD
         ,SCE_ORD_TP      SCE
         ,WH              WH
         ,MDSE            MDSE
     WHERE
               PRH.PO_RCV_NUM           =  #poRcvNum01#
          AND  PRH.EZCANCELFLAG         =  '0'
          AND  PRH.GLBL_CMPY_CD         =  #glblCmpyCd01#
          AND  PRD.EZCANCELFLAG         =  '0'
          AND  PRH.PO_RCV_NUM           =  PRD.PO_RCV_NUM
          AND  PRH.GLBL_CMPY_CD         =  PRD.GLBL_CMPY_CD
          AND  PRH.PO_RCV_TRX_HDR_NUM   =  POD.PO_ORD_NUM
          AND  POD.EZCANCELFLAG         =  '0'
          AND  PRH.GLBL_CMPY_CD         =  POD.GLBL_CMPY_CD
          AND  PRD.PO_RCV_TRX_LINE_NUM  =  POD.PO_ORD_DTL_LINE_NUM
          AND  PRD.GLBL_CMPY_CD         =  POD.GLBL_CMPY_CD
          AND  SHPG.EZCANCELFLAG        =  '0'
          AND  POD.SHPG_PLN_NUM         =  SHPG.SHPG_PLN_NUM
          AND  POD.GLBL_CMPY_CD         =  SHPG.GLBL_CMPY_CD
          AND  SHPG.TRX_HDR_NUM         =  CPO.CPO_ORD_NUM
          AND  SHPG.GLBL_CMPY_CD        =  CPO.GLBL_CMPY_CD
          AND  CPO.EZCANCELFLAG (+)     =  '0'

          AND  SCE.EZCANCELFLAG (+)     =  '0'
          AND  PRH.GLBL_CMPY_CD         =  SCE.GLBL_CMPY_CD (+)
          AND  PRH.SCE_ORD_TP_CD        =  SCE.SCE_ORD_TP_CD (+)
          AND  SCE.INBD_OTBD_CD (+)     =  #sceInbd01#
          AND  WH.EZCANCELFLAG (+)      =  '0'
          AND  PRD.GLBL_CMPY_CD         =  WH.GLBL_CMPY_CD (+)
          AND  PRD.INVTY_LOC_CD         =  WH.WH_CD (+) 

          AND  PRD.GLBL_CMPY_CD         =  MDSE.GLBL_CMPY_CD
          AND  PRD.MDSE_CD              =  MDSE.MDSE_CD
          AND  MDSE.EZCANCELFLAG        = '0'

     ORDER BY
          PRH.PO_RCV_NUM
         ,PRD.PO_RCV_LINE_NUM
    </statement>

    <statement id="getShipTp" parameterClass="Map">
        SELECT DISTINCT
            OH.CPO_ORD_NUM
           ,CL.CPO_DTL_LINE_NUM
           ,CL.CPO_DTL_LINE_SUB_NUM
           ,H.DS_ORD_TP_CD
           ,L.DS_ORD_LINE_CATG_CD
           ,CASE WHEN MI.INSTL_BASE_CTRL_FLG = 'N'     THEN 'LE'
                 WHEN P.OUT_OF_WH_INVTY_PROC_FLG = 'Y' THEN 'LI'
                                                       ELSE 'LE'
            END AS SHIP_TP
        FROM
            CPO                          OH
           ,CPO_DTL                      CL
           ,DS_ORD_TP_PROC_DFN           H
           ,DS_ORD_LINE_PROC_DFN         L
           ,ORD_PROC_TP                  P
           ,MDSE                         MI
        WHERE
                OH.GLBL_CMPY_CD          = #glblCmpyCd01#
            AND OH.CPO_ORD_NUM           = #cpoOrdNum01#
            AND H.GLBL_CMPY_CD           = OH.GLBL_CMPY_CD
            AND H.DS_ORD_TP_CD           = OH.DS_ORD_TP_CD
            AND H.OUT_OF_WH_NODE_USG_FLG = 'Y'
            AND CL.GLBL_CMPY_CD          = OH.GLBL_CMPY_CD
            AND CL.CPO_ORD_NUM           = OH.CPO_ORD_NUM
            AND MI.GLBL_CMPY_CD          = CL.GLBL_CMPY_CD
            AND MI.MDSE_CD               = CL.MDSE_CD
            AND L.GLBL_CMPY_CD           = CL.GLBL_CMPY_CD
            AND L.DS_ORD_LINE_CATG_CD    = CL.DS_ORD_LINE_CATG_CD
            AND L.DS_ORD_TP_CD           = H.DS_ORD_TP_CD
            AND P.GLBL_CMPY_CD           = L.GLBL_CMPY_CD
            AND P.ORD_PROC_TP_CD         = L.ORD_PROC_TP_CD
            AND OH.EZCANCELFLAG          = '0'
            AND CL.EZCANCELFLAG          = '0'
            AND H.EZCANCELFLAG           = '0'
            AND L.EZCANCELFLAG           = '0'
            AND P.EZCANCELFLAG           = '0'
            AND MI.EZCANCELFLAG          = '0'
        ORDER BY
            H.DS_ORD_TP_CD
           ,L.DS_ORD_LINE_CATG_CD
    </statement>

    <statement id="getShpgPlnNum" parameterClass="Map" resultClass="String">
    SELECT
        SHPG_PLN_NUM
    FROM
       (SELECT 
            SP.SHPG_PLN_NUM
        FROM
            SHPG_PLN SP
        WHERE 1=1
          AND  SP.GLBL_CMPY_CD        = #glblCmpyCd#
          AND  SP.TRX_HDR_NUM         = #trxHdrNum#
          AND  SP.TRX_LINE_NUM        = #trxLineNum#
          AND  SP.TRX_LINE_SUB_NUM    = #trxLineSubNum#
          AND  SP.PO_ORD_NUM          = #poOrdNum#
          AND  SP.SHPG_STS_CD         = #shpgStsCd#
          AND  SP.PO_REQ_FLG          = 'Y'
          AND  SP.SO_CLOSE_FLG        = 'Y'
          AND  SP.EZCANCELFLAG        = '0'
          AND  NOT EXISTS ( SELECT 
                                1
                            FROM
                                SHPG_ORD_DTL SOD
                            WHERE 1=1
                            AND SP.GLBL_CMPY_CD  = SOD.GLBL_CMPY_CD
                            AND SP.SHPG_PLN_NUM  = SOD.SHPG_PLN_NUM
                            AND SOD.EZCANCELFLAG = '0')
          ORDER BY
              SP.ACTL_SHIP_DT
             ,SP.SHPG_PLN_NUM
         )
     WHERE ROWNUM = 1
    </statement>

    <!-- 2018/01/10 QC#18460(SOL#087) T,Hakodate ADD START -->
     <statement id="getTechMeetTruckFlg" parameterClass="Map" resultClass="String">
        SELECT
            1
        FROM
             ( SELECT
                   MAX(DS_CPO_ISTL_INFO_PK) CUR_DS_CPO_ISTL_INFO_PK
                   ,GLBL_CMPY_CD
                   ,CPO_ORD_NUM
               FROM
                   DS_CPO_ISTL_INFO D
               WHERE
                   EZCANCELFLAG = '0'
               GROUP BY
                    GLBL_CMPY_CD
                   ,CPO_ORD_NUM
             ) CUR_REC
            ,DS_CPO_ISTL_INFO DCII
            ,SVC_ISTL_RULE    SIR
        WHERE
            DCII.GLBL_CMPY_CD           = #glblCmpyCd#
        AND DCII.CPO_ORD_NUM            = #trxHdrNum#
        AND DCII.EZCANCELFLAG           = '0'
        AND DCII.GLBL_CMPY_CD           = CUR_REC.GLBL_CMPY_CD
        AND DCII.CPO_ORD_NUM            = CUR_REC.CPO_ORD_NUM
        AND DCII.DS_CPO_ISTL_INFO_PK    = CUR_REC.CUR_DS_CPO_ISTL_INFO_PK
        AND DCII.GLBL_CMPY_CD           = SIR.GLBL_CMPY_CD
        AND DCII.SVC_ISTL_RULE_NUM      = SIR.SVC_ISTL_RULE_NUM
        AND SIR.TECH_MEET_TRUCK_DEF_FLG = #flgOnY#
        AND SIR.EZCANCELFLAG            = '0'
     </statement>
    <!-- 2018/01/10 QC#18460(SOL#087) T,Hakodate ADD END   -->

    <!-- 201/12/28 QC#18460(SOL#087) T,Hakodate ADD START -->
     <statement id="getRequestInstallTime" parameterClass="Map" resultClass="String">
     SELECT
         RQST_ISTL_TM
     FROM
         DS_CPO_ISTL_INFO DCII
     WHERE 1=1 
     AND DCII.CPO_ORD_NUM     = #trxHdrNum#
     AND DCII.GLBL_CMPY_CD    = #glblCmpyCd#
     AND DCII.EZCANCELFLAG    = '0'
     AND ROWNUM = 1
     </statement>
    <!-- 201/12/28 QC#18460(SOL#087) T,Hakodate ADD END   -->

</sqlMap>
