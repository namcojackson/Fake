<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="ZZML0030Query">

	<typeAlias alias="ZZML0030SMsg"		type="business.blap.ZZML0030.ZZML0030SMsg"/>
	<typeAlias alias="ZZML0030_ASMsg"	type="business.blap.ZZML0030.ZZML0030_ASMsg"/>
	<typeAlias alias="ZZML0030_BSMsg"	type="business.blap.ZZML0030.ZZML0030_BSMsg"/>
	<typeAlias alias="ZZML0030_CSMsg"	type="business.blap.ZZML0030.ZZML0030_CSMsg"/>
	
	<!-- Mail Archives Monitor Screen -->
	<statement id="getList" parameterClass="Map" resultMap="result.ZZML0030_ASMsg">
	<!-- 03/03/2020 Mod QC#56127 Start -->
		<isNotNull property="mlUsrAddrTo">
		SELECT
				ROW_NUMBER() OVER(ORDER BY R.EZUPTIME DESC)	AS	ML_NUM
			,	R.ML_SUBJ_TXT
			,	R.ML_SEND_STS_CD
			,	R.XXUPTIME
			,	R.EZUPTIME
			,	R.EZUPTIMEZONE
			,	R.ML_USR_ADDR
			,	R.ML_SEND_PK
			,	R.ML_STS_PK
		FROM
				(SELECT	DISTINCT
						CASE
		</isNotNull>
		<isNull property="mlUsrAddrTo">
				SELECT
						ROW_NUMBER() OVER(ORDER BY T.EZUPTIME DESC)	AS	ML_NUM
					,	CASE
		</isNull>
							WHEN	LENGTH(S.ML_SUBJ_TXT) > 69	THEN	SUBSTR(S.ML_SUBJ_TXT, 1, 66) || '...'
							ELSE										S.ML_SUBJ_TXT
						END						AS	ML_SUBJ_TXT
					,	CASE T.ML_SEND_STS_CD
							WHEN	'SEND'	THEN	'SENT'
							WHEN	'ERROR'	THEN	'PENDING'
							ELSE					T.ML_SEND_STS_CD
						END						AS	ML_SEND_STS_CD
					,	TO_CHAR( TO_TIMESTAMP(T.EZUPTIME, 'yyyymmddhh24missff3'), 'mm/dd/yyyy hh24:mi:ss')
												AS	XXUPTIME
					,	T.EZUPTIME				AS	EZUPTIME
					,	T.EZUPTIMEZONE			AS	EZUPTIMEZONE
					,	CASE
							<isNotNull property="mlUsrAddrTo">
							WHEN	LENGTH(U.ML_USR_ADDR_FROM) > 81	THEN	SUBSTR(U.ML_USR_ADDR_FROM, 1, 78) || '...'
							ELSE										U.ML_USR_ADDR_FROM
							</isNotNull>
							<isNull property="mlUsrAddrTo">
							WHEN	LENGTH(U.ML_USR_ADDR) > 81	THEN	SUBSTR(U.ML_USR_ADDR, 1, 78) || '...'
							ELSE										U.ML_USR_ADDR
							</isNull>
						END						AS	ML_USR_ADDR
					,	U.ML_SEND_PK			AS	ML_SEND_PK
					,	U.ML_STS_PK				AS	ML_STS_PK
				FROM
						ML_STS T
					,	ML_SEND S
					,	(SELECT
								U1.ML_STS_PK
							,	U1.ML_SEND_PK
							,	U1.ML_EVENT_PK
							,	U1.ML_USR_ADDR
							<isNotNull property="mlUsrAddrTo">
							,	U2.ML_USR_ADDR	AS ML_USR_ADDR_FROM
							</isNotNull>
							,	U1.ML_ADDR_TP_CD
						 FROM
						 		ML_USR U1
							<isNotNull property="mlUsrAddrTo">
							,	ML_USR U2
							</isNotNull>
						 WHERE
							<isNotNull property="mlUsrAddrTo">
								U2.ML_ADDR_TP_CD = 'FROM'
							AND	U1.ML_STS_PK = U2.ML_STS_PK
							AND	U1.ML_SEND_PK = U2.ML_SEND_PK
							AND	U1.ML_EVENT_PK = U2.ML_EVENT_PK
							AND	U1.GLBL_CMPY_CD  = #cMsg.glblCmpyCd#
							AND	U2.GLBL_CMPY_CD  = #cMsg.glblCmpyCd#
							AND	U1.EZCANCELFLAG  = '0'
							AND	U2.EZCANCELFLAG  = '0'
							</isNotNull>
							<isNull property="mlUsrAddrTo">
								U1.ML_ADDR_TP_CD = 'FROM'
							AND	U1.GLBL_CMPY_CD  = #cMsg.glblCmpyCd#
							AND	U1.EZCANCELFLAG  = '0'
							</isNull>
						 ORDER BY
							U1.EZUPTIME DESC) U
					,	ML_EVENT E
				WHERE
						T.ML_STS_PK = U.ML_STS_PK
					AND	S.ML_SEND_PK = U.ML_SEND_PK
					AND	U.ML_EVENT_PK = E.ML_EVENT_PK
				 	AND	T.GLBL_CMPY_CD = #cMsg.glblCmpyCd#
					AND	S.GLBL_CMPY_CD = #cMsg.glblCmpyCd#
					AND	E.GLBL_CMPY_CD = #cMsg.glblCmpyCd#
					AND	T.EZCANCELFLAG = '0'
					AND	S.EZCANCELFLAG = '0'
					AND	E.EZCANCELFLAG = '0'
						
				<!-- Status -->
				<isNotNull property="cMsg.mlSendStsCd_H">
					AND T.ML_SEND_STS_CD = #cMsg.mlSendStsCd_H#
				</isNotNull>
				
				<!-- Subject -->
				<isNotNull property="mlSubjTxt">
					AND S.ML_SUBJ_TXT LIKE #mlSubjTxt#
				</isNotNull>
				
				<!-- Mail Address -->
				<isNotNull property="mlUsrAddr">
					<isNotNull property="mlUsrAddrTo">
						<isNotNull property="cMsg.mlAddrTpCd_T">
							AND U.ML_USR_ADDR_FROM LIKE #mlUsrAddr#
							AND	U.ML_USR_ADDR LIKE #mlUsrAddrTo#
							AND	U.ML_ADDR_TP_CD = #cMsg.mlAddrTpCd_T#
						</isNotNull>
						<isNull property="cMsg.mlAddrTpCd_T">
							AND	U.ML_USR_ADDR_FROM LIKE #mlUsrAddr#
							AND	U.ML_USR_ADDR LIKE #mlUsrAddrTo#
							AND	(	U.ML_ADDR_TP_CD = 'TO'
								OR	U.ML_ADDR_TP_CD = 'CC'
								OR	U.ML_ADDR_TP_CD = 'BCC')
						</isNull>
					</isNotNull>
					<isNull property="mlUsrAddrTo">
						AND	U.ML_USR_ADDR LIKE #mlUsrAddr#
					</isNull>
				</isNotNull>
				<isNull property="mlUsrAddr">
					<isNotNull property="mlUsrAddrTo">
						<isNotNull property="cMsg.mlAddrTpCd_T">
							AND U.ML_USR_ADDR LIKE #mlUsrAddrTo#
							AND	U.ML_ADDR_TP_CD = #cMsg.mlAddrTpCd_T#
						</isNotNull>
						<isNull property="cMsg.mlAddrTpCd_T">
							AND	U.ML_USR_ADDR LIKE #mlUsrAddrTo#
							AND	(	U.ML_ADDR_TP_CD = 'TO'
								OR	U.ML_ADDR_TP_CD = 'CC'
								OR	U.ML_ADDR_TP_CD = 'BCC')
						</isNull>
					</isNotNull>
				</isNull>
		
				<!-- Mail Send Date From -->
				<isNotNull property="updatedDateFrom">
					AND T.EZUPTIME &gt;= #updatedDateFrom#
				</isNotNull>
					
				<!-- Mail Send Date To -->
				<isNotNull property="updatedDateTo">
					AND T.EZUPTIME &lt;= #updatedDateTo#
				</isNotNull>
		
				<!-- Mail Send Time From -->
				<isNotNull property="updatedTimeFrom">
					AND SUBSTR(T.EZUPTIME, 9, 6) &gt;= #updatedTimeFrom#
				</isNotNull>
					
				<!-- Mail Send Time To -->
				<isNotNull property="updatedTimeTo">
					AND SUBSTR(T.EZUPTIME, 9, 6) &lt;= #updatedTimeTo#
				</isNotNull>
					AND ROWNUM &lt;= 1001
		<isNotNull property="mlUsrAddrTo">
				) R
		</isNotNull>
	<!-- 03/03/2020 Mod QC#56127 End -->
	</statement>

	<!-- Mail Archives Monitor Detail Screen (Address) -->
	<statement id="getMlUsr" parameterClass="Map" resultMap="result.ZZML0030_BSMsg">
		SELECT
				row_number() over(order by U.ML_USR_PK)	AS	ML_NUM
			,	U.ML_ADDR_TP_CD			AS	ML_ADDR_TP_CD
			,	U.ML_USR_ADDR			AS	ML_USR_ADDR
			,	U.ML_USR_NM				AS	ML_USR_NM
			,	U.ML_USR_ID				AS	ML_USR_ID
		FROM
				ML_USR U
		WHERE
				U.GLBL_CMPY_CD  = #glblCmpyCd#
			AND U.EZCANCELFLAG  = '0'
			AND	U.ML_SEND_PK = #mlSendPk#
			AND	U.ML_STS_PK = #mlStsPk#
	</statement>

	<!-- Mail Archives Monitor Detail Screen (Attachment) -->
	<statement id="getMlAtt" parameterClass="Map" resultMap="result.ZZML0030_CSMsg">
		SELECT
				row_number() over(order by A.ML_ATT_PK)	AS	ML_NUM
			,	A.ML_ATT_NM			AS	ML_ATT_NM
		FROM
				ML_SEND S ,
				ML_ATT_REF R,
				ML_ATT A
		WHERE
				S.GLBL_CMPY_CD  = R.GLBL_CMPY_CD
			AND	S.ML_SEND_PK = R.ML_SEND_PK
			AND R.GLBL_CMPY_CD = A.GLBL_CMPY_CD
			AND R.ML_ATT_PK = A.ML_ATT_PK
			AND S.EZCANCELFLAG  = '0'
			AND R.EZCANCELFLAG  = '0'
			AND A.EZCANCELFLAG  = '0'
			AND S.GLBL_CMPY_CD  = #glblCmpyCd#
			AND S.ML_SEND_PK = #mlSendPk#
	</statement>

	<!-- Mail Archives Monitor Detail Screen (Mail Subject/Body) -->
	<statement id="getMlSend" parameterClass="Map" resultMap="result">
		SELECT
				S.GLBL_CMPY_CD			AS	GLBL_CMPY_CD
			,	S.ML_SUBJ_TXT			AS	ML_SUBJ_TXT
		FROM
				ML_SEND S
		WHERE
				S.GLBL_CMPY_CD  = #glblCmpyCd#
			AND S.EZCANCELFLAG  = '0'
			AND	S.ML_SEND_PK = #mlSendPk#
	</statement>
	
	<!-- select ML_BODY_TXT -->
	<statement id="selMlBody" parameterClass="Map" resultClass="Map">
		SELECT
				DBMS_LOB.GETCHUNKSIZE(ML_BODY_TXT) AS CHUNK_SIZE
			,	ML_BODY_TXT
		FROM
				ML_SEND
		WHERE
				GLBL_CMPY_CD  = #glblCmpyCd#
			AND EZCANCELFLAG  = '0'
			AND	ML_SEND_PK = #mlSendPk#
    </statement>
	
	<resultMap id="result" 						class="ZZML0030SMsg">
		<result property="glblCmpyCd_01"		column="GLBL_CMPY_CD"		javaType="EZDSStringItem"/>
		<result property="mlSubjTxt_01"			column="ML_SUBJ_TXT"		javaType="EZDSStringItem"/>
		<!-- <result property="xxMlBodyTxt_01"		column="ML_BODY_TXT"		javaType="EZDSStringItem"/> -->
	</resultMap>

	<resultMap id="result.ZZML0030_ASMsg" 		class="ZZML0030_ASMsg">
		<result property="xxNum_A"				column="ML_NUM"				javaType="EZDSBigDecimalItem"/>
		<result property="mlSubjTxt_A"			column="ML_SUBJ_TXT"		javaType="EZDSStringItem"/>
		<result property="xxScrItem7Txt_A"		column="ML_SEND_STS_CD"		javaType="EZDSStringItem"/>
		<result property="xxDtTm_A"				column="XXUPTIME"			javaType="EZDSStringItem"/>
		<result property="ezUpTime_A"			column="EZUPTIME"			javaType="EZDSStringItem"/>
		<result property="ezUpTimeZone_A"		column="EZUPTIMEZONE"		javaType="EZDSStringItem"/>
		<result property="mlUsrAddr_A"			column="ML_USR_ADDR"		javaType="EZDSStringItem"/>
		<result property="mlSendPk_A"			column="ML_SEND_PK"			javaType="EZDSBigDecimalItem"/>
		<result property="mlStsPk_A"			column="ML_STS_PK"			javaType="EZDSBigDecimalItem"/>
	</resultMap>

	<resultMap id="result.ZZML0030_BSMsg" 		class="ZZML0030_BSMsg">
		<result property="xxNum_B"				column="ML_NUM"				javaType="EZDSBigDecimalItem"/>
		<result property="mlAddrTpCd_B"			column="ML_ADDR_TP_CD"		javaType="EZDSStringItem"/>
		<result property="mlUsrAddr_B"			column="ML_USR_ADDR"		javaType="EZDSStringItem"/>
		<result property="mlUsrNm_B"			column="ML_USR_NM"			javaType="EZDSStringItem"/>
		<result property="mlUsrId_B"			column="ML_USR_ID"			javaType="EZDSStringItem"/>
	</resultMap>

	<resultMap id="result.ZZML0030_CSMsg" 		class="ZZML0030_CSMsg">
		<result property="xxNum_C"				column="ML_NUM"				javaType="EZDSBigDecimalItem"/>
		<result property="mlAttNm_C"			column="ML_ATT_NM"			javaType="EZDSStringItem"/>
	</resultMap>

</sqlMap>