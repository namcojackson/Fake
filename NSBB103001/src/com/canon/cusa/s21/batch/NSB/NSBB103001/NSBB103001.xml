<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSBB103001">
    <statement id="getLastUpdateTs" parameterClass="Map" resultClass="Map">
        SELECT
            DS_BIZ_PROC_LOG_PK
           ,DS_BIZ_LAST_UPD_TS
        FROM
            DS_BIZ_PROC_LOG DBPL
        WHERE 1=1
            AND GLBL_CMPY_CD       = #glblCmpyCd#
            AND DBPL.PROC_PGM_ID   = #procPgmId#
            AND DBPL.EZCANCELFLAG  = '0'
        ORDER BY 
            DS_BIZ_PROC_TRX_NUM
           ,DS_BIZ_PROC_TRX_DTL_NUM
           ,DS_BIZ_PROC_TRX_SUB_DTL_NUM
    </statement>
    <statement id="getTargetData" parameterClass="Map" resultClass="Map">
        SELECT
             RH.TRX_ORD_NUM       AS RMA_NUM
            ,SMM.SVC_MACH_MSTR_PK AS SVC_MACH_MSTR_PK
        FROM
             RWS_HDR          RH
            ,DS_CPO_CONFIG    DCC
            ,DS_CPO_RTRN_DTL  DCRD
            ,SVC_MACH_MSTR    SMM
            ,SVC_CONFIG_MSTR  SCM
            ,DS_MDL           DM
            ,SVC_ISTL_RULE    SIR
            ,DS_CPO_ISTL_INFO DCII1
            ,SVC_ISTL_RULE    SIR1
            ,DS_CPO_ISTL_INFO DCII2
            ,SVC_ISTL_RULE    SIR2
        WHERE
                RH.GLBL_CMPY_CD               = #glblCmpyCd#
            AND RH.DNLD_DT_TM_TS              BETWEEN #dsBizLastUpdTs# AND #sysTimeStamp#
            AND RH.EZCANCELFLAG               = '0'
            AND RH.GLBL_CMPY_CD               = DCC.GLBL_CMPY_CD
            AND RH.DS_CPO_CONFIG_PK           = DCC.DS_CPO_CONFIG_PK
            AND DCC.EZCANCELFLAG              = '0'
            AND DCC.GLBL_CMPY_CD              = DCRD.GLBL_CMPY_CD
            AND DCC.DS_CPO_CONFIG_PK          = DCRD.DS_CPO_CONFIG_PK
            AND DCRD.EZCANCELFLAG             = '0'
            AND DCRD.GLBL_CMPY_CD             = SMM.GLBL_CMPY_CD
            AND DCRD.CPO_ORD_NUM              = SMM.TRX_HDR_NUM
            AND DCRD.DS_CPO_RTRN_LINE_NUM     = SMM.TRX_LINE_NUM
            AND DCRD.DS_CPO_RTRN_LINE_SUB_NUM = SMM.TRX_LINE_SUB_NUM
            AND SMM.SVC_MACH_MSTR_STS_CD      = #svcMachMstrSts#
            AND SMM.SVC_MACH_TP_CD            = #svcMachTpCd#
            AND SMM.EZCANCELFLAG              = '0'
            AND SMM.GLBL_CMPY_CD              = SCM.GLBL_CMPY_CD
            AND SMM.SVC_CONFIG_MSTR_PK        = SCM.SVC_CONFIG_MSTR_PK
            AND SCM.EZCANCELFLAG              = '0'
            AND SCM.GLBL_CMPY_CD              = DM.GLBL_CMPY_CD(+)
            AND SCM.MDL_ID                    = DM.MDL_ID(+)
            AND DM.SVC_DEINS_CALL_GRP_NUM(+)  IS NOT NULL
            AND DM.EZCANCELFLAG(+)            = '0'
            AND DM.GLBL_CMPY_CD               = SIR.GLBL_CMPY_CD(+)
            AND DM.SVC_DEINS_RULE_NUM         = SIR.SVC_ISTL_RULE_NUM(+)
            AND SIR.EZCANCELFLAG(+)           = '0'
            AND DCC.GLBL_CMPY_CD              = DCII1.GLBL_CMPY_CD(+)
            AND DCC.DS_CPO_CONFIG_PK          = DCII1.DS_CPO_CONFIG_PK(+)
            AND DCII1.EZCANCELFLAG(+)         = '0'
            AND DCII1.GLBL_CMPY_CD            = SIR1.GLBL_CMPY_CD(+)
            AND DCII1.SVC_ISTL_RULE_NUM       = SIR1.SVC_ISTL_RULE_NUM(+)
            AND SIR1.EZCANCELFLAG(+)          = '0'
            AND RH.GLBL_CMPY_CD               = DCII2.GLBL_CMPY_CD(+)
            AND RH.TRX_ORD_NUM                = DCII2.CPO_ORD_NUM(+)
            AND DCII2.DS_CPO_CONFIG_PK(+)     IS NULL
            AND DCII2.EZCANCELFLAG(+)         = '0'
            AND DCII2.GLBL_CMPY_CD            = SIR2.GLBL_CMPY_CD(+)
            AND DCII2.SVC_ISTL_RULE_NUM       = SIR2.SVC_ISTL_RULE_NUM(+)
            AND SIR2.EZCANCELFLAG(+)          = '0'
            AND NVL(SIR2.AUTO_DEINS_CALL_FLG, NVL(SIR1.AUTO_DEINS_CALL_FLG, SIR.AUTO_DEINS_CALL_FLG)) = 'Y'
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                    SVC_TASK  ST
                WHERE
                        ST.GLBL_CMPY_CD     = RH.GLBL_CMPY_CD
                    AND ST.RMA_NUM          = RH.TRX_ORD_NUM
                    AND ST.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                    AND ST.EZCANCELFLAG     = '0'
            )
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                    SVC_DEINS_CALL_MACH_INFO   SDCM
                WHERE
                        SDCM.GLBL_CMPY_CD     = RH.GLBL_CMPY_CD
                    AND SDCM.RMA_NUM          = RH.TRX_ORD_NUM
                    AND SDCM.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                    AND SDCM.EZCANCELFLAG     = '0'
            )
        UNION ALL
        SELECT
             RH.TRX_ORD_NUM        AS RMA_NUM
            ,SMM2.SVC_MACH_MSTR_PK AS SVC_MACH_MSTR_PK
        FROM
             RWS_HDR          RH
            ,DS_CPO_CONFIG    DCC
            ,DS_CPO_RTRN_DTL  DCRD
            ,SVC_MACH_MSTR    SMM1
            ,SVC_CONFIG_MSTR  SCM
            ,SVC_MACH_MSTR    SMM2
            ,MDSE             MDSE
            ,SVC_ISTL_RULE    SIR
            ,DS_CPO_ISTL_INFO DCII1
            ,SVC_ISTL_RULE    SIR1
            ,DS_CPO_ISTL_INFO DCII2
            ,SVC_ISTL_RULE    SIR2
        WHERE
                RH.GLBL_CMPY_CD                = #glblCmpyCd#
            AND RH.DNLD_DT_TM_TS               BETWEEN #dsBizLastUpdTs# AND #sysTimeStamp#
            AND RH.EZCANCELFLAG                = '0'
            AND RH.GLBL_CMPY_CD                = DCC.GLBL_CMPY_CD
            AND RH.DS_CPO_CONFIG_PK            = DCC.DS_CPO_CONFIG_PK
            AND DCC.EZCANCELFLAG               = '0'
            AND DCC.GLBL_CMPY_CD               = DCRD.GLBL_CMPY_CD
            AND DCC.DS_CPO_CONFIG_PK           = DCRD.DS_CPO_CONFIG_PK
            AND DCRD.EZCANCELFLAG              = '0'
            AND DCRD.GLBL_CMPY_CD              = SMM1.GLBL_CMPY_CD
            AND DCRD.CPO_ORD_NUM               = SMM1.TRX_HDR_NUM
            AND DCRD.DS_CPO_RTRN_LINE_NUM      = SMM1.TRX_LINE_NUM
            AND DCRD.DS_CPO_RTRN_LINE_SUB_NUM  = SMM1.TRX_LINE_SUB_NUM
            AND SMM1.SVC_MACH_MSTR_STS_CD      = #svcMachMstrSts#
            AND SMM1.SVC_MACH_TP_CD            = #svcMachTpCdAcc#
            AND SMM1.EZCANCELFLAG              = '0'
            AND SMM1.GLBL_CMPY_CD              = SCM.GLBL_CMPY_CD
            AND SMM1.SVC_CONFIG_MSTR_PK        = SCM.SVC_CONFIG_MSTR_PK
            AND SCM.EZCANCELFLAG               = '0'
            AND SCM.GLBL_CMPY_CD               = SMM2.GLBL_CMPY_CD
            AND SCM.SVC_MACH_MSTR_PK           = SMM2.SVC_MACH_MSTR_PK
            AND SMM2.EZCANCELFLAG              = '0'
            AND SMM1.GLBL_CMPY_CD              = MDSE.GLBL_CMPY_CD(+)
            AND SMM1.MDSE_CD                   = MDSE.MDSE_CD(+)
            AND MDSE.SVC_DEINS_CALL_GRP_NUM(+) IS NOT NULL
            AND MDSE.EZCANCELFLAG(+)           = '0'
            AND MDSE.GLBL_CMPY_CD              = SIR.GLBL_CMPY_CD(+)
            AND MDSE.SVC_DEINS_RULE_NUM        = SIR.SVC_ISTL_RULE_NUM(+)
            AND SIR.EZCANCELFLAG(+)            = '0'
            AND DCC.GLBL_CMPY_CD               = DCII1.GLBL_CMPY_CD(+)
            AND DCC.DS_CPO_CONFIG_PK           = DCII1.DS_CPO_CONFIG_PK(+)
            AND DCII1.EZCANCELFLAG(+)          = '0'
            AND DCII1.GLBL_CMPY_CD             = SIR1.GLBL_CMPY_CD(+)
            AND DCII1.SVC_ISTL_RULE_NUM        = SIR1.SVC_ISTL_RULE_NUM(+)
            AND SIR1.EZCANCELFLAG(+)           = '0'
            AND RH.GLBL_CMPY_CD                = DCII2.GLBL_CMPY_CD(+)
            AND RH.TRX_ORD_NUM                 = DCII2.CPO_ORD_NUM(+)
            AND DCII2.DS_CPO_CONFIG_PK(+)      IS NULL
            AND DCII2.EZCANCELFLAG(+)          = '0'
            AND DCII2.GLBL_CMPY_CD             = SIR2.GLBL_CMPY_CD(+)
            AND DCII2.SVC_ISTL_RULE_NUM        = SIR2.SVC_ISTL_RULE_NUM(+)
            AND SIR2.EZCANCELFLAG(+)           = '0'
            AND NVL(SIR2.AUTO_DEINS_CALL_FLG, NVL(SIR1.AUTO_DEINS_CALL_FLG, SIR.AUTO_DEINS_CALL_FLG)) = 'Y'
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                    SVC_TASK  ST
                WHERE
                        ST.GLBL_CMPY_CD     = RH.GLBL_CMPY_CD
                    AND ST.RMA_NUM          = RH.TRX_ORD_NUM
                    AND ST.SVC_MACH_MSTR_PK = SMM2.SVC_MACH_MSTR_PK
                    AND ST.EZCANCELFLAG     = '0'
            )
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                    SVC_DEINS_CALL_MACH_INFO  SDCM
                WHERE
                    SDCM.GLBL_CMPY_CD     = RH.GLBL_CMPY_CD
                AND SDCM.RMA_NUM          = RH.TRX_ORD_NUM
                AND SDCM.SVC_MACH_MSTR_PK = SMM2.SVC_MACH_MSTR_PK
                AND SDCM.EZCANCELFLAG     = '0'
            )
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                    DS_CPO_RTRN_DTL  DCRDX
                WHERE
                    DCRDX.GLBL_CMPY_CD     = DCC.GLBL_CMPY_CD
                AND DCRDX.DS_CPO_CONFIG_PK = DCC.DS_CPO_CONFIG_PK
                AND DCRDX.BASE_CMPT_FLG    = #baseCmptFlg#
                AND DCRDX.EZCANCELFLAG     = '0'
            )
        ORDER BY
             RMA_NUM
            ,SVC_MACH_MSTR_PK
    </statement>

    <statement id="getSvcDeinstallCallMachineInfo" parameterClass="Map" resultClass="Map">
        SELECT
             SDCM.RMA_NUM                  AS RMA_NUM
            ,DCRD.GLBL_CMPY_CD             AS CPO_CTAC_GLBL_CMPY_CD
            ,DCRD.CPO_ORD_NUM              AS CPO_CTAC_ORD_NUM
            ,DCRD.DS_CPO_CONFIG_PK         AS CPO_CTAC_CONFIG_PK
            ,DCRD.DS_CPO_RTRN_LINE_NUM     AS CPO_CTAC_DTL_RTRN_LINE_NUM
            ,DCRD.DS_CPO_RTRN_LINE_SUB_NUM AS CPO_CTAC_DTL_RTRN_LINE_SUB_NUM
            ,DCRD.CUST_ISS_PO_NUM          AS CUST_ISS_PO_NUM
            ,DCRD.CUST_PO_DT               AS CUST_PO_DT
            ,SMM.SVC_MACH_MSTR_PK          AS SVC_MACH_MSTR_PK
            ,SMM.CUST_MACH_CTRL_NUM        AS CUST_MACH_CTRL_NUM
            ,SMM.SER_NUM                   AS SER_NUM
            ,SMM.BILL_TO_ACCT_NUM          AS BILL_TO_ACCT_NUM
            ,DM.SVC_DEINS_CALL_GRP_NUM     AS SVC_DEINS_CALL_GRP_NUM
            ,DCII1.ISTL_ADDL_CMNT_TXT      AS ISTL_ADDL_CMNT_TXT1
            ,DCII1.ISTL_TECH_CD            AS ISTL_TECH_CD1
            ,DCII1.EZUPUSERID              AS EZUPUSERID1
            ,DCII2.ISTL_ADDL_CMNT_TXT      AS ISTL_ADDL_CMNT_TXT2
            ,DCII2.ISTL_TECH_CD            AS ISTL_TECH_CD2
            ,DCII2.EZUPUSERID              AS EZUPUSERID2
            ,DCRD.EZUPUSERID               AS DCRD_EZUPUSERID
            ,SMM.MDSE_CD                   AS MACH_MDSE_CD
            ,'N'                           AS ADD_ASRY_FLG
        FROM
             RWS_HDR                  RH
            ,SVC_DEINS_CALL_MACH_INFO SDCM
            ,DS_CPO_CONFIG            DCC
            ,DS_CPO_RTRN_DTL          DCRD
            ,SVC_MACH_MSTR            SMM
            ,SVC_CONFIG_MSTR          SCM
            ,DS_MDL                   DM
            ,SVC_ISTL_RULE            SIR
            ,DS_CPO_ISTL_INFO         DCII1
            ,SVC_ISTL_RULE            SIR1
            ,DS_CPO_ISTL_INFO         DCII2
            ,SVC_ISTL_RULE            SIR2
        WHERE
                RH.GLBL_CMPY_CD               = #glblCmpyCd#
            AND RH.EZCANCELFLAG               = '0'
            AND RH.GLBL_CMPY_CD               = SDCM.GLBL_CMPY_CD
            AND RH.TRX_ORD_NUM                = SDCM.RMA_NUM
            AND SDCM.EZCANCELFLAG             = '0'
            AND RH.GLBL_CMPY_CD               = DCC.GLBL_CMPY_CD
            AND RH.DS_CPO_CONFIG_PK           = DCC.DS_CPO_CONFIG_PK
            AND DCC.EZCANCELFLAG              = '0'
            AND DCC.GLBL_CMPY_CD              = DCRD.GLBL_CMPY_CD
            AND DCC.DS_CPO_CONFIG_PK          = DCRD.DS_CPO_CONFIG_PK
            AND DCRD.EZCANCELFLAG             = '0'
            AND DCRD.GLBL_CMPY_CD             = SMM.GLBL_CMPY_CD
            AND DCRD.CPO_ORD_NUM              = SMM.TRX_HDR_NUM
            AND DCRD.DS_CPO_RTRN_LINE_NUM     = SMM.TRX_LINE_NUM
            AND DCRD.DS_CPO_RTRN_LINE_SUB_NUM = SMM.TRX_LINE_SUB_NUM
            AND SMM.SVC_MACH_MSTR_STS_CD      = #svcMachMstrSts#
            AND SMM.SVC_MACH_TP_CD            = #svcMachTpCd#
            AND SMM.EZCANCELFLAG              = '0'
            AND SMM.GLBL_CMPY_CD              = SDCM.GLBL_CMPY_CD
            AND SMM.SVC_MACH_MSTR_PK          = SDCM.SVC_MACH_MSTR_PK
            AND SMM.GLBL_CMPY_CD              = SCM.GLBL_CMPY_CD
            AND SMM.SVC_CONFIG_MSTR_PK        = SCM.SVC_CONFIG_MSTR_PK
            AND SCM.EZCANCELFLAG              = '0'
            AND SCM.GLBL_CMPY_CD              = DM.GLBL_CMPY_CD(+)
            AND SCM.MDL_ID                    = DM.MDL_ID(+)
            AND DM.SVC_DEINS_CALL_GRP_NUM(+)  IS NOT NULL
            AND DM.EZCANCELFLAG(+)            = '0'
            AND DM.GLBL_CMPY_CD               = SIR.GLBL_CMPY_CD(+)
            AND DM.SVC_DEINS_RULE_NUM         = SIR.SVC_ISTL_RULE_NUM(+)
            AND SIR.EZCANCELFLAG(+)           = '0'
            AND DCC.GLBL_CMPY_CD              = DCII1.GLBL_CMPY_CD(+)
            AND DCC.DS_CPO_CONFIG_PK          = DCII1.DS_CPO_CONFIG_PK(+)
            AND DCII1.EZCANCELFLAG(+)         = '0'
            AND DCII1.GLBL_CMPY_CD            = SIR1.GLBL_CMPY_CD(+)
            AND DCII1.SVC_ISTL_RULE_NUM       = SIR1.SVC_ISTL_RULE_NUM(+)
            AND SIR1.EZCANCELFLAG(+)          = '0'
            AND RH.GLBL_CMPY_CD               = DCII2.GLBL_CMPY_CD(+)
            AND RH.TRX_ORD_NUM                = DCII2.CPO_ORD_NUM(+)
            AND DCII2.DS_CPO_CONFIG_PK(+)     IS NULL
            AND DCII2.EZCANCELFLAG(+)         = '0'
            AND DCII2.GLBL_CMPY_CD            = SIR2.GLBL_CMPY_CD(+)
            AND DCII2.SVC_ISTL_RULE_NUM       = SIR2.SVC_ISTL_RULE_NUM(+)
            AND SIR2.EZCANCELFLAG(+)          = '0'
            AND NVL(SIR2.AUTO_DEINS_CALL_FLG, NVL(SIR1.AUTO_DEINS_CALL_FLG, SIR.AUTO_DEINS_CALL_FLG)) = 'Y'
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                    SVC_TASK  ST
                WHERE
                        ST.GLBL_CMPY_CD     = RH.GLBL_CMPY_CD
                    AND ST.RMA_NUM          = RH.TRX_ORD_NUM
                    AND ST.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                    AND ST.EZCANCELFLAG     = '0'
            )
        UNION ALL
        SELECT
             SDCM.RMA_NUM                  AS RMA_NUM
            ,DCRD.GLBL_CMPY_CD             AS CPO_CTAC_GLBL_CMPY_CD
            ,DCRD.CPO_ORD_NUM              AS CPO_CTAC_ORD_NUM
            ,DCRD.DS_CPO_CONFIG_PK         AS CPO_CTAC_CONFIG_PK
            ,DCRD.DS_CPO_RTRN_LINE_NUM     AS CPO_CTAC_DTL_RTRN_LINE_NUM
            ,DCRD.DS_CPO_RTRN_LINE_SUB_NUM AS CPO_CTAC_DTL_RTRN_LINE_SUB_NUM
            ,DCRD.CUST_ISS_PO_NUM          AS CUST_ISS_PO_NUM
            ,DCRD.CUST_PO_DT               AS CUST_PO_DT
            ,SMM2.SVC_MACH_MSTR_PK         AS SVC_MACH_MSTR_PK
            ,SMM2.CUST_MACH_CTRL_NUM       AS CUST_MACH_CTRL_NUM
            ,SMM2.SER_NUM                  AS SER_NUM
            ,SMM2.BILL_TO_ACCT_NUM         AS BILL_TO_ACCT_NUM
            ,MDSE.SVC_DEINS_CALL_GRP_NUM   AS SVC_DEINS_CALL_GRP_NUM
            ,DCII1.ISTL_ADDL_CMNT_TXT      AS ISTL_ADDL_CMNT_TXT1
            ,DCII1.ISTL_TECH_CD            AS ISTL_TECH_CD1
            ,DCII1.EZUPUSERID              AS EZUPUSERID1
            ,DCII2.ISTL_ADDL_CMNT_TXT      AS ISTL_ADDL_CMNT_TXT2
            ,DCII2.ISTL_TECH_CD            AS ISTL_TECH_CD2
            ,DCII2.EZUPUSERID              AS EZUPUSERID2
            ,DCRD.EZUPUSERID               AS DCRD_EZUPUSERID
            ,SMM2.MDSE_CD                  AS MACH_MDSE_CD
            ,'Y'                           AS ADD_ASRY_FLG
        FROM
             RWS_HDR                  RH
            ,SVC_DEINS_CALL_MACH_INFO SDCM
            ,DS_CPO_CONFIG            DCC
            ,DS_CPO_RTRN_DTL          DCRD
            ,SVC_MACH_MSTR            SMM1
            ,SVC_CONFIG_MSTR          SCM
            ,SVC_MACH_MSTR            SMM2
            ,MDSE                     MDSE
            ,SVC_ISTL_RULE            SIR
            ,DS_CPO_ISTL_INFO         DCII1
            ,SVC_ISTL_RULE            SIR1
            ,DS_CPO_ISTL_INFO         DCII2
            ,SVC_ISTL_RULE            SIR2
        WHERE
                RH.GLBL_CMPY_CD                = #glblCmpyCd#
            AND RH.EZCANCELFLAG                = '0'
            AND RH.GLBL_CMPY_CD                = SDCM.GLBL_CMPY_CD
            AND RH.TRX_ORD_NUM                 = SDCM.RMA_NUM
            AND SDCM.EZCANCELFLAG             = '0'
            AND RH.GLBL_CMPY_CD                = DCC.GLBL_CMPY_CD
            AND RH.DS_CPO_CONFIG_PK            = DCC.DS_CPO_CONFIG_PK
            AND DCC.EZCANCELFLAG               = '0'
            AND DCC.GLBL_CMPY_CD               = DCRD.GLBL_CMPY_CD
            AND DCC.DS_CPO_CONFIG_PK           = DCRD.DS_CPO_CONFIG_PK
            AND DCRD.EZCANCELFLAG              = '0'
            AND DCRD.GLBL_CMPY_CD              = SMM1.GLBL_CMPY_CD
            AND DCRD.CPO_ORD_NUM               = SMM1.TRX_HDR_NUM
            AND DCRD.DS_CPO_RTRN_LINE_NUM      = SMM1.TRX_LINE_NUM
            AND DCRD.DS_CPO_RTRN_LINE_SUB_NUM  = SMM1.TRX_LINE_SUB_NUM
            AND SMM1.SVC_MACH_MSTR_STS_CD      = #svcMachMstrSts#
            AND SMM1.SVC_MACH_TP_CD            = #svcMachTpCdAcc#
            AND SMM1.EZCANCELFLAG              = '0'
            AND SMM1.GLBL_CMPY_CD              = SCM.GLBL_CMPY_CD
            AND SMM1.SVC_CONFIG_MSTR_PK        = SCM.SVC_CONFIG_MSTR_PK
            AND SCM.EZCANCELFLAG               = '0'
            AND SCM.GLBL_CMPY_CD               = SMM2.GLBL_CMPY_CD
            AND SCM.SVC_MACH_MSTR_PK           = SMM2.SVC_MACH_MSTR_PK
            AND SMM2.EZCANCELFLAG              = '0'
            AND SMM2.GLBL_CMPY_CD              = SDCM.GLBL_CMPY_CD
            AND SMM2.SVC_MACH_MSTR_PK          = SDCM.SVC_MACH_MSTR_PK
            AND SMM1.GLBL_CMPY_CD              = MDSE.GLBL_CMPY_CD(+)
            AND SMM1.MDSE_CD                   = MDSE.MDSE_CD(+)
            AND MDSE.SVC_DEINS_CALL_GRP_NUM(+) IS NOT NULL
            AND MDSE.EZCANCELFLAG(+)           = '0'
            AND MDSE.GLBL_CMPY_CD              = SIR.GLBL_CMPY_CD(+)
            AND MDSE.SVC_DEINS_RULE_NUM        = SIR.SVC_ISTL_RULE_NUM(+)
            AND SIR.EZCANCELFLAG(+)            = '0'
            AND DCC.GLBL_CMPY_CD               = DCII1.GLBL_CMPY_CD(+)
            AND DCC.DS_CPO_CONFIG_PK           = DCII1.DS_CPO_CONFIG_PK(+)
            AND DCII1.EZCANCELFLAG(+)          = '0'
            AND DCII1.GLBL_CMPY_CD             = SIR1.GLBL_CMPY_CD(+)
            AND DCII1.SVC_ISTL_RULE_NUM        = SIR1.SVC_ISTL_RULE_NUM(+)
            AND SIR1.EZCANCELFLAG(+)           = '0'
            AND RH.GLBL_CMPY_CD                = DCII2.GLBL_CMPY_CD(+)
            AND RH.TRX_ORD_NUM                 = DCII2.CPO_ORD_NUM(+)
            AND DCII2.DS_CPO_CONFIG_PK(+)      IS NULL
            AND DCII2.EZCANCELFLAG(+)          = '0'
            AND DCII2.GLBL_CMPY_CD             = SIR2.GLBL_CMPY_CD(+)
            AND DCII2.SVC_ISTL_RULE_NUM        = SIR2.SVC_ISTL_RULE_NUM(+)
            AND SIR2.EZCANCELFLAG(+)           = '0'
            AND NVL(SIR2.AUTO_DEINS_CALL_FLG, NVL(SIR1.AUTO_DEINS_CALL_FLG, SIR.AUTO_DEINS_CALL_FLG)) = 'Y'
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                    SVC_TASK  ST
                WHERE
                        ST.GLBL_CMPY_CD     = RH.GLBL_CMPY_CD
                    AND ST.RMA_NUM          = RH.TRX_ORD_NUM
                    AND ST.SVC_MACH_MSTR_PK = SMM2.SVC_MACH_MSTR_PK
                    AND ST.EZCANCELFLAG     = '0'
            )
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                    DS_CPO_RTRN_DTL  DCRDX
                WHERE
                    DCRDX.GLBL_CMPY_CD     = DCC.GLBL_CMPY_CD
                AND DCRDX.DS_CPO_CONFIG_PK = DCC.DS_CPO_CONFIG_PK
                AND DCRDX.BASE_CMPT_FLG    = #baseCmptFlg#
                AND DCRDX.EZCANCELFLAG     = '0'
            )
        ORDER BY
             CPO_CTAC_ORD_NUM
            ,CPO_CTAC_CONFIG_PK
            ,CPO_CTAC_DTL_RTRN_LINE_NUM
            ,CPO_CTAC_DTL_RTRN_LINE_SUB_NUM
    </statement>

    <statement id="getDsSvcCallTpInfo" parameterClass="Map" resultClass="Map">
        SELECT
             SICGD.DS_SVC_CALL_TP_CD AS DS_SVC_CALL_TP_CD_DTL
            ,DSCT.SVC_CALL_PRTY_CD   AS SVC_CALL_PRTY_CD
            ,DSCT.BYPS_PRF_TECH_FLG  AS BYPS_PRF_TECH_FLG
            ,SBT.LBOR_CHRG_FLG       AS LBOR_CHRG_FLG
            ,SBT.PRT_CHRG_FLG        AS PRT_CHRG_FLG

        FROM
             SVC_ISTL_CALL_GRP     SICG
            ,SVC_ISTL_CALL_GRP_DTL SICGD
            ,DS_SVC_CALL_TP        DSCT
            ,SVC_BILL_TP           SBT
        WHERE
                SICG.GLBL_CMPY_CD          = #glblCmpyCd#
            AND SICG.SVC_ISTL_CALL_GRP_NUM = #svcIstlCallGrpNum#
            AND SICG.SVC_ISTL_CALL_GRP_FLG = #svcIstlCallGrpFlg#
            AND SICG.EZCANCELFLAG          = '0'
            AND SICG.GLBL_CMPY_CD          = SICGD.GLBL_CMPY_CD
            AND SICG.SVC_ISTL_CALL_GRP_NUM = SICGD.SVC_ISTL_CALL_GRP_NUM
            AND SICGD.EZCANCELFLAG         = '0'
            AND SICGD.GLBL_CMPY_CD         = DSCT.GLBL_CMPY_CD
            AND SICGD.DS_SVC_CALL_TP_CD    = DSCT.DS_SVC_CALL_TP_CD
            AND DSCT.EZCANCELFLAG          = '0'
            AND DSCT.GLBL_CMPY_CD          = SBT.GLBL_CMPY_CD
            AND DSCT.SVC_BILL_TP_CD        = SBT.SVC_BILL_TP_CD
            AND SBT.EZCANCELFLAG           = '0'
    </statement>
    <statement id="getCpoCtacPsnInfo" parameterClass="Map" resultClass="Map">
        SELECT
             '1'                        AS SORT_TXT
            ,DCCP.CTAC_PSN_SORT_NUM     AS SORT_NUM
            ,DCCP.DS_CPO_CTAC_PSN_PK    AS DS_CPO_CTAC_PSN_PK
            ,DCCP.CTAC_PSN_TEL_NUM      AS CTAC_PSN_TEL_NUM
            ,DCCP.CTAC_PSN_EXTN_NUM     AS CTAC_PSN_EXTN_NUM
            ,DCCP.CTAC_PSN_EML_ADDR     AS CTAC_PSN_EML_ADDR
            ,SUBSTR(DCCP.CTAC_PSN_FIRST_NM || ' ' || DCCP.CTAC_PSN_LAST_NM, 1, #len60#)
                                        AS SVC_CUST_ATTN_TXT
            ,SUBSTR(DCCP.CTAC_PSN_FIRST_NM || ' ' || DCCP.CTAC_PSN_LAST_NM, 1, #len60#)
                                        AS SVC_CUST_CLLR_TXT
            ,DCCP.CTAC_PSN_TEL_NUM      AS SVC_CUST_CLLR_TEL_NUM
            ,DCCP.CTAC_PSN_EXTN_NUM     AS SVC_CUST_CLLR_TEL_EXTN_NUM
        FROM
             CPO             DCPO
            ,DS_CPO_CTAC_PSN DCCP
        WHERE
                DCPO.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DCPO.CPO_ORD_NUM          = #cpoOrdNum#
            AND DCPO.EZCANCELFLAG         = '0'
            AND DCPO.GLBL_CMPY_CD         = DCCP.GLBL_CMPY_CD (+)
            AND DCPO.CPO_ORD_NUM          = DCCP.CPO_ORD_NUM  (+)
            AND DCCP.DS_CPO_CONFIG_PK (+) = #dsCpoConfigPk#
            AND DCCP.CTAC_PSN_TP_CD   (+) = #ctacPsnTpCd#
            AND DCCP.EZCANCELFLAG     (+) = '0'
        UNION ALL
        SELECT
             '2'                        AS SORT_TXT
            ,DCCP.CTAC_PSN_SORT_NUM     AS SORT_NUM
            ,DCCP.DS_CPO_CTAC_PSN_PK    AS DS_CPO_CTAC_PSN_PK
            ,DCCP.CTAC_PSN_TEL_NUM      AS CTAC_PSN_TEL_NUM
            ,DCCP.CTAC_PSN_EXTN_NUM     AS CTAC_PSN_EXTN_NUM
            ,DCCP.CTAC_PSN_EML_ADDR     AS CTAC_PSN_EML_ADDR
            ,SUBSTR(DCCP.CTAC_PSN_FIRST_NM || ' ' || DCCP.CTAC_PSN_LAST_NM, 1, #len60#)
                                        AS SVC_CUST_ATTN_TXT
            ,SUBSTR(DCCP.CTAC_PSN_FIRST_NM || ' ' || DCCP.CTAC_PSN_LAST_NM, 1, #len60#)
                                        AS SVC_CUST_CLLR_TXT
            ,DCCP.CTAC_PSN_TEL_NUM      AS SVC_CUST_CLLR_TEL_NUM
            ,DCCP.CTAC_PSN_EXTN_NUM     AS SVC_CUST_CLLR_TEL_EXTN_NUM
        FROM
             CPO             DCPO
            ,DS_CPO_CTAC_PSN DCCP
        WHERE
                DCPO.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DCPO.CPO_ORD_NUM          = #cpoOrdNum#
            AND DCPO.EZCANCELFLAG         = '0'
            AND DCPO.GLBL_CMPY_CD         = DCCP.GLBL_CMPY_CD (+)
            AND DCPO.CPO_ORD_NUM          = DCCP.CPO_ORD_NUM  (+)
            AND DCCP.CTAC_PSN_TP_CD   (+) = #ctacPsnTpCd#
            AND DCCP.EZCANCELFLAG     (+) = '0'
        ORDER BY
             SORT_TXT           ASC
            ,SORT_NUM           ASC
            ,DS_CPO_CTAC_PSN_PK ASC
    </statement>
    <statement id="getTechInfo" parameterClass="Map" resultClass="Map">
        SELECT
             B.PSN_CD
            ,B.PSN_TP_CD
        FROM
             FSR_VISIT A
            ,S21_PSN   B
        WHERE
            A.GLBL_CMPY_CD   = #glblCmpyCd#
        AND A.FSR_NUM        = #fsrNum#
        AND A.FSR_VISIT_NUM  = #fsrVisitNum#
        AND A.EZCANCELFLAG   = '0'
        AND A.GLBL_CMPY_CD   = B.GLBL_CMPY_CD
        AND A.TECH_CD        = B.PSN_CD
        AND B.DEL_FLG        = 'N'
        AND B.EZCANCELFLAG   = '0'
    </statement>
</sqlMap>
