<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NFCL0730Query">
    <!-- *********************************************************** -->
    <!-- ********** Bean Definition ******************************** -->
    <!-- *********************************************************** -->
    <typeAlias alias="NFCL0730_BCMsg"     type="business.blap.NFCL0730.NFCL0730_BCMsg"/>

    <statement id="getDetails" parameterClass="Map" resultMap="result.getDetails">
        SELECT
             A.AR_TRX_NUM
            ,A.AR_ADJ_NUM
            ,B.AR_ADJ_TP_CD
            ,C.AR_ADJ_TP_DESC_TXT
            ,A.GL_DT
            ,A.DEAL_APPLY_AMT * -1 AS DEAL_APPLY_AMT
            ,B.ADJ_CMNT_TXT
            ,B.AR_WRT_OFF_NOTE_TXT
            <!-- START 2022/11/10 S.Naya [QC#57252,ADD] -->
            ,CASE WHEN D.AR_ADJ_NUM IS NOT NULL THEN
                (CONCAT(D.ADJ_COA_CMPY_CD,  '.') ||
                 CONCAT(D.ADJ_COA_BR_CD,    '.') ||
                 CONCAT(D.ADJ_COA_CC_CD,    '.') ||
                 CONCAT(D.ADJ_COA_ACCT_CD,  '.') ||
                 CONCAT(D.ADJ_COA_PROD_CD,  '.') ||
                 CONCAT(D.ADJ_COA_CH_CD,    '.') ||
                 CONCAT(D.ADJ_COA_AFFL_CD,  '.') ||
                 CONCAT(D.ADJ_COA_PROJ_CD,  '.') ||
                 D.ADJ_COA_EXTN_CD)
             ELSE NULL END AS XX_CMNT_TXT
           <!-- END   2022/11/10 S.Naya [QC#57252,ADD] -->
            ,B.EZINUSERID
        FROM
             AR_CASH_APP    A
            ,AR_ADJ         B
            ,AR_ADJ_TP      C
            <!-- START 2022/11/10 S.Naya [QC#57252,ADD] -->
            ,AR_ADJ_COA_INFO    D
            <!-- END   2022/11/10 S.Naya [QC#57252,ADD] -->
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.GLBL_CMPY_CD      = C.GLBL_CMPY_CD
            AND A.AR_TRX_NUM        = #arTrxNum#
            AND A.AR_APPLY_TP_CD    = #arApplytpCd#
            AND A.AR_SCR_CANC_FLG   = 'N'
            AND A.AR_ADJ_NUM        = B.AR_ADJ_NUM
            AND B.AR_ADJ_TP_CD      = C.AR_ADJ_TP_CD
            AND A.EZCANCELFLAG      = '0'
            AND B.EZCANCELFLAG      = '0'
            AND C.EZCANCELFLAG      = '0'
            <!-- START 2022/11/10 S.Naya [QC#57252,ADD] -->
            AND A.GLBL_CMPY_CD      = D.GLBL_CMPY_CD(+)
            AND A.AR_ADJ_NUM        = D.AR_ADJ_NUM(+)
            AND D.EZCANCELFLAG(+)   = '0'
            <!-- END   2022/11/10 S.Naya [QC#57252,ADD] -->
      ORDER BY A.AR_ADJ_NUM DESC
    </statement>
    <resultMap id="result.getDetails" class="NFCL0730_BCMsg">
        <result property="arTrxNum_B1"        column="AR_TRX_NUM"           javaType="EZDSStringItem" />
        <result property="arAdjNum_B1"        column="AR_ADJ_NUM"           javaType="EZDSStringItem" />
        <result property="arAdjTpCd_B1"       column="AR_ADJ_TP_CD"         javaType="EZDSStringItem" />
        <result property="arAdjTpDescTxt_B1"  column="AR_ADJ_TP_DESC_TXT"   javaType="EZDSStringItem" />
        <result property="glDt_B1"            column="GL_DT"                javaType="EZDSStringItem" />
        <result property="dealApplyAmt_B1"    column="DEAL_APPLY_AMT"       javaType="EZDSBigDecimalItem" />
        <result property="adjCmntTxt_B1"      column="ADJ_CMNT_TXT"         javaType="EZDSStringItem" />
        <result property="arWrtOffNoteTxt_B1" column="AR_WRT_OFF_NOTE_TXT" javaType="EZDSStringItem" />
        <!-- START 2022/11/10 S.Naya [QC#57252,ADD] -->
        <result property="xxCmntTxt_B1"       column="XX_CMNT_TXT"          javaType="EZDSStringItem" />
        <!-- END   2022/11/10 S.Naya [QC#57252,ADD] -->
        <result property="ezInUserID_B1"      column="EZINUSERID"           javaType="EZDSStringItem" />
    </resultMap>

    <statement id="getResultDetails" parameterClass="Map" resultMap="result.getDetails">
        SELECT
             A.AR_ADJ_NUM
            ,B.AR_ADJ_TP_CD
            ,C.AR_ADJ_TP_DESC_TXT
            ,A.GL_DT
            ,A.DEAL_APPLY_AMT
            ,B.ADJ_CMNT_TXT
            ,B.AR_WRT_OFF_NOTE_TXT
            <!-- START 2022/11/10 S.Naya [QC#57252,ADD] -->
            ,CASE WHEN D.AR_ADJ_NUM IS NOT NULL THEN
                (CONCAT(D.ADJ_COA_CMPY_CD,  '.') ||
                 CONCAT(D.ADJ_COA_BR_CD,    '.') ||
                 CONCAT(D.ADJ_COA_CC_CD,    '.') ||
                 CONCAT(D.ADJ_COA_ACCT_CD,  '.') ||
                 CONCAT(D.ADJ_COA_PROD_CD,  '.') ||
                 CONCAT(D.ADJ_COA_CH_CD,    '.') ||
                 CONCAT(D.ADJ_COA_AFFL_CD,  '.') ||
                 CONCAT(D.ADJ_COA_PROJ_CD,  '.') ||
                 D.ADJ_COA_EXTN_CD)
             ELSE NULL END AS XX_CMNT_TXT
            <!-- END   2022/11/10 S.Naya [QC#57252,ADD] -->
            ,B.EZINUSERID
        FROM
             AR_CASH_APP    A
            ,AR_ADJ         B
            ,AR_ADJ_TP      C
            <!-- START 2022/11/10 S.Naya [QC#57252,ADD] -->
            ,AR_ADJ_COA_INFO    D
            <!-- END   2022/11/10 S.Naya [QC#57252,ADD] -->
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.GLBL_CMPY_CD      = C.GLBL_CMPY_CD
            AND A.RCPT_NUM          = #rcptNum#
            AND A.AR_APPLY_TP_CD    = #arApplytpCd#
            AND A.AR_SCR_CANC_FLG   = 'N'
            AND A.AR_ADJ_NUM        = B.AR_ADJ_NUM
            AND B.AR_ADJ_TP_CD      = C.AR_ADJ_TP_CD
            AND A.EZCANCELFLAG      = '0'
            AND B.EZCANCELFLAG      = '0'
            AND C.EZCANCELFLAG      = '0'
            <!-- START 2022/11/10 S.Naya [QC#57252,ADD] -->
            AND A.GLBL_CMPY_CD      = D.GLBL_CMPY_CD(+)
            AND A.AR_ADJ_NUM        = D.AR_ADJ_NUM(+)
            AND D.EZCANCELFLAG(+)   = '0'
            <!-- END   2022/11/10 S.Naya [QC#57252,ADD] -->
        ORDER BY
            A.AR_CASH_APP_SQ_NUM
    </statement>
    <resultMap id="result.getDetails" class="NFCL0730_BCMsg">
        <result property="arAdjNum_B1"        column="AR_ADJ_NUM"         javaType="EZDSStringItem" />
        <result property="arAdjTpCd_B1"       column="AR_ADJ_TP_CD"       javaType="EZDSStringItem" />
        <result property="arAdjTpDescTxt_B1"  column="AR_ADJ_TP_DESC_TXT" javaType="EZDSStringItem" />
        <result property="glDt_B1"            column="GL_DT"              javaType="EZDSStringItem" />
        <result property="dealApplyAmt_B1"    column="DEAL_APPLY_AMT"     javaType="EZDSBigDecimalItem" />
        <result property="adjCmntTxt_B1"      column="ADJ_CMNT_TXT"       javaType="EZDSStringItem" />
        <result property="arWrtOffNoteTxt_B1" column="AR_WRT_OFF_NOTE_TXT" javaType="EZDSStringItem" />
        <!-- START 2022/11/10 S.Naya [QC#57252,ADD] -->
        <result property="xxCmntTxt_B1"       column="XX_CMNT_TXT"        javaType="EZDSStringItem" />
        <!-- END   2022/11/10 S.Naya [QC#57252,ADD] -->
        <result property="ezInUserID_B1"      column="EZINUSERID"         javaType="EZDSStringItem" />
    </resultMap>

    <statement id="findArAdjTpForAdj" parameterClass="Map" resultClass="Map">
    SELECT
            AAT.AR_ADJ_TP_CD
          , AAT.AR_ADJ_TP_DESC_TXT
    FROM
            AR_ADJ_TP AAT
    WHERE
            AAT.GLBL_CMPY_CD = #glblCmpyCd#
        AND AAT.EZCANCELFLAG = '0'
        AND AAT.AR_ADJ_CATG_CD = #arAdjCatgCd#
    <!-- START 2023/01/27 T.Kuroda [QC#61089, ADD] -->
    <isNotNull property="funcList">
        AND EXISTS (
                SELECT
                        1
                FROM
                        AR_WRITE_OFF_ADJ_TP_DFN AWOATD
                WHERE
                        AWOATD.GLBL_CMPY_CD = AAT.GLBL_CMPY_CD
                    AND AWOATD.EZCANCELFLAG = '0'
                    AND AWOATD.AR_ADJ_TP_CD = AAT.AR_ADJ_TP_CD
                <iterate property="funcList" var="funcList[]" open="AND AWOATD.BIZ_FUNC_ID IN (" close=")" conjunction=",">
                        #funcList[]#
                </iterate>
            )
    </isNotNull>
    ORDER BY
            AAT.AR_ADJ_TP_SORT_NUM
    <!-- END   2023/01/27 T.Kuroda [QC#61089, ADD] -->
    </statement>

    <!-- START   2023/06/30 S.Fujita [QC#60397,ADD] -->
    <statement id="getHrTtlNm" parameterClass="Map" resultClass="String">
        SELECT
             HTAL.HR_TTL_NM
        FROM
             HR_TTL_APVL_LIMIT HTAL
            ,S21_CSA_APPS.S21_PSN SP
        WHERE
            <!-- START   2023/08/02 S.Fujita [QC#60397,MOD] -->
                HTAL.GLBL_CMPY_CD        = #glblCmpyCd#
            AND HTAL.GLBL_CMPY_CD        = SP.GLBL_CMPY_CD
            AND HTAL.EZCANCELFLAG        = '0'
            AND SP.EZCANCELFLAG          = '0'
            AND HTAL.APVL_LIMIT_ACTV_FLG = 'Y'
            AND HTAL.AR_ADJ_CATG_CD      = #catgCd#
            AND SP.PSN_CD                = #psnCd#
            AND HTAL.HR_TTL_NM           = SP.HR_TTL_NM
            <!-- END   2023/08/02 S.Fujita [QC#60397,MOD] -->
    </statement>

    <statement id="getHrTtlApvlLimitPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             HTAL.HR_TTL_APVL_LIMIT_PK
        FROM
             HR_TTL_APVL_LIMIT HTAL
        WHERE
            <!-- START   2023/08/02 S.Fujita [QC#60397,MOD] -->
                HTAL.GLBL_CMPY_CD        = #glblCmpyCd#
            AND HTAL.EZCANCELFLAG        = '0'
            AND HTAL.APVL_LIMIT_ACTV_FLG = 'Y'
            AND HTAL.AR_ADJ_CATG_CD      = #catgCd#
            AND HTAL.HR_TTL_NM           = #hrTtlNm#
            <!-- END   2023/08/02 S.Fujita [QC#60397,MOD] -->
    </statement>

    <!-- END   2023/06/30 S.Fujita [QC#60397,ADD] -->
</sqlMap>
