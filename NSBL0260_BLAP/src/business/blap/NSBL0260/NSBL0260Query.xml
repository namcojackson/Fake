<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSBL0260Query">

    <statement id="getDsMdlEol" parameterClass="Map" resultClass="Map">
        SELECT
            A.GLBL_CMPY_CD
           ,A.DME10_DS_MDL_EOL_EX_PK
           ,A.DME20_DS_MDL_EOL_EX_PK
           ,A.MDL_ID
           ,A.MDL_NM
           ,A.SER_NUM
           ,A.DME10_DS_MDL_EOL_STS_CD
           ,A.DME10_DS_MDL_EOL_DT
           ,A.DME10_EZUPTIME
           ,A.DME10_EZUPTIMEZONE
           ,A.DME20_DS_MDL_EOL_STS_CD
           ,A.DME20_DS_MDL_EOL_DT
           ,A.DME20_EZUPTIME
           ,A.DME20_EZUPTIMEZONE
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
           ,A.XX_REC_HIST_CRAT_TS
           ,A.XX_REC_HIST_CRAT_BY_NM
           ,A.XX_REC_HIST_UPD_TS
           ,A.XX_REC_HIST_UPD_BY_NM
           ,A.XX_REC_HIST_TBL_NM
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
           ,A.DS_ACCT_NUM
           ,A.SVC_CONFIG_MSTR_PK
           ,A.DS_ACCT_NM
           ,A.CTY_ADDR
           ,A.ST_CD
        FROM(
            SELECT
                DME_ALL.GLBL_CMPY_CD
               ,DME_ALL.DME10_DS_MDL_EOL_EX_PK
               ,DME_ALL.DME20_DS_MDL_EOL_EX_PK
               ,DME_ALL.MDL_ID
               ,MN.T_MDL_NM               MDL_NM
               ,DME_ALL.SER_NUM           SER_NUM
               ,DME10_DS_MDL_EOL_STS_CD
               ,DME10_DS_MDL_EOL_DT
               ,DME10_EZUPTIME
               ,DME10_EZUPTIMEZONE
               ,DME20_DS_MDL_EOL_STS_CD
               ,DME20_DS_MDL_EOL_DT
               ,DME20_EZUPTIME
               ,DME20_EZUPTIMEZONE
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
               ,XX_REC_HIST_CRAT_TS
               ,XX_REC_HIST_CRAT_BY_NM
               ,XX_REC_HIST_UPD_TS
               ,XX_REC_HIST_UPD_BY_NM
               ,XX_REC_HIST_TBL_NM
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
               ,SMM.OWNR_ACCT_NUM        DS_ACCT_NUM
               ,SMM.SVC_CONFIG_MSTR_PK
               ,STC.DS_ACCT_NM
               ,STC.CTY_ADDR
               ,STC.ST_CD
            FROM(
                SELECT
                    DME10_GLBL_CMPY_CD          GLBL_CMPY_CD
                   ,DME10_DS_MDL_EOL_EX_PK
                   ,DME20_DS_MDL_EOL_EX_PK
                   ,DME10_MDL_ID                MDL_ID
                   ,DME10_SER_NUM               SER_NUM
                   ,DME10_DS_MDL_EOL_STS_CD
                   ,DME10_DS_MDL_EOL_DT
                   ,DME10_EZUPTIME
                   ,DME10_EZUPTIMEZONE
                   ,DME20_DS_MDL_EOL_STS_CD
                   ,DME20_DS_MDL_EOL_DT
                   ,DME20_EZUPTIME
                   ,DME20_EZUPTIMEZONE
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
                   ,XX_REC_HIST_CRAT_TS
                   ,XX_REC_HIST_CRAT_BY_NM
                   ,XX_REC_HIST_UPD_TS
                   ,XX_REC_HIST_UPD_BY_NM
                   ,XX_REC_HIST_TBL_NM
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
                FROM
                       (SELECT
                            DME10.GLBL_CMPY_CD      DME10_GLBL_CMPY_CD
                           ,DME10.DS_MDL_EOL_EX_PK  DME10_DS_MDL_EOL_EX_PK
                           ,NULL
                           ,DME10.MDL_ID            DME10_MDL_ID
                           ,DME10.SER_NUM           DME10_SER_NUM
                           ,DME10.DS_MDL_EOL_STS_CD DME10_DS_MDL_EOL_STS_CD
                           ,DME10.DS_MDL_EOL_DT     DME10_DS_MDL_EOL_DT
                           ,DME10.EZUPTIME          DME10_EZUPTIME
                           ,DME10.EZUPTIMEZONE      DME10_EZUPTIMEZONE
                           ,NULL
                           ,NULL
                           ,NULL
                           ,NULL
                        FROM(
                            SELECT
                                DME.GLBL_CMPY_CD
                               ,DME.DS_MDL_EOL_EX_PK
                               ,DME.MDL_ID
                               ,DME.SER_NUM
                               ,DME.DS_MDL_EOL_STS_CD
                               ,DME.DS_MDL_EOL_DT
                               ,DME.EZUPTIME
                               ,DME.EZUPTIMEZONE
                            FROM
                                DS_MDL_EOL_EX    DME
                            WHERE
                                DME.GLBL_CMPY_CD     = #glblCmpyCd#
                                AND DME.EZCANCELFLAG = '0'
                        ) DME10
                        WHERE
                            DME10.DS_MDL_EOL_STS_CD = #noNewContractsAfterDate#
                      )
                      ,(SELECT
                            DME20.GLBL_CMPY_CD      DME20_GLBL_CMPY_CD
                           ,NULL
                           ,DME20.DS_MDL_EOL_EX_PK  DME20_DS_MDL_EOL_EX_PK
                           ,DME20.MDL_ID            DME20_MDL_ID
                           ,DME20.SER_NUM           DME20_SER_NUM
                           ,NULL
                           ,NULL
                           ,NULL
                           ,NULL
                           ,DME20.DS_MDL_EOL_STS_CD DME20_DS_MDL_EOL_STS_CD
                           ,DME20.DS_MDL_EOL_DT     DME20_DS_MDL_EOL_DT
                           ,DME20.EZUPTIME          DME20_EZUPTIME
                           ,DME20.EZUPTIMEZONE      DME20_EZUPTIMEZONE
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
                           ,DME20.EZINTIME          XX_REC_HIST_CRAT_TS
                           ,DME20.EZINUSERID        XX_REC_HIST_CRAT_BY_NM
                           ,DME20.EZUPTIME          XX_REC_HIST_UPD_TS
                           ,DME20.EZUPUSERID        XX_REC_HIST_UPD_BY_NM
                           ,DME20.EZTABLEID         XX_REC_HIST_TBL_NM
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
                        FROM(
                            SELECT
                                DME.GLBL_CMPY_CD
                               ,DME.DS_MDL_EOL_EX_PK
                               ,DME.MDL_ID
                               ,DME.SER_NUM
                               ,DME.DS_MDL_EOL_STS_CD
                               ,DME.DS_MDL_EOL_DT
                               ,DME.EZUPTIME
                               ,DME.EZUPTIMEZONE
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
                               ,DME.EZINTIME
                               ,DME.EZINUSERID
                               ,DME.EZUPUSERID
                               ,DME.EZTABLEID
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
                            FROM
                                DS_MDL_EOL_EX    DME
                            WHERE
                                DME.GLBL_CMPY_CD     = #glblCmpyCd#
                                AND DME.EZCANCELFLAG = '0'
                        ) DME20
                        WHERE
                            DME20.DS_MDL_EOL_STS_CD = #stopServiceDate#
                        )
                WHERE
                    DME10_GLBL_CMPY_CD = DME20_GLBL_CMPY_CD
                    AND DME10_MDL_ID   = DME20_MDL_ID
                    AND DME10_SER_NUM  = DME20_SER_NUM
                UNION ALL
                SELECT
                    DME10_GLBL_CMPY_CD          GLBL_CMPY_CD
                   ,DME10_DS_MDL_EOL_EX_PK
                   ,NULL
                   ,DME10_MDL_ID                MDL_ID
                   ,DME10_SER_NUM               SER_NUM
                   ,DME10_DS_MDL_EOL_STS_CD
                   ,DME10_DS_MDL_EOL_DT
                   ,DME10_EZUPTIME
                   ,DME10_EZUPTIMEZONE
                   ,NULL
                   ,NULL
                   ,NULL
                   ,NULL
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
                   ,XX_REC_HIST_CRAT_TS
                   ,XX_REC_HIST_CRAT_BY_NM
                   ,XX_REC_HIST_UPD_TS
                   ,XX_REC_HIST_UPD_BY_NM
                   ,XX_REC_HIST_TBL_NM
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
                FROM
                       (SELECT
                            DME10.GLBL_CMPY_CD      DME10_GLBL_CMPY_CD
                           ,DME10.DS_MDL_EOL_EX_PK  DME10_DS_MDL_EOL_EX_PK
                           ,NULL
                           ,DME10.MDL_ID            DME10_MDL_ID
                           ,DME10.SER_NUM           DME10_SER_NUM
                           ,DME10.DS_MDL_EOL_STS_CD DME10_DS_MDL_EOL_STS_CD
                           ,DME10.DS_MDL_EOL_DT     DME10_DS_MDL_EOL_DT
                           ,DME10.EZUPTIME          DME10_EZUPTIME
                           ,DME10.EZUPTIMEZONE      DME10_EZUPTIMEZONE
                           ,NULL
                           ,NULL
                           ,NULL
                           ,NULL
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
                           ,DME10.EZINTIME          XX_REC_HIST_CRAT_TS
                           ,DME10.EZINUSERID        XX_REC_HIST_CRAT_BY_NM
                           ,DME10.EZUPTIME          XX_REC_HIST_UPD_TS
                           ,DME10.EZUPUSERID        XX_REC_HIST_UPD_BY_NM
                           ,DME10.EZTABLEID         XX_REC_HIST_TBL_NM
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
                        FROM(
                            SELECT
                                DME.GLBL_CMPY_CD
                               ,DME.DS_MDL_EOL_EX_PK
                               ,DME.MDL_ID
                               ,DME.SER_NUM
                               ,DME.DS_MDL_EOL_STS_CD
                               ,DME.DS_MDL_EOL_DT
                               ,DME.EZUPTIME
                               ,DME.EZUPTIMEZONE
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
                               ,DME.EZINTIME
                               ,DME.EZINUSERID
                               ,DME.EZUPUSERID
                               ,DME.EZTABLEID
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
                            FROM
                                DS_MDL_EOL_EX    DME
                            WHERE
                                DME.GLBL_CMPY_CD     = #glblCmpyCd#
                                AND DME.EZCANCELFLAG = '0'
                        ) DME10
                        WHERE
                            DME10.DS_MDL_EOL_STS_CD = #noNewContractsAfterDate#
                    )
                WHERE
                    NOT EXISTS(
                               SELECT
                                   1
                               FROM
                                  (SELECT
                                      DME20.GLBL_CMPY_CD      DME20_GLBL_CMPY_CD
                                     ,NULL
                                     ,DME20.DS_MDL_EOL_EX_PK  DME20_DS_MDL_EOL_EX_PK
                                     ,DME20.MDL_ID            DME20_MDL_ID
                                     ,DME20.SER_NUM           DME20_SER_NUM
                                     ,NULL
                                     ,NULL
                                     ,NULL
                                     ,NULL
                                     ,DME20.DS_MDL_EOL_STS_CD DME20_DS_MDL_EOL_STS_CD
                                     ,DME20.DS_MDL_EOL_DT     DME20_DS_MDL_EOL_DT
                                     ,DME20.EZUPTIME          DME20_EZUPTIME
                                     ,DME20.EZUPTIMEZONE      DME20_EZUPTIMEZONE
                                  FROM(
                                      SELECT
                                          DME.GLBL_CMPY_CD
                                         ,DME.DS_MDL_EOL_EX_PK
                                         ,DME.MDL_ID
                                         ,DME.SER_NUM
                                         ,DME.DS_MDL_EOL_STS_CD
                                         ,DME.DS_MDL_EOL_DT
                                         ,DME.EZUPTIME
                                         ,DME.EZUPTIMEZONE
                                      FROM
                                          DS_MDL_EOL_EX    DME
                                      WHERE
                                          DME.GLBL_CMPY_CD     = #glblCmpyCd#
                                          AND DME.EZCANCELFLAG = '0'
                                      ) DME20
                                  WHERE
                                      DME20.DS_MDL_EOL_STS_CD = #stopServiceDate#)
                               WHERE
                                   DME10_GLBL_CMPY_CD = DME20_GLBL_CMPY_CD
                                   AND DME10_MDL_ID   = DME20_MDL_ID
                                   AND DME10_SER_NUM  = DME20_SER_NUM
                               )
                UNION ALL
                SELECT
                    DME20_GLBL_CMPY_CD          GLBL_CMPY_CD
                   ,NULL
                   ,DME20_DS_MDL_EOL_EX_PK
                   ,DME20_MDL_ID                MDL_ID
                   ,DME20_SER_NUM               SER_NUM
                   ,NULL
                   ,NULL
                   ,NULL
                   ,NULL
                   ,DME20_DS_MDL_EOL_STS_CD
                   ,DME20_DS_MDL_EOL_DT
                   ,DME20_EZUPTIME
                   ,DME20_EZUPTIMEZONE
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
                   ,XX_REC_HIST_CRAT_TS
                   ,XX_REC_HIST_CRAT_BY_NM
                   ,XX_REC_HIST_UPD_TS
                   ,XX_REC_HIST_UPD_BY_NM
                   ,XX_REC_HIST_TBL_NM
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
                FROM
                       (SELECT
                            DME20.GLBL_CMPY_CD      DME20_GLBL_CMPY_CD
                           ,NULL
                           ,DME20.DS_MDL_EOL_EX_PK  DME20_DS_MDL_EOL_EX_PK
                           ,DME20.MDL_ID            DME20_MDL_ID
                           ,DME20.SER_NUM           DME20_SER_NUM
                           ,NULL
                           ,NULL
                           ,NULL
                           ,NULL
                           ,DME20.DS_MDL_EOL_STS_CD DME20_DS_MDL_EOL_STS_CD
                           ,DME20.DS_MDL_EOL_DT     DME20_DS_MDL_EOL_DT
                           ,DME20.EZUPTIME          DME20_EZUPTIME
                           ,DME20.EZUPTIMEZONE      DME20_EZUPTIMEZONE
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
                           ,DME20.EZINTIME          XX_REC_HIST_CRAT_TS
                           ,DME20.EZINUSERID        XX_REC_HIST_CRAT_BY_NM
                           ,DME20.EZUPTIME          XX_REC_HIST_UPD_TS
                           ,DME20.EZUPUSERID        XX_REC_HIST_UPD_BY_NM
                           ,DME20.EZTABLEID         XX_REC_HIST_TBL_NM
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
                        FROM(
                            SELECT
                                DME.GLBL_CMPY_CD
                               ,DME.DS_MDL_EOL_EX_PK
                               ,DME.MDL_ID
                               ,DME.SER_NUM
                               ,DME.DS_MDL_EOL_STS_CD
                               ,DME.DS_MDL_EOL_DT
                               ,DME.EZUPTIME
                               ,DME.EZUPTIMEZONE
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
                               ,DME.EZINTIME
                               ,DME.EZINUSERID
                               ,DME.EZUPUSERID
                               ,DME.EZTABLEID
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
                            FROM
                                DS_MDL_EOL_EX    DME
                            WHERE
                                DME.GLBL_CMPY_CD     = #glblCmpyCd#
                                AND DME.EZCANCELFLAG = '0'
                        ) DME20
                        WHERE
                            DME20.DS_MDL_EOL_STS_CD = #stopServiceDate#
                    )
                WHERE
                    NOT EXISTS(
                               SELECT
                                   1
                               FROM
                                  (SELECT
                                      DME10.GLBL_CMPY_CD      DME10_GLBL_CMPY_CD
                                     ,DME10.DS_MDL_EOL_EX_PK  DME10_DS_MDL_EOL_EX_PK
                                     ,NULL
                                     ,DME10.MDL_ID            DME10_MDL_ID
                                     ,DME10.SER_NUM           DME10_SER_NUM
                                     ,DME10.DS_MDL_EOL_STS_CD DME10_DS_MDL_EOL_STS_CD
                                     ,DME10.DS_MDL_EOL_DT     DME10_DS_MDL_EOL_DT
                                     ,DME10.EZUPTIME          DME10_EZUPTIME
                                     ,DME10.EZUPTIMEZONE      DME10_EZUPTIMEZONE
                                     ,NULL
                                     ,NULL
                                     ,NULL
                                     ,NULL
                                  FROM(
                                      SELECT
                                          DME.GLBL_CMPY_CD
                                         ,DME.DS_MDL_EOL_EX_PK
                                         ,DME.MDL_ID
                                         ,DME.SER_NUM
                                         ,DME.DS_MDL_EOL_STS_CD
                                         ,DME.DS_MDL_EOL_DT
                                         ,DME.EZUPTIME
                                         ,DME.EZUPTIMEZONE
                                      FROM
                                          DS_MDL_EOL_EX    DME
                                      WHERE
                                          DME.GLBL_CMPY_CD     = #glblCmpyCd#
                                          AND DME.EZCANCELFLAG = '0'
                                      ) DME10
                                  WHERE
                                      DME10.DS_MDL_EOL_STS_CD = #noNewContractsAfterDate#)
                               WHERE
                                   DME10_GLBL_CMPY_CD = DME20_GLBL_CMPY_CD
                                   AND DME10_MDL_ID   = DME20_MDL_ID
                                   AND DME10_SER_NUM  = DME20_SER_NUM
                               )
               )                 DME_ALL
                ,MDL_NM          MN
                ,SVC_CONFIG_MSTR SCM
                ,SVC_MACH_MSTR   SMM
                ,SELL_TO_CUST    STC
            WHERE
                0=0
            <isEqual property="serviceableOffFlag" compareValue="YN">
                AND (   DME20_DS_MDL_EOL_DT IS NULL
                     OR DME20_DS_MDL_EOL_DT &gt; #salesDate#)
            </isEqual>
            <isEqual property="serviceableOffFlag" compareValue="NY">
                AND DME20_DS_MDL_EOL_DT &lt;=  #salesDate#
            </isEqual>
            <isEqual property="searchCriteriaCd" compareValue="MC">
                AND MN.T_GLBL_CMPY_CD     = #glblCmpyCd#
                AND MN.T_MDL_NM           &gt;= #mdlNm#
                AND MN.EZCANCELFLAG       = '0'
                AND DME_ALL.GLBL_CMPY_CD  = #glblCmpyCd#
                AND MN.T_MDL_ID           = DME_ALL.MDL_ID
                AND SCM.GLBL_CMPY_CD      = #glblCmpyCd#
                AND DME_ALL.MDL_ID        = SCM.MDL_ID
                AND SCM.EZCANCELFLAG      = '0'
                AND SMM.GLBL_CMPY_CD      = #glblCmpyCd#
<!-- START 2017/07/07 K.Kim [QC#18164, MOD] -->
                <!-- AND SCM.SVC_MACH_MSTR_PK  = SMM.SVC_MACH_MSTR_PK -->
                AND SCM.SVC_CONFIG_MSTR_PK = SMM.SVC_CONFIG_MSTR_PK
<!-- END 2017/07/07 K.Kim [QC#18164, MOD] -->
                AND DME_ALL.SER_NUM       = SMM.SER_NUM
                AND SMM.EZCANCELFLAG      = '0'
                AND STC.GLBL_CMPY_CD      = #glblCmpyCd#
                AND SMM.OWNR_ACCT_NUM     = STC.SELL_TO_CUST_CD
                AND STC.EFF_FROM_DT       &lt;= #salesDate#
                AND NVL(STC.EFF_THRU_DT, #maxThruDate#)
                                          &gt;= #salesDate#
                AND STC.DS_ACCT_ACTV_CUST_FLG
                                          = 'Y'
                AND STC.EZCANCELFLAG      = '0'
            </isEqual>
            <isEqual property="searchCriteriaCd" compareValue="SC">
                AND DME_ALL.GLBL_CMPY_CD  = #glblCmpyCd#
                AND DME_ALL.SER_NUM       &gt;= #serNum#
                AND MN.T_GLBL_CMPY_CD     = #glblCmpyCd#
                AND DME_ALL.MDL_ID        = MN.T_MDL_ID
                AND MN.EZCANCELFLAG       = '0'
                AND SCM.GLBL_CMPY_CD      = #glblCmpyCd#
                AND DME_ALL.MDL_ID        = SCM.MDL_ID
                AND SCM.EZCANCELFLAG      = '0'
                AND SMM.GLBL_CMPY_CD      = #glblCmpyCd#
<!-- START 2017/07/07 K.Kim [QC#18164, MOD] -->
                <!-- AND SCM.SVC_MACH_MSTR_PK  = SMM.SVC_MACH_MSTR_PK  -->
                AND SCM.SVC_CONFIG_MSTR_PK = SMM.SVC_CONFIG_MSTR_PK
<!-- END 2017/07/07 K.Kim [QC#18164, MOD] -->
                AND DME_ALL.SER_NUM       = SMM.SER_NUM
                AND SMM.EZCANCELFLAG      = '0'
                AND STC.GLBL_CMPY_CD      = #glblCmpyCd#
                AND SMM.OWNR_ACCT_NUM     = STC.SELL_TO_CUST_CD
                AND STC.EFF_FROM_DT       &lt;= #salesDate#
                AND NVL(STC.EFF_THRU_DT, #maxThruDate#)
                                          &gt;= #salesDate#
                AND STC.DS_ACCT_ACTV_CUST_FLG
                                          = 'Y'
                AND STC.EZCANCELFLAG      = '0'
            </isEqual>
            <isEqual property="searchCriteriaCd" compareValue="MSC">
                AND MN.T_GLBL_CMPY_CD     = #glblCmpyCd#
                AND MN.T_MDL_NM           &gt;= #mdlNm#
                AND MN.EZCANCELFLAG       = '0'
                AND DME_ALL.GLBL_CMPY_CD  = #glblCmpyCd#
                AND MN.T_MDL_ID           = DME_ALL.MDL_ID
                AND DME_ALL.SER_NUM       &gt;= #serNum#
                AND SCM.GLBL_CMPY_CD      = #glblCmpyCd#
                AND DME_ALL.MDL_ID        = SCM.MDL_ID
                AND SCM.EZCANCELFLAG      = '0'
                AND SMM.GLBL_CMPY_CD      = #glblCmpyCd#
<!-- START 2017/07/07 K.Kim [QC#18164, MOD] -->
                <!-- AND SCM.SVC_MACH_MSTR_PK  = SMM.SVC_MACH_MSTR_PK -->
                AND SCM.SVC_CONFIG_MSTR_PK = SMM.SVC_CONFIG_MSTR_PK
<!-- END 2017/07/07 K.Kim [QC#18164, MOD] -->
                AND DME_ALL.SER_NUM       = SMM.SER_NUM
                AND SMM.EZCANCELFLAG      = '0'
                AND STC.GLBL_CMPY_CD      = #glblCmpyCd#
                AND SMM.OWNR_ACCT_NUM     = STC.SELL_TO_CUST_CD
                AND STC.EFF_FROM_DT       &lt;= #salesDate#
                AND NVL(STC.EFF_THRU_DT, #maxThruDate#)
                                          &gt;= #salesDate#
                AND STC.DS_ACCT_ACTV_CUST_FLG
                                          = 'Y'
                AND STC.EZCANCELFLAG      = '0'
            </isEqual>
            <isEqual property="searchCriteriaCd" compareValue="MH">
                AND MN.T_GLBL_CMPY_CD     = #glblCmpyCd#
                AND MN.T_MDL_NM           LIKE #mdlNm#
                AND MN.EZCANCELFLAG       = '0'
                AND DME_ALL.GLBL_CMPY_CD  = #glblCmpyCd#
                AND MN.T_MDL_ID           = DME_ALL.MDL_ID
                AND SCM.GLBL_CMPY_CD      = #glblCmpyCd#
                AND DME_ALL.MDL_ID        = SCM.MDL_ID
                AND SCM.EZCANCELFLAG      = '0'
                AND SMM.GLBL_CMPY_CD      = #glblCmpyCd#
<!-- START 2017/07/07 K.Kim [QC#18164, MOD] -->
                <!-- AND SCM.SVC_MACH_MSTR_PK  = SMM.SVC_MACH_MSTR_PK -->
                AND SCM.SVC_CONFIG_MSTR_PK = SMM.SVC_CONFIG_MSTR_PK
<!-- END 2017/07/07 K.Kim [QC#18164, MOD] -->
                AND DME_ALL.SER_NUM       = SMM.SER_NUM
                AND SMM.EZCANCELFLAG      = '0'
                AND STC.GLBL_CMPY_CD      = #glblCmpyCd#
                AND SMM.OWNR_ACCT_NUM     = STC.SELL_TO_CUST_CD
                AND STC.EFF_FROM_DT       &lt;= #salesDate#
                AND NVL(STC.EFF_THRU_DT, #maxThruDate#)
                                          &gt;= #salesDate#
                AND STC.DS_ACCT_ACTV_CUST_FLG
                                          = 'Y'
                AND STC.EZCANCELFLAG      = '0'
            </isEqual>
            <isEqual property="searchCriteriaCd" compareValue="CH">
                AND SMM.GLBL_CMPY_CD      = #glblCmpyCd#
                AND SMM.OWNR_ACCT_NUM     LIKE #dsAcctNum#
                AND SMM.EZCANCELFLAG      = '0'
                AND SCM.GLBL_CMPY_CD      = #glblCmpyCd#
<!-- START 2017/07/07 K.Kim [QC#18164, MOD] -->
                <!-- AND SMM.SVC_MACH_MSTR_PK  = SCM.SVC_MACH_MSTR_PK -->
                AND SCM.SVC_CONFIG_MSTR_PK = SMM.SVC_CONFIG_MSTR_PK
<!-- END 2017/07/07 K.Kim [QC#18164, MOD] -->
                AND SCM.EZCANCELFLAG      = '0'
                AND STC.GLBL_CMPY_CD      = #glblCmpyCd#
                AND SMM.OWNR_ACCT_NUM     = STC.SELL_TO_CUST_CD
                AND STC.EFF_FROM_DT       &lt;= #salesDate#
                AND NVL(STC.EFF_THRU_DT, #maxThruDate#)
                                          &gt;= #salesDate#
                AND STC.DS_ACCT_ACTV_CUST_FLG
                                          = 'Y'
                AND STC.EZCANCELFLAG      = '0'
                AND DME_ALL.GLBL_CMPY_CD  = #glblCmpyCd#
                AND SMM.SER_NUM           = DME_ALL.SER_NUM
                AND MN.T_GLBL_CMPY_CD     = #glblCmpyCd#
                AND MN.T_MDL_ID           = DME_ALL.MDL_ID
            </isEqual>
            <isEqual property="searchCriteriaCd" compareValue="ALL">
                AND MN.T_GLBL_CMPY_CD     = #glblCmpyCd#
                AND DME_ALL.MDL_ID        = MN.T_MDL_ID
                AND MN.EZCANCELFLAG       = '0'
                AND SCM.GLBL_CMPY_CD      = #glblCmpyCd#
                AND DME_ALL.MDL_ID        = SCM.MDL_ID
                AND SCM.EZCANCELFLAG      = '0'
                AND SMM.GLBL_CMPY_CD      = #glblCmpyCd#
<!-- START 2017/07/07 K.Kim [QC#18164, MOD] -->
                <!-- AND SCM.SVC_MACH_MSTR_PK  = SMM.SVC_MACH_MSTR_PK -->
                AND SCM.SVC_CONFIG_MSTR_PK = SMM.SVC_CONFIG_MSTR_PK
<!-- END 2017/07/07 K.Kim [QC#18164, MOD] -->
                AND DME_ALL.SER_NUM       = SMM.SER_NUM
                AND SMM.EZCANCELFLAG      = '0'
                AND STC.GLBL_CMPY_CD      = #glblCmpyCd#
                AND SMM.OWNR_ACCT_NUM     = STC.SELL_TO_CUST_CD
                AND STC.EFF_FROM_DT       &lt;= #salesDate#
                AND NVL(STC.EFF_THRU_DT, #maxThruDate#)
                                          &gt;= #salesDate#
                AND STC.DS_ACCT_ACTV_CUST_FLG
                                          = 'Y'
                AND STC.EZCANCELFLAG      = '0'
            </isEqual>
            ORDER BY
                MDL_NM
               ,SER_NUM
            ) A
        WHERE
            ROWNUM &lt;= #limitNum#
    </statement>

    <statement id="getCustomerInfo" parameterClass="Map" resultClass="Map">
        SELECT
            SMM.GLBL_CMPY_CD
           ,SMM.OWNR_ACCT_NUM   DS_ACCT_NUM
           ,SMM.SVC_CONFIG_MSTR_PK
           ,STC.DS_ACCT_NM
           ,STC.CTY_ADDR
           ,STC.ST_CD
        FROM
            SVC_MACH_MSTR SMM
           ,SELL_TO_CUST  STC
        WHERE
            SMM.GLBL_CMPY_CD           = #glblCmpyCd#
            AND SMM.SER_NUM            = #serNum#
            AND SMM.EZCANCELFLAG       = '0'
            AND STC.GLBL_CMPY_CD       = #glblCmpyCd#
            AND SMM.OWNR_ACCT_NUM      = STC.SELL_TO_CUST_CD
            AND STC.EZCANCELFLAG       = '0'
    </statement>

<!-- START 2017/07/03 K.Kim [QC#18164, ADD] -->
    <statement id="existMdlNmSvcMachMstr" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)        AS CNT
        FROM
            MDL_NM          MN
           ,SVC_CONFIG_MSTR SCM
           ,SVC_MACH_MSTR   SMM
        WHERE
            MN.T_GLBL_CMPY_CD          = #glblCmpyCd#
            AND MN.T_MDL_NM            = #mdlNm#
            AND MN.EZCANCELFLAG        = '0'
            AND MN.T_MDL_ID            = SCM.MDL_ID
            AND SCM.GLBL_CMPY_CD       = #glblCmpyCd#
            AND SCM.EZCANCELFLAG       = '0'
            AND SCM.SVC_CONFIG_MSTR_PK = SMM.SVC_CONFIG_MSTR_PK
            AND SMM.GLBL_CMPY_CD       = #glblCmpyCd#
            AND SMM.SER_NUM            = #serNum#
            AND SMM.EZCANCELFLAG       = '0'
    </statement>
<!-- END 2017/07/03 K.Kim [QC#18164, ADD] -->
</sqlMap>
