<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWZC150001Query">

    <statement id="getForceDummyWhList" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
                  OLVS.DS_ORD_LINE_CATG_CD
                  , OLVS.SCD_BIZ_CTX_ATTRB_TXT
            FROM
                ORD_LINE_VAL_SET OLVS
            WHERE
                OLVS.GLBL_CMPY_CD           = #glblCmpyCd#
                AND OLVS.ORD_LINE_CTX_TP_CD = #forceDummyWh#
                AND OLVS.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getDefaultCarrCd" parameterClass="Map" resultClass="String">
        SELECT
                  CR.CARR_CD
            FROM
                SHPG_SVC_LVL_CARR_RELN CR
            WHERE
                CR.GLBL_CMPY_CD        = #glblCmpyCd#
                AND CR.CARR_SVC_LVL_CD = #carrSvcLvlCd#
                AND CR.EZCANCELFLAG    = '0'
                AND ROWNUM             = #rownum#
    </statement>

    <statement id="getDefaultCarrSvcLvl" parameterClass="Map" resultClass="String">
        SELECT
                  PD.DEF_CARR_SVC_LVL_CD
            FROM
                DS_ORD_TP_PROC_DFN      PD
                , FRT_COND_SVC_LVL_RELN SLR
            WHERE
                PD.GLBL_CMPY_CD         = #glblCmpyCd#
                AND PD.DS_ORD_TP_CD     = #dsOrdTpCd#
                AND PD.ACTV_FLG         = 'Y'
                AND PD.EFF_FROM_DT     &lt;= #slsDt#
                AND (PD.EFF_THRU_DT    &gt;= #slsDt#
                 OR PD.EFF_THRU_DT      IS NULL)
                AND PD.EZCANCELFLAG     = '0' 
                AND PD.GLBL_CMPY_CD     = SLR.GLBL_CMPY_CD 
                AND PD.LINE_BIZ_TP_CD   = SLR.LINE_BIZ_TP_CD 
                AND SLR.FRT_COND_CD     = #frtCondCd#
                AND SLR.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
                AND SLR.EZCANCELFLAG    = '0'
                AND ROWNUM              = #rownum#
    </statement>

    <statement id="getDefaultTrxCd" parameterClass="Map" resultClass="Map">
        SELECT
                  AAB.TRX_CD
                , AAB.TRX_RSN_CD
            FROM
                DS_ORD_LINE_PROC_DFN PD
                , AJE_ACCT_BAT       AAB
            WHERE
                PD.GLBL_CMPY_CD            = #glblCmpyCd#
                AND PD.DS_ORD_TP_CD        = #dsOrdTpCd#
                AND PD.DS_ORD_LINE_CATG_CD = #dsOrdLineCatgCd#
                AND PD.EZCANCELFLAG        = '0'
                AND PD.GLBL_CMPY_CD        = AAB.GLBL_CMPY_CD
                AND PD.AJE_ACCT_BAT_CD     = AAB.AJE_ACCT_BAT_CD
                AND AAB.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getCoaMdseTpList" parameterClass="Map" resultClass="String">
        SELECT
                  VS.COA_MDSE_TP_CD
            FROM
                MDSE_TP_VAL_SET VS
            WHERE
                VS.GLBL_CMPY_CD          = #glblCmpyCd#
                AND VS.MDSE_TP_CTX_TP_CD = #mainMach#
                AND VS.EZCANCELFLAG      = '0'
    </statement>

    <statement id="getDefPrcCatgCd" parameterClass="Map" resultClass="String">
        SELECT
                  PD.DEF_PRC_CATG_CD
            FROM
                DS_ORD_TP_PROC_DFN PD
            WHERE
                PD.GLBL_CMPY_CD     = #glblCmpyCd#
                AND PD.DS_ORD_TP_CD = #dsOrdTpCd#
                AND PD.ACTV_FLG     = 'Y'
                AND PD.EFF_FROM_DT &lt;= #slsDt#
                AND (
                    PD.EFF_THRU_DT &gt;= #slsDt#
                 OR PD.EFF_THRU_DT  IS NULL
                    )
                AND PD.EZCANCELFLAG = '0'
    </statement>

    <statement id="getSvcMachMstrPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                  MAX(SMM.SVC_MACH_MSTR_PK) SVC_MACH_MSTR_PK
            FROM
                SVC_MACH_MSTR SMM
            WHERE
                SMM.GLBL_CMPY_CD     = #glblCmpyCd#
                AND SMM.SER_NUM      = #serNum#
                AND SMM.MDSE_CD      LIKE #mdseCd#
                AND SMM.EZCANCELFLAG = '0'
    </statement>

    <statement id="getDefaultShipToInfo" parameterClass="Map" resultClass="Map">
        SELECT
                  STC.LOC_NM
                , STC.ADDL_LOC_NM
                , STC.FIRST_LINE_ADDR
                , STC.SCD_LINE_ADDR
                , STC.THIRD_LINE_ADDR
                , STC.FRTH_LINE_ADDR
                , STC.CTY_ADDR
                , STC.ST_CD
                , STC.PROV_NM
                , STC.POST_CD
                , STC.CTRY_CD
                , STC.FIRST_REF_CMNT_TXT
                , STC.SCD_REF_CMNT_TXT
                , C.CNTY_NM 
            FROM
                SHIP_TO_CUST STC
                , CNTY C 
            WHERE
                STC.GLBL_CMPY_CD        = #glblCmpyCd#
                AND STC.SHIP_TO_CUST_CD = #shipToCustCd#
                AND STC.EZCANCELFLAG    = '0' 
<!-- 2018/11/22 QC#29220 Mod Start -->
<!--            AND STC.GLBL_CMPY_CD    = C.GLBL_CMPY_CD --> 
<!--            AND STC.CNTY_PK         = C.CNTY_PK  -->
<!--            AND C.EZCANCELFLAG      = '0' -->
                AND STC.GLBL_CMPY_CD    = C.GLBL_CMPY_CD (+)
                AND STC.CNTY_PK         = C.CNTY_PK (+)
                AND C.EZCANCELFLAG (+)  = '0'
<!-- 2018/11/22 QC#29220 Mod End -->
    </statement>

    <statement id="getMdseItemStsInfo" parameterClass="Map" resultClass="Map">
        SELECT
                  MIS.CUST_ORD_ENTRY_AVAL_FLG
                , MIS.USED_ONLY_AVAL_FLG
                , MIS.WS_ORD_ENTRY_AVAL_FLG
                , MIS.CUST_RTRN_AVAL_FLG
            FROM
                MDSE            DMI
                , MDSE_ITEM_STS MIS
            WHERE
                DMI.GLBL_CMPY_CD         = #glblCmpyCd#
                AND DMI.MDSE_CD       LIKE #mdseCd#
                AND DMI.EZCANCELFLAG     = '0'
                AND DMI.GLBL_CMPY_CD     = MIS.GLBL_CMPY_CD
                AND DMI.MDSE_ITEM_STS_CD = MIS.MDSE_ITEM_STS_CD
                AND MIS.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getOrdProcTpInfo" parameterClass="Map" resultClass="Map">
        SELECT
                  OPT.ITRL_ORD_PROC_FLG
                , OPT.CUST_ORD_PROC_FLG
                , OPT.WS_ORD_PROC_FLG 
            FROM
                <isNotNull property="dsOrdLineCatgCd">
                DS_ORD_LINE_PROC_DFN    PD
                </isNotNull>
                <isNull property="dsOrdLineCatgCd">
                DS_ORD_TP_PROC_DFN      PD
                </isNull>
                , ORD_PROC_TP           OPT
            WHERE
                PD.GLBL_CMPY_CD            = #glblCmpyCd#
                AND PD.DS_ORD_TP_CD        = #dsOrdTpCd#
                <isNotNull property="dsOrdLineCatgCd">
                AND PD.DS_ORD_LINE_CATG_CD = #dsOrdLineCatgCd#
                </isNotNull>
                AND PD.EZCANCELFLAG        = '0'
                AND PD.GLBL_CMPY_CD        = OPT.GLBL_CMPY_CD
                AND PD.ORD_PROC_TP_CD      = OPT.ORD_PROC_TP_CD
                AND OPT.EFF_FROM_DT       &lt;= #slsDt#
                AND (
                    OPT.EFF_THRU_DT       &gt;= #slsDt#
                 OR OPT.EFF_THRU_DT       IS NULL
                    )
                AND OPT.ACTV_FLG           = 'Y'
                AND OPT.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getCostPctInfo" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                  S.MDSE_INVTY_COST_PCT
            FROM
                RTL_SWH RS
                , SWH   S
            WHERE
                RS.GLBL_CMPY_CD      = #glblCmpyCd#
                AND RS.RTL_SWH_CD    = #rtlSwhCd#
                AND RS.EFF_FROM_DT  &lt;= #slsDt#
                AND (
                    RS.EFF_THRU_DT  &gt;= #slsDt#
                 OR RS.EFF_THRU_DT  IS NULL
                    )
                AND RS.EZCANCELFLAG  = '0'
                AND RS.GLBL_CMPY_CD  = S.GLBL_CMPY_CD
                AND RS.RTL_SWH_CD    = S.RTL_SWH_CD
                AND S.EZCANCELFLAG   = '0'
    </statement>

    <statement id="getDsCpoDtlByCpoOrdNumAndDsOrdPosnNum" parameterClass="Map" resultClass="Map">
        SELECT
            DCD.CPO_ORD_NUM
            ,DCD.CPO_DTL_LINE_NUM
            ,DCD.CPO_DTL_LINE_SUB_NUM
        FROM
            CPO_DTL DCD
        WHERE
                DCD.GLBL_CMPY_CD = #glblCmpyCd#
            AND DCD.CPO_ORD_NUM = #cpoOrdNum#
            AND DCD.DS_ORD_POSN_NUM = #dsOrdPosnNum#
            AND DCD.EZCANCELFLAG = '0'
    </statement>

    <statement id="getDsCpoRtrnDtlByCpoOrdNumAndDsOrdPosnNum" parameterClass="Map" resultClass="Map">
        SELECT
            DCRD.CPO_ORD_NUM
            ,DCRD.DS_CPO_RTRN_LINE_NUM
            ,DCRD.DS_CPO_RTRN_LINE_SUB_NUM
        FROM
            DS_CPO_RTRN_DTL DCRD
        WHERE
                DCRD.GLBL_CMPY_CD = #glblCmpyCd#
            AND DCRD.CPO_ORD_NUM = #cpoOrdNum#
            AND DCRD.DS_ORD_POSN_NUM = #dsOrdPosnNum#
            AND DCRD.EZCANCELFLAG = '0'
    </statement>

    <statement id="getDefaultRetailSubWH" parameterClass="Map" resultClass="String">
        SELECT 
            RSW.RTL_SWH_CD
        FROM
            RTL_SWH RSW
        WHERE
                RSW.EZCANCELFLAG                    = '0'
            AND RSW.GLBL_CMPY_CD                    = #glblCmpyCd#
            AND RSW.RTL_WH_CD                       = #rtlWhCd#
            AND RSW.PRTY_LOC_FLG                    = #prtyLocFlg#
            AND RSW.EFF_FROM_DT                     &lt;= #slsDt#
            AND NVL(RSW.EFF_THRU_DT, '99991231')    &gt;= #slsDt#
            AND ROWNUM                              = 1
    </statement>

    <!-- 2018/05/20 S21_NA#25604 Del Start -->
    <!-- statement id="isExistOrdCatg" parameterClass="Map" resultClass="Integer" -->
<!--         SELECT -->
<!--             COUNT(OCBC.ORD_CATG_BIZ_CTX_PK) -->
<!--         FROM -->
<!--             ORD_CATG_BIZ_CTX OCBC -->
<!--         WHERE -->
<!--             OCBC.GLBL_CMPY_CD           = #glblCmpyCd# -->
<!--             AND OCBC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTpCd# -->
<!--             AND OCBC.EZCANCELFLAG       = '0' -->
<!--             AND ( -->
<!--                  ( -->
<!--                   OCBC.DS_ORD_CATG_CD    = #dsOrdCatgCd# -->
<!--                   AND OCBC.DS_ORD_TP_CD  IS NULL -->
<!--                   AND OCBC.DS_ORD_RSN_CD IS NULL -->
<!--                  ) -->
<!--                  <isNotNull property="dsOrdTpCd"> -->
<!--                  OR -->
<!--                  ( -->
<!--                   OCBC.DS_ORD_CATG_CD    = #dsOrdCatgCd# -->
<!--                   AND OCBC.DS_ORD_TP_CD  = #dsOrdTpCd# -->
<!--                   AND OCBC.DS_ORD_RSN_CD IS NULL -->
<!--                  ) -->
<!--                  </isNotNull> -->
<!--                  <isNotNull property="dsOrdTpCd"> -->
<!--                      <isNotNull property="dsOrdRsnCd"> -->
<!--                      OR -->
<!--                      ( -->
<!--                       OCBC.DS_ORD_CATG_CD    = #dsOrdCatgCd# -->
<!--                       AND OCBC.DS_ORD_TP_CD  = #dsOrdTpCd# -->
<!--                       AND OCBC.DS_ORD_RSN_CD = #dsOrdRsnCd# -->
<!--                      ) -->
<!--                      </isNotNull> -->
<!--                  </isNotNull> -->
<!--                 ) -->
    <!-- /statement -->
    <!-- 2018/05/20 S21_NA#25604 Del End -->

    <!-- 2016/03/16 S21_NA#5519 Add Start -->
    <statement id="isMultipleConfigId" parameterClass="Map" resultClass="BigDecimal">
    <!-- 2019/08/01 QC#52212 Mod Start -->
        SELECT
            SM.SVC_CONFIG_MSTR_PK
        FROM
           (
            SELECT
                SMM.SVC_CONFIG_MSTR_PK
            FROM
                SVC_MACH_MSTR SMM
            WHERE
                SMM.GLBL_CMPY_CD = #glblCmpyCd#
                <!-- 2017/02/23 UPD START -->
                <!-- <iterate property="serNumList" var="serNumList[]" open=" AND SER_NUM IN (" close=")"  conjunction=",">
                    #serNumList[]#
                </iterate> -->
                AND (SMM.SER_NUM, SMM.MDSE_CD) IN
                <iterate property="serNumList" var="serNumMap[]" open="((" close="))" conjunction="),(">
                    #serNumMap[].serNum# , #serNumMap[].mdseCd#
                </iterate>
                <!-- 2017/02/23 UPD E N D -->
                AND SMM.EZCANCELFLAG = '0'
           ) SM
        WHERE
            SM.SVC_CONFIG_MSTR_PK IS NOT NULL
        GROUP BY
    <!--    SMM.SVC_CONFIG_MSTR_PK -->
            SM.SVC_CONFIG_MSTR_PK
    <!-- 2019/08/01 QC#52212 Mod End -->
    <!-- 2016/03/16 S21_NA#5519 Add Start -->
    </statement>

    <!-- 2016/04/18 S21_NA#5321-2 Add Start -->
    <statement id="getMdlIdNmBySvcConfigMstr" parameterClass="Map" resultClass="Map">
        SELECT
            SCM.MDL_ID
            ,DM.MDL_DESC_TXT
        FROM
            SVC_CONFIG_MSTR SCM
            ,DS_MDL DM
        WHERE
            SCM.GLBL_CMPY_CD            = #glblCmpyCd#
            AND SCM.SVC_CONFIG_MSTR_PK  = #svcConfigMstrPk#
            AND SCM.EZCANCELFLAG        = '0'

            AND SCM.GLBL_CMPY_CD    = DM.GLBL_CMPY_CD(+)
            AND SCM.MDL_ID          = DM.MDL_ID(+)
            AND DM.EZCANCELFLAG(+)  = '0'
    </statement>
    <!-- 2016/04/18 S21_NA#5321-2 Add End -->
    <!-- 2016/04/19 Add #7263 Start -->
    <statement id="getCpoDtlCount" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(CD.CPO_ORD_NUM)
        FROM
            CPO_DTL CD
        WHERE
            CD.GLBL_CMPY_CD = #glblCmpyCd#
        AND CD.CPO_ORD_NUM  = #cpoOrdNum#
        AND CD.ORD_LINE_STS_CD &lt;&gt; #ordLineStsCd#   
        AND CD.EZCANCELFLAG = '0'
        GROUP BY
            CD.CPO_ORD_NUM
    <!-- 2016/04/19 Add #7263 Start -->
    </statement>

    <!--  2016/05/09 Add S21_NA#7750 Start -->
    <statement id="getComponentExistsFlg" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
                  OLVS.DS_ORD_LINE_CATG_CD
                , OLVS.FIRST_BIZ_CTX_ATTRB_TXT
                , OLVS.SCD_BIZ_CTX_ATTRB_TXT
            FROM
                ORD_LINE_VAL_SET OLVS
            WHERE
                OLVS.GLBL_CMPY_CD            = #glblCmpyCd#
                AND OLVS.ORD_LINE_CTX_TP_CD  = #ComponentExistsFlg#
                AND OLVS.EZCANCELFLAG        = '0'
    </statement>
    <!--  2016/05/09 Add S21_NA#7750 End -->

    <!-- 2016/07/12 S21_NA#9426-4 Add Start -->
    <statement id="getShpgPlnCountByStatus" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(SP.SHPG_PLN_NUM) PRT_INV_CNT
        FROM
            SHPG_PLN SP
        WHERE
            SP.GLBL_CMPY_CD = #glblCmpyCd#
            AND SP.TRX_HDR_NUM = #cpoOrdNum#
            AND SP.SHPG_STS_CD = #shpgStsCd#
            AND EZCANCELFLAG = '0'
    </statement>
    <!-- 2016/07/12 S21_NA#9426-4 Add End -->
    <!-- 2016/07/21 S21_NA#9228 Add Start -->
    <statement id="getOrdTotDealNetAmt" parameterClass="Map" resultClass="Map">
        SELECT 
            DCV.ORD_HDR_STS_CD
            , DCV.ORD_TOT_DEAL_NET_AMT
        FROM
            CPO_V DCV
        WHERE
            DCV.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DCV.CPO_ORD_NUM      = #cpoOrdNum#
            AND DCV.EZCANCELFLAG     = '0'
    </statement>
    <!-- 2016/07/21 S21_NA#9228 Add End -->

    <!-- S21_NA#11280 add start -->
    <statement id="getITTOutboundHoldListForRelease" parameterClass="Map" resultClass="Map">
        SELECT
             H.HLD_PK
            ,H.HLD_RSN_CD
            ,H.CPO_ORD_NUM
            ,H.CPO_DTL_LINE_NUM
            ,H.CPO_DTL_LINE_SUB_NUM
            ,H.SHPG_PLN_NUM
            ,H.REL_FLG
        FROM
             HLD          H
            ,CPO_DTL      DCD
            ,ORD_LINE_SRC OLS
        WHERE
                H.EZCANCELFLAG         = '0'
            AND H.GLBL_CMPY_CD         = #glblCmpyCd#
            AND H.HLD_RSN_CD           = #hldRsnCd#
            AND H.REL_FLG              = 'N'
            AND H.CPO_ORD_NUM          = #cpoOrdNum#
            AND H.EZCANCELFLAG         = DCD.EZCANCELFLAG
            AND H.GLBL_CMPY_CD         = DCD.GLBL_CMPY_CD
            AND H.CPO_ORD_NUM          = DCD.CPO_ORD_NUM
            AND H.CPO_DTL_LINE_NUM     = DCD.CPO_DTL_LINE_NUM
            AND H.CPO_DTL_LINE_SUB_NUM = DCD.CPO_DTL_LINE_SUB_NUM
            AND DCD.EZCANCELFLAG       = OLS.EZCANCELFLAG
            AND DCD.GLBL_CMPY_CD       = OLS.GLBL_CMPY_CD
            AND DCD.ORD_LINE_SRC_CD    = OLS.ORD_LINE_SRC_CD
            AND OLS.ITT_HLD_FLG        = 'N'
    </statement>
    <!-- S21_NA#11280 add end -->

    <!-- 2016/08/10 S21_NA#5394 Add Start -->
    <statement id="getWfTarget" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             COUNT(HLD_PK) AS WF_CNT
        FROM
             HLD                 H
            ,CPO                 DC
            ,HLD_RSN             DHR
        WHERE
                H.GLBL_CMPY_CD            = #glblCmpyCd#
            AND H.CPO_ORD_NUM             = #cpoOrdNum#
            AND H.REL_FLG                 = #relFlgN#
            AND H.EZCANCELFLAG            = '0'
            
            AND H.GLBL_CMPY_CD            = DC.GLBL_CMPY_CD
            AND H.CPO_ORD_NUM             = DC.CPO_ORD_NUM
            AND DC.EZCANCELFLAG           = '0'
            
            AND H.GLBL_CMPY_CD            = DHR.GLBL_CMPY_CD
            AND H.HLD_RSN_CD              = DHR.HLD_RSN_CD
            AND DHR.HLD_EFF_FROM_DT   <![CDATA[<=]]> #slsDt#
            AND (DHR.HLD_EFF_TO_DT       IS NULL
                OR (
                    DHR.HLD_EFF_TO_DT    IS NOT NULL
                AND DHR.HLD_EFF_TO_DT <![CDATA[>=]]> #slsDt#
                )
            )
            AND DHR.ORD_PROC_NODE_CD     IS NOT NULL
            <iterate property="ordProcNodeCdList" var="ordProcNodeCdList[]" open=" AND DHR.ORD_PROC_NODE_CD IN (" close=")"  conjunction=",">
                #ordProcNodeCdList[]#
            </iterate>
            AND DHR.EZCANCELFLAG          = '0'
    </statement>
    <!-- 2016/08/10 S21_NA#5394 Add End -->


    <!-- S21_NA#11630 Add START -->
    <statement id="isEnableToCancelForOutbound" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                COUNT(*)
        FROM
                SHPG_PLN SP
        WHERE
             SP.GLBL_CMPY_CD        = #glblCmpyCd#
        AND SP.EZCANCELFLAG        = '0'
        AND SP.TRX_HDR_NUM         = #trxHdrNum#
        AND SP.SHPG_STS_CD NOT IN
        <iterate property="shpgStsCdList" var="shpgStsCd[]" open="(" close=")" conjunction=",">
           #shpgStsCd[]#
        </iterate>
    </statement>

    <statement id="isEnableToCancelForInbound" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                COUNT(*)
        FROM
                DS_CPO_RTRN_DTL DCRD
        WHERE
            DCRD.GLBL_CMPY_CD        = #glblCmpyCd#
        AND DCRD.EZCANCELFLAG        = '0'
        AND DCRD.CPO_ORD_NUM         = #cpoOrdNum#
        AND DCRD.RTRN_LINE_STS_CD NOT IN
        <iterate property="rtrnLineStsCdList" var="rtrnLineStsCd[]" open="(" close=")" conjunction=",">
           #rtrnLineStsCd[]#
        </iterate>
    </statement>
    <!-- S21_NA#11630 Add END -->
    <statement id="getConvProcStsCd" parameterClass="Map" resultClass="BigDecimal">
        SELECT COUNT(*) 
        FROM   DS_ORD_LINE_PROC_DFN PROC
           ,   ORD_PROC_TP DPT
        WHERE PROC.GLBL_CMPY_CD         = #glblCmpyCd#
        AND   PROC.EZCANCELFLAG         = '0'
        AND   PROC.DS_ORD_TP_CD         = #dsOrdTpCd#
        AND   PROC.DS_ORD_LINE_CATG_CD  = #dsOrdLineCatgCd#
        AND   PROC.EFF_FROM_DT          &lt;= #slsDt#
        AND  ( PROC.EFF_THRU_DT         &gt;= #slsDt# OR PROC.EFF_THRU_DT  IS NULL )
        AND   PROC.GLBL_CMPY_CD         = DPT.GLBL_CMPY_CD
        AND   PROC.EZCANCELFLAG         = DPT.EZCANCELFLAG
        AND   PROC.ORD_PROC_TP_CD       = DPT.ORD_PROC_TP_CD
        AND   DPT.CONV_PROC_TP_TXT      IN('LOAN_TO_SLS', #rentalToSales#)
        AND   DPT.EFF_FROM_DT           &lt;= #slsDt#
        AND  ( DPT.EFF_THRU_DT          &gt;= #slsDt# OR DPT.EFF_THRU_DT  IS NULL )
    </statement>

    <!-- 2017/06/20 S21_NA#19288-2 Add Start -->
    <statement id="hasOpenReturnDtl" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(R.GLBL_CMPY_CD)
        FROM
            DS_CPO_RTRN_DTL R
        WHERE
            R.GLBL_CMPY_CD          = #glblCmpyCd#
            AND R.CPO_ORD_NUM       = #cpoOrdNum#
            AND R.RTRN_LINE_STS_CD NOT IN (#closed#, #cancelled#)
            AND R.EZCANCELFLAG = '0'
    </statement>

    <statement id="hasOpenCpoDtl" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(CD.GLBL_CMPY_CD)
        FROM
            CPO_DTL CD
        WHERE
            CD.GLBL_CMPY_CD          = #glblCmpyCd#
            AND CD.CPO_ORD_NUM       = #cpoOrdNum#
            AND CD.ORD_LINE_STS_CD NOT IN (#closed#, #cancelled#)
            AND CD.EZCANCELFLAG = '0'
    </statement>
    <!-- 2017/06/20 S21_NA#19288-2 Add End -->

    <!-- 2017/09/13 S21_NA#16346 Add Start -->
    <statement id="getInBoundLineCatg" parameterClass="Map" resultClass="String">
        SELECT
            A.*
        FROM
            (
            SELECT 
                INBD_ORD_LINE_CATG_CD
            FROM 
                (
                SELECT 
                     OLCR.INBD_ORD_LINE_CATG_CD INBD_ORD_LINE_CATG_CD
                    ,1                          RESULT_NUM
                FROM
                    ORD_LINE_CATG_RELN      OLCR
                WHERE
                    OLCR.GLBL_CMPY_CD           = #glblCmpyCd#
                AND OLCR.OTBD_ORD_CATG_CD       = #ordCatgCd#
                AND OLCR.OTBD_ORD_LINE_CATG_CD  = #ordLineCatgCd#
                AND OLCR.EZCANCELFLAG           = '0'

                UNION ALL
                SELECT
                     OLCR.INBD_ORD_LINE_CATG_CD INBD_ORD_LINE_CATG_CD
                    ,2                          RESULT_NUM
                FROM
                    ORD_LINE_CATG_RELN      OLCR
                WHERE
                    OLCR.GLBL_CMPY_CD           = #glblCmpyCd#
                AND OLCR.OTBD_ORD_CATG_CD       = #astrCatgCd#
                AND OLCR.OTBD_ORD_LINE_CATG_CD  = #ordLineCatgCd#
                AND OLCR.EZCANCELFLAG           = '0'
               )    RESULT
               ,DS_ORD_LINE_PROC_DFN    DOLP
           WHERE
                    DOLP.GLBL_CMPY_CD(+)        = #glblCmpyCd#
                AND RESULT.INBD_ORD_LINE_CATG_CD  = DOLP.DS_ORD_LINE_CATG_CD(+)
                AND DOLP.DS_ORD_TP_CD(+)        = #dsOrdTpCd#
                AND DOLP.EZCANCELFLAG(+)        = '0'
                    
            ORDER BY 
                RESULT.RESULT_NUM
               ,DOLP.RMA_PRIM_LINE_CATG_FLG DESC NULLS LAST
               ,RESULT.INBD_ORD_LINE_CATG_CD
        )   A
        WHERE 
            ROWNUM = #rowNum#
    </statement>
    <statement id="getCarrSvcLvlCd" parameterClass="Map" resultClass="String">
        SELECT
            CARR_SVC_LVL_CD
        FROM
            (
             SELECT 
                 SSLCR.CARR_SVC_LVL_CD
             FROM
                 SHPG_SVC_LVL_CARR_RELN SSLCR
             WHERE
                 SSLCR.GLBL_CMPY_CD        = #glblCmpyCd#
                 AND SSLCR.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
                 AND SSLCR.CARR_CD         = #carrCd#
                 AND SSLCR.EZCANCELFLAG    = '0'
             ORDER BY
                 SSLCR.CARR_SVC_LVL_CD DESC
            )
        WHERE
            ROWNUM = #rowNum#
    </statement>
    <!-- 2017/09/13 S21_NA#16346 Add End -->

    <!-- 2017/09/13 S21_NA#16347 Add End -->
    <statement id="getConvTrxCd" parameterClass="Map" resultClass="Map">
        SELECT
             CONV.TO_TRX_CD
            ,CONV.TO_TRX_RSN_CD
        FROM
            CR_REBIL_TRX_RSN_CONV  CONV
        WHERE
                CONV.GLBL_CMPY_CD     = #glblCmpyCd#
            AND CONV.FROM_TRX_CD      = #fromTrxCd#
            AND CONV.FROM_TRX_RSN_CD  = #fromTrxRsnCd#
            AND CONV.EZCANCELFLAG     = '0'
    </statement>
    <!-- 2017/09/13 S21_NA#16347 Add End -->

    <!-- 2017/11/09 S21_NA#22091 Add Start -->
    <statement id="getDiChkMandtRec" parameterClass="Map" resultClass="Map">
        SELECT
            DMCD.DI_MND_CHK_TBL_NM
            , DMCD.DI_MND_CHK_COL_NM
        FROM
            DS_ORD_TP_PROC_DFN PROC
            , DS_DI_CHK_ORD_CATG_DFN CATG
            , DS_CPO_DI_CHK_MSTR MSTR
            , DI_MND_CHK_DFN DMCD
        WHERE
            PROC.GLBL_CMPY_CD = #glblCmpyCd#
            AND PROC.DS_ORD_TP_CD = #dsOrdTpCd#
            AND PROC.DI_CHK_NODE_USG_FLG = 'Y'
            AND PROC.ACTV_FLG = 'Y'
            AND PROC.EFF_FROM_DT <![CDATA[<=]]> #slsDt#
            AND (
                PROC.EFF_THRU_DT >= #slsDt#
                OR PROC.EFF_THRU_DT IS NULL
            )
            AND PROC.EZCANCELFLAG = '0'
            AND PROC.GLBL_CMPY_CD = CATG.GLBL_CMPY_CD
            AND PROC.DS_ORD_TP_CD = CATG.DS_ORD_TP_CD
            AND CATG.DS_ORD_CATG_CD = #dsOrdCatgCd#
            AND CATG.DI_CHK_INCL_FLG = 'Y'
            AND CATG.EFF_FROM_DT <![CDATA[<=]]> #slsDt#
            AND (
                CATG.EFF_TO_DT >= #slsDt#
                OR CATG.EFF_TO_DT IS NULL
            )
            AND CATG.EZCANCELFLAG = '0'
            AND CATG.GLBL_CMPY_CD = MSTR.GLBL_CMPY_CD
            AND CATG.DI_CHK_CD = MSTR.DI_CHK_CD
            AND MSTR.EFF_FROM_DT <![CDATA[<=]]> #slsDt#
            AND (
                MSTR.EFF_TO_DT <![CDATA[>=]]> #slsDt#
                OR MSTR.EFF_TO_DT IS NULL
            )
            AND MSTR.DI_CHK_LVL_CD = #diChkLvlCdLine#
            AND MSTR.EZCANCELFLAG = '0'
            AND PROC.GLBL_CMPY_CD = MSTR.GLBL_CMPY_CD
            AND PROC.DI_CHK_NODE_PRFL_CD = MSTR.DI_CHK_NODE_PRFL_CD
            AND CATG.GLBL_CMPY_CD = DMCD.GLBL_CMPY_CD
            AND CATG.DI_MND_CHK_PRFL_CD = DMCD.DI_MND_CHK_PRFL_CD
            AND DMCD.EZCANCELFLAG = '0'
        ORDER BY
            DMCD.DI_MND_CHK_TBL_NM
    </statement>
    <!-- 2017/11/09 S21_NA#22091 Add End -->
    <!-- 2018/01/11 S21_NA#23329 Add Start -->
    <statement id="isModelChildItem" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(1) CNT
        FROM
            DS_MDL_CONFIG DMC
        WHERE
            DMC.GLBL_CMPY_CD = #glblCmpyCd#
            <iterate property="childMdseList" var="childMdseList[]" open=" AND CHILD_MDSE_CD IN (" close=")"  conjunction=",">
                #childMdseList[]#
            </iterate>
            AND DMC.EZCANCELFLAG = '0'
    </statement>
    <!-- 2018/01/11 S21_NA#23329 Add End -->
    <!-- 2018/01/31 QC#23563 add start -->
    <statement id="getDefaultIstlDiv" parameterClass="Map" resultClass="String">
        SELECT
            SBR.SVC_LINE_BIZ_CD
        FROM
            DS_ORD_TP_PROC_DFN DPD
            ,SVC_LINE_BIZ_RELN SBR
        WHERE
                DPD.GLBL_CMPY_CD = #glblCmpyCd#
            AND DPD.EZCANCELFLAG = '0'
            AND DPD.DS_ORD_TP_CD = #dsOrdTpCd#

            AND DPD.GLBL_CMPY_CD = SBR.GLBL_CMPY_CD
            AND DPD.EZCANCELFLAG = SBR.EZCANCELFLAG
            AND DPD.LINE_BIZ_TP_CD = SBR.LINE_BIZ_TP_CD
    </statement>
    <!-- 2018/01/31 QC#23563 add start -->
    <!-- 2018/03/20 S21_NA#24698 Add Start -->
    <statement id="getSvcConfItemInfo" parameterClass="Map" resultClass="Map">
        SELECT
            SMM.SVC_MACH_TP_CD      AS SVC_MACH_TP_CD
           ,SMM.MDSE_CD             AS MDSE_CD
           ,M.INSTL_BASE_CTRL_FLG   AS INSTL_BASE_CTRL_FLG
           ,MT.MDSE_TP_CTX_TP_CD    AS MDSE_TP_CTX_TP_CD
        FROM
            SVC_MACH_MSTR       SMM
            ,MDSE               M
            ,MDSE_TP_VAL_SET    MT
        WHERE
            SMM.GLBL_CMPY_CD            = #glblCmpyCd#
            AND SMM.SVC_CONFIG_MSTR_PK  = #configId#
            AND SMM.EZCANCELFLAG        = '0'

            AND SMM.GLBL_CMPY_CD        = M.GLBL_CMPY_CD
            AND SMM.MDSE_CD             = M.MDSE_CD
            AND M.EZCANCELFLAG          = '0'

            AND M.GLBL_CMPY_CD          = MT.GLBL_CMPY_CD(+)
            AND M.COA_MDSE_TP_CD        = MT.COA_MDSE_TP_CD(+)
            AND MT.MDSE_TP_CTX_TP_CD(+) = #mdseTpCtxTpCd#
            AND MT.EZCANCELFLAG(+)      = '0'
        ORDER BY
            SMM.SVC_MACH_MSTR_PK
    </statement>

    <statement id="asItemSoftModelParent" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(1) AS CNT
        FROM
            DS_MDL_CONFIG DMC
            ,DS_MDL DM
        WHERE
            DMC.GLBL_CMPY_CD            = #glblCmpyCd#
            AND (
                DMC.PRNT_MDSE_CD        = #mdseCdFull#
                OR DMC.PRNT_MDSE_CD     = #mdseCd#
            )
            AND DMC.EFF_FROM_DT         <![CDATA[<=]]> #slsDt#
            AND (DMC.EFF_THRU_DT IS NULL OR DMC.EFF_THRU_DT <![CDATA[>=]]> #slsDt#)
            AND DMC.EZCANCELFLAG        = '0'

            AND DMC.GLBL_CMPY_CD        = DM.GLBL_CMPY_CD
            AND DMC.MDL_ID              = DM.MDL_ID
            AND DM.SVC_MDL_TP_CD        = #mdlTpSoft#
            AND DM.EZCANCELFLAG         = '0'
    </statement>
    <!-- 2018/03/20 S21_NA#24698 Add End -->
    
    <!-- 2018/06/14 S21_NA#24294 Add Start -->
    <statement id="getMdseItemStsFlagInfo" parameterClass="Map" resultClass="Map">
        SELECT
                  MIS.CUST_ORD_ENTRY_AVAL_FLG
                , MIS.USED_ONLY_AVAL_FLG
                , MIS.WS_ORD_ENTRY_AVAL_FLG
                , MIS.CUST_RTRN_AVAL_FLG
                , MIS.MDSE_ITEM_STS_CD
                , MIS.PRCH_AVAL_FLG  <!-- 2018/08/24 S21_NA#27840 Add -->
            FROM
                MDSE_ITEM_STS MIS
            WHERE
                MIS.GLBL_CMPY_CD         = #glblCmpyCd#
                AND MIS.EZCANCELFLAG     = '0'
    </statement>
    <!-- 2018/06/14 S21_NA#24294 Add Start -->
    <!-- 2018/10/16 S21_NA#28772 Add Start -->
    <statement id="getSvcConfig" parameterClass="Map" resultClass="Map">
        SELECT
             SER_NUM
           , MDSE_CD
           , SVC_MACH_MSTR_PK
           , RANK
        FROM (
            SELECT
                SCM.SVC_CONFIG_MSTR_PK          SVC_CONFIG_MSTR_PK
               ,SMM.SER_NUM                     SER_NUM
               ,SMM.MDSE_CD                     MDSE_CD
               ,SMM.SVC_MACH_USG_STS_CD         SVC_MACH_USG_STS_CD
               ,SMM.SVC_MACH_MSTR_STS_CD        SVC_MACH_MSTR_STS_CD
               ,SMM.SVC_MACH_MSTR_PK            SVC_MACH_MSTR_PK
               ,SMM.SVC_MACH_TP_CD              SVC_MACH_TP_CD
               ,RANK() OVER(
                   PARTITION BY DCD.SVC_MACH_MSTR_PK
                   ORDER BY 
                       NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT) DESC
                       ,DECODE(DC.DS_CONTR_CATG_CD, #warranty#, 2, 1)
                       ,DCD.DS_CONTR_PK DESC
               ) RANK
            FROM
                SVC_MACH_MSTR           SMM
               ,SVC_CONFIG_MSTR         SCM
               ,DS_CONTR_DTL            DCD
               ,DS_CONTR                DC
            WHERE
                SMM.GLBL_CMPY_CD         = #glblCmpyCd#
            AND SMM.SVC_CONFIG_MSTR_PK   = #svcConfigMstrPk#
            AND SMM.EZCANCELFLAG         = '0'
            AND SMM.GLBL_CMPY_CD         = SCM.GLBL_CMPY_CD(+)
            AND SMM.SVC_CONFIG_MSTR_PK   = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.EZCANCELFLAG(+)      = '0'
            AND SMM.GLBL_CMPY_CD         = DCD.GLBL_CMPY_CD(+)
            AND SMM.SVC_MACH_MSTR_PK     = DCD.SVC_MACH_MSTR_PK(+)
            AND DCD.CONTR_EFF_FROM_DT(+) &lt;= #slsDate#
            AND NVL(DCD.CONTR_CLO_DT(+), DCD.CONTR_EFF_THRU_DT(+)) &gt;= #slsDate#
            AND DCD.DS_CONTR_DTL_STS_CD(+) NOT IN (#dsContrDtlStsCanc#)
            AND DCD.EZCANCELFLAG(+)      = '0'
            AND DCD.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD(+)
            AND DCD.DS_CONTR_PK          = DC.DS_CONTR_PK(+)
            AND DC.EZCANCELFLAG(+)       = '0'
            ORDER BY
                SMM.SVC_CONFIG_MSTR_PK
               ,SMM.SVC_MACH_TP_CD
               ,SMM.SVC_MACH_MSTR_PK
       ) A
       WHERE
           RANK  = 1
    </statement>

    <!-- START 2018/11/28 Hd.Sugawara [QC#29252,ADD] -->
    <statement id="getDsTrxRuleTpCd" parameterClass="Map" resultClass="Map">
        SELECT
                C.FIRST_BIZ_CTX_ATTRB_TXT
        FROM
                ORD_CATG_BIZ_CTX C
        WHERE
                C.GLBL_CMPY_CD       = #glblCmpyCd#
            AND C.EZCANCELFLAG       = '0'
            AND C.ORD_CATG_CTX_TP_CD IN (#ordCatgCtxTpCd01# , #ordCatgCtxTpCd02#)
            AND C.DS_ORD_CATG_CD     = #dsOrdCatgCd#
            <isNotNull property="dsOrdTpCd">
            AND (C.DS_ORD_TP_CD      IS NULL
                OR C.DS_ORD_TP_CD    = #dsOrdTpCd#)
            </isNotNull>
            <isNotNull property="dsOrdRsnCd">
            AND (C.DS_ORD_RSN_CD     IS NULL
                OR C.DS_ORD_RSN_CD   = #dsOrdRsnCd#)
            </isNotNull>
    </statement>
    <!-- END 2018/11/28 Hd.Sugawara [QC#29252,ADD] -->
    <!-- 2019/02/22 S21_NA#30449 Add Start -->
    <statement id="getOrdCatgBizCtx" parameterClass="Map" resultClass="String">
        SELECT 
                #flgY#
          FROM
                ORD_CATG_BIZ_CTX OCBC
         WHERE
                OCBC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND OCBC.EZCANCELFLAG        = '0'
            AND OCBC.ORD_CATG_CTX_TP_CD  = #ordCatgCtxTpCd#
        <isNotNull property="dsOrdCatgCd">
            AND (OCBC.DS_ORD_CATG_CD = #dsOrdCatgCd# OR OCBC.DS_ORD_CATG_CD IS NULL)
        </isNotNull>
        <isNull property="dsOrdCatgCd">
            AND OCBC.DS_ORD_CATG_CD IS NULL
        </isNull>
        <isNotNull property="dsOrdTpCd">
            AND (OCBC.DS_ORD_TP_CD = #dsOrdTpCd# OR OCBC.DS_ORD_TP_CD IS NULL)
        </isNotNull>
        <isNull property="dsOrdTpCd">
            AND OCBC.DS_ORD_TP_CD IS NULL
        </isNull>
    </statement>
    <!-- 2019/02/22 S21_NA#30449 Add End -->
    <!-- 2019/10/02 S21_NA#52988 Add Start -->
    <statement id="isExistsSplyReln" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            MDSE           A
        WHERE
                A.GLBL_CMPY_CD     = #glblCmpyCd#
            AND A.MDSE_CD          = #mdseCd#
            AND A.EZCANCELFLAG     = '0'
            AND EXISTS (
                SELECT
                    1
                FROM
                    DS_MDL_SPLY_RELN X
                WHERE
                        X.GLBL_CMPY_CD     = A.GLBL_CMPY_CD
                    AND X.MDSE_CD          = A.MDSE_CD
                    <isNotNull property="mdlId">
                    AND X.MDL_ID           = #mdlId#
                    </isNotNull>
                    AND X.EZCANCELFLAG     = '0'
            )
            AND ROWNUM           = 1
    </statement>
    <statement id="isExistsSplyRelnForOrdTakeMdse" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             ORD_TAKE_MDSE A
            ,MDSE          B
        WHERE
                A.GLBL_CMPY_CD     = #glblCmpyCd#
            AND A.ORD_TAKE_MDSE_CD = #mdseCd#
            AND A.EZCANCELFLAG     = '0'
            AND A.GLBL_CMPY_CD     = B.GLBL_CMPY_CD
            AND A.MDSE_CD          = B.MDSE_CD
            AND B.EZCANCELFLAG     = '0'
            AND EXISTS (
                SELECT
                    1
                FROM
                    DS_MDL_SPLY_RELN X
                WHERE
                        X.GLBL_CMPY_CD     = A.GLBL_CMPY_CD
                    AND X.ORD_TAKE_MDSE_CD = A.ORD_TAKE_MDSE_CD
                    <isNotNull property="mdlId">
                    AND X.MDL_ID           = #mdlId#
                    </isNotNull>
                    AND X.EZCANCELFLAG     = '0'
            )
            AND ROWNUM           = 1
    </statement>
    <!-- 2019/10/02 S21_NA#52988 Add End -->

    <!-- START 2023/05/11 T.Doi [CSA-QC#61246, ADD] -->
    <statement id="getPrchReqDtlKey" parameterClass="Map" resultClass="Map">
    SELECT
         PRD.PRCH_REQ_NUM
        ,PRD.PRCH_REQ_LINE_NUM
        ,PRD.PRCH_REQ_LINE_SUB_NUM
	    ,CD.CPO_DTL_LINE_NUM
	    ,CD.CPO_DTL_LINE_SUB_NUM
    FROM
        CPO                     C
       ,CPO_DTL                 CD
       ,DS_IMPT_ORD             DIO
       ,DS_IMPT_ORD_DTL         DIOD
       ,PRCH_REQ                PR
       ,PRCH_REQ_DTL            PRD
    WHERE
            C.GLBL_CMPY_CD                         = #glblCmpyCd#
        AND C.EZCANCELFLAG                         = '0'
        AND C.GLBL_CMPY_CD                         = CD.GLBL_CMPY_CD
        AND CD.EZCANCELFLAG                        = '0'
        AND C.GLBL_CMPY_CD                         = DIO.GLBL_CMPY_CD
        AND DIO.EZCANCELFLAG                       = '0'
        AND DIO.GLBL_CMPY_CD                       = DIOD.GLBL_CMPY_CD
        AND DIOD.EZCANCELFLAG                      = '0'
        AND DIO.GLBL_CMPY_CD                       = PR.GLBL_CMPY_CD
        AND PR.EZCANCELFLAG                        = '0'
        AND PR.GLBL_CMPY_CD                        = PRD.GLBL_CMPY_CD
        AND PRD.EZCANCELFLAG                       = '0'
        AND C.CPO_ORD_NUM                          = #cpoOrdNum#
        AND C.CPO_ORD_NUM                          = CD.CPO_ORD_NUM
        AND CD.ORD_LINE_STS_CD                     = #crdLineStsCd#
        AND C.ORD_SRC_REF_NUM                      = DIO.ORD_SRC_REF_NUM
        AND DIO.DS_IMPT_ORD_PK                     = DIOD.DS_IMPT_ORD_PK
        AND CD.ORD_SRC_REF_LINE_NUM                = DIOD.ORD_SRC_REF_LINE_NUM
        AND CD.ORD_SRC_REF_LINE_SUB_NUM            = DIOD.ORD_SRC_REF_LINE_SUB_NUM
        AND DIO.ORD_SRC_REF_NUM                    = PR.PRCH_REQ_NUM
        AND PR.PRCH_REQ_NUM                        = PRD.PRCH_REQ_NUM
        AND DIOD.ORD_SRC_REF_LINE_NUM              = PRD.PRCH_REQ_LINE_NUM
        AND DIOD.ORD_SRC_REF_LINE_SUB_NUM          = PRD.PRCH_REQ_LINE_SUB_NUM
        AND NVL(CD.CPO_SRC_TP_CD, C.CPO_SRC_TP_CD) = #cpoSrcTpCd#
        AND PRD.PRCH_REQ_LINE_STS_CD               NOT IN (#prchReqLineStsCd01# , #prchReqLineStsCd02#)
    </statement>
    <!-- END 2023/05/11 T.Doi [CSA-QC#61246, ADD] -->

    <!-- 2023/09/05 K.Watanabe QC#53408 Add Start -->
    <statement id ="getDefaultAccessoryInstTypeWithConfNum" parameterClass="Map"  resultClass="Map">
        SELECT 
            SIR.SVC_ISTL_RULE_NUM
        FROM 
            DS_CPO_CONFIG              DCC
           ,CPO_DTL                    CPOD
           ,MDSE                       MDSE
           ,SVC_ISTL_RULE              SIR
        WHERE 
            DCC.EZCANCELFLAG           = '0'
        AND DCC.GLBL_CMPY_CD           = #glblCmpyCd#
        AND DCC.CPO_ORD_NUM            = #cpoOrdNum#
        AND DCC.DS_ORD_POSN_NUM        = #dsOrdPosnNum#
        AND DCC.CONFIG_CATG_CD         = #ConfigCatgCd#
        <iterate property="configTpCdList" var="configTpCd[]" open="AND DCC.CONFIG_TP_CD IN (" close=")" conjunction=",">
            #configTpCd[]#
        </iterate>
        AND DCC.GLBL_CMPY_CD           = CPOD.GLBL_CMPY_CD
        AND DCC.DS_CPO_CONFIG_PK       = CPOD.DS_CPO_CONFIG_PK
        AND CPOD.EZCANCELFLAG          = '0'
        AND NOT EXISTS (
            SELECT
                1
            FROM
                CPO_DTL                CPOD
            WHERE
                DCC.CONFIG_TP_CD       = 'O02'
            AND DCC.GLBL_CMPY_CD       = CPOD.GLBL_CMPY_CD
            AND DCC.DS_CPO_CONFIG_PK   = CPOD.DS_CPO_CONFIG_PK
            AND CPOD.EZCANCELFLAG      = '0'
            AND CPOD.BASE_CMPT_FLG     = #baseCmptFlg#
            AND ROWNUM                 = 1
        )
        AND CPOD.GLBL_CMPY_CD          = MDSE.GLBL_CMPY_CD
        AND (
            CPOD.MDSE_CD = MDSE.MDSE_CD
                OR EXISTS (
                    SELECT
                        MDSE.MDSE_CD
                    FROM
                        ORD_TAKE_MDSE OTM
                    WHERE
                        CPOD.GLBL_CMPY_CD = OTM.GLBL_CMPY_CD
                    AND CPOD.MDSE_CD      = OTM.ORD_TAKE_MDSE_CD
                    AND OTM.MDSE_CD       = MDSE.MDSE_CD
                    AND OTM.EZCANCELFLAG  = '0'
                )
            )
        AND MDSE.EZCANCELFLAG          = '0'
        AND NOT EXISTS (
            SELECT
                1
            FROM
                CPO_DTL                CPOD
               ,MDSE                   MDSE
               ,SVC_MACH_MSTR          SMM
            WHERE
                DCC.CONFIG_TP_CD       = 'O06'
            AND DCC.GLBL_CMPY_CD       = CPOD.GLBL_CMPY_CD
            AND DCC.DS_CPO_CONFIG_PK   = CPOD.DS_CPO_CONFIG_PK
            AND CPOD.EZCANCELFLAG      = '0'
            AND CPOD.GLBL_CMPY_CD      = MDSE.GLBL_CMPY_CD
            AND (
                CPOD.MDSE_CD = MDSE.MDSE_CD
                    OR EXISTS (
                        SELECT
                            MDSE.MDSE_CD
                        FROM
                            ORD_TAKE_MDSE OTM
                        WHERE
                            CPOD.GLBL_CMPY_CD = OTM.GLBL_CMPY_CD
                        AND CPOD.MDSE_CD      = OTM.ORD_TAKE_MDSE_CD
                        AND OTM.MDSE_CD       = MDSE.MDSE_CD
                        AND OTM.EZCANCELFLAG  = '0'
                    )
                )
            AND MDSE.EZCANCELFLAG      = '0'
            AND MDSE.GLBL_CMPY_CD      = SMM.GLBL_CMPY_CD
            AND MDSE.MDSE_CD           = SMM.MDSE_CD
            AND SMM.EZCANCELFLAG       = '0'
            AND SMM.SVC_MACH_TP_CD     = #svcMachTpCd#
            AND ROWNUM                 = 1
        )
        AND MDSE.SVC_ISTL_RULE_NUM     = SIR.SVC_ISTL_RULE_NUM(+)
        AND MDSE.GLBL_CMPY_CD          = SIR.GLBL_CMPY_CD(+)
        AND SIR.EZCANCELFLAG(+)        = '0'
        ORDER BY
             SIR.AUTO_ISTL_CALL_FLG DESC
            ,SIR.SVC_ISTL_RULE_NUM ASC
    </statement>
    <!-- 2023/09/05 K.Watanabe QC#53408 Add End -->

    <!-- 2023/12/12 K.Watanabe QC#61300 Add Start -->
    <statement id ="getDeinstallInfo" parameterClass="Map"  resultClass="Map">
        SELECT
            DCC.DS_CPO_CONFIG_PK
           ,SMM.SVC_MACH_MSTR_PK
           ,SMM.SVC_BY_SVC_PRVD_PTY_CD
           ,SPP.SVC_DEINS_RULE_NUM
        FROM
            DS_CPO_CONFIG              DCC
           ,SVC_CONFIG_MSTR            SCM
           ,SVC_MACH_MSTR              SMM
           ,SVC_PRVD_PTY               SPP
        WHERE
            DCC.EZCANCELFLAG           = '0'
        AND DCC.GLBL_CMPY_CD           = #glblCmpyCd#
        AND DCC.CPO_ORD_NUM            = #cpoOrdNum#
        AND DCC.DS_ORD_POSN_NUM        = #dsOrdPosnNum#
        AND DCC.CONFIG_CATG_CD         = #ConfigCatgCd#
        AND DCC.GLBL_CMPY_CD           = SCM.GLBL_CMPY_CD
        AND DCC.SVC_CONFIG_MSTR_PK     = SCM.SVC_CONFIG_MSTR_PK
        AND SCM.GLBL_CMPY_CD           = SMM.GLBL_CMPY_CD
        AND SCM.SVC_MACH_MSTR_PK       = SMM.SVC_MACH_MSTR_PK
        AND SMM.GLBL_CMPY_CD           = SPP.GLBL_CMPY_CD
        AND SMM.SVC_BY_SVC_PRVD_PTY_CD = SPP.SVC_PRVD_PTY_CD
    </statement>

    <statement id ="getSvcDeinsRuleNum" parameterClass="Map"  resultClass="Map">
        SELECT
            MDSE.SVC_DEINS_RULE_NUM
        FROM
            DS_CPO_RTRN_DTL         DCRD
            <isNotNull property="svcMachMstrPk">
           ,SVC_MACH_MSTR           SMM
            </isNotNull>
           ,MDSE                    MDSE
           ,SVC_ISTL_RULE           SIR
        WHERE
            DCRD.EZCANCELFLAG       = '0'
        AND DCRD.GLBL_CMPY_CD       = #glblCmpyCd#
        AND DCRD.DS_CPO_CONFIG_PK   = #dsCpoConfigPk#
        <isNotNull property="svcMachMstrPk">
        AND DCRD.GLBL_CMPY_CD       = SMM.GLBL_CMPY_CD
        AND DCRD.MDSE_CD            = SMM.MDSE_CD
        AND SMM.EZCANCELFLAG        = '0'
        AND SMM.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
        <isNotNull property="svcMachTpCd">
        AND SMM.SVC_MACH_TP_CD      = #svcMachTpCd#
        </isNotNull>
        </isNotNull>
        AND DCRD.GLBL_CMPY_CD       = MDSE.GLBL_CMPY_CD
        AND (
            DCRD.MDSE_CD = MDSE.MDSE_CD
                OR EXISTS (
                    SELECT
                        MDSE.MDSE_CD
                    FROM
                        ORD_TAKE_MDSE OTM
                    WHERE
                        DCRD.GLBL_CMPY_CD = OTM.GLBL_CMPY_CD
                    AND DCRD.MDSE_CD      = OTM.ORD_TAKE_MDSE_CD
                    AND OTM.MDSE_CD       = MDSE.MDSE_CD
                    AND OTM.EZCANCELFLAG  = '0'
                )
            )
        AND MDSE.EZCANCELFLAG       = '0'
        AND MDSE.SVC_DEINS_RULE_NUM = SIR.SVC_ISTL_RULE_NUM(+)
        AND MDSE.GLBL_CMPY_CD       = SIR.GLBL_CMPY_CD(+)
        AND SIR.EZCANCELFLAG(+)     = '0'
        ORDER BY
             SIR.AUTO_DEINS_CALL_FLG DESC
            ,SIR.SVC_ISTL_RULE_NUM ASC
    </statement>
    <!-- 2023/12/12 K.Watanabe QC#61300 Add End -->

    <!-- 2024/03/14 QC#63527 Add Start -->
    <statement id="getDsOrdCatgListForValSet" parameterClass="Map" resultClass="Map">
        SELECT
            LVS.DS_ORD_LINE_CATG_CD
            ,LVS.THIRD_BIZ_CTX_ATTRB_TXT AS RTL_WH_CD
            ,LVS.FIFTH_BIZ_CTX_ATTRB_TXT AS OWNR
        FROM 
            ORD_LINE_VAL_SET LVS
        WHERE 
            LVS.GLBL_CMPY_CD                = #glblCmpyCd#
            AND LVS.ORD_LINE_CTX_TP_CD      = #ordLineCtxCd#
            AND LVS.FIRST_BIZ_CTX_ATTRB_TXT = #firstBizCtxAttrbTxt#
            AND LVS.EZCANCELFLAG            = '0'
        ORDER BY 
            LVS.SCD_BIZ_CTX_ATTRB_TXT
    </statement>
    
    <statement id="getCpoDetailInvLocCd" parameterClass="Map" resultClass="String">
        SELECT
            RTL_WH.INVTY_OWNR_CD 
        FROM 
            CPO_DTL     DTL
            ,RTL_SWH    RTL_SWH
            ,RTL_WH     RTL_WH
        WHERE 
            DTL.GLBL_CMPY_CD              = #glblCmpyCd#
            AND DTL.CPO_ORD_NUM           = #cplOrdNum#
            AND DTL.CPO_DTL_LINE_NUM      = #cplDtlLineNum#
            AND DTL.CPO_DTL_LINE_SUB_NUM  = #cplDtlLineSubNum#
            AND DTL.EZCANCELFLAG          = '0'
            AND DTL.INVTY_LOC_CD          = RTL_SWH.INVTY_LOC_CD 
            AND RTL_SWH.RTL_WH_Cd         = RTL_WH.RTL_WH_CD
            AND RTL_SWH.GLBL_CMPY_CD      = #glblCmpyCd#
            AND RTL_SWH.EZCANCELFLAG      = '0'
            AND RTL_WH.GLBL_CMPY_CD       = #glblCmpyCd#
            AND RTL_WH.EZCANCELFLAG       = '0'       
    </statement>
    
    <statement id="getRtlWh" parameterClass="Map" resultClass="String">
        SELECT
            RTW.RTL_WH_CD
        FROM
            RTL_WH RTW
        WHERE
            RTW.GLBL_CMPY_CD        = #glblCmpyCd#
            AND RTW.PHYS_WH_CD      = #physWhCd#
            AND RTW.INVTY_OWNR_CD   = 'GMD'    
            AND RTW.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getInvtyOwnrCd" parameterClass="Map" resultClass="String">
        SELECT
            DISTINCT RTL_WH.INVTY_OWNR_CD  
        FROM
            RTL_SWH              RTL_SWH
            ,RTL_WH              RTL_WH
        WHERE
            RTL_SWH.RTL_WH_CD            = RTL_WH.RTL_WH_CD
            AND RTL_SWH.RTL_WH_CD        = #whCd#
            AND RTL_SWH.GLBL_CMPY_CD     = #glblCmpyCd#
            AND RTL_SWH.EZCANCELFLAG     = '0'
            AND RTL_WH.GLBL_CMPY_CD      = #glblCmpyCd#
            AND RTL_WH.EZCANCELFLAG      = '0'
    </statement>
    <!-- 2024/03/14 QC#63527 Add End -->
</sqlMap>
