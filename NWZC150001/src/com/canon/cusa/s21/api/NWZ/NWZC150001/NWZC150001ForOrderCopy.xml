<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWZC150001ForOrderCopy">

    <!-- typeAlias alias="CPO_SVCTMsg"                 type="business.db.CPO_SVCTMsg"/ -->

    <statement id="getMaxBizProcPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             MAX(BIZ_PROC_LOG_PK) BIZ_PROC_LOG_PK
        FROM
            BIZ_PROC_LOG BPL
        WHERE
                BPL.SUB_SYS_ID      = #subSysId#
            AND BPL.PROC_ID         = #procId#
            AND BPL.EVENT_ID        LIKE #eventId#
            AND BPL.DOC_TP_CD       = #docTpCd#
            <isNotNull property="docId">
                AND BPL.DOC_ID          = #docId#
            </isNotNull>
            AND BPL.PRNT_DOC_ID     = #cpoOrdNum#
            AND BPL.EZUPUSERID      = #userId#
            AND BPL.EZUPTIME        <![CDATA[>=]]> #ezUptime#
            AND BPL.EZCANCELFLAG    = '0'
    </statement>

    <!-- 2017/05/11 S21_NA#Review structure Lv.2 RS#8389 Del Start -->
    <!-- statement id="getCpoSvcInfoByCpoOrdNum" parameterClass="Map" resultMap="result.getCpoSvcInfoByCpoOrdNum" -->
<!--         SELECT -->
<!--              CS.GLBL_CMPY_CD -->
<!--             ,CS.CPO_SVC_PK -->
<!--             ,CS.REF_CPO_ORD_NUM -->
<!--         FROM -->
<!--             CPO_SVC              CS          CPO Service -->
<!--         WHERE -->
<!--                 CS.GLBL_CMPY_CD     = #glblCmpyCd# -->
<!--             AND CS.REF_CPO_ORD_NUM  = #cpoOrdNum# -->
<!--             AND CS.EZCANCELFLAG         = '0' -->
    <!-- /statement -->
    <!-- resultMap id="result.getCpoSvcInfoByCpoOrdNum" class="CPO_SVCTMsg" noCheckSet="True" -->
        <!-- result property="glblCmpyCd"               column="GLBL_CMPY_CD"                       javaType="EZDTStringItem"/ -->
        <!-- result property="cpoSvcPk"                 column="CPO_SVC_PK"                         javaType="EZDTBigDecimalItem"/ -->
        <!-- result property="refCpoOrdNum"             column="REF_CPO_ORD_NUM"                    javaType="EZDTStringItem"/ -->
    <!-- /resultMap -->
    <!-- 2017/05/11 S21_NA#Review structure Lv.2 RS#8389 Del End -->

    <!-- 2018/05/20 S21_NA#25604 Del Start -->
    <!-- statement id="isExistOrdCatg" parameterClass="Map" resultClass="Integer" -->
<!--         SELECT -->
<!--             COUNT(OCBC.ORD_CATG_BIZ_CTX_PK) -->
<!--         FROM -->
<!--             ORD_CATG_BIZ_CTX OCBC -->
<!--         WHERE -->
<!--             OCBC.GLBL_CMPY_CD           = #glblCmpyCd# -->
<!--             AND OCBC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTpCd# -->
<!--             AND OCBC.EZCANCELFLAG       = '0' -->
<!--             AND ( -->
<!--                  ( -->
<!--                   OCBC.DS_ORD_CATG_CD    = #dsOrdCatgCd# -->
<!--                   AND OCBC.DS_ORD_TP_CD  IS NULL -->
<!--                   AND OCBC.DS_ORD_RSN_CD IS NULL -->
<!--                  ) -->
<!--                  OR -->
<!--                  ( -->
<!--                   OCBC.DS_ORD_CATG_CD    = #dsOrdCatgCd# -->
<!--                   AND OCBC.DS_ORD_TP_CD  = #dsOrdTpCd# -->
<!--                   AND OCBC.DS_ORD_RSN_CD IS NULL -->
<!--                  ) -->
<!--                  OR -->
<!--                  ( -->
<!--                   OCBC.DS_ORD_CATG_CD    = #dsOrdCatgCd# -->
<!--                   AND OCBC.DS_ORD_TP_CD  = #dsOrdTpCd# -->
<!--                   AND OCBC.DS_ORD_RSN_CD = #dsOrdRsnCd# -->
<!--                  ) -->
<!--                 ) -->
    <!-- /statement -->
    <!-- 2018/05/20 S21_NA#25604 Del End -->

    <!-- 2017/05/11 S21_NA#Review structure Lv.2 RS#8389 Del Start -->
    <!-- statement id="getCpoSvcDtlForShell" parameterClass="Map" resultClass="Map" -->
<!--         SELECT -->
<!--              CSD.CPO_SVC_DTL_PK                            Primary key of the entity -->
<!--             ,CSD.CPO_SVC_LINE_NUM                          Maintenance Shell -->
<!--             ,CSD.CPO_SVC_MDSE_CD                           Shell Item -->
<!--             ,CSD.PRC_SVC_CONTR_TP_CD                       Contract Type -->
<!--             ,CSD.PRC_SVC_PLN_TP_CD                         Plan Type -->
<!--             ,CSD.DS_CONTR_CATG_CD                          Contract Indicator -->
<!--             ,CSD.BASE_BLLG_CYCLE_CD                        Base Bill Cycle -->
<!--             ,CSD.USG_BLLG_CYCLE_CD                         Usage Bill Cycle -->
<!--             ,CSD.FROM_PER_MTH_NUM                          Period From -->
<!--             ,CSD.TO_PER_MTH_NUM                            Period To -->
<!--             ,CSD.TERM_MTH_NUM                              Term -->
<!--             ,CSD.BILL_WITH_EQUIP_FLG                       Billed w/ Equip -->
<!--             ,CSD.BILL_BY_TP_CD                             Billed by -->
<!--             ,CSD.SOLD_TO_CUST_LOC_CD                       Location Number -->
<!--             ,CSD.SELL_TO_CUST_CD                           Customer -->
<!--             ,CSD.CPO_SVC_AGMT_VER_NUM                      Agreement Version -->
<!--             ,CSD.MAN_CONTR_OVRD_FLG                        Manual Override -->
<!--             ,CSD.MAN_CONTR_OVRD_RSN_CD                     Manual Override Reason -->
<!--             ,CSD.MAN_CONTR_OVRD_CMNT_TXT                   Manual Override Comment -->
<!--             ,CSD.DS_CONTR_PK                               Add to Contract -->
<!--             ,CSD.SVC_PRC_CATG_CD                           MUBC or AUBC or ADCH -->
<!--             ,CSD.BILL_WITH_EQUIP_INVD_FLG                  Bill With Equipment Invoiced Flag -->
<!--             ,CSD.CR_REBIL_CD                               Credit And Rebill Code -->
<!--             ,CSD.CONTR_CRAT_FLG                            Contract Creation Flag -->
<!--             ,CSD.APPLY_EQUIP_BILL_TO_FLG                   Maint Bill To Same as Equipment -->
<!--             ,CSD.TOT_BASE_PRC_DEAL_AMT -->
<!--             ,CSD.TOT_BASE_PRC_FUNC_AMT -->
<!--             ,CSD.ADD_ASRY_FLG -->
<!--             ,CSD.FIX_TERM_IN_MTH_AOT -->
<!--             ,CSD.MAX_UPLFT_PCT -->
<!--             ,CSD.CPO_SVC_LINE_ACT_CD -->
<!--         FROM -->
<!--             CPO_SVC_DTL          CSD         CPO Service Detail -->
<!--         WHERE -->
<!--             CSD.EZCANCELFLAG       = 0 -->
<!--             AND CSD.GLBL_CMPY_CD   = #glblCmpyCd# -->
<!--             AND CSD.CPO_SVC_PK     = #cpoSvcPk# -->
    <!-- /statement -->
    <!-- 2017/05/11 S21_NA#Review structure Lv.2 RS#8389 Del End -->

    <!-- 2017/05/11 S21_NA#Review structure Lv.2 RS#8389 Del Start -->
    <!-- statement id="getCpoSvcConfigRefForShell" parameterClass="Map" resultClass="Map" -->
<!--         SELECT -->
<!--              CSCR.CPO_SVC_DTL_PK                            Reference to parent entity -->
<!--             ,CSD.CPO_SVC_LINE_NUM                           Maintenance Shell -->
<!--             ,CSCR.CPO_ORD_NUM                               CPO Order Number -->
<!--             ,CSCR.CPO_DTL_LINE_NUM                          Line/Config -->
<!--             ,CSCR.CPO_DTL_LINE_SUB_NUM                      Line/Config -->
<!--             ,DCD.DS_ORD_POSN_NUM                            Order Position Number -->
<!--             ,CSCR.SVC_CONFIG_MSTR_PK                        -->
<!--             ,CSCR.CUST_ISS_PO_NUM                           PO Number -->
<!--             ,CSCR.CUST_ISS_PO_DT                            PO Number -->
<!--             ,CSCR.MTR_READ_METH_CD                          Meter Method -->
<!--             ,CSCR.CPO_SVC_PRC_PK                            Reference to pricing -->
<!--             ,CSCR.SVC_PRC_CATG_CD                           MUBC or AUBC or ADCH -->
<!--             ,CSCR.BILL_WITH_EQUIP_INVD_FLG                  Bill With Equipment Invoiced Flag -->
<!--             ,CSCR.CR_REBIL_CD                               Credit And Rebill Code -->
<!--             ,CSCR.CONTR_CRAT_FLG                            Contract Creation Flag -->
<!--         FROM -->
<!--             CPO_SVC_CONFIG_REF   CSCR        CPO Service Config Reference -->
<!--             ,CPO_SVC_DTL         CSD         CPO Service Detail -->
<!--             ,CPO_DTL             DCD         CPO Detail -->
<!--         WHERE -->
<!--             CSCR.EZCANCELFLAG       = 0 -->
<!--             AND CSCR.GLBL_CMPY_CD   = #glblCmpyCd# -->
<!--             AND CSCR.EZCANCELFLAG   = CSD.EZCANCELFLAG -->
<!--             AND CSCR.GLBL_CMPY_CD   = CSD.GLBL_CMPY_CD -->
<!--             AND CSCR.CPO_SVC_DTL_PK = CSD.CPO_SVC_DTL_PK -->
<!--             AND CSD.CPO_SVC_PK      = #cpoSvcPk# -->
<!--             AND CSCR.EZCANCELFLAG   = DCD.EZCANCELFLAG -->
<!--             AND CSCR.GLBL_CMPY_CD   = DCD.GLBL_CMPY_CD -->
<!--             AND CSCR.CPO_ORD_NUM = DCD.CPO_ORD_NUM -->
<!--             AND CSCR.CPO_DTL_LINE_NUM  = DCD.CPO_DTL_LINE_NUM -->
<!--             AND CSCR.CPO_DTL_LINE_SUB_NUM = DCD.CPO_DTL_LINE_SUB_NUM -->
    <!-- /statement -->
    <!-- 2017/05/11 S21_NA#Review structure Lv.2 RS#8389 Del End -->
    <!-- 2017/09/19 S21_NA#18859(Sol#154) Add Start -->
    
    <statement id="getRtrnMdseCd" parameterClass="Map" resultClass="String" >
        SELECT
            NVL(IL.MDSE_CD ,NVL(M.MDSE_CD, NVL(OTM.MDSE_CD, CD.MDSE_CD)))     MDSE_CD
        FROM 
            CPO_DTL         CD
           ,SHPG_PLN        SP
           ,INV_LINE        IL
           ,MDSE            M
           ,ORD_TAKE_MDSE   OTM
        WHERE 
            CD.GLBL_CMPY_CD         = #glblCmpyCd#
        AND CD.CPO_ORD_NUM          = #cpoOrdNum#
        AND CD.CPO_DTL_LINE_NUM     = #cpoDtlLineNum#
        AND CD.CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
        AND CD.EZCANCELFLAG         = '0'

        AND CD.GLBL_CMPY_CD         = OTM.GLBL_CMPY_CD(+)
        AND CD.MDSE_CD              = OTM.ORD_TAKE_MDSE_CD(+)
        AND OTM.EZCANCELFLAG(+)     = '0'

        AND CD.GLBL_CMPY_CD         = SP.GLBL_CMPY_CD(+)
        AND CD.CPO_ORD_NUM          = SP.TRX_HDR_NUM(+)
        AND CD.CPO_DTL_LINE_NUM     = SP.TRX_LINE_NUM(+)
        AND CD.CPO_DTL_LINE_SUB_NUM = SP.TRX_LINE_SUB_NUM(+)
        AND SP.EZCANCELFLAG(+)      = '0'
        AND SP.GLBL_CMPY_CD         = M.GLBL_CMPY_CD(+)
        AND SP.MDSE_CD              = M.MDSE_CD(+)
        AND M.EZCANCELFLAG(+)       = '0'

        AND CD.GLBL_CMPY_CD         = IL.GLBL_CMPY_CD(+)
        AND CD.CPO_ORD_NUM          = IL.CPO_ORD_NUM(+)
        AND CD.CPO_DTL_LINE_NUM     = IL.CPO_DTL_LINE_NUM(+)
        AND CD.CPO_DTL_LINE_SUB_NUM = IL.CPO_DTL_LINE_SUB_NUM(+)
        AND IL.EZCANCELFLAG(+)      = '0'
        AND IL.INV_LINE_CATG_CD(+)  = #invLineCatgCd#
    </statement>

    <statement id="getSalesRepList" parameterClass="Map" resultClass="Map">
        SELECT 
            T.TOC_NM
            ,CE.COA_EXTN_CD
            ,CE.COA_EXTN_DESC_TXT
            ,CB.COA_BR_CD
            ,CB.COA_BR_DESC_TXT
            ,CC.COA_CC_CD
            ,CC.COA_CC_DESC_TXT
            ,T.TOC_CD
            ,SP.PSN_NUM
        FROM 
            TOC T
            ,COA_EXTN CE
            ,COA_BR   CB
            ,COA_CC   CC
            ,ORG_FUNC_ASG OFA
            ,S21_PSN SP
        WHERE 
                T.GLBL_CMPY_CD        = #glblCmpyCd#
            AND T.EZCANCELFLAG        = '0'
            <isNotNull property="slsRepTocCd">
            AND T.TOC_CD              = #slsRepTocCd#
            </isNotNull>
            AND T.GLBL_CMPY_CD        = OFA.GLBL_CMPY_CD
            AND T.TOC_CD              = OFA.TOC_CD
            AND OFA.EZCANCELFLAG      = '0'
            AND OFA.GLBL_CMPY_CD      = SP.GLBL_CMPY_CD
            AND OFA.PSN_CD            = SP.PSN_CD
            AND SP.EZCANCELFLAG       = '0'
            AND T.GLBL_CMPY_CD        = CE.GLBL_CMPY_CD (+)
            AND T.COA_EXTN_CD         = CE.COA_EXTN_CD (+)
            AND CE.EZCANCELFLAG (+)   = '0'
            AND T.GLBL_CMPY_CD        = CB.GLBL_CMPY_CD (+)
            AND T.COA_BR_CD           = CB.COA_BR_CD (+)
            AND CB.EZCANCELFLAG (+)   = '0'
            AND T.GLBL_CMPY_CD        = CC.GLBL_CMPY_CD (+)
            AND T.COA_CC_CD           = CC.COA_CC_CD (+)
            AND CC.EZCANCELFLAG (+)   = '0'
    </statement>

    <statement id="getOrdCatgBizCtx" parameterClass="Map" resultClass="String">
        SELECT 
                #flgY#
          FROM
                ORD_CATG_BIZ_CTX OCBC
         WHERE
                OCBC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND OCBC.EZCANCELFLAG        = '0'
            AND OCBC.ORD_CATG_CTX_TP_CD  = #ordCatgCtxTpCd#
        <isNotNull property="dsOrdCatgCd">
            AND (OCBC.DS_ORD_CATG_CD = #dsOrdCatgCd# OR OCBC.DS_ORD_CATG_CD IS NULL)
        </isNotNull>
        <isNull property="dsOrdCatgCd">
            AND OCBC.DS_ORD_CATG_CD IS NULL
        </isNull>
        <isNotNull property="dsOrdTpCd">
            AND (OCBC.DS_ORD_TP_CD = #dsOrdTpCd# OR OCBC.DS_ORD_TP_CD IS NULL)
        </isNotNull>
        <isNull property="dsOrdTpCd">
            AND OCBC.DS_ORD_TP_CD IS NULL
        </isNull>
    </statement>

    <statement id="getOrdCatgBizCtxFstAttbTxt" parameterClass="Map" resultClass="String">
        SELECT 
                OCBC.FIRST_BIZ_CTX_ATTRB_TXT
          FROM
                ORD_CATG_BIZ_CTX OCBC
         WHERE
                OCBC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND OCBC.EZCANCELFLAG        = '0'
            AND OCBC.ORD_CATG_CTX_TP_CD  = #ordCatgCtxTpCd#
        <isNotNull property="dsOrdCatgCd">
            AND (OCBC.DS_ORD_CATG_CD = #dsOrdCatgCd# OR OCBC.DS_ORD_CATG_CD IS NULL)
        </isNotNull>
        <isNull property="dsOrdCatgCd">
            AND OCBC.DS_ORD_CATG_CD IS NULL
        </isNull>
        <isNotNull property="dsOrdTpCd">
            AND (OCBC.DS_ORD_TP_CD = #dsOrdTpCd# OR OCBC.DS_ORD_TP_CD IS NULL)
        </isNotNull>
        <isNull property="dsOrdTpCd">
            AND OCBC.DS_ORD_TP_CD IS NULL
        </isNull>
    </statement>
    <!-- QC#50130 2019/05/15 Add -->
    <statement id="getSpecCondPrcPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
              SCP.SPEC_COND_PRC_PK
        FROM
              SPEC_COND_PRC SCP
        WHERE
              SCP.GLBL_CMPY_CD   = #glblCmpyCd#
          AND SCP.EZCANCELFLAG   = '0'
          AND SCP.PRC_COND_TP_CD = #prcCondTpCd#
          AND ROWNUM = 1
    </statement>

</sqlMap>
