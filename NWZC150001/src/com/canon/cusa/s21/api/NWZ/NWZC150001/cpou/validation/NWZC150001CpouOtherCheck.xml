<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWZC150001CpouOtherCheck">


    <!-- START ADD S.Yamamoto [OM003] -->
    <statement id="cntFrtCondCd" parameterClass="Map" resultClass="Integer">
        SELECT
              COUNT(FC.FRT_COND_CD) 
        FROM
              FRT_COND FC
        WHERE
              FC.GLBL_CMPY_CD   = #glblCmpyCd#
          AND FC.FRT_COND_CD    = #frtCondCd#
          AND FC.DS_ORD_CATG_CD IN (#dsOrdCatgCd#,'*')
          AND FC.EZCANCELFLAG   = '0'
    </statement>

    <statement id="getCoaGlCmbn4Seg" parameterClass="Map" resultClass="String">
        SELECT
               C4S.GLBL_CMPY_CD
        FROM
              COA_GL_CMBN_4_SEG        C4S
        WHERE
                C4S.GLBL_CMPY_CD            = #glblCmpyCd#
            AND C4S.COA_PROD_CD             = #coaProdCd#
            AND C4S.COA_BR_CD                 = #coaBrCd#
            AND C4S.COA_CH_CD                 = #coaChCd#
            AND C4S.COA_CC_CD                 = #coaCcCd#
            AND C4S.COA_GL_CMBN_ACTV_FLG     = #coaGlCmbnActvFlg#
            AND C4S.EZCANCELFLAG            = '0'
    </statement>

    <statement id="isContractInfo" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(HCOS.HLD_RSN_CD)
        FROM
            HLD_CTRL_ORD_SRC HCOS
          , HLD_CTRL_ORD_TP  HCOT
        WHERE
            HCOS.GLBL_CMPY_CD = #glblCmpyCd#
          AND HCOS.HLD_RSN_CD   = #hldRsnCd#
          AND HCOS.APPLY_ORD_SRC_TP_CD = #ordSrcTpCd#
          AND HCOS.EZCANCELFLAG = '0'
          AND HCOT.GLBL_CMPY_CD = HCOS.GLBL_CMPY_CD
          AND HCOT.HLD_RSN_CD   = HCOS.HLD_RSN_CD
          AND HCOT.APPLY_ORD_TP_CD = #ordTpCd#
          AND HCOT.EZCANCELFLAG = '0'
          AND ROWNUM <![CDATA[ <= ]]> 1
    </statement>

    <statement id="getHldCtrlOrgList" parameterClass="Map" resultClass="Map">
        SELECT 
            HC.FIRST_ORG_CD
          , HC.SCD_ORG_CD
          , HC.THIRD_ORG_CD
          , HC.FRTH_ORG_CD
          , HC.FIFTH_ORG_CD    
          , HC.SIXTH_ORG_CD     
          , HC.SVNTH_ORG_CD     
          , HC.EIGHTH_ORG_CD  
          , HC.TOC_CD 
        
        FROM
          HLD_CTRL_ORG HC
        
        WHERE
              HC.GLBL_CMPY_CD = #glblCmpyCd#
          AND HC.HLD_RSN_CD = #hldRsnCd#
          AND HC.EZCANCELFLAG = '0'  
        
        GROUP BY
            HC.FIRST_ORG_CD
          , HC.SCD_ORG_CD
          , HC.THIRD_ORG_CD
          , HC.FRTH_ORG_CD
          , HC.FIFTH_ORG_CD    
          , HC.SIXTH_ORG_CD     
          , HC.SVNTH_ORG_CD     
          , HC.EIGHTH_ORG_CD  
          , HC.TOC_CD 
        
        ORDER BY
          HC.TOC_CD        NULLS LAST
        , HC.EIGHTH_ORG_CD NULLS LAST
        , HC.SVNTH_ORG_CD  NULLS LAST            
        , HC.SIXTH_ORG_CD  NULLS LAST        
        , HC.FIFTH_ORG_CD  NULLS LAST            
        , HC.FRTH_ORG_CD   NULLS LAST        
        , HC.THIRD_ORG_CD  NULLS LAST        
        , HC.SCD_ORG_CD    NULLS LAST               
        , HC.FIRST_ORG_CD  NULLS LAST        
    </statement>

    <statement id="cntAvalWarehouse" parameterClass="Map" resultClass="Integer">
        SELECT
              COUNT(WH.WH_CD) 
        FROM
              DS_ORD_TP_LOC_ROLE_RELN DLR
            , WH                      WH
            , LOC_USG                 LU
        WHERE
              DLR.GLBL_CMPY_CD   = #glblCmpyCd#
          AND DLR.GLBL_CMPY_CD   = WH.GLBL_CMPY_CD
          AND DLR.GLBL_CMPY_CD   = LU.GLBL_CMPY_CD
          AND DLR.DS_ORD_TP_CD   = #dsOrdTpCd#
          AND WH.WH_CD           = #invtyLocCd#
          AND LU.PTY_LOC_PK      = WH.PTY_LOC_PK
          AND LU.LOC_ROLE_TP_CD  = DLR.LOC_ROLE_TP_CD
          AND DLR.EZCANCELFLAG   = '0'
          AND WH.EZCANCELFLAG    = '0'
          AND LU.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getSvcMachMstr" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             SMM.SVC_MACH_MSTR_PK
        FROM
             SVC_MACH_MSTR          SMM
        WHERE
                SMM.GLBL_CMPY_CD       = #glblCmpyCd#
            AND SMM.SVC_CONFIG_MSTR_PK = #svcConfigMstrPk#
            AND SMM.SHIP_TO_CUST_CD    = #shipToCustCd#
            AND SMM.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getMachMstrCratFlg" parameterClass="Map" resultClass="String">
        SELECT
            MC.MACH_MSTR_CRAT_FLG
        FROM
            MDSE                    M
            , MDSE_CATG             MC
        WHERE
                M.GLBL_CMPY_CD      = #glblCmpyCd#
            AND M.MDSE_CD           = #mdseCd#
            AND M.EZCANCELFLAG      = '0'
            AND MC.GLBL_CMPY_CD     = M.GLBL_CMPY_CD
            AND MC.MDSE_CATG_CD     = M.MDSE_CATG_CD
            AND MC.EZCANCELFLAG     = '0'
    </statement>
    
    <!-- S21_NA#19854 2017/07/31 Add Start -->
    <statement id="isDefaultWhTmpl" parameterClass="Map" resultClass="BigDecimal">
        SELECT
               COUNT(CTX.ORD_CATG_BIZ_CTX_PK)
        FROM
               ORD_CATG_BIZ_CTX          CTX
        WHERE
               CTX.GLBL_CMPY_CD          = #glblCmpyCd#
           AND CTX.EZCANCELFLAG          = '0'
           AND CTX.ORD_CATG_CTX_TP_CD    = #ordCatgCtxTpCd#
           AND
           (
               (    CTX.DS_ORD_CATG_CD   IS NULL
                AND CTX.DS_ORD_TP_CD     IS NULL
                AND CTX.DS_ORD_RSN_CD    IS NULL)
            OR
               (    CTX.DS_ORD_CATG_CD   = #dsOrdCatgCd#
                AND CTX.DS_ORD_TP_CD     IS NULL
                AND CTX.DS_ORD_RSN_CD    IS NULL)
            OR
               (    CTX.DS_ORD_CATG_CD   = #dsOrdCatgCd#
                AND CTX.DS_ORD_TP_CD     = #dsOrdTpCd#
                AND CTX.DS_ORD_RSN_CD    IS NULL)
           <isNotNull property="dsOrdRsnCd">
            OR
               (    CTX.DS_ORD_CATG_CD   = #dsOrdCatgCd#
                AND CTX.DS_ORD_TP_CD     = #dsOrdTpCd#
                AND CTX.DS_ORD_RSN_CD    = #dsOrdRsnCd#)
           </isNotNull>
           )
    </statement>
    <!-- S21_NA#19854 2017/07/31 Add End -->
    <!-- 2019/08/01 S21_NA#52156 Add Start -->
    <statement id="getApprovedPRLineNum" parameterClass="Map" resultClass="Map">
    SELECT 
        CD.CPO_ORD_NUM          AS TRX_HDR_NUM
       ,CD.CPO_DTL_LINE_NUM     AS TRX_LINE_NUM
       ,CD.CPO_DTL_LINE_SUB_NUM AS TRX_LINE_SUB_NUM
    FROM 
        CPO_DTL CD
    WHERE 
            CD.GLBL_CMPY_CD = #glblCmpyCd#
        AND CD.CPO_ORD_NUM  = #cpoOrdNum#
        AND CD.EZCANCELFLAG = '0'
        AND CD.ORD_LINE_DPLY_STS_CD IN
            <iterate property="stsList" var="elem[]" open="(" close=")" conjunction=",">
                #elem[]#
            </iterate>
        AND (
            EXISTS (
                SELECT 
                    1
                FROM 
                    SHPG_PLN SP
                WHERE
                        SP.GLBL_CMPY_CD     = CD.GLBL_CMPY_CD 
                    AND SP.TRX_HDR_NUM      = CD.CPO_ORD_NUM
                    AND SP.TRX_LINE_NUM     = CD.CPO_DTL_LINE_NUM
                    AND SP.TRX_LINE_SUB_NUM = CD.CPO_DTL_LINE_SUB_NUM
                    AND SP.EZCANCELFLAG     = '0'
                    AND SP.SHPG_STS_CD      = #shpgStsCd#
                    AND (
                        EXISTS (
                            SELECT
                                1
                            FROM 
                                PRCH_REQ PR
                               ,PRCH_REQ_DTL      PRD
                               ,PRCH_REQ_APVL_STS PRAS
                        WHERE
                                SP.GLBL_CMPY_CD         = #glblCmpyCd#
                            AND PRD.SHPG_PLN_NUM        = SP.SHPG_PLN_NUM
                            AND PRD.EZCANCELFLAG        = '0'
                            AND PRD.PRCH_REQ_NUM        = PR.PRCH_REQ_NUM
                            AND PR.EZCANCELFLAG         = '0'
                            AND PR.PRCH_REQ_APVL_STS_CD = PRAS.PRCH_REQ_APVL_STS_CD
                            AND PRAS.PRCH_REQ_APVL_FLG  = 'Y'
                            AND PR.PRCH_REQ_STS_CD      &lt;&gt; #prchReqStsCancel#
                            AND PRD.PRCH_REQ_LINE_STS_CD &lt;&gt; #prchReqLineStsCancel#
                            AND NOT EXISTS (
                                SELECT
                                    1
                                FROM 
                                    PO_DTL PD
                                WHERE
                                        PD.GLBL_CMPY_CD = PRD.GLBL_CMPY_CD
                                    AND PD.PO_ORD_NUM   = PRD.PO_ORD_NUM
                                    AND PD.EZCANCELFLAG = '0'
                            )
                        )
                        OR EXISTS (
                            SELECT
                                1
                            FROM 
                                PO_DTL PD
                            WHERE
                                    PD.GLBL_CMPY_CD     = SP.GLBL_CMPY_CD
                                AND PD.SHPG_PLN_NUM     = SP.SHPG_PLN_NUM
                                AND PD.PO_STS_CD        &lt;&gt; #poStsCancel#
                                AND PD.EZCANCELFLAG     = '0'
                        )
                    )
                )
            OR EXISTS (
                SELECT 
                    1
                FROM
                    SHPG_PLN SP
                WHERE
                        SP.GLBL_CMPY_CD     = CD.GLBL_CMPY_CD
                    AND SP.TRX_HDR_NUM      = CD.CPO_ORD_NUM
                    AND SP.TRX_LINE_NUM     = CD.CPO_DTL_LINE_NUM
                    AND SP.TRX_LINE_SUB_NUM = CD.CPO_DTL_LINE_SUB_NUM
                    AND SP.EZCANCELFLAG     = '0'
                    AND SP.PO_REQ_FLG       = 'Y'
                    AND NOT EXISTS (
                        SELECT 
                            1
                        FROM 
                            SHPG_PLN SPA
                        WHERE
                                SPA.GLBL_CMPY_CD = SP.GLBL_CMPY_CD
                            AND SPA.SHPG_PLN_NUM = SP.SHPG_PLN_NUM
                            AND SPA.SHPG_STS_CD  = #shpgStsCd#
                        )
                    )
                )
    </statement>
    <!-- 2019/08/01 S21_NA#52156 Add End -->

</sqlMap>
