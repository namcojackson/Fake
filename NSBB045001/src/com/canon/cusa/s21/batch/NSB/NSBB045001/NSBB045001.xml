<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSBB045001">
    <statement id="getTaskInfo" parameterClass="Map" resultClass="Map">
        SELECT
             ST.SVC_TASK_NUM        AS SVC_TASK_NUM
            ,ST.FSR_NUM             AS FSR_NUM
            ,ST.SVC_RPR_TM_NUM      AS SVC_RPR_TM_NUM
            ,FV.FSR_VISIT_NUM       AS FSR_VISIT_NUM
            ,FV.NEXT_FSR_VISIT_NUM  AS NEXT_FSR_VISIT_NUM
            ,SCM.MDL_ID             AS MDL_ID
            ,SMM.SVC_MACH_MSTR_PK   AS SVC_MACH_MSTR_PK
        FROM
            SVC_CONFIG_MSTR SCM
            ,SVC_MACH_MSTR  SMM
            ,SVC_TASK       ST
            ,FSR_VISIT      FV
        WHERE
            SCM.GLBL_CMPY_CD           = #glblCmpyCd#
            AND EXISTS (
                    SELECT
                        1
                    FROM
                        DS_MDL MDL
                    WHERE
                        MDL.GLBL_CMPY_CD                      = #glblCmpyCd#
                        AND MDL.EZCANCELFLAG                  = '0'
                        AND MOD(MDL.MDL_ID,#multiMdlDurnCnt#) = #rest#
                        AND MDL.MDL_ID                        = SCM.MDL_ID)
            AND SCM.GLBL_CMPY_CD       = SMM.GLBL_CMPY_CD
            AND SCM.SVC_CONFIG_MSTR_PK = SMM.SVC_CONFIG_MSTR_PK
            AND SMM.GLBL_CMPY_CD       = ST.GLBL_CMPY_CD
            AND SMM.SVC_MACH_MSTR_PK   = ST.SVC_MACH_MSTR_PK
            <iterate property="dsSvcCallTpCd" var="elem[]" open="AND ST.DS_SVC_CALL_TP_CD   IN (" close=")" conjunction=",">
                            #elem[]#
            </iterate>
            <iterate property="svcTaskStsCd" var="elem[]" open="AND ST.SVC_TASK_STS_CD   IN (" close=")" conjunction=",">
                            #elem[]#
            </iterate>
            AND ST.SVC_TASK_CLO_DT     BETWEEN #salesDateBefore# AND #salesDate#
            AND ST.GLBL_CMPY_CD        = FV.GLBL_CMPY_CD
            AND ST.SVC_TASK_NUM        = FV.SVC_TASK_NUM
            AND ST.FSR_NUM             = FV.FSR_NUM
            AND FV.FSR_VISIT_NUM       = #fsrVisitNum#
            AND SCM.EZCANCELFLAG       = '0'
            AND SMM.EZCANCELFLAG       = '0'
            AND ST.EZCANCELFLAG        = '0'
            AND FV.EZCANCELFLAG        = '0'
        ORDER BY
            SCM.MDL_ID                 ASC
            ,SMM.SVC_MACH_MSTR_PK      ASC
            ,ST.SVC_TASK_NUM           ASC
    </statement>
<!-- mod start 2016/08/31 CSA Defect#13839 -->
<!-- 
    <statement id="getLaborTime" parameterClass="Map" resultClass="Map">
        SELECT
             FVTE.SVC_TM_EVENT_FROM_DT  AS SVC_TM_EVENT_FROM_DT
            ,FVTE.SVC_TM_EVENT_FROM_TM  AS SVC_TM_EVENT_FROM_TM
            ,FVTE.SVC_TM_EVENT_TO_DT    AS SVC_TM_EVENT_TO_DT
            ,FVTE.SVC_TM_EVENT_TO_TM    AS SVC_TM_EVENT_TO_TM
        FROM
            FSR_VISIT_TM_EVENT FVTE
        WHERE
            FVTE.GLBL_CMPY_CD           = #glblCmpyCd#
            AND FVTE.SVC_TASK_NUM       = #svcTaskNum#
            <iterate property="svcTmEventCd" var="elem[]" open="AND FVTE.SVC_TM_EVENT_CD IN (" close=")" conjunction=",">
                            #elem[]#
            </iterate>
            AND FVTE.EZCANCELFLAG       = '0'
            AND FVTE.SVC_TM_EVENT_FROM_DT IS NOT NULL
            AND FVTE.SVC_TM_EVENT_FROM_TM IS NOT NULL
            AND FVTE.SVC_TM_EVENT_TO_DT   IS NOT NULL
            AND FVTE.SVC_TM_EVENT_TO_TM   IS NOT NULL
    </statement>
 -->
    <statement id="getLaborTime" parameterClass="Map" resultClass="Map">
        SELECT
             FVT.SVC_TASK_NUM                   AS SVC_TASK_NUM
            ,NVL(SUM(FVT.SVC_LBOR_TM_NUM), 0)   AS SVC_LBOR_TM_NUM
        FROM
            FSR_VISIT_TASK FVT
        WHERE
                FVT.GLBL_CMPY_CD    = #glblCmpyCd#
            AND FVT.SVC_TASK_NUM    = #svcTaskNum#
            AND FVT.EZCANCELFLAG    = '0'
        GROUP BY
            FVT.SVC_TASK_NUM
    </statement>
<!-- mod end 2016/08/31 CSA Defect#13839 -->
    <statement id="getFollowUpTask" parameterClass="Map" resultClass="Map">
        SELECT
             ST.SVC_TASK_NUM        AS SVC_TASK_NUM
            ,ST.FSR_NUM             AS FSR_NUM
            ,ST.SVC_RPR_TM_NUM      AS SVC_RPR_TM_NUM
            ,FV.FSR_VISIT_NUM       AS FSR_VISIT_NUM
            ,FV.NEXT_FSR_VISIT_NUM  AS NEXT_FSR_VISIT_NUM
        FROM
            SVC_TASK ST
            ,FSR_VISIT FV
        WHERE
            FV.GLBL_CMPY_CD           = #glblCmpyCd#
            AND FV.FSR_NUM            = #fsrNum#
            AND FV.FSR_VISIT_NUM      = #fsrVisitNum#
            AND FV.GLBL_CMPY_CD       = ST.GLBL_CMPY_CD
            AND FV.SVC_TASK_NUM       = ST.SVC_TASK_NUM
            AND FV.EZCANCELFLAG       = '0'
            AND ST.EZCANCELFLAG       = '0'
    </statement>
</sqlMap>
