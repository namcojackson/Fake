<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NLGB012001">
    <typeAlias alias="WMS_INBD_TRXTMsg"    type="business.db.WMS_INBD_TRXTMsg"/>
    <typeAlias alias="WMS_INBD_SO_HDRTMsg" type="business.db.WMS_INBD_SO_HDRTMsg"/>
    <typeAlias alias="WMS_INBD_PO_HDRTMsg" type="business.db.WMS_INBD_PO_HDRTMsg"/>
    <typeAlias alias="WMS_SO_ASN_DTLTMsg"  type="business.db.WMS_SO_ASN_DTLTMsg"/>
    <typeAlias alias="SHPG_ORD_CONF_WRKTMsg"      type="business.db.SHPG_ORD_CONF_WRKTMsg"/>
    <typeAlias alias="SHPG_ORD_CONF_DTL_WRKTMsg"  type="business.db.SHPG_ORD_CONF_DTL_WRKTMsg"/>
    <typeAlias alias="SHIP_SER_NUM_WRKTMsg"       type="business.db.SHIP_SER_NUM_WRKTMsg"/>

    <statement id="getSoConfOshp" parameterClass="Map">
        SELECT
            TRX.GLBL_CMPY_CD
           ,TRX.WMS_INBD_TRX_PK
           ,TRX.WMS_REC_ID
           ,TRX.WH_CD
           ,TRX.WMS_ORD_QTY
           ,TRX.WMS_TRX_DT_TM_TS
           ,TRX.WMS_TASK_CD
           ,TRX.OTBD_ORD_NUM
           ,TRX.OTBD_ORD_TP_CD
           ,TRX.WMS_ORD_STS_CD
           ,TRX.WMS_SHIP_ID
           ,TRX.WMS_FRT_CHRG_AMT
           ,TRX.TMS_FRT_CHRG_AMT
           ,TRX.WMS_TOT_WT
           ,TRX.WMS_CARR_CD
           ,TRX.WMS_ORG_HOST_ID
           ,TRX.EZINTIME
           ,VIA_OSHP.WMS_CARR_CD     VIA_WMS_CARR_CD
           ,VIA_OSHP.WMS_TRNSP_TP_CD
           ,SH.RTL_WH_CD
           ,MAX(SH.WMS_SQ_NUM)       WMS_SQ_NUM
        FROM
            WMS_INBD_TRX    TRX
           ,WMS_SHIP_VIA    VIA_OSHP
           ,WMS_INBD_SO_HDR SH
        WHERE
            TRX.GLBL_CMPY_CD         = #glblCmpyCd#
        AND TRX.WMS_TASK_CD          = #wmsTaskOshp#
        <iterate property="wmsTrgtWhCd" var="elem[]" open="AND TRX.WH_CD IN (" close=")" conjunction=",">
            #elem[]#
        </iterate>
        <iterate property="wmsOrdTpCd" var="elem[]" open="AND TRX.OTBD_ORD_TP_CD IN (" close=")" conjunction=",">
            #elem[]#
        </iterate>
        AND TRX.PROC_STS_CD          = #procStsCdInComp#
        AND TRX.INTFC_PROC_STS_CD    = #procStsCdComp#
        AND TRX.EZCANCELFLAG         = '0'
        AND TRX.GLBL_CMPY_CD         = VIA_OSHP.GLBL_CMPY_CD(+)
        AND TRX.WMS_CARR_CD          = VIA_OSHP.WMS_CARR_CD(+)
        AND TRX.WMS_ORG_HOST_ID      = VIA_OSHP.WMS_ORG_HOST_ID(+)
        AND VIA_OSHP.EZCANCELFLAG(+) = '0'
        AND TRX.GLBL_CMPY_CD         = SH.GLBL_CMPY_CD (+)
        AND TRX.WH_CD                = SH.WH_CD (+)
        AND TRX.OTBD_ORD_NUM         = SH.WMS_SO_ID (+)
        AND SH.EZCANCELFLAG(+)       = '0'
        GROUP BY
            TRX.GLBL_CMPY_CD
           ,TRX.WMS_INBD_TRX_PK
           ,TRX.WMS_REC_ID
           ,TRX.WH_CD
           ,TRX.WMS_ORD_QTY
           ,TRX.WMS_TRX_DT_TM_TS
           ,TRX.WMS_TASK_CD
           ,TRX.OTBD_ORD_NUM
           ,TRX.OTBD_ORD_TP_CD
           ,TRX.WMS_ORD_STS_CD
           ,TRX.WMS_SHIP_ID
           ,TRX.WMS_FRT_CHRG_AMT
           ,TRX.TMS_FRT_CHRG_AMT
           ,TRX.WMS_TOT_WT
           ,TRX.WMS_CARR_CD
           ,TRX.WMS_ORG_HOST_ID
           ,TRX.EZINTIME
           ,VIA_OSHP.WMS_CARR_CD
           ,VIA_OSHP.WMS_TRNSP_TP_CD
           ,SH.RTL_WH_CD
        ORDER BY
            TRX.WMS_INBD_TRX_PK
    </statement>

    <statement id="getSoConfOshpForTpl" parameterClass="Map">
        SELECT
            TRX.GLBL_CMPY_CD
           ,TRX.WMS_INBD_TRX_PK
           ,TRX.WMS_REC_ID
           ,TRX.WH_CD
           ,TRX.WMS_ORD_QTY
           ,TRX.WMS_TRX_DT_TM_TS
           ,TRX.WMS_TASK_CD
           ,TRX.OTBD_ORD_NUM
           ,TRX.OTBD_ORD_TP_CD
           ,TRX.WMS_ORD_STS_CD
           ,TRX.WMS_SHIP_ID
           ,TRX.WMS_FRT_CHRG_AMT
           ,TRX.TMS_FRT_CHRG_AMT
           ,TRX.WMS_TOT_WT
           ,TRX.WMS_CARR_CD
           ,TRX.WMS_ORG_HOST_ID
           ,TRX.EZINTIME
           ,TRX.WMS_CARR_CD          VIA_WMS_CARR_CD
           ,NULL                     WMS_TRNSP_TP_CD
           ,SH.RTL_WH_CD
           ,MAX(SH.WMS_SQ_NUM)       WMS_SQ_NUM
        FROM
            WMS_INBD_TRX     TRX
           ,TPL_CARR_SVC_LVL VIA_OSHP
           ,WMS_INBD_SO_HDR  SH
        WHERE
            TRX.GLBL_CMPY_CD         = #glblCmpyCd#
        AND TRX.WMS_TASK_CD          = #wmsTaskOshp#
        <iterate property="wmsOrdTpCd" var="elem[]" open="AND TRX.OTBD_ORD_TP_CD IN (" close=")" conjunction=",">
            #elem[]#
        </iterate>
        AND TRX.PROC_STS_CD          = #procStsCdInComp#
        AND TRX.INTFC_PROC_STS_CD    = #procStsCdComp#
        AND TRX.EZCANCELFLAG         = '0'
        AND EXISTS (
            SELECT
                1
            FROM
                TPL_LOC TL
            WHERE
                TL.GLBL_CMPY_CD = TRX.GLBL_CMPY_CD
            AND TL.TPL_LOC_CD   = TRX.WH_CD
            AND TL.EZCANCELFLAG = '0'
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                     RTL_WH RW
                    ,WMS_WH WW
                WHERE
                    RW.GLBL_CMPY_CD = TL.GLBL_CMPY_CD
                AND RW.RTL_WH_CD    = TL.TPL_LOC_CD
                AND RW.EZCANCELFLAG = '0'
                AND RW.GLBL_CMPY_CD = WW.GLBL_CMPY_CD
                AND RW.WMS_WH_CD    = WW.WH_CD
                AND WW.EZCANCELFLAG = '0'
            )
        )
        AND TRX.GLBL_CMPY_CD         = VIA_OSHP.GLBL_CMPY_CD(+)
        AND TRX.WMS_CARR_CD          = VIA_OSHP.TPL_CARR_SVC_LVL_CD(+)
        AND VIA_OSHP.EZCANCELFLAG(+) = '0'
        AND TRX.GLBL_CMPY_CD         = SH.GLBL_CMPY_CD (+)
        AND TRX.WH_CD                = SH.WH_CD (+)
        AND TRX.OTBD_ORD_NUM         = SH.WMS_SO_ID (+)
        AND SH.EZCANCELFLAG(+)       = '0'
        GROUP BY
            TRX.GLBL_CMPY_CD
           ,TRX.WMS_INBD_TRX_PK
           ,TRX.WMS_REC_ID
           ,TRX.WH_CD
           ,TRX.WMS_ORD_QTY
           ,TRX.WMS_TRX_DT_TM_TS
           ,TRX.WMS_TASK_CD
           ,TRX.OTBD_ORD_NUM
           ,TRX.OTBD_ORD_TP_CD
           ,TRX.WMS_ORD_STS_CD
           ,TRX.WMS_SHIP_ID
           ,TRX.WMS_FRT_CHRG_AMT
           ,TRX.TMS_FRT_CHRG_AMT
           ,TRX.WMS_TOT_WT
           ,TRX.WMS_CARR_CD
           ,TRX.WMS_ORG_HOST_ID
           ,TRX.EZINTIME
           ,TRX.WMS_CARR_CD
           ,SH.RTL_WH_CD
        ORDER BY
            TRX.WMS_INBD_TRX_PK
    </statement>

    <statement id="getSoConfShip" parameterClass="Map">
        SELECT
            SHIP.WMS_INBD_TRX_PK
           ,SHIP.WMS_REC_ID
           ,SHIP.OTBD_ORD_TP_CD
           ,SHIP.OTBD_ORD_LINE_NUM
           ,SHIP.WMS_OUT_CNTNR_NUM
           ,SHIP.WMS_CARR_CD
           ,SHIP.WMS_TOT_WT
           ,SHIP.WMS_FRT_CHRG_AMT
           ,SHIP.BOL_NUM
           ,SHIP.PRO_NUM
           ,SHIP.TMS_TRK_NUM
           ,SHIP.WMS_MDSE_CD
           ,SHIP.WMS_STK_STS_CD
           ,SHIP.WMS_ORD_QTY
           ,VIA_SHIP.CARR_SCAC_CD
           ,VIA_SHIP.SHPG_SVC_LVL_CD
           ,SD.RTL_WH_CD
           ,SD.RTL_SWH_CD
           ,SHIP.INTFC_PROC_STS_CD
           ,SHIP.INTFC_ERR_MSG_CD
        FROM
            WMS_INBD_TRX    SHIP
           ,WMS_SHIP_VIA    VIA_SHIP
           ,WMS_INBD_SO_DTL SD
        WHERE
            SHIP.GLBL_CMPY_CD        = #glblCmpyCd#
        AND SHIP.WH_CD               = #whCd#
        AND SHIP.OTBD_ORD_NUM        = #otbdOrdNum#
        AND SHIP.WMS_SHIP_ID         = #wmsShipId#
        AND SHIP.WMS_TASK_CD         = #wmsTaskShip#
        AND SHIP.PROC_STS_CD         = #procStsCdInComp#
        AND SHIP.EZCANCELFLAG        = '0'
        AND SHIP.GLBL_CMPY_CD        = VIA_SHIP.GLBL_CMPY_CD(+)
        AND SHIP.WMS_CARR_CD         = VIA_SHIP.WMS_CARR_CD(+)
        AND SHIP.WMS_ORG_HOST_ID     = VIA_SHIP.WMS_ORG_HOST_ID(+)
        AND VIA_SHIP.EZCANCELFLAG(+) = '0'
        AND SHIP.GLBL_CMPY_CD        = SD.GLBL_CMPY_CD(+)
        AND SHIP.WH_CD               = SD.WH_CD(+)
        AND SHIP.OTBD_ORD_NUM        = SD.WMS_SO_ID(+)
        AND SHIP.OTBD_ORD_LINE_NUM   = SD.WMS_LINE_NUM(+)
        AND SD.WMS_SQ_NUM(+)         = #wmsSqNum#
        AND SD.EZCANCELFLAG(+)       = '0' 
        ORDER BY
            SHIP.WMS_INBD_TRX_PK
    </statement>

    <statement id="getSoConfShipForTpl" parameterClass="Map">
        SELECT
           SHIP.WMS_INBD_TRX_PK
          ,SHIP.WMS_REC_ID
          ,SHIP.OTBD_ORD_TP_CD
          ,SHIP.OTBD_ORD_LINE_NUM
          ,SHIP.WMS_OUT_CNTNR_NUM
          ,SHIP.WMS_CARR_CD
          ,SHIP.WMS_TOT_WT
          ,SHIP.WMS_FRT_CHRG_AMT
          ,SHIP.BOL_NUM
          ,SHIP.PRO_NUM
          ,SHIP.TMS_TRK_NUM
          ,SHIP.WMS_MDSE_CD
          ,SHIP.WMS_STK_STS_CD
          ,SHIP.WMS_ORD_QTY
          ,VIA_SHIP.CARR_CD         CARR_SCAC_CD
          ,VIA_SHIP.SHPG_SVC_LVL_CD
          ,SD.RTL_WH_CD
          ,SD.RTL_SWH_CD
          ,SHIP.INTFC_PROC_STS_CD
          ,SHIP.INTFC_ERR_MSG_CD
        FROM
            WMS_INBD_TRX     SHIP
           ,TPL_CARR_SVC_LVL VIA_SHIP
           ,WMS_INBD_SO_DTL  SD
        WHERE
            SHIP.GLBL_CMPY_CD        = #glblCmpyCd#
        AND SHIP.WH_CD               = #whCd#
        AND SHIP.OTBD_ORD_NUM        = #otbdOrdNum#
        AND SHIP.WMS_SHIP_ID         = #wmsShipId#
        AND SHIP.WMS_TASK_CD         = #wmsTaskShip#
        AND SHIP.PROC_STS_CD         = #procStsCdInComp#
        AND SHIP.EZCANCELFLAG        = '0'
        AND EXISTS (
            SELECT
                1
            FROM
                TPL_LOC TL
            WHERE
                TL.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD
            AND TL.TPL_LOC_CD   = SHIP.WH_CD
            AND TL.EZCANCELFLAG = '0'
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                     RTL_WH RW
                    ,WMS_WH WW
                WHERE
                    RW.GLBL_CMPY_CD = TL.GLBL_CMPY_CD
                AND RW.RTL_WH_CD    = TL.TPL_LOC_CD
                AND RW.EZCANCELFLAG = '0'
                AND RW.GLBL_CMPY_CD = WW.GLBL_CMPY_CD
                AND RW.WMS_WH_CD    = WW.WH_CD
                AND WW.EZCANCELFLAG = '0'
            )
        )
        AND SHIP.GLBL_CMPY_CD        = VIA_SHIP.GLBL_CMPY_CD(+)
        AND SHIP.WMS_CARR_CD         = VIA_SHIP.TPL_CARR_SVC_LVL_CD(+)
        AND VIA_SHIP.EZCANCELFLAG(+) = '0'
        AND SHIP.GLBL_CMPY_CD        = SD.GLBL_CMPY_CD(+)
        AND SHIP.WH_CD               = SD.WH_CD(+)
        AND SHIP.OTBD_ORD_NUM        = SD.WMS_SO_ID(+)
        AND SHIP.OTBD_ORD_LINE_NUM   = SD.WMS_LINE_NUM(+)
        AND SD.WMS_SQ_NUM(+)         = #wmsSqNum#
        AND SD.EZCANCELFLAG(+)       = '0' 
        ORDER BY
            SHIP.WMS_INBD_TRX_PK
    </statement>

    <statement id="getSoConfOchg" parameterClass="Map">
        SELECT
            OCHG.WMS_INBD_TRX_PK
           ,OCHG.WMS_REC_ID
           ,OCHG.TMS_FRT_CHRG_AMT
           ,OCHG.INTFC_PROC_STS_CD
           ,OCHG.INTFC_ERR_MSG_CD
        FROM
            WMS_INBD_TRX OCHG
        WHERE
            OCHG.GLBL_CMPY_CD        = #glblCmpyCd#
        AND OCHG.WH_CD               = #whCd#
        AND OCHG.OTBD_ORD_NUM        = #otbdOrdNum#
        AND OCHG.WMS_SHIP_ID         = #wmsShipId#
        AND OCHG.WMS_TASK_CD         = #wmsTaskOchg#
        AND OCHG.PROC_STS_CD         = #procStsCdInComp#
        AND OCHG.EZCANCELFLAG        = '0'
        ORDER BY
            OCHG.WMS_INBD_TRX_PK
    </statement>

    <statement id="getWmsInbdTrxShipList" parameterClass="Map" resultClass="Map">
    SELECT
        SHIP.WMS_INBD_TRX_PK
       ,SHIP.WMS_REC_ID
       ,SHIP.WH_CD
       ,SHIP.OTBD_ORD_TP_CD
       ,SHIP.OTBD_ORD_NUM
       ,SHIP.OTBD_ORD_LINE_NUM
       ,SHIP.WMS_SHIP_ID
       ,SHIP.WMS_OUT_CNTNR_NUM
       ,SHIP.WMS_CARR_CD
       ,VIA_SHIP.WMS_CARR_CD     VIA_WMS_CARR_CD
       ,SHIP.WMS_TOT_WT
       ,SHIP.WMS_FRT_CHRG_AMT
       ,SHIP.BOL_NUM
       ,SHIP.PRO_NUM
       ,SHIP.TMS_TRK_NUM
       ,SHIP.WMS_MDSE_CD
       ,SHIP.WMS_STK_STS_CD
       ,SHIP.WMS_ORD_QTY
       ,SHIP.EZINTIME
       <!-- START 2020/11/20 A.Marte [QC#57659,ADD] -->
       ,SHIP.CARR_ENC_TRK_URL
        <!-- END 2020/11/20 A.Marte [QC#57659,ADD] -->
       <!-- START 2021/08/27 R.Azucena [QC#59036, ADD] -->
       ,SHIP.WMS_CNTNR_ID
       <!-- END 2021/08/27 R.Azucena [QC#59036, ADD] -->
       ,VIA_SHIP.CARR_SCAC_CD
       ,VIA_SHIP.SHPG_SVC_LVL_CD
       ,VIA_SHIP.WMS_TRNSP_TP_CD
       ,SH.RTL_WH_CD
       ,SD.RTL_SWH_CD
       ,RS.INVTY_LOC_CD
       ,SSC.S80_STK_STS_CD
       ,SH.WMS_SQ_NUM
       ,SST.SO_PRINT_FLG 
       ,SST.SHIP_FLG
       ,SO.SCE_ORD_TP_CD
       ,SOD.FROM_STK_STS_CD
       ,SOD.MDSE_CD              SOD_MDSE_CD
       ,SOD.RTL_WH_CD            SOD_RTL_WH_CD
       ,SOD.RTL_SWH_CD           SOD_RTL_SWH_CD
       <!-- START 2022/08/08 R.Azucena [QC#60416, DEL] -->
       <!-- START 2022/04/04 R.Azucena [QC#59802, ADD] -->
       <!-- ,SOD.SER_NUM_TAKE_FLG -->
       <!-- ,SOD.PICK_SVC_CONFIG_MSTR_PK -->
       <!-- END 2022/04/04 R.Azucena [QC#59802, ADD] -->
       <!-- START 2022/04/25 R.Azucena [QC#59802-1, ADD] -->
       <!-- ,M.INSTL_BASE_CTRL_FLG -->
       <!-- END 2022/04/25 R.Azucena [QC#59802-1, ADD] -->
       <!-- END 2022/08/08 R.Azucena [QC#60416, DEL] -->
       ,CASE WHEN NVL(SOD.SHPG_QTY,0) >= NVL(SOD.SHIP_QTY,0) + NVL(SHIP.WMS_ORD_QTY,0)
             THEN 'N'
             ELSE 'Y'
        END SHIP_OVER_ERR
       ,CASE WHEN SO.GLBL_CMPY_CD IS NULL
             THEN 'N'
             ELSE 'Y'
        END SHPG_ORD_EXIST
       ,CASE WHEN SOD.GLBL_CMPY_CD IS NULL
             THEN 'N'
             ELSE 'Y'
        END SHPG_ORD_DTL_EXIST
       ,CASE WHEN STS.GLBL_CMPY_CD IS NULL
             THEN 'N'
             ELSE 'Y'
        END STK_STS_CD_EXIST
       ,SHIP.WMS_OP_ID
       ,SHIP.WMS_TASK_CD
       ,SHIP.INTFC_TRX_ID
       ,SO.SRC_ORD_NUM
    FROM
        WMS_INBD_TRX    SHIP
       ,WMS_SHIP_VIA    VIA_SHIP
       ,(SELECT
               SH.GLBL_CMPY_CD
              ,SH.WH_CD
              ,SH.WMS_SO_ID
              ,SH.RTL_WH_CD
              ,SH.WMS_SQ_NUM
         FROM WMS_INBD_SO_HDR SH
            , (
              SELECT
                   MH.GLBL_CMPY_CD     GLBL_CMPY_CD
                  ,MH.WH_CD            WH_CD
                  ,MH.WMS_SO_ID        WMS_SO_ID
                  ,MAX(MH.WMS_SQ_NUM)  WMS_SQ_NUM
              FROM
                   WMS_INBD_SO_HDR MH
              WHERE
                   MH.GLBL_CMPY_CD = #glblCmpyCd#
              <iterate property="wmsTrgtWhCd" var="elem[]" open="AND MH.WH_CD IN (" close=")" conjunction=",">
                 #elem[]#
              </iterate>
              GROUP BY
                    MH.GLBL_CMPY_CD
                   ,MH.WH_CD
                   ,MH.WMS_SO_ID
              ) MH
         WHERE SH.GLBL_CMPY_CD   = MH.GLBL_CMPY_CD
         AND   SH.WH_CD          = MH.WH_CD
         AND   SH.WMS_SO_ID      = MH.WMS_SO_ID
         AND   SH.WMS_SQ_NUM     = MH.WMS_SQ_NUM
         AND   SH.EZCANCELFLAG   = '0'
        ) SH
       ,WMS_INBD_SO_DTL SD
       ,SHPG_ORD        SO
       ,SHPG_ORD_DTL    SOD
       ,SHPG_STS        SST
       ,RTL_SWH         RS
       ,STK_STS_CONV    SSC
       ,STK_STS         STS
       <!-- START 2022/04/25 R.Azucena [QC#59802-1, ADD] -->
       <!-- START 2022/08/08 R.Azucena [QC#60416, DEL] -->
       <!-- ,MDSE            M -->
       <!-- END 2022/08/08 R.Azucena [QC#60416, DEL] -->
       <!-- END 2022/04/25 R.Azucena [QC#59802-1, ADD] -->
    WHERE
        SHIP.GLBL_CMPY_CD        = #glblCmpyCd#
    AND SHIP.WMS_TASK_CD         = #wmsTaskShip#
    <iterate property="wmsTrgtWhCd" var="elem[]" open="AND SHIP.WH_CD IN (" close=")" conjunction=",">
        #elem[]#
    </iterate>
    <iterate property="wmsOrdTpCd" var="elem[]" open="AND SHIP.OTBD_ORD_TP_CD IN (" close=")" conjunction=",">
        #elem[]#
    </iterate>
    AND SHIP.PROC_STS_CD         = #procStsCdInComp#
    AND SHIP.INTFC_PROC_STS_CD   = #intfcProcStsCdComp#
    AND SHIP.EZCANCELFLAG        = '0'
    AND SHIP.GLBL_CMPY_CD        = VIA_SHIP.GLBL_CMPY_CD(+)
    AND SHIP.WMS_CARR_CD         = VIA_SHIP.WMS_CARR_CD(+)
    AND SHIP.WMS_ORG_HOST_ID     = VIA_SHIP.WMS_ORG_HOST_ID(+)
    AND VIA_SHIP.EZCANCELFLAG(+) = '0'
    AND SHIP.GLBL_CMPY_CD        = SH.GLBL_CMPY_CD(+)
    AND SHIP.WH_CD               = SH.WH_CD(+)
    AND SHIP.OTBD_ORD_NUM        = SH.WMS_SO_ID(+)
    AND SHIP.GLBL_CMPY_CD        = STS.GLBL_CMPY_CD(+)
    AND SHIP.WMS_STK_STS_CD      = STS.STK_STS_CD(+)
    AND STS.EZCANCELFLAG(+)      = '0'
    AND SHIP.GLBL_CMPY_CD        = SO.GLBL_CMPY_CD(+)
    AND SHIP.OTBD_ORD_NUM        = SO.SO_NUM(+)
    AND SO.EZCANCELFLAG(+)       = '0'
    AND SHIP.GLBL_CMPY_CD                         = SOD.GLBL_CMPY_CD(+)
    AND SHIP.OTBD_ORD_NUM                         = SOD.SO_NUM(+)
    AND LPAD(NVL(SHIP.OTBD_ORD_LINE_NUM,0),3,'0') = SOD.SO_SLP_NUM(+)
    AND SOD.EZCANCELFLAG(+)      = '0'
    AND SOD.GLBL_CMPY_CD         = SST.GLBL_CMPY_CD(+)
    AND SOD.SHPG_STS_CD          = SST.SHPG_STS_CD(+)
    AND SST.EZCANCELFLAG(+)      = '0'
    AND SH.GLBL_CMPY_CD          = SD.GLBL_CMPY_CD(+)
    AND SH.WH_CD                 = SD.WH_CD(+)
    AND SH.WMS_SO_ID             = SD.WMS_SO_ID(+)
    AND SH.WMS_SQ_NUM            = SD.WMS_SQ_NUM(+)
    AND SHIP.OTBD_ORD_LINE_NUM   = SD.WMS_LINE_NUM(+)
    AND SD.EZCANCELFLAG(+)       = '0'
    AND SD.GLBL_CMPY_CD          = RS.GLBL_CMPY_CD(+)
    AND SD.RTL_WH_CD             = RS.RTL_WH_CD(+)
    AND SD.RTL_SWH_CD            = RS.RTL_SWH_CD(+)
    AND RS.EZCANCELFLAG(+)       = '0'
    AND SHIP.GLBL_CMPY_CD        = SSC.GLBL_CMPY_CD(+)
    AND SHIP.WMS_STK_STS_CD      = SSC.STK_STS_CD(+)
    AND SSC.EZCANCELFLAG(+)      = '0'
    <!-- START 2022/04/25 R.Azucena [QC#59802-1, ADD] -->
    <!-- START 2022/08/08 R.Azucena [QC#60416, DEL] -->
    <!-- AND M.GLBL_CMPY_CD(+)        = SOD.GLBL_CMPY_CD -->
    <!-- AND M.MDSE_CD(+)             = SOD.MDSE_CD -->
    <!-- AND M.EZCANCELFLAG(+)        = '0' -->
    <!-- END 2022/08/08 R.Azucena [QC#60416, DEL] -->
    <!-- END 2022/04/25 R.Azucena [QC#59802-1, ADD] -->
    ORDER BY
        SHIP.WMS_INBD_TRX_PK
    </statement>

    <statement id="getWmsInbdTrxShipListForTpl" parameterClass="Map" resultClass="Map">
    SELECT
        SHIP.WMS_INBD_TRX_PK
       ,SHIP.WMS_REC_ID
       ,SHIP.WH_CD
       ,SHIP.OTBD_ORD_TP_CD
       ,SHIP.OTBD_ORD_NUM
       ,SHIP.OTBD_ORD_LINE_NUM
       ,SHIP.WMS_SHIP_ID
       ,SHIP.WMS_OUT_CNTNR_NUM
       ,SHIP.WMS_CARR_CD
       ,SHIP.WMS_CARR_CD         VIA_WMS_CARR_CD
       ,SHIP.WMS_TOT_WT
       ,SHIP.WMS_FRT_CHRG_AMT
       ,SHIP.BOL_NUM
       ,SHIP.PRO_NUM
       ,SHIP.TMS_TRK_NUM
       ,SHIP.WMS_MDSE_CD
       ,SHIP.WMS_STK_STS_CD
       ,SHIP.WMS_ORD_QTY
       ,SHIP.EZINTIME
       <!-- START 2020/11/20 A.Marte [QC#57659,ADD] -->
       ,SHIP.CARR_ENC_TRK_URL
        <!-- END 2020/11/20 A.Marte [QC#57659,ADD] -->
       <!-- START 2021/08/27 R.Azucena [QC#59036, ADD] -->
       ,SHIP.WMS_CNTNR_ID
       <!-- END 2021/08/27 R.Azucena [QC#59036, ADD] -->
       ,VIA_SHIP.CARR_CD         CARR_SCAC_CD
       ,VIA_SHIP.SHPG_SVC_LVL_CD
       ,NULL                     WMS_TRNSP_TP_CD
       ,SH.RTL_WH_CD
       ,SD.RTL_SWH_CD
       ,RS.INVTY_LOC_CD
       ,SSC.S80_STK_STS_CD
       ,SH.WMS_SQ_NUM
       ,SST.SO_PRINT_FLG 
       ,SST.SHIP_FLG
       ,SO.SCE_ORD_TP_CD
       ,SOD.FROM_STK_STS_CD
       ,SOD.MDSE_CD              SOD_MDSE_CD
       ,SOD.RTL_WH_CD            SOD_RTL_WH_CD
       ,SOD.RTL_SWH_CD           SOD_RTL_SWH_CD
       <!-- START 2022/08/08 R.Azucena [QC#60416, DEL] -->
       <!-- START 2022/04/04 R.Azucena [QC#59802, ADD] -->
       <!-- ,SOD.SER_NUM_TAKE_FLG -->
       <!-- ,SOD.PICK_SVC_CONFIG_MSTR_PK -->
       <!-- END 2022/04/04 R.Azucena [QC#59802, ADD] -->
       <!-- START 2022/04/25 R.Azucena [QC#59802-1, ADD] -->
       <!-- ,M.INSTL_BASE_CTRL_FLG -->
       <!-- END 2022/04/25 R.Azucena [QC#59802-1, ADD] -->
       <!-- END 2022/08/08 R.Azucena [QC#60416, DEL] -->
       ,CASE WHEN NVL(SOD.SHPG_QTY,0) >= NVL(SOD.SHIP_QTY,0) + NVL(SHIP.WMS_ORD_QTY,0)
             THEN 'N'
             ELSE 'Y'
        END SHIP_OVER_ERR
       ,CASE WHEN SO.GLBL_CMPY_CD IS NULL
             THEN 'N'
             ELSE 'Y'
        END SHPG_ORD_EXIST
       ,CASE WHEN SOD.GLBL_CMPY_CD IS NULL
             THEN 'N'
             ELSE 'Y'
        END SHPG_ORD_DTL_EXIST
       ,CASE WHEN STS.GLBL_CMPY_CD IS NULL
             THEN 'N'
             ELSE 'Y'
        END STK_STS_CD_EXIST
        ,SHIP.WMS_OP_ID
        ,SHIP.WMS_TASK_CD
        ,SHIP.INTFC_TRX_ID
        ,SO.SRC_ORD_NUM
    FROM
        WMS_INBD_TRX     SHIP
       ,TPL_CARR_SVC_LVL VIA_SHIP
       ,(SELECT
               SH.GLBL_CMPY_CD
              ,SH.WH_CD
              ,SH.WMS_SO_ID
              ,SH.RTL_WH_CD
              ,SH.WMS_SQ_NUM
         FROM WMS_INBD_SO_HDR SH
            , (
              SELECT
                   MH.GLBL_CMPY_CD     GLBL_CMPY_CD
                  ,MH.WH_CD            WH_CD
                  ,MH.WMS_SO_ID        WMS_SO_ID
                  ,MAX(MH.WMS_SQ_NUM)  WMS_SQ_NUM
              FROM
                   WMS_INBD_SO_HDR MH
              WHERE
                   MH.GLBL_CMPY_CD = #glblCmpyCd#
              GROUP BY
                    MH.GLBL_CMPY_CD
                   ,MH.WH_CD
                   ,MH.WMS_SO_ID
              ) MH
         WHERE SH.GLBL_CMPY_CD   = MH.GLBL_CMPY_CD
         AND   SH.WH_CD          = MH.WH_CD
         AND   SH.WMS_SO_ID      = MH.WMS_SO_ID
         AND   SH.WMS_SQ_NUM     = MH.WMS_SQ_NUM
         AND   SH.EZCANCELFLAG   = '0'
        ) SH
       ,WMS_INBD_SO_DTL  SD
       ,SHPG_ORD         SO
       ,SHPG_ORD_DTL     SOD
       ,SHPG_STS         SST
       ,RTL_SWH          RS
       ,STK_STS_CONV     SSC
       ,STK_STS          STS
       <!-- START 2022/04/25 R.Azucena [QC#59802-1, ADD] -->
       <!-- START 2022/08/08 R.Azucena [QC#60416, DEL] -->
       <!-- ,MDSE             M -->
       <!-- END 2022/08/08 R.Azucena [QC#60416, DEL] -->
       <!-- END 2022/04/25 R.Azucena [QC#59802-1, ADD] -->
    WHERE
        SHIP.GLBL_CMPY_CD        = #glblCmpyCd#
    AND SHIP.WMS_TASK_CD         = #wmsTaskShip#
        <iterate property="wmsOrdTpCd" var="elem[]" open="AND SHIP.OTBD_ORD_TP_CD IN (" close=")" conjunction=",">
            #elem[]#
        </iterate>
    AND SHIP.PROC_STS_CD         = #procStsCdInComp#
    AND SHIP.INTFC_PROC_STS_CD   = #intfcProcStsCdComp#
    AND SHIP.EZCANCELFLAG        = '0'
    AND EXISTS (
            SELECT
                1
            FROM
                TPL_LOC TL
            WHERE
                TL.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD
            AND TL.TPL_LOC_CD   = SHIP.WH_CD
            AND TL.EZCANCELFLAG = '0'
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                     RTL_WH RW
                    ,WMS_WH WW
                WHERE
                    RW.GLBL_CMPY_CD = TL.GLBL_CMPY_CD
                AND RW.RTL_WH_CD    = TL.TPL_LOC_CD
                AND RW.EZCANCELFLAG = '0'
                AND RW.GLBL_CMPY_CD = WW.GLBL_CMPY_CD
                AND RW.WMS_WH_CD    = WW.WH_CD
                AND WW.EZCANCELFLAG = '0'
            )
        )
    AND SHIP.GLBL_CMPY_CD        = VIA_SHIP.GLBL_CMPY_CD(+)
    AND SHIP.WMS_CARR_CD         = VIA_SHIP.TPL_CARR_SVC_LVL_CD(+)
    AND VIA_SHIP.EZCANCELFLAG(+) = '0'
    AND SHIP.GLBL_CMPY_CD        = SH.GLBL_CMPY_CD(+)
    AND SHIP.WH_CD               = SH.WH_CD(+)
    AND SHIP.OTBD_ORD_NUM        = SH.WMS_SO_ID(+)
    AND SHIP.GLBL_CMPY_CD        = STS.GLBL_CMPY_CD(+)
    AND SHIP.WMS_STK_STS_CD      = STS.STK_STS_CD(+)
    AND STS.EZCANCELFLAG(+)      = '0'
    AND SHIP.GLBL_CMPY_CD        = SO.GLBL_CMPY_CD(+)
    AND SHIP.OTBD_ORD_NUM        = SO.SO_NUM(+)
    AND SO.EZCANCELFLAG(+)       = '0'
    AND SHIP.GLBL_CMPY_CD                         = SOD.GLBL_CMPY_CD(+)
    AND SHIP.OTBD_ORD_NUM                         = SOD.SO_NUM(+)
    AND LPAD(NVL(SHIP.OTBD_ORD_LINE_NUM,0),3,'0') = SOD.SO_SLP_NUM(+)
    AND SOD.EZCANCELFLAG(+)      = '0'
    AND SOD.GLBL_CMPY_CD         = SST.GLBL_CMPY_CD(+)
    AND SOD.SHPG_STS_CD          = SST.SHPG_STS_CD(+)
    AND SST.EZCANCELFLAG(+)      = '0'
    AND SH.GLBL_CMPY_CD          = SD.GLBL_CMPY_CD(+)
    AND SH.WH_CD                 = SD.WH_CD(+)
    AND SH.WMS_SO_ID             = SD.WMS_SO_ID(+)
    AND SH.WMS_SQ_NUM            = SD.WMS_SQ_NUM(+)
    AND SHIP.OTBD_ORD_LINE_NUM   = SD.WMS_LINE_NUM(+)
    AND SD.EZCANCELFLAG(+)       = '0'
    AND SD.GLBL_CMPY_CD          = RS.GLBL_CMPY_CD(+)
    AND SD.RTL_WH_CD             = RS.RTL_WH_CD(+)
    AND SD.RTL_SWH_CD            = RS.RTL_SWH_CD(+)
    AND RS.EZCANCELFLAG(+)       = '0'
    AND SHIP.GLBL_CMPY_CD        = SSC.GLBL_CMPY_CD(+)
    AND SHIP.WMS_STK_STS_CD      = SSC.STK_STS_CD(+)
    AND SSC.EZCANCELFLAG(+)      = '0'
    <!-- START 2022/04/25 R.Azucena [QC#59802-1, ADD] -->
    <!-- START 2022/08/08 R.Azucena [QC#60416, DEL] -->
    <!-- AND M.GLBL_CMPY_CD(+)        = SOD.GLBL_CMPY_CD -->
    <!-- AND M.MDSE_CD(+)             = SOD.MDSE_CD -->
    <!-- AND M.EZCANCELFLAG(+)        = '0' -->
    <!-- END 2022/08/08 R.Azucena [QC#60416, DEL] -->
    <!-- END 2022/04/25 R.Azucena [QC#59802-1, ADD] -->
    ORDER BY
    SHIP.WMS_INBD_TRX_PK
    </statement>

    <statement id="getWmsInbdTrxOshpList" parameterClass="Map" resultClass="Map">
    SELECT
        OSHP.GLBL_CMPY_CD
       ,OSHP.WMS_TASK_CD
       ,OSHP.WMS_INBD_TRX_PK
       ,OSHP.WMS_TRX_DT_TM_TS
       ,OSHP.OTBD_ORD_NUM
       ,OSHP.OTBD_ORD_TP_CD
       ,OSHP.INBD_ORD_TP_CD
       ,OSHP.WMS_ORD_STS_CD
       ,OSHP.WMS_FRT_CHRG_AMT
       ,OSHP.WMS_TOT_WT
       ,SH.WH_CD
       ,SH.WMS_SQ_NUM
       ,SH.RTL_WH_CD
    FROM
        WMS_INBD_TRX    OSHP
       ,WMS_INBD_SO_HDR SH
    WHERE
        OSHP.GLBL_CMPY_CD      = #glblCmpyCd#
    AND OSHP.WMS_TASK_CD       = #wmsTaskOshp#
    AND OSHP.WH_CD             = #whCd#
    AND OSHP.OTBD_ORD_NUM      = #otbdOrdNum#
    AND OSHP.WMS_SHIP_ID       = #wmsShipId#
    AND OSHP.PROC_STS_CD       = #procStsCdInComp#
    AND OSHP.INTFC_PROC_STS_CD = #intfcProcStsCdComp#
    AND OSHP.EZCANCELFLAG      = '0'
    AND OSHP.GLBL_CMPY_CD      = SH.GLBL_CMPY_CD(+)
    AND OSHP.WH_CD             = SH.WH_CD(+)
    AND OSHP.OTBD_ORD_NUM      = SH.WMS_SO_ID(+)
    AND SH.WMS_SQ_NUM(+)       = #wmsSqNum#
    AND SH.EZCANCELFLAG(+)     = '0'
    AND NOT EXISTS (SELECT
                        1
                    FROM
                        WMS_INBD_TRX SHIP
                    WHERE
                        SHIP.GLBL_CMPY_CD = OSHP.GLBL_CMPY_CD
                    AND SHIP.WH_CD        = OSHP.WH_CD
                    AND SHIP.OTBD_ORD_NUM = OSHP.OTBD_ORD_NUM
                    AND SHIP.WMS_SHIP_ID  = OSHP.WMS_SHIP_ID
                    AND SHIP.WMS_TASK_CD  = #wmsTaskShip#
                    AND SHIP.PROC_STS_CD IN (#procStsCdInComp#, #procStsCdErr#)
                    AND SHIP.EZCANCELFLAG = '0'
                   )
    AND NOT EXISTS (SELECT
                        1
                    FROM
                        WMS_INBD_TRX OCHG
                    WHERE
                        OCHG.GLBL_CMPY_CD = OSHP.GLBL_CMPY_CD
                    AND OCHG.WH_CD        = OSHP.WH_CD
                    AND OCHG.OTBD_ORD_NUM = OSHP.OTBD_ORD_NUM
                    AND OCHG.WMS_SHIP_ID  = OSHP.WMS_SHIP_ID
                    AND OCHG.WMS_TASK_CD  = #wmsTaskOchg#
                    AND OCHG.PROC_STS_CD IN (#procStsCdInComp#, #procStsCdErr#)
                    AND OCHG.EZCANCELFLAG = '0'
                   )
    ORDER BY
        OSHP.WMS_INBD_TRX_PK
    </statement>

    <statement id="getWmsInbdTrxSerlList" parameterClass="Map" resultClass="Map">
        SELECT
            SERL.WMS_INBD_TRX_PK
           ,SERL.WMS_REC_ID
           ,SERL.WMS_TRX_DT_TM_TS
           ,SERL.OTBD_ORD_LINE_NUM
           ,SERL.WMS_MDSE_CD
           ,SERL.SER_NUM
           ,SD.RTL_WH_CD
           ,SD.RTL_SWH_CD
           ,#fromStkStsCd# AS FROM_STK_STS_CD
        FROM
            WMS_INBD_TRX SERL
           ,WMS_INBD_SO_DTL SD
        WHERE
            SERL.GLBL_CMPY_CD        = #glblCmpyCd#
        AND SERL.WH_CD               = #whCd#
        AND SERL.OTBD_ORD_NUM        = #otbdOrdNum#
        AND SERL.OTBD_ORD_LINE_NUM   = #otbdOrdLineNum#
        AND SERL.WMS_SHIP_ID         = #wmsShipId#
        AND SERL.WMS_TASK_CD         = #wmsTaskSerl#
        AND SERL.PROC_STS_CD         = #procStsCdInComp#
        AND SERL.INTFC_PROC_STS_CD   = #intfcProcStsCdComp#
        AND SERL.EZCANCELFLAG        = '0'
        AND SERL.GLBL_CMPY_CD        = SD.GLBL_CMPY_CD(+)
        AND SERL.WH_CD               = SD.WH_CD(+)
        AND SERL.OTBD_ORD_NUM        = SD.WMS_SO_ID(+)
        AND SERL.OTBD_ORD_LINE_NUM   = SD.WMS_LINE_NUM(+)
        AND SD.WMS_SQ_NUM(+)         = #wmsSqNum#
        AND SD.EZCANCELFLAG(+)       = '0' 
        ORDER BY
            SERL.WMS_INBD_TRX_PK
    </statement>

    <statement id="getWmsInbdTrxOshpAndOscList" parameterClass="Map" resultClass="Map">
    SELECT
        TRX.GLBL_CMPY_CD
       ,TRX.WMS_INBD_TRX_PK
       ,TRX.WH_CD
       ,TRX.OTBD_ORD_NUM
       ,TRX.OTBD_ORD_TP_CD
       ,TRX.WMS_ORD_STS_CD
       ,TRX.WMS_FRT_CHRG_AMT
       ,TRX.INBD_ORD_TP_CD
       ,TRX.WMS_TOT_WT
       ,SH.RTL_WH_CD
       ,SH.WMS_SQ_NUM
    FROM
           WMS_INBD_TRX TRX
          ,(SELECT
                  SH.GLBL_CMPY_CD
                 ,SH.WH_CD
                 ,SH.WMS_SO_ID
                 ,SH.RTL_WH_CD
                 ,SH.WMS_SQ_NUM
            FROM WMS_INBD_SO_HDR SH
               , (
                 SELECT
                      MH.GLBL_CMPY_CD     GLBL_CMPY_CD
                     ,MH.WH_CD            WH_CD
                     ,MH.WMS_SO_ID        WMS_SO_ID
                     ,MAX(MH.WMS_SQ_NUM)  WMS_SQ_NUM
                 FROM
                      WMS_INBD_SO_HDR MH
                 WHERE
                      MH.GLBL_CMPY_CD = #glblCmpyCd#
                 <iterate property="wmsTrgtWhCd" var="elem[]" open="AND MH.WH_CD IN (" close=")" conjunction=",">
                    #elem[]#
                 </iterate>
                 GROUP BY
                       MH.GLBL_CMPY_CD
                      ,MH.WH_CD
                      ,MH.WMS_SO_ID
                 ) MH
            WHERE SH.GLBL_CMPY_CD   = MH.GLBL_CMPY_CD
            AND   SH.WH_CD          = MH.WH_CD
            AND   SH.WMS_SO_ID      = MH.WMS_SO_ID
            AND   SH.WMS_SQ_NUM     = MH.WMS_SQ_NUM
            AND   SH.EZCANCELFLAG   = '0'
           ) SH
    WHERE
           TRX.GLBL_CMPY_CD         = #glblCmpyCd#
    AND (
             TRX.WMS_TASK_CD        = #wmsTaskOshp#
         OR (    TRX.WMS_TASK_CD    = #wmsTaskOsc#
             AND TRX.WMS_ORD_STS_CD = #wmsOrdStsCan#
            )
         )
    <iterate property="wmsTrgtWhCd" var="elem[]" open="AND TRX.WH_CD IN (" close=")" conjunction=",">
        #elem[]#
    </iterate>
    <iterate property="wmsOrdTpCd" var="elem[]" open="AND TRX.OTBD_ORD_TP_CD IN (" close=")" conjunction=",">
        #elem[]#
    </iterate>
    AND    TRX.PROC_STS_CD          = #procStsCdInComp#
    AND    TRX.INTFC_PROC_STS_CD    = #intfcProcStsCdComp#
    AND    TRX.EZCANCELFLAG         = '0'
    AND    TRX.GLBL_CMPY_CD         = SH.GLBL_CMPY_CD (+)
    AND    TRX.WH_CD                = SH.WH_CD (+)
    AND    TRX.OTBD_ORD_NUM         = SH.WMS_SO_ID (+)
    AND NOT EXISTS (SELECT
                        1
                    FROM
                        WMS_INBD_TRX SHIP
                    WHERE
                        SHIP.GLBL_CMPY_CD = TRX.GLBL_CMPY_CD
                    AND SHIP.WH_CD        = TRX.WH_CD
                    AND SHIP.OTBD_ORD_NUM = TRX.OTBD_ORD_NUM
                    AND SHIP.WMS_SHIP_ID  = TRX.WMS_SHIP_ID
                    AND SHIP.WMS_TASK_CD  = #wmsTaskShip#
                    AND SHIP.PROC_STS_CD IN (#procStsCdInComp#, #procStsCdErr#)
                    AND SHIP.EZCANCELFLAG = '0'
                   )
    AND NOT EXISTS (SELECT
                        1
                    FROM
                        WMS_INBD_TRX OCHG
                    WHERE
                        OCHG.GLBL_CMPY_CD = TRX.GLBL_CMPY_CD
                    AND OCHG.WH_CD        = TRX.WH_CD
                    AND OCHG.OTBD_ORD_NUM = TRX.OTBD_ORD_NUM
                    AND OCHG.WMS_SHIP_ID  = TRX.WMS_SHIP_ID
                    AND OCHG.WMS_TASK_CD  = #wmsTaskOchg#
                    AND OCHG.PROC_STS_CD IN (#procStsCdInComp#, #procStsCdErr#)
                    AND OCHG.EZCANCELFLAG = '0'
                   )
    ORDER BY
           TRX.WMS_INBD_TRX_PK
    </statement>

    <statement id="getWmsInbdTrxOshpAndOscListForTpl" parameterClass="Map" resultClass="Map">
    SELECT
        TRX.GLBL_CMPY_CD
       ,TRX.WMS_INBD_TRX_PK
       ,TRX.WH_CD
       ,TRX.OTBD_ORD_NUM
       ,TRX.OTBD_ORD_TP_CD
       ,TRX.WMS_ORD_STS_CD
       ,TRX.WMS_FRT_CHRG_AMT
       ,TRX.WMS_TOT_WT
       ,TRX.INBD_ORD_TP_CD
       ,SH.RTL_WH_CD
       ,SH.WMS_SQ_NUM
    FROM
        WMS_INBD_TRX     TRX
       ,(SELECT
               SH.GLBL_CMPY_CD
              ,SH.WH_CD
              ,SH.WMS_SO_ID
              ,SH.RTL_WH_CD
              ,SH.WMS_SQ_NUM
         FROM WMS_INBD_SO_HDR SH
            , (
              SELECT
                   MH.GLBL_CMPY_CD     GLBL_CMPY_CD
                  ,MH.WH_CD            WH_CD
                  ,MH.WMS_SO_ID        WMS_SO_ID
                  ,MAX(MH.WMS_SQ_NUM)  WMS_SQ_NUM
              FROM
                   WMS_INBD_SO_HDR MH
              WHERE
                   MH.GLBL_CMPY_CD = #glblCmpyCd#
              GROUP BY
                    MH.GLBL_CMPY_CD
                   ,MH.WH_CD
                   ,MH.WMS_SO_ID
              ) MH
         WHERE SH.GLBL_CMPY_CD   = MH.GLBL_CMPY_CD
         AND   SH.WH_CD          = MH.WH_CD
         AND   SH.WMS_SO_ID      = MH.WMS_SO_ID
         AND   SH.WMS_SQ_NUM     = MH.WMS_SQ_NUM
         AND   SH.EZCANCELFLAG   = '0'
        ) SH
    WHERE
        TRX.GLBL_CMPY_CD         = #glblCmpyCd#
    AND (
         TRX.WMS_TASK_CD     = #wmsTaskOshp#
      OR (    TRX.WMS_TASK_CD    = #wmsTaskOsc#
          AND TRX.WMS_ORD_STS_CD = #wmsOrdStsCan#
         )
        )
    <iterate property="wmsOrdTpCd" var="elem[]" open="AND TRX.OTBD_ORD_TP_CD IN (" close=")" conjunction=",">
        #elem[]#
    </iterate>
    AND TRX.PROC_STS_CD          = #procStsCdInComp#
    AND TRX.INTFC_PROC_STS_CD    = #intfcProcStsCdComp#
    AND TRX.EZCANCELFLAG         = '0'
    AND EXISTS (
            SELECT
                1
            FROM
                TPL_LOC TL
            WHERE
                TL.GLBL_CMPY_CD = TRX.GLBL_CMPY_CD
            AND TL.TPL_LOC_CD   = TRX.WH_CD
            AND TL.EZCANCELFLAG = '0'
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                     RTL_WH RW
                    ,WMS_WH WW
                WHERE
                    RW.GLBL_CMPY_CD = TL.GLBL_CMPY_CD
                AND RW.RTL_WH_CD    = TL.TPL_LOC_CD
                AND RW.EZCANCELFLAG = '0'
                AND RW.GLBL_CMPY_CD = WW.GLBL_CMPY_CD
                AND RW.WMS_WH_CD    = WW.WH_CD
                AND WW.EZCANCELFLAG = '0'
            )
        )
    AND TRX.GLBL_CMPY_CD         = SH.GLBL_CMPY_CD (+)
    AND TRX.WH_CD                = SH.WH_CD (+)
    AND TRX.OTBD_ORD_NUM         = SH.WMS_SO_ID (+)
    AND NOT EXISTS (SELECT
                        1
                    FROM
                        WMS_INBD_TRX SHIP
                    WHERE
                        SHIP.GLBL_CMPY_CD = TRX.GLBL_CMPY_CD
                    AND SHIP.WH_CD        = TRX.WH_CD
                    AND SHIP.OTBD_ORD_NUM = TRX.OTBD_ORD_NUM
                    AND SHIP.WMS_SHIP_ID  = TRX.WMS_SHIP_ID
                    AND SHIP.WMS_TASK_CD  = #wmsTaskShip#
                    AND SHIP.PROC_STS_CD IN (#procStsCdInComp#, #procStsCdErr#)
                    AND SHIP.EZCANCELFLAG = '0'
                   )
    AND NOT EXISTS (SELECT
                    1
                    FROM
                        WMS_INBD_TRX OCHG
                    WHERE
                        OCHG.GLBL_CMPY_CD = TRX.GLBL_CMPY_CD
                    AND OCHG.WH_CD        = TRX.WH_CD
                    AND OCHG.OTBD_ORD_NUM = TRX.OTBD_ORD_NUM
                    AND OCHG.WMS_SHIP_ID  = TRX.WMS_SHIP_ID
                    AND OCHG.WMS_TASK_CD  = #wmsTaskOchg#
                    AND OCHG.PROC_STS_CD IN (#procStsCdInComp#, #procStsCdErr#)
                    AND OCHG.EZCANCELFLAG = '0'
                   )
    ORDER BY
        TRX.WMS_INBD_TRX_PK
    </statement>

    <statement id="getSceOrdTp" parameterClass="Map" resultClass="String">
        SELECT
            TP.SCE_ORD_TP_CD
        FROM
            SCE_ORD_TP  TP
        WHERE
            TP.GLBL_CMPY_CD  = #glblCmpyCd#
        AND TP.S80_ORD_TP_CD = #s80OrdTpCd#
        AND TP.INBD_OTBD_CD  = #inbdOtbdCd#
        AND TP.EZCANCELFLAG  = '0'
    </statement>

    <statement id="locFrtChrg" parameterClass="Map" resultMap="result.locFrtChrg">
        SELECT
            TRX.GLBL_CMPY_CD
           ,TRX.WMS_INBD_TRX_PK
        FROM
            WMS_INBD_TRX TRX
        WHERE
            TRX.GLBL_CMPY_CD   = #glblCmpyCd#
        AND TRX.WH_CD          = #whCd#
        AND TRX.WMS_SHIP_ID    = #wmsShipId#
        AND TRX.OTBD_ORD_NUM   = #otbdOrdNum#
        AND TRX.WMS_TASK_CD    = #wmsTaskCd#
        AND TRX.EZCANCELFLAG   = '0'
        FOR UPDATE
    </statement>

    <resultMap id="result.locFrtChrg" class="WMS_INBD_TRXTMsg">
        <result property="glblCmpyCd"      column="GLBL_CMPY_CD"       javaType="EZDTStringItem"/>
        <result property="wmsInbdTrxPk"    column="WMS_INBD_TRX_PK"    javaType="EZDTStringItem"/>
    </resultMap>

    <statement id="locFrtChrgBol" parameterClass="Map" resultMap="result.locFrtChrgBol">
    SELECT
           TRX.GLBL_CMPY_CD
          ,TRX.WMS_INBD_TRX_PK
      FROM
           WMS_INBD_TRX TRX
     WHERE
           TRX.GLBL_CMPY_CD = #glblCmpyCd#
       AND TRX.WH_CD        = #whCd#
       AND TRX.WMS_SHIP_ID  = #wmsShipId#
       AND TRX.WMS_TASK_CD  = #wmsTaskCd#
       <isNotNull property="bolNum">
       AND TRX.BOL_NUM      = #bolNum#
       </isNotNull>
       <isNull property="bolNum">
       AND TRX.BOL_NUM      IS NULL
       </isNull>
       <isNotNull property="proNum">
       AND DECODE(TRX.PRO_NUM, NULL, TRX.TMS_TRK_NUM, TRX.PRO_NUM)  = #proNum#
       </isNotNull>
       <isNull property="proNum">
       AND DECODE(TRX.PRO_NUM, NULL, TRX.TMS_TRK_NUM, TRX.PRO_NUM) IS NULL
       </isNull>
       AND TRX.EZCANCELFLAG = '0'
       FOR UPDATE
    </statement>
    <resultMap id="result.locFrtChrgBol" class="WMS_INBD_TRXTMsg">
        <result property="glblCmpyCd"      column="GLBL_CMPY_CD"       javaType="EZDTStringItem"/>
        <result property="wmsInbdTrxPk"    column="WMS_INBD_TRX_PK"    javaType="EZDTStringItem"/>
    </resultMap>

    <statement id="getPktSts" parameterClass="Map">
    SELECT
           TRX.GLBL_CMPY_CD
          ,TRX.WMS_INBD_TRX_PK
          ,TRX.WMS_REC_ID
          ,TRX.WH_CD
          ,TRX.WMS_TRX_DT_TM_TS
          ,TRX.WMS_TASK_CD
          ,TRX.OTBD_ORD_NUM
          ,TRX.OTBD_ORD_TP_CD
          ,ORS.PKT_STS_CD
          ,ORS.PKT_STS_TXT
          ,TRX.WMS_ORD_STS_CD
          ,TRX.EST_DOCK_DT_TM_TS
          ,TRX.WMS_CARR_CD
          ,TRX.OTBD_ORD_LINE_NUM
          ,TRX.WMS_ORD_QTY
          ,ORS.DS_SO_LINE_STS_CD
          ,TRX.WMS_MDSE_CD
          ,TRX.SER_NUM
          ,TRX.WMS_LOC_ID
          ,TRX.WMS_CNTNR_ID
          <!-- START 2022/11/11 F.Fadriquela [QC#60772,ADD] -->
          ,TRX.WMS_STK_STS_CD
          ,MD.SHPG_SER_TAKE_FLG
          ,MD.INSTL_BASE_CTRL_FLG
          <!-- END 2022/11/11 F.Fadriquela [QC#60772,ADD] -->
      FROM
           WMS_INBD_TRX TRX
          ,WMS_ORD_STS  ORS
          <!-- START 2022/11/11 F.Fadriquela [QC#60772,ADD] -->
          ,MDSE MD
          <!-- END 2022/11/11 F.Fadriquela [QC#60772,ADD] -->
     WHERE
           TRX.GLBL_CMPY_CD    = #glblCmpyCd#
       <isNotNull property="wmsTaskCdArray">
           <iterate property="wmsTaskCdArray" var="wmsTaskCd[]" open="AND TRX.WMS_TASK_CD IN (" close=")" conjunction=",">
               #wmsTaskCd[]#
           </iterate>
       </isNotNull>
       AND TRX.OTBD_ORD_NUM    IS NOT NULL
       <isNotNull property="wmsOrdStsCdArray">
           <iterate property="wmsOrdStsCdArray" var="wmsOrdStsCd[]" open="AND TRX.WMS_ORD_STS_CD IN (" close=")" conjunction=",">
               #wmsOrdStsCd[]#
           </iterate>
       </isNotNull>
<!-- 
       AND TRX.WMS_GRP_ID_03   IS NOT NULL
 -->
       <iterate property="wmsTrgtWhCd" var="elem[]" open="AND TRX.WH_CD IN (" close=")" conjunction=",">
           #elem[]#
       </iterate>
       AND TRX.PROC_STS_CD        = #procStsCd#
       AND TRX.EZCANCELFLAG       = '0'
       AND TRX.GLBL_CMPY_CD       = ORS.GLBL_CMPY_CD
       AND TRX.WMS_ORD_STS_CD     = ORS.WMS_ORD_STS_CD
       <!-- START 2022/11/11 F.Fadriquela [QC#60772,ADD] -->
       AND MD.GLBL_CMPY_CD        = TRX.GLBL_CMPY_CD
       AND MD.MDSE_CD             = TRX.WMS_MDSE_CD
       AND MD.EZCANCELFLAG        = '0'
       <!-- END 2022/11/11 F.Fadriquela [QC#60772,ADD] -->
       AND ORS.EZCANCELFLAG       = '0'
     ORDER BY
           TRX.WRK_TRX_ID
          ,TRX.OTBD_ORD_NUM
    </statement>

    <statement id="getAsn" parameterClass="Map">
    SELECT
           ASN.WMS_INBD_TRX_PK
          ,ASN.WMS_SHIP_ID         ASN_WMS_SHIP_ID
          ,ASN.BOL_NUM             ASN_BOL_NUM
          ,SHIP.WMS_INBD_TRX_PK    SHIP_WMS_INBD_TRX_PK
          ,SHIP.GLBL_CMPY_CD
          ,SHIP.OTBD_ORD_NUM
          ,SHIP.WH_CD
          ,SHIP.WMS_SHIP_ID        WMS_SO_SHIP_ID
          ,SHIP.WMS_TRX_DT_TM_TS   WMS_SHIP_DT_TM_TS
          ,SHIP.BOL_NUM
          ,SHIP.PRO_NUM
          ,SHIP.TMS_TRK_NUM
          ,SHIP.WMS_TOT_WT
          ,VIA.CARR_SCAC_CD
          ,SHIP.WMS_CARR_CD
          ,SHIP.WMS_ORG_HOST_ID
          ,SHIP.WMS_CNTNR_ID
          ,SHIP.WMS_OUT_CNTNR_NUM
          ,SHIP.WMS_MDSE_CD
          ,SHIP.WMS_STK_STS_CD
          ,SHIP.WMS_ORD_QTY
          ,NVL(DTL.WMS_SHIP_QTY,0) WMS_SHIP_QTY
          ,SUM(SHIP.WMS_TOT_WT)  OVER (PARTITION BY SHIP.WH_CD,SHIP.WMS_SHIP_ID,SHIP.BOL_NUM,HDR.CHRG_TO_CUST_CD) SUM_WMS_TOT_WT
          ,SUM(SHIP.WMS_ORD_QTY) OVER (PARTITION BY SHIP.GLBL_CMPY_CD,SHIP.WH_CD,SHIP.OTBD_ORD_NUM,SHIP.OTBD_ORD_LINE_NUM,HDR.CHRG_TO_CUST_CD) TOTAL_QTY
          ,SHIP.OTBD_ORD_LINE_NUM
          ,HDR.CHRG_TO_CUST_CD     CUST_ACCT_NUM
          ,DTL.ORIG_SO_ID
          ,DTL.ORIG_LINE_NUM
          ,DTL.WMS_MDSE_CD         WMS_SO_MDSE_CD
          ,DTL.WMS_SO_ID
          ,DTL.WMS_LINE_NUM
          ,DTL.ESS_MDSE_LINE_NUM   ROW_POSN_NUM
          ,DTL.ESS_LINE_NUM        ROW_SQ_NUM
          ,VIA.WMS_TRNSP_TP_CD
          ,VIA.WMS_CARR_NM
          ,ASN.EZINTIME
          ,DTL.RTL_WH_CD
          ,DTL.RTL_SWH_CD
      FROM
           WMS_INBD_TRX    ASN
          ,WMS_INBD_TRX    SHIP
          ,WMS_SHIP_VIA    VIA
          ,WMS_INBD_SO_DTL DTL
          ,(
              SELECT
                     HDR.GLBL_CMPY_CD
                    ,HDR.WMS_SO_ID
                    ,HDR.CHRG_TO_CUST_CD
                    ,MAX(HDR.WMS_SQ_NUM) WMS_SQ_NUM
                FROM WMS_INBD_SO_HDR HDR
               WHERE HDR.EZCANCELFLAG = '0'
               GROUP BY
                     HDR.GLBL_CMPY_CD
                    ,HDR.WMS_SO_ID
                    ,HDR.CHRG_TO_CUST_CD
           )               HDR
     WHERE
           ASN.GLBL_CMPY_CD       = #glblCmpyCd#
       <iterate property="wmsTrgtWhCd" var="elem[]" open="AND ASN.WH_CD IN (" close=")" conjunction=",">
       #elem[]#
       </iterate>
       AND ASN.WMS_TASK_CD        = #wmsTaskAsn#
       AND (
               ASN.WMS_CARR_CD    &lt;&gt; #wmsCarrCdExpt#
            OR ASN.WMS_CARR_CD    IS NULL
           )
       AND ASN.PROC_STS_CD        =  #procStsCd#
       AND ASN.EZCANCELFLAG       =  '0'
       AND ASN.GLBL_CMPY_CD       =  SHIP.GLBL_CMPY_CD(+)
       AND ASN.WH_CD              =  SHIP.WH_CD(+)
       AND ASN.WMS_SHIP_ID        =  SHIP.WMS_SHIP_ID(+)
       AND ASN.BOL_NUM            =  SHIP.BOL_NUM(+)
       AND SHIP.WMS_TASK_CD(+)    =  #wmsTaskShip#
       AND SHIP.PROC_STS_CD(+)    IN ( #procStsCd# , #procStsCdComp# )
       AND SHIP.EZCANCELFLAG(+)   =  '0'
       AND SHIP.GLBL_CMPY_CD      =  VIA.GLBL_CMPY_CD(+)
       AND SHIP.WMS_CARR_CD       =  VIA.WMS_CARR_CD(+)
       AND SHIP.WMS_ORG_HOST_ID   =  VIA.WMS_ORG_HOST_ID(+)
       AND VIA.EZCANCELFLAG(+)    =  '0'
       AND SHIP.GLBL_CMPY_CD      =  DTL.GLBL_CMPY_CD(+)
       AND SHIP.WH_CD             =  DTL.WH_CD(+)
       AND SHIP.OTBD_ORD_NUM      =  DTL.WMS_SO_ID(+)
       AND SHIP.OTBD_ORD_LINE_NUM =  DTL.WMS_LINE_NUM(+)
       AND DTL.EZCANCELFLAG(+)    =  '0'
       AND DTL.GLBL_CMPY_CD       =  HDR.GLBL_CMPY_CD(+)
       AND DTL.WMS_SO_ID          =  HDR.WMS_SO_ID(+)
       AND DTL.WMS_SQ_NUM         =  HDR.WMS_SQ_NUM(+)
       AND NOT (HDR.WMS_SQ_NUM IS NULL AND DTL.WMS_SQ_NUM IS NOT NULL)
     ORDER BY
           ASN.WMS_INBD_TRX_PK
          ,ASN.WMS_SHIP_ID
          ,ASN.BOL_NUM
          ,SHIP.OTBD_ORD_NUM
          ,SHIP.OTBD_ORD_LINE_NUM
    </statement>

    <statement id="getWmsInbdSoHdr" parameterClass="Map" resultMap="result.getWmsInbdSoHdr">
        SELECT
            SOH.GLBL_CMPY_CD
           ,SOH.WH_CD
           ,SOH.WMS_SQ_NUM
           ,SOH.SHIP_DT_TM_TS
           ,SOH.WMS_CANC_DT_TM_TS
        FROM
            WMS_INBD_SO_HDR SOH
        WHERE
            SOH.GLBL_CMPY_CD = #glblCmpyCd#
        AND SOH.WH_CD        = #whCd#
        AND SOH.WMS_SO_ID    = #wmsSoId#
        AND SOH.EZCANCELFLAG = '0'
        ORDER BY
            SOH.WMS_SQ_NUM DESC
        FOR UPDATE
    </statement>

    <resultMap id="result.getWmsInbdSoHdr" class="WMS_INBD_SO_HDRTMsg">
        <result property="glblCmpyCd"      column="GLBL_CMPY_CD"       javaType="EZDTStringItem"/>
        <result property="whCd"            column="WH_CD"              javaType="EZDTStringItem"/>
        <result property="wmsSqNum"        column="WMS_SQ_NUM"         javaType="EZDTBigDecimalItem"/>
        <result property="shipDtTmTs"      column="SHIP_DT_TM_TS"      javaType="EZDTStringItem"/>
        <result property="wmsCancDtTmTs"   column="WMS_CANC_DT_TM_TS"  javaType="EZDTStringItem"/>
    </resultMap>

    <statement id="getBaseComponentFlag" parameterClass="Map" resultClass = "String">
        SELECT 
            DCD.BASE_CMPT_FLG
        FROM
            SHPG_ORD_DTL SOD
           ,CPO_DTL      DCD
        WHERE
            SOD.GLBL_CMPY_CD            = #glblCmpyCd#
        AND SOD.SO_NUM                  = #soNum#
        AND SOD.SO_SLP_NUM              = #soSlpNum#
        AND SOD.EZCANCELFLAG            = '0'
        AND DCD.GLBL_CMPY_CD            = SOD.GLBL_CMPY_CD
        AND DCD.CPO_ORD_NUM             = SOD.TRX_HDR_NUM
        AND DCD.CPO_DTL_LINE_NUM        = SOD.TRX_LINE_NUM
        AND DCD.CPO_DTL_LINE_SUB_NUM    = SOD.TRX_LINE_SUB_NUM
        AND DCD.EZCANCELFLAG            = '0'
        AND ROWNUM                      = 1
    </statement>

    <statement id="getTechMstr" parameterClass="Map" resultClass="Map">
        SELECT
            TM.TECH_TOC_CD
        FROM
            TECH_MSTR TM
            , S21_PSN SP
        WHERE
            TM.GLBL_CMPY_CD                     = #glblCmpyCd#
        AND TM.TECH_TOC_CD                      = #techTocCd#
        AND TM.GLBL_CMPY_CD                     = SP.GLBL_CMPY_CD
        AND TM.TECH_TOC_CD                      = SP.PSN_CD
        AND SP.EFF_FROM_DT                  &lt;= #salesDate#
        AND NVL(SP.EFF_THRU_DT, '99991231') &gt;= #salesDate#
        ORDER BY
            TM.TECH_TOC_CD
    </statement>

    <statement id="getShpgOrdConfWrkForUpd" parameterClass="Map" resultMap="result.SHPG_ORD_CONF_WRKTMsg">
        SELECT
            SOCW.GLBL_CMPY_CD
           ,SOCW.WRK_TRX_ID
           ,SOCW.SQ_ID
        FROM
            SHPG_ORD_CONF_WRK SOCW
        WHERE
            SOCW.GLBL_CMPY_CD = #glblCmpyCd#
        AND SOCW.WRK_TRX_ID   = #wrkTrxId#
        AND SOCW.SO_NUM       = #soNum#
        AND SOCW.PROC_STS_CD  = #procStsCd#
        AND SOCW.EZCANCELFLAG = '0'
    </statement>

    <resultMap id="result.SHPG_ORD_CONF_WRKTMsg" class="SHPG_ORD_CONF_WRKTMsg">
        <result property="glblCmpyCd"    column="GLBL_CMPY_CD"    javaType="EZDTStringItem"/>
        <result property="wrkTrxId"      column="WRK_TRX_ID"      javaType="EZDTStringItem"/>
        <result property="sqId"          column="SQ_ID"           javaType="EZDTStringItem"/>
    </resultMap>

    <statement id="getShpgOrdDtlSts" parameterClass="Map" resultClass="Map">
        SELECT
            SSD.SO_PRINT_FLG
           ,SSD.SHIP_FLG
           ,WW.WH_CD  AS WMS_WH_CD
        FROM
            SHPG_ORD_DTL DTL
           ,SHPG_STS     SSD
           ,SHPG_ORD     SO
           ,SHPG_STS     SSH
           ,RTL_WH       RW
           ,WMS_WH       WW
        WHERE
            DTL.GLBL_CMPY_CD = #glblCmpyCd#
        AND DTL.SO_NUM       = #soNum#
        AND DTL.EZCANCELFLAG = '0'
        AND DTL.GLBL_CMPY_CD = SSD.GLBL_CMPY_CD
        AND DTL.SHPG_STS_CD  = SSD.SHPG_STS_CD
        AND SSD.EZCANCELFLAG = '0'
        AND DTL.GLBL_CMPY_CD = SO.GLBL_CMPY_CD
        AND DTL.SO_NUM       = SO.SO_NUM
        AND SO.EZCANCELFLAG  = '0'
        AND SO.GLBL_CMPY_CD  = SSH.GLBL_CMPY_CD
        AND SO.SHPG_STS_CD   = SSH.SHPG_STS_CD
        AND SSH.EZCANCELFLAG = '0'
        AND (
                (SSH.SO_PRINT_FLG = #flgY# AND SSH.SHIP_FLG = #flgY#)
             OR (SSH.SO_PRINT_FLG = #flgN# AND SSH.SHIP_FLG = #flgN#)
            )
        AND SO.GLBL_CMPY_CD  = RW.GLBL_CMPY_CD
        AND SO.WH_CD         = RW.RTL_WH_CD
        AND RW.EZCANCELFLAG  = '0'
        AND RW.GLBL_CMPY_CD  = WW.GLBL_CMPY_CD
        AND RW.WMS_WH_CD     = WW.WH_CD
        AND WW.EZCANCELFLAG  = '0'
        AND EXISTS (SELECT
                        1
                    FROM
                        WMS_INBD_SO_HDR WISH
                    WHERE
                        WISH.GLBL_CMPY_CD = SO.GLBL_CMPY_CD
                    AND WISH.WH_CD        = WW.WH_CD
                    AND WISH.WMS_SO_ID    = SO.SO_NUM
                    AND WISH.EZCANCELFLAG = '0'
                    AND WISH.SHIP_DT_TM_TS     IS NULL
                    AND WISH.WMS_CANC_DT_TM_TS IS NULL
                   )
        UNION
        SELECT
            SSD.SO_PRINT_FLG
           ,SSD.SHIP_FLG
           ,RW.RTL_WH_CD AS WMS_WH_CD
        FROM
            SHPG_ORD_DTL DTL
           ,SHPG_STS     SSD
           ,SHPG_ORD     SO
           ,SHPG_STS     SSH
           ,RTL_WH       RW
        WHERE
            DTL.GLBL_CMPY_CD = #glblCmpyCd#
        AND DTL.SO_NUM       = #soNum#
        AND DTL.EZCANCELFLAG = '0'
        AND DTL.GLBL_CMPY_CD = SSD.GLBL_CMPY_CD
        AND DTL.SHPG_STS_CD  = SSD.SHPG_STS_CD
        AND SSD.EZCANCELFLAG = '0'
        AND DTL.GLBL_CMPY_CD = SO.GLBL_CMPY_CD
        AND DTL.SO_NUM       = SO.SO_NUM
        AND SO.EZCANCELFLAG  = '0'
        AND SO.GLBL_CMPY_CD  = SSH.GLBL_CMPY_CD
        AND SO.SHPG_STS_CD   = SSH.SHPG_STS_CD
        AND SSH.EZCANCELFLAG = '0'
        AND (
                (SSH.SO_PRINT_FLG = #flgY# AND SSH.SHIP_FLG = #flgY#)
             OR (SSH.SO_PRINT_FLG = #flgN# AND SSH.SHIP_FLG = #flgN#)
            )
        AND SO.GLBL_CMPY_CD  = RW.GLBL_CMPY_CD
        AND SO.WH_CD         = RW.RTL_WH_CD
        AND RW.EZCANCELFLAG  = '0'
        AND EXISTS (
            SELECT
                1
            FROM
                TPL_LOC TL
            WHERE
                TL.GLBL_CMPY_CD = RW.GLBL_CMPY_CD
            AND TL.TPL_LOC_CD   = RW.RTL_WH_CD
            AND TL.WH_OWNR_CD   = RW.WH_OWNR_CD
            AND TL.EZCANCELFLAG = '0'
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                    WMS_WH WW
                WHERE
                    WW.GLBL_CMPY_CD = RW.GLBL_CMPY_CD
                AND WW.WH_CD        = RW.WMS_WH_CD
                AND WW.EZCANCELFLAG = '0'
            )
        )
        AND EXISTS (SELECT
                        1
                    FROM
                        WMS_INBD_SO_HDR WISH
                    WHERE
                        WISH.GLBL_CMPY_CD = SO.GLBL_CMPY_CD
                    AND WISH.WH_CD        = RW.RTL_WH_CD
                    AND WISH.WMS_SO_ID    = SO.SO_NUM
                    AND WISH.EZCANCELFLAG = '0'
                    AND WISH.SHIP_DT_TM_TS     IS NULL
                    AND WISH.WMS_CANC_DT_TM_TS IS NULL
                   )
    </statement>

    <statement id="getShpgOrdConfDtlWrkForUpd" parameterClass="Map" resultMap="result.SHPG_ORD_CONF_DTL_WRKTMsg">
        SELECT
            SOCDW.GLBL_CMPY_CD
           ,SOCDW.WRK_TRX_ID
           ,SOCDW.SQ_ID
        FROM
            SHPG_ORD_CONF_DTL_WRK SOCDW
        WHERE
            SOCDW.GLBL_CMPY_CD = #glblCmpyCd#
        AND SOCDW.WRK_TRX_ID   = #wrkTrxId#
        AND SOCDW.SO_NUM       = #soNum#
        AND SOCDW.PROC_STS_CD  = #procStsCd#
        AND SOCDW.EZCANCELFLAG = '0'
    </statement>

    <resultMap id="result.SHPG_ORD_CONF_DTL_WRKTMsg" class="SHPG_ORD_CONF_DTL_WRKTMsg">
        <result property="glblCmpyCd"    column="GLBL_CMPY_CD"    javaType="EZDTStringItem"/>
        <result property="wrkTrxId"      column="WRK_TRX_ID"      javaType="EZDTStringItem"/>
        <result property="sqId"          column="SQ_ID"           javaType="EZDTStringItem"/>
    </resultMap>

    <statement id="getShipSerNumWrkForUpd" parameterClass="Map" resultMap="result.SHIP_SER_NUM_WRKTMsg">
        SELECT
            SSNW.GLBL_CMPY_CD
           ,SSNW.WRK_TRX_ID
           ,SSNW.SQ_ID
        FROM
            SHIP_SER_NUM_WRK SSNW
        WHERE
            SSNW.GLBL_CMPY_CD = #glblCmpyCd#
        AND SSNW.WRK_TRX_ID   = #wrkTrxId#
        AND SSNW.SO_NUM       = #soNum#
        AND SSNW.PROC_STS_CD  = #procStsCd#
        AND SSNW.EZCANCELFLAG = '0'
    </statement>

    <resultMap id="result.SHIP_SER_NUM_WRKTMsg" class="SHIP_SER_NUM_WRKTMsg">
        <result property="glblCmpyCd"    column="GLBL_CMPY_CD"    javaType="EZDTStringItem"/>
        <result property="wrkTrxId"      column="WRK_TRX_ID"      javaType="EZDTStringItem"/>
        <result property="sqId"          column="SQ_ID"           javaType="EZDTStringItem"/>
    </resultMap>

    <statement id="getWmsTrxDtTmTs" parameterClass="Map" resultClass = "String">
        SELECT
            DAT.WMS_TRX_DT_TM_TS
        FROM
           (
            SELECT
                TRX.WMS_TRX_DT_TM_TS
            FROM
                WMS_INBD_TRX TRX
            WHERE
                TRX.GLBL_CMPY_CD   = #glblCmpyCd#
            AND TRX.WH_CD          = #whCd#
            AND TRX.OTBD_ORD_NUM   = #wmsSoId#
            <isEqual property="isShipped" compareValue="Y">
            AND TRX.WMS_TASK_CD    = #wmsTaskOshp#
            </isEqual>
            <isEqual property="isShipped" compareValue="N">
            AND TRX.WMS_TASK_CD    = #wmsTaskOsc#
            AND TRX.WMS_ORD_STS_CD = #wmsOrdStsCan#
            </isEqual>
            ORDER BY
                WMS_INBD_TRX_PK DESC
           ) DAT
        WHERE
            ROWNUM = 1
    </statement>
    
    <!-- QC#29979 Update. Update Date:01/25/2019 -->
    <statement id="getTplCarrSvc" parameterClass="Map" resultClass="Map">
        SELECT 
             TCSL.CARR_CD          AS CARR_CD
             ,TCSL.SHPG_SVC_LVL_CD AS SHPG_SVC_LVL_CD
        FROM (
            SELECT
                TCSL.CARR_CD
                ,TCSL.SHPG_SVC_LVL_CD
            FROM 
                TPL_CARR_SVC_LVL TCSL
<!-- START 2019/02/06 T.Ogura [QC#30182,DEL] -->
<!--            ,RTL_WH RW -->
<!-- END   2019/02/06 T.Ogura [QC#30182,DEL] -->
            WHERE
                TCSL.GLBL_CMPY_CD        = #glblCmpyCd# 
<!-- START 2019/02/06 T.Ogura [QC#30182,DEL] -->
<!--    <isNotNull property="wmsCarrCd"> -->
<!-- END   2019/02/06 T.Ogura [QC#30182,DEL] -->
            <isEqual property="whGpCd" compareValue="2">
            AND TCSL.TPL_CARR_CD          = #wmsCarrCd#
            </isEqual>
            <isEqual property="whGpCd" compareValue="3">
            AND TCSL.TPL_CARR_SVC_LVL_CD  = #wmsCarrCd#
            </isEqual>
<!-- START 2019/02/06 T.Ogura [QC#30182,DEL] -->
<!--    </isNotNull> -->
<!-- END   2019/02/06 T.Ogura [QC#30182,DEL] -->
            AND TCSL.EZCANCELFLAG        = '0'
<!-- START 2019/02/06 T.Ogura [QC#30182,DEL] -->
<!--        AND TCSL.GLBL_CMPY_CD        = RW.GLBL_CMPY_CD -->
<!--        AND TCSL.WH_OWNR_CD          = RW.WH_OWNR_CD -->
<!--        AND RW.WMS_WH_CD             = #wmsWhCd# -->
<!--        AND RW.EZCANCELFLAG          = '0' -->
<!-- END   2019/02/06 T.Ogura [QC#30182,DEL] -->
            ORDER BY 
                TCSL.TPL_CARR_SVC_LVL_SORT_NUM ASC
        ) TCSL
        WHERE ROWNUM            = 1
    </statement>

    <statement id="getProNumList" parameterClass="Map" resultClass="Map">
    SELECT
         WIT.WMS_CARR_CD
        <!-- 2019/11/28 [QC#54812 MOD] START -->
        <!-- ,WIT.TMS_TRK_NUM -->
        ,NVL(WIT.TMS_TRK_NUM, WIT.PRO_NUM) AS TMS_TRK_NUM
        <!-- 2019/11/28 [QC#54812 MOD] END -->
        ,WIT.WH_CD
        ,WIT.OTBD_ORD_NUM
        ,WIT.OTBD_ORD_LINE_NUM
        ,WIT.WMS_TOT_WT
        ,WIT.WMS_CNTNR_ID
        ,WIT.TMS_FRT_CHRG_AMT
        ,WIT.OTBD_ORD_TP_CD
        ,WIT.WMS_TAG_ID
        ,SO.SHPG_STS_CD
        ,SO.SCE_ORD_TP_CD
        ,WIT.WMS_INBD_TRX_PK
        ,WIT.WMS_CARR_CD
        ,WIT.WMS_FRT_CHRG_AMT
    FROM 
         WMS_INBD_TRX WIT
        ,SHPG_ORD SO
    WHERE 1=1
    AND WIT.GLBL_CMPY_CD        = #glblCmpyCd# 
    AND WIT.EZCANCELFLAG        = '0'
    AND WIT.WMS_TASK_CD         = #wmsTaskCd#
    AND WIT.WMS_SHIP_ID         = #wmsShipId#
    AND WIT.INTFC_TRX_ID        = #intfcTrxId#
    AND WIT.GLBL_CMPY_CD        = SO.GLBL_CMPY_CD(+)
    AND WIT.OTBD_ORD_NUM        = SO.SO_NUM(+)
    ORDER BY WIT.TMS_TRK_NUM, WIT.OTBD_ORD_LINE_NUM, WIT.WMS_INBD_TRX_PK
    </statement>

    <statement id="getSvcMachMstrPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             A.SVC_MACH_MSTR_PK         AS SVC_MACH_MSTR_PK
        FROM
             SVC_MACH_MSTR A
        WHERE
            A.GLBL_CMPY_CD       = #glblCmpyCd#
        AND A.EZCANCELFLAG       = '0'
        AND A.SVC_CONFIG_MSTR_PK = #svcConfigMstrPk#
        AND A.MDSE_CD            = #mdseCd#
        <isNotNull property="serNum">
        AND A.SER_NUM            = #serNum#
        </isNotNull>
    </statement>

    <statement id="cntSvcMachMstrPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             COUNT(A.SVC_MACH_MSTR_PK) AS CNT
        FROM
             SVC_MACH_MSTR A
        WHERE
            A.GLBL_CMPY_CD       = #glblCmpyCd#
        AND A.EZCANCELFLAG       = '0'
        AND A.MDSE_CD            = #mdseCd#
        AND A.SER_NUM            = #serNum#
        AND A.STK_STS_CD         = #stkStsCd#
        AND A.EZCANCELFLAG       = '0'
    </statement>

    <!-- START 2021/08/27 R.Azucena [QC#59036, ADD] -->
    <statement id="getSvcMachMstrCurLocNum" parameterClass="Map" resultClass="String">
        SELECT
             A.CUR_LOC_NUM
        FROM
             SVC_MACH_MSTR A
        WHERE
            A.GLBL_CMPY_CD       = #glblCmpyCd#
        AND A.MDSE_CD            = #mdseCd#
        AND A.SER_NUM            = #serNum#
        AND A.STK_STS_CD         = #stkStsCd#
        AND A.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getWmsInbdTrxOtbdOrdLineNum" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             A.OTBD_ORD_LINE_NUM
        FROM
             WMS_INBD_TRX A
        WHERE
            A.GLBL_CMPY_CD       = #glblCmpyCd#
        AND A.WMS_INBD_TRX_PK    = #wmsInbdTrxPk#
        AND A.EZCANCELFLAG       = '0'
    </statement>
    <!-- END 2021/08/27 R.Azucena [QC#59036, ADD] -->

    <statement id="getCtryCd" parameterClass="Map" resultClass="String">
        SELECT
             CTRY_CD
        FROM
             SHPG_ORD_CUST_DTL A
        WHERE
            A.GLBL_CMPY_CD       = #glblCmpyCd#
        AND A.EZCANCELFLAG       = '0'
        AND A.SO_NUM             = #soNum#
        AND A.SO_CUST_DATA_TP_CD = #soCustDataTpCd#
    </statement>

    <!-- START 2022/04/04 R.Azucena [QC#59802, ADD] -->
    <!-- START 2022/08/08 R.Azucena [QC#60416, DEL] -->
    <!-- 
    <statement id="getAvailSingleQty" parameterClass="Map" resultClass="BigDecimal">
         SELECT
                COUNT(*)
         FROM
                SVC_MACH_MSTR SMM
         WHERE
                SMM.GLBL_CMPY_CD            = #glblCmpyCd#
            AND SMM.MDSE_CD                 = #mdseCd#
            AND SMM.STK_STS_CD              = #stkStsCd#
            AND SMM.CUR_LOC_NUM             = #curLocNum#
            AND SMM.SVC_MACH_MAINT_AVAL_FLG = #svcMachMaintAvalFlg#
            <isNotNull property="pickSvcConfigMstrPk">
            AND SMM.SVC_CONFIG_MSTR_PK      = #pickSvcConfigMstrPk#
            </isNotNull>
            <isNull property="pickSvcConfigMstrPk">
            AND SMM.SVC_CONFIG_MSTR_PK IS NULL
            </isNull>
            <iterate property="svcMachMstrStsCdList" var="svcMachMstrStsCd[]" open="AND SMM.SVC_MACH_MSTR_STS_CD IN (" conjunction= "," close=")">
                #svcMachMstrStsCd[]#
            </iterate>
            AND SMM.EZCANCELFLAG            = '0'
    </statement>
    -->
    <!-- END 2022/08/08 R.Azucena [QC#60416, DEL] -->
    <!-- END 2022/04/04 R.Azucena [QC#59802, ADD] -->

    <!-- START 2022/11/11 F.Fadriquela [QC#60772, ADD] -->
    <statement id="getSvcMachMstrItemCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            SVC_MACH_MSTR SMM
        WHERE
            SMM.GLBL_CMPY_CD                = #glblCmpyCd#
        AND SMM.MDSE_CD                     = #mdseCd#
        <isNotNull property="serNum">
            AND SMM.SER_NUM                 = #serNum#
        </isNotNull>
        <isNull property="serNum">
            AND SMM.SER_NUM IS NULL
            AND SMM.SVC_MACH_MAINT_AVAL_FLG = #svcMachMaintAvalFlg#
            AND SMM.TRX_HDR_NUM IS NULL
        </isNull>
        <isNotNull property="svcConfigMstrPk">
            AND SMM.SVC_CONFIG_MSTR_PK      = #svcConfigMstrPk#
        </isNotNull>
        AND SMM.CUR_LOC_NUM                 = #invtyLocCd#
        AND SMM.STK_STS_CD                  = #stkStsCd#
        <iterate property="svcMachMstrStsCdList" var="svcMachMstrStsCd[]" open="AND SMM.SVC_MACH_MSTR_STS_CD IN (" conjunction= "," close=")">
            #svcMachMstrStsCd[]#
        </iterate>
        AND SMM.EZCANCELFLAG                = '0'
    </statement>
    <!-- END 2022/11/11 F.Fadriquela [QC#60772, ADD] -->

</sqlMap>
