<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NLBB033001">

    <statement id="getSoConfirmation" parameterClass="Map"  resultClass="Map">
        SELECT
            SOC.SO_NUM
            ,SOC.WH_CD
            ,SOC.SCE_ORD_TP_CD
            ,SOC.SO_PROC_STS_CD
            ,SOC.SO_DATA_ACT_TP_CD
            ,SOC.SHIP_DT_TM_TS
            ,SOC.TOT_SHIP_WT
            ,SOC.TOT_FRT_AMT
            ,SO.TRX_HDR_NUM
            ,STC.POST_CD                 AS        POST_CD_STC
            ,DAC.COA_CH_CD
            ,RW.LOC_TP_CD
            ,RW.POST_CD                  AS        POST_CD_RW
            ,RW.COA_BR_CD                AS        COA_BR_CD_RW
            ,T.COA_BR_CD                 AS        COA_BR_CD_TOC
            ,DCC.DS_COND_CONST_VAL_TXT_01
            ,OC.CARR_CD
        FROM
            SCE_ORD_TP         SOT
            ,SHPG_ORD_CONF     SOC
            ,SHPG_ORD          SO
            ,SHIP_TO_CUST      STC
            ,SELL_TO_CUST      DAC
            ,RTL_WH            RW
            ,CPO               DC
            ,TOC               T
            ,DS_COND_CONST     DCC
            ,SHPG_ORD_CONF_DTL SOCD
            ,OTBD_CARR_V       OC
        WHERE
            SOT.GLBL_CMPY_CD                =    #glblCmpyCd#
            AND SOT.INBD_OTBD_CD            =    #inbdOtbdCd#
            AND SOT.NTC_DROP_FLG            =    #ntcDropFlg#
            -- SHPG_ORD_CONF JOIN
            AND SOT.GLBL_CMPY_CD            =    SOC.GLBL_CMPY_CD
            AND SOT.SCE_ORD_TP_CD           =    SOC.SCE_ORD_TP_CD
            AND SOC.SHIP_DT_TM_TS          &gt;  #dsBizLastUpdTs#
            <!-- STR 04/28/2016 R.Shimamoto [QC#7662 DEL] -->
            <!-- AND SOC.SHIP_DT_TM_TS          &lt;= #thisProcTs# -->
            <!-- END 04/28/2016 R.Shimamoto [QC#7662 DEL] -->
            -- SHPG_ORD JOIN
            AND SOC.GLBL_CMPY_CD            =    SO.GLBL_CMPY_CD
            AND SOC.SO_NUM                  =    SO.SO_NUM
            AND SO.SHPG_STS_CD              =    #shpgStsCd#
            -- SHIP_TO_CUST JOIN
            AND SO.GLBL_CMPY_CD             =    STC.GLBL_CMPY_CD
            AND SO.SHIP_TO_CUST_CD          =    STC.SHIP_TO_CUST_CD
            -- SELL_TO_CUST JOIN
            AND STC.GLBL_CMPY_CD            =    DAC.GLBL_CMPY_CD(+)
            AND STC.SELL_TO_CUST_CD         =    DAC.SELL_TO_CUST_CD(+)
            -- RTL_WH JOIN
            AND SOC.GLBL_CMPY_CD            =    RW.GLBL_CMPY_CD
            AND SOC.WH_CD                   =    RW.RTL_WH_CD
            -- CPO JOIN
            AND SO.GLBL_CMPY_CD             =    DC.GLBL_CMPY_CD(+)
            AND SO.TRX_HDR_NUM              =    DC.CPO_ORD_NUM(+)
            -- TOC JOIN
            AND DC.GLBL_CMPY_CD             =    T.GLBL_CMPY_CD(+)
            AND DC.SLS_REP_TOC_CD           =    T.TOC_CD(+)
            -- DS_COND_CONST JOIN
            AND DC.GLBL_CMPY_CD             =    DCC.GLBL_CMPY_CD(+)
            AND DC.DS_ORD_CATG_CD           =    DCC.DS_COND_CONST_CD(+)
            AND DCC.DS_COND_CONST_GRP_ID(+) =    #batchId#
            -- SHPG_ORD_CONF_DTL JOIN
            AND SOC.GLBL_CMPY_CD            =    SOCD.GLBL_CMPY_CD
            AND SOC.SO_NUM                  =    SOCD.SO_NUM
            AND SOCD.SO_SLP_NUM             =    #soSlpNum001#
            -- OTBD_CARR_V JOIN
            AND SOCD.GLBL_CMPY_CD           =    OC.GLBL_CMPY_CD(+)
            AND SOCD.VND_CD                 =    OC.CARR_CD(+)
            AND SOT.EZCANCELFLAG            =    '0'
            AND SOC.EZCANCELFLAG            =    '0'
            AND SO.EZCANCELFLAG             =    '0'
            AND STC.EZCANCELFLAG            =    '0'
            AND DAC.EZCANCELFLAG(+)         =    '0'
            AND RW.EZCANCELFLAG             =    '0'
            AND DC.EZCANCELFLAG(+)          =    '0'
            AND T.EZCANCELFLAG(+)           =    '0'
            AND DCC.EZCANCELFLAG(+)         =    '0'
            AND SOCD.EZCANCELFLAG           =    '0'
            AND OC.EZCANCELFLAG(+)          =    '0'
        ORDER BY
            SOC.SCE_ORD_TP_CD NULLS FIRST
            ,SOC.WH_CD NULLS FIRST
            ,SOC.SHIP_DT_TM_TS NULLS FIRST
    </statement>
    <statement id="selectCarrierFreightSourceType" parameterClass="Map"  resultClass="Map">
        SELECT
            CFSTX.CARR_FRT_SRC_TP_XREF_NUM
            ,CFSTX.SCE_ORD_TP_CD
            ,CFSTX.INBD_OTBD_CD
            ,CFSTX.FROM_LOC_TP_CD
            ,CFSTX.DROP_SHIP_WH_CD
            ,CFSTX.CARR_FRT_SRC_TP_NM
            ,CFSTX.CARR_FRT_SRC_TP_DESC_TXT
            ,CFSTX.CARR_FRT_PRFL_NUM
            ,CFSTX.TRX_HDR_NUM_TP_CD
            ,CFSTX.TRX_REF_NUM_TP_CD_01
            ,CFSTX.TRX_REF_NUM_TP_CD_02
            ,CFSTX.DEF_COA_CMPY_CD
            ,CFSTX.DEF_COA_BR_CD
            ,CFSTX.DEF_COA_CC_CD
            ,CFSTX.DEF_COA_ACCT_CD
            ,CFSTX.DEF_COA_PROD_CD
            ,CFSTX.DEF_COA_CH_CD
            ,CFSTX.DEF_COA_AFFL_CD
            ,CFSTX.DEF_COA_MDSE_TP_CD
            ,CFSTX.CARR_FRT_CHRG_BU_CD
            ,CFSTX.DEF_CARR_CD
        FROM
            CARR_FRT_SRC_TP_XREF CFSTX
        WHERE
            CFSTX.GLBL_CMPY_CD           = #glblCmpyCd#
            AND CFSTX.SCE_ORD_TP_CD      = #sceOrdTpCd#
            AND CFSTX.INBD_OTBD_CD       = #inbdOtbdCd#
            AND CFSTX.EZCANCELFLAG       = '0'
        ORDER BY
            CFSTX.SCE_ORD_TP_CD NULLS FIRST
            ,CFSTX.INBD_OTBD_CD NULLS FIRST
    </statement>
    <statement id="selectCrossReference" parameterClass="Map"  resultClass="Map">
        SELECT
            CFSTX.CARR_FRT_SRC_TP_XREF_NUM
            ,CFSTX.SCE_ORD_TP_CD
            ,CFSTX.INBD_OTBD_CD
            ,CFSTX.FROM_LOC_TP_CD
            ,CFSTX.DROP_SHIP_WH_CD
            ,CFSTX.CARR_FRT_SRC_TP_NM
            ,CFSTX.CARR_FRT_SRC_TP_DESC_TXT
            ,CFSTX.CARR_FRT_PRFL_NUM
            ,CFSTX.TRX_HDR_NUM_TP_CD
            ,CFSTX.TRX_REF_NUM_TP_CD_01
            ,CFSTX.TRX_REF_NUM_TP_CD_02
            ,CFSTX.DEF_COA_CMPY_CD
            ,CFSTX.DEF_COA_BR_CD
            ,CFSTX.DEF_COA_CC_CD
            ,CFSTX.DEF_COA_ACCT_CD
            ,CFSTX.DEF_COA_PROD_CD
            ,CFSTX.DEF_COA_CH_CD
            ,CFSTX.DEF_COA_AFFL_CD
            ,CFSTX.DEF_COA_MDSE_TP_CD
            ,CFSTX.CARR_FRT_CHRG_BU_CD
            ,CFSTX.DEF_CARR_CD
        FROM
            CARR_FRT_SRC_TP_XREF CFSTX
        WHERE
            CFSTX.GLBL_CMPY_CD           = #glblCmpyCd#
            AND CFSTX.SCE_ORD_TP_CD      = #sceOrdTpCd#
            AND CFSTX.INBD_OTBD_CD       = #inbdOtbdCd#
            <isNotNull property="fromLocTpCd">
            AND CFSTX.FROM_LOC_TP_CD     = #fromLocTpCd#
            </isNotNull>
            <isNull property="fromLocTpCd">
            AND CFSTX.FROM_LOC_TP_CD     IS NULL
            </isNull>
            <isNotNull property="dropShipWhCd">
            AND CFSTX.DROP_SHIP_WH_CD    = #dropShipWhCd#
            </isNotNull>
            <isNull property="dropShipWhCd">
            AND CFSTX.DROP_SHIP_WH_CD    IS NULL
            </isNull>
            AND CFSTX.EZCANCELFLAG       = '0'
        ORDER BY
            CFSTX.SCE_ORD_TP_CD NULLS FIRST
            ,CFSTX.INBD_OTBD_CD NULLS FIRST
    </statement>
    <statement id="getPoNum" parameterClass="Map"  resultClass="Map">
    <!-- 04/18/2016    CITS     R.Shimamoto    Update     QC#6978 -->
        SELECT
            PLN.PO_ORD_NUM
        FROM
            (SELECT
                SP.PO_ORD_NUM
            FROM
                SHPG_ORD_DTL SOD
                ,SHPG_PLN SP
            WHERE
                SOD.GLBL_CMPY_CD     = #glblCmpyCd#
                AND SOD.SO_NUM       = #soNum#
                AND SOD.GLBL_CMPY_CD = SP.GLBL_CMPY_CD
                AND SOD.SHPG_PLN_NUM = SP.SHPG_PLN_NUM
                AND SOD.EZCANCELFLAG = '0'
                AND SP.EZCANCELFLAG  = '0'
            ORDER BY
                SOD.SO_SLP_NUM ASC
            ) PLN
        WHERE
            ROWNUM = #rowNum#
    </statement>
    <statement id="getPrchReqNumForSoConf" parameterClass="Map"  resultClass="Map">
        SELECT
            DSOD.PRCH_REQ_NUM
        FROM
            SHPG_ORD_DTL DSOD
        WHERE
            ROWNUM                    = #rowNum#
            AND DSOD.GLBL_CMPY_CD     = #glblCmpyCd#
            AND DSOD.SO_NUM           = #soNum#
            AND DSOD.PRCH_REQ_NUM     IS NOT NULL
            AND DSOD.EZCANCELFLAG     = '0'
    </statement>
    <statement id="getPrchReqNumForRwsHeader" parameterClass="Map"  resultClass="Map">
        SELECT
            DRD.PRCH_REQ_NUM
        FROM
            RWS_DTL DRD
        WHERE
            ROWNUM                    = #rowNum#
            AND DRD.GLBL_CMPY_CD      = #glblCmpyCd#
            AND DRD.RWS_NUM           = #rwsNum#
            AND DRD.PRCH_REQ_NUM      IS NOT NULL
            AND DRD.EZCANCELFLAG      = '0'
    </statement>
    <statement id="getVendorPostalCode" parameterClass="Map"  resultClass="Map">
        SELECT
            V.POST_CD
        FROM
            PO P
            ,VND V
        WHERE
            P.GLBL_CMPY_CD         = #glblCmpyCd#
            AND P.PO_ORD_NUM       = #poOrdNum#
            AND P.GLBL_CMPY_CD     = V.GLBL_CMPY_CD
            AND P.VND_CD           = V.VND_CD
            AND P.EZCANCELFLAG     = '0'
            AND V.EZCANCELFLAG     = '0'
    </statement>
    <statement id="getCarrierCode" parameterClass="Map"  resultClass="Map">
        SELECT
            RSD.CARR_CD
        FROM
            RWS_DTL RSD
        WHERE
            ROWNUM                    = #rowNum#
            AND RSD.GLBL_CMPY_CD      = #glblCmpyCd#
            AND RSD.RWS_NUM           = #rwsNum#
            AND RSD.EZCANCELFLAG      = '0'
    </statement>
    <statement id="getRwsHeader" parameterClass="Map"  resultClass="Map">
        SELECT
            RH.RWS_NUM                 AS    RWS_NUM_RH
            ,RH.IMPT_INV_PK
            ,RH.IMPT_INV_NUM
            ,RH.IMPT_INV_CLS_CD
            ,RH.IMPT_INV_VER_NUM
            ,RH.IMPT_INV_SLP_CLS_CD
            ,RH.IMPT_CNTNR_LOT_NUM
            ,RH.IMPT_CNTNR_NUM
            ,RH.INBD_SRC_TP_CD
            ,RH.RWS_STS_CD
            ,RH.RWS_PRT_FLG
            ,RH.IMPT_INV_VESL_NM
            ,RH.IMPT_INV_BOL_NUM
            ,RH.WH_CD
            ,RH.WH_IN_ETA_DT
            ,RH.LTST_WH_IN_ETA_DT
            ,RH.FROM_LOC_NM_01
            ,RH.FROM_LOC_NM_02
            ,RH.FROM_LOC_CTY_ADDR
            ,RH.FROM_LOC_ST_CD
            ,RH.FROM_LOC_CTRY_CD
            ,RH.FROM_LOC_PSN_NM
            ,RH.FROM_LOC_TEL_NUM
            ,RH.FROM_LOC_ADDR_01
            ,RH.FROM_LOC_ADDR_02
            ,RH.FROM_LOC_ADDR_03
            ,RH.FROM_LOC_ADDR_04
            ,RH.FROM_LOC_TP_CD
            ,RH.FROM_LOC_CD
            ,RH.DNLD_DT_TM_TS
            ,RH.TRX_CD
            ,RH.TRX_RSN_CD
            ,RH.CNTNR_SEAL_NUM
            ,RH.TOT_RCV_WT
            ,RH.SCE_ORD_TP_CD
            ,RH.RWS_CARR_CD
            ,RH.FROM_LOC_POST_CD
            ,RH.TRUCK_CNTNR_PK
            ,RH.IMPT_INV_SHPG_METH_CD
            ,RH.INLND_SHPG_METH_CD
            ,RH.WMS_DROP_STS_CD
            ,RH.RWS_REF_NUM
            ,RH.DRCT_SHIP_TP_CD
            ,RH.RTRN_AUTH_HDR_PK
            ,RH.WH_ETA_TEMP_DT
            ,RH.SCHD_ETA_CHK_FLG
            ,RH.FINAL_ETA_CHK_FLG
            ,RH.APPT_HOUR_MN
            ,RH.APPT_DRYG_CARR_CD
            ,RH.WH_SCHD_CMNT_TXT
            ,RH.TRX_ORD_NUM
            ,RH.SCHD_ETA_DT
            ,RH.FINAL_ETA_DT
            ,RH.SYS_SRC_CD
            ,RH.FIRST_STK_IN_DT
            ,RH.PO_RCV_TRX_HDR_NUM
            ,RH.RWS_NUM                  AS    RWS_NUM_DRH
            ,RH.TRX_SRC_TP_CD
            ,RH.PICK_UP_RQST_FLG
            ,RH.PICK_UP_RQST_TS
            ,RH.SVC_CONFIG_MSTR_PK
            ,RH.SHIP_FROM_SO_NUM
            ,RH.DS_CPO_CONFIG_PK
            ,RH.RWS_CLO_DT_TM_TS
            ,RW.LOC_TP_CD
            ,RW.POST_CD
            ,RW.COA_BR_CD                 AS    COA_BR_CD_RW
            ,DAC.COA_CH_CD
            ,T.COA_BR_CD                  AS    COA_BR_CD_TOC
            ,DCC.DS_COND_CONST_VAL_TXT_01
            ,DC.CPO_ORD_NUM
        FROM
            SCE_ORD_TP     SOT
            ,RWS_HDR       RH
            ,RTL_WH        RW
            ,SHIP_TO_CUST  STC
            ,SELL_TO_CUST  DAC
            ,CPO           DC
            ,TOC           T
            ,DS_COND_CONST DCC
        WHERE
            SOT.GLBL_CMPY_CD                =    #glblCmpyCd#
            AND SOT.INBD_OTBD_CD            =    #inbdOtbdCd#
            AND SOT.NTC_DROP_FLG            =    #ntcDropFlg#
            -- RWS_HDR JOIN
            AND SOT.GLBL_CMPY_CD            =    RH.GLBL_CMPY_CD
            AND RH.RWS_CLO_DT_TM_TS    &gt;     #dsBizLastUpdTs#
            <!-- STR 04/28/2016 R.Shimamoto [QC#7662 DEL] -->
            <!-- AND RH.RWS_CLO_DT_TM_TS    &lt;=    #thisProcTs# -->
            <!-- END 04/28/2016 R.Shimamoto [QC#7662 DEL] -->
            -- RWS_HDR JOIN
            AND SOT.GLBL_CMPY_CD            =    RH.GLBL_CMPY_CD
            AND SOT.SCE_ORD_TP_CD           =    RH.SCE_ORD_TP_CD
            AND RH.RWS_STS_CD               =    #rwsStsCd#
            -- RTL_WH JOIN
            AND RH.GLBL_CMPY_CD             =    RW.GLBL_CMPY_CD
            AND RH.WH_CD                    =    RW.RTL_WH_CD
            -- SHIP_TO_CUST JOIN
            AND RW.GLBL_CMPY_CD             =    STC.GLBL_CMPY_CD
            AND RW.RTL_WH_CD                =    STC.SHIP_TO_CUST_CD
            -- SELL_TO_CUST JOIN
            AND STC.GLBL_CMPY_CD            =    DAC.GLBL_CMPY_CD(+)
            AND STC.SELL_TO_CUST_CD         =    DAC.SELL_TO_CUST_CD(+)
            -- CPO JOIN
            AND RH.GLBL_CMPY_CD             =    DC.GLBL_CMPY_CD(+)
            AND RH.TRX_ORD_NUM              =    DC.CPO_ORD_NUM(+)
            -- TOC JOIN
            AND DC.GLBL_CMPY_CD             =    T.GLBL_CMPY_CD(+)
            AND DC.SLS_REP_TOC_CD           =    T.TOC_CD(+)
            -- DS_COND_CONST JOIN
            AND DC.GLBL_CMPY_CD             =    DCC.GLBL_CMPY_CD(+)
            AND DC.DS_ORD_CATG_CD           =    DCC.DS_COND_CONST_CD(+)
            AND DCC.DS_COND_CONST_GRP_ID(+) =    #batchId#
            AND SOT.EZCANCELFLAG            =    '0'
            AND RH.EZCANCELFLAG             =    '0'
            AND RW.EZCANCELFLAG             =    '0'
            AND STC.EZCANCELFLAG            =    '0'
            AND DAC.EZCANCELFLAG(+)         =    '0'
            AND DC.EZCANCELFLAG(+)          =    '0'
            AND T.EZCANCELFLAG(+)           =    '0'
            AND DCC.EZCANCELFLAG(+)         =    '0'
        ORDER BY
            RH.SCE_ORD_TP_CD NULLS FIRST
            ,RH.WH_CD NULLS FIRST
            ,RH.RWS_CLO_DT_TM_TS NULLS FIRST
    </statement>

    <statement id="getSoConfirmationSSO" parameterClass="Map"  resultClass="Map">
        SELECT DISTINCT
             MAIN.CARR_FRT_SRC_TP_NM
            ,CASE
                WHEN MAIN.MDSE_COA_MDSE_TP_CD = #machine# AND COA_MDSE_TP_CNT = 1 AND EXISTS( SELECT 1 FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #tds# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD)
                THEN (SELECT CFCPX.CARR_FRT_PRFL_NUM FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #tds# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD)
                WHEN MAIN.MDSE_COA_MDSE_TP_CD = #machine# AND COA_MDSE_TP_CNT = 1 AND EXISTS( SELECT 1 FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #dg# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD) 
                THEN (SELECT CFCPX.CARR_FRT_PRFL_NUM FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #dg# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD)
                ELSE MAIN.CARR_FRT_PRFL_NUM
             END AS CARR_FRT_PRFL_NUM
            ,MAIN.TRX_HDR_NUM
            ,MAIN.TRX_REF_NUM_01
            ,MAIN.TRX_REF_NUM_02
            ,MAIN.COA_CMPY_CD
            ,MAIN.COA_BR_CD
            ,MAIN.COA_CC_CD
            ,MAIN.COA_ACCT_CD
            ,CASE
                WHEN MAIN.MDSE_COA_MDSE_TP_CD = #machine# AND COA_MDSE_TP_CNT = 1 AND EXISTS( SELECT 1 FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #tds# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD)
                THEN #tdsCoaProdCd#
                WHEN MAIN.MDSE_COA_MDSE_TP_CD = #machine# AND COA_MDSE_TP_CNT = 1 AND EXISTS( SELECT 1 FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #dg# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD) 
                THEN #dgCoaProdCd#
                ELSE MAIN.DEF_COA_PROD_CD
             END AS COA_PROD_CD
            ,MAIN.COA_CH_CD
            ,MAIN.COA_AFFL_CD
            ,MAIN.COA_PROJ_CD
            ,MAIN.CARR_FRT_CHRG_BU_CD
            ,MAIN.CARR_CD
            ,MAIN.INVTY_TRX_DT
            ,MAIN.FROM_POST_CD
            ,MAIN.TO_POST_CD
        FROM (
            SELECT
                 CFSTX.CARR_FRT_SRC_TP_NM              AS CARR_FRT_SRC_TP_NM
                ,DCC.DS_COND_CONST_VAL_TXT_01          AS CARR_FRT_PRFL_NUM
                ,#orderSSO#                            AS TRX_HDR_NUM
                ,SOC.SO_NUM                            AS TRX_REF_NUM_01
                ,SO.TRX_HDR_NUM                        AS TRX_REF_NUM_02
                ,CFSTX.DEF_COA_CMPY_CD                 AS COA_CMPY_CD
                ,T.COA_BR_CD                           AS COA_BR_CD
                ,T.COA_CC_CD                           AS COA_CC_CD
                ,DCC.DS_COND_CONST_VAL_TXT_05          AS COA_ACCT_CD
                ,DCC.DS_COND_CONST_VAL_TXT_07          AS COA_CH_CD
                ,DCC.DS_COND_CONST_VAL_TXT_08          AS COA_AFFL_CD
                ,DCC.DS_COND_CONST_VAL_TXT_09          AS COA_PROJ_CD
                ,DCC.DS_COND_CONST_VAL_TXT_10          AS CARR_FRT_CHRG_BU_CD
                ,CASE
                    WHEN SOCD.VND_CD IS NULL OR SOCD.VND_CD = '*' THEN CFSTX.DEF_CARR_CD
                    WHEN OCV.CARR_CD IS NOT NULL THEN OCV.CARR_CD
                    ELSE SOCD.VND_CD
                 END                                   AS CARR_CD
                ,SOC.SHIP_DT_TM_TS                     AS INVTY_TRX_DT
                ,RW.POST_CD                            AS FROM_POST_CD
                ,CD.SHIP_TO_POST_CD                    AS TO_POST_CD
                ,DCC.DS_COND_CONST_VAL_TXT_06          AS DEF_COA_PROD_CD
                ,M.COA_PROD_CD                         AS MDSE_COA_PROD_CD
                ,M.COA_MDSE_TP_CD                      AS MDSE_COA_MDSE_TP_CD
                ,CASE 
                    WHEN M.COA_MDSE_TP_CD = #machine# THEN COUNT(M.COA_MDSE_TP_CD) OVER(PARTITION BY SO.SO_NUM, M.COA_MDSE_TP_CD ORDER BY SO.SO_NUM) 
                    WHEN (SELECT /*+ INDEX(M MDSE_PK) */
                              COUNT(SOCD.GLBL_CMPY_CD)
                          FROM
                               SHPG_ORD_CONF_DTL SOCD
                              ,MDSE M
                          WHERE
                              SOCD.GLBL_CMPY_CD = #glblCmpyCd#
                          AND SOCD.SO_NUM       = SOC.SO_NUM
                          AND SOCD.GLBL_CMPY_CD = M.GLBL_CMPY_CD
                          AND SOCD.MDSE_CD      = M.MDSE_CD
                          AND M.COA_MDSE_TP_CD  = #machine#
                          AND SOCD.EZCANCELFLAG = '0'
                          AND M.EZCANCELFLAG    = '0') > 0 THEN 0
                 END AS COA_MDSE_TP_CNT
                ,SOCD.SO_SLP_NUM
            FROM
                 SHPG_ORD_CONF        SOC
                ,SCE_ORD_TP           SOT
                ,RTL_WH               RW
                ,SHPG_ORD             SO
                ,SHPG_ORD_CONF_DTL    SOCD
                ,SHPG_ORD_DTL         SOD
                ,CPO                  C
                ,CPO_DTL              CD
                ,CARR_FRT_SRC_TP_XREF CFSTX
                ,TOC                  T
                ,MDSE                 M
                ,DS_COND_CONST        DCC
                ,DS_ORD_TP            DOT
                ,OTBD_CARR_V          OCV
            WHERE
                SOC.GLBL_CMPY_CD            = #glblCmpyCd#
            AND SOC.SHIP_DT_TM_TS           &gt;= #dsBizLastUpdTs#
            AND SOC.GLBL_CMPY_CD            = SOT.GLBL_CMPY_CD
            AND SOC.SCE_ORD_TP_CD           = SOT.SCE_ORD_TP_CD
            AND SOT.SCE_ORD_TP_CD           = #sceOrdTpCdRS#
            AND SOT.INBD_OTBD_CD            = #inbdOtbdCd#
            AND SOT.NTC_DROP_FLG            = #ntcDropFlg#
            AND SOC.GLBL_CMPY_CD            = RW.GLBL_CMPY_CD
            AND SOC.WH_CD                   = RW.RTL_WH_CD
            AND RW.RTL_WH_CATG_CD          != #dummy#
            AND SOC.GLBL_CMPY_CD            = SO.GLBL_CMPY_CD
            AND SOC.SO_NUM                  = SO.SO_NUM
            AND SO.SHPG_STS_CD              = #shpgStsCd#
            AND SO.GLBL_CMPY_CD             = SOCD.GLBL_CMPY_CD
            AND SO.SO_NUM                   = SOCD.SO_NUM
            AND SOCD.GLBL_CMPY_CD           = SOD.GLBL_CMPY_CD
            AND SOCD.SO_NUM                 = SOD.SO_NUM
            AND SOCD.SO_SLP_NUM             = SOD.SO_SLP_NUM
            AND SO.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
            AND SO.TRX_HDR_NUM              = C.CPO_ORD_NUM
            AND C.GLBL_CMPY_CD              = T.GLBL_CMPY_CD
            AND C.SLS_REP_TOC_CD            = T.TOC_CD
            AND C.GLBL_CMPY_CD              = CD.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM               = CD.CPO_ORD_NUM
            AND SOD.TRX_LINE_NUM            = CD.CPO_DTL_LINE_NUM
            AND SOT.GLBL_CMPY_CD            = CFSTX.GLBL_CMPY_CD
            AND SOT.SCE_ORD_TP_CD           = CFSTX.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD            = CFSTX.INBD_OTBD_CD
            AND CFSTX.DROP_SHIP_WH_CD       IS NULL
            AND SOCD.GLBL_CMPY_CD           = M.GLBL_CMPY_CD
            AND SOCD.MDSE_CD                = M.MDSE_CD
            AND C.GLBL_CMPY_CD              = DCC.GLBL_CMPY_CD
            AND C.DS_ORD_TP_CD              = DCC.DS_COND_CONST_CD
            AND DCC.DS_COND_CONST_GRP_ID    = #batchId#
            AND DCC.GLBL_CMPY_CD            = DOT.GLBL_CMPY_CD
            AND DCC.DS_COND_CONST_CD        = DOT.DS_ORD_TP_CD
            AND SOCD.GLBL_CMPY_CD           = OCV.GLBL_CMPY_CD(+)
            AND SOCD.VND_CD                 = OCV.CARR_CD(+)
            AND SOC.EZCANCELFLAG            = '0'
            AND SOT.EZCANCELFLAG            = '0'
            AND RW.EZCANCELFLAG             = '0'
            AND SO.EZCANCELFLAG             = '0'
            AND SOCD.EZCANCELFLAG           = '0'
            AND SOD.EZCANCELFLAG            = '0'
            AND C.EZCANCELFLAG              = '0'
            AND CD.EZCANCELFLAG             = '0'
            AND CFSTX.EZCANCELFLAG          = '0'
            AND T.EZCANCELFLAG              = '0'
            AND M.EZCANCELFLAG              = '0'
            AND DCC.EZCANCELFLAG            = '0'
            AND DOT.EZCANCELFLAG            = '0'
            AND OCV.EZCANCELFLAG(+)         = '0'
        ) MAIN
    WHERE (COA_MDSE_TP_CNT IS NULL OR COA_MDSE_TP_CNT > 0)
    </statement>

    <statement id="getSoConfirmationSSD" parameterClass="Map"  resultClass="Map">
        SELECT DISTINCT
             MAIN.CARR_FRT_SRC_TP_NM
            ,CASE
                WHEN MAIN.MDSE_COA_MDSE_TP_CD = #machine# AND COA_MDSE_TP_CNT = 1 AND EXISTS( SELECT 1 FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #tds# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD)
                THEN (SELECT CFCPX.CARR_FRT_PRFL_NUM FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #tds# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD)
                WHEN MAIN.MDSE_COA_MDSE_TP_CD = #machine# AND COA_MDSE_TP_CNT = 1 AND EXISTS( SELECT 1 FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #dg# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD) 
                THEN (SELECT CFCPX.CARR_FRT_PRFL_NUM FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #dg# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD)
                ELSE MAIN.CARR_FRT_PRFL_NUM
             END AS CARR_FRT_PRFL_NUM
            ,MAIN.TRX_HDR_NUM
            ,MAIN.TRX_REF_NUM_01
            ,MAIN.TRX_REF_NUM_02
            ,MAIN.COA_CMPY_CD
            ,MAIN.COA_BR_CD
            ,MAIN.COA_CC_CD
            ,MAIN.COA_ACCT_CD
            ,CASE
                WHEN MAIN.MDSE_COA_MDSE_TP_CD = #machine# AND COA_MDSE_TP_CNT = 1 AND EXISTS( SELECT 1 FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #tds# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD)
                THEN #tdsCoaProdCd#
                WHEN MAIN.MDSE_COA_MDSE_TP_CD = #machine# AND COA_MDSE_TP_CNT = 1 AND EXISTS( SELECT 1 FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #dg# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD) 
                THEN #dgCoaProdCd#
                ELSE MAIN.DEF_COA_PROD_CD
             END AS COA_PROD_CD
            ,MAIN.COA_CH_CD
            ,MAIN.COA_AFFL_CD
            ,MAIN.COA_PROJ_CD
            ,MAIN.CARR_FRT_CHRG_BU_CD
            ,MAIN.CARR_CD
            ,MAIN.INVTY_TRX_DT
            ,MAIN.FROM_POST_CD
            ,MAIN.TO_POST_CD
        FROM (
            SELECT
                 CFSTX.CARR_FRT_SRC_TP_NM              AS CARR_FRT_SRC_TP_NM
                ,DCC.DS_COND_CONST_VAL_TXT_01          AS CARR_FRT_PRFL_NUM
                ,#orderSSD#                            AS TRX_HDR_NUM
                ,SO.TRX_HDR_NUM                        AS TRX_REF_NUM_01
                ,PD.PO_ORD_NUM                         AS TRX_REF_NUM_02
                ,CFSTX.DEF_COA_CMPY_CD                 AS COA_CMPY_CD
                ,T.COA_BR_CD                           AS COA_BR_CD
                ,T.COA_CC_CD                           AS COA_CC_CD
                ,DCC.DS_COND_CONST_VAL_TXT_05          AS COA_ACCT_CD
                ,DCC.DS_COND_CONST_VAL_TXT_07          AS COA_CH_CD
                ,DCC.DS_COND_CONST_VAL_TXT_08          AS COA_AFFL_CD
                ,DCC.DS_COND_CONST_VAL_TXT_09          AS COA_PROJ_CD
                ,DCC.DS_COND_CONST_VAL_TXT_10          AS CARR_FRT_CHRG_BU_CD
                ,CASE
                    WHEN SOCD.VND_CD IS NULL OR SOCD.VND_CD = '*' THEN CFSTX.DEF_CARR_CD
                    WHEN OCV.CARR_CD IS NOT NULL THEN OCV.CARR_CD
                    ELSE SOCD.VND_CD
                 END                                   AS CARR_CD
                ,SOC.SHIP_DT_TM_TS                     AS INVTY_TRX_DT
                ,RW.POST_CD                            AS FROM_POST_CD
                ,CD.SHIP_TO_POST_CD                    AS TO_POST_CD
                ,DCC.DS_COND_CONST_VAL_TXT_06          AS DEF_COA_PROD_CD
                ,M.COA_PROD_CD                         AS MDSE_COA_PROD_CD
                ,M.COA_MDSE_TP_CD                      AS MDSE_COA_MDSE_TP_CD
                ,CASE 
                    WHEN M.COA_MDSE_TP_CD = #machine# THEN COUNT(M.COA_MDSE_TP_CD) OVER(PARTITION BY SO.SO_NUM, M.COA_MDSE_TP_CD ORDER BY SO.SO_NUM) 
                    WHEN (SELECT /*+ INDEX(M MDSE_PK) */
                              COUNT(SOCD.GLBL_CMPY_CD)
                          FROM
                               SHPG_ORD_CONF_DTL SOCD
                              ,MDSE M
                          WHERE
                              SOCD.GLBL_CMPY_CD = #glblCmpyCd#
                          AND SOCD.SO_NUM       = SOC.SO_NUM
                          AND SOCD.GLBL_CMPY_CD = M.GLBL_CMPY_CD
                          AND SOCD.MDSE_CD      = M.MDSE_CD
                          AND M.COA_MDSE_TP_CD  = #machine#
                          AND SOCD.EZCANCELFLAG = '0'
                          AND M.EZCANCELFLAG    = '0') > 0 THEN 0
                 END AS COA_MDSE_TP_CNT
                ,SOCD.SO_SLP_NUM
            FROM
                 SHPG_ORD_CONF        SOC
                ,SCE_ORD_TP           SOT
                ,RTL_WH               RW
                ,SHPG_ORD             SO
                ,SHPG_ORD_CONF_DTL    SOCD
                ,SHPG_ORD_DTL         SOD
                ,CPO                  C
                ,CPO_DTL              CD
                ,CARR_FRT_SRC_TP_XREF CFSTX
                ,TOC                  T
                ,MDSE                 M
                ,PO_DTL               PD
                ,DS_COND_CONST        DCC
                ,DS_ORD_TP            DOT
                ,OTBD_CARR_V          OCV
            WHERE
                SOC.GLBL_CMPY_CD         = #glblCmpyCd#
            AND SOC.SHIP_DT_TM_TS        &gt;= #dsBizLastUpdTs#
            AND SOC.GLBL_CMPY_CD         = SOT.GLBL_CMPY_CD
            AND SOC.SCE_ORD_TP_CD        = SOT.SCE_ORD_TP_CD
            AND SOT.SCE_ORD_TP_CD        = #sceOrdTpCdRS#
            AND SOT.INBD_OTBD_CD         = #inbdOtbdCd#
            AND SOT.NTC_DROP_FLG         = #ntcDropFlg#
            AND SOC.GLBL_CMPY_CD         = RW.GLBL_CMPY_CD
            AND SOC.WH_CD                = RW.RTL_WH_CD
            AND SOC.GLBL_CMPY_CD         = SO.GLBL_CMPY_CD
            AND SOC.SO_NUM               = SO.SO_NUM
            AND SO.SHPG_STS_CD           = #shpgStsCd#
            AND SO.GLBL_CMPY_CD          = SOCD.GLBL_CMPY_CD
            AND SO.SO_NUM                = SOCD.SO_NUM
            AND SOCD.GLBL_CMPY_CD        = SOD.GLBL_CMPY_CD
            AND SOCD.SO_NUM              = SOD.SO_NUM
            AND SOCD.SO_SLP_NUM          = SOD.SO_SLP_NUM
            AND SO.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND SO.TRX_HDR_NUM           = C.CPO_ORD_NUM
            AND C.GLBL_CMPY_CD           = T.GLBL_CMPY_CD
            AND C.SLS_REP_TOC_CD         = T.TOC_CD
            AND C.GLBL_CMPY_CD           = CD.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM            = CD.CPO_ORD_NUM
            AND SOD.TRX_LINE_NUM         = CD.CPO_DTL_LINE_NUM
            AND SOT.GLBL_CMPY_CD         = CFSTX.GLBL_CMPY_CD
            AND SOT.SCE_ORD_TP_CD        = CFSTX.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD         = CFSTX.INBD_OTBD_CD
            AND SOC.WH_CD                = CFSTX.DROP_SHIP_WH_CD
            AND SOCD.GLBL_CMPY_CD        = M.GLBL_CMPY_CD
            AND SOCD.MDSE_CD             = M.MDSE_CD
            AND C.GLBL_CMPY_CD           = PD.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM            = PD.CPO_ORD_NUM
            AND CD.CPO_DTL_LINE_NUM      = PD.CPO_DTL_LINE_NUM
            AND C.GLBL_CMPY_CD           = DCC.GLBL_CMPY_CD
            AND C.DS_ORD_TP_CD           = DCC.DS_COND_CONST_CD
            AND DCC.DS_COND_CONST_GRP_ID = #batchId#
            AND DCC.GLBL_CMPY_CD         = DOT.GLBL_CMPY_CD
            AND DCC.DS_COND_CONST_CD     = DOT.DS_ORD_TP_CD
            AND SOCD.GLBL_CMPY_CD        = OCV.GLBL_CMPY_CD(+)
            AND SOCD.VND_CD              = OCV.CARR_CD(+)
            AND SOC.EZCANCELFLAG         = '0'
            AND SOT.EZCANCELFLAG         = '0'
            AND RW.EZCANCELFLAG          = '0'
            AND SO.EZCANCELFLAG          = '0'
            AND SOCD.EZCANCELFLAG        = '0'
            AND SOD.EZCANCELFLAG         = '0'
            AND C.EZCANCELFLAG           = '0'
            AND CD.EZCANCELFLAG          = '0'
            AND CFSTX.EZCANCELFLAG       = '0'
            AND T.EZCANCELFLAG           = '0'
            AND M.EZCANCELFLAG           = '0'
            AND PD.EZCANCELFLAG          = '0'
            AND DCC.EZCANCELFLAG         = '0'
            AND DOT.EZCANCELFLAG         = '0'
            AND OCV.EZCANCELFLAG(+)      = '0'
            <!-- START 2020/10/06 A.Marte [QC#57795, ADD] -->
            <isNotNull property="poVndCdList">
            AND EXISTS(
                SELECT
                    1
                FROM
                    PO  PO
                WHERE
                    PO.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                AND PO.PO_ORD_NUM        = PD.PO_ORD_NUM
                <iterate property="poVndCdList" var="poVndCdList[]" open="AND PO.VND_CD NOT IN (" close=")" conjunction=",">
                    #poVndCdList[]#
                </iterate>
                AND EZCANCELFLAG = '0'
                )
            </isNotNull>
            <!-- END 2020/10/06 A.Marte [QC#57795, ADD] -->
        ) MAIN
    WHERE (COA_MDSE_TP_CNT IS NULL OR COA_MDSE_TP_CNT > 0)
    </statement>

    <statement id="getSoConfirmationMOS" parameterClass="Map"  resultClass="Map">
        SELECT DISTINCT
             MAIN.CARR_FRT_SRC_TP_NM
            ,MAIN.CARR_FRT_PRFL_NUM 
            ,MAIN.TRX_HDR_NUM
            ,MAIN.TRX_REF_NUM_01
            ,MAIN.TRX_REF_NUM_02
            ,MAIN.COA_CMPY_CD
            ,MAIN.COA_BR_CD
            ,MAIN.COA_CC_CD
            ,MAIN.COA_ACCT_CD
            ,MAIN.COA_PROD_CD
            ,MAIN.COA_CH_CD
            ,MAIN.COA_AFFL_CD
            ,MAIN.COA_PROJ_CD
            ,MAIN.CARR_FRT_CHRG_BU_CD
            ,MAIN.CARR_CD
            ,MAIN.INVTY_TRX_DT
            ,MAIN.FROM_POST_CD
            ,MAIN.TO_POST_CD
        FROM (
            SELECT
                 CFSTX.CARR_FRT_SRC_TP_NM              AS CARR_FRT_SRC_TP_NM
                ,(SELECT DCC.DS_COND_CONST_VAL_TXT_01 FROM DS_COND_CONST DCC WHERE DCC.GLBL_CMPY_CD = #glblCmpyCd# AND DCC.DS_COND_CONST_GRP_ID = #mosCtsiPrfl# AND SP.LINE_BIZ_TP_CD = DCC.DS_COND_CONST_CD AND DCC.EZCANCELFLAG = '0') AS CARR_FRT_PRFL_NUM
                ,#orderMOS#                            AS TRX_HDR_NUM
                ,SO.SO_NUM                             AS TRX_REF_NUM_01
                ,SO.SRC_ORD_NUM                        AS TRX_REF_NUM_02
                ,CFSTX.DEF_COA_CMPY_CD                 AS COA_CMPY_CD
                ,T.COA_BR_CD                           AS COA_BR_CD
                ,T.COA_CC_CD                           AS COA_CC_CD
                ,CFSTX.DEF_COA_ACCT_CD                 AS COA_ACCT_CD
                ,CFSTX.DEF_COA_CH_CD                   AS COA_CH_CD
                ,CFSTX.DEF_COA_AFFL_CD                 AS COA_AFFL_CD
                ,CFSTX.DEF_COA_MDSE_TP_CD              AS COA_PROJ_CD
                ,CFSTX.CARR_FRT_CHRG_BU_CD             AS CARR_FRT_CHRG_BU_CD
                ,CASE
                    WHEN SOCD.VND_CD IS NULL OR SOCD.VND_CD = '*' THEN CFSTX.DEF_CARR_CD
                    WHEN OCV.CARR_CD IS NOT NULL THEN OCV.CARR_CD
                    ELSE SOCD.VND_CD
                 END                                   AS CARR_CD
                ,SOC.SHIP_DT_TM_TS                     AS INVTY_TRX_DT
                ,RW.POST_CD                            AS FROM_POST_CD
                ,NVL(PR.SHIP_TO_POST_CD, RW_TECH.POST_CD) AS TO_POST_CD
                ,CASE
                    WHEN SP.LINE_BIZ_TP_CD = #lfs# THEN #lfsCoaProdCd#
                    WHEN SP.LINE_BIZ_TP_CD = #pps# THEN #ppsCoaProdCd#
                    WHEN SP.LINE_BIZ_TP_CD = #ess# THEN #essCoaProdCd#
                    ELSE NULL
                 END AS COA_PROD_CD
                ,SOCD.SO_SLP_NUM
                ,RW_TECH.TECH_TOC_CD
                ,SP.LINE_BIZ_TP_CD
            FROM
                 SHPG_ORD_CONF        SOC
                ,SCE_ORD_TP           SOT
                ,RTL_WH               RW
                ,SHPG_ORD             SO
                ,SHPG_ORD_CONF_DTL    SOCD
                ,SHPG_ORD_DTL         SOD
                ,CARR_FRT_SRC_TP_XREF CFSTX
                ,PRCH_REQ             PR
                ,RTL_WH               RW_TECH
                ,S21_PSN              SP
                ,TOC                  T
                ,OTBD_CARR_V          OCV
            WHERE
                SOC.GLBL_CMPY_CD         = #glblCmpyCd#
            AND SOC.SHIP_DT_TM_TS        &gt;= #dsBizLastUpdTs#
            AND SOC.GLBL_CMPY_CD         = SOT.GLBL_CMPY_CD
            AND SOC.SCE_ORD_TP_CD        = SOT.SCE_ORD_TP_CD
            AND SOT.SCE_ORD_TP_CD        = #sceOrdTpCdTR#
            AND SOT.INBD_OTBD_CD         = #inbdOtbdCd#
            AND SOT.NTC_DROP_FLG         = #ntcDropFlg#
            AND SOC.GLBL_CMPY_CD         = RW.GLBL_CMPY_CD
            AND SOC.WH_CD                = RW.RTL_WH_CD
            AND RW.LOC_TP_CD             = #locTpCd01#
            AND SOC.GLBL_CMPY_CD         = SO.GLBL_CMPY_CD
            AND SOC.SO_NUM               = SO.SO_NUM
            AND SO.SHPG_STS_CD           = #shpgStsCd#
            AND SO.GLBL_CMPY_CD          = SOCD.GLBL_CMPY_CD
            AND SO.SO_NUM                = SOCD.SO_NUM
            AND SOCD.GLBL_CMPY_CD        = SOD.GLBL_CMPY_CD
            AND SOCD.SO_NUM              = SOD.SO_NUM
            AND SOCD.SO_SLP_NUM          = SOD.SO_SLP_NUM
            AND SOD.GLBL_CMPY_CD         = RW_TECH.GLBL_CMPY_CD
            AND SOD.SHIP_TO_RTL_WH_CD    = RW_TECH.RTL_WH_CD
            AND RW_TECH.GLBL_CMPY_CD     = SP.GLBL_CMPY_CD
            AND RW_TECH.TECH_TOC_CD      = SP.PSN_CD
            AND SOT.GLBL_CMPY_CD         = CFSTX.GLBL_CMPY_CD
            AND SOT.SCE_ORD_TP_CD        = CFSTX.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD         = CFSTX.INBD_OTBD_CD
            AND RW.LOC_TP_CD             = CFSTX.FROM_LOC_TP_CD
            AND SO.GLBL_CMPY_CD          = PR.GLBL_CMPY_CD
            AND SO.SRC_ORD_NUM           = PR.PRCH_REQ_NUM
            AND RW_TECH.GLBL_CMPY_CD     = T.GLBL_CMPY_CD
            AND T.TOC_CD = (
                SELECT
                    TOC_CD
                FROM(
                    SELECT
                        B.TOC_CD
                    FROM
                         ORG_FUNC_ASG     A
                        ,TOC              B
                        ,ORG_FUNC_ROLE_TP C
                    WHERE
                            A.GLBL_CMPY_CD        = #glblCmpyCd#
                        <!-- 2023/06/28 QC#61651 Update Start  -->
                        AND A.EFF_FROM_DT   &lt;= #salesDate#
                        AND (A.EFF_THRU_DT  &gt;= #salesDate#
                          OR A.EFF_THRU_DT  IS NULL
                        )
                        <!-- 2023/06/28 QC#61651 Update End  -->
                        AND A.EZCANCELFLAG        = '0'
                        AND A.PSN_CD              = RW_TECH.TECH_TOC_CD
                        AND A.GLBL_CMPY_CD        = B.GLBL_CMPY_CD
                        AND A.TOC_CD              = B.TOC_CD
                        AND A.EZCANCELFLAG        = '0'
                        AND C.GLBL_CMPY_CD        = B.GLBL_CMPY_CD
                        AND C.ORG_FUNC_ROLE_TP_CD = B.ORG_FUNC_ROLE_TP_CD
                        AND C.TECH_MSTR_REQ_FLG   = 'Y'
                        AND C.EZCANCELFLAG        = '0'
                    ORDER BY
                        C.MGR_FLG ASC, C.ORG_FUNC_ROLE_TP_SORT_NUM ASC
                    )
                WHERE
                    ROWNUM = 1
            )
            AND SOCD.GLBL_CMPY_CD        = OCV.GLBL_CMPY_CD(+)
            AND SOCD.VND_CD              = OCV.CARR_CD(+)
            AND SOC.EZCANCELFLAG         = '0'
            AND SOT.EZCANCELFLAG         = '0'
            AND RW.EZCANCELFLAG          = '0'
            AND SO.EZCANCELFLAG          = '0'
            AND SOCD.EZCANCELFLAG        = '0'
            AND SOD.EZCANCELFLAG         = '0'
            AND CFSTX.EZCANCELFLAG       = '0'
            AND PR.EZCANCELFLAG          = '0'
            AND RW_TECH.EZCANCELFLAG     = '0'
            AND SP.EZCANCELFLAG          = '0'
            AND T.EZCANCELFLAG           = '0'
            AND OCV.EZCANCELFLAG(+)      = '0'
        ) MAIN
    </statement>

    <statement id="getSoConfirmationRAP" parameterClass="Map"  resultClass="Map">
        SELECT DISTINCT
             MAIN.CARR_FRT_SRC_TP_NM
            ,MAIN.CARR_FRT_PRFL_NUM 
            ,MAIN.TRX_HDR_NUM
            ,MAIN.TRX_REF_NUM_01
            ,MAIN.TRX_REF_NUM_02
            ,MAIN.COA_CMPY_CD
            ,MAIN.COA_BR_CD
            ,MAIN.COA_CC_CD
            ,MAIN.COA_ACCT_CD
            ,MAIN.COA_PROD_CD
            ,MAIN.COA_CH_CD
            ,MAIN.COA_AFFL_CD
            ,MAIN.COA_PROJ_CD
            ,MAIN.CARR_FRT_CHRG_BU_CD
            ,MAIN.CARR_CD
            ,MAIN.INVTY_TRX_DT
            ,MAIN.FROM_POST_CD
            ,MAIN.TO_POST_CD
        FROM (
            SELECT
                 CFSTX.CARR_FRT_SRC_TP_NM              AS CARR_FRT_SRC_TP_NM
                ,(SELECT DCC.DS_COND_CONST_VAL_TXT_01 FROM DS_COND_CONST DCC WHERE DCC.GLBL_CMPY_CD = #glblCmpyCd# AND DCC.DS_COND_CONST_GRP_ID = #rapCtsiPrfl# AND SP.LINE_BIZ_TP_CD = DCC.DS_COND_CONST_CD AND DCC.EZCANCELFLAG = '0') AS CARR_FRT_PRFL_NUM
                ,#orderRAP#                            AS TRX_HDR_NUM
                ,SO.SO_NUM                             AS TRX_REF_NUM_01
                ,SO.SRC_ORD_NUM                        AS TRX_REF_NUM_02
                ,CFSTX.DEF_COA_CMPY_CD                 AS COA_CMPY_CD
                ,T.COA_BR_CD                           AS COA_BR_CD
                ,T.COA_CC_CD                           AS COA_CC_CD
                ,CFSTX.DEF_COA_ACCT_CD                 AS COA_ACCT_CD
                ,CFSTX.DEF_COA_CH_CD                   AS COA_CH_CD
                ,CFSTX.DEF_COA_AFFL_CD                 AS COA_AFFL_CD
                ,CFSTX.DEF_COA_MDSE_TP_CD              AS COA_PROJ_CD
                ,CFSTX.CARR_FRT_CHRG_BU_CD             AS CARR_FRT_CHRG_BU_CD
                ,CASE
                    WHEN SOCD.VND_CD IS NULL OR SOCD.VND_CD = '*' THEN CFSTX.DEF_CARR_CD
                    WHEN OCV.CARR_CD IS NOT NULL THEN OCV.CARR_CD
                    ELSE SOCD.VND_CD
                 END                                   AS CARR_CD
                ,SOC.SHIP_DT_TM_TS                     AS INVTY_TRX_DT
                ,RW_TECH.POST_CD                       AS FROM_POST_CD
                ,NVL(PR.SHIP_TO_POST_CD, RW.POST_CD)   AS TO_POST_CD
                ,CASE
                    WHEN SP.LINE_BIZ_TP_CD = #lfs# THEN #lfsCoaProdCd#
                    WHEN SP.LINE_BIZ_TP_CD = #pps# THEN #ppsCoaProdCd#
                    WHEN SP.LINE_BIZ_TP_CD = #ess# THEN #essCoaProdCd#
                    ELSE NULL
                 END AS COA_PROD_CD
                ,SOCD.SO_SLP_NUM
                ,RW_TECH.TECH_TOC_CD
                ,SP.LINE_BIZ_TP_CD
            FROM
                 SHPG_ORD_CONF        SOC
                ,SCE_ORD_TP           SOT
                ,RTL_WH               RW
                ,SHPG_ORD             SO
                ,SHPG_ORD_CONF_DTL    SOCD
                ,SHPG_ORD_DTL         SOD
                ,CARR_FRT_SRC_TP_XREF CFSTX
                ,PRCH_REQ             PR
                ,RTL_WH               RW_TECH
                ,S21_PSN              SP
                ,TOC                  T
                ,OTBD_CARR_V          OCV
            WHERE
                SOC.GLBL_CMPY_CD         = #glblCmpyCd#
            AND SOC.SHIP_DT_TM_TS        &gt;= #dsBizLastUpdTs#
            AND SOC.GLBL_CMPY_CD         = SOT.GLBL_CMPY_CD
            AND SOC.SCE_ORD_TP_CD        = SOT.SCE_ORD_TP_CD
            AND SOT.SCE_ORD_TP_CD        = #sceOrdTpCdTR#
            AND SOT.INBD_OTBD_CD         = #inbdOtbdCd#
            AND SOT.NTC_DROP_FLG         = #ntcDropFlg#
            AND SOC.GLBL_CMPY_CD         = RW_TECH.GLBL_CMPY_CD
            AND SOC.WH_CD                = RW_TECH.RTL_WH_CD
            AND RW_TECH.LOC_TP_CD        = #locTpCd06#
            AND SOC.GLBL_CMPY_CD         = SO.GLBL_CMPY_CD
            AND SOC.SO_NUM               = SO.SO_NUM
            AND SO.SHPG_STS_CD           = #shpgStsCd#
            AND SO.GLBL_CMPY_CD          = SOCD.GLBL_CMPY_CD
            AND SO.SO_NUM                = SOCD.SO_NUM
            AND SOCD.GLBL_CMPY_CD        = SOD.GLBL_CMPY_CD
            AND SOCD.SO_NUM              = SOD.SO_NUM
            AND SOCD.SO_SLP_NUM          = SOD.SO_SLP_NUM
            AND SOD.GLBL_CMPY_CD         = RW.GLBL_CMPY_CD
            AND SOD.SHIP_TO_RTL_WH_CD    = RW.RTL_WH_CD
            AND RW_TECH.GLBL_CMPY_CD     = SP.GLBL_CMPY_CD
            AND RW_TECH.TECH_TOC_CD      = SP.PSN_CD
            AND SOT.GLBL_CMPY_CD         = CFSTX.GLBL_CMPY_CD
            AND SOT.SCE_ORD_TP_CD        = CFSTX.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD         = CFSTX.INBD_OTBD_CD
            AND RW_TECH.LOC_TP_CD        = CFSTX.FROM_LOC_TP_CD
            AND SO.GLBL_CMPY_CD          = PR.GLBL_CMPY_CD
            AND SO.SRC_ORD_NUM           = PR.PRCH_REQ_NUM
            AND RW_TECH.GLBL_CMPY_CD     = T.GLBL_CMPY_CD
            AND T.TOC_CD = (
                SELECT
                    TOC_CD
                FROM(
                    SELECT
                        B.TOC_CD
                    FROM
                         ORG_FUNC_ASG     A
                        ,TOC              B
                        ,ORG_FUNC_ROLE_TP C
                    WHERE
                            A.GLBL_CMPY_CD        = #glblCmpyCd#
                        <!-- 2023/06/28 QC#61651 Update Start  -->
                        AND A.EFF_FROM_DT   &lt;= #salesDate#
                        AND (A.EFF_THRU_DT  &gt;= #salesDate#
                          OR A.EFF_THRU_DT  IS NULL
                        )
                        <!-- 2023/06/28 QC#61651 Update End  -->
                        AND A.EZCANCELFLAG        = '0'
                        AND A.PSN_CD              = RW_TECH.TECH_TOC_CD
                        AND A.GLBL_CMPY_CD        = B.GLBL_CMPY_CD
                        AND A.TOC_CD              = B.TOC_CD
                        AND A.EZCANCELFLAG        = '0'
                        AND C.GLBL_CMPY_CD        = B.GLBL_CMPY_CD
                        AND C.ORG_FUNC_ROLE_TP_CD = B.ORG_FUNC_ROLE_TP_CD
                        AND C.TECH_MSTR_REQ_FLG   = 'Y'
                        AND C.EZCANCELFLAG        = '0'
                    ORDER BY
                        C.MGR_FLG ASC, C.ORG_FUNC_ROLE_TP_SORT_NUM ASC
                    )
                WHERE
                    ROWNUM = 1
            )
            AND SOCD.GLBL_CMPY_CD        = OCV.GLBL_CMPY_CD(+)
            AND SOCD.VND_CD              = OCV.CARR_CD(+)
            AND SOC.EZCANCELFLAG         = '0'
            AND SOT.EZCANCELFLAG         = '0'
            AND RW.EZCANCELFLAG          = '0'
            AND SO.EZCANCELFLAG          = '0'
            AND SOCD.EZCANCELFLAG        = '0'
            AND SOD.EZCANCELFLAG         = '0'
            AND CFSTX.EZCANCELFLAG       = '0'
            AND PR.EZCANCELFLAG          = '0'
            AND RW_TECH.EZCANCELFLAG     = '0'
            AND SP.EZCANCELFLAG          = '0'
            AND T.EZCANCELFLAG           = '0'
            AND OCV.EZCANCELFLAG(+)      = '0'
        ) MAIN
    </statement>

    <statement id="getSoConfirmationTRFDt" parameterClass="Map"  resultClass="Map">
        SELECT DISTINCT
             MAIN.CARR_FRT_SRC_TP_NM
            ,MAIN.CARR_FRT_PRFL_NUM
            ,MAIN.TRX_HDR_NUM
            ,MAIN.TRX_REF_NUM_01
            ,MAIN.TRX_REF_NUM_02
            ,MAIN.COA_CMPY_CD
            ,MAIN.COA_BR_CD
            ,MAIN.COA_CC_CD
            ,MAIN.COA_ACCT_CD
            ,MAIN.COA_PROD_CD
            ,MAIN.COA_CH_CD
            ,MAIN.COA_AFFL_CD
            ,MAIN.COA_PROJ_CD
            ,MAIN.CARR_FRT_CHRG_BU_CD
            ,MAIN.CARR_CD
            ,MAIN.INVTY_TRX_DT
            ,MAIN.FROM_POST_CD
            ,MAIN.TO_POST_CD
        FROM (
            SELECT
                 CFSTX.CARR_FRT_SRC_TP_NM              AS CARR_FRT_SRC_TP_NM
                ,CASE WHEN EXISTS
                     (SELECT 1 FROM VAR_CHAR_CONST VCC WHERE VCC.GLBL_CMPY_CD = #glblCmpyCd# AND VCC.VAR_CHAR_CONST_NM = #CTSI_TRF_DT# AND VCC.VAR_CHAR_CONST_VAL IS NOT NULL AND VCC.EZCANCELFLAG = '0')
                 THEN
                     (SELECT VCC.VAR_CHAR_CONST_VAL FROM VAR_CHAR_CONST VCC WHERE VCC.GLBL_CMPY_CD = #glblCmpyCd# AND VCC.VAR_CHAR_CONST_NM = #CTSI_TRF_DT# AND VCC.EZCANCELFLAG = '0')
                 ELSE
                     (SELECT DCC.DS_COND_CONST_VAL_TXT_01 FROM DS_COND_CONST DCC WHERE DCC.GLBL_CMPY_CD = #glblCmpyCd# AND DCC.DS_COND_CONST_GRP_ID = #trfCtsiPrfl# AND SP.LINE_BIZ_TP_CD = DCC.DS_COND_CONST_CD AND DCC.EZCANCELFLAG = '0')
                 END AS CARR_FRT_PRFL_NUM
                ,#orderTRF#                            AS TRX_HDR_NUM
                ,SOC.SO_NUM                            AS TRX_REF_NUM_01
                ,SO.TRX_HDR_NUM                        AS TRX_REF_NUM_02
                ,CFSTX.DEF_COA_CMPY_CD                 AS COA_CMPY_CD
                ,RW.COA_BR_CD                          AS COA_BR_CD
                ,CFSTX.DEF_COA_CC_CD                   AS COA_CC_CD
                ,CFSTX.DEF_COA_ACCT_CD                 AS COA_ACCT_CD
                ,CFSTX.DEF_COA_PROD_CD                 AS COA_PROD_CD
                ,CFSTX.DEF_COA_CH_CD                   AS COA_CH_CD
                ,CFSTX.DEF_COA_AFFL_CD                 AS COA_AFFL_CD
                ,CFSTX.DEF_COA_MDSE_TP_CD              AS COA_PROJ_CD
                ,CFSTX.CARR_FRT_CHRG_BU_CD             AS CARR_FRT_CHRG_BU_CD
                ,CASE
                    WHEN SOCD.VND_CD IS NULL OR SOCD.VND_CD = '*' THEN CFSTX.DEF_CARR_CD
                    WHEN OCV.CARR_CD IS NOT NULL THEN OCV.CARR_CD
                    ELSE SOCD.VND_CD
                 END                                   AS CARR_CD
                ,SOC.SHIP_DT_TM_TS                     AS INVTY_TRX_DT
                ,RW.POST_CD                            AS FROM_POST_CD
                ,CD.SHIP_TO_POST_CD                    AS TO_POST_CD
                ,M.COA_PROD_CD                         AS MDSE_COA_PROD_CD
                ,SOCD.SO_SLP_NUM
            FROM
                 SHPG_ORD_CONF        SOC
                ,SCE_ORD_TP           SOT
                ,RTL_WH               RW
                ,SHPG_ORD             SO
                ,SHPG_ORD_CONF_DTL    SOCD
                ,SHPG_ORD_DTL         SOD
                ,CPO                  C
                ,CPO_DTL              CD
                ,CARR_FRT_SRC_TP_XREF CFSTX
                ,TOC                  T
                ,MDSE                 M
                ,DS_COND_CONST        DCC
                ,DS_ORD_TP            DOT
                ,ORG_FUNC_ASG         OFA
                ,S21_PSN              SP
                ,OTBD_CARR_V          OCV
            WHERE
                SOC.GLBL_CMPY_CD            = #glblCmpyCd#
            AND SOC.SHIP_DT_TM_TS           &gt;= #dsBizLastUpdTs#
            AND SOC.GLBL_CMPY_CD            = SOT.GLBL_CMPY_CD
            AND SOC.SCE_ORD_TP_CD           = SOT.SCE_ORD_TP_CD
            AND SOT.SCE_ORD_TP_CD           = #sceOrdTpCdDt#
            AND SOT.INBD_OTBD_CD            = #inbdOtbdCd#
            AND SOT.NTC_DROP_FLG            = #ntcDropFlg#
            AND SOC.GLBL_CMPY_CD            = RW.GLBL_CMPY_CD
            AND SOC.WH_CD                   = RW.RTL_WH_CD
            AND SOC.GLBL_CMPY_CD            = SO.GLBL_CMPY_CD
            AND SOC.SO_NUM                  = SO.SO_NUM
            AND SO.SHPG_STS_CD              = #shpgStsCd#
            AND SO.GLBL_CMPY_CD             = SOCD.GLBL_CMPY_CD
            AND SO.SO_NUM                   = SOCD.SO_NUM
            AND SOCD.GLBL_CMPY_CD           = SOD.GLBL_CMPY_CD
            AND SOCD.SO_NUM                 = SOD.SO_NUM
            AND SOCD.SO_SLP_NUM             = SOD.SO_SLP_NUM
            AND SO.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
            AND SO.TRX_HDR_NUM              = C.CPO_ORD_NUM
            AND C.GLBL_CMPY_CD              = T.GLBL_CMPY_CD
            AND C.SLS_REP_TOC_CD            = T.TOC_CD
            AND C.GLBL_CMPY_CD              = CD.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM               = CD.CPO_ORD_NUM
            AND SOD.TRX_LINE_NUM            = CD.CPO_DTL_LINE_NUM
            AND SOT.GLBL_CMPY_CD            = CFSTX.GLBL_CMPY_CD
            AND SOT.SCE_ORD_TP_CD           = CFSTX.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD            = CFSTX.INBD_OTBD_CD
            AND SOCD.GLBL_CMPY_CD           = M.GLBL_CMPY_CD
            AND SOCD.MDSE_CD                = M.MDSE_CD
            AND C.GLBL_CMPY_CD              = DCC.GLBL_CMPY_CD
            AND C.DS_ORD_TP_CD              = DCC.DS_COND_CONST_CD
            AND DCC.DS_COND_CONST_GRP_ID    = #batchId#
            AND DCC.GLBL_CMPY_CD            = DOT.GLBL_CMPY_CD
            AND DCC.DS_COND_CONST_CD        = DOT.DS_ORD_TP_CD
            AND T.GLBL_CMPY_CD              = OFA.GLBL_CMPY_CD
            AND T.TOC_CD                    = OFA.TOC_CD
            AND OFA.GLBL_CMPY_CD            = SP.GLBL_CMPY_CD
            AND OFA.PSN_CD                  = SP.PSN_CD
            AND SOCD.GLBL_CMPY_CD           = OCV.GLBL_CMPY_CD(+)
            AND SOCD.VND_CD                 = OCV.CARR_CD(+)
            AND SOC.EZCANCELFLAG            = '0'
            AND SOT.EZCANCELFLAG            = '0'
            AND RW.EZCANCELFLAG             = '0'
            AND SO.EZCANCELFLAG             = '0'
            AND SOCD.EZCANCELFLAG           = '0'
            AND SOD.EZCANCELFLAG            = '0'
            AND C.EZCANCELFLAG              = '0'
            AND CD.EZCANCELFLAG             = '0'
            AND CFSTX.EZCANCELFLAG          = '0'
            AND T.EZCANCELFLAG              = '0'
            AND M.EZCANCELFLAG              = '0'
            AND DCC.EZCANCELFLAG            = '0'
            AND DOT.EZCANCELFLAG            = '0'
            AND OFA.EZCANCELFLAG            = '0'
            AND SP.EZCANCELFLAG             = '0'
            AND OCV.EZCANCELFLAG(+)         = '0'
        ) MAIN
    </statement>

    <statement id="getSoConfirmationTRFIr" parameterClass="Map"  resultClass="Map">
        SELECT DISTINCT
             MAIN.CARR_FRT_SRC_TP_NM
            ,MAIN.CARR_FRT_PRFL_NUM 
            ,MAIN.TRX_HDR_NUM
            ,MAIN.TRX_REF_NUM_01
            ,MAIN.TRX_REF_NUM_02
            ,MAIN.COA_CMPY_CD
            ,MAIN.COA_BR_CD
            ,MAIN.COA_CC_CD
            ,MAIN.COA_ACCT_CD
            ,MAIN.COA_PROD_CD
            ,MAIN.COA_CH_CD
            ,MAIN.COA_AFFL_CD
            ,MAIN.COA_PROJ_CD
            ,MAIN.CARR_FRT_CHRG_BU_CD
            ,MAIN.CARR_CD
            ,MAIN.INVTY_TRX_DT
            ,MAIN.FROM_POST_CD
            ,MAIN.TO_POST_CD
        FROM (
            SELECT
                 CFSTX.CARR_FRT_SRC_TP_NM              AS CARR_FRT_SRC_TP_NM
                ,CASE WHEN EXISTS
                    (SELECT 1 FROM VAR_CHAR_CONST VCC WHERE VCC.GLBL_CMPY_CD = #glblCmpyCd# AND VCC.VAR_CHAR_CONST_NM = #CTSI_TRF_IR# AND VCC.VAR_CHAR_CONST_VAL IS NOT NULL AND VCC.EZCANCELFLAG = '0') 
                 THEN
                    (SELECT VCC.VAR_CHAR_CONST_VAL FROM VAR_CHAR_CONST VCC WHERE VCC.GLBL_CMPY_CD = #glblCmpyCd# AND VCC.VAR_CHAR_CONST_NM = #CTSI_TRF_IR# AND VCC.EZCANCELFLAG = '0')
                 ELSE
                    CFSTX.CARR_FRT_PRFL_NUM
                 END AS CARR_FRT_PRFL_NUM
                ,#orderTRF#                            AS TRX_HDR_NUM
                ,SO.SO_NUM                             AS TRX_REF_NUM_01
                ,SO.SRC_ORD_NUM                        AS TRX_REF_NUM_02
                ,CFSTX.DEF_COA_CMPY_CD                 AS COA_CMPY_CD
                ,RW.COA_BR_CD                          AS COA_BR_CD
                ,CFSTX.DEF_COA_CC_CD                   AS COA_CC_CD
                ,CFSTX.DEF_COA_ACCT_CD                 AS COA_ACCT_CD
                ,CFSTX.DEF_COA_PROD_CD                 AS COA_PROD_CD
                ,CFSTX.DEF_COA_CH_CD                   AS COA_CH_CD
                ,CFSTX.DEF_COA_AFFL_CD                 AS COA_AFFL_CD
                ,CFSTX.DEF_COA_MDSE_TP_CD              AS COA_PROJ_CD
                ,CFSTX.CARR_FRT_CHRG_BU_CD             AS CARR_FRT_CHRG_BU_CD
                ,CASE
                    WHEN SOCD.VND_CD IS NULL OR SOCD.VND_CD = '*' THEN CFSTX.DEF_CARR_CD
                    WHEN OCV.CARR_CD IS NOT NULL THEN OCV.CARR_CD
                    ELSE SOCD.VND_CD
                 END                                   AS CARR_CD
                ,SOC.SHIP_DT_TM_TS                     AS INVTY_TRX_DT
                ,RW.POST_CD                            AS FROM_POST_CD
                ,STC.POST_CD                           AS TO_POST_CD
                ,SOCD.SO_SLP_NUM
            FROM
                 SHPG_ORD_CONF        SOC
                ,SCE_ORD_TP           SOT
                ,RTL_WH               RW
                ,SHPG_ORD             SO
                ,SHPG_ORD_CONF_DTL    SOCD
                ,SHPG_ORD_DTL         SOD
                ,CARR_FRT_SRC_TP_XREF CFSTX
                ,SHIP_TO_CUST         STC
                ,OTBD_CARR_V          OCV
            WHERE
                SOC.GLBL_CMPY_CD         = #glblCmpyCd#
            AND SOC.SHIP_DT_TM_TS        &gt;= #dsBizLastUpdTs#
            AND SOC.GLBL_CMPY_CD         = SOT.GLBL_CMPY_CD
            AND SOC.SCE_ORD_TP_CD        = SOT.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD         = #inbdOtbdCd#
            AND SOT.NTC_DROP_FLG         = #ntcDropFlg#
            AND SOC.GLBL_CMPY_CD         = RW.GLBL_CMPY_CD
            AND SOC.WH_CD                = RW.RTL_WH_CD
            AND SOC.GLBL_CMPY_CD         = SO.GLBL_CMPY_CD
            AND SOC.SO_NUM               = SO.SO_NUM
            AND SO.SHPG_STS_CD           = #shpgStsCd#
            AND SO.GLBL_CMPY_CD          = SOCD.GLBL_CMPY_CD
            AND SO.SO_NUM                = SOCD.SO_NUM
            AND SOCD.GLBL_CMPY_CD        = SOD.GLBL_CMPY_CD
            AND SOCD.SO_NUM              = SOD.SO_NUM
            AND SOCD.SO_SLP_NUM          = SOD.SO_SLP_NUM
            AND SOD.GLBL_CMPY_CD         = STC.GLBL_CMPY_CD
            AND NVL(SOD.SHIP_TO_RTL_WH_CD, SOD.TO_INVTY_LOC_CD) = STC.SHIP_TO_CUST_CD
            AND SOT.GLBL_CMPY_CD         = CFSTX.GLBL_CMPY_CD
            AND SOT.SCE_ORD_TP_CD        = CFSTX.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD         = CFSTX.INBD_OTBD_CD
            AND CFSTX.TRX_REF_NUM_TP_CD_01 = #trxHdrNumTpCd04#
            AND CFSTX.SCE_ORD_TP_CD     != #sceOrdTpCdDt#
            AND SOCD.GLBL_CMPY_CD        = OCV.GLBL_CMPY_CD(+)
            AND SOCD.VND_CD              = OCV.CARR_CD(+)
            AND SOC.EZCANCELFLAG         = '0'
            AND SOT.EZCANCELFLAG         = '0'
            AND RW.EZCANCELFLAG          = '0'
            AND SO.EZCANCELFLAG          = '0'
            AND SOCD.EZCANCELFLAG        = '0'
            AND SOD.EZCANCELFLAG         = '0'
            AND CFSTX.EZCANCELFLAG       = '0'
            AND STC.EZCANCELFLAG         = '0'
            AND OCV.EZCANCELFLAG(+)      = '0'
        ) MAIN
    </statement>

    <statement id="getRwsCompleteRAE" parameterClass="Map"  resultClass="Map">
        SELECT DISTINCT
             MAIN.CARR_FRT_SRC_TP_NM
            ,CASE
                WHEN MAIN.MDSE_COA_MDSE_TP_CD = #machine# AND COA_MDSE_TP_CNT = 1 AND EXISTS( SELECT 1 FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #tds# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD)
                THEN (SELECT CFCPX.CARR_FRT_PRFL_NUM FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #tds# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD)
                WHEN MAIN.MDSE_COA_MDSE_TP_CD = #machine# AND COA_MDSE_TP_CNT = 1 AND EXISTS( SELECT 1 FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #dg# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD) 
                THEN (SELECT CFCPX.CARR_FRT_PRFL_NUM FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #dg# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD)
                ELSE MAIN.CARR_FRT_PRFL_NUM
             END AS CARR_FRT_PRFL_NUM
            ,MAIN.TRX_HDR_NUM
            ,MAIN.TRX_REF_NUM_01
            ,MAIN.TRX_REF_NUM_02
            ,MAIN.COA_CMPY_CD
            ,MAIN.COA_BR_CD
            ,MAIN.COA_CC_CD
            ,MAIN.COA_ACCT_CD
            ,CASE
                WHEN MAIN.MDSE_COA_MDSE_TP_CD = #machine# AND COA_MDSE_TP_CNT = 1 AND EXISTS( SELECT 1 FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #tds# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD)
                THEN #tdsCoaProdCd#
                WHEN MAIN.MDSE_COA_MDSE_TP_CD = #machine# AND COA_MDSE_TP_CNT = 1 AND EXISTS( SELECT 1 FROM CARR_FRT_COA_PROD_XREF CFCPX WHERE CFCPX.GLBL_CMPY_CD = #glblCmpyCd# AND CFCPX.LINE_BIZ_TP_CD = #dg# AND CFCPX.EZCANCELFLAG = '0' AND MAIN.MDSE_COA_PROD_CD = CFCPX.COA_PROD_CD) 
                THEN #dgCoaProdCd#
                ELSE MAIN.DEF_COA_PROD_CD
             END AS COA_PROD_CD
            ,MAIN.COA_CH_CD
            ,MAIN.COA_AFFL_CD
            ,MAIN.COA_PROJ_CD
            ,MAIN.CARR_FRT_CHRG_BU_CD
            ,MAIN.CARR_CD
            ,MAIN.INVTY_TRX_DT
            ,MAIN.FROM_POST_CD
            ,MAIN.TO_POST_CD
        FROM (
            SELECT 
                 CFSTX.CARR_FRT_SRC_TP_NM              AS CARR_FRT_SRC_TP_NM
                ,DCC.DS_COND_CONST_VAL_TXT_01          AS CARR_FRT_PRFL_NUM
                ,#orderRAE#                            AS TRX_HDR_NUM
                <!-- Mod Start 2020/02/21 QC#55942 -->
                <!-- ,RC.RWS_NUM                            AS TRX_REF_NUM_01 -->
                ,RH.RWS_NUM                            AS TRX_REF_NUM_01
                <!-- Mod End 2020/02/21 QC#55942 -->
                ,RH.TRX_ORD_NUM                        AS TRX_REF_NUM_02
                ,CFSTX.DEF_COA_CMPY_CD                 AS COA_CMPY_CD
                ,T.COA_BR_CD                           AS COA_BR_CD
                ,T.COA_CC_CD                           AS COA_CC_CD
                ,DCC.DS_COND_CONST_VAL_TXT_05          AS COA_ACCT_CD
                ,DCC.DS_COND_CONST_VAL_TXT_07          AS COA_CH_CD
                ,DCC.DS_COND_CONST_VAL_TXT_08          AS COA_AFFL_CD
                ,DCC.DS_COND_CONST_VAL_TXT_09          AS COA_PROJ_CD
                ,DCC.DS_COND_CONST_VAL_TXT_10          AS CARR_FRT_CHRG_BU_CD
                ,CASE
                    WHEN RD.CARR_CD IS NULL THEN CFSTX.DEF_CARR_CD
                    WHEN OCV.CARR_CD IS NOT NULL THEN OCV.CARR_CD
                    ELSE RD.CARR_CD
                 END                                   AS CARR_CD
                ,NVL(RD.ACTL_PICK_UP_DT, NVL(RD.SCHD_PICK_UP_DT, NVL(DCRD.RQST_PICK_UP_DT, C.ORD_BOOK_TS)))                     AS INVTY_TRX_DT
                ,RH.FROM_LOC_POST_CD                   AS FROM_POST_CD
                ,RW.POST_CD                            AS TO_POST_CD
                ,DCC.DS_COND_CONST_VAL_TXT_06          AS DEF_COA_PROD_CD
                ,M.COA_PROD_CD                         AS MDSE_COA_PROD_CD
                ,M.COA_MDSE_TP_CD                      AS MDSE_COA_MDSE_TP_CD
                ,CASE 
                    WHEN M.COA_MDSE_TP_CD = #machine# THEN COUNT(M.COA_MDSE_TP_CD) OVER(PARTITION BY RH.RWS_NUM, M.COA_MDSE_TP_CD ORDER BY RH.RWS_NUM) 
                    WHEN (SELECT
                              COUNT(RD.GLBL_CMPY_CD)
                          FROM
                               RWS_DTL RD
                              ,MDSE M
                          WHERE
                              RD.GLBL_CMPY_CD  = #glblCmpyCd#
                          <!-- Mod Start 2020/02/21 QC#55942 -->
                          <!-- AND RD.RWS_NUM       = RC.RWS_NUM -->
                          AND RD.RWS_NUM       = RH.RWS_NUM
                          <!-- Mod End 2020/02/21 QC#55942 -->
                          AND RD.GLBL_CMPY_CD  = M.GLBL_CMPY_CD
                          AND RD.MDSE_CD       = M.MDSE_CD
                          AND M.COA_MDSE_TP_CD = #machine#
                          AND RD.EZCANCELFLAG  = '0'
                          AND M.EZCANCELFLAG   = '0') > 0 THEN 0
                 END AS COA_MDSE_TP_CNT
                ,RD.RWS_DTL_LINE_NUM
            FROM
            <!-- Del Start 2020/02/21 QC#55942 -->
            <!--      RWS_CPLT             RC -->
            <!-- Del End 2020/02/21 QC#55942 -->
                 SCE_ORD_TP           SOT
                ,RTL_WH               RW
                ,RWS_HDR              RH
                ,RWS_DTL              RD
                ,CPO                  C
                ,DS_CPO_RTRN_DTL      DCRD
                ,CARR_FRT_SRC_TP_XREF CFSTX
                ,TOC                  T
                ,MDSE                 M
                ,DS_COND_CONST        DCC
                ,DS_ORD_TP            DOT
                ,OTBD_CARR_V          OCV
            <!-- Mod Start 2020/02/21 QC#55942 -->
            WHERE
            <!--     RC.GLBL_CMPY_CD            = #glblCmpyCd# -->
            <!-- AND RC.RWS_CLO_DT_TM_TS        &gt;= #dsBizLastUpdTs# -->
            <!-- AND RC.GLBL_CMPY_CD            = SOT.GLBL_CMPY_CD -->
            <!-- AND RC.SCE_ORD_TP_CD           = SOT.SCE_ORD_TP_CD -->
                RH.GLBL_CMPY_CD            = #glblCmpyCd#
            <isNotNull property="rwsStsCdList">
            AND <iterate property="rwsStsCdList" var="rwsStsCdList[]" open="RH.RWS_STS_CD IN (" close=")" conjunction=",">
                #rwsStsCdList[]#
                </iterate>
            </isNotNull>
            AND RH.EZINTIME                &gt;= #dsBizLastUpdTs#
            AND RH.GLBL_CMPY_CD            = SOT.GLBL_CMPY_CD
            AND RH.SCE_ORD_TP_CD           = SOT.SCE_ORD_TP_CD
            AND SOT.SCE_ORD_TP_CD          = #sceOrdTpCdRt#
            AND SOT.INBD_OTBD_CD           = #inbdOtbdCd#
            AND SOT.NTC_DROP_FLG           = #ntcDropFlg#
            <!-- AND RC.GLBL_CMPY_CD            = RW.GLBL_CMPY_CD -->
            <!-- AND RC.WH_CD                   = RW.RTL_WH_CD -->
            <!-- AND RC.GLBL_CMPY_CD            = RH.GLBL_CMPY_CD -->
            <!-- AND RC.RWS_NUM                 = RH.RWS_NUM -->
            <!-- AND RH.RWS_STS_CD              = #rwsStsCd# -->
            AND RH.GLBL_CMPY_CD            = RD.GLBL_CMPY_CD
            AND RH.RWS_NUM                 = RD.RWS_NUM
            AND RH.GLBL_CMPY_CD            = C.GLBL_CMPY_CD
            AND RH.TRX_ORD_NUM             = C.CPO_ORD_NUM
            AND RH.GLBL_CMPY_CD            = RW.GLBL_CMPY_CD
            AND RH.WH_CD                   = RW.RTL_WH_CD
            AND C.GLBL_CMPY_CD             = T.GLBL_CMPY_CD
            AND C.SLS_REP_TOC_CD           = T.TOC_CD
            AND C.GLBL_CMPY_CD             = DCRD.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM              = DCRD.CPO_ORD_NUM
            AND RD.TRX_LINE_NUM            = DCRD.DS_CPO_RTRN_LINE_NUM
            AND SOT.GLBL_CMPY_CD           = CFSTX.GLBL_CMPY_CD
            AND SOT.SCE_ORD_TP_CD          = CFSTX.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD           = CFSTX.INBD_OTBD_CD
            AND RD.GLBL_CMPY_CD            = M.GLBL_CMPY_CD
            AND RD.MDSE_CD                 = M.MDSE_CD
            AND C.GLBL_CMPY_CD             = DCC.GLBL_CMPY_CD
            AND C.DS_ORD_TP_CD             = DCC.DS_COND_CONST_CD
            AND DCC.DS_COND_CONST_GRP_ID   = #batchId#
            AND DCC.GLBL_CMPY_CD           = DOT.GLBL_CMPY_CD
            AND DCC.DS_COND_CONST_CD       = DOT.DS_ORD_TP_CD
            AND RD.GLBL_CMPY_CD            = OCV.GLBL_CMPY_CD(+)
            AND RD.CARR_CD                 = OCV.CARR_CD(+)
            <!-- AND RC.EZCANCELFLAG            = '0' -->
            AND SOT.EZCANCELFLAG           = '0'
            AND RW.EZCANCELFLAG            = '0'
            AND RH.EZCANCELFLAG            = '0'
            AND C.EZCANCELFLAG             = '0'
            AND DCRD.EZCANCELFLAG          = '0'
            AND CFSTX.EZCANCELFLAG         = '0'
            AND T.EZCANCELFLAG             = '0'
            AND M.EZCANCELFLAG             = '0'
            AND DCC.EZCANCELFLAG           = '0'
            AND DOT.EZCANCELFLAG           = '0'
            AND OCV.EZCANCELFLAG(+)        = '0'
            <!-- Mod End 2020/02/21 QC#55942 -->
        ) MAIN
    WHERE (COA_MDSE_TP_CNT IS NULL OR COA_MDSE_TP_CNT > 0)
    ORDER BY MAIN.TRX_REF_NUM_01
    </statement>

    <statement id="getRwsCompletePO" parameterClass="Map"  resultClass="Map">
        SELECT DISTINCT
             CASE
                WHEN MDSE_ITEM_TP_CD = #mdseItemTpCdParts# AND RWS_CNT = RWS_MDSE_ITEM_TP_CNT THEN #poPartsSrcNm#
                ELSE #poEquipSrcNm#
             END AS CARR_FRT_SRC_TP_NM
            ,MAIN.CARR_FRT_PRFL_NUM
            ,CASE
                WHEN MDSE_ITEM_TP_CD = #mdseItemTpCdParts# AND RWS_CNT = RWS_MDSE_ITEM_TP_CNT THEN #orderPOP#
                WHEN MDSE_ITEM_TP_CD = #mdseItemTpCdSupply# AND RWS_CNT = RWS_MDSE_ITEM_TP_CNT THEN #orderPOS#
                ELSE #orderPOE#
             END AS TRX_HDR_NUM
            ,MAIN.TRX_REF_NUM_01
            ,MAIN.TRX_REF_NUM_02
            ,MAIN.COA_CMPY_CD
            ,MAIN.COA_BR_CD
            ,MAIN.COA_CC_CD
            ,MAIN.COA_ACCT_CD
            ,MAIN.COA_PROD_CD
            ,MAIN.COA_CH_CD
            ,MAIN.COA_AFFL_CD
            ,MAIN.COA_PROJ_CD
            ,MAIN.CARR_FRT_CHRG_BU_CD
            ,MAIN.CARR_CD
            ,MAIN.INVTY_TRX_DT
            ,MAIN.FROM_POST_CD
            ,MAIN.TO_POST_CD
        FROM (
            SELECT
                 DCC.DS_COND_CONST_VAL_TXT_01          AS CARR_FRT_PRFL_NUM
            <!-- START 2022/03/03 A.Cullano [QC#59776, MOD] -->
            <!-- Mod Start 2020/02/21 QC#55942 -->
            <!-- ,RC.RWS_NUM                           AS TRX_REF_NUM_01 -->
            <!-- ,RH.RWS_NUM                           AS TRX_REF_NUM_01 -->
            <!-- Mod End 2020/02/21 QC#55942 -->
                ,CASE
                    WHEN 
                        (PO.PRNT_VND_CD = #cusaID# AND PO.VND_CD != #cusaPartsID# AND M.MDSE_CATG_CD != #mdseCatgCd#) THEN RH.RWS_REF_NUM
                    ELSE RH.RWS_NUM
                END AS TRX_REF_NUM_01
            <!-- END 2022/03/03 A.Cullano [QC#59776, MOD] -->
                ,RH.PO_RCV_TRX_HDR_NUM                 AS TRX_REF_NUM_02
                ,CFSTX.DEF_COA_CMPY_CD                 AS COA_CMPY_CD
                ,RW.COA_BR_CD                          AS COA_BR_CD
                ,CASE
                    WHEN PO.PRCH_GRP_CD = DCC.DS_COND_CONST_CD THEN DCC.DS_COND_CONST_VAL_TXT_04
                    WHEN DCC.DS_COND_CONST_CD = '*' THEN DCC.DS_COND_CONST_VAL_TXT_04
                    ELSE '491997'
                 END                                   AS COA_CC_CD
                ,CFSTX.DEF_COA_ACCT_CD                 AS COA_ACCT_CD
                ,CASE
                    WHEN PO.PRCH_GRP_CD = DCC.DS_COND_CONST_CD THEN DCC.DS_COND_CONST_VAL_TXT_06
                    WHEN DCC.DS_COND_CONST_CD = '*' THEN DCC.DS_COND_CONST_VAL_TXT_06
                    ELSE 'ZZ'
                 END                                   AS COA_PROD_CD
                ,CFSTX.DEF_COA_CH_CD                   AS COA_CH_CD
                ,CFSTX.DEF_COA_AFFL_CD                 AS COA_AFFL_CD
                ,CFSTX.DEF_COA_MDSE_TP_CD              AS COA_PROJ_CD
                ,CFSTX.CARR_FRT_CHRG_BU_CD             AS CARR_FRT_CHRG_BU_CD
                ,CFSTX.DEF_CARR_CD                     AS CARR_CD
            <!-- Mod Start 2020/02/21 QC#55942 -->
            <!--     ,RC.RWS_CLO_DT_TM_TS                   AS INVTY_TRX_DT -->
                ,RH.EZINTIME                           AS INVTY_TRX_DT
            <!-- Mod End 2020/02/21 QC#55942 -->
                ,RH.FROM_LOC_POST_CD                   AS FROM_POST_CD
                ,RW.POST_CD                            AS TO_POST_CD
                ,M.MDSE_ITEM_TP_CD
            <!-- START 2022/03/03 A.Cullano [QC#59776, MOD] -->
            <!--,COUNT(RPA.RWS_NUM) OVER(PARTITION BY RH.RWS_NUM ORDER BY RH.RWS_NUM) AS RWS_CNT -->
            <!--,COUNT(RPA.RWS_NUM) OVER(PARTITION BY RH.RWS_NUM, M.MDSE_ITEM_TP_CD ORDER BY RH.RWS_NUM) AS RWS_MDSE_ITEM_TP_CNT -->
                ,COUNT(RDTL.RWS_NUM) OVER(PARTITION BY RH.RWS_NUM ORDER BY RH.RWS_NUM) AS RWS_CNT
                ,COUNT(RDTL.RWS_NUM) OVER(PARTITION BY RH.RWS_NUM, M.MDSE_ITEM_TP_CD ORDER BY RH.RWS_NUM) AS RWS_MDSE_ITEM_TP_CNT
            <!-- END 2022/03/03 A.Cullano [QC#59776, MOD] -->
            <!-- Del Start 2020/02/21 QC#55942 -->
            <!--     ,RPA.RWS_DTL_LINE_NUM -->
            <!-- Del End 2020/02/21 QC#55942 -->
                ,PO.PRCH_GRP_CD
            FROM
            <!-- Del Start 2020/02/21 QC#55942 -->
            <!--      RWS_CPLT             RC -->
            <!-- Del End 2020/02/21 QC#55942 -->
                 SCE_ORD_TP           SOT
                ,RWS_HDR              RH
                ,CARR_FRT_SRC_TP_XREF CFSTX
                ,RTL_WH               RW
                ,PO                   PO
            <!-- START 2022/03/03 A.Cullano [QC#59776, MOD] -->
            <!--,RWS_PUT_AWAY         RPA -->
                ,RWS_DTL              RDTL
            <!-- END 2022/03/03 A.Cullano [QC#59776, MOD] -->
                ,MDSE                 M
                ,DS_COND_CONST        DCC
            <!-- Mod Start 2020/02/21 QC#55942 -->
            WHERE
            <!--     RC.GLBL_CMPY_CD            = #glblCmpyCd# -->
            <!-- AND RC.RWS_CLO_DT_TM_TS        &gt;= #dsBizLastUpdTs# -->
            <!-- AND RC.GLBL_CMPY_CD            = SOT.GLBL_CMPY_CD -->
            <!-- AND RC.SCE_ORD_TP_CD           = SOT.SCE_ORD_TP_CD -->
                RH.GLBL_CMPY_CD            = #glblCmpyCd#
            <isNotNull property="rwsStsCdList">
            AND <iterate property="rwsStsCdList" var="rwsStsCdList[]" open="RH.RWS_STS_CD IN (" close=")" conjunction=",">
                #rwsStsCdList[]#
                </iterate>
            </isNotNull>
            AND RH.EZINTIME                &gt;= #dsBizLastUpdTs#
            AND RH.GLBL_CMPY_CD            = SOT.GLBL_CMPY_CD
            AND RH.SCE_ORD_TP_CD           = SOT.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD           = #inbdOtbdCd#
            AND SOT.NTC_DROP_FLG           = #ntcDropFlg#
            <!-- AND RC.GLBL_CMPY_CD            = RH.GLBL_CMPY_CD -->
            <!-- AND RC.RWS_NUM                 = RH.RWS_NUM -->
            <!-- AND RH.RWS_STS_CD              = #rwsStsCd# -->
            AND RH.GLBL_CMPY_CD            = CFSTX.GLBL_CMPY_CD
            AND RH.SCE_ORD_TP_CD           = CFSTX.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD           = CFSTX.INBD_OTBD_CD
            AND CFSTX.TRX_HDR_NUM_TP_CD    = #trxHdrNumTpCdPO#
            <!-- AND RC.GLBL_CMPY_CD            = RW.GLBL_CMPY_CD -->
            <!-- AND RC.WH_CD                   = RW.RTL_WH_CD -->
            AND RH.GLBL_CMPY_CD            = RW.GLBL_CMPY_CD
            AND RH.WH_CD                   = RW.RTL_WH_CD
            AND RW.RTL_WH_CATG_CD         != #dummy#
            AND RH.GLBL_CMPY_CD            = PO.GLBL_CMPY_CD
            AND RH.SRC_ORD_NUM             = PO.PO_ORD_NUM
            <!-- START 2022/03/03 A.Cullano [QC#59776, MOD] -->
            <!-- AND RH.GLBL_CMPY_CD            = RPA.GLBL_CMPY_CD(+) -->
            <!-- AND RH.RWS_NUM                 = RPA.RWS_NUM(+) -->
            <!-- AND RPA.GLBL_CMPY_CD           = M.GLBL_CMPY_CD(+) -->
            <!-- AND RPA.MDSE_CD                = M.MDSE_CD(+) -->
            AND RH.GLBL_CMPY_CD            = RDTL.GLBL_CMPY_CD(+)
            AND RH.RWS_NUM                 = RDTL.RWS_NUM(+)
            AND RDTL.GLBL_CMPY_CD          = M.GLBL_CMPY_CD(+)
            AND RDTL.MDSE_CD               = M.MDSE_CD(+)
            <!-- END 2022/03/03 A.Cullano [QC#59776, MOD] -->
            AND PO.GLBL_CMPY_CD            = DCC.GLBL_CMPY_CD
            AND PO.PRCH_GRP_CD             = DCC.DS_COND_CONST_CD
            AND DCC.DS_COND_CONST_GRP_ID   = #poGroupId#
            <!-- AND RC.EZCANCELFLAG            = '0' -->
            AND SOT.EZCANCELFLAG           = '0'
            AND RH.EZCANCELFLAG            = '0'
            AND CFSTX.EZCANCELFLAG         = '0'
            AND RW.EZCANCELFLAG            = '0'
            AND PO.EZCANCELFLAG            = '0'
            <!-- START 2022/03/03 A.Cullano [QC#59776, MOD] -->
            <!-- AND RPA.EZCANCELFLAG(+)        = '0' -->
            AND RDTL.EZCANCELFLAG(+)       = '0'
            <!-- END 2022/03/03 A.Cullano [QC#59776, MOD] -->
            AND M.EZCANCELFLAG(+)          = '0'
            AND DCC.EZCANCELFLAG           = '0'
            <!-- Mod End 2020/02/21 QC#55942 -->
        ) MAIN
    </statement>

    <statement id="getWarningReport" parameterClass="Map"  resultClass="Map">
        WITH NOT_DS_ORD_TP AS(
            SELECT
                 GLBL_CMPY_CD
                ,DS_ORD_TP_CD
            FROM
                DS_ORD_TP DOT
            WHERE
                DOT.GLBL_CMPY_CD = #glblCmpyCd#
        AND NOT EXISTS(
            SELECT
                1
            FROM
                DS_COND_CONST DCC
            WHERE
                DCC.GLBL_CMPY_CD         = DOT.GLBL_CMPY_CD
            AND DCC.DS_COND_CONST_CD     = DOT.DS_ORD_TP_CD
            AND DCC.DS_COND_CONST_GRP_ID = #batchId#
            AND DCC.EZCANCELFLAG         = '0'
            )
        )
        SELECT DISTINCT
             MAIN.CARR_FRT_SRC_TP_NM
            ,MAIN.TRX_HDR_NUM  AS DATA_SOURCE
            ,MAIN.DS_ORD_TP_CD AS ORD_TP_CD
            ,MAIN.DS_ORD_TP_NM AS ORD_TP_NM
            ,MAIN.SO_NUM       AS CBS_REF_NUM_01
        FROM (
            SELECT
                CFSTX.CARR_FRT_SRC_TP_NM AS CARR_FRT_SRC_TP_NM
                ,#orderSSO#              AS TRX_HDR_NUM
                ,DOT.DS_ORD_TP_CD
                ,DOT.DS_ORD_TP_NM
                ,SOC.SO_NUM
                ,CASE 
                    WHEN M.COA_MDSE_TP_CD = #machine# THEN COUNT(M.COA_MDSE_TP_CD) OVER(PARTITION BY SO.SO_NUM, M.COA_MDSE_TP_CD ORDER BY SO.SO_NUM) 
                    WHEN (
                        SELECT /*+ INDEX(M MDSE_PK) */ 
                            COUNT(SOCD.GLBL_CMPY_CD)
                        FROM
                             SHPG_ORD_CONF_DTL SOCD
                            ,MDSE M
                        WHERE
                            SOCD.GLBL_CMPY_CD = #glblCmpyCd#
                        AND SOCD.SO_NUM       = SOC.SO_NUM
                        AND SOCD.GLBL_CMPY_CD = M.GLBL_CMPY_CD
                        AND SOCD.MDSE_CD      = M.MDSE_CD
                        AND M.COA_MDSE_TP_CD  = #machine#
                        AND SOCD.EZCANCELFLAG = '0'
                        AND M.EZCANCELFLAG    = '0'
                        ) > 0 THEN 0
                    END                  AS COA_MDSE_TP_CNT
            FROM
                 SHPG_ORD_CONF        SOC
                ,SCE_ORD_TP           SOT
                ,RTL_WH               RW
                ,SHPG_ORD             SO
                ,SHPG_ORD_CONF_DTL    SOCD
                ,SHPG_ORD_DTL         SOD
                ,CPO                  C
                ,CPO_DTL              CD
                ,CARR_FRT_SRC_TP_XREF CFSTX
                ,TOC                  T
                ,MDSE                 M
                ,NOT_DS_ORD_TP        NDOT
                ,DS_ORD_TP            DOT
                ,OTBD_CARR_V          OCV
            WHERE
                SOC.GLBL_CMPY_CD            = #glblCmpyCd#
            AND SOC.SHIP_DT_TM_TS       &gt;= #dsBizLastUpdTs#
            AND SOC.GLBL_CMPY_CD            = SOT.GLBL_CMPY_CD
            AND SOC.SCE_ORD_TP_CD           = SOT.SCE_ORD_TP_CD
            AND SOT.SCE_ORD_TP_CD           = #sceOrdTpCdRS#
            AND SOT.INBD_OTBD_CD            = #otbdCd#
            AND SOT.NTC_DROP_FLG            = #ntcDropFlg#
            AND SOC.GLBL_CMPY_CD            = RW.GLBL_CMPY_CD
            AND SOC.WH_CD                   = RW.RTL_WH_CD
            AND RW.RTL_WH_CATG_CD          != #dummy#
            AND SOC.GLBL_CMPY_CD            = SO.GLBL_CMPY_CD
            AND SOC.SO_NUM                  = SO.SO_NUM
            AND SO.SHPG_STS_CD              = #shpgStsCd#
            AND SO.GLBL_CMPY_CD             = SOCD.GLBL_CMPY_CD
            AND SO.SO_NUM                   = SOCD.SO_NUM
            AND SOCD.GLBL_CMPY_CD           = SOD.GLBL_CMPY_CD
            AND SOCD.SO_NUM                 = SOD.SO_NUM
            AND SOCD.SO_SLP_NUM             = SOD.SO_SLP_NUM
            AND SO.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
            AND SO.TRX_HDR_NUM              = C.CPO_ORD_NUM
            AND C.GLBL_CMPY_CD              = T.GLBL_CMPY_CD
            AND C.SLS_REP_TOC_CD            = T.TOC_CD
            AND C.GLBL_CMPY_CD              = CD.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM               = CD.CPO_ORD_NUM
            AND SOD.TRX_LINE_NUM            = CD.CPO_DTL_LINE_NUM
            AND SOT.GLBL_CMPY_CD            = CFSTX.GLBL_CMPY_CD
            AND SOT.SCE_ORD_TP_CD           = CFSTX.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD            = CFSTX.INBD_OTBD_CD
            AND CFSTX.DROP_SHIP_WH_CD       IS NULL
            AND SOCD.GLBL_CMPY_CD           = M.GLBL_CMPY_CD
            AND SOCD.MDSE_CD                = M.MDSE_CD
            AND C.GLBL_CMPY_CD              = NDOT.GLBL_CMPY_CD
            AND C.DS_ORD_TP_CD              = NDOT.DS_ORD_TP_CD
            AND DOT.GLBL_CMPY_CD            = NDOT.GLBL_CMPY_CD
            AND DOT.DS_ORD_TP_CD            = NDOT.DS_ORD_TP_CD
            AND SOCD.GLBL_CMPY_CD           = OCV.GLBL_CMPY_CD(+)
            AND SOCD.VND_CD                 = OCV.CARR_CD(+)
            AND SOC.EZCANCELFLAG            = '0'
            AND SOT.EZCANCELFLAG            = '0'
            AND RW.EZCANCELFLAG             = '0'
            AND SO.EZCANCELFLAG             = '0'
            AND SOCD.EZCANCELFLAG           = '0'
            AND SOD.EZCANCELFLAG            = '0'
            AND C.EZCANCELFLAG              = '0'
            AND CD.EZCANCELFLAG             = '0'
            AND CFSTX.EZCANCELFLAG          = '0'
            AND T.EZCANCELFLAG              = '0'
            AND M.EZCANCELFLAG              = '0'
            AND DOT.EZCANCELFLAG            = '0'
            AND OCV.EZCANCELFLAG(+)         = '0'
        ) MAIN
            WHERE (COA_MDSE_TP_CNT IS NULL OR COA_MDSE_TP_CNT > 0)
        UNION ALL
        SELECT DISTINCT
             MAIN.CARR_FRT_SRC_TP_NM
            ,MAIN.TRX_HDR_NUM
            ,MAIN.DS_ORD_TP_CD
            ,MAIN.DS_ORD_TP_NM
            ,MAIN.CBS_REF_NUM_01
        FROM (
            SELECT
                 CFSTX.CARR_FRT_SRC_TP_NM    AS CARR_FRT_SRC_TP_NM
                ,#orderSSD#                  AS TRX_HDR_NUM
                ,DOT.DS_ORD_TP_CD
                ,DOT.DS_ORD_TP_NM
                ,SO.TRX_HDR_NUM              AS CBS_REF_NUM_01
                ,CASE 
                    WHEN M.COA_MDSE_TP_CD = #machine# THEN COUNT(M.COA_MDSE_TP_CD) OVER(PARTITION BY SO.SO_NUM, M.COA_MDSE_TP_CD ORDER BY SO.SO_NUM) 
                    WHEN (
                        SELECT /*+ INDEX(M MDSE_PK) */
                            COUNT(SOCD.GLBL_CMPY_CD)
                        FROM
                             SHPG_ORD_CONF_DTL SOCD
                            ,MDSE              M
                        WHERE
                            SOCD.GLBL_CMPY_CD = #glblCmpyCd#
                        AND SOCD.SO_NUM       = SOC.SO_NUM
                        AND SOCD.GLBL_CMPY_CD = M.GLBL_CMPY_CD
                        AND SOCD.MDSE_CD      = M.MDSE_CD
                        AND M.COA_MDSE_TP_CD  = #machine#
                        AND SOCD.EZCANCELFLAG = '0'
                        AND M.EZCANCELFLAG    = '0'
                    ) > 0 THEN 0
                END AS COA_MDSE_TP_CNT
            FROM
                 SHPG_ORD_CONF        SOC
                ,SCE_ORD_TP           SOT
                ,RTL_WH               RW
                ,SHPG_ORD             SO
                ,SHPG_ORD_CONF_DTL    SOCD
                ,SHPG_ORD_DTL         SOD
                ,CPO                  C
                ,CPO_DTL              CD
                ,CARR_FRT_SRC_TP_XREF CFSTX
                ,TOC                  T
                ,MDSE                 M
                ,PO_DTL               PD
                ,NOT_DS_ORD_TP        NDOT
                ,DS_ORD_TP            DOT
                ,OTBD_CARR_V          OCV
            WHERE
                SOC.GLBL_CMPY_CD         = #glblCmpyCd#
            AND SOC.SHIP_DT_TM_TS    &gt;= #dsBizLastUpdTs#
            AND SOC.GLBL_CMPY_CD         = SOT.GLBL_CMPY_CD
            AND SOC.SCE_ORD_TP_CD        = SOT.SCE_ORD_TP_CD
            AND SOT.SCE_ORD_TP_CD        = #sceOrdTpCdRS#
            AND SOT.INBD_OTBD_CD         = #otbdCd#
            AND SOT.NTC_DROP_FLG         = #ntcDropFlg#
            AND SOC.GLBL_CMPY_CD         = RW.GLBL_CMPY_CD
            AND SOC.WH_CD                = RW.RTL_WH_CD
            AND SOC.GLBL_CMPY_CD         = SO.GLBL_CMPY_CD
            AND SOC.SO_NUM               = SO.SO_NUM
            AND SO.SHPG_STS_CD           = #shpgStsCd#
            AND SO.GLBL_CMPY_CD          = SOCD.GLBL_CMPY_CD
            AND SO.SO_NUM                = SOCD.SO_NUM
            AND SOCD.GLBL_CMPY_CD        = SOD.GLBL_CMPY_CD
            AND SOCD.SO_NUM              = SOD.SO_NUM
            AND SOCD.SO_SLP_NUM          = SOD.SO_SLP_NUM
            AND SO.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND SO.TRX_HDR_NUM           = C.CPO_ORD_NUM
            AND C.GLBL_CMPY_CD           = T.GLBL_CMPY_CD
            AND C.SLS_REP_TOC_CD         = T.TOC_CD
            AND C.GLBL_CMPY_CD           = CD.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM            = CD.CPO_ORD_NUM
            AND SOD.TRX_LINE_NUM         = CD.CPO_DTL_LINE_NUM
            AND SOT.GLBL_CMPY_CD         = CFSTX.GLBL_CMPY_CD
            AND SOT.SCE_ORD_TP_CD        = CFSTX.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD         = CFSTX.INBD_OTBD_CD
            AND SOC.WH_CD                = CFSTX.DROP_SHIP_WH_CD
            AND SOCD.GLBL_CMPY_CD        = M.GLBL_CMPY_CD
            AND SOCD.MDSE_CD             = M.MDSE_CD
            AND C.GLBL_CMPY_CD           = PD.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM            = PD.CPO_ORD_NUM
            AND CD.CPO_DTL_LINE_NUM      = PD.CPO_DTL_LINE_NUM
            AND C.GLBL_CMPY_CD           = NDOT.GLBL_CMPY_CD
            AND C.DS_ORD_TP_CD           = NDOT.DS_ORD_TP_CD
            AND DOT.GLBL_CMPY_CD         = NDOT.GLBL_CMPY_CD
            AND DOT.DS_ORD_TP_CD         = NDOT.DS_ORD_TP_CD
            AND SOCD.GLBL_CMPY_CD        = OCV.GLBL_CMPY_CD(+)
            AND SOCD.VND_CD              = OCV.CARR_CD(+)
            AND SOC.EZCANCELFLAG         = '0'
            AND SOT.EZCANCELFLAG         = '0'
            AND RW.EZCANCELFLAG          = '0'
            AND SO.EZCANCELFLAG          = '0'
            AND SOCD.EZCANCELFLAG        = '0'
            AND SOD.EZCANCELFLAG         = '0'
            AND C.EZCANCELFLAG           = '0'
            AND CD.EZCANCELFLAG          = '0'
            AND CFSTX.EZCANCELFLAG       = '0'
            AND T.EZCANCELFLAG           = '0'
            AND M.EZCANCELFLAG           = '0'
            AND PD.EZCANCELFLAG          = '0'
            AND DOT.EZCANCELFLAG         = '0'
            AND OCV.EZCANCELFLAG(+)      = '0'
        ) MAIN
            WHERE (COA_MDSE_TP_CNT IS NULL OR COA_MDSE_TP_CNT > 0)
        UNION ALL
        SELECT DISTINCT
             MAIN.CARR_FRT_SRC_TP_NM
            ,MAIN.TRX_HDR_NUM
            ,MAIN.DS_ORD_TP_CD
            ,MAIN.DS_ORD_TP_NM
            ,MAIN.RWS_NUM
        FROM (
            SELECT 
                 CFSTX.CARR_FRT_SRC_TP_NM AS CARR_FRT_SRC_TP_NM
                ,#orderRAE#               AS TRX_HDR_NUM
                ,DOT.DS_ORD_TP_CD
                ,DOT.DS_ORD_TP_NM
            <!-- Mod Start 2020/02/21 QC#55942 -->
            <!--     ,RC.RWS_NUM -->
                ,RH.RWS_NUM
            <!-- Mod End 2020/02/21 QC#55942 -->
                ,CASE 
                    WHEN M.COA_MDSE_TP_CD = #machine# THEN COUNT(M.COA_MDSE_TP_CD) OVER(PARTITION BY RH.RWS_NUM, M.COA_MDSE_TP_CD ORDER BY RH.RWS_NUM) 
                    WHEN (
                        SELECT
                            COUNT(RD.GLBL_CMPY_CD)
                        FROM
                             RWS_DTL RD
                            ,MDSE    M
                        WHERE
                            RD.GLBL_CMPY_CD  = #glblCmpyCd#
                        <!-- Mod Start 2020/02/21 QC#55942 -->
                        <!-- AND RD.RWS_NUM       = RC.RWS_NUM -->
                        AND RD.RWS_NUM       = RH.RWS_NUM
                        <!-- Mod End 2020/02/21 QC#55942 -->
                        AND RD.GLBL_CMPY_CD  = M.GLBL_CMPY_CD
                        AND RD.MDSE_CD       = M.MDSE_CD
                        AND M.COA_MDSE_TP_CD = #machine#
                        AND RD.EZCANCELFLAG  = '0'
                        AND M.EZCANCELFLAG   = '0'
                        ) > 0 THEN 0
                 END AS COA_MDSE_TP_CNT
                ,RD.RWS_DTL_LINE_NUM
            FROM
            <!-- Del Start 2020/02/21 QC#55942 -->
            <!--      RWS_CPLT             RC -->
            <!-- Del End 2020/02/21 QC#55942 -->
                 SCE_ORD_TP           SOT
                ,RTL_WH               RW
                ,RWS_HDR              RH
                ,RWS_DTL              RD
                ,CPO                  C
                ,DS_CPO_RTRN_DTL      DCRD
                ,CARR_FRT_SRC_TP_XREF CFSTX
                ,TOC                  T
                ,MDSE                 M
                ,NOT_DS_ORD_TP        NDOT
                ,DS_ORD_TP            DOT
                ,OTBD_CARR_V          OCV
            <!-- Mod Start 2020/02/21 QC#55942 -->
            WHERE
            <!--     RC.GLBL_CMPY_CD            = #glblCmpyCd# -->
            <!-- AND RC.RWS_CLO_DT_TM_TS    &gt;= #dsBizLastUpdTs# -->
            <!-- AND RC.GLBL_CMPY_CD            = SOT.GLBL_CMPY_CD -->
            <!-- AND RC.SCE_ORD_TP_CD           = SOT.SCE_ORD_TP_CD -->
                RH.GLBL_CMPY_CD            = #glblCmpyCd#
            <isNotNull property="rwsStsCdList">
            AND <iterate property="rwsStsCdList" var="rwsStsCdList[]" open="RH.RWS_STS_CD IN (" close=")" conjunction=",">
                #rwsStsCdList[]#
                </iterate>
            </isNotNull>
            AND RH.EZINTIME                &gt;= #dsBizLastUpdTs#
            AND SOT.SCE_ORD_TP_CD          = #sceOrdTpCdRt#
            AND SOT.INBD_OTBD_CD           = #inbdCd#
            AND SOT.NTC_DROP_FLG           = #ntcDropFlg#
            <!-- AND RC.GLBL_CMPY_CD            = RW.GLBL_CMPY_CD -->
            <!-- AND RC.WH_CD                   = RW.RTL_WH_CD -->
            <!-- AND RC.GLBL_CMPY_CD            = RH.GLBL_CMPY_CD -->
            <!-- AND RC.RWS_NUM                 = RH.RWS_NUM -->
            <!-- AND RH.RWS_STS_CD              = #rwsStsCd# -->
            AND RH.GLBL_CMPY_CD            = RW.GLBL_CMPY_CD
            AND RH.WH_CD                   = RW.RTL_WH_CD
            AND RH.GLBL_CMPY_CD            = RD.GLBL_CMPY_CD
            AND RH.RWS_NUM                 = RD.RWS_NUM
            AND RH.GLBL_CMPY_CD            = C.GLBL_CMPY_CD
            AND RH.TRX_ORD_NUM             = C.CPO_ORD_NUM
            AND C.GLBL_CMPY_CD             = T.GLBL_CMPY_CD
            AND C.SLS_REP_TOC_CD           = T.TOC_CD
            AND C.GLBL_CMPY_CD             = DCRD.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM              = DCRD.CPO_ORD_NUM
            AND RD.TRX_LINE_NUM            = DCRD.DS_CPO_RTRN_LINE_NUM
            AND SOT.GLBL_CMPY_CD           = CFSTX.GLBL_CMPY_CD
            AND SOT.SCE_ORD_TP_CD          = CFSTX.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD           = CFSTX.INBD_OTBD_CD
            AND RD.GLBL_CMPY_CD            = M.GLBL_CMPY_CD
            AND RD.MDSE_CD                 = M.MDSE_CD
            AND C.GLBL_CMPY_CD             = NDOT.GLBL_CMPY_CD
            AND C.DS_ORD_TP_CD             = NDOT.DS_ORD_TP_CD
            AND DOT.GLBL_CMPY_CD           = NDOT.GLBL_CMPY_CD
            AND DOT.DS_ORD_TP_CD           = NDOT.DS_ORD_TP_CD
            AND RD.GLBL_CMPY_CD            = OCV.GLBL_CMPY_CD(+)
            AND RD.CARR_CD                 = OCV.CARR_CD(+)
            <!-- AND RC.EZCANCELFLAG            = '0' -->
            AND SOT.EZCANCELFLAG           = '0'
            AND RW.EZCANCELFLAG            = '0'
            AND RH.EZCANCELFLAG            = '0'
            AND C.EZCANCELFLAG             = '0'
            AND DCRD.EZCANCELFLAG          = '0'
            AND CFSTX.EZCANCELFLAG         = '0'
            AND T.EZCANCELFLAG             = '0'
            AND M.EZCANCELFLAG             = '0'
            AND DOT.EZCANCELFLAG           = '0'
            AND OCV.EZCANCELFLAG(+)        = '0'
            <!-- Mod End 2020/02/21 QC#55942 -->
        ) MAIN
            WHERE (COA_MDSE_TP_CNT IS NULL OR COA_MDSE_TP_CNT > 0)
        UNION ALL
        SELECT DISTINCT
             CASE
                WHEN MDSE_ITEM_TP_CD = #mdseItemTpCdParts# AND RWS_CNT = RWS_MDSE_ITEM_TP_CNT THEN #poPartsSrcNm#
                ELSE #poEquipSrcNm#
             END AS CARR_FRT_SRC_TP_NM
            ,CASE
                WHEN MDSE_ITEM_TP_CD = #mdseItemTpCdParts# AND RWS_CNT = RWS_MDSE_ITEM_TP_CNT THEN #orderPOP#
                WHEN MDSE_ITEM_TP_CD = #mdseItemTpCdSupply# AND RWS_CNT = RWS_MDSE_ITEM_TP_CNT THEN #orderPOS#
                ELSE #orderPOE#
             END AS TRX_HDR_NUM
            ,MAIN.PRCH_GRP_CD
            ,MAIN.PRCH_GRP_NM
            ,MAIN.RWS_NUM
        FROM (
            SELECT
                 DCC.PRCH_GRP_CD
                ,DCC.PRCH_GRP_NM
            <!-- Mod Start 2020/02/21 QC#55942 -->
            <!--     ,RC.RWS_NUM --> 
                ,RH.RWS_NUM 
            <!-- Mod End 2020/02/21 QC#55942 -->
                ,M.MDSE_ITEM_TP_CD
                ,COUNT(RPA.RWS_NUM) OVER(PARTITION BY RH.RWS_NUM ORDER BY RH.RWS_NUM) AS RWS_CNT
                ,COUNT(RPA.RWS_NUM) OVER(PARTITION BY RH.RWS_NUM, M.MDSE_ITEM_TP_CD ORDER BY RH.RWS_NUM) AS RWS_MDSE_ITEM_TP_CNT
            FROM
            <!-- Del Start 2020/02/21 QC#55942 -->
            <!--      RWS_CPLT             RC -->
            <!-- Del End 2020/02/21 QC#55942 -->
                 SCE_ORD_TP           SOT
                ,RWS_HDR              RH
                ,CARR_FRT_SRC_TP_XREF CFSTX
                ,RTL_WH               RW
                ,PO                   PO
                ,RWS_PUT_AWAY         RPA
                ,MDSE                 M
                ,(
                    SELECT
                         GLBL_CMPY_CD
                        ,PRCH_GRP_CD
                        ,PRCH_GRP_NM
                    FROM
                        PRCH_GRP PG
                    WHERE
                        PG.GLBL_CMPY_CD = #glblCmpyCd#
                    AND NOT EXISTS(
                        SELECT
                            1
                        FROM
                            DS_COND_CONST DCC
                        WHERE
                            DCC.GLBL_CMPY_CD         = PG.GLBL_CMPY_CD
                        AND DCC.DS_COND_CONST_CD     = PG.PRCH_GRP_CD
                        AND DCC.DS_COND_CONST_GRP_ID = #poGroupId#
                        AND DCC.EZCANCELFLAG         = '0'
                    )
                ) DCC
            <!-- Mod Start 2020/02/21 QC#55942 -->
            WHERE
            <!--     RC.GLBL_CMPY_CD            = #glblCmpyCd# -->
            <!-- AND RC.RWS_CLO_DT_TM_TS        &gt;= #dsBizLastUpdTs# -->
            <!-- AND RC.GLBL_CMPY_CD            = SOT.GLBL_CMPY_CD -->
            <!-- AND RC.SCE_ORD_TP_CD           = SOT.SCE_ORD_TP_CD -->
                RH.GLBL_CMPY_CD            = #glblCmpyCd#
            <isNotNull property="rwsStsCdList">
            AND <iterate property="rwsStsCdList" var="rwsStsCdList[]" open="RH.RWS_STS_CD IN (" close=")" conjunction=",">
                #rwsStsCdList[]#
                </iterate>
            </isNotNull>
            AND RH.EZINTIME                &gt;= #dsBizLastUpdTs#
            AND RH.GLBL_CMPY_CD            = SOT.GLBL_CMPY_CD
            AND RH.SCE_ORD_TP_CD           = SOT.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD           = #inbdCd#
            AND SOT.NTC_DROP_FLG           = #ntcDropFlg#
            <!-- AND RC.GLBL_CMPY_CD            = RH.GLBL_CMPY_CD -->
            <!-- AND RC.RWS_NUM                 = RH.RWS_NUM -->
            <!-- AND RH.RWS_STS_CD              = #rwsStsCd# -->
            AND RH.GLBL_CMPY_CD            = CFSTX.GLBL_CMPY_CD
            AND RH.SCE_ORD_TP_CD           = CFSTX.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD           = CFSTX.INBD_OTBD_CD
            AND CFSTX.TRX_HDR_NUM_TP_CD    = #trxHdrNumTpCdPO#
            <!-- AND RC.GLBL_CMPY_CD            = RW.GLBL_CMPY_CD -->
            <!-- AND RC.WH_CD                   = RW.RTL_WH_CD -->
            AND RH.GLBL_CMPY_CD            = RW.GLBL_CMPY_CD
            AND RH.WH_CD                   = RW.RTL_WH_CD
            AND RW.RTL_WH_CATG_CD         != #dummy#
            AND RH.GLBL_CMPY_CD            = PO.GLBL_CMPY_CD
            AND RH.SRC_ORD_NUM             = PO.PO_ORD_NUM
            AND RH.GLBL_CMPY_CD            = RPA.GLBL_CMPY_CD(+)
            AND RH.RWS_NUM                 = RPA.RWS_NUM(+)
            AND RPA.GLBL_CMPY_CD           = M.GLBL_CMPY_CD(+)
            AND RPA.MDSE_CD                = M.MDSE_CD(+)
            AND PO.GLBL_CMPY_CD            = DCC.GLBL_CMPY_CD
            AND PO.PRCH_GRP_CD             = DCC.PRCH_GRP_CD
            <!-- AND RC.EZCANCELFLAG            = '0' -->
            AND SOT.EZCANCELFLAG           = '0'
            AND RH.EZCANCELFLAG            = '0'
            AND CFSTX.EZCANCELFLAG         = '0'
            AND RW.EZCANCELFLAG            = '0'
            AND PO.EZCANCELFLAG            = '0'
            AND RPA.EZCANCELFLAG(+)        = '0'
            AND M.EZCANCELFLAG(+)          = '0'
            <!-- Mod End 2020/02/21 QC#55942 -->
        ) MAIN
        ORDER BY 
             1
            ,2
            ,3
            ,5
    </statement>

</sqlMap>
