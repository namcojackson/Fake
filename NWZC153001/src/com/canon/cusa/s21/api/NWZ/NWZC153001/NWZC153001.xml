<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWZC153001">

    <typeAlias alias="DS_CPO_RTRN_PRC_DTLTMsg"           type="business.db.DS_CPO_RTRN_PRC_DTLTMsg"/>
    <typeAlias alias="SVC_MACH_MSTR_HISTTMsg"           type="business.db.SVC_MACH_MSTR_HISTTMsg"/>

    <!-- #################### Statement #################### --> 
    <statement id="getCntOpenOrdDtl" parameterClass="Map" resultMap="Integer">
        SELECT
            COUNT(*)
        FROM
            CPO_DTL CD
        WHERE
            CD.GLBL_CMPY_CD =  #glblCmpyCd#
        AND CD.CPO_ORD_NUM  =  #ordNum#
        AND (
                CD.ORD_LINE_STS_CD !=  #cancelSts#
            OR
                CD.ORD_LINE_STS_CD !=  #closeSts#
            )
        AND EZCANCELFLAG    =  0
    </statement>

    <statement id="getBizProcLogPk" parameterClass="Map" resultMap="BigDecimal">
        SELECT	
            A.BIZ_PROC_LOG_PK
        FROM
            BIZ_PROC_LOG A
        WHERE
            A.PRNT_DOC_ID  =  #parentDocID#
        AND A.DOC_ID       IS NULL
        AND A.SUB_SYS_ID   =  #subSysID#
        AND A.PROC_ID      =  #procID#
        AND A.DOC_TP_CD    =  #docTpCd#
        AND ROWNUM         =  #rowNumOne#
    </statement>

    <statement id="getMaxBizProcLogPkForHdr" parameterClass="Map" resultMap="BigDecimal">
        SELECT
            MAX(BPL.BIZ_PROC_LOG_PK)     AS    BIZ_PROC_LOG_PK
        FROM
            BIZ_PROC_LOG  BPL
         ,  CPO C
        WHERE
            BPL.PRNT_DOC_ID              =     #parentDocID#
        AND BPL.EVENT_ID                 =     #eventID#
        AND BPL.DOC_ID                   IS    NULL
        AND BPL.SUB_SYS_ID               =     #subSysID#
        AND BPL.PROC_ID                  =     #procID#
        AND BPL.DOC_TP_CD                =     #docTpCd#
        AND C.CPO_ORD_NUM                =     #parentDocID#
        AND BPL.EZUPUSERID               =     C.EZUPUSERID
        AND BPL.EZUPTIMEZONE             =     C.EZUPTIMEZONE
        AND BPL.EZUPTIME                 &gt;= C.EZUPTIME
    </statement>

    <statement id="getMaxBizProcLogPkForDtl" parameterClass="Map" resultMap="BigDecimal">
        SELECT
            MAX(BPL.BIZ_PROC_LOG_PK)     AS    BIZ_PROC_LOG_PK
        FROM
            BIZ_PROC_LOG  BPL
         ,  DS_CPO_RTRN_DTL RD
        WHERE
            BPL.PRNT_DOC_ID              =     #parentDocID#
        AND BPL.EVENT_ID                 =     #eventID#
        AND BPL.DOC_ID                   =     #docID#
        AND BPL.SUB_SYS_ID               =     #subSysID#
        AND BPL.PROC_ID                  =     #procID#
        AND BPL.DOC_TP_CD                =     #docTpCd#
        AND RD.DS_CPO_RTRN_LINE_NUM      =     #rtrnLineNum#
        AND RD.DS_CPO_RTRN_LINE_SUB_NUM  =     #rtrnLineSubNum#
        AND BPL.EZUPUSERID               =     RD.EZUPUSERID
        AND BPL.EZUPTIMEZONE             =     RD.EZUPTIMEZONE
        AND BPL.EZUPTIME                 &gt;= RD.EZUPTIME
    </statement>

    <statement id="getDsCpoRtrnPrcDtlTMsgArray" parameterClass="Map" resultMap="result.getDsCpoRtrnPrcDtlTMsgArray">
        SELECT
              GLBL_CMPY_CD
            , DS_CPO_RTRN_PRC_DTL_PK
            , CPO_ORD_NUM
            , DS_CPO_RTRN_LINE_NUM
            , DS_CPO_RTRN_LINE_SUB_NUM
            , SHPG_PLN_NUM
            , PRMO_PK
            , PRMO_CATG_PK
            , PRMO_CATG_NM
            , PRMO_SHORT_NM
            , PRMO_DESC_TXT
            , DEAL_PK
            , CPO_LINE_PRC_NUM
            , PRC_DT
            , SHIP_UNIT_QTY
            , DEAL_UNIT_PRC_AMT
            , DEAL_LAST_NET_UNIT_PRC_AMT
            , DEAL_NET_AMT
            , DEAL_DISC_AMT
            , DEAL_PRMO_NET_UNIT_PRC_AMT
            , DEAL_PER_UNIT_FIX_AMT
            , DEAL_SLS_PCT_NUM
            , FUNC_PER_UNIT_FIX_AMT
            , FUNC_UNIT_PRC_AMT
            , FUNC_LAST_NET_UNIT_PRC_AMT
            , FUNC_NET_AMT
            , FUNC_DISC_AMT
            , FUNC_PRMO_NET_UNIT_PRC_AMT
            , DEAL_NM
            , COA_ACCT_CD
            , PRMO_EFF_STS_CD
            , EZUPTIME
            , EZUPTIMEZONE
        FROM
            DS_CPO_RTRN_PRC_DTL
        WHERE
            GLBL_CMPY_CD                 = #glblCmpyCd#
            AND CPO_ORD_NUM              = #cpoOrdNum#
            AND DS_CPO_RTRN_LINE_NUM     = #dsCpoRtrnLineNum#
            AND DS_CPO_RTRN_LINE_SUB_NUM = #dsCpoRtrnLineSubNum#
            AND EZCANCELFLAG = '0'
    </statement>
    <resultMap id="result.getDsCpoRtrnPrcDtlTMsgArray" class="DS_CPO_RTRN_PRC_DTLTMsg">
        <result property="glblCmpyCd"            column="GLBL_CMPY_CD"               javaType="EZDTStringItem"/>
        <result property="dsCpoRtrnPrcDtlPk"     column="DS_CPO_RTRN_PRC_DTL_PK"     javaType="EZDTBigDecimalItem"/>
        <result property="cpoOrdNum"             column="CPO_ORD_NUM"                javaType="EZDTStringItem"/>
        <result property="dsCpoRtrnLineNum"      column="DS_CPO_RTRN_LINE_NUM"       javaType="EZDTStringItem"/>
        <result property="dsCpoRtrnLineSubNum"   column="DS_CPO_RTRN_LINE_SUB_NUM"   javaType="EZDTStringItem"/>
        <result property="shpgPlnNum"            column="SHPG_PLN_NUM"               javaType="EZDTStringItem"/>
        <result property="prmoPk"                column="PRMO_PK"                    javaType="EZDTBigDecimalItem"/>
        <result property="prmoCatgPk"            column="PRMO_CATG_PK"               javaType="EZDTBigDecimalItem"/>
        <result property="prmoCatgNm"            column="PRMO_CATG_NM"               javaType="EZDTStringItem"/>
        <result property="prmoShortNm"           column="PRMO_SHORT_NM"              javaType="EZDTStringItem"/>
        <result property="prmoDescTxt"           column="PRMO_DESC_TXT"              javaType="EZDTStringItem"/>
        <result property="dealPk"                column="DEAL_PK"                    javaType="EZDTBigDecimalItem"/>
        <result property="cpoLinePrcNum"         column="CPO_LINE_PRC_NUM"           javaType="EZDTStringItem"/>
        <result property="prcDt"                 column="PRC_DT"                     javaType="EZDTDateItem"/>
        <result property="shipUnitQty"           column="SHIP_UNIT_QTY"              javaType="EZDTBigDecimalItem"/>
        <result property="dealUnitPrcAmt"        column="DEAL_UNIT_PRC_AMT"          javaType="EZDTBigDecimalItem"/>
        <result property="dealLastNetUnitPrcAmt" column="DEAL_LAST_NET_UNIT_PRC_AMT" javaType="EZDTBigDecimalItem"/>
        <result property="dealNetAmt"            column="DEAL_NET_AMT"               javaType="EZDTBigDecimalItem"/>
        <result property="dealDiscAmt"           column="DEAL_DISC_AMT"              javaType="EZDTBigDecimalItem"/>
        <result property="dealPrmoNetUnitPrcAmt" column="DEAL_PRMO_NET_UNIT_PRC_AMT" javaType="EZDTBigDecimalItem"/>
        <result property="dealPerUnitFixAmt"     column="DEAL_PER_UNIT_FIX_AMT"      javaType="EZDTBigDecimalItem"/>
        <result property="dealSlsPctNum"         column="DEAL_SLS_PCT_NUM"           javaType="EZDTBigDecimalItem"/>
        <result property="funcPerUnitFixAmt"     column="FUNC_PER_UNIT_FIX_AMT"      javaType="EZDTBigDecimalItem"/>
        <result property="funcUnitPrcAmt"        column="FUNC_UNIT_PRC_AMT"          javaType="EZDTBigDecimalItem"/>
        <result property="funcLastNetUnitPrcAmt" column="FUNC_LAST_NET_UNIT_PRC_AMT" javaType="EZDTBigDecimalItem"/>
        <result property="funcNetAmt"            column="FUNC_NET_AMT"               javaType="EZDTBigDecimalItem"/>
        <result property="funcDiscAmt"           column="FUNC_DISC_AMT"              javaType="EZDTBigDecimalItem"/>
        <result property="funcPrmoNetUnitPrcAmt" column="FUNC_PRMO_NET_UNIT_PRC_AMT" javaType="EZDTBigDecimalItem"/>
        <result property="dealNm"                column="DEAL_NM"                    javaType="EZDTStringItem"/>
        <result property="coaAcctCd"             column="COA_ACCT_CD"                javaType="EZDTStringItem"/>
        <result property="prmoEffStsCd"          column="PRMO_EFF_STS_CD"            javaType="EZDTStringItem"/>
        <result property="ezUpTime"              column="EZUPTIME"                   javaType="EZDTStringItem"/>
        <result property="ezUpTimeZone"          column="EZUPTIMEZONE"               javaType="EZDTStringItem"/>
    </resultMap>

    <!-- S21_NA#2996 Add Start -->
    <statement id="getHdrAmoutForNotCanceled" parameterClass="Map" resultClass="Map">
        SELECT
            'CPO_DTL' DTL_TP
            ,SUM(CD.ENT_CPO_DTL_DEAL_SLS_AMT) ENT_CPO_TOT_DEAL_SLS_AMT
            ,SUM(CD.ENT_CPO_DTL_DEAL_SLS_AMT) - SUM(CD.ENT_CPO_DTL_DEAL_NET_AMT) ENT_CPO_TOT_DEAL_DISC_AMT
            ,SUM(CD.ENT_CPO_DTL_DEAL_NET_AMT) ENT_CPO_TOT_DEAL_NET_AMT
            ,SUM(CD.ENT_CPO_DTL_FUNC_SLS_AMT) ENT_CPO_TOT_FUNC_SLS_AMT
            ,SUM(CD.ENT_CPO_DTL_FUNC_SLS_AMT) - SUM(CD.ENT_CPO_DTL_FUNC_NET_AMT) ENT_CPO_TOT_FUNC_DISC_AMT
            ,SUM(CD.ENT_CPO_DTL_FUNC_NET_AMT) ENT_CPO_TOT_FUNC_NET_AMT
            ,SUM(CD.CPO_DTL_DEAL_SLS_AMT) CPO_TOT_DEAL_SLS_AMT
            ,SUM(CD.CPO_DTL_DEAL_SLS_AMT) - SUM(CD.CPO_DTL_DEAL_NET_AMT) CPO_TOT_DEAL_DISC_AMT
            ,SUM(CD.CPO_DTL_DEAL_NET_AMT) CPO_TOT_DEAL_NET_AMT
            ,SUM(CD.CPO_DTL_FUNC_NET_AMT) CPO_TOT_FUNC_NET_AMT
            ,SUM(CD.CPO_DTL_FUNC_SLS_AMT) CPO_TOT_FUNC_SLS_AMT
            ,SUM(CD.CPO_DTL_FUNC_NET_AMT) - SUM(CD.CPO_DTL_FUNC_SLS_AMT) CPO_TOT_FUNC_DISC_AMT
        FROM
            CPO_DTL CD
        WHERE
                CD.GLBL_CMPY_CD = #glblCmpyCd#
            AND CD.CPO_ORD_NUM = #cpoOrdNum#
            AND CD.ORD_LINE_STS_CD <![CDATA[<>]]> #ordLineStsCancel#
        GROUP BY
            CD.CPO_ORD_NUM
        UNION
        SELECT
            'DS_CPO_RTRN_DTL' DTL_TP
            ,SUM(DCRD.ENT_CPO_DTL_DEAL_SLS_AMT) ENT_CPO_TOT_DEAL_SLS_AMT
            ,SUM(DCRD.ENT_CPO_DTL_DEAL_SLS_AMT) - SUM(DCRD.ENT_CPO_DTL_DEAL_NET_AMT) ENT_CPO_TOT_DEAL_DISC_AMT
            ,SUM(DCRD.ENT_CPO_DTL_DEAL_NET_AMT) ENT_CPO_TOT_DEAL_NET_AMT
            ,SUM(DCRD.ENT_CPO_DTL_FUNC_SLS_AMT) ENT_CPO_TOT_FUNC_SLS_AMT
            ,SUM(DCRD.ENT_CPO_DTL_FUNC_SLS_AMT) - SUM(DCRD.ENT_CPO_DTL_FUNC_NET_AMT) ENT_CPO_TOT_FUNC_DISC_AMT
            ,SUM(DCRD.ENT_CPO_DTL_FUNC_NET_AMT) ENT_CPO_TOT_FUNC_NET_AMT
            ,SUM(DCRD.CPO_DTL_DEAL_SLS_AMT) CPO_TOT_DEAL_SLS_AMT
            ,SUM(DCRD.CPO_DTL_DEAL_SLS_AMT) - SUM(DCRD.CPO_DTL_DEAL_NET_AMT) CPO_TOT_DEAL_DISC_AMT
            ,SUM(DCRD.CPO_DTL_DEAL_NET_AMT) CPO_TOT_DEAL_NET_AMT
            ,SUM(DCRD.CPO_DTL_FUNC_NET_AMT) CPO_TOT_FUNC_NET_AMT
            ,SUM(DCRD.CPO_DTL_FUNC_SLS_AMT) CPO_TOT_FUNC_SLS_AMT
            ,SUM(DCRD.CPO_DTL_FUNC_NET_AMT) - SUM(DCRD.CPO_DTL_FUNC_SLS_AMT) CPO_TOT_FUNC_DISC_AMT
        FROM
            DS_CPO_RTRN_DTL DCRD
        WHERE
                DCRD.GLBL_CMPY_CD = #glblCmpyCd#
            AND DCRD.CPO_ORD_NUM = #cpoOrdNum#
            AND DCRD.RTRN_LINE_STS_CD <![CDATA[<>]]> #ordLineStsCancel#
        GROUP BY
            DCRD.CPO_ORD_NUM
    </statement>
    <!-- S21_NA#2996 Add Start -->
    <!-- 2016/02/24 S21_NA#3429 Add Start-->
    <statement id="getSvcMachMstrHist" parameterClass="Map" resultMap="result.getSvcMachMstrHist">
        SELECT
              MMH.GLBL_CMPY_CD
            , MMH.SVC_MACH_MSTR_H_PK
            , MMH.SVC_MACH_MSTR_PK
            , MMH.SVC_MACH_MSTR_STS_CD
        FROM
            SVC_MACH_MSTR_HIST MMH
        WHERE
            MMH.GLBL_CMPY_CD         = #glblCmpyCd#
            AND MMH.SVC_MACH_MSTR_PK = #svcMachMstrPk#
            AND MMH.EZCANCELFLAG     = '0'
        ORDER BY
            <!-- 2016/05/31 QC#7757 MOD -->
            <!-- MMH.SVC_MACH_MSTR_H_PK DESC  --> 
            MMH.HIST_CRAT_TS DESC
            <!-- 2016/05/31 QC#7757 MOD -->
    </statement>
    <resultMap id="result.getSvcMachMstrHist" class="SVC_MACH_MSTR_HISTTMsg">
        <result property="glblCmpyCd"         column="GLBL_CMPY_CD"           javaType="EZDTStringItem"/>
        <result property="svcMachMstrHPk"     column="SVC_MACH_MSTR_H_PK"     javaType="EZDTBigDecimalItem"/>
        <result property="svcMachMstrPk"      column="SVC_MACH_MSTR_PK"       javaType="EZDTBigDecimalItem"/>
        <result property="svcMachMstrStsCd"   column="SVC_MACH_MSTR_STS_CD"   javaType="EZDTStringItem"/>
    </resultMap>
    <!-- 2016/02/24 S21_NA#3429 Add End-->
    <!-- 2016/06/06 S21_NA#9374 Add Start-->
    <statement id="getSetCmptStsCnt" parameterClass="Map" resultClass="Integer">
        SELECT COUNT(*)
        FROM
            DS_CPO_RTRN_DTL DCRD
        WHERE
            DCRD.GLBL_CMPY_CD = #glblCmpyCd#
            AND DCRD.EZCANCELFLAG = '0'
            AND DCRD.CPO_ORD_NUM = #cpoOrdNum#
            AND DCRD.DS_CPO_RTRN_LINE_NUM = #dsCpoRtrnLineNum#
            AND DCRD.DS_CPO_RTRN_LINE_SUB_NUM <![CDATA[<>]]> #dsCpoRtrnLineSubNum#
            AND DCRD.RTRN_LINE_STS_CD <![CDATA[<>]]> #rtrnLineStsCd#
    </statement>
    <!-- 2016/06/06 S21_NA#9374 Add End-->

    <!-- 2016/07/06 S21_NA#7755 Add Start-->

    <statement id="isExistOrdCatg" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(OCBC.ORD_CATG_BIZ_CTX_PK)
        FROM
            ORD_CATG_BIZ_CTX OCBC
        WHERE
            OCBC.GLBL_CMPY_CD           = #glblCmpyCd#
            AND OCBC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTpCd#
            AND OCBC.EZCANCELFLAG       = '0'
            AND (
                 (
                  OCBC.DS_ORD_CATG_CD    = #dsOrdCatgCd#
                  AND OCBC.DS_ORD_TP_CD  IS NULL
                  AND OCBC.DS_ORD_RSN_CD IS NULL
                 )
                 OR
                 (
                  OCBC.DS_ORD_CATG_CD    = #dsOrdCatgCd#
                  AND OCBC.DS_ORD_TP_CD  = #dsOrdTpCd#
                  AND OCBC.DS_ORD_RSN_CD IS NULL
                 )
                 OR
                 (
                  OCBC.DS_ORD_CATG_CD    = #dsOrdCatgCd#
                  AND OCBC.DS_ORD_TP_CD  = #dsOrdTpCd#
                  AND OCBC.DS_ORD_RSN_CD = #dsOrdRsnCd#
                 )
                )
    </statement>

    <statement id="getBaseComponentFlag" parameterClass="Map" resultClass="Map">
        SELECT
            DM.INSTL_BASE_CTRL_FLG
           ,MT.MDSE_TP_CTX_TP_CD
        FROM
            MDSE            DM
           ,MDSE_TP_VAL_SET MT
        WHERE
            DM.GLBL_CMPY_CD             = #glblCmpyCd#
            AND DM.MDSE_CD              = #mdseCd#
            AND DM.EZCANCELFLAG         = '0'
            AND DM.GLBL_CMPY_CD         = MT.GLBL_CMPY_CD(+)
            AND DM.COA_MDSE_TP_CD       = MT.COA_MDSE_TP_CD(+)
            AND MT.MDSE_TP_CTX_TP_CD(+) = #mdseTpCtxTpCd#
            AND MT.EZCANCELFLAG(+)      = '0'
            AND ROWNUM                  = 1
    </statement>
    <!-- 2016/07/06 S21_NA#7755 Add End-->
    <!-- 2017/09/29 S21_NA#21151 Add Start -->
    <statement id="isExistsSvcMachMstr" parameterClass="Map" resultClass="Integer">
        SELECT
               COUNT(SMM.SVC_MACH_MSTR_PK)
        FROM
               SVC_MACH_MSTR SMM
        WHERE
               SMM.GLBL_CMPY_CD     = #glblCmpyCd#
          AND  SMM.SVC_MACH_MSTR_PK = #svcMachMstrPk#
          AND  SMM.TRX_HDR_NUM      = #cpoOrdNum#
          AND  SMM.EZCANCELFLAG     = '0'
    </statement>
    <!-- 2017/09/29 S21_NA#21151 Add End -->

</sqlMap>