<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWAL1880Query">

    <typeAlias alias="NWAL1880SMsg"    type="business.blap.NWAL1880.NWAL1880SMsg"/>
    <typeAlias alias="NWAL1880_ASMsg"  type="business.blap.NWAL1880.NWAL1880_ASMsg"/>

    <statement id="findOrderTeamZoneByUserId" parameterClass="Map" resultClass="Map">
        SELECT
            OZ.ORD_ZN_DESC_TXT
            ,OTMH.ORD_TEAM_MSTR_NM 
        FROM
            ORD_TEAM_MSTR_HDR OTMH
            ,ORD_TEAM_MSTR_DTL OTMD
            ,ORD_TEAM_ATTRB_TP OTAT
            ,ORD_ZN OZ
        WHERE
            OTMH.GLBL_CMPY_CD = #glblCmpyCd#
            AND OTMH.EZCANCELFLAG           = '0'
            AND OTMH.EFF_FROM_DT        &lt;= #slsDt#
            AND (OTMH.EFF_THRU_DT IS NULL
            OR OTMH.EFF_THRU_DT &gt;= #slsDt#)
            AND OTMH.GLBL_CMPY_CD           = OZ.GLBL_CMPY_CD
            AND OTMH.ORD_ZN_CD              = OZ.ORD_ZN_CD
            AND OZ.EZCANCELFLAG             = '0'
            AND OTMH.GLBL_CMPY_CD           = OTMD.GLBL_CMPY_CD
            AND OTMH.ORD_TEAM_MSTR_HDR_PK   = OTMD.ORD_TEAM_MSTR_HDR_PK
            AND OTMD.ORD_TEAM_ATTRB_VAL_TXT = #userId#
            AND OTMD.EZCANCELFLAG           = '0'
            AND OTMD.GLBL_CMPY_CD           = OTAT.GLBL_CMPY_CD
            AND OTMD.ORD_TEAM_ATTRB_TP_CD   = OTAT.ORD_TEAM_ATTRB_TP_CD
            AND OTAT.ORD_TEAM_ATTRB_TP_CD   = #attrbTpCdUser#
            AND OTAT.EZCANCELFLAG = '0'
    </statement>

    <statement id="findOrderList" parameterClass="Map" resultClass="Map">
        <isEqual property="teamSearchFlg" compareValue="Y">
        WITH
        TMZN AS (
        SELECT
            TM.GLBL_CMPY_CD
            ,TM.ORD_TEAM_MSTR_NM
            ,TM.ORD_ZN_DESC_TXT
            ,CBU.CRAT_BY_USR_ID
            ,CAC.CUST_ACCT_CD
            ,LBT.LINE_BIZ_TP_CD
            ,CBC.COA_BR_CD
        FROM 
            (
            SELECT
                OTMH.GLBL_CMPY_CD
                ,OTMH.ORD_TEAM_MSTR_NM
                ,OZ.ORD_ZN_DESC_TXT
                ,NULL AS ORD_TEAM_ATTRB_TP_CD10
                ,NULL AS CRAT_BY_USR_ID
                ,NULL AS ORD_TEAM_ATTRB_TP_CD20
                ,NULL AS CUST_ACCT_CD
                ,NULL AS ORD_TEAM_ATTRB_TP_CD30
                ,NULL AS LINE_BIZ_TP_CD
                ,NULL AS ORD_TEAM_ATTRB_TP_CD40
                ,NULL AS COA_BR_CD
            FROM
                ORD_TEAM_MSTR_HDR OTMH
                ,ORD_ZN OZ
            WHERE
                OTMH.GLBL_CMPY_CD = #glblCmpyCd#
                <isNotNull property="cMsg.xxOrdTeamSrchTxt">
                $searchCondition_Team$
                </isNotNull>
                AND OTMH.EFF_FROM_DT        &lt;= #slsDt#
                AND (OTMH.EFF_THRU_DT IS NULL
                        OR OTMH.EFF_THRU_DT &gt;= #slsDt#)
                AND OTMH.EZCANCELFLAG = '0'
                AND OTMH.GLBL_CMPY_CD = OZ.GLBL_CMPY_CD
                AND OTMH.ORD_ZN_CD = OZ.ORD_ZN_CD
                <isNotNull property="cMsg.xxOrdZnSrchTxt">
                $searchCondition_Zone$
                </isNotNull>
                AND OZ.EZCANCELFLAG = '0'
            ) TM
            ,(
            SELECT
                OTMH.GLBL_CMPY_CD
                ,OTMH.ORD_TEAM_MSTR_NM
                ,OZ.ORD_ZN_DESC_TXT
                ,OTAT.ORD_TEAM_ATTRB_TP_CD AS ORD_TEAM_ATTRB_TP_CD10
                ,OTMD.ORD_TEAM_ATTRB_VAL_TXT AS CRAT_BY_USR_ID
                ,NULL AS ORD_TEAM_ATTRB_TP_CD20
                ,NULL AS CUST_ACCT_CD
                ,NULL AS ORD_TEAM_ATTRB_TP_CD30
                ,NULL AS LINE_BIZ_TP_CD
                ,NULL AS ORD_TEAM_ATTRB_TP_CD40
                ,NULL AS COA_BR_CD
            FROM
                ORD_TEAM_MSTR_HDR OTMH
                ,ORD_TEAM_MSTR_DTL OTMD
                ,ORD_TEAM_ATTRB_TP OTAT
                ,ORD_ZN OZ
            WHERE
                OTMH.GLBL_CMPY_CD = #glblCmpyCd#
                <isNotNull property="cMsg.xxOrdTeamSrchTxt">
                $searchCondition_Team$
                </isNotNull>
                AND OTMH.EFF_FROM_DT        &lt;= #slsDt#
                AND (OTMH.EFF_THRU_DT IS NULL
                        OR OTMH.EFF_THRU_DT &gt;= #slsDt#)
                AND OTMH.EZCANCELFLAG = '0'
                AND OTMH.GLBL_CMPY_CD = OZ.GLBL_CMPY_CD
                AND OTMH.ORD_ZN_CD = OZ.ORD_ZN_CD
                <isNotNull property="cMsg.xxOrdZnSrchTxt">
                $searchCondition_Zone$
                </isNotNull>
                AND OZ.EZCANCELFLAG = '0'
                AND OTMH.GLBL_CMPY_CD = OTMD.GLBL_CMPY_CD
                AND OTMH.ORD_TEAM_MSTR_HDR_PK = OTMD.ORD_TEAM_MSTR_HDR_PK
                AND OTMD.EZCANCELFLAG = '0'
                AND OTMD.GLBL_CMPY_CD = OTAT.GLBL_CMPY_CD
                AND OTMD.ORD_TEAM_ATTRB_TP_CD = OTAT.ORD_TEAM_ATTRB_TP_CD
                AND OTAT.ORD_TEAM_ATTRB_TP_CD = #attrbTpCdUser#
                AND OTAT.EZCANCELFLAG = '0'
            ) CBU
            ,(
            SELECT
                OTMH.GLBL_CMPY_CD
                ,OTMH.ORD_TEAM_MSTR_NM
                ,OZ.ORD_ZN_DESC_TXT
                ,NULL AS ORD_TEAM_ATTRB_TP_CD10
                ,NULL AS CRAT_BY_USR_ID
                ,OTAT.ORD_TEAM_ATTRB_TP_CD AS ORD_TEAM_ATTRB_TP_CD20
                ,OTMD.ORD_TEAM_ATTRB_VAL_TXT AS CUST_ACCT_CD
                ,NULL AS ORD_TEAM_ATTRB_TP_CD30
                ,NULL AS LINE_BIZ_TP_CD
                ,NULL AS ORD_TEAM_ATTRB_TP_CD40
                ,NULL AS COA_BR_CD
            FROM
                ORD_TEAM_MSTR_HDR OTMH
                ,ORD_TEAM_MSTR_DTL OTMD
                ,ORD_TEAM_ATTRB_TP OTAT
                ,ORD_ZN OZ
            WHERE
                OTMH.GLBL_CMPY_CD = #glblCmpyCd#
                <isNotNull property="cMsg.xxOrdTeamSrchTxt">
                $searchCondition_Team$
                </isNotNull>
                AND OTMH.EFF_FROM_DT        &lt;= #slsDt#
                AND (OTMH.EFF_THRU_DT IS NULL
                        OR OTMH.EFF_THRU_DT &gt;= #slsDt#)
                AND OTMH.EZCANCELFLAG = '0'
                AND OTMH.GLBL_CMPY_CD = OZ.GLBL_CMPY_CD
                AND OTMH.ORD_ZN_CD = OZ.ORD_ZN_CD
                <isNotNull property="cMsg.xxOrdZnSrchTxt">
                $searchCondition_Zone$
                </isNotNull>
                AND OZ.EZCANCELFLAG = '0'
                AND OTMH.GLBL_CMPY_CD = OTMD.GLBL_CMPY_CD
                AND OTMH.ORD_TEAM_MSTR_HDR_PK = OTMD.ORD_TEAM_MSTR_HDR_PK
                AND OTMD.EZCANCELFLAG = '0'
                AND OTMD.GLBL_CMPY_CD = OTAT.GLBL_CMPY_CD
                AND OTMD.ORD_TEAM_ATTRB_TP_CD = OTAT.ORD_TEAM_ATTRB_TP_CD
                AND OTAT.ORD_TEAM_ATTRB_TP_CD = #attrbTpCdCustomer#
                AND OTAT.EZCANCELFLAG = '0'
            ) CAC
            ,(
            SELECT
                OTMH.GLBL_CMPY_CD
                ,OTMH.ORD_TEAM_MSTR_NM
                ,OZ.ORD_ZN_DESC_TXT
                ,NULL AS ORD_TEAM_ATTRB_TP_CD10
                ,NULL AS CRAT_BY_USR_ID
                ,NULL AS ORD_TEAM_ATTRB_TP_CD20
                ,NULL AS CUST_ACCT_CD
                ,OTAT.ORD_TEAM_ATTRB_TP_CD AS ORD_TEAM_ATTRB_TP_CD30
                ,OTMD.ORD_TEAM_ATTRB_VAL_TXT AS LINE_BIZ_TP_CD
                ,NULL AS ORD_TEAM_ATTRB_TP_CD40
                ,NULL AS COA_BR_CD
            FROM
                ORD_TEAM_MSTR_HDR OTMH
                ,ORD_TEAM_MSTR_DTL OTMD
                ,ORD_TEAM_ATTRB_TP OTAT
                ,ORD_ZN OZ
            WHERE
                OTMH.GLBL_CMPY_CD = #glblCmpyCd#
                <isNotNull property="cMsg.xxOrdTeamSrchTxt">
                $searchCondition_Team$
                </isNotNull>
                AND OTMH.EFF_FROM_DT        &lt;= #slsDt#
                AND (OTMH.EFF_THRU_DT IS NULL
                        OR OTMH.EFF_THRU_DT &gt;= #slsDt#)
                AND OTMH.EZCANCELFLAG = '0'
                AND OTMH.GLBL_CMPY_CD = OZ.GLBL_CMPY_CD
                AND OTMH.ORD_ZN_CD = OZ.ORD_ZN_CD
                <isNotNull property="cMsg.xxOrdZnSrchTxt">
                $searchCondition_Zone$
                </isNotNull>
                AND OZ.EZCANCELFLAG = '0'
                AND OTMH.GLBL_CMPY_CD = OTMD.GLBL_CMPY_CD
                AND OTMH.ORD_TEAM_MSTR_HDR_PK = OTMD.ORD_TEAM_MSTR_HDR_PK
                AND OTMD.EZCANCELFLAG = '0'
                AND OTMD.GLBL_CMPY_CD = OTAT.GLBL_CMPY_CD
                AND OTMD.ORD_TEAM_ATTRB_TP_CD = OTAT.ORD_TEAM_ATTRB_TP_CD
                AND OTAT.ORD_TEAM_ATTRB_TP_CD = #attrbTpCdLob#
                AND OTAT.EZCANCELFLAG = '0'
            ) LBT
            ,(
            SELECT
                OTMH.GLBL_CMPY_CD
                ,OTMH.ORD_TEAM_MSTR_NM
                ,OZ.ORD_ZN_DESC_TXT
                ,NULL AS ORD_TEAM_ATTRB_TP_CD10
                ,NULL AS CRAT_BY_USR_ID
                ,NULL AS ORD_TEAM_ATTRB_TP_CD20
                ,NULL AS CUST_ACCT_CD
                ,NULL AS ORD_TEAM_ATTRB_TP_CD30
                ,NULL AS LINE_BIZ_TP_CD
                ,OTAT.ORD_TEAM_ATTRB_TP_CD AS ORD_TEAM_ATTRB_TP_CD40
                ,OTMD.ORD_TEAM_ATTRB_VAL_TXT AS COA_BR_CD
            FROM
                ORD_TEAM_MSTR_HDR OTMH
                ,ORD_TEAM_MSTR_DTL OTMD
                ,ORD_TEAM_ATTRB_TP OTAT
                ,ORD_ZN OZ
            WHERE
                OTMH.GLBL_CMPY_CD = #glblCmpyCd#
                <isNotNull property="cMsg.xxOrdTeamSrchTxt">
                $searchCondition_Team$
                </isNotNull>
                AND OTMH.EFF_FROM_DT        &lt;= #slsDt#
                AND (OTMH.EFF_THRU_DT IS NULL
                        OR OTMH.EFF_THRU_DT &gt;= #slsDt#)
                AND OTMH.EZCANCELFLAG = '0'
                AND OTMH.GLBL_CMPY_CD = OZ.GLBL_CMPY_CD
                AND OTMH.ORD_ZN_CD = OZ.ORD_ZN_CD
                <isNotNull property="cMsg.xxOrdZnSrchTxt">
                $searchCondition_Zone$
                </isNotNull>
                AND OZ.EZCANCELFLAG = '0'
                AND OTMH.GLBL_CMPY_CD = OTMD.GLBL_CMPY_CD
                AND OTMH.ORD_TEAM_MSTR_HDR_PK = OTMD.ORD_TEAM_MSTR_HDR_PK
                AND OTMD.EZCANCELFLAG = '0'
                AND OTMD.GLBL_CMPY_CD = OTAT.GLBL_CMPY_CD
                AND OTMD.ORD_TEAM_ATTRB_TP_CD = OTAT.ORD_TEAM_ATTRB_TP_CD
                AND OTAT.ORD_TEAM_ATTRB_TP_CD = #attrbTpCdBranch#
                AND OTAT.EZCANCELFLAG = '0'
            ) CBC
        WHERE
            TM.GLBL_CMPY_CD =  CBU.GLBL_CMPY_CD(+)
            AND TM.ORD_TEAM_MSTR_NM = CBU.ORD_TEAM_MSTR_NM(+)
            AND TM.ORD_ZN_DESC_TXT = CBU.ORD_ZN_DESC_TXT(+)
            AND TM.GLBL_CMPY_CD = CAC.GLBL_CMPY_CD(+)
            AND TM.ORD_TEAM_MSTR_NM = CAC.ORD_TEAM_MSTR_NM(+)
            AND TM.ORD_ZN_DESC_TXT = CAC.ORD_ZN_DESC_TXT(+)
            AND TM.GLBL_CMPY_CD = LBT.GLBL_CMPY_CD(+)
            AND TM.ORD_TEAM_MSTR_NM = LBT.ORD_TEAM_MSTR_NM(+)
            AND TM.ORD_ZN_DESC_TXT = LBT.ORD_ZN_DESC_TXT(+)
            AND TM.GLBL_CMPY_CD = CBC.GLBL_CMPY_CD(+)
            AND TM.ORD_TEAM_MSTR_NM = CBC.ORD_TEAM_MSTR_NM(+)
            AND TM.ORD_ZN_DESC_TXT = CBC.ORD_ZN_DESC_TXT(+)
        )
        </isEqual>
        SELECT
            GLBL_CMPY_CD
            ,DPLY_BY_01_ITEM_CD
            <isNotNull property="pairDplyByItemNm_01">
            ,DPLY_BY_01_ITEM_NM
            </isNotNull>
            <!-- 2017/01/24 S21_NA#16992 Add Start -->
            <isEqual property="allCsaFlg" compareValue="N">
            ,USR_ID                                             AS USR_ID
            </isEqual>
            <!-- 2017/01/24 S21_NA#16992 Add End -->
            ,ENT_CNT
            ,CR_HLD_CNT
            ,PRFT_CNT
            ,VLD_CNT
            ,ALL_OTHER_CNT
            ,BOOK_CNT

            ,INVD_TODAY_CNT
            ,INVD_CUR_MTH_CNT
            ,INVD_TOT_CNT

            ,AGING_TODAY_CNT
            ,AGING_1_2_CNT
            ,AGING_3_10_CNT
            ,AGING_11_30_CNT
            ,AGING_31_50_CNT
            ,AGING_OVER_50_CNT
            ,AGING_TOT_CNT

            ,CR_REBIL_TODAY_CNT
            ,CR_REBIL_CUR_MTH_CNT
            ,CR_REBIL_TOT_CNT

            ,BLLG_HLD_CNT
            ,BLLG_HLD_AMT

            ,RVW_DEAL_CONFIG_CNT
            ,RVW_SOM_CNT

            ,ACPT_DEAL_CONFIG_CNT
            ,ACPT_SOM_CNT
        FROM (
            SELECT
                GLBL_CMPY_CD
                ,$cMsg.xxScrItem50Txt$                              AS DPLY_BY_01_ITEM_CD
                <isNotNull property="pairDplyByItemNm_01">
                ,$pairDplyByItemNm_01$                              AS DPLY_BY_01_ITEM_NM
                </isNotNull>
                <!-- 2017/01/24 S21_NA#16992 Add Start -->
                <isEqual property="allCsaFlg" compareValue="N">
                <!-- 2018/08/01 QC#20098 Add Start -->
                <isEqual property="dispByCratUsrId" compareValue="Y">
                ,USR_ID                                             AS USR_ID
                </isEqual>
                <isNotEqual property="dispByCratUsrId" compareValue="Y">
                ,NULL                                               AS USR_ID
                </isNotEqual>
                <!-- 2018/08/01 QC#20098 Add End -->
                </isEqual>
                <!-- 2017/01/24 S21_NA#16992 Add Start -->
                ,COUNT(DISTINCT(ENT_CNT))                           AS ENT_CNT
                ,COUNT(DISTINCT(CR_HLD_CNT))                        AS CR_HLD_CNT
                ,COUNT(DISTINCT(PRFT_CNT))                          AS PRFT_CNT
                ,COUNT(DISTINCT(VLD_CNT))                           AS VLD_CNT
                ,COUNT(DISTINCT(ALL_OTHER_CNT))                     AS ALL_OTHER_CNT
                ,COUNT(DISTINCT(BOOK_CNT))                          AS BOOK_CNT

                ,COUNT(DISTINCT(INVD_TODAY_CNT))                    AS INVD_TODAY_CNT
                ,COUNT(DISTINCT(INVD_CUR_MTH_CNT))                  AS INVD_CUR_MTH_CNT
                ,COUNT(DISTINCT(INVD_TOT_CNT))                      AS INVD_TOT_CNT

                ,COUNT(DISTINCT(AGING_TODAY_CNT))                   AS AGING_TODAY_CNT
                ,COUNT(DISTINCT(AGING_1_2_CNT))                     AS AGING_1_2_CNT
                ,COUNT(DISTINCT(AGING_3_10_CNT))                    AS AGING_3_10_CNT
                ,COUNT(DISTINCT(AGING_11_30_CNT))                   AS AGING_11_30_CNT
                ,COUNT(DISTINCT(AGING_31_50_CNT))                   AS AGING_31_50_CNT
                ,COUNT(DISTINCT(AGING_OVER_50_CNT))                 AS AGING_OVER_50_CNT
                ,COUNT(DISTINCT(AGING_TOT_CNT))                     AS AGING_TOT_CNT

                ,COUNT(DISTINCT(CR_REBIL_TODAY_CNT))                AS CR_REBIL_TODAY_CNT
                ,COUNT(DISTINCT(CR_REBIL_CUR_MTH_CNT))              AS CR_REBIL_CUR_MTH_CNT
                ,COUNT(DISTINCT(CR_REBIL_TOT_CNT))                  AS CR_REBIL_TOT_CNT

                ,COUNT(DISTINCT(BLLG_HLD_CNT))                      AS BLLG_HLD_CNT
                ,SUM(BLLG_HLD_AMT)                                  AS BLLG_HLD_AMT

                ,COUNT(DISTINCT(RVW_DEAL_CONFIG_CNT))               AS RVW_DEAL_CONFIG_CNT
                ,COUNT(DISTINCT(RVW_SOM_CNT))                       AS RVW_SOM_CNT

                ,COUNT(DISTINCT(ACPT_DEAL_CONFIG_CNT))              AS ACPT_DEAL_CONFIG_CNT
                ,COUNT(DISTINCT(ACPT_SOM_CNT))                      AS ACPT_SOM_CNT
            FROM (
                SELECT
                    DOO.GLBL_CMPY_CD
                    <isEqual property="allCsaFlg" compareValue="Y">
                    ,'All CSA'                                           AS ALL_CSA
                    </isEqual>
                    <isEqual property="allCsaFlg" compareValue="N">
                    <isEqual property="teamSearchFlg" compareValue="Y">
                    ,TMZN.ORD_TEAM_MSTR_NM
                    ,TMZN.ORD_ZN_DESC_TXT
                    </isEqual>
                    ,DECODE(PSN.USR_NM, NULL, DOO.CRAT_BY_USR_ID,
                        DOO.CRAT_BY_USR_ID || '(' ||  PSN.FIRST_NM || ' ' || PSN.LAST_NM || ')')
                                                                         AS CRAT_BY_USR_ID<!-- 2017/01/24 S21_NA#16992 Mod -->
                    ,DOO.CRAT_BY_USR_ID                                  AS USR_ID<!-- 2017/01/24 S21_NA#16992 Mod -->
                    </isEqual>
                    ,CASE DOO.ORD_HDR_DPLY_STS_NM
                        WHEN #stsEnt# THEN SRC_REF_OR_CPO_ORD_NUM
                        ELSE NULL
                    END                                                  AS ENT_CNT
                    ,CASE DOO.ORD_HDR_DPLY_STS_NM
                        WHEN #stsCrHld# THEN SRC_REF_OR_CPO_ORD_NUM
                        ELSE NULL
                    END                                                  AS CR_HLD_CNT
                    ,CASE DOO.ORD_HDR_DPLY_STS_NM
                        WHEN #stsPrft# THEN SRC_REF_OR_CPO_ORD_NUM
                        ELSE NULL
                    END                                                  AS PRFT_CNT
                    ,CASE DOO.ORD_HDR_DPLY_STS_NM
                        WHEN #stsVld# THEN SRC_REF_OR_CPO_ORD_NUM
                        ELSE NULL
                    END                                                  AS VLD_CNT
                    ,CASE
                        WHEN DOO.ORD_LINE_DPLY_STS_NM = #stsEnt# OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsEnt# THEN
                            CASE DOO.ORD_HDR_DPLY_STS_NM
                                WHEN #stsEnt# THEN NULL
                                WHEN #stsCrHld# THEN NULL
                                WHEN #stsPrft# THEN NULL
                                WHEN #stsVld# THEN NULL
                                ELSE SRC_REF_OR_CPO_ORD_NUM
                            END
                        ELSE NULL
                    END                                                  AS ALL_OTHER_CNT
                    ,CASE DOO.ORD_HDR_DPLY_STS_NM
                        WHEN #stsBook# THEN SRC_REF_OR_CPO_ORD_NUM
                        ELSE NULL
                    END                                                  AS BOOK_CNT
                    ,CASE
                        WHEN    DOO.ORD_LINE_DPLY_STS_NM = #stsClo#         OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsClo#
                             OR DOO.ORD_LINE_DPLY_STS_NM = #stsCloLoanRtrn# OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsCloLoanRtrn#
                             OR DOO.ORD_LINE_DPLY_STS_NM = #stsCloLoanSold# OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsCloLoanSold#
                            THEN
                            CASE
                                WHEN DOO.INV_DT = #slsDt# THEN SRC_REF_OR_CPO_ORD_NUM
                                ELSE NULL
                            END
                        ELSE NULL
                    END                                                  AS INVD_TODAY_CNT
                    ,CASE
                        WHEN    DOO.ORD_LINE_DPLY_STS_NM = #stsClo#         OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsClo#
                             OR DOO.ORD_LINE_DPLY_STS_NM = #stsCloLoanRtrn# OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsCloLoanRtrn#
                             OR DOO.ORD_LINE_DPLY_STS_NM = #stsCloLoanSold# OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsCloLoanSold#
                            THEN
                            CASE
                                WHEN DOO.INV_DT LIKE #slsDtYM# AND DOO.INV_DT &lt;&gt; #slsDt# THEN SRC_REF_OR_CPO_ORD_NUM
                                ELSE null
                            END
                        ELSE null
                    END                                                  AS INVD_CUR_MTH_CNT
                    ,CASE
                        WHEN    DOO.ORD_LINE_DPLY_STS_NM = #stsClo#         OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsClo#
                             OR DOO.ORD_LINE_DPLY_STS_NM = #stsCloLoanRtrn# OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsCloLoanRtrn#
                             OR DOO.ORD_LINE_DPLY_STS_NM = #stsCloLoanSold# OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsCloLoanSold#
                            THEN
                            CASE
                                WHEN DOO.INV_DT LIKE #slsDtYM# THEN SRC_REF_OR_CPO_ORD_NUM
                                ELSE NULL
                            END
                        ELSE NULL
                    END                                                  AS INVD_TOT_CNT
                    ,CASE DOO.ORD_AGING_BCKT_DESC_TXT
                        WHEN #agingToday# THEN
                            CASE
                                WHEN DOO.ORD_HDR_DPLY_STS_NM = #stsCanc#
                                    OR DOO.ORD_LINE_DPLY_STS_NM = #stsCanc#
                                    OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsCanc# THEN NULL
                                ELSE SRC_REF_OR_CPO_ORD_NUM
                            END
                        ELSE NULL
                    END                                                  AS AGING_TODAY_CNT
                    ,CASE DOO.ORD_AGING_BCKT_DESC_TXT
                        WHEN #agingFrom1To2# THEN
                            CASE
                                WHEN DOO.ORD_HDR_DPLY_STS_NM = #stsCanc#
                                    OR DOO.ORD_LINE_DPLY_STS_NM = #stsCanc#
                                    OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsCanc# THEN NULL
                                ELSE SRC_REF_OR_CPO_ORD_NUM
                            END
                        ELSE NULL
                    END                                                  AS AGING_1_2_CNT
                    ,CASE DOO.ORD_AGING_BCKT_DESC_TXT
                        WHEN #agingFrom3To10# THEN
                            CASE
                                WHEN DOO.ORD_HDR_DPLY_STS_NM = #stsCanc#
                                    OR DOO.ORD_LINE_DPLY_STS_NM = #stsCanc#
                                    OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsCanc# THEN NULL
                                ELSE SRC_REF_OR_CPO_ORD_NUM
                            END
                        ELSE NULL
                    END                                                  AS AGING_3_10_CNT
                    ,CASE DOO.ORD_AGING_BCKT_DESC_TXT
                        WHEN #agingFrom11To30# THEN
                            CASE
                                WHEN DOO.ORD_HDR_DPLY_STS_NM = #stsCanc#
                                    OR DOO.ORD_LINE_DPLY_STS_NM = #stsCanc#
                                    OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsCanc# THEN NULL
                                ELSE SRC_REF_OR_CPO_ORD_NUM
                            END
                        ELSE NULL
                    END                                                  AS AGING_11_30_CNT
                    <!-- 2018/12/14 QC#29024 Mod Start -->
                    <!--
                    ,CASE DOO.ORD_AGING_BCKT_DESC_TXT
                        WHEN #agingFrom31To50# THEN SRC_REF_OR_CPO_ORD_NUM
                    END                                                  AS AGING_31_50_CNT
                    -->
                    ,CASE DOO.ORD_AGING_BCKT_DESC_TXT
                        WHEN #agingFrom31To50# THEN
                            CASE
                                WHEN DOO.ORD_HDR_DPLY_STS_NM = #stsCanc#
                                    OR DOO.ORD_LINE_DPLY_STS_NM = #stsCanc#
                                    OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsCanc# THEN NULL
                                ELSE SRC_REF_OR_CPO_ORD_NUM
                            END
                        ELSE NULL
                    END                                                  AS AGING_31_50_CNT
                    <!-- 2018/12/14 QC#29024 Mod End -->
                    ,CASE DOO.ORD_AGING_BCKT_DESC_TXT
                        WHEN #agingOver50# THEN
                            CASE
                                WHEN DOO.ORD_HDR_DPLY_STS_NM = #stsCanc#
                                    OR DOO.ORD_LINE_DPLY_STS_NM = #stsCanc#
                                    OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsCanc# THEN NULL
                                ELSE SRC_REF_OR_CPO_ORD_NUM
                            END
                        ELSE NULL
                    END                                                  AS AGING_OVER_50_CNT
                    ,CASE
                        WHEN DOO.ORD_AGING_BCKT_DESC_TXT = #agingToday#
                            OR DOO.ORD_AGING_BCKT_DESC_TXT = #agingFrom1To2#
                            OR DOO.ORD_AGING_BCKT_DESC_TXT = #agingFrom3To10#
                            OR DOO.ORD_AGING_BCKT_DESC_TXT = #agingFrom11To30#
                            OR DOO.ORD_AGING_BCKT_DESC_TXT = #agingFrom31To50#
                            OR DOO.ORD_AGING_BCKT_DESC_TXT = #agingOver50# THEN
                            CASE
                                WHEN DOO.ORD_HDR_DPLY_STS_NM = #stsCanc#
                                    OR DOO.ORD_LINE_DPLY_STS_NM = #stsCanc#
                                    OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsCanc# THEN NULL
                                ELSE SRC_REF_OR_CPO_ORD_NUM
                            END
                        ELSE NULL
                     END                                                 AS AGING_TOT_CNT
                    ,CASE
                        <!-- 2018/01/15 S21_NA#22330 Mod Start -->
                        <!-- WHEN DOO.CPO_SRC_TP_CD = #cpoSrcTpCrReBill# -->
                        WHEN DOO.CPO_SRC_TP_CD IN (#cpoSrcTpCr#, #cpoSrcTpRb#)
                        <!-- 2018/01/15 S21_NA#22330 Mod End -->
                            THEN
                            CASE
                                WHEN DOO.CPO_ORD_TS = #slsDt# THEN SRC_REF_OR_CPO_ORD_NUM
                                ELSE NULL
                            END
                        ELSE NULL
                    END                                                  AS CR_REBIL_TODAY_CNT
                    ,CASE
                        <!-- 2018/01/15 S21_NA#22330 Mod Start -->
                        <!-- WHEN DOO.CPO_SRC_TP_CD = #cpoSrcTpCrReBill# -->
                        WHEN DOO.CPO_SRC_TP_CD IN (#cpoSrcTpCr#, #cpoSrcTpRb#)
                        <!-- 2018/01/15 S21_NA#22330 Mod End -->
                            THEN
                            CASE
                                WHEN DOO.CPO_ORD_TS LIKE #slsDtYM# AND DOO.CPO_ORD_TS &lt;&gt; #slsDt# THEN SRC_REF_OR_CPO_ORD_NUM
                                ELSE NULL
                            END
                        ELSE NULL
                    END                                                  AS CR_REBIL_CUR_MTH_CNT
                    ,CASE
                        <!-- 2018/01/15 S21_NA#22330 Mod Start -->
                        <!-- WHEN DOO.CPO_SRC_TP_CD = #cpoSrcTpCrReBill# -->
                        WHEN DOO.CPO_SRC_TP_CD IN (#cpoSrcTpCr#, #cpoSrcTpRb#)
                        <!-- 2018/01/15 S21_NA#22330 Mod End -->
                            THEN
                            CASE
                                WHEN DOO.CPO_ORD_TS LIKE #slsDtYM# THEN SRC_REF_OR_CPO_ORD_NUM
                                ELSE NULL
                            END
                        ELSE NULL
                    END                                                  AS CR_REBIL_TOT_CNT
                    ,CASE
                        WHEN DOO.ORD_LINE_DPLY_STS_NM = #stsBllgHld# OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsBllgHld# THEN SRC_REF_OR_CPO_ORD_NUM
                        ELSE NULL
                    END                                                  AS BLLG_HLD_CNT
                    <!-- 2019/03/05 QC#30694  MOD START -->
                    ,CASE
                        WHEN DOO.ORD_LINE_DPLY_STS_NM = #stsBllgHld# OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsBllgHld# THEN
                           CASE WHEN COUNT_FOR_SER_NUM >= 2 THEN
                               NVL(SP_FUNC_NET_UNIT_PRC_AMT,NVL(ENT_CPO_DTL_FUNC_NET_AMT,0))
                           ELSE
                               NVL(SP_TOT_FUNC_NET_AMT,NVL(ENT_CPO_DTL_FUNC_NET_AMT,0))
                           END
                        ELSE 0
                    END                                                 AS BLLG_HLD_AMT
                    <!--
                    ,CASE
                        WHEN DOO.ORD_LINE_DPLY_STS_NM = #stsBllgHld# OR DOO.ORD_RTRN_LINE_DPLY_STS_NM = #stsBllgHld# THEN SP_TOT_FUNC_NET_AMT
                        ELSE 0
                    END                                                 AS BLLG_HLD_AMT
                    -->
                    
                    <!-- 2019/03/05 QC#30694  MOD END -->

                    ,CASE
                        WHEN DOO.CPO_SRC_TP_CD = #cpoSrcTpDealConfig#
                            AND  DOO.ORD_HDR_DPLY_STS_NM = #stsPendImpt# THEN SRC_REF_OR_CPO_ORD_NUM
                        ELSE NULL
                    END                                                  AS RVW_DEAL_CONFIG_CNT
                    ,CASE
                        WHEN DOO.CPO_SRC_TP_CD = #cpoSrcTpSom#
                            AND  DOO.ORD_HDR_DPLY_STS_NM = #stsPendImpt# THEN SRC_REF_OR_CPO_ORD_NUM
                        ELSE NULL
                    END                                                  AS RVW_SOM_CNT
                    ,CASE
                        WHEN DOO.CPO_SRC_TP_CD = #cpoSrcTpDealConfig#
                            AND  DOO.SRC_REF_OR_CPO_ORD_NUM &lt;&gt; DOO.ORD_SRC_REF_NUM THEN SRC_REF_OR_CPO_ORD_NUM
                        ELSE NULL
                    END                                                  AS ACPT_DEAL_CONFIG_CNT
                    ,CASE
                        WHEN DOO.CPO_SRC_TP_CD = #cpoSrcTpSom#
                            AND  DOO.SRC_REF_OR_CPO_ORD_NUM &lt;&gt; DOO.ORD_SRC_REF_NUM THEN SRC_REF_OR_CPO_ORD_NUM
                        ELSE NULL
                    END                                                  AS ACPT_SOM_CNT
                FROM
                    <!-- 2019/03/05 QC#30694 Mod Start -->
                    (
                    SELECT
                        EZCANCELFLAG
                        , GLBL_CMPY_CD
                        , DS_ALL_ORD_PK
                        , SRC_REF_OR_CPO_ORD_NUM
                        , CPO_DTL_LINE_NUM
                        , CPO_DTL_LINE_SUB_NUM
                        , DS_ORD_POSN_NUM
                        , DS_CPO_LINE_NUM
                        , DS_CPO_LINE_SUB_NUM
                        , DS_CPO_RTRN_LINE_NUM
                        , DS_CPO_RTRN_LINE_SUB_NUM
                        , DS_CPO_CONFIG_PK
                        , SHPG_PLN_NUM
                        , PRCH_REQ_NUM
                        , PO_ORD_NUM
                        , SO_NUM
                        , SO_SLP_NUM
                        , INV_NUM
                        , INV_BOL_LINE_NUM
                        , INV_LINE_NUM
                        , INV_LINE_SUB_NUM
                        , INV_LINE_SUB_TRX_NUM
                        , DS_INV_SLS_CR_PK
                        , ADD_ORIG_CPO_ORD_NUM
                        , CUST_ISS_PO_NUM
                        , LEASE_CMPY_PO_NUM
                        , SOLD_TO_CUST_ACCT_NM
                        , SOLD_TO_CUST_ACCT_CD
                        , SOLD_TO_CUST_LOC_CD
                        , SHIP_TO_CUST_ACCT_NM
                        , SHIP_TO_CUST_ACCT_CD
                        , SHIP_TO_CUST_LOC_CD
                        , BILL_TO_CUST_ACCT_NM
                        , BILL_TO_CUST_ACCT_CD
                        , BILL_TO_CUST_LOC_CD
                        , COA_BR_CD
                        , COA_BR_DESC_TXT
                        , COA_EXTN_CD
                        , COA_EXTN_DESC_TXT
                        , SLS_REP_TOC_CD
                        , SLS_REP_TOC_NM
                        , CPO_SRC_TP_CD
                        , CPO_SRC_TP_DESC_TXT
                        , DS_ORD_CATG_CD
                        , DS_ORD_CATG_DESC_TXT
                        , DS_ORD_TP_CD
                        , DS_ORD_TP_DESC_TXT
                        , DS_ORD_RSN_CD
                        , DS_ORD_RSN_DESC_TXT
                        , CSMP_CONTR_NUM
                        , PRC_CONTR_NUM
                        , PRC_CONTR_NM
                        , ORD_SRC_REF_NUM
                        , IMPT_STS_CD
                        , ZEROTH_PROD_CTRL_CD
                        , ZEROTH_PROD_CTRL_NM
                        , FIRST_PROD_CTRL_CD
                        , FIRST_PROD_CTRL_NM
                        , SCD_PROD_CTRL_CD
                        , SCD_PROD_CTRL_NM
                        , THIRD_PROD_CTRL_CD
                        , THIRD_PROD_CTRL_NM
                        , FRTH_PROD_CTRL_CD
                        , FRTH_PROD_CTRL_NM
                        , FIFTH_PROD_CTRL_CD
                        , FIFTH_PROD_CTRL_NM
                        , MDSE_CD
                        , MDSE_DESC_SHORT_TXT
                        , COA_PROD_CD
                        , COA_PROD_DESC_TXT
                        , COA_MDSE_TP_CD
                        , COA_MDSE_TP_DESC_TXT
                        , REV_COA_ACCT_CD
                        , REV_TRIAL_BAL_TP_CD
                        , MDL_ID
                        , T_MDL_NM
                        , SER_NUM
                        , RTRN_RSN_CD
                        , RTRN_RSN_DESC_TXT
                        , ACTL_SHIP_DT
                        , INV_DT
                        , ORD_LINE_SRC_CD
                        , ORD_LINE_SRC_NM
                        , RTL_WH_CD
                        , RTL_WH_NM
                        , RTL_SWH_CD
                        , RTL_SWH_NM
                        , INVTY_LOC_CD
                        , VND_NM
                        , DROP_SHIP_FLG
                        , DS_CONTR_NUM
                        , SVC_CONFIG_MSTR_PK
                        , CRAT_BY_USR_ID
                        , CPO_ORD_TS
                        , ORD_BOOK_TS
                        , ORD_HDR_STS_CD
                        , ORD_LINE_STS_CD
                        , RTRN_LINE_STS_CD
                        , ORD_HDR_DPLY_STS_NM
                        , ORD_LINE_DPLY_STS_NM
                        , ORD_RTRN_LINE_DPLY_STS_NM
                        , CONFIG_CATG_CD
                        , SLS_REP_OR_SLS_TEAM_TOC_CD
                        , SLS_REP_OR_SLS_TEAM_TOC_NM
                        , ISTL_DT
                        , RDD_DT
                        , PSD_DT
                        , PDD_DT
                        , PRC_CATG_CD
                        , PRC_CATG_DESC_TXT
                        , ORD_QTY
                        , CR_HLD_QTY
                        , CR_CHK_QTY
                        , SLS_HLD_QTY
                        , ENT_CPO_DTL_FUNC_NET_AMT
                        , ENT_CPO_DTL_FUNC_SLS_AMT
                        , SP_FUNC_UNIT_PRC_AMT
                        , SP_FUNC_NET_UNIT_PRC_AMT
                        , SP_TOT_FUNC_NET_AMT
                        , LINE_BIZ_TP_CD
                        , LINE_BIZ_TP_DESC_TXT
                        , DS_ORD_LINE_CATG_CD
                        , DS_ORD_LINE_CATG_DESC_TXT
                        , SVC_MACH_MSTR_PK
                        , INV_LINE_FUNC_NET_AMT
                        , FUNC_GRS_TOT_PRC_AMT
                        , FUNC_SLS_CR_AMT
                        , TRX_CD
                        , TRX_RSN_CD
                        , DFRD_REV_FLG
                        , ORD_AGING_BCKT_DESC_TXT
                        , ORD_SRC_IMPT_DT
                        , DPLY_VND_NM
                        , DS_CPO_CRAT_USR_ID
                        , SLS_REP_PSN_NUM
                        , AQU_NUM
                        , RTL_WH_DESC_TXT
                        , COUNT(1) OVER ( 
                                        PARTITION BY
                                          SRC_REF_OR_CPO_ORD_NUM
                                          , SHPG_PLN_NUM
                                          , CONFIG_CATG_CD
                                          , DS_ORD_POSN_NUM
                                          , DS_CPO_LINE_NUM
                                          , DS_CPO_LINE_SUB_NUM
                                      ) AS COUNT_FOR_SER_NUM
                    FROM
                        DS_ALL_ORD
                    ) DOO
                    <!-- 2018/12/14 QC#29024 Mod Start -->
                    <!-- DS_ALL_ORD DOO -->
                    <!-- DS_OPEN_ORD DOO -->
                    <!-- 2018/12/14 QC#29024 Mod End -->
                    <!-- 2019/03/05 QC#30694 Mod End -->
                    <isEqual property="teamSearchFlg" compareValue="Y">
                    ,TMZN
                    </isEqual>
                    <!-- 2018/06/27 QC#26837 Add Start -->
                    <isEqual property="allCsaFlg" compareValue="N">
                    ,AUTH_PSN PSN<!-- 2017/01/24 S21_NA#16992 Add -->
                    </isEqual>
                    <!-- 2018/06/27 QC#26837 Add End -->
                WHERE
                    DOO.GLBL_CMPY_CD = #glblCmpyCd#
                    AND DOO.EZCANCELFLAG = '0'
                    <isNotNull property="searchCondition_OpenOrder">
                    $searchCondition_OpenOrder$
                    </isNotNull>
                    <isEqual property="teamSearchFlg" compareValue="Y">
                    AND DOO.CRAT_BY_USR_ID =
                        CASE
                        WHEN
                            TMZN.CRAT_BY_USR_ID IS NULL
                        THEN
                            DOO.CRAT_BY_USR_ID
                        ELSE
                            TMZN.CRAT_BY_USR_ID
                        END
                    AND (DOO.SOLD_TO_CUST_ACCT_CD =
                        CASE
                        WHEN
                            TMZN.CUST_ACCT_CD IS NULL
                        THEN
                            DOO.SOLD_TO_CUST_ACCT_CD
                        ELSE
                            TMZN.CUST_ACCT_CD
                        END
                        OR DOO.SHIP_TO_CUST_ACCT_CD =
                        CASE
                        WHEN
                            TMZN.CUST_ACCT_CD IS NULL
                        THEN
                            DOO.SHIP_TO_CUST_ACCT_CD
                        ELSE
                            TMZN.CUST_ACCT_CD
                        END
                        OR DOO.BILL_TO_CUST_ACCT_CD =
                        CASE
                        WHEN
                            TMZN.CUST_ACCT_CD IS NULL
                        THEN
                            DOO.BILL_TO_CUST_ACCT_CD
                        ELSE
                            TMZN.CUST_ACCT_CD
                        END)
                    AND DOO.LINE_BIZ_TP_CD =
                        CASE
                        WHEN
                            TMZN.LINE_BIZ_TP_CD IS NULL
                        THEN
                            DOO.LINE_BIZ_TP_CD
                        ELSE
                            TMZN.LINE_BIZ_TP_CD
                        END
                    AND DOO.COA_BR_CD =
                        CASE
                        WHEN
                            TMZN.COA_BR_CD IS NULL
                        THEN
                            DOO.COA_BR_CD
                        ELSE
                            TMZN.COA_BR_CD
                        END
                    </isEqual>
                    <!-- 2017/01/24 S21_NA#16992 Add Start -->
                    <!-- 2018/06/27 QC#26837 Add Start -->
                    <isEqual property="allCsaFlg" compareValue="N">
                    AND DOO.GLBL_CMPY_CD = PSN.GLBL_CMPY_CD(+)
                    AND DOO.CRAT_BY_USR_ID = PSN.USR_NM(+)
                    AND PSN.EZCANCELFLAG(+) = '0'
                    </isEqual>
                    <!-- 2018/06/27 QC#26837 Add End -->
                    <!-- 2017/01/24 S21_NA#16992 Add End -->
            )
            GROUP BY
                GLBL_CMPY_CD
                ,$cMsg.xxScrItem50Txt$
                <isNotNull property="pairDplyByItemNm_01">
                ,$pairDplyByItemNm_01$
                </isNotNull>
                <!-- 2017/01/24 QC#20098 Mod Start -->
                <isEqual property="dispByCratUsrId" compareValue="Y">
                ,USR_ID
                </isEqual>
                <!-- 2017/01/24 QC#20098 Mod End -->
            ORDER BY
                GLBL_CMPY_CD
                ,$cMsg.xxScrItem50Txt$
                <isNotNull property="pairDplyByItemNm_01">
                ,$pairDplyByItemNm_01$
                </isNotNull>
        )
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

</sqlMap>
