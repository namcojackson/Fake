<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NLCL0610Query">

    <typeAlias alias="NLCL0610_ASMsg" type="business.blap.NLCL0610.NLCL0610_ASMsg"/>
    <statement id="searchPiList" resultMap="result.searchPiList">
        SELECT
            PI.RTL_WH_CD
           ,PI.RTL_WH_NM
           ,PI.RTL_SWH_CD
           ,PI.RTL_SWH_NM
           ,PI.INVTY_LOC_CD
           ,PI.PHYS_INVTY_DT 
           ,PI.PHYS_INVTY_CTRL_NM 
           ,PI.LOC_TP_CD
           ,PI.PHYS_INVTY_NUM
           ,PI.PHYS_INVTY_STS_CD
           ,PI.PHYS_INVTY_STS_NM
           ,PI.PHYS_INVTY_START_TS
           ,PI.PHYS_INVTY_CTRL_DESC_NM
        FROM(
            SELECT
                DRWV.RTL_WH_CD
               ,DRWV.RTL_WH_NM
               ,DRWV.RTL_SWH_CD
               ,DRWV.RTL_SWH_NM
               ,DRWV.INVTY_LOC_CD
               ,PIC.PHYS_INVTY_DT 
               ,PIC.PHYS_INVTY_CTRL_NM 
               ,PIC.LOC_TP_CD
               ,PIC.PHYS_INVTY_NUM
               ,PIC.PHYS_INVTY_STS_CD
               ,PIC.PHYS_INVTY_STS_NM
               ,PIC.PHYS_INVTY_START_TS
               ,PIC.PHYS_INVTY_CTRL_DESC_NM
            FROM
                PHYS_INVTY_CTRL PIC
               ,DS_RTL_WH_V DRWV
            WHERE
                PIC.GLBL_CMPY_CD        = #glblCmpyCd#
        <isNotNull property="rtlWhCd">
            AND PIC.RTL_WH_CD           LIKE #rtlWhCd#
        </isNotNull>
        <isNotNull property="physInvtyDtFrom">
            AND PIC.PHYS_INVTY_DT       &gt;= #physInvtyDtFrom#
        </isNotNull>
        <isNotNull property="physInvtyDtThru">
            AND PIC.PHYS_INVTY_DT       &lt;= #physInvtyDtThru#
        </isNotNull>
        <isNotNull property="physInvtyCtrlNm">
            AND PIC.PHYS_INVTY_CTRL_NM  LIKE #physInvtyCtrlNm#
        </isNotNull>
        <iterate property="whPilocTpCdList" var="whPilocTpCd[]" open="AND PIC.LOC_TP_CD IN (" close=") " conjunction=",">
            #whPilocTpCd[]#
        </iterate>
        <iterate property="whPiWhOwnrCdList" var="whPiWhOwnrCd[]" open="AND DRWV.WH_OWNR_CD IN (" close=") " conjunction=",">
            #whPiWhOwnrCd[]#
        </iterate>
            AND PIC.GLBL_CMPY_CD        = DRWV.GLBL_CMPY_CD
            AND PIC.WH_CD               = DRWV.INVTY_LOC_CD
            AND PIC.EZCANCELFLAG        = '0'
            AND DRWV.EZCANCELFLAG       = '0'
            ORDER BY
                PIC.PHYS_INVTY_NUM
               ,PIC.WH_CD
            ) PI
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <resultMap id="result.searchPiList" class="NLCL0610_ASMsg">
        <result property="rtlWhCd_A"                column="RTL_WH_CD"                   javaType="EZDSStringItem"/>
        <result property="rtlWhNm_A"                column="RTL_WH_NM"                   javaType="EZDSStringItem"/>
        <result property="rtlSwhCd_A"               column="RTL_SWH_CD"                  javaType="EZDSStringItem"/>
        <result property="rtlSwhNm_A"               column="RTL_SWH_NM"                  javaType="EZDSStringItem"/>
        <result property="physInvtyDt_A"            column="PHYS_INVTY_DT"               javaType="EZDSDateItem"/>
        <result property="physInvtyCtrlNm_A"        column="PHYS_INVTY_CTRL_NM"          javaType="EZDSStringItem"/>
        <result property="physInvtyNum_A"           column="PHYS_INVTY_NUM"              javaType="EZDSStringItem"/>
        <result property="physInvtyStsNm_A"         column="PHYS_INVTY_STS_NM"           javaType="EZDSStringItem"/>
        <result property="physInvtyStartTs_A"       column="PHYS_INVTY_START_TS"         javaType="EZDSStringItem"/>
        <result property="physInvtyCtrlDescNm_A"    column="PHYS_INVTY_CTRL_DESC_NM"     javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="countPiForEdit" resultMap="Integer">
        SELECT
            COUNT(PHYS_INVTY_CTRL_PK) AS CNT_SCHEDULED
        FROM
            PHYS_INVTY_CTRL PIC
        WHERE
            PIC.GLBL_CMPY_CD        = #glblCmpyCd#
        AND PIC.PHYS_INVTY_NUM      = #physInvtyNum#
        AND PIC.PHYS_INVTY_STS_CD   = #physInvtyStsCdScheduled#
        AND PIC.EZCANCELFLAG        = '0'
    </statement>
    <!-- 2016/11/08 CITS R.Shimamoto Add Start. V0.2 -->
    <statement id="countPiForCancel" resultMap="Integer">
        SELECT
            COUNT(PHYS_INVTY_CTRL_PK) AS CNT_SCHEDULED
        FROM
            PHYS_INVTY_CTRL PIC
        WHERE
            PIC.GLBL_CMPY_CD           = #glblCmpyCd#
        AND PIC.PHYS_INVTY_NUM         = #physInvtyNum#
        AND NOT(PIC.PHYS_INVTY_STS_CD  = #physInvtyStsCdScheduled#
        OR (PIC.PHYS_INVTY_STS_CD      = #physInvtyStsCdOpen#
        <iterate property="techPiCancCntStsCd" var="techPiCancCntStsCdList[]" open="AND PIC.PHYS_INVTY_CNT_STS_CD IN (" conjunction= ", " close=")))">
            #techPiCancCntStsCdList[]#
        </iterate>
        AND PIC.EZCANCELFLAG        = '0'
    </statement>
    <!-- 2016/11/08 CITS R.Shimamoto Add End. V0.2 -->
    <statement id="getWarehouseName" parameterClass="Map"
        resultClass="Map">
        SELECT
            RW.RTL_WH_CD
            ,RW.RTL_WH_NM
            ,RW.LOC_TP_CD
        FROM
            RTL_WH RW
        WHERE
                RW.GLBL_CMPY_CD                        =    #glblCmpyCd#
            AND RW.RTL_WH_CD                           =    #rtlWhCd#
            <iterate property="whPilocTpCdList" var="whPilocTpCdList[]" open=" AND RW.LOC_TP_CD IN (" close=")" conjunction=",">
                #whPilocTpCdList[]#
            </iterate>
            
            <iterate property="whPiWhOwnrCdList" var="whPiWhOwnrCdList[]" open=" AND RW.WH_OWNR_CD IN (" close=")" conjunction=",">
                #whPiWhOwnrCdList[]#
            </iterate>
            AND RW.EZCANCELFLAG                        =    '0'
    </statement>
</sqlMap>
