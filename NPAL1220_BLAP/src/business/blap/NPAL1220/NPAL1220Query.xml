<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NPAL1220Query">
    <typeAlias alias="NPAL1220CMsg" type="business.blap.NPAL1220.NPAL1220CMsg" />
    <typeAlias alias="NPAL1220SMsg" type="business.blap.NPAL1220.NPAL1220SMsg" />
    <typeAlias alias="NPAL1220_ASMsg" type="business.blap.NPAL1220.NPAL1220_ASMsg" />

    <statement id="getSearchOptionPulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            SSO.SRCH_OPT_PK
           ,SSO.SRCH_OPT_NM
        FROM
            SAVE_SRCH_OPT SSO
        WHERE
                SSO.GLBL_CMPY_CD    = #glblCmpyCd#
            AND SSO.SRCH_OPT_APL_ID = #srchOptAplId#
            AND SSO.SRCH_OPT_USR_ID = #srchOptUsrId#
            AND SSO.EZCANCELFLAG    = '0'
        ORDER BY
            SSO.SRCH_OPT_NM ASC
    </statement>
    <statement id="getQualifierTypePulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            AQT.ASL_QLFY_TP_CD
           ,AQT.ASL_QLFY_TP_DESC_TXT
        FROM
            ASL_QLFY_TP AQT
        WHERE
                AQT.GLBL_CMPY_CD    = #glblCmpyCd#
            AND AQT.EZCANCELFLAG    = '0'
        ORDER BY
            AQT.ASL_QLFY_TP_SORT_NUM ASC
    </statement>
    <statement id="getMerchandiseTypePulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            CP.COA_PROJ_CD
           ,CP.COA_PROJ_DESC_TXT
        FROM
            COA_PROJ CP
        WHERE
                CP.GLBL_CMPY_CD     = #glblCmpyCd#
            AND CP.EZCANCELFLAG     = '0'
        ORDER BY
            CP.COA_PROJ_SORT_NUM ASC
    </statement>
    <statement id="getItemDescription" parameterClass="Map"
        resultClass="String">
        SELECT
            DMI.MDSE_DESC_SHORT_TXT
        FROM
            MDSE    DMI
        WHERE
                DMI.GLBL_CMPY_CD    = #glblCmpyCd#
            AND DMI.MDSE_CD         = #mdseCd#
            AND DMI.EZCANCELFLAG    = '0'
    </statement>
    <statement id="getSupplierName" parameterClass="Map"
        resultClass="String">
        SELECT
              PV.PRNT_VND_NM
        FROM
              PRNT_VND PV
        WHERE
                PV.GLBL_CMPY_CD     = #glblCmpyCd#
            AND PV.PRNT_VND_CD      = #prntVndCd#
            AND PV.EZCANCELFLAG     = '0'
    </statement>
    <!-- START 2018/01/11 S.Katsuma [QC#12226,ADD] -->
    <statement id="getSupplierSiteName" parameterClass="Map"
        resultClass="String">
        SELECT
              V.LOC_NM
        FROM
              VND V
        WHERE
                V.GLBL_CMPY_CD     = #glblCmpyCd#
            AND V.VND_CD           = #vndCd#
            AND V.EZCANCELFLAG     = '0'
    </statement>
    <!-- END 2018/01/11 S.Katsuma [QC#12226,ADD] -->
    <statement id="search" parameterClass="Map"
        resultMap="result.NPAL1220_ASMsg">
        WITH ASL_QLFY_RELN_CNT AS (
            SELECT
                 AQR.GLBL_CMPY_CD
                ,AQR.ASL_HDR_PK
                ,MIN(AQR.ASL_QLFY_TP_CD)    AS ASL_QLFY_TP_CD_MIN
                ,MAX(AQR.ASL_QLFY_TP_CD)    AS ASL_QLFY_TP_CD_MAX
                ,MIN(AQR.ASL_QLFY_REF_CD)   AS ASL_QLFY_REF_CD_MIN
                ,MAX(AQR.ASL_QLFY_REF_CD)   AS ASL_QLFY_REF_CD_MAX
            FROM
                ASL_QLFY_RELN AQR
            WHERE
                1=1
            <isNotNull property="cMsg.aslQlfyTpCd_SL">
                AND AQR.ASL_QLFY_TP_CD      = #cMsg.aslQlfyTpCd_SL#
            </isNotNull>
            <isNotNull property="cMsg.aslQlfyRefCd">
                AND AQR.ASL_QLFY_REF_CD     LIKE #cMsg.aslQlfyRefCd#
            </isNotNull>
                AND AQR.EZCANCELFLAG        = '0'
            GROUP BY
                 AQR.GLBL_CMPY_CD
                ,AQR.ASL_HDR_PK
        )
        SELECT
             ASL_HDR_PK 
            ,ASL_NM
            <!-- START 2018/01/11 S.Katsuma [QC#12226,ADD] -->
            ,PRNT_VND_CD
            <!-- END 2018/01/11 S.Katsuma [QC#12226,ADD] -->
            ,PRNT_VND_NM
            ,MDSE_CD
            ,MDSE_DESC_SHORT_TXT
            ,COA_MDSE_TP_CD
            ,SPLY_ITEM_NUM
            ,UNIT_PRC_AMT
            ,ASL_QLFY_TP_DESC_TXT
            ,ASL_QLFY_REF_CD
            ,COA_PROJ_DESC_TXT
            <!-- START 2018/01/11 S.Katsuma [QC#12226,ADD] -->
            ,VND_CD
            ,LOC_NM
            ,PRIM_SPLY_FLG
            <!-- END 2018/01/11 S.Katsuma [QC#12226,ADD] -->
        FROM
            (
                SELECT
                     ASL_HDR_PK 
                    ,ASL_NM
                    <!-- START 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                    ,PRNT_VND_CD
                    <!-- END 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                    ,PRNT_VND_NM
                    ,MDSE_CD
                    ,MDSE_DESC_SHORT_TXT
                    ,COA_MDSE_TP_CD
                    ,SPLY_ITEM_NUM
                    ,UNIT_PRC_AMT
                    ,ASL_QLFY_TP_DESC_TXT
                    ,ASL_QLFY_REF_CD
                    ,COA_PROJ_DESC_TXT
                    <!-- START 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                    ,VND_CD
                    ,LOC_NM
                    ,PRIM_SPLY_FLG
                    <!-- END 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                FROM
                    (
                        SELECT
                             AH.ASL_HDR_PK 
                            ,AH.ASL_NM
                            <!-- START 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                            ,PV.PRNT_VND_CD
                            <!-- END 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                            ,PV.PRNT_VND_NM
                            ,AD.MDSE_CD
                            ,AD.EFF_FROM_DT
                            ,DMI.MDSE_DESC_SHORT_TXT
                            ,AD.COA_MDSE_TP_CD
                            ,AD.SPLY_ITEM_NUM
                            ,AD.UNIT_PRC_AMT
                            ,CASE
                                WHEN AQRC.ASL_QLFY_TP_CD_MIN &lt;&gt; AQRC.ASL_QLFY_TP_CD_MAX THEN 'Multiple'
                                ELSE AQT.ASL_QLFY_TP_DESC_TXT
                             END AS ASL_QLFY_TP_DESC_TXT
                            ,CASE
                                WHEN AQRC.ASL_QLFY_REF_CD_MIN &lt;&gt; AQRC.ASL_QLFY_REF_CD_MAX THEN 'Multiple'
                                ELSE AQRC.ASL_QLFY_REF_CD_MIN
                             END AS ASL_QLFY_REF_CD
                            ,CMT.COA_PROJ_DESC_TXT
                            <!-- START 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                            ,AD.VND_CD
                            ,V.LOC_NM
                            ,AD.PRIM_SPLY_FLG
                            <!-- END 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                        FROM
                             ASL_HDR            AH
                            ,ASL_DTL            AD
                            ,ASL_QLFY_RELN_CNT  AQRC
                            ,ASL_QLFY_TP        AQT
                            ,COA_PROJ           CMT
                            ,PRNT_VND           PV
                            ,MDSE               DMI
                            <!-- START 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                            ,VND                V
                            <!-- END 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                        WHERE
                                AH.GLBL_CMPY_CD         = #glblCmpyCd#
                        <isNotNull property="cMsg.aslNm">
                            AND AH.ASL_NM               LIKE #cMsg.aslNm#
                        </isNotNull>
                        <isNotNull property="cMsg.prntVndCd">
                            AND AH.PRNT_VND_CD          = #cMsg.prntVndCd#
                        </isNotNull>
                            AND AH.GLBL_CMPY_CD         = AD.GLBL_CMPY_CD(+)
                            AND AH.ASL_HDR_PK           = AD.ASL_HDR_PK(+)
                        <isNotNull property="cMsg.splyItemNum">
                            AND AD.SPLY_ITEM_NUM    LIKE #cMsg.splyItemNum#
                        </isNotNull>
                        <isNotNull property="cMsg.mdseCd">
                            AND AD.MDSE_CD           LIKE #cMsg.mdseCd#
                        </isNotNull>
                        <isNotNull property="cMsg.coaMdseTpCd_SL">
                            AND AD.COA_MDSE_TP_CD       = #cMsg.coaMdseTpCd_SL#
                        </isNotNull>
                        <isNotNull property="cMsg.actvFlg">
                            AND NVL(AD.EFF_FROM_DT,'19000101')     &lt;= #salesDate#
                            AND NVL(AD.EFF_THRU_DT,'99991231')     &gt;= #salesDate#
                        </isNotNull>
                            AND AH.GLBL_CMPY_CD         = AQRC.GLBL_CMPY_CD(+)
                            AND AH.ASL_HDR_PK           = AQRC.ASL_HDR_PK(+)
                        <isNotNull property="cMsg.aslQlfyRefCd">
                            AND AQRC.ASL_QLFY_REF_CD_MIN LIKE #cMsg.aslQlfyRefCd#
                        </isNotNull>
                        <isNotNull property="cMsg.aslQlfyTpCd_SL">
                            AND AQRC.ASL_QLFY_TP_CD_MIN = #cMsg.aslQlfyTpCd_SL#
                        </isNotNull>
                        <!-- START 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                        <isNotNull property="cMsg.vndCd">
                            AND AD.VND_CD               = #cMsg.vndCd#
                        </isNotNull>
                        <isNotNull property="cMsg.locNm">
                            AND V.LOC_NM                = #cMsg.locNm#
                        </isNotNull>
                        <!-- END 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                            AND AQRC.GLBL_CMPY_CD       = AQT.GLBL_CMPY_CD(+)
                            AND AQRC.ASL_QLFY_TP_CD_MIN = AQT.ASL_QLFY_TP_CD(+)
                            AND AD.GLBL_CMPY_CD         = CMT.GLBL_CMPY_CD(+)
                            AND AD.COA_MDSE_TP_CD       = CMT.COA_PROJ_CD(+)
                            AND AH.GLBL_CMPY_CD         = PV.GLBL_CMPY_CD(+)
                            AND AH.PRNT_VND_CD          = PV.PRNT_VND_CD(+)
                            AND AD.GLBL_CMPY_CD         = DMI.GLBL_CMPY_CD(+)
                            AND AD.MDSE_CD              = DMI.MDSE_CD(+)
                            <!-- START 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                            AND AD.GLBL_CMPY_CD         = V.GLBL_CMPY_CD(+)
                            AND AD.VND_CD               = V.VND_CD(+)
                            <!-- END 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                            AND AH.EZCANCELFLAG         = '0'
                            AND AD.EZCANCELFLAG(+)      = '0'
                            AND AQT.EZCANCELFLAG(+)     = '0'
                            AND CMT.EZCANCELFLAG(+)     = '0'
                            AND PV.EZCANCELFLAG(+)      = '0'
                            AND DMI.EZCANCELFLAG(+)     = '0'
                            <!-- START 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                            AND V.EZCANCELFLAG(+)     = '0'
                            <!-- END 2018/01/11 S.Katsuma [QC#12226,ADD] -->
                    ) ASL
                ORDER BY
                    ASL_NM          ASC
                   ,MDSE_CD         ASC
                   ,EFF_FROM_DT     ASC
                   ,ASL_QLFY_REF_CD ASC
            ) ASL_SORTED
        WHERE
            ROWNUM &lt; #rowNum#
    </statement>
    <resultMap id="result.NPAL1220_ASMsg" class="NPAL1220_ASMsg">
        <result property="aslHdrPk_A1"           column="ASL_HDR_PK"             javaType="EZDCBigDecimalItem"/>
        <result property="aslNm_A1"              column="ASL_NM"                 javaType="EZDSStringItem"/>
        <result property="prntVndNm_A1"          column="PRNT_VND_NM"            javaType="EZDSStringItem"/>
        <result property="mdseCd_A1"             column="MDSE_CD"                javaType="EZDSStringItem"/>
        <result property="mdseDescShortTxt_A1"   column="MDSE_DESC_SHORT_TXT"    javaType="EZDSStringItem"/>
        <result property="coaMdseTpCd_A1"        column="COA_MDSE_TP_CD"         javaType="EZDSStringItem"/>
        <result property="splyItemNum_A1"        column="SPLY_ITEM_NUM"          javaType="EZDSStringItem"/>
        <result property="unitPrcAmt_A1"         column="UNIT_PRC_AMT"           javaType="EZDCBigDecimalItem"/>
        <result property="aslQlfyTpDescTxt_A1"   column="ASL_QLFY_TP_DESC_TXT"   javaType="EZDSStringItem"/>
        <result property="aslQlfyRefCd_A1"       column="ASL_QLFY_REF_CD"        javaType="EZDSStringItem"/>
        <result property="coaProjDescTxt_A1"     column="COA_PROJ_DESC_TXT"      javaType="EZDSStringItem"/>
        <!-- START 2018/01/11 S.Katsuma [QC#12226,ADD] -->
        <result property="prntVndCd_A1"          column="PRNT_VND_CD"            javaType="EZDSStringItem"/>
        <result property="vndCd_A1"              column="VND_CD"                 javaType="EZDSStringItem"/>
        <result property="locNm_A1"              column="LOC_NM"                 javaType="EZDSStringItem"/>
        <result property="primSplyFlg_A1"        column="PRIM_SPLY_FLG"          javaType="EZDSStringItem"/>
        <!-- END 2018/01/11 S.Katsuma [QC#12226,ADD] -->
    </resultMap>
</sqlMap>