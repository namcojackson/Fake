<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL0630Query">
    <typeAlias alias="NSAL0630_ASMsg" type="business.blap.NSAL0630.NSAL0630_ASMsg"/>

    <statement id="getContrInfo" parameterClass="Map" resultMap="result.getContrInfo">
        SELECT
             DCH.EZUPTIME                       AS EZUPTIME
            ,DCH.EZUPTIMEZONE                   AS EZUPTIMEZONE
            <!-- START 2017/08/31 K.Kim [QC#20578, MOD] -->
            <!--,CASE WHEN DCS.DS_CONTR_STS_CD = #dsContrStsCdIsExpired# THEN 'Y' -->
            <!--      WHEN DCS.DS_CONTR_STS_CD = #dsContrStsCdIsCancelled# THEN 'Y' -->
            <!--      WHEN DCS.DS_CONTR_STS_CD = #dsContrStsCdIsTerminated# THEN 'Y' -->
            <!--      WHEN DCS.CONTR_HLD_FLG = 'Y' THEN 'Y' -->
            <!--      ELSE 'N' -->
            ,CASE WHEN DCS.CONTR_HLD_FLG = 'Y' THEN 'Y'
                  WHEN DCS.DS_CONTR_CTRL_STS_CD = #dsContrStsCdIsActive# THEN 'N'
                  WHEN DCS.DS_CONTR_CTRL_STS_CD = #dsContrStsCdIsSigned# THEN 'N'
                  ELSE 'Y'
            <!-- END 2017/08/31 K.Kim [QC#20578, MOD] -->
             END                                AS XX_DPLY_CTRL_FLG
            ,DCH.DS_CONTR_PK                    AS DS_CONTR_PK
            ,DCH.DS_CONTR_CATG_CD               AS DS_CONTR_CATG_CD
            ,DCH.DS_CONTR_NUM                   AS DS_CONTR_NUM
            ,TRIM(DCH.DS_CONTR_CATG_CD
                || '-' || DCH.DS_CONTR_NUM)     AS CONTR_NUM_TXT
            ,DAC.DS_ACCT_NM                     AS DS_ACCT_NM
            ,TRIM(BTC.FIRST_LINE_ADDR 
                || ',' || BTC.SCD_LINE_ADDR
                || ',' || BTC.CTY_ADDR
                || ',' || BTC.ST_CD
                || ',' || BTC.POST_CD)          AS BILL_TO_CUST_LOC_ADDR
            ,DCH.CONTR_VRSN_EFF_FROM_DT         AS CONTR_VRSN_EFF_FROM_DT
            ,DCH.CONTR_VRSN_EFF_THRU_DT         AS CONTR_VRSN_EFF_THRU_DT
            ,DCS.DS_CONTR_CTRL_STS_NM           AS DS_CONTR_CTRL_STS_NM
            <!-- START 2017/08/31 K.Kim [QC#20578, ADD] -->
            ,DCS.DS_CONTR_CTRL_STS_CD           AS DS_CONTR_CTRL_STS_CD
            <!-- END 2017/08/31 K.Kim [QC#20578, ADD] -->
        FROM
             DS_CONTR        DCH
            ,SELL_TO_CUST    DAC
            ,BILL_TO_CUST    BTC
            ,DS_CONTR_STS_V  DCS
        WHERE
                DCH.GLBL_CMPY_CD        = #glblCmpyCd#
            <iterate property="dsContrPkList" var="dsContrPk[]" open="AND DCH.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND DCH.DS_CONTR_CATG_CD    &lt;&gt; #dsContrCatgCdIsWty#
            AND DCH.EZCANCELFLAG        = '0'
            AND DCH.GLBL_CMPY_CD        = DAC.GLBL_CMPY_CD
            AND DCH.DS_ACCT_NUM         = DAC.SELL_TO_CUST_CD
            AND DAC.EZCANCELFLAG        = '0'
            AND DCH.GLBL_CMPY_CD        = BTC.GLBL_CMPY_CD
            AND DCH.ALT_PAYER_CUST_CD   = BTC.BILL_TO_CUST_CD
            AND BTC.EZCANCELFLAG        = '0'
            AND DCH.GLBL_CMPY_CD        = DCS.GLBL_CMPY_CD
            AND DCH.DS_CONTR_PK         = DCS.DS_CONTR_PK
            AND DCS.EZCANCELFLAG        = '0'
            AND ROWNUM                  &lt;= #limitCnt#
        ORDER BY
             DCH.DS_CONTR_CATG_CD ASC NULLS LAST
            ,DCH.DS_CONTR_NUM ASC NULLS LAST
    </statement>
    <resultMap id="result.getContrInfo" class="NSAL0630_ASMsg">
        <result property="ezUpTime_A"              column="EZUPTIME"               javaType="EZDSStringItem" />
        <result property="ezUpTimeZone_A"          column="EZUPTIMEZONE"           javaType="EZDSStringItem" />
        <result property="xxDplyCtrlFlg_A"         column="XX_DPLY_CTRL_FLG"       javaType="EZDSStringItem" />
        <result property="dsContrPk_A"             column="DS_CONTR_PK"            javaType="EZDSBigDecimalItem" />
        <result property="contrNumTxt_A"           column="CONTR_NUM_TXT"          javaType="EZDSStringItem" />
        <result property="dsAcctNm_A"              column="DS_ACCT_NM"             javaType="EZDSStringItem" />
        <result property="billToCustLocAddr_A"     column="BILL_TO_CUST_LOC_ADDR"  javaType="EZDSStringItem" />
        <result property="contrVrsnEffFromDt_A"    column="CONTR_VRSN_EFF_FROM_DT" javaType="EZDSDateItem" />
        <result property="contrVrsnEffThruDt_A"    column="CONTR_VRSN_EFF_THRU_DT" javaType="EZDSDateItem" />
        <result property="dsContrStsDescTxt_A"     column="DS_CONTR_CTRL_STS_NM"   javaType="EZDSStringItem" />
        <!-- START 2017/08/31 K.Kim [QC#20578, ADD] -->
        <result property="dsContrCtrlStsCd_A"      column="DS_CONTR_CTRL_STS_CD"   javaType="EZDSStringItem" />
        <!-- END 2017/08/31 K.Kim [QC#20578, ADD] -->
    </resultMap>

    <!-- START 2017/08/31 K.Kim [QC#20578, ADD] -->
    <statement id="getContrDtlList" parameterClass="Map" resultClass="Map">
       SELECT
            DS_CONTR_DTL_PK
           ,DS_CONTR_CTRL_STS_CD
           ,DS_CONTR_STS_CD

       FROM
            DS_CONTR_DTL_STS_V  A
       WHERE
                 A.GLBL_CMPY_CD                            = #glblCmpyCd#
             AND A.DS_CONTR_PK                             = #dsContrPk#
             AND A.EZCANCELFLAG                            = '0'
    </statement>
    <statement id="getBllgMtrList" parameterClass="Map" resultClass="Map">
       SELECT
            DS_CONTR_BLLG_MTR_PK
           ,DS_CONTR_CTRL_STS_CD
           ,DS_CONTR_STS_CD

       FROM
            DS_CONTR_BLLG_MTR_STS_V  A
       WHERE
                 A.GLBL_CMPY_CD                            = #glblCmpyCd#
             AND A.DS_CONTR_DTL_PK                         = #dsContrDtlPk#
             AND A.EZCANCELFLAG                            = '0'
    </statement>
    <statement id="getPrcEffList" parameterClass="Map" resultClass="Map">
       SELECT
            DS_CONTR_PRC_EFF_PK
           ,DS_CONTR_CTRL_STS_CD
           ,DS_CONTR_STS_CD

       FROM
            DS_CONTR_PRC_EFF_STS_V  A
       WHERE
                 A.GLBL_CMPY_CD                            = #glblCmpyCd#
             AND A.DS_CONTR_DTL_PK                         = #dsContrDtlPk#
             AND A.EZCANCELFLAG                            = '0'
    </statement>
    <!-- END 2017/08/31 K.Kim [QC#20578, ADD] -->

    <!-- START 2023/03/09 E.Sanchez [QC#61230, DEL] -->
    <!-- START 2023/03/02 E.Sanchez [QC#61230, ADD] -->
    <!--
    <statement id="getDsContrStsCd" parameterClass="Map" resultClass="String">
        SELECT
             A.DS_CONTR_STS_CD
        FROM
             DS_CONTR_CTRL_STS A
        WHERE
                A.GLBL_CMPY_CD                 = #glblCmpyCd#
            AND A.DS_CONTR_CTRL_STS_CD         = #dsContrCtrlStsCd#
            AND A.EZCANCELFLAG                 = '0'
    </statement>
    -->
    <!-- END 2023/03/02 E.Sanchez [QC#61230, ADD] -->
    <!-- END 2023/03/09 E.Sanchez [QC#61230, DEL] -->
</sqlMap>

