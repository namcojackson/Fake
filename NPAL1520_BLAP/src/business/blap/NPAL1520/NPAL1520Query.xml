<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NPAL1520Query">
    <typeAlias alias="NPAL1520CMsg" type="business.blap.NPAL1520.NPAL1520CMsg" />
    <typeAlias alias="NPAL1520SMsg" type="business.blap.NPAL1520.NPAL1520SMsg" />
    <typeAlias alias="NPAL1520_ASMsg" type="business.blap.NPAL1520.NPAL1520_ASMsg" />

    <statement id="getSearchOptionPulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
             SSO.SRCH_OPT_PK
            ,SSO.SRCH_OPT_NM
        FROM
            SAVE_SRCH_OPT SSO
        WHERE
                SSO.GLBL_CMPY_CD = #glblCmpyCd#
            AND SSO.SRCH_OPT_APL_ID = #srchOptAplId#
            AND SSO.SRCH_OPT_USR_ID = #srchOptUsrId#
            AND SSO.EZCANCELFLAG = '0'
        ORDER BY
            SSO.SRCH_OPT_NM ASC
    </statement>

    <statement id="getItemDescription" parameterClass="Map"
        resultClass="String">
        SELECT
            AM.MDSE_DESC_SHORT_TXT
        FROM
            ALL_MDSE_V AM
        WHERE
            AM.GLBL_CMPY_CD = #glblCmpyCd#
        AND AM.MDSE_CD      = #mdseCd#
        AND AM.EZCANCELFLAG = '0'
    </statement>

    <statement id="getManagerName" parameterClass="Map"
        resultClass="String">
        SELECT
              SPV.FULL_PSN_NM
        FROM
              S21_PSN_V SPV
        WHERE
                SPV.GLBL_CMPY_CD = #glblCmpyCd#
            AND SPV.PSN_CD = #whMgrPsnCd#
            AND SPV.EZCANCELFLAG = '0'
            AND ROWNUM = 1
    </statement>

    <statement id="search" parameterClass="Map"
        resultMap="result.NPAL1520_ASMsg">
        SELECT /*+ ORDERED USE_NL(MRP AM) */
                MRP.MRP_INFO_PK
               ,MRP.MRP_PLN_NM
               ,MRP.MDSE_CD
               ,AM.MDSE_DESC_SHORT_TXT   AS MDSE_DESC_SHORT_TXT
               ,RWC.RTL_WH_CATG_NM       AS RTL_WH_CATG_NM
               ,MRP.RTL_WH_CD
               ,MRP.RTL_WH_NM
               ,MRP.RTL_SWH_CD
               ,RS.RTL_SWH_NM            AS RTL_SWH_NM
               ,MRP.WH_MGR_PSN_CD
               ,MRP.FULL_PSN_NM
               ,MRP.ROP_QTY
               ,MRP.MAX_INVTY_QTY
               ,MRP.MRP_ENBL_FLG
               ,PR.PROCR_TP_NM           AS PROCR_TP_NM
               ,MRP.SRC_RTL_WH_CD
               ,SRW.RTL_WH_NM            AS SRC_RTL_WH_NM
               ,MRP.SRC_RTL_SWH_CD
               ,SRS.RTL_SWH_NM           AS SRC_RTL_SWH_NM
               <!-- START 2022/10/06 M.Kikushima [QC#60560,ADD] -->
               ,MRP.CALC_ORD_PROC_CD
               <!-- END 2022/10/06 M.Kikushima [QC#60560,ADD] -->
        FROM  ( SELECT
                    X.GLBL_CMPY_CD
                   ,X.MRP_INFO_PK
                   ,X.MRP_PLN_NM
                   ,X.MDSE_CD
                   ,X.RTL_WH_CATG_CD
                   ,X.RTL_WH_CD
                   ,X.RTL_WH_NM
                   ,X.RTL_SWH_CD
                   ,X.WH_MGR_PSN_CD
                   ,X.FULL_PSN_NM
                   ,X.ROP_QTY
                   ,X.MAX_INVTY_QTY
                   ,X.MRP_ENBL_FLG
                   ,X.PROCR_TP_CD
                   ,X.SRC_RTL_WH_CD
                   ,X.SRC_RTL_SWH_CD
                   <!-- START 2022/10/06 M.Kikushima [QC#60560,ADD] -->
                   ,X.CALC_ORD_PROC_CD
                   <!-- END 2022/10/06 M.Kikushima [QC#60560,ADD] -->
                FROM ( SELECT
                            MI.GLBL_CMPY_CD        AS GLBL_CMPY_CD
                           ,MI.MRP_INFO_PK         AS MRP_INFO_PK
                           ,MI.MRP_PLN_NM          AS MRP_PLN_NM
                           ,MI.MDSE_CD             AS MDSE_CD
                           ,MI.RTL_WH_CATG_CD      AS RTL_WH_CATG_CD
                           ,MI.RTL_WH_CD           AS RTL_WH_CD
                           ,RW.RTL_WH_NM           AS RTL_WH_NM
                           ,MI.RTL_SWH_CD          AS RTL_SWH_CD
                           ,RW.WH_MGR_PSN_CD       AS WH_MGR_PSN_CD
                           ,RW.FULL_PSN_NM         AS FULL_PSN_NM
                           ,MI.ROP_QTY             AS ROP_QTY
                           ,MI.MAX_INVTY_QTY       AS MAX_INVTY_QTY
                           ,MI.MRP_ENBL_FLG        AS MRP_ENBL_FLG
                           ,MI.PROCR_TP_CD         AS PROCR_TP_CD
                           ,MI.SRC_RTL_WH_CD       AS SRC_RTL_WH_CD
                           ,MI.SRC_RTL_SWH_CD      AS SRC_RTL_SWH_CD
                           <!-- START 2022/10/06 M.Kikushima [QC#60560,ADD] -->
                           ,MI.CALC_ORD_PROC_CD      AS CALC_ORD_PROC_CD
                           <!-- END 2022/10/06 M.Kikushima [QC#60560,ADD] -->
                    FROM
                            MRP_INFO    MI
                           ,( SELECT 
                                     R.GLBL_CMPY_CD
                                    ,R.EZCANCELFLAG
                                    ,R.RTL_WH_CD
                                    ,R.RTL_WH_NM
                                    ,R.WH_MGR_PSN_CD
                                    ,S.FULL_PSN_NM
                              FROM 
                                     RTL_WH    R
                                    ,S21_PSN_V S
                              WHERE
                                     R.GLBL_CMPY_CD    = #glblCmpyCd#
                              AND    R.EZCANCELFLAG    = '0'
                              AND    R.GLBL_CMPY_CD    = S.GLBL_CMPY_CD(+)
                              AND    S.EZCANCELFLAG(+) = '0'
                              AND    R.WH_MGR_PSN_CD   = S.PSN_CD(+)
                            ) RW
                    WHERE   
                            MI.GLBL_CMPY_CD = #glblCmpyCd#
                    <isNotNull property="cMsg.mrpPlnNm">
                    AND     MI.MRP_PLN_NM LIKE #cMsg.mrpPlnNm#
                    </isNotNull>
                    <isNotNull property="cMsg.mdseCd">
                    AND     MI.MDSE_CD    LIKE #cMsg.mdseCd#
                    </isNotNull>
                    <isNotNull property="cMsg.rtlWhCatgCd_SL">
                    AND     MI.RTL_WH_CATG_CD = #cMsg.rtlWhCatgCd_SL#
                    </isNotNull>
                    <isNotNull property="cMsg.rtlWhCd">
                    AND     MI.RTL_WH_CD      = #cMsg.rtlWhCd#
                    </isNotNull>
                    <isNotNull property="cMsg.rtlSwhCd">
                    AND     MI.RTL_SWH_CD     = #cMsg.rtlSwhCd#
                    </isNotNull>
                    <isNotNull property="cMsg.whMgrPsnCd">
                    AND     RW.WH_MGR_PSN_CD  = #cMsg.whMgrPsnCd#
                    </isNotNull>
                    <isNotNull property="cMsg.procrTpCd_SL">
                    AND     MI.PROCR_TP_CD    = #cMsg.procrTpCd_SL#
                    </isNotNull>
                    <isNotNull property="cMsg.srcRtlWhCd">
                    AND     MI.SRC_RTL_WH_CD  = #cMsg.srcRtlWhCd#
                    </isNotNull>
                    <isNotNull property="cMsg.srcRtlSwhCd">
                    AND     MI.SRC_RTL_SWH_CD = #cMsg.srcRtlSwhCd#
                    </isNotNull>
                    <isNotNull property="cMsg.mrpEnblFlg">
                    AND     MI.MRP_ENBL_FLG   = #cMsg.mrpEnblFlg#
                    </isNotNull>
                    <!-- START 2022/10/06 M.Kikushima [QC#60560,ADD] -->
                    <isNotNull property="cMsg.calcOrdProcCd">
                    AND     MI.CALC_ORD_PROC_CD = #cMsg.calcOrdProcCd#
                    </isNotNull>
                    <!-- END 2022/10/06 M.Kikushima [QC#60560,ADD] -->
                    AND     MI.MRP_INFO_RGTN_STS_CD = #rgtnStsCd#
                    AND     MI.EZCANCELFLAG     = '0'
                    AND     MI.RTL_WH_CD        = RW.RTL_WH_CD(+)
                    AND     MI.GLBL_CMPY_CD     = RW.GLBL_CMPY_CD(+)
                    AND     RW.EZCANCELFLAG(+)  = '0'
                    ORDER BY 
                            MI.MRP_PLN_NM
                           ,MI.MDSE_CD
                    ) X
                WHERE   ROWNUM &lt;= #rowNum#
              ) MRP
              , RTL_SWH     RS
              , RTL_WH_CATG RWC
              , PROCR_TP    PR
              , RTL_WH      SRW
              , RTL_SWH     SRS
              , ALL_MDSE_V  AM
        WHERE
            MRP.GLBL_CMPY_CD    = AM.GLBL_CMPY_CD(+)
        AND MRP.MDSE_CD         = AM.MDSE_CD(+)
        AND AM.EZCANCELFLAG(+)  = '0'
        AND MRP.RTL_WH_CD       = RS.RTL_WH_CD(+)
        AND MRP.RTL_SWH_CD      = RS.RTL_SWH_CD(+)
        AND MRP.GLBL_CMPY_CD    = RS.GLBL_CMPY_CD(+)
        AND RS.EZCANCELFLAG(+)  = '0'
        AND MRP.RTL_WH_CATG_CD  = RWC.RTL_WH_CATG_CD (+)
        AND MRP.GLBL_CMPY_CD    = RWC.GLBL_CMPY_CD(+)
        AND RWC.EZCANCELFLAG(+) = '0'
        AND MRP.PROCR_TP_CD     = PR.PROCR_TP_CD (+)
        AND MRP.GLBL_CMPY_CD    = PR.GLBL_CMPY_CD(+)
        AND PR.EZCANCELFLAG(+)  = '0'
        AND MRP.SRC_RTL_WH_CD   = SRW.RTL_WH_CD (+)
        AND MRP.GLBL_CMPY_CD    = SRW.GLBL_CMPY_CD(+)
        AND SRW.EZCANCELFLAG(+) = '0'
        AND MRP.SRC_RTL_WH_CD   = SRS.RTL_WH_CD (+)
        AND MRP.SRC_RTL_SWH_CD  = SRS.RTL_SWH_CD (+)
        AND MRP.GLBL_CMPY_CD    = SRS.GLBL_CMPY_CD(+)
        AND SRS.EZCANCELFLAG(+) = '0'
        ORDER BY 
            MRP.MRP_PLN_NM
           ,MRP.MDSE_CD
    </statement>

    <resultMap id="result.NPAL1520_ASMsg" class="NPAL1520_ASMsg">
        <result property="mrpInfoPk_A1"        column="MRP_INFO_PK"         javaType="EZDSBigDecimalItem"/>
        <result property="mrpPlnNm_A1"         column="MRP_PLN_NM"          javaType="EZDSStringItem"/>
        <result property="mdseCd_A1"           column="MDSE_CD"             javaType="EZDSStringItem"/>
        <result property="mdseDescShortTxt_A1" column="MDSE_DESC_SHORT_TXT" javaType="EZDSStringItem"/>
        <result property="rtlWhCatgDescTxt_A1" column="RTL_WH_CATG_NM"      javaType="EZDSStringItem"/>
        <result property="rtlWhCd_A1"          column="RTL_WH_CD"           javaType="EZDSStringItem"/>
        <result property="rtlWhNm_A1"          column="RTL_WH_NM"           javaType="EZDSStringItem"/>
        <result property="rtlSwhCd_A1"         column="RTL_SWH_CD"          javaType="EZDSStringItem"/>
        <result property="rtlSwhNm_A1"         column="RTL_SWH_NM"          javaType="EZDSStringItem"/>
        <result property="whMgrPsnCd_A1"       column="WH_MGR_PSN_CD"       javaType="EZDSStringItem"/>
        <result property="fullPsnNm_A1"        column="FULL_PSN_NM"         javaType="EZDSStringItem"/>
        <result property="ropQty_A1"           column="ROP_QTY"             javaType="EZDSBigDecimalItem"/>
        <result property="maxInvtyQty_A1"      column="MAX_INVTY_QTY"       javaType="EZDSBigDecimalItem"/>
        <result property="mrpEnblFlg_A1"       column="MRP_ENBL_FLG"        javaType="EZDSStringItem"/>
        <result property="procrTpDescTxt_A1"   column="PROCR_TP_NM"         javaType="EZDSStringItem"/>
        <result property="srcRtlWhCd_A1"       column="SRC_RTL_WH_CD"       javaType="EZDSStringItem"/>
        <result property="rtlWhNm_A2"          column="SRC_RTL_WH_NM"       javaType="EZDSStringItem"/>
        <result property="srcRtlSwhCd_A1"      column="SRC_RTL_SWH_CD"      javaType="EZDSStringItem"/>
        <result property="rtlSwhNm_A2"         column="SRC_RTL_SWH_NM"      javaType="EZDSStringItem"/>
        <!-- START 2022/10/06 M.Kikushima [QC#60560,ADD] -->
        <result property="calcOrdProcCd_A1"    column="CALC_ORD_PROC_CD"     javaType="EZDSStringItem"/>
        <!-- END 2022/10/06 M.Kikushima [QC#60560,ADD] -->
    </resultMap>
</sqlMap>