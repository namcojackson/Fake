<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMZC260001Query">

    <statement id="getDefSlsRep" parameterClass="Map" resultClass="Map">
    SELECT
        ATRA.TRTY_GRP_TP_CD AS TRTY_GRP_TP_CD
        ,ATRA.LINE_BIZ_ROLE_TP_CD AS LINE_BIZ_ROLE_TP_CD
        ,ATRA.ORG_CD AS ORG_CD
        ,ATRA.TOC_CD AS TOC_CD
        ,ATRA.PSN_CD AS PSN_CD
        ,ATRA.ORG_RANK_NUM AS ORG_RANK_NUM
        ,ATRA.SHIP_TO_CUST_CD AS SHIP_TO_CUST_CD
        ,ATRA.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
        ,TRTY.LINE_BIZ_TP_CD AS LINE_BIZ_TP_CD
        ,ATRA.TRTY_GRP_TP_CD AS TRTY_GRP_TP_CD
    FROM 
        ACCT_TRTY_ROLE_ASG ATRA
        , TRTY_GRP_TP TRTY
    WHERE
        ATRA.GLBL_CMPY_CD = #glblCmpyCd#
    AND ATRA.EZCANCELFLAG  = '0'
    <isNotNull property="shipToCustCd">
    AND ATRA.SHIP_TO_CUST_CD = #shipToCustCd#
    </isNotNull>
    <isNotNull property="billToCustCd">
    AND ATRA.BILL_TO_CUST_CD = #billToCustCd#
    </isNotNull>

    AND ATRA.GLBL_CMPY_CD = TRTY.GLBL_CMPY_CD(+)
    AND ATRA.TRTY_GRP_TP_CD = TRTY.TRTY_GRP_TP_CD(+)
    AND TRTY.EZCANCELFLAG(+) = '0'
    </statement>

    <statement id="getDefSlsRepForDsOrderType" parameterClass="Map" resultClass="Map">
    SELECT DISTINCT
        DOTPD.LINE_BIZ_TP_CD           AS LINE_BIZ_TP_CD
        ,DOTPD.DEF_SLS_REP_TOC_CD      AS DEF_SLS_REP_TOC_CD
        ,DOTPD.TRTY_GRP_TP_TXT         AS TRTY_GRP_TP_CD <!-- 2018/04/11 S21_NA#25418 Add -->
        ,LBRT_QUOT.LINE_BIZ_ROLE_TP_CD AS LINE_BIZ_ROLE_TP_CD
    FROM
        DS_ORD_TP_PROC_DFN DOTPD
        ,LINE_BIZ_ROLE_TP LBRT_QUOT
        <!-- 2018/11/09 S21_NA#29010 Add Start -->
        <isNotNull property="trtyGrpTpList">
        ,LINE_BIZ_ROLE_RANK_DECN LBRRD
        </isNotNull>
        <!-- 2018/11/09 S21_NA#29010 Add End -->
    WHERE
        DOTPD.GLBL_CMPY_CD = #glblCmpyCd#
    AND DOTPD.DS_ORD_TP_CD = #dsOrdTpCd#
    AND DOTPD.EZCANCELFLAG = '0'

    AND DOTPD.GLBL_CMPY_CD = LBRT_QUOT.GLBL_CMPY_CD
    AND DOTPD.LINE_BIZ_TP_CD = LBRT_QUOT.LINE_BIZ_TP_CD
    AND LBRT_QUOT.EZCANCELFLAG = '0'
    AND LBRT_QUOT.SLS_CR_QUOT_FLG = 'Y'

    <!-- 2018/11/09 S21_NA#29010 Add Start -->
    AND LBRT_QUOT.PRIM_REP_ROLE_FLG = 'Y'
    <isNotNull property="trtyGrpTpList">
    AND LBRT_QUOT.GLBL_CMPY_CD = LBRRD.GLBL_CMPY_CD
    AND LBRRD.TRTY_GRP_TP_CD IN
    <iterate property="trtyGrpTpList" var="trtyGrpTp[]" open="(" close=")" conjunction=",">
        #trtyGrpTp[]#
    </iterate>
    AND LBRT_QUOT.LINE_BIZ_ROLE_TP_CD = LBRRD.LINE_BIZ_ROLE_TP_CD
    AND LBRRD.EZCANCELFLAG = '0'
    <!-- 2018/11/09 S21_NA#29010 Add End -->
    </isNotNull>
    </statement>

    <statement id="getPrimRep" parameterClass="Map" resultClass="String">
    SELECT LINE_BIZ_ROLE_TP_CD FROM (SELECT
        LBRT.LINE_BIZ_ROLE_TP_CD AS LINE_BIZ_ROLE_TP_CD
    FROM
        LINE_BIZ_ROLE_TP LBRT
    WHERE
        LBRT.GLBL_CMPY_CD = #glblCmpyCd#
    AND LBRT.LINE_BIZ_TP_CD = #lineBizTpCd#
    AND LBRT.PRIM_REP_ROLE_FLG = 'Y'
    AND LBRT.EZCANCELFLAG = '0'
    ORDER BY LBRT.LINE_BIZ_ROLE_TP_SORT_NUM
    )
    WHERE ROWNUM = 1
    </statement>

    <!-- START 2017/10/31 H.Sugawara [QC#20146(Sol#092),ADD] -->
    <statement id="getFMDummyRep" parameterClass="Map" resultClass="Map">
    SELECT 
        ORG.TOC_CD AS TOC_CD
    FROM 
        SELL_TO_CUST STC
        ,S21_ORG ORG
    WHERE
        STC.GLBL_CMPY_CD = #glblCmpyCd#
    AND STC.SELL_TO_CUST_CD = #shipToCustAcctCd#
    AND STC.EZCANCELFLAG  = '0'
    AND STC.GLBL_CMPY_CD = ORG.GLBL_CMPY_CD
    AND STC.COA_CC_CD = ORG.COA_CC_CD
    AND ORG.EZCANCELFLAG  = '0'
    </statement>
    <!-- END 2017/10/31 H.Sugawara [QC#20146(Sol#092),ADD] -->
    
    <!-- 2018/04/02 S21_NA#24860 Add Start -->
    <statement id="isExistOrdCatg" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(OCBC.ORD_CATG_BIZ_CTX_PK)
        FROM
            ORD_CATG_BIZ_CTX OCBC
        WHERE
            OCBC.GLBL_CMPY_CD           = #glblCmpyCd#
            AND OCBC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTpCd#
            AND OCBC.EZCANCELFLAG       = '0'
            AND (
                 (
                  OCBC.DS_ORD_CATG_CD    = #dsOrdCatgCd#
                  AND OCBC.DS_ORD_TP_CD  IS NULL
                  AND OCBC.DS_ORD_RSN_CD IS NULL
                 )
                 OR
                 (
                  OCBC.DS_ORD_CATG_CD    = #dsOrdCatgCd#
                  AND OCBC.DS_ORD_TP_CD  = #dsOrdTpCd#
                  AND OCBC.DS_ORD_RSN_CD IS NULL
                 )
                )
    </statement>
    <!-- 2018/04/02 S21_NA#24860 Add End -->

</sqlMap>
