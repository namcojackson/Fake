<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSBB034001">
    <statement id="getSvcMod" parameterClass="Map" resultClass="Map">
        SELECT
             A.SVC_MOD_PLN_ID           AS SVC_MOD_PLN_ID
            ,A.SVC_MOD_PK               AS SVC_MOD_PK
            ,B.SVC_MOD_DTL_PK           AS SVC_MOD_DTL_PK
            ,C.SVC_MOD_SER_RNG_PK       AS SVC_MOD_SER_RNG_PK
            ,C.SVC_MOD_FROM_SER_NUM     AS SVC_MOD_FROM_SER_NUM
            ,C.SVC_MOD_TO_SER_NUM       AS SVC_MOD_TO_SER_NUM
            ,C.MDSE_CD                  AS MDSE_CD
            ,C.LG_SER_NUM               AS LG_SER_NUM
            ,(SELECT
                  E.ORD_TAKE_MDSE_CD
              FROM
                  ORD_TAKE_MDSE     E
              WHERE
                      E.GLBL_CMPY_CD       = C.GLBL_CMPY_CD
                  AND E.ORD_TAKE_MDSE_CD   = C.MDSE_CD
                  AND E.EZCANCELFLAG       = '0')
                                        AS ORD_TAKE_MDSE_CD
        FROM
             SVC_MOD                A
            ,SVC_MOD_DTL            B
            ,SVC_MOD_SER_RNG        C
            ,AUTO_CRAT_RFRS_TMG     D
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.SVC_MOD_PK            = B.SVC_MOD_PK
            AND B.EZCANCELFLAG          = '0'
            AND (   B.SVC_MOD_CANC_DT BETWEEN #fromDt# AND #toDt#
                 OR B.SVC_MOD_OBSL_DT BETWEEN #fromDt# AND #toDt#)
            AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND B.SVC_MOD_DTL_PK        = C.SVC_MOD_DTL_PK
            AND C.EZCANCELFLAG          = '0'
            AND C.GLBL_CMPY_CD          = D.GLBL_CMPY_CD
            AND C.AUTO_CRAT_RFRS_TMG_CD = D.AUTO_CRAT_RFRS_TMG_CD
            AND D.EZCANCELFLAG          = '0'
        ORDER BY
             A.SVC_MOD_PK           ASC
            ,B.SVC_MOD_DTL_PK       ASC
            ,C.SVC_MOD_SER_RNG_PK   ASC
    </statement>
    <statement id="getSvcMachMstr" parameterClass="Map" resultClass="Map">
        <!-- START 2018/08/08 K.Kitachi [QC#27460, MOD] -->
        <!-- SELECT -->
        <!--      A.SER_NUM                  AS SER_NUM -->
        <!--     ,C.SVC_MOD_STS_PK           AS SVC_MOD_STS_PK -->
        <!--     ,D.SVC_TASK_NUM             AS SVC_TASK_NUM -->
        <!--     ,D.FSR_NUM                  AS FSR_NUM -->
        <!--     ,D.DS_SVC_CALL_TP_CD        AS DS_SVC_CALL_TP_CD -->
        <!--     ,D.SVC_CALL_PRTY_CD         AS SVC_CALL_PRTY_CD -->
        <!-- FROM -->
        <!--      SVC_MACH_MSTR          A -->
        <!--     ,MDSE                   B -->
        <!--     ,SVC_MOD_STS            C -->
        <!--     ,SVC_TASK               D -->
        <!-- WHERE -->
        <!--         A.GLBL_CMPY_CD          = #glblCmpyCd# -->
        <!--     <isNotNull property="mdseCd01"> -->
        <!--     AND A.MDSE_CD           LIKE  #mdseCd01# -->
        <!--     </isNotNull> -->
        <!--     <isNotNull property="mdseCd02"> -->
        <!--     AND A.MDSE_CD               = #mdseCd02# -->
        <!--     </isNotNull> -->
        <!--     AND LENGTH(A.SER_NUM)       = #lgSerNum# -->
        <!--     AND A.EZCANCELFLAG          = '0' -->
        <!--     AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD -->
        <!--     AND A.MDSE_CD               = B.MDSE_CD -->
        <!--     AND B.EZCANCELFLAG          = '0' -->
        <!--     AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD -->
        <!--     AND C.SVC_MOD_DTL_PK        = #svcModDtlPk# -->
        <!--     AND C.SVC_MOD_PROC_STS_CD   = '0' -->
        <!--     AND C.EZCANCELFLAG          = '0' -->
        <!--     AND C.SVC_TASK_NUM          = D.SVC_TASK_NUM -->
        <!--     AND C.GLBL_CMPY_CD          = D.GLBL_CMPY_CD -->
        <!--     AND D.EZCANCELFLAG          = '0' -->
        <!-- ORDER BY -->
        <!--      C.SVC_MOD_STS_PK           ASC -->
        SELECT
             B.SER_NUM
            ,A.SVC_MOD_STS_PK
            ,C.SVC_TASK_NUM
            ,C.FSR_NUM
            ,C.DS_SVC_CALL_TP_CD
            ,C.SVC_CALL_PRTY_CD
        FROM
             SVC_MOD_STS   A
            ,SVC_MACH_MSTR B
            ,SVC_TASK      C
        WHERE
                A.GLBL_CMPY_CD        = #glblCmpyCd#
            AND A.SVC_MOD_DTL_PK      = #svcModDtlPk#
            AND A.SVC_MOD_PROC_STS_CD = '0'
            AND A.EZCANCELFLAG        = '0'
            AND A.GLBL_CMPY_CD        = B.GLBL_CMPY_CD
            AND A.SVC_MACH_MSTR_PK    = B.SVC_MACH_MSTR_PK
            AND LENGTH(B.SER_NUM)     = #lgSerNum#
            AND B.EZCANCELFLAG        = '0'
            AND A.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
            AND A.SVC_TASK_NUM        = C.SVC_TASK_NUM
            AND C.EZCANCELFLAG        = '0'
        ORDER BY
            A.SVC_MOD_STS_PK
        <!-- END 2018/08/08 K.Kitachi [QC#27460, MOD] -->
    </statement>
    <statement id="getSvcModSts" parameterClass="Map" resultClass="Map">
        SELECT
             A.SVC_MOD_STS_PK           AS SVC_MOD_STS_PK
            ,B.SVC_TASK_NUM             AS SVC_TASK_NUM
            ,B.FSR_NUM                  AS FSR_NUM
            ,B.DS_SVC_CALL_TP_CD        AS DS_SVC_CALL_TP_CD
            ,B.SVC_CALL_PRTY_CD         AS SVC_CALL_PRTY_CD
        FROM
             SVC_MOD_STS           A
            ,SVC_TASK              B
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.SVC_MOD_OPT_CD        = #cancelCd#
            AND A.SVC_MOD_OPT_DT        BETWEEN #fromDt# AND #toDt#
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND B.EZCANCELFLAG          = '0'
            AND B.SVC_TASK_NUM          = A.SVC_TASK_NUM
            AND B.SVC_TASK_STS_CD       NOT IN (#Complete#, #Close#, #Cancel#, #Arrived#)
        <!-- START 2018/01/18 K.Kojima [QC#22394,ADD] -->
        UNION ALL
        SELECT
             A.SVC_MOD_STS_PK           AS SVC_MOD_STS_PK
            ,B.SVC_TASK_NUM             AS SVC_TASK_NUM
            ,B.FSR_NUM                  AS FSR_NUM
            ,B.DS_SVC_CALL_TP_CD        AS DS_SVC_CALL_TP_CD
            ,B.SVC_CALL_PRTY_CD         AS SVC_CALL_PRTY_CD
        FROM
             SVC_MOD_STS           A
            ,SVC_TASK              B
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.SVC_MOD_PROC_STS_CD   = #svcModProcStsOpen#
            AND A.SVC_MOD_OPT_CD        IN (#adminCd#, #remanCd#)
            AND A.SVC_MOD_OPT_DT        &lt;= #salesDate#
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND B.EZCANCELFLAG          = '0'
            AND B.SVC_TASK_NUM          = A.SVC_TASK_NUM
            AND B.SVC_TASK_STS_CD       NOT IN (#Complete#, #Close#, #Cancel#, #Arrived#)
        <!-- END 2018/01/18 K.Kojima [QC#22394,ADD] -->
        ORDER BY
            <!-- START 2018/01/18 K.Kojima [QC#22394,MOD] -->
            <!-- A.SVC_TASK_NUM             ASC -->
            SVC_TASK_NUM             ASC
            <!-- END 2018/01/18 K.Kojima [QC#22394,MOD] -->
    </statement>
    <statement id="getSvcTask" parameterClass="Map" resultClass="Map">
        SELECT
             A.SVC_TASK_NUM             AS SVC_TASK_NUM
            ,A.SVC_TASK_STS_CD          AS SVC_TASK_STS_CD
            ,B.FSR_VISIT_STS_CD         AS FSR_VISIT_STS_CD
        FROM
             SVC_TASK               A
            ,FSR_VISIT              B
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.FSR_NUM               = #fsrNum#
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND B.EZCANCELFLAG          = '0'
            AND B.SVC_TASK_NUM          = A.SVC_TASK_NUM
        ORDER BY
             A.SVC_TASK_NUM             ASC
    </statement>
    <statement id="getSvcModStsForCancel" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            STS.SVC_MOD_STS_PK
        FROM
             SVC_MOD_STS           STS
        WHERE
                STS.GLBL_CMPY_CD          = #glblCmpyCd#
            <!-- START 2023/01/16 S.Dong [QC#60922, MOD] -->
            <!-- AND STS.SVC_MOD_PROC_STS_CD   = #svcModProcStsOpen# -->
            AND STS.SVC_MOD_PROC_STS_CD   IN (#svcModProcStsOpen#, #svcModProcStsClosed#)
            <!-- END 2023/01/16 S.Dong [QC#60922, MOD] -->
            AND STS.SVC_MOD_OPT_CD        = #cancelCd#
            AND STS.SVC_MOD_OPT_DT        &lt;= #salesDate#
            AND STS.EZCANCELFLAG          = '0'
        ORDER BY
            STS.SVC_MOD_STS_PK
    </statement>
    <statement id="getSvcModStsForClose" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            STS.SVC_MOD_STS_PK
        FROM
             SVC_MOD_STS           STS
        WHERE
                STS.GLBL_CMPY_CD          = #glblCmpyCd#
            <!-- START 2023/01/16 S.Dong [QC#60922, MOD] -->
            <!-- AND STS.SVC_MOD_PROC_STS_CD   = #svcModProcStsOpen# -->
            AND STS.SVC_MOD_PROC_STS_CD   IN (#svcModProcStsOpen#, #svcModProcStsCancelled#)
            <!-- END 2023/01/16 S.Dong [QC#60922, MOD] -->
            AND STS.SVC_MOD_OPT_CD        IN (#adminCd#, #remanCd#)
            AND STS.SVC_MOD_OPT_DT        &lt;= #salesDate#
            AND STS.EZCANCELFLAG          = '0'
        ORDER BY
            STS.SVC_MOD_STS_PK
    </statement>
</sqlMap>
