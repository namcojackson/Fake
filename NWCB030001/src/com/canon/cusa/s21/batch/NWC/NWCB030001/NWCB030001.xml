<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWCB030001">
    <statement id="getEDITargetData" parameterClass="Map" resultClass="Map">
        SELECT
             BILL_TO_CUST_ACCT_CD
            ,DS_EDI_TRD_PTNR_CD
            ,INV_NUM
            ,INV_TYPE
            ,INV_INTFC_ID
            <!-- 2018/01/26 QC#22718 Add Start -->
            ,SAP_EDI_TRD_PTNR_CD
            <!-- 2018/01/26 QC#22718 Add End -->
        FROM
            (
                SELECT DISTINCT
                     I.BILL_TO_CUST_ACCT_CD
                    ,DETP.DS_EDI_TRD_PTNR_CD
                    ,I.INV_NUM
                    ,#typeOm# AS INV_TYPE
                    ,DETP.INV_INTFC_ID
                    <!-- 2018/01/26 QC#22718 Add Start -->
                    ,XIX.SRC_ATTRB_TXT_01 SAP_EDI_TRD_PTNR_CD
                    <!-- 2018/01/26 QC#22718 Add End -->
                FROM
                     INV_PRT_CTRL     IPC
                    ,INV              I
                    ,XTRNL_INTFC_XREF XIX
                    ,DS_EDI_TRD_PTNR  DETP
                WHERE
                        IPC.GLBL_CMPY_CD         = #glblCmpyCd#
                    AND IPC.INV_EDI_PROC_STS_CD  = #invEdiProcStsCd#
                    AND IPC.GLBL_CMPY_CD         = I.GLBL_CMPY_CD
                    AND IPC.INV_NUM              = I.INV_NUM
                    AND I.FNLZ_INV_FLG           = 'Y'
                    <!-- 2019/11/12 QC#54139 Mod Start -->
                    <!-- AND NOT EXISTS(SELECT '1' FROM SVC_INV SI WHERE I.GLBL_CMPY_CD = SI.GLBL_CMPY_CD AND I.INV_NUM = SI.SVC_INV_NUM AND SI.EZCANCELFLAG = '0') -->
                    AND I.SVC_INV_PK IS NULL
                    <!-- 2019/11/12 QC#54139 Mod End -->
                    AND I.INV_TOT_DEAL_NET_AMT  &lt;&gt; 0
                    AND I.GLBL_CMPY_CD           = XIX.GLBL_CMPY_CD
                    AND I.BILL_TO_CUST_ACCT_CD   = XIX.TRGT_ATTRB_TXT_01
                    AND XIX.INTFC_XREF_CTX_TP_CD = #intfcXrefCtxTpCd#
                    AND XIX.INTFC_ID             = #intfcId#
                    AND XIX.GLBL_CMPY_CD         = DETP.GLBL_CMPY_CD
                    AND XIX.SRC_ATTRB_TXT_02     = DETP.DS_EDI_TRD_PTNR_CD
                    AND DETP.SEND_INV_FLG        = 'Y'
                    AND IPC.EZCANCELFLAG         = '0'
                    AND I.EZCANCELFLAG           = '0'
                    AND XIX.EZCANCELFLAG         = '0'
                    AND DETP.EZCANCELFLAG        = '0'
                UNION ALL
                SELECT DISTINCT
                     I.BILL_TO_CUST_ACCT_CD
                    ,DETP.DS_EDI_TRD_PTNR_CD
                    ,I.INV_NUM
                    ,#typeService# AS INV_TYPE
                    ,DETP.INV_INTFC_ID
                    <!-- 2018/01/26 QC#22718 Add Start -->
                    ,XIX.SRC_ATTRB_TXT_01 SAP_EDI_TRD_PTNR_CD
                    <!-- 2018/01/26 QC#22718 Add End -->
                FROM
                     INV_PRT_CTRL     IPC
                    ,INV              I
                    ,SVC_INV          SI
                    ,XTRNL_INTFC_XREF XIX
                    ,DS_EDI_TRD_PTNR  DETP
                WHERE
                        IPC.GLBL_CMPY_CD         = #glblCmpyCd#
                    AND IPC.INV_EDI_PROC_STS_CD  = #invEdiProcStsCd#
                    AND IPC.GLBL_CMPY_CD         = I.GLBL_CMPY_CD
                    AND IPC.INV_NUM              = I.INV_NUM
                    AND I.FNLZ_INV_FLG           = 'Y'
                    AND I.INV_TOT_DEAL_NET_AMT  &lt;&gt; 0
                    AND I.GLBL_CMPY_CD           = SI.GLBL_CMPY_CD
                    <!-- 2019/11/12 QC#54139 Mod Start -->
                    <!-- AND I.INV_NUM                = SI.SVC_INV_NUM -->
                    AND I.SVC_INV_PK             = SI.SVC_INV_PK
                    <!-- 2019/11/12 QC#54139 Mod End -->
                    AND I.GLBL_CMPY_CD          = XIX.GLBL_CMPY_CD
                    AND I.BILL_TO_CUST_ACCT_CD  = XIX.TRGT_ATTRB_TXT_01
                    AND XIX.INTFC_XREF_CTX_TP_CD = #intfcXrefCtxTpCd#
                    AND XIX.INTFC_ID             = #intfcId#
                    AND XIX.GLBL_CMPY_CD         = DETP.GLBL_CMPY_CD
                    AND XIX.SRC_ATTRB_TXT_02     = DETP.DS_EDI_TRD_PTNR_CD
                    AND DETP.SEND_INV_FLG        = 'Y'
                    AND IPC.EZCANCELFLAG         = '0'
                    AND I.EZCANCELFLAG           = '0'
                    AND SI.EZCANCELFLAG          = '0'
                    AND XIX.EZCANCELFLAG         = '0'
                    AND DETP.EZCANCELFLAG        = '0'
            )
        ORDER BY
             BILL_TO_CUST_ACCT_CD
            ,DS_EDI_TRD_PTNR_CD
            ,INV_NUM
            ,INV_TYPE
    </statement>
    <statement id="getHeaderData" parameterClass="Map" resultClass="Map">
        SELECT
             I.PMT_TERM_CD
            ,I.INV_TP_CD
            ,I.INV_DT
            ,I.BILL_TO_CUST_ACCT_CD
            ,I.BILL_TO_CUST_ACCT_NM
            ,I.RCPNT_FIRST_LINE_ADDR || ' ' || I.RCPNT_SCD_LINE_ADDR || ' ' || I.RCPNT_THIRD_LINE_ADDR || ' ' || I.RCPNT_FRTH_LINE_ADDR AS ADDRESS
            ,I.RCPNT_CTY_ADDR
            ,I.RCPNT_POST_CD
            ,I.RCPNT_CTRY_CD
            ,I.RCPNT_ST_CD
            ,I.CUST_ISS_PO_NUM           AS  CUST_ISS_PO_NUM
            ,I.CUST_ISS_PO_DT            AS  CUST_ISS_PO_DT
            ,SI.SVC_INV_SRC_TP_CD
            ,I.INV_TOT_DEAL_NET_AMT
            ,I.INV_TOT_DEAL_SLS_AMT
            ,I.INV_TOT_DEAL_TAX_AMT
            ,I.INV_TOT_DEAL_DISC_AMT
            ,SIB.SHIP_DEAL_FRT_AMT
            ,SIB.SHIP_DEAL_HDLG_CHRG_AMT
            ,DIEA.DS_IMPT_ATTRB_TXT_02
            ,NVL(XIX_C0.SRC_ATTRB_TXT_02, I.PMT_TERM_CD)   AS PMT_TERM_CD_TXT
            ,NVL(XIX_C1.SRC_ATTRB_TXT_02, I.DS_INV_TP_CD) AS DS_INV_TP_CD
            ,SI.DS_CONTR_CATG_CD
            ,I.NET_DUE_DT
            ,I.DS_ORD_CATG_CD
            ,I.DS_ORD_TP_CD
            ,I.DS_ORD_RSN_CD
            ,I.ORD_DT
            ,I.SELL_TO_CUST_CD
            <!-- 2018/04/23 QC#25772 Add Start -->
            ,I.CPO_ORD_NUM
            <!-- 2018/04/23 QC#25772 Add End -->
            <!-- 2018/09/11 QC#27032 Add Start -->
            ,SIB.FRT_DEAL_TAX_AMT FRT_DEAL_TAX_AMT
            <!-- 2018/09/11 QC#27032 Add End -->
            <!-- 2019/01/16 QC#27032 Add Start -->
            ,DC.ADD_DROP_SHIP_FLG
            ,DC.ADD_SHIP_TO_CUST_CD
            <!-- 2019/01/16 QC#27032 Add End -->
        FROM
             INV I
            ,(
                SELECT
                     IB.INV_NUM
                    ,SUM(IB.SHIP_DEAL_FRT_AMT) SHIP_DEAL_FRT_AMT
                    ,SUM(IB.SHIP_DEAL_HDLG_CHRG_AMT) SHIP_DEAL_HDLG_CHRG_AMT
                    ,SUM(IB.TOT_BOL_DEAL_TAX_AMT) TOT_BOL_DEAL_TAX_AMT
                    ,SUM(IB.FRT_DEAL_TAX_AMT) FRT_DEAL_TAX_AMT
                FROM
                    INV_BOL IB
                WHERE
                        IB.GLBL_CMPY_CD = #glblCmpyCd#
                    AND IB.INV_NUM      = #invNum#
                    AND IB.EZCANCELFLAG = '0'
                GROUP BY
                    IB.INV_NUM
             ) SIB
            ,SVC_INV SI
            ,CPO DC
            ,DS_IMPT_ORD DIO
            ,DS_IMPT_EXT_ATTRB DIEA
            ,XTRNL_INTFC_XREF XIX_C0
            ,XTRNL_INTFC_XREF XIX_C1
        WHERE
                I.GLBL_CMPY_CD                 = #glblCmpyCd#
            AND I.INV_NUM                      = #invNum#
            AND I.INV_NUM                      = SIB.INV_NUM(+)
            AND I.GLBL_CMPY_CD                 = SI.GLBL_CMPY_CD(+)
            <!-- 2019/11/12 QC#54139 Mod Start -->
            <!-- AND I.INV_NUM                      = SI.SVC_INV_NUM(+) -->
            AND I.SVC_INV_PK                   = SI.SVC_INV_PK(+)
            <!-- 2019/11/12 QC#54139 Mod End -->
            AND I.GLBL_CMPY_CD                 = DC.GLBL_CMPY_CD(+)
            AND I.CPO_ORD_NUM                  = DC.CPO_ORD_NUM(+)
            AND DC.GLBL_CMPY_CD                = DIO.GLBL_CMPY_CD(+)
            AND DC.CPO_ORD_NUM                 = DIO.CPO_ORD_NUM(+)
            AND DC.ORD_SRC_REF_NUM             = DIO.ORD_SRC_REF_NUM(+)
            AND DIO.CPO_SRC_TP_CD(+)           = #cpoSrcTpCd#
            AND DIO.GLBL_CMPY_CD               = DIEA.GLBL_CMPY_CD(+)
            AND DIO.DS_IMPT_ORD_PK             = DIEA.DS_IMPT_ORD_PK(+)
            AND I.GLBL_CMPY_CD                 = XIX_C0.GLBL_CMPY_CD(+)
            AND I.PMT_TERM_CD                  = XIX_C0.TRGT_ATTRB_TXT_02(+)
            AND XIX_C0.TRGT_ATTRB_TXT_01(+)    = #dsEdiTrdPtnrCd#
            AND XIX_C0.INTFC_XREF_CTX_TP_CD(+) = #intfcXrefCtxTpCdC0#
            AND XIX_C0.INTFC_ID(+)             = #intfcId#
            AND I.GLBL_CMPY_CD                 = XIX_C1.GLBL_CMPY_CD(+)
            AND I.DS_INV_TP_CD                 = XIX_C1.TRGT_ATTRB_TXT_02(+)
            AND XIX_C1.TRGT_ATTRB_TXT_01(+)    = #dsEdiTrdPtnrCd#
            AND XIX_C1.INTFC_XREF_CTX_TP_CD(+) = #intfcXrefCtxTpCdC1#
            AND XIX_C1.INTFC_ID(+)             = #intfcId#

            AND I.EZCANCELFLAG                 = '0'
            AND SI.EZCANCELFLAG(+)             = '0'
            AND DC.EZCANCELFLAG(+)             = '0'
            AND DIO.EZCANCELFLAG(+)            = '0'
            AND DIEA.EZCANCELFLAG(+)           = '0'
            AND XIX_C0.EZCANCELFLAG(+)         = '0'
            AND XIX_C1.EZCANCELFLAG(+)         = '0'
    </statement>
    <statement id="getEasyPack" parameterClass="Map" resultClass="Map">
        SELECT
            '1'
        FROM
             ORD_CATG_BIZ_CTX OCBC
            ,SPLY_PGM_CONTR   SPC
        WHERE
                OCBC.GLBL_CMPY_CD                  = #glblCmpyCd#
            AND OCBC.DS_ORD_CATG_CD                = #dcOrdCatgCd#
            <isNotNull property="dsOrdTpCd" >
            AND
                (
                       OCBC.DS_ORD_TP_CD           = #dsOrdTpCd#
                    OR OCBC.DS_ORD_TP_CD           IS NULL
                )
            </isNotNull>
            <isNull property="dsOrdTpCd" >
            AND OCBC.DS_ORD_TP_CD                  IS NULL
            </isNull>
            <isNotNull property="dsOrdRsnCd" >
            AND
                (
                       OCBC.DS_ORD_RSN_CD           = #dsOrdRsnCd#
                    OR OCBC.DS_ORD_RSN_CD          IS NULL
                )
            </isNotNull>
            <isNull property="dsOrdRsnCd" >
            AND OCBC.DS_ORD_RSN_CD                 IS NULL
            </isNull>
            AND OCBC.ORD_CATG_CTX_TP_CD            IN (#easyPack1#, #easyPack1Return#)
            AND OCBC.GLBL_CMPY_CD                  = SPC.GLBL_CMPY_CD
            AND SPC.BILL_TO_CUST_ACCT_CD           = #billtoCustAcctCd#
            AND SPC.EFF_FROM_DT                   &lt;= #effDt#
            AND NVL(SPC.EFF_THRU_DT, #limitDate#) &gt;= #effDt#
            AND OCBC.EZCANCELFLAG                  = '0'
            AND SPC.EZCANCELFLAG                   = '0'
            AND ROWNUM                             = 1
    </statement>
    <statement id="getPaymentTermData" parameterClass="Map" resultClass="Map">
        SELECT
             NVL(IPT.ISTL_PMT_TERM_AOT, PT.PMT_TERM_AOT)                                                   AS PMT_TERM_AOT
            ,#pmtTermTxt1# || TO_CHAR(TO_DATE(#netDueDate#, 'YYYY/MM/DD'), 'MM/DD/YYYY') ||  #pmtTermTxt2# AS PMT_TERM_TXT
        FROM
             PMT_TERM      PT
            ,ISTL_PMT_TERM IPT
        WHERE
                PT.GLBL_CMPY_CD     = #glblCmpyCd#
            AND PT.PMT_TERM_CD      = #pmtTermCd#
            AND PT.GLBL_CMPY_CD     = IPT.GLBL_CMPY_CD(+)
            AND PT.PMT_TERM_CD      = IPT.ISTL_PMT_TERM_CD(+)
            AND PT.EZCANCELFLAG     = '0'
            AND IPT.EZCANCELFLAG(+) = '0'
        ORDER BY
            IPT.ISTL_PMT_TERM_DTL_NUM
    </statement>
    <statement id="getLineDataOm" parameterClass="Map" resultClass="Map">
        SELECT
             IL.INV_BOL_LINE_NUM
            ,IL.INV_LINE_NUM
            ,IL.INV_LINE_SUB_NUM
            ,IL.INV_LINE_SUB_TRX_NUM
            <isNotNull property="easyPack">
            ,NVL(IL.SPLY_PGM_SHIP_QTY, IL.SHIP_QTY)                  AS SHIP_QTY
            </isNotNull>
            <isNull property="easyPack">
            ,NVL(IL.INV_DPLY_QTY, IL.SHIP_QTY)                       AS SHIP_QTY
            </isNull>
            <!-- 2018/01/26 QC#22718 Mod Start -->
            <!-- ,NVL(XIX.SRC_ATTRB_TXT_02, IL.UOM_CD)                    AS UOM_CD -->
            ,NVL(XIX.SRC_ATTRB_TXT_01, IL.UOM_CD)                    AS UOM_CD
            <!-- 2018/01/26 QC#22718 Mod End -->
            ,CASE
                WHEN
                    IL.ORD_CUST_UOM_QTY IS NOT NULL
                THEN
                    MSP.IN_POUND_WT * IL.SHIP_QTY * IL.ORD_CUST_UOM_QTY
                ELSE
                    CASE
                        WHEN
                            MSP_UOM.IN_EACH_QTY IS NOT NULL
                        THEN
                            MSP.IN_POUND_WT * IL.SHIP_QTY * MSP_UOM.IN_EACH_QTY
                        ELSE
                            MSP.IN_POUND_WT * IL.SHIP_QTY * 1
                        END
                END                                                  AS TOTAL_IN_POUND_WEIGHT
            ,NVL(DMI.MNF_ITEM_CD, IL.MDSE_CD)                        AS MDSE_CD
            ,CASE
                WHEN DMI.MDSE_CD IS NOT NULL
                    THEN DMI.MDSE_DESC_SHORT_TXT
                ELSE IL.MDSE_NM END                                  AS MDSE_NM 
            <isNotNull property="easyPack">
            ,CASE WHEN IL.SPLY_PGM_SHIP_QTY IS NULL OR IL.SPLY_PGM_SHIP_QTY = 0 THEN 0 ELSE ROUND(IL.DEAL_GRS_UNIT_PRC_AMT/IL.SPLY_PGM_SHIP_QTY,2) END AS DEAL_GRS_UNIT_PRC_AMT
            </isNotNull>
            <isNull property="easyPack">
            ,IL.DEAL_GRS_UNIT_PRC_AMT
            </isNull>
            ,IL.DEAL_GRS_TOT_PRC_AMT
            <isNotNull property="easyPack">
            ,IL.SPLY_PGM_UNIT_AMT_RATE                               AS DEAL_NET_UNIT_PRC_AMT
            </isNotNull>
            <isNull property="easyPack">
            ,IL.DEAL_NET_UNIT_PRC_AMT
            </isNull>
            ,IL.INV_LINE_DEAL_NET_AMT
            ,IB.SHIP_DEAL_HDLG_CHRG_AMT
            ,IL.INV_LINE_DEAL_TAX_AMT
            ,IB.FRT_DEAL_TAX_AMT
            ,IL.MDSE_CD                                              AS INV_LINE_MDSE_CD
            <!-- 2018/04/26 QC#25816 Add Start -->
            ,IL.FUNC_NET_UNIT_PRC_AMT
            <!-- 2018/04/26 QC#25816 Add End -->
            ,MSP_UOM.IN_EACH_QTY<!-- 2018/08/27 S21_NA#25001 Add -->
            <!-- 2018/09/11 QC#27032 Add Start -->
            ,IB.SHIP_DEAL_FRT_AMT
            ,IL.CPO_ORD_NUM
            ,IL.CPO_DTL_LINE_NUM
            ,IL.CPO_DTL_LINE_SUB_NUM
            ,IL.INV_LINE_CATG_CD
            <!-- 2018/09/11 QC#27032 Add End -->
            <!-- 2019/02/06 QC#30187 Add Start -->
            ,IL.CUST_ISS_PO_NUM                                      AS CUST_ISS_PO_NUM_L
            <!-- 2018/02/06 QC#30187 Add End -->
        FROM
             INV_LINE         IL
            ,MDSE_STORE_PKG   MSP
            ,MDSE             DMI
            ,INV_BOL          IB
            ,INV              I
            ,XTRNL_INTFC_XREF XIX
            ,MDSE_STORE_PKG   MSP_UOM
        WHERE
                IL.GLBL_CMPY_CD             = #glblCmpyCd#
            AND IL.INV_NUM                  = #invNum#
            <!-- 2018/05/24 QC#21841 Add Start -->
            AND IL.INV_LINE_CATG_CD  &lt;&gt; #invLineCatgFrt#
            <!-- 2018/05/24 QC#21841 Add End -->
            AND IL.GLBL_CMPY_CD             = MSP.GLBL_CMPY_CD(+)
            AND IL.MDSE_CD                  = MSP.MDSE_CD(+)
            AND MSP.PKG_UOM_CD(+)           = #pkgUomCd#
            AND IL.GLBL_CMPY_CD             = DMI.GLBL_CMPY_CD(+)
            AND IL.MDSE_CD                  = DMI.MDSE_CD(+)
            AND IL.GLBL_CMPY_CD             = IB.GLBL_CMPY_CD
            AND IL.INV_NUM                  = IB.INV_NUM
            AND IL.INV_BOL_LINE_NUM         = IB.INV_BOL_LINE_NUM
            AND IL.GLBL_CMPY_CD             = I.GLBL_CMPY_CD
            AND IL.INV_NUM                  = I.INV_NUM
            <!-- 2018/06/07 QC#26443 Add Start -->
            AND IL.GLBL_CMPY_CD             = MSP_UOM.GLBL_CMPY_CD(+)
            AND IL.MDSE_CD                  = MSP_UOM.MDSE_CD(+)
            AND IL.UOM_CD                   = MSP_UOM.PKG_UOM_CD(+)
            <!-- 2018/06/07 QC#26443 Add End -->
            AND IL.GLBL_CMPY_CD             = XIX.GLBL_CMPY_CD(+)
            <!-- 2018/06/07 QC#26443 Mod Start -->
            <!-- AND IL.UOM_CD                   = XIX.TRGT_ATTRB_TXT_02(+) -->
            AND NVL(MSP_UOM.BASE_PKG_UOM_CD, IL.UOM_CD) = XIX.TRGT_ATTRB_TXT_02(+)
            <!-- 2018/06/07 QC#26443 Mod End -->
            <!-- 2018/06/06 QC#26443 Add Start -->
            AND DMI.PKG_UOM_CLS_CD          = XIX.TRGT_ATTRB_TXT_03(+)
            <!-- 2018/06/06 QC#26443 Add Endt -->
            AND XIX.TRGT_ATTRB_TXT_01(+)    = #dsEdiTrdPtnrCd#
            AND XIX.INTFC_XREF_CTX_TP_CD(+) = #intfcXrefCtxTpCd#
            <!-- 2018/06/07 QC#26443 Del Start -->
            <!-- AND IL.GLBL_CMPY_CD             = MSP_UOM.GLBL_CMPY_CD(+) -->
            <!-- AND IL.MDSE_CD                  = MSP_UOM.MDSE_CD(+) -->
            <!-- AND IL.UOM_CD                  = MSP_UOM.PKG_UOM_CD(+) -->
            <!-- 2018/06/07 QC#26443 Del End -->
            AND IL.EZCANCELFLAG             = '0'
            AND MSP.EZCANCELFLAG(+)         = '0'
            AND DMI.EZCANCELFLAG(+)         = '0'
            AND IB.EZCANCELFLAG             = '0'
            AND I.EZCANCELFLAG              = '0'
            AND XIX.EZCANCELFLAG(+)         = '0'
            AND MSP_UOM.EZCANCELFLAG(+)     = '0'
        ORDER BY
             IL.INV_BOL_LINE_NUM
            ,IL.INV_LINE_NUM
            ,IL.INV_LINE_SUB_NUM
    </statement>
    <statement id="getLineDataFleet" parameterClass="Map" resultClass="Map">
        SELECT
             IL.INV_BOL_LINE_NUM
            ,IL.INV_LINE_NUM
            ,IL.INV_LINE_SUB_NUM
            ,IL.INV_LINE_SUB_TRX_NUM
            ,NVL(IL.INV_DPLY_QTY, IL.SHIP_QTY)     AS SHIP_QTY
            <!-- 2018/01/26 QC#22718 Mod Start -->
            <!-- ,NVL(XIX.SRC_ATTRB_TXT_02, IL.UOM_CD)  AS UOM_CD -->
            ,NVL(XIX.SRC_ATTRB_TXT_01, IL.UOM_CD)  AS UOM_CD
            <!-- 2018/01/26 QC#22718 Mod End -->
            ,NULL                                  AS TOTAL_IN_POUND_WEIGHT
            ,NULL                                  AS MDL_GRP_NM
            ,NULL                                  AS MDL_NM
            ,NVL(DMI.MNF_ITEM_CD, IL.MDSE_CD)      AS MDSE_CD
            ,CASE
                WHEN DMI.MDSE_CD IS NOT NULL
                    THEN DMI.MDSE_DESC_SHORT_TXT
                ELSE IL.MDSE_NM END                AS MDSE_NM 
            ,SIL.BLLG_PER_FROM_DT
            ,SIL.BLLG_PER_THRU_DT
            ,IL.DEAL_NET_UNIT_PRC_AMT
            ,IL.INV_LINE_DEAL_NET_AMT
            ,IL.INV_LINE_DEAL_TAX_AMT
            ,NULL                                  AS SER_NUM
            ,IL.DEAL_GRS_UNIT_PRC_AMT
            ,IL.DEAL_GRS_TOT_PRC_AMT
            ,IL.DEAL_NET_UNIT_PRC_AMT
            ,IPSP.INV_PRINT_SVC_PGM_SRC_NM
            ,SIL.SVC_INV_CHRG_TP_CD
            ,IL.MDSE_CD                            AS INV_LINE_MDSE_CD
            <!-- 2018/04/26 QC#25816 Add Start -->
            ,IL.FUNC_NET_UNIT_PRC_AMT
            <!-- 2018/04/26 QC#25816 Add End -->
            ,MSP_UOM.IN_EACH_QTY<!-- 2018/08/27 S21_NA#25001 Add -->
            ,SIL.CUST_ISS_PO_NUM                   AS CUST_ISS_PO_NUM_L<!-- 2018/02/06 S21_NA#30187 Add -->
        FROM
             INV_LINE          IL
            ,SVC_INV           SI
            ,SVC_INV_LINE      SIL
            ,SHIP_TO_CUST      STC
            ,DS_CTAC_PSN_RELN  DCPR
            ,CTAC_PSN          CP
            ,DS_CONTR_DTL      DCD
            ,MDSE              DMI
            ,INV               I
            <!-- 2018/06/07 QC#26443 Add Start -->
            ,MDSE_STORE_PKG    MSP_UOM
            <!-- 2018/06/07 QC#26443 Add End -->
            ,XTRNL_INTFC_XREF  XIX
            ,INV_PRINT_SVC_PGM IPSP
        WHERE
                IL.GLBL_CMPY_CD             = #glblCmpyCd#
            AND IL.INV_NUM                  = #invNum#
            <!-- 2019/11/12 QC#54139 Mod Start -->
            <!-- AND IL.GLBL_CMPY_CD             = SI.GLBL_CMPY_CD -->
            <!-- AND IL.INV_NUM                  = SI.SVC_INV_NUM -->
            AND IL.GLBL_CMPY_CD             = I.GLBL_CMPY_CD
            AND IL.INV_NUM                  = I.INV_NUM
            AND I.GLBL_CMPY_CD              = SI.GLBL_CMPY_CD
            AND I.SVC_INV_PK                = SI.SVC_INV_PK
            <!-- 2019/11/12 QC#54139 Mod End -->
            AND SI.DS_CONTR_CATG_CD         = #dsContrCatgCdFleet#
            AND IL.GLBL_CMPY_CD             = SIL.GLBL_CMPY_CD
            AND IL.SVC_INV_LINE_PK          = SIL.SVC_INV_LINE_PK
            AND SIL.GLBL_CMPY_CD            = STC.GLBL_CMPY_CD(+)
            AND SIL.SHIP_TO_CUST_CD         = STC.SHIP_TO_CUST_CD(+)
            AND STC.GLBL_CMPY_CD            = DCPR.GLBL_CMPY_CD(+)
            AND STC.LOC_NUM                 = DCPR.LOC_NUM(+)
            AND DCPR.DS_PRIM_LOC_FLG(+)     = 'Y'
            AND DCPR.EFF_FROM_DT(+)     &lt;= #invoiceDate#
            AND (DCPR.EFF_THRU_DT(+)    &gt;= #invoiceDate# OR DCPR.EFF_THRU_DT(+) IS NULL)
            AND DCPR.GLBL_CMPY_CD           = CP.GLBL_CMPY_CD(+)
            AND DCPR.CTAC_PSN_PK            = CP.CTAC_PSN_PK(+)
            AND SIL.GLBL_CMPY_CD            = DCD.GLBL_CMPY_CD
            AND SIL.DS_CONTR_DTL_PK         = DCD.DS_CONTR_DTL_PK
            AND IL.GLBL_CMPY_CD             = DMI.GLBL_CMPY_CD(+)
            AND IL.MDSE_CD                  = DMI.MDSE_CD(+)
            <!-- 2019/11/12 QC#54139 Del Start -->
            <!-- AND IL.GLBL_CMPY_CD             = I.GLBL_CMPY_CD -->
            <!-- AND IL.INV_NUM                  = I.INV_NUM -->
            <!-- 2019/11/12 QC#54139 Del End -->
            <!-- 2018/06/07 QC#26443 Add Start -->
            AND IL.GLBL_CMPY_CD             = MSP_UOM.GLBL_CMPY_CD(+)
            AND IL.MDSE_CD                  = MSP_UOM.MDSE_CD(+)
            AND IL.UOM_CD                   = MSP_UOM.PKG_UOM_CD(+)
            <!-- 2018/06/07 QC#26443 Add End -->
            AND IL.GLBL_CMPY_CD             = XIX.GLBL_CMPY_CD(+)
            <!-- 2018/06/07 QC#26443 Mod Start -->
            <!-- AND IL.UOM_CD                   = XIX.TRGT_ATTRB_TXT_02(+) -->
            AND NVL(MSP_UOM.BASE_PKG_UOM_CD, IL.UOM_CD) = XIX.TRGT_ATTRB_TXT_02(+)
            <!-- 2018/06/07 QC#26443 Mod End -->
            <!-- 2018/06/06 QC#26443 Add Start -->
            AND DMI.PKG_UOM_CLS_CD          = XIX.TRGT_ATTRB_TXT_03(+)
            <!-- 2018/06/06 QC#26443 Add End -->
            AND XIX.TRGT_ATTRB_TXT_01(+)    = #dsEdiTrdPtnrCd#
            AND XIX.INTFC_XREF_CTX_TP_CD(+) = #intfcXrefCtxTpCd#
            AND SIL.GLBL_CMPY_CD            = IPSP.GLBL_CMPY_CD(+)
            AND SIL.SVC_PGM_MDSE_CD         = IPSP.INV_PRINT_SVC_PGM_CD(+)
            AND IL.EZCANCELFLAG             = '0'
            AND SI.EZCANCELFLAG             = '0'
            AND SIL.EZCANCELFLAG            = '0'
            AND STC.EZCANCELFLAG(+)         = '0'
            AND DCPR.EZCANCELFLAG(+)        = '0'
            AND CP.EZCANCELFLAG(+)          = '0'
            AND DCD.EZCANCELFLAG            = '0'
            AND DMI.EZCANCELFLAG(+)         = '0'
            AND I.EZCANCELFLAG              = '0'
            <!-- 2018/06/07 QC#26443 Add Start -->
            AND MSP_UOM.EZCANCELFLAG(+)    = '0'
            <!-- 2018/06/07 QC#26443 Add End -->
            AND XIX.EZCANCELFLAG(+)         = '0'
            AND IPSP.EZCANCELFLAG(+)        = '0'
        ORDER BY
             IL.INV_BOL_LINE_NUM
            ,IL.INV_LINE_NUM
            ,IL.INV_LINE_SUB_NUM
            ,IL.INV_LINE_SUB_TRX_NUM
    </statement>
    <statement id="getLineDataRegularOrAggregate" parameterClass="Map" resultClass="Map">
        SELECT
             IL.INV_BOL_LINE_NUM
            ,IL.INV_LINE_NUM
            ,IL.INV_LINE_SUB_NUM
            ,IL.INV_LINE_SUB_TRX_NUM
            ,NVL(IL.INV_DPLY_QTY, IL.SHIP_QTY)     AS SHIP_QTY
            <!-- 2018/01/26 QC#22718 Mod Start -->
            <!-- ,NVL(XIX.SRC_ATTRB_TXT_02, IL.UOM_CD)  AS UOM_CD -->
            ,NVL(XIX.SRC_ATTRB_TXT_01, IL.UOM_CD)  AS UOM_CD
            <!-- 2018/01/26 QC#22718 Mod End -->
            ,NULL                                  AS TOTAL_IN_POUND_WEIGHT
            ,DMG.MDL_GRP_NM
            ,DM.MDL_DESC_TXT
            ,NVL(DMI.MNF_ITEM_CD, IL.MDSE_CD)      AS MDSE_CD
            ,CASE
                WHEN DMI.MDSE_CD IS NOT NULL
                    THEN DMI.MDSE_DESC_SHORT_TXT
                ELSE IL.MDSE_NM END                AS MDSE_NM 
            ,SIL.BLLG_PER_FROM_DT
            ,SIL.BLLG_PER_THRU_DT
            ,IL.DEAL_NET_UNIT_PRC_AMT
            ,IL.INV_LINE_DEAL_NET_AMT
            ,IL.INV_LINE_DEAL_TAX_AMT
            ,SMM.SER_NUM
            ,IL.DEAL_GRS_UNIT_PRC_AMT
            ,IL.DEAL_GRS_TOT_PRC_AMT
            ,IL.DEAL_NET_UNIT_PRC_AMT
            ,IPSP.INV_PRINT_SVC_PGM_SRC_NM
            ,SIL.SVC_INV_CHRG_TP_CD
            ,IL.MDSE_CD                            AS INV_LINE_MDSE_CD
            <!-- 2018/04/26 QC#25816 Add Start -->
            ,IL.FUNC_NET_UNIT_PRC_AMT
            <!-- 2018/04/26 QC#25816 Add End -->
            ,MSP_UOM.IN_EACH_QTY<!-- 2018/08/27 S21_NA#25001 Add -->
            <!-- 2019/02/06 QC#30187 Add Start -->
            ,SIL.CUST_ISS_PO_NUM                   AS CUST_ISS_PO_NUM_L
            <!-- 2019/02/06 QC#30187 Add End -->
        FROM
             INV_LINE         IL
            ,SVC_INV          SI
            ,SVC_INV_LINE     SIL
            ,SVC_MACH_MSTR    SMM
            ,SHIP_TO_CUST     STC
            ,DS_CTAC_PSN_RELN DCPR
            ,CTAC_PSN         CP
            ,DS_MDL           DM
            ,DS_MDL_GRP       DMG
            ,DS_CONTR_DTL     DCD
            ,MDSE             DMI
            ,INV              I
            <!-- 2018/06/07 QC#26443 Add Start -->
            ,MDSE_STORE_PKG   MSP_UOM
            <!-- 2018/06/07 QC#26443 Add End -->
            ,XTRNL_INTFC_XREF XIX
            ,INV_PRINT_SVC_PGM IPSP
        WHERE
                IL.GLBL_CMPY_CD             = #glblCmpyCd#
            AND IL.INV_NUM                  = #invNum#
            <!-- 2019/11/12 QC#54139 Mod Start -->
            <!-- AND IL.GLBL_CMPY_CD             = SI.GLBL_CMPY_CD -->
            <!-- AND IL.INV_NUM                  = SI.SVC_INV_NUM -->
            AND IL.GLBL_CMPY_CD             = I.GLBL_CMPY_CD
            AND IL.INV_NUM                  = I.INV_NUM
            AND I.GLBL_CMPY_CD              = SI.GLBL_CMPY_CD
            AND I.SVC_INV_PK                = SI.SVC_INV_PK
            <!-- 2019/11/12 QC#54139 Mod End -->
            AND SI.DS_CONTR_CATG_CD  &lt;&gt; #dsContrCatgCdFleet#
            AND IL.GLBL_CMPY_CD            = SIL.GLBL_CMPY_CD
            AND IL.SVC_INV_LINE_PK         = SIL.SVC_INV_LINE_PK
            AND SIL.GLBL_CMPY_CD            = SMM.GLBL_CMPY_CD(+)
            AND SIL.SVC_MACH_MSTR_PK        = SMM.SVC_MACH_MSTR_PK(+)
            AND SMM.GLBL_CMPY_CD            = STC.GLBL_CMPY_CD(+)
            AND SMM.SHIP_TO_CUST_CD         = STC.SHIP_TO_CUST_CD(+)
            AND STC.GLBL_CMPY_CD            = DCPR.GLBL_CMPY_CD(+)
            AND STC.LOC_NUM                 = DCPR.LOC_NUM(+)
            AND DCPR.DS_PRIM_LOC_FLG(+)     = 'Y'
            AND DCPR.EFF_FROM_DT(+)     &lt;= #invoiceDate#
            AND (DCPR.EFF_THRU_DT(+)     &gt;= #invoiceDate# OR DCPR.EFF_THRU_DT(+) IS NULL)
            AND DCPR.GLBL_CMPY_CD           = CP.GLBL_CMPY_CD(+)
            AND DCPR.CTAC_PSN_PK            = CP.CTAC_PSN_PK(+)
            AND SIL.GLBL_CMPY_CD            = DM.GLBL_CMPY_CD(+)
            AND SIL.MDL_ID                  = DM.MDL_ID(+)
            AND DM.GLBL_CMPY_CD             = DMG.GLBL_CMPY_CD(+)
            AND DM.MDL_GRP_ID               = DMG.MDL_GRP_ID(+)
            AND SIL.GLBL_CMPY_CD            = DCD.GLBL_CMPY_CD
            AND SIL.DS_CONTR_DTL_PK         = DCD.DS_CONTR_DTL_PK
            AND IL.GLBL_CMPY_CD             = DMI.GLBL_CMPY_CD(+)
            AND IL.MDSE_CD                  = DMI.MDSE_CD(+)
            <!-- 2019/11/12 QC#54139 Del Start -->
            <!-- AND IL.GLBL_CMPY_CD             = I.GLBL_CMPY_CD -->
            <!-- AND IL.INV_NUM                  = I.INV_NUM -->
            <!-- 2019/11/12 QC#54139 Del End -->
            <!-- 2018/06/07 QC#26443 Add Start -->
            AND IL.GLBL_CMPY_CD             = MSP_UOM.GLBL_CMPY_CD(+)
            AND IL.MDSE_CD                  = MSP_UOM.MDSE_CD(+)
            AND IL.UOM_CD                   = MSP_UOM.PKG_UOM_CD(+)
            <!-- 2018/06/07 QC#26443 Add End -->
            AND IL.GLBL_CMPY_CD             = XIX.GLBL_CMPY_CD(+)
            <!-- 2018/06/07 QC#26443 Mod Start -->
            <!-- AND IL.UOM_CD                   = XIX.TRGT_ATTRB_TXT_02(+) -->
            AND NVL(MSP_UOM.BASE_PKG_UOM_CD, IL.UOM_CD) = XIX.TRGT_ATTRB_TXT_02(+)
            <!-- 2018/06/07 QC#26443 Mod End -->
            <!-- 2018/06/06 QC#26443 Add Start -->
            AND DMI.PKG_UOM_CLS_CD          = XIX.TRGT_ATTRB_TXT_03(+)
            <!-- 2018/06/06 QC#26443 Add End -->
            AND XIX.TRGT_ATTRB_TXT_01(+)    = #dsEdiTrdPtnrCd#
            AND XIX.INTFC_XREF_CTX_TP_CD(+) = #intfcXrefCtxTpCd#
            AND SIL.GLBL_CMPY_CD            = IPSP.GLBL_CMPY_CD(+)
            AND SIL.SVC_PGM_MDSE_CD         = IPSP.INV_PRINT_SVC_PGM_CD(+)
            AND IL.EZCANCELFLAG             = '0'
            AND SI.EZCANCELFLAG             = '0'
            AND SIL.EZCANCELFLAG            = '0'
            AND SMM.EZCANCELFLAG(+)         = '0'
            AND STC.EZCANCELFLAG(+)         = '0'
            AND DCPR.EZCANCELFLAG(+)        = '0'
            AND CP.EZCANCELFLAG(+)          = '0'
            AND DM.EZCANCELFLAG(+)          = '0'
            AND DMG.EZCANCELFLAG(+)         = '0'
            AND DCD.EZCANCELFLAG            = '0'
            AND DMI.EZCANCELFLAG(+)         = '0'
            AND I.EZCANCELFLAG              = '0'
            <!-- 2018/06/07 QC#26443 Add Start -->
            AND MSP_UOM.EZCANCELFLAG(+)     = '0'
            <!-- 2018/06/07 QC#26443 Add End -->
            AND XIX.EZCANCELFLAG(+)         = '0'
            AND IPSP.EZCANCELFLAG(+)        = '0'
        ORDER BY
             IL.INV_BOL_LINE_NUM
            ,IL.INV_LINE_NUM
            ,IL.INV_LINE_SUB_NUM
            ,IL.INV_LINE_SUB_TRX_NUM
    </statement>
    <statement id="getLineDataDispatch" parameterClass="Map" resultClass="Map">
        SELECT
             IL.INV_BOL_LINE_NUM
            ,IL.INV_LINE_NUM
            ,IL.INV_LINE_SUB_NUM
            ,IL.INV_LINE_SUB_TRX_NUM
            ,NVL(IL.INV_DPLY_QTY, IL.SHIP_QTY)                                   AS SHIP_QTY
            <!-- 2018/01/26 QC#22718 Mod Start -->
            <!-- ,NVL(XIX.SRC_ATTRB_TXT_02, IL.UOM_CD)                                AS UOM_CD -->
            ,NVL(XIX.SRC_ATTRB_TXT_01, IL.UOM_CD)                                AS UOM_CD
            <!-- 2018/01/26 QC#22718 Mod End -->
            ,NULL                                                                AS TOTAL_IN_POUND_WEIGHT
            ,DMG.MDL_GRP_NM
            ,DM.MDL_DESC_TXT
            ,NVL(DMI.MNF_ITEM_CD, IL.MDSE_CD)                                    AS MDSE_CD
            ,CASE
                WHEN DMI.MDSE_CD IS NOT NULL
                    THEN DMI.MDSE_DESC_SHORT_TXT
                ELSE IL.MDSE_NM END                                              AS MDSE_NM 
            ,SIL.BLLG_PER_FROM_DT
            ,SIL.BLLG_PER_THRU_DT
            ,IL.DEAL_NET_UNIT_PRC_AMT
            ,IL.INV_LINE_DEAL_NET_AMT
            ,IL.INV_LINE_DEAL_TAX_AMT
            ,SI.SER_NUM
            ,IL.DEAL_GRS_UNIT_PRC_AMT
            ,IL.DEAL_GRS_TOT_PRC_AMT
            ,IL.DEAL_NET_UNIT_PRC_AMT
            ,IL.MDSE_CD                                              AS INV_LINE_MDSE_CD
            <!-- 2018/04/26 QC#25816 Add Start -->
            ,IL.FUNC_NET_UNIT_PRC_AMT
            <!-- 2018/04/26 QC#25816 Add End -->
            ,MSP_UOM.IN_EACH_QTY<!-- 2018/08/27 S21_NA#25001 Add -->
            ,SIL.CUST_ISS_PO_NUM                   AS CUST_ISS_PO_NUM_L <!-- 2019/02/06 S21_NA#30187 Add -->
        FROM
             INV_LINE         IL
            ,SVC_INV          SI
            ,SVC_INV_LINE     SIL
            ,SHIP_TO_CUST     STC
            ,DS_CTAC_PSN_RELN DCPR
            ,CTAC_PSN         CP
            ,DS_MDL           DM
            ,DS_MDL_GRP       DMG
            ,DS_CONTR_DTL     DCD
            ,MDSE             DMI
            ,INV              I
            <!-- 2018/06/07 QC#26443 Add Start -->
            ,MDSE_STORE_PKG   MSP_UOM
            <!-- 2018/06/07 QC#26443 Add End -->
            ,XTRNL_INTFC_XREF XIX
        WHERE
                IL.GLBL_CMPY_CD             = #glblCmpyCd#
            AND IL.INV_NUM                  = #invNum#
            <!-- 2019/11/12 QC#54139 Mod Start -->
            <!-- AND IL.GLBL_CMPY_CD             = SI.GLBL_CMPY_CD -->
            <!-- AND IL.INV_NUM                  = SI.SVC_INV_NUM -->
            AND IL.GLBL_CMPY_CD             = I.GLBL_CMPY_CD
            AND IL.INV_NUM                  = I.INV_NUM
            AND I.GLBL_CMPY_CD             = SI.GLBL_CMPY_CD
            AND I.SVC_INV_PK               = SI.SVC_INV_PK
            <!-- 2019/11/12 QC#54139 Mod End -->
            AND IL.GLBL_CMPY_CD             = SIL.GLBL_CMPY_CD
            AND IL.SVC_INV_LINE_PK          = SIL.SVC_INV_LINE_PK
            AND SI.GLBL_CMPY_CD             = STC.GLBL_CMPY_CD(+)
            AND SI.SHIP_TO_CUST_CD          = STC.SHIP_TO_CUST_CD(+)
            AND STC.GLBL_CMPY_CD            = DCPR.GLBL_CMPY_CD(+)
            AND STC.LOC_NUM                 = DCPR.LOC_NUM(+)
            AND DCPR.DS_PRIM_LOC_FLG(+)     = 'Y'
            AND DCPR.EFF_FROM_DT(+)     &lt;= #invoiceDate#
            AND (DCPR.EFF_THRU_DT(+)    &gt;= #invoiceDate# OR DCPR.EFF_THRU_DT(+) IS NULL)
            AND DCPR.GLBL_CMPY_CD           = CP.GLBL_CMPY_CD(+)
            AND DCPR.CTAC_PSN_PK            = CP.CTAC_PSN_PK(+)
            AND SI.GLBL_CMPY_CD             = DM.GLBL_CMPY_CD(+)
            AND SI.MDL_ID                   = DM.MDL_ID(+)
            AND DM.GLBL_CMPY_CD             = DMG.GLBL_CMPY_CD(+)
            AND DM.MDL_GRP_ID               = DMG.MDL_GRP_ID(+)
            AND SI.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
            AND SI.DS_CONTR_DTL_PK          = DCD.DS_CONTR_DTL_PK
            AND IL.GLBL_CMPY_CD             = DMI.GLBL_CMPY_CD(+)
            AND IL.MDSE_CD                  = DMI.MDSE_CD(+)
            <!-- 2019/11/12 QC#54139 Del Start -->
            <!-- AND IL.GLBL_CMPY_CD             = I.GLBL_CMPY_CD -->
            <!-- AND IL.INV_NUM                  = I.INV_NUM -->
            <!-- 2019/11/12 QC#54139 Del End -->
            <!-- 2018/06/07 QC#26443 Add Start -->
            AND IL.GLBL_CMPY_CD             = MSP_UOM.GLBL_CMPY_CD(+)
            AND IL.MDSE_CD                  = MSP_UOM.MDSE_CD(+)
            AND IL.UOM_CD                   = MSP_UOM.PKG_UOM_CD(+)
            <!-- 2018/06/07 QC#26443 Add End -->
            AND IL.GLBL_CMPY_CD             = XIX.GLBL_CMPY_CD(+)
            <!-- 2018/06/07 QC#26443 Mod Start -->
            <!-- AND IL.UOM_CD                   = XIX.TRGT_ATTRB_TXT_02(+) -->
            AND NVL(MSP_UOM.BASE_PKG_UOM_CD, IL.UOM_CD) = XIX.TRGT_ATTRB_TXT_02(+)
            <!-- 2018/06/07 QC#26443 Mod End -->
            <!-- 2018/06/06 QC#26443 Add Start -->
            AND DMI.PKG_UOM_CLS_CD          = XIX.TRGT_ATTRB_TXT_03(+)
            <!-- 2018/06/06 QC#26443 Add End -->
            AND XIX.TRGT_ATTRB_TXT_01(+)    = #dsEdiTrdPtnrCd#
            AND XIX.INTFC_XREF_CTX_TP_CD(+) = #intfcXrefCtxTpCd#
            AND IL.EZCANCELFLAG             = '0'
            AND SI.EZCANCELFLAG             = '0'
            AND SIL.EZCANCELFLAG            = '0'
            AND STC.EZCANCELFLAG(+)         = '0'
            AND DCPR.EZCANCELFLAG(+)        = '0'
            AND CP.EZCANCELFLAG(+)          = '0'
            AND DM.EZCANCELFLAG(+)          = '0'
            AND DMG.EZCANCELFLAG(+)         = '0'
            AND DCD.EZCANCELFLAG            = '0'
            AND DMI.EZCANCELFLAG(+)         = '0'
            AND I.EZCANCELFLAG              = '0'
            <!-- 2018/06/07 QC#26443 Add Start -->
            AND MSP_UOM.EZCANCELFLAG(+)    = '0'
            <!-- 2018/06/07 QC#26443 Add End -->
            AND XIX.EZCANCELFLAG(+)         = '0'
        ORDER BY
             IL.INV_BOL_LINE_NUM
            ,IL.INV_LINE_NUM
            ,IL.INV_LINE_SUB_NUM
            ,IL.INV_LINE_SUB_TRX_NUM
    </statement>
    <statement id="getCustMdseXrefInfo" parameterClass="Map" resultClass="Map">
        SELECT
             CUST_MDSE_CD
            ,CUST_MDSE_NM
        FROM
            (
                SELECT
                     CMX.CUST_MDSE_CD
                    ,CMX.CUST_MDSE_NM
                FROM
                    CUST_MDSE_XREF CMX
                WHERE
                        CMX.GLBL_CMPY_CD            = #glblCmpyCd#
                    AND CMX.MDSE_CD                 = #mdseCd#
                    AND CMX.DS_ACCT_NUM             = #dsAcctNum#
                    AND CMX.CUST_MDSE_XREF_ENBL_FLG = 'Y'
                    AND CMX.EFF_FROM_DT            &lt;= #effFromDt#
                    AND CMX.EZCANCELFLAG            = '0'
                ORDER BY
                     CMX.EFF_FROM_DT
                    ,CMX.CUST_MDSE_CD
            )
        WHERE
            ROWNUM = 1
    </statement>
    <statement id="getMeterSummary" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            SUM(SILM.BLLG_COPY_QTY) AS SUM_BLLG_COPY_QTY
        FROM
             INV_LINE         IL
            ,SVC_INV_LINE     SIL
            ,SVC_INV_LINE_MTR SILM
        WHERE
                IL.GLBL_CMPY_CD         = #glblCmpyCd#
            AND IL.INV_NUM              = #invNum#
            AND IL.INV_BOL_LINE_NUM     = #invBolLineNum#
            AND IL.INV_LINE_NUM         = #invLineNum#
            AND IL.INV_LINE_SUB_NUM     = #invLineSubNum#
            AND IL.INV_LINE_SUB_TRX_NUM = #invLineSubTrxNum#
            AND IL.GLBL_CMPY_CD         = SIL.GLBL_CMPY_CD
            AND IL.SVC_INV_LINE_PK      = SIL.SVC_INV_LINE_PK
            AND IL.GLBL_CMPY_CD         = SILM.GLBL_CMPY_CD
            AND IL.SVC_INV_LINE_PK      = SILM.SVC_INV_LINE_PK
            AND IL.EZCANCELFLAG         = '0'
            AND SIL.EZCANCELFLAG        = '0'
            AND SILM.EZCANCELFLAG       = '0'
    </statement>
    <statement id="getMeterSummaryAGG" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            SUM(SILM.BLLG_COPY_QTY) AS SUM_BLLG_COPY_QTY
        FROM
             INV_LINE         IL
            ,SVC_INV_LINE     SIL
            ,SVC_INV_LINE_MTR SILM
        WHERE
                IL.GLBL_CMPY_CD         = #glblCmpyCd#
            AND IL.INV_NUM              = #invNum#
            AND IL.GLBL_CMPY_CD         = SIL.GLBL_CMPY_CD
            AND IL.SVC_INV_LINE_PK      = SIL.SVC_INV_LINE_PK
            AND IL.GLBL_CMPY_CD         = SILM.GLBL_CMPY_CD
            AND IL.SVC_INV_LINE_PK      = SILM.SVC_INV_LINE_PK
            AND IL.EZCANCELFLAG         = '0'
            AND SIL.EZCANCELFLAG        = '0'
            AND SILM.EZCANCELFLAG       = '0'
    </statement>
    <statement id="getMeterDataFleet" parameterClass="Map" resultClass="Map">
        SELECT
             SILM.PREV_TOT_COPY_QTY
            ,SILM.TOT_COPY_QTY
            <!-- 2019/01/10 QC#29534 Add Start -->
            ,SPMR_O.READ_MTR_CNT      READ_MTR_CNT_OR
            ,SPMR_P.READ_MTR_CNT      READ_MTR_CNT_PR
            <!-- 2019/01/10 QC#29534 Add End -->
        FROM
             INV_LINE         IL
            ,SVC_INV          SI
            ,SVC_INV_LINE     SILFL
            ,SVC_INV_LINE     SILML
            ,DS_CONTR_DTL     DCD
            ,SVC_MACH_MSTR    SMM
            ,DS_MDL           DM
            ,DS_MDL_GRP       DMG
            ,SVC_INV_LINE_MTR SILM
            <!-- 2019/01/10 QC#29534 Add Start -->
            ,CONTR_PHYS_BLLG_MTR_RELN  CPBMR
            ,SVC_PHYS_MTR              SPM
            ,SVC_PHYS_MTR_READ         SPMR_O
            ,SVC_PHYS_MTR_READ         SPMR_P
            <!-- 2019/01/10 QC#29534 Add End -->
            <!-- 2019/11/12 QC#54139 Add Start -->
            ,INV              I
            <!-- 2019/11/12 QC#54139 Add End -->
        WHERE
                IL.GLBL_CMPY_CD         = #glblCmpyCd#
            AND IL.INV_NUM              = #invNum#
            AND IL.INV_BOL_LINE_NUM     = #invBolLineNum#
            AND IL.INV_LINE_NUM         = #invLineNum#
            AND IL.INV_LINE_SUB_NUM     = #invLineSubNum#
            AND IL.INV_LINE_SUB_TRX_NUM = #invLineSubTrxNum#
            <!-- 2019/11/12 QC#54139 Mod Start -->
            <!-- AND IL.GLBL_CMPY_CD         = SI.GLBL_CMPY_CD -->
            <!-- AND IL.INV_NUM              = SI.SVC_INV_NUM -->
            AND IL.GLBL_CMPY_CD         = I.GLBL_CMPY_CD
            AND IL.INV_NUM              = I.INV_NUM
            AND I.GLBL_CMPY_CD          = SI.GLBL_CMPY_CD
            AND I.SVC_INV_PK            = SI.SVC_INV_PK
            <!-- 2019/11/12 QC#54139 Mod End -->
            AND SI.SVC_INV_SRC_TP_CD    = #svcInvSrcTpCd#
            AND SI.DS_CONTR_CATG_CD     = #dsContrCatgCd#
            AND IL.GLBL_CMPY_CD         = SILFL.GLBL_CMPY_CD
            AND IL.SVC_INV_LINE_PK      = SILFL.SVC_INV_LINE_PK
            AND SILFL.GLBL_CMPY_CD      = SILML.GLBL_CMPY_CD
            AND SILFL.SVC_INV_LINE_PK   = SILML.PRNT_SVC_INV_LINE_PK
            AND SILML.GLBL_CMPY_CD      = DCD.GLBL_CMPY_CD
            AND SILML.DS_CONTR_DTL_PK   = DCD.DS_CONTR_DTL_PK
            AND DCD.GLBL_CMPY_CD        = SMM.GLBL_CMPY_CD
            AND DCD.SVC_MACH_MSTR_PK    = SMM.SVC_MACH_MSTR_PK
            AND SILML.GLBL_CMPY_CD      = DM.GLBL_CMPY_CD(+)
            AND SILML.MDL_ID            = DM.MDL_ID(+)
            AND DM.GLBL_CMPY_CD         = DMG.GLBL_CMPY_CD(+)
            AND DM.MDL_GRP_ID           = DMG.MDL_GRP_ID(+)
            AND SILFL.GLBL_CMPY_CD      = SILM.GLBL_CMPY_CD
            AND SILFL.SVC_INV_LINE_PK   = SILM.SVC_INV_LINE_PK
            AND IL.EZCANCELFLAG         = '0'
            AND SI.EZCANCELFLAG         = '0'
            AND SILFL.EZCANCELFLAG      = '0'
            AND SILML.EZCANCELFLAG      = '0'
            AND DCD.EZCANCELFLAG        = '0'
            AND SMM.EZCANCELFLAG        = '0'
            AND DM.EZCANCELFLAG(+)      = '0'
            AND DMG.EZCANCELFLAG(+)     = '0'
            AND SILM.EZCANCELFLAG       = '0'
            <!-- 2019/11/12 QC#54139 Add Start -->
            AND I.EZCANCELFLAG          = '0'
            <!-- 2019/11/12 QC#54139 Add End -->
            <!-- 2019/01/10 QC#29534 Add Start -->
            AND SILM.GLBL_CMPY_CD              = CPBMR.GLBL_CMPY_CD
            AND SILM.DS_CONTR_BLLG_MTR_PK      = CPBMR.DS_CONTR_BLLG_MTR_PK
            AND CPBMR.GLBL_CMPY_CD             = SPM.GLBL_CMPY_CD
            AND CPBMR.SVC_PHYS_MTR_PK          = SPM.SVC_PHYS_MTR_PK
            AND SPM.GLBL_CMPY_CD               = SPMR_O.GLBL_CMPY_CD(+)
            AND SPM.MDL_MTR_LB_CD              = SPMR_O.MTR_LB_CD(+)
            AND SILM.SVC_PHYS_MTR_READ_GRP_SQ  = SPMR_O.SVC_PHYS_MTR_READ_GRP_SQ(+)
            AND SPM.GLBL_CMPY_CD               = SPMR_P.GLBL_CMPY_CD(+)
            AND SPM.MDL_MTR_LB_CD              = SPMR_P.MTR_LB_CD(+)
            AND SILM.PREV_PHYS_MTR_READ_GRP_SQ = SPMR_P.SVC_PHYS_MTR_READ_GRP_SQ(+)
            AND CPBMR.EZCANCELFLAG             = '0'
            AND SPM.EZCANCELFLAG               = '0'
            AND SPMR_O.EZCANCELFLAG(+)         = '0'
            AND SPMR_P.EZCANCELFLAG(+)         = '0'
            <!-- 2019/01/10 QC#29534 Add End -->
        ORDER BY
            SILM.SVC_INV_LINE_MTR_PK
    </statement>
    <statement id="getMeterDataRegularOrAggregate" parameterClass="Map" resultClass="Map">
        SELECT
             SILM.PREV_TOT_COPY_QTY
            ,SILM.TOT_COPY_QTY
            <!-- 2019/01/10 QC#29534 Add Start -->
            ,SPMR_O.READ_MTR_CNT      READ_MTR_CNT_OR
            ,SPMR_P.READ_MTR_CNT      READ_MTR_CNT_PR
            <!-- 2019/01/10 QC#29534 Add End -->
        FROM
             INV_LINE         IL
            ,SVC_INV          SI
            ,SVC_INV_LINE     SIL
            ,DS_CONTR_DTL     DCD
            ,SVC_MACH_MSTR    SMM
            ,SVC_INV_LINE_MTR SILM
            <!-- 2019/01/10 QC#29534 Add Start -->
            ,CONTR_PHYS_BLLG_MTR_RELN  CPBMR
            ,SVC_PHYS_MTR              SPM
            ,SVC_PHYS_MTR_READ         SPMR_O
            ,SVC_PHYS_MTR_READ         SPMR_P
            <!-- 2019/01/10 QC#29534 Add End -->
            <!-- 2019/11/12 QC#54139 Add Start -->
            ,INV              I
            <!-- 2019/11/12 QC#54139 Add End -->
        WHERE
                IL.GLBL_CMPY_CD         = #glblCmpyCd#
            AND IL.INV_NUM              = #invNum#
            AND IL.INV_BOL_LINE_NUM     = #invBolLineNum#
            AND IL.INV_LINE_NUM         = #invLineNum#
            AND IL.INV_LINE_SUB_NUM     = #invLineSubNum#
            AND IL.INV_LINE_SUB_TRX_NUM = #invLineSubTrxNum#
            <!-- 2019/11/12 QC#54139 Mod Start -->
            <!-- AND IL.GLBL_CMPY_CD         = SI.GLBL_CMPY_CD -->
            <!-- AND IL.INV_NUM              = SI.SVC_INV_NUM -->
            AND IL.GLBL_CMPY_CD         = I.GLBL_CMPY_CD
            AND IL.INV_NUM              = I.INV_NUM
            AND I.GLBL_CMPY_CD          = SI.GLBL_CMPY_CD
            AND I.SVC_INV_PK            = SI.SVC_INV_PK
            <!-- 2019/11/12 QC#54139 Mod End -->
            AND SI.SVC_INV_SRC_TP_CD    = #svcInvSrcTpCd#
            AND SI.DS_CONTR_CATG_CD    &lt;&gt; #dsContrCatgCd#
            AND IL.GLBL_CMPY_CD         = SIL.GLBL_CMPY_CD
            AND IL.SVC_INV_LINE_PK      = SIL.SVC_INV_LINE_PK
            AND SIL.GLBL_CMPY_CD        = DCD.GLBL_CMPY_CD
            AND SIL.DS_CONTR_DTL_PK     = DCD.DS_CONTR_DTL_PK
            AND DCD.GLBL_CMPY_CD        = SMM.GLBL_CMPY_CD
            AND DCD.SVC_MACH_MSTR_PK    = SMM.SVC_MACH_MSTR_PK
            AND SIL.GLBL_CMPY_CD        = SILM.GLBL_CMPY_CD
            AND SIL.SVC_INV_LINE_PK     = SILM.SVC_INV_LINE_PK
            AND IL.EZCANCELFLAG         = '0'
            AND SI.EZCANCELFLAG         = '0'
            AND SIL.EZCANCELFLAG        = '0'
            AND DCD.EZCANCELFLAG        = '0'
            AND SMM.EZCANCELFLAG        = '0'
            AND SILM.EZCANCELFLAG       = '0'
            <!-- 2019/11/12 QC#54139 Add Start -->
            AND I.EZCANCELFLAG          = '0'
            <!-- 2019/11/12 QC#54139 Add End -->
            <!-- 2019/01/10 QC#29534 Add Start -->
            AND SILM.GLBL_CMPY_CD              = CPBMR.GLBL_CMPY_CD
            AND SILM.DS_CONTR_BLLG_MTR_PK      = CPBMR.DS_CONTR_BLLG_MTR_PK
            AND CPBMR.GLBL_CMPY_CD             = SPM.GLBL_CMPY_CD
            AND CPBMR.SVC_PHYS_MTR_PK          = SPM.SVC_PHYS_MTR_PK
            AND SPM.GLBL_CMPY_CD               = SPMR_O.GLBL_CMPY_CD(+)
            AND SPM.MDL_MTR_LB_CD              = SPMR_O.MTR_LB_CD(+)
            AND SILM.SVC_PHYS_MTR_READ_GRP_SQ  = SPMR_O.SVC_PHYS_MTR_READ_GRP_SQ(+)
            AND SPM.GLBL_CMPY_CD               = SPMR_P.GLBL_CMPY_CD(+)
            AND SPM.MDL_MTR_LB_CD              = SPMR_P.MTR_LB_CD(+)
            AND SILM.PREV_PHYS_MTR_READ_GRP_SQ = SPMR_P.SVC_PHYS_MTR_READ_GRP_SQ(+)
            AND CPBMR.EZCANCELFLAG             = '0'
            AND SPM.EZCANCELFLAG               = '0'
            AND SPMR_O.EZCANCELFLAG(+)         = '0'
            AND SPMR_P.EZCANCELFLAG(+)         = '0'
            <!-- 2019/01/10 QC#29534 Add End -->
        ORDER BY
            SILM.SVC_INV_LINE_MTR_PK
    </statement>
    <statement id="getShipDataOm" parameterClass="Map" resultClass="Map">
        SELECT
             IB.GLBL_CMPY_CD
            ,IB.INV_NUM
            ,IB.INV_BOL_LINE_NUM
            ,IB.SHIP_TO_CUST_CD
            ,IB.SHIP_TO_CUST_ACCT_NM                                                            AS DS_ACCT_NM
            ,IB.SHIP_TO_FIRST_LINE_ADDR                                                          AS FIRST_LINE_ADDR
            ,IB.SHIP_TO_SCD_LINE_ADDR || ' ' || IB.SHIP_TO_THIRD_LINE_ADDR || ' ' || IB.SHIP_TO_FRTH_LINE_ADDR AS ADDRESS
            ,IB.SHIP_TO_CTY_ADDR AS CTY_ADDR
            ,IB.SHIP_TO_POST_CD  AS POST_CD
            ,IB.SHIP_TO_CTRY_CD  AS CTRY_CD
            ,IB.SHIP_TO_CNTY_NM  AS CNTY_NM
            ,IB.SHIP_TO_ST_CD    AS ST_CD
            ,DCP1.DS_CTAC_PNT_VAL_TXT AS DS_CTAC_PNT_VAL_TXT_1
            ,DCP2.DS_CTAC_PNT_VAL_TXT AS DS_CTAC_PNT_VAL_TXT_2
            <!-- 2018/01/26 QC#22718 Add Start -->
            ,IB.SHIP_TO_LOC_NM
            ,IB.DROP_SHIP_FLG
            <!-- 2018/01/26 QC#22718 Add End -->
            <!-- 2018/09/18 QC#28159 Add Start -->
            ,IB.SHIP_TO_CUST_ACCT_CD
            <!-- 2018/09/18 QC#28159 Add End -->
        FROM
             INV_BOL     IB
            ,DS_CTAC_PNT DCP1
            ,DS_CTAC_PNT DCP2
        WHERE
                IB.GLBL_CMPY_CD           = #glblCmpyCd#
            AND IB.INV_NUM                = #invNum#
            AND IB.INV_BOL_LINE_NUM       = #invBolLineNum#
            AND IB.GLBL_CMPY_CD           = DCP1.GLBL_CMPY_CD(+)
            AND IB.CTAC_PSN_PK            = DCP1.CTAC_PSN_PK(+)
            AND DCP1.DS_CTAC_PNT_TP_CD(+) = #dsCtacPntTpCdPhoneWork#
            AND IB.GLBL_CMPY_CD           = DCP2.GLBL_CMPY_CD(+)
            AND IB.CTAC_PSN_PK            = DCP2.CTAC_PSN_PK(+)
            AND DCP2.DS_CTAC_PNT_TP_CD(+) = #dsCtacPntTpCdPhoneMobile#
            AND IB.EZCANCELFLAG           = '0'
            AND DCP1.EZCANCELFLAG(+)      = '0'
            AND DCP2.EZCANCELFLAG(+)      = '0'
    </statement>
    <statement id="getShipDataContract" parameterClass="Map" resultClass="Map">
        SELECT
             STC.SHIP_TO_CUST_CD
            ,SEL.DS_ACCT_NM
            ,STC.FIRST_LINE_ADDR
            ,STC.SCD_LINE_ADDR || ' ' || STC.THIRD_LINE_ADDR || ' ' || STC.FRTH_LINE_ADDR AS ADDRESS
            ,STC.CTY_ADDR
            ,STC.POST_CD
            ,STC.CTRY_CD
            ,C.CNTY_NM
            ,STC.ST_CD
            <!-- 2019/02/05 QC#30173 Mod Start -->
            ,STC.TEL_NUM              AS DS_CTAC_PNT_VAL_TXT_1
            <!-- 2019/02/05 QC#30173 Mod End -->
            ,DCP2.DS_CTAC_PNT_VAL_TXT AS DS_CTAC_PNT_VAL_TXT_2
            <!-- 2018/09/18 QC#28159 Add Start -->
            ,DIB.SHIP_TO_CUST_ACCT_CD
            <!-- 2018/09/18 QC#28159 Add End -->
        FROM
             INV_LINE         IL
            ,SVC_INV          SI
            ,SVC_INV_LINE     SIL
            ,SHIP_TO_CUST     STC
            ,CNTY             C
            ,ACCT_LOC         AL
            ,SELL_TO_CUST     SEL
            ,INV_BOL          DIB
            ,CTAC_PSN         CP
            ,DS_CTAC_PNT      DCP1
            ,DS_CTAC_PNT      DCP2
            <!-- 2019/11/12 QC#54139 Add Start -->
            ,INV              I
            <!-- 2019/11/12 QC#54139 Add End -->
        WHERE
                IL.GLBL_CMPY_CD                   = #glblCmpyCd#
            AND IL.INV_NUM                        = #invNum#
            AND IL.INV_BOL_LINE_NUM               = #invBolLineNum#
            AND IL.INV_LINE_NUM                   = #invLineNum#
            AND IL.INV_LINE_SUB_NUM               = #invLineSubNum#
            AND IL.INV_LINE_SUB_TRX_NUM           = #invLineSubTrxNum#
            <!-- 2019/11/12 QC#54139 Mod Start -->
            <!-- AND IL.GLBL_CMPY_CD                   = SI.GLBL_CMPY_CD -->
            <!-- AND IL.INV_NUM                        = SI.SVC_INV_NUM -->
            AND IL.GLBL_CMPY_CD                   = I.GLBL_CMPY_CD
            AND IL.INV_NUM                        = I.INV_NUM
            AND I.GLBL_CMPY_CD                    = SI.GLBL_CMPY_CD
            AND I.SVC_INV_PK                      = SI.SVC_INV_PK
            <!-- 2019/11/12 QC#54139 Mod End -->
            AND IL.GLBL_CMPY_CD                   = SIL.GLBL_CMPY_CD
            AND IL.SVC_INV_LINE_PK                = SIL.SVC_INV_LINE_PK
            AND SIL.GLBL_CMPY_CD                  = STC.GLBL_CMPY_CD(+)
            AND SIL.SHIP_TO_CUST_CD               = STC.SHIP_TO_CUST_CD(+)
            AND STC.GLBL_CMPY_CD                  = C.GLBL_CMPY_CD(+)
            AND STC.CNTY_PK                       = C.CNTY_PK(+)
            AND STC.GLBL_CMPY_CD                  = AL.GLBL_CMPY_CD(+)
            AND STC.LOC_NUM                       = AL.LOC_NUM(+)
            AND AL.EFF_FROM_DT(+)                 &lt;= #invDt#
            AND NVL(AL.EFF_THRU_DT(+), #limitDt#) &gt;= #invDt#
            AND AL.GLBL_CMPY_CD                   = SEL.GLBL_CMPY_CD(+)
            AND AL.DS_ACCT_NUM                    = SEL.SELL_TO_CUST_CD(+)
            AND IL.GLBL_CMPY_CD                   = DIB.GLBL_CMPY_CD
            AND IL.INV_NUM                        = DIB.INV_NUM
            AND IL.INV_BOL_LINE_NUM               = DIB.INV_BOL_LINE_NUM
            AND DIB.GLBL_CMPY_CD                  = CP.GLBL_CMPY_CD(+)
            AND DIB.CTAC_PSN_PK                   = CP.CTAC_PSN_PK(+)
            AND DIB.GLBL_CMPY_CD                  = DCP1.GLBL_CMPY_CD(+)
            AND DIB.CTAC_PSN_PK                   = DCP1.CTAC_PSN_PK(+)
            AND DCP1.DS_CTAC_PNT_TP_CD(+)         = #dsCtacPntTpCdPhoneWork#
            AND DIB.GLBL_CMPY_CD                  = DCP2.GLBL_CMPY_CD(+)
            AND DIB.CTAC_PSN_PK                   = DCP2.CTAC_PSN_PK(+)
            AND DCP2.DS_CTAC_PNT_TP_CD(+)         = #dsCtacPntTpCdPhoneMobile#
            AND IL.EZCANCELFLAG                   = '0'
            AND SI.EZCANCELFLAG                   = '0'
            AND SIL.EZCANCELFLAG                  = '0'
            AND STC.EZCANCELFLAG(+)               = '0'
            AND C.EZCANCELFLAG(+)                 = '0'
            AND AL.EZCANCELFLAG(+)                = '0'
            AND SEL.EZCANCELFLAG(+)               = '0'
            AND DIB.EZCANCELFLAG                  = '0'
            AND CP.EZCANCELFLAG(+)                = '0'
            AND DCP1.EZCANCELFLAG(+)              = '0'
            AND DCP2.EZCANCELFLAG(+)              = '0'
            <!-- 2019/11/12 QC#54139 Add Start -->
            AND I.EZCANCELFLAG                    = '0'
            <!-- 2019/11/12 QC#54139 Add End -->
    </statement>
    <statement id="getShipDataDispatch" parameterClass="Map" resultClass="Map">
        SELECT
             STC.SHIP_TO_CUST_CD
            ,SEL.DS_ACCT_NM
            ,STC.FIRST_LINE_ADDR
            ,STC.SCD_LINE_ADDR || ' ' || STC.THIRD_LINE_ADDR || ' ' || STC.FRTH_LINE_ADDR AS ADDRESS
            ,STC.CTY_ADDR
            ,STC.POST_CD
            ,STC.CTRY_CD
            ,C.CNTY_NM
            ,STC.ST_CD
            <!-- 2019/02/05 QC#30173 Mod Start -->
            ,STC.TEL_NUM              AS DS_CTAC_PNT_VAL_TXT_1
            <!-- 2019/02/05 QC#30173 Mod End -->
            ,DCP2.DS_CTAC_PNT_VAL_TXT AS DS_CTAC_PNT_VAL_TXT_2
            <!-- 2018/09/18 QC#28159 Add Start -->
            ,DIB.SHIP_TO_CUST_ACCT_CD
            <!-- 2018/09/18 QC#28159 Add End -->
        FROM
             INV_LINE         IL
            ,SVC_INV          SI
            ,SHIP_TO_CUST     STC
            ,CNTY             C
            ,ACCT_LOC         AL
            ,SELL_TO_CUST     SEL
            ,INV_BOL          DIB
            ,CTAC_PSN         CP
            ,DS_CTAC_PNT      DCP1
            ,DS_CTAC_PNT      DCP2
            <!-- 2019/11/12 QC#54139 Add Start -->
            ,INV              I
            <!-- 2019/11/12 QC#54139 Add End -->
        WHERE
                IL.GLBL_CMPY_CD                   = #glblCmpyCd#
            AND IL.INV_NUM                        = #invNum#
            AND IL.INV_BOL_LINE_NUM               = #invBolLineNum#
            AND IL.INV_LINE_NUM                   = #invLineNum#
            AND IL.INV_LINE_SUB_NUM               = #invLineSubNum#
            AND IL.INV_LINE_SUB_TRX_NUM           = #invLineSubTrxNum#
            <!-- 2019/11/12 QC#54139 Mod Start -->
            <!-- AND IL.GLBL_CMPY_CD                   = SI.GLBL_CMPY_CD -->
            <!-- AND IL.INV_NUM                        = SI.SVC_INV_NUM -->
            AND IL.GLBL_CMPY_CD                   = I.GLBL_CMPY_CD
            AND IL.INV_NUM                        = I.INV_NUM
            AND I.GLBL_CMPY_CD                    = SI.GLBL_CMPY_CD
            AND I.SVC_INV_PK                      = SI.SVC_INV_PK
            <!-- 2019/11/12 QC#54139 Mod End -->
            AND SI.GLBL_CMPY_CD                   = STC.GLBL_CMPY_CD(+)
            AND SI.SHIP_TO_CUST_CD                = STC.SHIP_TO_CUST_CD(+)
            AND STC.GLBL_CMPY_CD                  = C.GLBL_CMPY_CD(+)
            AND STC.CNTY_PK                       = C.CNTY_PK(+)
            AND STC.GLBL_CMPY_CD                  = AL.GLBL_CMPY_CD(+)
            AND STC.LOC_NUM                       = AL.LOC_NUM(+)
            AND AL.EFF_FROM_DT(+)                 &lt;= #invDt#
            AND NVL(AL.EFF_THRU_DT(+), #limitDt#) &gt;= #invDt#
            AND AL.GLBL_CMPY_CD                   = SEL.GLBL_CMPY_CD(+)
            AND AL.DS_ACCT_NUM                    = SEL.SELL_TO_CUST_CD(+)
            AND IL.GLBL_CMPY_CD                   = DIB.GLBL_CMPY_CD
            AND IL.INV_NUM                        = DIB.INV_NUM
            AND IL.INV_BOL_LINE_NUM               = DIB.INV_BOL_LINE_NUM
            AND DIB.GLBL_CMPY_CD                  = CP.GLBL_CMPY_CD(+)
            AND DIB.CTAC_PSN_PK                   = CP.CTAC_PSN_PK(+)
            AND DIB.GLBL_CMPY_CD                  = DCP1.GLBL_CMPY_CD(+)
            AND DIB.CTAC_PSN_PK                   = DCP1.CTAC_PSN_PK(+)
            AND DCP1.DS_CTAC_PNT_TP_CD(+)         = #dsCtacPntTpCdPhoneWork#
            AND DIB.GLBL_CMPY_CD                  = DCP2.GLBL_CMPY_CD(+)
            AND DIB.CTAC_PSN_PK                   = DCP2.CTAC_PSN_PK(+)
            AND DCP2.DS_CTAC_PNT_TP_CD(+)         = #dsCtacPntTpCdPhoneMobile#
            AND IL.EZCANCELFLAG                   = '0'
            AND SI.EZCANCELFLAG                   = '0'
            AND STC.EZCANCELFLAG(+)               = '0'
            AND C.EZCANCELFLAG(+)                 = '0'
            AND AL.EZCANCELFLAG(+)                = '0'
            AND SEL.EZCANCELFLAG(+)               = '0'
            AND DIB.EZCANCELFLAG                  = '0'
            AND CP.EZCANCELFLAG(+)                = '0'
            AND DCP1.EZCANCELFLAG(+)              = '0'
            AND DCP2.EZCANCELFLAG(+)              = '0'
            <!-- 2019/11/12 QC#54139 Add Start -->
            AND I.EZCANCELFLAG                    = '0'
            <!-- 2019/11/12 QC#54139 Add End -->
    </statement>
    <statement id="getUpdateTarget" parameterClass="Map" resultClass="Map">
        SELECT
           IPC.INV_PRT_CTRL_PK
        FROM
           INV_PRT_CTRL IPC
        WHERE
               IPC.GLBL_CMPY_CD        = #glblCmpyCd#
           AND IPC.INV_NUM             = #invNum#
           AND IPC.INV_EDI_PROC_STS_CD = #invEdiProcStsCd#
           AND IPC.EZCANCELFLAG        = '0'
    </statement>
    <!-- 2018/04/26 QC#25815 Add Start -->
    <statement id="getRtlWhCd" parameterClass="Map" resultClass="String">
        SELECT
           RS.RTL_WH_CD
        FROM
            INV_BOL   IB
           ,RTL_SWH   RS
        WHERE
               IB.GLBL_CMPY_CD            = #glblCmpyCd#
           AND IB.INV_NUM                 = #invNum#
           AND IB.INV_BOL_LINE_NUM        = #invBolLineNum#
           AND IB.EZCANCELFLAG            = '0'

           AND IB.GLBL_CMPY_CD            = RS.GLBL_CMPY_CD
           AND IB.SHIP_FROM_INVTY_LOC_CD  = RS.INVTY_LOC_CD
           AND RS.EZCANCELFLAG            = '0'
    </statement>
    <!-- 2018/04/26 QC#25815 Add End -->
    <!-- 2018/10/03 QC#27032 Add Start -->
    <statement id="getPntpNetAmount" parameterClass="Map" resultClass="Map">
        SELECT
            IL.GLBL_CMPY_CD
            ,IL.INV_NUM
            ,SUM(IL.INV_LINE_DEAL_NET_AMT) AS PNTP_NET_AMT
        FROM
            INV_LINE IL
        WHERE
            IL.GLBL_CMPY_CD = #glblCmpyCd#
            AND IL.INV_NUM = #invNum#
            AND IL.INV_LINE_CATG_CD = #invLineCatgItem#
            AND IL.EZCANCELFLAG = '0'
            AND EXISTS (
                SELECT
                    1
                FROM
                    ORD_PRC_CALC_BASE OPCB
                    , SPEC_COND_PRC SCP
                    , PRC_ADJ_DTL PAD 
                WHERE
                    IL.GLBL_CMPY_CD = OPCB.GLBL_CMPY_CD
                    AND IL.CPO_ORD_NUM = OPCB.CPO_ORD_NUM
                    AND IL.CPO_DTL_LINE_NUM = OPCB.CPO_DTL_LINE_NUM
                    AND IL.CPO_DTL_LINE_SUB_NUM = OPCB.CPO_DTL_LINE_SUB_NUM
                    AND OPCB.EZCANCELFLAG = '0'
                    AND OPCB.GLBL_CMPY_CD = SCP.GLBL_CMPY_CD
                    AND OPCB.SPEC_COND_PRC_PK = SCP.SPEC_COND_PRC_PK
                    AND SCP.EZCANCELFLAG = '0'
                    AND SCP.GLBL_CMPY_CD = PAD.GLBL_CMPY_CD 
                    AND SCP.PRC_RULE_DTL_PK = PAD.PRC_RULE_DTL_PK 
                    <iterate property="pntpPrcRuleHdrPkList" var="pntpPrcRuleHdrPk[]" open=" AND PAD.PRC_RULE_HDR_PK IN (" close=")" conjunction=",">
                        #pntpPrcRuleHdrPk[]#
                    </iterate>
                    AND PAD.EZCANCELFLAG = '0'
            )
        GROUP BY
            IL.GLBL_CMPY_CD
            ,IL.INV_NUM
    </statement>
    <statement id="getLineDealNetFrtAmt" parameterClass="Map" resultClass="Map">
        SELECT
            IL.GLBL_CMPY_CD
            ,IL.INV_NUM
            ,IL.CPO_ORD_NUM
            ,IL.CPO_DTL_LINE_NUM
            ,IL.CPO_DTL_LINE_SUB_NUM
            ,SUM(INV_LINE_DEAL_NET_AMT) AS INV_LINE_DEAL_NET_FRT_AMT
        FROM
            INV_LINE IL
        WHERE
            IL.GLBL_CMPY_CD             = #glblCmpyCd#
            AND IL.INV_NUM              = #invNum#
            AND IL.INV_BOL_LINE_NUM     = #invBolLineNum#
            AND IL.CPO_ORD_NUM          = #cpoOrdNum#
            AND IL.CPO_DTL_LINE_NUM     = #cpoDtlLineNum#
            AND IL.CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
            AND IL.INV_LINE_CATG_CD     = #invLineCatgFrt#
            AND IL.EZCANCELFLAG         = '0'
        GROUP BY
            IL.GLBL_CMPY_CD
            ,IL.INV_NUM
            ,IL.CPO_ORD_NUM
            ,IL.CPO_DTL_LINE_NUM
            ,IL.CPO_DTL_LINE_SUB_NUM
    </statement>
    <statement id="getLineZsfSpecialChargeAmt" parameterClass="Map" resultClass="Map">
        SELECT
            IL.GLBL_CMPY_CD
            ,IL.INV_NUM
            ,IL.INV_BOL_LINE_NUM
            ,IL.CPO_ORD_NUM
            ,IL.CPO_DTL_LINE_NUM
            ,IL.CPO_DTL_LINE_SUB_NUM
            ,SUM(IL.INV_LINE_DEAL_NET_AMT) AS ZSF_NET_AMT
        FROM
            INV_LINE IL
        WHERE
            IL.GLBL_CMPY_CD = #glblCmpyCd#
            AND IL.INV_NUM = #invNum#
            AND IL.INV_BOL_LINE_NUM = #invBolLineNum#
            AND IL.CPO_ORD_NUM = #cpoOrdNum#
            AND IL.CPO_DTL_LINE_NUM = #cpoDtlLineNum#
            AND IL.CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
            AND IL.INV_LINE_CATG_CD = #invLineCatgCharge#
            AND IL.EZCANCELFLAG = '0'
            AND EXISTS (
                SELECT
                    1
                FROM
                    ORD_PRC_CALC_BASE OPCB
                    , SPEC_COND_PRC SCP
                    , PRC_RULE_DTL PRD
                WHERE
                    IL.GLBL_CMPY_CD = OPCB.GLBL_CMPY_CD
                    AND IL.CPO_ORD_NUM = OPCB.CPO_ORD_NUM
                    AND IL.CPO_DTL_LINE_NUM = OPCB.CPO_DTL_LINE_NUM
                    AND IL.CPO_DTL_LINE_SUB_NUM = OPCB.CPO_DTL_LINE_SUB_NUM
                    AND OPCB.EZCANCELFLAG = '0'
                    AND OPCB.GLBL_CMPY_CD = SCP.GLBL_CMPY_CD
                    AND OPCB.SPEC_COND_PRC_PK = SCP.SPEC_COND_PRC_PK
                    AND SCP.EZCANCELFLAG = '0'
                    AND SCP.GLBL_CMPY_CD = PRD.GLBL_CMPY_CD 
                    AND SCP.PRC_RULE_DTL_PK = PRD.PRC_RULE_DTL_PK 
                    <iterate property="spclHdlgPrcRuleHdrPkList" var="spclHdlgPrcRuleHdrPk[]" open=" AND PRD.PRC_RULE_HDR_PK IN (" close=")" conjunction=",">
                        #spclHdlgPrcRuleHdrPk[]#
                    </iterate>
                    AND PRD.EZCANCELFLAG = '0'
            )
        GROUP BY
            IL.GLBL_CMPY_CD
            ,IL.INV_NUM
            ,IL.INV_BOL_LINE_NUM
            ,IL.CPO_ORD_NUM
            ,IL.CPO_DTL_LINE_NUM
            ,IL.CPO_DTL_LINE_SUB_NUM
    </statement>
    <statement id="getHdrZsfSpecialChargeAmt" parameterClass="Map" resultClass="Map">
        SELECT
            IL.GLBL_CMPY_CD
            ,IL.INV_NUM
            ,SUM(IL.INV_LINE_DEAL_NET_AMT) AS ZSF_NET_AMT
        FROM
            INV_LINE IL
        WHERE
            IL.GLBL_CMPY_CD = #glblCmpyCd#
            AND IL.INV_NUM = #invNum#
            AND IL.INV_LINE_CATG_CD = #invLineCatgCharge#
            AND IL.EZCANCELFLAG = '0'
            AND EXISTS (
                SELECT
                    1
                FROM
                    ORD_PRC_CALC_BASE OPCB
                    , SPEC_COND_PRC SCP
                    , PRC_RULE_DTL PRD
                WHERE
                    IL.GLBL_CMPY_CD = OPCB.GLBL_CMPY_CD
                    AND IL.CPO_ORD_NUM = OPCB.CPO_ORD_NUM
                    AND IL.CPO_DTL_LINE_NUM = OPCB.CPO_DTL_LINE_NUM
                    AND IL.CPO_DTL_LINE_SUB_NUM = OPCB.CPO_DTL_LINE_SUB_NUM
                    AND OPCB.EZCANCELFLAG = '0'
                    AND OPCB.GLBL_CMPY_CD = SCP.GLBL_CMPY_CD
                    AND OPCB.SPEC_COND_PRC_PK = SCP.SPEC_COND_PRC_PK
                    AND SCP.EZCANCELFLAG = '0'
                    AND SCP.GLBL_CMPY_CD = PRD.GLBL_CMPY_CD 
                    AND SCP.PRC_RULE_DTL_PK = PRD.PRC_RULE_DTL_PK 
                    <iterate property="spclHdlgPrcRuleHdrPkList" var="spclHdlgPrcRuleHdrPk[]" open=" AND PRD.PRC_RULE_HDR_PK IN (" close=")" conjunction=",">
                        #spclHdlgPrcRuleHdrPk[]#
                    </iterate>
                    AND PRD.EZCANCELFLAG = '0'
            )
        GROUP BY
            IL.GLBL_CMPY_CD
            ,IL.INV_NUM
    </statement>
    <!-- 2018/10/03 QC#27032 Add End -->
    <statement id="getInvLineXsMtrCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS CNT
        FROM
             INV_LINE         IL
            ,SVC_INV_LINE     SIL
            ,SVC_INV_LINE_XS_MTR SILXM
        WHERE
                IL.GLBL_CMPY_CD         = #glblCmpyCd#
            AND IL.INV_NUM              = #invNum#
            AND IL.INV_BOL_LINE_NUM     = #invBolLineNum#
            AND IL.INV_LINE_NUM         = #invLineNum#
            AND IL.INV_LINE_SUB_NUM     = #invLineSubNum#
            AND IL.INV_LINE_SUB_TRX_NUM = #invLineSubTrxNum#
            AND IL.GLBL_CMPY_CD         = SIL.GLBL_CMPY_CD
            AND IL.SVC_INV_LINE_PK      = SIL.SVC_INV_LINE_PK
            AND IL.GLBL_CMPY_CD         = SILXM.GLBL_CMPY_CD
            AND IL.SVC_INV_LINE_PK      = SILXM.SVC_INV_LINE_PK
            AND IL.EZCANCELFLAG         = '0'
            AND SIL.EZCANCELFLAG        = '0'
            AND SILXM.EZCANCELFLAG      = '0'
    </statement>
</sqlMap>
