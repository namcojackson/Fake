<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAB016001">
<statement id="getMtrEstSel" parameterClass="Map" resultClass="Map">
SELECT
	SEL.MTR_EST_SEL_PK
,	SEL.SVC_MACH_MSTR_PK
,	SEL.SER_NUM
,	SEL.DS_CONTR_PK
,	SEL.DS_CONTR_DTL_PK
,	SEL.DS_CONTR_NUM
<!-- START 2022/08/15 N.Takatsu [QC#60186, MOD] -->
,   NVL(DCH.MTR_EST_TP_CD, #endMonthTpCd#) AS MTR_EST_TP_CD
<!-- START 2018/07/23 K.Kitachi [QC#23586, ADD] -->
<!-- ,   DCH.MTR_EST_TP_CD-->
<!-- END 2018/07/23 K.Kitachi [QC#23586, ADD] -->
<!-- END 2022/08/15 N.Takatsu [QC#60186, MOD] -->
FROM
	MTR_EST_SEL			SEL
<!-- START 2018/07/23 K.Kitachi [QC#23586, ADD] -->
    ,DS_CONTR           DCH
<!-- END 2018/07/23 K.Kitachi [QC#23586, ADD] -->
WHERE
	SEL.GLBL_CMPY_CD		=	#glblCmpyCd#
AND	SEL.MTR_EST_SEL_GRP_NUM	=	#mtrEstSelGrpNum#
AND	SEL.MTR_EST_STS_CD		=	#mtrEstStsCd#
AND	SEL.EZCANCELFLAG		=	'0'
<!-- START 2018/07/23 K.Kitachi [QC#23586, ADD] -->
AND SEL.GLBL_CMPY_CD        =   DCH.GLBL_CMPY_CD
AND SEL.DS_CONTR_PK         =   DCH.DS_CONTR_PK
AND DCH.EZCANCELFLAG        =   '0'
<!-- END 2018/07/23 K.Kitachi [QC#23586, ADD] -->
<!-- START 2020/04/21 K.Sakurai [QC#56189, ADD] -->
ORDER BY SEL.SER_NUM, SEL.DS_CONTR_NUM
<!-- END 2020/04/21 K.Sakurai [QC#56189, ADD] -->
</statement>
<statement id="getSvcPhysMtrInfo" parameterClass="Map" resultClass="Map">
SELECT
	SMM.SVC_MACH_MSTR_PK
,	SMM.SER_NUM
<!--
,	SMM.EFF_FROM_DT
,	SMM.EFF_THRU_DT 
-->
,	SMM.ISTL_DT
,	SPM.SVC_PHYS_MTR_PK
,	SPM.MDL_MTR_LB_CD
,	MDN.T_MDL_NM				AS	MDL_NM
,   SPM.CNTR_DIGIT_NUM
FROM
	SVC_MACH_MSTR				SMM
,	SVC_PHYS_MTR				SPM
,	SVC_CONFIG_MSTR				SCM
,	MDL_NM						MDN
WHERE
	SMM.SVC_MACH_MSTR_PK		=	#svcMachMstrPk#
AND	SMM.GLBL_CMPY_CD			=	#glblCmpyCd#
AND	SMM.EZCANCELFLAG			=	'0'
AND	SPM.SVC_MACH_MSTR_PK		=	SMM.SVC_MACH_MSTR_PK
AND	SPM.GLBL_CMPY_CD			=	SMM.GLBL_CMPY_CD
AND	SPM.EZCANCELFLAG			=	SMM.EZCANCELFLAG
AND	SCM.SVC_CONFIG_MSTR_PK		=	SMM.SVC_CONFIG_MSTR_PK
AND	SCM.GLBL_CMPY_CD			=	SMM.GLBL_CMPY_CD
AND	SCM.EZCANCELFLAG			=	SMM.EZCANCELFLAG
AND	MDN.T_MDL_ID				=	SCM.MDL_ID
AND	MDN.T_GLBL_CMPY_CD			=	SCM.GLBL_CMPY_CD
AND	MDN.EZCANCELFLAG			=	SCM.EZCANCELFLAG
</statement>
<!-- START 2018/07/11 K.Kojima [QC#23925,DEL] -->
<!-- <statement id="getDsContrBllgSchd" parameterClass="Map" resultClass="Map"> -->
<!-- SELECT -->
<!--     CBS.* -->
<!-- FROM -->
<!--     CONTR_PHYS_BLLG_MTR_RELN        PBR -->
<!-- ,   DS_CONTR_BLLG_SCHD_SMRY         BSS -->
<!-- ,   DS_CONTR_BLLG_SCHD              CBS -->
<!-- WHERE -->
<!--     PBR.SVC_PHYS_MTR_PK             =   #svcPhysMtrPk# -->
<!-- AND PBR.GLBL_CMPY_CD                =   #glblCmpyCd# -->
<!-- AND PBR.EZCANCELFLAG                =   '0' -->
<!-- AND BSS.DS_CONTR_BLLG_MTR_PK        =   PBR.DS_CONTR_BLLG_MTR_PK -->
<!-- AND BSS.GLBL_CMPY_CD                =   PBR.GLBL_CMPY_CD -->
<!-- AND BSS.EZCANCELFLAG                =   PBR.EZCANCELFLAG -->
<!-- AND CBS.DS_CONTR_BLLG_SCHD_SMRY_PK  =   BSS.DS_CONTR_BLLG_SCHD_SMRY_PK -->
<!-- AND CBS.USG_CHRG_FLG                =   'Y' -->
<!-- AND CBS.MTR_ENTRY_CPLT_FLG          =   'N' -->
<!-- AND CBS.NEXT_BLLG_DT                &lt;    #slsDt# -->
<!-- AND CBS.GLBL_CMPY_CD                =   BSS.GLBL_CMPY_CD -->
<!-- AND CBS.EZCANCELFLAG                =   BSS.EZCANCELFLAG -->
<!-- ORDER BY -->
<!--     CBS.BLLG_SCHD_FROM_DT -->
<!-- </statement> -->
<!-- END 2018/07/11 K.Kojima [QC#23925,DEL] -->
<statement id="getBllgThruDtList" parameterClass="Map" resultClass="String">
SELECT
<!-- mod start 2018/08/27 QC#27553 -->
<!--    CBS.BLLG_SCHD_THRU_DT -->
    CASE WHEN CBS.BLLG_SCHD_THRU_DT &gt; #slsDt# THEN #slsDt#
         ELSE CBS.BLLG_SCHD_THRU_DT
    END  BLLG_SCHD_THRU_DT
<!-- mod end 2018/08/27 QC#27553 -->
FROM
    DS_CONTR_BLLG_SCHD              CBS
<!-- START 2021/07/23 R.Cabral [QC#58531,ADD] -->
,   DS_CONTR_DTL                    CD
,   DS_CONTR_DTL_STS_V              CDSV
<!-- END 2021/07/23 R.Cabral [QC#58531,ADD] -->
WHERE
    CBS.GLBL_CMPY_CD                =   #glblCmpyCd#
<!-- START 2021/07/23 R.Cabral [QC#58531,MOD] -->
<!--
AND CBS.DS_CONTR_DTL_PK             =   #dsContrDtlPk#
-->
AND CD.SVC_MACH_MSTR_PK = #svcMachMstrPk#
AND CD.GLBL_CMPY_CD = #glblCmpyCd#
AND CDSV.DS_CONTR_DTL_PK = CD.DS_CONTR_DTL_PK
AND CD.DS_CONTR_DTL_PK = CBS.DS_CONTR_DTL_PK
AND CD.EZCANCELFLAG = '0'
AND CDSV.EZCANCELFLAG = '0'
AND CDSV.GLBL_CMPY_CD = #glblCmpyCd#
AND CD.GLBL_CMPY_CD = #glblCmpyCd#
AND CDSV.MTR_EST_AVAL_FLG = #mtrEstAvalFlg#
<!-- END 2021/07/23 R.Cabral [QC#58531,MOD] -->
AND CBS.EZCANCELFLAG                =   '0'
AND CBS.USG_CHRG_FLG                =   'Y'
AND CBS.MTR_ENTRY_CPLT_FLG          =   'N'
<!-- START 2018/07/11 K.Kojima [QC#23925,ADD] -->
AND CBS.INV_FLG                     =   'N'
<!-- END 2018/07/11 K.Kojima [QC#23925,ADD] -->
<!-- mod start 2018/08/27 QC#27553 -->
<!-- AND CBS.NEXT_BLLG_DT                &lt;    #slsDt# -->
AND CBS.BLLG_SCHD_THRU_DT       &lt;=   #trgtDt#
<!-- mod end 2018/08/27 QC#27553 -->
<!-- START 2023/02/03 E.Sanchez [QC#61138, ADD] -->
AND CBS.SKIP_RECOV_TP_CD     &lt;&gt;   #skipRecovTpCd#
<!-- END 2023/02/03 E.Sanchez [QC#61138, ADD] -->
GROUP BY
    CBS.BLLG_SCHD_THRU_DT
ORDER BY
    CBS.BLLG_SCHD_THRU_DT
</statement>
<statement id="getInitMtrRead" parameterClass="Map" resultClass="Map">
SELECT
	*
FROM
(
	SELECT
		PMR.*
	,	ROW_NUMBER() OVER (
			PARTITION BY
				PMR.SVC_PHYS_MTR_PK
			ORDER BY
				PMR.MTR_READ_DT					ASC
			,	PMR.SVC_PHYS_MTR_READ_GRP_SQ	ASC
		)	AS	ROW_NUM
	FROM
		SVC_PHYS_MTR_READ	PMR
<!-- START 2021/07/23 R.Cabral [QC#58531,ADD] -->
    ,   CONTR_PHYS_BLLG_MTR_RELN CPBMR
<!-- END   2021/07/23 R.Cabral [QC#58531,ADD] -->
	WHERE
		PMR.SVC_PHYS_MTR_PK		=	#svcPhysMtrPk#
	AND	PMR.GLBL_CMPY_CD		=	#glblCmpyCd#
<!-- START 2018/06/29 K.Kim [QC#23311,MOD] -->
<!--
	<isNotNull property="fromDt">
	AND	PMR.MTR_READ_DT			&gt;=	#fromDt#
	</isNotNull>
	<isNotNull property="thruDt">
	AND	PMR.MTR_READ_DT			&lt;=	#thruDt#
	</isNotNull>
-->
    <!-- START 2021/07/23 R.Cabral [QC#58531,DEL] -->
    <!--
	AND PMR.DS_CONTR_DTL_PK		=	#dsContrDtlPk#
	-->
	<!-- END 2021/07/23 R.Cabral [QC#58531,DEL] -->
<!-- END 2018/06/29 K.Kim [QC#23311,MOD] -->
<!-- START 2018/10/11 K.Fujimoto [QC#28592,ADD] -->
    AND PMR.VLD_MTR_FLG         =   'Y'
<!-- END   2018/10/11 K.Fujimoto [QC#28592,ADD] -->
    <!-- add start 2020/01/28 QC#55495 -->
    <!-- START 2021/07/23 R.Cabral [QC#58531,DEL] -->
    <!--
    AND PMR.CARRY_OVER_TP_CD    =   '0'
    -->
    <!-- END 2021/07/23 R.Cabral [QC#58531,DEL] -->
    <!-- add end 2020/01/28 QC#55495 -->
	AND	PMR.EZCANCELFLAG		=	'0'
	<!-- START 2021/07/23 R.Cabral [QC#58531,ADD] -->
	AND CPBMR.GLBL_CMPY_CD      =   PMR.GLBL_CMPY_CD
    AND CPBMR.EZCANCELFLAG      =   '0'
    AND CPBMR.MACH_MSTR_PK      =   PMR.SVC_MACH_MSTR_PK
    AND CPBMR.DS_CONTR_DTL_PK   =   PMR.DS_CONTR_DTL_PK
    AND CPBMR.SVC_PHYS_MTR_PK   =   PMR.SVC_PHYS_MTR_PK
    AND CPBMR.BLLBL_FLG         =   #bllblFlg#
    AND EXISTS (
        SELECT
            *
        FROM
            CONTR_PHYS_BLLG_MTR_RELN   X
           , DS_CONTR_DTL Y
           , DS_CONTR_DTL_STS_V Z
        WHERE
                X.GLBL_CMPY_CD  = #glblCmpyCd#
            AND X.EZCANCELFLAG  = '0'
            AND X.SVC_PHYS_MTR_PK = PMR.SVC_PHYS_MTR_PK
            AND X.BLLBL_FLG = #bllblFlg#
            AND X.GLBL_CMPY_CD = Y.GLBL_CMPY_CD
            AND X.DS_CONTR_DTL_PK = Y.DS_CONTR_DTL_PK
            AND Y.EZCANCELFLAG = '0'
            AND Z.EZCANCELFLAG = '0'
            AND X.GLBL_CMPY_CD = Z.GLBL_CMPY_CD
            AND Y.DS_CONTR_DTL_PK = Z.DS_CONTR_DTL_PK
            <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCd[]" open="AND Z.DS_CONTR_CTRL_STS_CD NOT IN  (" conjunction= "," close=")">
            	#dsContrCtrlStsCd[]#
        	</iterate>
            AND Y.DS_CONTR_DTL_PK = CPBMR.DS_CONTR_DTL_PK
            <!-- START 2022/02/21 R.Cabral [QC#59741, ADD] -->
            AND NVL(Y.CONTR_CLO_DT, Y.CONTR_EFF_THRU_DT) &gt;= #bllgThruDt#
            <!-- END   2022/02/21 R.Cabral [QC#59741, ADD] -->
    )
	<!-- END 2021/07/23 R.Cabral [QC#58531,ADD] -->
)
WHERE
	ROW_NUM	=	1
</statement>
<statement id="getMtrRead1" parameterClass="Map" resultClass="Map">
<!-- START 2019/02/26 K.Kitachi [QC#30488, DEL] -->
<!-- SELECT -->
<!-- 	* -->
<!-- FROM -->
<!-- ( -->
<!-- 	SELECT -->
<!-- 		* -->
<!-- 	FROM -->
<!-- 	( -->
<!-- 		SELECT -->
<!-- 			PMR.* -->
<!-- 		,	ROW_NUMBER() OVER ( -->
<!-- 				PARTITION BY -->
<!-- 					PMR.SVC_PHYS_MTR_PK -->
<!-- 				ORDER BY -->
<!-- 					MTR_READ_DT	DESC -->
<!-- 				,	SVC_PHYS_MTR_READ_GRP_SQ	DESC -->
<!-- 			)		AS	ROW_NUM -->
<!-- 		,	1		AS	PRTY_NUM -->
<!-- 		FROM -->
<!-- 			SVC_PHYS_MTR_READ	PMR -->
<!-- 		WHERE -->
<!-- 			PMR.GLBL_CMPY_CD	=	#glblCmpyCd# -->
<!-- 		AND	PMR.SVC_PHYS_MTR_PK	=	#svcPhysMtrPk# -->
<!-- 		AND	PMR.EST_FLG			=	'N' -->
		<!-- START 2018/10/11 K.Fujimoto [QC#28592,ADD] -->
<!--     	AND PMR.VLD_MTR_FLG		=	'Y' -->
		<!-- END   2018/10/11 K.Fujimoto [QC#28592,ADD] -->
<!-- 		AND	PMR.EZCANCELFLAG	=	'0' -->
<!-- 		AND	PMR.MTR_READ_DT		&gt;=	TO_CHAR(TO_DATE(#mtrReadDt#, 'YYYYMMDD') + INTERVAL '$intvlDays$' DAY, 'YYYYMMDD') -->
<!-- 	) -->
<!-- 	WHERE -->
<!-- 		ROW_NUM	=	1 -->
<!-- 	UNION ALL -->
<!-- END 2019/02/26 K.Kitachi [QC#30488, DEL] -->
	SELECT
		*
	FROM
	(
		SELECT
			PMR.*
		,	ROW_NUMBER() OVER (
				PARTITION BY
					PMR.SVC_PHYS_MTR_PK
				ORDER BY
					MTR_READ_DT	DESC
				,	SVC_PHYS_MTR_READ_GRP_SQ	DESC
			)		AS	ROW_NUM
<!-- START 2019/02/26 K.Kitachi [QC#30488, DEL] -->
<!-- 		,	2		AS	PRTY_NUM -->
<!-- END 2019/02/26 K.Kitachi [QC#30488, DEL] -->
		FROM
			SVC_PHYS_MTR_READ	PMR
		WHERE
			PMR.GLBL_CMPY_CD	=	#glblCmpyCd#
		AND	PMR.SVC_PHYS_MTR_PK	=	#svcPhysMtrPk#
		<!-- START 2018/10/11 K.Fujimoto [QC#28592,ADD] -->
    	AND PMR.VLD_MTR_FLG		=	'Y'
		<!-- END   2018/10/11 K.Fujimoto [QC#28592,ADD] -->
        <!-- add start 2020/01/28 QC#55495 -->
        AND PMR.CARRY_OVER_TP_CD =  '0'
        <!-- add end 2020/01/28 QC#55495 -->
		AND	PMR.EZCANCELFLAG	=	'0'
		AND	PMR.MTR_READ_DT		&gt;=	TO_CHAR(TO_DATE(#mtrReadDt#, 'YYYYMMDD') + INTERVAL '$intvlDays$' DAY, 'YYYYMMDD')
        <!-- START 2020/09/04 K.Kitachi [QC#57649, ADD] -->
        <iterate property="dsMtrReadTpGrpCdList" var="dsMtrReadTpGrpCd[]" open="AND PMR.DS_MTR_READ_TP_GRP_CD IN (" conjunction= "," close=")">
            #dsMtrReadTpGrpCd[]#
        </iterate>
        <!-- END 2020/09/04 K.Kitachi [QC#57649, ADD] -->
	)
	WHERE
		ROW_NUM	=	1
<!-- START 2019/02/26 K.Kitachi [QC#30488, DEL] -->
<!-- ) -->
<!-- ORDER BY -->
<!-- 	PRTY_NUM	ASC -->
<!-- END 2019/02/26 K.Kitachi [QC#30488, DEL] -->
</statement>
<statement id="getMtrRead2" parameterClass="Map" resultClass="Map">
SELECT
	*
FROM
(
	SELECT
		*
	FROM
	(
		SELECT
			PMR.*
		,	ROW_NUMBER() OVER (
				PARTITION BY
					PMR.SVC_PHYS_MTR_PK
				ORDER BY
					MTR_READ_DT					ASC
				,	SVC_PHYS_MTR_READ_GRP_SQ	ASC
			)		AS	ROW_NUM
		,	1		AS	PRTY_NUM
		FROM
			SVC_PHYS_MTR_READ	PMR
		WHERE
			PMR.GLBL_CMPY_CD	=	#glblCmpyCd#
		AND	PMR.SVC_PHYS_MTR_PK	=	#svcPhysMtrPk#
		AND	PMR.EST_FLG			=	'N'
		<!-- START 2018/10/11 K.Fujimoto [QC#28592,ADD] -->
    	AND PMR.VLD_MTR_FLG		=	'Y'
		<!-- END   2018/10/11 K.Fujimoto [QC#28592,ADD] -->
        <!-- add start 2020/01/28 QC#55495 -->
        AND PMR.CARRY_OVER_TP_CD =  '0'
        <!-- add end 2020/01/28 QC#55495 -->
		AND	PMR.EZCANCELFLAG	=	'0'
		AND PMR.MTR_READ_DT		&gt;	TO_CHAR(ADD_MONTHS(TO_DATE(#mtrReadDt#, 'YYYYMMDD'), -1 * #intvlMth#), 'YYYYMMDD')
        <!-- START 2023/03/15 E.Sanchez [QC#61288, ADD] -->
        AND PMR.MTR_READ_DT     &lt; #mtrReadDt#
        <!-- END 2023/03/15 E.Sanchez [QC#61288, ADD] -->
        <!-- START 2020/09/04 K.Kitachi [QC#57649, ADD] -->
        <iterate property="dsMtrReadTpGrpCdList" var="dsMtrReadTpGrpCd[]" open="AND PMR.DS_MTR_READ_TP_GRP_CD IN (" conjunction= "," close=")">
            #dsMtrReadTpGrpCd[]#
        </iterate>
        <!-- END 2020/09/04 K.Kitachi [QC#57649, ADD] -->
	)
	WHERE
		ROW_NUM	=	1
	UNION ALL
	SELECT
		*
	FROM
	(
		SELECT
			PMR.*
		,	ROW_NUMBER() OVER (
				PARTITION BY
					PMR.SVC_PHYS_MTR_PK
				ORDER BY
					MTR_READ_DT					DESC
				,	SVC_PHYS_MTR_READ_GRP_SQ	DESC
			)		AS	ROW_NUM
		,	2		AS	PRTY_NUM
		FROM
			SVC_PHYS_MTR_READ	PMR
		WHERE
			PMR.GLBL_CMPY_CD	=	#glblCmpyCd#
		AND	PMR.SVC_PHYS_MTR_PK	=	#svcPhysMtrPk#
		AND	PMR.EST_FLG			=	'N'
		<!-- START 2018/10/11 K.Fujimoto [QC#28592,ADD] -->
    	AND PMR.VLD_MTR_FLG		=	'Y'
		<!-- END   2018/10/11 K.Fujimoto [QC#28592,ADD] -->
        <!-- add start 2020/01/28 QC#55495 -->
        AND PMR.CARRY_OVER_TP_CD =  '0'
        <!-- add end 2020/01/28 QC#55495 -->
		AND	PMR.EZCANCELFLAG	=	'0'
		AND PMR.MTR_READ_DT		&lt;=	TO_CHAR(ADD_MONTHS(TO_DATE(#mtrReadDt#, 'YYYYMMDD'), -1 * #intvlMth#), 'YYYYMMDD')
        <!-- START 2020/09/04 K.Kitachi [QC#57649, ADD] -->
        <iterate property="dsMtrReadTpGrpCdList" var="dsMtrReadTpGrpCd[]" open="AND PMR.DS_MTR_READ_TP_GRP_CD IN (" conjunction= "," close=")">
            #dsMtrReadTpGrpCd[]#
        </iterate>
        <!-- END 2020/09/04 K.Kitachi [QC#57649, ADD] -->
	)
	WHERE
		ROW_NUM	=	1
	UNION ALL
	SELECT
		*
	FROM
	(
		SELECT
			PMR.*
		,	ROW_NUMBER() OVER (
				PARTITION BY
					PMR.SVC_PHYS_MTR_PK
				ORDER BY
					MTR_READ_DT					ASC
				,	SVC_PHYS_MTR_READ_GRP_SQ	ASC
			)		AS	ROW_NUM
		,	3		AS	PRTY_NUM
		FROM
			SVC_PHYS_MTR_READ	PMR
		WHERE
			PMR.GLBL_CMPY_CD	=	#glblCmpyCd#
		AND	PMR.SVC_PHYS_MTR_PK	=	#svcPhysMtrPk#
		<!-- START 2018/10/11 K.Fujimoto [QC#28592,ADD] -->
    	AND PMR.VLD_MTR_FLG		=	'Y'
		<!-- END   2018/10/11 K.Fujimoto [QC#28592,ADD] -->
        <!-- add start 2020/01/28 QC#55495 -->
        AND PMR.CARRY_OVER_TP_CD =  '0'
        <!-- add end 2020/01/28 QC#55495 -->
		AND	PMR.EZCANCELFLAG	=	'0'
		AND PMR.MTR_READ_DT		&gt;	TO_CHAR(ADD_MONTHS(TO_DATE(#mtrReadDt#, 'YYYYMMDD'), -1 * #intvlMth#), 'YYYYMMDD')
        <!-- START 2023/03/15 E.Sanchez [QC#61288, ADD] -->
        AND PMR.MTR_READ_DT     &lt; #mtrReadDt#
        <!-- END 2023/03/15 E.Sanchez [QC#61288, ADD] -->
        <!-- START 2020/09/04 K.Kitachi [QC#57649, ADD] -->
        <iterate property="dsMtrReadTpGrpCdList" var="dsMtrReadTpGrpCd[]" open="AND PMR.DS_MTR_READ_TP_GRP_CD IN (" conjunction= "," close=")">
            #dsMtrReadTpGrpCd[]#
        </iterate>
        <!-- END 2020/09/04 K.Kitachi [QC#57649, ADD] -->
	)
	WHERE
		ROW_NUM	=	1
	UNION ALL
	SELECT
		*
	FROM
	(
		SELECT
			PMR.*
		,	ROW_NUMBER() OVER (
				PARTITION BY
					PMR.SVC_PHYS_MTR_PK
				ORDER BY
					MTR_READ_DT					DESC
				,	SVC_PHYS_MTR_READ_GRP_SQ	DESC
			)		AS	ROW_NUM
		,	4		AS	PRTY_NUM
		FROM
			SVC_PHYS_MTR_READ	PMR
		WHERE
			PMR.GLBL_CMPY_CD	=	#glblCmpyCd#
		AND	PMR.SVC_PHYS_MTR_PK	=	#svcPhysMtrPk#
		<!-- START 2018/10/11 K.Fujimoto [QC#28592,ADD] -->
    	AND PMR.VLD_MTR_FLG		=	'Y'
		<!-- END   2018/10/11 K.Fujimoto [QC#28592,ADD] -->
        <!-- add start 2020/01/28 QC#55495 -->
        AND PMR.CARRY_OVER_TP_CD =  '0'
        <!-- add end 2020/01/28 QC#55495 -->
		AND	PMR.EZCANCELFLAG	=	'0'
		AND PMR.MTR_READ_DT		&lt;=	TO_CHAR(ADD_MONTHS(TO_DATE(#mtrReadDt#, 'YYYYMMDD'), -1 * #intvlMth#), 'YYYYMMDD')
        <!-- START 2020/09/04 K.Kitachi [QC#57649, ADD] -->
        <iterate property="dsMtrReadTpGrpCdList" var="dsMtrReadTpGrpCd[]" open="AND PMR.DS_MTR_READ_TP_GRP_CD IN (" conjunction= "," close=")">
            #dsMtrReadTpGrpCd[]#
        </iterate>
        <!-- END 2020/09/04 K.Kitachi [QC#57649, ADD] -->
	)
	WHERE
		ROW_NUM	=	1
)
ORDER BY
	PRTY_NUM	ASC
</statement>
<statement id="getLtstMtrRead" parameterClass="Map" resultClass="Map">
SELECT
	*
FROM
(
	SELECT
		PMR.*
	,	ROW_NUMBER() OVER (
			PARTITION BY
				PMR.SVC_PHYS_MTR_PK
			ORDER BY
				PMR.MTR_READ_DT					DESC
			,	PMR.SVC_PHYS_MTR_READ_GRP_SQ	DESC
		)	AS	ROW_NUM
	FROM
		SVC_PHYS_MTR_READ			PMR
	WHERE
		PMR.SVC_PHYS_MTR_PK			=	#svcPhysMtrPk#
	AND	PMR.GLBL_CMPY_CD			=	#glblCmpyCd#
    <!-- add start 2020/01/28 QC#55495 -->
    AND PMR.VLD_MTR_FLG             =   'Y'
    AND PMR.CARRY_OVER_TP_CD        =   '0'
    <!-- add end 2020/01/28 QC#55495 -->
	<isNotNull property="fromDt">
	AND	PMR.MTR_READ_DT				&gt;=	#fromDt#
	</isNotNull>
	<isNotNull property="thruDt">
	AND	PMR.MTR_READ_DT				&lt;=	#thruDt#
	</isNotNull>
	AND	PMR.SVC_PHYS_MTR_READ_PK	!=	#svcPhysMtrReadPk#
	AND	PMR.EZCANCELFLAG			=	'0'
    <!-- START 2020/09/04 K.Kitachi [QC#57649, ADD] -->
    <iterate property="dsMtrReadTpGrpCdList" var="dsMtrReadTpGrpCd[]" open="AND PMR.DS_MTR_READ_TP_GRP_CD IN (" conjunction= "," close=")">
        #dsMtrReadTpGrpCd[]#
    </iterate>
    <!-- END 2020/09/04 K.Kitachi [QC#57649, ADD] -->
)
WHERE
	ROW_NUM	=	1
</statement>
</sqlMap>