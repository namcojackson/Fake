<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<sqlMap namespace="NSZC068001">
<!-- START 2021/10/04 R.Cabral [QC#59192, ADD] -->
    <typeAlias alias="SVC_SUPPL_TASKTMsg"  type="business.db.SVC_SUPPL_TASKTMsg" />
<!-- END   2021/10/04 R.Cabral [QC#59192, ADD] -->
    <statement id="getSvcTaskInfo" parameterClass="Map" resultClass="Map">
        SELECT 
            TASK.SVC_CALL_PRTY_CD           AS SVC_CALL_PRTY_CD
            , STS.XTRNL_STS_REF_TXT         AS XTRNL_STS_REF_TXT
            , STS.SVC_TASK_STS_CD           AS SVC_TASK_STS_CD
            , TASK.FSR_NUM                  AS FSR_NUM
            , TASK.INV_CCY_CD               AS INV_CCY_CD
            , TASK.CCY_EXCH_RATE            AS CCY_EXCH_RATE
            , TASK.SVC_MACH_MSTR_PK         AS SVC_MACH_MSTR_PK
            , TASK.SVC_BILL_TP_CD           AS SVC_BILL_TP_CD
            , TASK.PMT_TERM_CASH_DISC_CD    AS PMT_TERM_CASH_DISC_CD
            , TASK.DS_SVC_CALL_TP_CD        AS DS_SVC_CALL_TP_CD
            , TASK.MDSE_CD                  AS MDSE_CD
            , TASK.SER_NUM                  AS SER_NUM
            , TASK.MDL_NM                   AS MDL_NM
            , TASK.CUST_MACH_CTRL_NUM       AS CUST_MACH_CTRL_NUM
            , VISIT.FSR_VISIT_NUM           AS FSR_VISIT_NUM
            , VISIT.FSR_VISIT_STS_CD        AS FSR_VISIT_STS_CD
            , VISIT.FSR_VISIT_DISPT_DT      AS FSR_VISIT_DISPT_DT
            , VISIT.FSR_VISIT_DISPT_TM      AS FSR_VISIT_DISPT_TM
            , VISIT.FSR_VISIT_ARV_DT        AS FSR_VISIT_ARV_DT
            , VISIT.FSR_VISIT_ARV_TM        AS FSR_VISIT_ARV_TM
            , VISIT.TECH_CD                 AS TECH_CD
            , FSR.SVC_PBLM_TP_CD            AS SVC_PBLM_TP_CD
            , ACC.DS_ACCT_NM                AS DS_ACCT_NM
            , SHIP.FIRST_LINE_ADDR          AS FIRST_LINE_ADDR
            , SHIP.CTRY_CD                  AS CTRY_CD
            , SHIP.POST_CD                  AS POST_CD
            <!-- START 2018/08/03 [QC#27605,ADD] -->
            , TASK.ERL_START_TS             AS ERL_START_TS
            , TASK.LATE_START_TS            AS LATE_START_TS
            <!-- END 2018/08/03 [QC#27605,ADD] -->
        FROM  SVC_TASK TASK
            , SVC_TASK_STS STS
            , FSR_VISIT VISIT
            , FSR
            , SELL_TO_CUST ACC
            , SHIP_TO_CUST SHIP
        WHERE TASK.GLBL_CMPY_CD = #glblCmpyCd#
          AND TASK.EZCANCELFLAG = '0'
          AND TASK.SVC_TASK_NUM = #svcTaskNum#
          AND TASK.GLBL_CMPY_CD = VISIT.GLBL_CMPY_CD
          AND TASK.SVC_TASK_NUM = VISIT.SVC_TASK_NUM
          AND VISIT.EZCANCELFLAG = '0'
          AND VISIT.GLBL_CMPY_CD = STS.GLBL_CMPY_CD
          AND VISIT.FSR_VISIT_STS_CD = STS.SVC_TASK_STS_CD
          AND STS.EZCANCELFLAG = '0'
          AND VISIT.GLBL_CMPY_CD = FSR.GLBL_CMPY_CD
          AND VISIT.FSR_NUM = FSR.FSR_NUM
          AND FSR.EZCANCELFLAG = '0'
          AND FSR.GLBL_CMPY_CD = ACC.GLBL_CMPY_CD(+)
          AND FSR.SELL_TO_CUST_CD = ACC.SELL_TO_CUST_CD(+)
          AND ACC.EZCANCELFLAG(+) = '0'
          AND FSR.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD(+)
          AND ( CASE
                     <!-- START 2022/03/11 [QC#59702, MOD] -->
                     <!-- WHEN FSR.SHIP_TO_CUST_UPD_FLG = 'Y' THEN FSR.SHIP_TO_UPD_CUST_CD -->
                     WHEN FSR.SHIP_TO_UPD_CUST_CD IS NOT NULL THEN FSR.SHIP_TO_UPD_CUST_CD
                     <!-- END   2022/03/11 [QC#59702, MOD] -->
                     ELSE FSR.SHIP_TO_CUST_CD
                 END
              ) = SHIP.SHIP_TO_CUST_CD(+)
          AND SHIP.EZCANCELFLAG(+) = '0'
    </statement>
    <statement id="getSupplementalTask" parameterClass="Map" resultClass="String">
        SELECT
            ST.SVC_SUPPL_TASK_NUM
        FROM
            SVC_SUPPL_TASK ST
        WHERE
                ST.GLBL_CMPY_CD             = #glblCmpyCd#
            AND ST.SVC_TASK_NUM             = #svcTaskNum#
            AND ST.TECH_CD                  = #techCd#
            AND ST.SVC_SUPPL_TASK_STS_CD    = #svcSupplTaskStsCd#
            AND ST.EZCANCELFLAG             = '0'
            AND EXISTS
                (SELECT *
                FROM
                    SVC_SUPPL_TASK_TP TP
                WHERE
                    TP.GLBL_CMPY_CD             = ST.GLBL_CMPY_CD
                    AND TP.SVC_SUPPL_TASK_TP_CD = ST.SVC_SUPPL_TASK_TP_CD
                    AND TP.SVC_ITRPT_FLG        = 'Y'
                    AND TP.EZCANCELFLAG         = '0')
            AND ROWNUM = 1
    </statement>
    <statement id="getSvcPblmRsnTpCd" parameterClass="Map" resultClass="String">
        SELECT 
            TP.SVC_PBLM_RSN_TP_CD
        FROM  SVC_PBLM_RSN_TP TP
        WHERE 
          TP.GLBL_CMPY_CD                  = #glblCmpyCd#
          AND TP.EZCANCELFLAG              = '0'
          AND TP.XTRNL_PBLM_RSN_TP_REF_TXT = #xtrnlPblmRsnTpRefTxt#
          AND ROWNUM                       = 1
    </statement>
    <statement id="getSvcPblmLocTpCd" parameterClass="Map" resultClass="String">
        SELECT 
            TP.SVC_PBLM_LOC_TP_CD
        FROM  SVC_PBLM_LOC_TP TP
        WHERE 
          TP.GLBL_CMPY_CD                  = #glblCmpyCd#
          AND TP.EZCANCELFLAG              = '0'
          AND TP.XTRNL_PBLM_LOC_TP_REF_TXT = #xtrnlPblmLocTpRefTxt#
          AND ROWNUM                       = 1
    </statement>
    <statement id="getSvcPblmCrctTpCd" parameterClass="Map" resultClass="String">
        SELECT 
            TP.SVC_PBLM_CRCT_TP_CD
        FROM  SVC_PBLM_CRCT_TP TP
        WHERE 
          TP.GLBL_CMPY_CD                   = #glblCmpyCd#
          AND TP.EZCANCELFLAG               = '0'
          AND TP.XTRNL_PBLM_CRCT_TP_REF_TXT = #xtrnlPblmCrctTpRefTxt#
          AND ROWNUM                        = 1
    </statement>
    <statement id="getSvcPblmTpCd" parameterClass="Map" resultClass="String">
        SELECT 
            TP.SVC_PBLM_TP_CD
        FROM  SVC_PBLM_TP TP
        WHERE 
          TP.GLBL_CMPY_CD                   = #glblCmpyCd#
          AND TP.EZCANCELFLAG               = '0'
          AND TP.XTRNL_PBLM_TP_REF_TXT      = #xtrnlPblmTpRefTxt#
          AND ROWNUM                        = 1
    </statement>

    <statement id="getIwrStsCd" parameterClass="Map" resultClass="String">
        SELECT 
            IWR.IWR_STS_CD
        FROM  IWR_STS IWR
        WHERE 
          IWR.GLBL_CMPY_CD                   = #glblCmpyCd#
          AND IWR.EZCANCELFLAG               = '0'
          AND IWR.XTRNL_IWR_STS_REF_TXT      = #xtrnlIwrStsRefTxt#
          AND ROWNUM                         = 1
    </statement>

    <statement id="getShipToCustBySvcSupplTaskNum" parameterClass="Map" resultClass="Map">
        SELECT
                 SHIP.CTRY_CD
                ,SHIP.POST_CD
            FROM
                 SVC_SUPPL_TASK SUPL
                ,SVC_TASK TASK
                ,FSR
                ,SHIP_TO_CUST SHIP
            WHERE
                SUPL.GLBL_CMPY_CD = #glblCmpyCd#
            AND
                SUPL.SVC_SUPPL_TASK_NUM = #svcSupplTaskNum#
            AND
                SUPL.EZCANCELFLAG    = '0'
            AND
                SUPL.GLBL_CMPY_CD    = TASK.GLBL_CMPY_CD
            AND
                SUPL.SVC_TASK_NUM    = TASK.SVC_TASK_NUM
            AND
                TASK.EZCANCELFLAG    = '0'
            AND
                TASK.GLBL_CMPY_CD    = FSR.GLBL_CMPY_CD
            AND
                TASK.FSR_NUM         = FSR.FSR_NUM
            AND
                FSR.EZCANCELFLAG     = '0'
            AND 
                ( CASE
                     <!-- START 2022/03/11 [QC#59702, MOD] -->
                     <!-- WHEN FSR.SHIP_TO_CUST_UPD_FLG = 'Y' THEN FSR.SHIP_TO_UPD_CUST_CD -->
                     WHEN FSR.SHIP_TO_UPD_CUST_CD IS NOT NULL THEN FSR.SHIP_TO_UPD_CUST_CD
                     <!-- END   2022/03/11 [QC#59702, MOD] -->
                     ELSE FSR.SHIP_TO_CUST_CD
                 END
                )                    = SHIP.SHIP_TO_CUST_CD
            AND
                FSR.GLBL_CMPY_CD     = SHIP.GLBL_CMPY_CD
            AND 
                SHIP.EZCANCELFLAG    = '0'
            AND
                SHIP.RGTN_STS_CD     = #rgtnStsCd#
    </statement>
    <statement id="getMdlInfo" parameterClass="Map" resultClass="Map">
        SELECT
            CFG.MDL_ID AS MDL_ID
            ,T_MDL_NM   AS MDL_NM
        FROM
            SVC_CONFIG_MSTR CFG
            ,MDL_NM         MDL
        WHERE
            CFG.GLBL_CMPY_CD            = #glblCmpyCd#
            AND CFG.SVC_CONFIG_MSTR_PK  = #svcConfigMstrPk#
            AND CFG.GLBL_CMPY_CD        = MDL.T_GLBL_CMPY_CD
            AND CFG.MDL_ID              = MDL.T_MDL_ID
            AND CFG.EZCANCELFLAG        ='0'
            AND MDL.EZCANCELFLAG        ='0'
            AND ROWNUM                  = 1
    </statement>
    <statement id="getFollUpTask" parameterClass="Map" resultClass="String">
        SELECT
            FL.SVC_TASK_NUM
        FROM
            FSR_VISIT    FV
           ,FSR_VISIT    FL
        WHERE
            FV.GLBL_CMPY_CD          = #glblCmpyCd#
        AND FV.SVC_TASK_NUM          = #svcTaskNum#
        AND FV.GLBL_CMPY_CD          = FL.GLBL_CMPY_CD
        AND FV.FSR_NUM               = FL.FSR_NUM
        AND FV.NEXT_FSR_VISIT_NUM    = FL.FSR_VISIT_NUM
        AND FV.EZCANCELFLAG          = '0'
        AND FL.EZCANCELFLAG          = '0'
    </statement>
    <statement id="getUserId" parameterClass="Map" resultClass="String">
        SELECT
            EVT.FSR_EVENT_EXE_USR_ID
        FROM
            (
                SELECT
                     FEV.GLBL_CMPY_CD
                    ,FEV.SVC_TASK_NUM
                    ,FEV.FSR_EVENT_EXE_USR_ID
                FROM
                     FSR_EVENT FEV
                WHERE
                        FEV.GLBL_CMPY_CD    = #glblCmpyCd#
                    AND FEV.SVC_TASK_NUM    = #svcTaskNum#
                    AND FEV.EZCANCELFLAG    = '0'
                ORDER BY
                    FEV.FSR_EVENT_EXE_TS    ASC
            ) EVT
        WHERE
            ROWNUM  = 1
    </statement>
    <statement id="getSvcMemoTpCd" parameterClass="Map" resultClass="String">
        SELECT 
            TP.SVC_MEMO_TP_CD
        FROM
            SVC_MEMO_TP TP
        WHERE
              TP.GLBL_CMPY_CD              = #glblCmpyCd#
          AND TP.EZCANCELFLAG              = '0'
          AND TP.SVC_MEMO_TP_DESC_TXT      = #svcMemoTpDescTxt#
    </statement>
<!-- START 2017/12/14 M.Kidokoro [QC#22223,ADD] -->
    <statement id="getCrCardCustRefNum" parameterClass="Map" resultClass="String">
        SELECT
            CCT.CR_CARD_CUST_REF_NUM
        FROM
            CR_CARD_TRX CCT
        WHERE
            CCT.GLBL_CMPY_CD        = #glblCmpyCd#
        AND CCT.CR_CARD_TRX_TP_CD   = #crCardTrxTpCd#
        AND CCT.FIRST_TRX_INFO_TXT  = #firstTrxInfoTxt#
        AND CCT.EZCANCELFLAG        = '0'
    </statement>
<!-- END 2017/12/14 M.Kidokoro [QC#22223,ADD] -->
<!-- START 2019/05/31 [QC#50574,ADD] -->
    <statement id="getFollUpPartCall" parameterClass="Map" resultClass="String">
        SELECT
            FL.SVC_TASK_NUM
        FROM
            FSR_VISIT    FV
           ,FSR_VISIT    FL
           ,SVC_TASK     TASK
        WHERE
            FV.GLBL_CMPY_CD        = #glblCmpyCd#
        AND FV.SVC_TASK_NUM        = #svcTaskNum#
        AND FV.GLBL_CMPY_CD        = FL.GLBL_CMPY_CD
        AND FV.FSR_NUM             = FL.FSR_NUM
        AND FV.NEXT_FSR_VISIT_NUM  = FL.FSR_VISIT_NUM
        AND FL.GLBL_CMPY_CD        = TASK.GLBL_CMPY_CD
        AND FL.SVC_TASK_NUM        = TASK.SVC_TASK_NUM
        <iterate property="dsSvcCallTpList" var="dsSvcCallTp[]" open="AND TASK.DS_SVC_CALL_TP_CD IN (" close=")" conjunction=",">
            #dsSvcCallTp[]#
        </iterate>
        AND FV.EZCANCELFLAG        = '0'
        AND FL.EZCANCELFLAG        = '0'
        AND TASK.EZCANCELFLAG      = '0'
    </statement>
    <statement id="getTechOrdPrtPk" parameterClass="Map" resultClass="Map">
        SELECT
            CTO.CLICK_TECH_ORD_PRT_PK
        FROM
            CLICK_TECH_ORD_PRT CTO
        WHERE
            CTO.GLBL_CMPY_CD  = #glblCmpyCd#
        AND CTO.PRCH_REQ_NUM  = #prchReqNum#
        AND CTO.PROC_STS_CD   = #inCompleted#
        AND CTO.EZCANCELFLAG  = '0'
    </statement>
<!-- END 2019/05/31 [QC#50574,ADD] -->
<!-- START 2021/10/04 R.Cabral [QC#59192, ADD] -->
    <resultMap id="result.SVC_SUPPL_TASKTMsg" class="SVC_SUPPL_TASKTMsg">
        <result property="svcSupplFromDt"         column="SVC_SUPPL_FROM_DT"           javaType="EZDTStringItem" />
        <result property="svcSupplFromTm"         column="SVC_SUPPL_FROM_TM"           javaType="EZDTStringItem" />
        <result property="svcSupplToDt"           column="SVC_SUPPL_TO_DT"             javaType="EZDTStringItem" />
        <result property="svcSupplToTm"           column="SVC_SUPPL_TO_TM"             javaType="EZDTStringItem" />
        <result property="svcSupplTmNum"          column="SVC_SUPPL_TM_NUM"            javaType="EZDTBigDecimalItem" />
        <result property="svcTrvlTmNum"           column="SVC_TRVL_TM_NUM"             javaType="EZDTBigDecimalItem" />
        <result property="durnTmNum"              column="DURN_TM_NUM"                 javaType="EZDTBigDecimalItem" />
    </resultMap>
    <statement id="getSupplTask" parameterClass="Map" resultMap="result.SVC_SUPPL_TASKTMsg">
        SELECT
             A.SVC_SUPPL_FROM_DT
            ,A.SVC_SUPPL_FROM_TM
            ,A.SVC_SUPPL_TO_DT
            ,A.SVC_SUPPL_TO_TM
            ,A.SVC_SUPPL_TM_NUM
            ,A.SVC_TRVL_TM_NUM
            ,A.DURN_TM_NUM
        FROM 
             SVC_SUPPL_TASK     A
            ,SVC_SUPPL_TASK_TP  B
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.EZCANCELFLAG         = '0'
            AND A.SVC_TASK_NUM         = #svcTaskNum#
            AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD
            AND A.SVC_SUPPL_TASK_TP_CD = B.SVC_SUPPL_TASK_TP_CD
            AND B.EZCANCELFLAG         = '0'
            AND B.SVC_ITRPT_FLG        = #svcItrptFlgY#
            AND B.EXCL_LBOR_FLG        = #exclLborFlg#
        ORDER BY
             A.SVC_SUPPL_FROM_DT DESC
            ,A.SVC_SUPPL_FROM_TM DESC
            ,A.SVC_SUPPL_TO_DT DESC
            ,A.SVC_SUPPL_TO_TM DESC
    </statement>
<!-- END   2021/10/04 R.Cabral [QC#59192, ADD] -->
<!-- START 2023/11/07 K.Kitachi [QC#61648, ADD] -->
    <statement id="getTechEmlAddr" parameterClass="Map" resultClass="String">
    SELECT
        WH.TECH_MBL_MSG_ADDR
    FROM
        TECH_MSTR TM
      , S21_PSN PSN
      , RTL_WH WH
    WHERE
        TM.GLBL_CMPY_CD = #glblCmpyCd#
    AND TM.TECH_TOC_CD = #rqstTechTocCd#
    AND TM.GLBL_CMPY_CD = PSN.GLBL_CMPY_CD
    AND TM.TECH_TOC_CD = PSN.PSN_CD
    AND TM.GLBL_CMPY_CD = WH.GLBL_CMPY_CD(+)
    AND TM.TECH_TOC_CD = WH.RTL_WH_CD(+)
    AND TM.EZCANCELFLAG = '0'
    AND PSN.EZCANCELFLAG = '0'
    AND WH.EZCANCELFLAG(+) = '0'
    </statement>
<!-- END 2023/11/07 K.Kitachi [QC#61648, ADD] -->
</sqlMap>
