<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL2840Query">

    <typeAlias alias="NMAL2840SMsg"    type="business.blap.NMAL2840.NMAL2840SMsg"/>
    <typeAlias alias="NMAL2840_BSMsg"  type="business.blap.NMAL2840.NMAL2840_BSMsg"/>

    <statement id="getPullDownDunsExtractModeList" parameterClass="Map" resultClass="Map">
        SELECT
              DC.DUNS_CRIT_CD          AS DUNS_CRIT_CD 
            , DC.DUNS_CRIT_DESC_TXT    AS DUNS_CRIT_DESC_TXT 
            , DC.DUNS_CRIT_DEF_VAL_TXT AS DUNS_CRIT_DEF_VAL_TXT 
        FROM
            DUNS_CRIT DC 
        WHERE
                DC.GLBL_CMPY_CD           = #glblCmpyCd# 
            AND DC.EZCANCELFLAG           = '0' 
            AND DC.DUNS_CRIT_XTRCT_FLG    = 'Y' 
            AND DC.DUNS_CRIT_XTRCT_GRP_ID = '0'
        ORDER BY
            DC.DUNS_CRIT_SORT_NUM ASC

    </statement>

	<statement id="getPullDownImportedDNBDateList" parameterClass="Map" resultClass="Map">
        SELECT
              TB.DUNS_PROC_TS          AS DUNS_PROC_TS
            , TB.DUNS_FILE_NM          AS DUNS_FILE_NM
            , TB.DUNS_FILE_TP_DESC_TXT AS DUNS_FILE_TP_DESC_TXT 
        FROM
            ( 
                SELECT
                      DTH.DUNS_PROC_TS          AS DUNS_PROC_TS
                    , DTF.DUNS_FILE_NM          AS DUNS_FILE_NM
                    , DFT.DUNS_FILE_TP_DESC_TXT AS DUNS_FILE_TP_DESC_TXT 
                FROM
                      DUNS_TRX_HDR DTH
                    , DUNS_TRX_FILE DTF
                    , DUNS_FILE_TP DFT 
                WHERE
                        DTH.DUNS_PROC_TP_CD  = #dunsProcTpCd20# 
                    AND DTH.DUNS_PROC_STS_CD = #dunsProcStsCd10# 
                    AND DTH.GLBL_CMPY_CD     = #glblCmpyCd# 
                    AND DTH.EZCANCELFLAG     = '0' 
                    AND DTH.DUNS_TRX_HDR_PK  = DTF.DUNS_TRX_HDR_PK 
                    AND DTH.GLBL_CMPY_CD     = DTF.GLBL_CMPY_CD 
                    AND DTH.EZCANCELFLAG     = DTF.EZCANCELFLAG 
                    AND DTF.DUNS_FILE_TP_CD  = DFT.DUNS_FILE_TP_CD 
                    AND DTF.GLBL_CMPY_CD     = DFT.GLBL_CMPY_CD 
                    AND DTF.EZCANCELFLAG     = DFT.EZCANCELFLAG 
                ORDER BY
                    DUNS_PROC_TS DESC
            ) TB 
        WHERE
            ROWNUM &lt;= #rowNum#

    </statement>
    
    <statement id="getLastDNBDate" parameterClass="Map" resultClass="String">
        SELECT
              MAX(DTH.DUNS_PROC_TS) AS DUNS_PROC_TS 
        FROM
            DUNS_TRX_HDR DTH 
        WHERE
                DTH.DUNS_PROC_TP_CD  = #dunsProcTpCd# 
            AND DTH.DUNS_PROC_STS_CD &lt; #dunsProcStsCd90# 
            AND DTH.GLBL_CMPY_CD     = #glblCmpyCd# 
            AND DTH.EZCANCELFLAG     = '0'

    </statement>

    <statement id="getExtractFieldsExtractSend" parameterClass="Map" resultClass="Map">
        SELECT
              DC.DUNS_CRIT_CD          AS DUNS_CRIT_CD
            , DC.DUNS_CRIT_DEF_VAL_FLG AS DUNS_CRIT_DEF_VAL_FLG 
            , DC.DUNS_CRIT_DEF_VAL_TXT AS DUNS_CRIT_DEF_VAL_TXT 
        FROM
            DUNS_CRIT DC 
        WHERE
                DC.DUNS_CRIT_XTRCT_FLG    = 'Y' 
            AND DC.DUNS_CRIT_XTRCT_GRP_ID &lt;&gt; '0' 
            AND DC.GLBL_CMPY_CD           = #glblCmpyCd# 
            AND DC.EZCANCELFLAG           = '0'

    </statement>

    <statement id="getExtractFieldsDNBFileUpdate" parameterClass="Map" resultClass="Map">
        SELECT
              DC.DUNS_CRIT_CD          AS DUNS_CRIT_CD 
            , DC.DUNS_CRIT_DESC_TXT    AS DUNS_CRIT_DESC_TXT 
            , DC.DUNS_CRIT_DEF_VAL_FLG AS DUNS_CRIT_DEF_VAL_FLG 
            , DC.DUNS_CRIT_DEF_VAL_TXT AS DUNS_CRIT_DEF_VAL_TXT 
        FROM
            DUNS_CRIT DC 
        WHERE
                DC.DUNS_CRIT_EXPT_FLG = 'Y' 
            AND DC.GLBL_CMPY_CD       = #glblCmpyCd# 
            AND DC.EZCANCELFLAG       = '0'

    </statement>

    <statement id="getAuditInformation" parameterClass="Map" resultClass="Map">
        SELECT
              DTH.DUNS_PROC_TP_CD         AS DUNS_PROC_TP_CD 
            , DTH.DUNS_PROC_TS            AS DUNS_PROC_TS 
            , DTH.DUNS_PROC_BY_ID         AS DUNS_PROC_BY_ID 
            , DTH.DUNS_PROC_CMNT_TXT      AS DUNS_PROC_CMNT_TXT 
            , DPT.DUNS_PROC_TP_DESC_TXT   AS DUNS_PROC_TP_DESC_TXT 
            , DTF.DUNS_FILE_TP_CD         AS DUNS_FILE_TP_CD 
            , DTF.DUNS_FILE_NM            AS DUNS_FILE_NM 
            , DTF.DUNS_FILE_LINE_NUM      AS DUNS_FILE_LINE_NUM 
            , DFT.DUNS_FILE_TP_DESC_TXT   AS DUNS_FILE_TP_DESC_TXT 
            , AP.FIRST_NM                 AS FIRST_NM
            , AP.LAST_NM                  AS LAST_NM 
            , AP.USR_NM                   AS USR_NM
            , JOIN_TBL.DUNS_CRIT_CD       AS DUNS_CRIT_CD 
            , JOIN_TBL.DUNS_CRIT_DESC_TXT AS DUNS_CRIT_DESC_TXT 
            , JOIN_TBL.DUNS_CRIT_VAL_FLG  AS DUNS_CRIT_VAL_FLG 
            , JOIN_TBL.DUNS_CRIT_VAL_TXT  AS DUNS_CRIT_VAL_TXT  
        FROM
              DUNS_TRX_HDR DTH 
            , DUNS_PROC_TP DPT 
            , DUNS_TRX_FILE DTF 
            , DUNS_FILE_TP DFT 
            , AUTH_PSN AP 
            , ( 
                SELECT
                      DTC_SUB.DUNS_TRX_HDR_PK
                    , DTC_SUB.GLBL_CMPY_CD
                    , DTC_SUB.EZCANCELFLAG 
                    , DC_SUB.DUNS_CRIT_CD
                    , DC_SUB.DUNS_CRIT_DESC_TXT
                    , DTC_SUB.DUNS_CRIT_VAL_FLG
                    , DTC_SUB.DUNS_CRIT_VAL_TXT 
                FROM
                    DUNS_TRX_CRIT DTC_SUB
                    , DUNS_CRIT DC_SUB 
                WHERE
                    DTC_SUB.DUNS_CRIT_CD = DC_SUB.DUNS_CRIT_CD 
                    AND DTC_SUB.GLBL_CMPY_CD = DC_SUB.GLBL_CMPY_CD 
                    AND DTC_SUB.EZCANCELFLAG = DC_SUB.EZCANCELFLAG 
              ) JOIN_TBL 
        WHERE
                DTH.DUNS_PROC_TP_CD  IN (#dunsProcTpCd10#, #dunsProcTpCd20#, #dunsProcTpCd30#, #dunsProcTpCd40#) 
            AND DTH.DUNS_PROC_STS_CD &lt; #dunsProcStsCd90# 
            AND DTH.GLBL_CMPY_CD     = #glblCmpyCd# 
            AND DTH.EZCANCELFLAG     = '0' 
            AND DTH.DUNS_PROC_TP_CD  = DPT.DUNS_PROC_TP_CD 
            AND DTH.GLBL_CMPY_CD     = DPT.GLBL_CMPY_CD 
            AND DTH.EZCANCELFLAG     = DPT.EZCANCELFLAG 
            AND DTH.DUNS_TRX_HDR_PK  = DTF.DUNS_TRX_HDR_PK(+) 
            AND DTH.GLBL_CMPY_CD     = DTF.GLBL_CMPY_CD(+) 
            AND DTH.EZCANCELFLAG     = DTF.EZCANCELFLAG(+) 
            AND DTF.DUNS_FILE_TP_CD  = DFT.DUNS_FILE_TP_CD(+) 
            AND DTF.GLBL_CMPY_CD     = DFT.GLBL_CMPY_CD(+) 
            AND DTF.EZCANCELFLAG     = DFT.EZCANCELFLAG(+) 
            AND DTH.DUNS_TRX_HDR_PK  = JOIN_TBL.DUNS_TRX_HDR_PK(+) 
            AND DTH.GLBL_CMPY_CD     = JOIN_TBL.GLBL_CMPY_CD(+) 
            AND DTH.EZCANCELFLAG     = JOIN_TBL.EZCANCELFLAG(+) 
            AND DTH.DUNS_PROC_BY_ID  = AP.USR_NM(+) 
            AND DTH.GLBL_CMPY_CD     = AP.GLBL_CMPY_CD(+) 
            AND DTH.EZCANCELFLAG     = AP.EZCANCELFLAG(+) 
        ORDER BY
              DTH.DUNS_PROC_TS DESC
            , DPT.DUNS_PROC_TP_SORT_NUM DESC
            <!-- START 2017/12/15 Hd.Sugawara [QC#20905,ADD] -->
            , DFT.DUNS_FILE_TP_SORT_NUM ASC
            <!-- END 2017/12/15 Hd.Sugawara [QC#20905,ADD] -->
            , JOIN_TBL.DUNS_CRIT_CD ASC 

    </statement>

    <!-- CSA-QC#14862 Add Start -->
    <statement id="extractForReviewList" parameterClass="Map" resultMap="result.extractForReviewList">
        SELECT
              S21_DPL.DS_ACCT_NM                     AS S21_ACCOUNT_NM
            , S21_DPL.DS_ACCT_NUM                    AS S21_ACCOUNT_NUM
            , S21_DPL.LOC_NUM                        AS S21_LOCATION_NUM
            , S21_DPL.FIRST_LINE_ADDR                AS S21_ADDRESS1
            , S21_DPL.SCD_LINE_ADDR                  AS S21_ADDRESS2
            , S21_DPL.CTY_ADDR                       AS S21_CITY
            , S21_DPL.ST_CD                          AS S21_STATE
            , S21_DPL.POST_CD                        AS S21_POSTAL_CODE
            , S21_DPL.DS_LOC_EMP_NUM                 AS S21_EMPLOYEE_TOTAL
            , S21_DPL.DS_LOC_REV_AMT                 AS S21_ANNUAL_US_SALES
            , S21_DPL.DS_CUST_SIC_DESC_TXT_2         AS S21_INDUSTRY
            , S21_DPL.DS_CUST_SIC_CD_2               AS S21_SIC_CODE
            , S21_DPL.DUNS_NUM                       AS S21_DUNS_NUM
            , S21_DPL.DS_ULT_DUNS_NUM                AS S21_UDUNS
            , S21_DPL.HQ_DUNS_NUM                    AS S21_HQ_DUNS_NUM
            , S21_DPL.DS_PRNT_DUNS_NUM               AS S21_PARENT_DUNS_NUM
            , S21_DPL.DUNS_BIZ_NM                    AS S21_DNB_BUSINESS_NM
            , S21_DPL.DUNS_TRADE_STYLE_NM            AS S21_DNB_TRADESTYLE_NM
            , S21_DPL.DUNS_LINE_ADDR                 AS S21_DNB_ADDRESS
            , S21_DPL.DUNS_ACTV_CD                   AS S21_DNB_BEMFAB_CODE
            , S21_DPL.DS_LAST_UPD_DUNS_DT            AS S21_DNB_LAST_UPDATE_DATE
            , S21_DPL.DS_CUST_SIC_CD                 AS S21_COMPANY_SIC_CODE
            , S21_DPL.DS_CUST_SIC_DESC_TXT           AS S21_COMPANY_SIC_DESCRIPTION
            , S21_DPL.S21_DNB_FILE_DATE              AS S21_DNB_FILE_DATE
            , S21_DPL.DNB_MATCH_CODE                 AS DNB_MATCH_CODE
            , S21_DPL.DNB_NM_PROFILE_CODE            AS DNB_NM_PROFILE_CODE
            , S21_DPL.DNB_STREET_NO_PROFILE_CODE     AS DNB_STREET_NO_PROFILE_CODE
            , S21_DPL.DNB_STREET_NM_PROFILE_CODE     AS DNB_STREET_NM_PROFILE_CODE
            , S21_DPL.DNB_CONFIDENCE_CODE            AS DNB_CONFIDENCE_CODE
            , S21_DPL.DNB_MATCH_GRADE                AS DNB_MATCH_GRADE
            , S21_DPL.DNB_NIXIE_A                    AS DNB_NIXIE_A
            , S21_DPL.DNB_BEMFAB                     AS DNB_BEMFAB
            , S21_DPL.DNB_BUSINESS_NM                AS DNB_BUSINESS_NM
            , S21_DPL.DNB_TRADE_NM                   AS DNB_TRADE_NM
            , S21_DPL.DNB_ADDRESS_LINE               AS DNB_ADDRESS_LINE
            , S21_DPL.DNB_CITY_NM                    AS DNB_CITY_NM
            , S21_DPL.DNB_STATE_ABBREVIATION         AS DNB_STATE_ABBREVIATION
            , S21_DPL.DNB_ZIP_CODE                   AS DNB_ZIP_CODE
            , S21_DPL.DNB_DUNS_NUM                   AS DNB_DUNS_NUM
            , S21_DPL.DNB_EMPLOYEES_TOTAL            AS DNB_EMPLOYEES_TOTAL
            , S21_DPL.DNB_ANNUAL_US_SALES            AS DNB_ANNUAL_US_SALES
            , S21_DPL.DNB_LINE_OF_BUSINESS           AS DNB_LINE_OF_BUSINESS
            , S21_DPL.DNB_SIC_CODE                   AS DNB_SIC_CODE
            , S21_DPL.DNB_GLOBAL_ULTIMATE_DUNS_NO    AS DNB_GLOBAL_ULTIMATE_DUNS_NO
            , S21_DPL.DNB_HEADQUARTERS_DUNS_NO       AS DNB_HEADQUARTERS_DUNS_NO
            , S21_DPL.DNB_PARENT_DUNS_NO             AS DNB_PARENT_DUNS_NO
            , S21_DPL.DNB_GLOBAL_ULTI_BUSINESS_NM    AS DNB_GLOBAL_ULTI_BUSINESS_NM
            , S21_DPL.DNB_COMPANY_SIC_CODE           AS DNB_COMPANY_SIC_CODE
            , S21_DPL.DNB_COMPANY_SIC_DESCRIPTION    AS DNB_COMPANY_SIC_DESCRIPTION 
        FROM
             ( 
                SELECT
                      DAC.DS_ACCT_NM             AS DS_ACCT_NM
                    , DAC.SELL_TO_CUST_CD            AS DS_ACCT_NUM
                    , PLW.LOC_NUM                AS LOC_NUM
                    , PLW.FIRST_LINE_ADDR        AS FIRST_LINE_ADDR
                    , PLW.SCD_LINE_ADDR          AS SCD_LINE_ADDR
                    , PLW.CTY_ADDR               AS CTY_ADDR
                    , PLW.ST_CD                  AS ST_CD
                    , PLW.POST_CD                AS POST_CD
                    , PLW.DS_LOC_EMP_NUM        AS DS_LOC_EMP_NUM
                    , PLW.DS_LOC_REV_AMT        AS DS_LOC_REV_AMT
                    , DAC.DS_CUST_SIC_DESC_TXT   AS DS_CUST_SIC_DESC_TXT
                    , DAC.DS_CUST_SIC_CD         AS DS_CUST_SIC_CD
                    , PLW.DUNS_NUM               AS DUNS_NUM  
                    , PLW.DS_ULT_DUNS_NUM       AS DS_ULT_DUNS_NUM
                    , PLW.HQ_DUNS_NUM           AS HQ_DUNS_NUM
                    , PLW.DS_PRNT_DUNS_NUM      AS DS_PRNT_DUNS_NUM
                    , PLW.DUNS_BIZ_NM           AS DUNS_BIZ_NM
                    , PLW.DUNS_TRADE_STYLE_NM   AS DUNS_TRADE_STYLE_NM
                    , PLW.DUNS_LINE_ADDR        AS DUNS_LINE_ADDR
                    , PLW.DUNS_ACTV_CD          AS DUNS_ACTV_CD
                    , PLW.DS_LAST_UPD_DUNS_DT   AS DS_LAST_UPD_DUNS_DT
                    , PLW.DS_CUST_SIC_CD        AS DS_CUST_SIC_CD_2
                    , PLW.DS_CUST_SIC_DESC_TXT  AS DS_CUST_SIC_DESC_TXT_2
                    , DAC.GLBL_CMPY_CD           AS GLBL_CMPY_CD
                    , DAC.EZCANCELFLAG           AS EZCANCELFLAG 
                    , DTH.DUNS_PROC_TS           AS S21_DNB_FILE_DATE
                    , DRI.DUNS_MATCH_CD          AS DNB_MATCH_CODE
                    , DRI.NM_PRFL_CD             AS DNB_NM_PROFILE_CODE
                    , DRI.STR_NO_PRFL_CD         AS DNB_STREET_NO_PROFILE_CODE
                    , DRI.STR_NM_PRFL_CD         AS DNB_STREET_NM_PROFILE_CODE
                    , DRI.DUNS_CNFD_CD           AS DNB_CONFIDENCE_CODE
                    , DRI.MATCH_GRD_CD           AS DNB_MATCH_GRADE
                    , DRI.NIXIE_A_CD             AS DNB_NIXIE_A
                    , DRI.DUNS_ACTV_CD           AS DNB_BEMFAB
                    , DRI.DUNS_BIZ_NM            AS DNB_BUSINESS_NM
                    , DRI.DUNS_TRADE_STYLE_NM    AS DNB_TRADE_NM
                    , DRI.DUNS_LINE_ADDR         AS DNB_ADDRESS_LINE
                    , DRI.DUNS_CTY_NM            AS DNB_CITY_NM
                    , DRI.DUNS_ST_CD_01          AS DNB_STATE_ABBREVIATION
                    , DRI.POST_CD                AS DNB_ZIP_CODE
                    , DRI.DUNS_NUM               AS DNB_DUNS_NUM
                    , DRI.EMP_TOT_NUM            AS DNB_EMPLOYEES_TOTAL
                    , DRI.ANN_SLS_AMT            AS DNB_ANNUAL_US_SALES
                    , DRI.LINE_BIZ_NM            AS DNB_LINE_OF_BUSINESS
                    , DRI.FIRST_SIC_CD           AS DNB_SIC_CODE
                    , DRI.GLBL_ULT_DUNS_NUM      AS DNB_GLOBAL_ULTIMATE_DUNS_NO
                    , DRI.HQ_DUNS_NUM            AS DNB_HEADQUARTERS_DUNS_NO
                    , DRI.PRNT_DUNS_NUM          AS DNB_PARENT_DUNS_NO
                    , DRI.GLBL_ULT_BIZ_NM        AS DNB_GLOBAL_ULTI_BUSINESS_NM
                    , DRI.DUNS_CMPY_SIC_CD       AS DNB_COMPANY_SIC_CODE
                    , DRI.DUNS_CMPY_SIC_DESC_TXT AS DNB_COMPANY_SIC_DESCRIPTION 
                FROM
                      DUNS_TRX_HDR DTH
                    , DUNS_RCV_INFO DRI
                    , SELL_TO_CUST DAC
                    , ACCT_LOC AL
                    , PTY_LOC_WRK PLW
                    , SHIP_TO_CUST STC 
                WHERE
                        DTH.GLBL_CMPY_CD       = #glblCmpyCd# 
                    AND DTH.EZCANCELFLAG       = '0' 
	                <isNotNull property="dunsProcTs">
                        AND DTH.DUNS_PROC_TS   = #dunsProcTs# 
                    </isNotNull>
                    AND DTH.DUNS_PROC_TP_CD    = #dunsProcTpCd20# 
                    AND DTH.DUNS_PROC_STS_CD   = #dunsProcStsCd10# 
                    AND DTH.DUNS_TRX_HDR_PK    = DRI.DUNS_TRX_HDR_PK 
                    AND DTH.GLBL_CMPY_CD       = DRI.GLBL_CMPY_CD 
                    AND DTH.EZCANCELFLAG       = DRI.EZCANCELFLAG 
                    <isNotNull property="dunsCritTxt51">
                        <iterate property="dunsCritTxtArrray51" var="elem51[]" open="AND (" close=")" conjunction="OR">
                            DRI.NM_PRFL_CD     LIKE #elem51[]# 
                        </iterate>
                    </isNotNull>
                    <isNotNull property="dunsCritFlg51">
                        AND DRI.NM_PRFL_CD     IS NULL 
                    </isNotNull>
                    <isNotNull property="dunsCritTxt52">
                        <iterate property="dunsCritTxtArrray52" var="elem52[]" open="AND (" close=")" conjunction="OR">
                            DRI.STR_NO_PRFL_CD LIKE #elem52[]# 
                        </iterate>
                    </isNotNull>
                    <isNotNull property="dunsCritFlg52">
                        AND DRI.STR_NO_PRFL_CD IS NULL
                    </isNotNull>
                    <isNotNull property="dunsCritTxt53">
                        <iterate property="dunsCritTxtArrray53" var="elem53[]" open="AND (" close=")" conjunction="OR">
                            DRI.STR_NM_PRFL_CD LIKE #elem53[]# 
                        </iterate>
                    </isNotNull> 
                    <isNotNull property="dunsCritFlg53">
                        AND DRI.STR_NM_PRFL_CD IS NULL 
                    </isNotNull>
                    <isNotNull property="dunsCritTxt54">
                        <iterate property="dunsCritTxtArrray54" var="elem54[]" open="AND (" close=")" conjunction="OR">
                            DRI.MATCH_GRD_CD   LIKE #elem54[]# 
                        </iterate>
                    </isNotNull> 
                    <isNotNull property="dunsCritFlg54">
                        AND DRI.MATCH_GRD_CD   IS NULL 
                    </isNotNull>
                    <isNotNull property="dunsCritTxt55">
                        <iterate property="dunsCritTxtArrray55" var="elem55[]" open="AND (" close=")" conjunction="OR">
                            DRI.DUNS_ACTV_CD   LIKE #elem55[]# 
                        </iterate>
                    </isNotNull> 
                    <isNotNull property="dunsCritFlg55">
                        AND DRI.DUNS_ACTV_CD   IS NULL 
                    </isNotNull>
                    <isNotNull property="dunsCritTxt56">
                        <iterate property="dunsCritTxtArrray56" var="elem56[]" open="AND (" close=")" conjunction="OR">
                            DRI.NIXIE_A_CD     LIKE #elem56[]# 
                        </iterate>
                    </isNotNull> 
                    <isNotNull property="dunsCritFlg56">
                        AND DRI.NIXIE_A_CD     IS NULL
                    </isNotNull>
                    <isNotNull property="dunsCritTxt57">
                        <iterate property="dunsCritTxtArrray57" var="elem57[]" open="AND (" close=")" conjunction="OR">
                            DRI.DUNS_CNFD_CD   LIKE #elem57[]# 
                        </iterate>
                    </isNotNull> 
                    <isNotNull property="dunsCritFlg57">
                        AND DRI.DUNS_CNFD_CD   IS NULL
                    </isNotNull>
                    AND DRI.DS_ACCT_NUM            = DAC.SELL_TO_CUST_CD 
                    AND DAC.DS_ACCT_ACTV_CUST_FLG  = 'Y' 
                    AND DRI.GLBL_CMPY_CD           = DAC.GLBL_CMPY_CD 
                    AND DRI.EZCANCELFLAG           = DAC.EZCANCELFLAG 

                    AND DAC.SELL_TO_CUST_CD            = AL.DS_ACCT_NUM
                    AND DRI.LOC_NUM                = AL.LOC_NUM
                    AND AL.RGTN_STS_CD             = #rgtnStsCd#
                    AND DAC.GLBL_CMPY_CD           = AL.GLBL_CMPY_CD 
                    AND DAC.EZCANCELFLAG           = AL.EZCANCELFLAG 

                    AND AL.LOC_NUM                 = PLW.LOC_NUM 
                    AND PLW.RGTN_STS_CD            = #rgtnStsCd# 
                    AND AL.GLBL_CMPY_CD            = PLW.GLBL_CMPY_CD 
                    AND AL.EZCANCELFLAG            = PLW.EZCANCELFLAG 

                    AND PLW.CTRY_CD                = #ctryCd# 

                    AND PLW.PTY_LOC_PK             = STC.PTY_LOC_PK 
                    AND STC.RGTN_STS_CD            = #rgtnStsCd# 
                    AND PLW.GLBL_CMPY_CD           = STC.GLBL_CMPY_CD 
                    AND PLW.EZCANCELFLAG           = STC.EZCANCELFLAG 

                UNION 

                SELECT
                      DAP.DS_ACCT_NM              AS DS_ACCT_NM
                    , DAP.DS_ACCT_NUM             AS DS_ACCT_NUM
                    , PLW2.LOC_NUM                AS LOC_NUM
                    , PLW2.FIRST_LINE_ADDR        AS FIRST_LINE_ADDR
                    , PLW2.SCD_LINE_ADDR          AS SCD_LINE_ADDR
                    , PLW2.CTY_ADDR               AS CTY_ADDR
                    , PLW2.ST_CD                  AS ST_CD
                    , PLW2.POST_CD                AS POST_CD
                    , PLW2.DS_LOC_EMP_NUM        AS DS_LOC_EMP_NUM
                    , PLW2.DS_LOC_REV_AMT        AS DS_LOC_REV_AMT
                    , DAP.DS_CUST_SIC_DESC_TXT    AS DS_CUST_SIC_DESC_TXT
                    , DAP.DS_CUST_SIC_CD          AS DS_CUST_SIC_CD
                    , PLW2.DUNS_NUM               AS DUNS_NUM
                    , PLW2.DS_ULT_DUNS_NUM       AS DS_ULT_DUNS_NUM
                    , PLW2.HQ_DUNS_NUM           AS HQ_DUNS_NUM
                    , PLW2.DS_PRNT_DUNS_NUM      AS DS_PRNT_DUNS_NUM
                    , PLW2.DUNS_BIZ_NM           AS DUNS_BIZ_NM
                    , PLW2.DUNS_TRADE_STYLE_NM   AS DUNS_TRADE_STYLE_NM
                    , PLW2.DUNS_LINE_ADDR        AS DUNS_LINE_ADDR
                    , PLW2.DUNS_ACTV_CD          AS DUNS_ACTV_CD
                    , PLW2.DS_LAST_UPD_DUNS_DT   AS DS_LAST_UPD_DUNS_DT
                    , PLW2.DS_CUST_SIC_CD        AS DS_CUST_SIC_CD_2
                    , PLW2.DS_CUST_SIC_DESC_TXT  AS DS_CUST_SIC_DESC_TXT_2
                    , DAP.GLBL_CMPY_CD            AS GLBL_CMPY_CD
                    , DAP.EZCANCELFLAG            AS EZCANCELFLAG 
                    , DTH2.DUNS_PROC_TS           AS S21_DNB_FILE_DATE
                    , DRI2.DUNS_MATCH_CD          AS DNB_MATCH_CODE
                    , DRI2.NM_PRFL_CD             AS DNB_NM_PROFILE_CODE
                    , DRI2.STR_NO_PRFL_CD         AS DNB_STREET_NO_PROFILE_CODE
                    , DRI2.STR_NM_PRFL_CD         AS DNB_STREET_NM_PROFILE_CODE
                    , DRI2.DUNS_CNFD_CD           AS DNB_CONFIDENCE_CODE
                    , DRI2.MATCH_GRD_CD           AS DNB_MATCH_GRADE
                    , DRI2.NIXIE_A_CD             AS DNB_NIXIE_A
                    , DRI2.DUNS_ACTV_CD           AS DNB_BEMFAB
                    , DRI2.DUNS_BIZ_NM            AS DNB_BUSINESS_NM
                    , DRI2.DUNS_TRADE_STYLE_NM    AS DNB_TRADE_NM
                    , DRI2.DUNS_LINE_ADDR         AS DNB_ADDRESS_LINE
                    , DRI2.DUNS_CTY_NM            AS DNB_CITY_NM
                    , DRI2.DUNS_ST_CD_01          AS DNB_STATE_ABBREVIATION
                    , DRI2.POST_CD                AS DNB_ZIP_CODE
                    , DRI2.DUNS_NUM               AS DNB_DUNS_NUM
                    , DRI2.EMP_TOT_NUM            AS DNB_EMPLOYEES_TOTAL
                    , DRI2.ANN_SLS_AMT            AS DNB_ANNUAL_US_SALES
                    , DRI2.LINE_BIZ_NM            AS DNB_LINE_OF_BUSINESS
                    , DRI2.FIRST_SIC_CD           AS DNB_SIC_CODE
                    , DRI2.GLBL_ULT_DUNS_NUM      AS DNB_GLOBAL_ULTIMATE_DUNS_NO
                    , DRI2.HQ_DUNS_NUM            AS DNB_HEADQUARTERS_DUNS_NO
                    , DRI2.PRNT_DUNS_NUM          AS DNB_PARENT_DUNS_NO
                    , DRI2.GLBL_ULT_BIZ_NM        AS DNB_GLOBAL_ULTI_BUSINESS_NM
                    , DRI2.DUNS_CMPY_SIC_CD       AS DNB_COMPANY_SIC_CODE
                    , DRI2.DUNS_CMPY_SIC_DESC_TXT AS DNB_COMPANY_SIC_DESCRIPTION 
                FROM
                      DUNS_TRX_HDR DTH2
                    , DUNS_RCV_INFO DRI2
                    , DS_ACCT_PROS DAP
                    , PROS_PTY_LOC_WRK PLW2
                WHERE
                        DTH2.GLBL_CMPY_CD       = #glblCmpyCd# 
                    AND DTH2.EZCANCELFLAG       = '0' 
	                <isNotNull property="dunsProcTs">
                        AND DTH2.DUNS_PROC_TS   = #dunsProcTs# 
                    </isNotNull>
                    AND DTH2.DUNS_PROC_TP_CD    = #dunsProcTpCd20# 
                    AND DTH2.DUNS_PROC_STS_CD   = #dunsProcStsCd10# 
                    AND DTH2.DUNS_TRX_HDR_PK    = DRI2.DUNS_TRX_HDR_PK 
                    AND DTH2.GLBL_CMPY_CD       = DRI2.GLBL_CMPY_CD 
                    AND DTH2.EZCANCELFLAG       = DRI2.EZCANCELFLAG 
                    <isNotNull property="dunsCritTxt51">
                        <iterate property="dunsCritTxtArrray51" var="elem51[]" open="AND (" close=")" conjunction="OR">
                            DRI2.NM_PRFL_CD     LIKE #elem51[]# 
                        </iterate>
                    </isNotNull>
                    <isNotNull property="dunsCritFlg51">
                        AND DRI2.NM_PRFL_CD     IS NULL 
                    </isNotNull>
                    <isNotNull property="dunsCritTxt52">
                        <iterate property="dunsCritTxtArrray52" var="elem52[]" open="AND (" close=")" conjunction="OR">
                            DRI2.STR_NO_PRFL_CD LIKE #elem52[]# 
                        </iterate>
                    </isNotNull>
                    <isNotNull property="dunsCritFlg52">
                        AND DRI2.STR_NO_PRFL_CD IS NULL
                    </isNotNull>
                    <isNotNull property="dunsCritTxt53">
                        <iterate property="dunsCritTxtArrray53" var="elem53[]" open="AND (" close=")" conjunction="OR">
                            DRI2.STR_NM_PRFL_CD LIKE #elem53[]# 
                        </iterate>
                    </isNotNull> 
                    <isNotNull property="dunsCritFlg53">
                        AND DRI2.STR_NM_PRFL_CD IS NULL 
                    </isNotNull>
                    <isNotNull property="dunsCritTxt54">
                        <iterate property="dunsCritTxtArrray54" var="elem54[]" open="AND (" close=")" conjunction="OR">
                            DRI2.MATCH_GRD_CD   LIKE #elem54[]# 
                        </iterate>
                    </isNotNull> 
                    <isNotNull property="dunsCritFlg54">
                        AND DRI2.MATCH_GRD_CD   IS NULL 
                    </isNotNull>
                    <isNotNull property="dunsCritTxt55">
                        <iterate property="dunsCritTxtArrray55" var="elem55[]" open="AND (" close=")" conjunction="OR">
                            DRI2.DUNS_ACTV_CD   LIKE #elem55[]# 
                        </iterate>
                    </isNotNull> 
                    <isNotNull property="dunsCritFlg55">
                        AND DRI2.DUNS_ACTV_CD   IS NULL 
                    </isNotNull>
                    <isNotNull property="dunsCritTxt56">
                        <iterate property="dunsCritTxtArrray56" var="elem56[]" open="AND (" close=")" conjunction="OR">
                            DRI2.NIXIE_A_CD     LIKE #elem56[]# 
                        </iterate>
                    </isNotNull> 
                    <isNotNull property="dunsCritFlg56">
                        AND DRI2.NIXIE_A_CD     IS NULL
                    </isNotNull>
                    <isNotNull property="dunsCritTxt57">
                        <iterate property="dunsCritTxtArrray57" var="elem57[]" open="AND (" close=")" conjunction="OR">
                            DRI2.DUNS_CNFD_CD   LIKE #elem57[]# 
                        </iterate>
                    </isNotNull> 
                    <isNotNull property="dunsCritFlg57">
                        AND DRI2.DUNS_CNFD_CD   IS NULL
                    </isNotNull>
                    AND DRI2.DS_ACCT_NUM           = DAP.DS_ACCT_NUM
                    AND DRI2.GLBL_CMPY_CD          = DAP.GLBL_CMPY_CD 
                    AND DRI2.EZCANCELFLAG          = DAP.EZCANCELFLAG 
                    AND DAP.DS_ACCT_ACTV_CUST_FLG  = 'Y' 

                    AND DAP.PTY_LOC_PK             = PLW2.PTY_LOC_PK 
                    AND DAP.GLBL_CMPY_CD           = PLW2.GLBL_CMPY_CD 
                    AND DAP.EZCANCELFLAG           = PLW2.EZCANCELFLAG 

                    AND PLW2.RGTN_STS_CD           = #rgtnStsCd# 
                    AND PLW2.CTRY_CD               = #ctryCd# 
            ) S21_DPL 
        WHERE
            ROWNUM                 &lt;= #rowNum#
    </statement>
    <!-- CSA-QC#14862 Add End -->

    <resultMap id="result.extractForReviewList" class="NMAL2840_BSMsg">
        <result property="dsAcctNm_B"           column="S21_ACCOUNT_NM"              javaType="EZDSStringItem"/>
        <result property="dsAcctNum_B"          column="S21_ACCOUNT_NUM"             javaType="EZDSStringItem"/>
        <result property="locNum_B"             column="S21_LOCATION_NUM"            javaType="EZDSStringItem"/>
        <result property="firstLineAddr_B"      column="S21_ADDRESS1"                javaType="EZDSStringItem"/>
        <result property="scdLineAddr_B"        column="S21_ADDRESS2"                javaType="EZDSStringItem"/>
        <result property="ctyAddr_B"            column="S21_CITY"                    javaType="EZDSStringItem"/>
        <result property="stCd_B"               column="S21_STATE"                   javaType="EZDSStringItem"/>
        <result property="postCd_1"             column="S21_POSTAL_CODE"             javaType="EZDSStringItem"/>
        <result property="dsLocEmpNum_B"        column="S21_EMPLOYEE_TOTAL"          javaType="EZDSBigDecimalItem"/>
        <result property="dsLocRevAmt_B"        column="S21_ANNUAL_US_SALES"         javaType="EZDSBigDecimalItem"/>
        <result property="dsCustSicDescTxt_1"   column="S21_INDUSTRY"                javaType="EZDSStringItem"/>
        <result property="dsCustSicCd_1"        column="S21_SIC_CODE"                javaType="EZDSStringItem"/>
        <result property="dunsNum_1"            column="S21_DUNS_NUM"                javaType="EZDSStringItem"/>
        <result property="dsUltDunsNum_B"       column="S21_UDUNS"                   javaType="EZDSStringItem"/>
        <result property="hqDunsNum_1"          column="S21_HQ_DUNS_NUM"            javaType="EZDSStringItem"/>
        <result property="dsPrntDunsNum_B"      column="S21_PARENT_DUNS_NUM"         javaType="EZDSStringItem"/>
        <result property="dunsProcTs_B"         column="S21_DNB_FILE_DATE"           javaType="EZDSStringItem"/>
        <result property="dunsBizNm_1"          column="S21_DNB_BUSINESS_NM"         javaType="EZDSStringItem"/>
        <result property="dunsTradeStyleNm_1"   column="S21_DNB_TRADESTYLE_NM"       javaType="EZDSStringItem"/>
        <result property="dunsLineAddr_1"       column="S21_DNB_ADDRESS"             javaType="EZDSStringItem"/>
        <result property="dunsActvCd_1"         column="S21_DNB_BEMFAB_CODE"         javaType="EZDSStringItem"/>
        <result property="dsLastUpdDunsDt_B"    column="S21_DNB_LAST_UPDATE_DATE"    javaType="EZDSDateItem"/>
        <result property="dsCustSicCd_2"        column="S21_COMPANY_SIC_CODE"        javaType="EZDSStringItem"/>
        <result property="dsCustSicDescTxt_2"   column="S21_COMPANY_SIC_DESCRIPTION" javaType="EZDSStringItem"/>
        <result property="dunsMatchCd_B"        column="DNB_MATCH_CODE"              javaType="EZDSStringItem"/>
        <result property="nmPrflCd_B"           column="DNB_NM_PROFILE_CODE"         javaType="EZDSStringItem"/>
        <result property="strNoPrflCd_B"        column="DNB_STREET_NO_PROFILE_CODE"  javaType="EZDSStringItem"/>
        <result property="strNmPrflCd_B"        column="DNB_STREET_NM_PROFILE_CODE"  javaType="EZDSStringItem"/>
        <result property="dunsCnfdCd_B"         column="DNB_CONFIDENCE_CODE"         javaType="EZDSStringItem"/>
        <result property="matchGrdCd_B"         column="DNB_MATCH_GRADE"             javaType="EZDSStringItem"/>
        <result property="nixieACd_B"           column="DNB_NIXIE_A"                 javaType="EZDSStringItem"/>
        <result property="dunsActvCd_2"         column="DNB_BEMFAB"                  javaType="EZDSStringItem"/>
        <result property="dunsBizNm_2"          column="DNB_BUSINESS_NM"             javaType="EZDSStringItem"/>
        <result property="dunsTradeStyleNm_2"   column="DNB_TRADE_NM"                javaType="EZDSStringItem"/>
        <result property="dunsLineAddr_2"       column="DNB_ADDRESS_LINE"            javaType="EZDSStringItem"/>
        <result property="dunsCtyNm_B"          column="DNB_CITY_NM"                 javaType="EZDSStringItem"/>
        <result property="dunsStCd_B"           column="DNB_STATE_ABBREVIATION"      javaType="EZDSStringItem"/>
        <result property="postCd_2"             column="DNB_ZIP_CODE"                javaType="EZDSStringItem"/>
        <result property="dunsNum_2"            column="DNB_DUNS_NUM"                javaType="EZDSStringItem"/>
        <result property="empTotNum_B"          column="DNB_EMPLOYEES_TOTAL"         javaType="EZDSBigDecimalItem"/>
        <result property="annSlsAmt_B"          column="DNB_ANNUAL_US_SALES"         javaType="EZDSBigDecimalItem"/>
        <result property="lineBizNm_B"          column="DNB_LINE_OF_BUSINESS"        javaType="EZDSStringItem"/>
        <result property="firstSicCd_B"         column="DNB_SIC_CODE"                javaType="EZDSStringItem"/>
        <result property="glblUltDunsNum_B"     column="DNB_GLOBAL_ULTIMATE_DUNS_NO" javaType="EZDSStringItem"/>
        <result property="hqDunsNum_2"          column="DNB_HEADQUARTERS_DUNS_NO"    javaType="EZDSStringItem"/>
        <result property="prntDunsNum_B"        column="DNB_PARENT_DUNS_NO"          javaType="EZDSStringItem"/>
        <result property="glblUltBizNm_B"       column="DNB_GLOBAL_ULTI_BUSINESS_NM" javaType="EZDSStringItem"/>
        <result property="dunsCmpySicCd_B"      column="DNB_COMPANY_SIC_CODE"        javaType="EZDSStringItem"/>
        <result property="dunsCmpySicDescTxt_B" column="DNB_COMPANY_SIC_DESCRIPTION" javaType="EZDSStringItem"/>
    </resultMap>
    <!-- CSA-QC#14832 Add Start -->
    <statement id="countDuplicateFilter" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(LIST.DUNS_TRX_HDR_PK) AS CNT 
        FROM (
                SELECT
                    DTH.DUNS_TRX_HDR_PK AS DUNS_TRX_HDR_PK
                    , LISTAGG(DTC.DUNS_CRIT_CD , ',') WITHIN GROUP (ORDER BY DTC.DUNS_CRIT_CD) AS DUNS_CRIT_CD
                FROM
                    DUNS_TRX_HDR DTH 
                    , DUNS_TRX_CRIT DTC
                WHERE
                    DTH.DUNS_PROC_TP_CD  = #dunsProcStsCd10#
                AND DTH.DUNS_PROC_STS_CD &lt; #dunsProcStsCd90#
                AND DTH.GLBL_CMPY_CD     = #glblCmpyCd#
                AND DTH.EZCANCELFLAG     = '0' 

                AND DTH.DUNS_TRX_HDR_PK  = DTC.DUNS_TRX_HDR_PK
                AND DTH.GLBL_CMPY_CD     = DTC.GLBL_CMPY_CD 
                AND DTH.EZCANCELFLAG     = DTC.EZCANCELFLAG 

                AND NOT EXISTS (SELECT 1 FROM DUNS_TRX_FILE DTF 
                                WHERE DTF.GLBL_CMPY_CD = DTH.GLBL_CMPY_CD
                                AND DTF.EZCANCELFLAG = DTH.EZCANCELFLAG
                                AND DTF.DUNS_TRX_HDR_PK = DTH.DUNS_TRX_HDR_PK)
                GROUP BY DTH.DUNS_TRX_HDR_PK ) LIST
        WHERE LIST.DUNS_CRIT_CD = #dunsCritId#
    </statement>
    <!-- CSA-QC#14832 Add End -->
</sqlMap>
