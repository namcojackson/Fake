<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAB119001">

    <statement id="getTrgtDtRec" parameterClass="Map" resultClass="BigDecimal">
        SELECT COUNT(1)
        FROM
            DMN_SLS_ORG              ORG
        WHERE 
            ORG.GLBL_CMPY_CD         = #glblCmpyCd#
        AND ORG.DWH_TRGT_DT          = #trgtDt#
        AND ORG.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getMainData" parameterClass="Map" resultClass="Map">
        SELECT
            SP.PSN_CD                           AS PSN_CD
           ,OFA.TOC_CD                          AS TOC_CD
           ,SP.PSN_NUM                          AS PSN_NUM
           ,SP.PSN_FIRST_NM                     AS PSN_FIRST_NM
           ,SP.PSN_LAST_NM                      AS PSN_LAST_NM
           ,SP.EFF_FROM_DT                      AS RESRC_EFF_FROM_DT
           ,SP.EFF_THRU_DT                      AS RESRC_EFF_THRU_DT
           ,SP.HR_SUPV_ID                       AS HR_SUPV_ID
           ,SP.HR_SUPV_NM                       AS HR_SUPV_NM
           ,DORR.REV_ACCT_TP_CD                 AS REV_ACCT_TP_CD
           ,RAT.REV_ACCT_TP_DESC_TXT            AS REV_ACCT_TP_DESC_TXT
           ,DORR.COA_CMPY_CD                    AS COA_CMPY_CD
           ,CCM.COA_CMPY_DESC_TXT               AS COA_CMPY_DESC_TXT
           ,DORR.COA_EXTN_CD                    AS COA_EXTN_CD
           ,CE.COA_EXTN_DESC_TXT                AS COA_EXTN_DESC_TXT
           ,DORR.COA_BR_CD                      AS COA_BR_CD
           ,CB.COA_BR_DESC_TXT                  AS COA_BR_DESC_TXT
           ,DORR.COA_CC_CD                      AS COA_CC_CD
           ,CC.COA_CC_DESC_TXT                  AS COA_CC_DESC_TXT
           ,DORR.EFF_FROM_DT                    AS RESRC_REV_EFF_FROM_DT
           ,DORR.EFF_THRU_DT                    AS RESRC_REV_EFF_THRU_DT
           ,TOMI.FIRST_ORG_MGR_PSN_CD           AS FIRST_ORG_MGR_PSN_CD
           ,TOMI.FIRST_ORG_MGR_TOC_CD           AS FIRST_ORG_MGR_TOC_CD
           ,TOMI.FIRST_ORG_MGR_FIRST_NM         AS FIRST_ORG_MGR_FIRST_NM
           ,TOMI.FIRST_ORG_MGR_LAST_NM          AS FIRST_ORG_MGR_LAST_NM
           ,TOMI.SCD_ORG_MGR_PSN_CD             AS SCD_ORG_MGR_PSN_CD
           ,TOMI.SCD_ORG_MGR_TOC_CD             AS SCD_ORG_MGR_TOC_CD
           ,TOMI.SCD_ORG_MGR_FIRST_NM           AS SCD_ORG_MGR_FIRST_NM
           ,TOMI.SCD_ORG_MGR_LAST_NM            AS SCD_ORG_MGR_LAST_NM
           ,TOMI.THIRD_ORG_MGR_PSN_CD           AS THIRD_ORG_MGR_PSN_CD
           ,TOMI.THIRD_ORG_MGR_TOC_CD           AS THIRD_ORG_MGR_TOC_CD
           ,TOMI.THIRD_ORG_MGR_FIRST_NM         AS THIRD_ORG_MGR_FIRST_NM
           ,TOMI.THIRD_ORG_MGR_LAST_NM          AS THIRD_ORG_MGR_LAST_NM
           ,TOMI.FRTH_ORG_MGR_PSN_CD            AS FRTH_ORG_MGR_PSN_CD
           ,TOMI.FRTH_ORG_MGR_TOC_CD            AS FRTH_ORG_MGR_TOC_CD
           ,TOMI.FRTH_ORG_MGR_FIRST_NM          AS FRTH_ORG_MGR_FIRST_NM
           ,TOMI.FRTH_ORG_MGR_LAST_NM           AS FRTH_ORG_MGR_LAST_NM
           ,TOMI.FIFTH_ORG_MGR_PSN_CD           AS FIFTH_ORG_MGR_PSN_CD
           ,TOMI.FIFTH_ORG_MGR_TOC_CD           AS FIFTH_ORG_MGR_TOC_CD
           ,TOMI.FIFTH_ORG_MGR_FIRST_NM         AS FIFTH_ORG_MGR_FIRST_NM
           ,TOMI.FIFTH_ORG_MGR_LAST_NM          AS FIFTH_ORG_MGR_LAST_NM
           ,TOMI.SIXTH_ORG_MGR_PSN_CD           AS SIXTH_ORG_MGR_PSN_CD
           ,TOMI.SIXTH_ORG_MGR_TOC_CD           AS SIXTH_ORG_MGR_TOC_CD
           ,TOMI.SIXTH_ORG_MGR_FIRST_NM         AS SIXTH_ORG_MGR_FIRST_NM
           ,TOMI.SIXTH_ORG_MGR_LAST_NM          AS SIXTH_ORG_MGR_LAST_NM
           ,TOMI.SVNTH_ORG_MGR_PSN_CD           AS SVNTH_ORG_MGR_PSN_CD
           ,TOMI.SVNTH_ORG_MGR_TOC_CD           AS SVNTH_ORG_MGR_TOC_CD
           ,TOMI.SVNTH_ORG_MGR_FIRST_NM         AS SVNTH_ORG_MGR_FIRST_NM
           ,TOMI.SVNTH_ORG_MGR_LAST_NM          AS SVNTH_ORG_MGR_LAST_NM
           ,TOMI.EIGHTH_ORG_MGR_PSN_CD          AS EIGHTH_ORG_MGR_PSN_CD
           ,TOMI.EIGHTH_ORG_MGR_TOC_CD          AS EIGHTH_ORG_MGR_TOC_CD
           ,TOMI.EIGHTH_ORG_MGR_FIRST_NM        AS EIGHTH_ORG_MGR_FIRST_NM
           ,TOMI.EIGHTH_ORG_MGR_LAST_NM         AS EIGHTH_ORG_MGR_LAST_NM
           ,TOMI.NINTH_ORG_MGR_PSN_CD           AS NINTH_ORG_MGR_PSN_CD
           ,TOMI.NINTH_ORG_MGR_TOC_CD           AS NINTH_ORG_MGR_TOC_CD
           ,TOMI.NINTH_ORG_MGR_FIRST_NM         AS NINTH_ORG_MGR_FIRST_NM
           ,TOMI.NINTH_ORG_MGR_LAST_NM          AS NINTH_ORG_MGR_LAST_NM
           ,TOMI.TENTH_ORG_MGR_PSN_CD           AS TENTH_ORG_MGR_PSN_CD
           ,TOMI.TENTH_ORG_MGR_TOC_CD           AS TENTH_ORG_MGR_TOC_CD
           ,TOMI.TENTH_ORG_MGR_FIRST_NM         AS TENTH_ORG_MGR_FIRST_NM
           ,TOMI.TENTH_ORG_MGR_LAST_NM          AS TENTH_ORG_MGR_LAST_NM
           ,TOMI.ELVTH_ORG_MGR_PSN_CD           AS ELVTH_ORG_MGR_PSN_CD
           ,TOMI.ELVTH_ORG_MGR_TOC_CD           AS ELVTH_ORG_MGR_TOC_CD
           ,TOMI.ELVTH_ORG_MGR_FIRST_NM         AS ELVTH_ORG_MGR_FIRST_NM
           ,TOMI.ELVTH_ORG_MGR_LAST_NM          AS ELVTH_ORG_MGR_LAST_NM
           ,OFA.EFF_FROM_DT                     AS RESRC_ASG_EFF_FROM_DT
           ,OFA.EFF_THRU_DT                     AS RESRC_ASG_EFF_THRU_DT
           ,SO.FIRST_ORG_CD                     AS FIRST_ORG_CD
           ,SO.FIRST_ORG_NM                     AS FIRST_ORG_NM
           ,SO.SCD_ORG_CD                       AS SCD_ORG_CD
           ,SO.SCD_ORG_NM                       AS SCD_ORG_NM
           ,SO.THIRD_ORG_CD                     AS THIRD_ORG_CD
           ,SO.THIRD_ORG_NM                     AS THIRD_ORG_NM
           ,SO.FRTH_ORG_CD                      AS FRTH_ORG_CD
           ,SO.FRTH_ORG_NM                      AS FRTH_ORG_NM
           ,SO.FIFTH_ORG_CD                     AS FIFTH_ORG_CD
           ,SO.FIFTH_ORG_NM                     AS FIFTH_ORG_NM
           ,SO.SIXTH_ORG_CD                     AS SIXTH_ORG_CD
           ,SO.SIXTH_ORG_NM                     AS SIXTH_ORG_NM
           ,SO.SVNTH_ORG_CD                     AS SVNTH_ORG_CD
           ,SO.SVNTH_ORG_NM                     AS SVNTH_ORG_NM
           ,SO.EIGHTH_ORG_CD                    AS EIGHTH_ORG_CD
           ,SO.EIGHTH_ORG_NM                    AS EIGHTH_ORG_NM
           ,SO.NINTH_ORG_CD                     AS NINTH_ORG_CD
           ,SO.NINTH_ORG_NM                     AS NINTH_ORG_NM
           ,SO.TENTH_ORG_CD                     AS TENTH_ORG_CD
           ,SO.TENTH_ORG_NM                     AS TENTH_ORG_NM
           ,SO.ELVTH_ORG_CD                     AS ELVTH_ORG_CD
           ,SO.ELVTH_ORG_NM                     AS ELVTH_ORG_NM
           ,SO.FIRST_ORG_TIER_CD                AS FIRST_ORG_TIER_CD
           ,SO.SCD_ORG_TIER_CD                  AS SCD_ORG_TIER_CD
           ,SO.THIRD_ORG_TIER_CD                AS THIRD_ORG_TIER_CD
           ,SO.FRTH_ORG_TIER_CD                 AS FRTH_ORG_TIER_CD
           ,SO.FIFTH_ORG_TIER_CD                AS FIFTH_ORG_TIER_CD
           ,SO.SIXTH_ORG_TIER_CD                AS SIXTH_ORG_TIER_CD
           ,SO.SVNTH_ORG_TIER_CD                AS SVNTH_ORG_TIER_CD
           ,SO.EIGHTH_ORG_TIER_CD               AS EIGHTH_ORG_TIER_CD
           ,SO.NINTH_ORG_TIER_CD                AS NINTH_ORG_TIER_CD
           ,SO.TENTH_ORG_TIER_CD                AS TENTH_ORG_TIER_CD
           ,SO.ELVTH_ORG_TIER_CD                AS ELVTH_ORG_TIER_CD
        FROM
            S21_PSN                             SP
           ,ORG_FUNC_ASG                        OFA
           ,TOC_ORG_MGR_INFO                    TOMI
           ,S21_ORG                             SO
           ,DS_ORG_RESRC_REV                    DORR
           ,REV_ACCT_TP                         RAT
           ,COA_CMPY                            CCM
           ,COA_EXTN                            CE
           ,COA_BR                              CB
           ,COA_CC                              CC
        WHERE
            SP.GLBL_CMPY_CD                   = #glblCmpyCd#
        AND SP.DEL_FLG                        = 'N'
        AND SP.GLBL_CMPY_CD                   = DORR.GLBL_CMPY_CD(+)
        AND SP.PSN_CD                         = DORR.PSN_CD
        AND DORR.EFF_FROM_DT              &lt;= #trgtDt#
        AND (DORR.EFF_THRU_DT             &gt;= #trgtDt#
        OR   DORR.EFF_THRU_DT IS NULL)
        AND DORR.GLBL_CMPY_CD                 = RAT.GLBL_CMPY_CD(+)
        AND DORR.REV_ACCT_TP_CD               = RAT.REV_ACCT_TP_CD(+)
        AND RAT.REV_COA_FLG(+)                = 'Y'
        AND DORR.GLBL_CMPY_CD                 = CCM.GLBL_CMPY_CD(+)
        AND DORR.COA_CMPY_CD                  = CCM.COA_CMPY_CD(+)
        AND DORR.GLBL_CMPY_CD                 = CE.GLBL_CMPY_CD(+)
        AND DORR.COA_EXTN_CD                  = CE.COA_EXTN_CD(+)
        AND DORR.GLBL_CMPY_CD                 = CB.GLBL_CMPY_CD(+)
        AND DORR.COA_BR_CD                    = CB.COA_BR_CD(+)
        AND DORR.GLBL_CMPY_CD                 = CC.GLBL_CMPY_CD(+)
        AND DORR.COA_CC_CD                    = CC.COA_CC_CD(+)
        AND SP.GLBL_CMPY_CD                   = OFA.GLBL_CMPY_CD(+)
        AND SP.PSN_CD                         = OFA.PSN_CD(+)
        AND OFA.GLBL_CMPY_CD                  = TOMI.GLBL_CMPY_CD(+)
        AND OFA.PSN_CD                        = TOMI.PSN_CD(+)
        AND OFA.TOC_CD                        = TOMI.TOC_CD(+)
        AND OFA.EFF_FROM_DT                   = TOMI.EFF_FROM_DT(+)
        AND TOMI.ORG_STRU_TP_CD(+)            = #bos#
        AND TOMI.FIRST_ORG_CD(+)              = #sales#
        AND OFA.GLBL_CMPY_CD                  = SO.GLBL_CMPY_CD(+)
        AND OFA.TOC_CD                        = SO.TOC_CD(+)
        AND OFA.GNRN_TP_CD                    IN (#past#, #current#, #future#)
        AND SO.FIRST_ORG_CD(+)                = #sales#
        AND SP.EZCANCELFLAG                   = '0'
        AND OFA.EZCANCELFLAG(+)               = '0'
        AND TOMI.EZCANCELFLAG(+)              = '0'
        AND SO.EZCANCELFLAG(+)                = '0'
        AND DORR.EZCANCELFLAG(+)              = '0'
        AND RAT.EZCANCELFLAG(+)               = '0'
        AND CCM.EZCANCELFLAG(+)               = '0'
        AND CE.EZCANCELFLAG(+)                = '0'
        AND CB.EZCANCELFLAG(+)                = '0'
        AND CC.EZCANCELFLAG(+)                = '0'
    </statement>

</sqlMap>
