<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWZC004001">

	<typeAlias alias="HLDTMsg" type="business.db.HLDTMsg"/>
    <typeAlias alias="DS_CPO_RTRN_DTLTMsg" type="business.db.DS_CPO_RTRN_DTLTMsg"/><!-- 20160107 S21_NA#2588 Add -->

    <statement id="getHldProcDfnList" parameterClass="Map">
		SELECT 
		    HR.HLD_RSN_CD
		  , HR.HLD_RSN_NM
		  , HR.HLD_LVL_CD
		  , HR.EX_REQ_FLG
		  
		FROM
		    HLD_RSN       HR
		  , HLD_PROC_DFN  HPD
		  
		WHERE
		      HR.GLBL_CMPY_CD  = #glblCmpyCd#
		  AND HR.EZCANCELFLAG  = '0'
		  
		  AND HPD.GLBL_CMPY_CD = HR.GLBL_CMPY_CD
		  AND HPD.HLD_RSN_CD   = HR.HLD_RSN_CD
		  AND HPD.EZCANCELFLAG = '0'
		  
		  <isEqual property="hldDfnChkPnt" compareValue="1">
		  AND HPD.CHK_PNT_ORD_VLD_FLG    = 'Y'
		  </isEqual>
		  <isEqual property="hldDfnChkPnt" compareValue="2">
 		  AND HPD.CHK_PNT_SOFT_ALLOC_FLG = 'Y'
		  </isEqual>
		  <isEqual property="hldDfnChkPnt" compareValue="3">
		  AND HPD.CHK_PNT_SHPG_VLD_FLG   = 'Y'
		  </isEqual>
		  <isEqual property="hldDfnChkPnt" compareValue="4">
		  AND HPD.CHK_PNT_SO_CANC_FLG    = 'Y'
		  </isEqual>
		  <isEqual property="hldDfnChkPnt" compareValue="5">
		  AND HPD.CHK_PNT_CR_CHK_FLG     = 'Y'
		  </isEqual>
		  
		GROUP BY
		    HR.HLD_RSN_CD
		  , HR.HLD_RSN_NM
		  , HR.HLD_LVL_CD
		  , HR.EX_REQ_FLG
		  , HR.WF_HLD_SORT_NUM
		ORDER BY
		    <!-- 2018/01/18 QC#22737-2 add start -->
		    HR.WF_HLD_SORT_NUM
		    <!-- 2018/01/18 QC#22737-2 add end -->
		  , HR.HLD_LVL_CD
		  , HR.HLD_RSN_CD
    </statement>


    <statement id="getApplyOrdTpList" parameterClass="Map" resultClass="String">
		SELECT
		    HR.HLD_RSN_CD || '.' || HCOS.APPLY_ORD_SRC_TP_CD || '.' || HCOT.APPLY_ORD_TP_CD || '.' || HPD.WH_TP_CD
		  
		FROM
		    HLD_RSN          HR
		  , HLD_PROC_DFN     HPD
		  , HLD_CTRL_ORD_SRC HCOS
		  , HLD_CTRL_ORD_TP  HCOT
<!-- START ADD S.Yamamoto [OM004] -->
		  , DS_HLD_CTRL_ORD_TP  DHCOT
<!-- END   ADD S.Yamamoto [OM004] -->
		  
		WHERE
		      HR.GLBL_CMPY_CD  = #glblCmpyCd#
		  AND HR.EZCANCELFLAG  = '0'
		  
		  AND HPD.GLBL_CMPY_CD = HR.GLBL_CMPY_CD
		  AND HPD.HLD_RSN_CD   = HR.HLD_RSN_CD
		  AND HPD.EZCANCELFLAG = '0'
		  
		  <isEqual property="hldDfnChkPnt" compareValue="1">
		  AND HPD.CHK_PNT_ORD_VLD_FLG    = 'Y'
		  </isEqual>
		  <isEqual property="hldDfnChkPnt" compareValue="2">
 		  AND HPD.CHK_PNT_SOFT_ALLOC_FLG = 'Y'
		  </isEqual>
		  <isEqual property="hldDfnChkPnt" compareValue="3">
		  AND HPD.CHK_PNT_SHPG_VLD_FLG   = 'Y'
		  </isEqual>
		  <isEqual property="hldDfnChkPnt" compareValue="4">
		  AND HPD.CHK_PNT_SO_CANC_FLG    = 'Y'
		  </isEqual>
		  <isEqual property="hldDfnChkPnt" compareValue="5">
		  AND HPD.CHK_PNT_CR_CHK_FLG     = 'Y'
		  </isEqual>

		  AND HCOS.GLBL_CMPY_CD = HR.GLBL_CMPY_CD
		  AND HCOS.HLD_RSN_CD   = HR.HLD_RSN_CD
		  AND HCOS.EZCANCELFLAG = '0'

		  AND HCOT.GLBL_CMPY_CD = HR.GLBL_CMPY_CD
		  AND HCOT.HLD_RSN_CD   = HR.HLD_RSN_CD
		  AND HCOT.EZCANCELFLAG = '0'
		  
<!-- START ADD S.Yamamoto [OM004] -->
		  AND DHCOT.GLBL_CMPY_CD       = HR.GLBL_CMPY_CD
		  AND DHCOT.HLD_RSN_CD         = HR.HLD_RSN_CD
		  AND DHCOT.APPLY_DS_ORD_TP_CD = #applyDsOrdTpCd#
		  AND DHCOT.EZCANCELFLAG       = '0'
<!-- END   ADD S.Yamamoto [OM004] -->

		GROUP BY
		    HR.HLD_RSN_CD || '.' || HCOS.APPLY_ORD_SRC_TP_CD || '.' || HCOT.APPLY_ORD_TP_CD || '.' || HPD.WH_TP_CD
		ORDER BY
		    HR.HLD_RSN_CD || '.' || HCOS.APPLY_ORD_SRC_TP_CD || '.' || HCOT.APPLY_ORD_TP_CD || '.' || HPD.WH_TP_CD
    </statement>
    
    
	<statement id="getHldCtrlOrgList" parameterClass="Map" resultClass="Map">
		SELECT 
			HLD_RSN_CD
		  , FIRST_ORG_CD
		  , SCD_ORG_CD
		  , THIRD_ORG_CD
		  , FRTH_ORG_CD
		  , FIFTH_ORG_CD    
		  , SIXTH_ORG_CD     
		  , SVNTH_ORG_CD     
		  , EIGHTH_ORG_CD  
		  , TOC_CD 
		
		FROM
		  HLD_CTRL_ORG
		
		WHERE
		      GLBL_CMPY_CD = #glblCmpyCd#
		  AND EZCANCELFLAG = '0'  
		
		GROUP BY
			HLD_RSN_CD
		  , FIRST_ORG_CD
		  , SCD_ORG_CD
		  , THIRD_ORG_CD
		  , FRTH_ORG_CD
		  , FIFTH_ORG_CD    
		  , SIXTH_ORG_CD     
		  , SVNTH_ORG_CD     
		  , EIGHTH_ORG_CD  
		  , TOC_CD 
		
		ORDER BY
		  HLD_RSN_CD
		, TOC_CD        NULLS LAST
		, EIGHTH_ORG_CD NULLS LAST
		, SVNTH_ORG_CD  NULLS LAST			
		, SIXTH_ORG_CD  NULLS LAST		
		, FIFTH_ORG_CD  NULLS LAST			
		, FRTH_ORG_CD   NULLS LAST		
		, THIRD_ORG_CD  NULLS LAST		
		, SCD_ORG_CD    NULLS LAST		       
		, FIRST_ORG_CD  NULLS LAST		
	</statement>


    <statement id="getHldOrderList" parameterClass="Map" resultClass="String">
		SELECT
		  CASE HR.HLD_LVL_CD
		    WHEN #hldLvl.cpo#     THEN HR.HLD_LVL_CD || '.' || H.CPO_ORD_NUM
		    WHEN #hldLvl.cpoDtl#  THEN HR.HLD_LVL_CD || '.' || H.CPO_ORD_NUM || '.' || H.CPO_DTL_LINE_NUM || '.' || H.CPO_DTL_LINE_SUB_NUM
		    WHEN #hldLvl.shpgPln# THEN HR.HLD_LVL_CD || '.' || H.CPO_ORD_NUM || '.' || H.CPO_DTL_LINE_NUM || '.' || H.CPO_DTL_LINE_SUB_NUM || '.' || H.SHPG_PLN_NUM
		  END HLD_ORD
		  
		FROM
		      HLD     H
		    , HLD_RSN HR
		    
		WHERE
		        H.GLBL_CMPY_CD  = #glblCmpyCd#
		    AND H.CPO_ORD_NUM   = #cpoOrdNum#
		    AND H.REL_FLG       = 'N'
		    AND (H.TRX_SRC_TP_CD IS NULL OR H.TRX_SRC_TP_CD &lt;&gt; #trxSrcTp# ) <!-- QC#11306 Add-->
		    AND H.EZCANCELFLAG  = '0'
		    
		    AND HR.GLBL_CMPY_CD = H.GLBL_CMPY_CD
		    AND HR.HLD_RSN_CD   = H.HLD_RSN_CD
		    AND HR.EZCANCELFLAG = '0'
    </statement>

    
    <statement id="getHldQtyInfoList" parameterClass="Map" resultClass="Map">
        SELECT
                HR.HLD_LVL_CD   HLD_LVL_CD
            ,   HR.HLD_TP_CD    HLD_TP_CD
            ,   MAX(HLD_QTY)	HLD_QTY

        FROM
                HLD     H
            ,   HLD_RSN	HR

        WHERE
                H.GLBL_CMPY_CD   = #glblCmpyCd#
            AND H.GLBL_CMPY_CD   = HR.GLBL_CMPY_CD
            AND H.HLD_RSN_CD     = HR.HLD_RSN_CD
            AND H.REL_FLG        = 'N'
<!-- 2016/9/26 UPD START  -->
			AND H.CPO_ORD_NUM    = #cpoOrdNum# 
            AND (
                 (      HR.HLD_LVL_CD          = #CPO_LEVEL#
              	)
              	
                OR (	HR.HLD_LVL_CD          = #CPO_DETAIL_LEVEL#
					AND H.CPO_DTL_LINE_NUM     = #cpoDtlLineNum#
					AND H.CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
                    AND (H.TRX_SRC_TP_CD IS NULL OR H.TRX_SRC_TP_CD &lt;&gt; #trxSrcTp# )  <!-- QC#11306 Add-->
	            )
                
                OR (	HR.HLD_LVL_CD          = #SHIPPING_PLAN_LEVEL#
					AND H.CPO_DTL_LINE_NUM     = #cpoDtlLineNum#
					AND H.CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
	            	AND H.SHPG_PLN_NUM         = #shpgPlnNum#
                )
            )
<!-- 2016/9/26 UPD END  -->
                
            AND H.EZCANCELFLAG  = '0'
            AND HR.EZCANCELFLAG = '0'

        GROUP BY
                HR.HLD_LVL_CD
            ,   HR.HLD_TP_CD

        ORDER BY
                HR.HLD_LVL_CD     DESC
            ,   HR.HLD_TP_CD
    </statement>

 
    <statement id="getHldCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
        	COUNT(*)

        FROM
        	  HLD_PROC_DFN	HPD
        	, HLD_RSN		HR
            , HLD			H

        WHERE
				HPD.GLBL_CMPY_CD           = #glblCmpyCd#
			AND HPD.EZCANCELFLAG           = '0'
	        <isEqual property="relPoint" compareValue="1">
            AND HPD.REL_PNT_SOFT_ALLOC_FLG = 'Y'
    	    </isEqual>
        	<isEqual property="relPoint" compareValue="2">
            AND HPD.REL_PNT_HARD_ALLOC_FLG = 'Y'
        	</isEqual>
        	<isEqual property="relPoint" compareValue="3">
            AND HPD.REL_PNT_CR_CHK_FLG     = 'Y'
        	</isEqual>
        	<isEqual property="relPoint" compareValue="4">
            AND HPD.REL_PNT_SO_CRAT_FLG    = 'Y'
        	</isEqual>
        	<isEqual property="relPoint" compareValue="5">
            AND HPD.REL_PNT_REV_FLG        = 'Y'
        	</isEqual>
        
			AND HR.GLBL_CMPY_CD = HPD.GLBL_CMPY_CD
			AND HR.HLD_RSN_CD   = HPD.HLD_RSN_CD
			AND HR.EZCANCELFLAG = '0'
			
			AND H.GLBL_CMPY_CD = HR.GLBL_CMPY_CD
			AND H.HLD_RSN_CD   = HR.HLD_RSN_CD
			AND H.EZCANCELFLAG = '0'
            AND H.REL_FLG      = #relFlg#

            AND (
                     (H.CPO_ORD_NUM          = #cpoOrdNum# 
                  AND HR.HLD_LVL_CD          = #hldLvl01#         )
        <isNotNull property="hldLvl02">
                OR   (H.CPO_ORD_NUM          = #cpoOrdNum#
                  AND H.CPO_DTL_LINE_NUM     = #cpoLineNum#
                  AND HR.HLD_LVL_CD          = #hldLvl02#         )
        </isNotNull>
        <isNotNull property="hldLvl03">
                OR   (H.CPO_ORD_NUM          = #cpoOrdNum#
                  AND H.CPO_DTL_LINE_NUM     = #cpoLineNum#
        		  <isNotNull property="cpoLineSubNum">
                  AND H.CPO_DTL_LINE_SUB_NUM = #cpoLineSubNum#
        		  </isNotNull>
        		  <isNotNull property="shpgPlnNum">
        		  AND H.SHPG_PLN_NUM         = #shpgPlnNum#
        		  </isNotNull>
                  AND HR.HLD_LVL_CD          = #hldLvl03#         )
        </isNotNull>
                )
            
            AND ROWNUM <![CDATA[ <= ]]> 1
    </statement>
 
<!-- WDS#110 START -->
     <statement id="getSlsHldCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
                COUNT(*)
          FROM 
                  HLD H
               ,  HLD_RSN      HR
               ,  HLD_PROC_DFN HPD
         WHERE 
                  H.GLBL_CMPY_CD           = #glblCmpyCd#
           AND    H.CPO_ORD_NUM            = #cpoOrdNum#
           AND    H.REL_FLG                = #relFlg#
           AND    H.GLBL_CMPY_CD           = HR.GLBL_CMPY_CD
           AND    H.HLD_RSN_CD             = HR.HLD_RSN_CD
           AND    H.GLBL_CMPY_CD           = HPD.GLBL_CMPY_CD
           AND    H.HLD_RSN_CD             = HPD.HLD_RSN_CD
           AND    HPD.REL_PNT_CR_CHK_FLG   = #relPntCrChkFlg#
           <!-- 2017/09/26 S21_NA#21279 Add Start -->
           AND    HR.HLD_LVL_CD            = #hldLvl01#
           AND    HPD.WH_TP_CD             = #whTpCdCommon#
           <!-- 2017/09/26 S21_NA#21279 Add End -->
<!-- WDS Defect#2548#2550 Delete -->
<!--           AND    (  (    HR.HLD_LVL_CD    = #hldLvl01#)
   AND HPD.WH_TP_CD     = #whTpCdCommon#)
                   OR(    HR.HLD_LVL_CD   != #hldLvl01#)
   AND HPD.WH_TP_CD     = #whTpCd#)
                  )-->
           AND    H.EZCANCELFLAG           = '0'
           AND    HR.EZCANCELFLAG          = '0'
           AND    HPD.EZCANCELFLAG         = '0'
    </statement>
<!-- WDS#110 E N D -->

    <!-- 2017/09/26 S21_NA#21279 Add Start -->
     <statement id="getDtlSlsHldCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
                COUNT(*)
          FROM 
                  HLD H
               ,  HLD_RSN      HR
               ,  HLD_PROC_DFN HPD
         WHERE 
                  H.GLBL_CMPY_CD           = #glblCmpyCd#
           AND    H.CPO_ORD_NUM            = #cpoOrdNum#
           AND    (
                    (
                              H.CPO_DTL_LINE_NUM       = #cpoDtlLineNum#
                       AND    H.CPO_DTL_LINE_SUB_NUM   = #cpoDtlLineSubNum#
                       AND    HR.HLD_LVL_CD            = #hldLvl02#
                    )
                    OR (
                              H.CPO_DTL_LINE_NUM       = #cpoDtlLineNum#
                       AND    H.CPO_DTL_LINE_SUB_NUM   = #setItemParentNum#
                       AND    HR.HLD_LVL_CD            = #hldLvl02#
                    )
                    OR (
                              H.SHPG_PLN_NUM           = #shpgPlnNum#
                       AND    HR.HLD_LVL_CD            = #hldLvl03#
                    )
                  )
           AND    H.REL_FLG                = #relFlg#
           AND    H.GLBL_CMPY_CD           = HR.GLBL_CMPY_CD
           AND    H.HLD_RSN_CD             = HR.HLD_RSN_CD
           AND    H.GLBL_CMPY_CD           = HPD.GLBL_CMPY_CD
           AND    H.HLD_RSN_CD             = HPD.HLD_RSN_CD
           AND    HPD.REL_PNT_CR_CHK_FLG   = #relPntCrChkFlg#
           AND    HPD.WH_TP_CD             = #whTpCd#
           AND    H.EZCANCELFLAG           = '0'
           AND    HR.EZCANCELFLAG          = '0'
           AND    HPD.EZCANCELFLAG         = '0'
    </statement>
    <!-- 2017/09/26 S21_NA#21279 Add End -->

 	<statement id="getHldSetCompCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
        	COUNT(*)

        FROM
        	  HLD_PROC_DFN	HPD
        	, HLD_RSN		HR
            , HLD			H

        WHERE
				HPD.GLBL_CMPY_CD           = #glblCmpyCd#
			AND HPD.EZCANCELFLAG           = '0'
	        <isEqual property="relPoint" compareValue="1">
            AND HPD.REL_PNT_SOFT_ALLOC_FLG = 'Y'
    	    </isEqual>
        	<isEqual property="relPoint" compareValue="2">
            AND HPD.REL_PNT_HARD_ALLOC_FLG = 'Y'
        	</isEqual>
        	<isEqual property="relPoint" compareValue="3">
            AND HPD.REL_PNT_CR_CHK_FLG     = 'Y'
        	</isEqual>
        	<isEqual property="relPoint" compareValue="4">
            AND HPD.REL_PNT_SO_CRAT_FLG    = 'Y'
        	</isEqual>
        	<isEqual property="relPoint" compareValue="5">
            AND HPD.REL_PNT_REV_FLG        = 'Y'
        	</isEqual>
        
			AND HR.GLBL_CMPY_CD = HPD.GLBL_CMPY_CD
			AND HR.HLD_RSN_CD   = HPD.HLD_RSN_CD
			AND HR.EZCANCELFLAG = '0'
			
			AND H.GLBL_CMPY_CD = HR.GLBL_CMPY_CD
			AND H.HLD_RSN_CD   = HR.HLD_RSN_CD
			AND H.EZCANCELFLAG = '0'
            AND H.REL_FLG      = #relFlg#

            AND (
                     (H.CPO_ORD_NUM          = #cpoOrdNum# 
                  AND HR.HLD_LVL_CD          = #hldLvl01#         )
        <isNotNull property="hldLvl02">
                OR   (H.CPO_ORD_NUM          = #cpoOrdNum#
                  AND H.CPO_DTL_LINE_NUM     = #cpoLineNum#
                  AND ( H.TRX_SRC_TP_CD IS NULL OR H.TRX_SRC_TP_CD &lt;&gt; #trxSrcTp# )  <!-- QC#11306 Add-->
                  AND HR.HLD_LVL_CD          = #hldLvl02#         )
        </isNotNull>
        <isNotNull property="hldLvl03">
                OR   (H.CPO_ORD_NUM          = #cpoOrdNum#
                  AND H.CPO_DTL_LINE_NUM     = #cpoLineNum#
 				  AND H.SHPG_PLN_NUM           IN
                	(
		                 SELECT SP.SHPG_PLN_NUM
		                 FROM 
		                       SHPG_PLN SP
		                 WHERE
		                         SP.GLBL_CMPY_CD           = #glblCmpyCd#
		                     AND (   SP.SET_SHPG_PLN_NUM   = #shpgPlnNum#
		                     	  OR SP.SHPG_PLN_NUM 	   = #shpgPlnNum#
		                     	  )
		                     AND SP.EZCANCELFLAG 		   = '0'
	                 )    
                  AND HR.HLD_LVL_CD          = #hldLvl03#         )
        </isNotNull>
                )
            
            AND ROWNUM <![CDATA[ <= ]]> 1
    </statement>
 
 
    <statement id="getHldCntByShipCplt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                COUNT(DISTINCT H.HLD_PK) COUNT
        FROM
                HLD H
            ,   HLD_RSN HR
            ,   HLD_PROC_DFN HPD
            ,  (SELECT
                      GLBL_CMPY_CD
                    , TRX_HDR_NUM
                    , TRX_LINE_NUM
                    , TRX_LINE_SUB_NUM
                    , SHPG_PLN_NUM
                FROM
                      SHPG_PLN
                WHERE
                      GLBL_CMPY_CD  = #glblCmpyCd#
                  AND TRX_HDR_NUM   = #trxHdrNum#
                  AND SHIP_CPLT_CD  = #shipCpltCd# 
                  AND TRX_SRC_TP_CD = #trxSrcTpCd#
                  AND EZCANCELFLAG  = '0'
               ) S
        WHERE
                H.GLBL_CMPY_CD           = #glblCmpyCd#
            AND H.GLBL_CMPY_CD           = HR.GLBL_CMPY_CD
            AND H.HLD_RSN_CD             = HR.HLD_RSN_CD
            AND H.GLBL_CMPY_CD           = HPD.GLBL_CMPY_CD
            AND H.HLD_RSN_CD             = HPD.HLD_RSN_CD
        <isEqual property="RelPnt" compareValue="3">
            AND HPD.REL_PNT_CR_CHK_FLG   = #RelPntFlg#
        </isEqual>
        <isEqual property="RelPnt" compareValue="4">
            AND HPD.REL_PNT_SO_CRAT_FLG  = #RelPntFlg#
        </isEqual>
            AND H.GLBL_CMPY_CD           = S.GLBL_CMPY_CD
            AND H.REL_FLG                = #relFlg#
            AND (
                     (H.CPO_ORD_NUM          = S.TRX_HDR_NUM 
                  AND HR.HLD_LVL_CD          = #hldLvl01#         )
                OR   (H.CPO_ORD_NUM          = S.TRX_HDR_NUM
                  AND H.CPO_DTL_LINE_NUM     = S.TRX_LINE_NUM
                  AND H.CPO_DTL_LINE_SUB_NUM = S.TRX_LINE_SUB_NUM
                  AND HR.HLD_LVL_CD          = #hldLvl02#         )
                OR   (H.SHPG_PLN_NUM         = S.SHPG_PLN_NUM
                  AND HR.HLD_LVL_CD          = #hldLvl03#         )
                )
            AND H.EZCANCELFLAG           = '0'
            AND HR.EZCANCELFLAG          = '0'
            AND HPD.EZCANCELFLAG         = '0'
    </statement>
    

    <statement id="getCrChkOrderList" parameterClass="Map" resultClass="Map">
        SELECT
                C.GLBL_CMPY_CD             GLBL_CMPY_CD
            ,   C.CPO_ORD_NUM              CPO_ORD_NUM
            ,   CD.CPO_DTL_LINE_NUM        CPO_DTL_LINE_NUM
            ,   CD.CPO_DTL_LINE_SUB_NUM    CPO_DTL_LINE_SUB_NUM
            ,   S.TRX_SRC_TP_CD            TRX_SRC_TP_CD
            ,   S.SHPG_PLN_NUM             SHPG_PLN_NUM
            ,   C.PAYER_CUST_CD            PAYER_CUST_CD
            ,   C.CPO_SRC_TP_CD            CPO_SRC_TP_CD
            ,   C.CPO_ORD_TP_CD            C_CPO_ORD_TP_CD
            ,   CD.CPO_ORD_TP_CD           CD_CPO_ORD_TP_CD
            ,   CD.MDSE_CD                 CD_MDSE_CD
            ,   CD.INVTY_LOC_CD            CD_INVTY_LOC_CD
            ,   CD.ORD_QTY                 CD_ORD_QTY
            ,   S.SHPG_STS_CD              SHPG_STS_CD
            ,   S.MDSE_CD                  S_MDSE_CD
            ,   S.INVTY_LOC_CD             S_INVTY_LOC_CD
            ,   S.ORD_QTY                  S_ORD_QTY
            ,   S.PO_REQ_FLG               PO_REQ_FLG
            ,   S.CR_CHK_QTY               CR_CHK_QTY
            ,   S.SP_FUNC_NET_UNIT_PRC_AMT SP_FUNC_NET_UNIT_PRC_AMT
            ,   S.AVAL_SO_QTY              AVAL_SO_QTY
            ,   S.AVAL_PO_QTY              AVAL_PO_QTY
            ,   S.SET_SHPG_PLN_NUM         SET_SHPG_PLN_NUM
            ,   S.SET_MDSE_CD              SET_MDSE_CD
            ,   S.CR_HLD_QTY               CR_HLD_QTY
<!-- START ADD S.Yamamoto [OM004] -->
            ,   C.DS_ORD_TP_CD             DS_ORD_TP_CD
<!-- END   ADD S.Yamamoto [OM004] -->
<!-- START ADD S.Takami [S21_NA#1407] -->
            ,   CD.DS_CPO_CONFIG_PK        DS_CPO_CONFIG_PK
<!-- END   ADD S.Takami [S21_NA#1407] -->
        FROM
                CPO                 C
            ,   CPO_DTL             CD
            ,   SHPG_PLN            S
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
<!-- START ADD S.Yamamoto [OM004] -->
<!--             ,   DS_CPO              DC -->
<!-- END   ADD S.Yamamoto [OM004] -->
<!-- START ADD S.Takami [S21_NA#1407] -->
<!--             ,   DS_CPO_DTL          DCD -->
<!-- END   ADD S.Takami [S21_NA#1407] -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
        WHERE
                S.GLBL_CMPY_CD           = #glblCmpyCd#
        <isNotNull property="shpgPlnNum">
            AND S.SHPG_PLN_NUM           = #shpgPlnNum#
        </isNotNull>
        <isNotNull property="trxHdrNum">
            AND S.TRX_HDR_NUM            = #trxHdrNum#
        </isNotNull>
        <isNotNull property="trxLineNum">
            AND S.TRX_LINE_NUM           = #trxLineNum#
        </isNotNull>
        <isNotNull property="trxLineSubNum">
            AND S.TRX_LINE_SUB_NUM       = #trxLineSubNum#
        </isNotNull>
        <isNotNull property="shipCpltCd">
            AND S.SHIP_CPLT_CD           = #shipCpltCd#
        </isNotNull>
            AND S.TRX_SRC_TP_CD          = #trxSrcTpCd#
            AND S.GLBL_CMPY_CD           = CD.GLBL_CMPY_CD
            AND S.TRX_HDR_NUM            = CD.CPO_ORD_NUM
            AND S.TRX_LINE_NUM           = CD.CPO_DTL_LINE_NUM
            AND S.TRX_LINE_SUB_NUM       = CD.CPO_DTL_LINE_SUB_NUM
            AND CD.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND CD.CPO_ORD_NUM           = C.CPO_ORD_NUM
            AND C.EZCANCELFLAG           = '0'
            AND CD.EZCANCELFLAG          = '0' 
            AND S.EZCANCELFLAG           = '0' 
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
<!-- START ADD S.Yamamoto [OM004] -->
<!--             AND DC.GLBL_CMPY_CD          = C.GLBL_CMPY_CD -->
<!--             AND DC.CPO_ORD_NUM           = C.CPO_ORD_NUM -->
<!--             AND DC.EZCANCELFLAG          = '0' -->
<!-- END   ADD S.Yamamoto [OM004] -->
<!-- START ADD S.Takami [S21_NA#1407] -->
<!--             AND CD.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD -->
<!--             AND CD.CPO_ORD_NUM           = DCD.CPO_ORD_NUM -->
<!--             AND CD.CPO_DTL_LINE_NUM      = DCD.CPO_DTL_LINE_NUM -->
<!--             AND CD.CPO_DTL_LINE_SUB_NUM  = DCD.CPO_DTL_LINE_SUB_NUM -->
<!--             AND DCD.EZCANCELFLAG         = '0' --> 
<!-- END   ADD S.Takami [S21_NA#1407] -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del End -->
        ORDER BY
                S.SHPG_STS_CD DESC
            ,   S.TRX_HDR_NUM
            ,   S.TRX_LINE_NUM
            ,   S.TRX_LINE_SUB_NUM
            ,   S.SHPG_PLN_NUM
        <!-- Def#2025
        <isEqual property="wait" compareValue="0">
            FOR UPDATE NOWAIT
        </isEqual>
        <isEqual property="wait" compareValue="1">
            FOR UPDATE
        </isEqual> -->
    </statement>

    <statement id="getSetCrOrderRs" parameterClass="Map" resultClass="Map">
        SELECT
                C.GLBL_CMPY_CD             GLBL_CMPY_CD
            ,   C.CPO_ORD_NUM              CPO_ORD_NUM
            ,   CD.CPO_DTL_LINE_NUM        CPO_DTL_LINE_NUM
            ,   CD.CPO_DTL_LINE_SUB_NUM    CPO_DTL_LINE_SUB_NUM
            ,   S.SHPG_PLN_NUM             SHPG_PLN_NUM
            ,   S.TRX_SRC_TP_CD			   TRX_SRC_TP_CD
            ,   C.PAYER_CUST_CD            PAYER_CUST_CD
            ,   C.CPO_SRC_TP_CD            CPO_SRC_TP_CD
            ,   C.CPO_ORD_TP_CD            C_CPO_ORD_TP_CD
            ,   CD.CPO_ORD_TP_CD           CD_CPO_ORD_TP_CD
            ,   CD.MDSE_CD                 CD_MDSE_CD
            ,   CD.INVTY_LOC_CD            CD_INVTY_LOC_CD
            ,   CD.ORD_QTY                 CD_ORD_QTY
            ,   S.SHPG_STS_CD              SHPG_STS_CD
            ,   S.MDSE_CD                  S_MDSE_CD
            ,   S.INVTY_LOC_CD             S_INVTY_LOC_CD
            ,   S.ORD_QTY                  S_ORD_QTY
            ,   S.PO_REQ_FLG               PO_REQ_FLG
            ,   S.CR_CHK_QTY               CR_CHK_QTY
            ,   S.SP_FUNC_NET_UNIT_PRC_AMT SP_FUNC_NET_UNIT_PRC_AMT
            ,   S.AVAL_SO_QTY              AVAL_SO_QTY
            ,   S.AVAL_PO_QTY              AVAL_PO_QTY
            ,   S.CR_HLD_QTY               CR_HLD_QTY
            ,   S.SLS_HLD_QTY              SLS_HLD_QTY
            ,   S.SET_MDSE_CD			   SET_MDSE_CD
            ,   S.SET_SHPG_PLN_NUM		   SET_SHPG_PLN_NUM
        FROM
                CPO                 C
            ,   CPO_DTL             CD
            ,   SHPG_PLN            S
        WHERE
                S.GLBL_CMPY_CD           = #glblCmpyCd#
            AND S.TRX_SRC_TP_CD          = #trxSrcTpCd#
            AND S.TRX_HDR_NUM            = #trxHdrNum#
            AND S.TRX_LINE_NUM           = #trxLineNum#
            AND S.TRX_LINE_SUB_NUM       = #trxLineSubNum#
            AND S.TRX_HDR_NUM            = CD.CPO_ORD_NUM
            AND S.TRX_LINE_NUM           = CD.CPO_DTL_LINE_NUM
            AND S.TRX_LINE_SUB_NUM       = CD.CPO_DTL_LINE_SUB_NUM
            AND S.TRX_HDR_NUM            = C.CPO_ORD_NUM
            AND S.SHPG_PLN_NUM           NOT IN
                (
                 SELECT H.SHPG_PLN_NUM
                 FROM 
                         HLD          H
                     ,   HLD_RSN      HR
                     ,   HLD_PROC_DFN HPD
                 WHERE
                         H.GLBL_CMPY_CD           = #glblCmpyCd#
                     AND H.CPO_ORD_NUM            = #trxHdrNum#
                     AND H.CPO_DTL_LINE_NUM       = #trxLineNum#
                     AND H.CPO_DTL_LINE_SUB_NUM   = #trxLineSubNum#
                     AND H.GLBL_CMPY_CD           = HR.GLBL_CMPY_CD
                     AND H.HLD_RSN_CD             = HR.HLD_RSN_CD
                     AND H.GLBL_CMPY_CD           = HPD.GLBL_CMPY_CD
                     AND H.HLD_RSN_CD             = HPD.HLD_RSN_CD
                 <isEqual property="relPoint" compareValue="1">
                     AND HPD.REL_PNT_SOFT_ALLOC_FLG = 'Y'
                 </isEqual>
                 <isEqual property="relPoint" compareValue="2">
                     AND HPD.REL_PNT_HARD_ALLOC_FLG = 'Y'
                 </isEqual>
                 <isEqual property="relPoint" compareValue="3">
                     AND HPD.REL_PNT_CR_CHK_FLG     = 'Y'
                 </isEqual>
                 <isEqual property="relPoint" compareValue="4">
                     AND HPD.REL_PNT_SO_CRAT_FLG    = 'Y'
                 </isEqual>
                 <isEqual property="relPoint" compareValue="5">
                     AND HPD.REL_PNT_REV_FLG        = 'Y'
                 </isEqual>
                     AND H.REL_FLG                = #relFlg#
                     AND HR.HLD_LVL_CD            = #hldLvl03#
                     AND H.EZCANCELFLAG           = '0'
                     AND HR.EZCANCELFLAG          = '0' 
                     AND HPD.EZCANCELFLAG         = '0' 
                )
            AND C.EZCANCELFLAG           = '0'
            AND CD.EZCANCELFLAG          = '0'
            AND S.EZCANCELFLAG           = '0'
        ORDER BY
                S.SHPG_STS_CD DESC
            ,   S.TRX_HDR_NUM
            ,   S.TRX_LINE_NUM
            ,   S.TRX_LINE_SUB_NUM
            ,   S.SHPG_PLN_NUM
        <!-- Def#2025
        <isEqual property="wait" compareValue="0">
            FOR UPDATE NOWAIT
        </isEqual>
        <isEqual property="wait" compareValue="1">
            FOR UPDATE
        </isEqual> -->
    </statement>

    <statement id="getCrChkQty" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                <!-- SUM(S.CR_CHK_QTY)          CR_CHK_QTY -->
                DECODE(SUM(S.CR_CHK_QTY), 0, SUM(S.CR_HLD_QTY), SUM(S.CR_CHK_QTY)) CR_CHK_QTY
        FROM
                SHPG_PLN            S
        WHERE
                S.GLBL_CMPY_CD           = #glblCmpyCd#
            AND S.TRX_HDR_NUM            = #trxHdrNum#
            AND S.TRX_LINE_NUM           = #trxLineNum#
            AND S.TRX_LINE_SUB_NUM       = #trxLineSubNum#
            AND S.TRX_SRC_TP_CD          = #trxSrcTpCd#
            AND S.EZCANCELFLAG           = '0' 
    </statement>


    <statement id="getOrderList" parameterClass="Map" resultClass="Map">
        SELECT
                C.GLBL_CMPY_CD                  GLBL_CMPY_CD
            ,   C.CPO_ORD_NUM                   CPO_ORD_NUM
            ,   CD.CPO_DTL_LINE_NUM             CPO_DTL_LINE_NUM
            ,   CD.CPO_DTL_LINE_SUB_NUM         CPO_DTL_LINE_SUB_NUM
            ,   S.TRX_SRC_TP_CD                 TRX_SRC_TP_CD
            ,   S.SHPG_PLN_NUM                  SHPG_PLN_NUM
            ,   C.PAYER_CUST_CD                 PAYER_CUST_CD
            ,   C.CPO_SRC_TP_CD                 CPO_SRC_TP_CD
            ,   C.CPO_ORD_TP_CD                 C_CPO_ORD_TP_CD
            ,   CD.CPO_ORD_TP_CD                CD_CPO_ORD_TP_CD
            ,   CD.MDSE_CD                      CD_MDSE_CD
            ,   CD.INVTY_LOC_CD                 CD_INVTY_LOC_CD
            ,   CD.ORD_QTY                      CD_ORD_QTY
            ,   S.SHPG_STS_CD                   SHPG_STS_CD
            ,   S.MDSE_CD                       S_MDSE_CD
            ,   S.INVTY_LOC_CD                  S_INVTY_LOC_CD
            ,   S.ORD_QTY                       S_ORD_QTY
            ,   S.CR_CHK_QTY                    CR_CHK_QTY
            ,   S.PO_REQ_FLG                    PO_REQ_FLG
            ,   CD.SET_MDSE_CD                  SET_MDSE_CD
            ,   S.SET_SHPG_PLN_NUM              SET_SHPG_PLN_NUM
            ,   CD.CPO_ORD_TS                   CPO_ORD_TS
            ,   S.CR_HLD_QTY                    CR_HLD_QTY
            ,   S.SHIP_CPLT_CD                  SHIP_CPLT_CD
<!-- START MODIFY S.Yamamoto [OM004] -->
            ,   C.DS_ORD_TP_CD                 DS_ORD_TP_CD
<!-- END   MODIFY S.Yamamoto [OM004] -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
<!--             ,   C.ADDL_CUST_INSTL_FLG          ADDL_CUST_INSTL_FLG -->
<!-- START 2013/02/25 S.Iidaka [WDSDefect#621 DEL] -->
<!--            ,   DC.CONTR_CMPL_NUM               CONTR_CMPL_NUM -->
<!-- E N D 2013/02/25 S.Iidaka [WDSDefect#621 DEL] -->
<!--             ,   C.CR_CARD_AUTH_DT              CR_CARD_AUTH_DT -->
<!--             ,   C.CR_CARD_AUTH_REF_NUM         CR_CARD_AUTH_REF_NUM -->
<!--             ,   C.CR_CARD_AUTH_STS_CD          CR_CARD_AUTH_STS_CD -->
<!--             ,   C.CR_CARD_CUST_REF_NUM         CR_CARD_CUST_REF_NUM -->
<!--             ,   C.CR_CARD_TP_CD                CR_CARD_TP_CD -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del End -->
            ,   C.DS_PMT_METH_CD               DS_PMT_METH_CD
            ,   C.INV_RCPNT_CUST_CD            INV_RCPNT_CUST_CD
<!-- START MODIFY S.Yamamoto [OM004] -->
            ,   C.DS_ORD_RSN_CD                DS_ORD_RSN_CD
<!-- END   MODIFY S.Yamamoto [OM004] -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
<!--             ,   C.SLCNF_TRX_NUM                SLCNF_TRX_NUM -->
<!--             ,   C.XREF_RMA_NUM                 XREF_RMA_NUM -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del End -->
            ,   C.BILL_TO_CUST_ACCT_CD         BILL_TO_CUST_ACCT_CD    <!-- 20150924 add -->
            ,   CD.SVC_CONFIG_MSTR_PK          SVC_CONFIG_MSTR_PK      <!-- 20150924 add -->
            ,   CD.DS_CPO_CONFIG_PK            DS_CPO_CONFIG_PK        <!-- 2015/12/03 S21_NA#1407 add -->
            ,   CD.CUST_ISTL_FLG               CUST_ISTL_FLG
            <!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
<!--             ,   CD.LGCY_INTFC_DS_CPO_LINE_NUM  LGCY_INTFC_DS_CPO_LINE_NUM -->
            <!-- 2017/03/29 S21_NA#Review structure Lv.1 Del End -->
            ,   M.INSTL_BASE_CTRL_FLG          INSTL_BASE_CTRL_FLG <!-- 2018/12/13 S21_NA#22488 add -->
            ,   M.INVTY_CTRL_FLG               INVTY_CTRL_FLG      <!-- 2018/12/13 S21_NA#22488 add -->
        FROM 
                CPO                 C
            ,   CPO_DTL             CD
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
<!--             ,   DS_CPO              DC -->
<!--             ,   DS_CPO_DTL          DCD -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del End -->
            ,   SHPG_PLN            S
            ,   ALL_MDSE_V           M   <!-- 2018/12/13 S21_NA#29488 add -->
        WHERE
                S.GLBL_CMPY_CD           = #glblCmpyCd#
        <isNotNull property="shpgPlnNum_I">
            AND S.SHPG_PLN_NUM           = #shpgPlnNum_I#
        </isNotNull>
        <isNotNull property="cpoOrdNum_I">
            AND S.TRX_HDR_NUM            = #cpoOrdNum_I#
        </isNotNull>
        <isNotNull property="cpoDtlLineNum_I">
            AND S.TRX_LINE_NUM           = #cpoDtlLineNum_I#
        </isNotNull>
        <isNotNull property="cpoDtlLineSubNum_I">
            AND S.TRX_LINE_SUB_NUM       = #cpoDtlLineSubNum_I#
        </isNotNull>
            AND S.TRX_SRC_TP_CD          = #trxSrcTpCd#
            AND CD.GLBL_CMPY_CD          = S.GLBL_CMPY_CD
            AND CD.CPO_ORD_NUM           = S.TRX_HDR_NUM
            AND CD.CPO_DTL_LINE_NUM      = S.TRX_LINE_NUM
            AND CD.CPO_DTL_LINE_SUB_NUM  = S.TRX_LINE_SUB_NUM
        <!-- 2023/06/20 QC#61556 START -->
        <isNotNull property="ordLineCancelled">
            <!-- START 2023/03/23 A.Cullano [QC#61328, ADD] -->
            AND CD.ORD_LINE_STS_CD       &lt;&gt; #ordLineCancelled#
            <!-- END 2023/03/23 A.Cullano [QC#61328, ADD] -->
        </isNotNull>
        <!-- 2023/06/20 QC#61556 END -->
            AND C.GLBL_CMPY_CD           = CD.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM            = CD.CPO_ORD_NUM
            AND S.GLBL_CMPY_CD           = M.GLBL_CMPY_CD <!-- 2018/12/13 S21_NA#29488 add -->
            AND S.MDSE_CD                = M.MDSE_CD      <!-- 2018/12/13 S21_NA#29488 add -->
            AND M.EZCANCELFLAG           = '0'            <!-- 2018/12/13 S21_NA#29488 add -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
<!--             AND DCD.GLBL_CMPY_CD         = S.GLBL_CMPY_CD -->
<!--             AND DCD.CPO_ORD_NUM          = S.TRX_HDR_NUM -->
<!--             AND DCD.CPO_DTL_LINE_NUM     = S.TRX_LINE_NUM -->
<!--             AND DCD.CPO_DTL_LINE_SUB_NUM = S.TRX_LINE_SUB_NUM -->
<!--             AND DC.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD -->
<!--             AND DC.CPO_ORD_NUM           = DCD.CPO_ORD_NUM -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del End -->
            AND S.EZCANCELFLAG           = '0'
            AND CD.EZCANCELFLAG          = '0' 
            AND C.EZCANCELFLAG           = '0' 
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
<!--             AND DCD.EZCANCELFLAG         = '0'  -->
<!--             AND DC.EZCANCELFLAG          = '0'  -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del End -->
        <!-- Def#2025
        <isEqual property="wait" compareValue="0">
            FOR UPDATE NOWAIT
        </isEqual>
        <isEqual property="wait" compareValue="1">
            FOR UPDATE
        </isEqual> -->
    </statement>
    

    <statement id="getShipCpltListRs" parameterClass="Map" resultClass="Map">
        SELECT
              S.TRX_HDR_NUM                 AS TRX_HDR_NUM
            , S.TRX_LINE_NUM                AS TRX_LINE_NUM
            , S.TRX_LINE_SUB_NUM            AS TRX_LINE_SUB_NUM
        FROM
              SHPG_PLN S
            , (SELECT
                     S.SHIP_CPLT_CD                  AS SHIP_CPLT_CD
                   , COUNT(DISTINCT S.INVTY_LOC_CD)  AS COUNT
               FROM
                    SHPG_PLN S
               WHERE
                    S.GLBL_CMPY_CD = #glblCmpyCd#
               AND  S.TRX_HDR_NUM  = #cpoOrdNum#
               AND  S.TRX_SRC_TP_CD  = #trxSrcTpCd#
               AND  S.SHIP_CPLT_CD IS NOT NULL
               AND (S.INVTY_LOC_CD IS NOT NULL
                 OR S.TRX_LINE_SUB_NUM &lt;&gt; #cpoDtlLineSubNum#)
               AND  S.SHPG_STS_CD  IN
            <iterate property="shpgStsCds" var="shpgSts[]" open="( " close=" )" conjunction=",">
                #shpgSts[]#
            </iterate>
               AND  S.EZCANCELFLAG = '0'
               GROUP BY
                    S.SHIP_CPLT_CD
               HAVING
                    COUNT(DISTINCT S.INVTY_LOC_CD) > 1
              ) A
        WHERE
             S.GLBL_CMPY_CD=#glblCmpyCd#
        AND  S.TRX_HDR_NUM=#cpoOrdNum#
        AND  S.TRX_SRC_TP_CD  = #trxSrcTpCd#
        AND  S.SHPG_STS_CD IN
            <iterate property="shpgStsCds" var="shpgSts[]" open="( " close=" )" conjunction=",">
                #shpgSts[]#
            </iterate>
        AND  S.SHIP_CPLT_CD=A.SHIP_CPLT_CD
        AND  S.EZCANCELFLAG='0'
        GROUP BY
             S.TRX_HDR_NUM
           , S.TRX_LINE_NUM
           , S.TRX_LINE_SUB_NUM
        ORDER BY
             S.TRX_HDR_NUM
           , S.TRX_LINE_NUM
           , S.TRX_LINE_SUB_NUM
    </statement>

    <statement id="getHold" parameterClass="Map" resultMap="result.getHold">    <!-- 20150924 mod -->
        SELECT
              H.GLBL_CMPY_CD
            , H.HLD_PK
            , H.CPO_ORD_NUM
            , H.CPO_DTL_LINE_NUM
            , H.CPO_DTL_LINE_SUB_NUM
        FROM
              HLD H
        WHERE
             H.GLBL_CMPY_CD = #glblCmpyCd#
        AND  H.CPO_ORD_NUM  = #cpoOrdNum#
        AND  H.HLD_RSN_CD   = #hldRsnCd#
        AND  H.REL_FLG      = 'N'
        AND  H.EZCANCELFLAG = '0'
    </statement>

    <resultMap id="result.getHold" class="HLDTMsg"> <!-- 20150924 mod -->
    	<result property="glblCmpyCd"       column="GLBL_CMPY_CD"         javaType="EZDTStringItem"/>
    	<result property="hldPk"            column="HLD_PK"               javaType="EZDTBigDecimalItem"/>
        <result property="cpoOrdNum"        column="CPO_ORD_NUM"          javaType="EZDTStringItem"/>
        <result property="cpoDtlLineNum"    column="CPO_DTL_LINE_NUM"     javaType="EZDTStringItem"/>
        <result property="cpoDtlLineSubNum" column="CPO_DTL_LINE_SUB_NUM" javaType="EZDTStringItem"/>
    </resultMap>

    <statement id="isShipCpltHold" parameterClass="Map" resultClass="String">
        SELECT
        	  H.HLD_RSN_CD
        FROM
              HLD H
        WHERE
             H.GLBL_CMPY_CD = #glblCmpyCd#
        AND  H.CPO_ORD_NUM  = #cpoOrdNum#
        AND  H.HLD_RSN_CD   = #hldRsnCd#
        AND  H.EZCANCELFLAG = '0'
        AND  ROWNUM = 1
    </statement>
	
	<statement id="queryEachCompCrHldQty" parameterClass="Map" resultClass="Map">
		SELECT 
			  SPCMP.TRX_HDR_NUM
            , SPCMP.TRX_LINE_NUM
            , SPCMP.TRX_LINE_SUB_NUM
			, NVL(SPWRK.SUM_CR_HLD_QTY,0)          SUM_CR_HLD_QTY
        FROM

				(
					SELECT DISTINCT
				 		  SP.TRX_HDR_NUM				AS TRX_HDR_NUM 
				 		, SP.TRX_LINE_NUM 				AS TRX_LINE_NUM
				 		, SP.TRX_LINE_SUB_NUM			AS TRX_LINE_SUB_NUM
				 	FROM
        				SHPG_PLN SP
					WHERE
				        	SP.GLBL_CMPY_CD 		  	= #glblCmpyCd#
				        AND SP.TRX_HDR_NUM 			  	= #trxHdrNum#
				        AND SP.TRX_LINE_NUM 			= #trxLineNum#
				        AND SP.TRX_LINE_SUB_NUM			&lt;&gt; #trxLineNumSet#
				        AND SP.TRX_SRC_TP_CD 		  	= #trxSrcTpCd#
					    AND SP.EZCANCELFLAG       	  	= '0' 
				 )  SPCMP
				LEFT JOIN
				 (
				 	SELECT 
				 		  SP.TRX_HDR_NUM				AS TRX_HDR_NUM  
				        , SP.TRX_LINE_NUM				AS TRX_LINE_NUM
				        , SP.TRX_LINE_SUB_NUM			AS TRX_LINE_SUB_NUM
						, SUM(SP.CR_HLD_QTY)          	AS SUM_CR_HLD_QTY
				 	FROM
				 		SHPG_PLN SP
					WHERE
				        	SP.GLBL_CMPY_CD 		  	= #glblCmpyCd#
				        AND SP.TRX_HDR_NUM 				= #trxHdrNum#
				        AND SP.TRX_LINE_NUM				= #trxLineNum#
				        AND SP.TRX_LINE_SUB_NUM			&lt;&gt; #trxLineNumSet#
				        AND SP.TRX_SRC_TP_CD 		  	= #trxSrcTpCd#
				        AND SP.SET_SHPG_PLN_NUM		  	= #setShpgPlnNum#
						AND SP.EZCANCELFLAG       	  = '0'   
					GROUP BY
				      		SP.TRX_HDR_NUM
				        ,   SP.TRX_LINE_NUM
				        ,   SP.TRX_LINE_SUB_NUM
	
				) SPWRK
					ON 
							SPCMP.TRX_HDR_NUM			= SPWRK.TRX_HDR_NUM
						AND SPCMP.TRX_LINE_NUM			= SPWRK.TRX_LINE_NUM
						AND SPCMP.TRX_LINE_SUB_NUM		= SPWRK.TRX_LINE_SUB_NUM
		
	</statement>
	
	
	<statement id="queryEachCompCrChkQty" parameterClass="Map" resultClass="Map">
	
		SELECT 
			  SPCMP.TRX_HDR_NUM
            , SPCMP.TRX_LINE_NUM
            , SPCMP.TRX_LINE_SUB_NUM
			, NVL(SPWRK.SUM_CR_CHK_QTY,0)          SUM_CR_CHK_QTY
        FROM

				(
				 	SELECT DISTINCT
				 		  SP.TRX_HDR_NUM				AS TRX_HDR_NUM 
				 		, SP.TRX_LINE_NUM 				AS TRX_LINE_NUM
				 		, SP.TRX_LINE_SUB_NUM			AS TRX_LINE_SUB_NUM
				 	FROM
        				SHPG_PLN SP
					WHERE
				        	SP.GLBL_CMPY_CD 		  	= #glblCmpyCd#
				        AND SP.TRX_HDR_NUM 			  	= #trxHdrNum#
				        AND SP.TRX_LINE_NUM 			= #trxLineNum#
				        AND SP.TRX_LINE_SUB_NUM			&lt;&gt; #trxLineNumSet#
				        AND SP.TRX_SRC_TP_CD 		  	= #trxSrcTpCd#
					    AND SP.EZCANCELFLAG       	  	= '0' 
				 )  SPCMP
				LEFT JOIN
				 (
				 	SELECT 
				 		  SP.TRX_HDR_NUM				AS TRX_HDR_NUM 
				        , SP.TRX_LINE_NUM				AS TRX_LINE_NUM
				        , SP.TRX_LINE_SUB_NUM			AS TRX_LINE_SUB_NUM
						, SUM(SP.CR_CHK_QTY)          	AS SUM_CR_CHK_QTY
				 	FROM
				 		SHPG_PLN SP
					WHERE
				        	SP.GLBL_CMPY_CD 		  	= #glblCmpyCd#
				        AND SP.TRX_HDR_NUM 				= #trxHdrNum#
				        AND SP.TRX_LINE_NUM				= #trxLineNum#
				        AND SP.TRX_LINE_SUB_NUM			&lt;&gt; #trxLineNumSet#
				        AND SP.TRX_SRC_TP_CD 		  	= #trxSrcTpCd#
				        AND SP.SET_SHPG_PLN_NUM		  	= #setShpgPlnNum#
						AND SP.EZCANCELFLAG       	    = '0'   
					GROUP BY
				      		SP.TRX_HDR_NUM
				        ,   SP.TRX_LINE_NUM
				        ,   SP.TRX_LINE_SUB_NUM
	
				) SPWRK
					ON 
							SPCMP.TRX_HDR_NUM			= SPWRK.TRX_HDR_NUM
						AND SPCMP.TRX_LINE_NUM			= SPWRK.TRX_LINE_NUM
						AND SPCMP.TRX_LINE_SUB_NUM		= SPWRK.TRX_LINE_SUB_NUM

	</statement>
	
	<statement id="queryHoldCtrlTaxExem" parameterClass="Map" resultClass="Map">
		SELECT 
			  HCTE.CTRY_CD
            , HCTE.ST_CD
        FROM
			HLD_CTRL_TAX_EXEM HCTE
		WHERE
				HCTE.GLBL_CMPY_CD 	= #glblCmpyCd#
			AND HCTE.EZCANCELFLAG   = '0'  
	</statement>
	
	
	<statement id="getOrderListToUpdateHldFlg" parameterClass="Map">
		/**********
		  CPO
		**********/
		SELECT
		    'CPO'         AS  TBL_NM
		  , CPO_HLD_FLG   AS  HLD_FLG
		  , CPO_ORD_NUM   AS  CPO_ORD_NUM
		  , NULL          AS  CPO_DTL_LINE_NUM
		  , NULL          AS  CPO_DTL_LINE_SUB_NUM  
		  , NULL          AS  SHPG_PLN_NUM
		FROM
		  CPO
		WHERE
		      GLBL_CMPY_CD  = #glblCmpyCd#
		  AND CPO_ORD_NUM   = #cpoOrdNum#
		  AND EZCANCELFLAG  = '0'
		  
		/**********
		  CPO_DTL
		**********/
		UNION ALL
		
		SELECT
		    'CPO_DTL'
		  , CPO_DTL_HLD_FLG
		  , CPO_ORD_NUM
		  , CPO_DTL_LINE_NUM
		  , CPO_DTL_LINE_SUB_NUM
		  , NULL
		FROM
		  CPO_DTL
		WHERE
		      GLBL_CMPY_CD  = #glblCmpyCd#
		  AND CPO_ORD_NUM   = #cpoOrdNum#
		  AND EZCANCELFLAG  = '0'
		  
		/**********
		  SHPG_PLN
		**********/
		UNION ALL
		
		SELECT
		    'SHPG_PLN'
		  , SHIP_PLN_HLD_FLG
		  , TRX_HDR_NUM
		  , TRX_LINE_NUM
		  , TRX_LINE_SUB_NUM
		  , SHPG_PLN_NUM
		FROM
		  SHPG_PLN
		WHERE
		      GLBL_CMPY_CD  = #glblCmpyCd#
		  AND TRX_HDR_NUM   = #cpoOrdNum#
		  AND SHPG_STS_CD  != #shpgSts.saved# -- exclude 00:SAVED
		  AND EZCANCELFLAG  = '0'	
	</statement>
		
    <statement id="sumInProcAmtForSC" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                SUM(S.ORD_QTY * S.SP_FUNC_NET_UNIT_PRC_AMT) SUM_NET_AMT
        FROM
                CPO                 C
            ,   CPO_DTL             CD
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
<!--             ,   DS_CPO_DTL          DCD --> <!-- 20150924 add -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
            ,   SHPG_PLN            S
        WHERE
                S.GLBL_CMPY_CD           = #glblCmpyCd#
            AND S.TRX_HDR_NUM            = #trxHdrNum#
            AND S.SHIP_CPLT_CD           = #shipCpltCd#
            AND S.TRX_LINE_SUB_NUM &lt;&gt; #trxLineNumSet#
            <!-- START ADD M.FUJI [Defect#2745] -->
            AND S.CR_CHK_QTY             = #crChkQty_Zero#
            <!-- END ADD M.FUJI [Defect#2745] -->
            AND S.GLBL_CMPY_CD           = CD.GLBL_CMPY_CD
            AND S.TRX_HDR_NUM            = CD.CPO_ORD_NUM
            AND S.TRX_LINE_NUM           = CD.CPO_DTL_LINE_NUM
            AND S.TRX_LINE_SUB_NUM       = CD.CPO_DTL_LINE_SUB_NUM
            AND CD.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND CD.CPO_ORD_NUM           = C.CPO_ORD_NUM
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
            <!-- 20150924 add start -->
<!--             AND CD.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD -->
<!--             AND CD.CPO_ORD_NUM           = DCD.CPO_ORD_NUM -->
<!--             AND CD.CPO_DTL_LINE_NUM      = DCD.CPO_DTL_LINE_NUM -->
<!--             AND CD.CPO_DTL_LINE_SUB_NUM  = DCD.CPO_DTL_LINE_SUB_NUM -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del End -->
            AND CD.CR_REBIL_CD         != #credit#
            <!-- 20150924 add end -->
            AND C.EZCANCELFLAG           = '0'
            AND CD.EZCANCELFLAG          = '0'
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
<!--             AND DCD.EZCANCELFLAG         = '0' --> <!-- 20150924 add -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
            AND S.EZCANCELFLAG           = '0'
    </statement>
    	
    <statement id="sumInProcAmtForSet" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                SUM(S.ORD_QTY * S.SP_FUNC_NET_UNIT_PRC_AMT) SUM_NET_AMT
        FROM
                CPO                 C
            ,   CPO_DTL             CD
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
<!--             ,   DS_CPO_DTL          DCD --> <!-- 20150924 add -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del End -->
            ,   SHPG_PLN            S
        WHERE
                S.GLBL_CMPY_CD           = #glblCmpyCd#
            AND S.TRX_HDR_NUM            = #trxHdrNum#
            AND S.SET_SHPG_PLN_NUM       = #setShpgPlnNum#
            AND S.TRX_LINE_SUB_NUM &lt;&gt; #trxLineNumSet#
            <!-- START ADD M.FUJI [Defect#2745] -->
            AND S.CR_CHK_QTY             = #crChkQty_Zero#
            <!-- END ADD M.FUJI [Defect#2745] -->
            AND S.GLBL_CMPY_CD           = CD.GLBL_CMPY_CD
            AND S.TRX_HDR_NUM            = CD.CPO_ORD_NUM
            AND S.TRX_LINE_NUM           = CD.CPO_DTL_LINE_NUM
            AND S.TRX_LINE_SUB_NUM       = CD.CPO_DTL_LINE_SUB_NUM
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
            <!-- 20150924 add start -->
<!--             AND CD.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD -->
<!--             AND CD.CPO_ORD_NUM           = DCD.CPO_ORD_NUM -->
<!--             AND CD.CPO_DTL_LINE_NUM      = DCD.CPO_DTL_LINE_NUM -->
<!--             AND CD.CPO_DTL_LINE_SUB_NUM  = DCD.CPO_DTL_LINE_SUB_NUM -->
<!--             AND DCD.CR_REBIL_CD         != #credit# -->
            <!-- 20150924 add end -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del End -->
            AND CD.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND CD.CPO_ORD_NUM           = C.CPO_ORD_NUM
            AND C.EZCANCELFLAG           = '0'
            AND CD.EZCANCELFLAG          = '0'
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
<!--             AND DCD.EZCANCELFLAG         = '0' --> <!-- 20150924 add -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del End -->
            AND S.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getCreditLimitOrdTpList" parameterClass="Map" resultClass="String">
		SELECT
		    HR.HLD_RSN_CD || '.' || HCOS.APPLY_ORD_SRC_TP_CD || '.' || HCOT.APPLY_ORD_TP_CD || '.' || HPD.WH_TP_CD

		FROM
		    HLD_RSN          HR
		  , HLD_PROC_DFN     HPD
		  , HLD_CTRL_ORD_SRC HCOS
		  , HLD_CTRL_ORD_TP  HCOT
<!-- START ADD S.Yamamoto [OM004] -->
		  , DS_HLD_CTRL_ORD_TP  DHCOT
<!-- END   ADD S.Yamamoto [OM004] -->
		  
		WHERE
		      HR.GLBL_CMPY_CD   = #glblCmpyCd#
		  AND HR.EZCANCELFLAG   = '0'
		  AND HPD.GLBL_CMPY_CD  = HR.GLBL_CMPY_CD
		  AND HPD.HLD_RSN_CD    = HR.HLD_RSN_CD
		  AND HPD.EZCANCELFLAG  = '0'
		  AND HCOS.GLBL_CMPY_CD = HR.GLBL_CMPY_CD
		  AND HCOS.HLD_RSN_CD   = HR.HLD_RSN_CD
		  AND HCOS.EZCANCELFLAG = '0'
		  AND HCOT.GLBL_CMPY_CD = HR.GLBL_CMPY_CD
		  AND HCOT.HLD_RSN_CD   = HR.HLD_RSN_CD
		  AND HCOT.EZCANCELFLAG = '0'
          AND HR.HLD_RSN_CD     = #hldRsnCd_CrLimit#
          AND HCOT.APPLY_ORD_TP_CD     = #ordTpCd#
          AND HCOS.APPLY_ORD_SRC_TP_CD = #srcTpCd#
<!-- START ADD S.Yamamoto [OM004] -->
		  AND DHCOT.GLBL_CMPY_CD       = HR.GLBL_CMPY_CD
		  AND DHCOT.HLD_RSN_CD         = HR.HLD_RSN_CD
		  AND DHCOT.APPLY_DS_ORD_TP_CD = #applyDsOrdTpCd#
		  AND DHCOT.EZCANCELFLAG       = '0'
<!-- END   ADD S.Yamamoto [OM004] -->
		GROUP BY
		    HR.HLD_RSN_CD || '.' || HCOS.APPLY_ORD_SRC_TP_CD || '.' || HCOT.APPLY_ORD_TP_CD || '.' || HPD.WH_TP_CD
    </statement>

    <statement id="getCreditLimitHldCtrlOrgList" parameterClass="Map" resultClass="Map">
		SELECT 
			HLD_RSN_CD
		  , FIRST_ORG_CD
		  , SCD_ORG_CD
		  , THIRD_ORG_CD
		  , FRTH_ORG_CD
		  , FIFTH_ORG_CD    
		  , SIXTH_ORG_CD     
		  , SVNTH_ORG_CD     
		  , EIGHTH_ORG_CD  
		  , TOC_CD 
		
		FROM
		  HLD_CTRL_ORG
		
		WHERE
		      GLBL_CMPY_CD = #glblCmpyCd#
		  AND EZCANCELFLAG = '0' 
          AND HLD_RSN_CD   = #hldRsnCd_CrLimit# 
		
		GROUP BY
			HLD_RSN_CD
		  , FIRST_ORG_CD
		  , SCD_ORG_CD
		  , THIRD_ORG_CD
		  , FRTH_ORG_CD
		  , FIFTH_ORG_CD
		  , SIXTH_ORG_CD
		  , SVNTH_ORG_CD
		  , EIGHTH_ORG_CD
		  , TOC_CD 
		
		ORDER BY
		  HLD_RSN_CD
		, TOC_CD        NULLS LAST
		, EIGHTH_ORG_CD NULLS LAST
		, SVNTH_ORG_CD  NULLS LAST
		, SIXTH_ORG_CD  NULLS LAST
		, FIFTH_ORG_CD  NULLS LAST
		, FRTH_ORG_CD   NULLS LAST
		, THIRD_ORG_CD  NULLS LAST
		, SCD_ORG_CD    NULLS LAST
		, FIRST_ORG_CD  NULLS LAST
    </statement>

	<!-- 20150924 add start -->
    <statement id="cntExceptBookHold" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                  COUNT(H.GLBL_CMPY_CD)
            FROM
                HLD          H
                , HLD_RSN    HR
            WHERE
                H.GLBL_CMPY_CD                 = #glblCmpyCd#
                AND H.CPO_ORD_NUM              = #trxHdrNum#
                AND H.REL_FLG                  = 'N'
                AND H.HLD_RSN_CD              != #bookHold#
                AND H.EZCANCELFLAG             = '0' 
                AND H.GLBL_CMPY_CD             = HR.GLBL_CMPY_CD
                AND H.HLD_RSN_CD               = HR.HLD_RSN_CD
                AND HR.HLD_EFF_FROM_DT     &lt;= #slsDt#
                <!-- QC#12809 Mod Start -->
                <!-- AND DHR.HLD_EFF_TO_DT      &gt;= #slsDt# -->
                AND (
                     HR.HLD_EFF_TO_DT &gt;= #slsDt#
                     OR
                     HR.HLD_EFF_TO_DT IS NULL
                    )
                <!-- QC#12809 Mod End -->
                AND HR.BLOCK_BOOK_HLD_REL_FLG = 'Y'
                AND HR.EZCANCELFLAG           = '0'
    </statement>

    <statement id="cntCrChkExem" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                  COUNT(CE.GLBL_CMPY_CD)
            FROM
                CUST_CR_CHK_EXEM CE
            WHERE
                CE.GLBL_CMPY_CD     = #glblCmpyCd#
                AND CE.DS_ACCT_NUM  = #dsAcctNum#
                AND CE.EFF_FROM_DT &lt;= #slsDt#
                <!-- QC#12809 Mod Start -->
                <!-- AND CE.EFF_TO_DT   &gt;= #slsDt# -->
                AND (
                     CE.EFF_TO_DT &gt;= #slsDt#
                     OR
                     CE.EFF_TO_DT IS NULL
                    )
                <!-- QC#12809 Mod End -->
                AND CE.EZCANCELFLAG = '0'
    </statement>
	<!-- 20150924 add end -->

    <!-- 20160107 S21_NA#2588 Add Start -->
    <statement id="getEnteredDsCpoRtrnDtlList" parameterClass="Map" resultMap="result.getEnteredDsCpoRtrnDtlList">
        SELECT
            GLBL_CMPY_CD
            ,CPO_ORD_NUM
            ,DS_CPO_RTRN_LINE_NUM
            ,DS_CPO_RTRN_LINE_SUB_NUM
        FROM
            DS_CPO_RTRN_DTL
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
            AND CPO_ORD_NUM = #cpoOrdNum#
            <iterate property="omitRtrnLineStsCdList" var="omitRtrnLineStsCd[]" open=" AND RTRN_LINE_STS_CD NOT IN (" close=")" conjunction=",">
                #omitRtrnLineStsCd[]#
            </iterate>
            AND EZCANCELFLAG = '0'
    </statement>
    <resultMap id="result.getEnteredDsCpoRtrnDtlList" class="DS_CPO_RTRN_DTLTMsg">
        <result property="glblCmpyCd"           column="GLBL_CMPY_CD"               javaType="EZDTStringItem"/>
        <result property="cpoOrdNum"            column="CPO_ORD_NUM"                javaType="EZDTStringItem"/>
        <result property="dsCpoRtrnLineNum"     column="DS_CPO_RTRN_LINE_NUM"       javaType="EZDTStringItem"/>
        <result property="dsCpoRtrnLineSubNum"  column="DS_CPO_RTRN_LINE_SUB_NUM"   javaType="EZDTStringItem"/>
    </resultMap>
    <!-- 20160107 S21_NA#2588 Add End -->

    <!-- S21_NA#13323 Add Start -->
    <statement id="cntNotAllLineCredit" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(CD.CPO_ORD_NUM)
        FROM
            CPO_DTL    CD
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
<!--            ,DS_CPO_DTL DCD -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del End -->
        WHERE
            CD.GLBL_CMPY_CD             = #glblCmpyCd#
            AND CD.CPO_ORD_NUM          = #cpoOrdNum#
            AND CD.ORD_LINE_STS_CD     != #ordLineStsCancel#
            AND CD.EZCANCELFLAG         = '0'
            AND (CD.CR_REBIL_CD       != #crRebilCd# OR CD.CR_REBIL_CD IS NULL)
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del Start -->
<!--             AND CD.GLBL_CMPY_CD         = DCD.GLBL_CMPY_CD -->
<!--             AND CD.CPO_ORD_NUM          = DCD.CPO_ORD_NUM -->
<!--             AND CD.CPO_DTL_LINE_NUM     = DCD.CPO_DTL_LINE_NUM -->
<!--             AND CD.CPO_DTL_LINE_SUB_NUM = DCD.CPO_DTL_LINE_SUB_NUM -->
<!--             AND DCD.EZCANCELFLAG        = '0' -->
<!-- 2017/03/29 S21_NA#Review structure Lv.1 Del End -->
    </statement>
    <!-- S21_NA#13323 Add End -->

    <!-- S21_NA#14973 Add Start -->
    <statement id="hasExemption" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(C.CPO_ORD_NUM)
        FROM
            CPO           C
           ,CUST_CR_CHK_EXEM CE
        WHERE
            C.GLBL_CMPY_CD             = #glblCmpyCd#
            AND C.CPO_ORD_NUM          = #cpoOrdNum#
            AND C.EZCANCELFLAG         = '0'

            AND C.GLBL_CMPY_CD         = CE.GLBL_CMPY_CD
            AND C.BILL_TO_CUST_ACCT_CD = CE.DS_ACCT_NUM
            AND #slsDt# BETWEEN CE.EFF_FROM_DT AND NVL(CE.EFF_TO_DT, '99991231')
            AND CE.EZCANCELFLAG         = '0'
    </statement>

    <!-- 2017/05/16 S21_NA#Review structure Lv.2 RS#7319 Del Start -->
    <!-- statement id="getShpgPlnList" parameterClass="Map" resultClass="Map" -->
<!--         SELECT -->
<!--             SP.TRX_HDR_NUM -->
<!--            ,SP.TRX_LINE_NUM -->
<!--            ,SP.TRX_LINE_SUB_NUM -->
<!--            ,SP.SHPG_PLN_NUM -->
<!--            ,SP.ORD_QTY -->
<!--         FROM -->
<!--             SHPG_PLN SP -->
<!--         WHERE -->
<!--             SP.GLBL_CMPY_CD          = #glblCmpyCd# -->
<!--             AND SP.TRX_HDR_NUM       = #cpoOrdNum# -->
<!--             AND SP.TRX_LINE_SUB_NUM != #setParentLineSubNum# -->
<!--             AND SP.TRX_SRC_TP_CD     = #trxSrcTpCd# -->
<!--             AND SP.EZCANCELFLAG      = '0' -->
    <!-- /statement -->
    <!-- 2017/05/17 S21_NA#Review structure Lv.2 RS#7319 Del End -->
    <!-- S21_NA#14973 Add End -->

    <!-- 2017/05/08 S21_NA#Review structure Lv.2 RS#7255(Display Status) Add Start -->
    <statement id="getHdrHldList" parameterClass="Map" resultClass="Map">
        SELECT
            H.HLD_RSN_CD
            , HR.HLD_TP_CD
        FROM
            HLD H
            ,HLD_RSN HR
        WHERE
            H.GLBL_CMPY_CD = #glblCmpyCd#
            AND H.CPO_ORD_NUM = #cpoOrdNum#
            AND H.REL_FLG = 'N'
            AND H.EZCANCELFLAG = '0'

            AND H.GLBL_CMPY_CD = HR.GLBL_CMPY_CD
            AND H.HLD_RSN_CD = HR.HLD_RSN_CD
            AND HR.EZCANCELFLAG = '0'
        GROUP BY
            H.HLD_RSN_CD
            , HR.HLD_TP_CD
        ORDER BY
            H.HLD_RSN_CD
    </statement>

    <statement id="isHdrCrHld" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(SHPG_PLN_NUM) CNT
        FROM
            SHPG_PLN SP
        WHERE
            SP.GLBL_CMPY_CD = #glblCmpyCd#
            AND SP.TRX_HDR_NUM = #trxHdrNum#
            AND SP.CR_HLD_QTY <![CDATA[ > ]]> 0
            AND SP.EZCANCELFLAG = '0'
    </statement>
    <!-- 2017/05/08 S21_NA#Review structure Lv.2 RS#7255(Display Status) Add End -->
    
    <!-- 2018/01/18 QC#22737-2 add start -->
    <statement id="countContr" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            CPO_DTL CD
            ,DS_CONTR DC
          <!-- 2019/05/07 QC#20073 Add Start -->
            ,CPO C
            ,ORD_CATG_BIZ_CTX OCC
          <!-- 2019/05/07 QC#20073 Add End -->
        WHERE
            CD.GLBL_CMPY_CD = #glblCmpyCd#
            AND CD.CPO_ORD_NUM = #cpoOrdNum#
            AND CD.DS_CONTR_NUM IS NOT NULL
            AND CD.EZCANCELFLAG = '0'
          <!-- 2019/05/07 QC#50073 Add Start -->
            AND CD.GLBL_CMPY_CD    = C.GLBL_CMPY_CD
            AND CD.CPO_ORD_NUM     = C.CPO_ORD_NUM
            AND C.EZCANCELFLAG     = '0'
            AND OCC.DS_ORD_CATG_CD = C.DS_ORD_CATG_CD
            AND (OCC.DS_ORD_TP_CD = C.DS_ORD_TP_CD 
               OR OCC.DS_ORD_TP_CD IS NULL)
            AND (OCC.DS_ORD_RSN_CD = C.DS_ORD_RSN_CD 
               OR OCC.DS_ORD_RSN_CD IS NULL)
            AND OCC.ORD_CATG_CTX_TP_CD = #ordCatgContrSup#
            AND OCC.EZCANCELFLAG   = '0'
          <!-- 2019/05/07 QC#50073 Add End -->
            AND CD.GLBL_CMPY_CD = DC.GLBL_CMPY_CD
            AND CD.DS_CONTR_NUM = DC.DS_CONTR_NUM
            AND CD.EZCANCELFLAG = DC.EZCANCELFLAG
        GROUP BY
            CD.DS_CONTR_NUM
    </statement>
    
    <statement id="getSpplyOrdCatg" parameterClass="Map" resultClass="String">
        SELECT
            OCB.DS_ORD_CATG_CD
        FROM
            ORD_CATG_BIZ_CTX OCB
        WHERE
                OCB.GLBL_CMPY_CD = #glblCmpyCd#
            AND OCB.ORD_CATG_CTX_TP_CD = #ordCatgCtxTp#
            AND OCB.EZCANCELFLAG = '0'
    </statement>
    <!-- 2018/01/18 QC#22737-2 add end -->
    
    <!-- 2018/07/02 S21_NA#24189 Add Start -->
    <statement id="getInvdShpgNumList" parameterClass="Map" resultClass="String">
        SELECT
            SP.SHPG_PLN_NUM
        FROM
            SHPG_PLN SP
        WHERE
                SP.GLBL_CMPY_CD    = #glblCmpyCd#
            AND SP.TRX_HDR_NUM     = #trxHdrNum#
            AND SP.SHPG_STS_CD     = #shpgStsCd#
            AND SP.SLS_HLD_QTY     > 0
            AND SP.EZCANCELFLAG    = '0'
    </statement>
    <!-- 2018/07/02 S21_NA#24189 Add End -->

    <!-- 2018/12/13 S21_NA#29488 Add Start -->
    <statement id="getHldTarget" parameterClass="Map" resultClass="Map">
       SELECT 
            C.CPO_ORD_NUM
           ,CD.CPO_DTL_LINE_NUM
           ,CD.CPO_DTL_LINE_SUB_NUM
           ,SP.SHPG_PLN_NUM
        FROM 
            CPO             C 
           ,DS_CPO_CONFIG   DCC
           ,CPO_DTL         CD
           ,SHPG_PLN        SP
           <!-- 2019/01/09 S21_NA#29879 Add Start -->
           ,ALL_MDSE_V      M
           <!-- 2019/01/09 S21_NA#29879 Add End -->
        where 
            C.GLBL_CMPY_CD      = #glblCmpyCd#
        AND C.CPO_ORD_NUM       = #cpoOrdNum#
        AND C.GLBL_CMPY_CD      = CD.GLBL_CMPY_CD
        AND C.CPO_ORD_NUM       = CD.CPO_ORD_NUM
        AND C.EZCANCELFLAG      = '0'
        AND CD.EZCANCELFLAG     = '0'
        AND CD.RTL_WH_CD        IS NULL

        AND CD.GLBL_CMPY_CD     = DCC.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM      = DCC.CPO_ORD_NUM
        AND CD.DS_CPO_CONFIG_PK = DCC.DS_CPO_CONFIG_PK
        AND CD.ORD_LINE_STS_CD != #ordLineStsCancel#
        <!-- 2019/01/09 S21_NA#29879 Add Start -->
        AND DCC.CONFIG_TP_CD    = #configTpCdAdd#
        <!-- 2019/01/09 S21_NA#29879 Add End -->
        AND DCC.EZCANCELFLAG    = '0'  
        AND CD.GLBL_CMPY_CD     = SP.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM      = SP.TRX_HDR_NUM
        AND CD.CPO_DTL_LINE_NUM = SP.TRX_LINE_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM = SP.TRX_LINE_SUB_NUM
        AND SP.EZCANCELFLAG     = '0' 
        <!-- 2019/01/09 S21_NA#29879 Add Start -->
        AND SP.GLBL_CMPY_CD     = M.GLBL_CMPY_CD
        AND SP.MDSE_CD          = M.MDSE_CD
        AND M.INSTL_BASE_CTRL_FLG = 'Y' 
        AND M.INVTY_CTRL_FLG    = 'N' 
        AND M.EZCANCELFLAG      = '0'
        <!-- 2019/01/09 S21_NA#29879 Add End -->
        AND NOT EXISTS (
            SELECT 1 
              FROM ALL_MDSE_V M2
                  ,SHPG_PLN SP2
                  ,DS_CPO_CONFIG DCC2
                  ,CPO_DTL  CD2
             WHERE M2.GLBL_CMPY_CD = SP2.GLBL_CMPY_CD
               AND M2.MDSE_CD      = SP2.MDSE_CD
               AND M2.INVTY_CTRL_FLG = 'Y' 
               AND M2.EZCANCELFLAG = '0'
               AND SP2.EZCANCELFLAG = '0'
               AND SP2.GLBL_CMPY_CD = CD2.GLBL_CMPY_CD
               AND SP2.TRX_HDR_NUM  = CD2.CPO_ORD_NUM
               AND SP2.TRX_LINE_NUM = CD2.CPO_DTL_LINE_NUM
               AND SP2.TRX_LINE_SUB_NUM = CD2.CPO_DTL_LINE_SUB_NUM
               AND CD2.EZCANCELFLAG = '0'
               AND CD2.GLBL_CMPY_CD = DCC2.GLBL_CMPY_CD
               AND CD2.CPO_ORD_NUM  = DCC2.CPO_ORD_NUM
               AND CD2.DS_CPO_CONFIG_PK = DCC2.DS_CPO_CONFIG_PK
               AND DCC2.EZCANCELFLAG = '0'
               AND DCC2.DS_CPO_CONFIG_PK = DCC.DS_CPO_CONFIG_PK
        )
        <!-- 2019/01/09 S21_NA#29879-2 Add Start -->
        AND NOT EXISTS(
            SELECT 1
            FROM   HLD H
            WHERE   H.GLBL_CMPY_CD  = SP.GLBL_CMPY_CD
                AND H.HLD_RSN_CD    = #hldRsnCd#
                AND H.CPO_ORD_NUM   = SP.TRX_HDR_NUM
                AND H.CPO_DTL_LINE_NUM = SP.TRX_LINE_NUM
                AND H.CPO_DTL_LINE_SUB_NUM = SP.TRX_LINE_SUB_NUM
                AND H.SHPG_PLN_NUM  = SP.SHPG_PLN_NUM
                AND H.EZCANCELFLAG  = '0'
        )
        <!-- 2019/01/09 S21_NA#29879-2 Add End -->
    </statement>
    <!-- 2018/12/13 S21_NA#29488 Add End -->

    <!-- Add Start 2019/08/30 QC#53016 -->
    <statement id="getCpoData" parameterClass="Map" resultClass="Map">
        SELECT
              C.GLBL_CMPY_CD
            , C.EZCANCELFLAG
            , C.CPO_ORD_NUM
            , C.DS_ORD_CATG_CD
            , C.DS_ORD_TP_CD 
        FROM
              CPO C 
        WHERE
                C.GLBL_CMPY_CD = #glblCmpyCd# 
            AND C.CPO_ORD_NUM  = #cpoOrdNum# 
            AND EXISTS ( 
                SELECT
                      1 
                FROM
                    CPO_DTL CD 
                WHERE
                        C.GLBL_CMPY_CD  = CD.GLBL_CMPY_CD 
                    AND C.CPO_ORD_NUM   = CD.CPO_ORD_NUM 
                    AND CD.CR_REBIL_CD  IS NULL
                    AND CD.RTL_WH_CD    NOT IN 
                    <iterate property="crRebillDummyWhCdList" var="crRebillDummyWhCd[]" open="(" close=" )" conjunction=",">
                        #crRebillDummyWhCd[]#
                    </iterate>
                    AND CD.EZCANCELFLAG = '0'
            ) 
            AND C.EZCANCELFLAG = '0'
    </statement>

    <statement id="getHldRsnFromValSet" parameterClass="Map" resultClass="String">
        SELECT
                OCBC.FIRST_BIZ_CTX_ATTRB_TXT
        FROM
                ORD_CATG_BIZ_CTX OCBC
        WHERE
                OCBC.GLBL_CMPY_CD             = #glblCmpyCd#
            AND OCBC.EZCANCELFLAG             = '0'
            AND OCBC.ORD_CATG_CTX_TP_CD       = #ordCatgCtxTpCd#
            AND
            (
               (    OCBC.DS_ORD_CATG_CD       IS NULL
                AND OCBC.DS_ORD_TP_CD         IS NULL
                AND OCBC.DS_ORD_RSN_CD        IS NULL)
              OR
               (    OCBC.DS_ORD_CATG_CD       = #dsOrdCatgCd#
                AND OCBC.DS_ORD_TP_CD         IS NULL
                AND OCBC.DS_ORD_RSN_CD        IS NULL)
              OR
               (    OCBC.DS_ORD_CATG_CD       = #dsOrdCatgCd#
                AND OCBC.DS_ORD_TP_CD         = #dsOrdTpCd#
                AND OCBC.DS_ORD_RSN_CD        IS NULL)
              <isNotNull property="dsOrdRsnCd">
              OR
               (    OCBC.DS_ORD_CATG_CD       = #dsOrdCatgCd#
                AND OCBC.DS_ORD_TP_CD         = #dsOrdTpCd#
                AND OCBC.DS_ORD_RSN_CD        = #dsOrdRsnCd#)
              </isNotNull>
            )
    </statement>
    <!-- Add End 2019/08/30 QC#53016 -->
</sqlMap>
