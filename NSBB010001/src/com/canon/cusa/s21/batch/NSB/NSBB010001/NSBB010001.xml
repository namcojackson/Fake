<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSBB010001">
    <statement id="getSvcInvList" parameterClass="Map" resultClass="Map">
        SELECT
            --** for Invoice Header Parameter ** --
            RANK() OVER (PARTITION BY INV.SVC_INV_NUM ORDER BY ILN.SVC_INV_LINE_PK) INV_RANK
           ,CASE 
                WHEN INV.DS_CONTR_CATG_CD = #dsContrCatgCd_Fleet#
                    THEN
                        RANK() OVER (PARTITION BY INV.SVC_INV_NUM ORDER BY ILN.SVC_INV_LINE_PK)
                    ELSE
                        RANK() OVER (PARTITION BY INV.SVC_INV_NUM, ILN.SHIP_TO_CUST_CD ORDER BY ILN.SVC_INV_LINE_PK)
            END                            AS SHIP_RANK
           ,CASE 
                WHEN INV.DS_CONTR_CATG_CD = #dsContrCatgCd_Fleet#
                    THEN
                        NULL
                    ELSE
                        ILN.SHIP_TO_CUST_CD
            END                            AS SORT_KEY_SHIP
           ,INV.EZUPTIME                   AS TM
           ,INV.EZUPTIMEZONE               AS TM_ZN
           ,INV.SVC_INV_PK                 AS SVC_INV_PK
           ,INV.SVC_INV_NUM                AS SVC_INV_NUM
           ,INV.ORIG_SVC_INV_NUM           AS ORIG_SVC_INV_NUM
           ,INV.INV_DT                     AS INV_DT
           ,INV.INV_TP_CD                  AS INV_TP_CD
           ,INV.INV_DUE_DT                 AS INV_DUE_DT
           ,INV.CUST_ISS_PO_NUM            AS CUST_ISS_PO_NUM
           ,INV.CUST_ISS_PO_DT             AS CUST_ISS_PO_DT
           ,INV.BILL_TO_CUST_CD            AS BILL_TO_CUST_CD
           ,INV.BILL_TO_CUST_ACCT_CD       AS BILL_TO_CUST_ACCT_CD
           ,INV.SELL_TO_CUST_CD            AS SELL_TO_CUST_CD
           ,INV.BILL_TO_LOC_NM             AS BILL_TO_LOC_NM
           ,INV.BILL_TO_ADDL_LOC_NM        AS BILL_TO_ADDL_LOC_NM
           ,INV.BILL_TO_FIRST_LINE_ADDR    AS BILL_TO_FIRST_LINE_ADDR
           ,INV.BILL_TO_SCD_LINE_ADDR      AS BILL_TO_SCD_LINE_ADDR
           ,INV.BILL_TO_THIRD_LINE_ADDR    AS BILL_TO_THIRD_LINE_ADDR
           ,INV.BILL_TO_FRTH_LINE_ADDR     AS BILL_TO_FRTH_LINE_ADDR
           ,INV.BILL_TO_CTY_ADDR           AS BILL_TO_CTY_ADDR
           ,INV.BILL_TO_PROV_NM            AS BILL_TO_PROV_NM
           ,INV.BILL_TO_CNTY_NM            AS BILL_TO_CNTY_NM
           ,INV.BILL_TO_ST_CD              AS BILL_TO_ST_CD
           ,INV.BILL_TO_POST_CD            AS BILL_TO_POST_CD
           ,INV.BILL_TO_CTRY_CD            AS BILL_TO_CTRY_CD
           ,INV.BILL_TO_FIRST_REF_CMNT_TXT AS BILL_TO_FIRST_REF_CMNT_TXT
           ,INV.BILL_TO_SCD_REF_CMNT_TXT   AS BILL_TO_SCD_REF_CMNT_TXT
           ,INV.PMT_TERM_START_DT          AS PMT_TERM_START_DT
           ,INV.PMT_TERM_CD                AS PMT_TERM_CD
           ,PTC.CASH_DISC_TERM_CD          AS CASH_DISC_TERM_CD
           ,INV.INV_TOT_DEAL_NET_AMT       AS INV_TOT_DEAL_NET_AMT
           <!-- START 2018/05/31 K.Kojima [QC#23685,DEL] -->
           <!-- ,INV.INV_TOT_DEAL_TAX_AMT       AS INV_TOT_DEAL_TAX_AMT -->
           <!-- END 2018/05/31 K.Kojima [QC#23685,DEL] -->
           ,INV.DEAL_CCY_CD                AS DEAL_CCY_CD
           ,INV.CCY_EXCH_RATE              AS CCY_EXCH_RATE
           ,CRD.INV_PRINT_FLG              AS INV_PRINT_FLG_CRD
           ,CDS.CR_DR_RSN_CD               AS CR_DR_RSN_CD
           ,ILN.CR_DR_SUB_RSN_CD           AS CR_DR_SUB_RSN_CD
           ,INV.PMT_TERM_CASH_DISC_CD      AS PMT_TERM_CASH_DISC_CD
           ,PTC.PMT_CC_FLG                 AS PMT_CC_FLG
           ,INV.CR_CARD_CUST_REF_NUM       AS CR_CARD_CUST_REF_NUM
           ,CAR.CR_CARD_TP_CD              AS CR_CARD_TP_CD
           ,CASE 
                WHEN CAR.CR_CARD_EXPR_YR_MTH IS NOT NULL
                    THEN
                        CAR.CR_CARD_EXPR_YR_MTH || '01'
                    ELSE
                        CAR.CR_CARD_EXPR_YR_MTH
            END                            AS DS_INV_EXPR_DT
           ,INV.DS_INV_TP_CD               AS DS_INV_TP_CD
           ,INV.SVC_INV_SRC_TP_CD          AS SVC_INV_SRC_TP_CD
           ,INV.DS_CONTR_NUM               AS DS_CONTR_NUM
           ,INV.FSR_NUM                    AS FSR_NUM
           ,INV.SLS_REP_TOC_CD             AS SLS_REP_TOC_CD
           <!-- START 2017/11/29 K.Kojima [QC#21918,ADD] -->
           ,ILN.SLS_REP_TOC_CD             AS SLS_REP_TOC_CD_FOR_LINE
           <!-- END 2017/11/29 K.Kojima [QC#21918,ADD] -->
           ,INV.CUST_CARE_TKT_NUM          AS CUST_CARE_TKT_NUM
           ,INV.DS_CONTR_CATG_CD           AS DS_CONTR_CATG_CD
           ,INV.LINE_BIZ_TP_CD             AS LINE_BIZ_TP_CD
           ,IST.DS_BIZ_AREA_CD             AS DS_BIZ_AREA_CD
           ,IST.CUST_INV_SRC_CD            AS CUST_INV_SRC_CD
           ,PSN.CTAC_PSN_FIRST_NM          AS CTAC_PSN_FIRST_NM
           ,PSN.CTAC_PSN_MID_NM            AS CTAC_PSN_MID_NM
           ,PSN.CTAC_PSN_LAST_NM           AS CTAC_PSN_LAST_NM
           ,DIT.INV_PRINT_FLG              AS INV_PRINT_FLG_DIT
           ,DCE.INV_PRINT_FLG              AS INV_PRINT_FLG_DCE
           ,DCN.DS_CONTR_EDI_CD            AS DS_CONTR_EDI_CD
           ,SEL.DS_ACCT_DLR_CD             AS DS_ACCT_DLR_CD
            --** for Shipments Parameter ** --
           ,PSN.CTAC_PSN_PK                AS CTAC_PSN_PK
            --** for Invoice Line Parameter ** --
           ,ILN.SVC_INV_LINE_PK            AS SVC_INV_LINE_PK
           ,ILN.SVC_INV_LINE_NUM           AS SVC_INV_LINE_NUM
           ,ILT.MAIN_MACH_FLG              AS MAIN_MACH_FLG
           ,ILT.CONTR_ASRY_FLG             AS CONTR_ASRY_FLG
           ,ILN.MDSE_CD                    AS MDSE_CD
           ,MDS.MDSE_NM                    AS MDSE_NM
           ,ILN.INTG_MDSE_CD               AS INTG_MDSE_CD
           ,MD2.MDSE_NM                    AS INTG_MDSE_NM
           ,ILN.TRX_CD                     AS TRX_CD
           ,ILN.TRX_RSN_CD                 AS TRX_RSN_CD
           ,ILN.SVC_INV_QTY                AS SVC_INV_QTY
           ,ILN.DEAL_UNIT_PRC_AMT          AS DEAL_UNIT_PRC_AMT
           ,ILN.INV_DISP_UNIT_PRC_AMT      AS INV_DISP_UNIT_PRC_AMT
           <!-- START 2018/05/31 K.Kojima [QC#23685,DEL] -->
           <!-- ,ILN.INV_LINE_DEAL_TAX_AMT      AS INV_LINE_DEAL_TAX_AMT -->
           <!-- END 2018/05/31 K.Kojima [QC#23685,DEL] -->
           ,ILN.INV_LINE_DEAL_NET_AMT      AS INV_LINE_DEAL_NET_AMT
           ,ILN.FUNC_UNIT_PRC_AMT          AS FUNC_UNIT_PRC_AMT
           <!-- START 2018/05/31 K.Kojima [QC#23685,DEL] -->
           <!-- ,ILN.INV_LINE_FUNC_TAX_AMT      AS INV_LINE_FUNC_TAX_AMT -->
           <!-- END 2018/05/31 K.Kojima [QC#23685,DEL] -->
           ,ILN.INV_LINE_FUNC_NET_AMT      AS INV_LINE_FUNC_NET_AMT
           <!-- START 2018/05/31 K.Kojima [QC#23685,DEL] -->
           <!-- ,ILN.SLS_TAX_RATE               AS SLS_TAX_RATE -->
           <!-- END 2018/05/31 K.Kojima [QC#23685,DEL] -->
           <!-- START 2018/07/10 K.Kitachi [QC#22788, MOD] -->
           <!-- , (SELECT -->
           <!--        MAX(SCM.SVC_CONFIG_MSTR_PK) -->
           <!--    FROM -->
           <!--        SVC_CONFIG_MSTR SCM -->
           <!--    WHERE -->
           <!--        SCM.GLBL_CMPY_CD     = INV.GLBL_CMPY_CD -->
           <!--    AND SCM.SVC_MACH_MSTR_PK = INV.SVC_MACH_MSTR_PK -->
           <!--    AND SCM.EZCANCELFLAG     = '0' -->
           <!--   )                             AS SVC_CONFIG_MSTR_PK -->
           , (SELECT
                  SMM.SVC_CONFIG_MSTR_PK
              FROM
                  SVC_MACH_MSTR SMM
              WHERE
                  SMM.GLBL_CMPY_CD     = ILN.GLBL_CMPY_CD
              AND SMM.SVC_MACH_MSTR_PK = ILN.SVC_MACH_MSTR_PK
              AND SMM.EZCANCELFLAG     = '0'
             )                             AS SVC_CONFIG_MSTR_PK
           <!-- END 2018/07/10 K.Kitachi [QC#22788, MOD] -->
           ,DCN.DS_CONTR_SQ_NUM            AS DS_CONTR_SQ_NUM
           ,ILN.FIRST_BLLG_ATTRB_VAL_TXT   AS FIRST_BLLG_ATTRB_VAL_TXT
           ,ILN.SCD_BLLG_ATTRB_VAL_TXT     AS SCD_BLLG_ATTRB_VAL_TXT
           ,ILN.THIRD_BLLG_ATTRB_VAL_TXT   AS THIRD_BLLG_ATTRB_VAL_TXT
           ,ILN.FRTH_BLLG_ATTRB_VAL_TXT    AS FRTH_BLLG_ATTRB_VAL_TXT
           ,ILN.FIFTH_BLLG_ATTRB_VAL_TXT   AS FIFTH_BLLG_ATTRB_VAL_TXT
           ,ILN.SIXTH_BLLG_ATTRB_VAL_TXT   AS SIXTH_BLLG_ATTRB_VAL_TXT
           ,ILN.UOM_CD                     AS UOM_CD
           ,ILN.DS_CONTR_DTL_PK            AS DS_CONTR_DTL_PK
           ,ILN.MDL_ID                     AS MDL_ID
           ,ILN.SVC_INV_CHRG_TP_CD         AS SVC_INV_CHRG_TP_CD
           ,ILN.BLLG_PER_FROM_DT           AS BLLG_PER_FROM_DT
           ,ILN.BLLG_PER_THRU_DT           AS BLLG_PER_THRU_DT
           ,NVL(ILM.BLLG_COPY_QTY, 0)      AS BLLG_COPY_QTY
           ,ILN.TAX_CALC_GEO_CD            AS TAX_CALC_GEO_CD
           ,ILN.CUST_ISS_PO_NUM            AS CUST_ISS_PO_NUM_2
           ,ILN.CUST_ISS_PO_DT             AS CUST_ISS_PO_DT_2
           ,ILN.INV_DISP_QTY               AS INV_DISP_QTY
           <!-- START 2018/11/15 S.Kitamura [QC#29117, MOD] -->
           <!--,INV.SHIP_TO_CUST_ACCT_CD       AS SHIP_TO_CUST_ACCT_CD -->
           ,STC.SELL_TO_CUST_CD            AS SHIP_TO_CUST_ACCT_CD
           <!-- END 2018/11/15 S.Kitamura [QC#29117, MOD] -->
           ,ILN.SHIP_TO_CUST_CD            AS SHIP_TO_CUST_CD
           ,STC.LOC_NM                     AS SHIP_TO_LOC_NM
           ,STC.ADDL_LOC_NM                AS SHIP_TO_ADDL_LOC_NM
           ,STC.FIRST_LINE_ADDR            AS SHIP_TO_FIRST_LINE_ADDR
           ,STC.SCD_LINE_ADDR              AS SHIP_TO_SCD_LINE_ADDR
           ,STC.THIRD_LINE_ADDR            AS SHIP_TO_THIRD_LINE_ADDR
           ,STC.FRTH_LINE_ADDR             AS SHIP_TO_FRTH_LINE_ADDR
           ,STC.ST_CD                      AS SHIP_TO_ST_CD
           ,STC.PROV_NM                    AS SHIP_TO_PROV_NM
           ,CNT.CNTY_NM                    AS SHIP_TO_CNTY_NM
           ,STC.FIRST_REF_CMNT_TXT         AS SHIP_TO_FIRST_REF_CMNT_TXT
           ,STC.SCD_REF_CMNT_TXT           AS SHIP_TO_SCD_REF_CMNT_TXT
           ,STC.POST_CD                    AS SHIP_TO_POST_CD
           ,STC.CTY_ADDR                   AS SHIP_TO_CTY_ADDR
           ,STC.CTRY_CD                    AS SHIP_TO_CTRY_CD
           <!-- START 2017/02/22 K.Kitachi [QC#17515, ADD] -->
           ,DCN.CONTR_INV_CMNT_TXT         AS CONTR_INV_CMNT_TXT
           <!-- END 2017/02/22 K.Kitachi [QC#17515, ADD] -->
           <!-- START 2018/07/10 K.Kitachi [QC#22788, ADD] -->
           ,ILN.SVC_MACH_MSTR_PK           AS SVC_MACH_MSTR_PK
           <!-- END 2018/07/10 K.Kitachi [QC#22788, ADD] -->
           <!-- START 2018/07/25 M.Naito [QC#13309, ADD] -->
           ,INV.TEMP_ETTL_NUM              AS TEMP_ETTL_NUM
           <!-- END 2018/07/25 M.Naito [QC#13309, ADD] -->
           <!-- add start 2018/08/09 QC#27329-3 -->
           ,ILN.DS_CONTR_BLLG_SCHD_PK      AS DS_CONTR_BLLG_SCHD_PK
           <!-- add end 2018/08/09 QC#27329-3 -->
           <!-- START 2020/07/13 K.Kitachi [QC#57304, ADD] -->
           ,DCN.ALT_PAYER_CUST_CD          AS ALT_PAYER_CUST_CD
           ,INV.DS_ACCT_NUM                AS DS_ACCT_NUM
           ,SEL.LOC_NM                     AS SELL_TO_LOC_NM
           ,SEL.ADDL_LOC_NM                AS SELL_TO_ADDL_LOC_NM
           ,SEL.FIRST_LINE_ADDR            AS SELL_TO_FIRST_LINE_ADDR
           ,SEL.SCD_LINE_ADDR              AS SELL_TO_SCD_LINE_ADDR
           ,SEL.THIRD_LINE_ADDR            AS SELL_TO_THIRD_LINE_ADDR
           ,SEL.FRTH_LINE_ADDR             AS SELL_TO_FRTH_LINE_ADDR
           ,SEL.CTY_ADDR                   AS SELL_TO_CTY_ADDR
           ,SEL.PROV_NM                    AS SELL_TO_PROV_NM
           ,SCT.CNTY_NM                    AS SELL_TO_CNTY_NM
           ,SEL.ST_CD                      AS SELL_TO_ST_CD
           ,SEL.POST_CD                    AS SELL_TO_POST_CD
           ,SEL.CTRY_CD                    AS SELL_TO_CTRY_CD
           ,SEL.FIRST_REF_CMNT_TXT         AS SELL_TO_FIRST_REF_CMNT_TXT
           ,SEL.SCD_REF_CMNT_TXT           AS SELL_TO_SCD_REF_CMNT_TXT
           ,CASE
                WHEN ILN.SVC_INV_CHRG_TP_CD = #baseCharge# OR PIL.SVC_INV_CHRG_TP_CD = #baseCharge#
                    THEN
                        DCN.BASE_CHRG_TO_LEASE_CMPY_FLG
                WHEN ILN.SVC_INV_CHRG_TP_CD = #meterCharge# OR PIL.SVC_INV_CHRG_TP_CD = #meterCharge#
                    THEN
                        DCN.USG_CHRG_TO_LEASE_CMPY_FLG
            END                            AS LEASE_CMPY_FLG
           <!-- END 2020/07/13 K.Kitachi [QC#57304, ADD] -->
           <!-- Start 2023/01/20 R.Onozuka [QC#60823, ADD] -->
           ,NVL(CAR.EZCANCELFLAG, #flgOne#)  AS DS_CR_CARD_EZCANCELFLAG
           <!-- End 2023/01/20 R.Onozuka [QC#60823, ADD] -->
        FROM
            SVC_INV                INV
           ,SVC_INV_LINE           ILN
           ,SVC_INV_LINE_MTR       ILM
           ,SVC_INV_LINE_TP        ILT
           ,MDSE                   MDS
           ,MDSE                   MD2
           ,PMT_TERM_CASH_DISC     PTC
           ,CR_DR_SUB_RSN          CDS
           ,DS_CONTR               DCN
           ,SVC_CR_REBIL_DTL       CRD
           ,DS_CONTR_CLS           DCC
           ,DS_INV_TP              DIT
           ,DS_CONTR_EDI           DCE
           ,SELL_TO_CUST           SEL
           ,SVC_INV_SRC_TP         IST
           ,CTAC_PSN               PSN
           ,DS_CR_CARD             CAR
           ,SHIP_TO_CUST           STC
           ,CNTY                   CNT
           <!-- START 2020/07/13 K.Kitachi [QC#57304, ADD] -->
           ,CNTY                   SCT
           ,SVC_INV_LINE           PIL
           <!-- END 2020/07/13 K.Kitachi [QC#57304, ADD] -->
        WHERE
            INV.GLBL_CMPY_CD              = #glblCmpyCd#
        AND INV.SVC_INV_STS_CD            = #svcInvStsCd#
        AND INV.SVC_INV_OM_LINK_FLG       = #svcInvOmLinkFlg#
        AND MOD(TO_NUMBER(INV.DS_ACCT_NUM), #multiCalcCnt#) = #divideNum#
        AND INV.SVC_INV_OM_LINK_STS_CD    IN (#inCompleted#, #error#)
        <!-- START 2018/05/31 K.Kojima [QC#23685,ADD] -->
        AND INV.TEMP_SVC_INV_NUM_FLG      = 'N'
        <!-- END 2018/05/31 K.Kojima [QC#23685,ADD] -->
        AND ILN.GLBL_CMPY_CD              = INV.GLBL_CMPY_CD
        AND ILN.SVC_INV_NUM               = INV.SVC_INV_NUM
        AND ILM.GLBL_CMPY_CD          (+) = ILN.GLBL_CMPY_CD
        AND ILM.SVC_INV_LINE_PK       (+) = ILN.SVC_INV_LINE_PK
        AND ILT.GLBL_CMPY_CD          (+) = ILN.GLBL_CMPY_CD
        AND ILT.SVC_INV_LINE_TP_CD    (+) = ILN.SVC_INV_LINE_TP_CD
        AND CDS.GLBL_CMPY_CD          (+) = ILN.GLBL_CMPY_CD
        AND CDS.CR_DR_SUB_RSN_CD      (+) = ILN.CR_DR_SUB_RSN_CD
        AND PTC.GLBL_CMPY_CD          (+) = INV.GLBL_CMPY_CD
        AND PTC.PMT_TERM_CASH_DISC_CD (+) = INV.PMT_TERM_CASH_DISC_CD
        AND DCN.GLBL_CMPY_CD          (+) = INV.GLBL_CMPY_CD
        AND DCN.DS_CONTR_PK           (+) = INV.DS_CONTR_PK
        AND CRD.GLBL_CMPY_CD          (+) = INV.GLBL_CMPY_CD
        AND CRD.SVC_CR_REBIL_DTL_PK   (+) = INV.SVC_CR_REBIL_DTL_PK
        AND DCC.GLBL_CMPY_CD          (+) = DCN.GLBL_CMPY_CD
        AND DCC.DS_CONTR_CLS_CD       (+) = DCN.DS_CONTR_CLS_CD
        AND DIT.GLBL_CMPY_CD          (+) = DCC.GLBL_CMPY_CD
        AND DIT.DS_INV_TP_CD          (+) = DCC.DS_INV_TP_CD
        AND DCE.GLBL_CMPY_CD          (+) = DCN.GLBL_CMPY_CD
        AND DCE.DS_CONTR_EDI_CD       (+) = DCN.DS_CONTR_EDI_CD
        AND SEL.GLBL_CMPY_CD          (+) = INV.GLBL_CMPY_CD
        AND SEL.SELL_TO_CUST_CD       (+) = INV.DS_ACCT_NUM
        AND IST.GLBL_CMPY_CD          (+) = INV.GLBL_CMPY_CD
        AND IST.SVC_INV_SRC_TP_CD     (+) = INV.SVC_INV_SRC_TP_CD
        AND PSN.GLBL_CMPY_CD          (+) = INV.GLBL_CMPY_CD
        AND PSN.CTAC_PSN_PK           (+) = INV.CTAC_PSN_PK
        AND MDS.GLBL_CMPY_CD          (+) = ILN.GLBL_CMPY_CD
        AND MDS.MDSE_CD               (+) = ILN.MDSE_CD
        AND MD2.GLBL_CMPY_CD          (+) = ILN.GLBL_CMPY_CD
        AND MD2.MDSE_CD               (+) = ILN.INTG_MDSE_CD
        AND CAR.GLBL_CMPY_CD          (+) = INV.GLBL_CMPY_CD
        AND CAR.CR_CARD_CUST_REF_NUM  (+) = INV.CR_CARD_CUST_REF_NUM
        AND STC.GLBL_CMPY_CD          (+) = ILN.GLBL_CMPY_CD
        AND STC.SHIP_TO_CUST_CD       (+) = ILN.SHIP_TO_CUST_CD
        AND CNT.GLBL_CMPY_CD          (+) = STC.GLBL_CMPY_CD
        AND CNT.CNTY_PK               (+) = STC.CNTY_PK
        AND INV.EZCANCELFLAG              = '0'
        AND ILN.EZCANCELFLAG              = '0'
        AND ILM.EZCANCELFLAG          (+) = '0'
        AND ILT.EZCANCELFLAG          (+) = '0'
        AND MDS.EZCANCELFLAG          (+) = '0'
        AND MD2.EZCANCELFLAG          (+) = '0'
        AND CDS.EZCANCELFLAG          (+) = '0'
        AND PTC.EZCANCELFLAG          (+) = '0'
        AND DCN.EZCANCELFLAG          (+) = '0'
        AND CRD.EZCANCELFLAG          (+) = '0'
        AND DCC.EZCANCELFLAG          (+) = '0'
        AND DIT.EZCANCELFLAG          (+) = '0'
        AND DCE.EZCANCELFLAG          (+) = '0'
        AND SEL.EZCANCELFLAG          (+) = '0'
        AND IST.EZCANCELFLAG          (+) = '0'
        AND PSN.EZCANCELFLAG          (+) = '0'
        AND CAR.EZCANCELFLAG          (+) = '0'
        AND STC.EZCANCELFLAG          (+) = '0'
        AND CNT.EZCANCELFLAG          (+) = '0'
        <!-- START 2020/07/13 K.Kitachi [QC#57304, ADD] -->
        AND SEL.GLBL_CMPY_CD              = SCT.GLBL_CMPY_CD (+)
        AND SEL.CNTY_PK                   = SCT.CNTY_PK (+)
        AND SCT.EZCANCELFLAG          (+) = '0'
        AND ILN.GLBL_CMPY_CD              = PIL.GLBL_CMPY_CD (+)
        AND ILN.PRNT_SVC_INV_LINE_PK      = PIL.SVC_INV_LINE_PK (+)
        AND PIL.EZCANCELFLAG          (+) = '0'
        <!-- END 2020/07/13 K.Kitachi [QC#57304, ADD] -->
        <!-- START 2018/07/25 M.Naito [QC#13309, ADD] -->
        AND NOT EXISTS
        (
            SELECT
                1
            FROM
                 TEMP_ETTL    TE
            WHERE
                INV.GLBL_CMPY_CD   = TE.GLBL_CMPY_CD
            AND INV.TEMP_ETTL_NUM  = TE.TEMP_ETTL_NUM
            AND TE.ALL_FSR_CLO_FLG = 'N'
            AND TE.EZCANCELFLAG    = '0'
        )
        <!-- END 2018/07/25 M.Naito [QC#13309, ADD] -->
    ORDER BY
        INV.SVC_INV_NUM
       ,SORT_KEY_SHIP NULLS FIRST
       ,ILN.SVC_INV_LINE_PK
    </statement>

    <statement id="getSvcInvLineTaxDtlList" parameterClass="Map" resultClass="Map">
        SELECT
            <!-- START 2019/02/19 K.Fujimoto [QC#29688,ADD] -->
            /*+ INDEX(ILX SVC_INV_LINE_TAX_DTL_I1) */
            <!-- END 2019/02/19 K.Fujimoto [QC#29688,ADD] -->
            ILN.SVC_INV_NUM                AS SVC_INV_NUM
           ,ILN.SVC_INV_LINE_NUM           AS SVC_INV_LINE_NUM
           ,ILX.DS_SLS_TAX_TP_CD           AS DS_SLS_TAX_TP_CD
           ,ILX.FUNC_TAX_AMT               AS FUNC_TAX_AMT
           ,ILX.DEAL_TAX_AMT               AS DEAL_TAX_AMT
           ,ILX.SLS_TAX_RATE               AS SLS_TAX_RATE_2
<!-- START 2017/08/07 M.Kidokoro [QC#20073, ADD] -->
           ,ILX.TAX_AREA_ID                AS TAX_AREA_ID
<!-- END 2017/08/07 M.Kidokoro [QC#20073, ADD] -->
        FROM
            SVC_INV_LINE           ILN
           ,SVC_INV_LINE_TAX_DTL   ILX
        WHERE
                ILN.GLBL_CMPY_CD              = #glblCmpyCd#
            AND ILN.SVC_INV_LINE_PK           = #svcInvLinePk#
            AND ILN.GLBL_CMPY_CD              = ILX.GLBL_CMPY_CD
            AND ILN.SVC_INV_LINE_PK           = ILX.SVC_INV_LINE_PK
            AND ILN.EZCANCELFLAG              = '0'
            AND ILX.EZCANCELFLAG              = '0'
        ORDER BY
            ILX.SVC_INV_LINE_TAX_DTL_PK
    </statement>

    <statement id="getSvcInvLineAllocList" parameterClass="Map" resultClass="Map">
        SELECT
            <!-- START 2018/10/24 K.Kitachi [QC#28579, ADD] -->
            /*+ INDEX(INA SVC_INV_LINE_ALLOC_I1) */
            <!-- END 2018/10/24 K.Kitachi [QC#28579, ADD] -->
            --** for Invoice Line Sales Credit Parameter ** --
            ILN.SVC_INV_NUM                AS SVC_INV_NUM
           ,ILN.SVC_INV_LINE_NUM           AS SVC_INV_LINE_NUM
           ,NVL(ILNP.SVC_INV_CHRG_TP_CD, ILN.SVC_INV_CHRG_TP_CD)
                                           AS SVC_INV_CHRG_TP_CD
           ,NVL(DCP.BASE_BLLG_TMG_CD, DCD.BASE_BLLG_TMG_CD)
                                           AS BASE_BLLG_TMG_CD
           ,NVL(DCP.MTR_BLLG_TMG_CD, DCD.MTR_BLLG_TMG_CD)
                                           AS MTR_BLLG_TMG_CD
           ,INA.INTG_MDSE_CD               AS INTG_MDSE_CD
           ,INA.SVC_INV_LINE_ALLOC_PK      AS SVC_INV_LINE_ALLOC_PK
           ,INA.SVC_INV_LINE_ALLOC_NUM     AS SVC_INV_LINE_ALLOC_NUM
           ,INA.INV_LINE_SPL_TP_CD         AS INV_LINE_SPL_TP_CD
           ,INA.SLS_ALLOC_RATE             AS SLS_ALLOC_RATE
           ,INA.TOC_CD                     AS TOC_CD
           ,INA.INV_LINE_DEAL_NET_AMT      AS INV_LINE_DEAL_NET_AMT_2
           ,INA.INV_LINE_FUNC_NET_AMT      AS INV_LINE_FUNC_NET_AMT_2
           ,INA.CCY_CD                     AS CCY_CD
           ,INA.DFRD_ACCTG_RULE_CD         AS DFRD_ACCTG_RULE_CD
           ,INA.DFRD_ACCTG_RULE_DURN_AOT   AS DFRD_ACCTG_RULE_DURN_AOT
           ,ORG.COA_BR_CD                  AS COA_BR_CD_ORG
           ,INA.COA_CMPY_CD                AS COA_CMPY_CD
           ,INA.COA_AFFL_CD                AS COA_AFFL_CD
           ,INA.COA_BR_CD                  AS COA_BR_CD
           ,INA.COA_CH_CD                  AS COA_CH_CD
           ,INA.COA_CC_CD                  AS COA_CC_CD
           ,INA.COA_ACCT_CD                AS COA_ACCT_CD
           ,INA.COA_PROD_CD                AS COA_PROD_CD
           ,INA.COA_PROJ_CD                AS COA_PROJ_CD
           ,INA.COA_EXTN_CD                AS COA_EXTN_CD
           ,INA.TRX_CD                     AS TRX_CD
           ,INA.TRX_RSN_CD                 AS TRX_RSN_CD
           ,INA.AJE_INV_LINE_ALLOC_CD      AS AJE_INV_LINE_ALLOC_CD
           ,IH.INV_TP_CD                   AS INV_TP_CD
        FROM
            SVC_INV_LINE           ILN
           ,SVC_INV                IH
           ,SVC_INV_LINE           ILNP
           ,SVC_INV_LINE_ALLOC     INA
           ,S21_ORG                ORG
           ,DS_CONTR_DTL           DCD
           ,DS_CONTR_DTL           DCP
        WHERE
                ILN.GLBL_CMPY_CD              = #glblCmpyCd#
            AND ILN.SVC_INV_LINE_PK           = #svcInvLinePk#
            AND ILN.GLBL_CMPY_CD              = IH.GLBL_CMPY_CD
            AND ILN.SVC_INV_NUM               = IH.SVC_INV_NUM
            AND ILN.GLBL_CMPY_CD              = INA.GLBL_CMPY_CD
            AND ILN.SVC_INV_LINE_PK           = INA.SVC_INV_LINE_PK
            AND ILN.GLBL_CMPY_CD              = ILNP.GLBL_CMPY_CD(+)
            AND ILN.PRNT_SVC_INV_LINE_PK      = ILNP.SVC_INV_LINE_PK(+)
            AND ILN.GLBL_CMPY_CD              = INA.GLBL_CMPY_CD
            AND ILN.SVC_INV_LINE_PK           = INA.SVC_INV_LINE_PK
            AND INA.GLBL_CMPY_CD              = ORG.GLBL_CMPY_CD(+)
            AND INA.TOC_CD                    = ORG.TOC_CD(+)
            AND ILN.GLBL_CMPY_CD              = DCD.GLBL_CMPY_CD(+)
            AND ILN.DS_CONTR_DTL_PK           = DCD.DS_CONTR_DTL_PK(+)
            AND DCD.GLBL_CMPY_CD              = DCP.GLBL_CMPY_CD(+)
            AND DCD.PRNT_DS_CONTR_DTL_PK      = DCP.DS_CONTR_DTL_PK(+)
            AND ILN.EZCANCELFLAG              = '0'
            AND IH.EZCANCELFLAG               = '0'
            AND ILNP.EZCANCELFLAG(+)          = '0'
            AND INA.EZCANCELFLAG              = '0'
            AND ORG.EZCANCELFLAG(+)           = '0'
            AND DCD.EZCANCELFLAG(+)           = '0'
            AND DCP.EZCANCELFLAG(+)           = '0'
        ORDER BY
            INA.SVC_INV_LINE_ALLOC_PK
    </statement>

    <statement id="getInvCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            INV            INV
        WHERE
            INV.GLBL_CMPY_CD = #glblCmpyCd#
        AND INV.INV_NUM      = #invNum#
        AND INV.EZCANCELFLAG = '0'
    </statement>

    <statement id="getContrRnwTotCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            MAX(DCD.CONTR_RNW_TOT_CNT) AS CONTR_RNW_TOT_CNT
        FROM
            ( SELECT
                   ILN.GLBL_CMPY_CD          AS GLBL_CMPY_CD
                  ,ILN.DS_CONTR_PK           AS DS_CONTR_PK
                  ,MAX(ILN.BLLG_PER_THRU_DT) AS BLLG_PER_THRU_DT
              FROM
                  SVC_INV_LINE ILN
              WHERE
                      ILN.GLBL_CMPY_CD = #glblCmpyCd#
                  AND ILN.SVC_INV_NUM  = #svcInvNum#
                  AND ILN.EZCANCELFLAG = '0'
              GROUP BY
                   ILN.GLBL_CMPY_CD
                  ,ILN.DS_CONTR_PK
            ) BTD
            , DS_CONTR_DTL DCD
        WHERE
                BTD.GLBL_CMPY_CD    =     DCD.GLBL_CMPY_CD
            AND BTD.DS_CONTR_PK     =     DCD.DS_CONTR_PK
            AND DCD.RNW_EFF_FROM_DT &lt;= BTD.BLLG_PER_THRU_DT
            AND DCD.EZCANCELFLAG    =     '0'
    </statement>
<!-- START 2019/03/01 S.Kitamura [QC#30496, DEL] -->
<!--
    <statement id="getNegativeMeterCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             SVC_INV          INV
            ,SVC_INV_LINE_MTR ILM
        WHERE
                INV.GLBL_CMPY_CD = #glblCmpyCd#
            AND INV.SVC_INV_NUM  = #svcInvNum#
            AND INV.GLBL_CMPY_CD = ILM.GLBL_CMPY_CD
            AND INV.SVC_INV_NUM  = ILM.SVC_INV_NUM
            AND (
                    ILM.PREV_TOT_COPY_QTY &lt; 0
                 OR ILM.TOT_COPY_QTY      &lt; 0
                 OR ILM.PREV_TOT_COPY_QTY - ILM.TOT_COPY_QTY &gt; 0
                )
            AND INV.EZCANCELFLAG = '0'
            AND ILM.EZCANCELFLAG = '0'
    </statement>
-->
<!-- END 2019/03/01 S.Kitamura [QC#30496, DEL] -->
    <statement id="getReviewAmtDiffCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS CNT
        FROM
            (  SELECT
                    GLBL_CMPY_CD
                   ,SVC_INV_NUM
                   ,SUM(INV_LINE_DEAL_NET_AMT) AS INV_LINE_DEAL_NET_AMT
                   ,SUM(INV_LINE_DEAL_TAX_AMT) AS INV_LINE_DEAL_TAX_AMT
               FROM
                   SVC_INV_LINE
               WHERE
                       GLBL_CMPY_CD = #glblCmpyCd#
                   AND SVC_INV_NUM  = #svcInvNum#
                   AND EZCANCELFLAG = '0'
               GROUP BY
                    GLBL_CMPY_CD
                   ,SVC_INV_NUM
            ) INL
            , SVC_INV INV
        WHERE
                INL.GLBL_CMPY_CD = INV.GLBL_CMPY_CD
            AND INL.SVC_INV_NUM  = INV.SVC_INV_NUM
            AND (NVL(INL.INV_LINE_DEAL_NET_AMT,0) + NVL(INV_LINE_DEAL_TAX_AMT,0))
                &lt;&gt;
                (NVL(INV.INV_TOT_DEAL_NET_AMT,0)  + NVL(INV.INV_TOT_DEAL_TAX_AMT,0))
            AND INV.EZCANCELFLAG = '0'
    </statement>
    <statement id="getReviewMeterAmtDiffCnt" parameterClass="Map" resultClass="BigDecimal">
        <!-- START 2021/03/08 R.Mercado [QC#58471,MOD] -->
        <!-- SELECT -->
        <!--     COUNT(*) -->
        <!-- FROM -->
        <!--     SVC_INV_LINE ILN -->
        <!-- WHERE -->
        <!--         ILN.GLBL_CMPY_CD       = #glblCmpyCd# -->
        <!--     AND ILN.SVC_INV_NUM        = #svcInvNum# -->
        <!--     AND ILN.SVC_INV_LINE_TP_CD = #svcInvLineTpCd# -->
        <!--     AND ILN.SVC_INV_CHRG_TP_CD = #svcInvChrgTpCdMc# -->
        <!--     AND ILN.EZCANCELFLAG = '0' -->
        <!--     AND EXISTS -->
        <!--     ( -->
        <!--         SELECT -->
        <!--             1 -->
        <!--         FROM -->
        <!--              SVC_INV_LINE_MTR    ILM -->
        <!--             ,SVC_INV_LINE_XS_MTR ILX -->
        <!--             ,CCY                 CCY -->
        <!--         WHERE -->
        <!--             ILN.GLBL_CMPY_CD            = ILM.GLBL_CMPY_CD -->
        <!--             AND ILN.SVC_INV_LINE_PK     = ILM.SVC_INV_LINE_PK -->
        <!--             AND ILM.GLBL_CMPY_CD        = ILX.GLBL_CMPY_CD -->
        <!--             AND ILM.SVC_INV_LINE_MTR_PK = ILX.SVC_INV_LINE_MTR_PK -->
        <!--             AND ILX.GLBL_CMPY_CD        = CCY.GLBL_CMPY_CD -->
        <!--             AND ILX.CCY_CD              = CCY.CCY_CD -->
        <!--             AND ILN.INV_LINE_DEAL_NET_AMT     &lt;&gt; -->
                        <!-- START 2017/11/16 K.Kojima [QC#22437,MOD] -->
                        <!-- ROUND(ILM.CONTR_MTR_MULT_RATE * -->
                        <!--       ILX.XS_MTR_AMT_RATE * -->
                        <!--       ILX.XS_MTR_COPY_QTY -->
                        <!--       , CCY.AFT_DECL_PNT_DIGIT_NUM) -->
        <!--                 ROUND(ILX.XS_MTR_AMT_RATE * -->
        <!--                 ILX.XS_MTR_COPY_QTY -->
        <!--                 , CCY.AFT_DECL_PNT_DIGIT_NUM) -->
                        <!-- EMD 2017/11/16 K.Kojima [QC#22437,MOD] -->
        <!--             AND ILM.EZCANCELFLAG        = '0' -->
        <!--             AND ILX.EZCANCELFLAG        = '0' -->
        <!--             AND CCY.EZCANCELFLAG        = '0' -->
        <!--     ) -->
        WITH SVC_INV_LINE_XS_MTR_SUMMARY AS 
             (SELECT 
                   X.SVC_INV_LINE_PK
                  ,SUM(X.XS_MTR_CHRG_DEAL_AMT) AS TOT_XS_AMT
              FROM 
                   SVC_INV_LINE        SIL
                  ,SVC_INV_LINE_XS_MTR X
              WHERE 
                      SIL.GLBL_CMPY_CD       = X.GLBL_CMPY_CD
                  AND SIL.SVC_INV_LINE_PK    = X.SVC_INV_LINE_PK
                  AND SIL.GLBL_CMPY_CD       = #glblCmpyCd#
                  AND SIL.EZCANCELFLAG       = '0'
                  AND X.EZCANCELFLAG         = '0'
                  AND SIL.SVC_INV_LINE_TP_CD = #svcInvLineTpCd#
                  AND SIL.SVC_INV_CHRG_TP_CD = #svcInvChrgTpCdMc#
                  AND SIL.SVC_INV_NUM        = #svcInvNum#
              GROUP BY X.SVC_INV_LINE_PK
              )
        SELECT 
             COUNT(*)
        FROM 
             SVC_INV_LINE                SIL2
            ,SVC_INV_LINE_XS_MTR_SUMMARY XSUM
        WHERE 
                SIL2.SVC_INV_LINE_PK    = XSUM.SVC_INV_LINE_PK
            AND SIL2.GLBL_CMPY_CD       = #glblCmpyCd#
            AND SIL2.EZCANCELFLAG       = '0'
            AND SIL2.SVC_INV_LINE_TP_CD = #svcInvLineTpCd#
            AND SIL2.SVC_INV_CHRG_TP_CD = #svcInvChrgTpCdMc#
            AND SIL2.SVC_INV_NUM        = #svcInvNum#
            AND SIL2.INV_LINE_DEAL_NET_AMT &lt;&gt; XSUM.TOT_XS_AMT
        ORDER BY 
             SIL2.SVC_INV_NUM 
            ,SIL2.SVC_INV_LINE_NUM
        <!-- END 2021/03/08 R.Mercado [QC#58471,MOD] -->
    </statement>
    <statement id="getInvLineCnt" parameterClass="Map" resultClass="Map">
        SELECT
             NVL(SER.CNT,0) AS SER_CNT
            ,NVL(TIE.CNT,0) AS TIE_CNT
            ,NVL(BCG.CNT,0) AS BCG_CNT
            ,NVL(PGM.CNT,0) AS PGM_CNT
        FROM
             (SELECT
                   GLBL_CMPY_CD
                  ,SVC_INV_NUM
                  ,COUNT(SER_NUM) AS CNT
              FROM
                  SVC_INV_LINE
              WHERE
                      GLBL_CMPY_CD       = #glblCmpyCd#
                  AND SVC_INV_NUM        = #svcInvNum#
                  AND EZCANCELFLAG       = '0'
              GROUP BY
                   GLBL_CMPY_CD
                  ,SVC_INV_NUM
                  
             ) SER
             ,(SELECT
                   ILN.GLBL_CMPY_CD
                  ,ILN.SVC_INV_NUM
                  ,COUNT(ILX.SVC_INV_LINE_PK) AS CNT
              FROM
                   SVC_INV_LINE        ILN
                  ,SVC_INV_LINE_XS_MTR ILX
              WHERE
                      ILN.GLBL_CMPY_CD       = #glblCmpyCd#
                  AND ILN.SVC_INV_NUM        = #svcInvNum#
                  <isNotNull property="svcInvLineTpCd">
                  AND ILN.SVC_INV_LINE_TP_CD = #svcInvLineTpCd#
                  </isNotNull>
                  AND ILN.EZCANCELFLAG       = '0'
                  AND ILN.GLBL_CMPY_CD       = ILX.GLBL_CMPY_CD(+)
                  AND ILN.SVC_INV_LINE_PK    = ILX.SVC_INV_LINE_PK(+)
                  AND ILX.EZCANCELFLAG(+)    = '0'
              GROUP BY
                   ILN.GLBL_CMPY_CD
                  ,ILN.SVC_INV_NUM
              ) TIE
            ,(SELECT
                   GLBL_CMPY_CD
                  ,SVC_INV_NUM
                  ,COUNT(SVC_INV_CHRG_TP_CD) AS CNT
              FROM
                  SVC_INV_LINE
              WHERE
                      GLBL_CMPY_CD       = #glblCmpyCd#
                  AND SVC_INV_NUM        = #svcInvNum#
                  AND SVC_INV_CHRG_TP_CD = #svcInvChrgTpCd#
                  AND EZCANCELFLAG       = '0'
              GROUP BY
                   GLBL_CMPY_CD
                  ,SVC_INV_NUM
                  
             ) BCG
             ,(SELECT
                   GLBL_CMPY_CD
                  ,SVC_INV_NUM
                  ,COUNT(SVC_PGM_MDSE_CD) AS CNT
              FROM
                  SVC_INV_LINE
              WHERE
                      GLBL_CMPY_CD       = #glblCmpyCd#
                  AND SVC_INV_NUM        = #svcInvNum#
                  AND EZCANCELFLAG       = '0'
              GROUP BY
                   GLBL_CMPY_CD
                  ,SVC_INV_NUM
                  
             ) PGM
        WHERE
                SER.GLBL_CMPY_CD = TIE.GLBL_CMPY_CD
            AND SER.SVC_INV_NUM  = TIE.SVC_INV_NUM
            AND SER.GLBL_CMPY_CD = BCG.GLBL_CMPY_CD
            AND SER.SVC_INV_NUM  = BCG.SVC_INV_NUM
            AND SER.GLBL_CMPY_CD = PGM.GLBL_CMPY_CD
            AND SER.SVC_INV_NUM  = PGM.SVC_INV_NUM
    </statement>
    <statement id="getSvcInvPgLineHgtList" parameterClass="Map" resultClass="Map">
        SELECT
             SVC_INV_PG_LYOT_CD
            ,SVC_INV_PG_LINE_HGT
        FROM
            SVC_INV_PG_LYOT
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND EZCANCELFLAG = '0'
        ORDER BY
            SVC_INV_PG_LYOT_CD
    </statement>
    <!-- START 2018/05/31 K.Kojima [QC#23685,ADD] -->
    <statement id="getAcctDlyActlExchRates" parameterClass="Map" resultClass="Map">
        SELECT
             CCY_CD
            ,ACTL_EXCH_RATE_ENT_DT
            ,GLBL_CMPY_CD
        FROM
            (
                SELECT
                     ADAXR.CCY_CD
                    ,ADAXR.ACTL_EXCH_RATE_ENT_DT
                    ,ADAXR.GLBL_CMPY_CD
                    ,ROW_NUMBER() OVER(ORDER BY ADAXR.ACTL_EXCH_RATE_ENT_DT DESC) ROW_NUM
                FROM
                    ACCT_DLY_ACTL_EXCH_RATES ADAXR
                WHERE
                        ADAXR.GLBL_CMPY_CD              = #glblCmpyCd#
                    AND ADAXR.CCY_CD                    = #ccyCd#
                    AND ADAXR.ACTL_EXCH_RATE            IS NOT NULL
                    AND ADAXR.ACTL_EXCH_RATE_ENT_DT &lt;= #actlExchRateEntDt#
                    AND ADAXR.EZCANCELFLAG              =        '0'
            )
        WHERE
            ROW_NUM = 1
    </statement>
    <!-- END 2018/05/31 K.Kojima [QC#23685,ADD] -->

    <!-- START 2018/07/25 M.Naito [QC#13309, ADD] -->
    <statement id="getClosedTempEttlInfo" parameterClass="Map" resultClass="Map">
        SELECT
            TE.TEMP_ETTL_NUM
        FROM
             TEMP_ETTL TE
        WHERE
            TE.GLBL_CMPY_CD = #glblCmpyCd#
    <!-- START 2018/08/30 M.Naito [QC#13309, MOD] -->
        AND TE.EFF_THRU_DT  &lt;= TO_CHAR((TO_DATE(#slsDt#, 'YYYYMMDD') - 1), 'YYYYMMDD')
    <!-- END 2018/08/30 M.Naito [QC#13309, MOD] -->
        AND TE.INV_CPLT_FLG = 'N'
        AND TE.EZCANCELFLAG = '0'
        <!-- del start 2019/04/03 QC#31037 -->
        <!-- AND MOD(TO_NUMBER(TE.DS_ACCT_NUM), #multiCalcCnt#) = #divideNum# -->
        <!-- del end 2019/04/03 QC#31037 -->
        AND NOT EXISTS
        (
            SELECT
                1
            FROM
                 FSR          FSR
                ,SVC_TASK_STS STS
            WHERE
                TE.GLBL_CMPY_CD   = FSR.GLBL_CMPY_CD
            AND TE.TEMP_ETTL_NUM  = FSR.TEMP_ETTL_NUM
            AND FSR.EZCANCELFLAG  = '0'
            AND FSR.GLBL_CMPY_CD  = STS.GLBL_CMPY_CD
            AND FSR.FSR_STS_CD    = STS.SVC_TASK_STS_CD
            AND STS.OPEN_TASK_FLG = 'Y'
            AND STS.EZCANCELFLAG  = '0'
        )
    </statement>

    <statement id="getSvcInvInfoForStandByFee" parameterClass="Map" resultClass="Map">
        SELECT
             TE.TEMP_ETTL_NUM
            ,TE.DS_ACCT_NUM
            ,TED.SVC_MACH_MSTR_PK
            ,TED.STAND_BY_FEE_AMT
            ,TED.CUST_PO_NUM
            ,SMM.SER_NUM
            ,SMM.MDSE_CD
            ,SMM.BILL_TO_LOC_NUM
            ,SMM.CUR_LOC_NUM
            ,SMM.SVC_BY_LINE_BIZ_TP_CD
            ,SMM.CTRL_FLD_TXT_01
            ,SMM.CTRL_FLD_TXT_02
            ,SMM.CTRL_FLD_TXT_03
            ,SMM.CTRL_FLD_TXT_04
            ,SMM.CTRL_FLD_TXT_05
            ,SMM.CTRL_FLD_TXT_06
            <!-- START 2018/09/10 K.Kitachi [QC#26260, ADD] -->
            ,SMM.SLD_BY_LINE_BIZ_TP_CD
            <!-- END 2018/09/10 K.Kitachi [QC#26260, ADD] -->
        FROM
             TEMP_ETTL     TE
            ,TEMP_ETTL_DTL TED
            ,SVC_MACH_MSTR SMM
        WHERE
            TE.GLBL_CMPY_CD      = #glblCmpyCd#
        AND TE.TEMP_ETTL_NUM     = #tempEttlNum#
        AND TE.EZCANCELFLAG      = '0'
        AND TE.GLBL_CMPY_CD      = TED.GLBL_CMPY_CD
        AND TE.TEMP_ETTL_NUM     = TED.TEMP_ETTL_NUM
        AND TED.EZCANCELFLAG     = '0'
        AND TED.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
        AND TED.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
        AND SMM.EZCANCELFLAG     = '0'
        ORDER BY
            SMM.SER_NUM
    </statement>

    <statement id="getMdl" parameterClass="Map" resultClass="Map">
        SELECT
             C.MDL_ID    AS MDL_ID
            ,D.T_MDL_NM  AS MDL_NM
        FROM
             SVC_MACH_MSTR    A
            ,SVC_CONFIG_MSTR  B
            ,DS_MDL           C
            ,MDL_NM           D
        WHERE
            A.GLBL_CMPY_CD        = #glblCmpyCd#
        AND A.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
        AND A.EZCANCELFLAG        = '0'
        AND A.GLBL_CMPY_CD        = B.GLBL_CMPY_CD
        AND A.SVC_CONFIG_MSTR_PK  = B.SVC_CONFIG_MSTR_PK
        AND B.EZCANCELFLAG        = '0'
        AND B.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
        AND B.MDL_ID              = C.MDL_ID
        AND C.EZCANCELFLAG        = '0'
        AND C.GLBL_CMPY_CD        = D.T_GLBL_CMPY_CD
        AND C.MDL_ID              = D.T_MDL_ID
        AND D.EZCANCELFLAG        = '0'
    </statement>

    <statement id="getMdlInfoFromConfigMstrDtl" parameterClass="Map" resultClass="Map">
        SELECT
             MN.T_MDL_ID   AS MDL_ID
            ,MN.T_MDL_NM   AS MDL_NM
        FROM
            MDL_NM      MN
        WHERE
            MN.T_GLBL_CMPY_CD = #glblCmpyCd#
        AND MN.EZCANCELFLAG   = '0'
        AND MN.T_MDL_ID       =
            (
                SELECT
                     X.MDL_ID
                FROM
                (
                    SELECT
                         SCM.MDL_ID
                    FROM
                        SVC_CONFIG_MSTR_DTL     SCM
                    WHERE
                        SCM.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND SCM.EZCANCELFLAG      = '0'
                    AND SCM.SVC_MACH_MSTR_PK  = #svcMachMstrPk#
                    ORDER BY
                        SCM.SVC_MACH_RMV_DT DESC NULLS FIRST
                ) X
                WHERE
                    ROWNUM = 1
            )
    </statement>

    <statement id="getCustPmtTerm" parameterClass="Map" resultClass="Map">
        SELECT
             CCP.PMT_TERM_CASH_DISC_CD
            ,PTC.PMT_TERM_CASH_DISC_DESC_TXT
            ,PTC.PMT_TERM_CD
            ,PT.PMT_TERM_AOT
        FROM
             CUST_CR_PRFL       CCP
            ,PMT_TERM_CASH_DISC PTC
            ,PMT_TERM           PT
        WHERE
            CCP.EZCANCELFLAG          = '0'
        AND CCP.GLBL_CMPY_CD          = #glblCmpyCd#
        AND CCP.BILL_TO_CUST_CD       = #billToCustCd#
        AND PTC.EZCANCELFLAG          = '0'
        AND CCP.GLBL_CMPY_CD          = PTC.GLBL_CMPY_CD
        AND CCP.PMT_TERM_CASH_DISC_CD = PTC.PMT_TERM_CASH_DISC_CD
        AND PT.EZCANCELFLAG           = '0'
        AND PTC.GLBL_CMPY_CD          = PT.GLBL_CMPY_CD
        AND PTC.PMT_TERM_CD           = PT.PMT_TERM_CD
    </statement>

    <statement id="getAcctPmtTerm" parameterClass="Map" resultClass="Map">
        SELECT
             DAC.PMT_TERM_CASH_DISC_CD
            ,PTC.PMT_TERM_CASH_DISC_DESC_TXT
            ,PTC.PMT_TERM_CD
            ,PT.PMT_TERM_AOT
        FROM
             BILL_TO_CUST       BTC
            ,DS_ACCT_CR_PRFL    DAC
            ,PMT_TERM_CASH_DISC PTC
            ,PMT_TERM           PT
        WHERE
            BTC.EZCANCELFLAG          = '0'
        AND BTC.GLBL_CMPY_CD          = #glblCmpyCd#
        AND BTC.BILL_TO_CUST_CD       = #billToCustCd#
        AND DAC.EZCANCELFLAG          = '0'
        AND BTC.GLBL_CMPY_CD          = DAC.GLBL_CMPY_CD
        AND BTC.SELL_TO_CUST_CD       = DAC.DS_ACCT_NUM
        AND PTC.EZCANCELFLAG          = '0'
        AND DAC.GLBL_CMPY_CD          = PTC.GLBL_CMPY_CD
        AND DAC.PMT_TERM_CASH_DISC_CD = PTC.PMT_TERM_CASH_DISC_CD
        AND PT.EZCANCELFLAG           = '0'
        AND PTC.GLBL_CMPY_CD          = PT.GLBL_CMPY_CD
        AND PTC.PMT_TERM_CD           = PT.PMT_TERM_CD
    </statement>

    <statement id="getBillToCust" parameterClass="Map" resultClass="Map">
        SELECT
            BTC.LOC_NM
           ,BTC.ADDL_LOC_NM
           ,BTC.FIRST_LINE_ADDR
           ,BTC.SCD_LINE_ADDR
           ,BTC.THIRD_LINE_ADDR
           ,BTC.FRTH_LINE_ADDR
           ,BTC.CTY_ADDR
           ,BTC.PROV_NM
           ,C.CNTY_NM
           ,BTC.ST_CD
           ,BTC.POST_CD
           ,BTC.CTRY_CD
           ,BTC.FIRST_REF_CMNT_TXT
           ,BTC.SCD_REF_CMNT_TXT
           ,BTC.SELL_TO_CUST_CD
           ,STC.COA_AFFL_CD
           ,STC.COA_CH_CD
           ,RT.REM_ID
           ,RT.LOC_NM
           ,RT.ADDL_LOC_NM
        FROM
            BILL_TO_CUST     BTC
           ,CNTY             C
           ,SELL_TO_CUST     STC
           ,REM_TO           RT
        WHERE
            BTC.GLBL_CMPY_CD        = #glblCmpyCd#
        AND BTC.BILL_TO_CUST_CD     = #billToCustCd#
        AND BTC.EZCANCELFLAG        = '0'
        AND BTC.GLBL_CMPY_CD        = C.GLBL_CMPY_CD(+)
        AND BTC.CNTY_PK             = C.CNTY_PK(+)
        AND C.EZCANCELFLAG(+)       = '0'
        AND BTC.GLBL_CMPY_CD        = STC.GLBL_CMPY_CD
        AND BTC.SELL_TO_CUST_CD     = STC.SELL_TO_CUST_CD
        AND RT.EZCANCELFLAG          = '0'
        AND BTC.GLBL_CMPY_CD        = RT.GLBL_CMPY_CD
        AND BTC.REM_ID              = RT.REM_ID
        AND RT.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getCrCardCustRefNum" parameterClass="Map" resultClass="String">
        SELECT
             CR_CARD_CUST_REF_NUM
        FROM
        (
            SELECT
                 DCC.CR_CARD_CUST_REF_NUM
            FROM
                 DS_CR_CARD DCC
                ,CR_CARD_TP CCT
            WHERE
                DCC.GLBL_CMPY_CD        =  #glblCmpyCd#
            AND DCC.SELL_TO_CUST_CD     =  #sellToCustCd#
            AND DCC.EZCANCELFLAG        = '0'
            AND DCC.CR_CARD_VALID_FLG   = 'Y'
            AND DCC.GLBL_CMPY_CD        = CCT.GLBL_CMPY_CD
            AND DCC.CR_CARD_TP_CD       = CCT.CR_CARD_TP_CD
            AND CCT.EZCANCELFLAG        = '0'
            ORDER BY
                DCC.CR_CARD_EXPR_YR_MTH DESC
               ,DCC.DS_CR_CARD_PK
        )
        WHERE
            ROWNUM = 1
    </statement>

    <statement id="getSlsRepTocCd" parameterClass="Map" resultClass="String">
        <!-- START 2018/09/10 K.Kitachi [QC#26260, MOD] -->
        <!-- SELECT -->
        <!--      SCB.TOC_CD       TOC_CD -->
        <!-- FROM -->
        <!--      SVC_MACH_MSTR    SMM -->
        <!--     ,SUB_CONTR_BR_MAP SCB -->
        <!-- WHERE -->
        <!--     SMM.EZCANCELFLAG          = '0' -->
        <!-- AND SMM.GLBL_CMPY_CD          = #glblCmpyCd# -->
        <!-- AND SMM.SVC_MACH_MSTR_PK      = #svcMachMstrPk# -->
        <!-- AND SCB.EZCANCELFLAG          = '0' -->
        <!-- AND SMM.GLBL_CMPY_CD          = SCB.GLBL_CMPY_CD -->
        <!-- AND SMM.FLD_SVC_BR_CD         = SCB.SVC_CONTR_BR_CD -->
        <!-- AND SMM.SVC_BY_LINE_BIZ_TP_CD = SCB.SVC_LINE_BIZ_CD -->
        <!-- AND SCB.ENBL_FLG              = 'Y' -->
        SELECT
            NVL(SCB2.TOC_CD, SCB.TOC_CD) TOC_CD
        FROM
             SVC_MACH_MSTR    SMM
            ,SUB_CONTR_BR_MAP SCB
            ,SUB_CONTR_BR_MAP SCB2
        WHERE
                SMM.EZCANCELFLAG              = '0'
            AND SMM.GLBL_CMPY_CD              = #glblCmpyCd#
            AND SMM.SVC_MACH_MSTR_PK          = #svcMachMstrPk#
            AND SCB.EZCANCELFLAG          (+) = '0'
            AND SMM.GLBL_CMPY_CD              = SCB.GLBL_CMPY_CD     (+)
            AND SMM.FLD_SVC_BR_CD             = SCB.SVC_CONTR_BR_CD  (+)
            AND SMM.SVC_BY_LINE_BIZ_TP_CD     = SCB.SVC_LINE_BIZ_CD  (+)
            AND SCB.ENBL_FLG              (+) = 'Y'
            AND SCB2.EZCANCELFLAG         (+) = '0'
            AND SMM.GLBL_CMPY_CD              = SCB2.GLBL_CMPY_CD    (+)
            AND SMM.FLD_SVC_BR_CD             = SCB2.SVC_CONTR_BR_CD (+)
            AND SMM.SLD_BY_LINE_BIZ_TP_CD     = SCB2.SVC_LINE_BIZ_CD (+)
            AND SCB2.ENBL_FLG             (+) = 'Y'
        <!-- END 2018/09/10 K.Kitachi [QC#26260, MOD] -->
    </statement>

    <statement id="getDsContrPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            DS_CONTR_PK
        FROM
            (
                SELECT
                     DCD.DS_CONTR_PK
                    ,RANK() OVER(ORDER BY
                         CASE WHEN SBT.LBOR_CHRG_FLG    = #flgN#          THEN 0 ELSE 1 END
                        ,CASE WHEN DCD.DS_CONTR_CATG_CD = #dsContrCatgCd# THEN 0 ELSE 1 END
                        ,NVL(DCD.CONTR_CLO_DT,DCD.CONTR_EFF_THRU_DT) DESC
                        ,DCD.DS_CONTR_NUM) AS CAL_RANK
                FROM
                    (
                        SELECT
                             DC.GLBL_CMPY_CD
                            ,DC.DS_CONTR_PK
                            ,DC.DS_CONTR_CATG_CD
                            ,DC.DS_CONTR_NUM
                            ,DTL.CONTR_EFF_THRU_DT
                            ,DTL.CONTR_CLO_DT
                            ,NVL(FLT.SVC_PGM_MDSE_CD, DTL.SVC_PGM_MDSE_CD) AS SVC_PGM_MDSE_CD
                        FROM
                             DS_CONTR_DTL     DTL
                            ,DS_CONTR         DC
                            ,DS_CONTR_DTL     FLT
                        WHERE
                                DTL.GLBL_CMPY_CD          = #glblCmpyCd#
                            <iterate property="dsContrDtkPkList" var="dsContrDtkPk[]" open="AND DTL.DS_CONTR_DTL_PK IN (" close=")" conjunction=",">
                            #dsContrDtkPk[]#
                            </iterate>
                            AND DTL.GLBL_CMPY_CD          = DC.GLBL_CMPY_CD
                            AND DTL.DS_CONTR_PK           = DC.DS_CONTR_PK
                            AND DC.GLBL_CMPY_CD           = FLT.GLBL_CMPY_CD(+)
                            AND DC.DS_CONTR_PK            = FLT.DS_CONTR_PK(+)
                            AND FLT.DS_CONTR_DTL_TP_CD(+) = #dsContrDtlTpCdFleet#
                            AND DTL.EZCANCELFLAG          = '0'
                            AND DC.EZCANCELFLAG           = '0'
                            AND FLT.EZCANCELFLAG(+)       = '0'
                    ) DCD
                    ,MDSE             MDS
                    ,SVC_COV_TMPL_DTL SCTD
                    ,SVC_BILL_TP      SBT
                WHERE
                        DCD.GLBL_CMPY_CD         = MDS.GLBL_CMPY_CD
                    AND DCD.SVC_PGM_MDSE_CD      = MDS.MDSE_CD
                    AND MDS.GLBL_CMPY_CD         = SCTD.GLBL_CMPY_CD
                    AND MDS.SVC_COV_TMPL_TP_CD   = SCTD.SVC_COV_TMPL_TP_CD
                    AND SCTD.SVC_COV_FEAT_CD     = #svcCovFeatCd#
                    AND SCTD.GLBL_CMPY_CD        = SBT.GLBL_CMPY_CD
                    AND SCTD.SVC_COV_DTL_VAL_TXT = SBT.SVC_BILL_TP_CD
                    AND MDS.EZCANCELFLAG         = '0'
                    AND SCTD.EZCANCELFLAG        = '0'
                    AND SBT.EZCANCELFLAG         = '0'
            )
        WHERE
            CAL_RANK = 1
    </statement>
    <!-- END 2018/07/25 M.Naito [QC#13309, ADD] -->
    <!-- add start 2018/08/09 QC#27329-3 -->
    <statement id="getOrigInvShipTo" parameterClass="Map" resultClass="Map">
        SELECT
             D.INV_NUM                    AS INV_NUM
            ,D.SHIP_TO_LOC_NM             AS SHIP_TO_LOC_NM
            ,D.SHIP_TO_ADDL_LOC_NM        AS SHIP_TO_ADDL_LOC_NM
            ,D.SHIP_TO_FIRST_LINE_ADDR    AS SHIP_TO_FIRST_LINE_ADDR
            ,D.SHIP_TO_SCD_LINE_ADDR      AS SHIP_TO_SCD_LINE_ADDR
            ,D.SHIP_TO_THIRD_LINE_ADDR    AS SHIP_TO_THIRD_LINE_ADDR
            ,D.SHIP_TO_FRTH_LINE_ADDR     AS SHIP_TO_FRTH_LINE_ADDR
            ,D.SHIP_TO_ST_CD              AS SHIP_TO_ST_CD
            ,D.SHIP_TO_PROV_NM            AS SHIP_TO_PROV_NM
            ,D.SHIP_TO_CNTY_NM            AS SHIP_TO_CNTY_NM
            ,D.SHIP_TO_FIRST_REF_CMNT_TXT AS SHIP_TO_FIRST_REF_CMNT_TXT
            ,D.SHIP_TO_SCD_REF_CMNT_TXT   AS SHIP_TO_SCD_REF_CMNT_TXT
            ,D.SHIP_TO_POST_CD            AS SHIP_TO_POST_CD
            ,D.SHIP_TO_CTY_ADDR           AS SHIP_TO_CTY_ADDR
            ,D.SHIP_TO_CTRY_CD            AS SHIP_TO_CTRY_CD
        FROM
             DS_CONTR_BLLG_SCHD  A
            ,SVC_INV_LINE        B
            ,INV_LINE            C
            ,INV_BOL             D
        WHERE
                A.GLBL_CMPY_CD               = #glblCmpyCd#
            AND A.DS_CONTR_BLLG_SCHD_PK      = #dsContrBllgSchdPk#
            AND A.EZCANCELFLAG               = '0'
            AND A.GLBL_CMPY_CD               = B.GLBL_CMPY_CD
            AND A.ORIG_DS_CONTR_BLLG_SCHD_PK = B.DS_CONTR_BLLG_SCHD_PK
            AND B.SVC_INV_NUM                = #svcInvNum#
            AND B.EZCANCELFLAG               = '0'
            AND B.GLBL_CMPY_CD               = C.GLBL_CMPY_CD
            AND B.SVC_INV_LINE_PK            = C.SVC_INV_LINE_PK
            AND C.EZCANCELFLAG               = '0'
            AND C.GLBL_CMPY_CD               = D.GLBL_CMPY_CD
            AND C.INV_NUM                    = D.INV_NUM
            AND C.INV_BOL_LINE_NUM           = D.INV_BOL_LINE_NUM
            AND D.EZCANCELFLAG               = '0'
    </statement>
    <!-- add end 2018/08/09 QC#27329-3 -->
    <!-- add start 2023/11/10 QC#61468 -->
    <statement id="getInvTotDealFrtAmt" parameterClass="Map" resultClass="BigDecimal">
            SELECT
                NVL(SUM(A.INV_LINE_DEAL_SLS_AMT), 0) AS INV_TOT_DEAL_FRT_AMT
            FROM
                SVC_INV_LINE        A
            WHERE
                    A.GLBL_CMPY_CD          = #glblCmpyCd#
                AND A.EZCANCELFLAG          = '0'
                AND A.SVC_INV_NUM           = #svcInvNum#
                AND A.SVC_INV_CHRG_TP_CD    = #chrgTpFC#
     </statement>
     <!-- add end   2023/11/10 QC#61468 -->
</sqlMap>
