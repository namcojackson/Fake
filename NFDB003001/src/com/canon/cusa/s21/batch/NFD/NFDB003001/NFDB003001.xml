<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NFDB003001">

<statement id="getWorkItemTran" parameterClass="Map" resultClass="Map">
        SELECT
             CST.CLT_STRGY_TRX_PK
            ,CST.CLT_ACCT_CD
            ,CST.BILL_TO_CUST_CD
            ,CSWIT.CLT_STRGY_WRK_ITEM_TRX_PK
            ,BTC.LOC_NUM
            ,NVL(CCT.CLT_CUST_TP_NM, CCT_ACCT.CLT_CUST_TP_NM) AS CLT_CUST_TP_NM
            ,SP_BILL.EML_ADDR                       AS EML_ADDR_BILL
            ,SP_ACCT.EML_ADDR                       AS EML_ADDR_ACCT
         FROM
             CLT_STRGY_TRX          CST
            ,CLT_STRGY_WRK_ITEM_TRX CSWIT
            ,BILL_TO_CUST           BTC
            ,CLT_PTFO               CP_BILL
            ,AUTH_PSN               SP_BILL
            ,SELL_TO_CUST           STC
            ,CLT_PTFO               CP_ACCT
            ,AUTH_PSN               SP_ACCT
            <!-- start add 2016/01/11 --> 
            ,CLT_CUST_TP            CCT
            <!-- end 2016/01/11 -->
            <!-- start add 2016/03/18 --> 
            ,CLT_CUST_TP            CCT_ACCT
            <!-- end 2016/03/18 -->
         WHERE
                  CST.GLBL_CMPY_CD                 = #glblCmpyCd#
           AND    CST.CLT_STRGY_STS_CD             = #cltStrgyStsCd#
           <!-- start add 2016/01/11 -->
           AND    CST.CLT_STRGY_CUR_FLG            = #flgY#
           <!-- end 2016/01/11-->
           AND    CSWIT.CLT_WRK_ITEM_RWSD_DT   &lt;= #batProcDt#
           AND    CSWIT.CLT_WRK_ITEM_CD            = #cltWrkItemCd#
           AND    CSWIT.CLT_WRK_ITEM_STS_CD        IN(#cltWrkItemStsCd#, #wrkItmStsOpen#)
           AND    CST.GLBL_CMPY_CD                 = CSWIT.GLBL_CMPY_CD
           AND    CST.CLT_STRGY_TRX_PK             = CSWIT.CLT_STRGY_TRX_PK
           AND    CST.GLBL_CMPY_CD                 = BTC.GLBL_CMPY_CD
           AND    CST.BILL_TO_CUST_CD              = BTC.BILL_TO_CUST_CD
           AND    BTC.GLBL_CMPY_CD                 = CP_BILL.GLBL_CMPY_CD(+)
           AND    BTC.CLT_PTFO_PK                  = CP_BILL.CLT_PTFO_PK(+)
           AND    CP_BILL.GLBL_CMPY_CD             = SP_BILL.GLBL_CMPY_CD(+)
           AND    CP_BILL.CLT_PSN_CD               = SP_BILL.USR_NM(+)
           AND    CST.GLBL_CMPY_CD                 = STC.GLBL_CMPY_CD
           AND    CST.CLT_ACCT_CD                  = STC.SELL_TO_CUST_CD
           AND    STC.GLBL_CMPY_CD                 = CP_ACCT.GLBL_CMPY_CD(+)
           AND    STC.CLT_PTFO_PK                  = CP_ACCT.CLT_PTFO_PK(+)
           AND    CP_ACCT.GLBL_CMPY_CD             = SP_ACCT.GLBL_CMPY_CD(+)
           AND    CP_ACCT.CLT_PSN_CD               = SP_ACCT.USR_NM(+)
           AND    CST.GLBL_CMPY_CD                 = CCT.GLBL_CMPY_CD(+)
           AND    BTC.CLT_CUST_TP_CD               = CCT.CLT_CUST_TP_CD(+)
           AND    CST.GLBL_CMPY_CD                 = CCT_ACCT.GLBL_CMPY_CD(+)
           AND    STC.CLT_CUST_TP_CD               = CCT_ACCT.CLT_CUST_TP_CD(+)
           AND    CST.EZCANCELFLAG                 = '0'
           AND    CSWIT.EZCANCELFLAG               = '0'
           AND    BTC.EZCANCELFLAG                 = '0'
           AND    CP_BILL.EZCANCELFLAG(+)          = '0'
           AND    SP_BILL.EZCANCELFLAG(+)          = '0'
           AND    STC.EZCANCELFLAG                 = '0'
           AND    CP_ACCT.EZCANCELFLAG(+)          = '0'
           AND    SP_ACCT.EZCANCELFLAG(+)          = '0'
           AND    CCT.EZCANCELFLAG(+)              = '0'
           AND    CCT_ACCT.EZCANCELFLAG(+)         = '0'
           <!-- QC#18754 ADD start -->
           AND    NOT EXISTS (
                              SELECT
                                   CSWIT2.CLT_STRGY_WRK_ITEM_TRX_PK
                              FROM
                                   CLT_STRGY_WRK_ITEM_TRX CSWIT2
                              WHERE
                                   CSWIT2.GLBL_CMPY_CD          = CST.GLBL_CMPY_CD
                              AND  CSWIT2.EZCANCELFLAG          = '0'
                              AND  CSWIT2.CLT_STRGY_TRX_PK      = CST.CLT_STRGY_TRX_PK
                              AND  CSWIT2.CLT_WRK_ITEM_RWSD_DT  &lt; CSWIT.CLT_WRK_ITEM_RWSD_DT
                              AND  CSWIT2.CLT_WRK_ITEM_STS_CD   IN(#cltWrkItemStsCd#, #wrkItmStsOpen#)
                              AND  CSWIT2.CLT_WRK_TP_CD         = #wrkTpCd#
                              )
           <!-- QC#18754 ADD end -->
         ORDER BY
                  CSWIT.CLT_STRGY_TRX_PK
                 ,CSWIT.CLT_STRGY_WRK_ITEM_TRX_PK
    </statement>

    <statement id="getArTrxBalList" parameterClass="Map" resultClass="Map">
        SELECT
             ART.AR_TRX_NUM
            ,ART.DEAL_ORIG_GRS_AMT
            ,ART.DEAL_TAX_AMT
            ,ART.DEAL_APPLY_GRS_AMT
            ,ART.DEAL_RMNG_BAL_GRS_AMT
            ,ART.AR_TRX_TP_CD
         FROM
             AR_TRX_BAL ART
         WHERE
                  ART.GLBL_CMPY_CD                 = #glblCmpyCd#
           AND    ART.BILL_TO_CUST_CD              = #billToCustCd#
           <iterate property="arCashApplyStsCdList" var="arCashApplyStsCdList[]" open="AND ART.AR_CASH_APPLY_STS_CD IN (" close=")" conjunction=",">
                 #arCashApplyStsCdList[]#
           </iterate>
           AND    ART.EZCANCELFLAG                 = '0'
         ORDER BY
                  ART.AR_TRX_NUM
    </statement>
</sqlMap>
