<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSAL1130Query">
    <typeAlias alias="NSAL1130_ASMsg" type="business.blap.NSAL1130.NSAL1130_ASMsg"/>

    <statement id="getCounterHistoryList" parameterClass="Map" resultMap="result.getCounterHistoryList">
        SELECT
             END_MTR_READ_DT
            ,MTR_LB_DESC_TXT
            ,OLD_END_READ_MTR_CNT
            <!-- START 2017/09/19 E.Kameishi [QC#18636, MOD] -->
            ,OLD_TEST_MTR_CNT
            <!-- END 2017/09/19 E.Kameishi [QC#18636, MOD] -->
            ,NEW_END_READ_MTR_CNT
            <!-- START 2017/09/19 E.Kameishi [QC#18636, MOD] -->
            ,NEW_TEST_MTR_CNT
            <!-- END 2017/09/19 E.Kameishi [QC#18636, MOD] -->
        FROM (
            SELECT
                 SCRMR.END_MTR_READ_DT
                ,ML.MTR_LB_DESC_TXT
                ,SCRMR.OLD_END_READ_MTR_CNT
                <!-- START 2017/09/19 E.Kameishi [QC#18636, MOD] -->
                ,SCRMR.OLD_TEST_MTR_CNT
                <!-- END 2017/09/19 E.Kameishi [QC#18636, MOD] -->
                ,SCRMR.NEW_END_READ_MTR_CNT
                <!-- START 2017/09/19 E.Kameishi [QC#18636, MOD] -->
                ,SCRMR.NEW_TEST_MTR_CNT
                <!-- END 2017/09/19 E.Kameishi [QC#18636, MOD] -->
            FROM
                SVC_PHYS_MTR SPM
                ,SVC_CR_REBIL_MTR_READ SCRMR
                ,MTR_LB                ML
                <!-- START 2017/09/19 E.Kameishi [QC#18636, ADD] -->
                ,SVC_CR_REBIL_DTL      SCRD
                <!-- END 2017/09/19 E.Kameishi [QC#18636, ADD] -->
            WHERE
                    SPM.GLBL_CMPY_CD                = #glblCmpyCd#
                AND SPM.SVC_MACH_MSTR_PK            = #svcMachMstrPk#
                AND SPM.GLBL_CMPY_CD                = SCRMR.GLBL_CMPY_CD
                AND SPM.SVC_PHYS_MTR_PK             = SCRMR.SVC_PHYS_MTR_PK
                <isNotNull property="mtrLbCd">
                AND SCRMR.PHYS_MTR_LB_CD            = #mtrLbCd#
                </isNotNull>
                <isNotNull property="mtrReadFromDt">
                AND SCRMR.END_MTR_READ_DT       &gt;= #mtrReadFromDt#
                </isNotNull>
                <isNotNull property="mtrReadThruDt">
                AND SCRMR.END_MTR_READ_DT       &lt;= #mtrReadThruDt#
                </isNotNull>
                AND SCRMR.GLBL_CMPY_CD              = ML.GLBL_CMPY_CD
                AND SCRMR.PHYS_MTR_LB_CD            = ML.MTR_LB_CD
                AND SPM.EZCANCELFLAG                = '0'
                AND SCRMR.EZCANCELFLAG              = '0'
                AND ML.EZCANCELFLAG                 = '0'
                <!-- START 2017/09/19 E.Kameishi [QC#18636, ADD] -->
                AND SCRMR.GLBL_CMPY_CD              = SCRD.GLBL_CMPY_CD
                AND SCRMR.SVC_CR_REBIL_DTL_PK       = SCRD.SVC_CR_REBIL_DTL_PK
                AND SCRD.EZCANCELFLAG               = '0'
                <!-- END 2017/09/19 E.Kameishi [QC#18636, ADD] -->
            ORDER BY
                <!-- START 2017/09/19 E.Kameishi [QC#18636, MOD] -->
                <!-- SCRMR.END_MTR_READ_DT DESC -->
                <!-- ,ML.MTR_LB_CD          ASC -->
               SCRD.CUST_INCDT_ID DESC
                <!-- END 2017/09/19 E.Kameishi [QC#18636, MOD] -->
        ) WHERE ROWNUM &lt;= #rowNum#
    </statement>

    <resultMap id="result.getCounterHistoryList" class="NSAL1130_ASMsg">
        <result property="endMtrReadDt"        column="END_MTR_READ_DT"        javaType="EZDSStringItem"/>
        <result property="mtrLbDescTxt"        column="MTR_LB_DESC_TXT"        javaType="EZDSStringItem"/>
        <result property="oldEndReadMtrCnt"    column="OLD_END_READ_MTR_CNT"   javaType="EZDSBigDecimalItem"/>
        <result property="oldTestMtrCnt"    column="OLD_TEST_MTR_CNT"   javaType="EZDSBigDecimalItem"/>
        <result property="newEndReadMtrCnt"    column="NEW_END_READ_MTR_CNT"   javaType="EZDSBigDecimalItem"/>
        <result property="newTestMtrCnt"    column="NEW_TEST_MTR_CNT"   javaType="EZDSBigDecimalItem"/>
    </resultMap>

    <statement id="getMtrLb" parameterClass="Map" resultClass="Map">
        SELECT
            B.MTR_LB_CD
            ,B.MTR_LB_DESC_TXT
        FROM
            SVC_PHYS_MTR A
            ,MTR_LB B
        WHERE
            A.GLBL_CMPY_CD     = #glblCmpyCd#
        AND A.SVC_MACH_MSTR_PK = #svcMachMstrPk#
        AND A.GLBL_CMPY_CD     = B.GLBL_CMPY_CD
        AND A.MDL_MTR_LB_CD    = B.MTR_LB_CD
        ORDER BY
            B.MTR_LB_SORT_NUM
    </statement>
</sqlMap>
