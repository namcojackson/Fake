<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL7290Query">

    <typeAlias alias="NMAL7290CMsg"    type="business.blap.NMAL7290.NMAL7290CMsg"/>
    <typeAlias alias="NMAL7290_ACMsg"  type="business.blap.NMAL7290.NMAL7290_ACMsg"/>
    <typeAlias alias="NMAL7290_BCMsg"  type="business.blap.NMAL7290.NMAL7290_BCMsg"/>

    <statement id="searchPrcRule" parameterClass="Map" resultMap="result.searchPrcRule">
        SELECT
              PRC_RULE_HDR_PK
            , PRC_RULE_NM
            , PRC_RULE_COND_TP_CD
            , PRC_RULE_COND_TP_DESC_TXT
            , LINE_BIZ_TP_CD
            , LINE_BIZ_TP_DESC_TXT
            , PRC_RULE_CATG_CD
            , PRC_RULE_CATG_DESC_TXT
            , APPLY_AUTO_FLG
            , OVRD_FLG
            , ACTV_FLG
            , DEF_RULE_PRCD_NUM
            , EFF_FROM_DT
            , EFF_THRU_DT
            , DEL_FLG
        FROM
            (
            SELECT
                  H.PRC_RULE_HDR_PK
                , H.PRC_RULE_NM
                , H.PRC_RULE_COND_TP_CD
                , H.LINE_BIZ_TP_CD
                , H.PRC_RULE_CATG_CD
                , H.APPLY_AUTO_FLG
                , H.OVRD_FLG
                , H.ACTV_FLG
                , H.DEF_RULE_PRCD_NUM
                , H.EFF_FROM_DT
                , H.EFF_THRU_DT
                , H.DEL_FLG
                , CD.PRC_RULE_COND_TP_DESC_TXT
                , LB.LINE_BIZ_TP_DESC_TXT
                , CT.PRC_RULE_CATG_DESC_TXT
            FROM
                  PRC_RULE_HDR      H
                , PRC_RULE_COND_TP  CD
                , LINE_BIZ_TP       LB
                , PRC_RULE_CATG     CT
            <isNotNull property="prcRuleCondFromTxt_Cat">
                , PRC_RULE_TRX_COND C1
            </isNotNull>
            <isNotNull property="prcRuleCondFromTxt_Rsn">
                , PRC_RULE_TRX_COND C2
            </isNotNull>
            WHERE
                    H.GLBL_CMPY_CD        = #glblCmpyCd#
                AND H.EZCANCELFLAG        = '0'
            <isNotNull property="prcRuleCatgCd">
                AND H.PRC_RULE_CATG_CD    = #prcRuleCatgCd#
            </isNotNull>
            <isNotNull property="prcRuleNm">
                AND H.PRC_RULE_NM      LIKE #prcRuleNm#
            </isNotNull>
            <isNotNull property="prcRuleCondTpCd">
                AND H.PRC_RULE_COND_TP_CD = #prcRuleCondTpCd#
            </isNotNull>
                AND H.EFF_FROM_DT     &lt;= #effDt#
                AND (H.EFF_THRU_DT    &gt;= #effDt# OR H.EFF_THRU_DT IS NULL)
                AND H.DEL_FLG             = 'N'
                AND H.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD 
                AND CD.EZCANCELFLAG       = '0'
                AND H.PRC_RULE_COND_TP_CD = CD.PRC_RULE_COND_TP_CD
                AND H.GLBL_CMPY_CD   = LB.GLBL_CMPY_CD 
                AND LB.EZCANCELFLAG  = '0'
                AND H.LINE_BIZ_TP_CD = LB.LINE_BIZ_TP_Cd
                AND H.GLBL_CMPY_CD     = CT.GLBL_CMPY_CD 
                AND CT.EZCANCELFLAG    = '0'
                AND H.PRC_RULE_CATG_CD = CT.PRC_RULE_CATG_CD
            <isNotNull property="prcRuleCondFromTxt_Cat">
                AND H.GLBL_CMPY_CD            = C1.GLBL_CMPY_CD 
                AND C1.EZCANCELFLAG           = '0'
                AND H.PRC_RULE_HDR_PK         = C1.PRC_RULE_HDR_PK
                AND C1.PRC_RULE_ATTRB_CD      = #prcRuleAttrbCd_Cat#
                AND C1.PRC_RULE_COND_FROM_TXT = #prcRuleCondFromTxt_Cat#
            </isNotNull>
            <isNotNull property="prcRuleCondFromTxt_Rsn">
                AND H.GLBL_CMPY_CD            = C2.GLBL_CMPY_CD 
                AND C2.EZCANCELFLAG           = '0'
                AND H.PRC_RULE_HDR_PK         = C2.PRC_RULE_HDR_PK
                AND C2.PRC_RULE_ATTRB_CD      = #prcRuleAttrbCd_Rsn#
                AND C2.PRC_RULE_COND_FROM_TXT = #prcRuleCondFromTxt_Rsn#
            </isNotNull>
            <isNotNull property="prcRuleCondFromTxt_LB">
                AND H.LINE_BIZ_TP_CD = #prcRuleCondFromTxt_LB#
            </isNotNull>
            ORDER BY H.PRC_RULE_HDR_PK
            )
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <resultMap id="result.searchPrcRule" class="NMAL7290_ACMsg">
        <result property="prcRuleNm_A"             column="PRC_RULE_NM"                javaType="EZDSStringItem"/>
        <result property="prcRuleCondTpDescTxt_A"  column="PRC_RULE_COND_TP_DESC_TXT"  javaType="EZDSStringItem"/>
        <result property="prcRuleCatgDescTxt_A"    column="PRC_RULE_CATG_DESC_TXT"     javaType="EZDSStringItem"/>
        <result property="defRulePrcdNum_A"        column="DEF_RULE_PRCD_NUM"          javaType="EZDSBigDecimalItem"/>
        <result property="prcRuleHdrPk_A"          column="PRC_RULE_HDR_PK"            javaType="EZDSBigDecimalItem"/>
        <result property="prcRuleCondTpCd_A"       column="PRC_RULE_COND_TP_CD"        javaType="EZDSStringItem"/>
        <result property="lineBizTpCd_A"           column="LINE_BIZ_TP_CD"             javaType="EZDSStringItem"/>
        <result property="prcRuleCatgCd_A"         column="PRC_RULE_CATG_CD"           javaType="EZDSStringItem"/>
        <result property="applyAutoFlg_A"          column="APPLY_AUTO_FLG"             javaType="EZDSStringItem"/>
        <result property="ovrdFlg_A"               column="OVRD_FLG"                   javaType="EZDSStringItem"/>
        <result property="actvFlg_A"               column="ACTV_FLG"                   javaType="EZDSStringItem"/>
        <result property="effFromDt_A"             column="EFF_FROM_DT"                javaType="EZDSDateItem"/>
        <result property="effThruDt_A"             column="EFF_THRU_DT"                javaType="EZDSDateItem"/>
        <result property="delFlg_A"                column="DEL_FLG"                    javaType="EZDSStringItem"/>
        <result property="lineBizTpDescTxt_A"      column="LINE_BIZ_TP_DESC_TXT"       javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="searchPrcRulePrcd" parameterClass="Map" resultMap="result.searchPrcRulePrcd">
        SELECT
              PRC_RULE_PRCD_SQ_NUM
            , PRC_RULE_PRCD_DTL_PK
            , PRC_RULE_HDR_PK
            , PRC_RULE_NM
            , PRC_RULE_COND_TP_CD
            , PRC_RULE_COND_TP_DESC_TXT
            , LINE_BIZ_TP_CD
            , LINE_BIZ_TP_DESC_TXT
            , PRC_RULE_CATG_CD
            , PRC_RULE_CATG_DESC_TXT
            , APPLY_AUTO_FLG
            , OVRD_FLG
            , ACTV_FLG
            , DEF_RULE_PRCD_NUM
            , EFF_FROM_DT
            , EFF_THRU_DT
            , DEL_FLG
            , XX_REC_HIST_CRAT_TS
            , XX_REC_HIST_CRAT_BY_NM
            , XX_REC_HIST_UPD_TS
            , XX_REC_HIST_UPD_BY_NM
            , XX_REC_HIST_TBL_NM
        FROM
            (
            SELECT
                  PD.PRC_RULE_PRCD_DTL_PK
                , PD.PRC_RULE_PRCD_SQ_NUM
                , H.PRC_RULE_HDR_PK
                , H.PRC_RULE_NM
                , H.PRC_RULE_COND_TP_CD
                , H.LINE_BIZ_TP_CD
                , H.PRC_RULE_CATG_CD
                , H.APPLY_AUTO_FLG
                , H.OVRD_FLG
                , H.ACTV_FLG
                , H.DEF_RULE_PRCD_NUM
                , H.EFF_FROM_DT
                , H.EFF_THRU_DT
                , H.DEL_FLG
                , CT.PRC_RULE_COND_TP_DESC_TXT
                , BT.LINE_BIZ_TP_DESC_TXT
                , C.PRC_RULE_CATG_DESC_TXT
                , PD.EZINTIME                       AS XX_REC_HIST_CRAT_TS
                , PD.EZINUSERID                     AS XX_REC_HIST_CRAT_BY_NM
                , PD.EZUPTIME                       AS XX_REC_HIST_UPD_TS
                , PD.EZUPUSERID                     AS XX_REC_HIST_UPD_BY_NM
                , PD.EZTABLEID                      AS XX_REC_HIST_TBL_NM
            FROM 
                  PRC_RULE_PRCD     P
                , PRC_RULE_PRCD_DTL PD
                , PRC_RULE_HDR      H
                , PRC_RULE_COND_TP  CT
                , LINE_BIZ_TP       BT
                , PRC_RULE_CATG     C
            WHERE
                    P.GLBL_CMPY_CD          = #glblCmpyCd#
                AND P.EZCANCELFLAG          = '0'
                AND P.PRC_RULE_PRCD_PK      = #prcRulePrcdPk#
                AND P.GLBL_CMPY_CD          = PD.GLBL_CMPY_CD
                AND PD.EZCANCELFLAG         = '0'
                AND P.PRC_RULE_PRCD_PK      = PD.PRC_RULE_PRCD_PK
                AND PD.GLBL_CMPY_CD         = H.GLBL_CMPY_CD
                AND H.EZCANCELFLAG          = '0'
                AND PD.PRC_RULE_HDR_PK      = H.PRC_RULE_HDR_PK
                AND H.GLBL_CMPY_CD          = CT.GLBL_CMPY_CD
                AND CT.EZCANCELFLAG         = '0'
                AND H.PRC_RULE_COND_TP_CD   = CT.PRC_RULE_COND_TP_CD
                AND H.GLBL_CMPY_CD          = BT.GLBL_CMPY_CD
                AND BT.EZCANCELFLAG         = '0'
                AND H.LINE_BIZ_TP_CD        = BT.LINE_BIZ_TP_CD
                AND H.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
                AND C.EZCANCELFLAG          = '0'
                AND H.PRC_RULE_CATG_CD      = C.PRC_RULE_CATG_CD
            ORDER BY PD.PRC_RULE_PRCD_SQ_NUM
                   , PD.PRC_RULE_HDR_PK
            )
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>
    
    <resultMap id="result.searchPrcRulePrcd" class="NMAL7290_BCMsg">
        <result property="prcRulePrcdSqNum_B"      column="PRC_RULE_PRCD_SQ_NUM"       javaType="EZDSBigDecimalItem"/>
        <result property="prcRulePrcdDtlPk_B"      column="PRC_RULE_PRCD_DTL_PK"       javaType="EZDSBigDecimalItem"/>
        <result property="prcRuleHdrPk_B"          column="PRC_RULE_HDR_PK"            javaType="EZDSBigDecimalItem"/>
        <result property="prcRuleNm_B"             column="PRC_RULE_NM"                javaType="EZDSStringItem"/>
        <result property="prcRuleCondTpCd_B"       column="PRC_RULE_COND_TP_CD"        javaType="EZDSStringItem"/>
        <result property="prcRuleCondTpDescTxt_B"  column="PRC_RULE_COND_TP_DESC_TXT"  javaType="EZDSStringItem"/>
        <result property="lineBizTpCd_B"           column="LINE_BIZ_TP_CD"             javaType="EZDSStringItem"/>
        <result property="lineBizTpDescTxt_B"      column="LINE_BIZ_TP_DESC_TXT"       javaType="EZDSStringItem"/>
        <result property="prcRuleCatgCd_B"         column="PRC_RULE_CATG_CD"           javaType="EZDSStringItem"/>
        <result property="prcRuleCatgDescTxt_B"    column="PRC_RULE_CATG_DESC_TXT"     javaType="EZDSStringItem"/>
        <result property="applyAutoFlg_B"          column="APPLY_AUTO_FLG"             javaType="EZDSStringItem"/>
        <result property="ovrdFlg_B"               column="OVRD_FLG"                   javaType="EZDSStringItem"/>
        <result property="actvFlg_B"               column="ACTV_FLG"                   javaType="EZDSStringItem"/>
        <result property="defRulePrcdNum_B"        column="DEF_RULE_PRCD_NUM"          javaType="EZDSBigDecimalItem"/>
        <result property="effFromDt_B"             column="EFF_FROM_DT"                javaType="EZDSDateItem"/>
        <result property="effThruDt_B"             column="EFF_THRU_DT"                javaType="EZDSDateItem"/>
        <result property="delFlg_B"                column="DEL_FLG"                    javaType="EZDSStringItem"/>
        <result property="xxRecHistCratTs_B"       column="XX_REC_HIST_CRAT_TS"        javaType="EZDCStringItem"/>
        <result property="xxRecHistCratByNm_B"     column="XX_REC_HIST_CRAT_BY_NM"     javaType="EZDCStringItem"/>
        <result property="xxRecHistUpdTs_B"        column="XX_REC_HIST_UPD_TS"         javaType="EZDCStringItem"/>
        <result property="xxRecHistUpdByNm_B"      column="XX_REC_HIST_UPD_BY_NM"      javaType="EZDCStringItem"/>
        <result property="xxRecHistTblNm_B"        column="XX_REC_HIST_TBL_NM"         javaType="EZDCStringItem"/>
    </resultMap>

    <statement id="searchPrcRulePrcdHdr" parameterClass="Map" resultMap="result.searchPrcRulePrcdHdr">
        SELECT
              P.PRC_RULE_PRCD_PK
            , P.PRC_RULE_PRCD_GRP_NM
            , P.ACTV_FLG
            , P.PRC_PRCD_ACT_TP_CD
            , P.EFF_FROM_DT
            , P.EFF_THRU_DT
            , SUBSTR(P.EZINTIME, 1, 8)    CRAT_DT
            , CASE
                WHEN AP1.FIRST_NM IS NOT NULL THEN P.EZINUSERID || '(' || AP1.FIRST_NM || ' ' || AP1.LAST_NM || ')'
                ELSE P.EZINUSERID
              END CRAT_USR_NM
            , SUBSTR(P.EZUPTIME, 1, 8)    UPD_DT
            , CASE
                WHEN AP2.FIRST_NM IS NOT NULL THEN P.EZUPUSERID || '(' || AP2.FIRST_NM || ' ' || AP2.LAST_NM || ')'
                ELSE P.EZUPUSERID
              END UPD_USR_NM
            , P.EZUPTIME
            , P.EZUPTIMEZONE
        FROM
              PRC_RULE_PRCD     P
             ,AUTH_PSN AP1
             ,AUTH_PSN AP2
        WHERE
               P.GLBL_CMPY_CD          = #glblCmpyCd#
           AND P.EZCANCELFLAG          = '0'
           AND P.PRC_RULE_PRCD_PK      = #prcRulePrcdPk#
           AND P.GLBL_CMPY_CD          = AP1.GLBL_CMPY_CD(+)
           AND P.EZCANCELFLAG          = AP1.EZCANCELFLAG(+)
           AND P.EZINUSERID            = AP1.USR_NM(+)
           AND P.GLBL_CMPY_CD          = AP2.GLBL_CMPY_CD(+)
           AND P.EZCANCELFLAG          = AP2.EZCANCELFLAG(+)
           AND P.EZUPUSERID            = AP2.USR_NM(+)
    </statement>
    
    <resultMap id="result.searchPrcRulePrcdHdr" class="NMAL7290CMsg">
        <result property="prcRulePrcdPk"           column="PRC_RULE_PRCD_PK"          javaType="EZDSBigDecimalItem"/>
        <result property="prcRulePrcdGrpNm"        column="PRC_RULE_PRCD_GRP_NM"      javaType="EZDSStringItem"/>
        <result property="actvFlg"                 column="ACTV_FLG"                  javaType="EZDSStringItem"/>
        <result property="prcPrcdActTpCd"          column="PRC_PRCD_ACT_TP_CD"        javaType="EZDSStringItem"/>
        <result property="effFromDt"               column="EFF_FROM_DT"               javaType="EZDSDateItem"/>
        <result property="effThruDt"               column="EFF_THRU_DT"               javaType="EZDSDateItem"/>
        <result property="xxFullNm_H1"             column="CRAT_USR_NM"               javaType="EZDCStringItem"/>
        <result property="cratDt"                  column="CRAT_DT"                   javaType="EZDSDateItem"/>
        <result property="xxFullNm_H2"             column="UPD_USR_NM"                javaType="EZDCStringItem"/>
        <result property="lastUpdDt"               column="UPD_DT"                    javaType="EZDSDateItem"/>
        <result property="ezUpTime"                column="EZUPTIME"                  javaType="EZDCStringItem"/>
        <result property="ezUpTimeZone"            column="EZUPTIMEZONE"              javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="getCntPrcRuleHdr" parameterClass="Map" resultClass="BigDecimal">
        SELECT
              COUNT(*)
        FROM
              PRC_RULE_PRCD_DTL     PRPD
             ,PRC_RULE_PRCD         PRP
        WHERE
               PRPD.GLBL_CMPY_CD          = #glblCmpyCd#
           AND PRPD.EZCANCELFLAG          = '0'
           AND PRPD.PRC_RULE_HDR_PK       = #prcRuleHdrPk#
           <isNotNull property="prcRulePrcdPk">
           AND PRPD.PRC_RULE_PRCD_PK      &lt;&gt; #prcRulePrcdPk#
           </isNotNull>
           AND PRPD.GLBL_CMPY_CD          = PRP.GLBL_CMPY_CD
           AND PRPD.PRC_RULE_PRCD_PK      = PRP.PRC_RULE_PRCD_PK
           AND PRP.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getPrcRuleData" parameterClass="Map" resultClass="Map">
        SELECT
              PRD.PRC_RULE_MOD_TP_CD
             ,PRD.PRC_RULE_ADJ_LVL_CD
             ,PF.PRC_FUNC_TP_CD
        FROM
              PRC_RULE_HDR     PRH
             ,PRC_RULE_DTL     PRD
             ,PRC_FMLA         PF
        WHERE
               PRH.GLBL_CMPY_CD          = #glblCmpyCd#
           AND PRH.EZCANCELFLAG          = '0'
           AND PRH.PRC_RULE_HDR_PK       = #prcRuleHdrPk#
           AND PRH.GLBL_CMPY_CD          = PRD.GLBL_CMPY_CD
           AND PRH.EZCANCELFLAG          = PRD.EZCANCELFLAG 
           AND PRH.PRC_RULE_HDR_PK       = PRD.PRC_RULE_HDR_PK
           AND PRD.GLBL_CMPY_CD          = PF.GLBL_CMPY_CD(+)
           AND PRD.EZCANCELFLAG          = PF.EZCANCELFLAG(+) 
           AND PRD.PRC_FMLA_PK           = PF.PRC_FMLA_PK(+)
    </statement>

    <statement id="getAnyColmn" parameterClass="Map" resultClass="String">
        SELECT
            $colNm$     GET_COLUMN
        FROM
            $tblNm$ A
        WHERE
                A.GLBL_CMPY_CD = #glblCmpyCd#
            AND A.EZCANCELFLAG = '0'
            AND A.$whereCol$ = #whereVal#
    </statement>
</sqlMap>
