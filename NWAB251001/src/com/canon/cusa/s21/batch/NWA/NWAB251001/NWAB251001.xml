<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWAB251001">

    <statement id="getDeleteList" parameterClass="Map" resultClass="Map">
        SELECT
            UOR.UPD_ORD_RPST_PK
        FROM
            UPD_ORD_RPST UOR
        WHERE
            UOR.EZCANCELFLAG = '0'
        AND UOR.GLBL_CMPY_CD = #glblCmpyCd#
        AND UOR.UPD_ORD_RPST_CRAT_TS &lt;= #baseDt#
        AND UOR.PROC_FLG = #procFlg_Y#
    </statement>
    
    <statement id="getTargetOrderList" parameterClass="Map" resultClass="Map">
        SELECT
            DISTINCT T.CPO_ORD_NUM
        FROM 
        (
	        --CPO
	        SELECT
	            C.CPO_ORD_NUM
	        FROM
	            CPO C
	           ,PROC_LAST_EXEC PLE
	        WHERE
	            C.GLBL_CMPY_CD       = #glblCmpyCd#
	        AND C.EZCANCELFLAG       = '0'
	        AND C.GLBL_CMPY_CD = PLE.GLBL_CMPY_CD
	        AND C.EZCANCELFLAG = PLE.EZCANCELFLAG
	        AND C.EZUPTIME &gt;= PLE.LAST_EXEC_TS
	        AND PLE.PROC_PGM_ID = #procPgmId#
	        
	        --CPO_DTL
	        UNION
	        SELECT
	            DISTINCT CD.CPO_ORD_NUM
	        FROM
	            CPO_DTL CD
	           ,PROC_LAST_EXEC PLE
	        WHERE
	            CD.GLBL_CMPY_CD = #glblCmpyCd#
	        AND CD.EZCANCELFLAG = '0'
	        AND CD.GLBL_CMPY_CD = PLE.GLBL_CMPY_CD
	        AND CD.EZCANCELFLAG = PLE.EZCANCELFLAG
	        AND CD.EZUPTIME &gt;= PLE.LAST_EXEC_TS
	        AND PLE.PROC_PGM_ID = #procPgmId#
	        
	        --SHPG_PLN
	        UNION
	        SELECT
	            DISTINCT SP.TRX_HDR_NUM
	        FROM
	            SHPG_PLN SP
	           ,PROC_LAST_EXEC PLE
	        WHERE
	            SP.GLBL_CMPY_CD = #glblCmpyCd#
	        AND SP.EZCANCELFLAG = '0'
	        AND SP.GLBL_CMPY_CD = PLE.GLBL_CMPY_CD
	        AND SP.EZCANCELFLAG = PLE.EZCANCELFLAG
	        AND SP.EZUPTIME &gt;= PLE.LAST_EXEC_TS
	        AND PLE.PROC_PGM_ID = #procPgmId#
	        AND EXISTS (SELECT '1' FROM CPO C
	                    WHERE C.CPO_ORD_NUM = SP.TRX_HDR_NUM
	                    AND C.EZCANCELFLAG = SP.EZCANCELFLAG
                        AND C.GLBL_CMPY_CD = SP.GLBL_CMPY_CD
	                    )
	        
	        --DS_CPO_CONFIG
	        UNION
	        SELECT
	            DISTINCT DCC.CPO_ORD_NUM
	        FROM
	            DS_CPO_CONFIG DCC
	           ,PROC_LAST_EXEC PLE
	        WHERE
	            DCC.GLBL_CMPY_CD = #glblCmpyCd#
	        AND DCC.EZCANCELFLAG = '0'
	        AND DCC.GLBL_CMPY_CD = PLE.GLBL_CMPY_CD
	        AND DCC.EZCANCELFLAG = PLE.EZCANCELFLAG
	        AND DCC.EZUPTIME &gt;= PLE.LAST_EXEC_TS
	        AND PLE.PROC_PGM_ID = #procPgmId#
	
	        --DS_CPO_RTRN_DTL
	        UNION
	        SELECT
	            DISTINCT DCRD.CPO_ORD_NUM
	        FROM
	            DS_CPO_RTRN_DTL DCRD
	           ,PROC_LAST_EXEC PLE
	        WHERE
	            DCRD.GLBL_CMPY_CD = #glblCmpyCd#
	        AND DCRD.EZCANCELFLAG = '0'
	        AND DCRD.GLBL_CMPY_CD = PLE.GLBL_CMPY_CD
	        AND DCRD.EZCANCELFLAG = PLE.EZCANCELFLAG
	        AND DCRD.EZUPTIME &gt;= PLE.LAST_EXEC_TS
	        AND PLE.PROC_PGM_ID = #procPgmId#
	
	        --DS_CPO_SLS_CR
	        UNION
	        SELECT
	            DISTINCT DCSC.CPO_ORD_NUM
	        FROM
	            DS_CPO_SLS_CR DCSC
	           ,PROC_LAST_EXEC PLE
	        WHERE
	            DCSC.GLBL_CMPY_CD = #glblCmpyCd#
	        AND DCSC.EZCANCELFLAG = '0'
	        AND DCSC.GLBL_CMPY_CD = PLE.GLBL_CMPY_CD
	        AND DCSC.EZCANCELFLAG = PLE.EZCANCELFLAG
	        AND DCSC.EZUPTIME &gt;= PLE.LAST_EXEC_TS
	        AND PLE.PROC_PGM_ID = #procPgmId#
	
	        --FSR
	        UNION
	        SELECT
	            DISTINCT CD.CPO_ORD_NUM
	        FROM
	            FSR F
	           ,CPO_DTL        CD
	           ,PROC_LAST_EXEC PLE
	        WHERE
	            F.GLBL_CMPY_CD = #glblCmpyCd#
	        AND F.EZCANCELFLAG = '0'
	        AND F.GLBL_CMPY_CD = PLE.GLBL_CMPY_CD
	        AND F.EZCANCELFLAG = PLE.EZCANCELFLAG
	        AND F.EZUPTIME &gt;= PLE.LAST_EXEC_TS
	        AND PLE.PROC_PGM_ID = #procPgmId#
	        AND CD.GLBL_CMPY_CD = F.GLBL_CMPY_CD
	        AND CD.EZCANCELFLAG = F.EZCANCELFLAG
	        AND CD.SVC_MACH_MSTR_PK = F.SVC_MACH_MSTR_PK
	        
	        --SVC_TASK
	        UNION
	        SELECT
	            DISTINCT CD.CPO_ORD_NUM
	        FROM
	            SVC_TASK ST
	           ,CPO_DTL        CD
	           ,PROC_LAST_EXEC PLE
	        WHERE
	            ST.GLBL_CMPY_CD = #glblCmpyCd#
	        AND ST.EZCANCELFLAG = '0'
	        AND ST.GLBL_CMPY_CD = PLE.GLBL_CMPY_CD
	        AND ST.EZCANCELFLAG = PLE.EZCANCELFLAG
	        AND ST.EZUPTIME &gt;= PLE.LAST_EXEC_TS
	        AND PLE.PROC_PGM_ID = #procPgmId#
	        AND CD.GLBL_CMPY_CD = ST.GLBL_CMPY_CD
	        AND CD.EZCANCELFLAG = ST.EZCANCELFLAG
	        AND CD.SVC_MACH_MSTR_PK = ST.SVC_MACH_MSTR_PK
	
	        --FSR_VISIT
	        UNION
	        SELECT
	            DISTINCT CD.CPO_ORD_NUM
	        FROM
	            FSR_VISIT FV
	           ,FSR F
	           ,CPO_DTL CD
               ,PROC_LAST_EXEC PLE
	        WHERE
	            FV.GLBL_CMPY_CD = #glblCmpyCd#
	        AND FV.EZCANCELFLAG = '0'
	        AND FV.GLBL_CMPY_CD = PLE.GLBL_CMPY_CD
	        AND FV.EZCANCELFLAG = PLE.EZCANCELFLAG
	        AND FV.EZUPTIME &gt;= PLE.LAST_EXEC_TS
	        AND PLE.PROC_PGM_ID = #procPgmId#
	        AND FV.EZCANCELFLAG = F.EZCANCELFLAG
	        AND FV.GLBL_CMPY_CD = F.GLBL_CMPY_CD
	        AND FV.FSR_NUM = F.FSR_NUM
	        AND F.GLBL_CMPY_CD = CD.GLBL_CMPY_CD
	        AND F.EZCANCELFLAG = CD.EZCANCELFLAG
	        AND F.SVC_MACH_MSTR_PK = CD.SVC_MACH_MSTR_PK
        ) T
    </statement>
    
    <statement id="chkExistCopOrdNum" parameterClass="Map" resultClass="Map">
        SELECT
            UOR.UPD_ORD_RPST_PK
        FROM
            UPD_ORD_RPST UOR
        WHERE
            UOR.EZCANCELFLAG = '0'
        AND UOR.GLBL_CMPY_CD = #glblCmpyCd#
        AND UOR.CPO_ORD_NUM = #cpoOrdNum#
    </statement>
</sqlMap>
