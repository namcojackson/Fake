<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NMAL6720Query">
  <typeAlias alias="NMAL6720SMsg"   type="business.blap.NMAL6720.NMAL6720SMsg"/>
  <typeAlias alias="NMAL6720_ASMsg"   type="business.blap.NMAL6720.NMAL6720_ASMsg"/>
  <typeAlias alias="NMAL6720_BSMsg"   type="business.blap.NMAL6720.NMAL6720_BSMsg"/>
  <typeAlias alias="NMAL6720_CSMsg"   type="business.blap.NMAL6720.NMAL6720_CSMsg"/>
  <typeAlias alias="NMAL6720_DSMsg"   type="business.blap.NMAL6720.NMAL6720_DSMsg"/>
  <typeAlias alias="NMAL6720_ESMsg"   type="business.blap.NMAL6720.NMAL6720_ESMsg"/>
  <typeAlias alias="NMAL6720_FSMsg"   type="business.blap.NMAL6720.NMAL6720_FSMsg"/>
  <typeAlias alias="NMAL6720_GSMsg"   type="business.blap.NMAL6720.NMAL6720_GSMsg"/>
  <typeAlias alias="NMAL6720_ISMsg"   type="business.blap.NMAL6720.NMAL6720_ISMsg"/>
  <typeAlias alias="STTMsg"           type="business.db.STTMsg"/>

  <statement id="getDsAcctTpCd" parameterClass="Map" resultClass="String">
        SELECT * FROM (
            SELECT
                ACCT.DS_ACCT_TP_CD 
            FROM
                SELL_TO_CUST ACCT
            WHERE
                ACCT.GLBL_CMPY_CD = #glblCmpyCd#
            AND ACCT.EZCANCELFLAG = '0'
            AND ACCT.SELL_TO_CUST_CD = #dsAcctNum#

        UNION ALL

            SELECT
               ACCT.DS_ACCT_TP_CD 
            FROM
                DS_ACCT_PROS ACCT
            WHERE
                ACCT.GLBL_CMPY_CD = #glblCmpyCd#
            AND ACCT.EZCANCELFLAG = '0'
            AND ACCT.DS_ACCT_NUM = #dsAcctNum#
            )
        WHERE ROWNUM = 1
  </statement>

  <statement id="getHeaderInfo" parameterClass="Map"  resultMap="result.getHeaderInfo">
        SELECT * FROM (
            SELECT 
                  PLW.PTY_LOC_PK
                , PLW.LOC_NUM
                , PLW.LOC_NM
                , PLW.CTRY_CD
                , PLW.FIRST_LINE_ADDR
                , PLW.SCD_LINE_ADDR
                , PLW.THIRD_LINE_ADDR
                , PLW.FRTH_LINE_ADDR
                , PLW.POST_CD
                , PLW.CTY_ADDR
                , PLW.ST_CD
                , PLW.CNTY_PK
                , CNTY.CNTY_NM
                , PLW.PROV_NM
                , PLW.TEL_NUM
                , PLW.RGTN_STS_CD
                , PLW.EFF_FROM_DT  AS EFF_FROM_DT_PLW
                , PLW.EFF_THRU_DT  AS EFF_THRU_DT_PLW
                , PLW.GEO_CD
                , PLW.LINE_BIZ_TP_CD
                , PLW.PRF_TECH_CD
                , PLW.REQ_TECH_CD
                , TM1.TECH_NM       AS PRF_TECH_NM
                , TM2.TECH_NM       AS REQ_TECH_NM
                , PLW.EZUPTIME     AS EZUPTIME_PLW
                , PLW.EZUPTIMEZONE AS EZUPTIMEZONE_PLW
                , PLW.DS_LOC_NM
                , ACCT.DS_ACCT_NM
                , ACCT.SELL_TO_CUST_CD AS DS_ACCT_NUM
                , ACCT.CMPY_PK
                , ACCT.DS_ACCT_TP_CD
                , ACCT.PROS_TO_CUST_CHNG_STS_CD
                , CASE WHEN PC.PRIN_CUST_PK IS NULL OR PC.RGTN_STS_CD = #rgtnStsCd#
                       THEN 'N' ELSE 'Y' 
                  END PRIN_CUST_FLG
                , PC.PRIN_CUST_PK
                , PC.EZUPTIME      AS EZUPTIME_PR
                , PC.EZUPTIMEZONE  AS EZUPTIMEZONE_PR
                , BTC.BILL_TO_CUST_PK
                , BTC.BILL_TO_CUST_CD
                , BTC.EFF_FROM_DT   AS EFF_FROM_DT_BI
                , BTC.EFF_THRU_DT   AS EFF_THRU_DT_BI
                , BTC.EZUPTIME      AS EZUPTIME_BI
                , BTC.EZUPTIMEZONE  AS EZUPTIMEZONE_BI
                , BTC.RGTN_STS_CD   AS RGTN_STS_CD_BI
                , CASE WHEN BTC.BILL_TO_CUST_PK IS NULL OR BTC.RGTN_STS_CD = #rgtnStsCd#
                       THEN 'N' ELSE 'Y' 
                  END DS_ACCT_RELN_BILL_TO_FLG
                , BTC.PRIM_USG_FLG AS PRIM_USG_FLG_BI
                , STC.SHIP_TO_CUST_PK
                , STC.SHIP_TO_CUST_CD
                , STC.EFF_FROM_DT   AS EFF_FROM_DT_SH
                , STC.EFF_THRU_DT   AS EFF_THRU_DT_SH
                , STC.DPL_STS_CD
                , STC.EMBGO_FLG
                , STC.DPL_MOD_DT_TM_TS
                , STC.DPL_RSN_TXT
                , STC.EZUPTIME      AS EZUPTIME_SH
                , STC.EZUPTIMEZONE  AS EZUPTIMEZONE_SH
                , STC.RGTN_STS_CD   AS RGTN_STS_CD_SH
                , CASE WHEN STC.SHIP_TO_CUST_PK IS NULL  OR STC.RGTN_STS_CD = #rgtnStsCd#
                       THEN 'N' ELSE 'Y' 
                  END DS_ACCT_RELN_SHIP_TO_FLG
                , STC.RELN_BILL_TO_CUST_CD
                , STC.PRIM_USG_FLG AS PRIM_USG_FLG_SH
    
                , PLW.EZINTIME             AS XX_REC_HIST_CRAT_TS
                , PLW.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
                , PLW.EZUPTIME             AS XX_REC_HIST_UPD_TS
                , PLW.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
                , 'PTY_LOC_WRK'            AS XX_REC_HIST_TBL_NM
                , BTC.EZINTIME             AS XX_REC_HIST_CRAT_TS_BI
                , BTC.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM_BI
                , BTC.EZUPTIME             AS XX_REC_HIST_UPD_TS_BI
                , BTC.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM_BI
                , 'BILL_TO_CUST'           AS XX_REC_HIST_TBL_NM_BI
                , STC.EZINTIME             AS XX_REC_HIST_CRAT_TS_SH
                , STC.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM_SH
                , STC.EZUPTIME             AS XX_REC_HIST_UPD_TS_SH
                , STC.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM_SH
                , 'SHIP_TO_CUST'           AS XX_REC_HIST_TBL_NM_SH
                <!-- 2020/03/02 QC#55673 Add Start -->
                , PLW.ADDL_LOC_NM
                <!-- 2020/03/02 QC#55673 Add End -->
                <!-- 2023/11/06 QC#61924 Add Start -->
                , CASE WHEN BTC.BILL_TO_CUST_PK IS NOT NULL
                     THEN BTC.DEAC_NEW_TRX_FLG
                     ELSE STC.DEAC_NEW_TRX_FLG
                 END DEAC_NEW_TRX_FLG
                <!-- 2023/11/06 QC#61924 Add End -->
            FROM 
                  SELL_TO_CUST    ACCT
                , ACCT_LOC        AL
                , PTY_LOC_WRK     PLW
                , PRIN_CUST       PC
                , BILL_TO_CUST    BTC
                , SHIP_TO_CUST    STC
                , CNTY            CNTY
                , TECH_MSTR       TM1
                , TECH_MSTR       TM2
            WHERE 
                    ACCT.GLBL_CMPY_CD     = #glblCmpyCd#
                AND ACCT.SELL_TO_CUST_CD  = #dsAcctNum#
                AND ACCT.EZCANCELFLAG     = '0'
                
                AND ACCT.GLBL_CMPY_CD     = AL.GLBL_CMPY_CD
                AND ACCT.SELL_TO_CUST_CD  = AL.DS_ACCT_NUM
                AND AL.LOC_NUM            = #locNum#
                AND AL.EZCANCELFLAG       = '0'
                
                AND AL.GLBL_CMPY_CD       = PLW.GLBL_CMPY_CD
                AND AL.LOC_NUM            = PLW.LOC_NUM
                AND PLW.EZCANCELFLAG      = '0'
                
                AND PLW.GLBL_CMPY_CD      = PC.GLBL_CMPY_CD (+)
                AND PLW.LOC_NUM           = PC.LOC_NUM (+)
                AND PC.EZCANCELFLAG (+)   = '0'
                
                AND PLW.GLBL_CMPY_CD      = BTC.GLBL_CMPY_CD (+)
                AND PLW.LOC_NUM           = BTC.LOC_NUM (+)
                AND BTC.EZCANCELFLAG (+)  = '0'
                
                AND PLW.GLBL_CMPY_CD      = STC.GLBL_CMPY_CD (+)
                AND PLW.LOC_NUM           = STC.LOC_NUM (+)
                AND STC.EZCANCELFLAG (+)  = '0'
                
                AND PLW.GLBL_CMPY_CD      = CNTY.GLBL_CMPY_CD (+)
                AND PLW.CNTY_PK           = CNTY.CNTY_PK (+)
                AND CNTY.EZCANCELFLAG (+) = '0'
                
                AND PLW.GLBL_CMPY_CD      = TM1.GLBL_CMPY_CD (+)
                AND PLW.PRF_TECH_CD       = TM1.TECH_TOC_CD (+)
                AND TM1.EZCANCELFLAG (+)  = '0'
                
                AND PLW.GLBL_CMPY_CD      = TM2.GLBL_CMPY_CD (+)
                AND PLW.REQ_TECH_CD       = TM2.TECH_TOC_CD (+)

            UNION ALL

            SELECT 
                  PLW.PTY_LOC_PK
                , PLW.LOC_NUM
                , PLW.LOC_NM
                , PLW.CTRY_CD
                , PLW.FIRST_LINE_ADDR
                , PLW.SCD_LINE_ADDR
                , PLW.THIRD_LINE_ADDR
                , PLW.FRTH_LINE_ADDR
                , PLW.POST_CD
                , PLW.CTY_ADDR
                , PLW.ST_CD
                , PLW.CNTY_PK
                , CNTY.CNTY_NM
                , PLW.PROV_NM
                , PLW.TEL_NUM
                , PLW.RGTN_STS_CD
                , PLW.EFF_FROM_DT  AS EFF_FROM_DT_PLW
                , PLW.EFF_THRU_DT  AS EFF_THRU_DT_PLW
                , PLW.GEO_CD
                , PLW.LINE_BIZ_TP_CD
                , PLW.PRF_TECH_CD
                , PLW.REQ_TECH_CD
                , TM1.TECH_NM       AS PRF_TECH_NM
                , TM2.TECH_NM       AS REQ_TECH_NM
                , PLW.EZUPTIME     AS EZUPTIME_PLW
                , PLW.EZUPTIMEZONE AS EZUPTIMEZONE_PLW
                , PLW.DS_LOC_NM
                , ACCT.DS_ACCT_NM
                , ACCT.DS_ACCT_NUM
                , ACCT.CMPY_PK
                , ACCT.DS_ACCT_TP_CD
                , ACCT.PROS_TO_CUST_CHNG_STS_CD
                , 'N' AS PRIN_CUST_FLG
                , NULL AS PRIN_CUST_PK
                , ''  AS EZUPTIME_PR
                , ''  AS EZUPTIMEZONE_PR
                , NULL AS BILL_TO_CUST_PK
                , ''  AS BILL_TO_CUST_CD
                , ''  AS EFF_FROM_DT_BI
                , ''  AS EFF_THRU_DT_BI
                , ''  AS EZUPTIME_BI
                , ''  AS EZUPTIMEZONE_BI
                , ''  AS RGTN_STS_CD_BI
                , 'N' AS DS_ACCT_RELN_BILL_TO_FLG
                , ''  AS PRIM_USG_FLG_BI
                , NULL  AS SHIP_TO_CUST_PK
                , ''  AS SHIP_TO_CUST_CD
                , ''  AS EFF_FROM_DT_SH
                , ''  AS EFF_THRU_DT_SH
                , ''  AS DPL_STS_CD
                , ''  AS EMBGO_FLG
                , ''  AS DPL_MOD_DT_TM_TS
                , ''  AS DPL_RSN_TXT
                , ''  AS EZUPTIME_SH
                , ''  AS EZUPTIMEZONE_SH
                , ''  AS RGTN_STS_CD_SH
                , 'N' AS DS_ACCT_RELN_SHIP_TO_FLG
                , ''  AS RELN_BILL_TO_CUST_CD
                , ''  AS PRIM_USG_FLG_SH
                , PLW.EZINTIME             AS XX_REC_HIST_CRAT_TS
                , PLW.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
                , PLW.EZUPTIME             AS XX_REC_HIST_UPD_TS
                , PLW.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
                , 'PROS_PTY_LOC_WRK'       AS XX_REC_HIST_TBL_NM
                , ''                       AS XX_REC_HIST_CRAT_TS_BI
                , ''                       AS XX_REC_HIST_CRAT_BY_NM_BI
                , ''                       AS XX_REC_HIST_UPD_TS_BI
                , ''                       AS XX_REC_HIST_UPD_BY_NM_BI
                , 'BILL_TO_CUST'           AS XX_REC_HIST_TBL_NM_BI
                , ''                       AS XX_REC_HIST_CRAT_TS_SH
                , ''                       AS XX_REC_HIST_CRAT_BY_NM_SH
                , ''                       AS XX_REC_HIST_UPD_TS_SH
                , ''                       AS XX_REC_HIST_UPD_BY_NM_SH
                , 'SHIP_TO_CUST'           AS XX_REC_HIST_TBL_NM_SH
                <!-- 2020/03/02 QC#55673 Add Start -->
                , PLW.ADDL_LOC_NM
                <!-- 2020/03/02 QC#55673 Add End -->
                <!-- 2023/11/06 QC#61924 Add Start -->
                , 'N'                      AS DEAC_NEW_TRX_FLG
                <!-- 2023/11/06 QC#61924 Add End -->

            FROM 
                  DS_ACCT_PROS      ACCT
                , PROS_PTY_LOC_WRK  PLW
                , CNTY              CNTY
                , TECH_MSTR         TM1
                , TECH_MSTR         TM2
            WHERE 
                    ACCT.GLBL_CMPY_CD = #glblCmpyCd#
                AND ACCT.DS_ACCT_NUM  = #dsAcctNum#
                AND ACCT.EZCANCELFLAG = '0'
                
                AND ACCT.GLBL_CMPY_CD = PLW.GLBL_CMPY_CD
                AND ACCT.PTY_LOC_PK   = PLW.PTY_LOC_PK
                AND PLW.LOC_NUM       = #locNum#
                AND PLW.EZCANCELFLAG  = '0'
                
                AND PLW.GLBL_CMPY_CD      = CNTY.GLBL_CMPY_CD (+)
                AND PLW.CNTY_PK           = CNTY.CNTY_PK (+)
                AND CNTY.EZCANCELFLAG (+) = '0'
                
                AND PLW.GLBL_CMPY_CD     = TM1.GLBL_CMPY_CD (+)
                AND PLW.PRF_TECH_CD      = TM1.TECH_TOC_CD (+)
                AND TM1.EZCANCELFLAG (+) = '0'
                
                AND PLW.GLBL_CMPY_CD     = TM2.GLBL_CMPY_CD (+)
                AND PLW.REQ_TECH_CD      = TM2.TECH_TOC_CD (+)
                AND TM2.EZCANCELFLAG (+) = '0'
                
            )
            WHERE ROWNUM = 1
  </statement>
  <resultMap id="result.getHeaderInfo" class="NMAL6720SMsg">
    <result property="dsAcctNm_H1"            column="DS_ACCT_NM"                javaType="EZDSStringItem" />
    <result property="dsAcctNum_H1"           column="DS_ACCT_NUM"               javaType="EZDSStringItem" />
    <result property="dsAcctTpCd_H1"          column="DS_ACCT_TP_CD"             javaType="EZDSStringItem" />
    <result property="prosToCustChngStsCd_H1" column="PROS_TO_CUST_CHNG_STS_CD"  javaType="EZDSStringItem" />
    <result property="cmpyCd"                 column="CMPY_CD"                   javaType="EZDSStringItem" />
    <result property="cmpyPk"                 column="CMPY_PK"                   javaType="EZDSBigDecimalItem" />
    <result property="prinCustPk"             column="PRIN_CUST_PK"              javaType="EZDSStringItem" />
    <result property="ctryCd_P1"              column="CTRY_CD"                   javaType="EZDSStringItem" />
    <result property="firstLineAddr_H1"       column="FIRST_LINE_ADDR"           javaType="EZDSStringItem" />
    <result property="scdLineAddr_H1"         column="SCD_LINE_ADDR"             javaType="EZDSStringItem" />
    <result property="thirdLineAddr_H1"       column="THIRD_LINE_ADDR"           javaType="EZDSStringItem" />
    <result property="frthLineAddr_H1"        column="FRTH_LINE_ADDR"            javaType="EZDSStringItem" />
    <result property="ctyAddr_H1"             column="CTY_ADDR"                  javaType="EZDSStringItem" />
    <result property="stCd_P1"                column="ST_CD"                     javaType="EZDSStringItem" />
    <result property="postCd_H1"              column="POST_CD"                   javaType="EZDSStringItem" />
    <result property="cntyPk_H1"              column="CNTY_PK"                   javaType="EZDSBigDecimalItem" />
    <result property="cntyNm_H1"              column="CNTY_NM"                   javaType="EZDSStringItem" />
    <result property="provNm_H1"              column="PROV_NM"                   javaType="EZDSStringItem" />
    <result property="locNm_H1"               column="LOC_NM"                    javaType="EZDSStringItem" />
    <result property="locNum_H1"              column="LOC_NUM"                   javaType="EZDSStringItem" />
    <result property="dsLocNm_H1"             column="DS_LOC_NM"                 javaType="EZDSStringItem" />
    <result property="rgtnStsCd_H1"           column="RGTN_STS_CD"               javaType="EZDSStringItem" />
    <result property="effFromDt_H1"           column="EFF_FROM_DT_PLW"           javaType="EZDSStringItem" />
    <result property="effThruDt_H1"           column="EFF_THRU_DT_PLW"           javaType="EZDSStringItem" />
    <result property="geoCd_H1"               column="GEO_CD"                    javaType="EZDSStringItem" />
    <result property="ezUpTime"               column="EZUPTIME_PLW"              javaType="EZDSStringItem" />
    <result property="ezUpTimeZone"           column="EZUPTIMEZONE_PLW"          javaType="EZDSStringItem" />
    <result property="dsAcctRelnBillToFlg_BI" column="DS_ACCT_RELN_BILL_TO_FLG"  javaType="EZDSStringItem" />
    <result property="billToCustPk_BI"        column="BILL_TO_CUST_PK"           javaType="EZDSBigDecimalItem" />
    <result property="effFromDt_BI"           column="EFF_FROM_DT_BI"            javaType="EZDSStringItem" />
    <result property="effThruDt_BI"           column="EFF_THRU_DT_BI"            javaType="EZDSStringItem" />
    <result property="billToCustCd_BI"        column="BILL_TO_CUST_CD"           javaType="EZDSStringItem" />
    <result property="primUsgFlg_BI"          column="PRIM_USG_FLG_BI"           javaType="EZDSStringItem" />
    <result property="ezUpTime_BI"            column="EZUPTIME_BI"               javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_BI"        column="EZUPTIMEZONE_BI"           javaType="EZDSStringItem" />
    <result property="rgtnStsCd_BI"           column="RGTN_STS_CD_BI"            javaType="EZDSStringItem" />
    <result property="dsAcctRelnShipToFlg_SH" column="DS_ACCT_RELN_SHIP_TO_FLG"  javaType="EZDSStringItem" />
    <result property="shipToCustPk_SH"        column="SHIP_TO_CUST_PK"           javaType="EZDSBigDecimalItem" />
    <result property="effFromDt_SH"           column="EFF_FROM_DT_SH"            javaType="EZDSStringItem" />
    <result property="effThruDt_SH"           column="EFF_THRU_DT_SH"            javaType="EZDSStringItem" />
    <result property="shipToCustCd_SH"        column="SHIP_TO_CUST_CD"           javaType="EZDSStringItem" />
    <result property="billToCustCd_SH"        column="RELN_BILL_TO_CUST_CD"      javaType="EZDSStringItem" />
    <result property="primUsgFlg_SH"          column="PRIM_USG_FLG_SH"           javaType="EZDSStringItem" />
    <result property="ezUpTime_SH"            column="EZUPTIME_SH"               javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_SH"        column="EZUPTIMEZONE_SH"           javaType="EZDSStringItem" />
    <result property="rgtnStsCd_SH"           column="RGTN_STS_CD_SH"            javaType="EZDSStringItem" />
    <result property="prinCustPk_PR"          column="PRIN_CUST_PK"              javaType="EZDSBigDecimalItem" />
    <result property="prinCustFlg_PR"         column="PRIN_CUST_FLG"             javaType="EZDSStringItem" />
    <result property="ezUpTime_PR"            column="EZUPTIME_PR"               javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_PR"        column="EZUPTIMEZONE_PR"           javaType="EZDSStringItem" />
    <result property="telNum_H1"              column="TEL_NUM"                   javaType="EZDSStringItem" />
    <result property="lineBizTpCd_P1"         column="LINE_BIZ_TP_CD"            javaType="EZDSStringItem" />
    <result property="dplStsCd_P1"            column="DPL_STS_CD"                javaType="EZDSStringItem" />
    <result property="embgoFlg_H1"            column="EMBGO_FLG"                 javaType="EZDSStringItem" />
    <result property="dplModDtTmTs_H1"        column="DPL_MOD_DT_TM_TS"          javaType="EZDSStringItem" />
    <result property="dplRsnTxt_H1"           column="DPL_RSN_TXT"               javaType="EZDSStringItem" />
    <result property="ptyLocPk"               column="PTY_LOC_PK"                javaType="EZDSBigDecimalItem" />
    <result property="prfTechCd_SA"           column="PRF_TECH_CD"               javaType="EZDSStringItem" />
    <result property="reqTechCd_SA"           column="REQ_TECH_CD"               javaType="EZDSStringItem" />
    <result property="xxAllPsnNm_S1"          column="PRF_TECH_NM"               javaType="EZDSStringItem" />
    <result property="xxAllPsnNm_S2"          column="REQ_TECH_NM"               javaType="EZDSStringItem" />
    <result property="xxRecHistCratTs"        column="XX_REC_HIST_CRAT_TS"       javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm"      column="XX_REC_HIST_CRAT_BY_NM"    javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs"         column="XX_REC_HIST_UPD_TS"        javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm"       column="XX_REC_HIST_UPD_BY_NM"     javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm"         column="XX_REC_HIST_TBL_NM"        javaType="EZDSStringItem" />
    <result property="xxRecHistCratTs_BI"     column="XX_REC_HIST_CRAT_TS_BI"    javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm_BI"   column="XX_REC_HIST_CRAT_BY_NM_BI" javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs_BI"      column="XX_REC_HIST_UPD_TS_BI"     javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm_BI"    column="XX_REC_HIST_UPD_BY_NM_BI"  javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm_BI"      column="XX_REC_HIST_TBL_NM_BI"     javaType="EZDSStringItem" />
    <result property="xxRecHistCratTs_SH"     column="XX_REC_HIST_CRAT_TS_SH"    javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm_SH"   column="XX_REC_HIST_CRAT_BY_NM_SH" javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs_SH"      column="XX_REC_HIST_UPD_TS_SH"     javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm_SH"    column="XX_REC_HIST_UPD_BY_NM_SH"  javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm_SH"      column="XX_REC_HIST_TBL_NM_SH"     javaType="EZDSStringItem" />
    <!-- 2020/03/02 QC#55673 Add Start -->
    <result property="addlLocNm"              column="ADDL_LOC_NM"               javaType="EZDSStringItem" />
    <!-- 2020/03/02 QC#55673 Add End -->
    <!-- 2023/11/06 QC#61924 Add Start -->
    <result property="xxChkBox_H1"            column="DEAC_NEW_TRX_FLG"          javaType="EZDSStringItem" />
    <!-- 2023/11/06 QC#61924 Add End -->
  </resultMap>

  <statement id="getAccountList" parameterClass="Map" resultMap="result.getAccountInfo">
    <isEqual property="dsAcctTpCd" compareValue="10">
        SELECT
            *
        FROM
            (        
                SELECT
                      AL.ACCT_LOC_PK        AS ACCT_LOC_PK
                    , #parent#              AS DS_ACCT_RELN_TP_NM
                    , ACCT.DS_ACCT_NM       AS DS_ACCT_NM
                    , ACCT.SELL_TO_CUST_CD  AS DS_ACCT_NUM
                    <!-- 2017/11/27 QC#20828 Add Start -->
                    , ACCT.DS_ACCT_TP_CD    AS DS_ACCT_TP_CD
                    <!-- 2017/11/27 QC#20828 Add End -->
                    , AL.EFF_FROM_DT        AS EFF_FROM_DT
                    , AL.EFF_THRU_DT        AS EFF_THRU_DT
                    , AL.RGTN_STS_CD        AS RGTN_STS_CD
                    , CASE
                        WHEN AL.RGTN_STS_CD = #rgtnStsCdPrc#
                            THEN #process#
                        WHEN AL.RGTN_STS_CD = #rgtnStsCdAct#
                            THEN #active#
                        ELSE #inActive#
                      END                   AS DS_ACCT_STS_NM
                    , AL.EZUPTIME
                    , AL.EZUPTIMEZONE
                    , AL.EZINTIME           AS XX_REC_HIST_CRAT_TS
                    , AL.EZINUSERID         AS XX_REC_HIST_CRAT_BY_NM
                    , AL.EZUPTIME           AS XX_REC_HIST_UPD_TS
                    , AL.EZUPUSERID         AS XX_REC_HIST_UPD_BY_NM
                    , 'ACCT_LOC'            AS XX_REC_HIST_TBL_NM
                    <!-- 2023/11/06 QC#61924 Add Start -->
                    , ACCT.DEAC_NEW_TRX_FLG AS DEAC_NEW_TRX_FLG
                    <!-- 2023/11/06 QC#61924 Add End -->
                FROM
                    ACCT_LOC AL
                    , SELL_TO_CUST  ACCT
                WHERE
                        AL.GLBL_CMPY_CD = #glblCmpyCd#
                    AND AL.EZCANCELFLAG = '0'
                    AND AL.LOC_NUM      = #locNum#
                    AND AL.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
                    AND AL.DS_ACCT_NUM  = ACCT.SELL_TO_CUST_CD
                    AND ACCT.EZCANCELFLAG = '0'
                    <iterate property="rgtnStsCdList" var="rgtnStsCdList[]" open="AND AL.RGTN_STS_CD IN (" close=")" conjunction=",">
                       #rgtnStsCdList[]#
                    </iterate>
                ORDER BY AL.EFF_FROM_DT
            )
        WHERE
            ROWNUM &lt;= #rowNum#
    </isEqual>
    <isNotEqual property="dsAcctTpCd" compareValue="10">
        SELECT
            *
        FROM
            (        
                SELECT
                      NULL                 AS ACCT_LOC_PK
                    , #parent#           AS DS_ACCT_RELN_TP_NM
                    , ACCT.DS_ACCT_NM    AS DS_ACCT_NM
                    , ACCT.DS_ACCT_NUM   AS DS_ACCT_NUM
                    <!-- 2017/11/27 QC#20828 Add Start -->
                    , ACCT.DS_ACCT_TP_CD AS DS_ACCT_TP_CD
                    <!-- 2017/11/27 QC#20828 Add End -->
                    , PLW.EFF_FROM_DT    AS EFF_FROM_DT
                    , PLW.EFF_THRU_DT    AS EFF_THRU_DT
                    , PLW.RGTN_STS_CD    AS RGTN_STS_CD
                    , CASE
                        WHEN PLW.RGTN_STS_CD = #rgtnStsCdPrc#
                            THEN #process#
                        WHEN PLW.RGTN_STS_CD = #rgtnStsCdAct#
                            THEN #active#
                        ELSE #inActive#
                      END                AS DS_ACCT_STS_NM
                    , PLW.EZUPTIME
                    , PLW.EZUPTIMEZONE
                    , PLW.EZINTIME       AS XX_REC_HIST_CRAT_TS
                    , PLW.EZINUSERID     AS XX_REC_HIST_CRAT_BY_NM
                    , PLW.EZUPTIME       AS XX_REC_HIST_UPD_TS
                    , PLW.EZUPUSERID     AS XX_REC_HIST_UPD_BY_NM
                    , 'PROS_PTY_LOC_WRK' AS XX_REC_HIST_TBL_NM
                FROM
                    PROS_PTY_LOC_WRK PLW
                    , DS_ACCT_PROS  ACCT
                WHERE
                        PLW.GLBL_CMPY_CD  = #glblCmpyCd#
                    AND PLW.EZCANCELFLAG  = '0'
                    AND PLW.LOC_NUM       = #locNum#
                    AND PLW.GLBL_CMPY_CD  = ACCT.GLBL_CMPY_CD
                    AND PLW.PTY_LOC_PK    = ACCT.PTY_LOC_PK
                    AND ACCT.EZCANCELFLAG = '0'
                    <iterate property="rgtnStsCdList" var="rgtnStsCdList[]" open="AND PLW.RGTN_STS_CD IN (" close=")" conjunction=",">
                       #rgtnStsCdList[]#
                    </iterate>
                ORDER BY PLW.EFF_FROM_DT
            )
        WHERE
            ROWNUM &lt;= #rowNum#
    </isNotEqual>
  </statement>
  <resultMap id="result.getAccountInfo" class="NMAL6720_ASMsg">
    <result property="acctLocPk_A1"         column="ACCT_LOC_PK"           javaType="EZDSBigDecimalItem" />
    <result property="dsAcctRelnTpNm_A1"    column="DS_ACCT_RELN_TP_NM"    javaType="EZDSStringItem" />
    <result property="dsAcctNm_A1"          column="DS_ACCT_NM"            javaType="EZDSStringItem" />
    <result property="dsAcctNum_A1"         column="DS_ACCT_NUM"           javaType="EZDSStringItem" />
    <result property="dsAcctTpCd_A1"        column="DS_ACCT_TP_CD"         javaType="EZDSStringItem" />
    <result property="effFromDt_A1"         column="EFF_FROM_DT"           javaType="EZDSStringItem" />
    <result property="effThruDt_A1"         column="EFF_THRU_DT"           javaType="EZDSStringItem" />
    <result property="rgtnStsCd_A1"         column="RGTN_STS_CD"           javaType="EZDSStringItem" />
    <result property="dsAcctStsNm_A1"       column="DS_ACCT_STS_NM"        javaType="EZDSStringItem" />
    <result property="ezUpTime_A1"          column="EZUPTIME"              javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_A1"      column="EZUPTIMEZONE"          javaType="EZDSStringItem" />
    <result property="dsAcctNum_AB"         column="DS_ACCT_NUM"           javaType="EZDSStringItem" />
    <result property="effFromDt_AB"         column="EFF_FROM_DT"           javaType="EZDSStringItem" />
    <result property="effThruDt_AB"         column="EFF_THRU_DT"           javaType="EZDSStringItem" />
    <result property="xxRecHistCratTs_A1"     column="XX_REC_HIST_CRAT_TS"    javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm_A1"   column="XX_REC_HIST_CRAT_BY_NM" javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs_A1"      column="XX_REC_HIST_UPD_TS"     javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm_A1"    column="XX_REC_HIST_UPD_BY_NM"  javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm_A1"      column="XX_REC_HIST_TBL_NM"     javaType="EZDSStringItem" />
    <!-- 2023/11/06 QC#61924 Add Start -->
    <result property="xxChkBox_A1"            column="DEAC_NEW_TRX_FLG"       javaType="EZDSStringItem" />
    <!-- 2023/11/06 QC#61924 Add End -->
  </resultMap>

  <statement id="getClassificationsInfo" parameterClass="Map" resultMap="result.getClassificationsInfo">
    SELECT
        *
    FROM
        (
            SELECT
                  PLW.PTY_LOC_PK
                , PLW.GLN_NUM
                , PLW.DUNS_NUM
                , PLW.GEO_CD
                , PLW.EZUPTIME AS EZUPTIME_PLW
                , PLW.EZUPTIMEZONE AS EZUPTIMEZONE_PLW
                , PLW.DS_ULT_DUNS_NUM
                , PLW.HQ_DUNS_NUM
                , PLW.DS_PRNT_DUNS_NUM
                , PLW.DS_LOC_EMP_NUM
                , PLW.DS_LOC_REV_AMT
                , PLW.DS_CUST_SIC_CD
                , PLW.DS_CUST_SIC_DESC_TXT
                , PLW.DS_LAST_UPD_DUNS_DT
                , PLW.DUNS_TRADE_STYLE_NM
                , PLW.DUNS_ACTV_CD
                , PLW.DUNS_LINE_ADDR
                , PLW.DUNS_BIZ_NM
                , PLW.DS_LAST_RCV_DUNS_TXT
                , PLW.DS_INSD_CTY_LIMIT_FLG
            FROM
                <isEqual property="dsAcctTpCd" compareValue="10">
                  PTY_LOC_WRK PLW
                </isEqual>
                <isNotEqual property="dsAcctTpCd" compareValue="10">
                  PROS_PTY_LOC_WRK PLW
                </isNotEqual>
            WHERE
                    PLW.GLBL_CMPY_CD = #glblCmpyCd#
                AND PLW.LOC_NUM      = #locNum#
                AND PLW.EZCANCELFLAG = '0'
        )
    WHERE
        ROWNUM = 1
  </statement>
  <resultMap id="result.getClassificationsInfo" class="NMAL6720SMsg">
    <result property="ptyLocPk"             column="PTY_LOC_PK"            javaType="EZDSStringItem" />
    <result property="ezUpTime"             column="EZUPTIME_PLW"          javaType="EZDSStringItem" />
    <result property="ezUpTimeZone"         column="EZUPTIMEZONE_PLW"      javaType="EZDSStringItem" />
    <result property="glnNum_H1"            column="GLN_NUM"               javaType="EZDSBigDecimalItem" />
    <result property="dunsNum_H1"           column="DUNS_NUM"              javaType="EZDSStringItem" />
    <result property="dsUltDunsNum_H1"      column="DS_ULT_DUNS_NUM"       javaType="EZDSStringItem" />
    <result property="hqDunsNum_H1"         column="HQ_DUNS_NUM"           javaType="EZDSStringItem" />
    <result property="dsPrntDunsNum_H1"     column="DS_PRNT_DUNS_NUM"      javaType="EZDSStringItem" />
    <result property="dsLocEmpNum_H1"       column="DS_LOC_EMP_NUM"        javaType="EZDSBigDecimalItem" />
    <result property="dsLocRevAmt_H1"       column="DS_LOC_REV_AMT"        javaType="EZDSBigDecimalItem" />
    <result property="dsCustSicCd_H1"       column="DS_CUST_SIC_CD"        javaType="EZDSStringItem" />
    <result property="dsCustSicDescTxt_H1"  column="DS_CUST_SIC_DESC_TXT"  javaType="EZDSStringItem" />
    <result property="dsLastUpdDunsDt_H1"   column="DS_LAST_UPD_DUNS_DT"   javaType="EZDSStringItem" />
    <result property="dunsTradeStyleNm_H1"  column="DUNS_TRADE_STYLE_NM"   javaType="EZDSStringItem" />
    <result property="dunsActvCd_H1"        column="DUNS_ACTV_CD"          javaType="EZDSStringItem" />
    <result property="dunsLineAddr_H1"      column="DUNS_LINE_ADDR"        javaType="EZDSStringItem" />
    <result property="dunsBizNm_H1"         column="DUNS_BIZ_NM"           javaType="EZDSStringItem" />
    <result property="dsLastRcvDunsTxt_H1"  column="DS_LAST_RCV_DUNS_TXT"  javaType="EZDSStringItem" />
    <result property="dsInsdCtyLimitFlg_H1" column="DS_INSD_CTY_LIMIT_FLG" javaType="EZDSStringItem" />
    <result property="geoCd_H1"             column="GEO_CD"                javaType="EZDSStringItem" />
  </resultMap>

  <statement id="getCrossReferenceList" parameterClass="Map" resultMap="result.getCrossReferenceList">
    SELECT
        *
    FROM
        (
            SELECT
                  DXA.DS_XREF_ACCT_PK
                , DXA.DS_XREF_ACCT_TP_CD
                , DXA.DS_XREF_ACCT_NM
                , DXA.DS_XREF_ACCT_CD
                , SUBSTR(DXA.EZUPTIME, 0, 8) AS LAST_UPD_DT
                , DXA.EZUPTIME
                , DXA.EZUPTIMEZONE
                <!-- Add Start 2016/11/16 M.Ohno S21_NA#2680 -->
                , DXA.EZINTIME          AS XX_REC_HIST_CRAT_TS
                , DXA.EZINUSERID        AS XX_REC_HIST_CRAT_BY_NM
                , DXA.EZUPTIME          AS XX_REC_HIST_UPD_TS
                , DXA.EZUPUSERID        AS XX_REC_HIST_UPD_BY_NM
                , 'DS_XREF_ACCT'        AS XX_REC_HIST_TBL_NM
                <!-- Add End   2016/11/16 M.Ohno S21_NA#2680 -->
            FROM
                DS_XREF_ACCT DXA 
            WHERE
                DXA.GLBL_CMPY_CD     = #glblCmpyCd#
                AND DXA.EZCANCELFLAG = '0' 
                AND DXA.LOC_NUM      = #locNum#
        )
    WHERE
        ROWNUM &lt;= #rowNum#
  </statement>
  <resultMap id="result.getCrossReferenceList" class="NMAL6720_BSMsg">
    <result property="dsXrefAcctPk_B1"   column="DS_XREF_ACCT_PK"    javaType="EZDSStringItem" />
    <result property="dsXrefAcctTpCd_P1" column="DS_XREF_ACCT_TP_CD" javaType="EZDSStringItem" />
    <result property="dsXrefAcctNm_B1"   column="DS_XREF_ACCT_NM"    javaType="EZDSStringItem" />
    <result property="dsXrefAcctCd_B1"   column="DS_XREF_ACCT_CD"    javaType="EZDSStringItem" />
    <result property="lastUpdDt_B1"      column="LAST_UPD_DT"        javaType="EZDSStringItem" />
    <result property="ezUpTime_B1"       column="EZUPTIME"           javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_B1"   column="EZUPTIMEZONE"       javaType="EZDSStringItem" />
    <!-- Add Start 2016/11/16 M.Ohno S21_NA#2680 -->
    <result property="xxRecHistCratTs_B1"     column="XX_REC_HIST_CRAT_TS"    javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm_B1"   column="XX_REC_HIST_CRAT_BY_NM" javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs_B1"      column="XX_REC_HIST_UPD_TS"     javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm_B1"    column="XX_REC_HIST_UPD_BY_NM"  javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm_B1"      column="XX_REC_HIST_TBL_NM"     javaType="EZDSStringItem" />
    <!-- Add End   2016/11/16 M.Ohno S21_NA#2680 -->
  </resultMap>

  <statement id="getContactList" parameterClass="Map" resultMap="result.getContactList">

    <!-- START 2017/12/18 Hd.Sugawara [QC#22286,MOD] -->
    <!-- SELECT  -->
    <!--     * -->
    <!-- FROM  -->
    WITH ALL_CONTACTS AS
    <!-- END 2017/12/18 Hd.Sugawara [QC#22286,MOD] -->
        (
            SELECT
                  CP.CTAC_PSN_PK
                , CP.CTAC_PSN_NUM
                , DCPR.CTAC_TP_CD
                <!-- START 2017/12/06 Hd.Sugawara [QC#21897,MOD] -->
                <!-- , CT.CTAC_TP_NM -->
                , CT.CTAC_TP_DESC_TXT
                <!-- END 2017/12/06 Hd.Sugawara [QC#21897,MOD] -->
                , CP.CTAC_PSN_FIRST_NM
                , CP.CTAC_PSN_LAST_NM
                , DCPD.DS_CTAC_PSN_DEPT_NM
                , DCPR.DS_CTAC_PSN_RELN_PK
                , DCPR.EFF_FROM_DT
                , DCPR.EFF_THRU_DT
                , CP.EZINTIME          AS XX_REC_HIST_CRAT_TS
                , CP.EZINUSERID        AS XX_REC_HIST_CRAT_BY_NM
                , CP.EZUPTIME          AS XX_REC_HIST_UPD_TS
                , CP.EZUPUSERID        AS XX_REC_HIST_UPD_BY_NM
                , 'CTAC_PSN'           AS XX_REC_HIST_TBL_NM
                , CASE
                    WHEN CP.CTAC_PSN_ACTV_FLG = 'Y'
                        THEN #active#
                        ELSE #inActive#
                  END AS DS_ACCT_STS_NM
                , ( SELECT 
                      A.DS_CTAC_PNT_VAL_TXT 
                  FROM
                    (
                        SELECT
                              B.GLBL_CMPY_CD
                            , B.CTAC_PSN_PK
                            , B.DS_CTAC_PNT_TP_CD
                            , B.DS_CTAC_PNT_PK
                            , P2.DS_CTAC_PNT_VAL_TXT
                            , P2.DS_CTAC_PSN_EXTN_NUM
                        FROM 
                            DS_CTAC_PNT P2,
                            (
                                SELECT
                                      P.GLBL_CMPY_CD
                                    , P.CTAC_PSN_PK
                                    , TP.DS_CTAC_PNT_TP_CD
                                    , MAX(P.DS_CTAC_PNT_PK) AS DS_CTAC_PNT_PK
                                 FROM 
                                      DS_CTAC_PNT P
                                    , DS_CTAC_PNT_TP TP
                                WHERE
                                        P.GLBL_CMPY_CD         = #glblCmpyCd#
                                    AND P.DS_CTAC_PNT_ACTV_FLG = 'Y'
                                    AND P.EZCANCELFLAG         = '0'
                                    AND P.GLBL_CMPY_CD         = TP.GLBL_CMPY_CD
                                    AND P.DS_CTAC_PNT_TP_CD    = TP.DS_CTAC_PNT_TP_CD
                                    AND TP.EZCANCELFLAG        = '0'
                                    AND TP.DS_CTAC_PNT_TP_CD   = #dsCtacPntTpCd_P#
                                GROUP BY
                                      P.GLBL_CMPY_CD
                                    , P.CTAC_PSN_PK
                                    , TP.DS_CTAC_PNT_TP_CD
                            ) B
                        WHERE 
                            P2.GLBL_CMPY_CD = B.GLBL_CMPY_CD
                        AND P2.DS_CTAC_PNT_PK = B.DS_CTAC_PNT_PK
                    ) A
                  WHERE
                       A.GLBL_CMPY_CD = CP.GLBL_CMPY_CD
                  AND  A.CTAC_PSN_PK = CP.CTAC_PSN_PK
                ) AS PHONE
                , ( SELECT 
                      A.DS_CTAC_PSN_EXTN_NUM 
                  FROM
                    (
                        SELECT
                              B.GLBL_CMPY_CD
                            , B.CTAC_PSN_PK
                            , B.DS_CTAC_PNT_TP_CD
                            , B.DS_CTAC_PNT_PK
                            , P2.DS_CTAC_PNT_VAL_TXT
                            , P2.DS_CTAC_PSN_EXTN_NUM
                        FROM 
                            DS_CTAC_PNT P2,
                            (
                                SELECT
                                      P.GLBL_CMPY_CD
                                    , P.CTAC_PSN_PK
                                    , TP.DS_CTAC_PNT_TP_CD
                                    , MAX(P.DS_CTAC_PNT_PK) AS DS_CTAC_PNT_PK
                                 FROM 
                                      DS_CTAC_PNT P
                                    , DS_CTAC_PNT_TP TP
                                WHERE
                                        P.GLBL_CMPY_CD         = #glblCmpyCd#
                                    AND P.DS_CTAC_PNT_ACTV_FLG = 'Y'
                                    AND P.EZCANCELFLAG         = '0'
                                    AND P.GLBL_CMPY_CD         = TP.GLBL_CMPY_CD
                                    AND P.DS_CTAC_PNT_TP_CD    = TP.DS_CTAC_PNT_TP_CD
                                    AND TP.EZCANCELFLAG        = '0'
                                    AND TP.DS_CTAC_PNT_TP_CD   = #dsCtacPntTpCd_P#
                                GROUP BY
                                      P.GLBL_CMPY_CD
                                    , P.CTAC_PSN_PK
                                    , TP.DS_CTAC_PNT_TP_CD
                            ) B
                        WHERE 
                            P2.GLBL_CMPY_CD = B.GLBL_CMPY_CD
                        AND P2.DS_CTAC_PNT_PK = B.DS_CTAC_PNT_PK
                    ) A
                  WHERE 
                      A.GLBL_CMPY_CD = CP.GLBL_CMPY_CD
                  AND A.CTAC_PSN_PK = CP.CTAC_PSN_PK
                ) AS EXT
                , ( SELECT 
                      A.DS_CTAC_PNT_VAL_TXT 
                  FROM
                    (
                        SELECT
                              B.GLBL_CMPY_CD
                            , B.CTAC_PSN_PK
                            , B.DS_CTAC_PNT_TP_CD
                            , B.DS_CTAC_PNT_PK
                            , P2.DS_CTAC_PNT_VAL_TXT
                            , P2.DS_CTAC_PSN_EXTN_NUM
                        FROM 
                            DS_CTAC_PNT P2,
                            (
                                SELECT
                                      P.GLBL_CMPY_CD
                                    , P.CTAC_PSN_PK
                                    , TP.DS_CTAC_PNT_TP_CD
                                    , MAX(P.DS_CTAC_PNT_PK) AS DS_CTAC_PNT_PK
                                 FROM 
                                      DS_CTAC_PNT P
                                    , DS_CTAC_PNT_TP TP
                                WHERE
                                        P.GLBL_CMPY_CD         = #glblCmpyCd#
                                    AND P.DS_CTAC_PNT_ACTV_FLG = 'Y'
                                    AND P.EZCANCELFLAG         = '0'
                                    AND P.GLBL_CMPY_CD         = TP.GLBL_CMPY_CD
                                    AND P.DS_CTAC_PNT_TP_CD    = TP.DS_CTAC_PNT_TP_CD
                                    AND TP.EZCANCELFLAG        = '0'
                                    AND TP.DS_CTAC_PNT_TP_CD   = #dsCtacPntTpCd_E#
                                GROUP BY
                                      P.GLBL_CMPY_CD
                                    , P.CTAC_PSN_PK
                                    , TP.DS_CTAC_PNT_TP_CD
                            ) B
                        WHERE 
                             P2.GLBL_CMPY_CD = B.GLBL_CMPY_CD
                        AND  P2.DS_CTAC_PNT_PK = B.DS_CTAC_PNT_PK
                    ) A
                  WHERE 
                       A.GLBL_CMPY_CD = CP.GLBL_CMPY_CD
                  AND  A.CTAC_PSN_PK  = CP.CTAC_PSN_PK
                ) AS EMAIL
                , DCPR.DS_PRIM_LOC_FLG
                , REPLACE(DCPR.DS_PRIM_LOC_FLG,'N','') AS DS_PRIM_LOC_FLG_BK
                , DCPR.EZUPTIME
                , DCPR.EZUPTIMEZONE
                , 1  AS SORT_NUM <!-- Add 2018/08/28 QC#27869 -->
            FROM
                  DS_CTAC_PSN_RELN DCPR
                , CTAC_PSN         CP
                , CTAC_TP          CT
                , DS_CTAC_PSN_DEPT DCPD
            WHERE
                    DCPR.GLBL_CMPY_CD = #glblCmpyCd#
                AND DCPR.LOC_NUM LIKE #locNum#
                AND DCPR.EZCANCELFLAG = '0'
                AND DCPR.GLBL_CMPY_CD = CP.GLBL_CMPY_CD
                AND DCPR.CTAC_PSN_PK  = CP.CTAC_PSN_PK
                AND CP.EZCANCELFLAG   = '0'
                AND DCPR.GLBL_CMPY_CD   = CT.GLBL_CMPY_CD
                AND DCPR.CTAC_TP_CD     = CT.CTAC_TP_CD
                AND CT.EZCANCELFLAG     = '0'
                AND CP.GLBL_CMPY_CD         = DCPD.GLBL_CMPY_CD (+)
                AND CP.DS_CTAC_PSN_DEPT_CD  = DCPD.DS_CTAC_PSN_DEPT_CD (+)
                AND DCPD.EZCANCELFLAG (+)   = '0'
                <isNotEqual property="showInactiveFlg" compareValue="Y">
                 AND CP.CTAC_PSN_ACTV_FLG = 'Y'
                </isNotEqual>
                <isNotNull property="ctacPsnPk">
                AND CP.CTAC_PSN_PK = #ctacPsnPk#
                </isNotNull>
            <!-- START 2017/12/18 Hd.Sugawara [QC#22286,DEL] -->
            <!-- ORDER BY -->
            <!--     CP.CTAC_PSN_LAST_NM -->
            <!-- END 2017/12/18 Hd.Sugawara [QC#22286,DEL] -->
            <!-- Add Start 2018/08/28 QC#27869 -->
            UNION ALL
            SELECT 
                  V.CTAC_PSN_PK       AS CTAC_PSN_PK
                , V.CTAC_PSN_NUM      AS CTAC_PSN_NUM
                , V.CTAC_TP_CD        AS CTAC_TP_CD
                , V.CTAC_TP_DESC_TXT  AS CTAC_TP_DESC_TXT
                , V.CTAC_PSN_FIRST_NM AS CTAC_PSN_FIRST_NM
                , V.CTAC_PSN_LAST_NM  AS CTAC_PSN_LAST_NM
                , ''                             AS DS_CTAC_PSN_DEPT_NM
                , NULL                           AS DS_CTAC_PSN_RELN_PK
                , V.EFF_FROM_DT             AS EFF_FROM_DT
                , V.EFF_THRU_DT             AS EFF_THRU_DT
                , ''                             AS XX_REC_HIST_CRAT_TS
                , ''                             AS XX_REC_HIST_CRAT_BY_NM
                , ''                             AS XX_REC_HIST_UPD_TS
                , ''                             AS XX_REC_HIST_UPD_BY_NM
                , ''                             AS XX_REC_HIST_TBL_NM

                ,CASE WHEN V.EFF_FROM_DT &lt;= #salesDt# AND  NVL(V.EFF_THRU_DT,#maxDt#) &gt;= #salesDt#  THEN #active# ELSE #inActive# END  DS_ACCT_STS_NM

                , ( SELECT
                         A.DS_CTAC_PNT_VAL_TXT
                     FROM
                         (
                          SELECT
                              B.CTAC_PSN_PK
                             ,B.DS_CTAC_PNT_TP_CD
                             ,B.DS_CTAC_PNT_PK
                             ,P2.DS_CTAC_PNT_VAL_TXT
                             ,P2.DS_CTAC_PSN_EXTN_NUM
                          FROM
                              DS_CTAC_PNT P2
                             ,(
                               SELECT
                                   P.GLBL_CMPY_CD
                                  ,P.CTAC_PSN_PK
                                  ,TP.DS_CTAC_PNT_TP_CD
                                  ,MAX(P.DS_CTAC_PNT_PK) AS DS_CTAC_PNT_PK
                               FROM
                                   DS_CTAC_PNT P
                                  ,DS_CTAC_PNT_TP TP
                               WHERE
                                   P.GLBL_CMPY_CD             = #glblCmpyCd#
                                   AND P.DS_CTAC_PNT_ACTV_FLG = 'Y'
                                   AND P.EZCANCELFLAG         = '0'
                                   AND P.GLBL_CMPY_CD         = TP.GLBL_CMPY_CD
                                   AND P.DS_CTAC_PNT_TP_CD    = TP.DS_CTAC_PNT_TP_CD
                                   AND TP.EZCANCELFLAG        = '0'
                                   AND TP.DS_CTAC_PNT_TP_CD   = #dsCtacPntTpCd_P#
                               GROUP BY
                                   P.GLBL_CMPY_CD
                                  ,P.CTAC_PSN_PK
                                  ,TP.DS_CTAC_PNT_TP_CD
                              ) B
                          WHERE
                             P2.GLBL_CMPY_CD   = B.GLBL_CMPY_CD
                          AND P2.DS_CTAC_PNT_PK = B.DS_CTAC_PNT_PK
                         ) A
                     WHERE
                         A.CTAC_PSN_PK   = V.CTAC_PSN_PK
                ) AS PHONE
                , ( SELECT
                         A.DS_CTAC_PSN_EXTN_NUM
                     FROM
                         (
                          SELECT
                              B.CTAC_PSN_PK
                             ,B.DS_CTAC_PNT_TP_CD
                             ,B.DS_CTAC_PNT_PK
                             ,P2.DS_CTAC_PNT_VAL_TXT
                             ,P2.DS_CTAC_PSN_EXTN_NUM
                          FROM
                              DS_CTAC_PNT P2
                             ,(
                               SELECT
                                   P.GLBL_CMPY_CD
                                  ,P.CTAC_PSN_PK
                                  ,TP.DS_CTAC_PNT_TP_CD
                                  ,MAX(P.DS_CTAC_PNT_PK) AS DS_CTAC_PNT_PK
                               FROM
                                   DS_CTAC_PNT P
                                  ,DS_CTAC_PNT_TP TP
                               WHERE
                                   P.GLBL_CMPY_CD             = #glblCmpyCd#
                                   AND P.DS_CTAC_PNT_ACTV_FLG = 'Y'
                                   AND P.EZCANCELFLAG         = '0'
                                   AND P.GLBL_CMPY_CD         = TP.GLBL_CMPY_CD
                                   AND P.DS_CTAC_PNT_TP_CD    = TP.DS_CTAC_PNT_TP_CD
                                   AND TP.EZCANCELFLAG        = '0'
                                   AND TP.DS_CTAC_PNT_TP_CD   = #dsCtacPntTpCd_P#
                               GROUP BY
                                   P.GLBL_CMPY_CD
                                  ,P.CTAC_PSN_PK
                                  ,TP.DS_CTAC_PNT_TP_CD
                              ) B
                          WHERE
                              P2.GLBL_CMPY_CD   = B.GLBL_CMPY_CD
                          AND P2.DS_CTAC_PNT_PK = B.DS_CTAC_PNT_PK
                         ) A
                     WHERE
                         A.CTAC_PSN_PK   = V.CTAC_PSN_PK
                ) AS EXT
                , ( SELECT
                         A.DS_CTAC_PNT_VAL_TXT
                     FROM
                         (
                          SELECT
                              B.CTAC_PSN_PK
                             ,B.DS_CTAC_PNT_TP_CD
                             ,B.DS_CTAC_PNT_PK
                             ,P2.DS_CTAC_PNT_VAL_TXT
                             ,P2.DS_CTAC_PSN_EXTN_NUM
                          FROM
                              DS_CTAC_PNT P2
                             ,(
                               SELECT
                                   P.GLBL_CMPY_CD
                                  ,P.CTAC_PSN_PK
                                  ,TP.DS_CTAC_PNT_TP_CD
                                  ,MAX(P.DS_CTAC_PNT_PK) AS DS_CTAC_PNT_PK
                               FROM
                                   DS_CTAC_PNT P
                                  ,DS_CTAC_PNT_TP TP
                               WHERE
                                   P.GLBL_CMPY_CD             = #glblCmpyCd#
                                   AND P.DS_CTAC_PNT_ACTV_FLG = 'Y'
                                   AND P.EZCANCELFLAG         = '0'
                                   AND P.GLBL_CMPY_CD         = TP.GLBL_CMPY_CD
                                   AND P.DS_CTAC_PNT_TP_CD    = TP.DS_CTAC_PNT_TP_CD
                                   AND TP.EZCANCELFLAG        = '0'
                                   AND TP.DS_CTAC_PNT_TP_CD   = #dsCtacPntTpCd_E#
                               GROUP BY
                                   P.GLBL_CMPY_CD
                                  ,P.CTAC_PSN_PK
                                  ,TP.DS_CTAC_PNT_TP_CD
                              ) B
                          WHERE
                              P2.GLBL_CMPY_CD   = B.GLBL_CMPY_CD
                          AND P2.DS_CTAC_PNT_PK = B.DS_CTAC_PNT_PK
                         ) A
                     WHERE
                         A.CTAC_PSN_PK   = V.CTAC_PSN_PK
                ) AS EMAIL
                , 'N' AS DS_PRIM_LOC_FLG
                , '' AS DS_PRIM_LOC_FLG_BK
                , '' AS EZUPTIME
                , '' AS EZUPTIMEZONE
                , 2  AS SORT_NUM
            FROM (
                SELECT  
                    DCP.CTAC_PSN_PK AS CTAC_PSN_PK
                    , CP.CTAC_PSN_NUM AS CTAC_PSN_NUM
                    , CP.CTAC_PSN_FIRST_NM AS CTAC_PSN_FIRST_NM
                    , CP.CTAC_PSN_LAST_NM AS CTAC_PSN_LAST_NM
                    , SCP.SVC_CTAC_TP_CD AS CTAC_TP_CD
                    , SCP.SVC_CTAC_TP_DESC_TXT AS CTAC_TP_DESC_TXT
                    , MIN(SMCP.EFF_FROM_DT) AS EFF_FROM_DT
                    , MAX(SMCP.EFF_THRU_DT) AS EFF_THRU_DT
                FROM
                    SVC_MACH_CTAC_PSN SMCP
                    , DS_CTAC_PNT DCP
                    , SVC_CTAC_TP SCP
                    , CTAC_PSN CP
                    , DS_CTAC_PSN_RELN DCPR
                WHERE SMCP.GLBL_CMPY_CD = #glblCmpyCd#
                AND  SMCP.EZCANCELFLAG = '0'
                AND EXISTS ( SELECT
                                1
                             FROM
                                 SVC_MACH_MSTR SMM
                             WHERE
                                 SMM.IND_CUR_LOC_NUM LIKE #locNum#
                             AND SMM.GLBL_CMPY_CD = SMCP.GLBL_CMPY_CD
                             AND SMM.SVC_MACH_MSTR_PK = SMCP.SVC_MACH_MSTR_PK
                             AND SMM.EZCANCELFLAG = '0')

                AND SMCP.GLBL_CMPY_CD = DCP.GLBL_CMPY_CD
                AND SMCP.DS_CTAC_PNT_PK = DCP.DS_CTAC_PNT_PK
                AND DCP.EZCANCELFLAG = '0' 

                AND SMCP.GLBL_CMPY_CD = SCP.GLBL_CMPY_CD
                AND SMCP.SVC_CTAC_TP_CD = SCP.SVC_CTAC_TP_CD 
                AND SCP.EZCANCELFLAG = '0'

                AND DCP.GLBL_CMPY_CD = CP.GLBL_CMPY_CD
                AND DCP.CTAC_PSN_PK = CP.CTAC_PSN_PK
                AND CP.EZCANCELFLAG = '0'
                <isNotEqual property="showInactiveFlg" compareValue="Y">
                    AND SMCP.EFF_FROM_DT &lt;= #salesDt# AND  NVL(SMCP.EFF_THRU_DT,#maxDt#) &gt;= #salesDt#
                </isNotEqual>
                <isNotNull property="ctacPsnPk">
                    AND CP.CTAC_PSN_PK = #ctacPsnPk#
                </isNotNull>

                AND CP.GLBL_CMPY_CD = DCPR.GLBL_CMPY_CD
                AND CP.CTAC_PSN_PK = DCPR.CTAC_PSN_PK
                AND DCPR.LOC_NUM = #locNum#
                AND DCPR.EZCANCELFLAG = '0'

                GROUP BY DCP.CTAC_PSN_PK, CP.CTAC_PSN_NUM, CP.CTAC_PSN_FIRST_NM, CP.CTAC_PSN_LAST_NM, SCP.SVC_CTAC_TP_CD, SCP.SVC_CTAC_TP_DESC_TXT
            ) V
            <!-- Add End   2018/08/28 QC#27869 -->
        )
    <!-- START 2017/12/18 Hd.Sugawara [QC#22286,ADD] -->
    SELECT
        CTAC_PSN_PK
      , CTAC_PSN_NUM
      , CTAC_TP_CD
      , CTAC_TP_DESC_TXT
      , CTAC_PSN_FIRST_NM
      , CTAC_PSN_LAST_NM
      , DS_CTAC_PSN_DEPT_NM
      , DS_CTAC_PSN_RELN_PK
      , EFF_FROM_DT
      , EFF_THRU_DT
      , XX_REC_HIST_CRAT_TS
      , XX_REC_HIST_CRAT_BY_NM
      , XX_REC_HIST_UPD_TS
      , XX_REC_HIST_UPD_BY_NM
      , XX_REC_HIST_TBL_NM
      , DS_ACCT_STS_NM
      , PHONE
      , EXT
      , EMAIL
      , DS_PRIM_LOC_FLG
      , DS_PRIM_LOC_FLG_BK
      , EZUPTIME
      , EZUPTIMEZONE
    FROM
        (
            SELECT
                CTAC_PSN_PK
              , CTAC_PSN_NUM
              , CTAC_TP_CD
              , CTAC_TP_DESC_TXT
              , CTAC_PSN_FIRST_NM
              , CTAC_PSN_LAST_NM
              , DS_CTAC_PSN_DEPT_NM
              , DS_CTAC_PSN_RELN_PK
              , EFF_FROM_DT
              , EFF_THRU_DT
              , XX_REC_HIST_CRAT_TS
              , XX_REC_HIST_CRAT_BY_NM
              , XX_REC_HIST_UPD_TS
              , XX_REC_HIST_UPD_BY_NM
              , XX_REC_HIST_TBL_NM
              , DS_ACCT_STS_NM
              , PHONE
              , EXT
              , EMAIL
              , DS_PRIM_LOC_FLG
              , DS_PRIM_LOC_FLG_BK
              , EZUPTIME
              , EZUPTIMEZONE
              , SORT_NUM
            FROM
                ALL_CONTACTS AC
            WHERE
                AC.CTAC_TP_CD &lt;&gt; #ctacTpCd#
            UNION ALL
            SELECT
                CTAC_PSN_PK
              , CTAC_PSN_NUM
              , CTAC_TP_CD
              , '' AS CTAC_TP_DESC_TXT
              , CTAC_PSN_FIRST_NM
              , CTAC_PSN_LAST_NM
              , DS_CTAC_PSN_DEPT_NM
              , DS_CTAC_PSN_RELN_PK
              , EFF_FROM_DT
              , EFF_THRU_DT
              , XX_REC_HIST_CRAT_TS
              , XX_REC_HIST_CRAT_BY_NM
              , XX_REC_HIST_UPD_TS
              , XX_REC_HIST_UPD_BY_NM
              , XX_REC_HIST_TBL_NM
              , DS_ACCT_STS_NM
              , PHONE
              , EXT
              , EMAIL
              , DS_PRIM_LOC_FLG
              , DS_PRIM_LOC_FLG_BK
              , EZUPTIME
              , EZUPTIMEZONE
              , SORT_NUM
            FROM
                ALL_CONTACTS AC
            WHERE
                AC.CTAC_TP_CD = #ctacTpCd#
                AND NOT EXISTS (
                    SELECT
                        CTAC_TP_CD
                    FROM
                        ALL_CONTACTS AC2
                    WHERE
                        AC2.CTAC_TP_CD &lt;&gt; #ctacTpCd#
                        <!-- 2018/01/15 QC#22286-2 add start -->
                        AND AC.CTAC_PSN_NUM = AC2.CTAC_PSN_NUM
                        <!-- 2018/01/15 QC#22286-2 add end -->
                )
            ORDER BY
                CTAC_PSN_LAST_NM,SORT_NUM,CTAC_TP_CD
        )
    <!-- END 2017/12/18 Hd.Sugawara [QC#22286,ADD] -->
    WHERE

        ROWNUM &lt;= #rowNum#
  </statement>
  <resultMap id="result.getContactList" class="NMAL6720_CSMsg">
    <result property="ctacPsnPk_C1"        column="CTAC_PSN_PK"          javaType="EZDSBigDecimalItem" />
    <result property="dsCtacPsnRelnPk_C1"  column="DS_CTAC_PSN_RELN_PK"  javaType="EZDSBigDecimalItem" />
    <result property="ctacPsnNum_C1"       column="CTAC_PSN_NUM"         javaType="EZDSStringItem" />
    <result property="ctacTpCd_C1"         column="CTAC_TP_CD"           javaType="EZDSStringItem" />
    <!-- START 2017/12/06 Hd.Sugawara [QC#21897,MOD] -->
    <!-- <result property="ctacTpNm_C1"         column="CTAC_TP_NM"           javaType="EZDSStringItem" /> -->
    <result property="ctacTpDescTxt_C1"    column="CTAC_TP_DESC_TXT"     javaType="EZDSStringItem" />
    <!-- END 2017/12/06 Hd.Sugawara [QC#21897,MOD] -->
    <result property="ctacPsnFirstNm_C1"   column="CTAC_PSN_FIRST_NM"    javaType="EZDSStringItem" />
    <result property="ctacPsnLastNm_C1"    column="CTAC_PSN_LAST_NM"     javaType="EZDSStringItem" />
    <result property="dsCtacPsnDeptNm_C1"  column="DS_CTAC_PSN_DEPT_NM"  javaType="EZDSStringItem" />
    <result property="dsCtacPntValTxt_C1"  column="PHONE"                javaType="EZDSStringItem" />
    <result property="dsCtacPntValTxt_C2"  column="EMAIL"                javaType="EZDSStringItem" />
    <result property="dsCtacPsnExtnNum_C1" column="EXT"                  javaType="EZDSStringItem" />
    <result property="effFromDt_C1"        column="EFF_FROM_DT"          javaType="EZDSStringItem" />
    <result property="effThruDt_C1"        column="EFF_THRU_DT"          javaType="EZDSStringItem" />
    <result property="dsPrimLocFlg_C1"     column="DS_PRIM_LOC_FLG"      javaType="EZDSStringItem" />
    <result property="dsPrimLocFlg_CB"     column="DS_PRIM_LOC_FLG_BK"   javaType="EZDSStringItem" />
    <result property="dsAcctStsNm_C1"      column="DS_ACCT_STS_NM"       javaType="EZDSStringItem" />
    <result property="ezUpTime_C1"         column="EZUPTIME"            javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_C1"     column="EZUPTIMEZONE"        javaType="EZDSStringItem" />
    <!-- Add Start 2016/11/16 M.Ohno S21_NA#2680 -->
    <result property="xxRecHistCratTs_C1"     column="XX_REC_HIST_CRAT_TS"    javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm_C1"   column="XX_REC_HIST_CRAT_BY_NM" javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs_C1"      column="XX_REC_HIST_UPD_TS"     javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm_C1"    column="XX_REC_HIST_UPD_BY_NM"  javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm_C1"      column="XX_REC_HIST_TBL_NM"     javaType="EZDSStringItem" />
    <!-- Add End   2016/11/16 M.Ohno S21_NA#2680 -->
  </resultMap>

  <statement id="getTransactionList" parameterClass="Map" resultMap="result.getTransactionList">
    SELECT
        *
    FROM
        (
            SELECT
                  DCTR.DS_CUST_TRX_RULE_PK
                , DCTR.DS_TRX_RULE_TP_CD
                , DCTR.DS_PO_REQ_FLG
                , DCTR.DS_BLKT_PO_NUM
                , DCTR.DS_PO_EXPR_DT
                , DCTR.DS_DEF_BILL_TO_CD
                , DCTR.DS_DEF_SHIP_TO_CD
                , DCTR.DS_CR_CARD_REQ_FLG
                , DCTR.DS_OVNGT_ALLW_FLG 
                , DCTR.EZUPTIME
                , DCTR.EZUPTIMEZONE
                 <!-- Add Start 2016/11/16 M.Ohno S21_NA#2680 -->
                , DCTR.EZINTIME          AS XX_REC_HIST_CRAT_TS
                , DCTR.EZINUSERID        AS XX_REC_HIST_CRAT_BY_NM
                , DCTR.EZUPTIME          AS XX_REC_HIST_UPD_TS
                , DCTR.EZUPUSERID        AS XX_REC_HIST_UPD_BY_NM
                , 'DS_CUST_TRX_RULE'     AS XX_REC_HIST_TBL_NM
                <!-- Add End   2016/11/16 M.Ohno S21_NA#2680 -->
            FROM
                DS_CUST_TRX_RULE DCTR
            WHERE
                    DCTR.GLBL_CMPY_CD = #glblCmpyCd# 
                AND DCTR.LOC_NUM      = #locNum#
                AND DCTR.EZCANCELFLAG = '0' 
            ORDER BY
                DCTR.DS_CUST_TRX_RULE_PK
        )
    WHERE 
        ROWNUM &lt;= #rowNum#
  </statement>
  <resultMap id="result.getTransactionList" class="NMAL6720_DSMsg">
    <result property="dsCustTrxRulePk_D1" column="DS_CUST_TRX_RULE_PK" javaType="EZDSBigDecimalItem" />
    <result property="dsTrxRuleTpCd_P1"   column="DS_TRX_RULE_TP_CD"   javaType="EZDSStringItem" />
    <result property="dsPoReqFlg_D1"      column="DS_PO_REQ_FLG"       javaType="EZDSStringItem" />
    <result property="dsBlktPoNum_D1"     column="DS_BLKT_PO_NUM"      javaType="EZDSStringItem" />
    <result property="dsPoExprDt_D1"      column="DS_PO_EXPR_DT"       javaType="EZDSStringItem" />
    <result property="dsDefBillToCd_D1"   column="DS_DEF_BILL_TO_CD"   javaType="EZDSStringItem" />
    <result property="dsDefShipToCd_D1"   column="DS_DEF_SHIP_TO_CD"   javaType="EZDSStringItem" />
    <result property="dsCrCardReqFlg_D1"  column="DS_CR_CARD_REQ_FLG"  javaType="EZDSStringItem" />
    <result property="dsOvngtAllwFlg_D1"  column="DS_OVNGT_ALLW_FLG"   javaType="EZDSStringItem" />
    <result property="ezUpTime_D1"        column="EZUPTIME"            javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_D1"    column="EZUPTIMEZONE"        javaType="EZDSStringItem" />
    <!-- Add Start 2016/11/16 M.Ohno S21_NA#2680 -->
    <result property="xxRecHistCratTs_D1"     column="XX_REC_HIST_CRAT_TS"    javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm_D1"   column="XX_REC_HIST_CRAT_BY_NM" javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs_D1"      column="XX_REC_HIST_UPD_TS"     javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm_D1"    column="XX_REC_HIST_UPD_BY_NM"  javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm_D1"      column="XX_REC_HIST_TBL_NM"     javaType="EZDSStringItem" />
    <!-- Add End   2016/11/16 M.Ohno S21_NA#2680 -->
  </resultMap>

  <statement id="getMsgNoteList" parameterClass="Map" resultMap="result.getMsgNoteList">
    SELECT
        *
    FROM
        (
            SELECT
                  DCSM.DS_CUST_SPCL_MSG_PK
                , DCSM.LINE_BIZ_TP_CD
                , DCSM.DS_BIZ_AREA_CD
                , DCSM.DS_CUST_MSG_TP_CD
                , DCSM.DS_CUST_MSG_TXT
                , DCSM.DS_PRINT_ON_INV_FLG
                , DCSM.EFF_THRU_DT
                , DCSM.EZUPTIME
                , DCSM.EZUPTIMEZONE
                <!-- Add Start 2016/11/16 M.Ohno S21_NA#2680 -->
                , DCSM.EZINTIME          AS XX_REC_HIST_CRAT_TS
                , DCSM.EZINUSERID        AS XX_REC_HIST_CRAT_BY_NM
                , DCSM.EZUPTIME          AS XX_REC_HIST_UPD_TS
                , DCSM.EZUPUSERID        AS XX_REC_HIST_UPD_BY_NM
                , 'DS_CUST_SPCL_MSG'     AS XX_REC_HIST_TBL_NM
                <!-- Add End   2016/11/16 M.Ohno S21_NA#2680 -->
            FROM
                DS_CUST_SPCL_MSG DCSM
            WHERE
                    DCSM.GLBL_CMPY_CD = #glblCmpyCd#
                AND DCSM.LOC_NUM      = #locNum#
                AND DCSM.EZCANCELFLAG = '0' 
        )
    WHERE
        ROWNUM &lt;= #rowNum#
  </statement>
  <resultMap id="result.getMsgNoteList" class="NMAL6720_ESMsg">
    <result property="dsCustSpclMsgPk_E1" column="DS_CUST_SPCL_MSG_PK" javaType="EZDSBigDecimalItem" />
    <result property="lineBizTpCd_P2"     column="LINE_BIZ_TP_CD"      javaType="EZDSStringItem" />
    <result property="dsBizAreaCd_P1"     column="DS_BIZ_AREA_CD"      javaType="EZDSStringItem" />
    <result property="dsCustMsgTpCd_P1"   column="DS_CUST_MSG_TP_CD"   javaType="EZDSStringItem" />
    <result property="dsCustMsgTxt_E1"    column="DS_CUST_MSG_TXT"     javaType="EZDSStringItem" />
    <result property="dsPrintOnInvFlg_E1" column="DS_PRINT_ON_INV_FLG" javaType="EZDSStringItem" />
    <result property="effThruDt_E1"       column="EFF_THRU_DT"         javaType="EZDSStringItem" />
    <result property="ezUpTime_E1"        column="EZUPTIME"            javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_E1"    column="EZUPTIMEZONE"        javaType="EZDSStringItem" />
    <!-- Add Start 2016/11/16 M.Ohno S21_NA#2680 -->
    <result property="xxRecHistCratTs_E1"     column="XX_REC_HIST_CRAT_TS"    javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm_E1"   column="XX_REC_HIST_CRAT_BY_NM" javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs_E1"      column="XX_REC_HIST_UPD_TS"     javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm_E1"    column="XX_REC_HIST_UPD_BY_NM"  javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm_E1"      column="XX_REC_HIST_TBL_NM"     javaType="EZDSStringItem" />
    <!-- Add End   2016/11/16 M.Ohno S21_NA#2680 -->
  </resultMap>
  
   <statement id="getCertReqList" parameterClass="Map" resultMap="result.getCertReqList">
    SELECT
        *
    FROM
        (
        SELECT
              SAP.SVC_ACCS_PMIT_NUM
            , SAP.EFF_FROM_DT
            , SAP.EFF_TO_DT
            , SAP.SVC_ACCS_PMIT_PK
            , SAP.EZUPTIME
            , SAP.EZUPTIMEZONE
            , VAL.SVC_ACCS_PMIT_DESC_TXT
            <!-- Add Start 2016/11/16 M.Ohno S21_NA#2680 -->
            , SAP.EZINTIME          AS XX_REC_HIST_CRAT_TS
            , SAP.EZINUSERID        AS XX_REC_HIST_CRAT_BY_NM
            , SAP.EZUPTIME          AS XX_REC_HIST_UPD_TS
            , SAP.EZUPUSERID        AS XX_REC_HIST_UPD_BY_NM
            , 'SVC_ACCS_PMIT'       AS XX_REC_HIST_TBL_NM
            <!-- Add End   2016/11/16 M.Ohno S21_NA#2680 -->
        FROM
              SVC_ACCS_PMIT SAP
            , SVC_ACCS_PMIT_VAL VAL
        WHERE
                SAP.GLBL_CMPY_CD         = #glblCmpyCd#
            AND SAP.SVC_PMIT_LVL_TP_CD   = #lvlTpCd#
            AND SAP.SVC_PMIT_LVL_VAL_TXT = #locNum#
            AND SAP.EZCANCELFLAG         = '0'
            
            AND SAP.GLBL_CMPY_CD      = VAL.GLBL_CMPY_CD (+)
            AND SAP.SVC_ACCS_PMIT_NUM = VAL.SVC_ACCS_PMIT_NUM (+)
            AND VAL.EZCANCELFLAG (+)  = '0' 
        )
    WHERE
        ROWNUM &lt;= #rowNum#
  </statement>
  <resultMap id="result.getCertReqList" class="NMAL6720_FSMsg">
    <result property="svcAccsPmitNum_F1"     column="SVC_ACCS_PMIT_NUM"      javaType="EZDSStringItem" />
    <result property="effFromDt_F1"          column="EFF_FROM_DT"            javaType="EZDSStringItem" />
    <result property="effToDt_F1"            column="EFF_TO_DT"              javaType="EZDSStringItem" />
    <result property="svcAccsPmitPk_F1"      column="SVC_ACCS_PMIT_PK"       javaType="EZDSStringItem" />
    <result property="ezUpTime_F1"           column="EZUPTIME"               javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_F1"       column="EZUPTIMEZONE"           javaType="EZDSStringItem" />
    <result property="svcAccsPmitDescTxt_F1" column="SVC_ACCS_PMIT_DESC_TXT" javaType="EZDSStringItem" />
    <!-- Add Start 2016/11/16 M.Ohno S21_NA#2680 -->
    <result property="xxRecHistCratTs_F1"     column="XX_REC_HIST_CRAT_TS"    javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm_F1"   column="XX_REC_HIST_CRAT_BY_NM" javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs_F1"      column="XX_REC_HIST_UPD_TS"     javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm_F1"    column="XX_REC_HIST_UPD_BY_NM"  javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm_F1"      column="XX_REC_HIST_TBL_NM"     javaType="EZDSStringItem" />
    <!-- Add End   2016/11/16 M.Ohno S21_NA#2680 -->
  </resultMap>

  <statement id="getDoNotSentTechList" parameterClass="Map" resultMap="result.getDoNotSentTechList">
    SELECT
        *
    FROM
        (
        SELECT
              NPT.NON_PRF_TECH_CD
            , NPT.EFF_THRU_DT
            , NPT.DS_CUST_NON_PRF_TECH_PK
            , NPT.EZUPUSERID
            , NPT.EZUPTIME
            , NPT.EZUPTIMEZONE
            , TM.TECH_NM
            , TO_CHAR(TO_TIMESTAMP(NPT.EZUPTIME, 'yyyymmddhh24missff3'), 'mm/dd/yyyy hh24:mi') AS EZUPTIME2
            <!-- Add Start 2016/11/16 M.Ohno S21_NA#2680 -->
            , NPT.EZINTIME                 AS XX_REC_HIST_CRAT_TS
            , NPT.EZINUSERID               AS XX_REC_HIST_CRAT_BY_NM
            , NPT.EZUPTIME                 AS XX_REC_HIST_UPD_TS
            , NPT.EZUPUSERID               AS XX_REC_HIST_UPD_BY_NM
            , 'DS_CUST_NON_PRF_TECH'       AS XX_REC_HIST_TBL_NM
            <!-- Add End   2016/11/16 M.Ohno S21_NA#2680 -->
        FROM
              DS_CUST_NON_PRF_TECH NPT
            , TECH_MSTR TM
        WHERE
                NPT.GLBL_CMPY_CD = #glblCmpyCd#
            AND NPT.LOC_NUM      = #locNum#
            AND NPT.EZCANCELFLAG = '0' 
            AND NPT.GLBL_CMPY_CD    = TM.GLBL_CMPY_CD
            AND NPT.NON_PRF_TECH_CD = TM.TECH_TOC_CD
            AND TM.EZCANCELFLAG     = '0' 
        )
    WHERE
        ROWNUM &lt;= #rowNum#
  </statement>
  <resultMap id="result.getDoNotSentTechList" class="NMAL6720_GSMsg">
    <result property="nonPrfTechCd_G1"       column="NON_PRF_TECH_CD"         javaType="EZDSStringItem" />
    <result property="effThruDt_G1"          column="EFF_THRU_DT"             javaType="EZDSStringItem" />
    <result property="dsCustNonPrfTechPk_G1" column="DS_CUST_NON_PRF_TECH_PK" javaType="EZDSStringItem" />
    <result property="ezUpUserID_G1"         column="EZUPUSERID"              javaType="EZDSStringItem" />
    <result property="ezUpTime_G1"           column="EZUPTIME"                javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_G1"       column="EZUPTIMEZONE"            javaType="EZDSStringItem" />
    <result property="techNm_G1"             column="TECH_NM"                 javaType="EZDSStringItem" />
    <result property="ezUpTime_G2"           column="EZUPTIME2"               javaType="EZDSStringItem" />
    <!-- Add Start 2016/11/16 M.Ohno S21_NA#2680 -->
    <result property="xxRecHistCratTs_G1"     column="XX_REC_HIST_CRAT_TS"    javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm_G1"   column="XX_REC_HIST_CRAT_BY_NM" javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs_G1"      column="XX_REC_HIST_UPD_TS"     javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm_G1"    column="XX_REC_HIST_UPD_BY_NM"  javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm_G1"      column="XX_REC_HIST_TBL_NM"     javaType="EZDSStringItem" />
    <!-- Add End   2016/11/16 M.Ohno S21_NA#2680 -->
  </resultMap>

  <statement id="getFirstLocInfo" parameterClass="Map" resultClass="Map">
    <isEqual property="dsAcctTpCd" compareValue="10">
        SELECT
            PRIN.PTY_LOC_PK
        FROM 
            SELL_TO_CUST ACCT
            , PRIN_CUST PRIN
        WHERE 
            ACCT.GLBL_CMPY_CD = #glblCmpyCd#
        AND ACCT.SELL_TO_CUST_CD  = #dsAcctNum#
        AND ACCT.EZCANCELFLAG = '0'
        AND ACCT.GLBL_CMPY_CD = PRIN.GLBL_CMPY_CD
        AND ACCT.PTY_LOC_PK = PRIN.PTY_LOC_PK
        AND PRIN.EZCANCELFLAG = '0' 
        AND PRIN.LOC_NUM IS NULL
        AND NOT EXISTS (
           SELECT 1 
               FROM ACCT_LOC AL 
           WHERE AL.EZCANCELFLAG = '0' 
           AND AL.GLBL_CMPY_CD = ACCT. GLBL_CMPY_CD
           AND AL.DS_ACCT_NUM = ACCT.SELL_TO_CUST_CD 
        )
    </isEqual>
    <isNotEqual property="dsAcctTpCd" compareValue="10">
        SELECT
            ACCT.PTY_LOC_PK
        FROM 
           DS_ACCT_PROS ACCT
        WHERE 
            ACCT.GLBL_CMPY_CD = #glblCmpyCd#
        AND ACCT.DS_ACCT_NUM  = #dsAcctNum#
        AND ACCT.EZCANCELFLAG = '0'
    </isNotEqual>
  </statement>
  <statement id="getPrimaryLoc" parameterClass="Map" resultClass="Map">
    SELECT
        PC.PRIN_CUST_PK
    FROM
          ACCT_LOC  AC
        , PRIN_CUST PC
    WHERE
            AC.GLBL_CMPY_CD = #glblCmpyCd#
        AND AC.EZCANCELFLAG = '0'
        AND AC.DS_ACCT_NUM  = #dsAcctNum#

        <!-- START 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
        <isNotNull property="locNum">
        <!-- END 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
        AND AC.LOC_NUM     != #locNum#
        <!-- START 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
        </isNotNull>
        <!-- END 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->

        AND AC.GLBL_CMPY_CD = PC.GLBL_CMPY_CD
        AND PC.EZCANCELFLAG = '0'
        AND AC.LOC_NUM      = PC.LOC_NUM
  </statement>

  <statement id="getPrinCust" parameterClass="Map" resultClass="Map">
    SELECT
         PRIN.PRIN_CUST_PK AS PRIN_CUST_PK
        ,PRIN.EZUPTIME AS EZUPTIME 
        ,PRIN.EZUPTIMEZONE AS EZUPTIMEZONE
    FROM
        SELL_TO_CUST ACCT
      , PRIN_CUST PRIN
    WHERE
        ACCT.GLBL_CMPY_CD    = #glblCmpyCd#
    AND ACCT.SELL_TO_CUST_CD = #dsAcctNum#
    AND ACCT.EZCANCELFLAG    = '0' 

    AND ACCT.GLBL_CMPY_CD    = PRIN.GLBL_CMPY_CD
    AND ACCT.CMPY_PK         = PRIN.CMPY_PK
    AND PRIN.EZCANCELFLAG    = '0'
  </statement>

  <statement id="getPrimaryBillTo" parameterClass="Map" resultClass="Map">
    SELECT
        B.BILL_TO_CUST_PK
    FROM
         BILL_TO_CUST    B
    WHERE
            B.GLBL_CMPY_CD    = #glblCmpyCd#
        AND B.EZCANCELFLAG    = '0'
        AND B.SELL_TO_CUST_CD = #dsAcctNum#
        AND B.PRIM_USG_FLG    = 'Y'
        <isNotNull property="billToCustCd">
        AND B.BILL_TO_CUST_CD != #billToCustCd#
        </isNotNull>
  </statement>
  
  <statement id="getPrimaryShipTo" parameterClass="Map" resultClass="Map">

    SELECT
        S.SHIP_TO_CUST_PK
      
    FROM
          SHIP_TO_CUST    S
    WHERE
            S.GLBL_CMPY_CD     = #glblCmpyCd#
        AND S.EZCANCELFLAG     = '0'
        AND S.SELL_TO_CUST_CD  = #dsAcctNum#
        <isNotNull property="shipToCustCd">
        AND S.SHIP_TO_CUST_CD != #shipToCustCd#
        </isNotNull>
        AND S.PRIM_USG_FLG     = 'Y'
  </statement>

  <statement id="getStateList" parameterClass="Map" resultMap="result.STTMsg">
    SELECT 
          ST_CD
        , ST_NM FROM  ST
    WHERE 
          ST.GLBL_CMPY_CD = #glblCmpyCd#
      AND ST.EZCANCELFLAG = '0'
    <isNotNull property="ctryCd">
      AND ST.CTRY_CD = #ctryCd#
    </isNotNull>
  </statement>
  <resultMap id="result.STTMsg" class="STTMsg">
      <result property="stCd" column="ST_CD" javaType="EZDTStringItem"/>
      <result property="stNm" column="ST_NM" javaType="EZDTStringItem"/>
  </resultMap>
  <statement id="getDefaultRemId" parameterClass="Map" resultClass="Map">
    SELECT * FROM (
    SELECT
        SRR.REM_ID
    FROM
        ST_REM_RELN SRR
    WHERE 
        SRR.GLBL_CMPY_CD = #glblCmpyCd#
    AND SRR.EZCANCELFLAG = '0'
    AND SRR.ST_CD = #stCd#
    ORDER BY SRR.REM_ID)
    WHERE ROWNUM = 1
  </statement>
  <!-- QC#6918 -->
  <statement id="getDefaultRemIdNoState" parameterClass="Map" resultClass="Map">
    SELECT * FROM (
    SELECT
        SRR.REM_ID
    FROM
        ST_REM_RELN SRR
    WHERE 
        SRR.GLBL_CMPY_CD = #glblCmpyCd#
    AND SRR.EZCANCELFLAG = '0'
    AND (SRR.ST_CD = '*' OR SRR.ST_CD IS NULL) 
    ORDER BY SRR.REM_ID)
    WHERE ROWNUM = 1
  </statement>
  <statement id="getAcct" parameterClass="Map" resultClass="Map">
    SELECT
          ACCT.DS_ACCT_NM            AS DS_ACCT_NM
        , ACCT.DS_ACCT_NUM           AS DS_ACCT_NUM
        , ACCT.DS_ACCT_TP_CD         AS DS_ACCT_TP_CD
        , ACCT.CMPY_PK               AS CMPY_PK
    FROM
        ( 
          <isEqual property="dsAcctTpCd" compareValue="10">
            SELECT
                   DAC.DS_ACCT_NM   
                  ,DAC.SELL_TO_CUST_CD  AS DS_ACCT_NUM
                  ,DAC.DS_ACCT_TP_CD
                  ,DAC.CMPY_PK      
            FROM
                SELL_TO_CUST DAC 
            WHERE
                DAC.GLBL_CMPY_CD     = #glblCmpyCd#
                AND DAC.EZCANCELFLAG = '0' 
                AND DAC.SELL_TO_CUST_CD  = #dsAcctNum#
          </isEqual>
          <isNotEqual property="dsAcctTpCd" compareValue="10">
            SELECT
                   DAP.DS_ACCT_NM   
                  ,DAP.DS_ACCT_NUM  
                  ,DAP.DS_ACCT_TP_CD
                  ,DAP.CMPY_PK      
            FROM
                DS_ACCT_PROS DAP 
            WHERE
                DAP.GLBL_CMPY_CD     = #glblCmpyCd# 
                AND DAP.EZCANCELFLAG = '0' 
                AND DAP.DS_ACCT_NUM  = #dsAcctNum#
          </isNotEqual>
        ) ACCT
    WHERE 
        ROWNUM = 1
  </statement>
  
  <!-- QC#4505 -->
  <!-- QC#11875 Mod Start -->
  <!-- QC#27169 Mod Start -->
  <statement id="getAddrByPost" parameterClass="Map" resultClass="Map">
    SELECT 
           DISTINCT
           P.CTY_ADDR
         , P.ST_CD
         , P.POST_CD
         , C.CNTY_NM
      FROM 
           POST P
         , CNTY_POST_RELN R
         , CNTY C
     WHERE 
           P.EZCANCELFLAG = '0'
       AND P.GLBL_CMPY_CD = #glblCmpyCd#
	   AND P.POST_CD = #postCd#
       <isNotNull property="ctyAddr">
       AND P.CTY_ADDR = #ctyAddr#
       </isNotNull>
       <isNotNull property="stCd">
       AND P.ST_CD = #stCd#
       </isNotNull>
	   AND R.EZCANCELFLAG(+) = '0'
	   AND R.GLBL_CMPY_CD(+) = P.GLBL_CMPY_CD
	   AND R.POST_PK(+) = P.POST_PK
	   AND C.EZCANCELFLAG = '0'
	   AND C.GLBL_CMPY_CD = R.GLBL_CMPY_CD
       <isNotNull property="cntyNm">
       AND C.CNTY_NM = #cntyNm#
       </isNotNull>
	   AND C.CNTY_PK = R.CNTY_PK 
     ORDER BY
           P.CTY_ADDR
         , P.ST_CD
         , P.POST_CD
         , C.CNTY_NM
  </statement>
  <!-- QC#27169 Mod End -->
  <!-- QC#11875 Mod End -->

  <statement id="getDuplicateRefAndType" parameterClass="Map" resultClass="Map">
    SELECT
        DXA.DS_XREF_ACCT_PK
    FROM
        DS_XREF_ACCT     DXA
       ,DS_XREF_ACCT_TP  DXAT
       ,(
        SELECT PLW.GLBL_CMPY_CD, PLW.LOC_NUM FROM PTY_LOC_WRK PLW WHERE PLW.GLBL_CMPY_CD = #glblCmpyCd# AND PLW.RGTN_STS_CD = #readyForOrderTaking# AND PLW.EZCANCELFLAG = '0'
        UNION ALL
        SELECT PPLW.GLBL_CMPY_CD, PPLW.LOC_NUM FROM PROS_PTY_LOC_WRK PPLW WHERE PPLW.GLBL_CMPY_CD = #glblCmpyCd# AND PPLW.RGTN_STS_CD = #readyForOrderTaking# AND PPLW.EZCANCELFLAG = '0'
        ) PLW
    WHERE
        DXA.GLBL_CMPY_CD           = #glblCmpyCd#
        AND DXA.DS_XREF_ACCT_TP_CD = #acctTpCd#
        AND DXA.DS_XREF_ACCT_CD    = #acctCd#
        AND DXA.LOC_NUM           &lt;&gt; #locNum#
        AND DXA.EZCANCELFLAG       = '0'
        AND DXA.GLBL_CMPY_CD       = DXAT.GLBL_CMPY_CD
        AND DXA.DS_XREF_ACCT_TP_CD = DXAT.DS_XREF_ACCT_TP_CD
        AND DXAT.DUP_CHK_FLG       = 'Y'
        AND DXAT.EZCANCELFLAG      = '0'
        AND DXA.GLBL_CMPY_CD       = PLW.GLBL_CMPY_CD
        AND DXA.LOC_NUM            = PLW.LOC_NUM
  </statement>

  <!-- QC#12060 -->
  <statement id="getLocationWithoutBillToShipTo" parameterClass="Map" resultClass="Map">
    SELECT AL.LOC_NUM
      FROM ACCT_LOC AL
     WHERE AL.EZCANCELFLAG = '0'
       AND AL.GLBL_CMPY_CD = #glblCmpyCd#
       AND AL.DS_ACCT_NUM = #dsAcctNum#
       AND NOT EXISTS (
             SELECT 1
               FROM BILL_TO_CUST BTC
              WHERE BTC.EZCANCELFLAG = '0'
                AND BTC.GLBL_CMPY_CD = AL.GLBL_CMPY_CD
                AND BTC.LOC_NUM = AL.LOC_NUM
           )
       AND NOT EXISTS (
             SELECT 1
               FROM SHIP_TO_CUST STC
              WHERE STC.EZCANCELFLAG = '0'
                AND STC.GLBL_CMPY_CD = AL.GLBL_CMPY_CD
                AND STC.LOC_NUM = AL.LOC_NUM
           )
  </statement>

  <!-- QC#14720 -->
  <statement id="checkActiveAcct" parameterClass="Map" resultClass="Integer">
    SELECT 
        COUNT(ACCT.SELL_TO_CUST_CD) CNT
    FROM
        SELL_TO_CUST ACCT
    WHERE
        ACCT.GLBL_CMPY_CD           = #glblCmpyCd#
    AND ACCT.SELL_TO_CUST_CD        = #dsAcctNum#
    AND ACCT.DS_ACCT_ACTV_CUST_FLG  = 'Y'
    AND ACCT.EZCANCELFLAG           = '0'
  </statement>

  <statement id="getShipToCustCd" parameterClass="Map" resultClass="Map">
    SELECT
    <!-- QC#28841 Mod Start -->
        SHIP.SHIP_TO_CUST_CD AS SHIP_TO_CUST_CD
     ,  SHIP.LOC_NM          AS LOC_NM
     ,  SHIP.FIRST_LINE_ADDR AS FIRST_LINE_ADDR
     ,  SHIP.SCD_LINE_ADDR   AS SCD_LINE_ADDR
     ,  SHIP.THIRD_LINE_ADDR AS THIRD_LINE_ADDR
     ,  SHIP.FRTH_LINE_ADDR  AS FRTH_LINE_ADDR
     ,  SHIP.CTY_ADDR        AS CTY_ADDR
     ,  SHIP.CNTY_PK         AS CNTY_PK
     ,  SHIP.PROV_NM         AS PROV_NM
     ,  SHIP.ST_CD           AS ST_CD
     ,  SHIP.POST_CD         AS POST_CD
     ,  SHIP.CTRY_CD         AS CTRY_CD
     ,  PLW.LOC_NUM          AS LOC_NUM_PL
     ,  PLW.PTY_LOC_PK       AS PTY_LOC_PK
    <!-- QC#28841 Mod End -->
    <!-- QC#55673 Add Start -->
     ,  SHIP.ADDL_LOC_NM     AS ADDL_LOC_NM
    <!-- QC#55673 Add End -->
    FROM
        SHIP_TO_CUST SHIP
    <!-- QC#28841 Add Start -->
       ,PTY_LOC_WRK  PLW
    <!-- QC#28841 Add End -->
    WHERE
        SHIP.GLBL_CMPY_CD    = #glblCmpyCd#
    AND SHIP.EZCANCELFLAG    = '0'
    AND SHIP.LOC_NUM         = #locNum#
    AND
      ( SHIP.LOC_ROLE_TP_CD  = #locRoleTp_WareHouse#
     OR SHIP.LOC_ROLE_TP_CD  = #locRoleTp_Technician#
      )
    <!-- QC#28841 Add Start -->
    AND SHIP.GLBL_CMPY_CD    = PLW.GLBL_CMPY_CD (+)
    AND SHIP.PTY_LOC_PK      = PLW.PTY_LOC_PK (+)
    AND PLW.EZCANCELFLAG (+) = '0'
    <!-- QC#28841 Add End -->
  </statement>

  <statement id="getWareHouse" parameterClass="Map" resultClass="Map">
    (    SELECT
            'WH_CD' AS WH
         ,  SWH.RTL_WH_CD
         ,  STC.SHIP_TO_CUST_CD
         ,  STC.PTY_LOC_PK
    <!-- QC#28841 Add Start -->
         ,  SWH.EFF_FROM_DT
         ,  SWH.EFF_THRU_DT
    <!-- QC#28841 Add End -->
        FROM
            RTL_SWH SWH
         ,  SHIP_TO_CUST STC
        WHERE
            SWH.GLBL_CMPY_CD = #glblCmpyCd#
        AND SWH.EZCANCELFLAG = '0'

        AND ( SWH.RTL_WH_CD  = #shipToCustCd#
           OR SWH.RTL_WH_CD IN
                  ( SELECT
                        RTL_WH_CD
                    FROM
                        RTL_SWH SWH2
                    WHERE
                        SWH2.GLBL_CMPY_CD = #glblCmpyCd#
                    AND SWH2.INVTY_LOC_CD = #shipToCustCd#
                    AND SWH2.EZCANCELFLAG = '0'
                  )
            )

        AND SWH.GLBL_CMPY_CD = STC.GLBL_CMPY_CD
        AND STC.EZCANCELFLAG = '0'
        AND SWH.RTL_WH_CD    = STC.SHIP_TO_CUST_CD
    UNION
        SELECT
            'SWH_CD' AS WH
         ,  SWH.INVTY_LOC_CD
         ,  STC.SHIP_TO_CUST_CD
         ,  STC.PTY_LOC_PK
    <!-- QC#28841 Add Start -->
         ,  SWH.EFF_FROM_DT
         ,  SWH.EFF_THRU_DT
    <!-- QC#28841 Add End -->
        FROM
            RTL_SWH SWH
         ,  SHIP_TO_CUST STC
        WHERE
            SWH.GLBL_CMPY_CD = #glblCmpyCd#
        AND SWH.EZCANCELFLAG = '0'

        AND ( SWH.RTL_WH_CD  = #shipToCustCd#
           OR SWH.RTL_WH_CD IN
                  ( SELECT
                        RTL_WH_CD
                    FROM
                        RTL_SWH SWH2
                    WHERE
                        SWH2.GLBL_CMPY_CD = #glblCmpyCd#
                    AND SWH2.INVTY_LOC_CD = #shipToCustCd#
                    AND SWH2.EZCANCELFLAG = '0'
                  )
            )

        AND SWH.GLBL_CMPY_CD = STC.GLBL_CMPY_CD
        AND STC.EZCANCELFLAG = '0'
        AND SWH.INVTY_LOC_CD = STC.SHIP_TO_CUST_CD
    )
  </statement>

  <statement id="cpoOpenOrder" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(C.CPO_ORD_NUM)
        FROM
            CPO           C
           ,DS_CPO_CONFIG DCC
           ,CPO_DTL       CD
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
           ,SELL_TO_CUST  ACCT
           ,ACCT_LOC      AL
           ,PTY_LOC_WRK   PLW
           <isNotNull property="billToCd">
           ,BILL_TO_CUST  BTC
           </isNotNull>
           <isNotNull property="shipToCd">
           ,SHIP_TO_CUST  STC
           </isNotNull>
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
        WHERE
            C.GLBL_CMPY_CD    = #glblCmpyCd#
        AND C.EZCANCELFLAG    = '0'
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->
        <!-- AND ( -->
        <!--     C.CPO_ORD_TS      IS NULL -->
        <!--     OR C.CPO_ORD_TS   >= #salesDate# -->
        <!--     ) -->
        AND C.CPO_ORD_TS      &gt;= #slsDtPast#
        AND C.OPEN_FLG        =  #flgOnY#
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->

        AND C.GLBL_CMPY_CD    =  DCC.GLBL_CMPY_CD
        AND DCC.EZCANCELFLAG  =  '0'
        AND C.CPO_ORD_NUM     =  DCC.CPO_ORD_NUM

        AND DCC.GLBL_CMPY_CD  =  CD.GLBL_CMPY_CD
        AND CD.EZCANCELFLAG   =  '0'
        AND DCC.CPO_ORD_NUM   =  CD.CPO_ORD_NUM
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
        AND DCC.DS_CPO_CONFIG_PK  =  CD.DS_CPO_CONFIG_PK
        AND CD.OPEN_FLG           =  #flgOnY#
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->

        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->
        <!-- AND ( -->
        <!--        DCC.BILL_TO_CUST_LOC_CD  = #locNum# -->
        <!--     OR DCC.SHIP_TO_CUST_LOC_CD  = #locNum# -->
        <!--     ) -->
        AND (
        <isNotNull property="billToCd">
                (       C.SELL_TO_CUST_CD        = #dsAcctNum#
                    AND C.SOLD_TO_CUST_LOC_CD    = #billToCd#)
                    OR
                (
                        DCC.BILL_TO_CUST_ACCT_CD = #dsAcctNum#
                    AND DCC.BILL_TO_CUST_LOC_CD  = #billToCd#)
        </isNotNull>
        <isNotNull property="shipToCd">
            <isNotNull property="billToCd">
                    OR
            </isNotNull>
                (
                        DCC.SHIP_TO_CUST_ACCT_CD = #dsAcctNum#
                    AND DCC.SHIP_TO_CUST_LOC_CD  = #shipToCd#)
        </isNotNull>
            )

        AND C.GLBL_CMPY_CD        =  ACCT.GLBL_CMPY_CD
        AND ACCT.RGTN_STS_CD      =  #rgtnStsCd#
        AND ACCT.EZCANCELFLAG     =  '0'
        AND ACCT.SELL_TO_CUST_CD  =  #dsAcctNum#

        AND ACCT.GLBL_CMPY_CD     =  AL.GLBL_CMPY_CD
        AND ACCT.SELL_TO_CUST_CD  =  AL.DS_ACCT_NUM
        AND AL.RGTN_STS_CD        =  #rgtnStsCd#
        AND AL.EZCANCELFLAG       =  '0' 
        AND AL.LOC_NUM            =  #locNum#

        AND AL.GLBL_CMPY_CD       =  PLW.GLBL_CMPY_CD
        AND AL.LOC_NUM            =  PLW.LOC_NUM
        AND PLW.RGTN_STS_CD       =  #rgtnStsCd#
        AND PLW.EZCANCELFLAG      =  '0'

        <isNotNull property="billToCd">
        AND PLW.GLBL_CMPY_CD      =  BTC.GLBL_CMPY_CD
        AND PLW.LOC_NUM           =  BTC.LOC_NUM
        AND BTC.RGTN_STS_CD       =  #rgtnStsCd#
        AND BTC.EZCANCELFLAG      =  '0'
        AND BTC.BILL_TO_CUST_CD   =  #billToCd#
        </isNotNull>

        <isNotNull property="shipToCd">
        AND PLW.GLBL_CMPY_CD      =  STC.GLBL_CMPY_CD
        AND PLW.LOC_NUM           =  STC.LOC_NUM
        AND STC.RGTN_STS_CD       =  #rgtnStsCd#
        AND STC.EZCANCELFLAG      =  '0'
        AND STC.SHIP_TO_CUST_CD   =  #shipToCd#
        </isNotNull>
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->

        AND ROWNUM = #rowNum#
    </statement>
 
    <statement id="openReturnOrder" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(C.CPO_ORD_NUM)
        FROM
            CPO                C
          , DS_CPO_CONFIG      DCC
          , DS_CPO_RTRN_DTL    DCRD
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
          , SELL_TO_CUST       ACCT
          , ACCT_LOC           AL
          , PTY_LOC_WRK        PLW
          <isNotNull property="billToCd">
          , BILL_TO_CUST       BTC
          </isNotNull>
          <isNotNull property="shipToCd">
          , SHIP_TO_CUST       STC
          </isNotNull>
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
        WHERE
            C.GLBL_CMPY_CD    =  #glblCmpyCd#
        AND C.EZCANCELFLAG    =  '0'
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->
        <!-- AND -->
        <!--     ( -->
        <!--     C.CPO_ORD_TS      IS NULL -->
        <!--     OR  C.CPO_ORD_TS  >= #salesDate# -->
        <!--     ) -->
        AND C.CPO_ORD_TS      &gt;= #slsDtPast#
        AND C.OPEN_FLG        =  #flgOnY#
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->

        AND C.GLBL_CMPY_CD    =  DCC.GLBL_CMPY_CD
        AND DCC.EZCANCELFLAG  =  '0'
        AND C.CPO_ORD_NUM     =  DCC.CPO_ORD_NUM

        AND DCC.GLBL_CMPY_CD  =  DCRD.GLBL_CMPY_CD
        AND DCRD.EZCANCELFLAG =  '0'
        AND DCC.CPO_ORD_NUM   =  DCRD.CPO_ORD_NUM
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
        AND DCC.DS_CPO_CONFIG_PK  =  DCRD.DS_CPO_CONFIG_PK
        AND DCRD.OPEN_FLG         =  #flgOnY#
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->
        <!-- AND -->
        <!--     ( -->
        <!--        DCC.BILL_TO_CUST_LOC_CD =  #locNum# -->
        <!--     OR DCC.SHIP_TO_CUST_LOC_CD =  #locNum# -->
        <!--     ) -->
        AND (
        <isNotNull property="billToCd">
                (       C.SELL_TO_CUST_CD        = #dsAcctNum#
                    AND C.SOLD_TO_CUST_LOC_CD    = #billToCd#)
                    OR
                (
                        DCC.BILL_TO_CUST_ACCT_CD = #dsAcctNum#
                    AND DCC.BILL_TO_CUST_LOC_CD  = #billToCd#)
        </isNotNull>
        <isNotNull property="shipToCd">
            <isNotNull property="billToCd">
                    OR
            </isNotNull>
                (
                        DCC.SHIP_TO_CUST_ACCT_CD = #dsAcctNum#
                    AND DCC.SHIP_TO_CUST_LOC_CD  = #shipToCd#)
        </isNotNull>
            )

        AND C.GLBL_CMPY_CD        =  ACCT.GLBL_CMPY_CD
        AND ACCT.RGTN_STS_CD      =  #rgtnStsCd#
        AND ACCT.EZCANCELFLAG     =  '0'
        AND ACCT.SELL_TO_CUST_CD  =  #dsAcctNum#

        AND ACCT.GLBL_CMPY_CD     =  AL.GLBL_CMPY_CD
        AND ACCT.SELL_TO_CUST_CD  =  AL.DS_ACCT_NUM
        AND AL.RGTN_STS_CD        =  #rgtnStsCd#
        AND AL.EZCANCELFLAG       =  '0'
        AND AL.LOC_NUM            =  #locNum#

        AND AL.GLBL_CMPY_CD       =  PLW.GLBL_CMPY_CD
        AND AL.LOC_NUM            =  PLW.LOC_NUM
        AND PLW.RGTN_STS_CD       =  #rgtnStsCd#
        AND PLW.EZCANCELFLAG      =  '0' 

        <isNotNull property="billToCd">
        AND PLW.GLBL_CMPY_CD      =  BTC.GLBL_CMPY_CD
        AND PLW.LOC_NUM           =  BTC.LOC_NUM
        AND BTC.RGTN_STS_CD       =  #rgtnStsCd#
        AND BTC.EZCANCELFLAG      =  '0'
        AND BTC.BILL_TO_CUST_CD   =  #billToCd#
        </isNotNull>

        <isNotNull property="shipToCd">
        AND PLW.GLBL_CMPY_CD      =  STC.GLBL_CMPY_CD
        AND PLW.LOC_NUM           =  STC.LOC_NUM
        AND STC.RGTN_STS_CD       =  #rgtnStsCd#
        AND STC.EZCANCELFLAG      =  '0'
        AND STC.SHIP_TO_CUST_CD   =  #shipToCd#
        </isNotNull>
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->

        AND ROWNUM = #rowNum#
    </statement>

    <statement id="openMachineMasterCheck" parameterClass="Map" resultClass="BigDecimal">
        SELECT
           COUNT(SMM.SVC_MACH_MSTR_PK)
        FROM
           SVC_MACH_MSTR SMM
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
           ,SELL_TO_CUST ACCT
           ,ACCT_LOC     AL
           ,PTY_LOC_WRK  PLW
           <isNotNull property="billToCd">
           ,BILL_TO_CUST BTC
           </isNotNull>
           <isNotNull property="shipToCd">
           ,SHIP_TO_CUST STC
           </isNotNull>
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
        WHERE
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->
        <!--    SMM.GLBL_CMPY_CD = #glblCmpyCd# -->
            ACCT.GLBL_CMPY_CD     = #glblCmpyCd#
        AND ACCT.EZCANCELFLAG     = '0'
        AND ACCT.SELL_TO_CUST_CD  = #dsAcctNum#
        AND ACCT.RGTN_STS_CD      = #rgtnStsCd#

        AND ACCT.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
        AND (
        <isNotNull property="billToCd">
                (       SMM.OWNR_ACCT_NUM    = #dsAcctNum#
                    AND SMM.OWNR_LOC_NUM     = #billToCd#)
                    OR
                (
                        SMM.BILL_TO_ACCT_NUM = #dsAcctNum#
                    AND SMM.BILL_TO_LOC_NUM  = #billToCd#)
        </isNotNull>
        <isNotNull property="shipToCd">
            <isNotNull property="billToCd">
                    OR
            </isNotNull>
                (
                        SMM.CUR_LOC_ACCT_NUM = #dsAcctNum#
                    AND SMM.CUR_LOC_NUM      = #shipToCd#)
        </isNotNull>
            )
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->
       AND SMM.EZCANCELFLAG = '0' 
       AND SMM.SVC_MACH_MSTR_STS_CD IN (#w4i#, #instl#, #w4r#, #dlrsv#)

        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
        AND ACCT.GLBL_CMPY_CD     =  AL.GLBL_CMPY_CD
        AND ACCT.SELL_TO_CUST_CD  =  AL.DS_ACCT_NUM
        AND AL.RGTN_STS_CD        =  #rgtnStsCd#
        AND AL.EZCANCELFLAG       =  '0' 
        AND AL.LOC_NUM            =  #locNum#

        AND AL.GLBL_CMPY_CD       =  PLW.GLBL_CMPY_CD
        AND AL.LOC_NUM            =  PLW.LOC_NUM
        AND PLW.RGTN_STS_CD       =  #rgtnStsCd#
        AND PLW.EZCANCELFLAG      =  '0'

        <isNotNull property="billToCd">
        AND PLW.GLBL_CMPY_CD      =  BTC.GLBL_CMPY_CD
        AND PLW.LOC_NUM           =  BTC.LOC_NUM
        AND BTC.RGTN_STS_CD       =  #rgtnStsCd#
        AND BTC.EZCANCELFLAG      =  '0'
        AND BTC.BILL_TO_CUST_CD   =  #billToCd#
        </isNotNull>

        <isNotNull property="shipToCd">
        AND PLW.GLBL_CMPY_CD      =  STC.GLBL_CMPY_CD
        AND PLW.LOC_NUM           =  STC.LOC_NUM
        AND STC.RGTN_STS_CD       =  #rgtnStsCd#
        AND STC.EZCANCELFLAG      =  '0'
        AND STC.SHIP_TO_CUST_CD   =  #shipToCd#
        </isNotNull>
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->

       <!-- START 2018/10/09 Hd.Sugawara [QC#27598,DEL] -->
       <!-- AND -->
       <!--     ( -->
       <!--     SMM.EFF_THRU_DT IS NULL -->
       <!--     OR  SMM.EFF_THRU_DT >= #salesDate# -->
       <!--     ) -->
       <!-- AND -->
       <!--    ( -->
       <!--        SMM.OWNR_LOC_NUM    = #locNum# -->
       <!--     OR SMM.BILL_TO_LOC_NUM = #locNum# -->
       <!--     OR SMM.CUR_LOC_NUM     = #locNum# -->
       <!--    ) -->
       <!-- END 2018/10/09 Hd.Sugawara [QC#27598,DEL] -->
       AND ROWNUM = #rowNum#
    </statement>
    <!-- 2017/08/10 QC#8598 Add Start -->
    <statement id="getPrimaryContactForDuplicateCheck" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT RELN.DS_CTAC_PSN_RELN_PK AS DS_CTAC_PSN_RELN_PK
        FROM
            DS_CTAC_PSN_RELN RELN
            , CTAC_PSN PSN
        WHERE
            RELN.GLBL_CMPY_CD = #glblCmpyCd#
        AND RELN.EZCANCELFLAG = '0'
            
        AND RELN.GLBL_CMPY_CD = PSN.GLBL_CMPY_CD
        AND RELN.CTAC_PSN_PK = PSN.CTAC_PSN_PK
        AND RELN.EFF_FROM_DT &lt; #chkEffThruDt#
        AND NVL(RELN.EFF_THRU_DT, #maxEffThruDt#) &gt;= #chkEffFromDt#
        
        AND PSN.EZCANCELFLAG = '0'

        AND RELN.LOC_NUM = #locNum#
        AND PSN.CTAC_PSN_PK &lt;&gt; #ctacPsnPk#
        AND RELN.DS_PRIM_LOC_FLG = 'Y'
        AND PSN.CTAC_PSN_ACTV_FLG = 'Y'
        AND RELN.CTAC_TP_CD = #ctacTpCd#
    </statement>
    <!-- 2017/08/10 QC#8598 Add End -->

    <statement id="getDsCustShpgDefList" parameterClass="Map" resultMap="result.getDsCustShpgDefList">
        <!-- 2018/12/13 QC#29135 Add Start -->
        SELECT 
               TBL1.EZUPTIME               AS DCSD_EZUPTIME
              ,TBL1.EZUPTIMEZONE           AS DCSD_EZUPTIMEZONE
              ,TBL1.DS_CUST_SHPG_DEF_PK
              ,TBL1.LINE_BIZ_TP_CD
              ,TBL1.DS_BIZ_AREA_CD
              ,TBL1.FRT_COND_CD
              ,TBL1.SHPG_SVC_LVL_CD
              ,TBL1.EFF_FROM_DT
              ,TBL1.EFF_THRU_DT
              ,TBL1.DEF_FLG
              ,TBL1.XX_REC_HIST_CRAT_TS
              ,TBL1.XX_REC_HIST_CRAT_BY_NM
              ,TBL1.XX_REC_HIST_UPD_TS
              ,TBL1.XX_REC_HIST_UPD_BY_NM
              ,TBL1.XX_REC_HIST_TBL_NM
              ,TBL2.VND_CD
              <!-- 2023/01/13 QC#60860 Add Start -->
              ,TBL2.VND_NM
              <!-- 2023/01/13 QC#60860 Add End -->
              ,TBL2.DS_CARR_ACCT_NUM
              ,TBL2.DEF_ACCT_CARR_FLG
              ,TBL2.DS_ACCT_CARR_PK
              ,TBL2.EZUPTIME             AS DAC_EZUPTIME
              ,TBL2.EZUPTIMEZONE         AS DAC_EZUPTIMEZONE
        
        FROM (
        <!-- 2018/12/13 QC#29135 Add End -->
            SELECT
                    DCSD.EZUPTIME
                   ,DCSD.EZUPTIMEZONE
                   ,DCSD.DS_CUST_SHPG_DEF_PK
                   ,DCSD.LINE_BIZ_TP_CD
                   ,DCSD.DS_BIZ_AREA_CD
                   ,DCSD.FRT_COND_CD
                   ,DCSD.SHPG_SVC_LVL_CD
                   ,DCSD.EFF_FROM_DT
                   ,DCSD.EFF_THRU_DT
                   <!-- 2018/12/10 QC#29135 Add Start -->
                   ,DCSD.DEF_FLG
                   ,DCSD.DS_ACCT_CARR_PK
                   <!-- 2018/12/10 QC#29135 Add End -->
                   , DCSD.EZINTIME             AS XX_REC_HIST_CRAT_TS
                   , DCSD.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
                   , DCSD.EZUPTIME             AS XX_REC_HIST_UPD_TS
                   , DCSD.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
                   , 'DS_CUST_SHPG_DEF'        AS XX_REC_HIST_TBL_NM
            FROM
                    DS_CUST_SHPG_DEF DCSD
                    , LINE_BIZ_TP LBT
                    , DS_BIZ_AREA DBA
                    , FRT_COND FC
                    , SHPG_SVC_LVL SSL
            WHERE
                    DCSD.GLBL_CMPY_CD          = #glblCmpyCd#
            AND     DCSD.LOC_NUM               = #locNum#
            AND     DCSD.EZCANCELFLAG          = '0' 
    
            AND     DCSD.GLBL_CMPY_CD          = LBT.GLBL_CMPY_CD
            AND     DCSD.LINE_BIZ_TP_CD        = LBT.LINE_BIZ_TP_CD 
            AND     LBT.EZCANCELFLAG           = '0' 
    
            AND     DCSD.GLBL_CMPY_CD          = DBA.GLBL_CMPY_CD
            AND     DCSD.DS_BIZ_AREA_CD        = DBA.DS_BIZ_AREA_CD 
            AND     DBA.EZCANCELFLAG           = '0' 
    
            AND     DCSD.GLBL_CMPY_CD          = FC.GLBL_CMPY_CD (+)
            AND     DCSD.FRT_COND_CD           = FC.FRT_COND_CD (+)
            AND     FC.EZCANCELFLAG (+)        = '0' 
    
            AND     DCSD.GLBL_CMPY_CD          = SSL.GLBL_CMPY_CD (+)
            AND     DCSD.SHPG_SVC_LVL_CD       = SSL.SHPG_SVC_LVL_CD (+)
            AND     SSL.EZCANCELFLAG (+)       = '0' 
    
            ORDER BY 
                    LBT.LINE_BIZ_TP_SORT_NUM, DBA.DS_BIZ_AREA_SORT_NUM, FC.FRT_COND_SORT_NUM, DCSD.DS_CUST_SHPG_DEF_PK DESC, NVL(DCSD.EFF_THRU_DT,#maxEffThruDt#) DESC
        ) TBL1,
        <!-- 2018/12/13 QC#29135 Add Start -->
        (   SELECT
                     DAC.VND_CD              VND_CD
                   , DAC.DS_CARR_ACCT_NUM    DS_CARR_ACCT_NUM
                   , DAC.EFF_FROM_DT         EFF_FROM_DT
                   , DAC.EFF_THRU_DT         EFF_THRU_DT
                   , DAC.DEF_ACCT_CARR_FLG   DEF_ACCT_CARR_FLG
                   , DAC.DS_ACCT_CARR_PK     DS_ACCT_CARR_PK
                   , DAC.EZUPTIME            EZUPTIME
                   , DAC.EZUPTIMEZONE        EZUPTIMEZONE
                   , DAC.EZINTIME             AS XX_REC_HIST_CRAT_TS
                   , DAC.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
                   , DAC.EZUPTIME             AS XX_REC_HIST_UPD_TS
                   , DAC.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
                   , 'DS_ACCT_CARR'           AS XX_REC_HIST_TBL_NM
                   <!-- 2023/01/13 QC#60860 Add Start -->
                   , V.CARR_NM                AS VND_NM
                   <!-- 2023/01/13 QC#60860 Add End -->
            FROM
                    DS_ACCT_CARR DAC
                    <!-- 2023/01/13 QC#60860 Add Start -->
                   ,OTBD_CARR_V  V
                    <!-- 2023/01/13 QC#60860 Add End -->
            WHERE
                    DAC.GLBL_CMPY_CD           = #glblCmpyCd#
            AND     DAC.EZCANCELFLAG           = '0'
            AND     DAC.LOC_NUM                = #locNum#
            <!-- 2023/01/13 QC#60860 Add Start -->
            AND     DAC.GLBL_CMPY_CD           = V.GLBL_CMPY_CD(+)
            AND     V.EZCANCELFLAG(+)          = '0'
            AND     DAC.VND_CD                 = V.CARR_CD(+)
            <!-- 2023/01/13 QC#60860 Add End -->
        ) TBL2
        WHERE
              ROWNUM &lt;= #rowNum#
        AND   TBL1.DS_ACCT_CARR_PK = TBL2.DS_ACCT_CARR_PK
        <!-- 2018/12/13 QC#29135 Add End -->

    </statement>
   <resultMap id="result.getDsCustShpgDefList" class="NMAL6720_ISMsg">
    <result property="dsCustShpgDefPk_I1" column="DS_CUST_SHPG_DEF_PK" javaType="EZDSBigDecimalItem" />
     <!-- 2018/12/13 QC#29135 Add Start -->
    <result property="dsAcctCarrPk_I1"    column="DS_ACCT_CARR_PK"     javaType="EZDSBigDecimalItem" />
    <!-- 2018/12/13 QC#29135 Add End -->
    <result property="lineBizTpCd_P3"     column="LINE_BIZ_TP_CD"      javaType="EZDSStringItem" />
    <result property="dsBizAreaCd_P2"     column="DS_BIZ_AREA_CD"      javaType="EZDSStringItem" />
    <result property="frtCondCd_P1"       column="FRT_COND_CD"         javaType="EZDSStringItem" />
    <result property="shpgSvcLvlCd_P1"    column="SHPG_SVC_LVL_CD"     javaType="EZDSStringItem" />
    <!-- 2018/12/13 QC#29135 Add Start -->
    <result property="xxChkBox_ID"        column="DEF_FLG"             javaType="EZDSStringItem" />
    <result property="vndCd_I3"           column="VND_CD"              javaType="EZDSStringItem" />
    <!-- 2023/01/13 QC#60860 Add Start -->
    <result property="carrNm_I3"          column="VND_NM"              javaType="EZDSStringItem" />
    <!-- 2023/01/13 QC#60860 Add End   -->
    <result property="dsCarrAcctNum_I1"   column="DS_CARR_ACCT_NUM"    javaType="EZDSStringItem" />
    <result property="ezUpTime_IS"        column="DCSD_EZUPTIME"       javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_IS"    column="DCSD_EZUPTIMEZONE"   javaType="EZDSStringItem" />
    <result property="ezUpTime_IC"        column="DAC_EZUPTIME"        javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_IC"    column="DAC_EZUPTIMEZONE"    javaType="EZDSStringItem" />
    <!-- 2018/12/13 QC#29135 Add End -->
    <result property="effFromDt_I1"       column="EFF_FROM_DT"         javaType="EZDSStringItem" />
    <result property="effThruDt_I1"       column="EFF_THRU_DT"         javaType="EZDSStringItem" />
    <!-- 2018/12/13 QC#29135 Del Start -->
<!--    <result property="ezUpTime_I1"        column="EZUPTIME"            javaType="EZDSStringItem" />-->
<!--    <result property="ezUpTimeZone_I1"    column="EZUPTIMEZONE"        javaType="EZDSStringItem" />-->
    <!-- 2018/12/13 QC#29135 Del End -->
    <result property="xxRecHistCratTs_I1"     column="XX_REC_HIST_CRAT_TS"    javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm_I1"   column="XX_REC_HIST_CRAT_BY_NM" javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs_I1"      column="XX_REC_HIST_UPD_TS"     javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm_I1"    column="XX_REC_HIST_UPD_BY_NM"  javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm_I1"      column="XX_REC_HIST_TBL_NM"     javaType="EZDSStringItem" />
  </resultMap>

    <statement id="getFrtCondSvcReln" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            <isNotNull property="frtCondCd">
            R.SHPG_SVC_LVL_CD
            ,SSL.SHPG_SVC_LVL_NM
            ,SSL.SHPG_SVC_LVL_SORT_NUM
            </isNotNull>
            <isNull property="frtCondCd">
            R.FRT_COND_CD
            ,FC.FRT_COND_NM
            ,FC.FRT_COND_SORT_NUM
            </isNull>
        FROM
            FRT_COND_SVC_LVL_RELN R
            <isNotNull property="frtCondCd">
            ,SHPG_SVC_LVL SSL
            </isNotNull>
            <isNull property="frtCondCd">
            ,FRT_COND FC
            </isNull>
        WHERE
                R.GLBL_CMPY_CD = #glblCmpyCd#
            AND R.LINE_BIZ_TP_CD = #lineBizTpCd#
            AND R.EZCANCELFLAG = '0'
            <isNotNull property="frtCondCd">
            AND R.FRT_COND_CD = #frtCondCd#

            AND R.GLBL_CMPY_CD = SSL.GLBL_CMPY_CD
            AND R.SHPG_SVC_LVL_CD = SSL.SHPG_SVC_LVL_CD
            AND R.EZCANCELFLAG = SSL.EZCANCELFLAG
            </isNotNull>

            <isNull property="frtCondCd">
            AND R.GLBL_CMPY_CD = FC.GLBL_CMPY_CD
            AND R.FRT_COND_CD = FC.FRT_COND_CD
            AND R.EZCANCELFLAG = FC.EZCANCELFLAG
            </isNull>
        ORDER BY
            <isNotNull property="frtCondCd">
            SSL.SHPG_SVC_LVL_SORT_NUM
            </isNotNull>
            <isNull property="frtCondCd">
            FC.FRT_COND_SORT_NUM
            </isNull>
    </statement>

    <!-- 2018/07/11 QC#26422 Add Start -->
    <statement id="getBillToCustCd" parameterClass="Map" resultClass="Integer">
        SELECT 
            COUNT(*) CNT
        FROM
            BILL_TO_CUST BILL
        WHERE
                  BILL.GLBL_CMPY_CD    = #glblCmpyCd#
            AND   BILL.EZCANCELFLAG    = '0'
            AND   BILL.RGTN_STS_CD     = #rgtnStsCd#
            AND   BILL.BILL_TO_CUST_CD = #billToCustCd#
    </statement>
    <!-- 2018/07/11 QC#26422 Add End -->

    <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
    <statement id="getCurrentAccount" parameterClass="Map" resultClass="Map">
        <isEqual property="dsAcctTpCd" compareValue="10">
            SELECT
                    ACCT.SELL_TO_CUST_CD AS DS_ACCT_NUM
            FROM
                    ACCT_LOC             AL
                  , SELL_TO_CUST         ACCT
            WHERE
                    AL.GLBL_CMPY_CD      = #glblCmpyCd#
                AND AL.EZCANCELFLAG      = '0'
                AND AL.LOC_NUM           = #locNum#
                AND AL.RGTN_STS_CD       = #rgtnStsCd#
                AND AL.GLBL_CMPY_CD      = ACCT.GLBL_CMPY_CD
                AND AL.DS_ACCT_NUM       = ACCT.SELL_TO_CUST_CD
                AND ACCT.EZCANCELFLAG    = '0'
        </isEqual>
        <isNotEqual property="dsAcctTpCd" compareValue="10">
            SELECT
                    ACCT.DS_ACCT_NUM     AS DS_ACCT_NUM
            FROM
                    PROS_PTY_LOC_WRK     PLW
                  , DS_ACCT_PROS         ACCT
            WHERE
                    PLW.GLBL_CMPY_CD     = #glblCmpyCd#
                AND PLW.EZCANCELFLAG     = '0'
                AND PLW.LOC_NUM          = #locNum#
                AND PLW.RGTN_STS_CD      = #rgtnStsCd#
                AND PLW.GLBL_CMPY_CD     = ACCT.GLBL_CMPY_CD
                AND PLW.PTY_LOC_PK       = ACCT.PTY_LOC_PK
                AND ACCT.EZCANCELFLAG    = '0'
        </isNotEqual>
    </statement>
    <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
    <!-- 2018/12/13 QC#29315 Add Start-->
    <statement id="getBankAcctPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
                V.VND_CD    VND_CD
               ,V.LOC_NM    LOC_NM
        FROM
                VND_TP_RELN VTR
               ,VND         V
        WHERE
                VTR.GLBL_CMPY_CD              = #glblCmpyCd#
        AND     VTR.VND_TP_CD                 = #outboundCarrier#
        AND     VTR.EZCANCELFLAG              = '0'
        AND     VTR.GLBL_CMPY_CD              = V.GLBL_CMPY_CD
        AND     VTR.VND_CD                    = V.VND_CD
        AND     V.EFF_FROM_DT                 &lt;= #salesDate#
        AND     NVL(V.EFF_THRU_DT, #maxDate#) &gt;= #salesDate#
        AND     V.EZCANCELFLAG                = '0'
        ORDER BY 
                V.LOC_NM
    </statement>
    <!-- 2018/12/13 QC#29315 Add End-->

    <!-- Add Start 2019/02/19 QC#30293 -->
    <statement id="getTemplateForFinancials" parameterClass="Map" resultClass="Map">
        SELECT
              DCAT.AR_STMT_FLG
            , DCAT.SEND_CR_BAL_STMT_FLG
            , DCAT.AR_STMT_ISS_DAY
            , DCAT.CLT_CUST_TP_CD
            , DCAT.CLT_PTFO_PK
            , DCAT.DS_CLT_ACCT_STS_CD
            , DCAT.LATE_FEE_FLG
            , DCAT.LATE_FEE_AMT
            <!-- START 2019/04/16 Hd.Sugawara [QC#31114,ADD] -->
            , DCAT.DS_CUST_TAX_CALC_CD
            , DCAT.DS_EXEM_EXPR_DT
            , DCAT.DS_TAX_EXEM_FLG
            , DCAT.DS_TAX_GRP_EXEM_CD
            , DCAT.DS_TAX_PRNT_TP_CD
            , DCAT.DUN_FLG
            , DCAT.REM_ID
            <!-- END 2019/04/16 Hd.Sugawara [QC#31114,ADD] -->
        FROM
              DS_CUST_AR_TMPL DCAT 
        WHERE
            DCAT.GLBL_CMPY_CD     = #glblCmpyCd#
        AND DCAT.EZCANCELFLAG     = '0'
        <!-- START 2019/04/16 Hd.Sugawara [QC#31114,ADD] -->
        AND DCAT.DS_TMPL_ACTV_FLG = 'Y'
        <!-- END 2019/04/16 Hd.Sugawara [QC#31114,ADD] -->
        AND DCAT.DS_DEF_TMPL_FLG  = 'Y'

        AND ROWNUM                = 1
    </statement>
    <!-- Add End 2019/02/19 QC#30293 -->

    <!-- START 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
    <statement id="getAcctCmpyPkByAcctNum" parameterClass="Map" resultClass="BigDecimal">
      SELECT
          CMPY_PK
      FROM
          SELL_TO_CUST
      WHERE
          GLBL_CMPY_CD    = #glblCmpyCd#
      AND EZCANCELFLAG    = '0'
      AND SELL_TO_CUST_CD = #dsAcctNum#
    </statement>
    <!-- END 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->

    <!-- START 2019/08/07 Hd.Sugawara [QC#52385,ADD] -->
    <statement id="getCustInfoForRelatedChildReln" parameterClass="Map" resultClass="Map">
    SELECT
        R_DS_ACCT_RELN_TP_CD
      , R_DS_ACCT_NUM
      , R_RELN_DS_ACCT_NUM
      , R_BILL_TO_CUST_CD
      , R_SHIP_TO_CUST_CD
      , R_DS_ACCT_RELN_BILL_TO_FLG
      , R_DS_ACCT_RELN_SHIP_TO_FLG
    FROM (
        WITH  RELN_WRK(GLBL_CMPY_CD
              ,DS_ACCT_NUM
              , RELN_DS_ACCT_NUM
              , DS_ACCT_RELN_TP_CD
              , DS_ACCT_RELN_BILL_TO_FLG
              , DS_ACCT_RELN_SHIP_TO_FLG
              , LV) 
        AS (
            SELECT RELN.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                 , RELN.DS_ACCT_NUM              AS DS_ACCT_NUM
                 , RELN.RELN_DS_ACCT_NUM         AS RELN_DS_ACCT_NUM
                 , RELN.DS_ACCT_RELN_TP_CD       AS DS_ACCT_RELN_TP_CD
                 , RELN.DS_ACCT_RELN_BILL_TO_FLG AS DS_ACCT_RELN_BILL_TO_FLG
                 , RELN.DS_ACCT_RELN_SHIP_TO_FLG AS DS_ACCT_RELN_SHIP_TO_FLG
                 , 1        AS LV
                FROM DS_ACCT_RELN RELN 
                WHERE RELN.RELN_DS_ACCT_NUM = #acctNum#
                AND RELN.GLBL_CMPY_CD = #glblCmpyCd#
                AND RELN.EZCANCELFLAG = '0'
                AND RELN.RGTN_STS_CD = #rgtnStsCd#
                AND RELN.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#

            UNION ALL
            SELECT RELN.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                 , RELN.DS_ACCT_NUM              AS DS_ACCT_NUM
                 , RELN.RELN_DS_ACCT_NUM         AS RELN_DS_ACCT_NUM
                 , RELN.DS_ACCT_RELN_TP_CD       AS DS_ACCT_RELN_TP_CD
                 , RELN.DS_ACCT_RELN_BILL_TO_FLG AS DS_ACCT_RELN_BILL_TO_FLG
                 , RELN.DS_ACCT_RELN_SHIP_TO_FLG AS DS_ACCT_RELN_SHIP_TO_FLG
                 , LV + 1        AS LV
                FROM DS_ACCT_RELN RELN, RELN_WRK
                WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
                AND RELN.EZCANCELFLAG = '0'
                AND RELN.RGTN_STS_CD = #rgtnStsCd#
                AND RELN_WRK.DS_ACCT_NUM = RELN.RELN_DS_ACCT_NUM
                AND RELN_WRK.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#

            )

            CYCLE DS_ACCT_NUM SET IsLoop TO 'Y' DEFAULT 'N'

        SELECT * FROM (
        SELECT
            RELN_WRK.DS_ACCT_RELN_TP_CD AS R_DS_ACCT_RELN_TP_CD
            , RELN_WRK.RELN_DS_ACCT_NUM AS R_DS_ACCT_NUM
            , RELN_WRK.DS_ACCT_NUM AS R_RELN_DS_ACCT_NUM
            , BILL.BILL_TO_CUST_CD AS R_BILL_TO_CUST_CD
            , SHIP.SHIP_TO_CUST_CD AS R_SHIP_TO_CUST_CD
            , '' AS R_DS_ACCT_RELN_BILL_TO_FLG
            , '' AS R_DS_ACCT_RELN_SHIP_TO_FLG
        FROM
            RELN_WRK
            , SHIP_TO_CUST SHIP
            , BILL_TO_CUST BILL
            , ACCT_LOC AL
        WHERE  ( RELN_WRK.DS_ACCT_NUM = #acctNum#
              OR (RELN_WRK.DS_ACCT_NUM &lt;&gt; #acctNum# AND RELN_WRK.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#))
        AND RELN_WRK.IsLoop = 'N'

        AND AL.DS_ACCT_NUM = RELN_WRK.DS_ACCT_NUM
        AND AL.LOC_NUM = SHIP.LOC_NUM (+)
        AND AL.LOC_NUM = BILL.LOC_NUM(+)
        AND AL.EZCANCELFLAG(+) = '0'
        AND AL.GLBL_CMPY_CD(+) = #glblCmpyCd#

        AND  RELN_WRK.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD(+)
        AND  RELN_WRK.DS_ACCT_NUM = SHIP.SELL_TO_CUST_CD(+)
        AND  SHIP.EZCANCELFLAG(+) = '0'
        AND  SHIP.RGTN_STS_CD(+) = #rgtnStsCd#

        AND  RELN_WRK.GLBL_CMPY_CD = BILL.GLBL_CMPY_CD(+)
        AND  RELN_WRK.DS_ACCT_NUM = BILL.SELL_TO_CUST_CD(+)
        AND  BILL.EZCANCELFLAG(+) = '0'
        AND  BILL.RGTN_STS_CD(+) = #rgtnStsCd#

       ORDER BY RELN_WRK.DS_ACCT_NUM
                , RELN_WRK.RELN_DS_ACCT_NUM
       )
    )
    WHERE 1 = 1
        <isNotNull property="defBillToList">
            AND (
        </isNotNull>
        <isNull property="defBillToList">
            <isNotNull property="defShipToList">
                AND (
            </isNotNull>
        </isNull>

        <isNotNull property="defBillToList">
            <iterate property="defBillToList" var="defBillTo[]" open=" R_BILL_TO_CUST_CD IN (" close=")" conjunction=",">
                #defBillTo[]#
            </iterate>
        </isNotNull>
        <isNotNull property="defShipToList">
            <isNotNull property="defBillToList">
                OR
            </isNotNull>
            <iterate property="defShipToList" var="defShipTo[]" open=" R_SHIP_TO_CUST_CD IN (" close=")" conjunction=",">
                #defShipTo[]#
            </iterate>
        </isNotNull>

        <isNotNull property="defBillToList">
            )
        </isNotNull>
        <isNull property="defBillToList">
            <isNotNull property="defShipToList">
                )
            </isNotNull>
        </isNull>
    </statement>

    <statement id="getCustInfoForRelatedCurrent" parameterClass="Map" resultClass="Map">
    SELECT
        R_DS_ACCT_RELN_TP_CD
      , R_DS_ACCT_NUM
      , R_RELN_DS_ACCT_NUM
      , R_BILL_TO_CUST_CD
      , R_SHIP_TO_CUST_CD
      , R_DS_ACCT_RELN_BILL_TO_FLG
      , R_DS_ACCT_RELN_SHIP_TO_FLG
    FROM (
        SELECT
            '' AS R_DS_ACCT_RELN_TP_CD
            , SELL.SELL_TO_CUST_CD AS R_DS_ACCT_NUM
            , '' AS R_RELN_DS_ACCT_NUM
            , BILL.BILL_TO_CUST_CD AS R_BILL_TO_CUST_CD
            , SHIP.SHIP_TO_CUST_CD AS R_SHIP_TO_CUST_CD
            , '' AS R_DS_ACCT_RELN_BILL_TO_FLG
            , '' AS R_DS_ACCT_RELN_SHIP_TO_FLG
        FROM
            SELL_TO_CUST SELL
            , SHIP_TO_CUST SHIP
            , BILL_TO_CUST BILL
            , ACCT_LOC AL
        WHERE
             SELL.GLBL_CMPY_CD = #glblCmpyCd#
        AND  SELL.EZCANCELFLAG = '0'
        AND  SELL.SELL_TO_CUST_CD = #acctNum#

        AND  AL.DS_ACCT_NUM = SELL.SELL_TO_CUST_CD
        AND  AL.LOC_NUM = SHIP.LOC_NUM (+)
        AND  AL.LOC_NUM = BILL.LOC_NUM (+)
        AND  AL.EZCANCELFLAG (+)= '0'
        AND  AL.GLBL_CMPY_CD (+)= #glblCmpyCd#

        AND  SELL.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD(+)
        AND  SELL.SELL_TO_CUST_CD = SHIP.SELL_TO_CUST_CD(+)
        AND  SHIP.EZCANCELFLAG(+) = '0'
        AND  SHIP.RGTN_STS_CD (+)= #rgtnStsCd#

        AND  SELL.GLBL_CMPY_CD = BILL.GLBL_CMPY_CD(+)
        AND  SELL.SELL_TO_CUST_CD = BILL.SELL_TO_CUST_CD(+)

        AND  BILL.EZCANCELFLAG (+)= '0'
        AND  BILL.RGTN_STS_CD (+)= #rgtnStsCd#
    )
    WHERE 1 = 1
        <isNotNull property="defBillToList">
            AND (
        </isNotNull>
        <isNull property="defBillToList">
            <isNotNull property="defShipToList">
                AND (
            </isNotNull>
        </isNull>

        <isNotNull property="defBillToList">
            <iterate property="defBillToList" var="defBillTo[]" open=" R_BILL_TO_CUST_CD IN (" close=")" conjunction=",">
                #defBillTo[]#
            </iterate>
        </isNotNull>
        <isNotNull property="defShipToList">
            <isNotNull property="defBillToList">
                OR
            </isNotNull>
            <iterate property="defShipToList" var="defShipTo[]" open=" R_SHIP_TO_CUST_CD IN (" close=")" conjunction=",">
                #defShipTo[]#
            </iterate>
        </isNotNull>

        <isNotNull property="defBillToList">
            )
        </isNotNull>
        <isNull property="defBillToList">
            <isNotNull property="defShipToList">
                )
            </isNotNull>
        </isNull>
    </statement>

    <statement id="getCustInfoForRelatedParentReln" parameterClass="Map" resultClass="Map">
    SELECT
        R_DS_ACCT_RELN_TP_CD
      , R_DS_ACCT_NUM
      , R_RELN_DS_ACCT_NUM
      , R_BILL_TO_CUST_CD
      , R_SHIP_TO_CUST_CD
      , R_DS_ACCT_RELN_BILL_TO_FLG
      , R_DS_ACCT_RELN_SHIP_TO_FLG
    FROM (
        WITH  RELN_WRK(GLBL_CMPY_CD
              ,DS_ACCT_NUM
              , RELN_DS_ACCT_NUM
              , DS_ACCT_RELN_TP_CD
              , DS_ACCT_RELN_BILL_TO_FLG
              , DS_ACCT_RELN_SHIP_TO_FLG
              , LV) 
        AS (
            SELECT RELN.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                 , RELN.DS_ACCT_NUM              AS DS_ACCT_NUM
                 , RELN.RELN_DS_ACCT_NUM         AS RELN_DS_ACCT_NUM
                 , RELN.DS_ACCT_RELN_TP_CD       AS DS_ACCT_RELN_TP_CD
                 , RELN.DS_ACCT_RELN_BILL_TO_FLG AS DS_ACCT_RELN_BILL_TO_FLG
                 , RELN.DS_ACCT_RELN_SHIP_TO_FLG AS DS_ACCT_RELN_SHIP_TO_FLG
                 , 1        AS LV
                FROM DS_ACCT_RELN RELN 
                WHERE RELN.DS_ACCT_NUM = #acctNum#
                AND RELN.GLBL_CMPY_CD = #glblCmpyCd#
                AND RELN.EZCANCELFLAG = '0'
                AND RELN.DS_ACCT_RELN_TP_CD != #dsAcctRelnTpCd_Exclusion#
                AND RELN.RGTN_STS_CD = #rgtnStsCd#

            UNION ALL
            SELECT RELN.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                 , RELN.DS_ACCT_NUM              AS DS_ACCT_NUM
                 , RELN.RELN_DS_ACCT_NUM         AS RELN_DS_ACCT_NUM
                 , RELN.DS_ACCT_RELN_TP_CD       AS DS_ACCT_RELN_TP_CD
                 , RELN.DS_ACCT_RELN_BILL_TO_FLG AS DS_ACCT_RELN_BILL_TO_FLG
                 , RELN.DS_ACCT_RELN_SHIP_TO_FLG AS DS_ACCT_RELN_SHIP_TO_FLG
                 , LV + 1        AS LV
                FROM DS_ACCT_RELN RELN, RELN_WRK
                WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
                AND RELN.EZCANCELFLAG = '0'
                AND RELN.RGTN_STS_CD = #rgtnStsCd#
                AND RELN_WRK.RELN_DS_ACCT_NUM = RELN.DS_ACCT_NUM
                AND RELN_WRK.DS_ACCT_NUM &lt;&gt; RELN.RELN_DS_ACCT_NUM 
                AND RELN_WRK.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#

            )

            CYCLE DS_ACCT_NUM SET IsLoop TO 'Y' DEFAULT 'N'
        SELECT /*+ LEADING(AL2 BILL SHIP)
                   USE_NL_WITH_INDEX(BILL BILL_TO_CUST_I4)
                   USE_NL_WITH_INDEX(SHIP SHIP_TO_CUST_I6) */
              AL2.DS_ACCT_RELN_TP_CD AS R_DS_ACCT_RELN_TP_CD
            , AL2.DS_ACCT_NUM AS R_DS_ACCT_NUM
            , AL2.RELN_DS_ACCT_NUM AS R_RELN_DS_ACCT_NUM
            , BILL.BILL_TO_CUST_CD AS R_BILL_TO_CUST_CD
            , SHIP.SHIP_TO_CUST_CD AS R_SHIP_TO_CUST_CD
            , AL2.DS_ACCT_RELN_BILL_TO_FLG AS R_DS_ACCT_RELN_BILL_TO_FLG
            , AL2.DS_ACCT_RELN_SHIP_TO_FLG AS R_DS_ACCT_RELN_SHIP_TO_FLG
        FROM (SELECT /*+ LEADING(RELN_WRK2 AL)
                         USE_NL_WITH_INDEX(AL ACCT_LOC_I2) */
                      RELN_WRK2.DS_ACCT_RELN_TP_CD
                    , RELN_WRK2.DS_ACCT_NUM
                    , RELN_WRK2.RELN_DS_ACCT_NUM
                    , RELN_WRK2.DS_ACCT_RELN_BILL_TO_FLG
                    , RELN_WRK2.DS_ACCT_RELN_SHIP_TO_FLG
                    , RELN_WRK2.GLBL_CMPY_CD
                    , AL.LOC_NUM
              FROM   (SELECT  RELN_WRK.DS_ACCT_RELN_TP_CD
                            , RELN_WRK.DS_ACCT_NUM
                            , RELN_WRK.RELN_DS_ACCT_NUM
                            , RELN_WRK.DS_ACCT_RELN_BILL_TO_FLG
                            , RELN_WRK.DS_ACCT_RELN_SHIP_TO_FLG
                            , RELN_WRK.GLBL_CMPY_CD
                        FROM  RELN_WRK
                       WHERE (RELN_WRK.DS_ACCT_NUM = #acctNum#
                          OR (RELN_WRK.DS_ACCT_NUM &lt;&gt; #acctNum# AND RELN_WRK.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#))
                         AND  RELN_WRK.IsLoop = 'N'
                         AND (RELN_WRK.DS_ACCT_RELN_BILL_TO_FLG = 'Y' OR  RELN_WRK.DS_ACCT_RELN_SHIP_TO_FLG = 'Y')
                      ORDER BY RELN_WRK.DS_ACCT_NUM
                              ,RELN_WRK.RELN_DS_ACCT_NUM) RELN_WRK2
                    , ACCT_LOC AL
              WHERE AL.DS_ACCT_NUM = RELN_WRK2.RELN_DS_ACCT_NUM
                AND AL.EZCANCELFLAG(+) = '0'
                AND AL.GLBL_CMPY_CD(+) = #glblCmpyCd#
            ) AL2
            , SHIP_TO_CUST SHIP
            , BILL_TO_CUST BILL
        WHERE AL2.LOC_NUM = SHIP.LOC_NUM(+)
          AND AL2.LOC_NUM = BILL.LOC_NUM(+)
          AND AL2.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD(+)
          AND AL2.RELN_DS_ACCT_NUM = SHIP.SELL_TO_CUST_CD(+)
          AND SHIP.RGTN_STS_CD(+) = #rgtnStsCd#
          AND SHIP.EZCANCELFLAG(+) = '0'
          AND AL2.GLBL_CMPY_CD = BILL.GLBL_CMPY_CD(+)
          AND AL2.RELN_DS_ACCT_NUM = BILL.SELL_TO_CUST_CD(+)
          AND BILL.RGTN_STS_CD(+) = #rgtnStsCd#
          AND BILL.EZCANCELFLAG(+) = '0'
        ORDER BY AL2.DS_ACCT_NUM
                ,AL2.RELN_DS_ACCT_NUM
    )
    WHERE 1 = 1
        <isNotNull property="defBillToList">
            AND (
        </isNotNull>
        <isNull property="defBillToList">
            <isNotNull property="defShipToList">
                AND (
            </isNotNull>
        </isNull>

        <isNotNull property="defBillToList">
            <iterate property="defBillToList" var="defBillTo[]" open=" R_BILL_TO_CUST_CD IN (" close=")" conjunction=",">
                #defBillTo[]#
            </iterate>
        </isNotNull>
        <isNotNull property="defShipToList">
            <isNotNull property="defBillToList">
                OR
            </isNotNull>
            <iterate property="defShipToList" var="defShipTo[]" open=" R_SHIP_TO_CUST_CD IN (" close=")" conjunction=",">
                #defShipTo[]#
            </iterate>
        </isNotNull>

        <isNotNull property="defBillToList">
            )
        </isNotNull>
        <isNull property="defBillToList">
            <isNotNull property="defShipToList">
                )
            </isNotNull>
        </isNull>
    </statement>
    <!-- END 2019/08/07 Hd.Sugawara [QC#52385,ADD] -->

<!-- 2019/12/13 QC#54882 Add Start -->
    <statement id="countOpenTransaction" parameterClass="Map" resultClass="BigDecimal">
    WITH CUST_INFO AS (
        SELECT SL.GLBL_CMPY_CD
             , SL.SELL_TO_CUST_CD
             <isNotNull property="billToCustCd">
             , BL.BILL_TO_CUST_CD
             </isNotNull>
             <isNotNull property="shipToCustCd">
             , SP.SHIP_TO_CUST_CD
             </isNotNull>
         FROM SELL_TO_CUST SL
            , ACCT_LOC     AL
            , PTY_LOC_WRK  PLW
             <isNotNull property="billToCustCd">
            , BILL_TO_CUST BL
             </isNotNull>
             <isNotNull property="shipToCustCd">
            , SHIP_TO_CUST SP
             </isNotNull>
        WHERE SL.GLBL_CMPY_CD = #glblCmpyCd#
          AND SL.EZCANCELFLAG = '0'
          AND SL.RGTN_STS_CD = #rgtnStsCd#
          AND SL.SELL_TO_CUST_CD = #acctNum#
          AND SL.GLBL_CMPY_CD = AL.GLBL_CMPY_CD
          AND SL.SELL_TO_CUST_CD = AL.DS_ACCT_NUM
          AND AL.EZCANCELFLAG = '0'
          AND AL.RGTN_STS_CD = #rgtnStsCd#
          AND AL.LOC_NUM = #locNum#
          AND AL.GLBL_CMPY_CD = PLW.GLBL_CMPY_CD
          AND AL.LOC_NUM = PLW.LOC_NUM
          AND PLW.EZCANCELFLAG = '0'
          AND PLW.RGTN_STS_CD = #rgtnStsCd#

          <isNotNull property="billToCustCd">
          AND PLW.GLBL_CMPY_CD = BL.GLBL_CMPY_CD
          AND PLW.LOC_NUM = BL.LOC_NUM
          AND BL.EZCANCELFLAG = '0'
          <!-- 2021/05/20 QC#58743 Mod Start -->
          <isNotEqual property="billToTerminated" compareValue="Y">
          AND BL.RGTN_STS_CD = #rgtnStsCd#
          </isNotEqual>
          <!-- 2021/05/20 QC#58743 Mod End -->
          AND BL.BILL_TO_CUST_CD = #billToCustCd#
         </isNotNull>

          <isNotNull property="shipToCustCd">
          AND PLW.GLBL_CMPY_CD = SP.GLBL_CMPY_CD
          AND PLW.LOC_NUM = SP.LOC_NUM
          AND SP.EZCANCELFLAG = '0'
          <!-- 2021/05/20 QC#58743 Mod Start -->
          <isNotEqual property="shipToTerminated" compareValue="Y">
          AND SP.RGTN_STS_CD = #rgtnStsCd#
          </isNotEqual>
          <!-- 2021/05/20 QC#58743 Mod End -->
          AND SP.SHIP_TO_CUST_CD = #shipToCustCd#
          </isNotNull>

        <!-- 2021/07/19 QC#58743-2 Add Start -->
        UNION ALL
        SELECT RELN.GLBL_CMPY_CD
             , RELN.RELN_DS_ACCT_NUM
             <isNotNull property="billToCustCd">
             , #billToCustCd#
             </isNotNull>
             <isNotNull property="shipToCustCd">
             , #shipToCustCd#
             </isNotNull>
         FROM DS_ACCT_RELN RELN
            , SELL_TO_CUST ACCT
            , DS_ACCT_RELN_TP DART
        WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
          AND RELN.EZCANCELFLAG = '0'
          AND RELN.DS_ACCT_NUM = #acctNum#
          AND RELN.RGTN_STS_CD = #rgtnStsCd#
          AND RELN.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
          AND RELN.RELN_DS_ACCT_NUM = ACCT.SELL_TO_CUST_CD
          AND ACCT.EZCANCELFLAG = '0'
          AND RELN.GLBL_CMPY_CD = DART.GLBL_CMPY_CD
          AND RELN.DS_ACCT_RELN_TP_CD = DART.DS_ACCT_RELN_TP_CD
          AND DART.EZCANCELFLAG = '0'
        UNION ALL
        SELECT RELN.GLBL_CMPY_CD
             , RELN.RELN_DS_ACCT_NUM
             <isNotNull property="billToCustCd">
             , #billToCustCd#
             </isNotNull>
             <isNotNull property="shipToCustCd">
             , #shipToCustCd#
             </isNotNull>
         FROM DS_ACCT_RELN RELN
            , DS_ACCT_PROS PROS
            , DS_ACCT_RELN_TP DART
        WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
          AND RELN.EZCANCELFLAG = '0'
          AND RELN.DS_ACCT_NUM = #acctNum#
          AND RELN.RGTN_STS_CD = #rgtnStsCd#
          AND RELN.GLBL_CMPY_CD = PROS.GLBL_CMPY_CD
          AND RELN.RELN_DS_ACCT_NUM = PROS.DS_ACCT_NUM
          AND PROS.EZCANCELFLAG = '0'
          AND RELN.GLBL_CMPY_CD = DART.GLBL_CMPY_CD
          AND RELN.DS_ACCT_RELN_TP_CD = DART.DS_ACCT_RELN_TP_CD
          AND DART.EZCANCELFLAG = '0'
        <!-- 2021/07/19 QC#58743-2 Add End -->
    )
    SELECT 1
      FROM DUAL
    WHERE 
    <isNotNull property="billToCustCd">
        EXISTS (
        SELECT 1
          FROM CPO C
             , CUST_INFO CI
         WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
           AND C.EZCANCELFLAG = '0'
           AND C.OPEN_FLG = #flgY#
           AND C.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND C.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND C.BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM CPO C
             , DS_CPO_CONFIG DCC
             , CPO_DTL       CD
             , CUST_INFO CI
         WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
           AND C.EZCANCELFLAG = '0'
           AND C.OPEN_FLG = #flgY#
           AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
           AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
           AND DCC.EZCANCELFLAG = '0'
           AND DCC.GLBL_CMPY_CD = CD.GLBL_CMPY_CD
           AND DCC.CPO_ORD_NUM = CD.CPO_ORD_NUM
           AND DCC.DS_CPO_CONFIG_PK = CD.DS_CPO_CONFIG_PK
           AND CD.EZCANCELFLAG = '0'
           AND CD.OPEN_FLG = #flgY#
           AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCC.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND DCC.BILL_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM CPO C
             , DS_CPO_CONFIG   DCC
             , DS_CPO_RTRN_DTL DCRD
             , CUST_INFO CI
         WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
           AND C.EZCANCELFLAG = '0'
           AND C.OPEN_FLG = #flgY#
           AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
           AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
           AND DCC.EZCANCELFLAG = '0'
           AND DCC.GLBL_CMPY_CD = DCRD.GLBL_CMPY_CD
           AND DCC.CPO_ORD_NUM = DCRD.CPO_ORD_NUM
           AND DCC.DS_CPO_CONFIG_PK = DCRD.DS_CPO_CONFIG_PK
           AND DCRD.EZCANCELFLAG = '0'
           AND DCRD.OPEN_FLG = #flgY#
           AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCC.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND DCC.BILL_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    <!-- START 03/14/2023 A.Cullano [QC#61182, DEL] -->
    <!--
    OR EXISTS (
        SELECT 1
          FROM SVC_MACH_MSTR SMM
             , CUST_INFO CI
         WHERE SMM.GLBL_CMPY_CD = #glblCmpyCd#
           AND SMM.EZCANCELFLAG = '0'
           AND SMM.SVC_MACH_TP_CD = #svcMachTpMachine#
           AND SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#, #svcMachStsDlrSvc#)
           AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND SMM.OWNR_ACCT_NUM = CI.SELL_TO_CUST_CD
    -->
    <!-- END 03/14/2023 A.Cullano [QC#61182, DEL] -->
           <!-- START 03/14/2023 A.Cullano [QC#61182, DEL] -->
           <!-- START 02/15/2023 A.Cullano [QC#61182, ADD] -->
           <!-- AND SMM.OWNR_ACCT_NUM = #acctNum# -->
           <!-- END 03/14/2023 A.Cullano [QC#61182, DEL] -->
           <!-- START 03/14/2023 A.Cullano [QC#61182, DEL] -->
           <!-- END 02/15/2023 A.Cullano [QC#61182, ADD] -->
           <!-- START 01/12/2023 A.Cullano [QC#60972, DEL] -->
           <!-- AND SMM.OWNR_LOC_NUM = CI.BILL_TO_CUST_CD -->
           <!-- END 01/12/2023 A.Cullano [QC#60972, DEL] -->
           <!-- AND ROWNUM = #rowNum# 
    ) -->
    <!-- END 03/14/2023 A.Cullano [QC#61182, DEL] -->
    OR EXISTS (
        SELECT 1
          FROM SVC_MACH_MSTR SMM
             , CUST_INFO CI
         WHERE SMM.GLBL_CMPY_CD = #glblCmpyCd#
           AND SMM.EZCANCELFLAG   = '0'
           AND SMM.SVC_MACH_TP_CD = #svcMachTpMachine#
           AND SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#, #svcMachStsDlrSvc#)
           AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND SMM.BILL_TO_ACCT_NUM = CI.SELL_TO_CUST_CD
           AND SMM.BILL_TO_LOC_NUM = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR       DCR
             , DS_CONTR_STS_V DCSV 
             , DS_CONTR_DTL   DCD
             , DS_CONTR_BLLG_SCHD DCBS
             , CUST_INFO CI
         WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCR.EZCANCELFLAG  = '0'
           AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgY#
           AND DCSV.DS_CONTR_CTRL_STS_CD  NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
           AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCD.DS_CONTR_PK
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG  = #flgN#
           AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND DCR.ALT_PAYER_CUST_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR       DCR
             , DS_CONTR_STS_V DCSV
             , DS_CONTR_DTL   DCD
             , DS_CONTR_BLLG_SCHD DCBS
             , CUST_INFO CI
         WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCR.EZCANCELFLAG  = '0'
           AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgY#
           AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
           AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG  = #flgN#
           AND DCD.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCD.BASE_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    <!-- 2021/05/20 QC#58743 Add Start -->
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR       DCR
             , DS_CONTR_STS_V DCSV
             , DS_CONTR_DTL   DCD
             , DS_CONTR_BLLG_SCHD DCBS
             , DS_CONTR_BLLG_MTR DCBM
             , CUST_INFO CI
         WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCR.EZCANCELFLAG  = '0'
           AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgY#
           AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
           AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG  = #flgN#
           AND DCD.GLBL_CMPY_CD = DCBM.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBM.DS_CONTR_DTL_PK
           AND DCBM.EZCANCELFLAG = '0'
           AND DCBM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCBM.BLLG_MTR_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR       DCR
             , DS_CONTR_STS_V DCSV 
             , DS_CONTR_DTL   DCD
             , DS_CONTR_BLLG_SCHD DCBS
             , CUST_INFO CI
         WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCR.EZCANCELFLAG  = '0'
           AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgN#
           AND DCSV.DS_CONTR_CTRL_STS_CD  = #dsContrCtrlStsTerminated#
           AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCD.DS_CONTR_PK
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG  = #flgN#
           <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
           <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND DCR.ALT_PAYER_CUST_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR       DCR
             , DS_CONTR_STS_V DCSV
             , DS_CONTR_DTL   DCD
             , DS_CONTR_BLLG_SCHD DCBS
             , CUST_INFO CI
         WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCR.EZCANCELFLAG  = '0'
           AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgN#
           AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
           AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG  = #flgN#
           <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
           <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND DCD.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCD.BASE_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR       DCR
             , DS_CONTR_STS_V DCSV
             , DS_CONTR_DTL   DCD
             , DS_CONTR_BLLG_SCHD DCBS
             , DS_CONTR_BLLG_MTR DCBM
             , CUST_INFO CI
         WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCR.EZCANCELFLAG  = '0'
           AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgN#
           AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
           AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG  = #flgN#
           <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
           <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND DCD.GLBL_CMPY_CD = DCBM.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBM.DS_CONTR_DTL_PK
           AND DCBM.EZCANCELFLAG = '0'
           AND DCBM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCBM.BLLG_MTR_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    <!-- 2021/05/20 QC#58743 Add End -->
    OR EXISTS (
        SELECT 1
          FROM SVC_TASK ST
             , FSR      F
             , CUST_INFO CI
         WHERE ST.GLBL_CMPY_CD = #glblCmpyCd#
           AND ST.EZCANCELFLAG = '0'
           AND ST.SVC_TASK_STS_CD NOT IN (#svcTaskStsClosed#, #svcTaskStsCancelled#)
           AND ST.GLBL_CMPY_CD = F.GLBL_CMPY_CD
           AND ST.FSR_NUM = F.FSR_NUM
           AND F.EZCANCELFLAG  = '0'
           AND F.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND F.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD 
           AND F.BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM SCHD_AGMT SA
             , CUST_INFO CI
         WHERE SA.GLBL_CMPY_CD = #glblCmpyCd#
           AND SA.EZCANCELFLAG = '0'
           AND SA.SCHD_AGMT_VLD_FROM_DT &lt;= #salesDate#
           AND NVL(SA.SCHD_AGMT_VLD_THRU_DT, #maxThruDt#) &gt;= #salesDate#
           AND EXISTS (SELECT 1
                         FROM SCHD_AGMT_PLN SAP
                        WHERE SAP.GLBL_CMPY_CD = SA.GLBL_CMPY_CD
                          AND SAP.SCHD_AGMT_NUM = SA.SCHD_AGMT_NUM
                          AND SAP.SCHD_AGMT_PLN_CANC_FLG = #flgN#
                          AND SAP.ORD_CRAT_TS IS NULL
                      )
           AND SA.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND SA.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND SA.BILL_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    ) 
    </isNotNull>
    <isNotNull property="shipToCustCd">
        <isNotNull property="billToCustCd">
        OR
        </isNotNull>
        EXISTS (
        SELECT 1
          FROM CPO C
             , CUST_INFO CI
         WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
           AND C.EZCANCELFLAG = '0'
           AND C.OPEN_FLG = #flgY#
           AND C.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND C.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND C.ADD_SHIP_TO_CUST_CD = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM CPO C
             , DS_CPO_CONFIG DCC
             , CPO_DTL       CD
             , CUST_INFO CI
         WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
           AND C.EZCANCELFLAG = '0'
           AND C.OPEN_FLG = #flgY#
           AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
           AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
           AND DCC.EZCANCELFLAG = '0'
           AND DCC.GLBL_CMPY_CD = CD.GLBL_CMPY_CD
           AND DCC.CPO_ORD_NUM = CD.CPO_ORD_NUM
           AND DCC.DS_CPO_CONFIG_PK = CD.DS_CPO_CONFIG_PK
           AND CD.EZCANCELFLAG = '0'
           AND CD.OPEN_FLG = #flgY#
           AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCC.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND DCC.SHIP_TO_CUST_LOC_CD = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM CPO C
             , DS_CPO_CONFIG   DCC
             , DS_CPO_RTRN_DTL DCRD
             , CUST_INFO CI
         WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
           AND C.EZCANCELFLAG = '0'
           AND C.OPEN_FLG = #flgY#
           AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
           AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
           AND DCC.EZCANCELFLAG = '0'
           AND DCC.GLBL_CMPY_CD = DCRD.GLBL_CMPY_CD
           AND DCC.CPO_ORD_NUM = DCRD.CPO_ORD_NUM
           AND DCC.DS_CPO_CONFIG_PK = DCRD.DS_CPO_CONFIG_PK
           AND DCRD.EZCANCELFLAG = '0'
           AND DCRD.OPEN_FLG = #flgY#
           AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCC.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND DCC.SHIP_TO_CUST_LOC_CD = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    <!-- 2020/01/07 QC#54882-1 Add Start -->
    OR EXISTS (
        SELECT 1
          FROM SVC_MACH_MSTR SMM
             , CUST_INFO CI
         WHERE SMM.GLBL_CMPY_CD = #glblCmpyCd#
           AND SMM.EZCANCELFLAG   = '0'
           AND SMM.SVC_MACH_TP_CD = #svcMachTpMachine#
           AND SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#, #svcMachStsDlrSvc#)
           AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND SMM.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD
           AND SMM.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    <!-- 2020/01/07 QC#54882-1 Add End -->
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR_DTL   DCD
             , DS_CONTR_STS_V DCSV
             , DS_CONTR_BLLG_SCHD DCBS
             , (
                 <!-- 2020/10/09 QC#57751 Add Start -->
                 SELECT * FROM LATERAL(
                 <!-- 2020/10/09 QC#57751 Add End -->
                    <!-- 2020/10/09 QC#57751 Edit Start -->
                    SELECT HH.GLBL_CMPY_CD
                         , HH.SVC_MACH_MSTR_PK
                         , HH.CUR_LOC_ACCT_NUM
                         , HH.CUR_LOC_NUM
                    <!-- 2020/10/09 QC#57751 Edit End -->
                         <!-- 2020/10/09 QC#57751 Add Start -->
                         , ROW_NUMBER() OVER (
                             PARTITION BY HH.SVC_MACH_MSTR_PK
                             ORDER BY HH.SVC_MACH_MSTR_PK
                                    , HH.HIST_CRAT_TS DESC
                         ) RANK_NUM
                         <!-- 2020/10/09 QC#57751 End Start -->
                    FROM SVC_MACH_MSTR_HIST H
                       <!-- 2020/10/09 QC#57751 Add Start -->
                       , CUST_INFO CI
                       , SVC_MACH_MSTR_HIST HH
                       <!-- 2020/10/09 QC#57751 Add End -->
                    WHERE H.GLBL_CMPY_CD = #glblCmpyCd#
                      AND H.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#)
                      AND H.EZCANCELFLAG = '0'
                 <!-- 2020/10/09 QC#57751 Add Start -->
                      AND H.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD
                      AND H.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
                      AND H.GLBL_CMPY_CD = HH.GLBL_CMPY_CD
                      AND H.SVC_MACH_MSTR_PK = HH.SVC_MACH_MSTR_PK
                      AND HH.EZCANCELFLAG = '0'
                 ) LH
                 WHERE LH.RANK_NUM= 1
                 <!-- 2020/10/09 QC#57751 Add End -->
               ) SMM
             , CUST_INFO CI
         WHERE DCD.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCD.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgY#
           AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG = #flgN#
           AND DCD.GLBL_CMPY_CD = SMM.GLBL_CMPY_CD
           AND DCD.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
           AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND SMM.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND SMM.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM SVC_TASK ST
             , FSR      F
             , CUST_INFO CI
         WHERE ST.GLBL_CMPY_CD = #glblCmpyCd#
           AND ST.EZCANCELFLAG    = '0'
           AND ST.SVC_TASK_STS_CD NOT IN (#svcTaskStsClosed#, #svcTaskStsCancelled#)
           AND ST.GLBL_CMPY_CD = F.GLBL_CMPY_CD
           AND ST.FSR_NUM = F.FSR_NUM
           AND F.EZCANCELFLAG  = '0'
           AND F.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND F.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD 
           AND F.SHIP_TO_CUST_CD = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM SCHD_AGMT SA
             , CUST_INFO CI
         WHERE SA.GLBL_CMPY_CD = #glblCmpyCd#
           AND SA.EZCANCELFLAG = '0'
           AND SA.SCHD_AGMT_VLD_FROM_DT &lt;= #salesDate#
           AND NVL(SA.SCHD_AGMT_VLD_THRU_DT, #maxThruDt#) &gt;= #salesDate#
           AND EXISTS (SELECT 1
                         FROM SCHD_AGMT_PLN SAP
                        WHERE SAP.GLBL_CMPY_CD = SA.GLBL_CMPY_CD
                          AND SAP.SCHD_AGMT_NUM = SA.SCHD_AGMT_NUM
                          AND SAP.SCHD_AGMT_PLN_CANC_FLG = #flgN#
                          AND SAP.ORD_CRAT_TS IS NULL
                      )
           AND SA.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND SA.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND SA.SHIP_TO_CUST_LOC_CD = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    <!-- 2021/05/20 QC#58743 Add End -->
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR_DTL   DCD
             , DS_CONTR_STS_V DCSV
             , DS_CONTR_BLLG_SCHD DCBS
             , (
                 SELECT * FROM LATERAL(
                    SELECT HH.GLBL_CMPY_CD
                         , HH.SVC_MACH_MSTR_PK
                         , HH.CUR_LOC_ACCT_NUM
                         , HH.CUR_LOC_NUM
                         , ROW_NUMBER() OVER (
                             PARTITION BY HH.SVC_MACH_MSTR_PK
                             ORDER BY HH.SVC_MACH_MSTR_PK
                                    , HH.HIST_CRAT_TS DESC
                         ) RANK_NUM
                    FROM SVC_MACH_MSTR_HIST H
                       , CUST_INFO CI
                       , SVC_MACH_MSTR_HIST HH
                    WHERE H.GLBL_CMPY_CD = #glblCmpyCd#
                      AND H.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#)
                      AND H.EZCANCELFLAG = '0'
                      AND H.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD
                      AND H.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
                      AND H.GLBL_CMPY_CD = HH.GLBL_CMPY_CD
                      AND H.SVC_MACH_MSTR_PK = HH.SVC_MACH_MSTR_PK
                      AND HH.EZCANCELFLAG = '0'
                 ) LH
                 WHERE LH.RANK_NUM= 1
               ) SMM
             , CUST_INFO CI
         WHERE DCD.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCD.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgN#
           AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG = #flgN#
           <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
           <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND DCD.GLBL_CMPY_CD = SMM.GLBL_CMPY_CD
           AND DCD.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
           AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND SMM.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND SMM.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    <!-- 2021/05/20 QC#58743 Add End -->
    </isNotNull>
    </statement>
<!-- 2019/12/13 QC#54882 Add End -->

<!-- 2020/07/22 QC#57316 Add Start -->
    <statement id="getOpenTransaction" parameterClass="Map" resultClass="Map">
    WITH CUST_INFO AS (
        SELECT SL.GLBL_CMPY_CD
             , SL.SELL_TO_CUST_CD
             <isNotNull property="billToCustCd">
             , BL.BILL_TO_CUST_CD
             </isNotNull>
             <isNotNull property="shipToCustCd">
             , SP.SHIP_TO_CUST_CD
             </isNotNull>
         FROM SELL_TO_CUST SL
            , ACCT_LOC     AL
            , PTY_LOC_WRK  PLW
             <isNotNull property="billToCustCd">
            , BILL_TO_CUST BL
             </isNotNull>
             <isNotNull property="shipToCustCd">
            , SHIP_TO_CUST SP
             </isNotNull>
        WHERE SL.GLBL_CMPY_CD = #glblCmpyCd#
          AND SL.EZCANCELFLAG = '0'
          AND SL.RGTN_STS_CD = #rgtnStsCd#
          AND SL.SELL_TO_CUST_CD = #acctNum#
          AND SL.GLBL_CMPY_CD = AL.GLBL_CMPY_CD
          AND SL.SELL_TO_CUST_CD = AL.DS_ACCT_NUM
          AND AL.EZCANCELFLAG = '0'
          AND AL.RGTN_STS_CD = #rgtnStsCd#
          AND AL.LOC_NUM = #locNum#
          AND AL.GLBL_CMPY_CD = PLW.GLBL_CMPY_CD
          AND AL.LOC_NUM = PLW.LOC_NUM
          AND PLW.EZCANCELFLAG = '0'
          AND PLW.RGTN_STS_CD = #rgtnStsCd#

          <isNotNull property="billToCustCd">
          AND PLW.GLBL_CMPY_CD = BL.GLBL_CMPY_CD
          AND PLW.LOC_NUM = BL.LOC_NUM
          AND BL.EZCANCELFLAG = '0'
          <!-- 2021/05/20 QC#58743 Mod Start -->
          <isNotEqual property="billToTerminated" compareValue="Y">
          AND BL.RGTN_STS_CD = #rgtnStsCd#
          </isNotEqual>
          <!-- 2021/05/20 QC#58743 Mod End -->
          AND BL.BILL_TO_CUST_CD = #billToCustCd#
         </isNotNull>

          <isNotNull property="shipToCustCd">
          AND PLW.GLBL_CMPY_CD = SP.GLBL_CMPY_CD
          AND PLW.LOC_NUM = SP.LOC_NUM
          AND SP.EZCANCELFLAG = '0'
          <!-- 2021/05/20 QC#58743 Mod Start -->
          <isNotEqual property="shipToTerminated" compareValue="Y">
          AND SP.RGTN_STS_CD = #rgtnStsCd#
          </isNotEqual>
          <!-- 2021/05/20 QC#58743 Mod End -->
          AND SP.SHIP_TO_CUST_CD = #shipToCustCd#
          </isNotNull>

        <!-- 2021/07/19 QC#58743-2 Add Start -->
        UNION ALL
        SELECT RELN.GLBL_CMPY_CD
             , RELN.RELN_DS_ACCT_NUM
             <isNotNull property="billToCustCd">
             , #billToCustCd#
             </isNotNull>
             <isNotNull property="shipToCustCd">
             , #shipToCustCd#
             </isNotNull>
         FROM DS_ACCT_RELN RELN
            , SELL_TO_CUST ACCT
            , DS_ACCT_RELN_TP DART
        WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
          AND RELN.EZCANCELFLAG = '0'
          AND RELN.DS_ACCT_NUM = #acctNum#
          AND RELN.RGTN_STS_CD = #rgtnStsCd#
          AND RELN.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
          AND RELN.RELN_DS_ACCT_NUM = ACCT.SELL_TO_CUST_CD
          AND ACCT.EZCANCELFLAG = '0'
          AND RELN.GLBL_CMPY_CD = DART.GLBL_CMPY_CD
          AND RELN.DS_ACCT_RELN_TP_CD = DART.DS_ACCT_RELN_TP_CD
          AND DART.EZCANCELFLAG = '0'
        UNION ALL
        SELECT RELN.GLBL_CMPY_CD
             , RELN.RELN_DS_ACCT_NUM
             <isNotNull property="billToCustCd">
             , #billToCustCd#
             </isNotNull>
             <isNotNull property="shipToCustCd">
             , #shipToCustCd#
             </isNotNull>
         FROM DS_ACCT_RELN RELN
            , DS_ACCT_PROS PROS
            , DS_ACCT_RELN_TP DART
        WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
          AND RELN.EZCANCELFLAG = '0'
          AND RELN.DS_ACCT_NUM = #acctNum#
          AND RELN.RGTN_STS_CD = #rgtnStsCd#
          AND RELN.GLBL_CMPY_CD = PROS.GLBL_CMPY_CD
          AND RELN.RELN_DS_ACCT_NUM = PROS.DS_ACCT_NUM
          AND PROS.EZCANCELFLAG = '0'
          AND RELN.GLBL_CMPY_CD = DART.GLBL_CMPY_CD
          AND RELN.DS_ACCT_RELN_TP_CD = DART.DS_ACCT_RELN_TP_CD
          AND DART.EZCANCELFLAG = '0'
        <!-- 2021/07/19 QC#58743-2 Add End -->
    )
    SELECT
        MAIN.TRX_PAT
       ,MAIN.KEY_NAME
       ,MAIN.KEY_VAL
    FROM (
        SELECT DISTINCT
            MAIN.TRX_PAT
           ,MAIN.KEY_NAME
           ,MAIN.KEY_VAL
           ,MAIN.SORT_NUM
        FROM (
            <isNotNull property="billToCustCd">
                SELECT
                    'CPO-BILL'         AS TRX_PAT
                   ,'CPO Order Number' AS KEY_NAME
                   ,C.CPO_ORD_NUM      AS KEY_VAL
                   ,1                  AS SORT_NUM
                FROM
                    CPO C
                   ,CUST_INFO CI
                WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
                AND C.EZCANCELFLAG = '0'
                AND C.OPEN_FLG = #flgY#
                AND C.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND C.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
                AND C.BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
                UNION ALL SELECT
                    'CONFIG-Out-BILL'  AS TRX_PAT
                   ,'CPO Order Number' AS KEY_NAME
                   ,C.CPO_ORD_NUM      AS KEY_VAL
                   ,4                  AS SORT_NUM
                FROM
                    CPO C
                   ,DS_CPO_CONFIG DCC
                   ,CPO_DTL       CD
                   ,CUST_INFO CI
                WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
                AND C.EZCANCELFLAG = '0'
                AND C.OPEN_FLG = #flgY#
                AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
                AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
                AND DCC.EZCANCELFLAG = '0'
                AND DCC.GLBL_CMPY_CD = CD.GLBL_CMPY_CD
                AND DCC.CPO_ORD_NUM = CD.CPO_ORD_NUM
                AND DCC.DS_CPO_CONFIG_PK = CD.DS_CPO_CONFIG_PK
                AND CD.EZCANCELFLAG = '0'
                AND CD.OPEN_FLG = #flgY#
                AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND DCC.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
                AND DCC.BILL_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
                UNION ALL SELECT
                    'CONFIG-In-BILL'  AS TRX_PAT
                   ,'CPO Order Number' AS KEY_NAME
                   ,C.CPO_ORD_NUM      AS KEY_VAL
                   ,6                  AS SORT_NUM
                FROM
                    CPO C
                   ,DS_CPO_CONFIG   DCC
                   ,DS_CPO_RTRN_DTL DCRD
                   ,CUST_INFO CI
                WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
                AND C.EZCANCELFLAG = '0'
                AND C.OPEN_FLG = #flgY#
                AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
                AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
                AND DCC.EZCANCELFLAG = '0'
                AND DCC.GLBL_CMPY_CD = DCRD.GLBL_CMPY_CD
                AND DCC.CPO_ORD_NUM = DCRD.CPO_ORD_NUM
                AND DCC.DS_CPO_CONFIG_PK = DCRD.DS_CPO_CONFIG_PK
                AND DCRD.EZCANCELFLAG = '0'
                AND DCRD.OPEN_FLG = #flgY#
                AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND DCC.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
                AND DCC.BILL_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
                <!-- START 03/14/2023 A.Cullano [QC#61182, DEL] -->
                <!--
                UNION ALL SELECT
                    'Machine-Owner'  AS TRX_PAT
                   ,'Install Base ID' AS KEY_NAME
                   ,TO_CHAR(SMM.SVC_MACH_MSTR_PK) AS KEY_VAL
                   ,8                  AS SORT_NUM
                FROM
                    SVC_MACH_MSTR SMM
                   ,CUST_INFO CI
                WHERE SMM.GLBL_CMPY_CD = #glblCmpyCd#
                AND SMM.EZCANCELFLAG = '0'
                AND SMM.SVC_MACH_TP_CD = #svcMachTpMachine#
                AND SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#, #svcMachStsDlrSvc#)
                AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND SMM.OWNR_ACCT_NUM = CI.SELL_TO_CUST_CD
                -->
                <!-- END 03/14/2023 A.Cullano [QC#61182, DEL] -->
                <!-- START 03/14/2023 A.Cullano [QC#61182, DEL] -->
                <!-- START 02/15/2023 A.Cullano [QC#61182, ADD] -->
                <!-- AND SMM.OWNR_ACCT_NUM = #acctNum# -->
                <!-- END 03/14/2023 A.Cullano [QC#61182, DEL] -->
                <!-- END 02/15/2023 A.Cullano [QC#61182, ADD] -->
                <!-- START 01/12/2023 A.Cullano [QC#60972, DEL] -->
                <!-- AND SMM.OWNR_LOC_NUM = CI.BILL_TO_CUST_CD -->
                <!-- END 01/12/2023 A.Cullano [QC#60972, DEL] -->
                UNION ALL SELECT
                    'Machine-BILL'  AS TRX_PAT
                   ,'Install Base ID' AS KEY_NAME
                   ,TO_CHAR(SMM.SVC_MACH_MSTR_PK) AS KEY_VAL
                   ,9                  AS SORT_NUM
                FROM
                    SVC_MACH_MSTR SMM
                   ,CUST_INFO CI
                WHERE SMM.GLBL_CMPY_CD = #glblCmpyCd#
                AND SMM.EZCANCELFLAG   = '0'
                AND SMM.SVC_MACH_TP_CD = #svcMachTpMachine#
                AND SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#, #svcMachStsDlrSvc#)
                AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND SMM.BILL_TO_ACCT_NUM = CI.SELL_TO_CUST_CD
                AND SMM.BILL_TO_LOC_NUM = CI.BILL_TO_CUST_CD
                UNION ALL SELECT
                    'Contract-BILL'  AS TRX_PAT
                   ,'Contract Number' AS KEY_NAME
                   ,DCR.DS_CONTR_NUM AS KEY_VAL
                   ,11                  AS SORT_NUM
                FROM
                    DS_CONTR       DCR
                   ,DS_CONTR_STS_V DCSV 
                   ,DS_CONTR_DTL   DCD
                   ,DS_CONTR_BLLG_SCHD DCBS
                   ,CUST_INFO CI
                WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
                AND DCR.EZCANCELFLAG  = '0'
                AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
                AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
                AND DCSV.EZCANCELFLAG = '0'
                AND DCSV.ETTL_AVAL_FLG = #flgY#
                AND DCSV.DS_CONTR_CTRL_STS_CD  NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
                AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
                AND DCR.DS_CONTR_PK  = DCD.DS_CONTR_PK
                AND DCD.EZCANCELFLAG = '0'
                AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
                AND DCBS.EZCANCELFLAG = '0'
                AND DCBS.INV_FLG  = #flgN#
                AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
                AND DCR.ALT_PAYER_CUST_CD = CI.BILL_TO_CUST_CD
                UNION ALL SELECT
                    'Contract-Detail-BILL'  AS TRX_PAT
                   ,'Contract Number' AS KEY_NAME
                   ,DCR.DS_CONTR_NUM AS KEY_VAL
                   ,13                  AS SORT_NUM
                FROM
                    DS_CONTR       DCR
                   ,DS_CONTR_STS_V DCSV
                   ,DS_CONTR_DTL   DCD
                   ,DS_CONTR_BLLG_SCHD DCBS
                   ,CUST_INFO CI
                WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
                AND DCR.EZCANCELFLAG  = '0'
                AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
                AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
                AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
                AND DCSV.EZCANCELFLAG = '0'
                AND DCSV.ETTL_AVAL_FLG = #flgY#
                AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
                AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
                AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
                AND DCD.EZCANCELFLAG = '0'
                AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
                AND DCBS.EZCANCELFLAG = '0'
                AND DCBS.INV_FLG  = #flgN#
                AND DCD.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND DCD.BASE_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
                UNION ALL SELECT
                    'SERVICE CALL-BILL'  AS TRX_PAT
                   ,'Service Task Number' AS KEY_NAME
                   ,ST.SVC_TASK_NUM AS KEY_VAL
                   ,14                  AS SORT_NUM
                FROM
                    SVC_TASK ST
                   ,FSR      F
                   ,CUST_INFO CI
                WHERE ST.GLBL_CMPY_CD = #glblCmpyCd#
                AND ST.EZCANCELFLAG = '0'
                AND ST.SVC_TASK_STS_CD NOT IN (#svcTaskStsClosed#, #svcTaskStsCancelled#)
                AND ST.GLBL_CMPY_CD = F.GLBL_CMPY_CD
                AND ST.FSR_NUM = F.FSR_NUM
                AND F.EZCANCELFLAG  = '0'
                AND F.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND F.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD 
                AND F.BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
                UNION ALL SELECT
                    'SCHEDULE AGREEMENT-BILL'  AS TRX_PAT
                   ,'Schedule Aggrement Number' AS KEY_NAME
                   ,SA.SCHD_AGMT_NUM AS KEY_VAL
                   ,16                  AS SORT_NUM
                FROM
                    SCHD_AGMT SA
                   ,CUST_INFO CI
                WHERE SA.GLBL_CMPY_CD = #glblCmpyCd#
                AND SA.EZCANCELFLAG = '0'
                AND SA.SCHD_AGMT_VLD_FROM_DT &lt;= #salesDate#
                AND NVL(SA.SCHD_AGMT_VLD_THRU_DT, #maxThruDt#) &gt;= #salesDate#
                AND EXISTS (SELECT 1
                            FROM SCHD_AGMT_PLN SAP
                            WHERE SAP.GLBL_CMPY_CD = SA.GLBL_CMPY_CD
                            AND SAP.SCHD_AGMT_NUM = SA.SCHD_AGMT_NUM
                            AND SAP.SCHD_AGMT_PLN_CANC_FLG = #flgN#
                            AND SAP.ORD_CRAT_TS IS NULL
                )
                AND SA.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND SA.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
                AND SA.BILL_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
                <!-- 2021/05/20 QC#58743 Add Start -->
                UNION ALL SELECT
                    'Contract-Detail-Overage-BILL'  AS TRX_PAT
                   ,'Contract Number' AS KEY_NAME
                   ,DCR.DS_CONTR_NUM AS KEY_VAL
                   ,18                  AS SORT_NUM
                FROM
                    DS_CONTR       DCR
                   ,DS_CONTR_STS_V DCSV
                   ,DS_CONTR_DTL   DCD
                   ,DS_CONTR_BLLG_SCHD DCBS
                   ,DS_CONTR_BLLG_MTR DCBM
                   ,CUST_INFO CI
                WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
                AND DCR.EZCANCELFLAG  = '0'
                AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
                AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
                AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
                AND DCSV.EZCANCELFLAG = '0'
                AND DCSV.ETTL_AVAL_FLG = #flgY#
                AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
                AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
                AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
                AND DCD.EZCANCELFLAG = '0'
                AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
                AND DCBS.EZCANCELFLAG = '0'
                AND DCBS.INV_FLG  = #flgN#
                AND DCD.GLBL_CMPY_CD = DCBM.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_PK = DCBM.DS_CONTR_DTL_PK
                AND DCBM.EZCANCELFLAG = '0'
                AND DCBM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND DCBM.BLLG_MTR_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
                UNION ALL SELECT
                    'Contract-BILL-Terminate Credit'  AS TRX_PAT
                   ,'Contract Number' AS KEY_NAME
                   ,DCR.DS_CONTR_NUM AS KEY_VAL
                   ,19                  AS SORT_NUM
                FROM
                    DS_CONTR       DCR
                   ,DS_CONTR_STS_V DCSV 
                   ,DS_CONTR_DTL   DCD
                   ,DS_CONTR_BLLG_SCHD DCBS
                   ,CUST_INFO CI
                WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
                AND DCR.EZCANCELFLAG  = '0'
                AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
                AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
                AND DCSV.EZCANCELFLAG = '0'
                AND DCSV.ETTL_AVAL_FLG = #flgN#
                AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
                AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
                AND DCR.DS_CONTR_PK  = DCD.DS_CONTR_PK
                AND DCD.EZCANCELFLAG = '0'
                AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
                AND DCBS.EZCANCELFLAG = '0'
                AND DCBS.INV_FLG  = #flgN#
                <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
                AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
                <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
                AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
                AND DCR.ALT_PAYER_CUST_CD = CI.BILL_TO_CUST_CD
                UNION ALL SELECT
                    'Contract-Detail-BILL-Terminate Credit'  AS TRX_PAT
                   ,'Contract Number' AS KEY_NAME
                   ,DCR.DS_CONTR_NUM AS KEY_VAL
                   ,21                  AS SORT_NUM
                FROM
                    DS_CONTR       DCR
                   ,DS_CONTR_STS_V DCSV
                   ,DS_CONTR_DTL   DCD
                   ,DS_CONTR_BLLG_SCHD DCBS
                   ,CUST_INFO CI
                WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
                AND DCR.EZCANCELFLAG  = '0'
                AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
                AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
                AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
                AND DCSV.EZCANCELFLAG = '0'
                AND DCSV.ETTL_AVAL_FLG = #flgN#
                AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
                AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
                AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
                AND DCD.EZCANCELFLAG = '0'
                AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
                AND DCBS.EZCANCELFLAG = '0'
                AND DCBS.INV_FLG  = #flgN#
                <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
                AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
                <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
                AND DCD.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND DCD.BASE_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
                UNION ALL SELECT
                    'Contract-Detail-Overage-BILL-Terminate Credit'  AS TRX_PAT
                   ,'Contract Number' AS KEY_NAME
                   ,DCR.DS_CONTR_NUM AS KEY_VAL
                   ,22                  AS SORT_NUM
                FROM
                    DS_CONTR       DCR
                   ,DS_CONTR_STS_V DCSV
                   ,DS_CONTR_DTL   DCD
                   ,DS_CONTR_BLLG_SCHD DCBS
                   ,DS_CONTR_BLLG_MTR DCBM
                   ,CUST_INFO CI
                WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
                AND DCR.EZCANCELFLAG  = '0'
                AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
                AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
                AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
                AND DCSV.EZCANCELFLAG = '0'
                AND DCSV.ETTL_AVAL_FLG = #flgN#
                AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
                AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
                AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
                AND DCD.EZCANCELFLAG = '0'
                AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
                AND DCBS.EZCANCELFLAG = '0'
                AND DCBS.INV_FLG  = #flgN#
                <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
                AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
                <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
                AND DCD.GLBL_CMPY_CD = DCBM.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_PK = DCBM.DS_CONTR_DTL_PK
                AND DCBM.EZCANCELFLAG = '0'
                AND DCBM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND DCBM.BLLG_MTR_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
                <!-- 2021/05/20 QC#58743 Add End -->
            </isNotNull>
            <isNotNull property="shipToCustCd">
                <isNotNull property="billToCustCd">
                UNION ALL
                </isNotNull>
                SELECT
                    'CPO-SHIP'         AS TRX_PAT
                   ,'CPO Order Number' AS KEY_NAME
                   ,C.CPO_ORD_NUM      AS KEY_VAL
                   ,2                  AS SORT_NUM
                FROM
                    CPO C
                   ,CUST_INFO CI
                WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
                AND C.EZCANCELFLAG = '0'
                AND C.OPEN_FLG = #flgY#
                AND C.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND C.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
                AND C.ADD_SHIP_TO_CUST_CD = CI.SHIP_TO_CUST_CD
                UNION ALL SELECT
                    'CONFIG-Out-SHIP'  AS TRX_PAT
                   ,'CPO Order Number' AS KEY_NAME
                   ,C.CPO_ORD_NUM      AS KEY_VAL
                   ,5                  AS SORT_NUM
                FROM
                    CPO C
                   ,DS_CPO_CONFIG DCC
                   ,CPO_DTL       CD
                   ,CUST_INFO CI
                WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
                AND C.EZCANCELFLAG = '0'
                AND C.OPEN_FLG = #flgY#
                AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
                AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
                AND DCC.EZCANCELFLAG = '0'
                AND DCC.GLBL_CMPY_CD = CD.GLBL_CMPY_CD
                AND DCC.CPO_ORD_NUM = CD.CPO_ORD_NUM
                AND DCC.DS_CPO_CONFIG_PK = CD.DS_CPO_CONFIG_PK
                AND CD.EZCANCELFLAG = '0'
                AND CD.OPEN_FLG = #flgY#
                AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND DCC.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
                AND DCC.SHIP_TO_CUST_LOC_CD = CI.SHIP_TO_CUST_CD
                UNION ALL SELECT
                    'CONFIG-In-SHIP'  AS TRX_PAT
                   ,'CPO Order Number' AS KEY_NAME
                   ,C.CPO_ORD_NUM      AS KEY_VAL
                   ,7                  AS SORT_NUM
                FROM
                    CPO C
                   ,DS_CPO_CONFIG   DCC
                   ,DS_CPO_RTRN_DTL DCRD
                   ,CUST_INFO CI
                WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
                AND C.EZCANCELFLAG = '0'
                AND C.OPEN_FLG = #flgY#
                AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
                AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
                AND DCC.EZCANCELFLAG = '0'
                AND DCC.GLBL_CMPY_CD = DCRD.GLBL_CMPY_CD
                AND DCC.CPO_ORD_NUM = DCRD.CPO_ORD_NUM
                AND DCC.DS_CPO_CONFIG_PK = DCRD.DS_CPO_CONFIG_PK
                AND DCRD.EZCANCELFLAG = '0'
                AND DCRD.OPEN_FLG = #flgY#
                AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND DCC.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
                AND DCC.SHIP_TO_CUST_LOC_CD = CI.SHIP_TO_CUST_CD
                UNION ALL SELECT
                    'Machine-Current'  AS TRX_PAT
                   ,'Install Base ID' AS KEY_NAME
                   ,TO_CHAR(SMM.SVC_MACH_MSTR_PK) AS KEY_VAL
                   ,10                  AS SORT_NUM
                FROM
                    SVC_MACH_MSTR SMM
                   ,CUST_INFO CI
                WHERE SMM.GLBL_CMPY_CD = #glblCmpyCd#
                AND SMM.EZCANCELFLAG   = '0'
                AND SMM.SVC_MACH_TP_CD = #svcMachTpMachine#
                AND SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#, #svcMachStsDlrSvc#)
                AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND SMM.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD
                AND SMM.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
                UNION ALL SELECT
                    'Contract-Detail-Install-SHIP'  AS TRX_PAT
                   ,'Contract Number' AS KEY_NAME
                   ,DCR.DS_CONTR_NUM AS KEY_VAL
                   ,12                  AS SORT_NUM
                FROM
                    DS_CONTR_DTL   DCD
                   ,DS_CONTR       DCR
                   ,DS_CONTR_STS_V DCSV
                   ,DS_CONTR_BLLG_SCHD DCBS
                   ,(
                     <!-- 2020/10/09 QC#57751 Add Start -->
                     SELECT * FROM LATERAL(
                     <!-- 2020/10/09 QC#57751 Add End -->
                        <!-- 2020/10/09 QC#57751 Edit Start -->
                        SELECT HH.GLBL_CMPY_CD
                             , HH.SVC_MACH_MSTR_PK
                             , HH.CUR_LOC_ACCT_NUM
                             , HH.CUR_LOC_NUM
                        <!-- 2020/10/09 QC#57751 Edit End -->
                             <!-- 2020/10/09 QC#57751 Add Start -->
                             , ROW_NUMBER() OVER (
                                 PARTITION BY HH.SVC_MACH_MSTR_PK
                                 ORDER BY HH.SVC_MACH_MSTR_PK
                                        , HH.HIST_CRAT_TS DESC
                             ) RANK_NUM
                             <!-- 2020/10/09 QC#57751 End Start -->
                        FROM SVC_MACH_MSTR_HIST H
                           <!-- 2020/10/09 QC#57751 Add Start -->
                           , CUST_INFO CI
                           , SVC_MACH_MSTR_HIST HH
                           <!-- 2020/10/09 QC#57751 Add End -->
                        WHERE H.GLBL_CMPY_CD = #glblCmpyCd#
                          AND H.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#)
                          AND H.EZCANCELFLAG = '0'
                     <!-- 2020/10/09 QC#57751 Add Start -->
                          AND H.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD
                          AND H.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
                          AND H.GLBL_CMPY_CD = HH.GLBL_CMPY_CD
                          AND H.SVC_MACH_MSTR_PK = HH.SVC_MACH_MSTR_PK
                          AND HH.EZCANCELFLAG = '0'
                     ) LH
                     WHERE LH.RANK_NUM= 1
                     <!-- 2020/10/09 QC#57751 Add End -->
                    ) SMM
                   ,CUST_INFO CI
                WHERE DCD.GLBL_CMPY_CD = #glblCmpyCd#
                AND DCD.EZCANCELFLAG = '0'
                AND DCD.GLBL_CMPY_CD = DCR.GLBL_CMPY_CD
                AND DCD.DS_CONTR_PK  = DCR.DS_CONTR_PK
                AND DCR.EZCANCELFLAG = '0'
                AND DCD.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
                AND DCD.DS_CONTR_PK  = DCSV.DS_CONTR_PK
                AND DCSV.EZCANCELFLAG = '0'
                AND DCSV.ETTL_AVAL_FLG = #flgY#
                AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
                AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
                AND DCBS.EZCANCELFLAG = '0'
                AND DCBS.INV_FLG = #flgN#
                AND DCD.GLBL_CMPY_CD = SMM.GLBL_CMPY_CD
                AND DCD.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND SMM.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD 
                AND SMM.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
                UNION ALL SELECT
                    'SERVICE CALL-SHIP'  AS TRX_PAT
                   ,'Service Task Number' AS KEY_NAME
                   ,ST.SVC_TASK_NUM AS KEY_VAL
                   ,15                  AS SORT_NUM
                FROM
                    SVC_TASK ST
                   ,FSR      F
                   ,CUST_INFO CI
                WHERE ST.GLBL_CMPY_CD = #glblCmpyCd#
                AND ST.EZCANCELFLAG    = '0'
                AND ST.SVC_TASK_STS_CD NOT IN (#svcTaskStsClosed#, #svcTaskStsCancelled#)
                AND ST.GLBL_CMPY_CD = F.GLBL_CMPY_CD
                AND ST.FSR_NUM = F.FSR_NUM
                AND F.EZCANCELFLAG  = '0'
                AND F.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND F.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD 
                AND F.SHIP_TO_CUST_CD = CI.SHIP_TO_CUST_CD
                UNION ALL SELECT
                    'SCHEDULE AGREEMENT-SHIP'  AS TRX_PAT
                   ,'Schedule Aggrement Number' AS KEY_NAME
                   ,SA.SCHD_AGMT_NUM AS KEY_VAL
                   ,17                  AS SORT_NUM
                FROM
                    SCHD_AGMT SA
                   ,CUST_INFO CI
                WHERE SA.GLBL_CMPY_CD = #glblCmpyCd#
                AND SA.EZCANCELFLAG = '0'
                AND SA.SCHD_AGMT_VLD_FROM_DT &lt;= #salesDate#
                AND NVL(SA.SCHD_AGMT_VLD_THRU_DT, #maxThruDt#) &gt;= #salesDate#
                AND EXISTS (SELECT 1
                            FROM SCHD_AGMT_PLN SAP
                            WHERE SAP.GLBL_CMPY_CD = SA.GLBL_CMPY_CD
                            AND SAP.SCHD_AGMT_NUM = SA.SCHD_AGMT_NUM
                            AND SAP.SCHD_AGMT_PLN_CANC_FLG = #flgN#
                            AND SAP.ORD_CRAT_TS IS NULL
                )
                AND SA.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND SA.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
                AND SA.SHIP_TO_CUST_LOC_CD = CI.SHIP_TO_CUST_CD
                <!-- 2021/05/20 QC#58743 Add Start -->
                UNION ALL SELECT
                    'Contract-Detail-Install-SHIP-Terminate Credit'  AS TRX_PAT
                   ,'Contract Number' AS KEY_NAME
                   ,DCR.DS_CONTR_NUM AS KEY_VAL
                   ,20                  AS SORT_NUM
                FROM
                    DS_CONTR_DTL   DCD
                   ,DS_CONTR       DCR
                   ,DS_CONTR_STS_V DCSV
                   ,DS_CONTR_BLLG_SCHD DCBS
                   ,(
                     SELECT * FROM LATERAL(
                        SELECT HH.GLBL_CMPY_CD
                             , HH.SVC_MACH_MSTR_PK
                             , HH.CUR_LOC_ACCT_NUM
                             , HH.CUR_LOC_NUM
                             , ROW_NUMBER() OVER (
                                 PARTITION BY HH.SVC_MACH_MSTR_PK
                                 ORDER BY HH.SVC_MACH_MSTR_PK
                                        , HH.HIST_CRAT_TS DESC
                             ) RANK_NUM
                        FROM SVC_MACH_MSTR_HIST H
                           , CUST_INFO CI
                           , SVC_MACH_MSTR_HIST HH
                        WHERE H.GLBL_CMPY_CD = #glblCmpyCd#
                          AND H.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#)
                          AND H.EZCANCELFLAG = '0'
                          AND H.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD
                          AND H.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
                          AND H.GLBL_CMPY_CD = HH.GLBL_CMPY_CD
                          AND H.SVC_MACH_MSTR_PK = HH.SVC_MACH_MSTR_PK
                          AND HH.EZCANCELFLAG = '0'
                     ) LH
                     WHERE LH.RANK_NUM= 1
                    ) SMM
                   ,CUST_INFO CI
                WHERE DCD.GLBL_CMPY_CD = #glblCmpyCd#
                AND DCD.EZCANCELFLAG = '0'
                AND DCD.GLBL_CMPY_CD = DCR.GLBL_CMPY_CD
                AND DCD.DS_CONTR_PK  = DCR.DS_CONTR_PK
                AND DCR.EZCANCELFLAG = '0'
                AND DCD.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
                AND DCD.DS_CONTR_PK  = DCSV.DS_CONTR_PK
                AND DCSV.EZCANCELFLAG = '0'
                AND DCSV.ETTL_AVAL_FLG = #flgN#
                AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
                AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
                AND DCBS.EZCANCELFLAG = '0'
                AND DCBS.INV_FLG = #flgN#
                <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
                AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
                <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
                AND DCD.GLBL_CMPY_CD = SMM.GLBL_CMPY_CD
                AND DCD.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
                AND SMM.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD 
                AND SMM.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
                <!-- 2021/05/20 QC#58743 Add End -->
            </isNotNull>
        ) MAIN
        ORDER BY
            SORT_NUM
    ) MAIN
    WHERE
        ROWNUM &lt;= #limitRownum#
    </statement>
<!-- 2020/07/22 QC#57316 Add End -->

    <!-- 2023/01/13 QC#60860 Add Start -->
    <statement id="getVndCd" parameterClass="Map" resultClass="String">
       SELECT
           A.CARR_CD
       FROM
           OTBD_CARR_V A
       WHERE
               A.GLBL_CMPY_CD      = #glblCmpyCd#
           AND A.EZCANCELFLAG      = '0'
           AND A.CARR_NM           = #vndNm#
    </statement>
    <!-- 2023/01/13 QC#60860 Add End -->
    <!-- add start 2023/07/18 QC#61421 -->
    <statement id="getDsBizArea" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_BIZ_AREA_CD
            ,A.DS_BIZ_AREA_NM
        FROM
            DS_BIZ_AREA A
        WHERE
                A.GLBL_CMPY_CD    = #glblCmpyCd#
            AND A.EZCANCELFLAG    = '0'
            <isNotNull property="spclInstnFlg">
            AND A.SPCL_INSTN_FLG  = #spclInstnFlg#
            </isNotNull>
        ORDER BY
            A.DS_BIZ_AREA_SORT_NUM
    </statement>
    <!-- add end 2023/07/18 QC#61421 -->
</sqlMap>
