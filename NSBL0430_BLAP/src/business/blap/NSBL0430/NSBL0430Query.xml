<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSBL0430Query">
    <typeAlias alias="NSBL0430_ASMsg" type="business.blap.NSBL0430.NSBL0430_ASMsg"/>
    <statement id="getSearchData" parameterClass="Map" resultMap="result.getSearchData">
        SELECT
             SVC_MOD_SER_RNG_PK         AS SVC_MOD_SER_RNG_PK
            ,SVC_MOD_DTL_PK             AS SVC_MOD_DTL_PK
            ,MDSE_CD                    AS MDSE_CD
            ,SVC_MOD_FROM_SER_NUM       AS SVC_MOD_FROM_SER_NUM
            ,SVC_MOD_TO_SER_NUM         AS SVC_MOD_TO_SER_NUM
            ,AUTO_CRAT_CALL_FLG         AS AUTO_CRAT_CALL_FLG
            ,AUTO_CRAT_RFRS_TMG_CD      AS AUTO_CRAT_RFRS_TMG_CD
            ,SVC_MOD_CANC_DT            AS SVC_MOD_CANC_DT
            ,SVC_MOD_OBSL_DT            AS SVC_MOD_OBSL_DT
            ,SVC_MOD_AUTO_CRAT_MND_FLG  AS SVC_MOD_AUTO_CRAT_MND_FLG
            ,EZUPTIME                   AS EZUPTIME
            ,EZUPTIMEZONE               AS EZUPTIMEZONE
            <!-- START 2016/12/05 K.Kojima [QC#14204, ADD] -->
            ,XX_REC_HIST_CRAT_TS_A
            ,XX_REC_HIST_CRAT_BY_NM_A
            ,XX_REC_HIST_UPD_TS_A
            ,XX_REC_HIST_UPD_BY_NM_A
            ,XX_REC_HIST_TBL_NM_A
            <!-- END 2016/12/05 K.Kojima [QC#14204, ADD] -->
        FROM (
            SELECT
                SMR.SVC_MOD_SER_RNG_PK         AS SVC_MOD_SER_RNG_PK
               ,SMR.SVC_MOD_DTL_PK             AS SVC_MOD_DTL_PK
               ,SMR.MDSE_CD                    AS MDSE_CD
               ,SMR.SVC_MOD_FROM_SER_NUM       AS SVC_MOD_FROM_SER_NUM
               ,SMR.SVC_MOD_TO_SER_NUM         AS SVC_MOD_TO_SER_NUM
               ,SMR.AUTO_CRAT_CALL_FLG         AS AUTO_CRAT_CALL_FLG
               ,SMR.AUTO_CRAT_RFRS_TMG_CD      AS AUTO_CRAT_RFRS_TMG_CD
               ,SMD.SVC_MOD_CANC_DT            AS SVC_MOD_CANC_DT
               ,SMD.SVC_MOD_OBSL_DT            AS SVC_MOD_OBSL_DT
               ,SMP.SVC_MOD_AUTO_CRAT_MND_FLG  AS SVC_MOD_AUTO_CRAT_MND_FLG
               ,SMR.EZUPTIME                   AS EZUPTIME
               ,SMR.EZUPTIMEZONE               AS EZUPTIMEZONE
               ,SMR.LG_SER_NUM                 AS LG_SER_NUM
               <!-- START 2016/12/05 K.Kojima [QC#14204, ADD] -->
               ,SMR.EZINTIME                   AS XX_REC_HIST_CRAT_TS_A
               ,SMR.EZINUSERID                 AS XX_REC_HIST_CRAT_BY_NM_A
               ,SMR.EZUPTIME                   AS XX_REC_HIST_UPD_TS_A
               ,SMR.EZUPUSERID                 AS XX_REC_HIST_UPD_BY_NM_A
               ,SMR.EZTABLEID                  AS XX_REC_HIST_TBL_NM_A
               <!-- END 2016/12/05 K.Kojima [QC#14204, ADD] -->
            FROM
                SVC_MOD_SER_RNG SMR
               ,SVC_MOD_DTL SMD
               ,SVC_MOD_PRTY SMP
            WHERE
                    SMR.GLBL_CMPY_CD    = #glblCmpyCd#
                AND SMR.SVC_MOD_PK      = #svcModPk#
                AND SMR.EZCANCELFLAG    = '0'
                AND SMR.GLBL_CMPY_CD    = SMD.GLBL_CMPY_CD(+)
                AND SMR.SVC_MOD_DTL_PK  = SMD.SVC_MOD_DTL_PK(+)
                AND SMD.SVC_MOD_PRTY_CD = SMP.SVC_MOD_PRTY_CD(+)
                AND SMD.GLBL_CMPY_CD    = SMP.GLBL_CMPY_CD(+)
                AND SMD.EZCANCELFLAG(+) = '0'
                AND SMP.EZCANCELFLAG(+) = '0'
                <!-- START 2016/04/26 [QC#3425, ADD] -->
                <isNotNull property="mdseCd">
                AND SMD.MDSE_CD &gt;= #mdseCd#
                </isNotNull>
                <!-- END 2016/04/26 [QC#3425, ADD] -->
            ORDER BY
                SMR.MDSE_CD              ASC
               ,SMR.LG_SER_NUM           ASC
               ,SMR.SVC_MOD_FROM_SER_NUM ASC)
        WHERE
            ROWNUM &lt;= #limitCnt#
    </statement>
    <resultMap id="result.getSearchData" class="NSBL0430_ASMsg">
        <result property="svcModSerRngPk_A"       column="SVC_MOD_SER_RNG_PK"        javaType="EZDSBigDecimalItem" />
        <result property="svcModDtlPk_A"          column="SVC_MOD_DTL_PK"            javaType="EZDSBigDecimalItem" />
        <result property="mdseCd_A"               column="MDSE_CD"                   javaType="EZDCStringItem" />
        <result property="svcModFromSerNum_A"     column="SVC_MOD_FROM_SER_NUM"      javaType="EZDCStringItem" />
        <result property="svcModToSerNum_A"       column="SVC_MOD_TO_SER_NUM"        javaType="EZDCStringItem" />
        <result property="autoCratCallFlg_A"      column="AUTO_CRAT_CALL_FLG"        javaType="EZDCStringItem" />
        <result property="autoCratRfrsTmgCd_A"    column="AUTO_CRAT_RFRS_TMG_CD"     javaType="EZDSStringItem" />
        <result property="svcModCancDt_A"         column="SVC_MOD_CANC_DT"           javaType="EZDSDateItem" />
        <result property="svcModObslDt_A"         column="SVC_MOD_OBSL_DT"           javaType="EZDSDateItem" />
        <result property="svcModAutoCratMndFlg_A" column="SVC_MOD_AUTO_CRAT_MND_FLG" javaType="EZDSStringItem" />
        <result property="ezUpTime_A"             column="EZUPTIME"                  javaType="EZDSStringItem" />
        <result property="ezUpTimeZone_A"         column="EZUPTIMEZONE"              javaType="EZDSStringItem" />
        <!-- START 2016/12/05 K.Kojima [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_A"      column="XX_REC_HIST_CRAT_TS_A"     javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_A"    column="XX_REC_HIST_CRAT_BY_NM_A"  javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_A"       column="XX_REC_HIST_UPD_TS_A"      javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_A"     column="XX_REC_HIST_UPD_BY_NM_A"   javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_A"       column="XX_REC_HIST_TBL_NM_A"      javaType="EZDSStringItem"/>
        <!-- END 2016/12/05 K.Kojima [QC#14204, ADD] -->
    </resultMap>

    <statement id="getDetailData" parameterClass="Map" resultClass="Map">
        SELECT
            SMD.SVC_MOD_DTL_PK            AS SVC_MOD_DTL_PK
           ,SMP.SVC_MOD_AUTO_CRAT_MND_FLG AS SVC_MOD_AUTO_CRAT_MND_FLG
        FROM
            SVC_MOD_DTL  SMD
           ,SVC_MOD_PRTY SMP
        WHERE
                SMD.GLBL_CMPY_CD      = #glblCmpyCd#
            AND SMD.SVC_MOD_PK        = #svcModPk#
            AND SMD.MDSE_CD           = #mdseCd#
            AND (( SMD.SVC_MOD_CANC_DT IS NULL 
               AND SMD.SVC_MOD_OBSL_DT IS NULL)
                OR SMD.SVC_MOD_CANC_DT &gt; #slsDt#
                OR SMD.SVC_MOD_OBSL_DT &gt; #slsDt#)
            AND SMD.EZCANCELFLAG      = '0'
            AND SMD.GLBL_CMPY_CD      = SMP.GLBL_CMPY_CD(+)
            AND SMD.SVC_MOD_PRTY_CD   = SMP.SVC_MOD_PRTY_CD(+)
            AND SMD.EZCANCELFLAG      = SMP.EZCANCELFLAG(+)
        <isNotNull property="mdseCd_8">
        UNION ALL
        SELECT
            SMD.SVC_MOD_DTL_PK            AS SVC_MOD_DTL_PK
           ,SMP.SVC_MOD_AUTO_CRAT_MND_FLG AS SVC_MOD_AUTO_CRAT_MND_FLG
        FROM
            SVC_MOD_DTL  SMD
           ,SVC_MOD_PRTY SMP
        WHERE
                SMD.GLBL_CMPY_CD      = #glblCmpyCd#
            AND SMD.SVC_MOD_PK        = #svcModPk#
            AND SMD.MDSE_CD           = #mdseCd_8#
            AND (( SMD.SVC_MOD_CANC_DT IS NULL 
               AND SMD.SVC_MOD_OBSL_DT IS NULL)
                OR SMD.SVC_MOD_CANC_DT &gt; #slsDt#
                OR SMD.SVC_MOD_OBSL_DT &gt; #slsDt#)
            AND SMD.EZCANCELFLAG      = '0'
            AND SMD.GLBL_CMPY_CD      = SMP.GLBL_CMPY_CD(+)
            AND SMD.SVC_MOD_PRTY_CD   = SMP.SVC_MOD_PRTY_CD(+)
            AND SMD.EZCANCELFLAG      = SMP.EZCANCELFLAG(+)
        </isNotNull>
    </statement>

    <statement id="getCallData" parameterClass="Map" resultClass="Map">
        SELECT
            SMR.SVC_MOD_SER_RNG_PK   AS SVC_MOD_SER_RNG_PK
           ,SMR.SVC_MOD_FROM_SER_NUM AS SVC_MOD_FROM_SER_NUM
           ,SMR.SVC_MOD_TO_SER_NUM   AS SVC_MOD_TO_SER_NUM
           ,SMR.LG_SER_NUM           AS LG_SER_NUM
           ,SM2.SER_NUM              AS SER_NUM
        FROM
            SVC_MOD_SER_RNG  SMR
           ,(SELECT
                SMS.GLBL_CMPY_CD     AS GLBL_CMPY_CD
               ,SMS.SVC_MOD_DTL_PK   AS SVC_MOD_DTL_PK
               ,SMM.SVC_MACH_MSTR_PK AS SVC_MACH_MSTR_PK
               ,SMM.SER_NUM          AS SER_NUM
               ,LENGTH(SMM.SER_NUM)  AS SER_NUM_LEN
             FROM
                SVC_MOD_STS     SMS
               ,SVC_MACH_MSTR   SMM
             WHERE
                    SMS.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
                AND SMS.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                AND SMS.EZCANCELFLAG     = SMM.EZCANCELFLAG
                AND SMS.EZCANCELFLAG     = '0') SM2
        WHERE
                SMR.GLBL_CMPY_CD       = #glblCmpyCd#
            AND SMR.SVC_MOD_SER_RNG_PK = #svcModSerRngPk#
            AND SMR.EZCANCELFLAG       = '0'
            AND SMR.GLBL_CMPY_CD       = SM2.GLBL_CMPY_CD
            AND SMR.SVC_MOD_DTL_PK     = SM2.SVC_MOD_DTL_PK
            AND SMR.LG_SER_NUM         = SM2.SER_NUM_LEN
    </statement>
    <statement id="getDefaultData" parameterClass="Map" resultMap="result.getDefaultData">
        SELECT
             SVC_MOD_DTL_PK             AS SVC_MOD_DTL_PK
            ,MDSE_CD                    AS MDSE_CD
            ,SVC_MOD_CANC_DT            AS SVC_MOD_CANC_DT
            ,SVC_MOD_OBSL_DT            AS SVC_MOD_OBSL_DT
            ,SVC_MOD_AUTO_CRAT_MND_FLG  AS SVC_MOD_AUTO_CRAT_MND_FLG
        FROM (
            SELECT
                SMD.SVC_MOD_DTL_PK             AS SVC_MOD_DTL_PK
               ,SMD.MDSE_CD                    AS MDSE_CD
               ,SMD.SVC_MOD_CANC_DT            AS SVC_MOD_CANC_DT
               ,SMD.SVC_MOD_OBSL_DT            AS SVC_MOD_OBSL_DT
               ,SMP.SVC_MOD_AUTO_CRAT_MND_FLG  AS SVC_MOD_AUTO_CRAT_MND_FLG
            FROM
                SVC_MOD_DTL SMD
               ,SVC_MOD_PRTY SMP
            WHERE
                    SMD.GLBL_CMPY_CD    = #glblCmpyCd#
                AND SMD.SVC_MOD_PK      = #svcModPk#
                AND (( SMD.SVC_MOD_CANC_DT IS NULL 
                   AND SMD.SVC_MOD_OBSL_DT IS NULL)
                    OR SMD.SVC_MOD_CANC_DT &gt; #slsDt#
                    OR SMD.SVC_MOD_OBSL_DT &gt; #slsDt#)
                AND SMD.SVC_MOD_PRTY_CD = SMP.SVC_MOD_PRTY_CD(+)
                AND SMD.GLBL_CMPY_CD    = SMP.GLBL_CMPY_CD(+)
                AND SMD.EZCANCELFLAG    = '0'
                AND SMP.EZCANCELFLAG(+) = '0'
            ORDER BY
                SMD.MDSE_CD              ASC)
        WHERE
            ROWNUM &lt;= #limitCnt#
    </statement>
    <resultMap id="result.getDefaultData" class="NSBL0430_ASMsg">
        <result property="svcModDtlPk_A"          column="SVC_MOD_DTL_PK"            javaType="EZDSBigDecimalItem" />
        <result property="mdseCd_A"               column="MDSE_CD"                   javaType="EZDCStringItem" />
        <result property="svcModCancDt_A"         column="SVC_MOD_CANC_DT"           javaType="EZDSDateItem" />
        <result property="svcModObslDt_A"         column="SVC_MOD_OBSL_DT"           javaType="EZDSDateItem" />
        <result property="svcModAutoCratMndFlg_A" column="SVC_MOD_AUTO_CRAT_MND_FLG" javaType="EZDSStringItem" />
    </resultMap>
<!-- START 2017/10/26 U.Kim [QC#21797, ADD] -->
    <statement id="getAutoCratRfrsTmgCd" parameterClass="Map" resultClass="String">
        SELECT
             ACRT.AUTO_CRAT_RFRS_TMG_CD
        FROM
             AUTO_CRAT_RFRS_TMG ACRT
        WHERE
                 ACRT.GLBL_CMPY_CD                 = #glblCmpyCd#
             AND ACRT.AUTO_CRAT_RFRS_TMG_DESC_TXT  = #autoCratRfrsTmgDescTxt#
             AND ACRT.EZCANCELFLAG                 = '0'
    </statement>
<!-- END 2017/10/26 U.Kim [QC#21797, ADD] -->
</sqlMap>
