<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NFCB127001">
    <statement id="getArTrxBalTargetCnt" parameterClass="Map">
     SELECT
               COUNT(*)                            COUNT
     FROM
               AR_TRX_BAL  A
     WHERE
                    A.GLBL_CMPY_CD              =  #GLBL_CMPY_CD#
               AND
               (
                 (  A.GL_DT                 &lt;=  #GL_DT_THRU#
               AND  A.CASH_APP_DT           &gt;=  #GL_DT_FROM#
                 )
                OR  
                 (  A.CASH_APP_DT            &lt;   #GL_DT_FROM#
               AND  A.AR_CASH_APPLY_STS_CD     IN  (#AR_CASH_APPLY_STS_CD_U#,#AR_CASH_APPLY_STS_CD_P#)
                 )
               )
               AND  A.EZCANCELFLAG              =  '0'
	</statement>
	
    <statement id="getArTrxBalSeparate" parameterClass="Map">
     SELECT
               TAB.GLBL_CMPY_CD
              ,TAB.AR_TRX_BAL_PK
              ,TAB.AR_TRX_NUM
              ,TAB.AR_TRX_TP_CD
              ,TAB.ATT_ADJ_NUM
              ,TAB.DEAL_CCY_CD
              ,TAB.DEAL_ORIG_GRS_AMT
              ,TAB.DEAL_APPLY_GRS_AMT
              ,TAB.DEAL_APPLY_CASH_DISC_AMT
              ,TAB.DEAL_APPLY_CR_AMT
              ,TAB.DEAL_APPLY_ADJ_AMT
              ,TAB.DEAL_APPLY_ADJ_RSVD_AMT
              ,TAB.DEAL_RMNG_BAL_GRS_AMT
              ,TAB.DEAL_NET_SLS_AMT
              ,TAB.DEAL_FRT_AMT
              ,TAB.DEAL_TAX_AMT
              ,TAB.DEAL_INV_DISC_AMT
              ,TAB.DEAL_PRMO_DISC_AMT
              ,TAB.DEAL_RCPT_VOID_AMT
              ,TAB.EXCH_RATE
              ,TAB.FUNC_CCY_CD
              ,TAB.FUNC_ORIG_GRS_AMT
              ,TAB.FUNC_APPLY_GRS_AMT
              ,TAB.FUNC_APPLY_CASH_DISC_AMT
              ,TAB.FUNC_APPLY_CR_AMT
              ,TAB.FUNC_APPLY_ADJ_AMT
              ,TAB.FUNC_APPLY_ADJ_RSVD_AMT
              ,TAB.FUNC_RVAL_VAR_AMT
              ,TAB.FUNC_RMNG_BAL_GRS_AMT
              ,TAB.FUNC_NET_SLS_AMT
              ,TAB.FUNC_FRT_AMT
              ,TAB.FUNC_TAX_AMT
              ,TAB.FUNC_INV_DISC_AMT
              ,TAB.FUNC_PRMO_DISC_AMT
              ,TAB.FUNC_RCPT_VOID_AMT
              ,TAB.PMT_TERM_CASH_DISC_CD
              ,TAB.PMT_TERM_CD
              ,TAB.CASH_DISC_TERM_CD
              ,TAB.CASH_DISC_PCT
              ,TAB.INV_PMT_METH_CD
              ,TAB.INV_PMT_COND_CD
              ,TAB.AR_CASH_APPLY_STS_CD
              ,TAB.AR_TRX_DT
              ,TAB.INV_DUE_DT
              ,TAB.GL_DT
              ,TAB.CASH_APP_DT
              ,TAB.BILL_TO_CUST_CD
              ,TAB.SELL_TO_CUST_CD
              ,TAB.PAYER_CUST_CD
              ,TAB.TOC_CD
              ,TAB.COA_PROD_CD
              ,TAB.GRP_INV_NUM
              ,TAB.CPO_ORD_NUM
              ,TAB.CUST_ISS_PO_NUM
              ,TAB.AR_CUST_REF_NUM
              ,TAB.EXPT_FLG
              ,TAB.UPPER_CUST_ISS_PO_NUM
              ,TAB.BILL_TO_CUST_ACCT_CD
              ,TAB.SRC_SYS_DOC_NUM
              ,TAB.SYS_SRC_CD
              ,TAB.ORIG_INV_NUM
              ,TAB.SVC_INV_PK
              ,TAB.DS_INV_TP_CD
              ,TAB.SLS_REP_TOC_CD
              ,TAB.CUST_CARE_TKT_NUM
              ,TAB.AR_AUTO_PURGE_OFS_FLG
              ,TAB.CR_REBIL_RSN_CATG_CD
              ,TAB.AR_TRX_BILL_FROM_DT
              ,TAB.AR_TRX_BILL_THRU_DT
              ,TAB.NUM
     FROM
         (
         SELECT
                   A.GLBL_CMPY_CD
                  ,A.AR_TRX_BAL_PK
                  ,A.AR_TRX_NUM
                  ,A.AR_TRX_TP_CD
                  ,A.ATT_ADJ_NUM
                  ,A.DEAL_CCY_CD
                  ,A.DEAL_ORIG_GRS_AMT
                  ,A.DEAL_APPLY_GRS_AMT
                  ,A.DEAL_APPLY_CASH_DISC_AMT
                  ,A.DEAL_APPLY_CR_AMT
                  ,A.DEAL_APPLY_ADJ_AMT
                  ,A.DEAL_APPLY_ADJ_RSVD_AMT
                  ,A.DEAL_RMNG_BAL_GRS_AMT
                  ,A.DEAL_NET_SLS_AMT
                  ,A.DEAL_FRT_AMT
                  ,A.DEAL_TAX_AMT
                  ,A.DEAL_INV_DISC_AMT
                  ,A.DEAL_PRMO_DISC_AMT
                  ,A.DEAL_RCPT_VOID_AMT
                  ,A.EXCH_RATE
                  ,A.FUNC_CCY_CD
                  ,A.FUNC_ORIG_GRS_AMT
                  ,A.FUNC_APPLY_GRS_AMT
                  ,A.FUNC_APPLY_CASH_DISC_AMT
                  ,A.FUNC_APPLY_CR_AMT
                  ,A.FUNC_APPLY_ADJ_AMT
                  ,A.FUNC_APPLY_ADJ_RSVD_AMT
                  ,A.FUNC_RVAL_VAR_AMT
                  ,A.FUNC_RMNG_BAL_GRS_AMT
                  ,A.FUNC_NET_SLS_AMT
                  ,A.FUNC_FRT_AMT
                  ,A.FUNC_TAX_AMT
                  ,A.FUNC_INV_DISC_AMT
                  ,A.FUNC_PRMO_DISC_AMT
                  ,A.FUNC_RCPT_VOID_AMT
                  ,A.PMT_TERM_CASH_DISC_CD
                  ,A.PMT_TERM_CD
                  ,A.CASH_DISC_TERM_CD
                  ,A.CASH_DISC_PCT
                  ,A.INV_PMT_METH_CD
                  ,A.INV_PMT_COND_CD
                  ,A.AR_CASH_APPLY_STS_CD
                  ,A.AR_TRX_DT
                  ,A.INV_DUE_DT
                  ,A.GL_DT
                  ,A.CASH_APP_DT
                  ,A.BILL_TO_CUST_CD
                  ,A.SELL_TO_CUST_CD
                  ,A.PAYER_CUST_CD
                  ,A.TOC_CD
                  ,A.COA_PROD_CD
                  ,A.GRP_INV_NUM
                  ,A.CPO_ORD_NUM
                  ,A.CUST_ISS_PO_NUM
                  ,A.AR_CUST_REF_NUM
                  ,A.EXPT_FLG
                  ,A.UPPER_CUST_ISS_PO_NUM
                  ,A.BILL_TO_CUST_ACCT_CD
                  ,A.SRC_SYS_DOC_NUM
                  ,A.SYS_SRC_CD
                  ,A.ORIG_INV_NUM
                  ,A.SVC_INV_PK
                  ,A.DS_INV_TP_CD
                  ,A.SLS_REP_TOC_CD
                  ,A.CUST_CARE_TKT_NUM
                  ,A.AR_AUTO_PURGE_OFS_FLG
                  ,A.CR_REBIL_RSN_CATG_CD
                  ,A.AR_TRX_BILL_FROM_DT
                  ,A.AR_TRX_BILL_THRU_DT
                  <!-- 2023/03/20 #1011603 D.Morimoto mod start -->
                  ,ROW_NUMBER() OVER (ORDER BY A.AR_TRX_BAL_PK) NUM
                  <!-- 2023/03/20 #1011603 D.Morimoto mod end   -->
         FROM
                   AR_TRX_BAL  A
         WHERE
                        A.GLBL_CMPY_CD              =  #GLBL_CMPY_CD#
                   AND
                   (
                     (  A.GL_DT                 &lt;=  #GL_DT_THRU#
                   AND  A.CASH_APP_DT           &gt;=  #GL_DT_FROM#
                     )
                    OR  
                     (  A.CASH_APP_DT            &lt;   #GL_DT_FROM#
                   AND  A.AR_CASH_APPLY_STS_CD     IN  (#AR_CASH_APPLY_STS_CD_U#,#AR_CASH_APPLY_STS_CD_P#)
                     )
                   )
                   AND  A.EZCANCELFLAG              =  '0'
         ORDER BY
                   A.AR_TRX_BAL_PK
         ) TAB
     WHERE
                    TAB.NUM                  &gt;=  #START_NUM#
               AND  TAB.NUM                  &lt;=  #END_NUM#
     ORDER BY
                    TAB.NUM
    </statement>


    <statement id="getArCashAppByPayment" parameterClass="Map">
     SELECT
               A.AR_APPLY_TP_CD
              ,A.DEAL_APPLY_AMT
              ,A.FUNC_APPLY_AMT
              ,A.RCPT_NUM
              ,A.AR_ADJ_NUM
              ,A.AR_TRX_NUM
              ,A.AR_CR_TRX_NUM
              ,B.AR_ADJ_TRX_TP_CD
              ,B.AR_ADJ_TP_CD
     FROM
               AR_CASH_APP  A  LEFT  JOIN  AR_ADJ  B
               ON      A.GLBL_CMPY_CD  =  B.GLBL_CMPY_CD
                  AND  A.AR_ADJ_NUM    =  B.AR_ADJ_NUM
                  AND  B.EZCANCELFLAG  =  '0'
     WHERE
                    A.GLBL_CMPY_CD    =  #GLBL_CMPY_CD#
               AND  A.GL_DT        &gt;  #GL_DT_THRU#
               AND  A.RCPT_NUM        =  #AR_TRX_NUM#
               AND  A.AR_APPLY_TP_CD IN  (#AR_APPLY_TP_CD_CSH#,#AR_APPLY_TP_CD_RFD#,#AR_APPLY_TP_CD_ADJ#)
               AND  A.EZCANCELFLAG    =  '0'
    </statement>

    <statement id="getArCashAppByCreditMemo" parameterClass="Map">
     SELECT
               SUM(A.DEAL_APPLY_AMT)   DEAL_APPLY_AMT
              ,SUM(A.FUNC_APPLY_AMT)   FUNC_APPLY_AMT
              ,A.AR_APPLY_TP_CD
     FROM
               AR_CASH_APP  A
     WHERE
                    A.GLBL_CMPY_CD     =  #GLBL_CMPY_CD#
               AND  A.GL_DT         &gt;  #GL_DT_THRU#
               AND  A.AR_CR_TRX_NUM    =  #AR_CR_TRX_NUM#
               AND  A.AR_APPLY_TP_CD  IN (#AR_APPLY_TP_CD_CRM#)
               AND  A.EZCANCELFLAG     =  '0'
     GROUP BY  
               A.AR_APPLY_TP_CD
    </statement>

    <statement id="getArCashAppByOthers" parameterClass="Map">
     SELECT
               A.AR_APPLY_TP_CD
              ,A.DEAL_APPLY_AMT
              ,A.FUNC_APPLY_AMT
              ,A.DEAL_APPLY_CASH_DISC_AMT
              ,A.FUNC_APPLY_CASH_DISC_AMT
     FROM
               AR_CASH_APP  A
     WHERE
                    A.GLBL_CMPY_CD     =  #GLBL_CMPY_CD#
               AND  A.GL_DT         &gt;  #GL_DT_THRU#
               AND  A.AR_TRX_NUM       =  #AR_TRX_NUM#
               AND  A.AR_APPLY_TP_CD  IN (#AR_APPLY_TP_CD_CRM#,#AR_APPLY_TP_CD_CSH#,#AR_APPLY_TP_CD_ADJ#)
               AND  A.EZCANCELFLAG     =  '0'
    </statement>

    <statement id="getArCashAppByDeduction" parameterClass="Map">
     SELECT
               A.AR_APPLY_TP_CD
              ,A.DEAL_APPLY_AMT
              ,A.FUNC_APPLY_AMT
     FROM
               AR_CASH_APP  A
     WHERE
                    A.GLBL_CMPY_CD     =  #GLBL_CMPY_CD#
               AND  A.GL_DT         &gt;  #GL_DT_THRU#
               AND  A.SET_AR_ADJ_NUM      =  #SET_AR_ADJ_NUM#
               AND  A.AR_APPLY_TP_CD   =  #AR_APPLY_TP_CD_ADJ#
               AND  A.EZCANCELFLAG     =  '0'
    </statement>

    <statement id="getArRcpt" parameterClass="Map">
     SELECT
               COUNT(A.GLBL_CMPY_CD)   COUNT_NUM
     FROM
               AR_RCPT  A
     WHERE
                    A.GLBL_CMPY_CD     =  #GLBL_CMPY_CD#
               AND  A.VOID_GL_DT    &gt;  #GL_DT_THRU#
               AND  A.RCPT_NUM         =  #AR_TRX_NUM#
               AND  A.EZCANCELFLAG     =  '0'
    </statement>

</sqlMap>
