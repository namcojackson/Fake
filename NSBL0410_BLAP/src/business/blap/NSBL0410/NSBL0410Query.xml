<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSBL0410Query">
    <typeAlias alias="NSBL0410_ASMsg" type="business.blap.NSBL0410.NSBL0410_ASMsg"/>

    <statement id="getDtlInfo" parameterClass="Map" resultMap="result.getDtlInfo">
        SELECT
                 SVC_MOD_PLN_ID              AS SVC_MOD_PLN_ID
                ,SVC_MOD_NM                  AS SVC_MOD_NM
                ,SVC_MOD_CMNT_TXT            AS SVC_MOD_CMNT_TXT
                ,EST_SVC_LBOR_HOUR_MN        AS EST_SVC_LBOR_HOUR_MN
                ,EZUPTIME                    AS EZUPTIME
                ,EZUPTIMEZONE                AS EZUPTIMEZONE
                ,SVC_MOD_PK                  AS SVC_MOD_PK
                ,SVC_MNF_CD                  AS SVC_MNF_CD
                ,SVC_MNF_MOD_NUM             AS SVC_MNF_MOD_NUM
                ,SVC_MOD_DOC_NUM             AS SVC_MOD_DOC_NUM
                ,MDSE_CD                     AS MDSE_CD
                ,SVC_MOD_PRTY_CD             AS SVC_MOD_PRTY_CD
                ,SVC_MOD_RPT_TRK_FLG         AS SVC_MOD_RPT_TRK_FLG
                ,SVC_MOD_ISS_DT              AS SVC_MOD_ISS_DT
                ,SVC_MOD_START_DT            AS SVC_MOD_START_DT
                ,SVC_MOD_ON_HLD_DT           AS SVC_MOD_ON_HLD_DT
                ,SVC_MOD_CANC_DT             AS SVC_MOD_CANC_DT
                ,SVC_MOD_OBSL_DT             AS SVC_MOD_OBSL_DT
                ,SVC_MOD_OBSL_NUM            AS SVC_MOD_OBSL_NUM
                ,EZUPTIME_DTL                AS EZUPTIME_DTL
                ,EZUPTIMEZONE_DTL            AS EZUPTIMEZONE_DTL
                ,SVC_MOD_DTL_PK              AS SVC_MOD_DTL_PK
                ,KIT_PARTS                   AS KIT_PARTS
                ,SVC_MOD_DTL_PK              AS SVC_MOD_DTL_PK_ITEM
                ,ITEM_CNT                    AS ITEM_CNT
                <!-- START 2016/12/05 K.Kojima [QC#14204, ADD] -->
                ,XX_REC_HIST_CRAT_TS_A
                ,XX_REC_HIST_CRAT_BY_NM_A
                ,XX_REC_HIST_UPD_TS_A
                ,XX_REC_HIST_UPD_BY_NM_A
                ,XX_REC_HIST_TBL_NM_A
                <!-- END 2016/12/05 K.Kojima [QC#14204, ADD] -->
        FROM (
                SELECT
                         SM.SVC_MOD_PLN_ID              AS SVC_MOD_PLN_ID
                        ,SM.SVC_MOD_NM                  AS SVC_MOD_NM
                        ,SM.SVC_MOD_CMNT_TXT            AS SVC_MOD_CMNT_TXT
                        ,SM.EST_SVC_LBOR_HOUR_MN        AS EST_SVC_LBOR_HOUR_MN
                        ,SM.EZUPTIME                    AS EZUPTIME
                        ,SM.EZUPTIMEZONE                AS EZUPTIMEZONE
                        ,SM.SVC_MOD_PK                  AS SVC_MOD_PK
                        ,SMD.SVC_MNF_CD                 AS SVC_MNF_CD
                        ,SMD.SVC_MNF_MOD_NUM            AS SVC_MNF_MOD_NUM
                        ,SMD.SVC_MOD_DOC_NUM            AS SVC_MOD_DOC_NUM
                        ,SMD.MDSE_CD                    AS MDSE_CD
                        ,SMD.SVC_MOD_PRTY_CD            AS SVC_MOD_PRTY_CD
                        ,SMD.SVC_MOD_RPT_TRK_FLG        AS SVC_MOD_RPT_TRK_FLG
                        ,SMD.SVC_MOD_ISS_DT             AS SVC_MOD_ISS_DT
                        ,SMD.SVC_MOD_START_DT           AS SVC_MOD_START_DT
                        ,SMD.SVC_MOD_ON_HLD_DT          AS SVC_MOD_ON_HLD_DT
                        ,SMD.SVC_MOD_CANC_DT            AS SVC_MOD_CANC_DT
                        ,SMD.SVC_MOD_OBSL_DT            AS SVC_MOD_OBSL_DT
                        ,SMD.SVC_MOD_OBSL_NUM           AS SVC_MOD_OBSL_NUM
                        ,SMD.EZUPTIME                   AS EZUPTIME_DTL
                        ,SMD.EZUPTIMEZONE               AS EZUPTIMEZONE_DTL
                        ,SMD.SVC_MOD_DTL_PK             AS SVC_MOD_DTL_PK
                        ,SMDI_S.KIT_PARTS               AS KIT_PARTS
                        ,SMDI_S.SVC_MOD_DTL_PK          AS SVC_MOD_DTL_PK_ITEM
                        ,SMDI_S.ITEM_CNT                AS ITEM_CNT
                        <!-- START 2016/12/05 K.Kojima [QC#14204, ADD] -->
                        ,SMD.EZINTIME                   AS XX_REC_HIST_CRAT_TS_A
                        ,SMD.EZINUSERID                 AS XX_REC_HIST_CRAT_BY_NM_A
                        ,SMD.EZUPTIME                   AS XX_REC_HIST_UPD_TS_A
                        ,SMD.EZUPUSERID                 AS XX_REC_HIST_UPD_BY_NM_A
                        ,SMD.EZTABLEID                  AS XX_REC_HIST_TBL_NM_A
                        <!-- END 2016/12/05 K.Kojima [QC#14204, ADD] -->
                FROM
                         SVC_MOD          SM
                        ,SVC_MOD_DTL      SMD
                        ,(
                        SELECT
                                MAX(SMDI.MDSE_CD)              AS KIT_PARTS
                                ,SMDI.SVC_MOD_DTL_PK
                                ,SMDI.GLBL_CMPY_CD
                                ,SMDI.EZCANCELFLAG
                                ,CASE
                                    WHEN COUNT(*) &gt; 1 THEN ' + '
                                    ELSE              '   '
                                END AS ITEM_CNT
                        FROM
                                 SVC_MOD SM
                                ,SVC_MOD_DTL SMD
                                ,SVC_MOD_DTL_ITEM SMDI
                        WHERE 
                                    SM.SVC_MOD_PK = #svcModPk#
                                AND SM.EZCANCELFLAG = '0'
                                AND SM.GLBL_CMPY_CD = #glblCmpyCd#
                                AND SM.SVC_MOD_PK = SMD.SVC_MOD_PK(+)
                                AND SM.GLBL_CMPY_CD = SMD.GLBL_CMPY_CD(+)
                                AND SMD.EZCANCELFLAG(+) = '0'
                                AND SMD.SVC_MOD_DTL_PK = SMDI.SVC_MOD_DTL_PK(+)
                                AND SMD.GLBL_CMPY_CD = SMDI.GLBL_CMPY_CD(+)
                                AND SMDI.EZCANCELFLAG(+) = '0'
                                <!-- START 2016/04/26 [QC#3425, ADD] -->
                                <isNotNull property="mdseCd">
                                AND SMD.MDSE_CD &gt;= #mdseCd#
                                </isNotNull>
                                <!-- END 2016/04/26 [QC#3425, ADD] -->
                       GROUP BY
                                SMDI.SVC_MOD_DTL_PK
                               ,SMDI.GLBL_CMPY_CD
                               ,SMDI.EZCANCELFLAG
                       ) SMDI_S
                WHERE 
                        SM.SVC_MOD_PK        = #svcModPk#
                    AND SM.EZCANCELFLAG      = '0'
                    AND SM.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND SM.SVC_MOD_PK        = SMD.SVC_MOD_PK(+)
                    AND SM.GLBL_CMPY_CD      = SMD.GLBL_CMPY_CD(+)
                    AND SMD.EZCANCELFLAG(+)  = '0'
                    AND SMD.SVC_MOD_DTL_PK   = SMDI_S.SVC_MOD_DTL_PK(+)
                    AND SMD.GLBL_CMPY_CD     = SMDI_S.GLBL_CMPY_CD(+)
                    AND SMDI_S.EZCANCELFLAG(+) = '0'
                    <!-- START 2016/04/26 [QC#3425, ADD] -->
                    <isNotNull property="mdseCd">
                    AND SMD.MDSE_CD &gt;= #mdseCd#
                    </isNotNull>
                    <!-- END 2016/04/26 [QC#3425, ADD] -->
                ORDER BY
                    SMD.MDSE_CD ASC)
        WHERE
            ROWNUM &lt;= #limitCnt#
        ORDER BY
            MDSE_CD ASC
    </statement>
    <resultMap id="result.getDtlInfo" class="NSBL0410_ASMsg">
        <result property="svcMnfCd_A"              column="SVC_MNF_CD"            javaType="EZDCStringItem" />
        <result property="svcMnfModNum_A"          column="SVC_MNF_MOD_NUM"       javaType="EZDCStringItem" />
        <result property="svcModDocNum_A"          column="SVC_MOD_DOC_NUM"       javaType="EZDCStringItem" />
        <result property="xxMdseCdAncr_A"          column="KIT_PARTS"             javaType="EZDCStringItem" />
        <result property="xxDplyByCtrlItemCd_A"    column="ITEM_CNT"              javaType="EZDCStringItem" />
        <result property="mdseCd_A"                column="MDSE_CD"               javaType="EZDCStringItem" />
        <result property="svcModPrtyDescTxt_A"     column="SVC_MOD_PRTY_CD"       javaType="EZDCStringItem" />
        <result property="svcModRptTrkFlg_A"       column="SVC_MOD_RPT_TRK_FLG"   javaType="EZDCStringItem" />
        <result property="svcModIssDt_A"           column="SVC_MOD_ISS_DT"        javaType="EZDCStringItem" />
        <result property="svcModStartDt_A"         column="SVC_MOD_START_DT"      javaType="EZDCStringItem" />
        <result property="svcModOnHldDt_A"         column="SVC_MOD_ON_HLD_DT"     javaType="EZDCStringItem" />
        <result property="svcModCancDt_A"          column="SVC_MOD_CANC_DT"       javaType="EZDCStringItem" />
        <result property="svcModObslDt_A"          column="SVC_MOD_OBSL_DT"       javaType="EZDCStringItem" />
        <result property="svcModObslNum_A"         column="SVC_MOD_OBSL_NUM"      javaType="EZDCStringItem" />
        <result property="svcModDtlPk_A"           column="SVC_MOD_DTL_PK"        javaType="EZDSBigDecimalItem" />
        <result property="ezUpTime_A"              column="EZUPTIME_DTL"          javaType="EZDCStringItem" />
        <result property="ezUpTimeZone_A"          column="EZUPTIMEZONE_DTL"      javaType="EZDCStringItem" />
        <!-- START 2016/12/05 K.Kojima [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_A"       column="XX_REC_HIST_CRAT_TS_A"    javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_A"     column="XX_REC_HIST_CRAT_BY_NM_A" javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_A"        column="XX_REC_HIST_UPD_TS_A"     javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_A"      column="XX_REC_HIST_UPD_BY_NM_A"  javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_A"        column="XX_REC_HIST_TBL_NM_A"     javaType="EZDSStringItem"/>
        <!-- END 2016/12/05 K.Kojima [QC#14204, ADD] -->
    </resultMap>

    <!-- START 2018/05/31 U.Kim [QC#22393, ADD] -->
    <statement id="getMdseCdForItemTpMktMdl" parameterClass="Map" resultMap="String">
        SELECT
            MDSE_CD
        FROM
            (
                SELECT
                    M.MDSE_CD
                FROM
                    MDSE M
                WHERE
                       M.GLBL_CMPY_CD    = #glblCmpyCd#
                   AND M.EZCANCELFLAG    = '0'
                   <isNotNull property="mdseItemTpCd">
                   AND M.MDSE_ITEM_TP_CD = #mdseItemTpCd#
                   </isNotNull>
                   <isNotNull property="mktMdlCd">
                   AND M.MKT_MDL_CD      = #mktMdlCd#
                   </isNotNull>
                ORDER BY
                    M.MDSE_CD
            )
        WHERE
            ROWNUM &lt;= #limitCnt#
    </statement>
</sqlMap>
    