<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<sqlMap namespace="NSZC054001">
    <statement id="getDsContr" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_PK
            ,A.DS_CONTR_NUM
            ,A.DS_CONTR_CATG_CD
            <!-- START 2019/09/05 [QC#52820, ADD] -->
            ,A.SVC_LINE_BIZ_CD
            <!-- END 2019/09/05 [QC#52820, ADD] -->
        FROM 
            DS_CONTR     A
        WHERE
                A.GLBL_CMPY_CD            = #glblCmpyCd#
            AND A.EZCANCELFLAG            = '0'
            <isNotNull property="dsContrPk">
            AND A.DS_CONTR_PK             = #dsContrPk#
            </isNotNull>
            <isNotNull property="dsContrNum">
            AND A.DS_CONTR_NUM            = #dsContrNum#
            </isNotNull>
            AND A.DS_CONTR_TP_CD          &lt;&gt; #dsContrTpWty#

    </statement>

<!-- mod start 2017/08/15 QC#18799 -->
    <statement id="getBllgSchdReg" parameterClass="Map" resultClass="Map">
        <!-- START 2022/09/20 [QC#60045,ADD] -->
        <!-- START 2023/05/09 K.Kitachi [QC#61469, DEL] -->
<!--        WITH DEF_WIN_DAYS AS ( -->
<!--            SELECT -->
<!--                 A.MTR_READ_WIN_MLY_DAYS_AOT -->
<!--                ,A.MTR_READ_WIN_OTH_DAYS_AOT -->
<!--            FROM -->
<!--                DS_WIN_DAYS A -->
<!--            WHERE -->
<!--                    A.GLBL_CMPY_CD             = #glblCmpyCd# -->
<!--                AND A.EZCANCELFLAG             = '0' -->
<!--                AND A.DS_WIN_DAYS_TRGT_PER_TXT = '*' -->
<!--                AND A.SVC_LINE_BIZ_CD          = '*' -->
<!--            ) -->
        <!-- END 2023/05/09 K.Kitachi [QC#61469, DEL] -->
        <!-- END   2022/09/20 [QC#60045,ADD] -->
        SELECT
             X.DS_CONTR_DTL_PK
            ,X.DS_CONTR_BLLG_SCHD_PK
            ,X.DS_CONTR_BLLG_MTR_PK
            ,X.NEXT_BLLG_DT
            <!-- 2022/12/19 QC#60886 Add Start -->
            ,X.BLLG_SCHD_FROM_DT
            ,X.SVC_LINE_BIZ_CD
            <!-- 2022/12/19 QC#60886 Add End -->
        FROM
            (
             SELECT
             A.DS_CONTR_DTL_PK
            ,B.DS_CONTR_BLLG_SCHD_PK
            ,B.DS_CONTR_BLLG_MTR_PK
            ,B.NEXT_BLLG_DT
            <!-- 2022/12/19 QC#60886 Add Start -->
            ,B.BLLG_SCHD_FROM_DT
            ,C.SVC_LINE_BIZ_CD
            <!-- 2022/12/19 QC#60886 Add End -->
                 ,B.BLLG_SCHD_THRU_DT
                 <!-- START 2022/09/20 [QC#60045,MOD] -->
                 <!-- ,NVL(DECODE(F.BLLG_CYCLE_UOM_CD, #months#, D.MTR_READ_WIN_MLY_DAYS_AOT, D.MTR_READ_WIN_OTH_DAYS_AOT), #defBefDays#) AS BEF_DAYS -->
                 <!-- START 2023/02/09 S.Naya [QC#60045, MOD] -->
                 <!-- ,DECODE(F.BLLG_CYCLE_UOM_CD, #months#, COALESCE(D.MTR_READ_WIN_MLY_DAYS_AOT, (SELECT MTR_READ_WIN_MLY_DAYS_AOT FROM DEF_WIN_DAYS), #defBefDays#), COALESCE(D.MTR_READ_WIN_OTH_DAYS_AOT, (SELECT MTR_READ_WIN_OTH_DAYS_AOT FROM DEF_WIN_DAYS), #defBefDays#)) AS BEF_DAYS -->
                 <!-- START 2023/05/09 K.Kitachi [QC#61469, MOD] -->
                 <!-- ,DECODE(F.BLLG_CYCLE_UOM_CD, #months#, COALESCE(D.MTR_READ_WIN_MLY_DAYS_AOT, D2.MTR_READ_WIN_MLY_DAYS_AOT, (SELECT MTR_READ_WIN_MLY_DAYS_AOT FROM DEF_WIN_DAYS), #defBefDays#), COALESCE(D.MTR_READ_WIN_OTH_DAYS_AOT, D2.MTR_READ_WIN_OTH_DAYS_AOT, (SELECT MTR_READ_WIN_OTH_DAYS_AOT FROM DEF_WIN_DAYS), #defBefDays#)) AS BEF_DAYS -->
                 ,DECODE(F.BLLG_CYCLE_UOM_CD, #months#, COALESCE(D.MTR_READ_WIN_MLY_DAYS_AOT, D2.MTR_READ_WIN_MLY_DAYS_AOT, #mtrReadWinMlyDaysAot#, #defBefDays#), COALESCE(D.MTR_READ_WIN_OTH_DAYS_AOT, D2.MTR_READ_WIN_OTH_DAYS_AOT, #mtrReadWinOthDaysAot#, #defBefDays#)) AS BEF_DAYS
                 <!-- END 2023/05/09 K.Kitachi [QC#61469, MOD] -->
                 <!-- END   2023/02/09 S.Naya [QC#60045, MOD] -->
                 <!-- END   2022/09/20 [QC#60045,MOD] -->
        FROM 
             DS_CONTR_DTL        A
            ,DS_CONTR_BLLG_SCHD  B
                 ,DS_CONTR                 C
                 <!-- START 2022/09/20 [QC#60045,MOD] -->
                 <!-- ,DS_CONTR_INTFC_DEF_RULE  D -->
                 ,DS_WIN_DAYS              D
                 <!-- END   2022/09/20 [QC#60045,MOD] -->
                 <!-- START 2023/02/09 S.Naya [QC#60045, ADD] -->
                 ,DS_WIN_DAYS              D2
                 <!-- END   2023/02/09 S.Naya [QC#60045, ADD] -->
                 ,DS_CONTR_BLLG_MTR        E
                 ,BLLG_CYCLE               F
        WHERE
                A.GLBL_CMPY_CD            = #glblCmpyCd#
            AND A.EZCANCELFLAG            = '0'
            AND A.DS_CONTR_PK             = #dsContrPk#
            AND A.SVC_MACH_MSTR_PK        = #svcMachMstrPk#
            AND A.GLBL_CMPY_CD            = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK         = B.DS_CONTR_DTL_PK
            AND B.EZCANCELFLAG            = '0'
            AND B.USG_CHRG_FLG            = #usgChrgFlgY#
            AND B.MTR_ENTRY_CPLT_FLG      = 'Y'
                 AND A.GLBL_CMPY_CD            = C.GLBL_CMPY_CD
                 AND A.DS_CONTR_PK             = C.DS_CONTR_PK
                 AND C.EZCANCELFLAG            = '0'
                 <!-- START 2022/09/20 [QC#60045,MOD] -->
                 <!-- AND C.GLBL_CMPY_CD            = D.GLBL_CMPY_CD          (+) -->
                 <!-- AND C.DS_CONTR_SRC_TP_CD      = D.CONTR_INTFC_SRC_TP_CD (+) -->
                 <!-- AND C.DS_CONTR_CLS_CD         = D.DS_CONTR_CLS_CD       (+) -->
                 <!-- AND C.SVC_LINE_BIZ_CD         = D.SVC_LINE_BIZ_CD       (+) -->
                 <!-- AND D.EZCANCELFLAG (+)        = '0' -->
                 <!-- AND D.EFF_FROM_DT  (+)        &lt;= #slsDt# -->
                 <!-- AND D.ENBL_FLG     (+)        = 'Y' -->
                 AND B.GLBL_CMPY_CD                       = D.GLBL_CMPY_CD(+)
                 AND D.EZCANCELFLAG(+)                    = '0'
                 AND SUBSTR(B.BLLG_SCHD_THRU_DT, 0, 6)    = D.DS_WIN_DAYS_TRGT_PER_TXT(+)
                 AND C.SVC_LINE_BIZ_CD                    = D.SVC_LINE_BIZ_CD(+)
                 <!-- END   2022/09/20 [QC#60045,MOD] -->
                 <!-- START 2023/02/09 S.Naya [QC#60045, ADD] -->
                 AND B.GLBL_CMPY_CD                       = D2.GLBL_CMPY_CD(+)
                 AND D2.EZCANCELFLAG(+)                   = '0'
                 AND SUBSTR(B.BLLG_SCHD_THRU_DT, 0, 6)    = D2.DS_WIN_DAYS_TRGT_PER_TXT(+)
                 AND D2.SVC_LINE_BIZ_CD(+)                = '*'
                 <!-- END   2023/02/09 S.Naya [QC#60045, ADD] -->
                 AND B.GLBL_CMPY_CD            = E.GLBL_CMPY_CD
                 AND B.DS_CONTR_BLLG_MTR_PK    = E.DS_CONTR_BLLG_MTR_PK
                 AND E.EZCANCELFLAG            = '0'
                 AND E.GLBL_CMPY_CD            = F.GLBL_CMPY_CD
                 AND E.BLLG_MTR_BLLG_CYCLE_CD  = F.BLLG_CYCLE_CD
                 AND F.EZCANCELFLAG            = '0'
            ) X
        WHERE
                X.BLLG_SCHD_THRU_DT   &gt;= #mtrReadDtFrom#
            AND X.BLLG_SCHD_THRU_DT   &lt;= TO_CHAR((TO_DATE(#mtrReadDt#, #dateFormat#) + TO_NUMBER(X.BEF_DAYS)), #dateFormat#) 
        ORDER BY
             X.DS_CONTR_DTL_PK
            ,X.DS_CONTR_BLLG_SCHD_PK
            ,X.DS_CONTR_BLLG_MTR_PK
    </statement>
<!-- mod end 2017/08/15 QC#18799 -->

<!-- mod start 2017/08/15 QC#18799 -->
    <statement id="getBllgSchdFlt" parameterClass="Map" resultClass="Map">
        SELECT
             X.DS_CONTR_DTL_PK
            ,X.DS_CONTR_BLLG_SCHD_PK
            ,X.DS_CONTR_BLLG_MTR_PK
            ,X.NEXT_BLLG_DT
        FROM
            (
             SELECT
             A.DS_CONTR_DTL_PK
            ,B.DS_CONTR_BLLG_SCHD_PK
            ,B.DS_CONTR_BLLG_MTR_PK
            ,B.NEXT_BLLG_DT
                 ,B.BLLG_SCHD_THRU_DT
                 ,NVL(DECODE(F.BLLG_CYCLE_UOM_CD, #months#, D.MTR_READ_WIN_MLY_DAYS_AOT, D.MTR_READ_WIN_OTH_DAYS_AOT), #defBefDays#) AS BEF_DAYS
        FROM 
             DS_CONTR_DTL        A
            ,DS_CONTR_BLLG_SCHD  B
                 ,DS_CONTR                 C
                 ,DS_CONTR_INTFC_DEF_RULE  D
                 ,DS_CONTR_BLLG_MTR        E
                 ,BLLG_CYCLE               F
        WHERE
                A.GLBL_CMPY_CD            = #glblCmpyCd#
            AND A.EZCANCELFLAG            = '0'
            AND A.DS_CONTR_PK             = #dsContrPk#
            AND A.DS_CONTR_DTL_TP_CD      = #dsContrDtlTpFleet#
            AND A.GLBL_CMPY_CD            = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK         = B.DS_CONTR_DTL_PK
            AND B.EZCANCELFLAG            = '0'
            AND B.USG_CHRG_FLG            = #usgChrgFlgY#
            AND EXISTS (
                SELECT
                         1
                FROM
                         DS_CONTR_BLLG_SCHD G
                WHERE
                             G.GLBL_CMPY_CD               = B.GLBL_CMPY_CD
                         AND G.PRNT_DS_CONTR_BLLG_SCHD_PK = B.DS_CONTR_BLLG_SCHD_PK
                         AND G.MTR_ENTRY_CPLT_FLG         = 'Y'
                         AND G.EZCANCELFLAG               = '0'
                 )
                 AND A.GLBL_CMPY_CD            = C.GLBL_CMPY_CD
                 AND A.DS_CONTR_PK             = C.DS_CONTR_PK
                    AND C.EZCANCELFLAG               = '0'
                 AND C.GLBL_CMPY_CD            = D.GLBL_CMPY_CD          (+)
                 AND C.DS_CONTR_SRC_TP_CD      = D.CONTR_INTFC_SRC_TP_CD (+)
                 AND C.DS_CONTR_CLS_CD         = D.DS_CONTR_CLS_CD       (+)
                 AND C.SVC_LINE_BIZ_CD         = D.SVC_LINE_BIZ_CD       (+)
                 AND D.EZCANCELFLAG (+)        = '0'
                 AND D.EFF_FROM_DT  (+)        &lt;= #slsDt#
                 AND D.ENBL_FLG     (+)        = 'Y'
                 AND B.GLBL_CMPY_CD            = E.GLBL_CMPY_CD
                 AND B.DS_CONTR_BLLG_MTR_PK    = E.DS_CONTR_BLLG_MTR_PK
                 AND E.EZCANCELFLAG            = '0'
                 AND E.GLBL_CMPY_CD            = F.GLBL_CMPY_CD
                 AND E.BLLG_MTR_BLLG_CYCLE_CD  = F.BLLG_CYCLE_CD
                 AND F.EZCANCELFLAG            = '0'
            ) X
        WHERE
                X.BLLG_SCHD_THRU_DT   &gt;= #mtrReadDtFrom#
            AND X.BLLG_SCHD_THRU_DT   &lt;= TO_CHAR((TO_DATE(#mtrReadDt#, #dateFormat#) + TO_NUMBER(X.BEF_DAYS)), #dateFormat#) 
        ORDER BY
             X.DS_CONTR_DTL_PK
            ,X.DS_CONTR_BLLG_SCHD_PK
            ,X.DS_CONTR_BLLG_MTR_PK
    </statement>
<!-- mod end 2017/08/15 QC#18799 -->

<!-- mod start 2017/08/15 QC#18799 -->
    <statement id="getBllgSchdAgg" parameterClass="Map" resultClass="Map">
        <!-- START 2022/09/20 [QC#60045,ADD] -->
        <!-- START 2023/05/09 K.Kitachi [QC#61469, DEL] -->
<!--        WITH DEF_WIN_DAYS AS ( -->
<!--            SELECT -->
<!--                 A.MTR_READ_WIN_MLY_DAYS_AOT -->
<!--                ,A.MTR_READ_WIN_OTH_DAYS_AOT -->
<!--            FROM -->
<!--                DS_WIN_DAYS A -->
<!--            WHERE -->
<!--                    A.GLBL_CMPY_CD             = #glblCmpyCd# -->
<!--                AND A.EZCANCELFLAG             = '0' -->
<!--                AND A.DS_WIN_DAYS_TRGT_PER_TXT = '*' -->
<!--                AND A.SVC_LINE_BIZ_CD          = '*' -->
<!--            ) -->
        <!-- END 2023/05/09 K.Kitachi [QC#61469, DEL] -->
        <!-- END   2022/09/20 [QC#60045,ADD] -->
        SELECT
             X.DS_CONTR_DTL_PK
            ,X.DS_CONTR_BLLG_SCHD_PK
            ,X.DS_CONTR_BLLG_MTR_PK
            ,X.NEXT_BLLG_DT
        FROM
            (
             SELECT
             A.DS_CONTR_DTL_PK
            ,B.DS_CONTR_BLLG_SCHD_PK
            ,B.DS_CONTR_BLLG_MTR_PK
            ,B.NEXT_BLLG_DT
                 ,B.BLLG_SCHD_THRU_DT
                 <!-- START 2022/09/20 [QC#60045,MOD] -->
                 <!-- ,NVL(DECODE(F.BLLG_CYCLE_UOM_CD, #months#, D.MTR_READ_WIN_MLY_DAYS_AOT, D.MTR_READ_WIN_OTH_DAYS_AOT), #defBefDays#) AS BEF_DAYS -->
                 <!-- START 2023/02/09 S.Naya [QC#60045, MOD] -->
                 <!-- ,DECODE(F.BLLG_CYCLE_UOM_CD, #months#, COALESCE(D.MTR_READ_WIN_MLY_DAYS_AOT, (SELECT MTR_READ_WIN_MLY_DAYS_AOT FROM DEF_WIN_DAYS), #defBefDays#), COALESCE(D.MTR_READ_WIN_OTH_DAYS_AOT, (SELECT MTR_READ_WIN_OTH_DAYS_AOT FROM DEF_WIN_DAYS), #defBefDays#)) AS BEF_DAYS -->
                 <!-- START 2023/05/09 K.Kitachi [QC#61469, MOD] -->
                 <!-- ,DECODE(F.BLLG_CYCLE_UOM_CD, #months#, COALESCE(D.MTR_READ_WIN_MLY_DAYS_AOT, D2.MTR_READ_WIN_MLY_DAYS_AOT, (SELECT MTR_READ_WIN_MLY_DAYS_AOT FROM DEF_WIN_DAYS), #defBefDays#), COALESCE(D.MTR_READ_WIN_OTH_DAYS_AOT, D2.MTR_READ_WIN_OTH_DAYS_AOT, (SELECT MTR_READ_WIN_OTH_DAYS_AOT FROM DEF_WIN_DAYS), #defBefDays#)) AS BEF_DAYS -->
                 ,DECODE(F.BLLG_CYCLE_UOM_CD, #months#, COALESCE(D.MTR_READ_WIN_MLY_DAYS_AOT, D2.MTR_READ_WIN_MLY_DAYS_AOT, #mtrReadWinMlyDaysAot#, #defBefDays#), COALESCE(D.MTR_READ_WIN_OTH_DAYS_AOT, D2.MTR_READ_WIN_OTH_DAYS_AOT, #mtrReadWinOthDaysAot#, #defBefDays#)) AS BEF_DAYS
                 <!-- END 2023/05/09 K.Kitachi [QC#61469, MOD] -->
                 <!-- END   2023/02/09 S.Naya [QC#60045, MOD] -->
                 <!-- END   2022/09/20 [QC#60045,MOD] -->
        FROM 
             DS_CONTR_DTL        A
            ,DS_CONTR_BLLG_SCHD  B
                 ,DS_CONTR                 C
                 <!-- START 2022/09/20 [QC#60045,MOD] -->
                 <!-- ,DS_CONTR_INTFC_DEF_RULE  D -->
                 ,DS_WIN_DAYS              D
                 <!-- END   2022/09/20 [QC#60045,MOD] -->
                 <!-- START 2023/02/09 S.Naya [QC#60045, ADD] -->
                 ,DS_WIN_DAYS              D2
                 <!-- END   2023/02/09 S.Naya [QC#60045, ADD] -->
                 ,DS_CONTR_BLLG_MTR        E
                 ,BLLG_CYCLE               F
        WHERE
                A.GLBL_CMPY_CD            = #glblCmpyCd#
            AND A.EZCANCELFLAG            = '0'
            AND A.DS_CONTR_PK             = #dsContrPk#
                 AND A.DS_CONTR_DTL_TP_CD      = #dsContrDtlTpAgg#
            AND A.GLBL_CMPY_CD            = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK         = B.DS_CONTR_DTL_PK
            AND B.EZCANCELFLAG            = '0'
            AND B.USG_CHRG_FLG            = #usgChrgFlgY#
            AND EXISTS (
                SELECT
                         1
                FROM
                         DS_CONTR_BLLG_SCHD G
                WHERE
                             G.GLBL_CMPY_CD               = B.GLBL_CMPY_CD
                         AND G.PRNT_DS_CONTR_BLLG_SCHD_PK = B.DS_CONTR_BLLG_SCHD_PK
                         AND G.MTR_ENTRY_CPLT_FLG         = 'Y'
                         AND G.EZCANCELFLAG               = '0'
                 )
                 AND A.GLBL_CMPY_CD            = C.GLBL_CMPY_CD
                 AND A.DS_CONTR_PK             = C.DS_CONTR_PK
                    AND C.EZCANCELFLAG               = '0'
                 <!-- START 2022/09/20 [QC#60045,MOD] -->
                 <!-- AND C.GLBL_CMPY_CD            = D.GLBL_CMPY_CD          (+) -->
                 <!-- AND C.DS_CONTR_SRC_TP_CD      = D.CONTR_INTFC_SRC_TP_CD (+) -->
                 <!-- AND C.DS_CONTR_CLS_CD         = D.DS_CONTR_CLS_CD       (+) -->
                 <!-- AND C.SVC_LINE_BIZ_CD         = D.SVC_LINE_BIZ_CD       (+) -->
                 <!-- AND D.EZCANCELFLAG (+)        = '0' -->
                 <!-- AND D.EFF_FROM_DT  (+)        &lt;= #slsDt# -->
                 <!-- AND D.ENBL_FLG     (+)        = 'Y' -->
                 AND B.GLBL_CMPY_CD                       = D.GLBL_CMPY_CD(+)
                 AND D.EZCANCELFLAG(+)                    = '0'
                 AND SUBSTR(B.BLLG_SCHD_THRU_DT, 0, 6)    = D.DS_WIN_DAYS_TRGT_PER_TXT(+)
                 AND C.SVC_LINE_BIZ_CD                    = D.SVC_LINE_BIZ_CD(+)
                 <!-- END   2022/09/20 [QC#60045,MOD] -->
                 <!-- START 2023/02/09 S.Naya [QC#60045, ADD] -->
                 AND B.GLBL_CMPY_CD                       = D2.GLBL_CMPY_CD(+)
                 AND D2.EZCANCELFLAG(+)                   = '0'
                 AND SUBSTR(B.BLLG_SCHD_THRU_DT, 0, 6)    = D2.DS_WIN_DAYS_TRGT_PER_TXT(+)
                 AND D2.SVC_LINE_BIZ_CD(+)                = '*'
                 <!-- END   2023/02/09 S.Naya [QC#60045, ADD] -->
                 AND B.GLBL_CMPY_CD            = E.GLBL_CMPY_CD
                 AND B.DS_CONTR_BLLG_MTR_PK    = E.DS_CONTR_BLLG_MTR_PK
                 AND E.EZCANCELFLAG            = '0'
                 AND E.GLBL_CMPY_CD            = F.GLBL_CMPY_CD
                 AND E.BLLG_MTR_BLLG_CYCLE_CD  = F.BLLG_CYCLE_CD
                 AND F.EZCANCELFLAG            = '0'
            ) X
        WHERE
                X.BLLG_SCHD_THRU_DT   &gt;= #mtrReadDtFrom#
            AND X.BLLG_SCHD_THRU_DT   &lt;= TO_CHAR((TO_DATE(#mtrReadDt#, #dateFormat#) + TO_NUMBER(X.BEF_DAYS)), #dateFormat#) 
        ORDER BY
             X.DS_CONTR_DTL_PK
            ,X.DS_CONTR_BLLG_SCHD_PK
            ,X.DS_CONTR_BLLG_MTR_PK
    </statement>
<!-- mod end 2017/08/15 QC#18799 -->

    <statement id="getBllgSchdAggChild" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_DTL_PK
            ,A.DS_CONTR_BLLG_SCHD_PK
            ,A.DS_CONTR_BLLG_MTR_PK
            ,A.NEXT_BLLG_DT
            <!-- 2022/12/19 QC#60886 Add Start -->
            ,A.BLLG_SCHD_FROM_DT
            ,C.SVC_LINE_BIZ_CD
            <!-- 2022/12/19 QC#60886 Add End -->
        FROM 
             DS_CONTR_BLLG_SCHD  A
            <!-- 2022/12/19 QC#60886 Add Start -->
            ,DS_CONTR_DTL        B
            ,DS_CONTR            C
            <!-- 2022/12/19 QC#60886 Add End -->
        WHERE
                A.GLBL_CMPY_CD               = #glblCmpyCd#
            AND A.EZCANCELFLAG               = '0'
            AND A.PRNT_DS_CONTR_BLLG_SCHD_PK = #prntDsContrBllgSchdPk#
            <!-- 2022/12/19 QC#60886 Add Start -->
            AND B.GLBL_CMPY_CD               = #glblCmpyCd#
            AND B.EZCANCELFLAG               = '0'
            AND C.GLBL_CMPY_CD               = #glblCmpyCd#
            AND C.EZCANCELFLAG               = '0'
            AND A.DS_CONTR_DTL_PK            = B.DS_CONTR_DTL_PK
            AND B.DS_CONTR_PK                = C.DS_CONTR_PK
            <!-- 2022/12/19 QC#60886 Add End -->
        ORDER BY
             A.DS_CONTR_DTL_PK
            ,A.DS_CONTR_BLLG_SCHD_PK
            ,A.DS_CONTR_BLLG_MTR_PK
    </statement>
    <statement id="getMtrBllg" parameterClass="Map" resultClass="Map">
        SELECT
             A.SVC_CONTR_BLLG_PK
            ,A.DS_CONTR_BLLG_SCHD_PK
            ,A.DS_CONTR_BLLG_MTR_PK
            ,B.MTR_BLLG_FROM_DT
            ,B.MTR_BLLG_THRU_DT
            ,B.MTR_CHRG_FUNC_AMT
            <!-- START 2018/03/13 U.Kim [QC#18884(Sol#337), ADD]  -->
            ,B.MTR_COPY_QTY
            <!-- END 2018/03/13 U.Kim [QC#18884(Sol#337), ADD]  -->
            <!-- START 2019/09/05 [QC#52820, ADD] -->
            ,B.BLLG_COPY_QTY
            ,B.COPY_INCL_QTY
            <!-- END 2019/09/05 [QC#52820, ADD] -->
        FROM 
             SVC_CONTR_BLLG      A
            ,SVC_CONTR_MTR_BLLG  B
        WHERE
                A.GLBL_CMPY_CD            = #glblCmpyCd#
            AND A.EZCANCELFLAG            = '0'
            AND A.DS_CONTR_BLLG_SCHD_PK   = #dsContrBllgSchdPk#
            AND A.GLBL_CMPY_CD            = B.GLBL_CMPY_CD
            AND A.SVC_CONTR_BLLG_PK       = B.SVC_CONTR_BLLG_PK
            AND B.EZCANCELFLAG            = '0'
    </statement>

    <!-- START 2019/09/05 [QC#52820, MOD] -->
    <!-- mod start 2019/10/11 QC#53574 -->
    <statement id="getPreMtrBllg" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_BLLG_SCHD_PK
            ,A.DS_CONTR_BLLG_MTR_PK
            ,A.MTR_CHRG_FUNC_AMT
        FROM 
            DS_CONTR_BLLG_SCHD  A
        WHERE
                A.GLBL_CMPY_CD            = #glblCmpyCd#
            AND A.EZCANCELFLAG            = '0'
            AND A.DS_CONTR_BLLG_MTR_PK    = #dsContrBllgMtrPk#
            AND A.USG_CHRG_FLG            = #usgChrgFlgY#
            AND A.INV_FLG                 = #invFlgY#
            AND A.MTR_CHRG_FUNC_AMT       &gt;= 0
            AND A.BLLG_SCHD_FROM_DT       &gt;= #mtrReadDtPrvw#
            AND A.BLLG_SCHD_THRU_DT       &lt;  #mtrBllgFromDt#
            AND A.INV_TP_CD               = #invTpCd#
            AND NOT EXISTS(
                    SELECT
                        1
                    FROM
                        DS_CONTR_BLLG_SCHD B
                    WHERE
                            B.GLBL_CMPY_CD               = A.GLBL_CMPY_CD
                        AND B.ORIG_DS_CONTR_BLLG_SCHD_PK = A.DS_CONTR_BLLG_SCHD_PK
                        AND B.INV_FLG                    = #invFlgY#
                        AND B.INV_TP_CD                  = #invTpCd#
                        AND B.EZCANCELFLAG               = '0'
                )
        ORDER BY
             A.DS_CONTR_BLLG_SCHD_PK
            ,A.DS_CONTR_BLLG_MTR_PK
    </statement>
    <!-- mod end 2019/10/11 QC#53574 -->
    <!-- END 2019/09/05 [QC#52820, MOD] -->

    <statement id="getContrBllgList" parameterClass="Map" resultClass="Map">
        SELECT
            DISTINCT
             C.BILL_TO_CUST_CD
            ,C.SVC_CONTR_BLLG_FROM_DT
            ,C.SVC_CONTR_BLLG_THRU_DT
            ,A.DS_CONTR_CATG_CD
            ,A.DS_CONTR_NUM
            ,A.SVC_CONTR_BR_CD
            ,A.CONTR_ADMIN_PSN_CD
            ,B.SVC_MACH_MSTR_PK
            <!-- START 2018/07/04 K.Kitachi [QC#26891, ADD] -->
            ,NVL(C.OVRD_NEXT_BLLG_DT, C.MTR_BLLG_NEXT_BLLG_DT) NEXT_BLLG_DT
            ,C.BLLG_APVL_REQ_FLG
            <!-- END 2018/07/04 K.Kitachi [QC#26891, ADD] -->
            <!-- START 2019/01/22 [QC#29791, ADD] -->
            ,E.RGTN_USR_ID
            ,E.EZINUSERID
            <!-- END   2019/01/22 [QC#29791, ADD] -->
            <!-- START 2019/09/02 K.Kitachi [QC#52695, ADD] -->
            ,C.DS_CONTR_DTL_PK
            <!-- END 2019/09/02 K.Kitachi [QC#52695, ADD] -->
        FROM
             DS_CONTR           A
            ,DS_CONTR_DTL       B
            ,SVC_CONTR_BLLG     C
            ,SVC_CONTR_MTR_BLLG D
            ,SVC_PHYS_MTR_READ  E
        WHERE
                A.EZCANCELFLAG      = '0'
            AND A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.DS_CONTR_PK       = #dsContrPk#
            AND B.EZCANCELFLAG      = '0'
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK       = B.DS_CONTR_PK
        <isNotNull property="svcMachMstrPk">
            AND B.SVC_MACH_MSTR_PK  = #svcMachMstrPk#
        </isNotNull>
            AND C.EZCANCELFLAG      = '0'
            AND B.GLBL_CMPY_CD      = C.GLBL_CMPY_CD
            AND B.DS_CONTR_PK       = C.DS_CONTR_PK
            AND B.DS_CONTR_DTL_PK   = C.DS_CONTR_DTL_PK
            AND C.USG_CHRG_FLG      = 'Y'
            AND C.BLLG_APVL_REQ_FLG = 'Y'
            AND C.BLLG_APVL_CPLT_FLG = 'N'
            AND D.EZCANCELFLAG      = '0'
            AND C.GLBL_CMPY_CD      = D.GLBL_CMPY_CD
            AND C.SVC_CONTR_BLLG_PK = D.SVC_CONTR_BLLG_PK
            <!-- START 2020/04/10 K.Kitachi [QC#56500, MOD] -->
            <!-- AND D.MTR_BLLG_FROM_DT  &lt;= #mtrReadDt# -->
            <!-- AND D.MTR_BLLG_THRU_DT  &gt;= #mtrReadDt# -->
            AND (
                    (
                            D.MTR_BLLG_FROM_DT &lt;= #mtrReadDt#
                        AND D.MTR_BLLG_THRU_DT &gt;= #mtrReadDt#
                    )
                <isNotNull property="dsContrDtlTpAgg">
                 OR EXISTS (
                        SELECT
                            1
                        FROM
                            SVC_CONTR_BLLG X
                        WHERE
                                C.GLBL_CMPY_CD           = X.GLBL_CMPY_CD
                            AND C.PRNT_SVC_CONTR_BLLG_PK = X.SVC_CONTR_BLLG_PK
                            AND X.SVC_CONTR_BLLG_FROM_DT &lt;= #mtrReadDt#
                            AND X.SVC_CONTR_BLLG_THRU_DT &gt;= #mtrReadDt#
                            AND X.EZCANCELFLAG           = '0'
                    )
                </isNotNull>
            )
            <!-- END 2020/04/10 K.Kitachi [QC#56500, MOD] -->
        <isNotNull property="dsContrDtlTpFleet">
            AND B.DS_CONTR_DTL_TP_CD = #dsContrDtlTpFleet#
        </isNotNull>
        <isNotNull property="dsContrDtlTpAgg">
            AND B.DS_CONTR_DTL_TP_CD  &lt;&gt; #dsContrDtlTpAgg#
        </isNotNull>
        <!-- START 2019/01/22 [QC#29791, ADD] -->
            AND D.GLBL_CMPY_CD = E.GLBL_CMPY_CD(+)
            AND D.SVC_PHYS_MTR_READ_GRP_SQ = E.SVC_PHYS_MTR_READ_GRP_SQ(+)
            AND E.EZCANCELFLAG(+) = '0'
        <!-- END   2019/01/22 [QC#29791, ADD] -->
        <!-- START 2019/11/28 [QC#53567, ADD] -->
        <isEqual property="negFlg" compareValue="Y">
        	AND D.MTR_COPY_QTY     &lt; 0
        </isEqual>
        <isEqual property="negFlg" compareValue="N">
        	AND D.MTR_COPY_QTY     &gt;= 0
        </isEqual>
        <!-- END   2019/11/28 [QC#53567, ADD] -->
        ORDER BY
             C.BILL_TO_CUST_CD
            ,C.SVC_CONTR_BLLG_THRU_DT
    </statement>

    <statement id="getMtrChrgFuncAmt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            NVL(SUM(D.MTR_CHRG_DEAL_AMT), 0) AS MTR_CHRG_DEAL_AMT
        FROM
             DS_CONTR           A
            ,DS_CONTR_DTL       B
            ,SVC_CONTR_BLLG     C
            ,SVC_CONTR_MTR_BLLG D
        WHERE
                A.EZCANCELFLAG      = '0'
            AND A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.DS_CONTR_PK       = #dsContrPk#
            AND B.EZCANCELFLAG      = '0'
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK       = B.DS_CONTR_PK
        <isNotNull property="svcMachMstrPk">
            AND B.SVC_MACH_MSTR_PK  = #svcMachMstrPk#
        </isNotNull>
            AND C.EZCANCELFLAG      = '0'
            AND B.GLBL_CMPY_CD      = C.GLBL_CMPY_CD
            AND B.DS_CONTR_PK       = C.DS_CONTR_PK
            AND B.DS_CONTR_DTL_PK   = C.DS_CONTR_DTL_PK
            AND C.BILL_TO_CUST_CD   = #billToCustCd#
            AND C.USG_CHRG_FLG      = 'Y'
            AND D.EZCANCELFLAG      = '0'
            AND C.GLBL_CMPY_CD      = D.GLBL_CMPY_CD
            AND C.SVC_CONTR_BLLG_PK = D.SVC_CONTR_BLLG_PK
            AND D.MTR_BLLG_FROM_DT  &lt;= #mtrReadDt#
            AND D.MTR_BLLG_THRU_DT  &gt;= #mtrReadDt#
    </statement>

    <statement id="getSvcRgPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            D.SVC_RG_PK
        FROM
             DS_CONTR       A
            ,SVC_CONTR_BR   B
            ,SVC_RG_BR_RELN C
            ,SVC_RG         D
        WHERE
                A.EZCANCELFLAG                 = '0'
            AND A.GLBL_CMPY_CD                 = #glblCmpyCd#
            AND A.DS_CONTR_PK                  = #dsContrPk#
            AND B.EZCANCELFLAG                 = '0'
            AND A.GLBL_CMPY_CD                 = B.GLBL_CMPY_CD
            AND A.SVC_CONTR_BR_CD              = B.SVC_CONTR_BR_CD
            AND B.SVC_CONTR_BR_ACTV_FLG        = 'Y'
            AND B.EFF_FROM_DT                  &lt;= #slsDt#
            AND NVL(B.EFF_THRU_DT, #maxDate#)  &gt;= #slsDt#
            AND C.EZCANCELFLAG                 = '0'
            AND B.GLBL_CMPY_CD                 = C.GLBL_CMPY_CD
            AND B.SVC_CONTR_BR_CD              = C.SVC_CONTR_BR_CD
            AND D.EZCANCELFLAG                 = '0'
            AND C.GLBL_CMPY_CD                 = D.GLBL_CMPY_CD
            AND C.SVC_RG_PK                    = D.SVC_RG_PK
            AND D.SVC_RG_ACTV_FLG              = 'Y'
            AND D.EFF_FROM_DT                  &lt;= #slsDt#
            AND NVL(D.EFF_THRU_DT, #maxDate#)  &gt;= #slsDt#
        ORDER BY
            D.SVC_RG_PK
    </statement>

<!-- START 2019/09/05 [QC#52820, DEL] -->
<!-- add start 2017/08/15 QC#18799 -->
<!--     <statement id="getBllgPrvwAvalMaxPrc" parameterClass="Map" resultClass="BigDecimal"> -->
<!--         SELECT                                                                           -->
<!--              B.BLLG_LIMIT_AMT                                                            -->
<!--         FROM                                                                             -->
<!--              DS_CONTR     A                                                              -->
<!--             ,DS_CONTR_INTFC_DEF_RULE B                                                   -->
<!--         WHERE                                                                            -->
<!--                 A.GLBL_CMPY_CD            = #glblCmpyCd#                                 -->
<!--             AND A.EZCANCELFLAG            = '0'                                          -->
<!--             <isNotNull property="dsContrPk">                                             -->
<!--             AND A.DS_CONTR_PK             = #dsContrPk#                                  -->
<!--             </isNotNull>                                                                 -->
<!--             <isNotNull property="dsContrNum">                                            -->
<!--             AND A.DS_CONTR_NUM            = #dsContrNum#                                 -->
<!--             </isNotNull>                                                                 -->
<!--             AND A.GLBL_CMPY_CD            = B.GLBL_CMPY_CD                               -->
<!--             AND A.DS_CONTR_SRC_TP_CD      = B.CONTR_INTFC_SRC_TP_CD                      -->
<!--             AND A.DS_CONTR_CLS_CD         = B.DS_CONTR_CLS_CD                            -->
<!--             AND A.SVC_LINE_BIZ_CD         = B.SVC_LINE_BIZ_CD                            -->
<!--             AND B.EZCANCELFLAG            = '0'                                          -->
<!--             AND B.EFF_FROM_DT             &lt;= #slsDt#                                  -->
<!--             AND B.ENBL_FLG                = 'Y'                                          -->
<!--     </statement>                                                                         -->
<!-- add end 2017/08/15 QC#18799 -->
<!-- END 2019/09/05 [QC#52820, DEL] -->
<!-- 2022/12/19 QC#60886 Add Start -->
    <statement id = "getAverageBilling" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             AVG(NVL(SCHD.MTR_CHRG_DEAL_AMT, 0)) AS AVG_BLLG
        FROM
             DS_CONTR_BLLG_MTR MTR
            ,DS_CONTR_PRC_EFF EFF
            ,DS_CONTR_BLLG_SCHD SCHD
        WHERE
             MTR.GLBL_CMPY_CD            = #glblCmpyCd#
         AND MTR.EZCANCELFLAG            = '0'
         AND MTR.GLBL_CMPY_CD            = EFF.GLBL_CMPY_CD
         AND EFF.EZCANCELFLAG            = '0'
         AND EFF.GLBL_CMPY_CD            = SCHD.GLBL_CMPY_CD
         AND SCHD.EZCANCELFLAG           = '0'
         AND MTR.DS_CONTR_BLLG_MTR_PK    = #dsContrBllgMtrPk#
         AND MTR.DS_CONTR_BLLG_MTR_PK    = EFF.DS_CONTR_BLLG_MTR_PK
         AND EFF.DS_CONTR_PRC_EFF_PK     = SCHD.DS_CONTR_PRC_EFF_PK
         AND SCHD.BLLG_SCHD_FROM_DT  &lt;  #bllgSchdFromDt#
         AND SCHD.BLLG_SCHD_THRU_DT  &gt;= TO_CHAR(ADD_MONTHS(TO_DATE(#bllgSchdFromDt#, #dateFormat#), -12), #dateFormat#)
         AND SCHD.INV_TP_CD              = #invTpCd#
         AND SCHD.BLLBL_FLG              = 'Y'
    </statement>
<!-- 2022/12/19 QC#60886 Add End -->
</sqlMap>
