<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSZC054001">

    <statement id="WF_PRVW_BLLG_SQL" parameterClass="Map" resultClass="Map">
        WITH CONTR_HRCH AS ( 
            SELECT
                G.GLBL_CMPY_CD
                , G.SVC_CONTR_BR_CD
                , G.PSN_CD  AS PRINCIPAL_CD
                , J.PSN_CD  AS BOSS_CD
                , I.APVL_LIMIT_AMT
                , 'N'       AS AUTO_APVL_FLG
                , ROW_NUMBER() OVER (
                    PARTITION BY
                        G.GLBL_CMPY_CD
                        , G.SVC_CONTR_BR_CD
                        , G.PSN_CD
                    ORDER BY
                        I.APVL_LIMIT_AMT
                ) AS ROW_ID
            FROM
                SVC_BR_RESRC_RELN   G
                , ORG_FUNC_ROLE_TP  H
                , ORG_FUNC_ROLE_TP  I
                , SVC_BR_RESRC_RELN J
            WHERE
                G.SVC_BR_RESRC_ACTV_FLG     = 'Y'
                AND G.EZCANCELFLAG          = '0'
                AND H.GLBL_CMPY_CD          = G.GLBL_CMPY_CD 
                AND H.ORG_FUNC_ROLE_TP_CD   = G.SVC_ORG_FUNC_ROLE_TP_CD
                AND H.ACTV_FLG              = 'Y'
                AND H.FIRST_ORG_CD          = #condStr4#
                AND H.EZCANCELFLAG          = '0'
                AND I.GLBL_CMPY_CD          = H.GLBL_CMPY_CD 
                AND I.APVL_LIMIT_AMT        &gt;= H.APVL_LIMIT_AMT
                AND I.ACTV_FLG              = 'Y'
                AND I.FIRST_ORG_CD          = #condStr4#
                AND I.EZCANCELFLAG          = '0'
                AND J.GLBL_CMPY_CD          = I.GLBL_CMPY_CD
                AND J.SVC_ORG_FUNC_ROLE_TP_CD   = I.ORG_FUNC_ROLE_TP_CD
                AND J.SVC_BR_RESRC_ACTV_FLG = 'Y'
                AND J.EZCANCELFLAG          = '0'
                AND J.SVC_CONTR_BR_CD       = G.SVC_CONTR_BR_CD
                AND (
                    G.PSN_CD            = J.PSN_CD
                    OR H.APVL_LIMIT_AMT &lt;&gt; I.APVL_LIMIT_AMT
                )
          ORDER BY
              G.SVC_CONTR_BR_CD
              , G.PSN_CD
              , I.APVL_LIMIT_AMT
          ) 
          <!-- START 2019/02/20 [QC#30292, MOD] -->
          SELECT DISTINCT
          <!-- END 2019/02/20 [QC#30292, MOD] -->
              A.SVC_RG_PK           AS COND_NUM_1
              , C.SVC_CONTR_BR_CD   AS COND_STR_1
              , D.PSN_CD            AS COND_STR_2
              , F.APVL_LIMIT_AMT    AS COND_NUM_2
              , F.AUTO_APVL_FLG     AS COND_STR_3
              , F.BOSS_CD           AS VAL_STR_1
          FROM
              SVC_RG                A
              , SVC_RG_BR_RELN      B 
              , SVC_CONTR_BR        C
              , SVC_BR_RESRC_RELN   D
              , CONTR_HRCH          F
          WHERE
              A.SVC_RG_PK           = #condNum1#
              AND C.SVC_CONTR_BR_CD = #condStr1#
              AND D.PSN_CD          = #condStr2#
              AND F.AUTO_APVL_FLG   = #condStr3#
              AND A.SVC_RG_ACTV_FLG = 'Y'
              AND A.GLBL_CMPY_CD    = #glblCmpyCd#
              AND A.EZCANCELFLAG    = '0'
              AND B.GLBL_CMPY_CD    = A.GLBL_CMPY_CD
              AND B.SVC_RG_PK       = A.SVC_RG_PK
              AND B.EZCANCELFLAG    = '0'
              AND C.GLBL_CMPY_CD    = B.GLBL_CMPY_CD
              AND C.SVC_CONTR_BR_CD = B.SVC_CONTR_BR_CD
              AND C.SVC_CONTR_BR_ACTV_FLG   = 'Y'
              AND C.EZCANCELFLAG    = '0'
              AND D.GLBL_CMPY_CD    = C.GLBL_CMPY_CD
              AND D.SVC_CONTR_BR_CD = C.SVC_CONTR_BR_CD
              AND D.SVC_BR_RESRC_ACTV_FLG   = 'Y'
              AND D.EZCANCELFLAG    = '0'
              AND F.GLBL_CMPY_CD    = D.GLBL_CMPY_CD
              AND F.SVC_CONTR_BR_CD = D.SVC_CONTR_BR_CD
              AND F.PRINCIPAL_CD    = D.PSN_CD
          ORDER BY
              A.SVC_RG_PK
              <!-- START 2019/02/20 [QC#30292, MOD] -->
              , C.SVC_CONTR_BR_CD
              <!-- END 2019/02/20 [QC#30292, MOD] -->
              , D.PSN_CD
              , F.APVL_LIMIT_AMT
    </statement>

    <statement id="WF_GRP_PRVW_BLLG_SQL" parameterClass="Map" resultClass="Map">
        SELECT
            'NSWP0002'          AS BIZ_ID
            , 'GRP_PRVW_BLLG'   AS USER_GROUP_NAME
            , ROW_NUMBER() OVER (
                PARTITION BY
                    G.GLBL_CMPY_CD
                    , G.SVC_CONTR_BR_CD
                    , G.PSN_CD
                ORDER BY
                    I.APVL_LIMIT_AMT
            ) AS USER_GROUP_LEVEL
            , J.PSN_CD          AS WF_USR_ID
        FROM
            SVC_BR_RESRC_RELN   G
            , ORG_FUNC_ROLE_TP  H
            , ORG_FUNC_ROLE_TP  I
            , SVC_BR_RESRC_RELN J
        WHERE
            G.SVC_CONTR_BR_CD       = #condStr1#
            AND G.PSN_CD            = #condStr2#
            AND I.APVL_LIMIT_AMT    &lt;= #condNum2#
            AND 'N'                 = #condStr3#
            AND G.SVC_BR_RESRC_ACTV_FLG = 'Y'
            AND G.GLBL_CMPY_CD      = #glblCmpyCd#
            AND G.EZCANCELFLAG      = '0'
            AND H.GLBL_CMPY_CD      = G.GLBL_CMPY_CD
            AND H.ORG_FUNC_ROLE_TP_CD   = G.SVC_ORG_FUNC_ROLE_TP_CD
            AND H.ACTV_FLG          = 'Y'
            AND H.FIRST_ORG_CD      = #condStr4#
            AND H.EZCANCELFLAG      = '0'
            AND I.GLBL_CMPY_CD      = H.GLBL_CMPY_CD
            AND I.APVL_LIMIT_AMT    &gt;= H.APVL_LIMIT_AMT
            AND I.ACTV_FLG          = 'Y'
            AND I.FIRST_ORG_CD      = #condStr4#
            AND I.EZCANCELFLAG      = '0'
            AND J.GLBL_CMPY_CD      = I.GLBL_CMPY_CD
            AND J.SVC_ORG_FUNC_ROLE_TP_CD   = I.ORG_FUNC_ROLE_TP_CD
            AND J.SVC_BR_RESRC_ACTV_FLG     = 'Y'
            AND J.EZCANCELFLAG      = '0'
            AND J.SVC_CONTR_BR_CD   = G.SVC_CONTR_BR_CD
            AND (
                G.PSN_CD            = J.PSN_CD
                OR H.APVL_LIMIT_AMT &lt;&gt; I.APVL_LIMIT_AMT
            )
        ORDER BY
            G.SVC_CONTR_BR_CD
            , G.PSN_CD
            , I.APVL_LIMIT_AMT
    </statement>

    <statement id="WF_GRP_PRVW_BLLG_REASG_SQL" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            'NSWP0002' AS BIZ_ID
            , 'GRP_BP_REASG' AS USER_GROUP_NAME
            , D.PSN_CD AS WF_USR_ID
        FROM
            SVC_BR_RESRC_RELN D
        WHERE
            D.GLBL_CMPY_CD = #glblCmpyCd#
            AND D.SVC_BR_RESRC_ACTV_FLG = 'Y'
            AND D.SVC_ORG_FUNC_ROLE_TP_CD &lt;&gt; '006'
            AND D.EZCANCELFLAG = '0'
    </statement>
    <!-- START 2018/03/13 U.Kim [QC#18884(Sol#337), ADD] -->
    <statement id="WF_NGTV_READ_SQL" parameterClass="Map" resultClass="Map">
        SELECT 
            SV.SVC_CONTR_BR_CD          AS COND_STR_1
           ,SV.SVC_ORG_FUNC_ROLE_TP_CD  AS COND_STR_2
           ,SV.PSN_CD                   AS VAL_STR_1
        FROM
             SVC_BR_RESRC_RELN  SV
        WHERE
            SV.GLBL_CMPY_CD                 =  #glblCmpyCd#
        AND SV.SVC_CONTR_BR_CD              =  #condStr1#
        AND SV.EZCANCELFLAG                 =  '0'
        AND SV.SVC_ORG_FUNC_ROLE_TP_CD      =  #condStr2#
        AND SV.SVC_BR_RESRC_ACTV_FLG        =  'Y'
        AND SV.EFF_FROM_DT                  &lt;=  #condStr3#
        AND NVL(SV.EFF_THRU_DT, '29991231') &gt;=  #condStr3#
        ORDER BY
            SV.PSN_CD
    </statement>
    <statement id="GET_NGTV_APVL_GRP" parameterClass="Map" resultClass="Map">
        SELECT 
              #glblCmpyCd#
            , #bizId#         AS BIZ_ID
            , #userGroup#     AS USER_GROUP_NAME
            , '000'           AS USER_GROUP_LEVEL
            , SV.PSN_CD       AS WF_USR_ID
        FROM
             SVC_BR_RESRC_RELN  SV
        WHERE
            SV.GLBL_CMPY_CD                 =  #glblCmpyCd#
        AND SV.SVC_CONTR_BR_CD              =  #condStr1#
        AND SV.EZCANCELFLAG                 =  '0'
        AND SV.SVC_ORG_FUNC_ROLE_TP_CD      =  #condStr2#
        AND SV.SVC_BR_RESRC_ACTV_FLG        =  'Y'
        AND SV.EFF_FROM_DT                  &lt;=  #condStr3#
        AND NVL(SV.EFF_THRU_DT, '29991231') &gt;=  #condStr3#
    </statement>
    <!-- END 2018/03/13 U.Kim [QC#18884(Sol#337), ADD] -->
</sqlMap>
