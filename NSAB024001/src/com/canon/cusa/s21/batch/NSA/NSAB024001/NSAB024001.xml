<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAB024001">

    <statement id="getTargetKeyFromDtlWrk" parameterClass="Map" resultClass="Map">
        SELECT
             A.SVC_MACH_MSTR_PK
            ,A.MTR_RCV_DT_TM_TS
        FROM
            IWR_MTR_READ_DTL_WRK A
        WHERE
                A.EZCANCELFLAG    = '0'
            AND A.GLBL_CMPY_CD    = #glblCmpyCd#
            AND A.IWR_PROC_STS_CD = #iwrProcStsNewRecord#
        GROUP BY
             A.SVC_MACH_MSTR_PK
            ,MTR_RCV_DT_TM_TS
        ORDER BY
             A.SVC_MACH_MSTR_PK ASC
            ,A.MTR_RCV_DT_TM_TS DESC
    </statement>

    <statement id="getBllgSchd" parameterClass="Map" resultClass="Map">
        SELECT
             B.BLLG_SCHD_FROM_DT
            ,B.BLLG_SCHD_THRU_DT
            ,B.DS_CONTR_BLLG_SCHD_PK
        FROM
             DS_CONTR_DTL          A
            ,DS_CONTR_BLLG_SCHD    B
            ,DS_BLLG_SCHD_TP C
        WHERE
                A.EZCANCELFLAG           = '0'
            AND A.GLBL_CMPY_CD           = #glblCmpyCd#
            AND A.SVC_MACH_MSTR_PK       = #svcMachMstrPk#
            AND B.EZCANCELFLAG           = '0'
            AND A.GLBL_CMPY_CD           = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK        = B.DS_CONTR_DTL_PK
            AND B.BLLG_SCHD_THRU_DT      &lt;= #slsDt#
            AND B.USG_CHRG_FLG           = 'Y'
            AND B.MTR_ENTRY_CPLT_FLG     = 'N'
            AND C.EZCANCELFLAG           = '0'
            AND B.GLBL_CMPY_CD           = C.GLBL_CMPY_CD
            AND B.DS_BLLG_SCHD_TP_CD     = C.DS_BLLG_SCHD_TP_CD
            AND C.DS_CONTR_SCHD_DISP_FLG = 'Y'
        ORDER BY
            B.BLLG_SCHD_THRU_DT DESC
    </statement>

    <!-- START 2018/03/13 K.Kojima [QC#23112,DEL] -->
    <!-- <statement id="getNoContrAndIntvlMtrReadMach" parameterClass="Map" resultClass="BigDecimal"> -->
    <!--     SELECT -->
    <!--         A.SVC_MACH_MSTR_PK -->
    <!--     FROM -->
    <!--         SVC_MACH_MSTR A -->
    <!--     WHERE -->
    <!--             A.EZCANCELFLAG     = '0' -->
    <!--         AND A.GLBL_CMPY_CD     = #glblCmpyCd# -->
    <!--         AND A.SVC_MACH_MSTR_PK = #svcMachMstrPk# -->
    <!--         AND NOT EXISTS ( -->
    <!--                 SELECT -->
    <!--                     1 -->
    <!--                 FROM -->
    <!--                      DS_CONTR_DTL B -->
    <!--                     ,DS_CONTR     C -->
    <!--                 WHERE -->
    <!--                         B.EZCANCELFLAG        = '0' -->
    <!--                     AND B.GLBL_CMPY_CD        = A.GLBL_CMPY_CD -->
    <!--                     AND B.SVC_MACH_MSTR_PK    = A.SVC_MACH_MSTR_PK -->
    <!--                     AND B.DS_CONTR_DTL_STS_CD &lt;&gt; #dsContrDtlStsCdCanc# -->
    <!--                     AND B.CONTR_EFF_FROM_DT   &lt;= #slsDt# -->
    <!--                     AND ( -->
    <!--                             (B.CONTR_CLO_DT    IS NULL     AND B.CONTR_EFF_THRU_DT &gt;= #slsDt#) -->
    <!--                             OR (B.CONTR_CLO_DT IS NOT NULL AND B.CONTR_CLO_DT      &gt;= #slsDt#) -->
    <!--                         ) -->
    <!--                     AND C.EZCANCELFLAG        = '0' -->
    <!--                     AND B.GLBL_CMPY_CD        = C.GLBL_CMPY_CD -->
    <!--                     AND B.DS_CONTR_PK         = C.DS_CONTR_PK -->
    <!--                     AND C.DS_CONTR_CATG_CD    &lt;&gt; #dsContrCatgCdWty# -->
    <!--             ) -->
    <!--         AND ( -->
    <!--                 EXISTS ( -->
    <!--                     SELECT -->
    <!--                         1 -->
    <!--                     FROM ( -->
    <!--                         SELECT -->
    <!--                             MAX(X.MTR_READ_DT) AS MTR_READ_DT -->
    <!--                         FROM -->
    <!--                             SVC_PHYS_MTR_READ X -->
    <!--                         WHERE -->
    <!--                                 X.EZCANCELFLAG     = '0' -->
    <!--                             AND X.GLBL_CMPY_CD     = A.GLBL_CMPY_CD -->
    <!--                             AND X.SVC_MACH_MSTR_PK = A.SVC_MACH_MSTR_PK) Y -->
    <!--                     WHERE -->
    <!--                         Y.MTR_READ_DT &lt;= #intvlDt# -->
    <!--                 ) -->
    <!--             OR -->
    <!--                 NOT EXISTS ( -->
    <!--                     SELECT -->
    <!--                         1 -->
    <!--                     FROM -->
    <!--                         SVC_PHYS_MTR_READ Z -->
    <!--                     WHERE -->
    <!--                             Z.EZCANCELFLAG     = '0' -->
    <!--                         AND Z.GLBL_CMPY_CD     = A.GLBL_CMPY_CD -->
    <!--                         AND Z.SVC_MACH_MSTR_PK = A.SVC_MACH_MSTR_PK -->
    <!--                 ) -->
    <!--             ) -->
    <!-- </statement> -->
    <!-- END 2018/03/13 K.Kojima [QC#23112,DEL] -->

    <statement id="getIwrMtrReadDtlWrk" parameterClass="Map" resultClass="Map">
        SELECT
             A.IWR_MTR_READ_DTL_WRK_PK
            ,A.SVC_MACH_MSTR_PK
            ,A.SER_NUM
            ,A.MTR_READ_DT
            ,A.READ_MTR_CNT
            ,B.MTR_LB_CD
        FROM
             IWR_MTR_READ_DTL_WRK A
            ,MTR_LB               B
        WHERE
                A.EZCANCELFLAG     = '0'
            AND A.GLBL_CMPY_CD     = #glblCmpyCd#
            AND A.SVC_MACH_MSTR_PK = #svcMachMstrPk#
            AND A.MTR_RCV_DT_TM_TS = #mtrRcvDtTmTs#
            AND A.IWR_PROC_STS_CD  = #iwrProcStsNewRecord#
            AND B.EZCANCELFLAG     = '0'
            AND A.GLBL_CMPY_CD     = B.GLBL_CMPY_CD
            AND A.MTR_CNTR_ID      = B.MTR_CNTR_ID
        ORDER BY
            B.MTR_LB_CD
    </statement>

</sqlMap>