<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL0650Query">
    <typeAlias alias="NSAL0650_ASMsg" type="business.blap.NSAL0650.NSAL0650_ASMsg"/>

    <statement id="getContrInfo" parameterClass="Map" resultMap="result.getContrInfo">
        SELECT
             DCH.EZUPTIME                       AS EZUPTIME
            ,DCH.EZUPTIMEZONE                   AS EZUPTIMEZONE
            ,DCH.DS_CONTR_PK                    AS DS_CONTR_PK
            ,DCH.DS_CONTR_STS_CD                AS DS_CONTR_STS_CD
            ,SCB.SVC_CONTR_BR_AUTO_EST_FLG      AS SVC_CONTR_BR_AUTO_EST_FLG
            ,DCH.CONTR_VRSN_EFF_FROM_DT         AS CONTR_VRSN_EFF_FROM_DT
            ,DCH.CONTR_VRSN_EFF_THRU_DT         AS CONTR_VRSN_EFF_THRU_DT
<!-- START 2018/07/02 T.Ogura [QC#26786,MOD] -->
<!--        ,CASE WHEN DCSV.DS_CONTR_STS_CD = #dsContrStsCdIsExpired# THEN 'Y' -->
<!--              WHEN DCSV.DS_CONTR_STS_CD = #dsContrStsCdIsCancelled# THEN 'Y' -->
<!--              WHEN DCSV.DS_CONTR_STS_CD = #dsContrStsCdIsTerminated# THEN 'Y' -->
<!--              WHEN DCSV.DS_CONTR_STS_CD = #dsContrStsCdIsApproved# THEN 'Y' -->
<!--              WHEN DCSV.DS_CONTR_STS_CD = #dsContrStsCdIsEffectived# THEN 'Y' -->
<!--              WHEN DCSV.CONTR_HLD_FLG   = 'Y' THEN 'Y' -->
<!--              WHEN DCSV.BLLG_HLD_FLG    = 'Y' THEN 'Y' -->
<!--              WHEN DCSV.MTR_HLD_FLG     = 'Y' THEN 'Y' -->
            ,CASE WHEN DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdIsCancelled# THEN 'Y'
                  WHEN DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdIsExpired# THEN 'Y'
                  WHEN DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdIsExpiredHold# THEN 'Y'
                  WHEN DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdIsTerminated# THEN 'Y'
                  WHEN DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdIsTerminatedHold# THEN 'Y'
<!-- END   2018/06/29 T.Ogura [QC#26786,MOD] -->
                  WHEN SCB.SVC_CONTR_BR_AUTO_EST_FLG = 'N' THEN 'Y'
                  WHEN DCH.CONTR_VRSN_EFF_FROM_DT &gt; #slsDt# THEN 'Y'
                  WHEN DCH.CONTR_VRSN_EFF_THRU_DT &lt; #slsDt# THEN 'Y'
                  ELSE 'N'
             END                                AS XX_DPLY_CTRL_FLG
            ,DCH.DS_CONTR_CATG_CD               AS DS_CONTR_CATG_CD
            ,DCH.DS_CONTR_NUM                   AS DS_CONTR_NUM
            ,TRIM(DCH.DS_CONTR_CATG_CD
                || '-' || DCH.DS_CONTR_NUM)     AS XX_SCR_ITEM_34_TXT
            ,STC.DS_ACCT_NM                     AS DS_ACCT_NM
            ,DCH.SVC_LINE_BIZ_CD                AS SVC_LINE_BIZ_CD
            ,DCH.SVC_CONTR_BR_CD                AS SVC_CONTR_BR_CD
            ,SCB.SVC_CONTR_BR_DESC_TXT          AS SVC_CONTR_BR_DESC_TXT
            ,TRIM(DCH.SVC_LINE_BIZ_CD 
                || NVL2(DCH.SVC_LINE_BIZ_CD, '-' || DCH.SVC_CONTR_BR_CD, DCH.SVC_CONTR_BR_CD)
                || NVL2(DCH.SVC_LINE_BIZ_CD || DCH.SVC_CONTR_BR_CD, '-' || SCB.SVC_CONTR_BR_DESC_TXT, SCB.SVC_CONTR_BR_DESC_TXT)) AS XX_GENL_FLD_AREA_TXT
            ,MET.MTR_EST_TP_CD                  AS MTR_EST_TP_CD
            ,MET.MTR_EST_TP_NM                  AS MTR_EST_TP_NM
        FROM
             DS_CONTR       DCH
            ,DS_CONTR_STS_V DCSV
            ,SELL_TO_CUST   STC
            ,SVC_CONTR_BR   SCB
            ,MTR_EST_TP     MET
        WHERE
                DCH.GLBL_CMPY_CD        = #glblCmpyCd#
            <iterate property="dsContrPkList" var="dsContrPk[]" open="AND DCH.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND DCH.EZCANCELFLAG        = '0'
            AND DCH.DS_CONTR_CATG_CD    &lt;&gt; #dsContrCatgCdIsWty#
            AND DCH.GLBL_CMPY_CD        = DCSV.GLBL_CMPY_CD
            AND DCH.DS_CONTR_PK         = DCSV.DS_CONTR_PK
            AND DCSV.EZCANCELFLAG       = '0'
            AND DCH.GLBL_CMPY_CD        = STC.GLBL_CMPY_CD    (+)
            AND DCH.DS_ACCT_NUM         = STC.SELL_TO_CUST_CD (+)
            AND STC.EZCANCELFLAG (+)    = '0'
            AND DCH.GLBL_CMPY_CD        = SCB.GLBL_CMPY_CD    (+)
            AND DCH.SVC_CONTR_BR_CD     = SCB.SVC_CONTR_BR_CD (+)
            AND SCB.EZCANCELFLAG (+)    = '0'
            AND DCH.GLBL_CMPY_CD        = MET.GLBL_CMPY_CD    (+)
            AND DCH.MTR_EST_TP_CD       = MET.MTR_EST_TP_CD   (+)
            AND MET.EZCANCELFLAG (+)    = '0'
            AND ROWNUM                  &lt; #limitCnt#
        ORDER BY
             DCH.DS_CONTR_CATG_CD ASC NULLS LAST
            ,DCH.DS_CONTR_NUM ASC NULLS LAST
    </statement>
    <resultMap id="result.getContrInfo" class="NSAL0650_ASMsg">
        <result property="ezUpTime_A1"           column="EZUPTIME"               javaType="EZDSStringItem" />
        <result property="ezUpTimeZone_A1"       column="EZUPTIMEZONE"           javaType="EZDSStringItem" />
        <result property="dsContrPk_A1"          column="DS_CONTR_PK"            javaType="EZDSBigDecimalItem" />
        <result property="dsContrStsCd_A1"       column="DS_CONTR_STS_CD"        javaType="EZDSStringItem" />
        <result property="contrVrsnEffFromDt_A1" column="CONTR_VRSN_EFF_FROM_DT" javaType="EZDSDateItem" />
        <result property="contrVrsnEffThruDt_A1" column="CONTR_VRSN_EFF_THRU_DT" javaType="EZDSDateItem" />
        <result property="svcContrBrAutoEstFlg_A1" column="SVC_CONTR_BR_AUTO_EST_FLG" javaType="EZDSStringItem" />
        <result property="xxDplyCtrlFlg_A1"      column="XX_DPLY_CTRL_FLG"       javaType="EZDSStringItem" />
        <result property="xxScrItem34Txt_A1"     column="XX_SCR_ITEM_34_TXT"     javaType="EZDSStringItem" />
        <result property="dsAcctNm_A1"           column="DS_ACCT_NM"             javaType="EZDSStringItem" />
        <result property="svcLineBizCd_A1"       column="SVC_LINE_BIZ_CD"        javaType="EZDSStringItem" />
        <result property="svcContrBrCd_A1"       column="SVC_CONTR_BR_CD"        javaType="EZDSStringItem" />
        <result property="svcContrBrDescTxt_A1"  column="SVC_CONTR_BR_DESC_TXT"  javaType="EZDSStringItem" />
        <result property="xxGenlFldAreaTxt_A1"   column="XX_GENL_FLD_AREA_TXT"   javaType="EZDSStringItem" />
        <result property="mtrEstTpCd_A1"         column="MTR_EST_TP_CD"          javaType="EZDSStringItem" />
        <result property="mtrEstTpNm_A1"         column="MTR_EST_TP_NM"          javaType="EZDSStringItem" />
    </resultMap>
</sqlMap>
