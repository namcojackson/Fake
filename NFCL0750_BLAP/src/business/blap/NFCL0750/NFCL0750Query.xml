<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NFCL0750Query">
    <typeAlias alias="NFCL0750_ASMsg"  type="business.blap.NFCL0750.NFCL0750_ASMsg"/>
    <statement id="getSearchData" parameterClass="Map" resultMap="result.getSearchData">
        SELECT
             AR_WRT_OFF_RQST_PK
            ,WRT_OFF_RQST_USR_ID
            ,WRT_OFF_RQST_GRP_CD
            ,AR_WRT_OFF_RQST_TP_CD
            ,AR_WRT_OFF_RQST_TP_DESC_TXT
            ,AR_ADJ_RSN_DESC_TXT
            ,AR_ADJ_TP_DESC_TXT
            ,AR_WRT_OFF_NOTE_TXT
            ,LOW_RMNG_BAL_AMT
            ,HIGH_RMNG_BAL_AMT
            ,LOW_INV_NUM
            ,HIGH_INV_NUM
            ,LOW_INV_DUE_DT
            ,HIGH_INV_DUE_DT
            ,LOW_DS_ACCT_NUM
            ,HIGH_DS_ACCT_NUM
            ,LOW_BILL_TO_CUST_CD
            ,HIGH_BILL_TO_CUST_CD
            ,INCL_CONSL_INV_FLG
            ,AR_DS_WF_STS_DESC_TXT
            ,WRT_OFF_ERR_MSG_TXT
            ,OPTION_VALUE
            ,WRT_OFF_APVL_USR_NM
        FROM
            (SELECT
                 A.AR_WRT_OFF_RQST_PK
                ,A.WRT_OFF_RQST_USR_ID
                ,A.WRT_OFF_RQST_GRP_CD
                ,A.AR_WRT_OFF_RQST_TP_CD
                ,D.AR_WRT_OFF_RQST_TP_DESC_TXT
                ,NVL(B.AR_ADJ_RSN_DESC_TXT, F.AR_WRT_OFF_NOTE_DESC_TXT) AS AR_ADJ_RSN_DESC_TXT
                ,C.AR_ADJ_TP_DESC_TXT
                ,A.AR_WRT_OFF_NOTE_TXT
                ,A.LOW_RMNG_BAL_AMT
                ,A.HIGH_RMNG_BAL_AMT
                ,A.LOW_INV_NUM
                ,A.HIGH_INV_NUM
                ,A.LOW_INV_DUE_DT
                ,A.HIGH_INV_DUE_DT
                ,A.LOW_DS_ACCT_NUM
                ,A.HIGH_DS_ACCT_NUM
                ,A.LOW_BILL_TO_CUST_CD
                ,A.HIGH_BILL_TO_CUST_CD
                ,A.INCL_CONSL_INV_FLG
                ,E.AR_DS_WF_STS_DESC_TXT
                ,A.WRT_OFF_ERR_MSG_TXT
                ,CASE WHEN A.WRT_OFF_OPT_TP_CD = #wrtOffOptTpCdIsGenerateOnly# THEN #wrtOffOptTpCdIsGenerateOnlyNm#
                      WHEN A.WRT_OFF_OPT_TP_CD = #wrtOffOptTpCdIsCreateAdj#    THEN #wrtOffOptTpCdIsCreateAdjNm#
                      ELSE NULL END AS OPTION_VALUE
                ,A.WRT_OFF_APVL_USR_NM
            FROM
                 AR_WRT_OFF_RQST    A
                ,AR_ADJ_RSN         B
                ,AR_ADJ_TP          C
                ,AR_WRT_OFF_RQST_TP D
                ,AR_DS_WF_STS       E
                ,AR_WRT_OFF_NOTE    F
            WHERE
                    A.GLBL_CMPY_CD          = #cMsg.glblCmpyCd#
                AND A.EZCANCELFLAG          = '0'
                <isNotNull property="cMsg.cltDispTpCd_H">
                <isEqual  property = "cMsg.cltDispTpCd_H" compareValue="01">
                AND A.WRT_OFF_RQST_USR_ID   = #userID#
                </isEqual>
                <isEqual  property = "cMsg.cltDispTpCd_H" compareValue="02">
                AND A.WRT_OFF_RQST_USR_ID IN ( SELECT G.PSN_CD FROM S21_PSN G 
                                               START WITH G.GLBL_CMPY_CD      = #cMsg.glblCmpyCd#
                                                      AND G.PSN_NUM           = #myGroupId#
                                                      AND G.EZCANCELFLAG      = '0'
                                               CONNECT BY PRIOR G.PSN_NUM     = G.HR_SUPV_ID )
                </isEqual>
                </isNotNull>
                <isNotNull property="cMsg.wrtOffRqstUsrId_H">
                AND A.WRT_OFF_RQST_USR_ID   = #userID#
                </isNotNull>
                AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD(+)
                AND A.AR_ADJ_RSN_CD         = B.AR_ADJ_RSN_CD(+)
                AND B.EZCANCELFLAG(+)       = '0'
                AND A.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
                AND A.AR_ADJ_TP_CD          = C.AR_ADJ_TP_CD
                AND C.EZCANCELFLAG          = '0'
                AND A.GLBL_CMPY_CD          = D.GLBL_CMPY_CD
                AND A.AR_WRT_OFF_RQST_TP_CD = D.AR_WRT_OFF_RQST_TP_CD
                AND D.EZCANCELFLAG          = '0'
                AND A.GLBL_CMPY_CD          = E.GLBL_CMPY_CD
                AND A.AR_DS_WF_STS_CD       = E.AR_DS_WF_STS_CD
                AND E.EZCANCELFLAG          = '0'
                <isNotNull property="cMsg.wrtOffRqstGrpCd_H">
                AND A.WRT_OFF_RQST_GRP_CD   = #cMsg.wrtOffRqstGrpCd_H#
                </isNotNull>
                <isNotNull property="cMsg.arAdjRsnDescTxt_SV">
                AND A.AR_ADJ_RSN_CD         = #cMsg.arAdjRsnDescTxt_SV#
                </isNotNull>
                <isNotNull property="cMsg.arAdjTpDescTxt_SV">
                AND A.AR_ADJ_TP_CD          = #cMsg.arAdjTpDescTxt_SV#
                </isNotNull>
                <isNotNull property="cMsg.dsAcctNum_H">
                AND #cMsg.dsAcctNum_H# BETWEEN A.LOW_DS_ACCT_NUM AND A.HIGH_DS_ACCT_NUM
                </isNotNull>
                <isNotNull property="cMsg.arWrtOffRqstTpDescTxt_SV">
                AND A.AR_WRT_OFF_RQST_TP_CD = #cMsg.arWrtOffRqstTpDescTxt_SV#
                </isNotNull>
                <isEqual property="cMsg.xxChkBox_R" compareValue="Y">
                <isNotEqual property="cMsg.xxChkBox_A" compareValue="Y">
                AND A.WRT_OFF_OPT_TP_CD     = #wrtOffOptTpCdIsGenerateOnly#
                </isNotEqual>
                </isEqual>
                <isNotEqual property="cMsg.xxChkBox_R" compareValue="Y">
                <isEqual property="cMsg.xxChkBox_A" compareValue="Y">
                AND A.WRT_OFF_OPT_TP_CD     = #wrtOffOptTpCdIsCreateAdj#
                </isEqual>
                </isNotEqual>
                <isNotNull property="cMsg.arDsWfStsDescTxt_SV">
                AND A.AR_DS_WF_STS_CD       = #cMsg.arDsWfStsDescTxt_SV#
                </isNotNull>
                AND A.GLBL_CMPY_CD          = F.GLBL_CMPY_CD(+)
                AND A.AR_WRT_OFF_NOTE_CD    = F.AR_WRT_OFF_NOTE_CD(+)
                AND F.EZCANCELFLAG(+)       = '0'
                AND EXISTS(
                    SELECT
                          1
                    FROM
                         AR_WRT_OFF_RQST        AWOR
                        ,AR_WRT_OFF_RQST_RSLT   AWORR
                        ,AR_TRX_BAL             ATB
                        ,AR_ADJ                 AA
                    WHERE 
                            AWOR.GLBL_CMPY_CD       = A.GLBL_CMPY_CD
                        AND AWOR.AR_WRT_OFF_RQST_PK = A.AR_WRT_OFF_RQST_PK
                        AND AWOR.EZCANCELFLAG       = '0'
                        AND AWOR.GLBL_CMPY_CD       = AWORR.GLBL_CMPY_CD(+)
                        AND AWOR.AR_WRT_OFF_RQST_PK = AWORR.AR_WRT_OFF_RQST_PK(+)
                        AND AWORR.EZCANCELFLAG(+)   = '0'
                        AND AWORR.GLBL_CMPY_CD      = ATB.GLBL_CMPY_CD(+)
                        AND AWORR.AR_TRX_BAL_PK     = ATB.AR_TRX_BAL_PK(+)
                        AND ATB.EZCANCELFLAG(+)     = '0'
                        AND AWORR.GLBL_CMPY_CD      = AA.GLBL_CMPY_CD(+)
                        AND AWORR.AR_ADJ_NUM        = AA.AR_ADJ_NUM(+)
                        AND AA.EZCANCELFLAG(+)      = '0'
                        <isNotNull property="cMsg.xxFromDt_H">
                        AND NVL(AA.ADJ_DT, SUBSTR(AWOR.EZINTIME,1,8)) &gt;= #cMsg.xxFromDt_H#
                        </isNotNull>
                        <isNotNull property="cMsg.xxThruDt_H">
                        AND NVL(AA.ADJ_DT, SUBSTR(AWOR.EZINTIME,1,8)) &lt;= #cMsg.xxThruDt_H#
                        </isNotNull>
                    )
            ORDER BY
                A.WRT_OFF_RQST_GRP_CD DESC NULLS LAST
            )
        WHERE
            ROWNUM                  &lt;= #limitCnt#
     
    </statement>
    <resultMap id="result.getSearchData"  class="NFCL0750_ASMsg">
        <result property="arWrtOffRqstPk_A"          column="AR_WRT_OFF_RQST_PK"              javaType="EZDSBigDecimalItem"/>
        <result property="wrtOffRqstUsrId_A"         column="WRT_OFF_RQST_USR_ID"             javaType="EZDSStringItem"/>
        <result property="wrtOffRqstGrpCd_A"         column="WRT_OFF_RQST_GRP_CD"             javaType="EZDSStringItem"/>
        <result property="arWrtOffRqstTpCd_A"        column="AR_WRT_OFF_RQST_TP_CD"           javaType="EZDSStringItem"/>
        <result property="arWrtOffRqstTpDescTxt_A"   column="AR_WRT_OFF_RQST_TP_DESC_TXT"     javaType="EZDSStringItem"/>
        <result property="xxScrItem30Txt_A"          column="OPTION_VALUE"                    javaType="EZDSStringItem"/>
        <result property="arAdjRsnDescTxt_A"         column="AR_ADJ_RSN_DESC_TXT"             javaType="EZDSStringItem"/>
        <result property="arAdjTpDescTxt_A"          column="AR_ADJ_TP_DESC_TXT"              javaType="EZDSStringItem"/>
        <result property="arWrtOffNoteTxt_A"         column="AR_WRT_OFF_NOTE_TXT"              javaType="EZDSStringItem"/>
        <result property="lowRmngBalAmt_A"           column="LOW_RMNG_BAL_AMT"                javaType="EZDSBigDecimalItem"/>
        <result property="highRmngBalAmt_A"          column="HIGH_RMNG_BAL_AMT"               javaType="EZDSBigDecimalItem"/>
        <result property="lowInvNum_A"               column="LOW_INV_NUM"                     javaType="EZDSStringItem"/>
        <result property="highInvNum_A"              column="HIGH_INV_NUM"                    javaType="EZDSStringItem"/>
        <result property="lowInvDueDt_A"             column="LOW_INV_DUE_DT"                  javaType="EZDSDateItem"/>
        <result property="highInvDueDt_A"            column="HIGH_INV_DUE_DT"                 javaType="EZDSDateItem"/>
        <result property="lowDsAcctNum_A"            column="LOW_DS_ACCT_NUM"                 javaType="EZDSStringItem"/>
        <result property="highDsAcctNum_A"           column="HIGH_DS_ACCT_NUM"                javaType="EZDSStringItem"/>
        <result property="lowBillToCustCd_A"         column="LOW_BILL_TO_CUST_CD"             javaType="EZDSStringItem"/>
        <result property="highBillToCustCd_A"        column="HIGH_BILL_TO_CUST_CD"            javaType="EZDSStringItem"/>
        <result property="inclConslInvFlg_A"         column="INCL_CONSL_INV_FLG"              javaType="EZDSStringItem"/>
        <result property="arDsWfStsDescTxt_A"        column="AR_DS_WF_STS_DESC_TXT"           javaType="EZDSStringItem"/>
        <result property="wrtOffApvlUsrNm_A"         column="WRT_OFF_APVL_USR_NM"             javaType="EZDSStringItem"/>
        <result property="wrtOffErrMsgTxt_A"         column="WRT_OFF_ERR_MSG_TXT"             javaType="EZDSStringItem"/>
    </resultMap>
</sqlMap>
