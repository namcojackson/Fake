<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NPAL1210Query">
    <typeAlias alias="NPAL1210CMsg" type="business.blap.NPAL1210.NPAL1210CMsg" />

    <statement id="search" parameterClass="Map" resultClass="Map">
        SELECT
            A.TRX_REF_NUM
            ,A.APVL_BY_PSN_CD
            ,A.APVL_FULL_PSN_NM
            ,A.APVL_HIST_INFO_TS
            ,A.APVL_HIST_TXT
            ,A.APVL_HIST_SRC_TP_DESC_TXT
            ,A.APVL_HIST_ACT_TP_DESC_TXT
        FROM
            (SELECT
                AHI.TRX_REF_NUM
                ,AHI.APVL_BY_PSN_CD
                ,AHI.APVL_FULL_PSN_NM
                ,AHI.APVL_HIST_INFO_TS
                ,AHI.APVL_HIST_TXT
                ,AHST.APVL_HIST_SRC_TP_DESC_TXT
                ,AHAT.APVL_HIST_ACT_TP_DESC_TXT
            FROM
                APVL_HIST_INFO AHI
                ,APVL_HIST_SRC_TP AHST
                ,APVL_HIST_ACT_TP AHAT
            WHERE
                AHI.GLBL_CMPY_CD = #glblCmpyCd#
                AND AHI.EZCANCELFLAG = '0'
                AND AHI.APVL_HIST_SRC_TP_CD = #cMsg.apvlHistSrcTpCd#
                AND AHI.TRX_REF_NUM = #cMsg.trxRefNum#
                AND AHI.GLBL_CMPY_CD = AHST.GLBL_CMPY_CD(+)
                AND AHI.APVL_HIST_SRC_TP_CD = AHST.APVL_HIST_SRC_TP_CD(+)
                AND AHST.EZCANCELFLAG(+) = '0'
                AND AHI.GLBL_CMPY_CD = AHAT.GLBL_CMPY_CD(+)
                AND AHI.APVL_HIST_ACT_TP_CD = AHAT.APVL_HIST_ACT_TP_CD(+)
                AND AHAT.EZCANCELFLAG(+) = '0'
            ORDER BY
                AHI.TRX_REF_NUM ASC
                ,AHI.APVL_HIST_INFO_TS DESC
                ,AHAT.APVL_HIST_ACT_TP_SORT_NUM DESC) A
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>
</sqlMap>