<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NFDB004001">

    <statement id="getWorkItemTran" parameterClass="Map" resultClass="Map">
        SELECT
             CST.CLT_STRGY_TRX_PK
            ,CST.CLT_ACCT_CD
            ,CST.BILL_TO_CUST_CD
            ,CSWIT.CLT_STRGY_WRK_ITEM_TRX_PK
            ,BTC.LOC_NUM
            ,BTC.BILL_TO_CUST_PK
         FROM
             CLT_STRGY_TRX CST
            ,CLT_STRGY_WRK_ITEM_TRX CSWIT
            ,BILL_TO_CUST BTC
         WHERE
                  CST.GLBL_CMPY_CD                 = #glblCmpyCd#
           AND    CST.CLT_STRGY_STS_CD             = #cltStrgyStsCd#
           AND    CST.CLT_STRGY_CUR_FLG            = #flgY#
           AND    CSWIT.CLT_WRK_ITEM_RWSD_DT   &lt;= #batProcDt#
           AND    CSWIT.CLT_WRK_ITEM_CD            = #cltWrkItemCd#
           AND    CSWIT.CLT_WRK_ITEM_STS_CD        IN(#cltWrkItemStsCd#, #wrkItmStsOpen#)
           AND    CST.GLBL_CMPY_CD                 = CSWIT.GLBL_CMPY_CD
           AND    CST.CLT_STRGY_TRX_PK             = CSWIT.CLT_STRGY_TRX_PK
           AND    CST.GLBL_CMPY_CD                 = BTC.GLBL_CMPY_CD
           AND    CST.BILL_TO_CUST_CD              = BTC.BILL_TO_CUST_CD
           AND    CST.EZCANCELFLAG                 = '0'
           AND    CSWIT.EZCANCELFLAG               = '0'
           AND    BTC.EZCANCELFLAG                 = '0'
           <!-- QC#18754 ADD start -->
           AND    NOT EXISTS (
                              SELECT
                                   CSWIT2.CLT_STRGY_WRK_ITEM_TRX_PK
                              FROM
                                   CLT_STRGY_WRK_ITEM_TRX CSWIT2
                              WHERE
                                   CSWIT2.GLBL_CMPY_CD          = CST.GLBL_CMPY_CD
                              AND  CSWIT2.EZCANCELFLAG          = '0'
                              AND  CSWIT2.CLT_STRGY_TRX_PK      = CST.CLT_STRGY_TRX_PK
                              AND  CSWIT2.CLT_WRK_ITEM_RWSD_DT  &lt; CSWIT.CLT_WRK_ITEM_RWSD_DT
                              AND  CSWIT2.CLT_WRK_ITEM_STS_CD   IN(#cltWrkItemStsCd#, #wrkItmStsOpen#)
                              AND  CSWIT2.CLT_WRK_TP_CD         = #wrkTpCd#
                              )
           <!-- QC#18754 ADD end -->
         ORDER BY
                  CSWIT.CLT_STRGY_TRX_PK
                 ,CSWIT.CLT_STRGY_WRK_ITEM_TRX_PK
    </statement>

</sqlMap>
