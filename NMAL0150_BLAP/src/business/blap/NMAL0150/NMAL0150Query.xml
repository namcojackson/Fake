<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NMAL0150Query">

    <statement id ="getCostTypeList" parameterClass="Map"  resultClass="Map">
        SELECT 
            T.MDSE_CST_UPD_TP_CD 
           ,T.MDSE_CST_UPD_TP_NM
        FROM 
            MDSE_CST_UPD_TP T
        WHERE 
            T.EZCANCELFLAG = '0'
        AND T.GLBL_CMPY_CD = #glblCmpyCd#
        <isNotNull property="manCratFlg">
        AND T.MAN_CRAT_FLG = 'Y'
        </isNotNull>
        ORDER BY MDSE_CST_UPD_TP_SORT_NUM
    </statement>

    <statement id ="getPkgUomPullDownList" parameterClass="Map"  resultClass="Map">
        SELECT 
            PU.PKG_UOM_CD 
           ,PU.PKG_UOM_DESC_TXT PKG_UOM_NM
        FROM 
            PKG_UOM PU
        WHERE 
            PU.EZCANCELFLAG = '0'
        AND PU.GLBL_CMPY_CD = #glblCmpyCd#
        AND PU.PKG_UOM_STD_FLG = 'Y'
        ORDER BY PU.PKG_UOM_SORT_NUM
    </statement>

    <!-- mod start 2022/05/30 QC#55970 -->
    <!-- <statement id ="getMdseCstUpdDetail" parameterClass="Map"  resultClass="Map"> -->
    <statement id ="getMdseCstUpdDetail" parameterClass="Map"  resultMap="result.getMdseCstUpdDetail">
    <!-- mod end 2022/05/30 QC#55970 -->
        SELECT * FROM (
		SELECT
		    D.MDSE_CST_UPD_HIST_HDR_PK
		   ,D.MDSE_CD
		   ,M.MDSE_DESC_SHORT_TXT
		   ,MIP.MDSE_ITEM_TP_NM
		   ,M.COA_MDSE_TP_CD || ':' || CP.COA_PROJ_DESC_TXT COA_PROJ_DESC_TXT
		   ,M.COA_PROD_CD
		   ,D.RQST_TOT_STD_COST_AMT
		   <!--  ,D.PKG_UOM_CD -->
           ,PUC.BASE_PKG_UOM_CD PKG_UOM_CD
		   ,D.MDSE_CST_UPD_EFF_FROM_DT
		   ,MCUS.MDSE_CST_UPD_STS_NM
		   ,D.EZUPTIME
		   ,D.EZUPTIMEZONE
		   <!-- QC#2872 -->
           ,D.EZINTIME    AS XX_REC_HIST_CRAT_TS
           ,D.EZINUSERID  AS XX_REC_HIST_CRAT_BY_NM
           ,D.EZUPTIME    AS XX_REC_HIST_UPD_TS
           ,D.EZUPUSERID  AS XX_REC_HIST_UPD_BY_NM
           ,D.EZTABLEID   AS XX_REC_HIST_TBL_NM
		FROM
		    MDSE_CST_UPD_HIST_DTL D
		   ,MDSE M
		   ,MDSE_ITEM_TP MIP
		   ,MDSE_CST_UPD_STS MCUS
           ,PKG_UOM_CLS PUC
           ,COA_PROJ CP
		WHERE
		    D.EZCANCELFLAG = '0'
		AND D.GLBL_CMPY_CD = #glblCmpyCd#
		AND D.MDSE_CST_UPD_HIST_HDR_PK = #mdseCstUpdHistHdrPk#
		AND D.EZCANCELFLAG = M.EZCANCELFLAG
		AND D.GLBL_CMPY_CD = M.GLBL_CMPY_CD
		AND D.MDSE_CD = M.MDSE_CD
		AND M.EZCANCELFLAG = MIP.EZCANCELFLAG (+)
		AND M.GLBL_CMPY_CD = MIP.GLBL_CMPY_CD (+)
		AND M.MDSE_ITEM_TP_CD = MIP.MDSE_ITEM_TP_CD (+)
		AND D.EZCANCELFLAG = MCUS.EZCANCELFLAG (+)
		AND D.GLBL_CMPY_CD = MCUS.GLBL_CMPY_CD (+)
		AND D.MDSE_CST_UPD_STS_CD = MCUS.MDSE_CST_UPD_STS_CD (+)
        AND M.EZCANCELFLAG = PUC.EZCANCELFLAG (+)
        AND M.GLBL_CMPY_CD = PUC.GLBL_CMPY_CD (+)
        AND M.PKG_UOM_CLS_CD = PUC.PKG_UOM_CLS_CD (+)
        AND M.EZCANCELFLAG = CP.EZCANCELFLAG (+)
        AND M.GLBL_CMPY_CD = CP.GLBL_CMPY_CD (+)
        AND M.COA_MDSE_TP_CD = CP.COA_PROJ_CD (+)
		) TMP
		WHERE ROWNUM &lt;= #rowNum#
    </statement>

    <statement id ="getMdseInfoForBomTable" parameterClass="Map"  resultClass="Map">
        SELECT 
            M.MDSE_CD
           ,M.MDSE_DESC_SHORT_TXT
           ,MIT.MDSE_ITEM_TP_NM 
           ,M.COA_MDSE_TP_CD || ':' || CMT.COA_PROJ_DESC_TXT COA_PROJ_DESC_TXT
           ,M.COA_PROD_CD
           ,PUC.BASE_PKG_UOM_CD
        FROM
            MDSE M
           ,MDSE_ITEM_TP MIT
           ,COA_PROJ CMT
           ,PKG_UOM_CLS PUC
        WHERE 
            M.EZCANCELFLAG = '0'
        AND M.GLBL_CMPY_CD = #glblCmpyCd#
        AND M.MDSE_CD = #mdseCd#
        AND M.EZCANCELFLAG = MIT.EZCANCELFLAG (+)
        AND M.GLBL_CMPY_CD = MIT.GLBL_CMPY_CD (+)
        AND M.MDSE_ITEM_TP_CD = MIT.MDSE_ITEM_TP_CD (+)
        AND M.EZCANCELFLAG = CMT.EZCANCELFLAG (+)
        AND M.GLBL_CMPY_CD = CMT.GLBL_CMPY_CD (+)
        AND M.COA_MDSE_TP_CD = CMT.COA_PROJ_CD (+)
        AND M.EZCANCELFLAG = PUC.EZCANCELFLAG (+)
        AND M.GLBL_CMPY_CD = PUC.GLBL_CMPY_CD (+)
        AND M.PKG_UOM_CLS_CD = PUC.PKG_UOM_CLS_CD (+)
    </statement>

    <statement id ="getCostUpdateGroupCount" parameterClass="Map" resultClass="Integer">
        SELECT
            count(*)
        FROM 
            MDSE_CST_UPD_HIST_HDR H
        WHERE
            H.EZCANCELFLAG = '0'
        AND H.GLBL_CMPY_CD = #glblCmpyCd#
        AND H.MDSE_CST_UPD_GRP_TXT = #mdseCstUpdGrpTxt#
        <isNotNull property="mdseCstUpdHistHdrPk">
        AND H.MDSE_CST_UPD_HIST_HDR_PK &lt;&gt; #mdseCstUpdHistHdrPk#
        </isNotNull>
    </statement>
    <statement id ="getStdCostExistsCount" parameterClass="Map" resultClass="Integer">
        SELECT
            count(*)
        FROM 
            MDSE_CST_UPD_HIST_HDR H
           ,MDSE_CST_UPD_HIST_DTL D
        WHERE
            H.EZCANCELFLAG = '0'
        AND H.GLBL_CMPY_CD = #glblCmpyCd#
        AND H.EZCANCELFLAG = D.EZCANCELFLAG
        AND H.GLBL_CMPY_CD = D.GLBL_CMPY_CD
        AND H.MDSE_CST_UPD_HIST_HDR_PK = D.MDSE_CST_UPD_HIST_HDR_PK
        AND D.MDSE_CD = #mdseCd#
        AND H.MDSE_CST_UPD_TP_CD = 'SC'
        <isNotNull property="mdseCstUpdHistHdrPk">
        AND H.MDSE_CST_UPD_HIST_HDR_PK &lt;&gt; #mdseCstUpdHistHdrPk#
        </isNotNull>
    </statement>
    
    <statement id ="getItemCostStatusExistsCount" parameterClass="Map" resultClass="Integer">
        SELECT
            count(*)
        FROM 
            MDSE_CST_UPD_HIST_HDR H
           ,MDSE_CST_UPD_HIST_DTL D
           ,MDSE_CST_UPD_TP T
        WHERE
            H.EZCANCELFLAG = '0'
        AND H.GLBL_CMPY_CD = #glblCmpyCd#
        AND H.EZCANCELFLAG = D.EZCANCELFLAG
        AND H.GLBL_CMPY_CD = D.GLBL_CMPY_CD
        AND H.MDSE_CST_UPD_HIST_HDR_PK = D.MDSE_CST_UPD_HIST_HDR_PK
        AND D.MDSE_CD = #mdseCd#
        AND H.EZCANCELFLAG = T.EZCANCELFLAG
        AND H.GLBL_CMPY_CD = T.GLBL_CMPY_CD
        AND H.MDSE_CST_UPD_TP_CD = T.MDSE_CST_UPD_TP_CD
        AND D.MDSE_CST_UPD_STS_CD IN ('AP','PE')
        AND T.STD_COST_RELN_FLG = #stdCostRelnFlg#
        <isNotNull property="mdseCstUpdHistHdrPk">
        AND H.MDSE_CST_UPD_HIST_HDR_PK &lt;&gt; #mdseCstUpdHistHdrPk#
        </isNotNull>
    </statement>

    <!-- add start 2022/05/30 QC#55970 -->
    <typeAlias alias="NMAL0150_ASMsg"    type="business.blap.NMAL0150.NMAL0150_ASMsg"/>
    <resultMap id="result.getMdseCstUpdDetail"     class="NMAL0150_ASMsg">
        <result property="mdseCd_A1"               column="MDSE_CD"                   javaType="EZDCStringItem"      />
        <result property="mdseCd_AB"               column="MDSE_CD"                   javaType="EZDCStringItem"      />
        <result property="mdseDescShortTxt_A1"     column="MDSE_DESC_SHORT_TXT"       javaType="EZDCStringItem"      />
        <result property="mdseItemTpNm_A1"         column="MDSE_ITEM_TP_NM"           javaType="EZDCStringItem"      />
        <result property="xxScrItem54Txt_A1"       column="COA_PROJ_DESC_TXT"         javaType="EZDCStringItem"      />
        <result property="coaProdCd_A1"            column="COA_PROD_CD"               javaType="EZDCStringItem"      />
        <result property="rqstTotStdCostAmt_A1"    column="RQST_TOT_STD_COST_AMT"     javaType="EZDCBigDecimalItem"  />
        <result property="pkgUomCd_A1"             column="PKG_UOM_CD"                javaType="EZDCStringItem"      />
        <result property="mdseCstUpdEffFromDt_A1"  column="MDSE_CST_UPD_EFF_FROM_DT"  javaType="EZDCStringItem"      />
        <result property="mdseCstUpdStsNm_A1"      column="MDSE_CST_UPD_STS_NM"       javaType="EZDCStringItem"      />
        <result property="ezUpTime_A1"             column="MDSE_CST_UPD_STS_NM"       javaType="EZDCStringItem"      />
        <result property="ezUpTimeZone_A1"         column="MDSE_CST_UPD_STS_CD"       javaType="EZDCStringItem"      />
        <result property="xxRecHistCratTs_A1"      column="XX_REC_HIST_CRAT_TS"       javaType="EZDCStringItem"      />
        <result property="xxRecHistCratByNm_A1"    column="XX_REC_HIST_CRAT_BY_NM"    javaType="EZDCStringItem"      />
        <result property="xxRecHistUpdTs_A1"       column="XX_REC_HIST_UPD_TS"        javaType="EZDCStringItem"      />
        <result property="xxRecHistUpdByNm_A1"     column="XX_REC_HIST_UPD_BY_NM"     javaType="EZDCStringItem"      />
        <result property="xxRecHistTblNm_A1"       column="XX_REC_HIST_TBL_NM"        javaType="EZDCStringItem"      />
    </resultMap>
    <!-- add end 2022/05/30 QC#55970 -->
</sqlMap>
