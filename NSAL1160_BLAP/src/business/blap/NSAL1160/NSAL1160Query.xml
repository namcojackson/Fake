<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL1160Query">

    <statement id="getSearchHeaderInfo" parameterClass="Map" resultClass="Map">
        SELECT
                  DC.DS_CONTR_NUM
                 ,STC.SELL_TO_CUST_CD AS DS_ACCT_NUM
                 ,STC.DS_ACCT_NM

        FROM
                  DS_CONTR DC
                 ,SELL_TO_CUST STC
        WHERE
                DC.GLBL_CMPY_CD            = #glblCmpyCd#
                AND DC.DS_CONTR_PK         = #dsContrPk#
                AND DC.EZCANCELFLAG        = '0'
                AND DC.GLBL_CMPY_CD        = STC.GLBL_CMPY_CD
                AND STC.SELL_TO_CUST_CD    = #shipToCustAcctCd#
                AND STC.EZCANCELFLAG       = '0'
    </statement>

    <typeAlias alias="NSAL1160CMsg"      type="business.blap.NSAL1160.NSAL1160CMsg"/>
    <typeAlias alias="NSAL1160_ASMsg"    type="business.blap.NSAL1160.NSAL1160_ASMsg"/>
    <statement id="getSearchNotesInfo" parameterClass="Map" resultMap="result.getSearchNotesInfo">
       SELECT
           A.*
        FROM (
            SELECT
                 SSAA.CRAT_DT
                ,SSAA.PROC_DT
                ,SSAA.ABUSE_ACT_CMNT_TXT
                ,AP.FIRST_NM||' '||AP.LAST_NM AS PSN_NM
                ,AA.ABUSE_ACT_DESC_TXT

            FROM
                SVC_SPLY_ABUSE_ACT SSAA
                ,AUTH_PSN AP
                ,ABUSE_ACT AA
            WHERE
                    SSAA.GLBL_CMPY_CD                         = #glblCmpyCd#
                    AND SSAA.DS_CONTR_PK                      = #dsContrPk#
                    AND SSAA.SHIP_TO_CUST_ACCT_CD             = #shipToCustAcctCd#
                    AND SSAA.SVC_PGM_MDSE_CD                  = #svcPgmMdseCd#
                    AND SSAA.CRAT_DT                      &gt;= #procDtAf#
                    AND SSAA.CRAT_DT                      &lt;= #procDtAt#
                    AND SSAA.EZCANCELFLAG                     = '0'
                    AND SSAA.GLBL_CMPY_CD                     = AP.GLBL_CMPY_CD
                    AND SSAA.CRAT_USR_ID                      = AP.USR_NM
                    AND AP.EZCANCELFLAG                       = '0'
                    AND SSAA.GLBL_CMPY_CD                     = AA.GLBL_CMPY_CD
                    AND SSAA.ABUSE_ACT_CD                     = AA.ABUSE_ACT_CD 
                    AND AA.EZCANCELFLAG                       = '0'

            ORDER BY
                 SSAA.CRAT_DT    DESC
                ,SSAA.PROC_DT    DESC
                ,SSAA.EZUPTIME   DESC
       ) A
       WHERE
           ROWNUM                          &lt;=   #limitCount#
    </statement>

    <resultMap id="result.getSearchNotesInfo" class="NSAL1160_ASMsg">
        <result property="cratDt_DA"             column="CRAT_DT"                 javaType="EZDSStringItem"/>
        <result property="procDt_DA"             column="PROC_DT"                 javaType="EZDSStringItem"/>
        <result property="xxScrItem61Txt_A"      column="PSN_NM"                  javaType="EZDSStringItem"/>
        <result property="abuseActDescTxt"       column="ABUSE_ACT_DESC_TXT"      javaType="EZDSStringItem"/>
        <result property="abuseActCmntTxt"       column="ABUSE_ACT_CMNT_TXT"      javaType="EZDSStringItem"/>
    </resultMap>

    <typeAlias alias="NSAL1160_BSMsg"    type="business.blap.NSAL1160.NSAL1160_BSMsg"/>
    <statement id="getSearchWorkflowActionsInfo" parameterClass="Map" resultMap="result.getSearchWorkflowActionsInfo">
       SELECT
           A.*
        FROM (
            SELECT
                  SUBSTR(SM.EZINTIME,0,8)                     AS  EZINTIME
                 ,SUBSTR(SM.LAST_UPD_TS,0,8)                  AS  LAST_UPD_TS
                 ,REPLACE(REPLACE(SM.SVC_CMNT_TXT, chr(13),''),chr(10),'') AS SVC_CMNT_TXT
                 ,SMT.SVC_MEMO_TP_DESC_TXT
            FROM
                SVC_MEMO      SM
                ,SELL_TO_CUST STC
                ,SVC_MEMO_TP  SMT
            WHERE
                    SM.GLBL_CMPY_CD                           = #glblCmpyCd#
                    AND SM.DS_CONTR_PK                        = #dsContrPk#
                    AND SM.SVC_MEMO_TRX_NM                    = #svcMemoTrxNm#
                    AND SM.LAST_UPD_TS                    &gt;= #lastUpdTsBf#||'000000000'
                    AND SM.LAST_UPD_TS                    &lt;= #lastUpdTsBt#||'235959999'
                    AND SM.EZCANCELFLAG                       = '0'
                    AND SM.GLBL_CMPY_CD                       = STC.GLBL_CMPY_CD
                    AND SM.SVC_MEMO_TRX_NUM                   = STC.SELL_TO_CUST_CD
                    AND STC.SELL_TO_CUST_CD                   = #shipToCustAcctCd#
                    AND STC.EZCANCELFLAG                      = '0'
                    AND SM.GLBL_CMPY_CD                       = SMT.GLBL_CMPY_CD
                    AND SM.SVC_MEMO_TP_CD                     = SMT.SVC_MEMO_TP_CD
                    AND SMT.EZCANCELFLAG                      = '0'
            ORDER BY
                 SM.EZINTIME     DESC
                ,SM.LAST_UPD_TS  DESC
       ) A
       WHERE
         ROWNUM                          &lt;=   #limitCount#
    </statement>

    <resultMap id="result.getSearchWorkflowActionsInfo" class="NSAL1160_BSMsg">
        <result property="procDt_D1"             column="EZINTIME"                  javaType="EZDSStringItem"/>
        <result property="procDt_D2"             column="LAST_UPD_TS"               javaType="EZDSStringItem"/>
        <result property="svcMemoTpDescTxt"      column="SVC_MEMO_TP_DESC_TXT"      javaType="EZDSStringItem"/>
        <result property="svcCmntTxt"            column="SVC_CMNT_TXT"              javaType="EZDSStringItem"/>
    </resultMap>

    <typeAlias alias="NSAL1160_CSMsg"    type="business.blap.NSAL1160.NSAL1160_CSMsg"/>
    <statement id="getSearchEnforcementActions" parameterClass="Map" resultMap="result.getSearchEnforcementActions">
       SELECT
           A.*
        FROM (
            SELECT
                  SSAA.CRAT_DT
                 ,SSAA.SVC_SPLY_EXPR_DT
                 ,AP.FIRST_NM||' '||AP.LAST_NM AS PSN_NM
                 ,AOR.ABUSE_OVWRT_RSN_DESC_TXT 

            FROM
                SVC_SPLY_ABUSE_ACT    SSAA
                ,SVC_SPLY_ABUSE_STAGE SSAS
                ,AUTH_PSN             AP
                ,ABUSE_OVWRT_RSN      AOR
            WHERE
                    SSAA.GLBL_CMPY_CD                         = #glblCmpyCd#
                    AND SSAA.DS_CONTR_PK                      = #dsContrPk#
                    AND SSAA.SHIP_TO_CUST_ACCT_CD             = #shipToCustAcctCd#
                    AND SSAA.SVC_PGM_MDSE_CD                  = #svcPgmMdseCd#
                    AND SSAA.CRAT_DT                      &gt;= #cratDtCf#
                    AND SSAA.CRAT_DT                      &lt;= #cratDtCt#
                    AND SSAA.EZCANCELFLAG                     = '0'
                    AND SSAA.GLBL_CMPY_CD                     = SSAS.GLBL_CMPY_CD
                    AND SSAA.SVC_SPLY_ABUSE_STAGE_PK          = SSAS.SVC_SPLY_ABUSE_STAGE_PK
                    AND SSAS.EZCANCELFLAG                     = '0'
                    AND SSAA.GLBL_CMPY_CD                     = AP.GLBL_CMPY_CD(+)
                    AND SSAA.APVL_USR_ID                      = AP.USR_NM(+)
                    AND AP.EZCANCELFLAG(+)                    = '0'
                    <!-- START 2017/07/26 U.Kim [QC#18316, MOD] -->
                    <!-- AND SSAS.GLBL_CMPY_CD                     = AOR.GLBL_CMPY_CD -->
                    <!-- AND SSAS.ABUSE_OVWRT_RSN_CD               = AOR.ABUSE_OVWRT_RSN_CD -->
                    AND SSAA.ABUSE_OVWRT_RSN_CD               = AOR.ABUSE_OVWRT_RSN_CD
                    <!-- END 2017/07/26 U.Kim [QC#18316, MOD] -->
                    AND AOR.EZCANCELFLAG                      = '0'
            ORDER BY
                 SSAA.CRAT_DT           DESC
                ,SSAA.SVC_SPLY_EXPR_DT  DESC NULLS LAST
                ,SSAA.EZUPTIME          DESC
       ) A
       WHERE
           ROWNUM                          &lt;=   #limitCount#

    </statement>

    <resultMap id="result.getSearchEnforcementActions" class="NSAL1160_CSMsg">
        <result property="cratDt"                 column="CRAT_DT"                    javaType="EZDSStringItem"/>
        <result property="svcSplyExprDt"          column="SVC_SPLY_EXPR_DT"           javaType="EZDSStringItem"/>
        <result property="xxScrItem61Txt_C"       column="PSN_NM"                     javaType="EZDSStringItem"/>
        <result property="abuseOvwrtRsnDescTxt"   column="ABUSE_OVWRT_RSN_DESC_TXT"   javaType="EZDSStringItem"/>
    </resultMap>
</sqlMap>
