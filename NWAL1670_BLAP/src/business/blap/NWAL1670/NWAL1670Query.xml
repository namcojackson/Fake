<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NWAL1670Query">
    <typeAlias alias="NWAL1670_ASMsg" type="business.blap.NWAL1670.NWAL1670_ASMsg"/>
    <typeAlias alias="NWAL1670_BCMsg" type="business.blap.NWAL1670.NWAL1670_BCMsg"/>
    <typeAlias alias="NWAL1670_CSMsg" type="business.blap.NWAL1670.NWAL1670_CSMsg"/>
    <statement id="getSearchData" parameterClass="Map" resultMap="result.getSearchData">
        SELECT
             ORD_TEAM_MSTR_HDR_PK
            ,ORD_TEAM_MSTR_NM
            ,ORD_ZN_CD
            ,EFF_FROM_DT
            ,EFF_THRU_DT
            ,EZUPTIME
            ,EZUPTIMEZONE
            ,ROWNUM AS XX_ROW_NUM
        FROM
            (
            SELECT
                 OTH.ORD_TEAM_MSTR_HDR_PK
                ,OTH.ORD_TEAM_MSTR_NM
                ,OTH.ORD_ZN_CD
                ,OTH.EFF_FROM_DT
                ,OTH.EFF_THRU_DT
                ,OTH.EZUPTIME
                ,OTH.EZUPTIMEZONE
            FROM
                 ORD_TEAM_MSTR_HDR  OTH
                ,ORD_ZN             OZN
            WHERE
                    OTH.GLBL_CMPY_CD        = #glblCmpyCd#
                <isNotNull property="ordTeamMstrNm">
                AND OTH.ORD_TEAM_MSTR_NM LIKE #ordTeamMstrNm#
                </isNotNull>
                <isNotNull property="ordZnCd">
                AND OTH.ORD_ZN_CD           = #ordZnCd#
                </isNotNull>
                <isNotNull property="xxChkBox">
                AND OTH.EFF_FROM_DT        &lt;= #slsDt#
                AND (OTH.EFF_THRU_DT IS NULL
                        OR OTH.EFF_THRU_DT &gt;= #slsDt#)
                </isNotNull>
                AND OTH.EZCANCELFLAG        = '0'
                AND OTH.GLBL_CMPY_CD        = OZN.GLBL_CMPY_CD
                AND OTH.ORD_ZN_CD           = OZN.ORD_ZN_CD
                AND OZN.EZCANCELFLAG        = '0'
            ORDER BY
                 OZN.ORD_ZN_DESC_TXT    ASC
                ,OTH.ORD_TEAM_MSTR_NM   ASC
            )
        WHERE
            ROWNUM &lt;= #limitCnt#
    </statement>
    <resultMap id="result.getSearchData"       class="NWAL1670_ASMsg">
        <result property="ordTeamMstrHdrPk_A"  column="ORD_TEAM_MSTR_HDR_PK" javaType="EZDSBigDecimalItem"/>
        <result property="ordTeamMstrNm_A"     column="ORD_TEAM_MSTR_NM"     javaType="EZDSStringItem"/>
        <result property="ordZnCd_A"           column="ORD_ZN_CD"            javaType="EZDCStringItem"/>
        <result property="effFromDt_A"         column="EFF_FROM_DT"          javaType="EZDSDateItem"/>
        <result property="effThruDt_A"         column="EFF_THRU_DT"          javaType="EZDSDateItem"/>
        <result property="ezUpTime_A"          column="EZUPTIME"             javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_A"      column="EZUPTIMEZONE"         javaType="EZDSStringItem"/>
        <result property="xxRowNum_A"          column="XX_ROW_NUM"           javaType="EZDSBigDecimalItem"/>
    </resultMap>
    <statement id="getMemberData" parameterClass="Map" resultMap="result.getMemberData">
        SELECT
             ROWNUM AS XX_ROW_NUM
            ,ORD_TEAM_MSTR_DTL_PK
            ,ORD_TEAM_ATTRB_TP_CD
            ,ORD_TEAM_ATTRB_VAL_TXT
            ,FULL_PSN_NM
            ,EZUPTIME
            ,EZUPTIMEZONE
        FROM (
            SELECT
                 OTD.ORD_TEAM_MSTR_DTL_PK
                ,OTD.ORD_TEAM_ATTRB_TP_CD
                ,OTD.ORD_TEAM_ATTRB_VAL_TXT
                ,SPV.FULL_PSN_NM
                ,OTD.EZUPTIME
                ,OTD.EZUPTIMEZONE
            FROM
                 ORD_TEAM_MSTR_DTL  OTD
                ,ORD_TEAM_ATTRB_TP  OTT
                ,S21_PSN_V          SPV
            WHERE
                    OTD.GLBL_CMPY_CD            = #glblCmpyCd#
                AND OTD.ORD_TEAM_MSTR_HDR_PK    = #ordTeamMstrHdrPk#
                AND OTD.ORD_TEAM_ATTRB_TP_CD    = #ordTeamAttrbTp_UserId#
                AND OTD.EZCANCELFLAG            = '0'
                AND OTD.GLBL_CMPY_CD            = OTT.GLBL_CMPY_CD
                AND OTD.ORD_TEAM_ATTRB_TP_CD    = OTT.ORD_TEAM_ATTRB_TP_CD
                AND OTT.EZCANCELFLAG            = '0'
                AND OTD.GLBL_CMPY_CD            = SPV.GLBL_CMPY_CD(+)
                AND OTD.ORD_TEAM_ATTRB_VAL_TXT  = SPV.PSN_CD(+)
                AND SPV.EZCANCELFLAG(+)         = '0'
            ORDER BY
                 OTT.ORD_TEAM_ATTRB_TP_SORT_NUM  ASC
                ,OTD.ORD_TEAM_ATTRB_VAL_TXT      ASC)
        WHERE
            ROWNUM &lt;= #limitCnt#
    </statement>
    <resultMap id="result.getMemberData"        class="NWAL1670_BCMsg">
        <result property="xxRowNum_B"           column="XX_ROW_NUM"             javaType="EZDSBigDecimalItem"/>
        <result property="ordTeamMstrDtlPk_B"   column="ORD_TEAM_MSTR_DTL_PK"   javaType="EZDSBigDecimalItem"/>
        <result property="ordTeamAttrbTpCd_B"   column="ORD_TEAM_ATTRB_TP_CD"   javaType="EZDSStringItem"/>
        <result property="ordTeamAttrbValTxt_B" column="ORD_TEAM_ATTRB_VAL_TXT" javaType="EZDSStringItem"/>
        <result property="fullPsnNm_B"          column="FULL_PSN_NM"            javaType="EZDSStringItem"/>
        <result property="ezUpTime_B"           column="EZUPTIME"               javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_B"       column="EZUPTIMEZONE"           javaType="EZDSStringItem"/>
    </resultMap>
    <statement id="getAttributeData" parameterClass="Map" resultMap="result.getAttributeData">
        SELECT
             ROWNUM AS XX_ROW_NUM
            ,ORD_TEAM_MSTR_DTL_PK
            ,ORD_TEAM_ATTRB_TP_CD
            ,ORD_TEAM_ATTRB_VAL_TXT
            ,DS_ACCT_NM
            ,EZUPTIME
            ,EZUPTIMEZONE
        FROM (
            SELECT
                 OTD.ORD_TEAM_MSTR_DTL_PK
                ,OTD.ORD_TEAM_ATTRB_TP_CD
                ,OTD.ORD_TEAM_ATTRB_VAL_TXT
                ,CASE WHEN OTD.ORD_TEAM_ATTRB_TP_CD = #ordTeamAttrbTp_CustNum# THEN STC.DS_ACCT_NM
                      WHEN OTD.ORD_TEAM_ATTRB_TP_CD = #ordTeamAttrbTp_LineBiz# THEN LBT.LINE_BIZ_TP_DESC_TXT
                      WHEN OTD.ORD_TEAM_ATTRB_TP_CD = #ordTeamAttrbTp_branch#  THEN CBR.COA_BR_DESC_TXT
                      ELSE NULL END AS DS_ACCT_NM
                ,OTD.EZUPTIME
                ,OTD.EZUPTIMEZONE
            FROM
                 ORD_TEAM_MSTR_DTL  OTD
                ,ORD_TEAM_ATTRB_TP  OTT
                ,LINE_BIZ_TP        LBT
                ,COA_BR             CBR
                ,(SELECT
                     SC.SELL_TO_CUST_CD
                    ,SC.DS_ACCT_NM
                  FROM
                     ORD_TEAM_MSTR_DTL  OT
                    ,SELL_TO_CUST       SC 
                  WHERE
                        OT.GLBL_CMPY_CD            = #glblCmpyCd#
                    AND OT.ORD_TEAM_MSTR_HDR_PK    = #ordTeamMstrHdrPk#
                    AND OT.ORD_TEAM_ATTRB_TP_CD    = #ordTeamAttrbTp_CustNum#
                    AND OT.EZCANCELFLAG            = '0'
                    AND OT.GLBL_CMPY_CD            = SC.GLBL_CMPY_CD
                    AND OT.ORD_TEAM_ATTRB_VAL_TXT  = SC.SELL_TO_CUST_CD
                    AND SC.RGTN_STS_CD            = #rgtnStsCd_ReadyForOrderTaking#
                    AND SC.EFF_FROM_DT           &lt;= #slsDt#
                    AND (SC.EFF_THRU_DT IS NULL
                        OR SC.EFF_THRU_DT        &gt;= #slsDt#)
                    AND SC.EZCANCELFLAG            = '0') STC
            WHERE
                    OTD.GLBL_CMPY_CD            = #glblCmpyCd#
                AND OTD.ORD_TEAM_MSTR_HDR_PK    = #ordTeamMstrHdrPk#
                AND OTD.ORD_TEAM_ATTRB_TP_CD   &lt;&gt; #ordTeamAttrbTp_UserId#
                AND OTD.EZCANCELFLAG            = '0'
                AND OTD.GLBL_CMPY_CD            = OTT.GLBL_CMPY_CD
                AND OTD.ORD_TEAM_ATTRB_TP_CD    = OTT.ORD_TEAM_ATTRB_TP_CD
                AND OTT.EZCANCELFLAG            = '0'
                AND OTD.ORD_TEAM_ATTRB_VAL_TXT  = STC.SELL_TO_CUST_CD(+)
                AND OTD.GLBL_CMPY_CD            = LBT.GLBL_CMPY_CD(+)
                AND OTD.ORD_TEAM_ATTRB_VAL_TXT  = LBT.LINE_BIZ_TP_CD(+)
                AND LBT.EZCANCELFLAG(+)         = '0'
                AND OTD.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                AND OTD.ORD_TEAM_ATTRB_VAL_TXT  = CBR.COA_BR_CD(+)
                AND CBR.EZCANCELFLAG(+)         = '0'
            ORDER BY
                 OTT.ORD_TEAM_ATTRB_TP_SORT_NUM  ASC
                ,OTD.ORD_TEAM_ATTRB_VAL_TXT      ASC)
        WHERE
            ROWNUM &lt;= #limitCnt#
    </statement>
    <resultMap id="result.getAttributeData"     class="NWAL1670_CSMsg">
        <result property="xxRowNum_C"           column="XX_ROW_NUM"             javaType="EZDSBigDecimalItem"/>
        <result property="ordTeamMstrDtlPk_C"   column="ORD_TEAM_MSTR_DTL_PK"   javaType="EZDSBigDecimalItem"/>
        <result property="ordTeamAttrbTpCd_C"   column="ORD_TEAM_ATTRB_TP_CD"   javaType="EZDSStringItem"/>
        <result property="ordTeamAttrbValTxt_C" column="ORD_TEAM_ATTRB_VAL_TXT" javaType="EZDSStringItem"/>
        <result property="dsAcctNm_C"           column="DS_ACCT_NM"             javaType="EZDSStringItem"/>
        <result property="ezUpTime_C"           column="EZUPTIME"               javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_C"       column="EZUPTIMEZONE"           javaType="EZDSStringItem"/>
    </resultMap>
    <statement id="getDsAcctCust" parameterClass="Map" resultClass="Map">
        SELECT
            STC.SELL_TO_CUST_PK
        FROM
            SELL_TO_CUST STC
        WHERE
                STC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND STC.SELL_TO_CUST_CD     = #dsAcctNum#
            AND STC.RGTN_STS_CD         = #rgtnStsCd_ReadyForOrderTaking#
            AND STC.EFF_FROM_DT         &lt;= #slsDt#
            AND (STC.EFF_THRU_DT IS NULL
                   OR STC.EFF_THRU_DT   &gt;= #slsDt#)
            AND STC.EZCANCELFLAG        = '0'
    </statement>
</sqlMap>
