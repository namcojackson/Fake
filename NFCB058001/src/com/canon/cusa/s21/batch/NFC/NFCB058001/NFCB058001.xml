<!--<?xml version="1.0" encoding="UTF-8"?>-->
<sqlMap namespace="NFCB058001">

	<typeAlias alias="CUST_CR_PRFLTMsg" type="business.db.CUST_CR_PRFLTMsg"/>
	<typeAlias alias="AR_TRX_BALTMsg" type="business.db.AR_TRX_BALTMsg"/>

    <statement id="getCreditMemo" parameterClass="Map">
     SELECT
          ATB.AR_TRX_BAL_PK
         ,ATB.AR_TRX_NUM
         ,ATB.AR_TRX_TP_CD
         ,ATB.AR_TRX_DT
         ,ATB.DEAL_RMNG_BAL_GRS_AMT
         ,ATB.AR_AUTO_PURGE_OFS_FLG
         ,ATB.CUST_CARE_TKT_NUM
         ,ATB.CR_REBIL_RSN_CATG_CD
         ,ATB.BILL_TO_CUST_CD
         ,ATB.EZUPTIME
         ,ATB.EZUPTIMEZONE
         ,AII.ORIG_INV_NUM
         ,AII.SYS_SRC_CD
     FROM
          AR_TRX_BAL ATB
         ,INV AII
     WHERE
              ATB.GLBL_CMPY_CD              =  #glblCmpyCd#
          AND ATB.AR_TRX_TP_CD              =  #arTrxTpCrm#
          AND ATB.AR_CASH_APPLY_STS_CD     IN (#arCashAppStsUnApp#, #arCashAppStsPart#)
          <isEqual property="flgTrnDtChk" compareValue="Y">
          <!-- START 2018/02/6 QC#23018 MOD -->
          <!-- AND ATB.AR_TRX_DT                 =  #batProcDate# -->
          AND AII.ACCT_DT                   =  #batProcDate# 
          <!-- END   2018/02/6 QC#23018 MOD -->
          </isEqual>
          AND ATB.GLBL_CMPY_CD              =  AII.GLBL_CMPY_CD
          AND ATB.AR_TRX_NUM             LIKE  CONCAT(AII.INV_NUM, '%')
          AND AII.ORIG_INV_NUM              IS NOT NULL
          AND ATB.EZCANCELFLAG              =  '0'
          AND AII.EZCANCELFLAG              =  '0'
     ORDER BY
          ATB.AR_TRX_NUM
    </statement>

    <statement id="getOrgInv" parameterClass="Map" resultMap="result.getOrgInv">
     SELECT
          ATB.AR_TRX_BAL_PK
         ,ATB.AR_TRX_NUM
         ,ATB.AR_TRX_TP_CD
         ,ATB.AR_TRX_DT
         ,ATB.AR_CASH_APPLY_STS_CD
         ,ATB.DEAL_CCY_CD
         ,ATB.DEAL_RMNG_BAL_GRS_AMT
         ,ATB.FUNC_CCY_CD
         ,ATB.BILL_TO_CUST_ACCT_CD
         ,ATB.BILL_TO_CUST_CD
         ,ATB.EZUPTIME
         ,ATB.EZUPTIMEZONE
     FROM
          AR_TRX_BAL ATB
     WHERE
              ATB.GLBL_CMPY_CD              =  #glblCmpyCd#
          AND ATB.AR_TRX_NUM                =  #orgInvNum#
          AND ATB.AR_TRX_TP_CD             !=  #arTrxTpRcp#
          AND ATB.EZCANCELFLAG              =  '0'
     ORDER BY
          ATB.AR_TRX_BAL_PK
    </statement>
    <resultMap id="result.getOrgInv" class="AR_TRX_BALTMsg">
        <result property="arTrxBalPk" column="AR_TRX_BAL_PK" javaType="EZDTBigDecimalItem"/>
        <result property="arTrxNum" column="AR_TRX_NUM" javaType="StringItemEZD"/>
        <result property="arTrxTpCd" column="AR_TRX_TP_CD" javaType="StringItemEZD"/>
        <result property="arTrxDt" column="AR_TRX_DT" javaType="StringItemEZD"/>
        <result property="arCashApplyStsCd" column="AR_CASH_APPLY_STS_CD" javaType="StringItemEZD"/>
        <result property="dealCcyCd" column="DEAL_CCY_CD" javaType="StringItemEZD"/>
        <result property="dealRmngBalGrsAmt" column="DEAL_RMNG_BAL_GRS_AMT" javaType="EZDTBigDecimalItem"/>
        <result property="funcCcyCd" column="FUNC_CCY_CD" javaType="StringItemEZD"/>
        <result property="billToCustAcctCd" column="BILL_TO_CUST_ACCT_CD" javaType="StringItemEZD"/>
        <result property="billToCustCd" column="BILL_TO_CUST_CD" javaType="StringItemEZD"/>
        <result property="ezUpTime" column="EZUPTIME" javaType="StringItemEZD"/>
        <result property="ezUpTimeZone" column="EZUPTIMEZONE" javaType="StringItemEZD"/>
    </resultMap>

    <statement id="getRebill" parameterClass="Map" resultMap="result.getRebill">
     SELECT
          ATB.AR_TRX_BAL_PK
         ,ATB.AR_TRX_NUM
         ,ATB.AR_TRX_TP_CD
         ,ATB.AR_TRX_DT
         ,ATB.DEAL_RMNG_BAL_GRS_AMT
         ,ATB.BILL_TO_CUST_CD
         ,ATB.EZUPTIME
         ,ATB.EZUPTIMEZONE
     FROM
          AR_TRX_BAL ATB
         ,INV AII
     WHERE
              ATB.GLBL_CMPY_CD              =  #glblCmpyCd#
          AND ATB.AR_TRX_TP_CD          NOT IN (#arTrxTpRcp#, #arTrxTpCrm#)
          AND ATB.AR_CASH_APPLY_STS_CD      IN (#arCashAppStsUnApp#, #arCashAppStsPart#)
          AND AII.GLBL_CMPY_CD              =  #glblCmpyCd#
          AND AII.ORIG_INV_NUM              =  #orgInvNum#
          <!-- START 2016/08/02 S.Fujita [QC#12756,DEL] -->
          <!--
          AND AII.CUST_CARE_TKT_NUM         =  #custTktNum#
          -->
          <!-- END   2016/08/02 S.Fujita [QC#12756,DEL] -->
          AND ATB.AR_TRX_NUM             LIKE  CONCAT(AII.INV_NUM, '%')
          AND ATB.EZCANCELFLAG              =  '0'
          AND AII.EZCANCELFLAG              =  '0'
     ORDER BY
          ATB.AR_TRX_NUM
    </statement>
    <resultMap id="result.getRebill" class="AR_TRX_BALTMsg">
        <result property="arTrxBalPk" column="AR_TRX_BAL_PK" javaType="EZDTBigDecimalItem"/>
        <result property="arTrxNum" column="AR_TRX_NUM" javaType="StringItemEZD"/>
        <result property="arTrxTpCd" column="AR_TRX_TP_CD" javaType="StringItemEZD"/>
        <result property="arTrxDt" column="AR_TRX_DT" javaType="StringItemEZD"/>
        <result property="dealRmngBalGrsAmt" column="DEAL_RMNG_BAL_GRS_AMT" javaType="EZDTBigDecimalItem"/>
        <result property="billToCustCd" column="BILL_TO_CUST_CD" javaType="StringItemEZD"/>
        <result property="ezUpTime" column="EZUPTIME" javaType="StringItemEZD"/>
        <result property="ezUpTimeZone" column="EZUPTIMEZONE" javaType="StringItemEZD"/>
    </resultMap>

    <statement id="getCustCrPrfl" parameterClass="Map" resultMap="result.getCustCrPrfl">
     SELECT
          CR_MGR_PSN_CD
     FROM
          CUST_CR_PRFL CCP
     WHERE
              CCP.GLBL_CMPY_CD              =  #glblCmpyCd#
          AND CCP.BILL_TO_CUST_CD           =  #billToCustCd#
          AND CCP.EZCANCELFLAG              =  '0'
    </statement>

    <resultMap id="result.getCustCrPrfl" class="CUST_CR_PRFLTMsg">
        <result property="crMgrPsnCd" column="CR_MGR_PSN_CD" javaType="StringItemEZD"/>
    </resultMap>
</sqlMap>
