<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL0710Query">
    <typeAlias alias="NSAL0710_ASMsg" type="business.blap.NSAL0710.NSAL0710_ASMsg"/>

    <statement id="getContrInfo" parameterClass="Map" resultMap="result.getContrInfo">
        SELECT
             HDR.DS_CONTR_PK                    DS_CONTR_PK
            ,0                                  DS_CONTR_DTL_PK
            ,HDR.DS_CONTR_CATG_CD               DS_CONTR_CATG_CD
            ,HDR.DS_CONTR_NUM                   DS_CONTR_NUM
            ,DCS.DS_CONTR_CTRL_STS_CD           HDR_DS_CONTR_CTRL_STS_CD
            ,''                                 DTL_DS_CONTR_CTRL_STS_CD
            ,TRIM(HDR.DS_CONTR_CATG_CD
                || '-' || HDR.DS_CONTR_NUM)  AS XX_SCR_ITEM_34_TXT
            ,STC.DS_ACCT_NM                     DS_ACCT_NM
            ,HDR.CONTR_VRSN_EFF_FROM_DT         CONTR_VRSN_EFF_FROM_DT
            ,HDR.CONTR_VRSN_EFF_THRU_DT         CONTR_VRSN_EFF_THRU_DT
            ,DCS.DS_CONTR_CTRL_STS_NM           DS_CONTR_CTRL_STS_NM
            ,''                                 SER_NUM
            ,''                                 T_MDL_NM
            ,''                                 PHONE_FLG
            ,''                                 EMNG_FLG
            ,''                                 EMAIL_FLG
            ,''                                 FAX_FLG
            ,''                                 IW_FLG
            ,''                                 CUR_MTR_READ_METH_CD
            ,''                                 CUR_MTR_READ_METH_NM
            ,1                                  SORT_NUM
            ,HDR.EZUPTIME                       EZUPTIME
            ,HDR.EZUPTIMEZONE                   EZUPTIMEZONE
<!-- START 2016/12/08 N.Arai [QC#14204, ADD] -->
            ,HDR.EZINTIME                       XX_REC_HIST_CRAT_TS
            ,HDR.EZINUSERID                     XX_REC_HIST_CRAT_BY_NM
            ,HDR.EZUPTIME                       XX_REC_HIST_UPD_TS
            ,HDR.EZUPUSERID                     XX_REC_HIST_UPD_BY_NM
            ,HDR.EZTABLEID                      XX_REC_HIST_TBL_NM
<!-- END 2016/12/08 N.Arai [QC#14204, ADD] -->
        FROM
             DS_CONTR               HDR
            ,SELL_TO_CUST           STC
            ,DS_CONTR_STS_V         DCS
        WHERE
                HDR.GLBL_CMPY_CD        = #glblCmpyCd#
            <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND HDR.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND HDR.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = STC.GLBL_CMPY_CD
            AND HDR.DS_ACCT_NUM         = STC.SELL_TO_CUST_CD
            AND STC.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = DCS.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK         = DCS.DS_CONTR_PK
            AND DCS.EZCANCELFLAG        = '0'
UNION ALL
        SELECT
             HDR.DS_CONTR_PK                    DS_CONTR_PK
            ,DTL.DS_CONTR_DTL_PK                DS_CONTR_DTL_PK
            ,HDR.DS_CONTR_CATG_CD               DS_CONTR_CATG_CD
            ,HDR.DS_CONTR_NUM                   DS_CONTR_NUM
            ,DCS.DS_CONTR_CTRL_STS_CD           HDR_DS_CONTR_CTRL_STS_CD
            ,DDS.DS_CONTR_CTRL_STS_CD           DTL_DS_CONTR_CTRL_STS_CD
            ,''                                 XX_SCR_ITEM_34_TXT
            ,''                                  DS_ACCT_NM
            ,''                                 CONTR_VRSN_EFF_FROM_DT
            ,''                                 CONTR_VRSN_EFF_THRU_DT
            ,DDS.DS_CONTR_CTRL_STS_NM           DS_CONTR_CTRL_STS_NM
            ,SMM.SER_NUM                        SER_NUM
            ,MDL.T_MDL_NM                       T_MDL_NM
            ,''                                 PHONE_FLG
            ,''                                 EMNG_FLG
            ,''                                 EMAIL_FLG
            ,''                                 FAX_FLG
            ,''                                 IW_FLG
            ,DTL.MTR_READ_METH_CD               CUR_MTR_READ_METH_CD
            ,MRM.MTR_READ_METH_NM               CUR_MTR_READ_METH_NM
            ,2                                  SORT_NUM
            ,DTL.EZUPTIME                       EZUPTIME
            ,DTL.EZUPTIMEZONE                   EZUPTIMEZONE
<!-- START 2016/12/08 N.Arai [QC#14204, ADD] -->
            ,DTL.EZINTIME                       XX_REC_HIST_CRAT_TS
            ,DTL.EZINUSERID                     XX_REC_HIST_CRAT_BY_NM
            ,DTL.EZUPTIME                       XX_REC_HIST_UPD_TS
            ,DTL.EZUPUSERID                     XX_REC_HIST_UPD_BY_NM
            ,DTL.EZTABLEID                      XX_REC_HIST_TBL_NM
<!-- END 2016/12/08 N.Arai [QC#14204, ADD] -->
        FROM
             DS_CONTR               HDR
            ,DS_CONTR_DTL           DTL
            ,SVC_MACH_MSTR          SMM
            ,SVC_CONFIG_MSTR        SCM
            ,MDL_NM                 MDL
            ,DS_CONTR_STS_V         DCS
            ,DS_CONTR_DTL_STS_V     DDS
            ,MTR_READ_METH          MRM
        WHERE
                HDR.GLBL_CMPY_CD        = #glblCmpyCd#
            <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND HDR.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND HDR.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = DTL.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK         = DTL.DS_CONTR_PK
            AND DTL.EZCANCELFLAG        = '0'
            AND DTL.GLBL_CMPY_CD        = SMM.GLBL_CMPY_CD
            AND DTL.SVC_MACH_MSTR_PK    = SMM.SVC_MACH_MSTR_PK
            <iterate property="dsContrDtlPkArray" var="dsContrDtlPk[]" open="AND DTL.DS_CONTR_DTL_PK IN (" close=")" conjunction=",">
                #dsContrDtlPk[]#
            </iterate>
            AND SMM.EZCANCELFLAG        = '0'
            AND SMM.GLBL_CMPY_CD        = SCM.GLBL_CMPY_CD
            AND SMM.SVC_CONFIG_MSTR_PK  = SCM.SVC_CONFIG_MSTR_PK
            AND SCM.EZCANCELFLAG        = '0'
            AND SCM.GLBL_CMPY_CD        = MDL.T_GLBL_CMPY_CD
            AND SCM.MDL_ID              = MDL.T_MDL_ID
            AND MDL.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = DCS.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK         = DCS.DS_CONTR_PK
            AND DCS.EZCANCELFLAG        = '0'
            AND DTL.GLBL_CMPY_CD        = DDS.GLBL_CMPY_CD
            AND DTL.DS_CONTR_PK         = DDS.DS_CONTR_PK
            AND DTL.DS_CONTR_DTL_PK     = DDS.DS_CONTR_DTL_PK
            AND DDS.EZCANCELFLAG        = '0'
            AND DTL.GLBL_CMPY_CD        = MRM.GLBL_CMPY_CD (+)
            AND DTL.MTR_READ_METH_CD    = MRM.MTR_READ_METH_CD (+)
            AND MRM.EZCANCELFLAG (+)    = '0'
        ORDER BY
             DS_CONTR_CATG_CD
            ,DS_CONTR_NUM
            ,SORT_NUM
            ,SER_NUM
    </statement>
    <resultMap id="result.getContrInfo" class="NSAL0710_ASMsg">
        <result property="dsContrPk_A1" column="DS_CONTR_PK"  javaType="EZDSBigDecimalItem" />
        <result property="dsContrDtlPk_A1" column="DS_CONTR_DTL_PK"  javaType="EZDSBigDecimalItem" />
        <result property="dsContrCtrlStsCd_AH" column="HDR_DS_CONTR_CTRL_STS_CD"  javaType="EZDSStringItem" />
        <result property="dsContrCtrlStsCd_AD" column="DTL_DS_CONTR_CTRL_STS_CD"  javaType="EZDSStringItem" />
        <result property="dsContrCatgCd_A1" column="DS_CONTR_CATG_CD"  javaType="EZDSStringItem" />
        <result property="dsContrNum_A1" column="DS_CONTR_NUM"  javaType="EZDSStringItem" />
        <result property="xxScrItem34Txt_A1" column="XX_SCR_ITEM_34_TXT"  javaType="EZDSStringItem" />
        <result property="dsAcctNm_A1" column="DS_ACCT_NM"  javaType="EZDSStringItem" />
        <result property="contrVrsnEffFromDt_A1" column="CONTR_VRSN_EFF_FROM_DT"  javaType="EZDSDateItem" />
        <result property="contrVrsnEffThruDt_A1" column="CONTR_VRSN_EFF_THRU_DT"  javaType="EZDSDateItem" />
        <result property="dsContrCtrlStsNm_A1" column="DS_CONTR_CTRL_STS_NM"  javaType="EZDSStringItem" />
        <result property="serNum_A1" column="SER_NUM"  javaType="EZDSStringItem" />
        <result property="t_MdlNm_A1" column="T_MDL_NM"  javaType="EZDSStringItem" />
        <result property="xxDplyCtrlFlg_A1" column="PHONE_FLG"  javaType="EZDSStringItem" />
        <result property="xxDplyCtrlFlg_A2" column="EMNG_FLG"  javaType="EZDSStringItem" />
        <result property="xxDplyCtrlFlg_A3" column="EMAIL_FLG"  javaType="EZDSStringItem" />
        <result property="xxDplyCtrlFlg_A4" column="FAX_FLG"  javaType="EZDSStringItem" />
        <result property="xxDplyCtrlFlg_A5" column="IW_FLG"  javaType="EZDSStringItem" />
        <result property="mtrReadMethCd_A1" column="CUR_MTR_READ_METH_CD"  javaType="EZDSStringItem" />
        <result property="mtrReadMethNm_A1" column="CUR_MTR_READ_METH_NM"  javaType="EZDSStringItem" />
        <result property="ezUpTime_D1" column="EZUPTIME"  javaType="EZDSStringItem" />
        <result property="ezUpTimeZone_D1" column="EZUPTIMEZONE"  javaType="EZDSStringItem" />
<!-- START 2016/12/08 N.Arai [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_A"   column="XX_REC_HIST_CRAT_TS"       javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_A" column="XX_REC_HIST_CRAT_BY_NM"    javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_A"    column="XX_REC_HIST_UPD_TS"        javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_A"  column="XX_REC_HIST_UPD_BY_NM"     javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_A"    column="XX_REC_HIST_TBL_NM"        javaType="EZDSStringItem"/>
<!-- END 2016/12/08 N.Arai [QC#14204, ADD] -->
    </resultMap>
</sqlMap>
