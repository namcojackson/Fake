<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAB070001">

    <statement id="getTrgtDtRec" parameterClass="Map" resultClass="BigDecimal">
        SELECT COUNT(1)
        FROM
            FCT_DLY_CONTR_REV_COST CRC
        WHERE 
            CRC.GLBL_CMPY_CD       = #glblCmpyCd#
        AND CRC.FCT_CRAT_DT        = #trgtDt#
        AND CRC.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getMainData" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
             AIAD.GLBL_CMPY_CD                 AS GLBL_CMPY_CD
            ,I.ACCT_DT                         AS DWH_TRGT_DT
            ,SUBSTR(I.ACCT_DT, 1, 6)           AS DWH_TRGT_YR_MTH
            ,SUBSTR(I.ACCT_DT, 1, 4)           AS DWH_TRGT_YR
            ,DRC.DWH_TRGT_QTR_NUM              AS DWH_TRGT_QTR_NUM
            ,#revsvc#                          AS FCT_CATG_CD
            ,DCD.DS_CONTR_PK                   AS DS_CONTR_PK
            ,IL.DS_CONTR_NUM                   AS DS_CONTR_NUM
            ,IL.DS_CONTR_DTL_PK                AS DS_CONTR_DTL_PK
            ,DCD.DS_CONTR_DTL_TP_CD            AS DS_CONTR_DTL_TP_CD
            ,DCDT.DS_CONTR_DTL_TP_DESC_TXT     AS DS_CONTR_DTL_TP_DESC_TXT
            ,DC.SVC_CONTR_BR_CD                AS SVC_CONTR_BR_CD
            ,DC.DS_CONTR_CATG_CD               AS DS_CONTR_CATG_CD
            ,DCC.DS_CONTR_CATG_DESC_TXT        AS DS_CONTR_CATG_DESC_TXT
            ,DC.SVC_LINE_BIZ_CD                AS SVC_LINE_BIZ_CD
            ,I.BILL_TO_CUST_ACCT_CD            AS DS_ACCT_NUM
            ,I.BILL_TO_CUST_ACCT_NM            AS DS_ACCT_NM
            ,I.BILL_TO_CUST_CD                 AS ALT_PAYER_CUST_CD
            ,SMM.CUR_LOC_ACCT_NUM              AS CUR_LOC_ACCT_NUM
            ,STC.DS_ACCT_NM                    AS CUR_LOC_ACCT_NM
            ,SMM.CUR_LOC_NUM                   AS CUR_LOC_NUM
            ,SMM.IND_CUR_LOC_NUM               AS IND_CUR_LOC_NUM
            ,DCD.SVC_MACH_MSTR_PK              AS SVC_MACH_MSTR_PK
            ,CASE
                WHEN DC.DS_CONTR_CATG_CD = #cntrCtgCd# THEN NVL(SMM.SER_NUM, #serNum#)
                ELSE                                  SMM.SER_NUM
             END                               AS SER_NUM
            ,SCM.MDL_ID                        AS MDL_ID
            ,NVL(MN.T_MDL_NM, #mdlNm#)         AS T_MDL_NM
            ,DM.SVC_SEG_CD                     AS SVC_SEG_CD
            ,NVL(SS.SVC_SEG_DESC_TXT, #segDescTxt#)
                                               AS SVC_SEG_DESC_TXT
            ,AIAD.AJE_COA_CMPY_CD              AS COA_CMPY_CD
            ,AIAD.AJE_COA_AFFL_CD              AS COA_AFFL_CD
            ,AIAD.AJE_COA_BR_CD                AS COA_BR_CD
            ,AIAD.AJE_COA_CH_CD                AS COA_CH_CD
            ,AIAD.AJE_COA_CC_CD                AS COA_CC_CD
            ,AIAD.AJE_COA_ACCT_CD              AS COA_ACCT_CD
            ,AIAD.AJE_COA_PROD_CD              AS COA_PROD_CD
            ,AIAD.AJE_COA_PROJ_CD              AS COA_PROJ_CD
            ,AIAD.AJE_COA_EXTN_CD              AS COA_EXTN_CD
            ,IL.MDSE_CD                        AS MDSE_CD
            ,MDS.MDSE_DESC_SHORT_TXT           AS MDSE_DESC_SHORT_TXT
            ,IL.SHIP_QTY                       AS SHIP_QTY
            ,0                                 AS UNIT_COST_AMT
            ,0                                 AS SHIP_CPLT_COST_AMT
            ,IL.SVC_INV_CHRG_TP_CD             AS SVC_INV_CHRG_TP_CD
            ,SICT.SVC_INV_CHRG_TP_DESC_TXT     AS SVC_INV_CHRG_TP_DESC_TXT
            ,I.DS_INV_TP_CD                    AS DS_INV_TP_CD
            ,CASE
                WHEN IL.SVC_INV_CHRG_TP_CD = #invChrgTpBC# THEN #invTpDescBC#
                WHEN IL.SVC_INV_CHRG_TP_CD = #invChrgTpMC# THEN #invTpDescMC#
                ELSE #hyphen#
             END                               AS INV_TP_DESC_TXT
            ,NULL                              AS SVC_INV_UNIT_HRS_AOT
            ,NULL                              AS SVC_LBOR_UNIT_AMT
            ,AIAD.INV_NUM                      AS INV_NUM
            ,AIAD.INV_BOL_LINE_NUM             AS INV_BOL_LINE_NUM
            ,AIAD.INV_LINE_NUM                 AS INV_LINE_NUM
            ,AIAD.INV_LINE_SUB_NUM             AS INV_LINE_SUB_NUM
            ,AIAD.INV_LINE_SUB_TRX_NUM         AS INV_LINE_SUB_TRX_NUM
            ,IL.SVC_INV_LINE_PK                AS SVC_INV_LINE_PK
            ,I.INV_DT                          AS INV_DT
            ,I.ACCT_DT                         AS ACCT_DT
            ,CASE
                WHEN ML.BW_MTR_FLG = 'Y' THEN
                    CASE
                        WHEN AIAD.DR_CR_TP_CD = #drCrTpC# THEN AIAD.JRNL_DEAL_AMT
                        ELSE AIAD.JRNL_DEAL_AMT * -1
                    END
                ELSE NULL
             END                               AS BW_MTR_CHRG_DEAL_AMT
            ,0                                 AS BW_COST_AMT
            ,CASE
                WHEN ML.COLOR_MTR_FLG = 'Y' THEN
                    CASE
                        WHEN AIAD.DR_CR_TP_CD = #drCrTpC# THEN AIAD.JRNL_DEAL_AMT
                        ELSE AIAD.JRNL_DEAL_AMT * -1
                    END
                ELSE NULL
             END                               AS CLR_MTR_CHRG_DEAL_AMT
            ,0                                 AS CLR_COST_AMT
            ,CASE
                WHEN IL.SVC_INV_CHRG_TP_CD != #invChrgTpMC# OR IL.SVC_INV_CHRG_TP_CD IS NULL THEN
                    CASE
                        WHEN AIAD.DR_CR_TP_CD = #drCrTpC# THEN AIAD.JRNL_DEAL_AMT
                        ELSE AIAD.JRNL_DEAL_AMT * -1
                    END
                ELSE NULL
             END                               AS OTH_INV_LINE_DEAL_NET_AMT
            ,0                                 AS OTH_COST_AMT
            ,IL.BLLG_PER_FROM_DT               AS BLLG_PER_FROM_DT
            ,IL.BLLG_PER_THRU_DT               AS BLLG_PER_THRU_DT
            ,NULL                              AS ACTL_MACH_QTY
            ,IL.ORD_QTY                        AS ORD_QTY
            ,IL.CPO_ORD_NUM                    AS CPO_ORD_NUM
            ,IL.CPO_DTL_LINE_NUM               AS CPO_DTL_LINE_NUM
            ,NULL                              AS CPO_ORD_DT
            ,MDS.IMG_SPLY_YIELD_CNT            AS IMG_SPLY_YIELD_CNT
            ,NULL                              AS SPLY_INCL_FLG
            ,DCD.SVC_PGM_MDSE_CD               AS SVC_PGM_MDSE_CD
            ,SI.FSR_NUM                        AS FSR_NUM
            ,NULL                              AS FSR_CRAT_DT
            ,DISC.INV_LINE_SPL_TP_CD           AS INV_LINE_SPL_TP_CD
            ,ILST.INV_LINE_SPL_TP_DESC_TXT     AS INV_LINE_SPL_TP_DESC_TXT
            ,NULL                              AS FSR_VISIT_NUM
            ,NULL                              AS SVC_TASK_CLO_DT
            ,NULL                              AS PRT_USED_BY_TECH_LOC_CD
            ,NULL                              AS UOM_CD
            ,NULL                              AS SVC_TASK_NUM
            ,NULL                              AS SVC_PBLM_TP_CD
            ,NULL                              AS SVC_PBLM_TP_DESC_TXT
            ,NULL                              AS IMG_SPLY_TP_CD
            ,NULL                              AS IMG_SPLY_TP_DESC_TXT
            ,NULL                              AS IMG_SPLY_COLOR_TP_CD
            ,NULL                              AS IMG_SPLY_COLOR_TP_DESC_TXT
            ,NULL                              AS USED_MULT_CNT
            ,NULL                              AS USED_EQUA_CNT
            ,CC.COA_CMPY_DESC_TXT              AS COA_CMPY_DESC_TXT
        FROM
             AJE_INV_ACCT_DIST    AIAD
            ,RPT_COND_CONST       RCCD
            ,INV_LINE             IL
            ,RPT_COND_CONST       RCCA
            ,DS_INV_SLS_CR        DISC
            ,INV                  I
            ,DMN_RPT_CAL          DRC
            ,INV_LINE_SPL_TP      ILST
            ,SVC_INV              SI
            ,SVC_INV_CHRG_TP      SICT
            ,MDSE                 MDS
            ,SVC_CONFIG_MSTR      SCM
            ,DS_MDL               DM
            ,MDL_NM               MN
            ,SVC_SEG              SS
            ,SVC_MACH_MSTR        SMM
            ,SELL_TO_CUST         STC
            ,DS_CONTR_DTL         DCD
            ,DS_CONTR             DC
            ,DS_CONTR_DTL_TP      DCDT
            ,DS_CONTR_CATG        DCC
            ,SVC_INV_LINE_MTR     SILM
            ,MTR_LB               ML
            ,COA_CMPY             CC
        WHERE
            AIAD.GLBL_CMPY_CD                  = #glblCmpyCd#
        AND AIAD.DFRD_REV_GL_STRG_FLG          = 'N'
        AND AIAD.GLBL_CMPY_CD                  = RCCD.GLBL_CMPY_CD
        AND RCCD.RPT_COND_CONST_GRP_ID         = #cratDays#
        AND AIAD.GL_DT                         = TO_CHAR(TO_DATE(#trgtDt#, 'YYYYMMDD') - RCCD.RPT_COND_CONST_VAL_NUM_01, 'YYYYMMDD')
        AND AIAD.GLBL_CMPY_CD                  = IL.GLBL_CMPY_CD
        AND AIAD.INV_NUM                       = IL.INV_NUM
        AND AIAD.INV_BOL_LINE_NUM              = IL.INV_BOL_LINE_NUM
        AND AIAD.INV_LINE_NUM                  = IL.INV_LINE_NUM
        AND AIAD.INV_LINE_SUB_NUM              = IL.INV_LINE_SUB_NUM
        AND AIAD.INV_LINE_SUB_TRX_NUM          = IL.INV_LINE_SUB_TRX_NUM
        AND AIAD.GLBL_CMPY_CD                  = RCCA.GLBL_CMPY_CD
        AND AIAD.AJE_COA_ACCT_CD               = RCCA.RPT_COND_CONST_VAL_TXT_01
        AND RCCA.RPT_COND_CONST_GRP_ID         = #svcAcct#
        AND AIAD.GLBL_CMPY_CD                  = DISC.GLBL_CMPY_CD
        AND AIAD.DS_INV_SLS_CR_PK              = DISC.DS_INV_SLS_CR_PK
        AND IL.GLBL_CMPY_CD                    = I.GLBL_CMPY_CD
        AND IL.INV_NUM                         = I.INV_NUM
        AND I.GLBL_CMPY_CD                     = DRC.GLBL_CMPY_CD
        AND I.ACCT_DT                          = DRC.DWH_TRGT_DT
        AND DISC.GLBL_CMPY_CD                  = ILST.GLBL_CMPY_CD(+)
        AND DISC.INV_LINE_SPL_TP_CD            = ILST.INV_LINE_SPL_TP_CD(+)
        AND I.GLBL_CMPY_CD                     = SI.GLBL_CMPY_CD(+)
        AND I.INV_NUM                          = SI.SVC_INV_NUM(+)
        AND IL.GLBL_CMPY_CD                    = SICT.GLBL_CMPY_CD(+)
        AND IL.SVC_INV_CHRG_TP_CD              = SICT.SVC_INV_CHRG_TP_CD(+)
        AND IL.GLBL_CMPY_CD                    = MDS.GLBL_CMPY_CD(+)
        AND IL.MDSE_CD                         = MDS.MDSE_CD(+)
        AND IL.GLBL_CMPY_CD                    = SCM.GLBL_CMPY_CD(+)
        AND IL.SVC_CONFIG_MSTR_PK              = SCM.SVC_CONFIG_MSTR_PK(+)
        AND SCM.GLBL_CMPY_CD                   = DM.GLBL_CMPY_CD(+)
        AND SCM.MDL_ID                         = DM.MDL_ID(+)
        AND SCM.GLBL_CMPY_CD                   = MN.T_GLBL_CMPY_CD(+)
        AND SCM.MDL_ID                         = MN.T_MDL_ID(+)
        AND DM.GLBL_CMPY_CD                    = SS.GLBL_CMPY_CD(+)
        AND DM.SVC_SEG_CD                      = SS.SVC_SEG_CD(+)
        AND SCM.GLBL_CMPY_CD                   = SMM.GLBL_CMPY_CD(+)
        AND SCM.SVC_MACH_MSTR_PK               = SMM.SVC_MACH_MSTR_PK(+)
        AND SMM.GLBL_CMPY_CD                   = STC.GLBL_CMPY_CD(+)
        AND SMM.CUR_LOC_ACCT_NUM               = STC.SELL_TO_CUST_CD(+)
        AND IL.GLBL_CMPY_CD                    = DCD.GLBL_CMPY_CD(+)
        AND IL.DS_CONTR_DTL_PK                 = DCD.DS_CONTR_DTL_PK(+)
        AND DCD.GLBL_CMPY_CD                   = DC.GLBL_CMPY_CD(+)
        AND DCD.DS_CONTR_PK                    = DC.DS_CONTR_PK(+)
        AND DCD.GLBL_CMPY_CD                   = DCDT.GLBL_CMPY_CD(+)
        AND DCD.DS_CONTR_DTL_TP_CD             = DCDT.DS_CONTR_DTL_TP_CD(+)
        AND DC.GLBL_CMPY_CD                    = DCC.GLBL_CMPY_CD(+)
        AND DC.DS_CONTR_CATG_CD                = DCC.DS_CONTR_CATG_CD(+)
        AND IL.GLBL_CMPY_CD                    = SILM.GLBL_CMPY_CD(+)
        AND IL.SVC_INV_LINE_PK                 = SILM.SVC_INV_LINE_PK(+)
        AND SILM.GLBL_CMPY_CD                  = ML.GLBL_CMPY_CD(+)
        AND SILM.MTR_LB_CD                     = ML.MTR_LB_CD(+)
        AND AIAD.GLBL_CMPY_CD                  = CC.GLBL_CMPY_CD
        AND AIAD.AJE_COA_CMPY_CD               = CC.COA_CMPY_CD
        AND AIAD.EZCANCELFLAG                  = '0'
        AND RCCD.EZCANCELFLAG                  = '0'
        AND IL.EZCANCELFLAG                    = '0'
        AND RCCA.EZCANCELFLAG                  = '0'
        AND DISC.EZCANCELFLAG                  = '0'
        AND I.EZCANCELFLAG                     = '0'
        AND DRC.EZCANCELFLAG                   = '0'
        AND ILST.EZCANCELFLAG(+)               = '0'
        AND SI.EZCANCELFLAG(+)                 = '0'
        AND SICT.EZCANCELFLAG(+)               = '0'
        AND MDS.EZCANCELFLAG(+)                = '0'
        AND SCM.EZCANCELFLAG(+)                = '0'
        AND DM.EZCANCELFLAG(+)                 = '0'
        AND MN.EZCANCELFLAG(+)                 = '0'
        AND SS.EZCANCELFLAG(+)                 = '0'
        AND SMM.EZCANCELFLAG(+)                = '0'
        AND STC.EZCANCELFLAG(+)                = '0'
        AND DCD.EZCANCELFLAG(+)                = '0'
        AND DC.EZCANCELFLAG(+)                 = '0'
        AND DCDT.EZCANCELFLAG(+)               = '0'
        AND DCC.EZCANCELFLAG(+)                = '0'
        AND SILM.EZCANCELFLAG(+)               = '0'
        AND ML.EZCANCELFLAG(+)                 = '0'
        AND CC.EZCANCELFLAG                    = '0'
        UNION ALL
        -- Revenue(Supply)
        SELECT DISTINCT
             MSRC.GLBL_CMPY_CD                 AS GLBL_CMPY_CD
            ,MSRC.DWH_TRGT_DT                  AS DWH_TRGT_DT
            ,MSRC.DWH_TRGT_YR_MTH              AS DWH_TRGT_YR_MTH
            ,MSRC.DWH_TRGT_YR                  AS DWH_TRGT_YR
            ,MSRC.DWH_TRGT_QTR_NUM             AS DWH_TRGT_QTR_NUM
            ,#revsply#                         AS FCT_CATG_CD
            ,MSRC.DS_CONTR_PK                  AS DS_CONTR_PK
            ,MSRC.DS_CONTR_NUM                 AS DS_CONTR_NUM
            ,MSRC.DS_CONTR_DTL_PK              AS DS_CONTR_DTL_PK
            ,MSRC.DS_CONTR_DTL_TP_CD           AS DS_CONTR_DTL_TP_CD
            ,MSRC.DS_CONTR_DTL_TP_DESC_TXT     AS DS_CONTR_DTL_TP_DESC_TXT
            ,MSRC.SVC_CONTR_BR_CD              AS SVC_CONTR_BR_CD
            ,MSRC.DS_CONTR_CATG_CD             AS DS_CONTR_CATG_CD
            ,MSRC.DS_CONTR_CATG_DESC_TXT       AS DS_CONTR_CATG_DESC_TXT
            ,MSRC.SVC_LINE_BIZ_CD              AS SVC_LINE_BIZ_CD
            ,MSRC.DS_ACCT_NUM                  AS DS_ACCT_NUM
            ,MSRC.DS_ACCT_NM                   AS DS_ACCT_NM
            ,MSRC.ALT_PAYER_CUST_CD            AS ALT_PAYER_CUST_CD
            ,MSRC.CUR_LOC_ACCT_NUM             AS CUR_LOC_ACCT_NUM
            ,MSRC.CUR_LOC_ACCT_NM              AS CUR_LOC_ACCT_NM
            ,MSRC.CUR_LOC_NUM                  AS CUR_LOC_NUM
            ,MSRC.IND_CUR_LOC_NUM              AS IND_CUR_LOC_NUM
            ,MSRC.SVC_MACH_MSTR_PK             AS SVC_MACH_MSTR_PK
            ,MSRC.SER_NUM                      AS SER_NUM
            ,MSRC.MDL_ID                       AS MDL_ID
            ,MSRC.T_MDL_NM                     AS T_MDL_NM
            ,MSRC.SVC_SEG_CD                   AS SVC_SEG_CD
            ,MSRC.SVC_SEG_DESC_TXT             AS SVC_SEG_DESC_TXT
            ,MSRC.COA_CMPY_CD                  AS COA_CMPY_CD
            ,MSRC.COA_AFFL_CD                  AS COA_AFFL_CD
            ,MSRC.COA_BR_CD                    AS COA_BR_CD
            ,MSRC.COA_CH_CD                    AS COA_CH_CD
            ,MSRC.COA_CC_CD                    AS COA_CC_CD
            ,MSRC.COA_ACCT_CD                  AS COA_ACCT_CD
            ,MSRC.COA_PROD_CD                  AS COA_PROD_CD
            ,MSRC.COA_PROJ_CD                  AS COA_PROJ_CD
            ,MSRC.COA_EXTN_CD                  AS COA_EXTN_CD
            ,MSRC.MDSE_CD                      AS MDSE_CD
            ,MSRC.MDSE_DESC_SHORT_TXT          AS MDSE_DESC_SHORT_TXT
            ,MSRC.SHIP_QTY                     AS SHIP_QTY
            ,MSRC.UNIT_COST_AMT                AS UNIT_COST_AMT
            ,MSRC.SHIP_CPLT_COST_AMT           AS SHIP_CPLT_COST_AMT
            ,MSRC.SVC_INV_CHRG_TP_CD           AS SVC_INV_CHRG_TP_CD
            ,MSRC.SVC_INV_CHRG_TP_DESC_TXT     AS SVC_INV_CHRG_TP_DESC_TXT
            ,MSRC.DS_INV_TP_CD                 AS DS_INV_TP_CD
            ,MSRC.INV_TP_DESC_TXT              AS INV_TP_DESC_TXT
            ,NULL                              AS SVC_INV_UNIT_HRS_AOT
            ,NULL                              AS SVC_LBOR_UNIT_AMT
            ,MSRC.INV_NUM                      AS INV_NUM
            ,MSRC.INV_BOL_LINE_NUM             AS INV_BOL_LINE_NUM
            ,MSRC.INV_LINE_NUM                 AS INV_LINE_NUM
            ,MSRC.INV_LINE_SUB_NUM             AS INV_LINE_SUB_NUM
            ,MSRC.INV_LINE_SUB_TRX_NUM         AS INV_LINE_SUB_TRX_NUM
            ,MSRC.SVC_INV_LINE_PK              AS SVC_INV_LINE_PK
            ,MSRC.INV_DT                       AS INV_DT
            ,MSRC.ACCT_DT                      AS ACCT_DT
            ,MSRC.BW_MTR_CHRG_DEAL_AMT         AS BW_MTR_CHRG_DEAL_AMT
            ,MSRC.BW_COST_AMT                  AS BW_COST_AMT
            ,MSRC.CLR_MTR_CHRG_DEAL_AMT        AS CLR_MTR_CHRG_DEAL_AMT
            ,MSRC.CLR_COST_AMT                 AS CLR_COST_AMT
            ,MSRC.OTH_INV_LINE_DEAL_NET_AMT    AS OTH_INV_LINE_DEAL_NET_AMT
            ,MSRC.OTH_COST_AMT                 AS OTH_COST_AMT
            ,MSRC.BLLG_PER_FROM_DT             AS BLLG_PER_FROM_DT
            ,MSRC.BLLG_PER_THRU_DT             AS BLLG_PER_THRU_DT
            ,MSRC.ACTL_MACH_QTY                AS ACTL_MACH_QTY
            ,MSRC.ORD_QTY                      AS ORD_QTY
            ,MSRC.CPO_ORD_NUM                  AS CPO_ORD_NUM
            ,MSRC.CPO_DTL_LINE_NUM             AS CPO_DTL_LINE_NUM
            ,MSRC.CPO_ORD_DT                   AS CPO_ORD_DT
            ,MSRC.IMG_SPLY_YIELD_CNT           AS IMG_SPLY_YIELD_CNT
            ,MSRC.SPLY_INCL_FLG                AS SPLY_INCL_FLG
            ,NULL                              AS SVC_PGM_MDSE_CD
            ,NULL                              AS FSR_NUM
            ,NULL                              AS FSR_CRAT_DT
            ,NULL                              AS INV_LINE_SPL_TP_CD
            ,NULL                              AS INV_LINE_SPL_TP_DESC_TXT
            ,NULL                              AS FSR_VISIT_NUM
            ,NULL                              AS SVC_TASK_CLO_DT
            ,NULL                              AS PRT_USED_BY_TECH_LOC_CD
            ,NULL                              AS UOM_CD
            ,NULL                              AS SVC_TASK_NUM
            ,NULL                              AS SVC_PBLM_TP_CD
            ,NULL                              AS SVC_PBLM_TP_DESC_TXT
            ,NULL                              AS IMG_SPLY_TP_CD
            ,NULL                              AS IMG_SPLY_TP_DESC_TXT
            ,NULL                              AS IMG_SPLY_COLOR_TP_CD
            ,NULL                              AS IMG_SPLY_COLOR_TP_DESC_TXT
            ,NULL                              AS USED_MULT_CNT
            ,NULL                              AS USED_EQUA_CNT
            ,MSRC.COA_CMPY_DESC_TXT            AS COA_CMPY_DESC_TXT
        FROM
             MLY_SPLY_REV_COST   MSRC
            ,RPT_COND_CONST      RCCD
        WHERE
            MSRC.GLBL_CMPY_CD                  = #glblCmpyCd#
        AND MSRC.FCT_CATG_CD                   = #revsply#
        AND MSRC.GLBL_CMPY_CD                  = RCCD.GLBL_CMPY_CD
        AND RCCD.RPT_COND_CONST_GRP_ID         = #cratDays#
        AND MSRC.DWH_TRGT_DT                   = TO_CHAR(TO_DATE(#trgtDt#, 'YYYYMMDD') - RCCD.RPT_COND_CONST_VAL_NUM_01, 'YYYYMMDD')
        AND MSRC.EZCANCELFLAG                  = '0'
        AND RCCD.EZCANCELFLAG                  = '0'
        UNION ALL
        -- Cost Service (Parts Usage)
        SELECT DISTINCT
             IT.GLBL_CMPY_CD                   AS GLBL_CMPY_CD
            ,IT.INVTY_TRX_DT                   AS DWH_TRGT_DT
            ,SUBSTR(IT.INVTY_TRX_DT, 1, 6)     AS DWH_TRGT_YR_MTH
            ,SUBSTR(IT.INVTY_TRX_DT, 1, 4)     AS DWH_TRGT_YR
            ,DRC.DWH_TRGT_QTR_NUM              AS DWH_TRGT_QTR_NUM
            ,#costsvc#                         AS FCT_CATG_CD
            ,DCD.DS_CONTR_PK                   AS DS_CONTR_PK
            ,DC.DS_CONTR_NUM                   AS DS_CONTR_NUM
            ,SIL.DS_CONTR_DTL_PK               AS DS_CONTR_DTL_PK
            ,DCD.DS_CONTR_DTL_TP_CD            AS DS_CONTR_DTL_TP_CD
            ,DCDT.DS_CONTR_DTL_TP_DESC_TXT     AS DS_CONTR_DTL_TP_DESC_TXT
            ,DC.SVC_CONTR_BR_CD                AS SVC_CONTR_BR_CD
            ,DC.DS_CONTR_CATG_CD               AS DS_CONTR_CATG_CD
            ,DCC.DS_CONTR_CATG_DESC_TXT        AS DS_CONTR_CATG_DESC_TXT
            ,DC.SVC_LINE_BIZ_CD                AS SVC_LINE_BIZ_CD
            ,SI.BILL_TO_CUST_ACCT_CD           AS DS_ACCT_NUM
            ,STCB.DS_ACCT_NM                   AS DS_ACCT_NM
            ,SI.BILL_TO_CUST_CD                AS ALT_PAYER_CUST_CD
            ,SMM.CUR_LOC_ACCT_NUM              AS CUR_LOC_ACCT_NUM
            ,STCL.DS_ACCT_NM                   AS CUR_LOC_ACCT_NM
            ,SMM.CUR_LOC_NUM                   AS CUR_LOC_NUM
            ,SMM.IND_CUR_LOC_NUM               AS IND_CUR_LOC_NUM
            ,DCD.SVC_MACH_MSTR_PK              AS SVC_MACH_MSTR_PK
            ,CASE
                WHEN DC.DS_CONTR_CATG_CD = #cntrCtgCd# THEN NVL(SMM.SER_NUM, #serNum#)
                ELSE SMM.SER_NUM
             END                               AS SER_NUM
            ,SCM.MDL_ID                        AS MDL_ID
            ,NVL(MN.T_MDL_NM, #mdlNm#)         AS T_MDL_NM
            ,DM.SVC_SEG_CD                     AS SVC_SEG_CD
            ,NVL(SS.SVC_SEG_DESC_TXT, #segDescTxt#)
                                               AS SVC_SEG_DESC_TXT
            ,NULL                              AS COA_CMPY_CD
            ,NULL                              AS COA_AFFL_CD
            ,NULL                              AS COA_BR_CD
            ,NULL                              AS COA_CH_CD
            ,NULL                              AS COA_CC_CD
            ,NULL                              AS COA_ACCT_CD
            ,M.COA_PROD_CD                     AS COA_PROD_CD
            ,NULL                              AS COA_PROJ_CD
            ,NULL                              AS COA_EXTN_CD
            ,IT.MDSE_CD                        AS MDSE_CD
            ,M.MDSE_DESC_SHORT_TXT             AS MDSE_DESC_SHORT_TXT
            ,IT.INVTY_TRX_QTY                  AS SHIP_QTY
            ,IT.UNIT_COST_AMT                  AS UNIT_COST_AMT
            ,IT.SHIP_COST_AMT                  AS SHIP_CPLT_COST_AMT
            ,SIL.SVC_INV_CHRG_TP_CD            AS SVC_INV_CHRG_TP_CD
            ,SICT.SVC_INV_CHRG_TP_DESC_TXT     AS SVC_INV_CHRG_TP_DESC_TXT
            ,NULL                              AS DS_INV_TP_CD
            ,NULL                              AS INV_TP_DESC_TXT
            ,NULL                              AS SVC_INV_UNIT_HRS_AOT
            ,TO_NUMBER(RCCL.RPT_COND_CONST_VAL_TXT_01) AS SVC_LBOR_UNIT_AMT
            ,SIL.SVC_INV_NUM                   AS INV_NUM
            ,NULL                              AS INV_BOL_LINE_NUM
            ,NULL                              AS INV_LINE_NUM
            ,NULL                              AS INV_LINE_SUB_NUM
            ,NULL                              AS INV_LINE_SUB_TRX_NUM
            ,SIL.SVC_INV_LINE_PK               AS SVC_INV_LINE_PK
            ,SI.INV_DT                         AS INV_DT
            ,NULL                              AS ACCT_DT
            ,NULL                              AS BW_MTR_CHRG_DEAL_AMT
            ,0                                 AS BW_COST_AMT
            ,NULL                              AS CLR_MTR_CHRG_DEAL_AMT
            ,0                                 AS CLR_COST_AMT
            ,NULL                              AS OTH_INV_LINE_DEAL_NET_AMT
            ,0                                 AS OTH_COST_AMT
            ,SIL.BLLG_PER_FROM_DT              AS BLLG_PER_FROM_DT
            ,SIL.BLLG_PER_THRU_DT              AS BLLG_PER_THRU_DT
            ,CASE
                WHEN DC.DS_CONTR_CATG_CD = #cntrCtgCd# THEN (
                    SELECT
                         COUNT(*) 
                    FROM
                         DS_CONTR_DTL  D
                        ,SVC_MACH_MSTR M
                    WHERE
                        D.GLBL_CMPY_CD       = DCD.GLBL_CMPY_CD
                    AND D.DS_CONTR_PK        = DCD.DS_CONTR_PK
                    AND D.DS_CONTR_DTL_TP_CD != #fleet#
                    AND D.CONTR_EFF_FROM_DT  &lt;= #trgtDt#
                    AND NVL(D.CONTR_CLO_DT, D.CONTR_EFF_THRU_DT) &gt;= #trgtDt#
                    AND D.GLBL_CMPY_CD       = M.GLBL_CMPY_CD
                    AND D.SVC_MACH_MSTR_PK   = M.SVC_MACH_MSTR_PK
                    AND M.SVC_MACH_TP_CD     = #svcMachTp#
                    AND D.EZCANCELFLAG       = '0'
                    AND M.EZCANCELFLAG       = '0'
                )
                ELSE 1
             END                               AS ACTL_MACH_QTY
            ,NULL                              AS ORD_QTY
            ,NULL                              AS CPO_ORD_NUM
            ,NULL                              AS CPO_DTL_LINE_NUM
            ,NULL                              AS CPO_ORD_DT
            ,M.IMG_SPLY_YIELD_CNT              AS IMG_SPLY_YIELD_CNT
            ,NULL                              AS SPLY_INCL_FLG
            ,DCD.SVC_PGM_MDSE_CD               AS SVC_PGM_MDSE_CD
            ,SI.FSR_NUM                        AS FSR_NUM
            ,F.FSR_CRAT_DT                     AS FSR_CRAT_DT
            ,NULL                              AS INV_LINE_SPL_TP_CD
            ,NULL                              AS INV_LINE_SPL_TP_DESC_TXT
            ,FV.FSR_VISIT_NUM                  AS FSR_VISIT_NUM
            ,ST.SVC_TASK_CLO_DT                AS SVC_TASK_CLO_DT
            ,IT.INVTY_LOC_CD                   AS PRT_USED_BY_TECH_LOC_CD
            ,CASE
                WHEN SIL.SVC_INV_CHRG_TP_CD = #invChrgTpLC# OR SIL.SVC_INV_CHRG_TP_CD = #invChrgTpTC# THEN #hr#
                WHEN SIL.SVC_INV_CHRG_TP_CD = #invChrgTpPC# THEN #ea#
                WHEN SIL.SVC_INV_CHRG_TP_CD = #invChrgTpXC# THEN #mi#
             END                               AS UOM_CD
            ,ST.SVC_TASK_NUM                   AS SVC_TASK_NUM
            ,FVT.SVC_PBLM_TP_CD                AS SVC_PBLM_TP_CD
            ,SPT.SVC_PBLM_TP_DESC_TXT          AS SVC_PBLM_TP_DESC_TXT
            ,NULL                              AS IMG_SPLY_TP_CD
            ,NULL                              AS IMG_SPLY_TP_DESC_TXT
            ,NULL                              AS IMG_SPLY_COLOR_TP_CD
            ,NULL                              AS IMG_SPLY_COLOR_TP_DESC_TXT
            ,NULL                              AS USED_MULT_CNT
            ,NULL                              AS USED_EQUA_CNT
            ,NVL(CCA.COA_CMPY_DESC_TXT, CCB.COA_CMPY_DESC_TXT)  AS COA_CMPY_DESC_TXT
        FROM
             INVTY_TRX            IT
            ,RPT_COND_CONST       RCCD
            ,RPT_COND_CONST       RCCT
            ,DMN_RPT_CAL          DRC
            ,FSR_VISIT            FV
            ,SVC_TASK             ST
            ,FSR                  F
            ,FSR_VISIT_TASK       FVT
            ,SVC_PBLM_TP          SPT
            ,SVC_INV_LINE         SIL
            ,RPT_COND_CONST       RCCC
            ,SVC_INV              SI
            ,SVC_INV_CHRG_TP      SICT
            ,SELL_TO_CUST         STCB
            ,MDSE                 M
            ,SVC_CONFIG_MSTR      SCM
            ,DS_MDL               DM
            ,MDL_NM               MN
            ,SVC_SEG              SS
            ,SVC_MACH_MSTR        SMM
            ,SELL_TO_CUST         STCL
            ,DS_CONTR_DTL         DCD
            ,DS_CONTR             DC
            ,DS_CONTR_DTL_TP      DCDT
            ,DS_CONTR_CATG        DCC
            ,RPT_COND_CONST       RCCL
            ,COA_CMPY             CCA
            ,COA_CMPY             CCB
        WHERE
            IT.GLBL_CMPY_CD                    = #glblCmpyCd#
        AND IT.GLBL_CMPY_CD                    = RCCD.GLBL_CMPY_CD
        AND RCCD.RPT_COND_CONST_GRP_ID         = #cratDays#
        AND IT.INVTY_TRX_DT                    = TO_CHAR(TO_DATE(#trgtDt#, 'YYYYMMDD') - RCCD.RPT_COND_CONST_VAL_NUM_01, 'YYYYMMDD')
        AND IT.GLBL_CMPY_CD                    = RCCT.GLBL_CMPY_CD
        AND IT.SYS_SRC_CD                      = RCCT.RPT_COND_CONST_VAL_TXT_01
        AND RCCT.RPT_COND_CONST_GRP_ID         = #usgTrxTp#
        AND IT.GLBL_CMPY_CD                    = DRC.GLBL_CMPY_CD
        AND IT.INVTY_TRX_DT                    = DRC.DWH_TRGT_DT
        AND IT.GLBL_CMPY_CD                    = FV.GLBL_CMPY_CD
        AND IT.PRO_NUM                         = FV.FSR_VISIT_NUM
        AND IT.INVTY_TRX_SLP_NUM               = FV.FSR_NUM
        AND IT.GLBL_CMPY_CD                    = ST.GLBL_CMPY_CD
        AND IT.BOL_NUM                         = ST.SVC_TASK_NUM
        AND IT.INVTY_TRX_SLP_NUM               = ST.FSR_NUM
        AND FV.GLBL_CMPY_CD                    = F.GLBL_CMPY_CD
        AND FV.FSR_NUM                         = F.FSR_NUM
        AND FV.GLBL_CMPY_CD                    = FVT.GLBL_CMPY_CD
        AND FV.SVC_TASK_NUM                    = FVT.SVC_TASK_NUM
        AND FV.FSR_VISIT_NUM                   = FVT.FSR_VISIT_NUM
        AND FVT.GLBL_CMPY_CD                   = SPT.GLBL_CMPY_CD
        AND FVT.SVC_PBLM_TP_CD                 = SPT.SVC_PBLM_TP_CD
        AND ST.GLBL_CMPY_CD                    = SIL.GLBL_CMPY_CD
        AND ST.SVC_TASK_NUM                    = SIL.SVC_TASK_NUM
        AND IT.MDSE_CD                         = SIL.MDSE_CD
        AND SIL.GLBL_CMPY_CD                   = RCCC.GLBL_CMPY_CD
        AND SIL.SVC_INV_CHRG_TP_CD             = RCCC.RPT_COND_CONST_VAL_TXT_01
        AND RCCC.RPT_COND_CONST_GRP_ID         = #usgChrgTp#
        AND SIL.GLBL_CMPY_CD                   = SI.GLBL_CMPY_CD
        AND SIL.SVC_INV_NUM                    = SI.SVC_INV_NUM
        AND SIL.GLBL_CMPY_CD                   = SICT.GLBL_CMPY_CD
        AND SIL.SVC_INV_CHRG_TP_CD             = SICT.SVC_INV_CHRG_TP_CD
        AND SI.GLBL_CMPY_CD                    = STCB.GLBL_CMPY_CD
        AND SI.BILL_TO_CUST_ACCT_CD            = STCB.SELL_TO_CUST_CD
        AND SIL.GLBL_CMPY_CD                   = M.GLBL_CMPY_CD(+)
        AND SIL.MDSE_CD                        = M.MDSE_CD(+)
        AND SIL.GLBL_CMPY_CD                   = SMM.GLBL_CMPY_CD(+)
        AND SIL.SVC_MACH_MSTR_PK               = SMM.SVC_MACH_MSTR_PK(+)
        AND SMM.GLBL_CMPY_CD                   = SCM.GLBL_CMPY_CD(+)
        AND SMM.SVC_CONFIG_MSTR_PK             = SCM.SVC_CONFIG_MSTR_PK(+)
        AND SCM.GLBL_CMPY_CD                   = DM.GLBL_CMPY_CD(+)
        AND SCM.MDL_ID                         = DM.MDL_ID(+)
        AND SCM.GLBL_CMPY_CD                   = MN.T_GLBL_CMPY_CD(+)
        AND SCM.MDL_ID                         = MN.T_MDL_ID(+)
        AND DM.GLBL_CMPY_CD                    = SS.GLBL_CMPY_CD(+)
        AND DM.SVC_SEG_CD                      = SS.SVC_SEG_CD(+)
        AND SMM.GLBL_CMPY_CD                   = STCL.GLBL_CMPY_CD(+)
        AND SMM.CUR_LOC_ACCT_NUM               = STCL.SELL_TO_CUST_CD(+)
        AND SIL.GLBL_CMPY_CD                   = DCD.GLBL_CMPY_CD(+)
        AND SIL.DS_CONTR_DTL_PK                = DCD.DS_CONTR_DTL_PK(+)
        AND DCD.GLBL_CMPY_CD                   = DC.GLBL_CMPY_CD(+)
        AND DCD.DS_CONTR_PK                    = DC.DS_CONTR_PK(+)
        AND DCD.GLBL_CMPY_CD                   = DCDT.GLBL_CMPY_CD(+)
        AND DCD.DS_CONTR_DTL_TP_CD             = DCDT.DS_CONTR_DTL_TP_CD(+)
        AND DC.GLBL_CMPY_CD                    = DCC.GLBL_CMPY_CD(+)
        AND DC.DS_CONTR_CATG_CD                = DCC.DS_CONTR_CATG_CD(+)
        AND IT.GLBL_CMPY_CD                    = RCCL.GLBL_CMPY_CD
        AND RCCL.RPT_COND_CONST_GRP_ID         = #lborUnit#
        AND RCCL.RPT_COND_CONST_CD             = #rptCondCostCd01#
        AND SIL.GLBL_CMPY_CD                   = CCA.GLBL_CMPY_CD(+)
        AND SIL.COA_CMPY_CD                    = CCA.COA_CMPY_CD(+)
        AND IT.GLBL_CMPY_CD                    = CCB.COA_CMPY_CD
        AND IT.EZCANCELFLAG                    = '0'
        AND RCCD.EZCANCELFLAG                  = '0'
        AND RCCT.EZCANCELFLAG                  = '0'
        AND DRC.EZCANCELFLAG                   = '0'
        AND FV.EZCANCELFLAG                    = '0'
        AND ST.EZCANCELFLAG                    = '0'
        AND F.EZCANCELFLAG                     = '0'
        AND FVT.EZCANCELFLAG                   = '0'
        AND SPT.EZCANCELFLAG                   = '0'
        AND SIL.EZCANCELFLAG                   = '0'
        AND RCCC.EZCANCELFLAG                  = '0'
        AND SI.EZCANCELFLAG                    = '0'
        AND SICT.EZCANCELFLAG                  = '0'
        AND STCB.EZCANCELFLAG                  = '0'
        AND M.EZCANCELFLAG(+)                  = '0'
        AND SCM.EZCANCELFLAG(+)                = '0'
        AND DM.EZCANCELFLAG(+)                 = '0'
        AND MN.EZCANCELFLAG(+)                 = '0'
        AND SS.EZCANCELFLAG(+)                 = '0'
        AND SMM.EZCANCELFLAG(+)                = '0'
        AND STCL.EZCANCELFLAG(+)               = '0'
        AND DCD.EZCANCELFLAG(+)                = '0'
        AND DC.EZCANCELFLAG(+)                 = '0'
        AND DCDT.EZCANCELFLAG(+)               = '0'
        AND DCC.EZCANCELFLAG(+)                = '0'
        AND RCCL.EZCANCELFLAG                  = '0'
        AND CCA.EZCANCELFLAG(+)                = '0'
        AND CCB.EZCANCELFLAG                   = '0'
        UNION ALL
        -- Cost Service (Labor/Travel/Expense)
        SELECT DISTINCT
             ST.GLBL_CMPY_CD                   AS GLBL_CMPY_CD
            ,SI.INV_DT                         AS DWH_TRGT_DT
            ,SUBSTR(SI.INV_DT, 1, 6)           AS DWH_TRGT_YR_MTH
            ,SUBSTR(SI.INV_DT, 1, 4)           AS DWH_TRGT_YR
            ,DRC.DWH_TRGT_QTR_NUM              AS DWH_TRGT_QTR_NUM
            ,#costsvc#                         AS FCT_CATG_CD
            ,DCD.DS_CONTR_PK                   AS DS_CONTR_PK
            ,DC.DS_CONTR_NUM                   AS DS_CONTR_NUM
            ,SIL.DS_CONTR_DTL_PK               AS DS_CONTR_DTL_PK
            ,DCD.DS_CONTR_DTL_TP_CD            AS DS_CONTR_DTL_TP_CD
            ,DCDT.DS_CONTR_DTL_TP_DESC_TXT     AS DS_CONTR_DTL_TP_DESC_TXT
            ,DC.SVC_CONTR_BR_CD                AS SVC_CONTR_BR_CD
            ,DC.DS_CONTR_CATG_CD               AS DS_CONTR_CATG_CD
            ,DCC.DS_CONTR_CATG_DESC_TXT        AS DS_CONTR_CATG_DESC_TXT
            ,DC.SVC_LINE_BIZ_CD                AS SVC_LINE_BIZ_CD
            ,SI.BILL_TO_CUST_ACCT_CD           AS DS_ACCT_NUM
            ,STCB.DS_ACCT_NM                   AS DS_ACCT_NM
            ,SI.BILL_TO_CUST_CD                AS ALT_PAYER_CUST_CD
            ,SMM.CUR_LOC_ACCT_NUM              AS CUR_LOC_ACCT_NUM
            ,STCL.DS_ACCT_NM                   AS CUR_LOC_ACCT_NM
            ,SMM.CUR_LOC_NUM                   AS CUR_LOC_NUM
            ,SMM.IND_CUR_LOC_NUM               AS IND_CUR_LOC_NUM
            ,DCD.SVC_MACH_MSTR_PK              AS SVC_MACH_MSTR_PK
            ,CASE
                WHEN DC.DS_CONTR_CATG_CD = #cntrCtgCd# THEN NVL(SMM.SER_NUM, #serNum#)
                ELSE SMM.SER_NUM
             END                               AS SER_NUM
            ,SCM.MDL_ID                        AS MDL_ID
            ,NVL(MN.T_MDL_NM, #mdlNm#)         AS T_MDL_NM
            ,DM.SVC_SEG_CD                     AS SVC_SEG_CD
            ,NVL(SS.SVC_SEG_DESC_TXT, #segDescTxt#)
                                               AS SVC_SEG_DESC_TXT
            ,NULL                              AS COA_CMPY_CD
            ,NULL                              AS COA_AFFL_CD
            ,NULL                              AS COA_BR_CD
            ,NULL                              AS COA_CH_CD
            ,NULL                              AS COA_CC_CD
            ,NULL                              AS COA_ACCT_CD
            ,M.COA_PROD_CD                     AS COA_PROD_CD
            ,NULL                              AS COA_PROJ_CD
            ,NULL                              AS COA_EXTN_CD
            ,SIL.MDSE_CD                       AS MDSE_CD
            ,M.MDSE_DESC_SHORT_TXT             AS MDSE_DESC_SHORT_TXT
            ,SIL.SVC_INV_QTY                   AS SHIP_QTY
            ,NULL                              AS UNIT_COST_AMT
            ,NULL                              AS SHIP_CPLT_COST_AMT
            ,SIL.SVC_INV_CHRG_TP_CD            AS SVC_INV_CHRG_TP_CD
            ,SICT.SVC_INV_CHRG_TP_DESC_TXT     AS SVC_INV_CHRG_TP_DESC_TXT
            ,NULL                              AS DS_INV_TP_CD
            ,NULL                              AS INV_TP_DESC_TXT
            ,SIL.SVC_INV_UNIT_HRS_AOT          AS SVC_INV_UNIT_HRS_AOT
            ,TO_NUMBER(RCCL.RPT_COND_CONST_VAL_TXT_01) AS SVC_LBOR_UNIT_AMT
            ,SIL.SVC_INV_NUM                   AS INV_NUM
            ,NULL                              AS INV_BOL_LINE_NUM
            ,NULL                              AS INV_LINE_NUM
            ,NULL                              AS INV_LINE_SUB_NUM
            ,NULL                              AS INV_LINE_SUB_TRX_NUM
            ,SIL.SVC_INV_LINE_PK               AS SVC_INV_LINE_PK
            ,SI.INV_DT                         AS INV_DT
            ,NULL                              AS ACCT_DT
            ,NULL                              AS BW_MTR_CHRG_DEAL_AMT
            ,0                                 AS BW_COST_AMT
            ,NULL                              AS CLR_MTR_CHRG_DEAL_AMT
            ,0                                 AS CLR_COST_AMT
            ,NULL                              AS OTH_INV_LINE_DEAL_NET_AMT
            ,0                                 AS OTH_COST_AMT
            ,SIL.BLLG_PER_FROM_DT              AS BLLG_PER_FROM_DT
            ,SIL.BLLG_PER_THRU_DT              AS BLLG_PER_THRU_DT
            ,CASE
                WHEN DC.DS_CONTR_CATG_CD = #cntrCtgCd# THEN (
                    SELECT
                         COUNT(*) 
                    FROM
                         DS_CONTR_DTL  D
                        ,SVC_MACH_MSTR M
                    WHERE
                        D.GLBL_CMPY_CD       = DCD.GLBL_CMPY_CD
                    AND D.DS_CONTR_PK        = DCD.DS_CONTR_PK
                    AND D.DS_CONTR_DTL_TP_CD != #fleet#
                    AND D.CONTR_EFF_FROM_DT  &lt;= #trgtDt#
                    AND NVL(D.CONTR_CLO_DT, D.CONTR_EFF_THRU_DT) &gt;= #trgtDt#
                    AND D.GLBL_CMPY_CD       = M.GLBL_CMPY_CD
                    AND D.SVC_MACH_MSTR_PK   = M.SVC_MACH_MSTR_PK
                    AND M.SVC_MACH_TP_CD     = #svcMachTp#
                    AND D.EZCANCELFLAG       = '0'
                    AND M.EZCANCELFLAG       = '0'
                )
                ELSE 1
             END                               AS ACTL_MACH_QTY
            ,NULL                              AS ORD_QTY
            ,NULL                              AS CPO_ORD_NUM
            ,NULL                              AS CPO_DTL_LINE_NUM
            ,NULL                              AS CPO_ORD_DT
            ,M.IMG_SPLY_YIELD_CNT              AS IMG_SPLY_YIELD_CNT
            ,NULL                              AS SPLY_INCL_FLG
            ,DCD.SVC_PGM_MDSE_CD               AS SVC_PGM_MDSE_CD
            ,SI.FSR_NUM                        AS FSR_NUM
            ,F.FSR_CRAT_DT                     AS FSR_CRAT_DT
            ,NULL                              AS INV_LINE_SPL_TP_CD
            ,NULL                              AS INV_LINE_SPL_TP_DESC_TXT
            ,FV.FSR_VISIT_NUM                  AS FSR_VISIT_NUM
            ,ST.SVC_TASK_CLO_DT                AS SVC_TASK_CLO_DT
            ,NULL                              AS PRT_USED_BY_TECH_LOC_CD
            ,CASE
                WHEN SIL.SVC_INV_CHRG_TP_CD = #invChrgTpLC# OR SIL.SVC_INV_CHRG_TP_CD =#invChrgTpTC# THEN #hr#
                WHEN SIL.SVC_INV_CHRG_TP_CD = #invChrgTpPC# THEN #ea#
                WHEN SIL.SVC_INV_CHRG_TP_CD = #invChrgTpXC# THEN #mi#
             END                               AS UOM_CD
            ,ST.SVC_TASK_NUM                   AS SVC_TASK_NUM
            ,FVT.SVC_PBLM_TP_CD                AS SVC_PBLM_TP_CD
            ,SPT.SVC_PBLM_TP_DESC_TXT          AS SVC_PBLM_TP_DESC_TXT
            ,NULL                              AS IMG_SPLY_TP_CD
            ,NULL                              AS IMG_SPLY_TP_DESC_TXT
            ,NULL                              AS IMG_SPLY_COLOR_TP_CD
            ,NULL                              AS IMG_SPLY_COLOR_TP_DESC_TXT
            ,NULL                              AS USED_MULT_CNT
            ,NULL                              AS USED_EQUA_CNT
            ,NVL(CCA.COA_CMPY_DESC_TXT, CCB.COA_CMPY_DESC_TXT)  AS COA_CMPY_DESC_TXT
        FROM
             SVC_INV              SI
            ,RPT_COND_CONST       RCCD
            ,SELL_TO_CUST         STCB
            ,DMN_RPT_CAL          DRC
            ,SVC_INV_LINE         SIL
            ,RPT_COND_CONST       RCCC
            ,SVC_INV_CHRG_TP      SICT
            ,SVC_TASK             ST
            ,FSR_VISIT            FV
            ,FSR_VISIT_TASK       FVT
            ,FSR                  F
            ,SVC_PBLM_TP          SPT
            ,MDSE                 M
            ,SVC_CONFIG_MSTR      SCM
            ,DS_MDL               DM
            ,MDL_NM               MN
            ,SVC_SEG              SS
            ,SVC_MACH_MSTR        SMM
            ,SELL_TO_CUST         STCL
            ,DS_CONTR_DTL         DCD
            ,DS_CONTR             DC
            ,DS_CONTR_DTL_TP      DCDT
            ,DS_CONTR_CATG        DCC
            ,RPT_COND_CONST       RCCL
            ,COA_CMPY             CCA
            ,COA_CMPY             CCB
        WHERE
            SI.GLBL_CMPY_CD                    = #glblCmpyCd#
        AND SI.GLBL_CMPY_CD                    = RCCD.GLBL_CMPY_CD
        AND RCCD.RPT_COND_CONST_GRP_ID         = #cratDays#
        AND SI.INV_DT                          = TO_CHAR(TO_DATE(#trgtDt#, 'YYYYMMDD') - RCCD.RPT_COND_CONST_VAL_NUM_01, 'YYYYMMDD')
        AND SI.GLBL_CMPY_CD                    = STCB.GLBL_CMPY_CD
        AND SI.BILL_TO_CUST_ACCT_CD            = STCB.SELL_TO_CUST_CD
        AND SI.GLBL_CMPY_CD                    = DRC.GLBL_CMPY_CD
        AND SI.INV_DT                          = DRC.DWH_TRGT_DT
        AND SI.GLBL_CMPY_CD                    = SIL.GLBL_CMPY_CD
        AND SI.SVC_INV_NUM                     = SIL.SVC_INV_NUM
        AND SIL.GLBL_CMPY_CD                   = RCCC.GLBL_CMPY_CD
        AND SIL.SVC_INV_CHRG_TP_CD             = RCCC.RPT_COND_CONST_VAL_TXT_01
        AND RCCC.RPT_COND_CONST_GRP_ID         = #expChrgTp#
        AND SIL.GLBL_CMPY_CD                   = SICT.GLBL_CMPY_CD
        AND SIL.SVC_INV_CHRG_TP_CD             = SICT.SVC_INV_CHRG_TP_CD
        AND SIL.GLBL_CMPY_CD                   = ST.GLBL_CMPY_CD
        AND SIL.SVC_TASK_NUM                   = ST.SVC_TASK_NUM
        AND ST.GLBL_CMPY_CD                    = FV.GLBL_CMPY_CD
        AND ST.SVC_TASK_NUM                    = FV.SVC_TASK_NUM
        AND FV.GLBL_CMPY_CD                    = FVT.GLBL_CMPY_CD
        AND FV.SVC_TASK_NUM                    = FVT.SVC_TASK_NUM
        AND FV.FSR_VISIT_NUM                   = FVT.FSR_VISIT_NUM
        AND ST.GLBL_CMPY_CD                    = F.GLBL_CMPY_CD
        AND ST.FSR_NUM                         = F.FSR_NUM
        AND FVT.GLBL_CMPY_CD                   = SPT.GLBL_CMPY_CD
        AND FVT.SVC_PBLM_TP_CD                 = SPT.SVC_PBLM_TP_CD
        AND SIL.GLBL_CMPY_CD                   = M.GLBL_CMPY_CD(+)
        AND SIL.MDSE_CD                        = M.MDSE_CD(+)
        AND SIL.GLBL_CMPY_CD                   = SMM.GLBL_CMPY_CD(+)
        AND SIL.SVC_MACH_MSTR_PK               = SMM.SVC_MACH_MSTR_PK(+)
        AND SMM.GLBL_CMPY_CD                   = SCM.GLBL_CMPY_CD(+)
        AND SMM.SVC_CONFIG_MSTR_PK             = SCM.SVC_CONFIG_MSTR_PK(+)
        AND SCM.GLBL_CMPY_CD                   = DM.GLBL_CMPY_CD(+)
        AND SCM.MDL_ID                         = DM.MDL_ID(+)
        AND SCM.GLBL_CMPY_CD                   = MN.T_GLBL_CMPY_CD(+)
        AND SCM.MDL_ID                         = MN.T_MDL_ID(+)
        AND DM.GLBL_CMPY_CD                    = SS.GLBL_CMPY_CD(+)
        AND DM.SVC_SEG_CD                      = SS.SVC_SEG_CD(+)
        AND SMM.GLBL_CMPY_CD                   = STCL.GLBL_CMPY_CD(+)
        AND SMM.CUR_LOC_ACCT_NUM               = STCL.SELL_TO_CUST_CD(+)
        AND SIL.GLBL_CMPY_CD                   = DCD.GLBL_CMPY_CD(+)
        AND SIL.DS_CONTR_DTL_PK                = DCD.DS_CONTR_DTL_PK(+)
        AND DCD.GLBL_CMPY_CD                   = DC.GLBL_CMPY_CD(+)
        AND DCD.DS_CONTR_PK                    = DC.DS_CONTR_PK(+)
        AND DCD.GLBL_CMPY_CD                   = DCDT.GLBL_CMPY_CD(+)
        AND DCD.DS_CONTR_DTL_TP_CD             = DCDT.DS_CONTR_DTL_TP_CD(+)
        AND DC.GLBL_CMPY_CD                    = DCC.GLBL_CMPY_CD(+)
        AND DC.DS_CONTR_CATG_CD                = DCC.DS_CONTR_CATG_CD(+)
        AND SI.GLBL_CMPY_CD                    = RCCL.GLBL_CMPY_CD
        AND RCCL.RPT_COND_CONST_GRP_ID         = #lborUnit#
        AND RCCL.RPT_COND_CONST_CD             = #rptCondCostCd01#
        AND SIL.GLBL_CMPY_CD                   = CCA.GLBL_CMPY_CD(+)
        AND SIL.COA_CMPY_CD                    = CCA.COA_CMPY_CD(+)
        AND SI.GLBL_CMPY_CD                    = CCB.COA_CMPY_CD
        AND SI.EZCANCELFLAG                    = '0'
        AND RCCD.EZCANCELFLAG                  = '0'
        AND STCB.EZCANCELFLAG                  = '0'
        AND DRC.EZCANCELFLAG                   = '0'
        AND SIL.EZCANCELFLAG                   = '0'
        AND RCCC.EZCANCELFLAG                  = '0'
        AND SICT.EZCANCELFLAG                  = '0'
        AND ST.EZCANCELFLAG                    = '0'
        AND FV.EZCANCELFLAG                    = '0'
        AND FVT.EZCANCELFLAG                   = '0'
        AND F.EZCANCELFLAG                     = '0'
        AND SPT.EZCANCELFLAG                   = '0'
        AND M.EZCANCELFLAG(+)                  = '0'
        AND SCM.EZCANCELFLAG(+)                = '0'
        AND DM.EZCANCELFLAG(+)                 = '0'
        AND MN.EZCANCELFLAG(+)                 = '0'
        AND SS.EZCANCELFLAG(+)                 = '0'
        AND SMM.EZCANCELFLAG(+)                = '0'
        AND STCL.EZCANCELFLAG(+)               = '0'
        AND DCD.EZCANCELFLAG(+)                = '0'
        AND DC.EZCANCELFLAG(+)                 = '0'
        AND DCDT.EZCANCELFLAG(+)               = '0'
        AND DCC.EZCANCELFLAG(+)                = '0'
        AND RCCL.EZCANCELFLAG                  = '0'
        AND CCA.EZCANCELFLAG(+)                = '0'
        AND CCB.EZCANCELFLAG                   = '0'
        UNION ALL
        -- Cost Supply
        SELECT DISTINCT
             MSRC.GLBL_CMPY_CD                 AS GLBL_CMPY_CD
            ,MSRC.DWH_TRGT_DT                  AS DWH_TRGT_DT
            ,MSRC.DWH_TRGT_YR_MTH              AS DWH_TRGT_YR_MTH
            ,MSRC.DWH_TRGT_YR                  AS DWH_TRGT_YR
            ,MSRC.DWH_TRGT_QTR_NUM             AS DWH_TRGT_QTR_NUM
            ,#costsply#                        AS FCT_CATG_CD
            ,MSRC.DS_CONTR_PK                  AS DS_CONTR_PK
            ,MSRC.DS_CONTR_NUM                 AS DS_CONTR_NUM
            ,MSRC.DS_CONTR_DTL_PK              AS DS_CONTR_DTL_PK
            ,MSRC.DS_CONTR_DTL_TP_CD           AS DS_CONTR_DTL_TP_CD
            ,MSRC.DS_CONTR_DTL_TP_DESC_TXT     AS DS_CONTR_DTL_TP_DESC_TXT
            ,MSRC.SVC_CONTR_BR_CD              AS SVC_CONTR_BR_CD
            ,MSRC.DS_CONTR_CATG_CD             AS DS_CONTR_CATG_CD
            ,MSRC.DS_CONTR_CATG_DESC_TXT       AS DS_CONTR_CATG_DESC_TXT
            ,MSRC.SVC_LINE_BIZ_CD              AS SVC_LINE_BIZ_CD
            ,MSRC.DS_ACCT_NUM                  AS DS_ACCT_NUM
            ,MSRC.DS_ACCT_NM                   AS DS_ACCT_NM
            ,MSRC.ALT_PAYER_CUST_CD            AS ALT_PAYER_CUST_CD
            ,MSRC.CUR_LOC_ACCT_NUM             AS CUR_LOC_ACCT_NUM
            ,MSRC.CUR_LOC_ACCT_NM              AS CUR_LOC_ACCT_NM
            ,MSRC.CUR_LOC_NUM                  AS CUR_LOC_NUM
            ,MSRC.IND_CUR_LOC_NUM              AS IND_CUR_LOC_NUM
            ,MSRC.SVC_MACH_MSTR_PK             AS SVC_MACH_MSTR_PK
            ,MSRC.SER_NUM                      AS SER_NUM
            ,MSRC.MDL_ID                       AS MDL_ID
            ,MSRC.T_MDL_NM                     AS T_MDL_NM
            ,MSRC.SVC_SEG_CD                   AS SVC_SEG_CD
            ,MSRC.SVC_SEG_DESC_TXT             AS SVC_SEG_DESC_TXT
            ,NULL                              AS COA_CMPY_CD
            ,NULL                              AS COA_AFFL_CD
            ,NULL                              AS COA_BR_CD
            ,NULL                              AS COA_CH_CD
            ,NULL                              AS COA_CC_CD
            ,NULL                              AS COA_ACCT_CD
            ,MSRC.COA_PROD_CD                  AS COA_PROD_CD
            ,NULL                              AS COA_PROJ_CD
            ,NULL                              AS COA_EXTN_CD
            ,MSRC.MDSE_CD                      AS MDSE_CD
            ,MSRC.MDSE_DESC_SHORT_TXT          AS MDSE_DESC_SHORT_TXT
            ,MSRC.SHIP_QTY                     AS SHIP_QTY
            ,MSRC.UNIT_COST_AMT                AS UNIT_COST_AMT
            ,MSRC.SHIP_CPLT_COST_AMT           AS SHIP_CPLT_COST_AMT
            ,NULL                              AS SVC_INV_CHRG_TP_CD
            ,NULL                              AS SVC_INV_CHRG_TP_DESC_TXT
            ,NULL                              AS DS_INV_TP_CD
            ,NULL                              AS INV_TP_DESC_TXT
            ,NULL                              AS SVC_INV_UNIT_HRS_AOT
            ,NULL                              AS SVC_LBOR_UNIT_AMT
            ,MSRC.INV_NUM                      AS INV_NUM
            ,MSRC.INV_BOL_LINE_NUM             AS INV_BOL_LINE_NUM
            ,MSRC.INV_LINE_NUM                 AS INV_LINE_NUM
            ,MSRC.INV_LINE_SUB_NUM             AS INV_LINE_SUB_NUM
            ,MSRC.INV_LINE_SUB_TRX_NUM         AS INV_LINE_SUB_TRX_NUM
            ,MSRC.SVC_INV_LINE_PK              AS SVC_INV_LINE_PK
            ,MSRC.INV_DT                       AS INV_DT
            ,NULL                              AS ACCT_DT
            ,NULL                              AS BW_MTR_CHRG_DEAL_AMT
            ,MSRC.BW_COST_AMT                  AS BW_COST_AMT
            ,NULL                              AS CLR_MTR_CHRG_DEAL_AMT
            ,MSRC.CLR_COST_AMT                 AS CLR_COST_AMT
            ,NULL                              AS OTH_INV_LINE_DEAL_NET_AMT
            ,MSRC.OTH_COST_AMT                 AS OTH_COST_AMT
            ,MSRC.BLLG_PER_FROM_DT             AS BLLG_PER_FROM_DT
            ,MSRC.BLLG_PER_THRU_DT             AS BLLG_PER_THRU_DT
            ,CASE
                WHEN MSRC.DS_CONTR_CATG_CD = #cntrCtgCd# THEN (
                    SELECT
                         COUNT(*) 
                    FROM
                         DS_CONTR_DTL  D
                        ,SVC_MACH_MSTR M
                    WHERE
                        D.GLBL_CMPY_CD       = MSRC.GLBL_CMPY_CD
                    AND D.DS_CONTR_PK        = MSRC.DS_CONTR_PK
                    AND D.DS_CONTR_DTL_TP_CD != #fleet#
                    AND D.CONTR_EFF_FROM_DT  &lt;= #trgtDt#
                    AND NVL(D.CONTR_CLO_DT, D.CONTR_EFF_THRU_DT) &gt;= #trgtDt#
                    AND D.GLBL_CMPY_CD       = M.GLBL_CMPY_CD
                    AND D.SVC_MACH_MSTR_PK   = M.SVC_MACH_MSTR_PK
                    AND M.SVC_MACH_TP_CD     = #svcMachTp#
                    AND D.EZCANCELFLAG       = '0'
                    AND M.EZCANCELFLAG       = '0'
                )
                ELSE 1
             END                               AS ACTL_MACH_QTY
            ,MSRC.ORD_QTY                      AS ORD_QTY
            ,MSRC.CPO_ORD_NUM                  AS CPO_ORD_NUM
            ,MSRC.CPO_DTL_LINE_NUM             AS CPO_DTL_LINE_NUM
            ,MSRC.CPO_ORD_DT                   AS CPO_ORD_DT
            ,MSRC.IMG_SPLY_YIELD_CNT           AS IMG_SPLY_YIELD_CNT
            ,MSRC.SPLY_INCL_FLG                AS SPLY_INCL_FLG
            ,NULL                              AS SVC_PGM_MDSE_CD
            ,NULL                              AS FSR_NUM
            ,NULL                              AS FSR_CRAT_DT
            ,NULL                              AS INV_LINE_SPL_TP_CD
            ,NULL                              AS INV_LINE_SPL_TP_DESC_TXT
            ,NULL                              AS FSR_VISIT_NUM
            ,NULL                              AS SVC_TASK_CLO_DT
            ,MSRC.PRT_USED_BY_TECH_LOC_CD      AS PRT_USED_BY_TECH_LOC_CD
            ,NULL                              AS UOM_CD
            ,NULL                              AS SVC_TASK_NUM
            ,NULL                              AS SVC_PBLM_TP_CD
            ,NULL                              AS SVC_PBLM_TP_DESC_TXT
            ,MSRC.IMG_SPLY_TP_CD               AS IMG_SPLY_TP_CD
            ,MSRC.IMG_SPLY_TP_DESC_TXT         AS IMG_SPLY_TP_DESC_TXT
            ,MSRC.IMG_SPLY_COLOR_TP_CD         AS IMG_SPLY_COLOR_TP_CD
            ,MSRC.IMG_SPLY_COLOR_TP_DESC_TXT   AS IMG_SPLY_COLOR_TP_DESC_TXT
            ,MSRC.USED_MULT_CNT                AS USED_MULT_CNT
            ,MSRC.USED_EQUA_CNT                AS USED_EQUA_CNT
            ,MSRC.COA_CMPY_DESC_TXT            AS COA_CMPY_DESC_TXT
        FROM
             MLY_SPLY_REV_COST    MSRC
            ,RPT_COND_CONST       RCCD
        WHERE
            MSRC.GLBL_CMPY_CD                  = #glblCmpyCd#
        AND MSRC.FCT_CATG_CD                   = #costsply#
        AND MSRC.GLBL_CMPY_CD                  = RCCD.GLBL_CMPY_CD
        AND RCCD.RPT_COND_CONST_GRP_ID         = #cratDays#
        AND MSRC.DWH_TRGT_DT                   = TO_CHAR(TO_DATE(#trgtDt#, 'YYYYMMDD') - RCCD.RPT_COND_CONST_VAL_NUM_01, 'YYYYMMDD')
        AND MSRC.EZCANCELFLAG                  = '0'
        AND RCCD.EZCANCELFLAG                  = '0'
    </statement>

</sqlMap>
