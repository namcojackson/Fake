<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPAB119001">

    <statement id="findCusaShipItem" parameterClass="Map" resultClass="Map">
        SELECT
            SI.SHPG_PLN_NUM
            ,SI.SO_NUM
            ,SP.SO_SLP_NUM
            ,SI.SO_CRAT_DT
            ,SI.MDSE_CD
            ,SI.MDL_NM
            ,SI.SHIP_QTY
            ,SI.SHIP_TO_ADDR_TP_CD
            ,SC.BOL_NUM
            ,SC.PRO_NUM
            ,SI.ACTL_SHIP_DT
            ,SI.RCPO_POSN_NUM
            ,SI.MACH_MDL_TP_CD AS PROD_MDL_TP_CD
        FROM
            CSA_SHIP_ITEM_V SI
            ,CSA_SHPG_PLN_V SP
            ,CSA_SHPG_ORD_CONF_DTL_V SC
        WHERE
            1 = 1
        AND SI.GLBL_CMPY_CD     = #cusaGlblCmpyCd#
        AND SI.ACTL_SHIP_DT     = #salesDate#
        <iterate property="shipToAddrTpCdList" var="shipToAddrTpCd[]" open="AND SI.SHIP_TO_ADDR_TP_CD NOT IN (" conjunction= ", " close=")">
            #shipToAddrTpCd[]#
        </iterate>
        AND NOT EXISTS (
            SELECT
                1
            FROM
                ROSS_SHIP_HDR RH
            WHERE
                1 = 1
            AND RH.GLBL_CMPY_CD = #csaGlblCmpyCd#
            AND RH.SO_NUM       = SP.SO_NUM
            AND RH.EZCANCELFLAG = '0'
        )
        -- JOIN TO CSA_SHPG_PLN_V
        AND SI.GLBL_CMPY_CD     = SP.GLBL_CMPY_CD
        AND SI.SHPG_PLN_NUM     = SP.SHPG_PLN_NUM
        -- JOIN TO CSA_SHPG_ORD_CONF_DTL_V
        AND SP.GLBL_CMPY_CD     = SC.GLBL_CMPY_CD(+)
        AND SP.SO_NUM           = SC.SO_NUM(+)
        AND SP.SO_SLP_NUM       = SC.SO_SLP_NUM(+)
        -- EZCANCELFLAG
        AND SI.EZCANCELFLAG     = '0'
        AND SP.EZCANCELFLAG     = '0'
        AND SC.EZCANCELFLAG(+)  = '0'
    </statement>

    <statement id="findCusaShipHdr" parameterClass="Map" resultClass="Map">
        SELECT /*+ leading(rsi) no_merge(sh) */
        DISTINCT
             SH.SO_NUM
            ,SH.SO_CRAT_DT
            ,SH.CPO_ORD_NUM CPO_ORD_NUM
            ,SH.SVC_DLR_CD
            ,SH.INSTL_NM
            ,SH.RTL_DIV_CD
            ,SH.DLR_WH_LOC_CD
            ,SH.SHIP_TO_LOC_NM
            ,SH.SHIP_TO_FIRST_LINE_ADDR
            ,SH.SHIP_TO_CTY_ADDR
            ,SH.SHIP_TO_ST_CD
            ,SH.SHIP_TO_POST_CD
            ,SO.CUST_ISS_PO_NUM
            ,SO.PDD_DT
            ,SO.VND_CD
            ,RSI.BOL_NUM
            ,RSI.PRO_NUM
        FROM
            ROSS_SHIP_ITEM RSI
            ,CSA_SHIP_HDR_V SH
            ,CSA_SHPG_ORD_V SO
        WHERE
            1 = 1
        AND RSI.GLBL_CMPY_CD = #csaGlblCmpyCd#
        AND RSI.IMPT_PROC_CD = #imptProcCd#
        -- JOIN TO CSA_SHIP_HDR_V
        AND RSI.SO_NUM       = SH.SO_NUM
        AND SH.GLBL_CMPY_CD  = #cusaGlblCmpyCd#
        -- JOIN TO CSA_SHPG_ORD_V
        AND SH.GLBL_CMPY_CD  = SO.GLBL_CMPY_CD
        AND SH.SO_NUM        = SO.SO_NUM
        -- EZCANCELFLAG
        AND RSI.EZCANCELFLAG = '0'
        AND SH.EZCANCELFLAG  = '0'
        AND SO.EZCANCELFLAG  = '0'
    </statement>

    <statement id="findCusaShipSer" parameterClass="Map" resultClass="Map">
        SELECT
             SS.SHIP_UNIT_PK
            ,SS.SHPG_PLN_NUM
            ,SS.SER_NUM
            ,SS.SO_NUM
            ,SP.SO_SLP_NUM
            ,SS.MDSE_CD
            ,RSI.BOL_NUM
            ,RSI.PRO_NUM
        FROM
             ROSS_SHIP_ITEM RSI
            ,CSA_SHIP_SER_V SS
            ,CSA_SHPG_PLN_V SP
        WHERE
            1 = 1
        AND RSI.GLBL_CMPY_CD = #csaGlblCmpyCd#
        AND RSI.IMPT_PROC_CD = #imptProcCd#
        -- JOIN TO CSA_SHIP_SER_V
        AND RSI.SHPG_PLN_NUM = SS.SHPG_PLN_NUM
        AND SS.GLBL_CMPY_CD  = #cusaGlblCmpyCd#
        -- JOIN TO CSA_SHPG_PLN_V
        AND SS.GLBL_CMPY_CD  = SP.GLBL_CMPY_CD
        AND SS.SHPG_PLN_NUM  = SP.SHPG_PLN_NUM
        -- EZCANCELFLAG
        AND RSI.EZCANCELFLAG = '0'
        AND SS.EZCANCELFLAG  = '0'
        AND SP.EZCANCELFLAG  = '0'
    </statement>

    <statement id="findRossShipItem" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            RSI.ROSS_SHIP_ITEM_PK
        FROM
            ROSS_SHIP_ITEM RSI
        WHERE
            1 = 1
        AND RSI.GLBL_CMPY_CD = #csaGlblCmpyCd#
        AND RSI.IMPT_PROC_CD = #imptProcCd#
        AND RSI.EZCANCELFLAG = '0'
    </statement>

    <statement id="findRossShipHdr" parameterClass="Map" resultClass="Map">
        SELECT
             RSH.GLBL_CMPY_CD
            ,RSH.ROSS_SHIP_HDR_PK
            ,RSH.SO_NUM
            ,RSH.SO_CRAT_DT
            ,RSH.CPO_ORD_NUM
            ,RSH.CUST_ISS_PO_NUM
            ,RSH.SVC_DLR_CUST_CD
            ,RSH.ISTL_LOC_NM
            ,RSH.RTL_DIV_CD
            ,RSH.DLR_WH_LOC_CD
            ,RSH.ETA_DT
            ,RSH.CARR_CD
            ,RSH.SHIP_TO_LOC_NM
            ,RSH.SHIP_TO_FIRST_LINE_ADDR
            ,RSH.SHIP_TO_CTY_ADDR
            ,RSH.SHIP_TO_ST_CD
            ,RSH.SHIP_TO_POST_CD
            ,RSH.CRAT_RWS_PROC_CD
            ,RSH.BOL_NUM
            ,RSH.PRO_NUM
        FROM
            ROSS_SHIP_HDR RSH
        WHERE
            1 = 1
        AND RSH.GLBL_CMPY_CD     = #csaGlblCmpyCd#
        AND RSH.CRAT_RWS_PROC_CD = #cratRwsProcCd#
        AND RSH.EZCANCELFLAG     = '0'
    </statement>

    <statement id="findVndShipToXref" parameterClass="Map" resultClass="Map">
        SELECT
             VSTX.INVTY_LOC_CD
            ,VSTX.RTL_WH_CD
        FROM
            VND_SHIP_TO_XREF VSTX
        WHERE
            1 = 1
        AND VSTX.GLBL_CMPY_CD                     = #csaGlblCmpyCd#
        AND VSTX.VND_XREF_TP_CD                   = #vndXrefTpCd#
        AND VSTX.VND_SHIP_TO_CUST_CD              = #vndShipToCustCd#
        AND VSTX.EFF_FROM_DT                  &lt;= #salesDate#
        AND NVL(VSTX.EFF_THRU_DT, '99991231') &gt;= #salesDate#
        AND VSTX.EZCANCELFLAG                     = '0'
    </statement>

    <statement id="findRossShipItemSer" parameterClass="Map" resultClass="Map">
        SELECT
             RSI.GLBL_CMPY_CD AS GLBL_CMPY_CD_RSI
            ,RSI.ROSS_SHIP_ITEM_PK
            ,RSI.SHPG_PLN_NUM AS SHPG_PLN_NUM_RSI
            ,RSI.SO_NUM AS SO_NUM_RSI
            ,RSI.SO_SLP_NUM AS SO_SLP_NUM_RSI
            ,RSI.SO_CRAT_DT
            ,RSI.MDSE_CD AS MDSE_CD_RSI
            ,RSI.MDL_NM
            ,RSI.SHIP_QTY
            ,RSI.BOL_NUM
            ,RSI.PRO_NUM
            ,RSI.SHIP_TO_ADDR_TP_CD
            ,RSI.ACTL_SHIP_DT
            ,RSI.RCPO_POSN_NUM
            ,RSI.PROD_MDL_TP_CD
            ,RSS.GLBL_CMPY_CD AS GLBL_CMPY_CD_RSS
            ,RSS.ROSS_SHIP_SER_PK
            ,RSS.SHPG_PLN_NUM AS SHPG_PLN_NUM_RSS
            ,RSS.SER_NUM
            ,RSS.SO_NUM AS SO_NUM_RSS
            ,RSS.SO_SLP_NUM AS SO_SLP_NUM_RSS
            ,RSS.MDSE_CD AS MDSE_CD_RSS
            ,PV.PRNT_VND_CD
            ,V.DEAL_CCY_CD
            ,M.MDSE_CD
            ,M.PRCH_GRP_CD
            ,M.LINE_BIZ_TP_CD
            ,MSP.BASE_PKG_UOM_CD
            ,V.VND_CD AS V_VND_CD
        FROM
             ROSS_SHIP_ITEM RSI
            ,ROSS_SHIP_SER RSS
            ,VND V
            ,PRNT_VND PV
            ,MDSE M
            ,MDSE_STORE_PKG MSP
        WHERE
            1 = 1
        AND RSI.GLBL_CMPY_CD                       = #csaGlblCmpyCd#
        AND RSI.SO_NUM                             = #soNum#
        <isNotNull property="bolNum">
        AND RSI.BOL_NUM                            = #bolNum#
        </isNotNull>
        <isNull property="bolNum">
        AND RSI.BOL_NUM                            IS NULL
        </isNull>
        <isNotNull property="proNum">
        AND RSI.PRO_NUM                            = #proNum#
        </isNotNull>
        <isNull property="proNum">
        AND RSI.PRO_NUM                            IS NULL
        </isNull>
        -- JOIN TO ROSS_SHIP_SER
        AND RSI.GLBL_CMPY_CD                       = RSS.GLBL_CMPY_CD(+)
        AND RSI.SO_NUM                             = RSS.SO_NUM(+)
        AND RSI.SO_SLP_NUM                         = RSS.SO_SLP_NUM(+)
        AND RSI.BOL_NUM                            = RSS.BOL_NUM(+)
        AND RSI.PRO_NUM                            = RSS.PRO_NUM(+)
        -- JOIN TO VND
        AND RSI.GLBL_CMPY_CD                       = V.GLBL_CMPY_CD(+)
        AND V.VND_CD(+)                            = #rossVndCd#
        AND V.EFF_FROM_DT(+)                   &lt;= #salesDate#
        AND NVL(V.EFF_THRU_DT(+), '99991231')  &gt;= #salesDate#
        AND V.RGTN_STS_CD(+)                       = #rgtnStsCd#
        -- JOIN TO PRNT_VND
        AND V.GLBL_CMPY_CD                         = PV.GLBL_CMPY_CD(+)
        AND V.PRNT_VND_PK                          = PV.PRNT_VND_PK(+)
        -- JOIN TO MDSE
        AND RSI.GLBL_CMPY_CD                       = M.GLBL_CMPY_CD(+)
        AND RSI.MDSE_CD                            = M.MDSE_CD(+)
        AND M.RGTN_STS_CD(+)                       = #rgtnStsCd#
        -- JOIN TO MDSE_STORE_PKG
        AND M.GLBL_CMPY_CD                         = MSP.GLBL_CMPY_CD(+)
        AND M.MDSE_CD                              = MSP.MDSE_CD(+)
        AND MSP.PRIM_PKG_UOM_FLG(+)                = #primPkgUomFlg#
        -- EZCANCELFLAG
        AND RSI.EZCANCELFLAG                       = '0'
        AND RSS.EZCANCELFLAG(+)                    = '0'
        AND PV.EZCANCELFLAG(+)                     = '0'
        AND M.EZCANCELFLAG(+)                      = '0'
        AND MSP.EZCANCELFLAG(+)                    = '0'
    </statement>
</sqlMap>
