<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWXC001001MakeCombinedInvoice">
    
    <typeAlias alias="DS_CMBN_INV_SUB_TOTTMsg" type="business.db.DS_CMBN_INV_SUB_TOTTMsg"/>
    <typeAlias alias="DS_CMBN_INV_SUB_TOT_DTLTMsg" type="business.db.DS_CMBN_INV_SUB_TOT_DTLTMsg"/>
    
    <statement id="queryInvLine" parameterClass="Map" resultClass="Map">
        SELECT
            IB.INV_NUM
            ,MIN(IB.INV_BOL_LINE_NUM) AS INV_BOL_LINE_NUM
            ,IB.SHIP_TO_CUST_CD
            ,IB.SHIP_TO_FIRST_LINE_ADDR
            ,IB.SHIP_TO_SCD_LINE_ADDR
            ,IB.SHIP_TO_THIRD_LINE_ADDR
            ,IB.SHIP_TO_CTY_ADDR
            ,IB.CUST_ISS_PO_NUM
            ,IB.CPO_ORD_NUM
            ,IL.CPO_DTL_LINE_NUM
            ,IL.CPO_DTL_LINE_SUB_NUM
            ,IL.MDSE_CD
            ,IL.MDSE_NM
            ,SUM(IL.SHIP_QTY) AS SHIP_QTY
            ,SUM(IL.INV_LINE_DEAL_NET_AMT) AS INV_LINE_DEAL_NET_AMT
            ,SUM(IL.INV_LINE_DEAL_TAX_AMT) AS INV_LINE_DEAL_TAX_AMT
            ,I.EASY_PACK_RATE
            ,SUM(IL.ESPAC_LINE_SHIP_QTY) AS ESPAC_LINE_SHIP_QTY
        FROM
            INV_BOL IB
            ,INV_LINE IL
            ,INV I
        WHERE
            IB.GLBL_CMPY_CD         = #glblCmpyCd#
        AND IB.INV_NUM              = #invNum#
        AND IB.EZCANCELFLAG         = '0'
        AND IB.INV_NUM              = IL.INV_NUM(+)
        AND IB.INV_BOL_LINE_NUM     = IL.INV_BOL_LINE_NUM(+)
        AND IL.GLBL_CMPY_CD(+)      = #glblCmpyCd#
        AND IL.EZCANCELFLAG(+)      = '0'
        AND IL.INV_NUM              = I.INV_NUM(+)
        AND I.GLBL_CMPY_CD(+)       = #glblCmpyCd#
        AND I.EZCANCELFLAG(+)       = '0'
        AND IL.SET_MDSE_CD          IS NULL
        GROUP BY
            IB.INV_NUM
            ,IB.SHIP_TO_CUST_CD
            ,IB.SHIP_TO_FIRST_LINE_ADDR
            ,IB.SHIP_TO_SCD_LINE_ADDR
            ,IB.SHIP_TO_THIRD_LINE_ADDR
            ,IB.SHIP_TO_CTY_ADDR
            ,IB.CUST_ISS_PO_NUM
            ,IB.CPO_ORD_NUM
            ,IB.CPO_ORD_NUM
            ,IL.CPO_DTL_LINE_NUM
            ,IL.CPO_DTL_LINE_SUB_NUM
            ,IL.MDSE_CD
            ,IL.MDSE_NM
            ,I.EASY_PACK_RATE
        ORDER BY
             IB.CPO_ORD_NUM
            ,IL.CPO_DTL_LINE_NUM
            ,IL.CPO_DTL_LINE_SUB_NUM

    </statement>
    <statement id="queryInvBol" parameterClass="Map" resultClass="Map">
        SELECT
            IB.INV_NUM
            ,MIN(IB.INV_BOL_LINE_NUM) AS INV_BOL_LINE_NUM
            ,IB.SHIP_TO_CUST_CD
            ,IB.SHIP_TO_FIRST_LINE_ADDR
            ,IB.SHIP_TO_SCD_LINE_ADDR
            ,IB.SHIP_TO_THIRD_LINE_ADDR
            ,IB.SHIP_TO_CTY_ADDR
            ,IB.CUST_ISS_PO_NUM
            ,IB.CPO_ORD_NUM
            ,SUM(IB.SHIP_DEAL_FRT_AMT) AS SHIP_DEAL_FRT_AMT
            ,SUM(IB.FRT_DEAL_TAX_AMT) AS FRT_DEAL_TAX_AMT
        FROM
            INV_BOL IB
       WHERE
            IB.GLBL_CMPY_CD         = #glblCmpyCd#
        AND IB.INV_NUM              = #invNum#
        AND IB.EZCANCELFLAG         = '0'
        GROUP BY
            IB.INV_NUM
            ,IB.SHIP_TO_CUST_CD
            ,IB.SHIP_TO_FIRST_LINE_ADDR
            ,IB.SHIP_TO_SCD_LINE_ADDR
            ,IB.SHIP_TO_THIRD_LINE_ADDR
            ,IB.SHIP_TO_CTY_ADDR
            ,IB.CUST_ISS_PO_NUM
            ,IB.CPO_ORD_NUM
        ORDER BY
            IB.CPO_ORD_NUM

    </statement>

    <statement id="queryCmbInvSubTot" parameterClass="Map" resultMap="result.DS_CMBN_INV_SUB_TOTTMsg">
        SELECT
            DCIST.GLBL_CMPY_CD
           ,DCIST.DS_CMBN_INV_SUB_TOT_PK
           ,DCIST.INV_NUM
           ,DCIST.DS_CMBN_SUB_TOT_TP_CD
           ,DCIST.DS_CMBN_INV_SUB_TOT_NET_AMT
           ,DCIST.DS_CMBN_INV_SUB_TOT_SLS_AMT
           ,DCIST.DS_CMBN_INV_SUB_TOT_TAX_AMT
        FROM
            DS_CMBN_INV_SUB_TOT DCIST
        WHERE
                DCIST.GLBL_CMPY_CD      = #glblCmpyCd#
            AND DCIST.INV_NUM           = #invNum#
            AND DCIST.EZCANCELFLAG      = '0'
        ORDER BY
            DCIST.INV_NUM
           ,DCIST.DS_CMBN_SUB_TOT_TP_CD
    </statement>

    <statement id="queryCmbInvSubTotDtl" parameterClass="Map" resultMap="result.DS_CMBN_INV_SUB_TOT_DTLTMsg">
        SELECT
            DCISTD.GLBL_CMPY_CD
           ,DCISTD.DS_CMBN_INV_SUB_TOT_DTL_PK
           ,DCISTD.INV_NUM
           ,DCISTD.DS_CMBN_INV_SUB_TOT_PK
           ,DCISTD.DS_CMBN_INV_SUB_LINE_NUM
           ,DCISTD.MDSE_CD
           ,DCISTD.CMBN_INV_SUB_DTL_DESC_TXT
           ,DCISTD.SHIP_QTY
           ,DCISTD.UNIT_PRC_AMT
           ,DCISTD.NET_AMT
           ,DCISTD.SLS_AMT
           ,DCISTD.TAX_AMT
        FROM
            DS_CMBN_INV_SUB_TOT_DTL DCISTD
        WHERE
                DCISTD.GLBL_CMPY_CD      = #glblCmpyCd#
            AND DCISTD.INV_NUM           = #invNum#
            AND DCISTD.DS_CMBN_INV_SUB_TOT_PK = #dsCmbnInvSubTotPk#
            AND DCISTD.EZCANCELFLAG      = '0'
        ORDER BY
            DCISTD.MDSE_CD
    </statement>


    <resultMap id="result.DS_CMBN_INV_SUB_TOTTMsg" class="DS_CMBN_INV_SUB_TOTTMsg">
        <result property="dsCmbnInvSubTotPk"       column="DS_CMBN_INV_SUB_TOT_PK"       javaType="EZDTBigDecimalItem"/>
        <result property="invNum"                  column="INV_NUM"                      javaType="EZDTStringItem"/>
        <result property="dsCmbnSubTotTpCd"        column="DS_CMBN_SUB_TOT_TP_CD"        javaType="EZDTStringItem"/>
        <result property="dsCmbnInvSubTotNetAmt"   column="DS_CMBN_INV_SUB_TOT_NET_AMT"  javaType="EZDTBigDecimalItem"/>
        <result property="dsCmbnInvSubTotSlsAmt"   column="DS_CMBN_INV_SUB_TOT_SLS_AMT"  javaType="EZDTBigDecimalItem"/>
        <result property="dsCmbnInvSubTotTaxAmt"   column="DS_CMBN_INV_SUB_TOT_TAX_AMT"  javaType="EZDTBigDecimalItem"/>
    </resultMap>

    <resultMap id="result.DS_CMBN_INV_SUB_TOT_DTLTMsg" class="DS_CMBN_INV_SUB_TOT_DTLTMsg">
        <result property="dsCmbnInvSubTotDtlPk"   column="DS_CMBN_INV_SUB_TOT_DTL_PK"   javaType="EZDTBigDecimalItem"/>
        <result property="invNum"                 column="INV_NUM"                      javaType="EZDTStringItem"/>
        <result property="dsCmbnInvSubTotPk"      column="DS_CMBN_INV_SUB_TOT_PK"       javaType="EZDTBigDecimalItem"/>
        <result property="dsCmbnInvSubLineNum"    column="DS_CMBN_INV_SUB_LINE_NUM"     javaType="EZDTStringItem"/>
        <result property="mdseCd"                 column="MDSE_CD"                      javaType="EZDTStringItem"/>
        <result property="cmbnInvSubDtlDescTxt"   column="CMBN_INV_SUB_DTL_DESC_TXT"    javaType="EZDTStringItem"/>
        <result property="shipQty"                column="SHIP_QTY"                     javaType="EZDTBigDecimalItem"/>
        <result property="unitPrcAmt"             column="UNIT_PRC_AMT"                 javaType="EZDTBigDecimalItem"/>
        <result property="netAmt"                 column="NET_AMT"                      javaType="EZDTBigDecimalItem"/>
        <result property="slsAmt"                 column="SLS_AMT"                      javaType="EZDTBigDecimalItem"/>
        <result property="taxAmt"                 column="TAX_AMT"                      javaType="EZDTBigDecimalItem"/>
    </resultMap>

</sqlMap>
