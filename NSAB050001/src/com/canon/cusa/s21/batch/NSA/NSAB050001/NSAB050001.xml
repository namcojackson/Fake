<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAB050001">
    <statement id="getRossIntfcContrPkForPurge" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            RIC.ROSS_INTFC_CONTR_PK
        FROM
            ROSS_INTFC_CONTR RIC
        WHERE
                RIC.GLBL_CMPY_CD              =   #glblCmpyCd#
            AND RIC.CONTR_END_DT          &lt;=   #contrEndDt#
    </statement>
    <statement id="getRossIntfcContrUsgPkForPurge" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            RICU.ROSS_INTFC_CONTR_USG_PK
        FROM
            ROSS_INTFC_CONTR_USG RICU
        WHERE
                RICU.GLBL_CMPY_CD             =   #glblCmpyCd#
            AND RICU.ROSS_INTFC_CONTR_PK      =   #rossIntfcContrPk#
    </statement>
    <statement id="getCsaContrDtl" parameterClass="Map" resultClass="Map">
        SELECT
            CCDV.PRNT_SER_NUM
            ,CCDV.BLLG_MSTR_PK
            ,CCDV.SER_NUM
            ,CCDV.MDSE_CD
            ,CCDV.PRNT_BLLG_MSTR_PK
            ,CCDV.PRNT_MDSE_CD
            ,CCDV.MSTR_BIZ_TP_CD
            ,CCDV.MACH_MSTR_STS_CD
            ,CCDV.BILL_TO_CUST_CD
            ,CCDV.SELL_TO_CUST_CD
            ,CCDV.INSTL_CD
            ,CCDV.ISTL_SUB_LOC_CD
            ,CCDV.SPLY_INCL_FLG
            ,CCDV.BLLG_BIZ_TP_CD
            ,CCDV.CONTR_START_DT
            ,CCDV.CONTR_END_DT
            ,CCDV.TRMN_DT
            ,CCDV.RTRN_DT
            ,CCDV.MRCF_TP_CD
            ,CCDV.BLLG_CYCLE_CD
            ,CCDV.LAST_BLLG_DT
            ,CCDV.BLLG_DAY
            ,CCDV.BLLG_TMG_TP_CD
            ,CCDV.PMT_TERM_AOT
            ,CCDV.RTL_DIV_CD
            ,CCDV.SVC_DLR_CD
            ,CCDV.FNDG_DLR_CD
            ,CCDV.ORIG_DLR_CD
            ,CCDV.ADMIN_DLR_CD
            ,CCDV.MACH_MDL_TP_CD
            ,CCDV.BLLG_MSTR_CRAT_DT
            ,CCDV.BLLG_MSTR_MOD_DT
            ,CCDV.SVC_BLLG_MSTR_CRAT_DT
            ,CCDV.SVC_BLLG_MSTR_MOD_DT
            ,CCDV.SELL_TO_CUST_CRAT_DT
            ,CCDV.SELL_TO_CUST_MOD_DT
            ,CCDV.RTL_MDL_CRAT_DT
            ,CCDV.RTL_MDL_MOD_DT
            ,CCDV.BLLG_COND_CRAT_DT
            ,CCDV.BLLG_COND_MOD_DT
            ,CCDV.PMT_TERM_CASH_DISC_CRAT_DT
            ,CCDV.PMT_TERM_CASH_DISC_MOD_DT
            ,CCDV.RTL_CUST_PO_PK
            ,CCDV.RTL_CUST_PO_CRAT_DT
            ,CCDV.RTL_CUST_PO_MOD_DT
            <!-- START 2018/01/19 U.Kim [QC#22173,ADD] -->
            ,CCDV.MLY_BASE_COMP_AMT
            ,CCDV.ISTL_COMP_AMT
            ,CCDV.SVC_DLR_COMP_AMT
            ,CCDV.EXT_WTY_COMP_AMT
            ,CCDV.FNDG_DLR_COMP_AMT
            ,CCDV.ORIG_DLR_COMP_AMT
            ,CCDV.MLY_ADMIN_COMP_AMT
            ,CCDV.RNW_COMP_AMT
            <!-- END 2018/01/19 U.Kim [QC#22173,ADD] -->
        FROM
            (
                SELECT 'CBS_CONTR_V',
                      '0',
                      CAST (NULL AS VARCHAR2 (17)) EZINTIME,
                      CAST (NULL AS VARCHAR2 (5)) EZINTIMEZONE,
                      CAST (NULL AS VARCHAR2 (4)) EZINCOMPANYCODE,
                      CAST (NULL AS VARCHAR2 (16)) EZINUSERID,
                      CAST (NULL AS VARCHAR2 (64)) EZINAPLID,
                      CAST (NULL AS VARCHAR2 (17)) EZUPTIME,
                      CAST (NULL AS VARCHAR2 (5)) EZUPTIMEZONE,
                      CAST (NULL AS VARCHAR2 (4)) EZUPCOMPANYCODE,
                      CAST (NULL AS VARCHAR2 (16)) EZUPUSERID,
                      CAST (NULL AS NVARCHAR2 (64)) EZUPAPLID,
                      'ABR' GLBL_CMPY_CD,
                      BM_C.BLLG_MSTR_PK BLLG_MSTR_PK,
                      BM_C.SER_NUM SER_NUM,
                      BM_C.MDSE_CD MDSE_CD,
                      BM_P.BLLG_MSTR_PK PRNT_BLLG_MSTR_PK,
                      BM_P.SER_NUM PRNT_SER_NUM,
                      BM_P.MDSE_CD PRNT_MDSE_CD,
                      SUBSTR (BM_C.CMA_CONTR_VAR_CD, 3, 1) MSTR_BIZ_TP_CD,
                      CASE
                         WHEN BMM_C.MACH_MSTR_STS_CD = 'INSTL'
                         THEN
                            CASE
                               WHEN BM_C.BLLG_MSTR_OM_LINK_FLG = 'N' THEN '65'
                               ELSE '70'
                            END
                         WHEN BMM_C.MACH_MSTR_STS_CD = 'PRCH'
                         THEN
                            '70'
                         WHEN BMM_C.MACH_MSTR_STS_CD = 'W4R'
                         THEN
                            '70'
                         WHEN BMM_C.MACH_MSTR_STS_CD = 'RTRN'
                         THEN
                            '86'
                         WHEN BMM_C.MACH_MSTR_STS_CD = 'DSPL'
                         THEN
                            '86'
                         ELSE
                            BMM_C.MACH_MSTR_STS_CD
                      END
                         MACH_MSTR_STS_CD,
                      STC.BILL_TO_CUST_CD BILL_TO_CUST_CD,
                      BM_C.SELL_TO_CUST_CD SELL_TO_CUST_CD,
                      BMM_C.INSTL_CD INSTL_CD,
                      BMM_C.ISTL_SUB_LOC_CD ISTL_SUB_LOC_CD,
                      CASE
                         WHEN NVL (DLR_SVC.BILL_TO_CUST_CD, ' ') IN
                                 ('A450', 'A658', 'D114')
                         THEN
                            CASE
                               WHEN BM_C.SBM_BM_BLLG_MSTR_PK IS NOT NULL
                               THEN
                                  NVL (BM_C.SBM_MLY_BASE_COMP_AMT, 0)
                               ELSE
                                  NVL (BM_C.MLY_BASE_COMP_AMT, 0)
                            END
                         ELSE
                            0
                      END
                         MLY_BASE_COMP_AMT,
                      CASE
                         WHEN BM_C.SBM_BM_BLLG_MSTR_PK IS NOT NULL
                         THEN
                            NVL (BM_C.SBM_SPLY_INCL_FLG, 'N')
                         ELSE
                            NVL (BM_C.SPLY_INCL_FLG, 'N')
                      END
                         SPLY_INCL_FLG,
                      CASE
                         WHEN BM_C.SBM_BM_BLLG_MSTR_PK IS NOT NULL
                         THEN
                            BM_C.SBM_BLLG_BIZ_TP_CD
                         ELSE
                            BM_C.BLLG_BIZ_TP_CD
                      END
                         BLLG_BIZ_TP_CD,
                      CASE
                         WHEN BM_C.SBM_BM_BLLG_MSTR_PK IS NOT NULL
                         THEN
                            BM_C.SBM_SVC_START_DT
                         ELSE
                            BM_C.ISTL_DT
                      END
                         CONTR_START_DT,
                      CASE
                         WHEN BM_C.SBM_RTL_CUST_PO_PK IS NULL
                         THEN
                            CASE
                               WHEN BMA_C.ASRY_MACH_ATT_DT IS NULL
                               --                       THEN  BM_C.ISTL_DT
                               THEN
                                  TO_CHAR (
                                     ADD_MONTHS (
                                        TO_DATE (BM_C.ISTL_DT, 'YYYYMMDD'),
                                        TO_NUMBER (NVL (BM_C.BLLG_BIZ_TERM_CD, '0'))),
                                     'YYYYMMDD')
                               ELSE
                                  TO_CHAR (
                                     ADD_MONTHS (
                                        TO_DATE (BMA_C.ASRY_MACH_ATT_DT, 'YYYYMMDD'),
                                        TO_NUMBER (NVL (BM_C.BLLG_BIZ_TERM_CD, '0'))),
                                     'YYYYMMDD')
                            END
                         ELSE
                            PM.RTL_CUST_PO_EFF_THRU_DT
                      END
                         CONTR_END_DT,
                      BM_C.SBM_TRMN_DT TRMN_DT,
                      BMM_C.RTRN_DT RTRN_DT,
                      CASE
                         WHEN BM_C.SBM_BM_BLLG_MSTR_PK IS NOT NULL
                         THEN
                            BM_C.SBM_MRCF_TP_CD
                         ELSE
                            BM_C.MRCF_TP_CD
                      END
                         MRCF_TP_CD,
                      BM_C.CMA_BLLG_CYCLE_CD BLLG_CYCLE_CD,
                      CASE
                         WHEN BM_C.SBM_BM_BLLG_MSTR_PK IS NOT NULL
                         THEN
                            BM_C.SBM_LAST_BLLG_DT
                         ELSE
                            BM_C.LAST_RTL_INV_DT
                      END
                         LAST_BLLG_DT,
                      BM_C.CMA_BLLG_DAY BLLG_DAY,
                      BM_C.CMA_BLLG_TMG_TP_CD BLLG_TMG_TP_CD,
                      PMNT.PMT_TERM_AOT PMT_TERM_AOT,
                      BM_C.RTL_DIV_CD RTL_DIV_CD,
                      BM_C.SVC_DLR_CD SVC_DLR_CD,
                      BM_C.FNDG_DLR_CD FNDG_DLR_CD,
                      BM_C.ORIG_DLR_CD ORIG_DLR_CD,
                      BM_C.ADMIN_DLR_CD ADMIN_DLR_CD,
                      CASE
                         WHEN NVL (DLR_SVC.BILL_TO_CUST_CD, ' ') IN
                                 ('A450', 'A658', 'D114')
                         THEN
                            NVL (BM_C.ISTL_COMP_AMT, 0)
                         ELSE
                            0
                      END
                         ISTL_COMP_AMT,
                      CASE
                         WHEN NVL (DLR_SVC.BILL_TO_CUST_CD, ' ') IN
                                 ('A450', 'A658', 'D114')
                         THEN
                            NVL (BM_C.SVC_DLR_COMP_AMT, 0)
                         ELSE
                            0
                      END
                         SVC_DLR_COMP_AMT,
                      CASE
                         WHEN NVL (DLR_SVC.BILL_TO_CUST_CD, ' ') IN
                                 ('A450', 'A658', 'D114')
                         THEN
                            NVL (BM_C.EXT_WTY_COMP_AMT, 0)
                         ELSE
                            0
                      END
                         EXT_WTY_COMP_AMT,
                      CASE
                         WHEN NVL (DLR_FND.BILL_TO_CUST_CD, ' ') IN
                                 ('A450', 'A658', 'D114')
                         THEN
                            NVL (BM_C.FNDG_DLR_COMP_AMT, 0)
                         ELSE
                            0
                      END
                         FNDG_DLR_COMP_AMT,
                      CASE
                         WHEN NVL (DLR_ORG.BILL_TO_CUST_CD, ' ') IN
                                 ('A450', 'A658', 'D114')
                         THEN
                            NVL (BM_C.ORIG_DLR_COMP_AMT, 0)
                         ELSE
                            0
                      END
                         ORIG_DLR_COMP_AMT,
                      CASE
                         WHEN NVL (DLR_ADM.BILL_TO_CUST_CD, ' ') IN
                                 ('A450', 'A658', 'D114')
                         THEN
                            CASE
                               WHEN BM_C.SBM_BM_BLLG_MSTR_PK IS NOT NULL
                               THEN
                                  NVL (BM_C.SBM_MLY_ADMIN_COMP_AMT, 0)
                               ELSE
                                  NVL (BM_C.MLY_ADMIN_COMP_AMT, 0)
                            END
                         ELSE
                            0
                      END
                         MLY_ADMIN_COMP_AMT,
                      CASE
                         WHEN NVL (DLR_SVC.BILL_TO_CUST_CD, ' ') IN
                                 ('A450', 'A658', 'D114')
                         THEN
                            NVL (BM_C.RNW_COMP_AMT, 0)
                         ELSE
                            0
                      END
                         RNW_COMP_AMT,
                      RM.MACH_MDL_TP_CD MACH_MDL_TP_CD,
                      SUBSTR (BM_C.EZINTIME, 1, 8) BLLG_MSTR_CRAT_DT,
                      SUBSTR (BM_C.EZUPTIME, 1, 8) BLLG_MSTR_MOD_DT,
                      SUBSTR (BM_C.SBM_EZINTIME, 1, 8) SVC_BLLG_MSTR_CRAT_DT,
                      SUBSTR (BM_C.SBM_EZUPTIME, 1, 8) SVC_BLLG_MSTR_MOD_DT,
                      SUBSTR (STCR.EZINTIME, 1, 8) SELL_TO_CUST_CRAT_DT,
                      SUBSTR (STCR.EZUPTIME, 1, 8) SELL_TO_CUST_MOD_DT,
                      SUBSTR (RM.EZINTIME, 1, 8) RTL_MDL_CRAT_DT,
                      SUBSTR (RM.EZUPTIME, 1, 8) RTL_MDL_MOD_DT,
                      SUBSTR (BM_C.CMA_EZINTIME, 1, 8) BLLG_COND_CRAT_DT,
                      SUBSTR (BM_C.CMA_EZUPTIME, 1, 8) BLLG_COND_MOD_DT,
                      SUBSTR (INVT.EZINTIME, 1, 8) PMT_TERM_CASH_DISC_CRAT_DT,
                      SUBSTR (INVT.EZUPTIME, 1, 8) PMT_TERM_CASH_DISC_MOD_DT,
                      PM.RTL_CUST_PO_PK RTL_CUST_PO_PK,
                      SUBSTR (PM.EZINTIME, 1, 8) RTL_CUST_PO_CRAT_DT,
                      SUBSTR (PM.EZUPTIME, 1, 8) RTL_CUST_PO_MOD_DT,
                      BM_C.EZINTIME BLLG_MSTR_CRAT_TS,
                      BM_C.EZUPTIME BLLG_MSTR_MOD_TS,
                      BM_C.SBM_EZINTIME SVC_BLLG_MSTR_CRAT_TS,
                      BM_C.SBM_EZUPTIME SVC_BLLG_MSTR_MOD_TS
                 FROM (SELECT AA.*,
                              SBM.BM_BLLG_MSTR_PK SBM_BM_BLLG_MSTR_PK,
                              SBM.MLY_BASE_COMP_AMT SBM_MLY_BASE_COMP_AMT,
                              SBM.BLLG_BIZ_TP_CD SBM_BLLG_BIZ_TP_CD,
                              SBM.BLLG_BIZ_TERM_CD SBM_BLLG_BIZ_TERM_CD,
                              SBM.SVC_START_DT SBM_SVC_START_DT,
                              SBM.RTL_CUST_PO_PK SBM_RTL_CUST_PO_PK,
                              SBM.TRMN_DT SBM_TRMN_DT,
                              SBM.MRCF_TP_CD SBM_MRCF_TP_CD,
                              SBM.LAST_BLLG_DT SBM_LAST_BLLG_DT,
                              SBM.MLY_ADMIN_COMP_AMT SBM_MLY_ADMIN_COMP_AMT,
                              SBM.EZINTIME SBM_EZINTIME,
                              SBM.EZUPTIME SBM_EZUPTIME,
                              SBM.BLLG_ACCT_CD SBM_BLLG_ACCT_CD,
                              SBM.CONTR_VAR_CD SBM_CONTR_VAR_CD,
                              SBM.CONTR_NUM SBM_CONTR_NUM,
                              SBM.SPLY_INCL_FLG SBM_SPLY_INCL_FLG,
                              CMA.BLLG_ACCT_CD CMA_BLLG_ACCT_CD,
                              CMA.CONTR_VAR_CD CMA_CONTR_VAR_CD,
                              CMA.BLLG_CYCLE_CD CMA_BLLG_CYCLE_CD,
                              CMA.BLLG_DAY CMA_BLLG_DAY,
                              CMA.BLLG_TMG_TP_CD CMA_BLLG_TMG_TP_CD,
                              CMA.EZINTIME CMA_EZINTIME,
                              CMA.EZUPTIME CMA_EZUPTIME,
                              CMA.PROD_CTRL_CD CMA_PROD_CTRL_CD,
                              CMA.PMT_TERM_CASH_DISC_CD CMA_PMT_TERM_CASH_DISC_CD
                         FROM CSA_BLLG_MSTR_V AA,
                              CSA_BLLG_COND_V CMA,
                              (SELECT A.*,
                                      B.BLLG_MSTR_PK BM_BLLG_MSTR_PK,
                                      B.SVC_BLLG_ATT_DT
                                 FROM CSA_BLLG_MSTR_V A, CSA_BLLG_SVC_BLLG_RELN_V B
                                WHERE     A.BLLG_MSTR_PK = B.SVC_BLLG_MSTR_PK
                                      AND A.GLBL_CMPY_CD = B.GLBL_CMPY_CD
                                      AND A.EZCANCELFLAG = '0'
                                      AND B.EZCANCELFLAG = '0'
                                      AND A.LTST_BLLG_MSTR_FLG = 'Y') SBM
                        WHERE     SBM.BM_BLLG_MSTR_PK(+) = AA.BLLG_MSTR_PK
                              AND SBM.GLBL_CMPY_CD(+) = AA.GLBL_CMPY_CD
                              AND CMA.BLLG_ACCT_CD =
                                     DECODE (SBM.BLLG_MSTR_PK,
                                             NULL, AA.BLLG_ACCT_CD,
                                             SBM.BLLG_ACCT_CD)
                              AND CMA.CONTR_VAR_CD =
                                     DECODE (SBM.BLLG_MSTR_PK,
                                             NULL, AA.CONTR_VAR_CD,
                                             SBM.CONTR_VAR_CD)
                              AND CMA.GLBL_CMPY_CD = AA.GLBL_CMPY_CD
                              AND CMA.EZCANCELFLAG = '0') BM_C,
                      CSA_BLLG_MSTR_V BM_P,
                      CSA_SELL_TO_CUST_V STC,
                      CSA_RTL_MDL_V RM,
                      CSA_PMT_TERM_CASH_DISC_V INVT,
                      CSA_PMT_TERM_V PMNT,
                      CSA_MACH_MSTR_V BMM_C,
                      CSA_MACH_ASRY_BLLG_V BMA_C,
                      CSA_RTL_CUST_PO_V PM,
                      CSA_RTL_SELL_TO_CUST_V STCR,
                      CSA_BIZ_TP_V BT,
                      (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                              S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SELL_TO_CUST_V S
                        WHERE     S.USR_DLR_TP_CD = 'D'
                              AND S.EZCANCELFLAG = '0'
                              AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                     ('A450', 'A658', 'D114')
                       UNION
                       SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                              SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                        WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                              AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                              AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                              AND SE.USR_DLR_TP_CD = 'D'
                              AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                     ('A450', 'A658', 'D114')
                              AND SH.EZCANCELFLAG = '0'
                              AND SE.EZCANCELFLAG = '0') DLR_SVC,
                      (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                              S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SELL_TO_CUST_V S
                        WHERE     S.USR_DLR_TP_CD = 'D'
                              AND S.EZCANCELFLAG = '0'
                              AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                     ('A450', 'A658', 'D114')
                       UNION
                       SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                              SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                        WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                              AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                              AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                              AND SE.USR_DLR_TP_CD = 'D'
                              AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                     ('A450', 'A658', 'D114')
                              AND SH.EZCANCELFLAG = '0'
                              AND SE.EZCANCELFLAG = '0') DLR_FND,
                      (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                              S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SELL_TO_CUST_V S
                        WHERE     S.USR_DLR_TP_CD = 'D'
                              AND S.EZCANCELFLAG = '0'
                              AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                     ('A450', 'A658', 'D114')
                       UNION
                       SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                              SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                        WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                              AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                              AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                              AND SE.USR_DLR_TP_CD = 'D'
                              AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                     ('A450', 'A658', 'D114')
                              AND SH.EZCANCELFLAG = '0'
                              AND SE.EZCANCELFLAG = '0') DLR_ORG,
                      (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                              S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SELL_TO_CUST_V S
                        WHERE     S.USR_DLR_TP_CD = 'D'
                              AND S.EZCANCELFLAG = '0'
                              AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                     ('A450', 'A658', 'D114')
                       UNION
                       SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                              SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                        WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                              AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                              AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                              AND SE.USR_DLR_TP_CD = 'D'
                              AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                     ('A450', 'A658', 'D114')
                              AND SH.EZCANCELFLAG = '0'
                              AND SE.EZCANCELFLAG = '0') DLR_ADM,
                      (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                              S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SELL_TO_CUST_V S
                        WHERE     S.USR_DLR_TP_CD = 'D'
                              AND S.EZCANCELFLAG = '0'
                              AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                     ('A450', 'A658', 'D114')
                       UNION
                       SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                              SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                        WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                              AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                              AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                              AND SE.USR_DLR_TP_CD = 'D'
                              AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                     ('A450', 'A658', 'D114')
                              AND SH.EZCANCELFLAG = '0'
                              AND SE.EZCANCELFLAG = '0') DLR_ORD
                WHERE                             ----------------------------------------
                          -- BIZ_TP
                          ----------------------------------------
                          BT.MSTR_BIZ_TP_CD &lt;&gt; 'S'
                      AND BT.BIZ_TP_CD = BM_C.BLLG_BIZ_TP_CD
                      AND BT.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- BM_C  : BLLG_MSTR TO SHOW CONTRACT WHICH HAS SERVIE
                      -- BMM_C : MACH_MSTR
                      ----------------------------------------
                      AND BM_C.LTST_BLLG_MSTR_FLG = 'Y'
                      AND (   NVL (BM_C.SELL_TO_CUST_CD, ' ') NOT LIKE 'CFS%'
                           OR (    NVL (BM_C.SELL_TO_CUST_CD, ' ') = 'CFS3'
                               AND BM_C.CMA_BLLG_ACCT_CD IN ('TRSIRS', 'IRS023')))
                      AND NVL (BM_C.SELL_TO_CUST_CD, ' ') &lt;&gt; 'C86N'
                      AND BMM_C.MACH_MSTR_STS_CD IN ('INSTL',
                                                     'PRCH',
                                                     'W4R',
                                                     'RTRN',
                                                     'DSPL')                 ----!= 'RTRN'
                      AND BM_C.MACH_MSTR_PK = BMM_C.MACH_MSTR_PK
                      AND BMM_C.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND BM_C.EZCANCELFLAG = '0'
                      AND BMM_C.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- MACH_ASRY_BLLG_MSTR_RELN
                      ----------------------------------------
                      AND BMA_C.ASRY_BLLG_MSTR_PK(+) = BM_C.BLLG_MSTR_PK
                      AND BMA_C.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND BMA_C.EZCANCELFLAG(+) = '0'
                      ----------------------------------------
                      -- BM_P : BLLG_MSTR FOR RELATED ACCESSORIES
                      ----------------------------------------
                      AND BM_P.BLLG_MSTR_PK =
                             NVL (BMA_C.MACH_BLLG_MSTR_PK, BM_C.BLLG_MSTR_PK)
                      AND BM_P.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND BM_P.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- PMT_TERM_CASH_DISC, PMT_TERM
                      ----------------------------------------
                      AND INVT.PMT_TERM_CASH_DISC_CD = BM_C.CMA_PMT_TERM_CASH_DISC_CD
                      AND INVT.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND INVT.EZCANCELFLAG = '0'
                      AND PMNT.PMT_TERM_CD = INVT.PMT_TERM_CD
                      AND PMNT.GLBL_CMPY_CD = INVT.GLBL_CMPY_CD
                      AND PMNT.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- RTL_CUST_PO
                      ----------------------------------------
                      AND PM.RTL_CUST_PO_PK =
                             NVL (BM_C.SBM_RTL_CUST_PO_PK, BM_C.RTL_CUST_PO_PK)
                      AND PM.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND PM.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- MASTERS
                      ----------------------------------------
                      AND STCR.SELL_TO_CUST_CD = BM_C.SELL_TO_CUST_CD
                      AND STCR.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND STCR.EZCANCELFLAG = '0'
                      AND STC.USR_DLR_TP_CD &lt;&gt; 'D'
                      AND STC.SELL_TO_CUST_CD = STCR.SELL_TO_CUST_CD
                      AND STC.GLBL_CMPY_CD = STCR.GLBL_CMPY_CD
                      AND STC.EZCANCELFLAG = '0'
                      AND RM.MDL_ID = BM_C.MDL_ID
                      AND RM.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND RM.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- DEALERS
                      ----------------------------------------
                      AND DLR_SVC.RTL_DLR_CD(+) = BM_C.SVC_DLR_CD
                      AND DLR_SVC.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND DLR_FND.RTL_DLR_CD(+) = BM_C.FNDG_DLR_CD
                      AND DLR_FND.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND DLR_ORG.RTL_DLR_CD(+) = BM_C.ORIG_DLR_CD
                      AND DLR_ORG.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND DLR_ADM.RTL_DLR_CD(+) = BM_C.ADMIN_DLR_CD
                      AND DLR_ADM.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND DLR_ORD.RTL_DLR_CD(+) = BM_C.ORD_TAKE_DLR_CD
                      AND DLR_ORD.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND (   NVL (DLR_SVC.BILL_TO_CUST_CD, ' ') IN
                                 ('A450', 'A658', 'D114')
                           OR NVL (DLR_FND.BILL_TO_CUST_CD, ' ') IN
                                 ('A450', 'A658', 'D114')
                           OR NVL (DLR_ORG.BILL_TO_CUST_CD, ' ') IN
                                 ('A450', 'A658', 'D114')
                           OR NVL (DLR_ADM.BILL_TO_CUST_CD, ' ') IN
                                 ('A450', 'A658', 'D114')
                           OR NVL (DLR_ORD.BILL_TO_CUST_CD, ' ') IN
                                 ('A450', 'A658', 'D114'))
               UNION
               SELECT --+ NO_MERGE(BM_C) LEADING(BM_C)
                     'CBS_CONTR_V',
                      '0',
                      CAST (NULL AS VARCHAR2 (17)) EZINTIME,
                      CAST (NULL AS VARCHAR2 (5)) EZINTIMEZONE,
                      CAST (NULL AS VARCHAR2 (4)) EZINCOMPANYCODE,
                      CAST (NULL AS VARCHAR2 (16)) EZINUSERID,
                      CAST (NULL AS VARCHAR2 (64)) EZINAPLID,
                      CAST (NULL AS VARCHAR2 (17)) EZUPTIME,
                      CAST (NULL AS VARCHAR2 (5)) EZUPTIMEZONE,
                      CAST (NULL AS VARCHAR2 (4)) EZUPCOMPANYCODE,
                      CAST (NULL AS VARCHAR2 (16)) EZUPUSERID,
                      CAST (NULL AS NVARCHAR2 (64)) EZUPAPLID,
                      'ABR' GLBL_CMPY_CD,
                      BM_C.BLLG_MSTR_PK BLLG_MSTR_PK,
                      BM_C.SER_NUM SER_NUM,
                      BM_C.MDSE_CD MDSE_CD,
                      BM_P.BLLG_MSTR_PK PRNT_BLLG_MSTR_PK,
                      BM_P.SER_NUM PRNT_SER_NUM,
                      BM_P.MDSE_CD PRNT_MDSE_CD,
                      SUBSTR (BM_C.CMA_CONTR_VAR_CD, 3, 1) MSTR_BIZ_TP_CD,
                      CASE
                         WHEN BMM_C.MACH_MSTR_STS_CD = 'INSTL'
                         THEN
                            CASE
                               WHEN BM_C.BLLG_MSTR_OM_LINK_FLG = 'N' THEN '65'
                               ELSE '70'
                            END
                         WHEN BMM_C.MACH_MSTR_STS_CD = 'PRCH'
                         THEN
                            '70'
                         WHEN BMM_C.MACH_MSTR_STS_CD = 'W4R'
                         THEN
                            '70'
                         WHEN BMM_C.MACH_MSTR_STS_CD = 'RTRN'
                         THEN
                            '86'
                         WHEN BMM_C.MACH_MSTR_STS_CD = 'DSPL'
                         THEN
                            '86'
                         ELSE
                            BMM_C.MACH_MSTR_STS_CD
                      END
                         MACH_MSTR_STS_CD,
                      STC.BILL_TO_CUST_CD BILL_TO_CUST_CD,
                      BM_C.SELL_TO_CUST_CD SELL_TO_CUST_CD,
                      BMM_C.INSTL_CD INSTL_CD,
                      BMM_C.ISTL_SUB_LOC_CD ISTL_SUB_LOC_CD,
                      0 MLY_BASE_COMP_AMT,
                      NVL (BM_C.SPLY_INCL_FLG, 'N') SPLY_INCL_FLG,
                      BM_C.BLLG_BIZ_TP_CD BLLG_BIZ_TP_CD,
                      BM_C.ISTL_DT CONTR_START_DT,
                      TO_CHAR (
                         ADD_MONTHS (TO_DATE (BM_C.ISTL_DT, 'YYYYMMDD'),
                                     TO_NUMBER (NVL (BM_C.BLLG_BIZ_TERM_CD, '0'))),
                         'YYYYMMDD')
                         CONTR_END_DT,
                      TO_CHAR (NULL) TRMN_DT,
                      BMM_C.RTRN_DT RTRN_DT,
                      TO_CHAR (NULL) MRCF_TP_CD,
                      'M' BLLG_CYCLE_CD,
                      TO_CHAR (NULL) LAST_BLLG_DT,
                      '08' BLLG_DAY,
                      'A' BLLG_TMG_TP_CD,
                      30 PMT_TERM_AOT,
                      BM_C.RTL_DIV_CD RTL_DIV_CD,
                      BM_C.SVC_DLR_CD SVC_DLR_CD,
                      TO_CHAR (NULL) FNDG_DLR_CD,
                      TO_CHAR (NULL) ORIG_DLR_CD,
                      TO_CHAR (NULL) ADMIN_DLR_CD,
                      0 ISTL_COMP_AMT,
                      0 SVC_DLR_COMP_AMT,
                      0 EXT_WTY_COMP_AMT,
                      0 FNDG_DLR_COMP_AMT,
                      0 ORIG_DLR_COMP_AMT,
                      0 MLY_ADMIN_COMP_AMT,
                      0 RNW_COMP_AMT,
                      RM.MACH_MDL_TP_CD MACH_MDL_TP_CD,
                      SUBSTR (BM_C.EZINTIME, 1, 8) BLLG_MSTR_CRAT_DT,
                      SUBSTR (BM_C.EZUPTIME, 1, 8) BLLG_MSTR_MOD_DT,
                      TO_CHAR (NULL) SVC_BLLG_MSTR_CRAT_DT,
                      TO_CHAR (NULL) SVC_BLLG_MSTR_MOD_DT,
                      SUBSTR (STCR.EZINTIME, 1, 8) SELL_TO_CUST_CRAT_DT,
                      SUBSTR (STCR.EZUPTIME, 1, 8) SELL_TO_CUST_MOD_DT,
                      SUBSTR (RM.EZINTIME, 1, 8) RTL_MDL_CRAT_DT,
                      SUBSTR (RM.EZUPTIME, 1, 8) RTL_MDL_MOD_DT,
                      SUBSTR (BM_C.CMA_EZINTIME, 1, 8) BLLG_COND_CRAT_DT,
                      SUBSTR (BM_C.CMA_EZUPTIME, 1, 8) BLLG_COND_MOD_DT,
                      SUBSTR (BM_C.EZINTIME, 1, 8) PMT_TERM_CASH_DISC_CRAT_DT,
                      SUBSTR (BM_C.EZUPTIME, 1, 8) PMT_TERM_CASH_DISC_MOD_DT,
                      PM.RTL_CUST_PO_PK RTL_CUST_PO_PK,
                      SUBSTR (PM.EZINTIME, 1, 8) RTL_CUST_PO_CRAT_DT,
                      SUBSTR (PM.EZUPTIME, 1, 8) RTL_CUST_PO_MOD_DT,
                      BM_C.EZINTIME BLLG_MSTR_CRAT_TS,
                      BM_C.EZUPTIME BLLG_MSTR_MOD_TS,
                      TO_CHAR (NULL) SVC_BLLG_MSTR_CRAT_TS,
                      TO_CHAR (NULL) SVC_BLLG_MSTR_MOD_TS
                 FROM (SELECT AA.*,
                              CMA.BLLG_ACCT_CD CMA_BLLG_ACCT_CD,
                              CMA.CONTR_VAR_CD CMA_CONTR_VAR_CD,
                              CMA.BLLG_CYCLE_CD CMA_BLLG_CYCLE_CD,
                              CMA.BLLG_DAY CMA_BLLG_DAY,
                              CMA.BLLG_TMG_TP_CD CMA_BLLG_TMG_TP_CD,
                              CMA.EZINTIME CMA_EZINTIME,
                              CMA.EZUPTIME CMA_EZUPTIME,
                              CMA.PROD_CTRL_CD CMA_PROD_CTRL_CD,
                              CMA.PMT_TERM_CASH_DISC_CD CMA_PMT_TERM_CASH_DISC_CD
                         FROM CSA_BLLG_MSTR_V AA,
                              CSA_BLLG_COND_V CMA,
                              (SELECT A.*,
                                      B.BLLG_MSTR_PK BM_BLLG_MSTR_PK,
                                      B.SVC_BLLG_ATT_DT
                                 FROM CSA_BLLG_MSTR_V A, CSA_BLLG_SVC_BLLG_RELN_V B
                                WHERE     A.BLLG_MSTR_PK = B.SVC_BLLG_MSTR_PK
                                      AND A.GLBL_CMPY_CD = B.GLBL_CMPY_CD
                                      AND A.EZCANCELFLAG = '0'
                                      AND B.EZCANCELFLAG = '0'
                                      AND A.LTST_BLLG_MSTR_FLG = 'Y') SBM
                        WHERE     SBM.BM_BLLG_MSTR_PK(+) = AA.BLLG_MSTR_PK
                              AND SBM.GLBL_CMPY_CD(+) = AA.GLBL_CMPY_CD
                              AND SBM.BM_BLLG_MSTR_PK IS NULL
                              AND CMA.BLLG_ACCT_CD = AA.BLLG_ACCT_CD
                              AND CMA.CONTR_VAR_CD = AA.CONTR_VAR_CD
                              AND CMA.GLBL_CMPY_CD = AA.GLBL_CMPY_CD
                              AND CMA.BLLG_ACCT_CD IN ('B6U',
                                                       'IRS023',
                                                       <!-- START 2018/01/22 U.Kim [QC#23330, MOD] -->
                                                       <!-- 'B6UAAA', -->
                                                       <!-- 'B7H') -->
                                                       'B6UAAA')
                                                       <!-- END 2018/01/22 U.Kim [QC#23330, MOD] -->
                              AND CMA.EZCANCELFLAG = '0') BM_C,
                      <!-- START 2017/01/09 U.Kim [QC#23330,MOD] -->
                      <!-- MACH_MSTR BMM_C, -->
                      <!-- MACH_ASRY_BLLG_MSTR_RELN BMA_C, -->
                      <!-- BLLG_MSTR BM_P, -->
                      <!-- RTL_CUST_PO PM, -->
                      <!-- RTL_MDL RM, -->
                      <!-- SELL_TO_CUST STC, -->
                      <!-- RTL_SELL_TO_CUST STCR, -->
                      <!-- BIZ_TP BT, -->
                      CSA_MACH_MSTR_V          BMM_C,
                      CSA_MACH_ASRY_BLLG_V     BMA_C,
                      CSA_BLLG_MSTR_V          BM_P,
                      CSA_RTL_CUST_PO_V        PM,
                      CSA_RTL_MDL_V            RM,
                      CSA_SELL_TO_CUST_V       STC,
                      CSA_RTL_SELL_TO_CUST_V   STCR,
                      CSA_BIZ_TP_V             BT,
                      <!-- END 2017/01/09 U.Kim [QC#23330,MOD]-->
                      (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                              S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SELL_TO_CUST_V S
                        WHERE S.USR_DLR_TP_CD = 'D'   --   AND S.BILL_TO_CUST_CD != 'D114'
                                                   AND S.EZCANCELFLAG = '0'
                       UNION
                       SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                              SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                        WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                              AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                              AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                              --   AND SH.BILL_TO_CUST_CD != 'D114'
                              AND SE.USR_DLR_TP_CD = 'D'
                              AND SH.EZCANCELFLAG = '0'
                              AND SE.EZCANCELFLAG = '0') DLR_SVC,
                      (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                              S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SELL_TO_CUST_V S
                        WHERE S.USR_DLR_TP_CD = 'D' AND S.EZCANCELFLAG = '0'
                       -- AND NVL (S.BILL_TO_CUST_CD, ' ') != 'D114'
                       UNION
                       SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                              SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                        WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                              AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                              AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                              AND SE.USR_DLR_TP_CD = 'D'
                              -- AND NVL (SH.BILL_TO_CUST_CD, ' ') != 'D114'
                              AND SH.EZCANCELFLAG = '0'
                              AND SE.EZCANCELFLAG = '0') DLR_FND,
                      (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                              S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SELL_TO_CUST_V S
                        WHERE S.USR_DLR_TP_CD = 'D' AND S.EZCANCELFLAG = '0'
                       -- AND NVL (S.BILL_TO_CUST_CD, ' ') != 'D114'
                       UNION
                       SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                              SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                        WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                              AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                              AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                              AND SE.USR_DLR_TP_CD = 'D'
                              -- AND NVL (SH.BILL_TO_CUST_CD, ' ') != 'D114'
                              AND SH.EZCANCELFLAG = '0'
                              AND SE.EZCANCELFLAG = '0') DLR_ORG,
                      (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                              S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SELL_TO_CUST_V S
                        WHERE     S.USR_DLR_TP_CD = 'D'
                              AND S.EZCANCELFLAG = '0'
                              AND NVL (S.BILL_TO_CUST_CD, ' ') != 'D114'
                       UNION
                       SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                              SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                        WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                              AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                              AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                              AND SE.USR_DLR_TP_CD = 'D'
                              --AND NVL (SH.BILL_TO_CUST_CD, ' ') != 'D114'
                              AND SH.EZCANCELFLAG = '0'
                              AND SE.EZCANCELFLAG = '0') DLR_ADM,
                      (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                              S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SELL_TO_CUST_V S
                        WHERE S.USR_DLR_TP_CD = 'D' AND S.EZCANCELFLAG = '0'
                       -- AND NVL (S.BILL_TO_CUST_CD, ' ') != 'D114'
                       UNION
                       SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                              SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                        WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                              AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                              AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                              AND SE.USR_DLR_TP_CD = 'D'
                              -- AND NVL (SH.BILL_TO_CUST_CD, ' ') != 'D114'
                              AND SH.EZCANCELFLAG = '0'
                              AND SE.EZCANCELFLAG = '0') DLR_ORD
                WHERE                             ----------------------------------------
                          -- BIZ_TP
                          ----------------------------------------
                          BT.MSTR_BIZ_TP_CD &lt;&gt; 'S'
                      AND BT.BIZ_TP_CD = BM_C.BLLG_BIZ_TP_CD
                      AND BT.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- BM_C  : BLLG_MSTR TO SHOW CONTRACT WHICH DOES NOT HAVE SERVIE
                      -- BMM_C : MACH_MSTR
                      ----------------------------------------
                      AND BM_C.LTST_BLLG_MSTR_FLG = 'Y'
                      AND BM_C.GLBL_CMPY_CD = 'ABR'
                      AND BM_C.EZCANCELFLAG = '0'
                      AND BMM_C.MACH_MSTR_STS_CD IN ('INSTL', 'PRCH', 'W4R') ----!= 'RTRN'
                      AND BMM_C.MACH_MSTR_PK = BM_C.MACH_MSTR_PK
                      AND BMM_C.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND BMM_C.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- MACH_ASRY_BLLG_MSTR_RELN
                      ----------------------------------------
                      AND BMA_C.ASRY_BLLG_MSTR_PK(+) = BM_C.BLLG_MSTR_PK
                      AND BMA_C.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND BMA_C.EZCANCELFLAG(+) = '0'
                      ----------------------------------------
                      -- BM_P : BLLG_MSTR FOR RELATED ACCESSORIES
                      ----------------------------------------
                      AND BM_P.BLLG_MSTR_PK =
                             NVL (BMA_C.MACH_BLLG_MSTR_PK, BM_C.BLLG_MSTR_PK)
                      AND BM_P.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND BM_P.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- RTL_CUST_PO
                      ----------------------------------------
                      AND PM.RTL_CUST_PO_PK = BM_C.RTL_CUST_PO_PK
                      AND PM.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND PM.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- MASTERS
                      ----------------------------------------
                      AND STCR.SELL_TO_CUST_CD = BM_C.SELL_TO_CUST_CD
                      AND STCR.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND STCR.EZCANCELFLAG = '0'
                      AND RM.MDL_ID = BM_C.MDL_ID
                      AND RM.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND RM.EZCANCELFLAG = '0'
                      AND STCR.SELL_TO_CUST_CD = STC.SELL_TO_CUST_CD
                      AND STCR.GLBL_CMPY_CD = STC.GLBL_CMPY_CD
                      AND STC.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- DEALERS
                      ----------------------------------------
                      AND DLR_SVC.RTL_DLR_CD(+) = BM_C.SVC_DLR_CD
                      AND DLR_SVC.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND DLR_FND.RTL_DLR_CD(+) = BM_C.FNDG_DLR_CD
                      AND DLR_FND.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND DLR_ORG.RTL_DLR_CD(+) = BM_C.ORIG_DLR_CD
                      AND DLR_ORG.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND DLR_ADM.RTL_DLR_CD(+) = BM_C.ADMIN_DLR_CD
                      AND DLR_ADM.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND DLR_ORD.RTL_DLR_CD(+) = BM_C.ORD_TAKE_DLR_CD
                      AND DLR_ORD.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND (    NVL (DLR_SVC.BILL_TO_CUST_CD, ' ') != 'D114'
                           AND NVL (DLR_FND.BILL_TO_CUST_CD, ' ') != 'D114'
                           AND NVL (DLR_ORG.BILL_TO_CUST_CD, ' ') != 'D114'
                           AND NVL (DLR_ADM.BILL_TO_CUST_CD, ' ') != 'D114'
                           AND NVL (DLR_ORD.BILL_TO_CUST_CD, ' ') != 'D114')
               UNION
               SELECT --+ NO_MERGE(BM_C) LEADING(BM_C)
                     'CBS_CONTR_V',
                      '0',
                      CAST (NULL AS VARCHAR2 (17)) EZINTIME,
                      CAST (NULL AS VARCHAR2 (5)) EZINTIMEZONE,
                      CAST (NULL AS VARCHAR2 (4)) EZINCOMPANYCODE,
                      CAST (NULL AS VARCHAR2 (16)) EZINUSERID,
                      CAST (NULL AS VARCHAR2 (64)) EZINAPLID,
                      CAST (NULL AS VARCHAR2 (17)) EZUPTIME,
                      CAST (NULL AS VARCHAR2 (5)) EZUPTIMEZONE,
                      CAST (NULL AS VARCHAR2 (4)) EZUPCOMPANYCODE,
                      CAST (NULL AS VARCHAR2 (16)) EZUPUSERID,
                      CAST (NULL AS NVARCHAR2 (64)) EZUPAPLID,
                      'ABR' GLBL_CMPY_CD,
                      BM_C.BLLG_MSTR_PK BLLG_MSTR_PK,
                      BM_C.SER_NUM SER_NUM,
                      BM_C.MDSE_CD MDSE_CD,
                      BM_P.BLLG_MSTR_PK PRNT_BLLG_MSTR_PK,
                      BM_P.SER_NUM PRNT_SER_NUM,
                      BM_P.MDSE_CD PRNT_MDSE_CD,
                      SUBSTR (BM_C.CMA_CONTR_VAR_CD, 3, 1) MSTR_BIZ_TP_CD,
                      CASE
                         WHEN BMM_C.MACH_MSTR_STS_CD = 'INSTL'
                         THEN
                            CASE
                               WHEN BM_C.BLLG_MSTR_OM_LINK_FLG = 'N' THEN '65'
                               ELSE '70'
                            END
                         WHEN BMM_C.MACH_MSTR_STS_CD = 'PRCH'
                         THEN
                            '70'
                         WHEN BMM_C.MACH_MSTR_STS_CD = 'W4R'
                         THEN
                            '70'
                         WHEN BMM_C.MACH_MSTR_STS_CD = 'RTRN'
                         THEN
                            '86'
                         WHEN BMM_C.MACH_MSTR_STS_CD = 'DSPL'
                         THEN
                            '86'
                         ELSE
                            BMM_C.MACH_MSTR_STS_CD
                      END
                         MACH_MSTR_STS_CD,
                      STC.BILL_TO_CUST_CD BILL_TO_CUST_CD,
                      BM_C.SELL_TO_CUST_CD SELL_TO_CUST_CD,
                      BMM_C.INSTL_CD INSTL_CD,
                      BMM_C.ISTL_SUB_LOC_CD ISTL_SUB_LOC_CD,
                      0 MLY_BASE_COMP_AMT,
                      NVL (BM_C.SBM_SPLY_INCL_FLG, 'N') SPLY_INCL_FLG,
                      BM_C.SBM_BLLG_BIZ_TP_CD BLLG_BIZ_TP_CD,
                      BM_C.SBM_SVC_START_DT CONTR_START_DT,
                      DECODE (
                         BM_C.RTL_CUST_PO_PK,
                         NULL, TO_CHAR (
                                  ADD_MONTHS (
                                     TO_DATE (BM_C.ISTL_DT, 'YYYYMMDD'),
                                     -TO_NUMBER (NVL (BM_C.BLLG_BIZ_TERM_CD, '0'))),
                                  'YYYYMMDD'),
                         PM.RTL_CUST_PO_EFF_THRU_DT)
                         CONTR_END_DT,
                      BM_C.SBM_TRMN_DT TRMN_DT,
                      BMM_C.RTRN_DT RTRN_DT,
                      TO_CHAR (NULL) MRCF_TP_CD,
                      'M' BLLG_CYCLE_CD,
                      TO_CHAR (NULL) LAST_BLLG_DT,
                      '08' BLLG_DAY,
                      'A' BLLG_TMG_TP_CD,
                      30 PMT_TERM_AOT,
                      BM_C.RTL_DIV_CD RTL_DIV_CD,
                      BM_C.SVC_DLR_CD SVC_DLR_CD,
                      TO_CHAR (NULL) FNDG_DLR_CD,
                      TO_CHAR (NULL) ORIG_DLR_CD,
                      TO_CHAR (NULL) ADMIN_DLR_CD,
                      0 ISTL_COMP_AMT,
                      0 SVC_DLR_COMP_AMT,
                      0 EXT_WTY_COMP_AMT,
                      0 FNDG_DLR_COMP_AMT,
                      0 ORIG_DLR_COMP_AMT,
                      0 MLY_ADMIN_COMP_AMT,
                      0 RNW_COMP_AMT,
                      RM.MACH_MDL_TP_CD MACH_MDL_TP_CD,
                      SUBSTR (BM_C.EZINTIME, 1, 8) BLLG_MSTR_CRAT_DT,
                      SUBSTR (BM_C.EZUPTIME, 1, 8) BLLG_MSTR_MOD_DT,
                      SUBSTR (BM_C.SBM_EZINTIME, 1, 8) SVC_BLLG_MSTR_CRAT_DT,
                      SUBSTR (BM_C.SBM_EZUPTIME, 1, 8) SVC_BLLG_MSTR_MOD_DT,
                      SUBSTR (STCR.EZINTIME, 1, 8) SELL_TO_CUST_CRAT_DT,
                      SUBSTR (STCR.EZUPTIME, 1, 8) SELL_TO_CUST_MOD_DT,
                      SUBSTR (RM.EZINTIME, 1, 8) RTL_MDL_CRAT_DT,
                      SUBSTR (RM.EZUPTIME, 1, 8) RTL_MDL_MOD_DT,
                      SUBSTR (BM_C.CMA_EZINTIME, 1, 8) BLLG_COND_CRAT_DT,
                      SUBSTR (BM_C.CMA_EZUPTIME, 1, 8) BLLG_COND_MOD_DT,
                      SUBSTR (BM_C.EZINTIME, 1, 8) PMT_TERM_CASH_DISC_CRAT_DT,
                      SUBSTR (BM_C.EZUPTIME, 1, 8) PMT_TERM_CASH_DISC_MOD_DT,
                      PM.RTL_CUST_PO_PK RTL_CUST_PO_PK,
                      SUBSTR (PM.EZINTIME, 1, 8) RTL_CUST_PO_CRAT_DT,
                      SUBSTR (PM.EZUPTIME, 1, 8) RTL_CUST_PO_MOD_DT,
                      BM_C.EZINTIME BLLG_MSTR_CRAT_TS,
                      BM_C.EZUPTIME BLLG_MSTR_MOD_TS,
                      BM_C.SBM_EZINTIME SVC_BLLG_MSTR_CRAT_TS,
                      BM_C.SBM_EZUPTIME SVC_BLLG_MSTR_MOD_TS
                 FROM (SELECT AA.*,
                              SBM.BM_BLLG_MSTR_PK SBM_BM_BLLG_MSTR_PK,
                              SBM.MLY_BASE_COMP_AMT SBM_MLY_BASE_COMP_AMT,
                              SBM.BLLG_BIZ_TP_CD SBM_BLLG_BIZ_TP_CD,
                              SBM.BLLG_BIZ_TERM_CD SBM_BLLG_BIZ_TERM_CD,
                              SBM.SVC_START_DT SBM_SVC_START_DT,
                              SBM.RTL_CUST_PO_PK SBM_RTL_CUST_PO_PK,
                              SBM.TRMN_DT SBM_TRMN_DT,
                              SBM.MRCF_TP_CD SBM_MRCF_TP_CD,
                              SBM.LAST_BLLG_DT SBM_LAST_BLLG_DT,
                              SBM.MLY_ADMIN_COMP_AMT SBM_MLY_ADMIN_COMP_AMT,
                              SBM.EZINTIME SBM_EZINTIME,
                              SBM.EZUPTIME SBM_EZUPTIME,
                              SBM.BLLG_ACCT_CD SBM_BLLG_ACCT_CD,
                              SBM.CONTR_VAR_CD SBM_CONTR_VAR_CD,
                              SBM.CONTR_NUM SBM_CONTR_NUM,
                              SBM.SPLY_INCL_FLG SBM_SPLY_INCL_FLG,
                              CMA.BLLG_ACCT_CD CMA_BLLG_ACCT_CD,
                              CMA.CONTR_VAR_CD CMA_CONTR_VAR_CD,
                              CMA.BLLG_CYCLE_CD CMA_BLLG_CYCLE_CD,
                              CMA.BLLG_DAY CMA_BLLG_DAY,
                              CMA.BLLG_TMG_TP_CD CMA_BLLG_TMG_TP_CD,
                              CMA.EZINTIME CMA_EZINTIME,
                              CMA.EZUPTIME CMA_EZUPTIME,
                              CMA.PROD_CTRL_CD CMA_PROD_CTRL_CD,
                              CMA.PMT_TERM_CASH_DISC_CD CMA_PMT_TERM_CASH_DISC_CD
                         FROM CSA_BLLG_MSTR_V AA,
                              CSA_BLLG_COND_V CMA,
                              (SELECT A.*,
                                      B.BLLG_MSTR_PK BM_BLLG_MSTR_PK,
                                      B.SVC_BLLG_ATT_DT
                                 FROM CSA_BLLG_MSTR_V A, CSA_BLLG_SVC_BLLG_RELN_V B
                                WHERE     A.BLLG_MSTR_PK = B.SVC_BLLG_MSTR_PK
                                      AND A.GLBL_CMPY_CD = B.GLBL_CMPY_CD
                                      AND A.EZCANCELFLAG = '0'
                                      AND B.EZCANCELFLAG = '0'
                                      AND A.LTST_BLLG_MSTR_FLG = 'Y') SBM
                        WHERE     SBM.BM_BLLG_MSTR_PK = AA.BLLG_MSTR_PK
                              AND SBM.GLBL_CMPY_CD = AA.GLBL_CMPY_CD
                              AND CMA.BLLG_ACCT_CD = SBM.BLLG_ACCT_CD
                              AND CMA.CONTR_VAR_CD = SBM.CONTR_VAR_CD
                              AND CMA.GLBL_CMPY_CD = AA.GLBL_CMPY_CD
                              AND CMA.BLLG_ACCT_CD IN ('B6U',
                                                       'IRS023',
                              <!-- START 2018/01/22 U.Kim [QC#23330, MOD] -->
                                                       <!-- 'B6UAAA', -->
                                                       <!--'B7H') -->
                                                       'B6UAAA')
                              <!-- END 2018/01/22 U.Kim [QC#23330, MOD] -->
                              AND CMA.EZCANCELFLAG = '0') BM_C,
                      CSA_MACH_MSTR_V BMM_C,
                      CSA_MACH_ASRY_BLLG_V BMA_C,
                      CSA_BLLG_MSTR_V BM_P,
                      CSA_RTL_CUST_PO_V PM,
                      CSA_RTL_MDL_V RM,
                      CSA_SELL_TO_CUST_V STC,
                      CSA_RTL_SELL_TO_CUST_V STCR,
                      CSA_BIZ_TP_V BT,
                      (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                              S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SELL_TO_CUST_V S
                        WHERE S.USR_DLR_TP_CD = 'D' AND S.EZCANCELFLAG = '0'
                       UNION
                       SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                              SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                        WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                              AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                              AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                              AND SE.USR_DLR_TP_CD = 'D'
                              AND SH.EZCANCELFLAG = '0'
                              AND SE.EZCANCELFLAG = '0') DLR_SVC,
                      (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                              S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SELL_TO_CUST_V S
                        WHERE S.USR_DLR_TP_CD = 'D' AND S.EZCANCELFLAG = '0'
                       UNION
                       SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                              SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                        WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                              AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                              AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                              AND SE.USR_DLR_TP_CD = 'D'
                              AND SH.EZCANCELFLAG = '0'
                              AND SE.EZCANCELFLAG = '0') DLR_FND,
                      (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                              S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SELL_TO_CUST_V S
                        WHERE S.USR_DLR_TP_CD = 'D' AND S.EZCANCELFLAG = '0'
                       UNION
                       SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                              SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                        WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                              AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                              AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                              AND SE.USR_DLR_TP_CD = 'D'
                              AND SH.EZCANCELFLAG = '0'
                              AND SE.EZCANCELFLAG = '0') DLR_ORG,
                      (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                              S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SELL_TO_CUST_V S
                        WHERE     S.USR_DLR_TP_CD = 'D'
                              AND S.EZCANCELFLAG = '0'
                              AND NVL (S.BILL_TO_CUST_CD, ' ') != 'D114'
                       UNION
                       SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                              SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                        WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                              AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                              AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                              AND SE.USR_DLR_TP_CD = 'D'
                              AND SH.EZCANCELFLAG = '0'
                              AND SE.EZCANCELFLAG = '0') DLR_ADM,
                      (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                              S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SELL_TO_CUST_V S
                        WHERE S.USR_DLR_TP_CD = 'D' AND S.EZCANCELFLAG = '0'
                       UNION
                       SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                              SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                              SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                         FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                        WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                              AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                              AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                              AND SE.USR_DLR_TP_CD = 'D'
                              AND SH.EZCANCELFLAG = '0'
                              AND SE.EZCANCELFLAG = '0') DLR_ORD
                WHERE                             ----------------------------------------
                          -- BIZ_TP
                          ----------------------------------------
                          BT.MSTR_BIZ_TP_CD &lt;&gt; 'S'
                      AND BT.BIZ_TP_CD = BM_C.BLLG_BIZ_TP_CD
                      AND BT.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- BM_C  : BLLG_MSTR TO SHOW CONTRACT WHICH HAS SERVIE
                      -- BMM_C : MACH_MSTR
                      ----------------------------------------
                      AND BM_C.LTST_BLLG_MSTR_FLG = 'Y'
                      AND BM_C.GLBL_CMPY_CD = 'ABR'
                      AND BM_C.EZCANCELFLAG = '0'
                      AND BMM_C.MACH_MSTR_STS_CD IN ('INSTL', 'PRCH', 'W4R') ----!= 'RTRN'
                      AND BMM_C.MACH_MSTR_PK = BM_C.MACH_MSTR_PK
                      AND BMM_C.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND BMM_C.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- MACH_ASRY_BLLG_MSTR_RELN
                      ----------------------------------------
                      AND BMA_C.ASRY_BLLG_MSTR_PK(+) = BM_C.BLLG_MSTR_PK
                      AND BMA_C.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND BMA_C.EZCANCELFLAG(+) = '0'
                      ----------------------------------------
                      -- BM_P : BLLG_MSTR FOR RELATED ACCESSORIES
                      ----------------------------------------
                      AND BM_P.BLLG_MSTR_PK =
                             NVL (BMA_C.MACH_BLLG_MSTR_PK, BM_C.BLLG_MSTR_PK)
                      AND BM_P.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND BM_P.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- RTL_CUST_PO
                      ----------------------------------------
                      AND PM.RTL_CUST_PO_PK = BM_C.SBM_RTL_CUST_PO_PK
                      AND PM.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND PM.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- MASTERS
                      ----------------------------------------
                      AND STCR.SELL_TO_CUST_CD = BM_C.SELL_TO_CUST_CD
                      AND STCR.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND STCR.EZCANCELFLAG = '0'
                      AND RM.MDL_ID = BM_C.MDL_ID
                      AND RM.GLBL_CMPY_CD = BM_C.GLBL_CMPY_CD
                      AND RM.EZCANCELFLAG = '0'
                      AND STCR.SELL_TO_CUST_CD = STC.SELL_TO_CUST_CD
                      AND STCR.GLBL_CMPY_CD = STC.GLBL_CMPY_CD
                      AND STC.EZCANCELFLAG = '0'
                      ----------------------------------------
                      -- DEALERS
                      ----------------------------------------
                      AND DLR_SVC.RTL_DLR_CD(+) = BM_C.SVC_DLR_CD
                      AND DLR_SVC.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND DLR_FND.RTL_DLR_CD(+) = BM_C.FNDG_DLR_CD
                      AND DLR_FND.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND DLR_ORG.RTL_DLR_CD(+) = BM_C.ORIG_DLR_CD
                      AND DLR_ORG.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND DLR_ADM.RTL_DLR_CD(+) = BM_C.ADMIN_DLR_CD
                      AND DLR_ADM.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND DLR_ORD.RTL_DLR_CD(+) = BM_C.ORD_TAKE_DLR_CD
                      AND DLR_ORD.GLBL_CMPY_CD(+) = BM_C.GLBL_CMPY_CD
                      AND (    NVL (DLR_SVC.BILL_TO_CUST_CD, ' ') != 'D114'
                           AND NVL (DLR_FND.BILL_TO_CUST_CD, ' ') != 'D114'
                           AND NVL (DLR_ORG.BILL_TO_CUST_CD, ' ') != 'D114'
                           AND NVL (DLR_ADM.BILL_TO_CUST_CD, ' ') != 'D114'
                           AND NVL (DLR_ORD.BILL_TO_CUST_CD, ' ') != 'D114')
            ) CCDV
        WHERE
                CCDV.GLBL_CMPY_CD             =   #glblCmpyCd#
            <iterate property="machMdlTpCd" var="machMdlTpCd[]" open="AND CCDV.MACH_MDL_TP_CD IN (" close=")" conjunction=",">
                        #machMdlTpCd[]#
            </iterate>
            <isNotNull property="lastProcTs">
            AND
            (
                   (CCDV.BLLG_MSTR_CRAT_TS        &gt;   #lastProcTs#  AND  CCDV.BLLG_MSTR_CRAT_TS      &lt;=   #curProcTs#)
                OR (CCDV.BLLG_MSTR_MOD_TS         &gt;   #lastProcTs#  AND  CCDV.BLLG_MSTR_MOD_TS       &lt;=   #curProcTs#)
                OR (CCDV.SVC_BLLG_MSTR_CRAT_TS    &gt;   #lastProcTs#  AND  CCDV.SVC_BLLG_MSTR_CRAT_TS  &lt;=   #curProcTs#)
                OR (CCDV.SVC_BLLG_MSTR_MOD_TS     &gt;   #lastProcTs#  AND  CCDV.SVC_BLLG_MSTR_MOD_TS   &lt;=   #curProcTs#)
            )
            </isNotNull>
            AND
            (
                (
                    <iterate property="bllgBizTpCd" var="bllgBizTpCd[]" open="CCDV.BLLG_BIZ_TP_CD NOT IN (" close=")" conjunction=",">
                        #bllgBizTpCd[]#
                    </iterate>
                    AND CCDV.RTL_DIV_CD                        =   #rtlDivCd#
                )
                OR
                (
                    (
                        (
                                CCDV.MSTR_BIZ_TP_CD            =   #mstrBizTpCd#
                        <isNotNull property="lastProcDate">
                            AND CCDV.CONTR_END_DT          &gt;=   #lastProcDate#
                        </isNotNull>
                        )
                        OR  CCDV.CONTR_END_DT              &gt;=   #slsDt#
                    )
                )
            )
    </statement>
    <statement id="getRossIntfcContr" parameterClass="Map" resultClass="Map">
        SELECT
            RIC.BLLG_MSTR_PK
            ,RIC.ROSS_INTFC_PROC_MODE_CD
            ,RIC.TRMN_DT
            ,RIC.MACH_MSTR_STS_CD
            ,RIC.MLY_BASE_COMP_AMT
            ,RIC.CONTR_START_DT
            ,RIC.BLLG_CYCLE_CD
            ,RIC.BLLG_TMG_TP_CD
            ,RIC.SER_NUM
            ,RIC.SVC_DLR_CD
            ,RIC.FNDG_DLR_CD
            ,RIC.ORIG_DLR_CD
            ,RIC.ADMIN_DLR_CD
            ,RIC.ISTL_COMP_AMT
            ,RIC.SVC_DLR_COMP_AMT
            ,RIC.EXT_WTY_COMP_AMT
            ,RIC.FNDG_DLR_COMP_AMT
            ,RIC.ORIG_DLR_COMP_AMT
            ,RIC.MLY_ADMIN_COMP_AMT
            ,RIC.RNW_COMP_AMT
            ,RIC.RTL_DIV_CD
            ,RIC.SPLY_INCL_FLG
            ,RIC.MRCF_TP_CD
            ,RIC.LAST_BLLG_DT
        FROM
            ROSS_INTFC_CONTR RIC
        WHERE
                RIC.GLBL_CMPY_CD              =   #glblCmpyCd#
            AND RIC.BLLG_MSTR_PK              =   #bllgMstrPk#
            AND RIC.EZCANCELFLAG              =   '0'
        ORDER BY
            RIC.ROSS_INTFC_CONTR_CRAT_DT DESC
            ,RIC.ROSS_INTFC_CONTR_PK DESC
    </statement>
    <statement id="countUpdatedRossContractUsageForTerminateAndCreate" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(RICU.ROSS_INTFC_CONTR_USG_PK)
        FROM
            ROSS_INTFC_CONTR_USG RICU
        WHERE
                RICU.GLBL_CMPY_CD             =   #glblCmpyCd#
            AND RICU.BLLG_MSTR_PK             =   #bllgMstrPk#
            AND NOT EXISTS (
                            SELECT
                                1
                            FROM
                                (
                                SELECT 'CBS_USG_V',
                                      '0',
                                      CAST (NULL AS VARCHAR2 (17)) EZINTIME,
                                      CAST (NULL AS VARCHAR2 (5)) EZINTIMEZONE,
                                      CAST (NULL AS VARCHAR2 (4)) EZINCOMPANYCODE,
                                      CAST (NULL AS VARCHAR2 (16)) EZINUSERID,
                                      CAST (NULL AS VARCHAR2 (64)) EZINAPLID,
                                      CAST (NULL AS VARCHAR2 (17)) EZUPTIME,
                                      CAST (NULL AS VARCHAR2 (5)) EZUPTIMEZONE,
                                      CAST (NULL AS VARCHAR2 (4)) EZUPCOMPANYCODE,
                                      CAST (NULL AS VARCHAR2 (16)) EZUPUSERID,
                                      CAST (NULL AS NVARCHAR2 (64)) EZUPAPLID,
                                      'ABR' GLBL_CMPY_CD,
                                      CASE
                                         WHEN BM.ROSS_ORD_TP_CD = 'S'
                                         THEN
                                            (SELECT SBM.BLLG_MSTR_PK
                                               FROM CSA_BLLG_SVC_BLLG_RELN_V SBM
                                              WHERE     SBM.SVC_BLLG_MSTR_PK = BM.BM_ID
                                                    AND SBM.GLBL_CMPY_CD = BM.GLBL_CMPY_CD
                                                    AND SBM.EZCANCELFLAG = '0')
                                         ELSE
                                            BM.BM_ID
                                      END
                                         BLLG_MSTR_PK,
                                      CASE
                                         WHEN NVL (DLR_SVC_BTC_BTC_NBR, ' ') IN ('A450', 'A658', 'D114')
                                         THEN
                                            NVL (BM.COPIES_INCLUDED_COMP, 0)
                                         ELSE
                                            0
                                      END
                                         MLY_COPY_INCL_COMP_QTY,
                                      CASE
                                         WHEN NVL (DLR_SVC_BTC_BTC_NBR, ' ') IN ('A450', 'A658', 'D114')
                                         THEN
                                            NVL (BM.FIRST_METER_COUNT, 0)
                                         ELSE
                                            0
                                      END
                                         MTR_CNT,
                                      BM.MET_ID BLLG_MSTR_BLLG_MTR_PK,
                                      0 XS_MTR_COMP_COPY_QTY,
                                      CASE
                                         WHEN NVL (DLR_SVC_BTC_BTC_NBR, ' ') IN ('A450', 'A658', 'D114')
                                         THEN
                                            NVL (BEMC.XS_MTR_COMP_AMT_RATE, 0)
                                         ELSE
                                            0
                                      END
                                         XS_MTR_COMP_AMT_RATE,
                                      BM.MET_DATE_CREATED BLLG_MSTR_BLLG_MTR_CRAT_DT,
                                      BM.MET_DATE_MODIFIED BLLG_MSTR_BLLG_MTR_MOD_DT,
                                      BM.PMET_DATE_CREATED PMT_TERM_CRAT_DT,
                                      BM.PMET_DATE_MODIFIED PMT_TERM_MOD_DT,
                                      SUBSTR (BEMC.EZINTIME, 1, 8) BLLG_XS_COPY_PRC_CRAT_DT,
                                      SUBSTR (BEMC.EZUPTIME, 1, 8) BLLG_XS_COPY_PRC_MOD_DT
                                FROM (  SELECT BM.GLBL_CMPY_CD GLBL_CMPY_CD,
                                                BM.BLLG_MSTR_PK BM_ID,
                                                BM.SVC_DLR_CD SVC_DLR_CD,
                                                BM.FNDG_DLR_CD FNDG_DLR_CD,
                                                BM.ORIG_DLR_CD ORIG_DLR_CD,
                                                BM.ADMIN_DLR_CD ADMIN_DLR_CD,
                                                DLR_SVC.BILL_TO_CUST_CD DLR_SVC_BTC_BTC_NBR,
                                                MET.BLLG_MSTR_BLLG_MTR_PK MET_ID,
                                                MET.BLLG_MTR_NUM BLLG_MTR_NUM,
                                                MET.MLY_COPY_INCL_COMP_QTY COPIES_INCLUDED_COMP,
                                                SUBSTR (MET.EZINTIME, 1, 8) MET_DATE_CREATED,
                                                SUBSTR (MET.EZUPTIME, 1, 8) MET_DATE_MODIFIED,
                                                MAX (SUBSTR (PMET.EZINTIME, 1, 8)) PMET_DATE_CREATED,
                                                MAX (SUBSTR (PMET.EZUPTIME, 1, 8)) PMET_DATE_MODIFIED,
                                                SUM (PMR.MTR_CNT) FIRST_METER_COUNT,
                                                BT.ROSS_ORD_TP_CD ROSS_ORD_TP_CD
                                           FROM CSA_BLLG_MSTR_V BM,
                                                CSA_BLLG_MSTR_BLLG_MTR_V MET,
                                                CSA_PHYS_MTR_V PMET,
                                                CSA_PHYS_MTR_READ_V PMR,
                                                CSA_BLLG_MSTR_PHYS_MTR_V BMPM,
                                                CSA_SELL_TO_CUST_V SC,
                                                CSA_BIZ_TP_V BT,
                                                (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                                                        S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SELL_TO_CUST_V S
                                                  WHERE     S.USR_DLR_TP_CD = 'D'
                                                        AND S.EZCANCELFLAG = '0'
                                                        AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                 UNION
                                                 SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                                                        SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                                                  WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                                                        AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                                                        AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                                                        AND SE.USR_DLR_TP_CD = 'D'
                                                        AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                        AND SH.EZCANCELFLAG = '0'
                                                        AND SE.EZCANCELFLAG = '0') DLR_SVC,
                                                (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                                                        S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SELL_TO_CUST_V S
                                                  WHERE     S.USR_DLR_TP_CD = 'D'
                                                        AND S.EZCANCELFLAG = '0'
                                                        AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                 UNION
                                                 SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                                                        SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                                                  WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                                                        AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                                                        AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                                                        AND SE.USR_DLR_TP_CD = 'D'
                                                        AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                        AND SH.EZCANCELFLAG = '0'
                                                        AND SE.EZCANCELFLAG = '0') DLR_FND,
                                                (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                                                        S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SELL_TO_CUST_V S
                                                  WHERE     S.USR_DLR_TP_CD = 'D'
                                                        AND S.EZCANCELFLAG = '0'
                                                        AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                 UNION
                                                 SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                                                        SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                                                  WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                                                        AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                                                        AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                                                        AND SE.USR_DLR_TP_CD = 'D'
                                                        AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                        AND SH.EZCANCELFLAG = '0'
                                                        AND SE.EZCANCELFLAG = '0') DLR_ORG,
                                                (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                                                        S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SELL_TO_CUST_V S
                                                  WHERE     S.USR_DLR_TP_CD = 'D'
                                                        AND S.EZCANCELFLAG = '0'
                                                        AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                 UNION
                                                 SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                                                        SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                                                  WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                                                        AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                                                        AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                                                        AND SE.USR_DLR_TP_CD = 'D'
                                                        AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                        AND SH.EZCANCELFLAG = '0'
                                                        AND SE.EZCANCELFLAG = '0') DLR_ADM,
                                                (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                                                        S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SELL_TO_CUST_V S
                                                  WHERE     S.USR_DLR_TP_CD = 'D'
                                                        AND S.EZCANCELFLAG = '0'
                                                        AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                 UNION
                                                 SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                                                        SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                                                  WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                                                        AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                                                        AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                                                        AND SE.USR_DLR_TP_CD = 'D'
                                                        AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                        AND SH.EZCANCELFLAG = '0'
                                                        AND SE.EZCANCELFLAG = '0') DLR_ORD
                                          WHERE     DLR_SVC.RTL_DLR_CD(+) = BM.SVC_DLR_CD
                                                AND DLR_SVC.GLBL_CMPY_CD(+) = BM.GLBL_CMPY_CD
                                                AND DLR_FND.RTL_DLR_CD(+) = BM.FNDG_DLR_CD
                                                AND DLR_FND.GLBL_CMPY_CD(+) = BM.GLBL_CMPY_CD
                                                AND DLR_ORG.RTL_DLR_CD(+) = BM.ORIG_DLR_CD
                                                AND DLR_ORG.GLBL_CMPY_CD(+) = BM.GLBL_CMPY_CD
                                                AND DLR_ADM.RTL_DLR_CD(+) = BM.ADMIN_DLR_CD
                                                AND DLR_ADM.GLBL_CMPY_CD(+) = BM.GLBL_CMPY_CD
                                                AND DLR_ORD.RTL_DLR_CD(+) = BM.ORD_TAKE_DLR_CD
                                                AND DLR_ORD.GLBL_CMPY_CD(+) = BM.GLBL_CMPY_CD
                                                AND (   NVL (DLR_SVC.BILL_TO_CUST_CD, ' ') IN
                                                           ('A450', 'A658', 'D114')
                                                     OR NVL (DLR_FND.BILL_TO_CUST_CD, ' ') IN
                                                           ('A450', 'A658', 'D114')
                                                     OR NVL (DLR_ORG.BILL_TO_CUST_CD, ' ') IN
                                                           ('A450', 'A658', 'D114')
                                                     OR NVL (DLR_ADM.BILL_TO_CUST_CD, ' ') IN
                                                           ('A450', 'A658', 'D114')
                                                     OR NVL (DLR_ORD.BILL_TO_CUST_CD, ' ') IN
                                                           ('A450', 'A658', 'D114'))
                                                AND (   NVL (BM.SELL_TO_CUST_CD, ' ') NOT LIKE 'CFS%'
                                                     OR (    NVL (BM.SELL_TO_CUST_CD, ' ') = 'CFS3'
                                                        -- AND BM.BLLG_ACCT_CD = 'TRSIRS'))
                                                AND BM.BLLG_ACCT_CD IN ('IRS023','TRSIRS')))
                                                AND NVL (BM.SELL_TO_CUST_CD, ' ') &lt;&gt; 'C86N'
                                                AND SC.USR_DLR_TP_CD &lt;&gt; 'D'
                                                --
                                                --*** BLLG_MSTR_BLLG_MTR MET ***--
                                                --
                                                AND MET.BLLG_MSTR_PK = BM.BLLG_MSTR_PK
                                                AND MET.GLBL_CMPY_CD = BM.GLBL_CMPY_CD
                                                AND BMPM.BLLG_MSTR_BLLG_MTR_PK = MET.BLLG_MSTR_BLLG_MTR_PK
                                                AND BMPM.GLBL_CMPY_CD = MET.GLBL_CMPY_CD
                                                AND BMPM.MACH_MSTR_PK = PMET.MACH_MSTR_PK
                                                AND BMPM.PHYS_MTR_NUM = PMET.PHYS_MTR_NUM
                                                AND BMPM.GLBL_CMPY_CD = PMET.GLBL_CMPY_CD
                                                AND PMR.MTR_READ_TP_CD = 'INIT'
                                                AND PMR.BLLG_MSTR_PK = BM.BLLG_MSTR_PK
                                                AND PMR.MACH_MSTR_PK = PMET.MACH_MSTR_PK
                                                AND PMR.PHYS_MTR_NUM = PMET.PHYS_MTR_NUM
                                                AND PMR.GLBL_CMPY_CD = PMET.GLBL_CMPY_CD
                                                AND BT.BIZ_TP_CD = BM.BLLG_BIZ_TP_CD
                                                AND BT.GLBL_CMPY_CD = BM.GLBL_CMPY_CD
                                                AND BT.EZCANCELFLAG = '0'
                                                --
                                                --*** PHYS_MTR PMET ***--
                                                --
                                                AND PMET.EZCANCELFLAG = '0'
                                                AND BMPM.EZCANCELFLAG = '0'
                                                AND MET.EZCANCELFLAG = '0'
                                                AND BM.EZCANCELFLAG = '0'
                                                AND SC.EZCANCELFLAG = '0'
                                                AND BM.SELL_TO_CUST_CD = SC.SELL_TO_CUST_CD
                                                AND BM.GLBL_CMPY_CD = SC.GLBL_CMPY_CD
                                       GROUP BY BM.GLBL_CMPY_CD,
                                                BM.BLLG_MSTR_PK,
                                                BM.SVC_DLR_CD,
                                                BM.FNDG_DLR_CD,
                                                BM.ORIG_DLR_CD,
                                                BM.ADMIN_DLR_CD,
                                                DLR_SVC.BILL_TO_CUST_CD,
                                                MET.BLLG_MSTR_BLLG_MTR_PK,
                                                MET.BLLG_MTR_NUM,
                                                MET.MLY_COPY_INCL_COMP_QTY,
                                                SUBSTR (MET.EZINTIME, 1, 8),
                                                SUBSTR (MET.EZUPTIME, 1, 8),
                                                BT.ROSS_ORD_TP_CD) BM,
                                      CSA_BLLG_XS_COPY_PRC_V BEMC
                                WHERE     BEMC.MTR_PRC_COMP_TP_CD = 'C'
                                      AND BEMC.BLLG_MTR_QTY_TP_CD = 'E'
                                      AND BEMC.GLBL_CMPY_CD = BM.GLBL_CMPY_CD
                                      AND BEMC.BLLG_MSTR_PK = BM.BM_ID
                                      AND BEMC.BLLG_MTR_NUM = BM.BLLG_MTR_NUM
                                      AND BEMC.EZCANCELFLAG = '0'
                                      AND BM.GLBL_CMPY_CD = #glblCmpyCdAbr#
                                      AND BM.BM_ID = RICU.BLLG_MSTR_PK
                                ) CUH
                            WHERE
                                    CUH.BLLG_MSTR_BLLG_MTR_PK      =  RICU.BLLG_MSTR_BLLG_MTR_PK
                                AND CUH.MTR_CNT                    =  RICU.MTR_CNT
                                AND CUH.XS_MTR_COMP_COPY_QTY       =  RICU.XS_MTR_COMP_COPY_QTY
                           )
            AND RICU.EZCANCELFLAG             =   '0'
    </statement>
    <statement id="countUpdatedRossContractUsageForUpdate" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(RICU.ROSS_INTFC_CONTR_USG_PK)
        FROM
            ROSS_INTFC_CONTR_USG RICU
        WHERE
                RICU.GLBL_CMPY_CD             =   #glblCmpyCd#
            AND RICU.BLLG_MSTR_PK             =   #bllgMstrPk#
            AND NOT EXISTS (
                            SELECT
                                1
                            FROM
                                (
                                SELECT 'CBS_USG_V',
                                      '0',
                                      CAST (NULL AS VARCHAR2 (17)) EZINTIME,
                                      CAST (NULL AS VARCHAR2 (5)) EZINTIMEZONE,
                                      CAST (NULL AS VARCHAR2 (4)) EZINCOMPANYCODE,
                                      CAST (NULL AS VARCHAR2 (16)) EZINUSERID,
                                      CAST (NULL AS VARCHAR2 (64)) EZINAPLID,
                                      CAST (NULL AS VARCHAR2 (17)) EZUPTIME,
                                      CAST (NULL AS VARCHAR2 (5)) EZUPTIMEZONE,
                                      CAST (NULL AS VARCHAR2 (4)) EZUPCOMPANYCODE,
                                      CAST (NULL AS VARCHAR2 (16)) EZUPUSERID,
                                      CAST (NULL AS NVARCHAR2 (64)) EZUPAPLID,
                                      'ABR' GLBL_CMPY_CD,
                                      CASE
                                         WHEN BM.ROSS_ORD_TP_CD = 'S'
                                         THEN
                                            (SELECT SBM.BLLG_MSTR_PK
                                               FROM CSA_BLLG_SVC_BLLG_RELN_V SBM
                                              WHERE     SBM.SVC_BLLG_MSTR_PK = BM.BM_ID
                                                    AND SBM.GLBL_CMPY_CD = BM.GLBL_CMPY_CD
                                                    AND SBM.EZCANCELFLAG = '0')
                                         ELSE
                                            BM.BM_ID
                                      END
                                         BLLG_MSTR_PK,
                                      CASE
                                         WHEN NVL (DLR_SVC_BTC_BTC_NBR, ' ') IN ('A450', 'A658', 'D114')
                                         THEN
                                            NVL (BM.COPIES_INCLUDED_COMP, 0)
                                         ELSE
                                            0
                                      END
                                         MLY_COPY_INCL_COMP_QTY,
                                      CASE
                                         WHEN NVL (DLR_SVC_BTC_BTC_NBR, ' ') IN ('A450', 'A658', 'D114')
                                         THEN
                                            NVL (BM.FIRST_METER_COUNT, 0)
                                         ELSE
                                            0
                                      END
                                         MTR_CNT,
                                      BM.MET_ID BLLG_MSTR_BLLG_MTR_PK,
                                      0 XS_MTR_COMP_COPY_QTY,
                                      CASE
                                         WHEN NVL (DLR_SVC_BTC_BTC_NBR, ' ') IN ('A450', 'A658', 'D114')
                                         THEN
                                            NVL (BEMC.XS_MTR_COMP_AMT_RATE, 0)
                                         ELSE
                                            0
                                      END
                                         XS_MTR_COMP_AMT_RATE,
                                      BM.MET_DATE_CREATED BLLG_MSTR_BLLG_MTR_CRAT_DT,
                                      BM.MET_DATE_MODIFIED BLLG_MSTR_BLLG_MTR_MOD_DT,
                                      BM.PMET_DATE_CREATED PMT_TERM_CRAT_DT,
                                      BM.PMET_DATE_MODIFIED PMT_TERM_MOD_DT,
                                      SUBSTR (BEMC.EZINTIME, 1, 8) BLLG_XS_COPY_PRC_CRAT_DT,
                                      SUBSTR (BEMC.EZUPTIME, 1, 8) BLLG_XS_COPY_PRC_MOD_DT
                                FROM (  SELECT BM.GLBL_CMPY_CD GLBL_CMPY_CD,
                                                BM.BLLG_MSTR_PK BM_ID,
                                                BM.SVC_DLR_CD SVC_DLR_CD,
                                                BM.FNDG_DLR_CD FNDG_DLR_CD,
                                                BM.ORIG_DLR_CD ORIG_DLR_CD,
                                                BM.ADMIN_DLR_CD ADMIN_DLR_CD,
                                                DLR_SVC.BILL_TO_CUST_CD DLR_SVC_BTC_BTC_NBR,
                                                MET.BLLG_MSTR_BLLG_MTR_PK MET_ID,
                                                MET.BLLG_MTR_NUM BLLG_MTR_NUM,
                                                MET.MLY_COPY_INCL_COMP_QTY COPIES_INCLUDED_COMP,
                                                SUBSTR (MET.EZINTIME, 1, 8) MET_DATE_CREATED,
                                                SUBSTR (MET.EZUPTIME, 1, 8) MET_DATE_MODIFIED,
                                                MAX (SUBSTR (PMET.EZINTIME, 1, 8)) PMET_DATE_CREATED,
                                                MAX (SUBSTR (PMET.EZUPTIME, 1, 8)) PMET_DATE_MODIFIED,
                                                SUM (PMR.MTR_CNT) FIRST_METER_COUNT,
                                                BT.ROSS_ORD_TP_CD ROSS_ORD_TP_CD
                                           FROM CSA_BLLG_MSTR_V BM,
                                                CSA_BLLG_MSTR_BLLG_MTR_V MET,
                                                CSA_PHYS_MTR_V PMET,
                                                CSA_PHYS_MTR_READ_V PMR,
                                                CSA_BLLG_MSTR_PHYS_MTR_V BMPM,
                                                CSA_SELL_TO_CUST_V SC,
                                                CSA_BIZ_TP_V BT,
                                                (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                                                        S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SELL_TO_CUST_V S
                                                  WHERE     S.USR_DLR_TP_CD = 'D'
                                                        AND S.EZCANCELFLAG = '0'
                                                        AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                 UNION
                                                 SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                                                        SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                                                  WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                                                        AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                                                        AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                                                        AND SE.USR_DLR_TP_CD = 'D'
                                                        AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                        AND SH.EZCANCELFLAG = '0'
                                                        AND SE.EZCANCELFLAG = '0') DLR_SVC,
                                                (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                                                        S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SELL_TO_CUST_V S
                                                  WHERE     S.USR_DLR_TP_CD = 'D'
                                                        AND S.EZCANCELFLAG = '0'
                                                        AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                 UNION
                                                 SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                                                        SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                                                  WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                                                        AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                                                        AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                                                        AND SE.USR_DLR_TP_CD = 'D'
                                                        AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                        AND SH.EZCANCELFLAG = '0'
                                                        AND SE.EZCANCELFLAG = '0') DLR_FND,
                                                (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                                                        S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SELL_TO_CUST_V S
                                                  WHERE     S.USR_DLR_TP_CD = 'D'
                                                        AND S.EZCANCELFLAG = '0'
                                                        AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                 UNION
                                                 SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                                                        SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                                                  WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                                                        AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                                                        AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                                                        AND SE.USR_DLR_TP_CD = 'D'
                                                        AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                        AND SH.EZCANCELFLAG = '0'
                                                        AND SE.EZCANCELFLAG = '0') DLR_ORG,
                                                (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                                                        S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SELL_TO_CUST_V S
                                                  WHERE     S.USR_DLR_TP_CD = 'D'
                                                        AND S.EZCANCELFLAG = '0'
                                                        AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                 UNION
                                                 SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                                                        SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                                                  WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                                                        AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                                                        AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                                                        AND SE.USR_DLR_TP_CD = 'D'
                                                        AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                        AND SH.EZCANCELFLAG = '0'
                                                        AND SE.EZCANCELFLAG = '0') DLR_ADM,
                                                (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                                                        S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SELL_TO_CUST_V S
                                                  WHERE     S.USR_DLR_TP_CD = 'D'
                                                        AND S.EZCANCELFLAG = '0'
                                                        AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                 UNION
                                                 SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                                        SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                                                        SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                                                   FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                                                  WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                                                        AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                                                        AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                                                        AND SE.USR_DLR_TP_CD = 'D'
                                                        AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                                               ('A450', 'A658', 'D114')
                                                        AND SH.EZCANCELFLAG = '0'
                                                        AND SE.EZCANCELFLAG = '0') DLR_ORD
                                          WHERE     DLR_SVC.RTL_DLR_CD(+) = BM.SVC_DLR_CD
                                                AND DLR_SVC.GLBL_CMPY_CD(+) = BM.GLBL_CMPY_CD
                                                AND DLR_FND.RTL_DLR_CD(+) = BM.FNDG_DLR_CD
                                                AND DLR_FND.GLBL_CMPY_CD(+) = BM.GLBL_CMPY_CD
                                                AND DLR_ORG.RTL_DLR_CD(+) = BM.ORIG_DLR_CD
                                                AND DLR_ORG.GLBL_CMPY_CD(+) = BM.GLBL_CMPY_CD
                                                AND DLR_ADM.RTL_DLR_CD(+) = BM.ADMIN_DLR_CD
                                                AND DLR_ADM.GLBL_CMPY_CD(+) = BM.GLBL_CMPY_CD
                                                AND DLR_ORD.RTL_DLR_CD(+) = BM.ORD_TAKE_DLR_CD
                                                AND DLR_ORD.GLBL_CMPY_CD(+) = BM.GLBL_CMPY_CD
                                                AND (   NVL (DLR_SVC.BILL_TO_CUST_CD, ' ') IN
                                                           ('A450', 'A658', 'D114')
                                                     OR NVL (DLR_FND.BILL_TO_CUST_CD, ' ') IN
                                                           ('A450', 'A658', 'D114')
                                                     OR NVL (DLR_ORG.BILL_TO_CUST_CD, ' ') IN
                                                           ('A450', 'A658', 'D114')
                                                     OR NVL (DLR_ADM.BILL_TO_CUST_CD, ' ') IN
                                                           ('A450', 'A658', 'D114')
                                                     OR NVL (DLR_ORD.BILL_TO_CUST_CD, ' ') IN
                                                           ('A450', 'A658', 'D114'))
                                                AND (   NVL (BM.SELL_TO_CUST_CD, ' ') NOT LIKE 'CFS%'
                                                     OR (    NVL (BM.SELL_TO_CUST_CD, ' ') = 'CFS3'
                                                        -- AND BM.BLLG_ACCT_CD = 'TRSIRS'))
                                                AND BM.BLLG_ACCT_CD IN ('IRS023','TRSIRS')))
                                                AND NVL (BM.SELL_TO_CUST_CD, ' ') &lt;&gt; 'C86N'
                                                AND SC.USR_DLR_TP_CD &lt;&gt; 'D'
                                                --
                                                --*** BLLG_MSTR_BLLG_MTR MET ***--
                                                --
                                                AND MET.BLLG_MSTR_PK = BM.BLLG_MSTR_PK
                                                AND MET.GLBL_CMPY_CD = BM.GLBL_CMPY_CD
                                                AND BMPM.BLLG_MSTR_BLLG_MTR_PK = MET.BLLG_MSTR_BLLG_MTR_PK
                                                AND BMPM.GLBL_CMPY_CD = MET.GLBL_CMPY_CD
                                                AND BMPM.MACH_MSTR_PK = PMET.MACH_MSTR_PK
                                                AND BMPM.PHYS_MTR_NUM = PMET.PHYS_MTR_NUM
                                                AND BMPM.GLBL_CMPY_CD = PMET.GLBL_CMPY_CD
                                                AND PMR.MTR_READ_TP_CD = 'INIT'
                                                AND PMR.BLLG_MSTR_PK = BM.BLLG_MSTR_PK
                                                AND PMR.MACH_MSTR_PK = PMET.MACH_MSTR_PK
                                                AND PMR.PHYS_MTR_NUM = PMET.PHYS_MTR_NUM
                                                AND PMR.GLBL_CMPY_CD = PMET.GLBL_CMPY_CD
                                                AND BT.BIZ_TP_CD = BM.BLLG_BIZ_TP_CD
                                                AND BT.GLBL_CMPY_CD = BM.GLBL_CMPY_CD
                                                AND BT.EZCANCELFLAG = '0'
                                                --
                                                --*** PHYS_MTR PMET ***--
                                                --
                                                AND PMET.EZCANCELFLAG = '0'
                                                AND BMPM.EZCANCELFLAG = '0'
                                                AND MET.EZCANCELFLAG = '0'
                                                AND BM.EZCANCELFLAG = '0'
                                                AND SC.EZCANCELFLAG = '0'
                                                AND BM.SELL_TO_CUST_CD = SC.SELL_TO_CUST_CD
                                                AND BM.GLBL_CMPY_CD = SC.GLBL_CMPY_CD
                                       GROUP BY BM.GLBL_CMPY_CD,
                                                BM.BLLG_MSTR_PK,
                                                BM.SVC_DLR_CD,
                                                BM.FNDG_DLR_CD,
                                                BM.ORIG_DLR_CD,
                                                BM.ADMIN_DLR_CD,
                                                DLR_SVC.BILL_TO_CUST_CD,
                                                MET.BLLG_MSTR_BLLG_MTR_PK,
                                                MET.BLLG_MTR_NUM,
                                                MET.MLY_COPY_INCL_COMP_QTY,
                                                SUBSTR (MET.EZINTIME, 1, 8),
                                                SUBSTR (MET.EZUPTIME, 1, 8),
                                                BT.ROSS_ORD_TP_CD) BM,
                                      CSA_BLLG_XS_COPY_PRC_V BEMC
                                WHERE     BEMC.MTR_PRC_COMP_TP_CD = 'C'
                                      AND BEMC.BLLG_MTR_QTY_TP_CD = 'E'
                                      AND BEMC.GLBL_CMPY_CD = BM.GLBL_CMPY_CD
                                      AND BEMC.BLLG_MSTR_PK = BM.BM_ID
                                      AND BEMC.BLLG_MTR_NUM = BM.BLLG_MTR_NUM
                                      AND BEMC.EZCANCELFLAG = '0'
                                      AND BM.GLBL_CMPY_CD = #glblCmpyCdAbr#
                                      AND BM.BM_ID = RICU.BLLG_MSTR_PK
                                ) CUH
                            WHERE
                                    CUH.BLLG_MSTR_BLLG_MTR_PK      =  RICU.BLLG_MSTR_BLLG_MTR_PK
                                AND CUH.MLY_COPY_INCL_COMP_QTY     =  RICU.MLY_COPY_INCL_COMP_QTY
                                AND CUH.XS_MTR_COMP_AMT_RATE       =  RICU.XS_MTR_COMP_AMT_RATE
                           )
            AND RICU.EZCANCELFLAG             =   '0'
    </statement>
    <statement id="countDealer" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(CFSDV.RTL_DLR_CD)
        FROM
            CSA_FEDEX_SVC_DLR_V CFSDV
        WHERE
                CFSDV.GLBL_CMPY_CD            =   #glblCmpyCd#
            AND CFSDV.RTL_DLR_CD              =   #rtlDlrCd#
            AND CFSDV.EZCANCELFLAG            =   '0'
    </statement>
    <statement id="getCsaUsg" parameterClass="Map" resultClass="Map">
        SELECT 'CBS_USG_V',
              '0',
              CAST (NULL AS VARCHAR2 (17)) EZINTIME,
              CAST (NULL AS VARCHAR2 (5)) EZINTIMEZONE,
              CAST (NULL AS VARCHAR2 (4)) EZINCOMPANYCODE,
              CAST (NULL AS VARCHAR2 (16)) EZINUSERID,
              CAST (NULL AS VARCHAR2 (64)) EZINAPLID,
              CAST (NULL AS VARCHAR2 (17)) EZUPTIME,
              CAST (NULL AS VARCHAR2 (5)) EZUPTIMEZONE,
              CAST (NULL AS VARCHAR2 (4)) EZUPCOMPANYCODE,
              CAST (NULL AS VARCHAR2 (16)) EZUPUSERID,
              CAST (NULL AS NVARCHAR2 (64)) EZUPAPLID,
              'ABR' GLBL_CMPY_CD,
              CASE
                 WHEN BM.ROSS_ORD_TP_CD = 'S'
                 THEN
                    (SELECT SBM.BLLG_MSTR_PK
                       FROM CSA_BLLG_SVC_BLLG_RELN_V SBM
                      WHERE     SBM.SVC_BLLG_MSTR_PK = BM.BM_ID
                            AND SBM.GLBL_CMPY_CD = BM.GLBL_CMPY_CD
                            AND SBM.EZCANCELFLAG = '0')
                 ELSE
                    BM.BM_ID
              END
                 BLLG_MSTR_PK,
              CASE
                 WHEN NVL (DLR_SVC_BTC_BTC_NBR, ' ') IN ('A450', 'A658', 'D114')
                 THEN
                    NVL (BM.COPIES_INCLUDED_COMP, 0)
                 ELSE
                    0
              END
                 MLY_COPY_INCL_COMP_QTY,
              CASE
                 WHEN NVL (DLR_SVC_BTC_BTC_NBR, ' ') IN ('A450', 'A658', 'D114')
                 THEN
                    NVL (BM.FIRST_METER_COUNT, 0)
                 ELSE
                    0
              END
                 MTR_CNT,
              BM.MET_ID BLLG_MSTR_BLLG_MTR_PK,
              0 XS_MTR_COMP_COPY_QTY,
              CASE
                 WHEN NVL (DLR_SVC_BTC_BTC_NBR, ' ') IN ('A450', 'A658', 'D114')
                 THEN
                    NVL (BEMC.XS_MTR_COMP_AMT_RATE, 0)
                 ELSE
                    0
              END
                 XS_MTR_COMP_AMT_RATE,
              BM.MET_DATE_CREATED BLLG_MSTR_BLLG_MTR_CRAT_DT,
              BM.MET_DATE_MODIFIED BLLG_MSTR_BLLG_MTR_MOD_DT,
              BM.PMET_DATE_CREATED PMT_TERM_CRAT_DT,
              BM.PMET_DATE_MODIFIED PMT_TERM_MOD_DT,
              SUBSTR (BEMC.EZINTIME, 1, 8) BLLG_XS_COPY_PRC_CRAT_DT,
              SUBSTR (BEMC.EZUPTIME, 1, 8) BLLG_XS_COPY_PRC_MOD_DT
        FROM (  SELECT BM.GLBL_CMPY_CD GLBL_CMPY_CD,
                        BM.BLLG_MSTR_PK BM_ID,
                        BM.SVC_DLR_CD SVC_DLR_CD,
                        BM.FNDG_DLR_CD FNDG_DLR_CD,
                        BM.ORIG_DLR_CD ORIG_DLR_CD,
                        BM.ADMIN_DLR_CD ADMIN_DLR_CD,
                        DLR_SVC.BILL_TO_CUST_CD DLR_SVC_BTC_BTC_NBR,
                        MET.BLLG_MSTR_BLLG_MTR_PK MET_ID,
                        MET.BLLG_MTR_NUM BLLG_MTR_NUM,
                        MET.MLY_COPY_INCL_COMP_QTY COPIES_INCLUDED_COMP,
                        SUBSTR (MET.EZINTIME, 1, 8) MET_DATE_CREATED,
                        SUBSTR (MET.EZUPTIME, 1, 8) MET_DATE_MODIFIED,
                        MAX (SUBSTR (PMET.EZINTIME, 1, 8)) PMET_DATE_CREATED,
                        MAX (SUBSTR (PMET.EZUPTIME, 1, 8)) PMET_DATE_MODIFIED,
                        SUM (PMR.MTR_CNT) FIRST_METER_COUNT,
                        BT.ROSS_ORD_TP_CD ROSS_ORD_TP_CD
                   FROM CSA_BLLG_MSTR_V BM,
                        CSA_BLLG_MSTR_BLLG_MTR_V MET,
                        CSA_PHYS_MTR_V PMET,
                        CSA_PHYS_MTR_READ_V PMR,
                        CSA_BLLG_MSTR_PHYS_MTR_V BMPM,
                        CSA_SELL_TO_CUST_V SC,
                        CSA_BIZ_TP_V BT,
                        (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                                S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                           FROM CSA_SELL_TO_CUST_V S
                          WHERE     S.USR_DLR_TP_CD = 'D'
                                AND S.EZCANCELFLAG = '0'
                                AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                       ('A450', 'A658', 'D114')
                         UNION
                         SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                                SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                           FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                          WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                                AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                                AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                                AND SE.USR_DLR_TP_CD = 'D'
                                AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                       ('A450', 'A658', 'D114')
                                AND SH.EZCANCELFLAG = '0'
                                AND SE.EZCANCELFLAG = '0') DLR_SVC,
                        (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                                S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                           FROM CSA_SELL_TO_CUST_V S
                          WHERE     S.USR_DLR_TP_CD = 'D'
                                AND S.EZCANCELFLAG = '0'
                                AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                       ('A450', 'A658', 'D114')
                         UNION
                         SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                                SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                           FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                          WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                                AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                                AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                                AND SE.USR_DLR_TP_CD = 'D'
                                AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                       ('A450', 'A658', 'D114')
                                AND SH.EZCANCELFLAG = '0'
                                AND SE.EZCANCELFLAG = '0') DLR_FND,
                        (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                                S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                           FROM CSA_SELL_TO_CUST_V S
                          WHERE     S.USR_DLR_TP_CD = 'D'
                                AND S.EZCANCELFLAG = '0'
                                AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                       ('A450', 'A658', 'D114')
                         UNION
                         SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                                SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                           FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                          WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                                AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                                AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                                AND SE.USR_DLR_TP_CD = 'D'
                                AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                       ('A450', 'A658', 'D114')
                                AND SH.EZCANCELFLAG = '0'
                                AND SE.EZCANCELFLAG = '0') DLR_ORG,
                        (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                                S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                           FROM CSA_SELL_TO_CUST_V S
                          WHERE     S.USR_DLR_TP_CD = 'D'
                                AND S.EZCANCELFLAG = '0'
                                AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                       ('A450', 'A658', 'D114')
                         UNION
                         SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                                SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                           FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                          WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                                AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                                AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                                AND SE.USR_DLR_TP_CD = 'D'
                                AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                       ('A450', 'A658', 'D114')
                                AND SH.EZCANCELFLAG = '0'
                                AND SE.EZCANCELFLAG = '0') DLR_ADM,
                        (SELECT S.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                S.SELL_TO_CUST_CD AS RTL_DLR_CD,
                                S.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                           FROM CSA_SELL_TO_CUST_V S
                          WHERE     S.USR_DLR_TP_CD = 'D'
                                AND S.EZCANCELFLAG = '0'
                                AND NVL (S.BILL_TO_CUST_CD, ' ') IN
                                       ('A450', 'A658', 'D114')
                         UNION
                         SELECT SH.GLBL_CMPY_CD AS GLBL_CMPY_CD,
                                SH.SHIP_TO_CUST_CD AS RTL_DLR_CD,
                                SH.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                           FROM CSA_SHIP_TO_CUST_V SH, CSA_SELL_TO_CUST_V SE
                          WHERE     SH.SELL_TO_CUST_CD = SE.SELL_TO_CUST_CD
                                AND SH.GLBL_CMPY_CD = SE.GLBL_CMPY_CD
                                AND SH.SELL_TO_CUST_CD != SH.SHIP_TO_CUST_CD
                                AND SE.USR_DLR_TP_CD = 'D'
                                AND NVL (SH.BILL_TO_CUST_CD, ' ') IN
                                       ('A450', 'A658', 'D114')
                                AND SH.EZCANCELFLAG = '0'
                                AND SE.EZCANCELFLAG = '0') DLR_ORD
                  WHERE     DLR_SVC.RTL_DLR_CD(+) = BM.SVC_DLR_CD
                        AND DLR_SVC.GLBL_CMPY_CD(+) = BM.GLBL_CMPY_CD
                        AND DLR_FND.RTL_DLR_CD(+) = BM.FNDG_DLR_CD
                        AND DLR_FND.GLBL_CMPY_CD(+) = BM.GLBL_CMPY_CD
                        AND DLR_ORG.RTL_DLR_CD(+) = BM.ORIG_DLR_CD
                        AND DLR_ORG.GLBL_CMPY_CD(+) = BM.GLBL_CMPY_CD
                        AND DLR_ADM.RTL_DLR_CD(+) = BM.ADMIN_DLR_CD
                        AND DLR_ADM.GLBL_CMPY_CD(+) = BM.GLBL_CMPY_CD
                        AND DLR_ORD.RTL_DLR_CD(+) = BM.ORD_TAKE_DLR_CD
                        AND DLR_ORD.GLBL_CMPY_CD(+) = BM.GLBL_CMPY_CD
                        AND (   NVL (DLR_SVC.BILL_TO_CUST_CD, ' ') IN
                                   ('A450', 'A658', 'D114')
                             OR NVL (DLR_FND.BILL_TO_CUST_CD, ' ') IN
                                   ('A450', 'A658', 'D114')
                             OR NVL (DLR_ORG.BILL_TO_CUST_CD, ' ') IN
                                   ('A450', 'A658', 'D114')
                             OR NVL (DLR_ADM.BILL_TO_CUST_CD, ' ') IN
                                   ('A450', 'A658', 'D114')
                             OR NVL (DLR_ORD.BILL_TO_CUST_CD, ' ') IN
                                   ('A450', 'A658', 'D114'))
                        AND (   NVL (BM.SELL_TO_CUST_CD, ' ') NOT LIKE 'CFS%'
                             OR (    NVL (BM.SELL_TO_CUST_CD, ' ') = 'CFS3'
                                -- AND BM.BLLG_ACCT_CD = 'TRSIRS'))
                        AND BM.BLLG_ACCT_CD IN ('IRS023','TRSIRS')))
                        AND NVL (BM.SELL_TO_CUST_CD, ' ') &lt;&gt; 'C86N'
                        AND SC.USR_DLR_TP_CD &lt;&gt; 'D'
                        --
                        --*** BLLG_MSTR_BLLG_MTR MET ***--
                        --
                        AND MET.BLLG_MSTR_PK = BM.BLLG_MSTR_PK
                        AND MET.GLBL_CMPY_CD = BM.GLBL_CMPY_CD
                        AND BMPM.BLLG_MSTR_BLLG_MTR_PK = MET.BLLG_MSTR_BLLG_MTR_PK
                        AND BMPM.GLBL_CMPY_CD = MET.GLBL_CMPY_CD
                        AND BMPM.MACH_MSTR_PK = PMET.MACH_MSTR_PK
                        AND BMPM.PHYS_MTR_NUM = PMET.PHYS_MTR_NUM
                        AND BMPM.GLBL_CMPY_CD = PMET.GLBL_CMPY_CD
                        AND PMR.MTR_READ_TP_CD = 'INIT'
                        AND PMR.BLLG_MSTR_PK = BM.BLLG_MSTR_PK
                        AND PMR.MACH_MSTR_PK = PMET.MACH_MSTR_PK
                        AND PMR.PHYS_MTR_NUM = PMET.PHYS_MTR_NUM
                        AND PMR.GLBL_CMPY_CD = PMET.GLBL_CMPY_CD
                        AND BT.BIZ_TP_CD = BM.BLLG_BIZ_TP_CD
                        AND BT.GLBL_CMPY_CD = BM.GLBL_CMPY_CD
                        AND BT.EZCANCELFLAG = '0'
                        --
                        --*** PHYS_MTR PMET ***--
                        --
                        AND PMET.EZCANCELFLAG = '0'
                        AND BMPM.EZCANCELFLAG = '0'
                        AND MET.EZCANCELFLAG = '0'
                        AND BM.EZCANCELFLAG = '0'
                        AND SC.EZCANCELFLAG = '0'
                        AND BM.SELL_TO_CUST_CD = SC.SELL_TO_CUST_CD
                        AND BM.GLBL_CMPY_CD = SC.GLBL_CMPY_CD
               GROUP BY BM.GLBL_CMPY_CD,
                        BM.BLLG_MSTR_PK,
                        BM.SVC_DLR_CD,
                        BM.FNDG_DLR_CD,
                        BM.ORIG_DLR_CD,
                        BM.ADMIN_DLR_CD,
                        DLR_SVC.BILL_TO_CUST_CD,
                        MET.BLLG_MSTR_BLLG_MTR_PK,
                        MET.BLLG_MTR_NUM,
                        MET.MLY_COPY_INCL_COMP_QTY,
                        SUBSTR (MET.EZINTIME, 1, 8),
                        SUBSTR (MET.EZUPTIME, 1, 8),
                        BT.ROSS_ORD_TP_CD) BM,
              CSA_BLLG_XS_COPY_PRC_V BEMC
        WHERE     BEMC.MTR_PRC_COMP_TP_CD = 'C'
              AND BEMC.BLLG_MTR_QTY_TP_CD = 'E'
              AND BEMC.GLBL_CMPY_CD = BM.GLBL_CMPY_CD
              AND BEMC.BLLG_MSTR_PK = BM.BM_ID
              AND BEMC.BLLG_MTR_NUM = BM.BLLG_MTR_NUM
              AND BEMC.EZCANCELFLAG = '0'
              AND BM.GLBL_CMPY_CD = #glblCmpyCd#
              <!-- Start 2017/11/11 QC#18233,MOD -->
              <!-- AND BM.BM_ID = #bllgMstrPk#  -->
              AND ((BM.BM_ID = #bllgMstrPk# and BM.ROSS_ORD_TP_CD &lt;&gt; 'S')
               OR (BM.ROSS_ORD_TP_CD = 'S' AND
                     (SELECT SBM2.BLLG_MSTR_PK
                       FROM CSA_BLLG_SVC_BLLG_RELN_V SBM2
                       WHERE     SBM2.SVC_BLLG_MSTR_PK = BM.BM_ID
                       AND SBM2.GLBL_CMPY_CD = BM.GLBL_CMPY_CD
                       AND SBM2.EZCANCELFLAG = '0') =  #bllgMstrPk#
                   )
              )
              <!-- End 2017/11/11 QC#18233,MOD -->
    </statement>
</sqlMap>