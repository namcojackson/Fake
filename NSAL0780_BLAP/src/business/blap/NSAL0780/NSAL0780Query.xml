<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAL0780Query">
    <typeAlias alias="NSAL0780_ASMsg"  type="business.blap.NSAL0780.NSAL0780_ASMsg"/>
    <statement id="getSearchData" parameterClass="Map" resultMap="result.getSearchData">
            SELECT
                 DS_CONTR_PK
                ,DS_CONTR_NUM
                ,MTR_LB_DESC_TXT
                ,BLLG_FROM_DT
                ,BLLG_THRU_DT
                ,CUR_FLEET_READ_MTR_CNT
                ,TEST_COPY_QTY
                ,MTR_ENTRY_CPLT_FLG
                ,FLEET_CALC_PROC_DESC_TXT
                ,VLD_MSG_TXT
                ,FLEET_READ_ROLL_UP_PK
                ,SVC_CR_REBIL_DTL_PK
            FROM (
                SELECT
                     A.DS_CONTR_PK              AS  DS_CONTR_PK
                    ,A.DS_CONTR_NUM             AS  DS_CONTR_NUM
                    ,F.MTR_LB_DESC_TXT          AS  MTR_LB_DESC_TXT
                    ,A.BLLG_FROM_DT             AS  BLLG_FROM_DT
                    ,A.BLLG_THRU_DT             AS  BLLG_THRU_DT
                    ,A.CUR_FLEET_READ_MTR_CNT   AS  CUR_FLEET_READ_MTR_CNT
                    ,A.TEST_COPY_QTY            AS  TEST_COPY_QTY
                    ,D.MTR_ENTRY_CPLT_FLG       AS  MTR_ENTRY_CPLT_FLG
                    ,E.FLEET_CALC_PROC_DESC_TXT AS  FLEET_CALC_PROC_DESC_TXT
                    ,A.VLD_MSG_TXT              AS  VLD_MSG_TXT
                    ,A.FLEET_READ_ROLL_UP_PK    AS  FLEET_READ_ROLL_UP_PK
                    ,A.SVC_CR_REBIL_DTL_PK      AS  SVC_CR_REBIL_DTL_PK
                FROM
                     FLEET_READ_ROLL_UP         A
                    ,DS_CONTR                   B
                    ,SELL_TO_CUST               C
                    ,DS_CONTR_BLLG_SCHD         D
                    ,FLEET_CALC_PROC            E
                    ,MTR_LB                     F
                WHERE
                        A.GLBL_CMPY_CD              = #glblCmpyCd#
                <isNotNull property="bllgFromDt">
                    AND A.BLLG_THRU_DT              &gt;= #bllgFromDt#
                </isNotNull>
                <isNotNull property="bllgThruDt">
                    AND A.BLLG_FROM_DT              &lt;= #bllgThruDt#
                </isNotNull>
                <isNotNull property="dsContrNum">
                    AND A.DS_CONTR_NUM              = #dsContrNum#
                </isNotNull>
                <isNotNull property="errOnly">
                    AND A.FLEET_CALC_PROC_CD        IN (#fleetCalcProcCd_InComplete#, #fleetCalcProcCd_ReBillInComplete#)
                </isNotNull>
                    AND A.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
                    AND A.DS_CONTR_PK               = B.DS_CONTR_PK
                <isNotNull property="dsAcctNum">
                    AND B.DS_ACCT_NUM               = #dsAcctNum#
                </isNotNull>
                    AND B.EZCANCELFLAG              = '0'
                    AND B.GLBL_CMPY_CD              = C.GLBL_CMPY_CD
                    AND B.DS_ACCT_NUM               = C.SELL_TO_CUST_CD
                <isNotNull property="dsAcctNm">
                    AND C.DS_ACCT_NM                LIKE #dsAcctNm#
                </isNotNull>
                    AND C.EZCANCELFLAG              = '0'
                <isNotNull property="serNum">
                    AND EXISTS
                        (SELECT
                                1
                         FROM
                                FLEET_READ_ROLL_UP_DTL  F
                         WHERE
                                F.GLBL_CMPY_CD      = A.GLBL_CMPY_CD
                            AND F.FLEET_READ_ROLL_UP_PK
                                                    = A.FLEET_READ_ROLL_UP_PK
                            AND F.SER_NUM           = #serNum#
                            AND F.EZCANCELFLAG      = '0'
                        )
                </isNotNull>
                    AND A.GLBL_CMPY_CD              = D.GLBL_CMPY_CD
                    AND A.PRNT_DS_CONTR_BLLG_SCHD_PK
                                                    = D.DS_CONTR_BLLG_SCHD_PK
                <isNotNull property="notComp">
                    AND D.MTR_ENTRY_CPLT_FLG        = 'N'
                </isNotNull>
                    AND D.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = E.GLBL_CMPY_CD(+)
                    AND A.FLEET_CALC_PROC_CD        = E.FLEET_CALC_PROC_CD(+)
                    AND E.EZCANCELFLAG(+)           = '0'
                    AND A.GLBL_CMPY_CD              = F.GLBL_CMPY_CD
                    AND A.BLLG_MTR_LB_CD            = F.MTR_LB_CD
                    AND F.EZCANCELFLAG              = '0'
                ORDER BY
                     A.BLLG_THRU_DT        DESC
                    ,A.BLLG_FROM_DT        DESC
                    ,A.DS_CONTR_NUM        ASC
                    ,A.DS_CONTR_PK         ASC
                    ,A.SVC_CR_REBIL_DTL_PK ASC
                    ,A.BLLG_MTR_LB_CD      ASC
            )
            WHERE
                ROWNUM        &lt;= #rowNum#
    </statement>
    <resultMap id="result.getSearchData"          class="NSAL0780_ASMsg">
        <result property="dsContrPk_A"            column="DS_CONTR_PK"              javaType="EZDSBigDecimalItem" />
        <result property="dsContrNum_A"           column="DS_CONTR_NUM"             javaType="EZDSStringItem" />
        <result property="mtrLbDescTxt_A"         column="MTR_LB_DESC_TXT"          javaType="EZDSStringItem" />
        <result property="bllgFromDt_A"           column="BLLG_FROM_DT"             javaType="EZDSDateItem" />
        <result property="bllgThruDt_A"           column="BLLG_THRU_DT"             javaType="EZDSDateItem" />
        <result property="curFleetReadMtrCnt_A"   column="CUR_FLEET_READ_MTR_CNT"   javaType="EZDSBigDecimalItem" />
        <result property="testCopyQty_A"          column="TEST_COPY_QTY"            javaType="EZDSBigDecimalItem" />
        <result property="mtrEntryCpltFlg_A"      column="MTR_ENTRY_CPLT_FLG"       javaType="EZDSStringItem" />
        <result property="fleetCalcProcDescTxt_A" column="FLEET_CALC_PROC_DESC_TXT" javaType="EZDSStringItem" />
        <result property="vldMsgTxt_A"            column="VLD_MSG_TXT"              javaType="EZDSStringItem" />
        <result property="fleetReadRollUpPk_A"    column="FLEET_READ_ROLL_UP_PK"    javaType="EZDSBigDecimalItem" />
        <result property="svcCrRebilDtlPk_A"      column="SVC_CR_REBIL_DTL_PK"      javaType="EZDSBigDecimalItem" />
    </resultMap>
</sqlMap>
