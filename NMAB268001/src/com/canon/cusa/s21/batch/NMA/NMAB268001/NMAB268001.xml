<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAB268001">
    <statement id="getContactInfoWrk" parameterClass="Map" resultClass="Map">
        SELECT
             CIW.DS_ACCT_NUM                AS DS_ACCT_NUM
            ,CIW.DS_ACCT_NM                 AS DS_ACCT_NM
            ,CIW.LOC_NUM                    AS LOC_NUM
            <!-- START 2018/07/18 Hd.Sugawara [QC#26407,MOD] -->
            <!-- ,CIW.CTAC_PRIM_FLG              AS CTAC_PRIM_FLG -->
            ,UPPER(CIW.CTAC_PRIM_FLG)       AS CTAC_PRIM_FLG
            <!-- END 2018/07/18 Hd.Sugawara [QC#26407,MOD] -->
            ,CIW.LAST_NM                    AS LAST_NM
            ,CIW.FIRST_NM                   AS FIRST_NM
            ,CIW.DS_CTAC_PSN_SALT_DESC_TXT  AS DS_CTAC_PSN_SALT_DESC_TXT
            <!-- 2018/03/06 S21_NA#23351 Mod Start -->
            <!-- 
            ,CIW.DS_CTAC_PSN_DEPT_DESC_TXT  AS DS_CTAC_PSN_DEPT_DESC_TXT
            ,CIW.CTAC_TP_DESC_TXT           AS CTAC_TP_DESC_TXT
            ,CIW.DS_CTAC_PSN_TTL_DESC_TXT   AS DS_CTAC_PSN_TTL_DESC_TXT
            ,CIW.DS_CTAC_PNT_TP_DESC_TXT    AS DS_CTAC_PNT_TP_DESC_TXT   -->
            <!-- START 2018/07/18 Hd.Sugawara [QC#26407,MOD] -->
            <!-- ,CIW.DS_CTAC_PSN_DEPT_CD        AS DS_CTAC_PSN_DEPT_CD -->
            <!-- ,CIW.CTAC_TP_CD                 AS CTAC_TP_CD -->
            <!-- ,CIW.DS_CTAC_PSN_TTL_CD         AS DS_CTAC_PSN_TTL_CD -->
            <!-- ,CIW.DS_CTAC_PNT_TP_CD          AS DS_CTAC_PNT_TP_CD -->
            ,UPPER(CIW.DS_CTAC_PSN_DEPT_CD) AS DS_CTAC_PSN_DEPT_CD
            ,UPPER(CIW.CTAC_TP_CD)          AS CTAC_TP_CD
            ,UPPER(CIW.DS_CTAC_PSN_TTL_CD)  AS DS_CTAC_PSN_TTL_CD
            ,UPPER(CIW.DS_CTAC_PNT_TP_CD)   AS DS_CTAC_PNT_TP_CD
            <!-- END 2018/07/18 Hd.Sugawara [QC#26407,MOD] -->
            <!-- 2018/03/06 S21_NA#23351 Mod Start -->
            ,CIW.TEL_DS_CTAC_PNT_VAL_TXT    AS TEL_DS_CTAC_PNT_VAL_TXT
            ,CIW.EXTN_DS_CTAC_PNT_VAL_TXT   AS EXTN_DS_CTAC_PNT_VAL_TXT
            ,CIW.EML_DS_CTAC_PNT_VAL_TXT    AS EML_DS_CTAC_PNT_VAL_TXT
            ,CIW.CELL_DS_CTAC_PNT_VAL_TXT   AS CELL_DS_CTAC_PNT_VAL_TXT
            ,CIW.FAX_DS_CTAC_PNT_VAL_TXT    AS FAX_DS_CTAC_PNT_VAL_TXT
            ,CIW.SER_NUM                    AS SER_NUM
            ,CIW.UPLD_CSV_RQST_CMNT_TXT     AS UPLD_CSV_RQST_CMNT_TXT
            ,CIW.UPLD_CSV_RQST_PK           AS UPLD_CSV_RQST_PK
            ,CIW.UPLD_CSV_RQST_ROW_NUM      AS UPLD_CSV_RQST_ROW_NUM
            ,CIW.SVC_CTAC_TP_DESC_TXT       AS SVC_CTAC_TP_DESC_TXT
        FROM
            CTAC_INFO_WRK CIW
        WHERE
            CIW.GLBL_CMPY_CD                = #glblCmpyCd#
            AND CIW.UPLD_CSV_RQST_PK        = #upldCsvRqstPk#
            AND CIW.EZCANCELFLAG            = '0'
        ORDER BY
            CIW.DS_ACCT_NUM                 ASC
        <!-- START 2017/08/30 H.Sugawara [QC#20791,ADD] -->
          , CIW.UPLD_CSV_RQST_ROW_NUM
        <!-- END 2017/08/30 H.Sugawara [QC#20791,ADD] -->
    </statement>
    <statement id="countPrimary" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(1) AS COUNT
        FROM
            CTAC_INFO_WRK CIW
        WHERE
            CIW.GLBL_CMPY_CD                = #glblCmpyCd#
            AND CIW.UPLD_CSV_RQST_PK        = #upldCsvRqstPk#
            <isNotNull property="dsAcctNum">
            AND CIW.DS_ACCT_NUM             = #dsAcctNum#
            </isNotNull>
            <isNotNull property="locNum">
            AND CIW.LOC_NUM                 = #locNum#
            </isNotNull>
            AND CIW.CTAC_PRIM_FLG           = #ctacPrimFlg#
            AND CIW.EZCANCELFLAG            = '0'
    </statement>
    <!-- START 2017/08/30 H.Sugawara [QC#20791,DEL] -->
    <!-- <statement id="getPersonName" parameterClass="Map" resultClass="Map"> -->
    <!--     SELECT -->
    <!--          CIW.LAST_NM    AS LAST_NM -->
    <!--          ,CIW.FIRST_NM  AS FIRST_NM -->
    <!--     FROM -->
    <!--         CTAC_INFO_WRK CIW -->
    <!--     WHERE -->
    <!--         CIW.GLBL_CMPY_CD                = #glblCmpyCd# -->
    <!--         AND CIW.UPLD_CSV_RQST_PK        = #upldCsvRqstPk# -->
    <!--         <isNotNull property="dsAcctNum"> -->
    <!--         AND CIW.DS_ACCT_NUM             = #dsAcctNum# -->
    <!--         </isNotNull> -->
    <!--         <isNotNull property="locNum"> -->
    <!--         AND CIW.LOC_NUM                 = #locNum# -->
    <!--         </isNotNull> -->
    <!--         AND CIW.EZCANCELFLAG            = '0' -->
    <!--     ORDER BY -->
    <!--         CIW.LAST_NM      ASC -->
    <!--         ,CIW.FIRST_NM    ASC -->
    <!-- </statement> -->
    <!-- START 2017/08/30 H.Sugawara [QC#20791,DEL] -->
    <statement id="countAccountLocation" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(1) AS COUNT
        FROM
            <isNotNull property="dsAcctNum">
            <isNotEqual property="prospectFlg" compareValue="Y">
            SELL_TO_CUST      DAC
            </isNotEqual>
            <isEqual property="prospectFlg" compareValue="Y">
            DS_ACCT_PROS      DAC
            </isEqual>
            </isNotNull>
            <isNotNull property="locNum">
            ACCT_LOC          DAC
            </isNotNull>
        WHERE
            DAC.GLBL_CMPY_CD                = #glblCmpyCd#
            <isNotNull property="dsAcctNum">
            <isNotEqual property="prospectFlg" compareValue="Y">
            AND DAC.SELL_TO_CUST_CD         = #dsAcctNum#
            </isNotEqual>
            <isEqual property="prospectFlg" compareValue="Y">
            AND DAC.DS_ACCT_NUM             = #dsAcctNum#
            </isEqual>
            </isNotNull>
            <isNotNull property="locNum">
            AND DAC.LOC_NUM                 = #locNum#
            </isNotNull>
            AND DAC.EZCANCELFLAG            = '0'
    </statement>
    <!-- START 2017/08/30 H.Sugawara [QC#20791,DEL] -->
    <!-- <statement id="countContactPerson" parameterClass="Map" resultClass="Integer"> -->
    <!--     SELECT -->
    <!--         COUNT(1) AS COUNT -->
    <!--     FROM -->
    <!--         DS_CTAC_PSN_RELN    DCPR -->
    <!--         ,CTAC_PSN           CP -->
    <!--     WHERE -->
    <!--         DCPR.GLBL_CMPY_CD               = #glblCmpyCd# -->
    <!--         <isNotNull property="dsAcctNum"> -->
    <!--         AND DCPR.DS_ACCT_NUM            = #dsAcctNum# -->
    <!--         </isNotNull> -->
    <!--         <isNotNull property="locNum"> -->
    <!--         AND DCPR.LOC_NUM                = #locNum# -->
    <!--         </isNotNull> -->
    <!--         AND DCPR.EFF_FROM_DT        &lt;= #procDate# -->
    <!--         AND NVL(DCPR.EFF_THRU_DT, #hitDate#)         &gt;= #procDate# -->
    <!--         AND DCPR.GLBL_CMPY_CD           = CP.GLBL_CMPY_CD -->
    <!--         AND DCPR.CTAC_PSN_PK            = CP.CTAC_PSN_PK -->
    <!-- END 2017/08/30 H.Sugawara [QC#20791,DEL] -->
            <!-- QC#8155
            AND CP.CTAC_PSN_FIRST_NM        = #ctacPsnFirstNm#
            AND CP.CTAC_PSN_LAST_NM         = #ctacPsnLastNm#
             -->
    <!-- START 2017/08/30 H.Sugawara [QC#20791,DEL] -->
    <!--         AND UPPER(CP.CTAC_PSN_FIRST_NM)        = UPPER(#ctacPsnFirstNm#) -->
    <!--         AND UPPER(CP.CTAC_PSN_LAST_NM)         = UPPER(#ctacPsnLastNm#) -->
    <!--         AND DCPR.EZCANCELFLAG           = '0' -->
    <!--         AND CP.EZCANCELFLAG             = '0' -->
    <!-- </statement> -->
    <!-- END 2017/08/30 H.Sugawara [QC#20791,DEL] -->
    <statement id="getSrvcMchnCntctPrsn" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            SMCP.SVC_MACH_CTAC_PSN_PK AS SVC_MACH_CTAC_PSN_PK
        FROM
            SVC_MACH_MSTR         SMM
            ,SVC_MACH_CTAC_PSN    SMCP
        WHERE
            SMM.GLBL_CMPY_CD                = #glblCmpyCd#
            AND SMM.SER_NUM                 = #serNum#
            AND SMM.GLBL_CMPY_CD            = SMCP.GLBL_CMPY_CD
            AND SMM.SVC_MACH_MSTR_PK        = SMCP.SVC_MACH_MSTR_PK
            AND SMM.EZCANCELFLAG            = '0'
            AND SMCP.EZCANCELFLAG           = '0'
    </statement>
    <statement id="getAvailableServiceMachine" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            M.SVC_MACH_MSTR_PK AS SVC_MACH_MSTR_PK
        FROM
            SVC_MACH_MSTR M
        WHERE
            M.GLBL_CMPY_CD            =  #glblCmpyCd#
        AND M.SER_NUM                 =  #serNum#
        AND M.SVC_MACH_MAINT_AVAL_FLG =  #flgOnY#
        AND M.EZCANCELFLAG            =  0
        AND M.SVC_MACH_MSTR_STS_CD   IN  ( #svcMachMstrSts_W4I#
                                         , #svcMachMstrSts_INSTL#
                                         , #svcMachMstrSts_W4R#)
    </statement>
    <statement id="getDsCtactPntTpCd" parameterClass="Map" resultClass="String">
        SELECT
            DS_CTAC_PNT_TP_CD
        FROM
            DS_CTAC_PNT_TP C
        WHERE
            C.GLBL_CMPY_CD             =  #glblCmpyCd#
        AND C.DS_CTAC_PNT_TP_DESC_TXT  =  #dsCtacPntTp#
        AND C.EZCANCELFLAG             =  0
        AND C.DS_CTAC_PNT_TP_CD       IN  ( #dsCtacPntTp_PhoneMobile#
                                          , #dsCtacPntTp_Work#
                                          , #dsCtacPntTp_EmailWork#
                                          , #dsCtacPntTp_FaxWork#)
    </statement>
    <!-- 2017/10/03 QC#20972 Add start -->
    <statement id="getCtacTpPntMndDfn" parameterClass="Map" resultClass="String">
        SELECT
            CTP.DS_CTAC_PNT_TP_CD
        FROM
            CTAC_TP_PNT_MND_DFN CTP
        WHERE
            CTP.GLBL_CMPY_CD             =  #glblCmpyCd#
        AND CTP.EZCANCELFLAG             =  '0'
        AND CTP.CTAC_TP_CD               =  #ctacTpCd#
    </statement>
    <!-- 2017/10/03 QC#20972 Add end -->
    <!-- START 2018/07/18 Hd.Sugawara [QC#26407,ADD] -->
    <statement id="getDsCtacPsnSalt" parameterClass="Map" resultClass="String">
        SELECT
            DCPS.DS_CTAC_PSN_SALT_CD
        FROM
            DS_CTAC_PSN_SALT DCPS
        WHERE
            DCPS.GLBL_CMPY_CD                     = #glblCmpyCd#
        AND DCPS.EZCANCELFLAG                     = '0'
        AND UPPER(DCPS.DS_CTAC_PSN_SALT_DESC_TXT) = UPPER(#dsCtacPsnSaltDescTxt#)
    </statement>
    <statement id="getSvcCtacTp" parameterClass="Map" resultClass="String">
        SELECT
            SCT.SVC_CTAC_TP_CD
        FROM
            SVC_CTAC_TP SCT
        WHERE
            SCT.GLBL_CMPY_CD                = #glblCmpyCd#
        AND SCT.EZCANCELFLAG                = '0'
        AND UPPER(SCT.SVC_CTAC_TP_DESC_TXT) = UPPER(#svcCtacTpDescTxt#)
    </statement>
    <!-- END 2018/07/18 Hd.Sugawara [QC#26407,ADD] -->
</sqlMap>
