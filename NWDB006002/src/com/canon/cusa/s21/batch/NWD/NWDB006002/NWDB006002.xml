<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NWDB006002">

    <typeAlias alias="HARD_ALLOC_BAT_WRKTMsg" type="business.db.HARD_ALLOC_BAT_WRKTMsg"/>
    <typeAlias alias="INVTYTMsg" type="business.db.INVTYTMsg"/>

    <statement id="getWorkList" parameterClass="Map" resultClass="Map">
        SELECT

             BATWRK.GLBL_CMPY_CD                                 GLBL_CMPY_CD
            ,BATWRK.BAT_GRP_CD                                     BAT_GRP_CD
            ,BATWRK.PROC_GRP_NUM                                 PROC_GRP_NUM
            ,BATWRK.PROC_SQ_NUM                                 PROC_SQ_NUM
            ,BATWRK.SHPG_PLN_NUM                                 SHPG_PLN_NUM
            ,BATWRK.DIST_TP_CD                                     DIST_TP_CD
            ,BATWRK.SOFT_ALLOC_PK                                SOFT_ALLOC_PK
            ,BATWRK.HARD_ALLOC_TP_CD                            HARD_ALLOC_TP_CD
            ,BATWRK.SHPG_PLN_ORD_TAKE_MDSE_CD                    SHPG_PLN_ORD_TAKE_MDSE_CD
            ,BATWRK.SOFT_ALLOC_ORD_TAKE_MDSE_CD                    SOFT_ALLOC_ORD_TAKE_MDSE_CD
            ,BATWRK.CPO_ORD_NUM                                    CPO_ORD_NUM
            ,BATWRK.CPO_DTL_LINE_NUM                            CPO_DTL_LINE_NUM
            ,BATWRK.CPO_DTL_LINE_SUB_NUM                        CPO_DTL_LINE_SUB_NUM
            ,BATWRK.TRX_HDR_NUM                                    TRX_HDR_NUM
            ,BATWRK.TRX_LINE_NUM                                TRX_LINE_NUM
            ,BATWRK.TRX_LINE_SUB_NUM                            TRX_LINE_SUB_NUM
            ,BATWRK.DS_CPO_CONFIG_PK                            DS_CPO_CONFIG_PK
            ,BATWRK.SER_NUM                                        SER_NUM
            ,BATWRK.SVC_MACH_MSTR_PK                            SVC_MACH_MSTR_PK
            ,BATWRK.HLD_RSN_CD                                    HLD_RSN_CD
            
            ,BATWRK.WH_CD                                        WH_CD
            ,BATWRK.DS_ORD_CATG_CD                                DS_ORD_CATG_CD
            ,BATWRK.DS_ORD_TP_CD                                DS_ORD_TP_CD
            ,BATWRK.DS_ORD_RSN_CD                                DS_ORD_RSN_CD
            <!-- 2019/09/06 S21_NA#53087 Add Start -->
           ,BATWRK.CPO_SRC_TP_CD                                 CPO_SRC_TP_CD
            <!-- 2019/09/06 S21_NA#53087 Add End -->
            
            ,BATWRK.MDSE_CD                                        MDSE_CD
            ,BATWRK.SP_MDSE_CD                                    SP_MDSE_CD
            ,BATWRK.INVTY_LOC_CD                                INVTY_LOC_CD
            <!-- START 2022/08/05 T.NEMA [QC#60319, MOD] -->
            <!-- ,BOIT.BACK_ORD_IMPCT_TP_CD                            BACK_ORD_IMPCT_TP_CD  -->
            ,NVL2(M2.BACK_ORD_IMPCT_TP_CD, M2.BACK_ORD_IMPCT_TP_CD, BOIT.BACK_ORD_IMPCT_TP_CD) BACK_ORD_IMPCT_TP_CD
            <!-- END   2022/08/05 T.NEMA [QC#60319, MOD] -->
            
            ,BATWRK.CPO_ORD_NUM || BATWRK.DS_CPO_CONFIG_PK        ORD_CONFIG_KEY
            ,BATWRK.STK_STS_CD                                    STK_STS_CD

        FROM
<!-- QC#16578 Add Start -->
             (
              SELECT
                 HAW.GLBL_CMPY_CD                     GLBL_CMPY_CD
                ,HAW.BAT_GRP_CD                     BAT_GRP_CD
                ,HAW.PROC_GRP_NUM                     PROC_GRP_NUM
                ,HAW.PROC_SQ_NUM                     PROC_SQ_NUM
                ,HAW.SHPG_PLN_NUM                     SHPG_PLN_NUM
                ,HAW.DIST_TP_CD                     DIST_TP_CD
                ,HAW.SOFT_ALLOC_PK                    SOFT_ALLOC_PK
                ,HAW.HARD_ALLOC_TP_CD                HARD_ALLOC_TP_CD
                ,HAW.SHPG_PLN_ORD_TAKE_MDSE_CD        SHPG_PLN_ORD_TAKE_MDSE_CD
                ,HAW.SOFT_ALLOC_ORD_TAKE_MDSE_CD    SOFT_ALLOC_ORD_TAKE_MDSE_CD

                ,CD.CPO_ORD_NUM                     CPO_ORD_NUM
                ,CD.CPO_DTL_LINE_NUM                CPO_DTL_LINE_NUM
                ,CD.CPO_DTL_LINE_SUB_NUM            CPO_DTL_LINE_SUB_NUM
                ,CD.DS_CPO_CONFIG_PK                DS_CPO_CONFIG_PK
                ,CD.SER_NUM                         SER_NUM
                ,CD.RTL_WH_CD                       WH_CD
                ,CD.SVC_MACH_MSTR_PK                SVC_MACH_MSTR_PK
                ,CD.STK_STS_CD                      STK_STS_CD
                <!-- START 2022/08/05 T.NEMA [QC#60319, ADD] -->
                ,CD.SET_MDSE_CD                     SET_MDSE_CD
                <!-- END   2022/08/05 T.NEMA [QC#60319, ADD] -->
                ,C.DS_ORD_CATG_CD                   DS_ORD_CATG_CD
                ,C.DS_ORD_TP_CD                     DS_ORD_TP_CD
                ,C.DS_ORD_RSN_CD                    DS_ORD_RSN_CD
                <!-- 2019/09/06 S21_NA#53087 Add Start -->
                ,C.CPO_SRC_TP_CD                    CPO_SRC_TP_CD
                <!-- 2019/09/06 S21_NA#53087 Add End -->

                ,DCC.MDL_ID                         MDL_ID
                
                ,SP.TRX_HDR_NUM                        TRX_HDR_NUM
                ,SP.TRX_LINE_NUM                    TRX_LINE_NUM
                ,SP.TRX_LINE_SUB_NUM                TRX_LINE_SUB_NUM

                ,(CASE WHEN OTM.MDSE_CD IS NOT NULL  THEN
                    OTM.MDSE_CD
                ELSE
                    SP.MDSE_CD
                END)                                MDSE_CD
                ,SP.MDSE_CD                            SP_MDSE_CD
                ,SP.INVTY_LOC_CD                    INVTY_LOC_CD
                <!-- 2018/07/02 QC#26757 Del Start
                ,(SELECT 
                        H.HLD_RSN_CD
                    FROM
                         HLD          H
                        ,HLD_PROC_DFN HPD
                        ,SHPG_PLN     SPW
                    WHERE
                            HAW.GLBL_CMPY_CD   = SPW.GLBL_CMPY_CD
                        AND HAW.SHPG_PLN_NUM   = SPW.SHPG_PLN_NUM
                        AND (
                                (       
                                        SPW.TRX_HDR_NUM      = H.CPO_ORD_NUM
                                    AND SPW.TRX_LINE_NUM     = H.CPO_DTL_LINE_NUM
                                    AND SPW.TRX_LINE_SUB_NUM = H.CPO_DTL_LINE_SUB_NUM
                                    AND H.SHPG_PLN_NUM      IS NULL
                                ) OR (
                                        SPW.SHPG_PLN_NUM     = H.SHPG_PLN_NUM
                                )
                            )
                        AND H.REL_FLG = 'N'
                        AND H.HLD_RSN_CD               = HPD.HLD_RSN_CD 
                        AND H.GLBL_CMPY_CD             = HPD.GLBL_CMPY_CD
                        AND HPD.REL_PNT_HARD_ALLOC_FLG = 'Y'

                        AND SPW.EZCANCELFLAG = '0'
                        AND H.EZCANCELFLAG   = '0'
                        AND HPD.EZCANCELFLAG = '0'
                        AND ROWNUM = 1
                ) HLD_RSN_CD
                2018/07/02 QC#26757 Del End -->
                
                <!-- 2018/07/02 QC#26757 Add Start -->
                ,(SELECT 
                        HLD_RSN_CD
                    FROM    
                        (SELECT
                               /*+ LEADING(SPW H HPD) USE_NL(H HPD) INDEX(HPD HLD_PROC_DFN_PK) */
                               H.HLD_RSN_CD
                           FROM    
                                HLD          H
                               ,HLD_PROC_DFN HPD
                               ,SHPG_PLN     SPW
                           WHERE
                                   HAW.GLBL_CMPY_CD   = SPW.GLBL_CMPY_CD
                               AND HAW.SHPG_PLN_NUM   = SPW.SHPG_PLN_NUM
                               AND     (       
                                               SPW.TRX_HDR_NUM      = H.CPO_ORD_NUM
                                           AND SPW.TRX_LINE_NUM     = H.CPO_DTL_LINE_NUM
                                           AND SPW.TRX_LINE_SUB_NUM = H.CPO_DTL_LINE_SUB_NUM
                                           AND H.SHPG_PLN_NUM      IS NULL
                                       ) 
                               AND H.REL_FLG = 'N'
                               AND H.HLD_RSN_CD               = HPD.HLD_RSN_CD 
                               AND H.GLBL_CMPY_CD             = HPD.GLBL_CMPY_CD
                               AND HPD.REL_PNT_HARD_ALLOC_FLG = 'Y'
                               AND SPW.EZCANCELFLAG = '0'
                               AND H.EZCANCELFLAG   = '0'
                               AND HPD.EZCANCELFLAG = '0'
                         UNION ALL
                         SELECT
                               /*+ LEADING(SPW H HPD) USE_NL(H HPD) INDEX(HPD HLD_PROC_DFN_PK) */
                               H.HLD_RSN_CD
                           FROM    
                                HLD          H
                               ,HLD_PROC_DFN HPD
                               ,SHPG_PLN     SPW
                           WHERE
                                   HAW.GLBL_CMPY_CD   = SPW.GLBL_CMPY_CD
                               AND HAW.SHPG_PLN_NUM   = SPW.SHPG_PLN_NUM
                               AND SPW.SHPG_PLN_NUM   = H.SHPG_PLN_NUM
                               AND H.REL_FLG = 'N'
                               AND H.HLD_RSN_CD               = HPD.HLD_RSN_CD 
                               AND H.GLBL_CMPY_CD             = HPD.GLBL_CMPY_CD
                               AND HPD.REL_PNT_HARD_ALLOC_FLG = 'Y'
                               AND SPW.EZCANCELFLAG = '0'
                               AND H.EZCANCELFLAG   = '0'
                               AND HPD.EZCANCELFLAG = '0')
                    WHERE ROWNUM = 1
                ) HLD_RSN_CD
                <!-- 2018/07/02 QC#26757 Add End -->
                
            FROM
                 HARD_ALLOC_BAT_WRK HAW
                ,CPO                C
                ,DS_CPO_CONFIG      DCC  <!-- QC#18386(L3#072) ADD -->
                ,CPO_DTL            CD
                ,SHPG_PLN           SP
                ,ORD_TAKE_MDSE      OTM
            WHERE
                HAW.GLBL_CMPY_CD        = #glblCmpyCd#
                AND HAW.BAT_GRP_CD      = #batGrpCd#
                AND HAW.EZCANCELFLAG    = '0'

                AND HAW.GLBL_CMPY_CD    = SP.GLBL_CMPY_CD
                AND HAW.SHPG_PLN_NUM    = SP.SHPG_PLN_NUM
                AND SP.EZCANCELFLAG     = '0'

                AND SP.GLBL_CMPY_CD     = CD.GLBL_CMPY_CD
                AND SP.TRX_HDR_NUM      = CD.CPO_ORD_NUM
                AND SP.TRX_LINE_NUM     = CD.CPO_DTL_LINE_NUM
                AND SP.TRX_LINE_SUB_NUM = CD.CPO_DTL_LINE_SUB_NUM
                AND CD.EZCANCELFLAG     = '0'

                AND CD.GLBL_CMPY_CD     = C.GLBL_CMPY_CD
                AND CD.CPO_ORD_NUM      = C.CPO_ORD_NUM
                AND C.EZCANCELFLAG      = '0'
                <!-- QC#18386(L3#072) ADD START -->
                AND CD.GLBL_CMPY_CD     = DCC.GLBL_CMPY_CD
                AND CD.DS_CPO_CONFIG_PK = DCC.DS_CPO_CONFIG_PK
                AND DCC.EZCANCELFLAG    = '0'
                <!-- QC#18386(L3#072) ADD START -->

                <!-- 2017/06/23 QC#19386 Add Start -->
                AND NOT EXISTS (
                                 SELECT
                                     <!-- 2018/07/02 QC#26757 Add Start -->
                                     /*+ LEADING(H HR HPD) USE_NL(HR HPD) INDEX(HPD HLD_PROC_DFN_PK) INDEX(HR HLD_RSN_PK) */
                                     <!-- 2018/07/02 QC#26757 Add End -->
                                     * 
                                 FROM
                                     HLD          H
                                    ,HLD_RSN      HR
                                    ,HLD_PROC_DFN HPD
                                 WHERE
                                     SP.GLBL_CMPY_CD                = H.GLBL_CMPY_CD
                                     AND SP.TRX_HDR_NUM             = H.CPO_ORD_NUM
                                     AND H.REL_FLG                  = 'N'
                                     AND H.EZCANCELFLAG             = '0'
                                     AND H.GLBL_CMPY_CD             = HR.GLBL_CMPY_CD
                                     AND H.HLD_RSN_CD               = HR.HLD_RSN_CD
                                     AND (
                                             (
                                                     HR.HLD_LVL_CD          = #hldLvlCpo#
                                                 AND SP.TRX_HDR_NUM         = H.CPO_ORD_NUM
                                             ) OR (
                                                     HR.HLD_LVL_CD          = #hldLvlCpoDtl#
                                                 AND SP.TRX_HDR_NUM         = H.CPO_ORD_NUM
                                                 AND SP.TRX_LINE_NUM        = H.CPO_DTL_LINE_NUM
                                                 AND SP.TRX_LINE_SUB_NUM    = H.CPO_DTL_LINE_SUB_NUM
                                             ) OR (
                                                     HR.HLD_LVL_CD          = #hldLvlShpg#
                                                 AND SP.SHPG_PLN_NUM        = H.SHPG_PLN_NUM
                                             ) OR (
                                                     HR.HLD_LVL_CD          = #hldLvlCpoDtl#
                                                 AND SP.TRX_HDR_NUM         = H.CPO_ORD_NUM
                                                 AND SP.TRX_LINE_NUM        = H.CPO_DTL_LINE_NUM
                                                 AND H.CPO_DTL_LINE_SUB_NUM = #trxLineSubNum#
                                             )
                                     )

                                     AND HR.EZCANCELFLAG            = '0'
                                     AND H.HLD_RSN_CD               = HPD.HLD_RSN_CD
                                     AND H.GLBL_CMPY_CD             = HPD.GLBL_CMPY_CD
                                     AND H.TRX_SRC_TP_CD            IS NULL
                                     AND HPD.REL_PNT_HARD_ALLOC_FLG = 'Y'
                                     AND HPD.EZCANCELFLAG           = '0'
                                )
                <!-- 2017/06/23 QC#19386 Add End -->

                AND HAW.GLBL_CMPY_CD              = OTM.GLBL_CMPY_CD(+)
                AND HAW.SHPG_PLN_ORD_TAKE_MDSE_CD = OTM.ORD_TAKE_MDSE_CD(+)
                AND OTM.EZCANCELFLAG(+)           = '0'
             ) BATWRK
<!-- QC#16578 Add End -->
            ,MDSE              M
            ,MDL_BO_IMPCT      MBI     <!-- QC#18386(L3#072) Add -->
            ,BACK_ORD_IMPCT_TP BOIT
            <!-- START 2022/08/05 T.NEMA [QC#60319, ADD] -->
            ,MDSE M2
            <!-- END   2022/08/05 T.NEMA [QC#60319, ADD] -->

        WHERE
                BATWRK.GLBL_CMPY_CD      = M.GLBL_CMPY_CD
            AND BATWRK.MDSE_CD           = M.MDSE_CD
            AND M.EZCANCELFLAG           = '0'

            <!-- QC#18386(L3#072) MOD START
            AND M.GLBL_CMPY_CD           = BOIT.GLBL_CMPY_CD(+)
            AND M.BACK_ORD_IMPCT_TP_CD   = BOIT.BACK_ORD_IMPCT_TP_CD(+)
            AND BOIT.EZCANCELFLAG(+)     = '0' -->

            AND BATWRK.GLBL_CMPY_CD      = MBI.GLBL_CMPY_CD(+)
            AND BATWRK.MDL_ID            = MBI.MDL_ID(+)
            AND NVL(BATWRK.SHPG_PLN_ORD_TAKE_MDSE_CD, BATWRK.MDSE_CD)
                                         = MBI.MDSE_CD(+)
            AND MBI.EZCANCELFLAG(+)      = '0'
            AND M.GLBL_CMPY_CD           = BOIT.GLBL_CMPY_CD(+)
            AND DECODE(MBI.MDL_ID , NULL, M.BACK_ORD_IMPCT_TP_CD, MBI.BO_IMPCT_TP_CD)
                                         = BOIT.BACK_ORD_IMPCT_TP_CD(+)
            AND BOIT.EZCANCELFLAG(+)     = '0'
            <!-- QC#18386(L3#072) MOD END -->

            <!-- START 2022/08/05 T.NEMA [QC#60319, ADD] -->
            AND BATWRK.GLBL_CMPY_CD     = M2.GLBL_CMPY_CD(+)
            AND BATWRK.SET_MDSE_CD      = M2.MDSE_CD(+)
            AND M2.MDSE_ITEM_TP_CD(+)   = #mdseItemTp#
            AND M2.EZCANCELFLAG(+)      = '0'
            <!-- END   2022/08/05 T.NEMA [QC#60319, ADDD] -->

        ORDER BY
             TO_NUMBER(BATWRK.PROC_GRP_NUM) ASC
            ,TO_NUMBER(BATWRK.PROC_SQ_NUM)  ASC
    </statement>


    <statement id="getOrderCategoryBusinessContext" parameterClass="Map" resultClass="Map">
    
        SELECT
             OCBC.DS_ORD_CATG_CD                    DS_ORD_CATG_CD
            ,OCBC.DS_ORD_TP_CD                        DS_ORD_TP_CD
            ,OCBC.DS_ORD_RSN_CD                        DS_ORD_RSN_CD
        FROM
             ORD_CATG_BIZ_CTX OCBC
        WHERE
            OCBC.GLBL_CMPY_CD           = #glblCmpyCd#
            AND OCBC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTpCd#
            AND OCBC.EZCANCELFLAG       = '0'
    
    </statement>


    <statement id="getSvcMachMstrStatus" parameterClass="Map" resultClass="Map">
    
        SELECT
             SMM.SVC_MACH_MAINT_AVAL_FLG                SVC_MACH_MAINT_AVAL_FLG
            ,SMM.SVC_MACH_MSTR_PK                        SVC_MACH_MSTR_PK
            ,SMM.MDSE_CD                                MDSE_CD
            ,SMM.SER_NUM                                SER_NUM
        FROM
             SVC_MACH_MSTR SMM
        WHERE
            SMM.GLBL_CMPY_CD          = #glblCmpyCd#
            AND SMM.MDSE_CD           LIKE #mdseCd# || '%'
           <!-- 2016/06/28 S21_NA#10530 Mod Start -->
            <isNotNull property="machMstrPk">
            AND SMM.SVC_MACH_MSTR_PK  = #machMstrPk#
            </isNotNull>
            <isNotNull property="serNum">
            AND SMM.SER_NUM           = #serNum#
            </isNotNull>
            <isNotNull property="stkStsCd">
            AND SMM.STK_STS_CD        = #stkStsCd#
            </isNotNull>
           <!-- 2016/06/28 S21_NA#10530 Mod End -->
            AND SMM.CUR_LOC_NUM             = #invtyLocCd#
            AND SMM.SVC_MACH_MAINT_AVAL_FLG = 'Y'   <!-- QC#18187 -->
            AND SMM.EZCANCELFLAG            = '0'
        ORDER BY
            SMM.MDSE_CD
    
    </statement>
    
    <statement id="oldgetWorkList" parameterClass="Map" resultMap="result.HARD_ALLOC_BAT_WRKTMsg">
        SELECT
            HAW.GLBL_CMPY_CD                     GLBL_CMPY_CD
            ,HAW.BAT_GRP_CD                     BAT_GRP_CD
            ,HAW.PROC_GRP_NUM                     PROC_GRP_NUM
            ,HAW.PROC_SQ_NUM                     PROC_SQ_NUM
            ,HAW.SHPG_PLN_NUM                     SHPG_PLN_NUM
            ,HAW.DIST_TP_CD                     DIST_TP_CD
            ,HAW.SOFT_ALLOC_PK                    SOFT_ALLOC_PK
            ,HAW.HARD_ALLOC_TP_CD                HARD_ALLOC_TP_CD
            ,HAW.SHPG_PLN_ORD_TAKE_MDSE_CD        SHPG_PLN_ORD_TAKE_MDSE_CD
            ,HAW.SOFT_ALLOC_ORD_TAKE_MDSE_CD    SOFT_ALLOC_ORD_TAKE_MDSE_CD
        FROM
            HARD_ALLOC_BAT_WRK HAW
        WHERE
            HAW.GLBL_CMPY_CD = #glblCmpyCd#
            AND HAW.BAT_GRP_CD = #batGrpCd#
            AND HAW.EZCANCELFLAG = '0'
        ORDER BY
            TO_NUMBER(HAW.PROC_GRP_NUM) ASC
            ,TO_NUMBER(HAW.PROC_SQ_NUM) ASC
    </statement>

    <statement id="getInvtyList" parameterClass="Map" resultMap="result.INVTYTMsg">
        SELECT
            IVT.MDSE_CD            MDSE_CD
            ,IVT.INVTY_LOC_CD    INVTY_LOC_CD
            ,IVT.LOC_STS_CD        LOC_STS_CD
            ,IVT.STK_STS_CD        STK_STS_CD
            ,IVT.INVTY_AVAL_QTY    INVTY_AVAL_QTY
        FROM
            INVTY IVT
        WHERE
            IVT.GLBL_CMPY_CD = #glblCmpyCd#
            AND IVT.MDSE_CD LIKE #mdseCd#
            AND IVT.LOC_STS_CD = #locStsCd#

            <isNotNull property="stkStsCd">
                AND IVT.STK_STS_CD = #stkStsCd#
            </isNotNull>
            AND IVT.EZCANCELFLAG = '0'
    </statement>

    <resultMap id="result.HARD_ALLOC_BAT_WRKTMsg" class="HARD_ALLOC_BAT_WRKTMsg">
        <result property="glblCmpyCd"                column="GLBL_CMPY_CD"                    javaType="EZDTStringItem"/>
        <result property="batGrpCd"                    column="BAT_GRP_CD"                        javaType="EZDTStringItem"/>
        <result property="procGrpNum"                column="PROC_GRP_NUM"                    javaType="EZDTStringItem"/>
        <result property="procSqNum"                column="PROC_SQ_NUM"                    javaType="EZDTStringItem"/>
        <result property="shpgPlnNum"                column="SHPG_PLN_NUM"                    javaType="EZDTStringItem"/>
        <result property="distTpCd"                    column="DIST_TP_CD"                        javaType="EZDTStringItem"/>
        <result property="softAllocPk"              column="SOFT_ALLOC_PK"                    javaType="EZDTBigDecimalItem"/>
        <result property="hardAllocTpCd"            column="HARD_ALLOC_TP_CD"                javaType="EZDTStringItem"/>
        <result property="shpgPlnOrdTakeMdseCd"        column="SHPG_PLN_ORD_TAKE_MDSE_CD"        javaType="EZDTStringItem"/>
        <result property="softAllocOrdTakeMdseCd"    column="SOFT_ALLOC_ORD_TAKE_MDSE_CD"    javaType="EZDTStringItem"/>
    </resultMap>

    <resultMap id="result.INVTYTMsg" class="INVTYTMsg">
        <result property="mdseCd"        column="MDSE_CD"        javaType="EZDTStringItem"/>
        <result property="invtyLocCd"    column="INVTY_LOC_CD"    javaType="EZDTStringItem"/>
        <result property="locStsCd"        column="LOC_STS_CD"        javaType="EZDTStringItem"/>
        <result property="stkStsCd"        column="STK_STS_CD"        javaType="EZDTStringItem"/>
        <result property="invtyAvalQty"    column="INVTY_AVAL_QTY"    javaType="EZDTBigDecimalItem"/>
    </resultMap>

<!-- Add Start QC#5872(L3#001) -->
    <statement id="checkCriticalMDSE" parameterClass="Map" resultClass="Integer">

        SELECT
            COUNT(1)    COUNT
        FROM 
            DS_CPO_CONFIG   DCC
           ,CPO_DTL         CD
           ,SHPG_PLN        SP
           ,MDSE            M
           ,ORD_TAKE_MDSE   OTM
           ,MDL_BO_IMPCT    MBI
        
        WHERE
            DCC.GLBL_CMPY_CD            = #glblCmpyCd#
        AND DCC.DS_CPO_CONFIG_PK        = #dsCpoConfigPk#
        AND DCC.EZCANCELFLAG            = '0'
        AND DCC.GLBL_CMPY_CD            = CD.GLBL_CMPY_CD
        AND DCC.DS_CPO_CONFIG_PK        = CD.DS_CPO_CONFIG_PK
        AND CD.EZCANCELFLAG             = '0'

        AND CD.GLBL_CMPY_CD             = SP.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM              = SP.TRX_HDR_NUM
        AND CD.CPO_DTL_LINE_NUM         = SP.TRX_LINE_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM     = SP.TRX_LINE_SUB_NUM
        AND SP.SHPG_STS_CD              = #shpgStsValidated#
        AND SP.EZCANCELFLAG             = '0'

        AND SP.GLBL_CMPY_CD             = OTM.GLBL_CMPY_CD(+)
        AND SUBSTR(SP.MDSE_CD, 1, 8)    = OTM.ORD_TAKE_MDSE_CD(+)
        AND OTM.EZCANCELFLAG(+)         = '0'
        AND SP.GLBL_CMPY_CD             = M.GLBL_CMPY_CD
        AND NVL(OTM.MDSE_CD, SP.MDSE_CD)= M.MDSE_CD
        AND M.EZCANCELFLAG              = '0'

        AND DCC.GLBL_CMPY_CD            = MBI.GLBL_CMPY_CD(+)
        AND DCC.MDL_ID                  = MBI.MDL_ID(+)
        AND NVL(OTM.ORD_TAKE_MDSE_CD, CD.MDSE_CD)
                                        = MBI.MDSE_CD(+)
        AND DECODE(MBI.MDL_ID , NULL, M.BACK_ORD_IMPCT_TP_CD, MBI.BO_IMPCT_TP_CD)
                                        = #backOrderImpctC#
        <!-- START 2022/08/05 T.NEMA [QC#60319, ADD] -->
        AND M.MDSE_ITEM_TP_CD           != #mdseItemTp#
        <!-- END   2022/08/05 T.NEMA [QC#60319, ADD] -->
        AND MBI.EZCANCELFLAG(+)         = '0'

        AND NOT EXISTS( SELECT 1 
                        FROM HARD_ALLOC_BAT_WRK  HAW
                        WHERE HAW.GLBL_CMPY_CD  = SP.GLBL_CMPY_CD
                          AND HAW.SHPG_PLN_NUM  = SP.SHPG_PLN_NUM
                          AND HAW.EZCANCELFLAG  = '0'
                       )
        AND CD.CR_REBIL_CD IS NULL

        <!-- 2017/12/25 S21_NA#23008 Add Start-->
        <isNotNull property="rtlWhLst">
            AND CD.RTL_WH_CD NOT IN
            <iterate property="rtlWhLst" var="rtlWhLst[]" open="(" close=")" conjunction=",">
                #rtlWhLst[]#
            </iterate>
        </isNotNull>
        <!-- 2017/12/25 S21_NA#23008 Add End-->

    </statement>
<!-- Add End QC#5872(L3#001) -->

</sqlMap>
