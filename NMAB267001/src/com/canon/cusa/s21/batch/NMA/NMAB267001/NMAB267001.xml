<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAB267001">
    <statement id="getLocInfoWrk" parameterClass="Map" resultClass="Map">
        SELECT
             LIW.DS_ACCT_NUM                AS DS_ACCT_NUM
            ,LIW.DS_ACCT_NM                 AS DS_ACCT_NM
            <!-- START 2018/07/18 Hd.Sugawara [QC#26407,MOD] -->
            <!-- ,LIW.CTRY_CD                    AS CTRY_CD -->
            ,UPPER(LIW.CTRY_CD)             AS CTRY_CD
            <!-- END 2018/07/18 Hd.Sugawara [QC#26407,MOD] -->
            ,LIW.FIRST_LINE_ADDR            AS FIRST_LINE_ADDR
            ,LIW.SCD_LINE_ADDR              AS SCD_LINE_ADDR
            ,LIW.THIRD_LINE_ADDR            AS THIRD_LINE_ADDR
            ,LIW.FRTH_LINE_ADDR             AS FRTH_LINE_ADDR
            ,LIW.CTY_ADDR                   AS CTY_ADDR
            <!-- START 2018/07/18 Hd.Sugawara [QC#26407,MOD] -->
            <!-- ,LIW.ST_CD                      AS ST_CD -->
            ,UPPER(LIW.ST_CD)               AS ST_CD
            <!-- END 2018/07/18 Hd.Sugawara [QC#26407,MOD] -->
            ,LIW.POST_CD                    AS POST_CD
            ,LIW.CNTY_NM                    AS CNTY_NM
            ,LIW.PROV_NM                    AS PROV_NM
            <!-- START 2018/07/18 Hd.Sugawara [QC#26407,MOD] -->
            <!-- ,LIW.BILL_TO_AVAL_FLG           AS BILL_TO_AVAL_FLG -->
            <!-- ,LIW.SHIP_TO_AVAL_FLG           AS SHIP_TO_AVAL_FLG -->
            ,UPPER(LIW.BILL_TO_AVAL_FLG)    AS BILL_TO_AVAL_FLG
            ,UPPER(LIW.SHIP_TO_AVAL_FLG)    AS SHIP_TO_AVAL_FLG
            <!-- END 2018/07/18 Hd.Sugawara [QC#26407,MOD] -->
            ,LIW.BILL_TO_EFF_FROM_DT_TXT    AS BILL_TO_EFF_FROM_DT_TXT
            ,LIW.BILL_TO_EFF_THRU_DT_TXT    AS BILL_TO_EFF_THRU_DT_TXT
            ,LIW.SHIP_TO_EFF_FROM_DT_TXT    AS SHIP_TO_EFF_FROM_DT_TXT
            ,LIW.SHIP_TO_EFF_THRU_DT_TXT    AS SHIP_TO_EFF_THRU_DT_TXT
            ,LIW.DS_LOC_NM                  AS DS_LOC_NM
            <!-- START 2018/07/18 Hd.Sugawara [QC#26407,MOD] -->
            <!-- ,LIW.LINE_BIZ_TP_CD             AS LINE_BIZ_TP_CD -->
            <!-- ,LIW.LOC_PRIM_FLG               AS LOC_PRIM_FLG -->
            <!-- ,LIW.LOC_ACTV_FLG               AS LOC_ACTV_FLG -->
            ,UPPER(LIW.LINE_BIZ_TP_CD)      AS LINE_BIZ_TP_CD
            ,UPPER(LIW.LOC_PRIM_FLG)        AS LOC_PRIM_FLG
            ,UPPER(LIW.LOC_ACTV_FLG)        AS LOC_ACTV_FLG
            <!-- END 2018/07/18 Hd.Sugawara [QC#26407,MOD] -->
            ,LIW.LOC_NUM                    AS LOC_NUM
            <!-- 2017/10/23 QC#21559 add start -->
            ,LIW.RELN_BILL_TO_CUST_CD       AS RELN_BILL_TO_CUST_CD
            <!-- 2017/10/23 QC#21559 add end -->
            ,LIW.UPLD_CSV_RQST_PK           AS UPLD_CSV_RQST_PK
            ,LIW.UPLD_CSV_RQST_ROW_NUM      AS UPLD_CSV_RQST_ROW_NUM
            ,LIW.UPLD_CSV_RQST_CMNT_TXT     AS UPLD_CSV_RQST_CMNT_TXT
        FROM
            LOC_INFO_WRK LIW
        WHERE
            LIW.GLBL_CMPY_CD                = #glblCmpyCd#
            AND LIW.UPLD_CSV_RQST_PK        = #upldCsvRqstPk#
            AND LIW.EZCANCELFLAG            = '0'
        ORDER BY
            LIW.DS_ACCT_NUM                 ASC
    </statement>
    <statement id="getCountLocInfoWrk" parameterClass="Map" resultClass="Map">
        SELECT
             CON.COUNT    AS COUNT
             ,LIW.LOC_NUM AS LOC_NUM
        FROM
            LOC_INFO_WRK LIW
            ,(SELECT
             COUNT(1) AS COUNT
            FROM
                LOC_INFO_WRK A
            WHERE
                A.GLBL_CMPY_CD              = #glblCmpyCd#
                AND A.UPLD_CSV_RQST_PK      = #upldCsvRqstPk#
                AND A.DS_ACCT_NUM           = #dsAcctNum#
                AND A.LOC_PRIM_FLG          = #locPrimFlg#
                AND A.EZCANCELFLAG          = '0') CON
        WHERE
            LIW.GLBL_CMPY_CD                = #glblCmpyCd#
            AND LIW.UPLD_CSV_RQST_PK        = #upldCsvRqstPk#
            AND LIW.DS_ACCT_NUM             = #dsAcctNum#
            AND LIW.EZCANCELFLAG            = '0'
        ORDER BY
            LIW.LOC_NUM                 ASC
    </statement>
    <statement id="getAccount" parameterClass="Map" resultClass="Map">
        SELECT
            STC.DS_ACCT_NM         AS DS_ACCT_NM
            ,STC.DS_ACCT_ITRL_FLG  AS DS_ACCT_ITRL_FLG
            ,STC.DS_ACCT_CLS_CD    AS DS_ACCT_CLS_CD
            ,STC.COA_CH_CD         AS COA_CH_CD
            ,STC.COA_AFFL_CD       AS COA_AFFL_CD
            ,STC.DS_ACCT_DLR_CD    AS DS_ACCT_DLR_CD
            ,STC.DS_ACCT_LEGAL_NM  AS DS_ACCT_LEGAL_NM
            ,STC.DBA_NM            AS DBA_NM
            ,STC.RGTN_STS_CD       AS RGTN_STS_CD
            ,STC.DS_ACCT_URL       AS DS_ACCT_URL
        FROM
            SELL_TO_CUST      STC
        WHERE
            STC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND STC.SELL_TO_CUST_CD = #dsAcctNum#
            AND STC.EZCANCELFLAG    = '0'
    </statement>
    <statement id="getLocation" parameterClass="Map" resultClass="Map">
        SELECT
            SEL.SELL_TO_CUST_CD             AS DS_ACCT_NUM
            ,SEL.DS_ACCT_NM                 AS DS_ACCT_NM
            ,SEL.DS_ACCT_ITRL_FLG           AS DS_ACCT_ITRL_FLG
            ,SEL.DS_ACCT_CLS_CD             AS DS_ACCT_CLS_CD
            ,SEL.COA_CH_CD                  AS COA_CH_CD
            ,SEL.COA_AFFL_CD                AS COA_AFFL_CD
            ,SEL.DS_ACCT_DLR_CD             AS DS_ACCT_DLR_CD
            ,SEL.DS_ACCT_LEGAL_NM           AS DS_ACCT_LEGAL_NM
            ,SEL.DBA_NM                     AS DBA_NM
            ,SEL.RGTN_STS_CD                AS RGTN_STS_CD
            ,SEL.DS_ACCT_URL                AS DS_ACCT_URL
            ,AL.EFF_FROM_DT                 AS EFF_FROM_DT
            ,NVL(AL.EFF_THRU_DT, #maxDate#) AS EFF_THRU_DT
            ,AL.ACCT_LOC_PK                 AS ACCT_LOC_PK
            ,AL.RGTN_STS_CD                 AS RGTN_STS_CD
            ,PLW.FIRST_LINE_ADDR            AS FIRST_LINE_ADDR
            ,PLW.SCD_LINE_ADDR              AS SCD_LINE_ADDR
            ,PLW.THIRD_LINE_ADDR            AS THIRD_LINE_ADDR
            ,PLW.FRTH_LINE_ADDR             AS FRTH_LINE_ADDR
            ,PLW.CTY_ADDR                   AS CTY_ADDR
            ,PLW.CNTY_PK                    AS CNTY_PK
            ,PLW.PROV_NM                    AS PROV_NM
            ,PLW.ST_CD                      AS ST_CD
            ,PLW.POST_CD                    AS POST_CD
            ,PLW.CTRY_CD                    AS CTRY_CD
            ,PLW.LOC_NM                     AS LOC_NM
            ,PLW.ADDL_LOC_NM                AS ADDL_LOC_NM
            ,PLW.GLN_NUM                    AS GLN_NUM
            ,PLW.TEL_NUM                    AS TEL_NUM
            ,PLW.DUNS_NUM                   AS DUNS_NUM
            ,PLW.FAX_NUM                    AS FAX_NUM
            ,BTC.EFF_FROM_DT                AS BTC_EFF_FROM_DT
            ,BTC.EFF_THRU_DT                AS BTC_EFF_THRU_DT
            ,BTC.LINE_BIZ_TP_CD             AS LINE_BIZ_TP_CD
            ,STC.EFF_FROM_DT                AS STC_EFF_FROM_DT
            ,STC.EFF_THRU_DT                AS STC_EFF_THRU_DT
            ,STC.DPL_STS_CD                 AS DPL_STS_CD
            ,STC.RELN_BILL_TO_CUST_CD       AS RELN_BILL_TO_CUST_CD
            ,STC.PRIM_USG_FLG               AS PRIM_USG_FLG
            ,STC.LINE_BIZ_TP_CD             AS LINE_BIZ_TP_CD
            ,STC.BIG_DEAL_NUM               AS BIG_DEAL_NUM
            ,PC.PTY_LOC_PK                  AS PTY_LOC_PK
            ,C.CNTY_NM                      AS CNTY_NM
        FROM
            SELL_TO_CUST      SEL
            ,ACCT_LOC         AL
            ,PTY_LOC_WRK      PLW
            ,BILL_TO_CUST     BTC
            ,SHIP_TO_CUST     STC
            ,PRIN_CUST        PC
            ,CNTY             C
        WHERE
            SEL.GLBL_CMPY_CD           = #glblCmpyCd#
            AND SEL.SELL_TO_CUST_CD    = #dsAcctNum#
            AND AL.GLBL_CMPY_CD        = #glblCmpyCd#
            AND SEL.SELL_TO_CUST_CD    = AL.DS_ACCT_NUM
            AND AL.LOC_NUM             = #locNum#
            AND AL.GLBL_CMPY_CD        = PLW.GLBL_CMPY_CD
            AND AL.LOC_NUM             = PLW.LOC_NUM
            AND PLW.GLBL_CMPY_CD       = BTC.GLBL_CMPY_CD(+)
            AND PLW.LOC_NUM            = BTC.LOC_NUM(+)
            AND PLW.GLBL_CMPY_CD       = STC.GLBL_CMPY_CD(+)
            AND PLW.LOC_NUM            = STC.LOC_NUM(+)
            AND PLW.GLBL_CMPY_CD       = PC.GLBL_CMPY_CD(+)
            AND PLW.PTY_LOC_PK         = PC.PTY_LOC_PK(+)
            AND PLW.GLBL_CMPY_CD       = C.GLBL_CMPY_CD(+)
            AND PLW.CNTY_PK            = C.CNTY_PK(+)
            AND SEL.EZCANCELFLAG       = '0'
            AND AL.EZCANCELFLAG        = '0'
            AND PLW.EZCANCELFLAG       = '0'
            AND BTC.EZCANCELFLAG(+)    = '0'
            AND STC.EZCANCELFLAG(+)    = '0'
            AND PC.EZCANCELFLAG(+)     = '0'
            AND C.EZCANCELFLAG(+)      = '0'
    </statement>
    <!-- 2017/10/23 QC#21559 add start -->
    <statement id="getAcctReln" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)
        FROM
            DS_ACCT_RELN D
        WHERE
                D.GLBL_CMPY_CD                 = #glblCmpyCd#
            AND D.EZCANCELFLAG                 = '0'
            AND D.DS_ACCT_NUM                  = #dsAcctNum#
            AND D.RELN_DS_ACCT_NUM             = #relnDsAcctNum#
            AND D.RGTN_STS_CD                  = #rgtnStsCd#
            AND D.DS_ACCT_RELN_BILL_TO_FLG     = 'Y'
            AND D.EFF_FROM_DT              &lt;= #procDate#
            AND NVL(D.EFF_THRU_DT, #maxDate#) &gt; #procDate#
    </statement>
    <!-- 2017/10/23 QC#21559 add end -->
</sqlMap>
