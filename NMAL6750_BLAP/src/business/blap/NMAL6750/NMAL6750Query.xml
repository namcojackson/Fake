<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL6750Query">
  <typeAlias alias="NMAL6750SMsg"   type="business.blap.NMAL6750.NMAL6750SMsg"/>
  <typeAlias alias="NMAL6750_ASMsg"   type="business.blap.NMAL6750.NMAL6750_ASMsg"/>
  <typeAlias alias="NMAL6750_BSMsg"   type="business.blap.NMAL6750.NMAL6750_BSMsg"/>
  <typeAlias alias="NMAL6750_RSMsg"   type="business.blap.NMAL6750.NMAL6750_RSMsg"/>
  <typeAlias alias="NMAL6750_TSMsg"   type="business.blap.NMAL6750.NMAL6750_TSMsg"/>

  <statement id="getContactPsnInfo" parameterClass="Map" resultMap="result.getContactPsnInfo">
    SELECT
        *
    FROM
        (   
            SELECT
                CP.CTAC_PSN_PK          AS CTAC_PSN_PK
              , CP.CTAC_PSN_NUM         AS CTAC_PSN_NUM
              , CP.CTAC_PSN_FIRST_NM    AS CTAC_PSN_FIRST_NM
              , CP.CTAC_PSN_LAST_NM     AS CTAC_PSN_LAST_NM
              , CP.DS_CTAC_PSN_SALT_CD  AS DS_CTAC_PSN_SALT_CD
              , CP.DS_CTAC_PSN_DEPT_CD  AS DS_CTAC_PSN_DEPT_CD
              , CP.DS_CTAC_PSN_TTL_CD   AS DS_CTAC_PSN_TTL_CD
              , DCPR.CTAC_TP_CD         AS CTAC_TP_CD
              , CP.CTAC_PSN_ACTV_FLG    AS CTAC_PSN_ACTV_FLG
              , CP.DS_PRIM_CTAC_TP_CD   AS DS_PRIM_CTAC_TP_CD
              , CP.CTAC_PSN_CMNT_TXT    AS CTAC_PSN_CMNT_TXT
              , CP.EZUPTIME             AS EZUPTIME
              , CP.EZUPTIMEZONE         AS EZUPTIMEZONE
              <!-- Add Start 2016/11/07 M.Ohno S21_NA#2680 -->
              , CP.EZINTIME             AS XX_REC_HIST_CRAT_TS
              , CP.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
              , CP.EZUPTIME             AS XX_REC_HIST_UPD_TS
              , CP.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
              , 'CTAC_PSN'              AS XX_REC_HIST_TBL_NM
              <!-- Add End   2016/11/07 M.Ohno S21_NA#2680 -->
            FROM
                CTAC_PSN CP
              , CTAC_TP CT
              , DS_CTAC_PSN_RELN DCPR
              , DS_CTAC_PSN_SALT DCPS
              , DS_CTAC_PSN_TTL DCPT
            WHERE
                  CP.GLBL_CMPY_CD = #glblCmpyCd#
              AND CP.CTAC_PSN_NUM = #ctacPsnNum#
              AND CP.EZCANCELFLAG = '0'
              AND CP.GLBL_CMPY_CD       = DCPR.GLBL_CMPY_CD (+)
              AND CP.CTAC_PSN_PK        = DCPR.CTAC_PSN_PK (+)
              AND DCPR.EZCANCELFLAG (+) = '0'
              <!-- Mod Start 2017/06/16 K.Kasai QC#18848 temporary modification until Solution#358  -->
              AND DCPR.GLBL_CMPY_CD      = CT.GLBL_CMPY_CD (+)
              AND DCPR.CTAC_TP_CD        = CT.CTAC_TP_CD (+)
              AND CT.EZCANCELFLAG (+)    = '0'
              <!-- Mod End 2017/06/16 K.Kasai QC#18848 temporary modification until Solution#358  -->
              AND CP.GLBL_CMPY_CD        = DCPS.GLBL_CMPY_CD (+)
              AND CP.DS_CTAC_PSN_SALT_CD = DCPS.DS_CTAC_PSN_SALT_CD (+)
              AND DCPS.EZCANCELFLAG (+)  = '0'
              AND CP.GLBL_CMPY_CD        = DCPT.GLBL_CMPY_CD (+)
              AND CP.DS_CTAC_PSN_TTL_CD  = DCPT.DS_CTAC_PSN_TTL_CD (+)
              AND DCPT.EZCANCELFLAG (+)  = '0'
        )
    WHERE
        ROWNUM = #rowNum#
  </statement>
  <resultMap id="result.getContactPsnInfo" class="NMAL6750SMsg">
    <result property="ctacPsnPk_H1"       column="CTAC_PSN_PK"         javaType="EZDSBigDecimalItem" />
    <result property="ctacPsnNum_H1"      column="CTAC_PSN_NUM"        javaType="EZDSStringItem" />
    <result property="ctacPsnFirstNm_H1"  column="CTAC_PSN_FIRST_NM"   javaType="EZDSStringItem" />
    <result property="ctacPsnLastNm_H1"   column="CTAC_PSN_LAST_NM"    javaType="EZDSStringItem" />
    <result property="dsCtacPsnSaltCd_H2" column="DS_CTAC_PSN_SALT_CD" javaType="EZDSStringItem" />
    <result property="dsCtacPsnDeptCd_H2" column="DS_CTAC_PSN_DEPT_CD" javaType="EZDSStringItem" />
    <result property="dsCtacPsnTtlCd_H2"  column="DS_CTAC_PSN_TTL_CD"  javaType="EZDSStringItem" />
    <result property="ctacTpCd_H2"        column="CTAC_TP_CD"          javaType="EZDSStringItem" />
    <result property="ctacPsnActvFlg_H1"  column="CTAC_PSN_ACTV_FLG"   javaType="EZDSStringItem" />
    <result property="dsCtacPntTpCd_H2"   column="DS_PRIM_CTAC_TP_CD"  javaType="EZDSStringItem" />
    <result property="ctacPsnCmntTxt_H1"  column="CTAC_PSN_CMNT_TXT"   javaType="EZDSStringItem" />
    <result property="ezUpTime"           column="EZUPTIME"            javaType="EZDSStringItem" />
    <result property="ezUpTimeZone"       column="EZUPTIMEZONE"        javaType="EZDSStringItem" />
    <!-- Add Start 2016/11/07 M.Ohno S21_NA#2680 -->
    <result property="xxRecHistCratTs"       column="XX_REC_HIST_CRAT_TS"     javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm"     column="XX_REC_HIST_CRAT_BY_NM"  javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs"        column="XX_REC_HIST_UPD_TS"      javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm"      column="XX_REC_HIST_UPD_BY_NM"   javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm"        column="XX_REC_HIST_TBL_NM"      javaType="EZDSStringItem" />
    <!-- Add End   2016/11/07 M.Ohno S21_NA#2680 -->
  </resultMap>

  <statement id="getRelatedAccountInfo" parameterClass="Map" resultMap="result.getRelatedAccount">
    SELECT 
        * 
    FROM
        (
        <isNotNull property="locNum">
            SELECT
                ACCT.DS_ACCT_NM     
              , ACCT.DS_ACCT_NUM    
              , ACCT.LOC_NUM         
              , ACCT.FIRST_LINE_ADDR
              , ACCT.SCD_LINE_ADDR
              , ACCT.CTY_ADDR
              , ACCT.ST_CD
              , ACCT.POST_CD
              , ''                   AS EFF_FROM_DT
              , ''                   AS EFF_THRU_DT
              , 'N'                  AS DS_PRIM_LOC_FLG 
            FROM
               (
                  SELECT
                        STC.DS_ACCT_NM 
                      , STC.SELL_TO_CUST_CD AS DS_ACCT_NUM
                      , AL.LOC_NUM         
                      , LOC.FIRST_LINE_ADDR
                      , LOC.SCD_LINE_ADDR
                      , LOC.CTY_ADDR
                      , LOC.ST_CD
                      , LOC.POST_CD
                  FROM
                        ACCT_LOC AL
                      , PTY_LOC_WRK LOC 
                      , SELL_TO_CUST STC 
                  WHERE
                          AL.GLBL_CMPY_CD = #glblCmpyCd# 
                      AND AL.LOC_NUM      = #locNum#
                      AND AL.EZCANCELFLAG = '0'
                      
                      AND AL.GLBL_CMPY_CD  = LOC.GLBL_CMPY_CD 
                      AND AL.LOC_NUM       = LOC.LOC_NUM 
                      AND LOC.EZCANCELFLAG = '0'
                      
                      AND AL.GLBL_CMPY_CD   = STC.GLBL_CMPY_CD 
                      AND AL.DS_ACCT_NUM    = STC.SELL_TO_CUST_CD 
                      AND STC.EZCANCELFLAG = '0'
                  UNION ALL 
                  SELECT
                        DAP.DS_ACCT_NM 
                      , DAP.DS_ACCT_NUM
                      , LOC.LOC_NUM         
                      , LOC.FIRST_LINE_ADDR
                      , LOC.SCD_LINE_ADDR
                      , LOC.CTY_ADDR
                      , LOC.ST_CD
                      , LOC.POST_CD
                  FROM
                        DS_ACCT_PROS DAP
                      , PROS_PTY_LOC_WRK LOC 
                  WHERE
                        DAP.GLBL_CMPY_CD = #glblCmpyCd# 
                    AND DAP.EZCANCELFLAG = '0'
                    
                    AND DAP.GLBL_CMPY_CD = LOC.GLBL_CMPY_CD
                    AND LOC.LOC_NUM      = #locNum#
                    AND DAP.PTY_LOC_PK = LOC.PTY_LOC_PK
                    AND LOC.EZCANCELFLAG = '0'
                ) ACCT
        </isNotNull>
        <isNull property="locNum">
        <!-- 201/7/11/08 QC#22055 mod start -->
            <!--SELECT
                STC.DS_ACCT_NM
              , STC.SELL_TO_CUST_CD AS DS_ACCT_NUM
              , ''                  AS LOC_NUM
              , DECODE(STC.FIRST_LINE_ADDR, NULL, PLW.FIRST_LINE_ADDR, STC.FIRST_LINE_ADDR)
                                    AS FIRST_LINE_ADDR
              , DECODE(STC.FIRST_LINE_ADDR, NULL, PLW.SCD_LINE_ADDR, STC.SCD_LINE_ADDR)
                                    AS SCD_LINE_ADDR
              , DECODE(STC.FIRST_LINE_ADDR, NULL, PLW.CTY_ADDR, STC.CTY_ADDR)
                                    AS CTY_ADDR
              , DECODE(STC.FIRST_LINE_ADDR, NULL, PLW.ST_CD, STC.ST_CD)
                                    AS ST_CD
              , DECODE(STC.FIRST_LINE_ADDR, NULL, PLW.POST_CD, STC.POST_CD)
                                    AS POST_CD
              , ''                  AS EFF_FROM_DT
              , ''                  AS EFF_THRU_DT
              , 'N'                 AS DS_PRIM_LOC_FLG 
            FROM
                SELL_TO_CUST STC
               ,PTY_LOC_WRK  PLW
            WHERE
                  STC.GLBL_CMPY_CD = #glblCmpyCd#
              AND STC.SELL_TO_CUST_CD  = #dsAcctNum#
              AND STC.EZCANCELFLAG = '0'
              AND STC.GLBL_CMPY_CD = PLW.GLBL_CMPY_CD
              AND STC.PTY_LOC_PK   = PLW.PTY_LOC_PK
              AND PLW.EZCANCELFLAG = '0'
            UNION ALL
            SELECT
                DAP.DS_ACCT_NM      AS DS_ACCT_NM
              , DAP.DS_ACCT_NUM     AS DS_ACCT_NUM
              , ''                  AS LOC_NUM
              , PLW.FIRST_LINE_ADDR AS FIRST_LINE_ADDR
              , PLW.SCD_LINE_ADDR   AS SCD_LINE_ADDR
              , PLW.CTY_ADDR        AS CTY_ADDR
              , PLW.ST_CD           AS ST_CD
              , PLW.POST_CD         AS POST_CD
              , ''                  AS EFF_FROM_DT
              , ''                  AS EFF_THRU_DT
              , 'N'                 AS DS_PRIM_LOC_FLG 
            FROM
                DS_ACCT_PROS     DAP
              , PROS_PTY_LOC_WRK PLW
            WHERE
                  DAP.GLBL_CMPY_CD = #glblCmpyCd#
              AND DAP.DS_ACCT_NUM  = #dsAcctNum#
              AND DAP.EZCANCELFLAG = '0'
              AND DAP.GLBL_CMPY_CD = PLW.GLBL_CMPY_CD
              AND DAP.PTY_LOC_PK   = PLW.PTY_LOC_PK
              AND PLW.EZCANCELFLAG = '0' -->
            SELECT
                STC.DS_ACCT_NM
              , STC.SELL_TO_CUST_CD AS DS_ACCT_NUM
              , ''                  AS LOC_NUM
              , STC.FIRST_LINE_ADDR AS FIRST_LINE_ADDR
              , STC.SCD_LINE_ADDR   AS SCD_LINE_ADDR
              , STC.CTY_ADDR        AS CTY_ADDR
              , STC.ST_CD           AS ST_CD
              , STC.POST_CD         AS POST_CD
              , ''                  AS EFF_FROM_DT
              , ''                  AS EFF_THRU_DT
              , 'N'                 AS DS_PRIM_LOC_FLG 
            FROM
                SELL_TO_CUST STC
            WHERE
                  STC.GLBL_CMPY_CD = #glblCmpyCd#
              AND STC.SELL_TO_CUST_CD  = #dsAcctNum#
              AND STC.EZCANCELFLAG = '0'
            UNION ALL
            SELECT
                DAP.DS_ACCT_NM      AS DS_ACCT_NM
              , DAP.DS_ACCT_NUM     AS DS_ACCT_NUM
              , ''                  AS LOC_NUM
              , DAP.FIRST_LINE_ADDR AS FIRST_LINE_ADDR
              , DAP.SCD_LINE_ADDR   AS SCD_LINE_ADDR
              , DAP.CTY_ADDR        AS CTY_ADDR
              , DAP.ST_CD           AS ST_CD
              , DAP.POST_CD         AS POST_CD
              , ''                  AS EFF_FROM_DT
              , ''                  AS EFF_THRU_DT
              , 'N'                 AS DS_PRIM_LOC_FLG 
            FROM
                DS_ACCT_PROS     DAP
            WHERE
                  DAP.GLBL_CMPY_CD = #glblCmpyCd#
              AND DAP.DS_ACCT_NUM  = #dsAcctNum#
              AND DAP.EZCANCELFLAG = '0'
        <!-- 201/7/11/08 QC#22055 mod end -->
        </isNull>
        )
    WHERE
        ROWNUM &lt;= #rowNum#
  </statement>
  
  <statement id="getRelatedAccountList" parameterClass="Map" resultMap="result.getRelatedAccount">
    SELECT
        *
    FROM
        (
        SELECT
            *
        FROM
            (
                SELECT
                    ACCT.DS_CTAC_PSN_RELN_PK
                  , ACCT.DS_ACCT_NM
                  , ACCT.DS_ACCT_NUM
                  , ACCT.LOC_NUM
                  , ACCT.FIRST_LINE_ADDR
                  , ACCT.SCD_LINE_ADDR
                  , ACCT.CTY_ADDR    
                  , ACCT.ST_CD       
                  , ACCT.POST_CD
                  , ACCT.EFF_FROM_DT
                  , ACCT.EFF_THRU_DT
                  , ACCT.DS_PRIM_LOC_FLG 
                  , ACCT.EZUPTIME
                  , ACCT.EZUPTIMEZONE
                  <!-- Add Start 2016/11/07 M.Ohno S21_NA#2680 -->
                  , ACCT.EZINTIME             AS XX_REC_HIST_CRAT_TS
	              , ACCT.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
	              , ACCT.EZUPTIME             AS XX_REC_HIST_UPD_TS
	              , ACCT.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
	              , 'DS_CTAC_PSN_RELN'       AS XX_REC_HIST_TBL_NM
	              <!-- Add End   2016/11/07 M.Ohno S21_NA#2680 -->
                FROM
                   (
                    SELECT
                          STC.DS_ACCT_NM 
                        , STC.SELL_TO_CUST_CD AS DS_ACCT_NUM
                        , PTY.LOC_NUM
                        , PTY.FIRST_LINE_ADDR
                        , PTY.SCD_LINE_ADDR
                        , PTY.CTY_ADDR    
                        , PTY.ST_CD       
                        , PTY.POST_CD
                        , CPR.DS_CTAC_PSN_RELN_PK
                        , CPR.EFF_FROM_DT
                        , CPR.EFF_THRU_DT
                        , CPR.DS_PRIM_LOC_FLG 
                        , CPR.EZUPTIME
                        , CPR.EZUPTIMEZONE
                        , CPR.EZUPUSERID
                        , CPR.EZINTIME
                        , CPR.EZINUSERID
                    FROM
                          SELL_TO_CUST STC
                        , DS_CTAC_PSN_RELN CPR
                        , PTY_LOC_WRK      PTY
                        , ACCT_LOC         LOC
                    WHERE 
                            CPR.GLBL_CMPY_CD = #glblCmpyCd#
                        AND CPR.CTAC_PSN_PK  = #ctacPsnPk#
                        AND CPR.EZCANCELFLAG = '0' 
                        
                        AND CPR.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD 
                        AND CPR.LOC_NUM      = PTY.LOC_NUM 
                        AND LOC.EZCANCELFLAG = '0' 
                        
                        AND CPR.GLBL_CMPY_CD = LOC.GLBL_CMPY_CD
                        AND CPR.LOC_NUM      = LOC.LOC_NUM
                        AND PTY.EZCANCELFLAG = '0' 
                        
                        AND LOC.GLBL_CMPY_CD   = STC.GLBL_CMPY_CD
                        AND LOC.DS_ACCT_NUM    = STC.SELL_TO_CUST_CD
                        AND STC.EZCANCELFLAG   = '0'
                        AND LOC.RGTN_STS_CD &lt;&gt; #rgtnStsCd#
                    UNION ALL 
                    SELECT
                          DAP.DS_ACCT_NM 
                        , DAP.DS_ACCT_NUM
                        , PTY.LOC_NUM
                        , PTY.FIRST_LINE_ADDR
                        , PTY.SCD_LINE_ADDR
                        , PTY.CTY_ADDR    
                        , PTY.ST_CD       
                        , PTY.POST_CD
                        , CPR.DS_CTAC_PSN_RELN_PK
                        , CPR.EFF_FROM_DT
                        , CPR.EFF_THRU_DT
                        , CPR.DS_PRIM_LOC_FLG 
                        , CPR.EZUPTIME
                        , CPR.EZUPTIMEZONE
                        , CPR.EZUPUSERID
                        , CPR.EZINTIME
                        , CPR.EZINUSERID
                    FROM
                          DS_ACCT_PROS DAP
                        , DS_CTAC_PSN_RELN CPR
                        , PROS_PTY_LOC_WRK  PTY
                    WHERE
                            CPR.GLBL_CMPY_CD = #glblCmpyCd#
                        AND CPR.CTAC_PSN_PK  = #ctacPsnPk#
                        AND CPR.EZCANCELFLAG = '0' 
                        
                        AND CPR.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD
                        AND CPR.LOC_NUM      = PTY.LOC_NUM
                        AND PTY.EZCANCELFLAG = '0' 
                        
                        AND PTY.GLBL_CMPY_CD   = DAP.GLBL_CMPY_CD
                        AND DAP.EZCANCELFLAG   = '0'
                        AND PTY.RGTN_STS_CD &lt;&gt; #rgtnStsCd#
                  ) ACCT 
                UNION ALL 
                -- Account Level
                SELECT
                    CPR.DS_CTAC_PSN_RELN_PK
                  , ACCT.DS_ACCT_NM
                  , ACCT.DS_ACCT_NUM
                  , '' AS LOC_NUM
                  , ACCT.FIRST_LINE_ADDR
                  , ACCT.SCD_LINE_ADDR
                  , ACCT.CTY_ADDR    
                  , ACCT.ST_CD       
                  , ACCT.POST_CD
                  , CPR.EFF_FROM_DT
                  , CPR.EFF_THRU_DT
                  , CPR.DS_PRIM_LOC_FLG 
                  , CPR.EZUPTIME
                  , CPR.EZUPTIMEZONE
                  <!-- Add Start 2016/11/07 M.Ohno S21_NA#2680 -->
                  , CPR.EZINTIME             AS XX_REC_HIST_CRAT_TS
	              , CPR.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
	              , CPR.EZUPTIME             AS XX_REC_HIST_UPD_TS
	              , CPR.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
	              , 'DS_CTAC_PSN_RELN'       AS XX_REC_HIST_TBL_NM
	              <!-- Add End   2016/11/07 M.Ohno S21_NA#2680 -->
                FROM
                    DS_CTAC_PSN_RELN CPR
                  , (
                    SELECT
                        STC.DS_ACCT_NM 
                      , STC.SELL_TO_CUST_CD AS DS_ACCT_NUM
                      , STC.GLBL_CMPY_CD
                      , STC.EZCANCELFLAG
                      , STC.FIRST_LINE_ADDR
                      , STC.SCD_LINE_ADDR
                      , STC.CTY_ADDR    
                      , STC.ST_CD       
                      , STC.POST_CD
                    FROM
                      SELL_TO_CUST STC
                    WHERE
                          STC.GLBL_CMPY_CD = #glblCmpyCd# 
                      AND STC.EZCANCELFLAG = '0'
                    UNION ALL 
                    SELECT
                        DAP.DS_ACCT_NM 
                      , DAP.DS_ACCT_NUM
                      , DAP.GLBL_CMPY_CD
                      , DAP.EZCANCELFLAG 
                      , DAP.FIRST_LINE_ADDR
                      , DAP.SCD_LINE_ADDR
                      , DAP.CTY_ADDR    
                      , DAP.ST_CD       
                      , DAP.POST_CD
                    FROM
                      DS_ACCT_PROS DAP
                    WHERE
                          DAP.GLBL_CMPY_CD = #glblCmpyCd# 
                      AND DAP.EZCANCELFLAG = '0'
                  ) ACCT 
                WHERE
                      CPR.GLBL_CMPY_CD = #glblCmpyCd#
                  AND CPR.CTAC_PSN_PK  = #ctacPsnPk#
                  AND CPR.EZCANCELFLAG = '0' 
                  AND CPR.GLBL_CMPY_CD  = ACCT.GLBL_CMPY_CD
                  AND CPR.DS_ACCT_NUM   = ACCT.DS_ACCT_NUM
                  AND ACCT.EZCANCELFLAG = '0'
          ) RELN
          <!-- 2017/10/16 QC#21996 add start -->
          WHERE
          <isNotNull property="locNum">
                  RELN.LOC_NUM = #locNum#
          </isNotNull>
          <isNull property="locNum">
                  RELN.LOC_NUM IS NULL
          </isNull>
          <isNotNull property="dsAcctNum">
              AND RELN.DS_ACCT_NUM = #dsAcctNum#
          </isNotNull>
          <!-- 2017/10/16 QC#21996 add end -->
          ORDER BY DS_CTAC_PSN_RELN_PK
        )
    WHERE
        ROWNUM &lt;= #rowNum#
  </statement>
  <resultMap id="result.getRelatedAccount" class="NMAL6750_ASMsg">
    <result property="dsCtacPsnRelnPk_A1" column="DS_CTAC_PSN_RELN_PK"  javaType="EZDSBigDecimalItem" />
    <result property="dsAcctNm_A1"        column="DS_ACCT_NM"           javaType="EZDSStringItem" />
    <result property="dsAcctNum_A1"       column="DS_ACCT_NUM"          javaType="EZDSStringItem" />
    <result property="locNum_A1"          column="LOC_NUM"              javaType="EZDSStringItem" />
    <result property="firstLineAddr_A1"   column="FIRST_LINE_ADDR"      javaType="EZDSStringItem" />
    <result property="scdLineAddr_A1"     column="SCD_LINE_ADDR"        javaType="EZDSStringItem" />
    <result property="ctyAddr_A1"         column="CTY_ADDR"             javaType="EZDSStringItem" />
    <result property="stCd_A1"            column="ST_CD"                javaType="EZDSStringItem" />
    <result property="postCd_A1"          column="POST_CD"              javaType="EZDSStringItem" />
    <result property="effFromDt_A1"       column="EFF_FROM_DT"          javaType="EZDSStringItem" />
    <result property="effThruDt_A1"       column="EFF_THRU_DT"          javaType="EZDSStringItem" />
    <result property="ezUpTime_A1"        column="EZUPTIME"             javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_A1"    column="EZUPTIMEZONE"         javaType="EZDSStringItem" />
    <!-- Add Start 2016/11/07 M.Ohno S21_NA#2680 -->
    <result property="xxRecHistCratTs_A1"       column="XX_REC_HIST_CRAT_TS"     javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm_A1"     column="XX_REC_HIST_CRAT_BY_NM"  javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs_A1"        column="XX_REC_HIST_UPD_TS"      javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm_A1"      column="XX_REC_HIST_UPD_BY_NM"   javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm_A1"        column="XX_REC_HIST_TBL_NM"      javaType="EZDSStringItem" />
    <!-- Add End   2016/11/07 M.Ohno S21_NA#2680 -->
  </resultMap>

  <statement id="getContactPointList" parameterClass="Map" resultMap="result.getContactPoint">
    SELECT
        *
    FROM
        (
            SELECT
                DCP.DS_CTAC_PNT_PK       AS DS_CTAC_PNT_PK
              , DCP.DS_CTAC_PNT_TP_CD    AS DS_CTAC_PNT_TP_CD
              , DCPT.DS_CTAC_PNT_TP_NM   AS DS_CTAC_PNT_TP_NM
              , DCP.DS_CTAC_PNT_VAL_TXT  AS DS_CTAC_PNT_VAL_TXT
              , DCP.DS_CTAC_PSN_EXTN_NUM AS DS_CTAC_PSN_EXTN_NUM
              , DCP.DS_OPS_OUT_FLG       AS DS_OPS_OUT_FLG
              , DCP.DS_CTAC_PNT_ACTV_FLG AS DS_CTAC_PNT_ACTV_FLG 
              , DCP.EZUPTIME
              , DCP.EZUPTIMEZONE
              <!-- Add Start 2016/11/07 M.Ohno S21_NA#2680 -->
              , DCP.EZINTIME             AS XX_REC_HIST_CRAT_TS
              , DCP.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
              , DCP.EZUPTIME             AS XX_REC_HIST_UPD_TS
              , DCP.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
              , 'DS_CTAC_PNT'            AS XX_REC_HIST_TBL_NM
              <!-- Add End   2016/11/07 M.Ohno S21_NA#2680 -->
              ,DCP.CTAC_PNT_FMT_TXT      AS CTAC_PNT_FMT_TXT    <!-- QC#8598 add -->
            FROM
                DS_CTAC_PNT DCP
              , DS_CTAC_PNT_TP DCPT 
            WHERE
                  DCP.GLBL_CMPY_CD = #glblCmpyCd#
              AND DCP.EZCANCELFLAG = '0' 
              AND DCP.CTAC_PSN_PK = #ctacPsnPk#
              AND DCP.GLBL_CMPY_CD = DCPT.GLBL_CMPY_CD 
              AND DCPT.EZCANCELFLAG = '0' 
              AND DCP.DS_CTAC_PNT_TP_CD = DCPT.DS_CTAC_PNT_TP_CD
            ORDER BY DCPT.DS_CTAC_PNT_TP_SORT_NUM
                    , DCP.DS_CTAC_PNT_ACTV_FLG DESC
                    , DCP.DS_OPS_OUT_FLG
        )
    WHERE
        ROWNUM &lt;= #rowNum#
  </statement>
  <resultMap id="result.getContactPoint" class="NMAL6750_BSMsg">
    <result property="dsCtacPntPk_B1"       column="DS_CTAC_PNT_PK"       javaType="EZDSBigDecimalItem" />
    <result property="dsCtacPntTpCd_B1"     column="DS_CTAC_PNT_TP_CD"    javaType="EZDSStringItem" />
    <result property="dsCtacPntValTxt_B1"   column="DS_CTAC_PNT_VAL_TXT"  javaType="EZDSStringItem" />
    <result property="dsCtacPsnExtnNum_B1"  column="DS_CTAC_PSN_EXTN_NUM" javaType="EZDSStringItem" />
    <result property="dsOpsOutFlg_B1"       column="DS_OPS_OUT_FLG"       javaType="EZDSStringItem" />
    <result property="dsCtacPntActvFlg_B1"  column="DS_CTAC_PNT_ACTV_FLG" javaType="EZDSStringItem" />
    <result property="ezUpTime_B1"          column="EZUPTIME"             javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_B1"      column="EZUPTIMEZONE"         javaType="EZDSStringItem" />
    <!-- Add Start 2016/11/07 M.Ohno S21_NA#2680 -->
    <result property="xxRecHistCratTs_B1"       column="XX_REC_HIST_CRAT_TS"     javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm_B1"     column="XX_REC_HIST_CRAT_BY_NM"  javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs_B1"        column="XX_REC_HIST_UPD_TS"      javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm_B1"      column="XX_REC_HIST_UPD_BY_NM"   javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm_B1"        column="XX_REC_HIST_TBL_NM"      javaType="EZDSStringItem" />
    <!-- Add End   2016/11/07 M.Ohno S21_NA#2680 -->
    <result property="ctacPntFmtTxt_B1"        column="CTAC_PNT_FMT_TXT"      javaType="EZDSStringItem" />
  </resultMap>
  
  <statement id="getOtherPrimCtac" parameterClass="Map" resultClass="Map">
    SELECT
        *
    FROM
        (
        SELECT 
            R.DS_CTAC_PSN_RELN_PK
          , R.CTAC_PSN_PK
          , R.DS_ACCT_NUM
          , R.LOC_NUM
          , R.EFF_FROM_DT
          , R.EFF_THRU_DT
          , R.DS_PRIM_LOC_FLG
        FROM 
            DS_CTAC_PSN_RELN R
        WHERE
              R.GLBL_CMPY_CD    = #glblCmpyCd#
    <isNull property="locNum">
          AND R.DS_ACCT_NUM   = #dsAcctNum# 
    </isNull>
    <isNotNull property="locNum">
          AND R.LOC_NUM   = #locNum# 
    </isNotNull>
          AND R.DS_PRIM_LOC_FLG = #dsPrimLocFlg# 
    <isNotNull property="ctacPsnPk">
          AND R.CTAC_PSN_PK != #ctacPsnPk#
    </isNotNull>
          AND R.EZCANCELFLAG    = '0' 
          AND (
                  (      R.EFF_FROM_DT                  &lt;= #effFromDt#
                     AND NVL(R.EFF_THRU_DT, '99991231') &gt;= #effFromDt#
                   )
        <isNotNull property="effThruDt">
              OR
                  (      R.EFF_FROM_DT                  &lt;= #effThruDt#
                     AND NVL(R.EFF_THRU_DT, '99991231') &gt;= #effThruDt#
                  )
        </isNotNull>
              )
        )
    WHERE
        ROWNUM = #rowNum#    
  </statement>
  
  <statement id="getDeptList" parameterClass="Map" resultClass="Map">
    SELECT
        *
    FROM
        (
        SELECT
              D.DS_CTAC_PSN_DEPT_CD
            , D.DS_CTAC_PSN_DEPT_NM
        FROM 
            DS_CTAC_PSN_DEPT D
        WHERE
              D.GLBL_CMPY_CD    = #glblCmpyCd#
          AND D.EZCANCELFLAG    = '0' 
        )
    WHERE
        ROWNUM &lt;= #rowNum#    
  </statement>
  
  <statement id="getAcctNm" parameterClass="Map" resultClass="Map">
    SELECT 
        STC.DS_ACCT_NM AS DS_ACCT_NM
    FROM
        SELL_TO_CUST STC
    WHERE 
          STC.GLBL_CMPY_CD = #glblCmpyCd#
      AND STC.EZCANCELFLAG = '0'
      AND STC.SELL_TO_CUST_CD = #dsAcctNum#

    UNION ALL

    SELECT 
        PROS.DS_ACCT_NM AS DS_ACCT_NM
    FROM
        DS_ACCT_PROS PROS
    WHERE 
          PROS.GLBL_CMPY_CD = #glblCmpyCd#
      AND PROS.EZCANCELFLAG = '0'
      AND PROS.DS_ACCT_NUM = #dsAcctNum#

  </statement>

    <statement id="getContactRelationList" parameterClass="Map" resultMap="result.getContactRelation">
        SELECT
             CT.CTAC_TP_CD
            ,CT.CTAC_TP_DESC_TXT
          <isNotNull property="ctacPsnPk">
            ,DECODE(DCPR.DS_CTAC_PSN_RELN_PK, NULL, #flgOff#, #flgOn#)   AS XX_CHK_BOX
          </isNotNull>
          <isNull property="ctacPsnPk">
            ,#flgOff# AS XX_CHK_BOX
          </isNull>
        FROM
             CTAC_TP            CT
          <isNotNull property="ctacPsnPk">
            ,DS_CTAC_PSN_RELN   DCPR
          </isNotNull>
        WHERE
                CT.GLBL_CMPY_CD         = #glblCmpyCd#
            AND CT.ACTV_FLG             = 'Y'
            AND CT.EZCANCELFLAG         = '0'
            AND CT.MSTR_VIEW_AVAL_FLG   = 'Y' <!-- Sol#454 ADD -->
            <!-- START 2017/12/18 Hd.Sugawara [QC#22286,ADD] -->
            AND CT.SCR_VIEW_AVAL_FLG    = 'Y'
            <!-- END 2017/12/18 Hd.Sugawara [QC#22286,ADD] -->
          <isNotNull property="ctacPsnPk">
                AND CT.GLBL_CMPY_CD         = DCPR.GLBL_CMPY_CD(+)
                AND CT.CTAC_TP_CD           = DCPR.CTAC_TP_CD(+)
                AND DCPR.CTAC_PSN_PK(+)     = #ctacPsnPk#
              <isNotNull property="dsAcctNum">
                AND DCPR.DS_ACCT_NUM(+)     = #dsAcctNum#
              </isNotNull>
              <isNotNull property="locNum">
                AND DCPR.LOC_NUM(+)         = #locNum#
              </isNotNull>
                AND DCPR.EZCANCELFLAG(+)    = '0'
          </isNotNull>
        ORDER BY CTAC_TP_CD
    </statement>

    <statement id="searchContactByName" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            CP.CTAC_PSN_PK 
        FROM
            DS_CTAC_PSN_RELN DCPR, CTAC_PSN CP 
        WHERE
                DCPR.GLBL_CMPY_CD = #glblCmpyCd# 
            AND DCPR.EZCANCELFLAG = '0' 

            AND DCPR.GLBL_CMPY_CD = CP.GLBL_CMPY_CD 
            AND DCPR.CTAC_PSN_PK = CP.CTAC_PSN_PK 
            AND CP.EZCANCELFLAG = '0' 

            AND UPPER(CP.CTAC_PSN_FIRST_NM) = UPPER(#ctacPsnFirstNm#)
            AND UPPER(CP.CTAC_PSN_LAST_NM) = UPPER(#ctacPsnLastNm#)

        <isNull property="locNum">
            AND DCPR.DS_ACCT_NUM = #dsAcctNum#
        </isNull>
        <isNotNull property="locNum">
            AND ( DCPR.LOC_NUM = #locNum#
                OR 
                DCPR.DS_ACCT_NUM = 
                    ( 
                        SELECT
                            MAX(AL.DS_ACCT_NUM)
                        FROM
                            ACCT_LOC AL 
                        WHERE
                            AL.GLBL_CMPY_CD = #glblCmpyCd# 
                        AND AL.EZCANCELFLAG = '0' 
                        AND AL.LOC_NUM = #locNum#
                        AND AL.EFF_FROM_DT   &lt;= #slsDt#
                        AND NVL(AL.EFF_THRU_DT, #maxEffThruDt#) &gt;= #slsDt#
                     <!-- 2019/06/05 QC#50651 Add Start -->
                        AND AL.RGTN_STS_CD   = #rgtnStsCd#
                     <!-- 2019/06/05 QC#50651 Add End -->
                    )
                )
            </isNotNull>
        UNION

        SELECT
            CP.CTAC_PSN_PK 
        FROM
            DS_CTAC_PSN_RELN DCPR, CTAC_PSN CP 
        WHERE
                DCPR.GLBL_CMPY_CD = #glblCmpyCd# 
            AND DCPR.EZCANCELFLAG = '0' 

            AND DCPR.GLBL_CMPY_CD = CP.GLBL_CMPY_CD 
            AND DCPR.CTAC_PSN_PK = CP.CTAC_PSN_PK 
            AND CP.EZCANCELFLAG = '0' 

            AND UPPER(CP.CTAC_PSN_FIRST_NM) = UPPER(#ctacPsnFirstNm#)
            AND UPPER(CP.CTAC_PSN_LAST_NM) = UPPER(#ctacPsnLastNm#)

            AND DCPR.LOC_NUM IN ( 
                    SELECT
                        AL.LOC_NUM 
                    FROM
                        ACCT_LOC AL 
                    WHERE
                            AL.GLBL_CMPY_CD = #glblCmpyCd# 
                        AND AL.EZCANCELFLAG = '0' 
                        AND AL.EFF_FROM_DT   &lt;= #slsDt#
                        AND NVL(AL.EFF_THRU_DT, #maxEffThruDt#) &gt;= #slsDt#
                     <!-- 2019/06/05 QC#50651 Add Start -->
                        AND AL.RGTN_STS_CD   = #rgtnStsCd#
                     <!-- 2019/06/05 QC#50651 Add End -->
                    <isNull property="locNum">
                        AND AL.DS_ACCT_NUM = #dsAcctNum#
                    </isNull>
                    <isNotNull property="locNum">
                        AND AL.DS_ACCT_NUM = ( 
                            SELECT
                                AL.DS_ACCT_NUM 
                            FROM
                                ACCT_LOC AL 
                            WHERE
                                    AL.GLBL_CMPY_CD = #glblCmpyCd# 
                                AND AL.EZCANCELFLAG = '0' 
                                AND AL.LOC_NUM = #locNum#
                     <!-- 2019/06/05 QC#50651 Add Start -->
                                AND AL.EFF_FROM_DT   &lt;= #slsDt#
                                AND NVL(AL.EFF_THRU_DT, #maxEffThruDt#) &gt;= #slsDt#
                                AND AL.RGTN_STS_CD   = #rgtnStsCd#
                     <!-- 2019/06/05 QC#50651 Add End -->
                        )
                    </isNotNull>
                )
    </statement>

    <statement id="getMandatoryContactPointType" parameterClass="Map" resultClass="String">
        SELECT DISTINCT
            CTPMD.DS_CTAC_PNT_TP_CD
        FROM
            CTAC_TP_PNT_MND_DFN     CTPMD
        WHERE
                CTPMD.GLBL_CMPY_CD      = #glblCmpyCd#
            AND CTPMD.CTAC_TP_CD        IN
            <iterate property="ctacTpCdList" var="ctacTpCd[]" open="(" close=" )" conjunction=",">
                #ctacTpCd[]#
            </iterate>
        ORDER BY DS_CTAC_PNT_TP_CD
    </statement>

    <statement id="getContactRelationPK" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            DCPR.DS_CTAC_PSN_RELN_PK
        FROM
            DS_CTAC_PSN_RELN   DCPR
        WHERE
                DCPR.GLBL_CMPY_CD       = #glblCmpyCd#
            AND DCPR.CTAC_TP_CD         = #ctacTpCd#
          <isNotNull property="dsAcctNum">
            AND DCPR.DS_ACCT_NUM        = #dsAcctNum#
          </isNotNull>
          <isNotNull property="locNum">
            AND DCPR.LOC_NUM            = #locNum#
          </isNotNull>
            AND DCPR.CTAC_PSN_PK        = #ctacPsnPk#
            AND DCPR.EZCANCELFLAG       = '0'
        ORDER BY CTAC_TP_CD
    </statement>


    <statement id="getAutoFormatContactTypeList" parameterClass="Map" resultMap="result.getAutoFormatContactType">
        SELECT
               DCPT.DS_CTAC_PNT_TP_CD
             , DCPT.AUTO_FMT_FLG
        FROM
             DS_CTAC_PNT_TP     DCPT
        WHERE
                DCPT.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DCPT.AUTO_FMT_FLG        = #autoFmtFlg#
            AND DCPT.EZCANCELFLAG        = '0'
    </statement>

    <resultMap id="result.getContactRelation" class="NMAL6750_RSMsg">
        <result property="ctacTpCd_R1"        column="CTAC_TP_CD"           javaType="EZDSStringItem" />
        <result property="ctacTpDescTxt_R1"   column="CTAC_TP_DESC_TXT"     javaType="EZDSStringItem" />
        <result property="xxChkBox_R1"        column="XX_CHK_BOX"           javaType="EZDSStringItem" />
    </resultMap>
    <resultMap id="result.getAutoFormatContactType" class="NMAL6750_TSMsg">
        <result property="dsCtacPntTpCd_T1"   column="DS_CTAC_PNT_TP_CD"    javaType="EZDSStringItem" />
        <result property="autoFmtFlg_T1"      column="AUTO_FMT_FLG"         javaType="EZDSStringItem" />
    </resultMap>

     <!-- Add Start 2018/07/31 H.Tomimatsu S21_NA#26565 -->
    <statement id="isExistContactRelation" parameterClass="Map" resultClass="Integer">
        SELECT
             COUNT(DCPR.GLBL_CMPY_CD)
        FROM
             DS_CTAC_PSN_RELN DCPR
        WHERE
                 DCPR.GLBL_CMPY_CD   = #glblCmpyCd#
             AND DCPR.CTAC_PSN_PK    = #ctacPsnPk#
             AND DCPR.EZCANCELFLAG   = '0'
             <isNotNull property="locNum">
             AND DCPR.LOC_NUM        = #locNum#
             </isNotNull>
             <isNull property="locNum">
             AND DCPR.DS_ACCT_NUM    = #dsAcctNum#
             </isNull>
    </statement>
     <!-- Add End 2018/07/31 H.Tomimatsu S21_NA#26565 -->

</sqlMap>
