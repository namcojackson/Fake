<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NMAL6730Query">
  <typeAlias alias="NMAL6730SMsg"     type="business.blap.NMAL6730.NMAL6730SMsg"/>
  <typeAlias alias="NMAL6730_ASMsg"   type="business.blap.NMAL6730.NMAL6730_ASMsg"/>
  <typeAlias alias="NMAL6730_KSMsg"   type="business.blap.NMAL6730.NMAL6730_KSMsg"/>
  <typeAlias alias="PMT_TERM_CASH_DISCTMsg"            type="business.db.PMT_TERM_CASH_DISCTMsg"/>

    
  <statement id="getBillToCustInfoHeader" parameterClass="Map" resultMap="result.getBillToCustInfoHeader">
      SELECT
              BTC.GLBL_CMPY_CD      AS GLBL_CMPY_CD
             ,ACCT.COA_CH_CD        AS COA_CH_CD_ACCT
             ,ACCT.COA_AFFL_CD      AS COA_AFFL_CD_ACCT
             ,ACCT.DS_ACCT_NUM      AS DS_ACCT_NUM
             ,ACCT.DS_ACCT_NM       AS DS_ACCT_NM
             ,BTC.FIRST_LINE_ADDR || ' ' ||
              BTC.SCD_LINE_ADDR   || ' ' ||
              BTC.THIRD_LINE_ADDR || ' ' ||
              BTC.FRTH_LINE_ADDR    AS XX_ALL_LINE_ADDR
             ,BTC.FIRST_LINE_ADDR   AS FIRST_LINE_ADDR
             ,BTC.SCD_LINE_ADDR     AS SCD_LINE_ADDR
             ,BTC.THIRD_LINE_ADDR   AS THIRD_LINE_ADDR
             ,BTC.FRTH_LINE_ADDR    AS FRTH_LINE_ADDR
             ,BTC.CTY_ADDR          AS CTY_ADDR
             ,BTC.ST_CD             AS ST_CD
             ,BTC.POST_CD           AS POST_CD
             ,BTC.LOC_NUM           AS LOC_NUM
             ,BTC.BILL_TO_CUST_CD   AS BILL_TO_CUST_CD
             ,BTC.BILL_TO_CUST_PK   AS BILL_TO_CUST_PK
             ,BTC.COA_CH_CD         AS COA_CH_CD
             ,BTC.COA_AFFL_CD       AS COA_AFFL_CD
             <!-- QC#6382 -->
             ,CH.COA_CH_NM          AS COA_CH_NM
             ,AFFL.COA_AFFL_NM      AS COA_AFFL_NM
             ,BTC.COA_CMPY_CD      AS COA_CMPY_CD
             ,BTC.COA_BR_CD         AS COA_BR_CD
             ,BTC.COA_CC_CD         AS COA_CC_CD
             ,BTC.COA_ACCT_CD       AS COA_ACCT_CD
             ,BTC.COA_PROD_CD       AS COA_PROD_CD
             ,BTC.COA_PROJ_CD       AS COA_PROJ_CD
             ,BTC.COA_EXTN_CD       AS COA_EXTN_CD
             ,BTC.EZUPTIME          AS EZUPTIME
             ,BTC.EZUPTIMEZONE      AS EZUPTIMEZONE
             <!-- 
             ,DBTC.EZUPTIME          AS DBTC_EZUPTIME
             ,DBTC.EZUPTIMEZONE      AS DBTC_EZUPTIMEZONE  -->
             ,BTC.RGTN_STS_CD        AS RGTN_STS_CD
             <!-- Add Start 2016/11/11 M.Ohno S21_NA#2680 -->
             , BTC.EZINTIME             AS XX_REC_HIST_CRAT_TS
             , BTC.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
             , BTC.EZUPTIME             AS XX_REC_HIST_UPD_TS
             , BTC.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
             , 'BILL_TO_CUST'           AS XX_REC_HIST_TBL_NM
             <!-- Add End   2016/11/11 M.Ohno S21_NA#2680 -->

      FROM
               (
               SELECT 
                     CUST.GLBL_CMPY_CD
                   , CUST.EZCANCELFLAG
                   , CUST.SELL_TO_CUST_CD AS DS_ACCT_NUM
                   , CUST.COA_CH_CD 
                   , CUST.COA_AFFL_CD
                   , CUST.DS_ACCT_NM
               FROM 
                   SELL_TO_CUST CUST
               UNION ALL
               SELECT 
                     PROS.GLBL_CMPY_CD
                   , PROS.EZCANCELFLAG
                   , PROS.DS_ACCT_NUM
                   , PROS.COA_CH_CD
                   , PROS.COA_AFFL_CD
                   , PROS.DS_ACCT_NM

               FROM 
                   DS_ACCT_PROS PROS
               ) ACCT
             , BILL_TO_CUST BTC
             , COA_CH CH
             , COA_AFFL AFFL
      WHERE
              BTC.GLBL_CMPY_CD        = #glblCmpyCd#
      AND     BTC.BILL_TO_CUST_CD     = #billToCustCd#
      AND     BTC.EZCANCELFLAG        = '0'

      AND     BTC.GLBL_CMPY_CD        = ACCT.GLBL_CMPY_CD
      AND     BTC.SELL_TO_CUST_CD     = ACCT.DS_ACCT_NUM
      AND     ACCT.EZCANCELFLAG       = '0'
      <!-- QC#6382 -->
      AND     BTC.GLBL_CMPY_CD        = CH.GLBL_CMPY_CD(+)
      AND     BTC.COA_CH_CD           = CH.COA_CH_CD(+)
      AND     CH.EZCANCELFLAG(+)      = '0'

      AND     BTC.GLBL_CMPY_CD        = AFFL.GLBL_CMPY_CD(+)
      AND     BTC.COA_AFFL_CD         = AFFL.COA_AFFL_CD(+)
      AND     AFFL.EZCANCELFLAG(+)    = '0'

      AND     ROWNUM                  = 1
  </statement> 
  <resultMap id="result.getBillToCustInfoHeader" class="NMAL6730SMsg">
    <result property="glblCmpyCd_H1"       column="GLBL_CMPY_CD"       javaType="EZDSStringItem" />
    <result property="coaChCd_BK"          column="COA_CH_CD_ACCT"     javaType="EZDSStringItem" />
    <!-- QC#9448
    <result property="coaAfflCd_BK"        column="COA_AFFL_CD_ACCT"   javaType="EZDSStringItem" />
     -->
    <result property="dsAcctNum_H1"        column="DS_ACCT_NUM"        javaType="EZDSStringItem" />
    <result property="dsAcctNm_H1"         column="DS_ACCT_NM"         javaType="EZDSStringItem" />
    <result property="xxAllLineAddr_H1"    column="XX_ALL_LINE_ADDR"   javaType="EZDSStringItem" />
    <result property="firstLineAddr_H1"    column="FIRST_LINE_ADDR"    javaType="EZDSStringItem" />
    <result property="scdLineAddr_H1"      column="SCD_LINE_ADDR"      javaType="EZDSStringItem" />
    <result property="thirdLineAddr_H1"    column="THIRD_LINE_ADDR"    javaType="EZDSStringItem" />
    <result property="frthLineAddr_H1"     column="FRTH_LINE_ADDR"     javaType="EZDSStringItem" />
    <result property="ctyAddr_H1"          column="CTY_ADDR"           javaType="EZDSStringItem" />
    <result property="stCd_H1"             column="ST_CD"              javaType="EZDSStringItem" />
    <result property="postCd_H1"           column="POST_CD"            javaType="EZDSStringItem" />
    <result property="locNum_H1"           column="LOC_NUM"            javaType="EZDSStringItem" />
    <result property="billToCustCd_H1"     column="BILL_TO_CUST_CD"    javaType="EZDSStringItem" />
    <result property="billToCustPk_H1"     column="BILL_TO_CUST_PK"    javaType="EZDSBigDecimalItem" />
    <result property="coaChCd_H1"          column="COA_CH_CD"          javaType="EZDSStringItem" />
    <result property="coaAfflCd_H1"        column="COA_AFFL_CD"        javaType="EZDSStringItem" />
    <!-- QC#6382 -->
    <result property="coaChNm_H1"          column="COA_CH_NM"          javaType="EZDSStringItem" />
    <!-- QC#9448
    <result property="coaAfflNm_H1"        column="COA_AFFL_NM"        javaType="EZDSStringItem" />
    -->
    <result property="coaCmpyCd_H1"        column="COA_CMPY_CD"        javaType="EZDSStringItem" />
    <result property="coaBrCd_H1"          column="COA_BR_CD"          javaType="EZDSStringItem" />
    <result property="coaCcCd_H1"          column="COA_CC_CD"          javaType="EZDSStringItem" />
    <result property="coaAcctCd_H1"        column="COA_ACCT_CD"        javaType="EZDSStringItem" />
    <result property="coaProdCd_H1"        column="COA_PROD_CD"        javaType="EZDSStringItem" />
    <result property="coaProjCd_H1"        column="COA_PROJ_CD"        javaType="EZDSStringItem" />
    <result property="coaExtnCd_H1"        column="COA_EXTN_CD"        javaType="EZDSStringItem" />
    <result property="ezUpTime_H1"         column="EZUPTIME"           javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_H1"     column="EZUPTIMEZONE"       javaType="EZDSStringItem" />
    <!--  
    <result property="ezUpTime_H2"         column="DBTC_EZUPTIME"      javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_H2"     column="DBTC_EZUPTIMEZONE"  javaType="EZDSStringItem" />-->
    <result property="rgtnStsCd_H1"        column="RGTN_STS_CD"        javaType="EZDSStringItem" />
    <!-- Add Start 2016/11/11 M.Ohno S21_NA#2680 -->
    <result property="xxRecHistCratTs"    column="XX_REC_HIST_CRAT_TS"     javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm"  column="XX_REC_HIST_CRAT_BY_NM"  javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs"     column="XX_REC_HIST_UPD_TS"      javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm"   column="XX_REC_HIST_UPD_BY_NM"   javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm"     column="XX_REC_HIST_TBL_NM"      javaType="EZDSStringItem" />
    <!-- Add End   2016/11/11 M.Ohno S21_NA#2680 -->
  </resultMap>

  <statement id="getFinancialInfo" parameterClass="Map" resultMap="result.getFinancialInfo">
        SELECT
            CCP.CCY_CD                           AS CCY_CD
          , CCP.CUST_CR_RTG_CD                   AS CUST_CR_RTG_CD
          , CCP.CR_LIMIT_AMT                     AS CR_LIMIT_AMT
          , CCP.CR_CHK_REQ_TP_CD                 AS CR_CHK_REQ_TP_CD
          , CCP.CR_RISK_CLS_CD                   AS CR_RISK_CLS_CD
          , CCP.CONTR_CR_RISK_CLS_CD             AS CONTR_CR_RISK_CLS_CD <!-- Add 2018/02/02 QC#22095 -->
          , CCP.PMT_TERM_CASH_DISC_CD            AS PMT_TERM_CASH_DISC_CD
          , CCP.OVRD_PMT_TERM_FLG                AS OVRD_PMT_TERM_FLG
          , CCP.CASH_OR_CC_REQ_FLG               AS CASH_OR_CC_REQ_FLG
          <!-- QC#4324 -->
          , CCP.CUST_HARD_HLD_FLG                AS CUST_HARD_HLD_FLG
          , BTC.REM_ID                           AS REM_ID
          , BTC.AR_STMT_FLG                      AS AR_STMT_FLG
          
          , BTC.SEND_CR_BAL_STMT_FLG             AS SEND_CR_BAL_STMT_FLG
          
          , BTC.AR_STMT_ISS_DAY                  AS AR_STMT_ISS_DAY
          , BTC.DUN_FLG                          AS DUN_FLG
          , BTC.CLT_CUST_TP_CD                   AS CLT_CUST_TP_CD
          , TP.CLT_CUST_TP_NM                    AS CLT_CUST_TP_NM
          , PTFO.CLT_PTFO_CD                     AS CLT_PTFO_CD
          , PTFO.CLT_PTFO_NM                     AS CLT_PTFO_NM
          , BTC.DS_CLT_ACCT_STS_CD               AS DS_CLT_ACCT_STS_CD
          , BTC.LATE_FEE_FLG                     AS LATE_FEE_FLG
          , BTC.LATE_FEE_AMT                     AS LATE_FEE_AMT
          , BTC.DS_CUST_TAX_CD                   AS DS_CUST_TAX_CD
          , BTC.DS_CUST_TAX_CALC_CD              AS DS_CUST_TAX_CALC_CD
          , BTC.DS_TAX_EXEM_FLG                  AS DS_TAX_EXEM_FLG
          , BTC.DS_TAX_GRP_EXEM_CD               AS DS_TAX_GRP_EXEM_CD
          , BTC.DS_EXEM_EXPR_DT                  AS DS_EXEM_EXPR_DT
          , BTC.DS_TAX_PRNT_TP_CD                AS DS_TAX_PRNT_TP_CD
          <!-- Start 2023/1/17 S.Nakatani [QC#60811, ADD]-->
          , BTC.MLY_LATE_FEE_RATE                AS MLY_LATE_FEE_RATE
          <!-- End 2023/1/17 S.Nakatani [QC#60811, ADD]-->
          , CCP.EZUPTIME                         AS EZUPTIME
          , CCP.EZUPTIMEZONE                     AS EZUPTIMEZONE
          , ISS.AR_STMT_ISS_CYCLE_CD             AS AR_STMT_ISS_CYCLE_CD
          <!-- Add Start 2016/11/11 M.Ohno S21_NA#2680 -->
          , CCP.EZINTIME             AS XX_REC_HIST_CRAT_TS
          , CCP.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
          , CCP.EZUPTIME             AS XX_REC_HIST_UPD_TS
          , CCP.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
          , 'CUST_CR_PRFL'           AS XX_REC_HIST_TBL_NM
          <!-- Add End   2016/11/11 M.Ohno S21_NA#2680 -->
          ,CCP.AUTO_CASH_HRCH_CD                 AS AUTO_CASH_HRCH_CD
        FROM
            BILL_TO_CUST BTC
          , CUST_CR_PRFL CCP
          , CLT_CUST_TP TP
          , CLT_PTFO PTFO
          , AR_STMT_ISS_CYCLE ISS
        WHERE
             BTC.GLBL_CMPY_CD    = #glblCmpyCd#
        AND  BTC.EZCANCELFLAG    = '0'
        AND  BTC.BILL_TO_CUST_CD = #billToCustCd#
     
        AND BTC.GLBL_CMPY_CD     = CCP.GLBL_CMPY_CD (+)
        AND BTC.BILL_TO_CUST_PK  = CCP.BILL_TO_CUST_PK (+)
        AND CCP.EZCANCELFLAG (+) = '0'
    
        AND BTC.GLBL_CMPY_CD    = TP.GLBL_CMPY_CD (+)
        AND BTC.CLT_CUST_TP_CD  = TP.CLT_CUST_TP_CD (+)
        AND TP.EZCANCELFLAG (+) = '0'
    
        AND BTC.GLBL_CMPY_CD      = PTFO.GLBL_CMPY_CD (+)
        AND BTC.CLT_PTFO_PK       = PTFO.CLT_PTFO_PK (+)
        AND PTFO.EZCANCELFLAG (+) = '0'
        
        AND BTC.GLBL_CMPY_CD    = ISS.GLBL_CMPY_CD(+)
        AND BTC.AR_STMT_ISS_DAY = ISS.AR_STMT_ISS_DAY(+)
        AND ISS.EZCANCELFLAG(+) = '0' 

  </statement> 
  <resultMap id="result.getFinancialInfo" class="NMAL6730SMsg">
    <result property="ccyCd_P1"                         column="CCY_CD"                       javaType="EZDSStringItem" />
    <result property="custCrRtgCd_P1"                   column="CUST_CR_RTG_CD"               javaType="EZDSStringItem" />
    <result property="crLimitAmt_F1"                    column="CR_LIMIT_AMT"                 javaType="EZDSBigDecimalItem" />
    <result property="crChkReqTpCd_P1"                  column="CR_CHK_REQ_TP_CD"             javaType="EZDSStringItem" />
    <result property="crRiskClsCd_P1"                   column="CR_RISK_CLS_CD"               javaType="EZDSStringItem" />
    <result property="contrCrRiskClsCd_P1"              column="CONTR_CR_RISK_CLS_CD"         javaType="EZDSStringItem" />
    <result property="pmtTermCashDiscCd_P1"             column="PMT_TERM_CASH_DISC_CD"        javaType="EZDSStringItem" />
    <result property="ovrdPmtTermFlg_F1"                column="OVRD_PMT_TERM_FLG"            javaType="EZDSStringItem" />
    <result property="cashOrCcReqFlg_F1"                column="CASH_OR_CC_REQ_FLG"           javaType="EZDSStringItem" />
    <!-- QC#4324 -->
    <result property="custHardHldFlg_F1"                column="CUST_HARD_HLD_FLG"            javaType="EZDSStringItem" />
    <result property="remId_F1"                         column="REM_ID"                       javaType="EZDSStringItem" />
    <result property="arStmtFlg_F1"                     column="AR_STMT_FLG"                  javaType="EZDSStringItem" />
    
    <result property="sendCrBalStmtFlg_F1"              column="SEND_CR_BAL_STMT_FLG"         javaType="EZDSStringItem" />
    
    <result property="arStmtIssCycleCd_P1"              column="AR_STMT_ISS_CYCLE_CD"         javaType="EZDSStringItem" />
    <result property="cltCustTpCd_F1"                   column="CLT_CUST_TP_CD"               javaType="EZDSStringItem" />
    <result property="cltCustTpNm_F1"                   column="CLT_CUST_TP_NM"               javaType="EZDSStringItem" />
    <result property="cltPtfoCd_F1"                     column="CLT_PTFO_CD"                  javaType="EZDSStringItem" />
    <result property="cltPtfoNm_F1"                     column="CLT_PTFO_NM"                  javaType="EZDSStringItem" />
    <result property="dsCltAcctStsCd_P1"                column="DS_CLT_ACCT_STS_CD"           javaType="EZDSStringItem" />
    <result property="lateFeeFlg_F1"                    column="LATE_FEE_FLG"                 javaType="EZDSStringItem" />
    <result property="lateFeeAmt_F1"                    column="LATE_FEE_AMT"                 javaType="EZDSBigDecimalItem" />
    <!-- Start 2023/1/17 S.Nakatani [QC#60811, ADD]-->
    <result property="mlyLateFeeRate_F1"                column="MLY_LATE_FEE_RATE"            javaType="EZDSBigDecimalItem" />
    <!-- End 2023/1/17 S.Nakatani [QC#60811, ADD]-->
    <result property="dsTaxExemFlg_F1"                  column="DS_TAX_EXEM_FLG"              javaType="EZDSStringItem" />
    <result property="dsTaxGrpExemCd_P1"                column="DS_TAX_GRP_EXEM_CD"           javaType="EZDSStringItem" />
    <result property="dsExemExprDt_F1"                  column="DS_EXEM_EXPR_DT"              javaType="EZDSStringItem" />
    <result property="dsTaxPrntTpCd_P1"                 column="DS_TAX_PRNT_TP_CD"            javaType="EZDSStringItem" />
    <result property="ezUpTime_F1"                      column="EZUPTIME"                     javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_F1"                  column="EZUPTIMEZONE"                 javaType="EZDSStringItem" />
    <!-- Add Start 2016/11/11 M.Ohno S21_NA#2680 -->
    <result property="xxRecHistCratTs_F1"               column="XX_REC_HIST_CRAT_TS"          javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm_F1"             column="XX_REC_HIST_CRAT_BY_NM"       javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs_F1"                column="XX_REC_HIST_UPD_TS"           javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm_F1"              column="XX_REC_HIST_UPD_BY_NM"        javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm_F1"                column="XX_REC_HIST_TBL_NM"           javaType="EZDSStringItem" />
    <!-- Add End   2016/11/11 M.Ohno S21_NA#2680 -->
    <result property="autoCashHrchCd_P1"                column="AUTO_CASH_HRCH_CD"            javaType="EZDSStringItem" />
  </resultMap>

  <statement id="getInvoiceSourceList" parameterClass="Map" resultMap="result.getInvoiceSourceList">
     SELECT
            DCIR.DS_CUST_INV_RULE_PK     AS DS_CUST_INV_RULE_PK
            , DCIR.CUST_INV_SRC_CD	     AS CUST_INV_SRC_CD
            , DCIR.CUST_BLLG_TP_CD	     AS CUST_BLLG_TP_CD
            , DCIR.CUST_CONSL_TERM_CD    AS CUST_CONSL_TERM_CD	
            , DCIR.CUST_BLLG_VCLE_CD     AS CUST_BLLG_VCLE_CD	
            , DCIR.ITRL_RVW_PSN_CD	     AS ITRL_RVW_PSN_CD
            , DCIR.CTAC_PSN_PK	         AS CTAC_PSN_PK
            , DCIR.CUST_EML_MSG_TXT	     AS CUST_EML_MSG_TXT
            , DCIR.DEF_INV_GRP_CD	     AS DEF_INV_GRP_CD
            , DCIR.INV_GRP_NUM	         AS INV_GRP_NUM
            , DCIR.EZUPTIME	             AS EZUPTIME
            , DCIR.EZUPTIMEZONE	         AS EZUPTIMEZONE
            , BTC.BILL_TO_CUST_CD
            , (SELECT SP.PSN_FIRST_NM || ' ' || SP.PSN_LAST_NM
                FROM S21_PSN SP
               WHERE DCIR.GLBL_CMPY_CD    = SP.GLBL_CMPY_CD
                 AND DCIR.ITRL_RVW_PSN_CD = SP.PSN_CD
                 AND SP.EZCANCELFLAG      = '0'
              ) AS XX_PSN_NM_A1
            , (SELECT CP.CTAC_PSN_FIRST_NM || ' ' || CP.CTAC_PSN_LAST_NM
                FROM CTAC_PSN CP
               WHERE DCIR.GLBL_CMPY_CD    = CP.GLBL_CMPY_CD
                 AND DCIR.CTAC_PSN_PK     = CP.CTAC_PSN_PK
                 AND CP.EZCANCELFLAG      = '0'
              ) AS XX_PSN_NM_A2
             <!-- Add Start 2016/11/11 M.Ohno S21_NA#2680 -->
             , DCIR.EZINTIME             AS XX_REC_HIST_CRAT_TS
             , DCIR.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
             , DCIR.EZUPTIME             AS XX_REC_HIST_UPD_TS
             , DCIR.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
             , 'DS_CUST_INV_RULE'        AS XX_REC_HIST_TBL_NM
             <!-- Add End   2016/11/11 M.Ohno S21_NA#2680 -->
        FROM
            BILL_TO_CUST BTC
          , DS_CUST_INV_RULE DCIR
        WHERE
             BTC.GLBL_CMPY_CD = #glblCmpyCd#
        AND  BTC.EZCANCELFLAG = '0'
        AND  BTC.BILL_TO_CUST_CD = #billToCustCd#
        <!-- 2018/10/12 QC#28420 H.Kumagai Mod Start -->
        AND  BTC.LOC_NUM = #locNum#
     
        AND BTC.GLBL_CMPY_CD = DCIR.GLBL_CMPY_CD
        <!-- AND BTC.BILL_TO_CUST_CD = DCIR.BILL_TO_CUST_CD -->
        AND BTC.LOC_NUM          = DCIR.LOC_NUM
        <!-- 2018/10/12 QC#28420 H.Kumagai Mod End -->
        AND DCIR.EZCANCELFLAG = '0'
  </statement> 
  <resultMap id="result.getInvoiceSourceList" class="NMAL6730_ASMsg">
    <result property="dsCustInvRulePk_A1" column="DS_CUST_INV_RULE_PK"  javaType="EZDSBigDecimalItem" />
    <result property="custInvSrcCd_P1"    column="CUST_INV_SRC_CD"      javaType="EZDSStringItem" />
    <result property="custBllgTpCd_P1"    column="CUST_BLLG_TP_CD"      javaType="EZDSStringItem" />
    <result property="custConslTermCd_P1" column="CUST_CONSL_TERM_CD"   javaType="EZDSStringItem" />
    <result property="custBllgVcleCd_P1"  column="CUST_BLLG_VCLE_CD"    javaType="EZDSStringItem" />
    <!-- QC#7781
    <result property="itrlRvwPsnCd_A1"    column="ITRL_RVW_PSN_CD"      javaType="EZDSStringItem" />
    <result property="xxPsnNm_A1"         column="XX_PSN_NM_A1"         javaType="EZDSStringItem" />
    <result property="ctacPsnPk_A1"       column="CTAC_PSN_PK"          javaType="EZDSBigDecimalItem" />
    <result property="xxPsnNm_A2"         column="XX_PSN_NM_A2"         javaType="EZDSStringItem" />
     -->
    <result property="custEmlMsgTxt_A1"   column="CUST_EML_MSG_TXT"     javaType="EZDSStringItem" />
    <result property="defInvGrpCd_P1"     column="DEF_INV_GRP_CD"       javaType="EZDSStringItem" />
    <result property="invGrpNum_A1"       column="INV_GRP_NUM"          javaType="EZDSStringItem" />
    <result property="ezUpTime_A1"        column="EZUPTIME"             javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_A1"    column="EZUPTIMEZONE"         javaType="EZDSStringItem" />
    <!-- Add Start 2016/11/11 M.Ohno S21_NA#2680 -->
    <result property="xxRecHistCratTs_A1"               column="XX_REC_HIST_CRAT_TS"          javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm_A1"             column="XX_REC_HIST_CRAT_BY_NM"       javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs_A1"                column="XX_REC_HIST_UPD_TS"           javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm_A1"              column="XX_REC_HIST_UPD_BY_NM"        javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm_A1"                column="XX_REC_HIST_TBL_NM"           javaType="EZDSStringItem" />
    <!-- Add End   2016/11/11 M.Ohno S21_NA#2680 -->
  </resultMap>

  <statement id="getBillingCycleInfo" parameterClass="Map" resultMap="result.getBillingCycleInfo">
    SELECT
        BTC.DEF_BASE_TP_CD    AS DEF_BASE_TP_CD
      , BTC.DEF_BASE_CYCLE_CD AS DEF_BASE_CYCLE_CD
      , BTC.DEF_USG_TP_CD     AS DEF_USG_TP_CD
      , BTC.DEF_USG_CYCLE_CD  AS DEF_USG_CYCLE_CD
      , BTC.DS_BILL_TGTR_FLG  AS DS_BILL_TGTR_FLG 
    FROM
         BILL_TO_CUST BTC 
    WHERE
          BTC.GLBL_CMPY_CD    = #glblCmpyCd#
      AND BTC.EZCANCELFLAG    = '0' 
      AND BTC.BILL_TO_CUST_PK = #billToCustPk#
  </statement> 
  <resultMap id="result.getBillingCycleInfo" class="NMAL6730SMsg">
    <result property="defBaseTpCd_P1"     column="DEF_BASE_TP_CD"     javaType="EZDSStringItem" />
    <result property="defBaseCycleCd_P1"  column="DEF_BASE_CYCLE_CD"  javaType="EZDSStringItem" />
    <result property="defUsgTpCd_P1"      column="DEF_USG_TP_CD"      javaType="EZDSStringItem" />
    <result property="defUsgCycleCd_P1"   column="DEF_USG_CYCLE_CD"   javaType="EZDSStringItem" />
    <result property="dsBillTgtrFlg_I1"   column="DS_BILL_TGTR_FLG"   javaType="EZDSStringItem" />
  </resultMap>

  <statement id="getTemplate" parameterClass="Map" resultMap="result.getTemplate">
        SELECT
            DCAT.CCY_CD
            , DCAT.CUST_CR_RTG_CD
            , DCAT.CR_LIMIT_AMT
            , DCAT.CR_CHK_REQ_TP_CD
            , DCAT.CR_RISK_CLS_CD
            , DCAT.CONTR_CR_RISK_CLS_CD <!-- 2018/02/01 [QC#22095,ADD] -->
            , DCAT.OVRD_PMT_TERM_FLG
            , DCAT.CASH_OR_CC_REQ_FLG
            <!-- QC#4324 -->
            , DCAT.CUST_HARD_HLD_FLG
            , DCAT.AR_STMT_FLG
            , DCAT.AR_STMT_ISS_DAY
            , DCAT.DUN_FLG
            , DCAT.CLT_CUST_TP_CD
            , DCAT.DS_CLT_ACCT_STS_CD
            , DCAT.LATE_FEE_FLG
            , DCAT.LATE_FEE_AMT
            , DCAT.DS_TAX_CD
            , DCAT.DS_CUST_TAX_CALC_CD
            , DCAT.DS_TAX_EXEM_FLG
            , DCAT.DS_EXEM_EXPR_DT
            , DCAT.DS_TAX_GRP_EXEM_CD
            , DCAT.DS_TAX_PRNT_TP_CD
            , DCAT.PMT_TERM_CASH_DISC_CD
            , DCAT.REM_ID
            , PTFO.CLT_PTFO_CD
            , CYCLE.AR_STMT_ISS_CYCLE_CD
            , DCAT.SEND_CR_BAL_STMT_FLG
        FROM
            DS_CUST_AR_TMPL DCAT 
            , CLT_PTFO PTFO
            , AR_STMT_ISS_CYCLE CYCLE
        WHERE
            DCAT.GLBL_CMPY_CD = #glblCmpyCd#
        AND DCAT.DS_CUST_AR_TMPL_NM = #dsCustArTmplNm# 
        AND DCAT.EZCANCELFLAG = '0'
        
        AND DCAT.GLBL_CMPY_CD = PTFO.GLBL_CMPY_CD(+)
        AND DCAT.CLT_PTFO_PK = PTFO.CLT_PTFO_PK(+)
        AND PTFO.EZCANCELFLAG(+) = '0'
        
        AND DCAT.GLBL_CMPY_CD = CYCLE.GLBL_CMPY_CD(+)
        AND DCAT.AR_STMT_ISS_DAY = CYCLE.AR_STMT_ISS_DAY(+)
        AND CYCLE.EZCANCELFLAG(+) = '0'
        
        AND ROWNUM = 1
  </statement> 
  <resultMap id="result.getTemplate" class="NMAL6730SMsg">
    <result property="ccyCd_P1"               column="CCY_CD"                 javaType="EZDSStringItem" />
    <result property="custCrRtgCd_P1"         column="CUST_CR_RTG_CD"         javaType="EZDSStringItem" />
    <result property="crLimitAmt_F1"          column="CR_LIMIT_AMT"           javaType="EZDSBigDecimalItem" />
    <result property="crChkReqTpCd_P1"        column="CR_CHK_REQ_TP_CD"       javaType="EZDSStringItem" />
    <result property="crRiskClsCd_P1"         column="CR_RISK_CLS_CD"         javaType="EZDSStringItem" />
    <result property="contrCrRiskClsCd_P1"    column="CONTR_CR_RISK_CLS_CD"   javaType="EZDSStringItem" />
    <result property="ovrdPmtTermFlg_F1"      column="OVRD_PMT_TERM_FLG"      javaType="EZDSStringItem" />
    <result property="cashOrCcReqFlg_F1"      column="CASH_OR_CC_REQ_FLG"     javaType="EZDSStringItem" />
    <result property="custHardHldFlg_F1"      column="CUST_HARD_HLD_FLG"      javaType="EZDSStringItem" />
    <result property="arStmtFlg_F1"           column="AR_STMT_FLG"            javaType="EZDSStringItem" />
    <result property="sendCrBalStmtFlg_F1"    column="SEND_CR_BAL_STMT_FLG"   javaType="EZDSStringItem" />
    <result property="arStmtIssCycleCd_P1"    column="AR_STMT_ISS_CYCLE_CD"   javaType="EZDSStringItem" />
    <result property="cltCustTpCd_F1"         column="CLT_CUST_TP_CD"         javaType="EZDSStringItem" />
    <result property="dsCltAcctStsCd_P1"      column="DS_CLT_ACCT_STS_CD"     javaType="EZDSStringItem" />
    <result property="lateFeeFlg_F1"          column="LATE_FEE_FLG"           javaType="EZDSStringItem" />
    <result property="lateFeeAmt_F1"          column="LATE_FEE_AMT"           javaType="EZDSBigDecimalItem" />
    <result property="dsTaxExemFlg_F1"        column="DS_TAX_EXEM_FLG"        javaType="EZDSStringItem" />
    <result property="dsExemExprDt_F1"        column="DS_EXEM_EXPR_DT"        javaType="EZDSStringItem" />
    <result property="dsTaxPrntTpCd_P1"       column="DS_TAX_PRNT_TP_CD"      javaType="EZDSStringItem" />
    <result property="pmtTermCashDiscCd_P1"   column="PMT_TERM_CASH_DISC_CD"  javaType="EZDSStringItem" />
    <result property="remId_F1"               column="REM_ID"                 javaType="EZDSStringItem" />
    <result property="cltPtfoCd_F1"           column="CLT_PTFO_CD"            javaType="EZDSStringItem" />
  </resultMap>
  <statement id="getCustConslTermCdList" parameterClass="Map" resultMap="result.PMT_TERM_CASH_DISCTMsg">
        SELECT 
            PMT_TERM_CASH_DISC_CD   AS PMT_TERM_CASH_DISC_CD
            , PMT_TERM_CASH_DISC_NM AS PMT_TERM_CASH_DISC_NM
        FROM
            PMT_TERM_CASH_DISC PMT
        WHERE
            PMT.GLBL_CMPY_CD = #glblCmpyCd#
        AND PMT.EZCANCELFLAG = '0'
        AND PMT.PMT_TERM_CONSL_FLG = 'Y'

  </statement>
  <resultMap id="result.PMT_TERM_CASH_DISCTMsg" class="PMT_TERM_CASH_DISCTMsg">
        <result property="pmtTermCashDiscCd"   column="PMT_TERM_CASH_DISC_CD"   javaType="EZDTStringItem"/>
        <result property="pmtTermCashDiscNm"   column="PMT_TERM_CASH_DISC_NM"   javaType="EZDTStringItem"/>
    </resultMap>
  <statement id="getCltPtfoNm" parameterClass="Map" resultClass="Map">
        SELECT P.CLT_PTFO_NM AS CLT_PTFO_NM
            , P.CLT_PTFO_PK  AS CLT_PTFO_PK
        FROM CLT_PTFO P
        WHERE P.GLBL_CMPY_CD = #glblCmpyCd#
        AND P.EZCANCELFLAG = '0'
        AND P.CLT_PTFO_CD = #cltPtfoCd#
  </statement>
  <statement id="countRemId" parameterClass="Map" resultClass="BigDecimal">
        SELECT COUNT(REM.REM_ID) FROM REM_TO REM
        WHERE REM.GLBL_CMPY_CD = #glblCmpyCd#
        AND REM.EZCANCELFLAG = '0'
        AND REM.REM_ID = #remId#
  </statement>
  <statement id="countContact" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
           COUNT(CTAC.CTAC_PSN_PK)
        FROM
            CTAC_PSN CTAC
            , DS_CTAC_PSN_RELN RELN
            , DS_CTAC_PNT PNT
            , DS_CTAC_PNT_TP TP
        WHERE
            CTAC.GLBL_CMPY_CD = #glblCmpyCd#
        AND CTAC.EZCANCELFLAG = '0'
        AND CTAC.CTAC_PSN_PK = #ctacPsnPk#
        AND CTAC.CTAC_PSN_ACTV_FLG = 'Y'

        AND CTAC.GLBL_CMPY_CD = RELN.GLBL_CMPY_CD
        AND CTAC.CTAC_PSN_PK = RELN.CTAC_PSN_PK
        AND RELN.EZCANCELFLAG = '0'
        <!-- QC#8527 -->
        AND (RELN.DS_ACCT_NUM = #dsAcctNum#
        OR  RELN.LOC_NUM = #locNum#)

        AND CTAC.GLBL_CMPY_CD = PNT.GLBL_CMPY_CD
        AND CTAC.CTAC_PSN_PK = PNT.CTAC_PSN_PK
        AND PNT.EZCANCELFLAG = '0'
        AND PNT.DS_CTAC_PNT_ACTV_FLG = 'Y'

        AND PNT.GLBL_CMPY_CD = TP.GLBL_CMPY_CD
        AND PNT.DS_CTAC_PNT_TP_CD = TP.DS_CTAC_PNT_TP_CD
        AND TP.EZCANCELFLAG = '0'
        AND TP.EML_FLG = 'Y'
    </statement>
    <statement id="countResource" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
           COUNT(PSN.PSN_CD)
        FROM
            S21_PSN PSN
        WHERE
            PSN.GLBL_CMPY_CD = #glblCmpyCd#
        AND PSN.EZCANCELFLAG = '0'
        AND PSN.PSN_CD = #psnCd#
        AND PSN.EML_ADDR IS NOT NULL
    </statement>
    
    <statement id="getDsAcctRefAttrb" parameterClass="Map" resultMap="result.getDsAcctRefAttrb">
        SELECT
                DARA.EZUPTIME
               ,DARA.EZUPTIMEZONE
               ,DARA.DS_ACCT_REF_ATTRB_PK
               ,DARA.BLLG_ATTRB_NM
               ,DARA.BLLG_ATTRB_VAL_TXT
               ,DARA.BLLG_ATTRB_ENBL_FLG
               ,DARA.BLLG_ATTRB_REQ_FLG
               ,DARA.CUST_EFF_LVL_CD
               ,'Control ' || DARA.DS_ACCT_REF_ATTRB_NUM AS DISP_REF_ATTRB_NUM
               ,DARA.DS_ACCT_REF_ATTRB_NUM
               <!-- Add Start 2016/11/11 M.Ohno S21_NA#2680 -->
               , DARA.EZINTIME             AS XX_REC_HIST_CRAT_TS
               , DARA.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
               , DARA.EZUPTIME             AS XX_REC_HIST_UPD_TS
               , DARA.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
               , 'DS_ACCT_REF_ATTRB'       AS XX_REC_HIST_TBL_NM
               <!-- Add End   2016/11/11 M.Ohno S21_NA#2680 -->
        FROM
                DS_ACCT_REF_ATTRB DARA
        WHERE
                DARA.GLBL_CMPY_CD         = #glblCmpyCd#
        AND     DARA.LOC_NUM              = #locNum#
        AND     DARA.EZCANCELFLAG         = '0'
        ORDER BY 
                DARA.DS_ACCT_REF_ATTRB_NUM
               ,DARA.DS_ACCT_REF_ATTRB_PK
    </statement>
    
  <resultMap id="result.getDsAcctRefAttrb" class="NMAL6730_KSMsg">
    <result property="ezUpTime_K1"            column="EZUPTIME"                javaType="EZDSStringItem" />
    <result property="ezUpTimeZone_K1"        column="EZUPTIMEZONE"            javaType="EZDSStringItem" />
    <result property="dsAcctRefAttrbPk_K1"    column="DS_ACCT_REF_ATTRB_PK"    javaType="EZDSBigDecimalItem" />
    <result property="bllgAttrbNm_K1"         column="BLLG_ATTRB_NM"           javaType="EZDSStringItem" />
    <result property="bllgAttrbValTxt_K1"     column="BLLG_ATTRB_VAL_TXT"      javaType="EZDSStringItem" />
    <result property="bllgAttrbEnblFlg_K1"    column="BLLG_ATTRB_ENBL_FLG"     javaType="EZDSStringItem" />
    <result property="bllgAttrbReqFlg_K1"     column="BLLG_ATTRB_REQ_FLG"      javaType="EZDSStringItem" />
    <result property="custEffLvlCd_K3"        column="CUST_EFF_LVL_CD"         javaType="EZDSStringItem" />
    <result property="xxCtlNm_K1"             column="DISP_REF_ATTRB_NUM"      javaType="EZDSStringItem" />
    <result property="dsAcctRefAttrbNum_K1"   column="DS_ACCT_REF_ATTRB_NUM"   javaType="EZDSStringItem" />
    <!-- Add Start 2016/11/11 M.Ohno S21_NA#2680 -->
    <result property="xxRecHistCratTs_K1"     column="XX_REC_HIST_CRAT_TS"     javaType="EZDSStringItem" />
    <result property="xxRecHistCratByNm_K1"   column="XX_REC_HIST_CRAT_BY_NM"  javaType="EZDSStringItem" />
    <result property="xxRecHistUpdTs_K1"      column="XX_REC_HIST_UPD_TS"      javaType="EZDSStringItem" />
    <result property="xxRecHistUpdByNm_K1"    column="XX_REC_HIST_UPD_BY_NM"   javaType="EZDSStringItem" />
    <result property="xxRecHistTblNm_K1"      column="XX_REC_HIST_TBL_NM"      javaType="EZDSStringItem" />
    <!-- Add End   2016/11/11 M.Ohno S21_NA#2680 -->
  </resultMap>
  
    <!-- QC#7781 -->
    <statement id="getInvoiceSourceListInternalReview" parameterClass="Map" resultClass="Map">
        SELECT 
            R.PSN_CD
           ,R.DS_CUST_INV_RULE_RCPNT_PK
        FROM
            DS_CUST_INV_RULE_RCPNT R
        WHERE
            R.GLBL_CMPY_CD = #glblCmpyCd#
        AND R.EZCANCELFLAG = '0'
        AND R.DS_CUST_INV_RULE_PK = #dsCustInvRulePk#
        AND R.INV_RULE_RCPNT_TP_CD = #invRuleRcpntTp_Internal#
        ORDER BY
            R.PSN_CD
    </statement>
  
      <statement id="getInvoiceSourceListExternalContact" parameterClass="Map" resultClass="Map">
        SELECT 
            R.CTAC_PSN_PK
           ,R.DS_CUST_INV_RULE_RCPNT_PK
        FROM
            DS_CUST_INV_RULE_RCPNT R
        WHERE
            R.GLBL_CMPY_CD = #glblCmpyCd#
        AND R.EZCANCELFLAG = '0'
        AND R.DS_CUST_INV_RULE_PK = #dsCustInvRulePk#
        AND R.INV_RULE_RCPNT_TP_CD = #invRuleRcpntTp_External#
        ORDER BY
            R.CTAC_PSN_PK
    </statement>
  
</sqlMap>
