<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWAL1800Query">

    <typeAlias alias="NWAL1800SMsg"    type="business.blap.NWAL1800.NWAL1800SMsg"/>
    <typeAlias alias="NWAL1800_ASMsg"  type="business.blap.NWAL1800.NWAL1800_ASMsg"/>

<statement id="getContractList" parameterClass="Map" resultClass="Map">
    SELECT
         DCR.DS_CONTR_NUM        AS CONTR_NUM
        ,DCR.DS_CONTR_SQ_NUM     AS CONTR_SQ_NUM
        ,DCR.SVC_PGM_MDSE_CD     AS MDSE_CD
        ,AM1.MDSE_CD             AS MDSE_CD10
        ,AM1.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT10
        ,AM2.MDSE_CD             AS MDSE_CD8
        ,AM2.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT8
    FROM
         DS_CONTR         DCR
        ,DS_CONTR_DTL     DCD
        ,SVC_MACH_MSTR    SMM
        ,SVC_CONFIG_MSTR  SCM
        ,DS_MDL           DML
        ,DS_MDL_SPLY_RELN MSR
        ,ALL_MDSE_V       AM1
        ,ALL_MDSE_V       AM2
        ,DS_CONTR_STS_V   CSV
    WHERE
        DCR.GLBL_CMPY_CD     = #glblCmpyCd#
        AND DCR.EZCANCELFLAG = '0'
        AND DCR.DS_ACCT_NUM  = #dsAcctNum#

        AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
        AND DCR.DS_CONTR_PK  = DCD.DS_CONTR_PK
        AND DCD.EZCANCELFLAG = '0'

        AND DCD.GLBL_CMPY_CD = SMM.GLBL_CMPY_CD
        AND DCD.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
        AND SMM.EZCANCELFLAG = '0'

        AND SMM.GLBL_CMPY_CD = SCM.GLBL_CMPY_CD
        AND SMM.SVC_CONFIG_MSTR_PK = SCM.SVC_CONFIG_MSTR_PK
        AND SCM.EZCANCELFLAG = '0'

        AND SCM.GLBL_CMPY_CD = DML.GLBL_CMPY_CD
        AND SCM.MDL_ID = DML.MDL_ID
        AND DML.EZCANCELFLAG = '0'

        AND DML.GLBL_CMPY_CD = MSR.GLBL_CMPY_CD
        AND DML.MDL_ID       = MSR.MDL_ID
        AND (MSR.MDSE_CD IN 
                <iterate property="mdseList" var="mdseList[]" open="(" close=")" conjunction=",">
                        #mdseList[]#
                </iterate>
                OR MSR.ORD_TAKE_MDSE_CD IN 
                <iterate property="mdseList" var="mdseList[]" open="(" close=")" conjunction=",">
                        #mdseList[]#
                </iterate>
             )
        AND MSR.EFF_FROM_DT &lt;= #salesDate#
        AND (MSR.EFF_THRU_DT &gt;= #salesDate# OR MSR.EFF_THRU_DT IS NULL)
        AND MSR.EZCANCELFLAG = '0'

        AND MSR.GLBL_CMPY_CD = AM1.GLBL_CMPY_CD(+)
        AND MSR.MDSE_CD = AM1.MDSE_CD(+)
        AND AM1.EZCANCELFLAG(+) = '0'

        AND MSR.GLBL_CMPY_CD = AM2.GLBL_CMPY_CD(+)
        AND MSR.ORD_TAKE_MDSE_CD = AM2.MDSE_CD(+)
        AND AM2.EZCANCELFLAG(+) = '0'
        
        AND DCR.GLBL_CMPY_CD = CSV.GLBL_CMPY_CD
        AND DCR.DS_CONTR_PK = CSV.DS_CONTR_PK
        AND CSV.EZCANCELFLAG = '0'
        AND CSV.ETTL_AVAL_FLG = 'Y'
        GROUP BY
             DCR.DS_CONTR_NUM
	        ,DCR.DS_CONTR_SQ_NUM
	        ,DCR.SVC_PGM_MDSE_CD
	        ,AM1.MDSE_CD
	        ,AM1.MDSE_DESC_SHORT_TXT
	        ,AM2.MDSE_CD
	        ,AM2.MDSE_DESC_SHORT_TXT  
        ORDER BY DCR.DS_CONTR_NUM
</statement>

<statement id="getSchedulingNum" parameterClass="Map" resultClass="Map">
    SELECT
         SAT.SCHD_AGMT_NUM
    FROM
         SCHD_AGMT SAT
        ,SCHD_AGMT_LINE SAL
    WHERE
        SAT.GLBL_CMPY_CD = #glblCmpyCd#
        AND SAT.EZCANCELFLAG = '0'
        AND SAT.SCHD_AGMT_STS_CD = #stsCd#
        AND SAT.DS_CONTR_NUM = #contrNum#
        AND SAT.DS_CONTR_SQ_NUM = #contrSqNum#
        AND SAT.GLBL_CMPY_CD = SAL.GLBL_CMPY_CD
        AND SAL.EZCANCELFLAG = '0'
        AND SAT.SCHD_AGMT_NUM = SAL.SCHD_AGMT_NUM
        AND SAL.MDSE_CD = #mdseCd#
        AND ROWNUM &lt;= #rowNum#
</statement>

</sqlMap>
