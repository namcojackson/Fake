<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLZC002001">

	<typeAlias alias="shpgOrdMsg" type="com.canon.cusa.s21.api.NLZ.NLZC002001.NLZC002001ShpgOrdMsg"/>
	<typeAlias alias="orgVndRtrnCpoMsg" type="com.canon.cusa.s21.api.NLZ.NLZC002001.NLZC002001OrgVndRtrnCpoMsg"/>
	<typeAlias alias="whTMsg" type="business.db.WHTMsg"/>

    <statement id="getShpgOrdCustDtl" parameterClass="shpgOrdMsg" resultMap="result.getShpgOrdCustDtl">
        SELECT
            SO.SELL_TO_CUST_CD
            , SO.BILL_TO_CUST_CD
            , SO.SHIP_TO_CUST_CD
            , SOC.SO_CUST_DATA_TP_CD
            , SOC.SO_CUST_LINE_LOC_NM_01
        FROM
            SHPG_ORD SO
            , SHPG_ORD_CUST_DTL SOC
        WHERE
            SO.GLBL_CMPY_CD = #glblCmpyCd#
            AND SO.SO_NUM = #soNum#
            AND SO.EZCANCELFLAG = '0'
            AND SO.GLBL_CMPY_CD = SOC.GLBL_CMPY_CD
            AND SO.SO_NUM = SOC.SO_NUM
            AND SOC.EZCANCELFLAG = '0'
    </statement>

    <resultMap id="result.getShpgOrdCustDtl" class="shpgOrdMsg">
        <result property="sellToCustCd"      column="SELL_TO_CUST_CD"        javaType="String"/>
        <result property="billToCustCd"      column="BILL_TO_CUST_CD"        javaType="String"/>
        <result property="shipToCustCd"      column="SHIP_TO_CUST_CD"        javaType="String"/>
        <result property="soCustDataTpCd"    column="SO_CUST_DATA_TP_CD"     javaType="String"/>
        <result property="soCustLineLocNm01" column="SO_CUST_LINE_LOC_NM_01" javaType="String"/>
    </resultMap>

    <statement id="getDsShpgOrdCustDtl" parameterClass="shpgOrdMsg" resultMap="result.getDsShpgOrdCustDtl">
        SELECT
              SOD.TO_INVTY_LOC_CD
            , SOCD.SO_CUST_DATA_TP_CD
            , SOCD.SO_CUST_LINE_LOC_NM_01
        FROM
              SHPG_ORD_DTL SOD
            , SHPG_ORD_CUST_DTL SOCD
        WHERE
                SOD.GLBL_CMPY_CD = #glblCmpyCd#
            AND SOD.SO_NUM = #soNum#
            AND SOD.SO_SLP_NUM = #soSlpNum#
            AND SOD.EZCANCELFLAG = '0'
            AND SOD.GLBL_CMPY_CD = SOCD.GLBL_CMPY_CD
            AND SOD.SO_NUM = SOCD.SO_NUM
            AND SOCD.EZCANCELFLAG = '0'
    </statement>

    <resultMap id="result.getDsShpgOrdCustDtl" class="shpgOrdMsg">
        <result property="shipToCustCd"      column="TO_INVTY_LOC_CD"        javaType="String"/>
        <result property="soCustDataTpCd"    column="SO_CUST_DATA_TP_CD"     javaType="String"/>
        <result property="soCustLineLocNm01" column="SO_CUST_LINE_LOC_NM_01" javaType="String"/>
    </resultMap>

    <statement id="getShpgOrdShpgPln" parameterClass="shpgOrdMsg" resultMap="result.getShpgOrdShpgPln">
        SELECT
              SP.SLS_REP_TOC_CD
            , SP.CCY_CD
        FROM
              SHPG_ORD_DTL SOD
            , SHPG_PLN SP
        WHERE
            SOD.GLBL_CMPY_CD = #glblCmpyCd#
            AND SOD.SO_NUM = #soNum#
            AND SOD.SO_SLP_NUM = #soSlpNum#
            AND SOD.EZCANCELFLAG = '0'
            AND SOD.GLBL_CMPY_CD = SP.GLBL_CMPY_CD
            AND SOD.SHPG_PLN_NUM = SP.SHPG_PLN_NUM
            AND SP.EZCANCELFLAG = '0'
    </statement>

    <resultMap id="result.getShpgOrdShpgPln" class="shpgOrdMsg">
        <result property="slsRepTocCd" column="SLS_REP_TOC_CD" javaType="String"/>
        <result property="ccyCd"       column="CCY_CD"         javaType="String"/>
    </resultMap>

    <statement id="getS21OrgCdVndRtrn" parameterClass="orgVndRtrnCpoMsg" resultMap="result.getS21OrgCdVndRtrn">
        SELECT
              O.FIRST_ORG_CD
            , O.SCD_ORG_CD
            , O.THIRD_ORG_CD
            , O.FRTH_ORG_CD
            , O.FIFTH_ORG_CD
            , O.SIXTH_ORG_CD
            , O.SVNTH_ORG_CD
            , O.EIGHTH_ORG_CD
            , VRD.SLS_REP_OR_SLS_TEAM_TOC_CD AS TOC_CD
            , VRD.FUNC_CCY_CD AS CCY_CD
        FROM
              VND_RTRN_DTL VRD
            , S21_ORG O
        WHERE
            VRD.GLBL_CMPY_CD                   = #glblCmpyCd#
            AND VRD.VND_RTRN_NUM               = #vndRtrnNum#
            AND VRD.TRX_LINE_NUM               = #trxLineNum#
            AND VRD.TRX_LINE_SUB_NUM           = #trxLineSubNum#
            AND VRD.EZCANCELFLAG               = '0'
            AND VRD.GLBL_CMPY_CD               = O.GLBL_CMPY_CD(+)
            AND VRD.SLS_REP_OR_SLS_TEAM_TOC_CD = O.TOC_CD(+)
            AND O.EZCANCELFLAG(+)              = '0'
    </statement>

    <resultMap id="result.getS21OrgCdVndRtrn" class="orgVndRtrnCpoMsg">
        <result property="firstOrgCd"  column="FIRST_ORG_CD"  javaType="String"/>
        <result property="scdOrgCd"    column="SCD_ORG_CD"    javaType="String"/>
        <result property="thirdOrgCd"  column="THIRD_ORG_CD"  javaType="String"/>
        <result property="frthOrgCd"   column="FRTH_ORG_CD"   javaType="String"/>
        <result property="fifthOrgCd"  column="FIFTH_ORG_CD"  javaType="String"/>
        <result property="sixthOrgCd"  column="SIXTH_ORG_CD"  javaType="String"/>
        <result property="svnthOrgCd"  column="SVNTH_ORG_CD"  javaType="String"/>
        <result property="eighthOrgCd" column="EIGHTH_ORG_CD" javaType="String"/>
        <result property="tocCd"       column="TOC_CD"        javaType="String"/>
        <result property="ccyCd"       column="CCY_CD"        javaType="String"/>
    </resultMap>

    <statement id="getDsCondConst" parameterClass="Map" resultClass="Map">
        SELECT
            DCC.DS_COND_CONST_VAL_TXT_03 AS INBD_OTBD_CD
           ,DCC.DS_COND_CONST_VAL_TXT_04 AS SWH_CD
        FROM
            DS_COND_CONST DCC
        WHERE
            DCC.GLBL_CMPY_CD             = #glblCmpyCd#
        AND DCC.DS_COND_CONST_GRP_ID     = #condConstGrpId#
        AND DCC.DS_COND_CONST_VAL_TXT_01 = #trxCd#
        AND DCC.DS_COND_CONST_VAL_TXT_02 = #trxRsnCd#
        AND DCC.EZCANCELFLAG             = '0'
    </statement>

    <statement id="getLoanWhFromShipWh" parameterClass="Map" resultClass="String">
        SELECT
            LW.INVTY_LOC_CD
        FROM
            RTL_SWH SF
           ,RTL_SWH LW
        WHERE
            SF.GLBL_CMPY_CD = #glblCmpyCd#
        AND SF.INVTY_LOC_CD = #shipFromLocCd#
        AND SF.EZCANCELFLAG = '0'
        AND LW.GLBL_CMPY_CD = SF.GLBL_CMPY_CD
        AND LW.RTL_WH_CD    = #invtyLocCd#
        AND LW.RTL_SWH_CD   = SF.RTL_SWH_CD
        AND LW.EZCANCELFLAG = '0'
    </statement>

    <statement id="getLoanWhFromOrgOrd" parameterClass="Map" resultClass="String">
        SELECT
            LW.INVTY_LOC_CD
        FROM
            CPO_DTL    CD
           ,RTL_SWH    LW
        WHERE
            CD.GLBL_CMPY_CD          = #glblCmpyCd#
        AND CD.CPO_ORD_NUM           = #cpoOrdNum#
        AND CD.CPO_DTL_LINE_NUM      = #cpoDtlLineNum#
        AND CD.CPO_DTL_LINE_SUB_NUM  = #cpoDtlLineSubNum#
        AND CD.EZCANCELFLAG          = '0'
        AND LW.GLBL_CMPY_CD          = CD.GLBL_CMPY_CD
        AND LW.RTL_WH_CD             = #invtyLocCd#
        AND LW.RTL_SWH_CD            = CD.RTL_SWH_CD
        AND LW.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getPoSrcWh" parameterClass="Map" resultClass="Map">
        SELECT
            IV.INVTY_LOC_CD AS SHIP_FROM_LOC_CUST_CD
           ,IV.INVTY_LOC_NM AS SHIP_FROM_LOC_CUST_NM
        FROM
            PO_DTL         PD
           ,DS_INVTY_LOC_V IV
        WHERE
            PD.GLBL_CMPY_CD        = #glblCmpyCd#
        AND PD.PO_ORD_NUM          = #poOrdNum#
        AND PD.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
        AND PD.EZCANCELFLAG        = '0'
        AND PD.GLBL_CMPY_CD        = IV.GLBL_CMPY_CD(+)
        AND PD.SRC_RTL_WH_CD       = IV.RTL_WH_CD(+)
        AND PD.SRC_RTL_SWH_CD      = IV.RTL_SWH_CD(+)
        AND IV.EZCANCELFLAG(+)     = '0'
    </statement>

    <statement id="getPoVnd" parameterClass="Map" resultClass="Map">
        SELECT
            P.VND_CD
           ,V.LOC_NM AS VND_NM
        FROM
            PO  P
           ,VND V
        WHERE
            P.GLBL_CMPY_CD    = #glblCmpyCd#
        AND P.PO_ORD_NUM      = #poOrdNum#
        AND P.EZCANCELFLAG    = '0'
        AND P.GLBL_CMPY_CD    = V.GLBL_CMPY_CD(+)
        AND P.VND_CD          = V.VND_CD(+)
        AND V.EZCANCELFLAG(+) = '0'
    </statement>

    <statement id="getSoShipFromLoc" parameterClass="Map" resultClass="Map">
        SELECT
            SOD.INVTY_LOC_CD AS SHIP_FROM_LOC_CUST_CD
           ,IV.INVTY_LOC_NM  AS SHIP_FROM_LOC_CUST_NM
        FROM
            SHPG_ORD_DTL    SOD
           ,INVTY_LOC_V     IV
        WHERE
            SOD.GLBL_CMPY_CD    = #glblCmpyCd#
        AND SOD.SO_NUM          = #soNum#
        AND SOD.SO_SLP_NUM      = #soSlpNum#
        AND SOD.EZCANCELFLAG    = '0'
        AND SOD.GLBL_CMPY_CD    = IV.GLBL_CMPY_CD(+)
        AND SOD.INVTY_LOC_CD    = IV.INVTY_LOC_CD(+)
        AND IV.EZCANCELFLAG(+)  = '0'
    </statement>

    <statement id="getInvtyDtailDaily" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            IDD.INVTY_DTL_DLY_PK
        FROM
            INVTY_DTL_DLY IDD
        WHERE
            IDD.GLBL_CMPY_CD    = #glblCmpyCd#
        AND IDD.MDSE_CD         = #mdseCd#
        <isNotNull property="invtyLocCd">
        AND IDD.INVTY_LOC_CD    = #invtyLocCd#
        </isNotNull>
        <isNotNull property="locStsCd">
        AND IDD.LOC_STS_CD      = #locStsCd#
        </isNotNull>
        <isNotNull property="stkStsCd">
        AND IDD.STK_STS_CD      = #stkStsCd#
        </isNotNull>
        <isNull property="serNumList">
        AND IDD.SER_NUM         IS NULL
        </isNull>
        <iterate property="serNumList" var="serNum[]" open="AND IDD.SER_NUM IN(" close=")" conjunction=",">
            #serNum[]#
        </iterate>
        <isNotNull property="invtyTrxDt">
        AND IDD.STK_IN_DT       = #invtyTrxDt#
        </isNotNull>
        <isNotNull property="svcConfigMstrPk">
        AND IDD.SVC_CONFIG_MSTR_PK = #svcConfigMstrPk#
        </isNotNull>
        <isNull property="svcConfigMstrPk">
        AND IDD.SVC_CONFIG_MSTR_PK IS NULL
        </isNull>
        AND IDD.EZCANCELFLAG    = '0'
        ORDER BY
            IDD.STK_IN_DT ASC
    </statement>

    <statement id="getInvtyDtailDailyAll" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            IDD.INVTY_DTL_DLY_PK
        FROM
            INVTY_DTL_DLY IDD
        WHERE
            IDD.GLBL_CMPY_CD    = #glblCmpyCd#
        AND IDD.MDSE_CD         = #mdseCd#
        AND IDD.INVTY_LOC_CD    = #invtyLocCd#
        AND IDD.LOC_STS_CD      = #locStsCd#
        AND IDD.STK_STS_CD      = #stkStsCd#
        <isNotNull property="svcConfigMstrPk">
        AND IDD.SVC_CONFIG_MSTR_PK = #svcConfigMstrPk#
        </isNotNull>
<!-- START 2019/08/07 M.Naito [QC#52333,MOD] -->
        <isNotNull property="serNum">
        AND IDD.SER_NUM = #serNum#
        </isNotNull>
        <!-- <isNull property="svcConfigMstrPk"> -->
        <!-- AND IDD.SVC_CONFIG_MSTR_PK IS NULL -->
        <!-- </isNull> -->
<!-- END 2019/08/07 M.Naito [QC#52333,MOD] -->
        AND IDD.EZCANCELFLAG    = '0'
        ORDER BY
            IDD.STK_IN_DT ASC
    </statement>

    <statement id="findVndNmWithPr" parameterClass="Map" resultClass="Map">
        SELECT
             V.VND_CD
            ,V.LOC_NM
        FROM
             INVTY_ORD_DTL IOD
            ,PRCH_REQ_DTL  PRD
            ,VND           V
        WHERE
            IOD.GLBL_CMPY_CD               = #glblCmpyCd#
        AND IOD.INVTY_ORD_NUM              = #invtyOrdNum#
        AND IOD.INVTY_ORD_LINE_NUM         = #invtyOrdLineNum#
        AND IOD.GLBL_CMPY_CD               = PRD.GLBL_CMPY_CD
        AND IOD.PRCH_REQ_NUM               = PRD.PRCH_REQ_NUM
        AND IOD.PRCH_REQ_LINE_NUM          = PRD.PRCH_REQ_LINE_NUM
        AND IOD.PRCH_REQ_LINE_SUB_NUM      = PRD.PRCH_REQ_LINE_SUB_NUM
        AND PRD.GLBL_CMPY_CD               = V.GLBL_CMPY_CD
        AND PRD.VND_CD                     = V.VND_CD 
        AND IOD.EZCANCELFLAG               = '0'
        AND PRD.EZCANCELFLAG               = '0'
        AND V.EZCANCELFLAG                 = '0'
    </statement>

    <statement id="findInvtyDtlDlySer" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            IDD.INVTY_DTL_DLY_PK
        FROM
            INVTY_DTL_DLY IDD
        WHERE
            IDD.GLBL_CMPY_CD    = #glblCmpyCd#
        AND IDD.MDSE_CD         = #mdseCd#
        <isNotNull property="invtyLocCd">
        AND IDD.INVTY_LOC_CD    = #invtyLocCd#
        </isNotNull>
        <isNotNull property="locStsCd">
        AND IDD.LOC_STS_CD      = #locStsCd#
        </isNotNull>
        <isNotNull property="stkStsCd">
        AND IDD.STK_STS_CD      = #stkStsCd#
        </isNotNull>
        <iterate property="serNumList" var="serNum[]" open="AND IDD.SER_NUM IN(" close=")" conjunction=",">
            #serNum[]#
        </iterate>
        <isNotNull property="invtyTrxDt">
        AND IDD.STK_IN_DT       = #invtyTrxDt#
        </isNotNull>
        <isNotNull property="svcConfigMstrPk">
        AND IDD.SVC_CONFIG_MSTR_PK = #svcConfigMstrPk#
        </isNotNull>
        AND IDD.EZCANCELFLAG    = '0'
        AND ROWNUM = 1
        ORDER BY
            IDD.STK_IN_DT ASC
    </statement>

    <statement id="getTocCdForAsg" parameterClass="Map" resultClass="String">
        SELECT
            TOC_CD
        FROM(
            SELECT
                B.TOC_CD
            FROM
                 ORG_FUNC_ASG     A
                ,TOC              B
                ,ORG_FUNC_ROLE_TP C
            WHERE
                    A.GLBL_CMPY_CD        = #glblCmpyCd#
                AND A.EZCANCELFLAG        = '0'
                AND A.PSN_CD              = #psnCd#
                AND A.EFF_FROM_DT         &lt;= #slsDt#
                AND NVL(A.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
                AND A.GLBL_CMPY_CD        = B.GLBL_CMPY_CD
                AND A.TOC_CD              = B.TOC_CD
                AND A.EZCANCELFLAG        = '0'
                AND C.GLBL_CMPY_CD        = B.GLBL_CMPY_CD
                AND C.ORG_FUNC_ROLE_TP_CD = B.ORG_FUNC_ROLE_TP_CD
                AND C.TECH_MSTR_REQ_FLG   = 'Y'
                AND C.EZCANCELFLAG        = '0'
            ORDER BY
                C.MGR_FLG ASC, C.ORG_FUNC_ROLE_TP_SORT_NUM ASC
            )
        WHERE
            ROWNUM = 1
    </statement>
</sqlMap>
