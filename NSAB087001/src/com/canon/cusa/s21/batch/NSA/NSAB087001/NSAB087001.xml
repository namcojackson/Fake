<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAB087001">
    <statement id="getCandidateData" parameterClass="Map" resultClass="Map">
        SELECT
             B.SVC_MACH_MSTR_PK
            ,B.BLLG_PER_FROM_DT
            ,B.BLLG_PER_THRU_DT
            ,B.SVC_INV_LINE_PK
            ,B.SVC_INV_NUM
            ,B.SVC_INV_LINE_NUM
            ,C.DS_CONTR_NUM
            ,C.CCY_CD
        FROM
            FRT_CHRG_REPL_INFO      A
           ,SVC_INV_LINE            B
           ,DS_CONTR                C
           ,SVC_INV                 D
        WHERE
                A.GLBL_CMPY_CD              = #glblCmpyCd#
            AND A.EZCANCELFLAG              = '0'
            AND B.GLBL_CMPY_CD              = #glblCmpyCd#
            AND B.EZCANCELFLAG              = '0'
            AND C.GLBL_CMPY_CD              = #glblCmpyCd#
            AND C.EZCANCELFLAG              = '0'
            AND A.FRT_CHRG_REPL_STS_CD      = #frtChrgReplStsCd#
            AND A.SVC_INV_NUM               = B.SVC_INV_NUM
            AND A.SVC_INV_LINE_NUM          = B.SVC_INV_LINE_NUM
            AND B.DS_CONTR_PK               = C.DS_CONTR_PK
            AND B.SVC_INV_NUM               = D.SVC_INV_NUM
        ORDER BY
           B.SVC_INV_NUM
          ,B.SVC_INV_LINE_NUM
    </statement>
    <statement id="getFreightChargeData" parameterClass="Map" resultClass="Map">
        SELECT 
            D.SLS_REP_TOC_CD
           ,D.INV_NUM
           ,D.INV_BOL_LINE_NUM
           ,D.INV_LINE_NUM
           ,D.INV_LINE_DEAL_NET_AMT
        FROM
            CPO        A
           ,CPO_DTL    B
           ,INV        C
           ,INV_LINE   D
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND B.GLBL_CMPY_CD          = #glblCmpyCd#
            AND B.EZCANCELFLAG          = '0'
            AND C.GLBL_CMPY_CD          = #glblCmpyCd#
            AND C.EZCANCELFLAG          = '0'
            AND D.GLBL_CMPY_CD          = #glblCmpyCd#
            AND D.EZCANCELFLAG          = '0'
            AND A.DS_ORD_CATG_CD        = #dsOrdCatgCd#
            <isNotNull property="frtReplOrdTpList">
                <iterate property="frtReplOrdTpList" var="frtReplOrdTpList[]" open="AND A.DS_ORD_TP_CD IN (" close=")" conjunction= ", " >
                    #frtReplOrdTpList[]#
                </iterate>
            </isNotNull>
            AND A.CPO_ORD_NUM           = B.CPO_ORD_NUM
            AND A.CPO_ORD_NUM           = C.CPO_ORD_NUM
            AND A.CPO_ORD_NUM           = D.CPO_ORD_NUM
            AND B.CPO_DTL_LINE_NUM      = D.CPO_DTL_LINE_NUM
            AND B.CPO_DTL_LINE_SUB_NUM  = D.CPO_DTL_LINE_SUB_NUM
            AND B.DS_CONTR_NUM          = #dsContrNum#
            AND C.DS_INV_TP_CD          = #dsInvTpCd#
            AND C.INV_DT                BETWEEN #bllgPerFromDt# AND #bllgPerThruDt#
            AND D.MDSE_CD               = #mdseCd#
            AND B.SVC_MACH_MSTR_PK      = #svcMachMstrpk#
        ORDER BY
            C.INV_DT
           ,C.CPO_ORD_NUM
    </statement>
    <statement id="getdsInvSlsCr" parameterClass="Map" resultClass="Map">
        SELECT 
             A.MDSE_CD
            ,A.SLS_REP_TOC_CD
            ,A.INV_LINE_SPL_PCT
            ,A.DEAL_SLS_CR_AMT
            ,A.COA_CMPY_CD
            ,A.COA_AFFL_CD
            ,A.COA_BR_CD
            ,A.COA_CH_CD
            ,A.COA_CC_CD
            ,A.COA_ACCT_CD
            ,A.COA_PROD_CD
            ,A.COA_PROJ_CD
            ,A.COA_EXTN_CD
            ,A.TRX_CD
            ,A.TRX_RSN_CD
            ,A.DFRD_ACCTG_RULE_CD
        FROM
            DS_INV_SLS_CR        A
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.INV_NUM               = #invNum#
            AND A.INV_BOL_LINE_NUM      = #invBolLineNum#
            AND A.INV_LINE_NUM          = #invLineNum#
    </statement>
    <statement id="getLatestSvcInvLineNum" parameterClass="Map" resultClass="Map">
        SELECT 
             LATEST_SVC_INV_LINE.SVC_INV_LINE_NUM AS SVC_INV_LINE_NUM
        FROM
            (SELECT
                A.SVC_INV_LINE_NUM
            FROM
                SVC_INV_LINE        A
            WHERE
                    A.GLBL_CMPY_CD          = #glblCmpyCd#
                AND A.EZCANCELFLAG          = '0'
                AND A.SVC_INV_NUM           = #svcInvNum#
            ORDER BY
                A.SVC_INV_LINE_NUM DESC
            ) LATEST_SVC_INV_LINE
        WHERE
            ROWNUM = 1
    </statement>
</sqlMap>
