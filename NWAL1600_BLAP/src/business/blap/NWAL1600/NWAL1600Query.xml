<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWAL1600Query">

    <statement id="getSlsRepDetail" parameterClass="Map" resultClass="Map">
        SELECT
             TC.TOC_NM
           , CE.COA_EXTN_NM
           , CB.COA_BR_NM
           , CC.COA_CC_NM
        FROM
             TOC      TC
           , COA_EXTN CE
           , COA_BR   CB
           , COA_CC   CC
        WHERE 
             TC.GLBL_CMPY_CD      = #glblCmpyCd#
        AND  TC.TOC_CD            = #slsRepTocCd#
        AND  TC.COA_EXTN_CD       = CE.COA_EXTN_CD(+)
        AND  TC.COA_BR_CD         = CB.COA_BR_CD(+)
        AND  TC.COA_CC_CD         = CC.COA_CC_CD(+)
        AND  TC.GLBL_CMPY_CD      = CE.GLBL_CMPY_CD(+)
        AND  TC.GLBL_CMPY_CD      = CB.GLBL_CMPY_CD(+)
        AND  TC.GLBL_CMPY_CD      = CC.GLBL_CMPY_CD(+)
        AND  TC.EZCANCELFLAG      = 0
        AND  CE.EZCANCELFLAG(+)   = 0
        AND  CB.EZCANCELFLAG(+)   = 0
        AND  CC.EZCANCELFLAG(+)   = 0
    </statement>

    <statement id="isSalesSlsrep"  parameterClass="Map" resultClass="Integer">
        SELECT
             COUNT(*) AS CNT
        FROM
             TOC               TC
           , S21_ORG           SO
           , ORG_FUNC_ROLE_TP  OFR
           , BIZ_AREA_ORG      BAO
        WHERE 
             TC.GLBL_CMPY_CD        = #glblCmpyCd#
        AND  TC.TOC_CD              = #slsRepTocCd#
        AND  TC.TOC_CD              = SO.TOC_CD
        AND  SO.ORG_FUNC_ROLE_TP_CD = OFR.ORG_FUNC_ROLE_TP_CD
        AND  OFR.SLS_REP_FLG        = #flagY#
        AND  SO.FIRST_ORG_CD        = BAO.BIZ_AREA_ORG_CD
        AND  BAO.SLS_FLG            = #flagY#
        AND  BAO.ORG_STRU_TP_CD     = #orgStruTp#
        AND  TC.GLBL_CMPY_CD        = SO.GLBL_CMPY_CD
        AND  SO.GLBL_CMPY_CD        = OFR.GLBL_CMPY_CD
        AND  OFR.GLBL_CMPY_CD       = BAO.GLBL_CMPY_CD
        AND  TC.EZCANCELFLAG        = 0
        AND  SO.EZCANCELFLAG        = 0
        AND  OFR.EZCANCELFLAG       = 0
        AND  BAO.EZCANCELFLAG       = 0
        AND  ROWNUM                 = #rowNum#
    </statement>

    <statement id="getSalesRepList" parameterClass="Map" resultClass="Map">
        SELECT 
             SP.PSN_CD
            ,SP.PSN_NUM
            ,T.TOC_NM
            ,CE.COA_EXTN_CD
            ,CE.COA_EXTN_NM
            ,CB.COA_BR_CD
            ,CB.COA_BR_NM
            ,CC.COA_CC_CD
            ,CC.COA_CC_NM
            ,T.TOC_CD
        FROM 
            TOC T
            ,ORG_FUNC_ROLE_TP OFRT
            ,BIZ_AREA_ORG BA
            ,ORG_FUNC_ASG OFA
            ,S21_PSN SP
            ,COA_EXTN CE
            ,COA_BR   CB
            ,COA_CC   CC
        WHERE 
                T.GLBL_CMPY_CD        = #glblCmpyCd#
            AND T.EZCANCELFLAG        = '0'
            AND T.GLBL_CMPY_CD        = OFRT.GLBL_CMPY_CD
            AND T.ORG_FUNC_ROLE_TP_CD = OFRT.ORG_FUNC_ROLE_TP_CD
            <isNotNull property="slsRepTocCd">
            AND T.TOC_CD              = #slsRepTocCd#
            </isNotNull>
            <isNotNull property="tocNm">
            AND UPPER(T.TOC_NM)       LIKE UPPER(#tocNm#)    <!-- S21_NA#13627 MOD -->
            </isNotNull>
            AND OFRT.SLS_REP_FLG      = #slsRepFlg#
            AND OFRT.EZCANCELFLAG     = '0'
            AND OFRT.GLBL_CMPY_CD     = BA.GLBL_CMPY_CD
            AND OFRT.FIRST_ORG_CD     = BA.BIZ_AREA_ORG_CD
            AND BA.SLS_FLG            = #slsRepFlg#
            AND BA.ORG_STRU_TP_CD     = #orgStruTpCd#
            AND BA.EZCANCELFLAG       = '0'
            AND OFA.GLBL_CMPY_CD      = T.GLBL_CMPY_CD
            AND OFA.EZCANCELFLAG      = '0'
            AND OFA.TOC_CD            =  T.TOC_CD
            <!-- 2020/04/02 QC#56425 Add Start-->
            AND OFA.EFF_FROM_DT      &lt;= #slsDt#
            AND (OFA.EFF_THRU_DT     &gt;= #slsDt# OR OFA.EFF_THRU_DT IS NULL)
            <!-- 2020/04/02 QC#56425 Add End-->
            AND SP.GLBL_CMPY_CD       = OFA.GLBL_CMPY_CD
            AND SP.EZCANCELFLAG       = '0'
            AND SP.PSN_CD             = OFA.PSN_CD
            AND SP.EFF_FROM_DT       &lt;= #slsDt#
            AND (SP.EFF_THRU_DT      &gt;= #slsDt# OR SP.EFF_THRU_DT IS NULL)
            <isNotNull property="psnNum">
            AND SP.PSN_NUM             LIKE #psnNum#
            </isNotNull>
            AND T.GLBL_CMPY_CD        = CB.GLBL_CMPY_CD(+)
            AND T.EZCANCELFLAG        = CB.EZCANCELFLAG(+)
            AND T.COA_BR_CD           = CB.COA_BR_CD(+)
            AND T.GLBL_CMPY_CD        = CE.GLBL_CMPY_CD(+)
            AND T.EZCANCELFLAG        = CE.EZCANCELFLAG(+)
            AND T.COA_EXTN_CD         = CE.COA_EXTN_CD(+)
            AND T.GLBL_CMPY_CD        = CC.GLBL_CMPY_CD(+)
            AND T.EZCANCELFLAG        = CC.EZCANCELFLAG(+)
            AND T.COA_CC_CD           = CC.COA_CC_CD(+)
    </statement>

    <!-- 2017/11/10 S21_NA#20146 Add Start -->
    <statement id="getSalesRepListForNonQuot" parameterClass="Map" resultClass="Map">
        SELECT 
             SP.PSN_CD
            ,SP.PSN_NUM
            ,T.TOC_NM
            ,CE.COA_EXTN_CD
            ,CE.COA_EXTN_NM
            ,CB.COA_BR_CD
            ,CB.COA_BR_NM
            ,CC.COA_CC_CD
            ,CC.COA_CC_NM
            ,T.TOC_CD
        FROM 
            TOC T
            ,ORG_FUNC_ASG OFA
            ,S21_PSN SP
            ,COA_EXTN CE
            ,COA_BR   CB
            ,COA_CC   CC
        WHERE 
                T.GLBL_CMPY_CD        = #glblCmpyCd#
            AND T.EZCANCELFLAG        = '0'
            <isNotNull property="slsRepTocCd">
            AND T.TOC_CD              = #slsRepTocCd#
            </isNotNull>
            <isNotNull property="tocNm">
            AND UPPER(T.TOC_NM)       LIKE UPPER(#tocNm#)
            </isNotNull>
            AND OFA.GLBL_CMPY_CD      = T.GLBL_CMPY_CD
            AND OFA.EZCANCELFLAG      = '0'
            AND OFA.TOC_CD            = T.TOC_CD
            <!-- 2020/04/02 QC#56425 Add Start-->
            AND OFA.EFF_FROM_DT      &lt;= #slsDt#
            AND (OFA.EFF_THRU_DT     &gt;= #slsDt# OR OFA.EFF_THRU_DT IS NULL)
            <!-- 2020/04/02 QC#56425 Add End-->
            AND SP.GLBL_CMPY_CD       = OFA.GLBL_CMPY_CD
            AND SP.EZCANCELFLAG       = '0'
            AND SP.PSN_CD             = OFA.PSN_CD
            <isNotNull property="psnNum">
            AND SP.PSN_NUM             LIKE #psnNum#
            </isNotNull>
            <!-- 2020/04/02 QC#56425 Add Start-->
            AND SP.EFF_FROM_DT       &lt;= #slsDt#
            AND (SP.EFF_THRU_DT      &gt;= #slsDt# OR SP.EFF_THRU_DT IS NULL)
            <!-- 2020/04/02 QC#56425 Add End-->
            AND T.GLBL_CMPY_CD        = CB.GLBL_CMPY_CD(+)
            AND T.EZCANCELFLAG        = CB.EZCANCELFLAG(+)
            AND T.COA_BR_CD           = CB.COA_BR_CD(+)
            AND T.GLBL_CMPY_CD        = CE.GLBL_CMPY_CD(+)
            AND T.EZCANCELFLAG        = CE.EZCANCELFLAG(+)
            AND T.COA_EXTN_CD         = CE.COA_EXTN_CD(+)
            AND T.GLBL_CMPY_CD        = CC.GLBL_CMPY_CD(+)
            AND T.EZCANCELFLAG        = CC.EZCANCELFLAG(+)
            AND T.COA_CC_CD           = CC.COA_CC_CD(+)
    </statement>
    <!-- 2017/11/10 S21_NA#20146 Add End -->

    <!-- 2016/05/27 S21_NA#4618 Add Start -->
    <statement id="getRoleList" parameterClass="Map" resultClass="Map">
        SELECT 
             RT.LINE_BIZ_ROLE_TP_CD         LINE_BIZ_ROLE_TP_CD
            ,RT.LINE_BIZ_ROLE_TP_DESC_TXT   LINE_BIZ_ROLE_TP_DESC_TXT
        FROM 
            LINE_BIZ_ROLE_TP RT
        WHERE
                RT.GLBL_CMPY_CD         = #glblCmpyCd#
            <isNotNull property="quotaFlg">
            AND RT.SLS_CR_QUOT_FLG      = #quotaFlg#
            </isNotNull>
            <isNotNull property="nonQuotaFlg">
            AND RT.NON_SLS_CR_QUOT_FLG  = #nonQuotaFlg#
            </isNotNull>
            AND RT.EZCANCELFLAG         = '0'
        ORDER BY 
            RT.LINE_BIZ_ROLE_TP_SORT_NUM 
    </statement>
    <!-- 2016/05/27 S21_NA#4618 Add End -->
</sqlMap>
