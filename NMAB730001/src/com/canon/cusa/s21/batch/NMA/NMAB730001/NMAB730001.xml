<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAB730001">
    <statement id="getMdse" parameterClass="Map" resultClass="Map">
            SELECT
                 OTM.ORD_TAKE_MDSE_CD   MDSE_CD
                ,M.THIS_MTH_TOT_STD_COST_AMT
                <!-- 2019/03/22 QC#30841 Mod Start -->
                ,NVL(MSP.PKG_UOM_CD, PUC.BASE_PKG_UOM_CD) AS BASE_PKG_UOM_CD
                <!--
                ,PUC.BASE_PKG_UOM_CD
                -->
                <!-- 2019/03/22 QC#30841 Mod End -->
            FROM
                 MDSE M
                ,ORD_TAKE_MDSE OTM
                ,PKG_UOM_CLS PUC
                <!-- 2019/03/22 QC#30841 Add Start -->
                ,MDSE_STORE_PKG MSP
                <!-- 2019/03/22 QC#30841 Add End -->
            WHERE
                    M.GLBL_CMPY_CD = #glblCmpyCd#
                AND M.EZCANCELFLAG = '0'
            <isNotNull property="procDt">
                AND M.MDSE_CST_UPD_DT = #procDt#
            </isNotNull>

            <isNotNull property="rgtnCd">
                AND M.RGTN_STS_CD    = #rgtnCd#
            </isNotNull>

                AND M.GLBL_CMPY_CD = OTM.GLBL_CMPY_CD
                AND M.EZCANCELFLAG = OTM.EZCANCELFLAG
                AND M.MDSE_CD      = OTM.MDSE_CD

                AND M.GLBL_CMPY_CD = PUC.GLBL_CMPY_CD
                AND M.EZCANCELFLAG = PUC.EZCANCELFLAG
                AND M.PKG_UOM_CLS_CD = PUC.PKG_UOM_CLS_CD

                <!-- 2019/03/22 QC#30841 Add Start -->
                AND M.EZCANCELFLAG      = MSP.EZCANCELFLAG(+)
                AND M.GLBL_CMPY_CD      = MSP.GLBL_CMPY_CD(+)
                AND M.MDSE_CD           = MSP.MDSE_CD(+)
                AND PUC.BASE_PKG_UOM_CD = MSP.BASE_PKG_UOM_CD(+)
                <!-- 2019/03/22 QC#30841 Add End -->
        UNION
            SELECT
                 M.MDSE_CD
                ,M.THIS_MTH_TOT_STD_COST_AMT
                <!-- 2019/03/22 QC#30841 Mod Start -->
                ,NVL(MSP.PKG_UOM_CD, PUC.BASE_PKG_UOM_CD) AS BASE_PKG_UOM_CD
                <!--
                ,PUC.BASE_PKG_UOM_CD
                -->
                <!-- 2019/03/22 QC#30841 Mod End -->
            FROM
                 MDSE M
                ,PKG_UOM_CLS PUC
                <!-- 2019/03/22 QC#30841 Add Start -->
                ,MDSE_STORE_PKG MSP
                <!-- 2019/03/22 QC#30841 Add End -->
            WHERE
                    M.GLBL_CMPY_CD = #glblCmpyCd#
                AND M.EZCANCELFLAG = '0'
            <isNotNull property="procDt">
                AND M.MDSE_CST_UPD_DT = #procDt#
            </isNotNull>

            <isNotNull property="rgtnCd">
                AND M.RGTN_STS_CD    = #rgtnCd#
            </isNotNull>

                AND M.GLBL_CMPY_CD = PUC.GLBL_CMPY_CD
                AND M.EZCANCELFLAG = PUC.EZCANCELFLAG
                AND M.PKG_UOM_CLS_CD = PUC.PKG_UOM_CLS_CD

                <!-- 2019/03/22 QC#30841 Add Start -->
                AND M.EZCANCELFLAG      = MSP.EZCANCELFLAG(+)
                AND M.GLBL_CMPY_CD      = MSP.GLBL_CMPY_CD(+)
                AND M.MDSE_CD           = MSP.MDSE_CD(+)
                AND PUC.BASE_PKG_UOM_CD = MSP.BASE_PKG_UOM_CD(+)
                <!-- 2019/03/22 QC#30841 Add End -->

                AND NOT EXISTS
                    ( SELECT 'X'
                        FROM ORD_TAKE_MDSE OTM
                       WHERE OTM.GLBL_CMPY_CD = M.GLBL_CMPY_CD
                         AND OTM.EZCANCELFLAG = M.EZCANCELFLAG
                         AND OTM.ORD_TAKE_MDSE_CD = SUBSTR(M.MDSE_CD, 1, 8))
    </statement>
    <statement id="getPrcEquip" parameterClass="Map" resultClass="Map">
        SELECT
            PLE.PRC_LIST_EQUIP_PK
            ,PLE.PRC_CATG_CD
            ,PCSS.DEST_PRC_CATG_CD
            ,PLE.PRC_LIST_EQUIP_CONFIG_NUM
            ,PLE.PRC_LIST_EQUIP_CONFIG_NM
            ,PLE.PRC_QLFY_TP_CD
            ,PLE.PRC_QLFY_VAL_TXT
            ,PLE.PKG_UOM_CD
            ,PLE.MIN_PRC_AMT
            ,PLE.MAX_PRC_AMT
            ,PLE.PRC_TERM_UOM_CD
            ,PLE.PRC_TERM_AOT
            ,PLE.CUST_BID_QTY
            ,PLE.MLY_PMT_AMT
            ,PLE.MIN_LEASE_PMT_AMT
            ,PLE.MAX_LEASE_PMT_AMT
            ,PLE.PRC_FMLA_PK
            ,PLE.OPEN_MKT_FLG
            ,PLE.QUOT_REV_AMT
            ,PLE.COMP_CD
            ,PLE.DEL_FLG
            ,PCSS.PRC_FMLA_NUM
            ,PCSS.PRC_CATG_SYNC_OP_CD
        FROM
            PRC_LIST_EQUIP PLE
            ,PRC_CATG DPC
            ,PRC_LIST_TP PLT
            ,PRC_CATG_SYNC_SETUP PCSS
        WHERE
                PLE.GLBL_CMPY_CD (+)     = #glblCmpyCd#
            AND PLE.EZCANCELFLAG (+)     = '0'
            AND PLE.PRC_QLFY_TP_CD (+)   = #prcQlfyTpCd#
            AND PLE.PRC_QLFY_VAL_TXT (+) = #mdseCd#
            AND PLE.PKG_UOM_CD (+)       = #pkgUomCd#
            AND PLE.DEL_FLG (+)          = 'N'   
        
            AND PLE.GLBL_CMPY_CD   = DPC.GLBL_CMPY_CD (+)
            AND PLE.EZCANCELFLAG   = DPC.EZCANCELFLAG (+)
            AND PLE.PRC_CATG_CD    = DPC.PRC_CATG_CD (+)
        
            AND DPC.GLBL_CMPY_CD            = PLT.GLBL_CMPY_CD (+)
            AND DPC.EZCANCELFLAG            = PLT.EZCANCELFLAG (+)
            AND DPC.PRC_LIST_TP_CD          = PLT.PRC_LIST_TP_CD (+)
            AND PLT.PRC_LIST_STRU_TP_CD (+) = '01'
            AND PLT.PRC_CATG_SYNC_FLG (+)   = 'Y'
        
            AND PCSS.GLBL_CMPY_CD                 = PLE.GLBL_CMPY_CD (+)
            AND PCSS.EZCANCELFLAG                 = PLE.EZCANCELFLAG (+) 
            AND PCSS.PRC_CATG_SYNC_SRC_CD         = #prcCatgSyncSrcCd#
            AND PCSS.DEST_PRC_CATG_CD             = PLE.PRC_CATG_CD (+)
            AND PCSS.EFF_FROM_DT                 &lt;= #procDt#
            AND NVL(PCSS.EFF_THRU_DT,'99991231') &gt;= #procDt#
        ORDER BY
            PLE.PRC_CATG_CD
            ,PCSS.DEST_PRC_CATG_CD
            ,PLE.PRC_LIST_EQUIP_CONFIG_NUM
            ,PLE.PRC_LIST_EQUIP_CONFIG_NM
            ,PLE.PRC_QLFY_TP_CD
            ,PLE.PRC_QLFY_VAL_TXT
            ,PLE.PKG_UOM_CD
            ,PLE.PRC_TERM_UOM_CD
            ,PLE.PRC_TERM_AOT
            ,PLE.EFF_FROM_DT
    </statement>
    <statement id="getPrcCatgSyncSetup" parameterClass="Map" resultClass="Map">
       SELECT
            PCSS.DEST_PRC_CATG_CD
            ,PCSS.PRC_FMLA_NUM
            ,PCSS.PRC_CATG_SYNC_OP_CD
        FROM
            PRC_CATG_SYNC_SETUP PCSS
            ,PRC_CATG DPC
            ,PRC_LIST_TP PLT
        WHERE
                PCSS.GLBL_CMPY_CD         = #glblCmpyCd#
            AND PCSS.EZCANCELFLAG         = '0'
            AND PCSS.PRC_CATG_SYNC_SRC_CD = #prcCatgSyncSrcCd#
            AND PCSS.EFF_FROM_DT          &lt;= #procDt#
            AND NVL(PCSS.EFF_THRU_DT,'99991231') &gt;= #procDt#

            AND PCSS.GLBL_CMPY_CD     = DPC.GLBL_CMPY_CD
            AND PCSS.EZCANCELFLAG     = DPC.EZCANCELFLAG
            AND PCSS.DEST_PRC_CATG_CD = DPC.PRC_CATG_CD

            AND DPC.GLBL_CMPY_CD        = PLT.GLBL_CMPY_CD
            AND DPC.EZCANCELFLAG        = PLT.EZCANCELFLAG
            AND DPC.PRC_LIST_TP_CD      = PLT.PRC_LIST_TP_CD
            AND PLT.PRC_LIST_STRU_TP_CD = #prcListStruTpCd#
            AND PLT.PRC_CATG_SYNC_FLG   = 'Y' 
    </statement>

    <!-- QC#12532 -->
    <statement id="getPrcCatgCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
              COUNT(*) 
        FROM
                PRC_LIST_EQUIP PLE 
        WHERE
                PLE.GLBL_CMPY_CD = #glblCmpyCd# 
            AND PLE.EZCANCELFLAG = '0' 
            AND PLE.PRC_CATG_CD = #prcCatgCd# 
            AND PLE.DEL_FLG = 'N'

    </statement>

    <statement id="getPrcCatgSyncList" parameterClass="Map" resultClass="Map">
        SELECT
              PC.PRC_CATG_CD 
            , PCSS.PRC_FMLA_NUM 
            , PCSS.PRC_CATG_SYNC_OP_CD 
        FROM
              PRC_CATG PC
            , ( 
                SELECT
                      SYNC.DEST_PRC_CATG_CD
                    , SYNC.PRC_FMLA_NUM
                    , SYNC.PRC_CATG_SYNC_OP_CD
                    , SYNC.GLBL_CMPY_CD
                    , SYNC.EZCANCELFLAG 
                FROM
                    PRC_CATG_SYNC_SETUP SYNC
            ) PCSS 
        WHERE
                PC.GLBL_CMPY_CD = #glblCmpyCd# 
            AND PC.EZCANCELFLAG = '0' 
            AND PC.PRC_CATG_CD = PCSS.DEST_PRC_CATG_CD 
            AND PC.GLBL_CMPY_CD = PCSS.GLBL_CMPY_CD 
            AND PC.EZCANCELFLAG = PCSS.EZCANCELFLAG

    </statement>
</sqlMap>
