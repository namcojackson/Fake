<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NMAL2610Query">

    <typeAlias alias="NMAL2610SMsg"     type="business.blap.NMAL2610.NMAL2610SMsg"/>
    <typeAlias alias="NMAL2610_ASMsg"   type="business.blap.NMAL2610.NMAL2610_ASMsg"/>
    <typeAlias alias="NMAL2610_BSMsg"   type="business.blap.NMAL2610.NMAL2610_BSMsg"/>
    <typeAlias alias="NMAL2610_CSMsg"   type="business.blap.NMAL2610.NMAL2610_CSMsg"/>
    <typeAlias alias="NMAL2610_DSMsg"   type="business.blap.NMAL2610.NMAL2610_DSMsg"/>

    <resultMap id="result.getTerritory"  class="NMAL2610SMsg">
        <result property="orgCd_H1"         column="ORG_CD"             javaType="EZDSStringItem"/>
        <result property="bizAreaOrgCd_P1"  column="FIRST_ORG_CD"       javaType="EZDSStringItem"/>
        <result property="trtyTpCd_P1"      column="TRTY_TP_CD"         javaType="EZDSStringItem"/>
        <result property="orgNm_H1"         column="ORG_NM"             javaType="EZDSStringItem"/>
        <result property="orgTierCd_P1"     column="ORG_TIER_CD"        javaType="EZDSStringItem"/>
        <result property="orgDescTxt_H1"    column="ORG_DESC_TXT"       javaType="EZDSStringItem"/>
        <result property="trtyGrpTpCd_P1"   column="TRTY_GRP_TP_CD"     javaType="EZDSStringItem"/>
        <result property="effFromDt_H1"     column="EFF_FROM_DT"        javaType="EZDCDateItem"/>
        <result property="effThruDt_H1"     column="EFF_THRU_DT"        javaType="EZDCDateItem"/>
        <result property="ezUpTime_X1"      column="EZUPTIME_ORG"       javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_X1"  column="EZUPTIMEZONE_ORG"   javaType="EZDSStringItem"/>
        <!-- Add Start 2016/11/09 M.Ohno S21_NA#2680 -->
        <result property="xxRecHistCratTs"    column="XX_REC_HIST_CRAT_TS"     javaType="EZDSStringItem" />
        <result property="xxRecHistCratByNm"  column="XX_REC_HIST_CRAT_BY_NM"  javaType="EZDSStringItem" />
        <result property="xxRecHistUpdTs"     column="XX_REC_HIST_UPD_TS"      javaType="EZDSStringItem" />
        <result property="xxRecHistUpdByNm"   column="XX_REC_HIST_UPD_BY_NM"   javaType="EZDSStringItem" />
        <result property="xxRecHistTblNm"     column="XX_REC_HIST_TBL_NM"      javaType="EZDSStringItem" />
        <!-- Add End   2016/11/09 M.Ohno S21_NA#2680 -->
    </resultMap>

    <resultMap id="result.getTerritoryParent"  class="NMAL2610_ASMsg">
        <result property="orgNm_A1"              column="ORG_NM"               javaType="EZDSStringItem"/>
        <result property="orgCd_A1"              column="ORG_CD"               javaType="EZDSStringItem"/>
        <result property="effFromDt_A1"          column="EFF_FROM_DT"          javaType="EZDCDateItem"/>
        <result property="effThruDt_A1"          column="EFF_THRU_DT"          javaType="EZDCDateItem"/>
        <result property="gnrnTpCd_A1"           column="GNRN_TP_CD"           javaType="EZDSStringItem"/>
        <result property="ezUpTime_X2"           column="EZUPTIME_RELN"        javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_X2"       column="EZUPTIMEZONE_RELN"    javaType="EZDSStringItem"/>
        <result property="orgCd_X2"              column="ORG_CD_RELN"          javaType="EZDSStringItem"/>
        <result property="prntOrgCd_X2"          column="PRNT_ORG_CD_RELN"     javaType="EZDSStringItem"/>
        <result property="orgStruTpCd_X2"        column="ORG_STRU_TP_CD_RELN"  javaType="EZDSStringItem"/>
        <result property="effFromDt_X2"          column="EFF_FROM_DT_RELN"     javaType="EZDCDateItem"/>
        <result property="bizAreaOrgCd_A1"       column="FIRST_ORG_CD_TRTY"    javaType="EZDSStringItem"/>
        <result property="orgTierCd_A1"          column="ORG_TIER_CD_TRTY"     javaType="EZDSStringItem"/>
        <result property="effFromDt_A2"          column="EFF_FROM_DT_TRTY"     javaType="EZDCDateItem"/>
        <result property="effThruDt_A2"          column="EFF_THRU_DT_TRTY"     javaType="EZDCDateItem"/>
        <!-- Add Start 2016/11/09 M.Ohno S21_NA#2680 -->
        <result property="xxRecHistCratTs_A1"    column="XX_REC_HIST_CRAT_TS"     javaType="EZDSStringItem" />
        <result property="xxRecHistCratByNm_A1"  column="XX_REC_HIST_CRAT_BY_NM"  javaType="EZDSStringItem" />
        <result property="xxRecHistUpdTs_A1"     column="XX_REC_HIST_UPD_TS"      javaType="EZDSStringItem" />
        <result property="xxRecHistUpdByNm_A1"   column="XX_REC_HIST_UPD_BY_NM"   javaType="EZDSStringItem" />
        <result property="xxRecHistTblNm_A1"     column="XX_REC_HIST_TBL_NM"      javaType="EZDSStringItem" />
        <!-- Add End   2016/11/09 M.Ohno S21_NA#2680 -->
        <!-- 2017/03/07 S21_NA#17760 Add Start -->
        <result property="dsOrgRelnPk_A1"     column="DS_ORG_RELN_PK"      javaType="EZDSBigDecimalItem" />
        <result property="dsOrgRelnPk_X2"     column="DS_ORG_RELN_PK"      javaType="EZDSBigDecimalItem" />
        <!-- 2017/03/07 S21_NA#17760 Add End -->
    </resultMap>

    <resultMap id="result.getTerritoryChild"  class="NMAL2610_BSMsg">
        <result property="orgNm_B1"              column="ORG_NM"               javaType="EZDSStringItem"/>
        <result property="orgCd_B1"              column="ORG_CD"               javaType="EZDSStringItem"/>
        <result property="effFromDt_B1"          column="EFF_FROM_DT"          javaType="EZDCDateItem"/>
        <result property="effThruDt_B1"          column="EFF_THRU_DT"          javaType="EZDCDateItem"/>
        <result property="bizAreaOrgCd_B1"       column="FIRST_ORG_CD_TRTY"    javaType="EZDSStringItem"/>
        <result property="orgTierCd_B1"          column="ORG_TIER_CD_TRTY"     javaType="EZDSStringItem"/>
        <result property="effFromDt_B2"          column="EFF_FROM_DT_TRTY"     javaType="EZDCDateItem"/>
        <result property="effThruDt_B2"          column="EFF_THRU_DT_TRTY"     javaType="EZDCDateItem"/>
        <result property="ezUpTime_B1"           column="EZUPTIME_RELN"        javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_B1"       column="EZUPTIMEZONE_RELN"    javaType="EZDSStringItem"/>
        <!-- Add Start 2016/11/09 M.Ohno S21_NA#2680 -->
        <result property="xxRecHistCratTs_B1"    column="XX_REC_HIST_CRAT_TS"     javaType="EZDSStringItem" />
        <result property="xxRecHistCratByNm_B1"  column="XX_REC_HIST_CRAT_BY_NM"  javaType="EZDSStringItem" />
        <result property="xxRecHistUpdTs_B1"     column="XX_REC_HIST_UPD_TS"      javaType="EZDSStringItem" />
        <result property="xxRecHistUpdByNm_B1"   column="XX_REC_HIST_UPD_BY_NM"   javaType="EZDSStringItem" />
        <result property="xxRecHistTblNm_B1"     column="XX_REC_HIST_TBL_NM"      javaType="EZDSStringItem" />
        <!-- Add End   2016/11/09 M.Ohno S21_NA#2680 -->
        <!-- 2017/03/07 S21_NA#17760 Add Start -->
        <result property="dsOrgRelnPk_B1"     column="DS_ORG_RELN_PK"      javaType="EZDSBigDecimalItem" />
        <!-- 2017/03/07 S21_NA#17760 Add End -->
    </resultMap>

    <resultMap id="result.getTerritoryRules"  class="NMAL2610_CSMsg">
        <result property="trtyRuleTpCd_P1"           column="TRTY_RULE_TP_CD"         javaType="EZDSStringItem"/>
        <result property="trtyRuleOprdTpCd_P1"       column="TRTY_RULE_OPRD_TP_CD"    javaType="EZDSStringItem"/>
        <result property="trtyRuleFromValTxt_C1"     column="TRTY_RULE_FROM_VAL_TXT"  javaType="EZDSStringItem"/>
        <result property="trtyRuleThruValTxt_C1"     column="TRTY_RULE_THRU_VAL_TXT"  javaType="EZDSStringItem"/>
        <result property="trtyRuleLogicTpCd_P1"      column="TRTY_RULE_LOGIC_TP_CD"   javaType="EZDSStringItem"/>
        <result property="effFromDt_C1"              column="EFF_FROM_DT"             javaType="EZDCDateItem"/>
        <result property="effThruDt_C1"              column="EFF_THRU_DT"             javaType="EZDCDateItem"/>
        <result property="ezUpTime_X3"               column="EZUPTIME_RULE"           javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_X3"           column="EZUPTIMEZONE_RULE"       javaType="EZDSStringItem"/>
        <result property="trtyRulePk_X3"             column="TRTY_RULE_PK_RULE"       javaType="EZDCBigDecimalItem"/>
        <!-- Add Start 2016/11/09 M.Ohno S21_NA#2680 -->
        <result property="xxRecHistCratTs_C1"    column="XX_REC_HIST_CRAT_TS"     javaType="EZDSStringItem" />
        <result property="xxRecHistCratByNm_C1"  column="XX_REC_HIST_CRAT_BY_NM"  javaType="EZDSStringItem" />
        <result property="xxRecHistUpdTs_C1"     column="XX_REC_HIST_UPD_TS"      javaType="EZDSStringItem" />
        <result property="xxRecHistUpdByNm_C1"   column="XX_REC_HIST_UPD_BY_NM"   javaType="EZDSStringItem" />
        <result property="xxRecHistTblNm_C1"     column="XX_REC_HIST_TBL_NM"      javaType="EZDSStringItem" />
        <!-- Add End   2016/11/09 M.Ohno S21_NA#2680 -->
    </resultMap>

    <resultMap id="result.getResource"  class="NMAL2610_DSMsg">
        <result property="psnFirstNm_D1"         column="PSN_FIRST_NM"                javaType="EZDSStringItem"/>
        <result property="psnLastNm_D1"          column="PSN_LAST_NM"                 javaType="EZDSStringItem"/>
        <result property="xxPsnNm_D1"            column="XX_PSN_NM"                   javaType="EZDSStringItem"/>
        <result property="psnCd_D1"              column="PSN_CD"                      javaType="EZDSStringItem"/>
        <result property="psnNum_D1"             column="PSN_NUM"                     javaType="EZDSStringItem"/>
        <result property="acctTeamRoleTpCd_P1"   column="ACCT_TEAM_ROLE_TP_CD"        javaType="EZDSStringItem"/>
        <result property="effFromDt_D1"          column="EFF_FROM_DT"                 javaType="EZDCDateItem"/>
        <result property="effThruDt_D1"          column="EFF_THRU_DT"                 javaType="EZDCDateItem"/>
        <result property="gnrnTpCd_D1"           column="GNRN_TP_CD"                  javaType="EZDSStringItem"/>
        <result property="ezUpTime_X4"           column="EZUPTIME_RELN"               javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_X4"       column="EZUPTIMEZONE_RELN"           javaType="EZDSStringItem"/>
        <result property="orgCd_X4"              column="ORG_CD_RELN"                 javaType="EZDSStringItem"/>
        <result property="orgStruTpCd_X4"        column="ORG_STRU_TP_CD_RELN"         javaType="EZDSStringItem"/>
        <result property="psnCd_X4"              column="PSN_CD_RELN"                 javaType="EZDSStringItem"/>
        <result property="orgFuncRoleTpCd_X4"    column="ORG_FUNC_ROLE_TP_CD_RELN"    javaType="EZDSStringItem"/>
        <result property="effFromDt_X4"          column="EFF_FROM_DT_RELN"            javaType="EZDCDateItem"/>
        <result property="effFromDt_D2"          column="EFF_FROM_DT_PSN"             javaType="EZDCDateItem"/>
        <result property="effThruDt_D2"          column="EFF_THRU_DT_PSN"             javaType="EZDCDateItem"/>
        <!-- Add Start 2016/11/09 M.Ohno S21_NA#2680 -->
        <result property="xxRecHistCratTs_D1"    column="XX_REC_HIST_CRAT_TS"     javaType="EZDSStringItem" />
        <result property="xxRecHistCratByNm_D1"  column="XX_REC_HIST_CRAT_BY_NM"  javaType="EZDSStringItem" />
        <result property="xxRecHistUpdTs_D1"     column="XX_REC_HIST_UPD_TS"      javaType="EZDSStringItem" />
        <result property="xxRecHistUpdByNm_D1"   column="XX_REC_HIST_UPD_BY_NM"   javaType="EZDSStringItem" />
        <result property="xxRecHistTblNm_D1"     column="XX_REC_HIST_TBL_NM"      javaType="EZDSStringItem" />
        <!-- Add End   2016/11/09 M.Ohno S21_NA#2680 -->
    </resultMap>

    <statement id="getBizAreaOrgPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
               ORG.BIZ_AREA_ORG_CD
              ,ORG.BIZ_AREA_ORG_NM
          FROM
               BIZ_AREA_ORG ORG
              ,ORG_STRU_TP STRU
         WHERE
               ORG.GLBL_CMPY_CD   = #glblCmpyCd#
           AND ORG.EZCANCELFLAG   = '0'
           AND STRU.GLBL_CMPY_CD  = #glblCmpyCd#
           AND STRU.EZCANCELFLAG  = '0'
           AND ORG.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
           AND TRTY_STRU_FLG = #trtyStruFlg#
         ORDER BY
               ORG.BIZ_AREA_ORG_SORT_NUM
    </statement>

    <statement id="getOrgTierPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
               TIER.ORG_TIER_CD
              ,TIER.ORG_TIER_NM
          FROM
               ORG_TIER TIER
         WHERE
               TIER.GLBL_CMPY_CD  = #glblCmpyCd#
           AND TIER.EZCANCELFLAG  = '0'
           AND TIER.ORG_TIER_CD &gt; '0'
         ORDER BY
               TIER.ORG_TIER_SORT_NUM
   </statement>

    <statement id="getTrtyRulePulldownList" parameterClass="Map" resultClass="Map">
        SELECT
               RULE.TRTY_RULE_TP_CD
              ,RULE.TRTY_RULE_TP_DESC_TXT
          FROM
               TRTY_RULE_TP RULE
         WHERE
               RULE.GLBL_CMPY_CD   = #glblCmpyCd#
           AND RULE.EZCANCELFLAG   = '0'
           AND RULE.ORG_STRU_TP_CD = #orgStruTp_TS#
         ORDER BY
               RULE.TRTY_RULE_TP_SORT_NUM
   </statement>

   <statement id="getTerritory" parameterClass="Map" resultMap="result.getTerritory">
        SELECT
            ORG.ORG_CD
           ,ORG.FIRST_ORG_CD
           ,ORG.TRTY_TP_CD
           ,ORG.ORG_NM
           ,ORG.ORG_TIER_CD
           ,ORG.ORG_DESC_TXT
           ,ORG.TRTY_GRP_TP_CD
           ,ORG.EFF_FROM_DT
           ,ORG.EFF_THRU_DT
           ,ORG.EZUPTIME AS EZUPTIME_ORG
           ,ORG.EZUPTIMEZONE AS EZUPTIMEZONE_ORG
           <!-- Add Start 2016/11/09 M.Ohno S21_NA#2680 -->
           , ORG.EZINTIME             AS XX_REC_HIST_CRAT_TS
           , ORG.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
           , ORG.EZUPTIME             AS XX_REC_HIST_UPD_TS
           , ORG.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
           , 'DS_ORG_UNIT'            AS XX_REC_HIST_TBL_NM
           <!-- Add End   2016/11/09 M.Ohno S21_NA#2680 -->
        FROM
            DS_ORG_UNIT ORG
            ,ORG_STRU_TP STRU
        WHERE
            ORG.GLBL_CMPY_CD = #glblCmpyCd#
        AND ORG.EZCANCELFLAG = '0'
        AND STRU.GLBL_CMPY_CD = #glblCmpyCd#
        AND STRU.EZCANCELFLAG = '0'
        AND ORG.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
        AND STRU.TRTY_STRU_FLG = #trtyStruFlg#
        <isNotNull property="cMsg.orgCd_H1">
        AND ORG.ORG_CD = #cMsg.orgCd_H1#
        </isNotNull>
        <isNull property="cMsg.orgCd_H1">
            <isNotNull property="cMsg.orgNm_H1">
            AND ORG.ORG_NM = #cMsg.orgNm_H1#
            </isNotNull>
            <isNull property="cMsg.orgNm_H1">
                <isNotNull property="cMsg.bizAreaOrgCd_P1">
                AND ORG.FIRST_ORG_CD = #cMsg.bizAreaOrgCd_P1#
                </isNotNull>
                <isNotNull property="cMsg.trtyTpCd_P1">
                AND ORG.TRTY_TP_CD = #cMsg.trtyTpCd_P1#
                </isNotNull>
                <isNotNull property="cMsg.orgTierCd_P1">
                AND ORG.ORG_TIER_CD = #cMsg.orgTierCd_P1#
                </isNotNull>
                <isNotNull property="cMsg.orgDescTxt_H1">
                AND ORG.ORG_DESC_TXT = #cMsg.orgDescTxt_H1#
                </isNotNull>
                <isNotNull property="cMsg.trtyGrpTpCd_P1">
                AND ORG.TRTY_GRP_TP_CD = #cMsg.trtyGrpTpCd_P1#
                </isNotNull>
                <isNotNull property="cMsg.effFromDt_H1">
                AND ORG.EFF_FROM_DT &lt;= #cMsg.effFromDt_H1#
                </isNotNull>
                <isNotNull property="cMsg.effThruDt_H1">
                AND NVL(ORG.EFF_THRU_DT, #maxeffThruDt#) &gt;= #cMsg.effThruDt_H1#
                </isNotNull>
                <!-- QC#7966
                <isNotNull property="cMsg.xxChkBox_H1">
                AND (ORG.GNRN_TP_CD = #gnrnTpCdCurrent# OR ORG.GNRN_TP_CD =#gnrnTpCdFuture#)
                </isNotNull>
                 -->
            </isNull>
        </isNull>
   </statement>
   
   <statement id="getTerritoryParent" parameterClass="Map" resultMap="result.getTerritoryParent">
        WITH ORG_REN AS(
            SELECT
                RELN.*
            FROM
                DS_ORG_RELN RELN
                ,ORG_STRU_TP STRU
            WHERE
                RELN.GLBL_CMPY_CD = #glblCmpyCd#
            AND RELN.EZCANCELFLAG = '0'
            AND RELN.GLBL_CMPY_CD = STRU.GLBL_CMPY_CD
            AND RELN.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
            AND STRU.EZCANCELFLAG = '0'
            AND STRU.TRTY_STRU_FLG = #trtyStruFlg#
            <!-- QC#7966 -->
            <isNull property="cMsg.xxChkBox_F1" >
            AND (RELN.GNRN_TP_CD = #gnrnTpCdCurrent# OR RELN.GNRN_TP_CD =#gnrnTpCdFuture#)
            </isNull>
            <isNotNull property="cMsg.xxChkBox_F1" >
            AND RELN.GNRN_TP_CD != #gnrnTpCdDelete#
            AND RELN.GNRN_TP_CD != #gnrnTpCdTerminated#
            </isNotNull>
        )
        ,ORG_PRNT AS(
            SELECT
                ORG_PRNT.*
            FROM
                DS_ORG_UNIT ORG_PRNT
                ,ORG_STRU_TP STRU
            WHERE
                ORG_PRNT.GLBL_CMPY_CD = #glblCmpyCd#
            AND ORG_PRNT.EZCANCELFLAG = '0'
            AND ORG_PRNT.GLBL_CMPY_CD = STRU.GLBL_CMPY_CD
            AND ORG_PRNT.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
            AND STRU.EZCANCELFLAG = '0'
            AND STRU.TRTY_STRU_FLG = #trtyStruFlg#
            <!-- QC#7966 -->
            <isNull property="cMsg.xxChkBox_F1">
            AND (ORG_PRNT.GNRN_TP_CD = #gnrnTpCdCurrent# OR ORG_PRNT.GNRN_TP_CD =#gnrnTpCdFuture#)
            </isNull>
        )
 
        SELECT
             ORG_PRNT.ORG_NM AS ORG_NM
            ,ORG_REN.PRNT_ORG_CD AS ORG_CD
            ,ORG_REN.EFF_FROM_DT AS EFF_FROM_DT
            ,ORG_REN.EFF_THRU_DT AS EFF_THRU_DT
            ,ORG_REN.GNRN_TP_CD AS GNRN_TP_CD
            ,ORG.EZUPTIME AS EZUPTIME_ORG
            ,ORG.EZUPTIMEZONE AS EZUPTIMEZONE_ORG
            ,ORG.ORG_CD AS ORG_CD_ORG
            ,ORG_REN.EZUPTIME AS EZUPTIME_RELN
            ,ORG_REN.EZUPTIMEZONE AS EZUPTIMEZONE_RELN
            ,ORG_REN.ORG_CD AS ORG_CD_RELN
            ,ORG_REN.PRNT_ORG_CD AS PRNT_ORG_CD_RELN
            ,ORG_REN.ORG_STRU_TP_CD AS ORG_STRU_TP_CD_RELN
            ,ORG_REN.EFF_FROM_DT AS EFF_FROM_DT_RELN
            ,ORG_PRNT.FIRST_ORG_CD AS FIRST_ORG_CD_TRTY
            ,ORG_PRNT.ORG_TIER_CD AS ORG_TIER_CD_TRTY
            ,ORG_PRNT.EFF_FROM_DT AS EFF_FROM_DT_TRTY
            ,ORG_PRNT.EFF_THRU_DT AS EFF_THRU_DT_TRTY
            <!-- Add Start 2016/11/09 M.Ohno S21_NA#2680 -->
            , ORG_REN.EZINTIME             AS XX_REC_HIST_CRAT_TS
            , ORG_REN.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
            , ORG_REN.EZUPTIME             AS XX_REC_HIST_UPD_TS
            , ORG_REN.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
            , 'DS_ORG_RELN'                AS XX_REC_HIST_TBL_NM
            <!-- Add End   2016/11/09 M.Ohno S21_NA#2680 -->
            <!-- 2017/03/07 S21_NA#17760 Add Start -->
            , ORG_REN.DS_ORG_RELN_PK AS DS_ORG_RELN_PK
            <!-- 2017/03/07 S21_NA#17760 Add End -->
        FROM
            DS_ORG_UNIT ORG
            ,ORG_REN
            ,ORG_PRNT
            ,ORG_STRU_TP STRU
        WHERE
            ORG.GLBL_CMPY_CD = #glblCmpyCd#
        AND ORG.GLBL_CMPY_CD = STRU.GLBL_CMPY_CD
        AND ORG.GLBL_CMPY_CD = ORG_REN.GLBL_CMPY_CD
        AND ORG_REN.GLBL_CMPY_CD = ORG_PRNT.GLBL_CMPY_CD
        AND STRU.EZCANCELFLAG = '0'
        AND ORG.EZCANCELFLAG = '0'
        AND ORG.ORG_CD = ORG_REN.ORG_CD
        AND ORG_REN.PRNT_ORG_CD = ORG_PRNT.ORG_CD
        AND ORG.ORG_STRU_TP_CD = ORG_REN.ORG_STRU_TP_CD
        AND ORG_REN.ORG_STRU_TP_CD = ORG_PRNT.ORG_STRU_TP_CD
        AND ORG.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
        AND STRU.TRTY_STRU_FLG = #trtyStruFlg#
        AND ORG.ORG_CD = #cMsg.orgCd_H1#
        <!-- QC#7966 -->
        <isNull property="cMsg.xxChkBox_F1">
        AND (ORG.GNRN_TP_CD = #gnrnTpCdCurrent# OR ORG.GNRN_TP_CD =#gnrnTpCdFuture#)
        </isNull>
        <!-- QC#7966
        <isNotEqual property="filter" compareValue='N'>
        AND ORG.ORG_NM LIKE #cMsg.orgNm_F1#
        </isNotEqual>
         -->
        AND ORG_PRNT.ORG_TIER_CD &gt;= #firstTierCd#
        ORDER BY
            ORG_REN.PRNT_ORG_CD, ORG_REN.EFF_FROM_DT DESC
   </statement>
   
   <statement id="getTerritoryChild" parameterClass="Map" resultMap="result.getTerritoryChild">
        WITH ORG_REN AS(
            SELECT
                RELN.*
            FROM
                DS_ORG_RELN RELN
                ,ORG_STRU_TP STRU
            WHERE
                RELN.GLBL_CMPY_CD = #glblCmpyCd#
            AND RELN.EZCANCELFLAG = '0'
            AND RELN.GLBL_CMPY_CD = STRU.GLBL_CMPY_CD
            AND RELN.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
            AND STRU.EZCANCELFLAG = '0'
            AND STRU.TRTY_STRU_FLG = #trtyStruFlg#
            <!-- QC#7966 -->
            <isNull property="cMsg.xxChkBox_F1">
            AND (RELN.GNRN_TP_CD = #gnrnTpCdCurrent# OR RELN.GNRN_TP_CD =#gnrnTpCdFuture#)
            </isNull>
            <isNotNull property="cMsg.xxChkBox_F1">
            AND RELN.GNRN_TP_CD != #gnrnTpCdDelete#
            AND RELN.GNRN_TP_CD != #gnrnTpCdTerminated#
            </isNotNull>
        )
        ,ORG_CHLD AS(
            SELECT
                ORG_CHLD.*
            FROM
                DS_ORG_UNIT ORG_CHLD
                ,ORG_STRU_TP STRU
            WHERE
                ORG_CHLD.GLBL_CMPY_CD = #glblCmpyCd#
            AND ORG_CHLD.EZCANCELFLAG = '0'
            AND ORG_CHLD.GLBL_CMPY_CD = STRU.GLBL_CMPY_CD
            AND ORG_CHLD.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
            AND STRU.EZCANCELFLAG = '0'
            AND STRU.TRTY_STRU_FLG = #trtyStruFlg#
            <!-- QC#7966 -->
            <isNull property="cMsg.xxChkBox_F1">
            AND (ORG_CHLD.GNRN_TP_CD = #gnrnTpCdCurrent# OR ORG_CHLD.GNRN_TP_CD =#gnrnTpCdFuture#)
            </isNull>
        )
        SELECT
             ORG_CHLD.ORG_NM AS ORG_NM
            ,ORG_CHLD.ORG_CD AS ORG_CD
            ,ORG_REN.EFF_FROM_DT AS EFF_FROM_DT
            ,ORG_REN.EFF_THRU_DT AS EFF_THRU_DT
            ,ORG_CHLD.FIRST_ORG_CD AS FIRST_ORG_CD_TRTY
            ,ORG_CHLD.ORG_TIER_CD AS ORG_TIER_CD_TRTY
            ,ORG_CHLD.EFF_FROM_DT AS EFF_FROM_DT_TRTY
            ,ORG_CHLD.EFF_THRU_DT AS EFF_THRU_DT_TRTY
            ,ORG_REN.EZUPTIME AS EZUPTIME_RELN
            ,ORG_REN.EZUPTIMEZONE AS EZUPTIMEZONE_RELN
            <!-- Add Start 2016/11/09 M.Ohno S21_NA#2680 -->
            , ORG_REN.EZINTIME             AS XX_REC_HIST_CRAT_TS
            , ORG_REN.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
            , ORG_REN.EZUPTIME             AS XX_REC_HIST_UPD_TS
            , ORG_REN.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
            , 'DS_ORG_RELN'                AS XX_REC_HIST_TBL_NM
            <!-- Add End   2016/11/09 M.Ohno S21_NA#2680 -->
            <!-- 2017/03/07 S21_NA#17760 Add Start -->
            , ORG_REN.DS_ORG_RELN_PK AS DS_ORG_RELN_PK
            <!-- 2017/03/07 S21_NA#17760 Add End -->
        FROM
            DS_ORG_UNIT ORG
            ,ORG_REN
            ,ORG_CHLD
            ,ORG_STRU_TP STRU
        WHERE
            ORG.GLBL_CMPY_CD = #glblCmpyCd#
        AND ORG.GLBL_CMPY_CD = ORG_REN.GLBL_CMPY_CD
        AND ORG_REN.GLBL_CMPY_CD = ORG_CHLD.GLBL_CMPY_CD
        AND ORG.GLBL_CMPY_CD = STRU.GLBL_CMPY_CD
        AND ORG.EZCANCELFLAG = '0'
        AND STRU.EZCANCELFLAG = '0'
        AND ORG.ORG_CD = ORG_REN.PRNT_ORG_CD
        AND ORG_REN.ORG_CD = ORG_CHLD.ORG_CD
        AND ORG.ORG_STRU_TP_CD = ORG_REN.ORG_STRU_TP_CD
        AND ORG_REN.ORG_STRU_TP_CD = ORG_CHLD.ORG_STRU_TP_CD
        AND ORG.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
        AND STRU.TRTY_STRU_FLG = #trtyStruFlg#
        AND ORG.ORG_CD = #cMsg.orgCd_H1#
        <!-- QC#7966 -->
        <isNull property="cMsg.xxChkBox_F1">
        AND (ORG.GNRN_TP_CD = #gnrnTpCdCurrent# OR ORG.GNRN_TP_CD =#gnrnTpCdFuture#)
        </isNull>
        ORDER BY
            ORG_REN.ORG_CD, ORG_REN.EFF_FROM_DT DESC
   </statement>
   
   <statement id="getTerritoryRules" parameterClass="Map" resultMap="result.getTerritoryRules">
        SELECT
            RULE.ORG_CD
            ,RULE.TRTY_RULE_TP_CD
            ,RULE.TRTY_RULE_OPRD_TP_CD
            ,RULE.TRTY_RULE_FROM_VAL_TXT
            ,RULE.TRTY_RULE_THRU_VAL_TXT
            ,RULE.TRTY_RULE_LOGIC_TP_CD
            ,RULE.EFF_FROM_DT
            ,RULE.EFF_THRU_DT
            ,RULE.EZUPTIME AS EZUPTIME_RULE
            ,RULE.EZUPTIMEZONE AS EZUPTIMEZONE_RULE
            ,RULE.TRTY_RULE_PK AS TRTY_RULE_PK_RULE
            <!-- Add Start 2016/11/09 M.Ohno S21_NA#2680 -->
            , RULE.EZINTIME             AS XX_REC_HIST_CRAT_TS
            , RULE.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
            , RULE.EZUPTIME             AS XX_REC_HIST_UPD_TS
            , RULE.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
            , 'TRTY_RULE'                AS XX_REC_HIST_TBL_NM
            <!-- Add End   2016/11/09 M.Ohno S21_NA#2680 -->
        FROM
            DS_ORG_UNIT ORG
            ,ORG_STRU_TP STRU
            ,TRTY_RULE RULE
        WHERE
            ORG.GLBL_CMPY_CD = #glblCmpyCd#
        AND STRU.GLBL_CMPY_CD = #glblCmpyCd#
        AND RULE.GLBL_CMPY_CD = #glblCmpyCd#
        AND ORG.EZCANCELFLAG = '0'
        AND STRU.EZCANCELFLAG = '0'
        AND RULE.EZCANCELFLAG = '0'
        AND ORG.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
        AND RULE.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
        AND STRU.TRTY_STRU_FLG = #trtyStruFlg#
        AND ORG.ORG_CD = RULE.ORG_CD
        AND ORG.ORG_CD = #cMsg.orgCd_H1#
        <isNull property="chkBox" >
        AND RULE.EFF_FROM_DT &lt;= #slsDt#
        AND NVL(RULE.EFF_THRU_DT,#maxeffThruDt#) &gt;= #slsDt#
        </isNull>
        <isNotNull property="cMsg.trtyRuleFromValTxt_F1" >
        AND RULE.TRTY_RULE_FROM_VAL_TXT LIKE #cMsg.trtyRuleFromValTxt_F1#
        </isNotNull>
        <isNotNull property="cMsg.trtyRuleThruValTxt_F1" >
        AND RULE.TRTY_RULE_THRU_VAL_TXT LIKE #cMsg.trtyRuleThruValTxt_F1#
        </isNotNull>
        <!-- 2019/05/13 QC#50128 Add Start -->
        AND ROWNUM     &lt;= #rowNum#
        <!-- 2019/05/13 QC#50128 Add End -->
        ORDER BY
            RULE.TRTY_RULE_LOGIC_TP_CD NULLS LAST
           ,RULE.TRTY_RULE_PK
   </statement>
   
   <!-- QC#7966 -->
   <statement id="getTerritoryRulesWithoutFilter" parameterClass="Map" resultClass="Map">
        SELECT
             RULE.ORG_CD
            ,RULE.TRTY_RULE_TP_CD
            ,RULE.TRTY_RULE_OPRD_TP_CD
            ,RULE.TRTY_RULE_FROM_VAL_TXT
            ,RULE.TRTY_RULE_THRU_VAL_TXT
            ,RULE.TRTY_RULE_LOGIC_TP_CD
            ,RULE.EFF_FROM_DT
            ,RULE.EFF_THRU_DT
            ,RULE.EZUPTIME AS EZUPTIME_RULE
            ,RULE.EZUPTIMEZONE AS EZUPTIMEZONE_RULE
            ,RULE.TRTY_RULE_PK AS TRTY_RULE_PK_RULE
        FROM
             DS_ORG_UNIT ORG
            ,ORG_STRU_TP STRU
            ,TRTY_RULE RULE
        WHERE
            ORG.GLBL_CMPY_CD = #glblCmpyCd#
        AND STRU.GLBL_CMPY_CD = #glblCmpyCd#
        AND RULE.GLBL_CMPY_CD = #glblCmpyCd#
        AND ORG.EZCANCELFLAG = '0'
        AND STRU.EZCANCELFLAG = '0'
        AND RULE.EZCANCELFLAG = '0'
        AND ORG.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
        AND RULE.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
        AND STRU.TRTY_STRU_FLG = #trtyStruFlg#
        AND ORG.ORG_CD = RULE.ORG_CD
        AND ORG.ORG_CD = #cMsg.orgCd_H1#
        <isNull property="chkBox" >
        AND RULE.EFF_FROM_DT &lt;= #slsDt#
        AND NVL(RULE.EFF_THRU_DT,#maxeffThruDt#) &gt;= #slsDt#
        </isNull>
        ORDER BY
            RULE.TRTY_RULE_LOGIC_TP_CD NULLS LAST
           ,RULE.TRTY_RULE_PK
   </statement>
   
   <statement id="getResource" parameterClass="Map" resultMap="result.getResource">
        SELECT
            PSN.PSN_FIRST_NM
            ,PSN.PSN_LAST_NM
            ,NVL(PSN.PSN_FIRST_NM ,'') || ', ' || NVL(PSN.PSN_LAST_NM ,'') AS XX_PSN_NM
            ,PSN.PSN_CD
            ,PSN.PSN_NUM
            ,RELN.ACCT_TEAM_ROLE_TP_CD
            ,RELN.EFF_FROM_DT
            ,RELN.EFF_THRU_DT
            ,RELN.GNRN_TP_CD AS GNRN_TP_CD
            ,RELN.EZUPTIME AS EZUPTIME_RELN
            ,RELN.EZUPTIMEZONE AS EZUPTIMEZONE_RELN
            ,RELN.ORG_CD AS ORG_CD_RELN
            ,RELN.ORG_STRU_TP_CD AS ORG_STRU_TP_CD_RELN
            ,RELN.PSN_CD AS PSN_CD_RELN
            ,RELN.ORG_FUNC_ROLE_TP_CD AS ORG_FUNC_ROLE_TP_CD_RELN
            ,RELN.EFF_FROM_DT AS EFF_FROM_DT_RELN
            ,PSN.EFF_FROM_DT AS EFF_FROM_DT_PSN
            ,PSN.EFF_THRU_DT AS EFF_THRU_DT_PSN
            <!-- Add Start 2016/11/09 M.Ohno S21_NA#2680 -->
            , RELN.EZINTIME             AS XX_REC_HIST_CRAT_TS
            , RELN.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
            , RELN.EZUPTIME             AS XX_REC_HIST_UPD_TS
            , RELN.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
            , 'DS_ORG_RESRC_RELN'       AS XX_REC_HIST_TBL_NM
            <!-- Add End   2016/11/09 M.Ohno S21_NA#2680 -->
        FROM
            DS_ORG_UNIT ORG
            ,ORG_STRU_TP STRU
            ,DS_ORG_RESRC_RELN RELN
            ,S21_PSN PSN
        WHERE
            ORG.GLBL_CMPY_CD = #glblCmpyCd#
        AND ORG.GLBL_CMPY_CD = STRU.GLBL_CMPY_CD
        AND ORG.GLBL_CMPY_CD = RELN.GLBL_CMPY_CD
        AND ORG.GLBL_CMPY_CD = PSN.GLBL_CMPY_CD
        AND ORG.EZCANCELFLAG = '0'
        AND STRU.EZCANCELFLAG = '0'
        AND RELN.EZCANCELFLAG = '0'
        AND PSN.EZCANCELFLAG = '0'
        AND ORG.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
        AND RELN.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
        AND STRU.TRTY_STRU_FLG = #trtyStruFlg#
        AND ORG.ORG_CD = RELN.ORG_CD
        AND RELN.PSN_CD = PSN.PSN_CD
        AND ORG.ORG_CD = #cMsg.orgCd_H1#
        <!-- QC#7966 -->
        <isNull property="cMsg.xxChkBox_F3">
        AND (RELN.GNRN_TP_CD = #gnrnTpCdCurrent# OR RELN.GNRN_TP_CD =#gnrnTpCdFuture#)
        </isNull>
        <isNotNull property="cMsg.xxChkBox_F3">
        AND RELN.GNRN_TP_CD != #gnrnTpCdDelete#
        AND RELN.GNRN_TP_CD != #gnrnTpCdTerminated#
        </isNotNull>
        <isNotNull property="copyTrtyFlg">
        AND RELN.EFF_FROM_DT &lt;= #slsDt#
        AND NVL(RELN.EFF_THRU_DT,#maxeffThruDt#) &gt;= #slsDt#
        </isNotNull>
        ORDER BY
            RELN.PSN_CD
   </statement>

   <statement id="getResourceAdditional" parameterClass="Map" resultClass="Map">
        WITH ACTIVE_ROLE AS(
            SELECT
                DISTINCT ASG.PSN_CD
                ,RQST.ORG_FUNC_ROLE_TP_CD
            FROM
                ORG_FUNC_ASG ASG
                ,ORG_TOC_CHNG_RQST RQST
            WHERE
                ASG.GLBL_CMPY_CD = #glblCmpyCd#
            AND ASG.EZCANCELFLAG = '0'
            AND RQST.GLBL_CMPY_CD = #glblCmpyCd#
            AND RQST.EZCANCELFLAG = '0'
            AND ASG.TOC_CD = RQST.TOC_CD
            AND ASG.GNRN_TP_CD IN (#gnrnTpCdCurrent#, #gnrnTpCdFuture#)
            AND RQST.RGTN_STS_CD IN (#rgtnStsCdP01#, #rgtnStsCdP20#)
        )
        SELECT
            NVL(PSN.PSN_FIRST_NM,'') || ', ' || NVL(PSN.PSN_LAST_NM,'') AS XX_PSN_NM
            ,ROLE.ORG_FUNC_ROLE_TP_CD AS ORG_FUNC_ROLE_TP_CD
            ,PSN.EFF_FROM_DT AS EFF_FROM_DT_PSN
            ,PSN.EFF_THRU_DT AS EFF_THRU_DT_PSN
        FROM
            S21_PSN PSN
            ,ACTIVE_ROLE ROLE
        WHERE
            PSN.GLBL_CMPY_CD = #glblCmpyCd#
        AND PSN.EZCANCELFLAG = '0'
        AND PSN.PSN_CD = ROLE.PSN_CD
        AND PSN.PSN_CD = #psnCd#
   </statement>
   
   <statement id="getTerritoryAdditional" parameterClass="Map" resultClass="Map">
        SELECT
            ORG.ORG_CD
            ,ORG.FIRST_ORG_CD AS FIRST_ORG_CD_TRTY
            ,ORG.ORG_TIER_CD AS ORG_TIER_CD_TRTY
            ,ORG.EFF_FROM_DT AS EFF_FROM_DT_TRTY
            ,ORG.EFF_THRU_DT AS EFF_THRU_DT_TRTY
        FROM
            DS_ORG_UNIT ORG
            ,ORG_STRU_TP STRU
        WHERE
            ORG.GLBL_CMPY_CD = #glblCmpyCd#
        AND ORG.EZCANCELFLAG = '0'
        AND ORG.GLBL_CMPY_CD = STRU.GLBL_CMPY_CD
        AND STRU.EZCANCELFLAG = '0'
        AND ORG.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
        AND STRU.TRTY_STRU_FLG = #trtyStruFlg#
        AND ORG.ORG_CD = #orgCd#
   </statement>

   <statement id="getZeroTierOrg" parameterClass="Map" resultClass="Map">
        SELECT
            ORG.ORG_CD
            ,ORG.EFF_FROM_DT
            ,ORG.EFF_THRU_DT
            ,ORG.GNRN_TP_CD
        FROM
            DS_ORG_UNIT ORG
            ,ORG_STRU_TP STRU
        WHERE
            ORG.GLBL_CMPY_CD = #glblCmpyCd#
        AND STRU.GLBL_CMPY_CD = #glblCmpyCd#
        AND ORG.EZCANCELFLAG = '0'
        AND STRU.EZCANCELFLAG = '0'
        AND ORG.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
        AND STRU.TRTY_STRU_FLG = #trtyStruFlg#
        AND ORG.ORG_TIER_CD = #orgTierCd#
        AND ORG.FIRST_ORG_CD = #cMsg.bizAreaOrgCd_P1#
   </statement>

   <statement id="getTerritoryByName" parameterClass="Map" resultClass="Map">
        SELECT
            ORG.ORG_CD
            ,ORG.FIRST_ORG_CD AS FIRST_ORG_CD_TRTY
            ,ORG.ORG_TIER_CD  AS ORG_TIER_CD_TRTY
        FROM
             DS_ORG_UNIT ORG
            ,ORG_STRU_TP STRU
        WHERE
            ORG.GLBL_CMPY_CD    =  #glblCmpyCd#
        AND ORG.ORG_NM          =  #orgNm#
        AND ORG.EFF_FROM_DT     &lt;=  #effFromDt#
        <isNotNull property="effThruDt">
        AND NVL(ORG.EFF_THRU_DT, #maxeffThruDt#) &gt;= #effThruDt#
        </isNotNull>
        AND ORG.EZCANCELFLAG     =  '0'
        AND ORG.ORG_STRU_TP_CD   =  STRU.ORG_STRU_TP_CD
        AND ORG.GLBL_CMPY_CD     =  STRU.GLBL_CMPY_CD
        AND STRU.TRTY_STRU_FLG   =  #trtyStruFlg#
        AND STRU.EZCANCELFLAG    =  '0'
        ORDER BY
            ORG.ORG_CD
   </statement>

   <statement id="getTierDescription" parameterClass="Map" resultClass="String">
        SELECT
            SD.STRU_DFN_DESC_TXT AS STRU_DFN_DESC_TXT
        FROM
             STRU_DFN SD 
            ,ORG_HRCH_STRU_DFN OH
            ,ORG_STRU_TP OST
        WHERE
            SD.GLBL_CMPY_CD     = #glblCmpyCd#
        AND SD.EZCANCELFLAG     = '0'
        AND SD.GLBL_CMPY_CD     = OH.GLBL_CMPY_CD
        AND SD.STRU_DFN_CD      = OH.STRU_DFN_CD
        AND OH.BIZ_AREA_ORG_CD  = #bizAreaOrgCd#
        AND OH.ORG_TIER_CD      = #orgTierCd#
        AND OH.EFF_FROM_DT  &lt;= #slsDt#
        AND NVL(OH.EFF_THRU_DT, #maxeffThruDt#) &gt;= #slsDt#
        AND OH.EZCANCELFLAG     = '0'
        AND OH.GLBL_CMPY_CD     = OST.GLBL_CMPY_CD
        AND OH.ORG_STRU_TP_CD   = OST.ORG_STRU_TP_CD
        AND OST.TRTY_STRU_FLG   = 'Y'
        AND OST.EZCANCELFLAG    = '0'
        ORDER BY
            SD.STRU_DFN_CD
   </statement>

   <statement id="checkActiveSalesRepRoll" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(BAO.BIZ_AREA_ORG_CD)
        FROM
            ORG_FUNC_ASG ASG
         ,  TOC_ORG_STRU_RELN RELN
         ,  DS_ORG_UNIT  ORG
         ,  BIZ_AREA_ORG BAO
        WHERE
            ASG.PSN_CD           =  #psnCd#
        AND ASG.GLBL_CMPY_CD     =  #glblCmpyCd#
       <!-- 2017/10/11 QC#21269 mod start -->
       <!--
        AND ASG.EFF_FROM_DT  &lt;=  #effFromDt#
       <isNotNull property= "effThruDt">
        AND NVL(ASG.EFF_THRU_DT, #maxEffThruDate#) &gt;= #effThruDt#
       </isNotNull>
       -->
       <isNotNull property= "effThruDt">
        AND ASG.EFF_FROM_DT  &lt;= #effThruDt#
       </isNotNull>
        AND NVL(ASG.EFF_THRU_DT, #maxEffThruDate#) &gt;= #effFromDt#
        AND ASG.EZCANCELFLAG     =  0

        AND ASG.TOC_CD           =  RELN.TOC_CD
        AND ASG.GLBL_CMPY_CD     =  RELN.GLBL_CMPY_CD
       <!-- 
        AND RELN.EFF_FROM_DT &lt;=  #effFromDt#
       <isNotNull property= "effThruDt">
        AND NVL(RELN.EFF_THRU_DT, #maxEffThruDate#) &gt;= #effThruDt#
       </isNotNull>
       -->
       <isNotNull property= "effThruDt">
        AND RELN.EFF_FROM_DT &lt;= #effThruDt#
       </isNotNull>
        AND NVL(RELN.EFF_THRU_DT, #maxEffThruDate#) &gt;= #effFromDt#
        AND RELN.EZCANCELFLAG    =  0
        <!-- 2017/10/11 QC#21269 mod end -->

        AND RELN.ORG_CD          =  ORG.ORG_CD
        AND RELN.GLBL_CMPY_CD    =  ORG.GLBL_CMPY_CD
        AND ORG.EZCANCELFLAG     =  0

        AND ORG.FIRST_ORG_CD     =  BAO.BIZ_AREA_ORG_CD
        AND ORG.GLBL_CMPY_CD     =  BAO.GLBL_CMPY_CD
        AND BAO.SLS_FLG          =  #slsFlg#
        AND BAO.ORG_STRU_TP_CD   =  #orgStruTp#
        AND BAO.EZCANCELFLAG     =  0
   </statement>

   <statement id="alreadyTerritoryAssigned" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*) CNT
        FROM
            DS_ORG_RESRC_RELN RELN
            ,ORG_STRU_TP STRU
        WHERE
            RELN.GLBL_CMPY_CD = #glblCmpyCd#
        AND RELN.EZCANCELFLAG = '0'
        AND STRU.GLBL_CMPY_CD = #glblCmpyCd#
        AND STRU.EZCANCELFLAG = '0'
        AND RELN.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
        AND STRU.TRTY_STRU_FLG = #trtyStruFlg#
        AND RELN.GNRN_TP_CD IN(#gnrnTpCdCurrent# ,#gnrnTpCdFuture#)
        AND RELN.PSN_CD = #psnCd#
        AND RELN.ORG_CD != #orgCd#
   </statement>

   <statement id="checkDuplicateTerritoryName" parameterClass="Map" resultClass="String">
        SELECT
            ORG.ORG_CD
        FROM
            DS_ORG_UNIT ORG
           ,ORG_STRU_TP STRU
        WHERE
            ORG.GLBL_CMPY_CD = #glblCmpyCd#
        AND ORG.EZCANCELFLAG = '0'
        AND STRU.GLBL_CMPY_CD = #glblCmpyCd#
        AND STRU.EZCANCELFLAG = '0'
        AND ORG.ORG_NM = #orgNm#
        AND ORG.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
        AND STRU.TRTY_STRU_FLG = #trtyStruFlg#
        AND ROWNUM = 1
   </statement>

    <statement id="checkActiveChildOrganization" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(D.ORG_CD)
        FROM
            DS_ORG_RELN D
        WHERE
            D.PRNT_ORG_CD        = #orgCd#
        AND D.GLBL_CMPY_CD       = #glblCmpyCd#
        AND D.EZCANCELFLAG       = 0
        AND (  D.EFF_THRU_DT  &gt; #effThruDt#
            OR D.EFF_THRU_DT    IS NULL)
    </statement>

    <statement id="checkActiveResource" parameterClass="Map" resultClass="Integer">
        SELECT 
            COUNT(P.PSN_CD)
        FROM 
            S21_PSN P
        WHERE
            P.GLBL_CMPY_CD        =  #glblCmpyCd#
        AND P.PSN_CD              =  #psnCd#
        AND P.EFF_FROM_DT         &lt; NVL(#effThruDt# , #maxEffDt#)
        AND NVL(P.EFF_THRU_DT, #maxEffDt#)     &gt;  #effFromDt#
        AND P.EZCANCELFLAG        =  0
    </statement>

    <statement id="checkTerritoryBizArea" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(O.BIZ_AREA_ORG_CD)
        FROM
            BIZ_AREA_ORG O 
        WHERE
            O.SLS_FLG         = #slsFlg#
        AND O.ORG_STRU_TP_CD  = #orgStruTp_Territory#
        AND O.BIZ_AREA_ORG_CD = #bizArea#
        AND O.GLBL_CMPY_CD    = #glblCmpyCd#
        AND O.EZCANCELFLAG    =  0
    </statement>

    <statement id="checkSalesRepFlgOfTrtyGrp" parameterClass="Map" resultClass="Integer">
        SELECT 
            COUNT(TG.TRTY_GRP_TP_CD)
        FROM
            TRTY_GRP_TP TG
        WHERE
            TG.TRTY_GRP_TP_CD  = #trtyGrpTp#
        AND TG.GLBL_CMPY_CD    = #glblCmpyCd#
        AND TG.NON_SLS_REP_FLG = #flgOffN#
        AND TG.EZCANCELFLAG    = 0
    </statement>

    <statement id="checkSalesRep" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(ROLE.ORG_FUNC_ROLE_TP_CD)
        FROM
             ORG_FUNC_ASG      ASG
            ,ORG_TOC_CHNG_RQST RQST
            ,ORG_FUNC_ROLE_TP  ROLE
        WHERE
            ASG.GLBL_CMPY_CD     =  #glblCmpyCd#
        AND ASG.PSN_CD           =  #psnCd#
        AND ASG.EZCANCELFLAG     =  0
        AND ASG.GLBL_CMPY_CD     =  RQST.GLBL_CMPY_CD
        AND ASG.TOC_CD           =  RQST.TOC_CD
        AND RQST.EZCANCELFLAG    =  0
        AND RQST.GLBL_CMPY_CD    =  ROLE.GLBL_CMPY_CD
        AND RQST.ORG_FUNC_ROLE_TP_CD
                                 =  ROLE.ORG_FUNC_ROLE_TP_CD
        AND ROLE.SLS_REP_FLG     =  #slsRepFlg#
        AND ROLE.EZCANCELFLAG    =  0
    </statement>
    <statement id="checkSalesRoleAsgResrc" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(PSN.PSN_CD)
        FROM
             S21_PSN PSN
            ,ORG_FUNC_ASG ASG
            ,ORG_TOC_CHNG_RQST RQST
            ,ORG_FUNC_ROLE_TP OFR
        WHERE
            PSN.GLBL_CMPY_CD = #glblCmpyCd#
        AND PSN.PSN_CD       = #psnCd#
        AND PSN.EZCANCELFLAG = '0'

        AND PSN.GLBL_CMPY_CD   =  ASG.GLBL_CMPY_CD
        AND PSN.PSN_CD         =  ASG.PSN_CD
        AND ASG.GNRN_TP_CD     IN (#gnrnTpCd_Current#, #gnrnTpCd_Future#)
        AND ASG.EZCANCELFLAG   =  '0'

        AND ASG.GLBL_CMPY_CD   =  RQST.GLBL_CMPY_CD
        AND ASG.TOC_CD         =  RQST.TOC_CD
        AND RQST.RGTN_STS_CD   IN (#rgtnStsCd_P01#, #rgtnStsCd_P20#)
        AND RQST.EZCANCELFLAG  =  '0'

        AND RQST.GLBL_CMPY_CD        =  OFR.GLBL_CMPY_CD
        AND RQST.ORG_FUNC_ROLE_TP_CD =  OFR.ORG_FUNC_ROLE_TP_CD
        AND OFR.FIRST_ORG_CD         =  #firstOrgCdSales#
        AND OFR.EZCANCELFLAG         =  '0'
    </statement>

    <!-- Add Start 2017/03/03 QC#15878 -->
    <!-- START 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
    <!-- <statement id="checkExistAcctNm" parameterClass="Map" resultClass="Integer"> -->
    <statement id="checkExistAcctNum" parameterClass="Map" resultClass="Integer">
    <!-- END 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
        SELECT
              COUNT(ACCT.DS_ACCT_NUM) 
        FROM
            ( 
                SELECT
                      DAP.DS_ACCT_NUM AS DS_ACCT_NUM
                    , DAP.DS_ACCT_NM
                    , DAP.GLBL_CMPY_CD
                    , DAP.EZCANCELFLAG 
                FROM
                    DS_ACCT_PROS DAP 
                WHERE
                    DAP.GLBL_CMPY_CD = #glblCmpyCd# 
                    AND DAP.EZCANCELFLAG = '0' 
                    AND DAP.DS_ACCT_ACTV_CUST_FLG = 'Y' 
                    <!-- START 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
                    <!-- AND DAP.DS_ACCT_NM = #acctNm#  -->
                    AND DAP.DS_ACCT_NUM = #acctNum# 
                    <!-- END 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
                UNION 
                SELECT
                      STC.SELL_TO_CUST_CD AS DS_ACCT_NUM
                    , STC.DS_ACCT_NM
                    , STC.GLBL_CMPY_CD
                    , STC.EZCANCELFLAG 
                FROM
                    SELL_TO_CUST STC
                WHERE
                    STC.GLBL_CMPY_CD = #glblCmpyCd# 
                    AND STC.EZCANCELFLAG = '0' 
                    AND STC.DS_ACCT_ACTV_CUST_FLG = 'Y' 
                    <!-- START 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
                    <!-- AND STC.DS_ACCT_NM = #acctNm# -->
                    AND STC.SELL_TO_CUST_CD = #acctNum#
                    <!-- END 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
            ) ACCT
    </statement>

    <statement id="checkExistCntyNm" parameterClass="Map" resultClass="Integer">
        SELECT
              COUNT(CNTY.CNTY_NM) 
        FROM
            CNTY CNTY 
        WHERE
            CNTY.GLBL_CMPY_CD = #glblCmpyCd# 
            AND CNTY.EZCANCELFLAG = '0' 
            AND CNTY.CNTY_NM = #cntyNm#
    </statement>

    <statement id="checkExistCtyAddr" parameterClass="Map" resultClass="Integer">
        SELECT
              COUNT(POST.CTY_ADDR) 
        FROM
            POST POST 
        WHERE
            POST.GLBL_CMPY_CD = #glblCmpyCd# 
            AND POST.EZCANCELFLAG = '0' 
            AND POST.CTY_ADDR = #ctyAddr#
    </statement>
    <!-- Add End 2017/03/03 QC#15878 -->
    <!-- 2017/08/21 QC#20273 Add Start -->
    <statement id="checkExistlocNum" parameterClass="Map" resultClass="Integer">
        SELECT
               SUM(A.CNT)
        FROM (
            SELECT
                   COUNT(P.LOC_NUM) CNT
            FROM
                   PTY_LOC_WRK     P
            WHERE
                   P.GLBL_CMPY_CD       = #glblCmpyCd#
               AND P.LOC_NUM            = #locNum#
               <!-- 2020/06/15 QC#57094 Del Start -->
<!--                AND P.RGTN_STS_CD       != #rgtnStsCd# -->
<!--                AND P.EFF_FROM_DT    &lt;= #slsDt# -->
<!--                AND (  -->
<!--                    P.EFF_THRU_DT    &gt;= #slsDt# -->
<!--                   OR P.EFF_THRU_DT    IS NULL -->
<!--                    )  -->
               <!-- 2020/06/15 QC#57094 Del End -->
                AND P.EZCANCELFLAG      = '0'
            
            UNION ALL
            SELECT
                   COUNT(P.LOC_NUM) CNT
            FROM
                   PROS_PTY_LOC_WRK P
            WHERE
                   P.GLBL_CMPY_CD       = #glblCmpyCd#
               AND P.LOC_NUM            = #locNum#
               <!-- 2020/06/15 QC#57094 Del Start -->
<!--               AND P.RGTN_STS_CD       != #rgtnStsCd# -->
<!--               AND P.EFF_FROM_DT    &lt;= #slsDt# -->
<!--               AND (  -->
<!--                   P.EFF_THRU_DT    &gt;= #slsDt# -->
<!--                   OR P.EFF_THRU_DT    IS NULL -->
<!--                   )  -->
               <!-- 2020/06/15 QC#57094 Del Start -->
               AND P.EZCANCELFLAG       = '0'
        ) A
    </statement>
    <!-- 2017/08/21 QC#20273 Add End -->

    <!-- START 2019/09/05 Hd.Sugawara [QC#51704,ADD] -->
    <statement id="getTerritoryParentOverlap" parameterClass="Map" resultClass="Map">
        WITH ORG_REN AS(
            SELECT
                RELN.*
            FROM
                DS_ORG_RELN RELN
                ,ORG_STRU_TP STRU
            WHERE
                RELN.GLBL_CMPY_CD   = #glblCmpyCd#
            AND RELN.EZCANCELFLAG   = '0'
            AND RELN.GLBL_CMPY_CD   = STRU.GLBL_CMPY_CD
            AND RELN.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
            AND STRU.EZCANCELFLAG   = '0'
            AND STRU.TRTY_STRU_FLG  = #trtyStruFlg#
            <isEqual property="pastOnlyFlag" compareValue="Y">
            AND RELN.GNRN_TP_CD = #gnrnTpCdPast#
            </isEqual>
            <isNotEqual property="pastOnlyFlag" compareValue="Y">
            AND RELN.GNRN_TP_CD     != #gnrnTpCdDelete#
            AND RELN.GNRN_TP_CD     != #gnrnTpCdTerminated#
            </isNotEqual>
        )
        ,ORG_PRNT AS(
            SELECT
                ORG_PRNT.*
            FROM
                DS_ORG_UNIT ORG_PRNT
                ,ORG_STRU_TP STRU
            WHERE
                ORG_PRNT.GLBL_CMPY_CD   = #glblCmpyCd#
            AND ORG_PRNT.EZCANCELFLAG   = '0'
            AND ORG_PRNT.GLBL_CMPY_CD   = STRU.GLBL_CMPY_CD
            AND ORG_PRNT.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
            AND STRU.EZCANCELFLAG       = '0'
            AND STRU.TRTY_STRU_FLG      = #trtyStruFlg#
        )
        SELECT
            ORG_REN.EFF_FROM_DT
            ,ORG_REN.EFF_THRU_DT
        FROM
            DS_ORG_UNIT ORG
            ,ORG_REN
            ,ORG_PRNT
            ,ORG_STRU_TP STRU
        WHERE
            ORG.GLBL_CMPY_CD       = #glblCmpyCd#
        AND ORG.GLBL_CMPY_CD       = STRU.GLBL_CMPY_CD
        AND ORG.GLBL_CMPY_CD       = ORG_REN.GLBL_CMPY_CD
        AND ORG_REN.GLBL_CMPY_CD   = ORG_PRNT.GLBL_CMPY_CD
        AND STRU.EZCANCELFLAG      = '0'
        AND ORG.EZCANCELFLAG       = '0'
        AND ORG.ORG_CD             = ORG_REN.ORG_CD
        AND ORG_REN.PRNT_ORG_CD    = ORG_PRNT.ORG_CD
        AND ORG.ORG_STRU_TP_CD     = ORG_REN.ORG_STRU_TP_CD
        AND ORG_REN.ORG_STRU_TP_CD = ORG_PRNT.ORG_STRU_TP_CD
        AND ORG.ORG_STRU_TP_CD     = STRU.ORG_STRU_TP_CD
        AND STRU.TRTY_STRU_FLG     = #trtyStruFlg#
        AND ORG.ORG_CD             = #chldOrgCd#
        AND ORG_REN.PRNT_ORG_CD    &lt;&gt; #prntOrgCd#
        AND ORG_PRNT.ORG_TIER_CD   &gt;= #firstTierCd#
    </statement>
    <!-- END 2019/09/05 Hd.Sugawara [QC#51704,ADD] -->
</sqlMap>
