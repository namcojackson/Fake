<sqlMap namespace="NFCReceiptCreation">
	<statement id="getRcptAccntWaitData" parameterClass="Map">
     SELECT
               A.APPLY_GRP_SUB_PK         APPLY_GRP_SUB_PK
              ,A.RCPT_IN_PROC_SQ_PK       RCPT_IN_PROC_SQ_PK
              ,A.RCV_HDR_NUM              RCV_HDR_NUM
              ,A.RCV_DTL_NUM              RCV_DTL_NUM
              ,A.RCPT_GL_DT               RCPT_GL_DT
              ,A.PAYER_CUST_CD            PAYER_CUST_CD
              ,A.PROC_TP_CD               PROC_TP_CD
              ,A.GRP_INV_FLG              GRP_INV_FLG
              ,A.CASH_APP_GL_DT           CASH_APP_GL_DT
              ,B.RCPT_BAT_NUM             RCPT_BAT_NUM
              ,B.RCPT_BAT_SQ_NUM          RCPT_BAT_SQ_NUM
              ,B.AR_RCPT_TRX_TP_CD        AR_RCPT_TRX_TP_CD
              ,B.AR_RCPT_TP_CD            AR_RCPT_TP_CD
              ,B.DEAL_CCY_CD              DEAL_CCY_CD
              ,B.DEAL_RCPT_AMT            DEAL_RCPT_AMT
              ,B.DEAL_APPLY_AMT           DEAL_APPLY_AMT
              ,B.DEAL_RF_AMT              DEAL_RF_AMT
              ,B.DEAL_VOID_AMT            DEAL_VOID_AMT
              ,B.DEAL_RCPT_RMNG_BAL_AMT   DEAL_RCPT_RMNG_BAL_AMT
              ,B.EXCH_RATE                EXCH_RATE
              ,B.FUNC_CCY_CD              FUNC_CCY_CD
              ,B.FUNC_RCPT_AMT            FUNC_RCPT_AMT
              ,B.FUNC_APPLY_AMT           FUNC_APPLY_AMT
              ,B.FUNC_RF_AMT              FUNC_RF_AMT
              ,B.FUNC_VOID_AMT            FUNC_VOID_AMT
              ,B.FUNC_RCPT_RMNG_BAL_AMT   FUNC_RCPT_RMNG_BAL_AMT
              ,B.RCPT_DT                  RCPT_DT
              ,B.RCPT_CHK_NUM             RCPT_CHK_NUM
              ,B.RCPT_CHK_DT              RCPT_CHK_DT
              ,B.TOC_CD                   TOC_CD
              ,B.COA_PROD_CD              COA_PROD_CD
              ,B.CR_ANLST_PSN_CD          CR_ANLST_PSN_CD
              ,B.AR_BANK_ACCT_CD          AR_BANK_ACCT_CD
              ,B.RCPT_FIRST_CMNT_TXT      RCPT_FIRST_CMNT_TXT
              ,B.RCPT_SCD_CMNT_TXT        RCPT_SCD_CMNT_TXT
              ,B.AR_CASH_APPLY_STS_CD     AR_CASH_APPLY_STS_CD
              ,B.VOID_FLG                 VOID_FLG
              ,B.AR_RCPT_VOID_RSN_CD      AR_RCPT_VOID_RSN_CD
              ,B.VOID_DT                  VOID_DT
              ,B.VOID_FIRST_CMNT_TXT      VOID_FIRST_CMNT_TXT
              ,B.VOID_SCD_CMNT_TXT        VOID_SCD_CMNT_TXT
              ,B.VOID_GL_DT               VOID_GL_DT
              ,B.AR_RCPT_RF_RSN_CD        AR_RCPT_RF_RSN_CD
              ,B.RF_DT                    RF_DT
              ,B.FIRST_RF_CMNT_TXT        FIRST_RF_CMNT_TXT
              ,B.SCD_RF_CMNT_TXT          SCD_RF_CMNT_TXT
              ,B.RF_GL_DT                 RF_GL_DT
              ,B.RF_EXCH_RATE             RF_EXCH_RATE
              ,B.RCV_TS                   RCV_TS
              ,B.RCV_SQ_PK                RCV_SQ_PK
              ,B.RCV_TRX_TP_CD            RCV_TRX_TP_CD
              ,B.RCV_TRX_NUM              RCV_TRX_NUM
              ,B.AR_EDI_SEND_BANK_CD      AR_EDI_SEND_BANK_CD
              ,B.EDI_RCV_CUST_NM          EDI_RCV_CUST_NM
              ,B.CRAT_METH_TP_CD          CRAT_METH_TP_CD
              ,B.INV_NUM                  INV_NUM
              ,B.AR_CUST_REF_NUM          AR_CUST_REF_NUM
              ,B.AR_CUST_REF_TP_CD        AR_CUST_REF_TP_CD
              ,B.DEAL_RCPT_DTL_AMT        DEAL_RCPT_DTL_AMT
              ,B.FUNC_RCPT_DTL_AMT        FUNC_RCPT_DTL_AMT
              ,B.AUTO_CRAT_FLG            AUTO_CRAT_FLG
              ,B.DUP_ERR_CD               DUP_ERR_CD
              ,B.EXPT_FLG                 EXPT_FLG
              ,B.RCV_FUNC_ID              RCV_FUNC_ID
              ,B.GL_DT                    GL_DT
              ,B.RCV_DT                   RCV_DT
              ,B.EZUPUSERID               EZUPUSERID
<!-- for North America(CSA) 2015/04/02 Add Start -->
              ,B.AR_BAT_RCPT_NM           AR_BAT_RCPT_NM
              ,B.CUST_RCPT_NUM            CUST_RCPT_NUM
              ,B.AR_RCPT_SRC_CD           AR_RCPT_SRC_CD
              ,B.RCV_DT                   RCV_DT
              ,B.REM_DS_BANK_ACCT_PK      REM_DS_BANK_ACCT_PK
              ,B.CUST_DS_BANK_ACCT_PK     CUST_DS_BANK_ACCT_PK
<!-- for North America(CSA) 2015/04/02 Add End -->
              ,C.UPLD_AR_CUST_REF_NUM     UPLD_AR_CUST_REF_NUM
              ,X.CLT_PSN_CD               CLT_PSN_CD
              <!-- 2017/12/11 QC#22262 add start -->
              ,F.LOC_NUM                  LOC_NUM
              ,G.BILL_TO_CUST_CD          BILL_TO_CUST_CD
              <!-- 2017/12/11 QC#22262 add end -->
              <!-- START 2018/06/26 Y.Matsui [QC#26788,MOD] -->
              ,B.CR_CARD_APVL_CD          CR_CARD_APVL_CD
              <!-- END   2018/06/26 Y.Matsui [QC#26788,MOD] -->
              <!-- START 2018/07/27 E.Kameishi [QC#27419,ADD] -->
              ,'****' || J.CR_CARD_LAST_DIGIT_NUM  CR_CARD_LAST_DIGIT_NUM
              <!-- END   2018/07/27 E.Kameishi [QC#27419,ADD] -->
     FROM
               AR_APPLY_INTFC_WRK   A
              ,AR_RCPT_IN_PROC_WRK  B
              ,AR_RCPT_RCV_WRK      C
              ,(
                    SELECT
                         D.SELL_TO_CUST_CD
                        ,E.CLT_PSN_CD
                    FROM
                         SELL_TO_CUST   D
                        ,CLT_PTFO       E
                    WHERE
                            D.GLBL_CMPY_CD      = #GLBL_CMPY_CD#
                        AND D.GLBL_CMPY_CD      = E.GLBL_CMPY_CD (+)
                        AND D.CLT_PTFO_PK       = E.CLT_PTFO_PK (+)
                        AND D.EZCANCELFLAG      = '0'
                        AND E.EZCANCELFLAG      = '0'
                ) X
              <!-- 2017/12/11 QC#22262 add start -->
              ,DS_CUST_BANK_ACCT_RELN F
              ,BILL_TO_CUST         G
              ,SELL_TO_CUST         H
              <!-- 2017/12/11 QC#22262 add end -->
              <!-- START 2018/07/27 E.Kameishi [QC#27419,ADD] -->
              ,CR_CARD_TRX          I
              ,DS_CR_CARD           J
              <!-- END   2018/07/27 E.Kameishi [QC#27419,ADD] -->
     WHERE
                     A.GLBL_CMPY_CD         =  #GLBL_CMPY_CD#
               AND   A.APPLY_GRP_KEY        =  #APPLY_GRP_KEY# 
               AND   A.RCPT_NUM            IS  NULL
               AND   A.EZCANCELFLAG         =  '0'
               AND   A.RCV_HDR_NUM          =  #RCV_HDR_NUM# 

               AND   A.GLBL_CMPY_CD         =  B.GLBL_CMPY_CD
               AND   A.RCPT_IN_PROC_SQ_PK   =  B.RCPT_IN_PROC_SQ_PK
               AND   A.RCV_HDR_NUM          =  B.RCV_HDR_NUM
               AND   A.RCV_DTL_NUM          =  B.RCV_DTL_NUM

               AND   A.GLBL_CMPY_CD         =  C.GLBL_CMPY_CD(+)
               AND   A.RCPT_IN_PROC_SQ_PK   =  C.RCV_SQ_PK(+)
               AND   A.RCV_HDR_NUM          =  C.RCV_HDR_NUM(+)
               AND   A.RCV_DTL_NUM          =  C.RCV_DTL_NUM(+)
               AND   B.EZCANCELFLAG         =  '0'
               AND   C.EZCANCELFLAG(+)      =  '0'
               
               AND   A.PAYER_CUST_CD        =  X.SELL_TO_CUST_CD (+)
               
               <!-- 2017/12/11 QC#22262 add start -->
               AND   A.GLBL_CMPY_CD         =  H.GLBL_CMPY_CD(+)
               AND   A.PAYER_CUST_CD        =  H.SELL_TO_CUST_CD(+)
               AND   A.EZCANCELFLAG         =  H.EZCANCELFLAG(+)
               
               AND   B.GLBL_CMPY_CD         =  F.GLBL_CMPY_CD(+)
               AND   B.CUST_DS_BANK_ACCT_PK =  F.DS_BANK_ACCT_PK(+)
               AND   B.EZCANCELFLAG         =  F.EZCANCELFLAG(+)
               AND   H.SELL_TO_CUST_PK      =  F.DS_ACCT_CUST_PK(+)
               
               AND   F.GLBL_CMPY_CD         =  G.GLBL_CMPY_CD(+)
               AND   F.LOC_NUM              =  G.LOC_NUM(+)
               AND   F.EZCANCELFLAG         =  G.EZCANCELFLAG(+)
               <!-- 2017/12/11 QC#22262 add end -->
              <!-- START 2018/07/27 E.Kameishi [QC#27419,ADD] -->
               AND   C.GLBL_CMPY_CD         =  I.GLBL_CMPY_CD(+)
               AND   C.CR_CARD_APVL_CD      =  I.CR_CARD_AUTH_REF_NUM(+)
               AND   C.EZCANCELFLAG         =  I.EZCANCELFLAG(+)
               AND   I.GLBL_CMPY_CD         =  J.GLBL_CMPY_CD(+)
               AND   I.CR_CARD_CUST_REF_NUM =  J.CR_CARD_CUST_REF_NUM(+)
               AND   I.EZCANCELFLAG         =  J.EZCANCELFLAG(+)
              <!-- END   2018/07/27 E.Kameishi [QC#27419,ADD] -->
     ORDER BY
                     A.GLBL_CMPY_CD
                    ,A.RCPT_IN_PROC_SQ_PK
                    ,A.RCV_HDR_NUM
                    ,A.RCV_DTL_NUM
	</statement>
</sqlMap>
