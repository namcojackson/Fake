<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL6760Query">

    <!-- In case of Quick Lookup -->
    <statement id="getDsAccountList"  parameterClass ="Map" resultClass="Map">
        SELECT * FROM (
        SELECT 
                 AF.DS_ACCT_NUM
               , AF.DS_ACCT_RELN_TP_CD
               , AF.DS_ACCT_NM
               , AF.DS_ACCT_TP_NM
               , AF.ORIG_ACCT_NUM
               , AF.RELN_DS_ACCT_NUM
               , AF.GLBL_CMPY_CD
               , AF.DS_ACCT_ACTV_CUST_FLG
               , AF.PTY_LOC_PK
               , AF.XX_YES_NO_CD
               , AF.BILL_TO_CUST_CD
               , AF.SHIP_TO_CUST_CD
               , AF.PTY_RGTN_STS_CD
               , AF.BILL_RGTN_STS_CD
               , AF.SHIP_RGTN_STS_CD
               , AF.LOC_RGTN_STS_CD
               , AF.SHIP_FROM_FULL_CMPY_ADDR
               , AF.LOC_NUM
               , AF.FIRST_LINE_ADDR
               , AF.SCD_LINE_ADDR
               , AF.THIRD_LINE_ADDR
               , AF.FRTH_LINE_ADDR 
               , AF.PROV_NM
               , AF.CNTY_NM
               , AF.CTRY_CD
               , AF.DS_LOC_NM
               , AF.CTY_ADDR
               , AF.ST_CD
               , AF.POST_CD
               , AF.FIRST_REF_CMNT_TXT
               , AF.SCD_REF_CMNT_TXT
               , AF.ORIG_LOC_NUM
         <isNull property="dispRelnFlg">
               , AF.PRNT_DS_ACCT_NUM
         </isNull>
         FROM (
          SELECT 
                 A.DS_ACCT_NUM
               , A.DS_ACCT_RELN_TP_CD
               , A.DS_ACCT_NM
               , A.DS_ACCT_TP_NM
               , A.ORIG_ACCT_NUM
               , A.RELN_DS_ACCT_NUM
               , A.GLBL_CMPY_CD
               , A.DS_ACCT_ACTV_CUST_FLG
               , A.PTY_LOC_PK
               , A.XX_YES_NO_CD
         <isEqual property="inacLocFlg" compareValue="N">
           <isEqual property="inacBillToShipToFlg" compareValue="N">
               , CASE WHEN A.EXIST_ACTV_ACCT_LOC_FLG = 'Y' AND A.PTY_RGTN_STS_CD = #rgtnSts_Actv# AND A.BILL_RGTN_STS_CD = #rgtnSts_Actv# 
                      THEN A.BILL_TO_CUST_CD ELSE NULL END BILL_TO_CUST_CD
               , CASE WHEN A.EXIST_ACTV_ACCT_LOC_FLG = 'Y' AND A.PTY_RGTN_STS_CD = #rgtnSts_Actv# AND A.SHIP_RGTN_STS_CD = #rgtnSts_Actv#
                      THEN A.SHIP_TO_CUST_CD ELSE NULL END SHIP_TO_CUST_CD
               , CASE WHEN A.EXIST_ACTV_ACCT_LOC_FLG = 'Y' AND A.PTY_RGTN_STS_CD = #rgtnSts_Actv# 
                      THEN A.PTY_RGTN_STS_CD ELSE NULL END PTY_RGTN_STS_CD
           </isEqual>
           <isEqual property="inacBillToShipToFlg" compareValue="Y">
               , A.BILL_TO_CUST_CD
               , A.SHIP_TO_CUST_CD
               , A.PTY_RGTN_STS_CD
           </isEqual>
         </isEqual>
         <isEqual property="inacLocFlg" compareValue="Y">
               , A.BILL_TO_CUST_CD
               , A.SHIP_TO_CUST_CD
               , A.PTY_RGTN_STS_CD
         </isEqual>
               , A.BILL_RGTN_STS_CD
               , A.SHIP_RGTN_STS_CD
               , A.LOC_RGTN_STS_CD
               , A.SHIP_FROM_FULL_CMPY_ADDR
               , A.LOC_NUM
               , A.FIRST_LINE_ADDR
               , A.SCD_LINE_ADDR
               , A.THIRD_LINE_ADDR
               , A.FRTH_LINE_ADDR 
               , A.PROV_NM
               , A.CNTY_NM
               , A.CTRY_CD
               , A.DS_LOC_NM
               , A.CTY_ADDR
               , A.ST_CD
               , A.POST_CD
               , A.FIRST_REF_CMNT_TXT
               , A.SCD_REF_CMNT_TXT
               , A.ORIG_LOC_NUM
         <isNull property="dispRelnFlg">
               , (SELECT RELN_DS_ACCT_NUM FROM 
                   (SELECT R.RELN_DS_ACCT_NUM
                         , ROW_NUMBER() OVER (ORDER BY DECODE(R.RGTN_STS_CD, #rgtnSts_Ready#, 1, #rgtnSts_Pend#, 2, 3)) AS SEQ
                      FROM DS_ACCT_RELN R 
                     WHERE R.EZCANCELFLAG = '0' AND R.GLBL_CMPY_CD = #glblCmpyCd# AND R.DS_ACCT_RELN_TP_CD = #dsAcctRelnTp_PrntAcct# 
                       AND R.DS_ACCT_NUM = A.DS_ACCT_NUM
                   ) WHERE SEQ = 1
                 ) PRNT_DS_ACCT_NUM
         </isNull>
                  ,MAX(A.ORIG_LOC_NUM)  OVER (PARTITION BY A.DS_ACCT_NUM) AS MAX_ORIG_LOC_NUM
            FROM         (
                  SELECT DISTINCT
                         LF_A.DS_ACCT_NUM
                       , LF_A.DS_ACCT_RELN_TP_CD
                       , LF_A.DS_ACCT_NM
                       , LF_A.DS_ACCT_TP_NM
                       , LF_A.ORIG_ACCT_NUM
                       , LF_A.RELN_DS_ACCT_NUM
                       , LF_A.GLBL_CMPY_CD
                       , LF_A.DS_ACCT_ACTV_CUST_FLG
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.PTY_LOC_PK ELSE LF_P.PTY_LOC_PK END AS PTY_LOC_PK
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.XX_YES_NO_CD ELSE LF_P.XX_YES_NO_CD END AS XX_YES_NO_CD
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.BILL_TO_CUST_CD ELSE LF_P.BILL_TO_CUST_CD END AS BILL_TO_CUST_CD
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.BILL_RGTN_STS_CD ELSE LF_P.BILL_RGTN_STS_CD END AS BILL_RGTN_STS_CD
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.SHIP_TO_CUST_CD ELSE LF_P.SHIP_TO_CUST_CD END AS SHIP_TO_CUST_CD
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.SHIP_RGTN_STS_CD ELSE LF_P.SHIP_RGTN_STS_CD END AS SHIP_RGTN_STS_CD
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.PTY_RGTN_STS_CD ELSE LF_P.PTY_RGTN_STS_CD END AS PTY_RGTN_STS_CD
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.LOC_RGTN_STS_CD ELSE LF_P.LOC_RGTN_STS_CD END AS LOC_RGTN_STS_CD
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.SHIP_FROM_FULL_CMPY_ADDR ELSE LF_P.SHIP_FROM_FULL_CMPY_ADDR END AS SHIP_FROM_FULL_CMPY_ADDR
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.LOC_NUM ELSE LF_P.LOC_NUM END AS LOC_NUM
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.FIRST_LINE_ADDR ELSE LF_P.FIRST_LINE_ADDR END AS FIRST_LINE_ADDR
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.SCD_LINE_ADDR ELSE LF_P.SCD_LINE_ADDR END AS SCD_LINE_ADDR
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.THIRD_LINE_ADDR ELSE LF_P.THIRD_LINE_ADDR END AS THIRD_LINE_ADDR
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.FRTH_LINE_ADDR  ELSE LF_P.FRTH_LINE_ADDR  END AS FRTH_LINE_ADDR 
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.PROV_NM ELSE LF_P.PROV_NM END AS PROV_NM
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.CNTY_NM ELSE LF_P.CNTY_NM END AS CNTY_NM
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.CTRY_CD ELSE LF_P.CTRY_CD END AS CTRY_CD
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.DS_LOC_NM ELSE LF_P.DS_LOC_NM END AS DS_LOC_NM
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.CTY_ADDR ELSE LF_P.CTY_ADDR END AS CTY_ADDR
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.ST_CD ELSE LF_P.ST_CD END AS ST_CD
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.POST_CD ELSE LF_P.POST_CD END AS POST_CD
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.FIRST_REF_CMNT_TXT ELSE LF_P.FIRST_REF_CMNT_TXT END AS FIRST_REF_CMNT_TXT
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.SCD_REF_CMNT_TXT ELSE LF_P.SCD_REF_CMNT_TXT END AS SCD_REF_CMNT_TXT
                       , CASE WHEN LF_A.DPLY_TP='ACCT+LOC' THEN LF_A.LOC_NUM ELSE NULL END AS ORIG_LOC_NUM
                       <!-- QC#25171 Del Start
                       , CASE WHEN
                                    <isNotEqual property="dsAcctTpCdCust" compareValue="N">
                                    EXISTS (
                                    SELECT 1 
                                      FROM ACCT_LOC LOC 
                                     WHERE LOC.EZCANCELFLAG = '0' 
                                       AND LOC.GLBL_CMPY_CD = LF_A.GLBL_CMPY_CD 
                                       AND LOC.LOC_NUM = LF_A.LOC_NUM
                                       AND LOC.RGTN_STS_CD = #rgtnSts_Actv#
                                    )
                                    </isNotEqual>
                                    <isNull property="dsAcctTpCdCust">
                                        OR
                                    </isNull>
                                    <isNotEqual property="dsAcctTpCdCust" compareValue="Y">
                                    EXISTS (
                                    SELECT 1
                                      FROM PROS_PTY_LOC_WRK LOC
                                     WHERE LOC.EZCANCELFLAG = '0' 
                                       AND LOC.GLBL_CMPY_CD = LF_A.GLBL_CMPY_CD 
                                       AND LOC.LOC_NUM = LF_A.LOC_NUM
                                       AND LOC.RGTN_STS_CD = #rgtnSts_Actv#
                                    )
                                    </isNotEqual>
                              THEN 'Y' ELSE 'N' END EXIST_ACTV_ACCT_LOC_FLG -->
                       <!-- QC#25171 Add Start -->
                       , LF_A.EXIST_ACTV_ACCT_LOC_FLG
                       <!-- QC#25171 Add End -->
                    FROM (SELECT   A_SFW1.DS_ACCT_NUM
                                 , A_SFW1.DS_ACCT_RELN_TP_CD
                                 , A_SFW1.DS_ACCT_NM
                                 , A_SFW1.SHIP_FROM_FULL_CMPY_ADDR
                                 , A_SFW1.LOC_NUM
                                 , A_SFW1.XX_YES_NO_CD
                                 , A_SFW1.DS_ACCT_TP_NM
                                 , A_SFW1.ORIG_ACCT_NUM
                                 , A_SFW1.RELN_DS_ACCT_NUM
                                 , A_SFW1.BILL_TO_CUST_CD
                                 , A_SFW1.SHIP_TO_CUST_CD
                                 , A_SFW1.GLBL_CMPY_CD
                                 , A_SFW1.PTY_LOC_PK
                                 , A_SFW1.FIRST_LINE_ADDR
                                 , A_SFW1.SCD_LINE_ADDR
                                 , A_SFW1.THIRD_LINE_ADDR
                                 , A_SFW1.FRTH_LINE_ADDR 
                                 , A_SFW1.PROV_NM
                                 , A_SFW1.CNTY_NM
                                 , A_SFW1.CTRY_CD
                                 , A_SFW1.SORT_NUM
                                 , A_SFW1.DS_LOC_NM
                                 , A_SFW1.CTY_ADDR
                                 , A_SFW1.ST_CD
                                 , A_SFW1.POST_CD
                                 , A_SFW1.FIRST_REF_CMNT_TXT
                                 , A_SFW1.SCD_REF_CMNT_TXT
                                 , A_SFW1.DS_ACCT_ACTV_CUST_FLG
                                 , A_SFW1.LOC_RGTN_STS_CD
                                 , A_SFW1.PTY_RGTN_STS_CD
                                 , A_SFW1.BILL_RGTN_STS_CD
                                 , A_SFW1.SHIP_RGTN_STS_CD
                                 , A_SFW1.HIT_LOC_CTAC_FLG
                                 <!-- QC#25171 Add Start -->
                                 , A_SFW1.EXIST_ACTV_ACCT_LOC_FLG
                                 <!-- QC#25171 Add End -->
                         <isEqual property="inacLocFlg" compareValue="N">
                           <isEqual property="inacBillToShipToFlg" compareValue="N">
                         , CASE 
                                WHEN A_SFW1.HIT_LOC_CTAC_FLG = 'N' THEN 'ACCT'
                                WHEN A_SFW1.LOC_RGTN_STS_CD IS NULL THEN 'ACCT'
                                WHEN A_SFW1.LOC_RGTN_STS_CD != #rgtnSts_Actv# THEN 'ACCT'
                                WHEN A_SFW1.PTY_RGTN_STS_CD != #rgtnSts_Actv# THEN 'ACCT'
                                WHEN A_SFW1.BILL_RGTN_STS_CD IS NULL AND A_SFW1.SHIP_RGTN_STS_CD IS NULL THEN 'ACCT+LOC'
                                WHEN A_SFW1.BILL_RGTN_STS_CD = #rgtnSts_Actv# THEN 'ACCT+LOC'
                                WHEN A_SFW1.SHIP_RGTN_STS_CD = #rgtnSts_Actv# THEN 'ACCT+LOC'
                                ELSE 'ACCT'
                            END AS DPLY_TP
                           </isEqual>
                           <isEqual property="inacBillToShipToFlg" compareValue="Y">
                         , CASE 
                                WHEN A_SFW1.HIT_LOC_CTAC_FLG = 'N' THEN 'ACCT'
                                WHEN A_SFW1.LOC_RGTN_STS_CD IS NULL THEN 'ACCT'
                                WHEN A_SFW1.BILL_RGTN_STS_CD IS NULL AND A_SFW1.SHIP_RGTN_STS_CD IS NULL AND A_SFW1.LOC_RGTN_STS_CD != #rgtnSts_Actv# THEN 'ACCT'
                                WHEN A_SFW1.BILL_RGTN_STS_CD IS NULL AND A_SFW1.SHIP_RGTN_STS_CD IS NULL AND A_SFW1.PTY_RGTN_STS_CD != #rgtnSts_Actv# THEN 'ACCT'
                                ELSE 'ACCT+LOC'
                            END AS DPLY_TP
                           </isEqual>
                         </isEqual>
                         <isEqual property="inacLocFlg" compareValue="Y">
                         , CASE 
                                WHEN A_SFW1.HIT_LOC_CTAC_FLG = 'N' THEN 'ACCT'
                                ELSE 'ACCT+LOC'
                            END AS DPLY_TP
                         </isEqual>
                          FROM 
                              ( SELECT 
                                          ACCT.DS_ACCT_NUM  AS DS_ACCT_NUM
                                        , ''                            AS DS_ACCT_RELN_TP_CD
                                        , ACCT.DS_ACCT_NM               AS DS_ACCT_NM
                                        , ACCT.FIRST_LINE_ADDR ||
                                          DECODE(ACCT.SCD_LINE_ADDR, NULL, '', ' ' || ACCT.SCD_LINE_ADDR) ||
                                          DECODE(ACCT.THIRD_LINE_ADDR, NULL, '', ' ' || ACCT.THIRD_LINE_ADDR) ||
                                          DECODE(ACCT.FRTH_LINE_ADDR, NULL, '', ' ' || ACCT.FRTH_LINE_ADDR) ||
                                          ' ' ||
                                          ACCT.CTY_ADDR        || ' ' ||
                                          ACCT.ST_CD           || ' ' ||
                                          ACCT.POST_CD                  AS SHIP_FROM_FULL_CMPY_ADDR
                                        , ACCT.LOC_NUM                  AS LOC_NUM
                                        , ACCT.XX_YES_NO_CD             AS XX_YES_NO_CD
                                        , (SELECT DS_ACCT_TP_NM FROM DS_ACCT_TP TP
                                               WHERE TP.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
                                               AND TP.EZCANCELFLAG = '0'
                                               AND TP.DS_ACCT_TP_CD = ACCT.DS_ACCT_TP_CD
                                          )                             AS DS_ACCT_TP_NM
                                        , ACCT.DS_ACCT_NUM              AS ORIG_ACCT_NUM
                                        , ''                            AS RELN_DS_ACCT_NUM
                                        , BILL.BILL_TO_CUST_CD          AS BILL_TO_CUST_CD
                                        , SHIP.SHIP_TO_CUST_CD          AS SHIP_TO_CUST_CD
                                        , ACCT.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                                        , ACCT.PTY_LOC_PK               AS PTY_LOC_PK
                                        , ACCT.FIRST_LINE_ADDR          AS FIRST_LINE_ADDR
                                        , ACCT.SCD_LINE_ADDR            AS SCD_LINE_ADDR
                                        , ACCT.THIRD_LINE_ADDR          AS THIRD_LINE_ADDR
                                        , ACCT.FRTH_LINE_ADDR           AS FRTH_LINE_ADDR 
                                        , ACCT.PROV_NM                  AS PROV_NM
                                        , CNTY.CNTY_NM                  AS CNTY_NM
                                        , ACCT.CTRY_CD                  AS CTRY_CD
                                        , ROWNUM                        AS SORT_NUM
                                        , ACCT.DS_LOC_NM                AS DS_LOC_NM
                                        , ACCT.CTY_ADDR                 AS CTY_ADDR
                                        , ACCT.ST_CD                    AS ST_CD
                                        , ACCT.POST_CD                  AS POST_CD
                                        , ACCT.FIRST_REF_CMNT_TXT       AS FIRST_REF_CMNT_TXT
                                        , ACCT.SCD_REF_CMNT_TXT         AS SCD_REF_CMNT_TXT
                                        , ACCT.DS_ACCT_ACTV_CUST_FLG    AS DS_ACCT_ACTV_CUST_FLG
                                        , ACCT.LOC_RGTN_STS_CD          AS LOC_RGTN_STS_CD
                                        , ACCT.PTY_RGTN_STS_CD          AS PTY_RGTN_STS_CD
                                        , BILL.RGTN_STS_CD              AS BILL_RGTN_STS_CD
                                        , SHIP.RGTN_STS_CD              AS SHIP_RGTN_STS_CD
                                        <!-- QC#25171 Add Start -->
                                        , ACCT.EXIST_ACTV_ACCT_LOC_FLG
                                        <!-- QC#25171 Add End -->
                                        <isNull property="ctacPsnFlg">
                                        , 'Y'                           AS HIT_LOC_CTAC_FLG
                                        </isNull>
                                        <isNotNull property="ctacPsnFlg">
                                        , CASE WHEN EXISTS (SELECT 1 
                                                        FROM 
                                                            DS_CTAC_PSN_RELN    PSN_RELN
                                                          , CTAC_PSN            PSN
                                                        <isNotNull property="ctacPsnTelNum">
                                                          , DS_CTAC_PNT         PNT
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnEmlAddr">
                                                          , DS_CTAC_PNT         PNT_EML
                                                        </isNotNull>
                                                        WHERE
                                                            ACCT.GLBL_CMPY_CD = PSN_RELN.GLBL_CMPY_CD
                                                        AND ACCT.LOC_NUM = PSN_RELN.LOC_NUM
                                                        AND PSN_RELN.EZCANCELFLAG = '0'
                                                        AND PSN_RELN.GLBL_CMPY_CD = PSN.GLBL_CMPY_CD
                                                        AND PSN_RELN.CTAC_PSN_PK = PSN.CTAC_PSN_PK
                                                        AND PSN.EZCANCELFLAG = '0'
                                                        <isNotNull property="ctacPsnFirstNm">
                                                        AND UPPER(PSN.CTAC_PSN_FIRST_NM) LIKE UPPER(#ctacPsnFirstNm#)
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnLastNm">
                                                        AND UPPER(PSN.CTAC_PSN_LAST_NM) LIKE UPPER(#ctacPsnLastNm#)
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnTelNum">
                                                        AND PSN.GLBL_CMPY_CD = PNT.GLBL_CMPY_CD
                                                        AND PSN.CTAC_PSN_PK = PNT.CTAC_PSN_PK
                                                        AND PNT.EZCANCELFLAG = '0'
                                                        AND PNT.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCd#
                                                        AND PNT.DS_CTAC_PNT_VAL_TXT LIKE #ctacPsnTelNum#
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnEmlAddr">
                                                        AND PSN.GLBL_CMPY_CD = PNT_EML.GLBL_CMPY_CD
                                                        AND PSN.CTAC_PSN_PK = PNT_EML.CTAC_PSN_PK
                                                        AND PNT_EML.EZCANCELFLAG = '0'
                                                        AND PNT_EML.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCdIsEml#
                                                        AND UPPER(PNT_EML.DS_CTAC_PNT_VAL_TXT) LIKE UPPER(#ctacPsnEmlAddr#)
                                                        </isNotNull>
                                                   )
                                            THEN 'Y' ELSE 'N' END       AS HIT_LOC_CTAC_FLG
                                        </isNotNull>
                        <!--        FROM ACCT-->
                                FROM
                                    ( 
                                    <isNotEqual property="dsAcctTpCdCust" compareValue="N">
                                        SELECT CUST.GLBL_CMPY_CD          AS GLBL_CMPY_CD
                                             , CUST.EZCANCELFLAG          AS EZCANCELFLAG
                                             , CUST.DS_ACCT_NM            AS DS_ACCT_NM
                                             , CUST.DS_ACCT_ACTV_CUST_FLG AS DS_ACCT_ACTV_CUST_FLG
                                             , CUST.SELL_TO_CUST_CD       AS DS_ACCT_NUM
                                             , CUST.DBA_NM                AS DBA_NM
                                             , CUST.DS_ACCT_LEGAL_NM      AS DS_ACCT_LEGAL_NM
                                             , CUST.DS_ACCT_DUNS_NUM      AS DS_ACCT_DUNS_NUM
                                             , CUST.DS_ULT_DUNS_NUM       AS DS_ULT_DUNS_NUM
                                             , CUST.DS_CUST_SIC_DESC_TXT  AS DS_CUST_SIC_DESC_TXT
                                             , CUST.DS_ACCT_ITRL_FLG      AS DS_ACCT_ITRL_FLG
                                             , CUST.DS_XTRNL_REF_TXT      AS DS_XTRNL_REF_TXT
                                             , CUST.DS_ACCT_CLS_CD        AS DS_ACCT_CLS_CD
                                             , CUST.DS_ACCT_TP_CD         AS DS_ACCT_TP_CD
                                             , PRIN.PTY_LOC_PK            AS PTY_LOC_PK
                                             , PTY.LOC_NUM                AS LOC_NUM
                                             , PTY.CNTY_PK                AS CNTY_PK
                                             , PTY.FIRST_LINE_ADDR        AS FIRST_LINE_ADDR
                                             , PTY.SCD_LINE_ADDR          AS SCD_LINE_ADDR
                                             , PTY.THIRD_LINE_ADDR        AS THIRD_LINE_ADDR
                                             , PTY.FRTH_LINE_ADDR         AS FRTH_LINE_ADDR
                                             , PTY.CTY_ADDR               AS CTY_ADDR
                                             , PTY.ST_CD                  AS ST_CD
                                             , PTY.POST_CD                AS POST_CD
                                             , PTY.DS_LOC_NM              AS DS_LOC_NM
                                             , PTY.PROV_NM                AS PROV_NM
                                             , PTY.CTRY_CD                AS CTRY_CD
                                             , PTY.FIRST_REF_CMNT_TXT     AS FIRST_REF_CMNT_TXT
                                             , PTY.SCD_REF_CMNT_TXT       AS SCD_REF_CMNT_TXT
                                             , PTY.RGTN_STS_CD            AS PTY_RGTN_STS_CD
                                             , LOC.RGTN_STS_CD            AS LOC_RGTN_STS_CD
                                             , PRIN.PRIN_CUST_PK          AS PRIN_CUST_PK
                                             , CASE WHEN PRIN.PRIN_CUST_PK IS NOT NULL THEN 'Y' ELSE 'N' END AS XX_YES_NO_CD
                                             <!-- START 2018/04/10 Hd.Sugawara [QC#24388,ADD] -->
                                             , PTY.DUNS_NUM               AS PTY_DUNS_NUM
                                             , PTY.DS_ULT_DUNS_NUM        AS PTY_DS_ULT_DUNS_NUM
                                             , PTY.DS_CUST_SIC_DESC_TXT   AS PTY_DS_CUST_SIC_DESC_TXT
                                             <!-- END 2018/04/10 Hd.Sugawara [QC#24388,ADD] -->
                                             <!-- QC#25171 Add Start -->
                                             , CASE WHEN
                                                 EXISTS (
                                                     SELECT
                                                         1
                                                     FROM
                                                         ACCT_LOC LOC2
                                                     WHERE
                                                         LOC2.EZCANCELFLAG = '0'
                                                     AND LOC2.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD
                                                     AND LOC2.LOC_NUM      = PTY.LOC_NUM
                                                     AND LOC2.RGTN_STS_CD  = #rgtnSts_Actv#
                                                 ) THEN 'Y'
                                                 ELSE 'N'
                                               END EXIST_ACTV_ACCT_LOC_FLG
                                             <!-- QC#25171 Add End -->
                                        FROM   SELL_TO_CUST CUST
                                             , ACCT_LOC     LOC
                                             , PTY_LOC_WRK  PTY
                                             , PRIN_CUST    PRIN
                                        WHERE  CUST.GLBL_CMPY_CD = #glblCmpyCd#
                                        AND    CUST.EZCANCELFLAG = '0'
                                        AND    CUST.GLBL_CMPY_CD = LOC.GLBL_CMPY_CD(+)
                                        AND    CUST.SELL_TO_CUST_CD = LOC.DS_ACCT_NUM(+)
                                        <isNotEqual property="xxChkBox_01" compareValue="Y">
                                        AND    CUST.LOC_NUM = LOC.LOC_NUM(+)
                                        </isNotEqual>
                                        AND    LOC.EZCANCELFLAG(+) = '0'
                                        AND    LOC.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD(+)
                                        AND    LOC.PTY_LOC_PK = PTY.PTY_LOC_PK(+)
                                        AND    PTY.EZCANCELFLAG(+) = '0'
                                        AND    PTY.GLBL_CMPY_CD = PRIN.GLBL_CMPY_CD(+)
                                        AND    PTY.LOC_NUM = PRIN.LOC_NUM(+)
                                        AND    PRIN.EZCANCELFLAG(+) = '0'
                                    </isNotEqual>
                                    <isNull property="dsAcctTpCdCust">
                                        UNION ALL
                                    </isNull>
                                    <isNotEqual property="dsAcctTpCdCust" compareValue="Y">
                                        SELECT CUST.GLBL_CMPY_CD          AS GLBL_CMPY_CD
                                             , CUST.EZCANCELFLAG          AS EZCANCELFLAG
                                             , CUST.DS_ACCT_NM            AS DS_ACCT_NM
                                             , CUST.DS_ACCT_ACTV_CUST_FLG AS DS_ACCT_ACTV_CUST_FLG
                                             , CUST.DS_ACCT_NUM           AS DS_ACCT_NUM
                                             , CUST.DBA_NM                AS DBA_NM
                                             , CUST.DS_ACCT_LEGAL_NM      AS DS_ACCT_LEGAL_NM
                                             , CUST.DS_ACCT_DUNS_NUM      AS DS_ACCT_DUNS_NUM
                                             , CUST.DS_ULT_DUNS_NUM       AS DS_ULT_DUNS_NUM
                                             , CUST.DS_CUST_SIC_DESC_TXT  AS DS_CUST_SIC_DESC_TXT
                                             , CUST.DS_ACCT_ITRL_FLG      AS DS_ACCT_ITRL_FLG
                                             , CUST.DS_XTRNL_REF_TXT      AS DS_XTRNL_REF_TXT
                                             , CUST.DS_ACCT_CLS_CD        AS DS_ACCT_CLS_CD
                                             , CUST.DS_ACCT_TP_CD         AS DS_ACCT_TP_CD
                                             , PTY.PTY_LOC_PK             AS PTY_LOC_PK
                                             , PTY.LOC_NUM                AS LOC_NUM
                                             , PTY.CNTY_PK                AS CNTY_PK
                                             , PTY.FIRST_LINE_ADDR        AS FIRST_LINE_ADDR
                                             , PTY.SCD_LINE_ADDR          AS SCD_LINE_ADDR
                                             , PTY.THIRD_LINE_ADDR        AS THIRD_LINE_ADDR
                                             , PTY.FRTH_LINE_ADDR         AS FRTH_LINE_ADDR
                                             , PTY.CTY_ADDR               AS CTY_ADDR
                                             , PTY.ST_CD                  AS ST_CD
                                             , PTY.POST_CD                AS POST_CD
                                             , PTY.DS_LOC_NM              AS DS_LOC_NM
                                             , PTY.PROV_NM                AS PROV_NM
                                             , PTY.CTRY_CD                AS CTRY_CD
                                             , PTY.FIRST_REF_CMNT_TXT     AS FIRST_REF_CMNT_TXT
                                             , PTY.SCD_REF_CMNT_TXT       AS SCD_REF_CMNT_TXT
                                             , PTY.RGTN_STS_CD            AS PTY_RGTN_STS_CD
                                             , PTY.RGTN_STS_CD            AS LOC_RGTN_STS_CD
                                             , null                       AS PRIN_CUST_PK
                                             , CASE WHEN PTY.LOC_NUM IS NOT NULL THEN 'Y' ELSE 'N' END AS XX_YES_NO_CD
                                             <!-- START 2018/04/10 Hd.Sugawara [QC#24388,ADD] -->
                                             , PTY.DUNS_NUM               AS PTY_DUNS_NUM
                                             , PTY.DS_ULT_DUNS_NUM        AS PTY_DS_ULT_DUNS_NUM
                                             , PTY.DS_CUST_SIC_DESC_TXT   AS PTY_DS_CUST_SIC_DESC_TXT
                                             <!-- END 2018/04/10 Hd.Sugawara [QC#24388,ADD] -->
                                             <!-- QC#25171 Add Start -->
                                             , CASE WHEN
                                                 EXISTS (
                                                     SELECT
                                                         1
                                                     FROM
                                                         PROS_PTY_LOC_WRK LOC2
                                                     WHERE
                                                         LOC2.EZCANCELFLAG = '0'
                                                     AND LOC2.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD
                                                     AND LOC2.LOC_NUM      = PTY.LOC_NUM
                                                     AND LOC2.RGTN_STS_CD  = #rgtnSts_Actv#
                                                 ) THEN 'Y'
                                                 ELSE 'N'
                                               END EXIST_ACTV_ACCT_LOC_FLG
                                             <!-- QC#25171 Add End -->
                                        FROM   DS_ACCT_PROS     CUST
                                             , PROS_PTY_LOC_WRK PTY
                                        WHERE  CUST.GLBL_CMPY_CD = #glblCmpyCd#
                                        AND    CUST.EZCANCELFLAG = '0'
                                        AND    CUST.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD(+)
                                        AND    CUST.PTY_LOC_PK = PTY.PTY_LOC_PK(+)
                                        <isNotEqual property="xxChkBox_01" compareValue="Y">
                                        AND    CUST.LOC_NUM = PTY.LOC_NUM(+)
                                        </isNotEqual>
                                        AND    PTY.EZCANCELFLAG(+) = '0'
                                    </isNotEqual>
                                      ) ACCT
                                    , BILL_TO_CUST BILL
                                    , SHIP_TO_CUST SHIP
                                    , CNTY CNTY
                                WHERE
                                    ACCT.GLBL_CMPY_CD = #glblCmpyCd#
                                AND ACCT.EZCANCELFLAG = '0'
                                AND ACCT.GLBL_CMPY_CD = BILL.GLBL_CMPY_CD(+)
                                AND ACCT.LOC_NUM = BILL.LOC_NUM(+)
                                AND BILL.EZCANCELFLAG(+) = '0'
                                AND ACCT.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD(+)
                                AND ACCT.LOC_NUM = SHIP.LOC_NUM(+)
                                AND SHIP.EZCANCELFLAG(+) = '0'
                                AND ACCT.CNTY_PK             = CNTY.CNTY_PK(+)
                                AND ACCT.GLBL_CMPY_CD        = CNTY.GLBL_CMPY_CD(+)
                                AND CNTY.EZCANCELFLAG(+)    = '0'
                                <isNotNull property="dsAcctActvCustFlg">
                                 AND ACCT.DS_ACCT_ACTV_CUST_FLG = #dsAcctActvCustFlg# 
                                </isNotNull>

                                <isNotNull property="dsAcctNm">
                                AND ACCT.DS_ACCT_NM LIKE #dsAcctNm#
                                </isNotNull>
                                <!-- Address -->
                                <isNotNull property="shipFromFullCmpyAddr">
                                AND UPPER(ACCT.FIRST_LINE_ADDR) || 
                                    DECODE(ACCT.SCD_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.SCD_LINE_ADDR)) ||
                                    DECODE(ACCT.THIRD_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.THIRD_LINE_ADDR)) ||
                                    DECODE(ACCT.FRTH_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.FRTH_LINE_ADDR)) LIKE #shipFromFullCmpyAddr#
                                </isNotNull>
                                <!-- Bill To Code -->
                                <isNotNull property="billToCustCd">
                                AND BILL.BILL_TO_CUST_CD LIKE #billToCustCd#
                                </isNotNull>
                                <!-- Ship To Code -->
                                <isNotNull property="shipToCustCd">
                                AND SHIP.SHIP_TO_CUST_CD LIKE #shipToCustCd#
                                </isNotNull>
                                <!-- City -->
                                <isNotNull property="ctyAddr">
                                AND UPPER(ACCT.CTY_ADDR) LIKE #ctyAddr#
                                </isNotNull>
                                <!-- State -->
                                <isNotNull property="stCd">
                                AND ACCT.ST_CD = #stCd#
                                </isNotNull>
                                <!-- Postal Code -->
                                <isNotNull property="postCd">
                                AND ACCT.POST_CD LIKE #postCd#
                                </isNotNull>
                                <!-- Account Number -->
                                <isNotNull property="dsAcctNum">
                                AND ACCT.DS_ACCT_NUM LIKE #dsAcctNum#
                                </isNotNull>
                                <!-- Location Number -->
                                <isNotNull property="locNum">
                                AND ACCT.LOC_NUM LIKE #locNum#
                                </isNotNull>
                                <!-- DBA Name -->
                                <isNotNull property="dbaNm">
                                AND ACCT.DBA_NM LIKE #dbaNm#
                                </isNotNull>
                                <!-- Account Legal Name -->
                                <isNotNull property="dsAcctLegalNm">
                                AND ACCT.DS_ACCT_LEGAL_NM LIKE #dsAcctLegalNm#
                                </isNotNull>
                                <!-- Account Group Code -->
                                <isNotNull property="dsAcctGrpCd">
                                AND EXISTS (SELECT 1 FROM DS_ACCT_GRP_ASG ASG 
                                            WHERE ASG.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
                                            AND ASG.EZCANCELFLAG = '0'
                                            AND ASG.DS_ACCT_NUM = ACCT.DS_ACCT_NUM
                                            AND ASG.EFF_FROM_DT &lt;= #slsDt#
                                            AND (ASG.EFF_THRU_DT &gt;= #slsDt#
                                                OR ASG.EFF_THRU_DT IS NULL ) 
                                            AND ASG.DS_ACCT_GRP_CD LIKE #dsAcctGrpCd#
                                    )
                                </isNotNull>
                                
                                <!-- Location Name -->
                                <isNotNull property="locNm">
                                AND UPPER(ACCT.DS_LOC_NM) LIKE #locNm#
                                </isNotNull>
                                <isNotNull property="dsAcctDunsNum">
                                <!-- START 2018/04/10 Hd.Sugawara [QC#24388,MOD] -->
                                <!-- AND ACCT.DS_ACCT_DUNS_NUM LIKE #dsAcctDunsNum# -->
                                AND (ACCT.DS_ACCT_DUNS_NUM LIKE #dsAcctDunsNum# OR ACCT.PTY_DUNS_NUM LIKE #dsAcctDunsNum#)
                                <!-- END 2018/04/10 Hd.Sugawara [QC#24388,MOD] -->
                                </isNotNull>
                                <!-- UDUNS Number -->
                                <isNotNull property="dsUltDunsNum">
                                <!-- START 2018/04/10 Hd.Sugawara [QC#24388,MOD] -->
                                <!-- AND ACCT.DS_ULT_DUNS_NUM LIKE #dsUltDunsNum# -->
                                AND (ACCT.DS_ULT_DUNS_NUM LIKE #dsUltDunsNum# OR ACCT.PTY_DS_ULT_DUNS_NUM LIKE #dsUltDunsNum#)
                                <!-- END 2018/04/10 Hd.Sugawara [QC#24388,MOD] -->
                                </isNotNull>
                                <!-- Industry -->
                                <isNotNull property="dsCustSicDescTxt">
                                <!-- START 2018/04/10 Hd.Sugawara [QC#24388,MOD] -->
                                <!--  AND UPPER(ACCT.DS_CUST_SIC_DESC_TXT) LIKE UPPER(#dsCustSicDescTxt#) -->
                                AND (UPPER(ACCT.DS_CUST_SIC_DESC_TXT) LIKE UPPER(#dsCustSicDescTxt#) 
                                    OR UPPER(ACCT.PTY_DS_CUST_SIC_DESC_TXT) LIKE UPPER(#dsCustSicDescTxt#))
                                <!-- END 2018/04/10 Hd.Sugawara [QC#24388,MOD] -->
                                </isNotNull>
                                <!-- Contact First Name -->
                                <isNotNull property="ctacPsnFlg">
                                    AND EXISTS (SELECT 1 
                                                FROM 
                                                    DS_CTAC_PSN_RELN    PSN_RELN
                                                  , CTAC_PSN            PSN
                                                <isNotNull property="ctacPsnTelNum">
                                                  , DS_CTAC_PNT         PNT
                                                </isNotNull>
                                                <isNotNull property="ctacPsnEmlAddr">
                                                  , DS_CTAC_PNT         PNT_EML
                                                </isNotNull>
                                                WHERE
                                                    ACCT.GLBL_CMPY_CD = PSN_RELN.GLBL_CMPY_CD
                                                <!-- QC#25171-2 Del Start
                                                AND (ACCT.DS_ACCT_NUM = PSN_RELN.DS_ACCT_NUM OR ACCT.LOC_NUM = PSN_RELN.LOC_NUM)
                                                -->
                                                <!-- QC#25171-2 Add Start -->
                                                AND ACCT.DS_ACCT_NUM = PSN_RELN.DS_ACCT_NUM
                                                <!-- QC#25171-2 Add End -->
                                                AND PSN_RELN.EZCANCELFLAG = '0'
                                                AND PSN_RELN.GLBL_CMPY_CD = PSN.GLBL_CMPY_CD
                                                AND PSN_RELN.CTAC_PSN_PK = PSN.CTAC_PSN_PK
                                                AND PSN.EZCANCELFLAG = '0'
                                                <isNotNull property="ctacPsnFirstNm">
                                                AND UPPER(PSN.CTAC_PSN_FIRST_NM) LIKE UPPER(#ctacPsnFirstNm#)
                                                </isNotNull>
                                                <isNotNull property="ctacPsnLastNm">
                                                AND UPPER(PSN.CTAC_PSN_LAST_NM) LIKE UPPER(#ctacPsnLastNm#)
                                                </isNotNull>
                                                <isNotNull property="ctacPsnTelNum">
                                                AND PSN.GLBL_CMPY_CD = PNT.GLBL_CMPY_CD
                                                AND PSN.CTAC_PSN_PK = PNT.CTAC_PSN_PK
                                                AND PNT.EZCANCELFLAG = '0'
                                                AND PNT.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCd#
                                                AND PNT.DS_CTAC_PNT_VAL_TXT LIKE #ctacPsnTelNum#
                                                </isNotNull>
                                                <isNotNull property="ctacPsnEmlAddr">
                                                AND PSN.GLBL_CMPY_CD = PNT_EML.GLBL_CMPY_CD
                                                AND PSN.CTAC_PSN_PK = PNT_EML.CTAC_PSN_PK
                                                AND PNT_EML.EZCANCELFLAG = '0'
                                                AND PNT_EML.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCdIsEml#
                                                AND UPPER(PNT_EML.DS_CTAC_PNT_VAL_TXT) LIKE UPPER(#ctacPsnEmlAddr#)
                                                </isNotNull>
                                           )
                                </isNotNull>
                                <isNotNull property="dsAcctItrlFlg">
                                 AND ACCT.DS_ACCT_ITRL_FLG = #dsAcctItrlFlg#
                                </isNotNull>
                                <isNotNull property="dsXtrnlRefTxt">
                                 AND ACCT.DS_XTRNL_REF_TXT LIKE #dsXtrnlRefTxt#
                                </isNotNull>
                                <isNotNull property="dsAcctActvCustFlg">
                                 AND ACCT.DS_ACCT_ACTV_CUST_FLG = #dsAcctActvCustFlg# 
                                </isNotNull>
                                <isEqual property="inacLocFlg" compareValue="N">
                                 AND ACCT.LOC_RGTN_STS_CD = #rgtnSts_Actv#
                                </isEqual>
                                <isNotNull property="dsAcctClsCd">
                                 AND ACCT.DS_ACCT_CLS_CD = #dsAcctClsCd#
                                </isNotNull>
                                <isNotNull property="dsXrefAcctFlg">
                                    AND EXISTS (SELECT 1 FROM DS_XREF_ACCT XREF
                                                WHERE XREF.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
                                                AND XREF.LOC_NUM = ACCT.LOC_NUM
                                                AND XREF.EZCANCELFLAG = '0'
                                                <isNotNull property="dsXrefAcctTpCd">
                                                 AND XREF.DS_XREF_ACCT_TP_CD  = #dsXrefAcctTpCd#
                                                </isNotNull>
                                                <isNotNull property="dsXrefAcctCd">
                                                 AND XREF.DS_XREF_ACCT_CD LIKE #dsXrefAcctCd#
                                                </isNotNull>
                                           )
                                </isNotNull>
                                <isEqual property="isDisplayRelated" compareValue="N">
                                    <isEqual property="dispBillToFlg" compareValue="Y">
                                        AND BILL.RGTN_STS_CD = #rgtnSts_Actv#
                                    </isEqual>
                                    <isEqual property="dispShipToFlg" compareValue="Y">
                                        AND SHIP.RGTN_STS_CD = #rgtnSts_Actv#
                                    </isEqual>
                                </isEqual>
                                <!-- QC#25171-2 Add Start -->
                                <isNotNull property="ctacPsnFlg">
                                UNION
                                SELECT 
                                          ACCT.DS_ACCT_NUM  AS DS_ACCT_NUM
                                        , ''                            AS DS_ACCT_RELN_TP_CD
                                        , ACCT.DS_ACCT_NM               AS DS_ACCT_NM
                                        , ACCT.FIRST_LINE_ADDR ||
                                          DECODE(ACCT.SCD_LINE_ADDR, NULL, '', ' ' || ACCT.SCD_LINE_ADDR) ||
                                          DECODE(ACCT.THIRD_LINE_ADDR, NULL, '', ' ' || ACCT.THIRD_LINE_ADDR) ||
                                          DECODE(ACCT.FRTH_LINE_ADDR, NULL, '', ' ' || ACCT.FRTH_LINE_ADDR) ||
                                          ' ' ||
                                          ACCT.CTY_ADDR        || ' ' ||
                                          ACCT.ST_CD           || ' ' ||
                                          ACCT.POST_CD                  AS SHIP_FROM_FULL_CMPY_ADDR
                                        , ACCT.LOC_NUM                  AS LOC_NUM
                                        , ACCT.XX_YES_NO_CD             AS XX_YES_NO_CD
                                        , (SELECT DS_ACCT_TP_NM FROM DS_ACCT_TP TP
                                               WHERE TP.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
                                               AND TP.EZCANCELFLAG = '0'
                                               AND TP.DS_ACCT_TP_CD = ACCT.DS_ACCT_TP_CD
                                          )                             AS DS_ACCT_TP_NM
                                        , ACCT.DS_ACCT_NUM              AS ORIG_ACCT_NUM
                                        , ''                            AS RELN_DS_ACCT_NUM
                                        , BILL.BILL_TO_CUST_CD          AS BILL_TO_CUST_CD
                                        , SHIP.SHIP_TO_CUST_CD          AS SHIP_TO_CUST_CD
                                        , ACCT.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                                        , ACCT.PTY_LOC_PK               AS PTY_LOC_PK
                                        , ACCT.FIRST_LINE_ADDR          AS FIRST_LINE_ADDR
                                        , ACCT.SCD_LINE_ADDR            AS SCD_LINE_ADDR
                                        , ACCT.THIRD_LINE_ADDR          AS THIRD_LINE_ADDR
                                        , ACCT.FRTH_LINE_ADDR           AS FRTH_LINE_ADDR 
                                        , ACCT.PROV_NM                  AS PROV_NM
                                        , CNTY.CNTY_NM                  AS CNTY_NM
                                        , ACCT.CTRY_CD                  AS CTRY_CD
                                        , ROWNUM                        AS SORT_NUM
                                        , ACCT.DS_LOC_NM                AS DS_LOC_NM
                                        , ACCT.CTY_ADDR                 AS CTY_ADDR
                                        , ACCT.ST_CD                    AS ST_CD
                                        , ACCT.POST_CD                  AS POST_CD
                                        , ACCT.FIRST_REF_CMNT_TXT       AS FIRST_REF_CMNT_TXT
                                        , ACCT.SCD_REF_CMNT_TXT         AS SCD_REF_CMNT_TXT
                                        , ACCT.DS_ACCT_ACTV_CUST_FLG    AS DS_ACCT_ACTV_CUST_FLG
                                        , ACCT.LOC_RGTN_STS_CD          AS LOC_RGTN_STS_CD
                                        , ACCT.PTY_RGTN_STS_CD          AS PTY_RGTN_STS_CD
                                        , BILL.RGTN_STS_CD              AS BILL_RGTN_STS_CD
                                        , SHIP.RGTN_STS_CD              AS SHIP_RGTN_STS_CD
                                        , ACCT.EXIST_ACTV_ACCT_LOC_FLG
                                        <isNull property="ctacPsnFlg">
                                        , 'Y'                           AS HIT_LOC_CTAC_FLG
                                        </isNull>
                                        <isNotNull property="ctacPsnFlg">
                                        , CASE WHEN EXISTS (SELECT 1 
                                                        FROM 
                                                            DS_CTAC_PSN_RELN    PSN_RELN
                                                          , CTAC_PSN            PSN
                                                        <isNotNull property="ctacPsnTelNum">
                                                          , DS_CTAC_PNT         PNT
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnEmlAddr">
                                                          , DS_CTAC_PNT         PNT_EML
                                                        </isNotNull>
                                                        WHERE
                                                            ACCT.GLBL_CMPY_CD = PSN_RELN.GLBL_CMPY_CD
                                                        AND ACCT.LOC_NUM = PSN_RELN.LOC_NUM
                                                        AND PSN_RELN.EZCANCELFLAG = '0'
                                                        AND PSN_RELN.GLBL_CMPY_CD = PSN.GLBL_CMPY_CD
                                                        AND PSN_RELN.CTAC_PSN_PK = PSN.CTAC_PSN_PK
                                                        AND PSN.EZCANCELFLAG = '0'
                                                        <isNotNull property="ctacPsnFirstNm">
                                                        AND UPPER(PSN.CTAC_PSN_FIRST_NM) LIKE UPPER(#ctacPsnFirstNm#)
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnLastNm">
                                                        AND UPPER(PSN.CTAC_PSN_LAST_NM) LIKE UPPER(#ctacPsnLastNm#)
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnTelNum">
                                                        AND PSN.GLBL_CMPY_CD = PNT.GLBL_CMPY_CD
                                                        AND PSN.CTAC_PSN_PK = PNT.CTAC_PSN_PK
                                                        AND PNT.EZCANCELFLAG = '0'
                                                        AND PNT.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCd#
                                                        AND PNT.DS_CTAC_PNT_VAL_TXT LIKE #ctacPsnTelNum#
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnEmlAddr">
                                                        AND PSN.GLBL_CMPY_CD = PNT_EML.GLBL_CMPY_CD
                                                        AND PSN.CTAC_PSN_PK = PNT_EML.CTAC_PSN_PK
                                                        AND PNT_EML.EZCANCELFLAG = '0'
                                                        AND PNT_EML.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCdIsEml#
                                                        AND UPPER(PNT_EML.DS_CTAC_PNT_VAL_TXT) LIKE UPPER(#ctacPsnEmlAddr#)
                                                        </isNotNull>
                                                   )
                                            THEN 'Y' ELSE 'N' END       AS HIT_LOC_CTAC_FLG
                                        </isNotNull>
                                FROM
                                    ( 
                                    <isNotEqual property="dsAcctTpCdCust" compareValue="N">
                                        SELECT CUST.GLBL_CMPY_CD          AS GLBL_CMPY_CD
                                             , CUST.EZCANCELFLAG          AS EZCANCELFLAG
                                             , CUST.DS_ACCT_NM            AS DS_ACCT_NM
                                             , CUST.DS_ACCT_ACTV_CUST_FLG AS DS_ACCT_ACTV_CUST_FLG
                                             , CUST.SELL_TO_CUST_CD       AS DS_ACCT_NUM
                                             , CUST.DBA_NM                AS DBA_NM
                                             , CUST.DS_ACCT_LEGAL_NM      AS DS_ACCT_LEGAL_NM
                                             , CUST.DS_ACCT_DUNS_NUM      AS DS_ACCT_DUNS_NUM
                                             , CUST.DS_ULT_DUNS_NUM       AS DS_ULT_DUNS_NUM
                                             , CUST.DS_CUST_SIC_DESC_TXT  AS DS_CUST_SIC_DESC_TXT
                                             , CUST.DS_ACCT_ITRL_FLG      AS DS_ACCT_ITRL_FLG
                                             , CUST.DS_XTRNL_REF_TXT      AS DS_XTRNL_REF_TXT
                                             , CUST.DS_ACCT_CLS_CD        AS DS_ACCT_CLS_CD
                                             , CUST.DS_ACCT_TP_CD         AS DS_ACCT_TP_CD
                                             , PRIN.PTY_LOC_PK            AS PTY_LOC_PK
                                             , PTY.LOC_NUM                AS LOC_NUM
                                             , PTY.CNTY_PK                AS CNTY_PK
                                             , PTY.FIRST_LINE_ADDR        AS FIRST_LINE_ADDR
                                             , PTY.SCD_LINE_ADDR          AS SCD_LINE_ADDR
                                             , PTY.THIRD_LINE_ADDR        AS THIRD_LINE_ADDR
                                             , PTY.FRTH_LINE_ADDR         AS FRTH_LINE_ADDR
                                             , PTY.CTY_ADDR               AS CTY_ADDR
                                             , PTY.ST_CD                  AS ST_CD
                                             , PTY.POST_CD                AS POST_CD
                                             , PTY.DS_LOC_NM              AS DS_LOC_NM
                                             , PTY.PROV_NM                AS PROV_NM
                                             , PTY.CTRY_CD                AS CTRY_CD
                                             , PTY.FIRST_REF_CMNT_TXT     AS FIRST_REF_CMNT_TXT
                                             , PTY.SCD_REF_CMNT_TXT       AS SCD_REF_CMNT_TXT
                                             , PTY.RGTN_STS_CD            AS PTY_RGTN_STS_CD
                                             , LOC.RGTN_STS_CD            AS LOC_RGTN_STS_CD
                                             , PRIN.PRIN_CUST_PK          AS PRIN_CUST_PK
                                             , CASE WHEN PRIN.PRIN_CUST_PK IS NOT NULL THEN 'Y' ELSE 'N' END AS XX_YES_NO_CD
                                             , PTY.DUNS_NUM               AS PTY_DUNS_NUM
                                             , PTY.DS_ULT_DUNS_NUM        AS PTY_DS_ULT_DUNS_NUM
                                             , PTY.DS_CUST_SIC_DESC_TXT   AS PTY_DS_CUST_SIC_DESC_TXT
                                             , CASE WHEN
                                                 EXISTS (
                                                     SELECT
                                                         1
                                                     FROM
                                                         ACCT_LOC LOC2
                                                     WHERE
                                                         LOC2.EZCANCELFLAG = '0'
                                                     AND LOC2.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD
                                                     AND LOC2.LOC_NUM      = PTY.LOC_NUM
                                                     AND LOC2.RGTN_STS_CD  = #rgtnSts_Actv#
                                                 ) THEN 'Y'
                                                 ELSE 'N'
                                               END EXIST_ACTV_ACCT_LOC_FLG
                                        FROM   SELL_TO_CUST CUST
                                             , ACCT_LOC     LOC
                                             , PTY_LOC_WRK  PTY
                                             , PRIN_CUST    PRIN
                                        WHERE  CUST.GLBL_CMPY_CD = #glblCmpyCd#
                                        AND    CUST.EZCANCELFLAG = '0'
                                        AND    CUST.GLBL_CMPY_CD = LOC.GLBL_CMPY_CD(+)
                                        AND    CUST.SELL_TO_CUST_CD = LOC.DS_ACCT_NUM(+)
                                        <isNotEqual property="xxChkBox_01" compareValue="Y">
                                        AND    CUST.LOC_NUM = LOC.LOC_NUM(+)
                                        </isNotEqual>
                                        AND    LOC.EZCANCELFLAG(+) = '0'
                                        AND    LOC.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD(+)
                                        AND    LOC.PTY_LOC_PK = PTY.PTY_LOC_PK(+)
                                        AND    PTY.EZCANCELFLAG(+) = '0'
                                        AND    PTY.GLBL_CMPY_CD = PRIN.GLBL_CMPY_CD(+)
                                        AND    PTY.LOC_NUM = PRIN.LOC_NUM(+)
                                        AND    PRIN.EZCANCELFLAG(+) = '0'
                                    </isNotEqual>
                                    <isNull property="dsAcctTpCdCust">
                                        UNION ALL
                                    </isNull>
                                    <isNotEqual property="dsAcctTpCdCust" compareValue="Y">
                                        SELECT CUST.GLBL_CMPY_CD          AS GLBL_CMPY_CD
                                             , CUST.EZCANCELFLAG          AS EZCANCELFLAG
                                             , CUST.DS_ACCT_NM            AS DS_ACCT_NM
                                             , CUST.DS_ACCT_ACTV_CUST_FLG AS DS_ACCT_ACTV_CUST_FLG
                                             , CUST.DS_ACCT_NUM           AS DS_ACCT_NUM
                                             , CUST.DBA_NM                AS DBA_NM
                                             , CUST.DS_ACCT_LEGAL_NM      AS DS_ACCT_LEGAL_NM
                                             , CUST.DS_ACCT_DUNS_NUM      AS DS_ACCT_DUNS_NUM
                                             , CUST.DS_ULT_DUNS_NUM       AS DS_ULT_DUNS_NUM
                                             , CUST.DS_CUST_SIC_DESC_TXT  AS DS_CUST_SIC_DESC_TXT
                                             , CUST.DS_ACCT_ITRL_FLG      AS DS_ACCT_ITRL_FLG
                                             , CUST.DS_XTRNL_REF_TXT      AS DS_XTRNL_REF_TXT
                                             , CUST.DS_ACCT_CLS_CD        AS DS_ACCT_CLS_CD
                                             , CUST.DS_ACCT_TP_CD         AS DS_ACCT_TP_CD
                                             , PTY.PTY_LOC_PK             AS PTY_LOC_PK
                                             , PTY.LOC_NUM                AS LOC_NUM
                                             , PTY.CNTY_PK                AS CNTY_PK
                                             , PTY.FIRST_LINE_ADDR        AS FIRST_LINE_ADDR
                                             , PTY.SCD_LINE_ADDR          AS SCD_LINE_ADDR
                                             , PTY.THIRD_LINE_ADDR        AS THIRD_LINE_ADDR
                                             , PTY.FRTH_LINE_ADDR         AS FRTH_LINE_ADDR
                                             , PTY.CTY_ADDR               AS CTY_ADDR
                                             , PTY.ST_CD                  AS ST_CD
                                             , PTY.POST_CD                AS POST_CD
                                             , PTY.DS_LOC_NM              AS DS_LOC_NM
                                             , PTY.PROV_NM                AS PROV_NM
                                             , PTY.CTRY_CD                AS CTRY_CD
                                             , PTY.FIRST_REF_CMNT_TXT     AS FIRST_REF_CMNT_TXT
                                             , PTY.SCD_REF_CMNT_TXT       AS SCD_REF_CMNT_TXT
                                             , PTY.RGTN_STS_CD            AS PTY_RGTN_STS_CD
                                             , PTY.RGTN_STS_CD            AS LOC_RGTN_STS_CD
                                             , null                       AS PRIN_CUST_PK
                                             , CASE WHEN PTY.LOC_NUM IS NOT NULL THEN 'Y' ELSE 'N' END AS XX_YES_NO_CD
                                             , PTY.DUNS_NUM               AS PTY_DUNS_NUM
                                             , PTY.DS_ULT_DUNS_NUM        AS PTY_DS_ULT_DUNS_NUM
                                             , PTY.DS_CUST_SIC_DESC_TXT   AS PTY_DS_CUST_SIC_DESC_TXT
                                             , CASE WHEN
                                                 EXISTS (
                                                     SELECT
                                                         1
                                                     FROM
                                                         PROS_PTY_LOC_WRK LOC2
                                                     WHERE
                                                         LOC2.EZCANCELFLAG = '0'
                                                     AND LOC2.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD
                                                     AND LOC2.LOC_NUM      = PTY.LOC_NUM
                                                     AND LOC2.RGTN_STS_CD  = #rgtnSts_Actv#
                                                 ) THEN 'Y'
                                                 ELSE 'N'
                                               END EXIST_ACTV_ACCT_LOC_FLG
                                        FROM   DS_ACCT_PROS     CUST
                                             , PROS_PTY_LOC_WRK PTY
                                        WHERE  CUST.GLBL_CMPY_CD = #glblCmpyCd#
                                        AND    CUST.EZCANCELFLAG = '0'
                                        AND    CUST.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD(+)
                                        AND    CUST.PTY_LOC_PK = PTY.PTY_LOC_PK(+)
                                        <isNotEqual property="xxChkBox_01" compareValue="Y">
                                        AND    CUST.LOC_NUM = PTY.LOC_NUM(+)
                                        </isNotEqual>
                                        AND    PTY.EZCANCELFLAG(+) = '0'
                                    </isNotEqual>
                                      ) ACCT
                                    , BILL_TO_CUST BILL
                                    , SHIP_TO_CUST SHIP
                                    , CNTY CNTY
                                WHERE
                                    ACCT.GLBL_CMPY_CD = #glblCmpyCd#
                                AND ACCT.EZCANCELFLAG = '0'
                                AND ACCT.GLBL_CMPY_CD = BILL.GLBL_CMPY_CD(+)
                                AND ACCT.LOC_NUM = BILL.LOC_NUM(+)
                                AND BILL.EZCANCELFLAG(+) = '0'
                                AND ACCT.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD(+)
                                AND ACCT.LOC_NUM = SHIP.LOC_NUM(+)
                                AND SHIP.EZCANCELFLAG(+) = '0'
                                AND ACCT.CNTY_PK             = CNTY.CNTY_PK(+)
                                AND ACCT.GLBL_CMPY_CD        = CNTY.GLBL_CMPY_CD(+)
                                AND CNTY.EZCANCELFLAG(+)    = '0'
                                <isNotNull property="dsAcctActvCustFlg">
                                 AND ACCT.DS_ACCT_ACTV_CUST_FLG = #dsAcctActvCustFlg# 
                                </isNotNull>

                                <isNotNull property="dsAcctNm">
                                AND ACCT.DS_ACCT_NM LIKE #dsAcctNm#
                                </isNotNull>
                                <!-- Address -->
                                <isNotNull property="shipFromFullCmpyAddr">
                                AND UPPER(ACCT.FIRST_LINE_ADDR) || 
                                    DECODE(ACCT.SCD_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.SCD_LINE_ADDR)) ||
                                    DECODE(ACCT.THIRD_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.THIRD_LINE_ADDR)) ||
                                    DECODE(ACCT.FRTH_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.FRTH_LINE_ADDR)) LIKE #shipFromFullCmpyAddr#
                                </isNotNull>
                                <!-- Bill To Code -->
                                <isNotNull property="billToCustCd">
                                AND BILL.BILL_TO_CUST_CD LIKE #billToCustCd#
                                </isNotNull>
                                <!-- Ship To Code -->
                                <isNotNull property="shipToCustCd">
                                AND SHIP.SHIP_TO_CUST_CD LIKE #shipToCustCd#
                                </isNotNull>
                                <!-- City -->
                                <isNotNull property="ctyAddr">
                                AND UPPER(ACCT.CTY_ADDR) LIKE #ctyAddr#
                                </isNotNull>
                                <!-- State -->
                                <isNotNull property="stCd">
                                AND ACCT.ST_CD = #stCd#
                                </isNotNull>
                                <!-- Postal Code -->
                                <isNotNull property="postCd">
                                AND ACCT.POST_CD LIKE #postCd#
                                </isNotNull>
                                <!-- Account Number -->
                                <isNotNull property="dsAcctNum">
                                AND ACCT.DS_ACCT_NUM LIKE #dsAcctNum#
                                </isNotNull>
                                <!-- Location Number -->
                                <isNotNull property="locNum">
                                AND ACCT.LOC_NUM LIKE #locNum#
                                </isNotNull>
                                <!-- DBA Name -->
                                <isNotNull property="dbaNm">
                                AND ACCT.DBA_NM LIKE #dbaNm#
                                </isNotNull>
                                <!-- Account Legal Name -->
                                <isNotNull property="dsAcctLegalNm">
                                AND ACCT.DS_ACCT_LEGAL_NM LIKE #dsAcctLegalNm#
                                </isNotNull>
                                <!-- Account Group Code -->
                                <isNotNull property="dsAcctGrpCd">
                                AND EXISTS (SELECT 1 FROM DS_ACCT_GRP_ASG ASG 
                                            WHERE ASG.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
                                            AND ASG.EZCANCELFLAG = '0'
                                            AND ASG.DS_ACCT_NUM = ACCT.DS_ACCT_NUM
                                            AND ASG.EFF_FROM_DT &lt;= #slsDt#
                                            AND (ASG.EFF_THRU_DT &gt;= #slsDt#
                                                OR ASG.EFF_THRU_DT IS NULL ) 
                                            AND ASG.DS_ACCT_GRP_CD LIKE #dsAcctGrpCd#
                                    )
                                </isNotNull>
                                
                                <!-- Location Name -->
                                <isNotNull property="locNm">
                                AND UPPER(ACCT.DS_LOC_NM) LIKE #locNm#
                                </isNotNull>
                                <isNotNull property="dsAcctDunsNum">
                                AND (ACCT.DS_ACCT_DUNS_NUM LIKE #dsAcctDunsNum# OR ACCT.PTY_DUNS_NUM LIKE #dsAcctDunsNum#)
                                </isNotNull>
                                <!-- UDUNS Number -->
                                <isNotNull property="dsUltDunsNum">
                                AND (ACCT.DS_ULT_DUNS_NUM LIKE #dsUltDunsNum# OR ACCT.PTY_DS_ULT_DUNS_NUM LIKE #dsUltDunsNum#)
                                </isNotNull>
                                <!-- Industry -->
                                <isNotNull property="dsCustSicDescTxt">
                                AND (UPPER(ACCT.DS_CUST_SIC_DESC_TXT) LIKE UPPER(#dsCustSicDescTxt#) 
                                    OR UPPER(ACCT.PTY_DS_CUST_SIC_DESC_TXT) LIKE UPPER(#dsCustSicDescTxt#))
                                </isNotNull>
                                <!-- Contact First Name -->
                                <isNotNull property="ctacPsnFlg">
                                    AND EXISTS (SELECT 1 
                                                FROM 
                                                    DS_CTAC_PSN_RELN    PSN_RELN
                                                  , CTAC_PSN            PSN
                                                <isNotNull property="ctacPsnTelNum">
                                                  , DS_CTAC_PNT         PNT
                                                </isNotNull>
                                                <isNotNull property="ctacPsnEmlAddr">
                                                  , DS_CTAC_PNT         PNT_EML
                                                </isNotNull>
                                                WHERE
                                                    ACCT.GLBL_CMPY_CD = PSN_RELN.GLBL_CMPY_CD
                                                AND ACCT.LOC_NUM = PSN_RELN.LOC_NUM
                                                AND PSN_RELN.EZCANCELFLAG = '0'
                                                AND PSN_RELN.GLBL_CMPY_CD = PSN.GLBL_CMPY_CD
                                                AND PSN_RELN.CTAC_PSN_PK = PSN.CTAC_PSN_PK
                                                AND PSN.EZCANCELFLAG = '0'
                                                <isNotNull property="ctacPsnFirstNm">
                                                AND UPPER(PSN.CTAC_PSN_FIRST_NM) LIKE UPPER(#ctacPsnFirstNm#)
                                                </isNotNull>
                                                <isNotNull property="ctacPsnLastNm">
                                                AND UPPER(PSN.CTAC_PSN_LAST_NM) LIKE UPPER(#ctacPsnLastNm#)
                                                </isNotNull>
                                                <isNotNull property="ctacPsnTelNum">
                                                AND PSN.GLBL_CMPY_CD = PNT.GLBL_CMPY_CD
                                                AND PSN.CTAC_PSN_PK = PNT.CTAC_PSN_PK
                                                AND PNT.EZCANCELFLAG = '0'
                                                AND PNT.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCd#
                                                AND PNT.DS_CTAC_PNT_VAL_TXT LIKE #ctacPsnTelNum#
                                                </isNotNull>
                                                <isNotNull property="ctacPsnEmlAddr">
                                                AND PSN.GLBL_CMPY_CD = PNT_EML.GLBL_CMPY_CD
                                                AND PSN.CTAC_PSN_PK = PNT_EML.CTAC_PSN_PK
                                                AND PNT_EML.EZCANCELFLAG = '0'
                                                AND PNT_EML.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCdIsEml#
                                                AND UPPER(PNT_EML.DS_CTAC_PNT_VAL_TXT) LIKE UPPER(#ctacPsnEmlAddr#)
                                                </isNotNull>
                                           )
                                </isNotNull>
                                <isNotNull property="dsAcctItrlFlg">
                                 AND ACCT.DS_ACCT_ITRL_FLG = #dsAcctItrlFlg#
                                </isNotNull>
                                <isNotNull property="dsXtrnlRefTxt">
                                 AND ACCT.DS_XTRNL_REF_TXT LIKE #dsXtrnlRefTxt#
                                </isNotNull>
                                <isNotNull property="dsAcctActvCustFlg">
                                 AND ACCT.DS_ACCT_ACTV_CUST_FLG = #dsAcctActvCustFlg# 
                                </isNotNull>
                                <isEqual property="inacLocFlg" compareValue="N">
                                 AND ACCT.LOC_RGTN_STS_CD = #rgtnSts_Actv#
                                </isEqual>
                                <isNotNull property="dsAcctClsCd">
                                 AND ACCT.DS_ACCT_CLS_CD = #dsAcctClsCd#
                                </isNotNull>
                                <isNotNull property="dsXrefAcctFlg">
                                    AND EXISTS (SELECT 1 FROM DS_XREF_ACCT XREF
                                                WHERE XREF.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
                                                AND XREF.LOC_NUM = ACCT.LOC_NUM
                                                AND XREF.EZCANCELFLAG = '0'
                                                <isNotNull property="dsXrefAcctTpCd">
                                                 AND XREF.DS_XREF_ACCT_TP_CD  = #dsXrefAcctTpCd#
                                                </isNotNull>
                                                <isNotNull property="dsXrefAcctCd">
                                                 AND XREF.DS_XREF_ACCT_CD LIKE #dsXrefAcctCd#
                                                </isNotNull>
                                           )
                                </isNotNull>
                                <isEqual property="isDisplayRelated" compareValue="N">
                                    <isEqual property="dispBillToFlg" compareValue="Y">
                                        AND BILL.RGTN_STS_CD = #rgtnSts_Actv#
                                    </isEqual>
                                    <isEqual property="dispShipToFlg" compareValue="Y">
                                        AND SHIP.RGTN_STS_CD = #rgtnSts_Actv#
                                    </isEqual>
                                </isEqual>
                                </isNotNull>
                                <!-- QC#25171-2 END -->
                                ) A_SFW1
                            )  LF_A
                       , (SELECT   A_SFW2.DS_ACCT_NUM
                                 , A_SFW2.DS_ACCT_RELN_TP_CD
                                 , A_SFW2.DS_ACCT_NM
                                 , A_SFW2.SHIP_FROM_FULL_CMPY_ADDR
                                 , A_SFW2.LOC_NUM
                                 , A_SFW2.XX_YES_NO_CD
                                 , A_SFW2.DS_ACCT_TP_NM
                                 , A_SFW2.ORIG_ACCT_NUM
                                 , A_SFW2.RELN_DS_ACCT_NUM
                                 , A_SFW2.BILL_TO_CUST_CD
                                 , A_SFW2.SHIP_TO_CUST_CD
                                 , A_SFW2.GLBL_CMPY_CD
                                 , A_SFW2.PTY_LOC_PK
                                 , A_SFW2.FIRST_LINE_ADDR
                                 , A_SFW2.SCD_LINE_ADDR
                                 , A_SFW2.THIRD_LINE_ADDR
                                 , A_SFW2.FRTH_LINE_ADDR 
                                 , A_SFW2.PROV_NM
                                 , A_SFW2.CNTY_NM
                                 , A_SFW2.CTRY_CD
                                 , A_SFW2.SORT_NUM
                                 , A_SFW2.DS_LOC_NM
                                 , A_SFW2.CTY_ADDR
                                 , A_SFW2.ST_CD
                                 , A_SFW2.POST_CD
                                 , A_SFW2.FIRST_REF_CMNT_TXT
                                 , A_SFW2.SCD_REF_CMNT_TXT
                                 , A_SFW2.DS_ACCT_ACTV_CUST_FLG
                                 , A_SFW2.LOC_RGTN_STS_CD
                                 , A_SFW2.PTY_RGTN_STS_CD
                                 , A_SFW2.BILL_RGTN_STS_CD
                                 , A_SFW2.SHIP_RGTN_STS_CD
                                 , A_SFW2.HIT_LOC_CTAC_FLG
                         <isEqual property="inacLocFlg" compareValue="N">
                           <isEqual property="inacBillToShipToFlg" compareValue="N">
                         , CASE 
                                WHEN A_SFW2.HIT_LOC_CTAC_FLG = 'N' THEN 'ACCT'
                                WHEN A_SFW2.LOC_RGTN_STS_CD IS NULL THEN 'ACCT'
                                WHEN A_SFW2.LOC_RGTN_STS_CD != #rgtnSts_Actv# THEN 'ACCT'
                                WHEN A_SFW2.PTY_RGTN_STS_CD != #rgtnSts_Actv# THEN 'ACCT'
                                WHEN A_SFW2.BILL_RGTN_STS_CD IS NULL AND A_SFW2.SHIP_RGTN_STS_CD IS NULL THEN 'ACCT+LOC'
                                WHEN A_SFW2.BILL_RGTN_STS_CD = #rgtnSts_Actv# THEN 'ACCT+LOC'
                                WHEN A_SFW2.SHIP_RGTN_STS_CD = #rgtnSts_Actv# THEN 'ACCT+LOC'
                                ELSE 'ACCT'
                            END AS DPLY_TP
                           </isEqual>
                           <isEqual property="inacBillToShipToFlg" compareValue="Y">
                         , CASE 
                                WHEN A_SFW2.HIT_LOC_CTAC_FLG = 'N' THEN 'ACCT'
                                WHEN A_SFW2.LOC_RGTN_STS_CD IS NULL THEN 'ACCT'
                                WHEN A_SFW2.BILL_RGTN_STS_CD IS NULL AND A_SFW2.SHIP_RGTN_STS_CD IS NULL AND A_SFW2.LOC_RGTN_STS_CD != #rgtnSts_Actv# THEN 'ACCT'
                                WHEN A_SFW2.BILL_RGTN_STS_CD IS NULL AND A_SFW2.SHIP_RGTN_STS_CD IS NULL AND A_SFW2.PTY_RGTN_STS_CD != #rgtnSts_Actv# THEN 'ACCT'
                                ELSE 'ACCT+LOC'
                            END AS DPLY_TP
                           </isEqual>
                         </isEqual>
                         <isEqual property="inacLocFlg" compareValue="Y">
                         , CASE 
                                WHEN A_SFW2.HIT_LOC_CTAC_FLG = 'N' THEN 'ACCT'
                                ELSE 'ACCT+LOC'
                            END AS DPLY_TP
                         </isEqual>
                          FROM 
                              ( SELECT 
                                          ACCT.DS_ACCT_NUM  AS DS_ACCT_NUM
                                        , ''                            AS DS_ACCT_RELN_TP_CD
                                        , ACCT.DS_ACCT_NM               AS DS_ACCT_NM
                                        , ACCT.FIRST_LINE_ADDR ||
                                          DECODE(ACCT.SCD_LINE_ADDR, NULL, '', ' ' || ACCT.SCD_LINE_ADDR) ||
                                          DECODE(ACCT.THIRD_LINE_ADDR, NULL, '', ' ' || ACCT.THIRD_LINE_ADDR) ||
                                          DECODE(ACCT.FRTH_LINE_ADDR, NULL, '', ' ' || ACCT.FRTH_LINE_ADDR) ||
                                          ' ' ||
                                          ACCT.CTY_ADDR        || ' ' ||
                                          ACCT.ST_CD           || ' ' ||
                                          ACCT.POST_CD                  AS SHIP_FROM_FULL_CMPY_ADDR
                                        , ACCT.LOC_NUM                  AS LOC_NUM
                                        , ACCT.XX_YES_NO_CD             AS XX_YES_NO_CD
                                        , (SELECT DS_ACCT_TP_NM FROM DS_ACCT_TP TP
                                               WHERE TP.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
                                               AND TP.EZCANCELFLAG = '0'
                                               AND TP.DS_ACCT_TP_CD = ACCT.DS_ACCT_TP_CD
                                          )                             AS DS_ACCT_TP_NM
                                        , ACCT.DS_ACCT_NUM              AS ORIG_ACCT_NUM
                                        , ''                            AS RELN_DS_ACCT_NUM
                                        , BILL.BILL_TO_CUST_CD          AS BILL_TO_CUST_CD
                                        , SHIP.SHIP_TO_CUST_CD          AS SHIP_TO_CUST_CD
                                        , ACCT.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                                        , ACCT.PTY_LOC_PK               AS PTY_LOC_PK
                                        , ACCT.FIRST_LINE_ADDR          AS FIRST_LINE_ADDR
                                        , ACCT.SCD_LINE_ADDR            AS SCD_LINE_ADDR
                                        , ACCT.THIRD_LINE_ADDR          AS THIRD_LINE_ADDR
                                        , ACCT.FRTH_LINE_ADDR           AS FRTH_LINE_ADDR 
                                        , ACCT.PROV_NM                  AS PROV_NM
                                        , CNTY.CNTY_NM                  AS CNTY_NM
                                        , ACCT.CTRY_CD                  AS CTRY_CD
                                        , ROWNUM                        AS SORT_NUM
                                        , ACCT.DS_LOC_NM                AS DS_LOC_NM
                                        , ACCT.CTY_ADDR                 AS CTY_ADDR
                                        , ACCT.ST_CD                    AS ST_CD
                                        , ACCT.POST_CD                  AS POST_CD
                                        , ACCT.FIRST_REF_CMNT_TXT       AS FIRST_REF_CMNT_TXT
                                        , ACCT.SCD_REF_CMNT_TXT         AS SCD_REF_CMNT_TXT
                                        , ACCT.DS_ACCT_ACTV_CUST_FLG    AS DS_ACCT_ACTV_CUST_FLG
                                        , ACCT.LOC_RGTN_STS_CD          AS LOC_RGTN_STS_CD
                                        , ACCT.PTY_RGTN_STS_CD          AS PTY_RGTN_STS_CD
                                        , BILL.RGTN_STS_CD              AS BILL_RGTN_STS_CD
                                        , SHIP.RGTN_STS_CD              AS SHIP_RGTN_STS_CD
                                        <isNull property="ctacPsnFlg">
                                        , 'Y'                           AS HIT_LOC_CTAC_FLG
                                        </isNull>
                                        <isNotNull property="ctacPsnFlg">
                                        , CASE WHEN EXISTS (SELECT 1 
                                                        FROM 
                                                            DS_CTAC_PSN_RELN    PSN_RELN2
                                                          , CTAC_PSN            PSN2
                                                        <isNotNull property="ctacPsnTelNum">
                                                          , DS_CTAC_PNT         PNT2
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnEmlAddr">
                                                          , DS_CTAC_PNT         PNT_EML2
                                                        </isNotNull>
                                                        WHERE
                                                            ACCT.GLBL_CMPY_CD = PSN_RELN2.GLBL_CMPY_CD
                                                        AND ACCT.LOC_NUM = PSN_RELN2.LOC_NUM
                                                        AND PSN_RELN2.EZCANCELFLAG = '0'
                                                        AND PSN_RELN2.GLBL_CMPY_CD = PSN2.GLBL_CMPY_CD
                                                        AND PSN_RELN2.CTAC_PSN_PK = PSN2.CTAC_PSN_PK
                                                        AND PSN2.EZCANCELFLAG = '0'
                                                        <isNotNull property="ctacPsnFirstNm">
                                                        AND UPPER(PSN2.CTAC_PSN_FIRST_NM) LIKE UPPER(#ctacPsnFirstNm#)
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnLastNm">
                                                        AND UPPER(PSN2.CTAC_PSN_LAST_NM) LIKE UPPER(#ctacPsnLastNm#)
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnTelNum">
                                                        AND PSN2.GLBL_CMPY_CD = PNT2.GLBL_CMPY_CD
                                                        AND PSN2.CTAC_PSN_PK = PNT2.CTAC_PSN_PK
                                                        AND PNT2.EZCANCELFLAG = '0'
                                                        AND PNT2.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCd#
                                                        AND PNT2.DS_CTAC_PNT_VAL_TXT LIKE #ctacPsnTelNum#
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnEmlAddr">
                                                        AND PSN2.GLBL_CMPY_CD = PNT_EML2.GLBL_CMPY_CD
                                                        AND PSN2.CTAC_PSN_PK = PNT_EML2.CTAC_PSN_PK
                                                        AND PNT_EML2.EZCANCELFLAG = '0'
                                                        AND PNT_EML2.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCdIsEml#
                                                        AND UPPER(PNT_EML2.DS_CTAC_PNT_VAL_TXT) LIKE UPPER(#ctacPsnEmlAddr#)
                                                </isNotNull>
                                                   )
                                            THEN 'Y' ELSE 'N' END       AS HIT_LOC_CTAC_FLG
                                        </isNotNull>
                        <!--        FROM ACCT-->
                                FROM
                                    ( 
                                    <isNotEqual property="dsAcctTpCdCust" compareValue="N">
                                        SELECT CUST.GLBL_CMPY_CD          AS GLBL_CMPY_CD
                                             , CUST.EZCANCELFLAG          AS EZCANCELFLAG
                                             , CUST.DS_ACCT_NM            AS DS_ACCT_NM
                                             , CUST.DS_ACCT_ACTV_CUST_FLG AS DS_ACCT_ACTV_CUST_FLG
                                             , CUST.SELL_TO_CUST_CD       AS DS_ACCT_NUM
                                             , CUST.DBA_NM                AS DBA_NM
                                             , CUST.DS_ACCT_LEGAL_NM      AS DS_ACCT_LEGAL_NM
                                             , CUST.DS_ACCT_DUNS_NUM      AS DS_ACCT_DUNS_NUM
                                             , CUST.DS_ULT_DUNS_NUM       AS DS_ULT_DUNS_NUM
                                             , CUST.DS_CUST_SIC_DESC_TXT  AS DS_CUST_SIC_DESC_TXT
                                             , CUST.DS_ACCT_ITRL_FLG      AS DS_ACCT_ITRL_FLG
                                             , CUST.DS_XTRNL_REF_TXT      AS DS_XTRNL_REF_TXT
                                             , CUST.DS_ACCT_CLS_CD        AS DS_ACCT_CLS_CD
                                             , CUST.DS_ACCT_TP_CD         AS DS_ACCT_TP_CD
                                             , PRIN.PTY_LOC_PK            AS PTY_LOC_PK
                                             , PTY.LOC_NUM                AS LOC_NUM
                                             , PTY.CNTY_PK                AS CNTY_PK
                                             , PTY.FIRST_LINE_ADDR        AS FIRST_LINE_ADDR
                                             , PTY.SCD_LINE_ADDR          AS SCD_LINE_ADDR
                                             , PTY.THIRD_LINE_ADDR        AS THIRD_LINE_ADDR
                                             , PTY.FRTH_LINE_ADDR         AS FRTH_LINE_ADDR
                                             , PTY.CTY_ADDR               AS CTY_ADDR
                                             , PTY.ST_CD                  AS ST_CD
                                             , PTY.POST_CD                AS POST_CD
                                             , PTY.DS_LOC_NM              AS DS_LOC_NM
                                             , PTY.PROV_NM                AS PROV_NM
                                             , PTY.CTRY_CD                AS CTRY_CD
                                             , PTY.FIRST_REF_CMNT_TXT     AS FIRST_REF_CMNT_TXT
                                             , PTY.SCD_REF_CMNT_TXT       AS SCD_REF_CMNT_TXT
                                             , PTY.RGTN_STS_CD            AS PTY_RGTN_STS_CD
                                             , LOC.RGTN_STS_CD            AS LOC_RGTN_STS_CD
                                             , PRIN.PRIN_CUST_PK          AS PRIN_CUST_PK
                                             , CASE WHEN PRIN.PRIN_CUST_PK IS NOT NULL THEN 'Y' ELSE 'N' END AS XX_YES_NO_CD
                                             <!-- START 2018/04/10 Hd.Sugawara [QC#24388,ADD] -->
                                             , PTY.DUNS_NUM               AS PTY_DUNS_NUM
                                             , PTY.DS_ULT_DUNS_NUM        AS PTY_DS_ULT_DUNS_NUM
                                             , PTY.DS_CUST_SIC_DESC_TXT   AS PTY_DS_CUST_SIC_DESC_TXT
                                             <!-- END 2018/04/10 Hd.Sugawara [QC#24388,ADD] -->
                                        FROM   SELL_TO_CUST CUST
                                             , ACCT_LOC     LOC
                                             , PTY_LOC_WRK  PTY
                                             , PRIN_CUST    PRIN
                                        WHERE  CUST.GLBL_CMPY_CD = #glblCmpyCd#
                                        AND    CUST.EZCANCELFLAG = '0'
                                        AND    CUST.GLBL_CMPY_CD = LOC.GLBL_CMPY_CD(+)
                                        AND    CUST.SELL_TO_CUST_CD = LOC.DS_ACCT_NUM(+)
                                        <isNotEqual property="xxChkBox_01" compareValue="Y">
                                        AND    CUST.LOC_NUM = LOC.LOC_NUM(+)
                                        </isNotEqual>
                                        AND    LOC.EZCANCELFLAG(+) = '0'
                                        AND    LOC.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD(+)
                                        AND    LOC.PTY_LOC_PK = PTY.PTY_LOC_PK(+)
                                        AND    PTY.EZCANCELFLAG(+) = '0'
                                        AND    PTY.GLBL_CMPY_CD = PRIN.GLBL_CMPY_CD(+)
                                        AND    PTY.LOC_NUM = PRIN.LOC_NUM(+)
                                        AND    PRIN.EZCANCELFLAG(+) = '0'
                                    </isNotEqual>
                                    <isNull property="dsAcctTpCdCust">
                                        UNION ALL
                                    </isNull>
                                    <isNotEqual property="dsAcctTpCdCust" compareValue="Y">
                                        SELECT CUST.GLBL_CMPY_CD          AS GLBL_CMPY_CD
                                             , CUST.EZCANCELFLAG          AS EZCANCELFLAG
                                             , CUST.DS_ACCT_NM            AS DS_ACCT_NM
                                             , CUST.DS_ACCT_ACTV_CUST_FLG AS DS_ACCT_ACTV_CUST_FLG
                                             , CUST.DS_ACCT_NUM           AS DS_ACCT_NUM
                                             , CUST.DBA_NM                AS DBA_NM
                                             , CUST.DS_ACCT_LEGAL_NM      AS DS_ACCT_LEGAL_NM
                                             , CUST.DS_ACCT_DUNS_NUM      AS DS_ACCT_DUNS_NUM
                                             , CUST.DS_ULT_DUNS_NUM       AS DS_ULT_DUNS_NUM
                                             , CUST.DS_CUST_SIC_DESC_TXT  AS DS_CUST_SIC_DESC_TXT
                                             , CUST.DS_ACCT_ITRL_FLG      AS DS_ACCT_ITRL_FLG
                                             , CUST.DS_XTRNL_REF_TXT      AS DS_XTRNL_REF_TXT
                                             , CUST.DS_ACCT_CLS_CD        AS DS_ACCT_CLS_CD
                                             , CUST.DS_ACCT_TP_CD         AS DS_ACCT_TP_CD
                                             , PTY.PTY_LOC_PK             AS PTY_LOC_PK
                                             , PTY.LOC_NUM                AS LOC_NUM
                                             , PTY.CNTY_PK                AS CNTY_PK
                                             , PTY.FIRST_LINE_ADDR        AS FIRST_LINE_ADDR
                                             , PTY.SCD_LINE_ADDR          AS SCD_LINE_ADDR
                                             , PTY.THIRD_LINE_ADDR        AS THIRD_LINE_ADDR
                                             , PTY.FRTH_LINE_ADDR         AS FRTH_LINE_ADDR
                                             , PTY.CTY_ADDR               AS CTY_ADDR
                                             , PTY.ST_CD                  AS ST_CD
                                             , PTY.POST_CD                AS POST_CD
                                             , PTY.DS_LOC_NM              AS DS_LOC_NM
                                             , PTY.PROV_NM                AS PROV_NM
                                             , PTY.CTRY_CD                AS CTRY_CD
                                             , PTY.FIRST_REF_CMNT_TXT     AS FIRST_REF_CMNT_TXT
                                             , PTY.SCD_REF_CMNT_TXT       AS SCD_REF_CMNT_TXT
                                             , PTY.RGTN_STS_CD            AS PTY_RGTN_STS_CD
                                             , PTY.RGTN_STS_CD            AS LOC_RGTN_STS_CD
                                             , null                       AS PRIN_CUST_PK
                                             , CASE WHEN PTY.LOC_NUM IS NOT NULL THEN 'Y' ELSE 'N' END AS XX_YES_NO_CD
                                             <!-- START 2018/04/10 Hd.Sugawara [QC#24388,ADD] -->
                                             , PTY.DUNS_NUM               AS PTY_DUNS_NUM
                                             , PTY.DS_ULT_DUNS_NUM        AS PTY_DS_ULT_DUNS_NUM
                                             , PTY.DS_CUST_SIC_DESC_TXT   AS PTY_DS_CUST_SIC_DESC_TXT
                                             <!-- END 2018/04/10 Hd.Sugawara [QC#24388,ADD] -->
                                        FROM   DS_ACCT_PROS     CUST
                                             , PROS_PTY_LOC_WRK PTY
                                        WHERE  CUST.GLBL_CMPY_CD = #glblCmpyCd#
                                        AND    CUST.EZCANCELFLAG = '0'
                                        AND    CUST.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD(+)
                                        AND    CUST.PTY_LOC_PK = PTY.PTY_LOC_PK(+)
                                        <isNotEqual property="xxChkBox_01" compareValue="Y">
                                        AND    CUST.LOC_NUM = PTY.LOC_NUM(+)
                                        </isNotEqual>
                                        AND    PTY.EZCANCELFLAG(+) = '0'
                                    </isNotEqual>
                                      ) ACCT
                                    , BILL_TO_CUST BILL
                                    , SHIP_TO_CUST SHIP
                                    , CNTY CNTY
                                WHERE
                                    ACCT.GLBL_CMPY_CD = #glblCmpyCd#
                                AND ACCT.EZCANCELFLAG = '0'
                                AND ACCT.GLBL_CMPY_CD = BILL.GLBL_CMPY_CD(+)
                                AND ACCT.LOC_NUM = BILL.LOC_NUM(+)
                                AND BILL.EZCANCELFLAG(+) = '0'
                                AND ACCT.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD(+)
                                AND ACCT.LOC_NUM = SHIP.LOC_NUM(+)
                                AND SHIP.EZCANCELFLAG(+) = '0'
                                AND ACCT.CNTY_PK             = CNTY.CNTY_PK(+)
                                AND ACCT.GLBL_CMPY_CD        = CNTY.GLBL_CMPY_CD(+)
                                AND CNTY.EZCANCELFLAG(+)    = '0'
                                <isEqual property="inacLocFlg" compareValue="N">
                                AND ACCT.LOC_RGTN_STS_CD = #rgtnSts_Actv#
                                </isEqual>

                                <isNotNull property="dsAcctActvCustFlg">
                                AND ACCT.DS_ACCT_ACTV_CUST_FLG = #dsAcctActvCustFlg# 
                                </isNotNull>

                                <isNotNull property="dsAcctNm">
                                AND ACCT.DS_ACCT_NM LIKE #dsAcctNm#
                                </isNotNull>
                                <!-- Address -->
                                <isNotNull property="shipFromFullCmpyAddr">
                                AND UPPER(ACCT.FIRST_LINE_ADDR) || 
                                    DECODE(ACCT.SCD_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.SCD_LINE_ADDR)) ||
                                    DECODE(ACCT.THIRD_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.THIRD_LINE_ADDR)) ||
                                    DECODE(ACCT.FRTH_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.FRTH_LINE_ADDR)) LIKE #shipFromFullCmpyAddr#
                                </isNotNull>
                                <!-- Bill To Code -->
                                <isNotNull property="billToCustCd">
                                AND BILL.BILL_TO_CUST_CD LIKE #billToCustCd#
                                </isNotNull>
                                <!-- Ship To Code -->
                                <isNotNull property="shipToCustCd">
                                AND SHIP.SHIP_TO_CUST_CD LIKE #shipToCustCd#
                                </isNotNull>
                                <!-- City -->
                                <isNotNull property="ctyAddr">
                                AND UPPER(ACCT.CTY_ADDR) LIKE #ctyAddr#
                                </isNotNull>
                                <!-- State -->
                                <isNotNull property="stCd">
                                AND ACCT.ST_CD = #stCd#
                                </isNotNull>
                                <!-- Postal Code -->
                                <isNotNull property="postCd">
                                AND ACCT.POST_CD LIKE #postCd#
                                </isNotNull>
                                <!-- Account Number -->
                                <isNotNull property="dsAcctNum">
                                AND ACCT.DS_ACCT_NUM LIKE #dsAcctNum#
                                </isNotNull>
                                <!-- Location Number -->
                                <isNotNull property="locNum">
                                AND ACCT.LOC_NUM LIKE #locNum#
                                </isNotNull>
                                <!-- DBA Name -->
                                <isNotNull property="dbaNm">
                                AND ACCT.DBA_NM LIKE #dbaNm#
                                </isNotNull>
                                <!-- Account Legal Name -->
                                <isNotNull property="dsAcctLegalNm">
                                AND ACCT.DS_ACCT_LEGAL_NM LIKE #dsAcctLegalNm#
                                </isNotNull>
                                <!-- Account Group Code -->
                                <isNotNull property="dsAcctGrpCd">
                                AND EXISTS (SELECT 1 FROM DS_ACCT_GRP_ASG ASG 
                                            WHERE ASG.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
                                            AND ASG.EZCANCELFLAG = '0'
                                            AND ASG.DS_ACCT_NUM = ACCT.DS_ACCT_NUM
                                            AND ASG.EFF_FROM_DT &lt;= #slsDt#
                                            AND (ASG.EFF_THRU_DT &gt;= #slsDt#
                                                OR ASG.EFF_THRU_DT IS NULL ) 
                                            AND ASG.DS_ACCT_GRP_CD LIKE #dsAcctGrpCd#
                                    )
                                </isNotNull>

                                <!-- Location Name -->
                                <isNotNull property="locNm">
                                AND UPPER(ACCT.DS_LOC_NM) LIKE #locNm#
                                </isNotNull>
                                <isNotNull property="dsAcctDunsNum">
                                <!-- START 2018/04/10 Hd.Sugawara [QC#24388,MOD] -->
                                <!-- AND ACCT.DS_ACCT_DUNS_NUM LIKE #dsAcctDunsNum# -->
                                AND (ACCT.DS_ACCT_DUNS_NUM LIKE #dsAcctDunsNum# OR ACCT.PTY_DUNS_NUM LIKE #dsAcctDunsNum#)
                                <!-- END 2018/04/10 Hd.Sugawara [QC#24388,MOD] -->
                                </isNotNull>
                                <!-- UDUNS Number -->
                                <isNotNull property="dsUltDunsNum">
                                <!-- START 2018/04/10 Hd.Sugawara [QC#24388,MOD] -->
                                <!-- AND ACCT.DS_ULT_DUNS_NUM LIKE #dsUltDunsNum# -->
                                AND (ACCT.DS_ULT_DUNS_NUM LIKE #dsUltDunsNum# OR ACCT.PTY_DS_ULT_DUNS_NUM LIKE #dsUltDunsNum#)
                                <!-- END 2018/04/10 Hd.Sugawara [QC#24388,MOD] -->
                                </isNotNull>
                                <!-- Industry -->
                                <isNotNull property="dsCustSicDescTxt">
                                <!-- START 2018/04/10 Hd.Sugawara [QC#24388,MOD] -->
                                <!--  AND UPPER(ACCT.DS_CUST_SIC_DESC_TXT) LIKE UPPER(#dsCustSicDescTxt#) -->
                                AND (UPPER(ACCT.DS_CUST_SIC_DESC_TXT) LIKE UPPER(#dsCustSicDescTxt#) 
                                    OR UPPER(ACCT.PTY_DS_CUST_SIC_DESC_TXT) LIKE UPPER(#dsCustSicDescTxt#))
                                <!-- END 2018/04/10 Hd.Sugawara [QC#24388,MOD] -->
                                </isNotNull>
                                <!-- Contact First Name -->
                                <isNotNull property="ctacPsnFlg">
                                    AND EXISTS (SELECT 1 
                                                FROM 
                                                    DS_CTAC_PSN_RELN    PSN_RELN
                                                  , CTAC_PSN            PSN
                                                <isNotNull property="ctacPsnTelNum">
                                                  , DS_CTAC_PNT         PNT
                                                </isNotNull>
                                                <isNotNull property="ctacPsnEmlAddr">
                                                  , DS_CTAC_PNT         PNT_EML
                                                </isNotNull>
                                                WHERE
                                                    ACCT.GLBL_CMPY_CD = PSN_RELN.GLBL_CMPY_CD
                                                <!-- QC#25171-2 Del
                                                AND (ACCT.DS_ACCT_NUM = PSN_RELN.DS_ACCT_NUM OR ACCT.LOC_NUM = PSN_RELN.LOC_NUM)
                                                -->
                                                <!-- QC#25171-2 Add Start -->
                                                AND ACCT.DS_ACCT_NUM = PSN_RELN.DS_ACCT_NUM
                                                <!-- QC#25171-2 Add End -->
                                                AND PSN_RELN.EZCANCELFLAG = '0'
                                                AND PSN_RELN.GLBL_CMPY_CD = PSN.GLBL_CMPY_CD
                                                AND PSN_RELN.CTAC_PSN_PK = PSN.CTAC_PSN_PK
                                                AND PSN.EZCANCELFLAG = '0'
                                                <isNotNull property="ctacPsnFirstNm">
                                                AND UPPER(PSN.CTAC_PSN_FIRST_NM) LIKE UPPER(#ctacPsnFirstNm#)
                                                </isNotNull>
                                                <isNotNull property="ctacPsnLastNm">
                                                AND UPPER(PSN.CTAC_PSN_LAST_NM) LIKE UPPER(#ctacPsnLastNm#)
                                                </isNotNull>
                                                <isNotNull property="ctacPsnTelNum">
                                                AND PSN.GLBL_CMPY_CD = PNT.GLBL_CMPY_CD
                                                AND PSN.CTAC_PSN_PK = PNT.CTAC_PSN_PK
                                                AND PNT.EZCANCELFLAG = '0'
                                                AND PNT.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCd#
                                                AND PNT.DS_CTAC_PNT_VAL_TXT LIKE #ctacPsnTelNum#
                                                </isNotNull>
                                                <isNotNull property="ctacPsnEmlAddr">
                                                AND PSN.GLBL_CMPY_CD = PNT_EML.GLBL_CMPY_CD
                                                AND PSN.CTAC_PSN_PK = PNT_EML.CTAC_PSN_PK
                                                AND PNT_EML.EZCANCELFLAG = '0'
                                                AND PNT_EML.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCdIsEml#
                                                AND UPPER(PNT_EML.DS_CTAC_PNT_VAL_TXT) LIKE UPPER(#ctacPsnEmlAddr#)
                                                </isNotNull>
                                           )
                                </isNotNull>
                                <isNotNull property="dsAcctItrlFlg">
                                 AND ACCT.DS_ACCT_ITRL_FLG = #dsAcctItrlFlg#
                                </isNotNull>
                                <isNotNull property="dsXtrnlRefTxt">
                                 AND ACCT.DS_XTRNL_REF_TXT LIKE #dsXtrnlRefTxt#
                                </isNotNull>
                                <isNotNull property="dsAcctActvCustFlg">
                                 AND ACCT.DS_ACCT_ACTV_CUST_FLG = #dsAcctActvCustFlg# 
                                </isNotNull>
                                <isNotNull property="dsAcctClsCd">
                                 AND ACCT.DS_ACCT_CLS_CD = #dsAcctClsCd#
                                </isNotNull>
                                <isNotNull property="dsXrefAcctFlg">
                                    AND EXISTS (SELECT 1 FROM DS_XREF_ACCT XREF
                                                WHERE XREF.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
                                                AND XREF.LOC_NUM = ACCT.LOC_NUM
                                                AND XREF.EZCANCELFLAG = '0'
                                                <isNotNull property="dsXrefAcctTpCd">
                                                 AND XREF.DS_XREF_ACCT_TP_CD  = #dsXrefAcctTpCd#
                                                </isNotNull>
                                                <isNotNull property="dsXrefAcctCd">
                                                 AND XREF.DS_XREF_ACCT_CD LIKE #dsXrefAcctCd#
                                                </isNotNull>
                                           )
                                </isNotNull>
                                <isEqual property="isDisplayRelated" compareValue="N">
                                    <isEqual property="dispBillToFlg" compareValue="Y">
                                        AND BILL.RGTN_STS_CD = #rgtnSts_Actv#
                                    </isEqual>
                                    <isEqual property="dispShipToFlg" compareValue="Y">
                                        AND SHIP.RGTN_STS_CD = #rgtnSts_Actv#
                                    </isEqual>
                                </isEqual>
                                <!-- QC#25171 Add Start-->
                                 AND ACCT.XX_YES_NO_CD = 'Y'
                                <!-- QC#25171 Add End -->
                                <!-- QC#25171-2 Add Start -->
                                <isNotNull property="ctacPsnFlg">
                                UNION
                                SELECT 
                                          ACCT.DS_ACCT_NUM  AS DS_ACCT_NUM
                                        , ''                            AS DS_ACCT_RELN_TP_CD
                                        , ACCT.DS_ACCT_NM               AS DS_ACCT_NM
                                        , ACCT.FIRST_LINE_ADDR ||
                                          DECODE(ACCT.SCD_LINE_ADDR, NULL, '', ' ' || ACCT.SCD_LINE_ADDR) ||
                                          DECODE(ACCT.THIRD_LINE_ADDR, NULL, '', ' ' || ACCT.THIRD_LINE_ADDR) ||
                                          DECODE(ACCT.FRTH_LINE_ADDR, NULL, '', ' ' || ACCT.FRTH_LINE_ADDR) ||
                                          ' ' ||
                                          ACCT.CTY_ADDR        || ' ' ||
                                          ACCT.ST_CD           || ' ' ||
                                          ACCT.POST_CD                  AS SHIP_FROM_FULL_CMPY_ADDR
                                        , ACCT.LOC_NUM                  AS LOC_NUM
                                        , ACCT.XX_YES_NO_CD             AS XX_YES_NO_CD
                                        , (SELECT DS_ACCT_TP_NM FROM DS_ACCT_TP TP
                                               WHERE TP.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
                                               AND TP.EZCANCELFLAG = '0'
                                               AND TP.DS_ACCT_TP_CD = ACCT.DS_ACCT_TP_CD
                                          )                             AS DS_ACCT_TP_NM
                                        , ACCT.DS_ACCT_NUM              AS ORIG_ACCT_NUM
                                        , ''                            AS RELN_DS_ACCT_NUM
                                        , BILL.BILL_TO_CUST_CD          AS BILL_TO_CUST_CD
                                        , SHIP.SHIP_TO_CUST_CD          AS SHIP_TO_CUST_CD
                                        , ACCT.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                                        , ACCT.PTY_LOC_PK               AS PTY_LOC_PK
                                        , ACCT.FIRST_LINE_ADDR          AS FIRST_LINE_ADDR
                                        , ACCT.SCD_LINE_ADDR            AS SCD_LINE_ADDR
                                        , ACCT.THIRD_LINE_ADDR          AS THIRD_LINE_ADDR
                                        , ACCT.FRTH_LINE_ADDR           AS FRTH_LINE_ADDR 
                                        , ACCT.PROV_NM                  AS PROV_NM
                                        , CNTY.CNTY_NM                  AS CNTY_NM
                                        , ACCT.CTRY_CD                  AS CTRY_CD
                                        , ROWNUM                        AS SORT_NUM
                                        , ACCT.DS_LOC_NM                AS DS_LOC_NM
                                        , ACCT.CTY_ADDR                 AS CTY_ADDR
                                        , ACCT.ST_CD                    AS ST_CD
                                        , ACCT.POST_CD                  AS POST_CD
                                        , ACCT.FIRST_REF_CMNT_TXT       AS FIRST_REF_CMNT_TXT
                                        , ACCT.SCD_REF_CMNT_TXT         AS SCD_REF_CMNT_TXT
                                        , ACCT.DS_ACCT_ACTV_CUST_FLG    AS DS_ACCT_ACTV_CUST_FLG
                                        , ACCT.LOC_RGTN_STS_CD          AS LOC_RGTN_STS_CD
                                        , ACCT.PTY_RGTN_STS_CD          AS PTY_RGTN_STS_CD
                                        , BILL.RGTN_STS_CD              AS BILL_RGTN_STS_CD
                                        , SHIP.RGTN_STS_CD              AS SHIP_RGTN_STS_CD
                                        <isNull property="ctacPsnFlg">
                                        , 'Y'                           AS HIT_LOC_CTAC_FLG
                                        </isNull>
                                        <isNotNull property="ctacPsnFlg">
                                        , CASE WHEN EXISTS (SELECT 1 
                                                        FROM 
                                                            DS_CTAC_PSN_RELN    PSN_RELN2
                                                          , CTAC_PSN            PSN2
                                                        <isNotNull property="ctacPsnTelNum">
                                                          , DS_CTAC_PNT         PNT2
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnEmlAddr">
                                                          , DS_CTAC_PNT         PNT_EML2
                                                        </isNotNull>
                                                        WHERE
                                                            ACCT.GLBL_CMPY_CD = PSN_RELN2.GLBL_CMPY_CD
                                                        AND ACCT.LOC_NUM = PSN_RELN2.LOC_NUM
                                                        AND PSN_RELN2.EZCANCELFLAG = '0'
                                                        AND PSN_RELN2.GLBL_CMPY_CD = PSN2.GLBL_CMPY_CD
                                                        AND PSN_RELN2.CTAC_PSN_PK = PSN2.CTAC_PSN_PK
                                                        AND PSN2.EZCANCELFLAG = '0'
                                                        <isNotNull property="ctacPsnFirstNm">
                                                        AND UPPER(PSN2.CTAC_PSN_FIRST_NM) LIKE UPPER(#ctacPsnFirstNm#)
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnLastNm">
                                                        AND UPPER(PSN2.CTAC_PSN_LAST_NM) LIKE UPPER(#ctacPsnLastNm#)
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnTelNum">
                                                        AND PSN2.GLBL_CMPY_CD = PNT2.GLBL_CMPY_CD
                                                        AND PSN2.CTAC_PSN_PK = PNT2.CTAC_PSN_PK
                                                        AND PNT2.EZCANCELFLAG = '0'
                                                        AND PNT2.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCd#
                                                        AND PNT2.DS_CTAC_PNT_VAL_TXT LIKE #ctacPsnTelNum#
                                                        </isNotNull>
                                                        <isNotNull property="ctacPsnEmlAddr">
                                                        AND PSN2.GLBL_CMPY_CD = PNT_EML2.GLBL_CMPY_CD
                                                        AND PSN2.CTAC_PSN_PK = PNT_EML2.CTAC_PSN_PK
                                                        AND PNT_EML2.EZCANCELFLAG = '0'
                                                        AND PNT_EML2.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCdIsEml#
                                                        AND UPPER(PNT_EML2.DS_CTAC_PNT_VAL_TXT) LIKE UPPER(#ctacPsnEmlAddr#)
                                                </isNotNull>
                                                   )
                                            THEN 'Y' ELSE 'N' END       AS HIT_LOC_CTAC_FLG
                                        </isNotNull>
                                FROM
                                    ( 
                                    <isNotEqual property="dsAcctTpCdCust" compareValue="N">
                                        SELECT CUST.GLBL_CMPY_CD          AS GLBL_CMPY_CD
                                             , CUST.EZCANCELFLAG          AS EZCANCELFLAG
                                             , CUST.DS_ACCT_NM            AS DS_ACCT_NM
                                             , CUST.DS_ACCT_ACTV_CUST_FLG AS DS_ACCT_ACTV_CUST_FLG
                                             , CUST.SELL_TO_CUST_CD       AS DS_ACCT_NUM
                                             , CUST.DBA_NM                AS DBA_NM
                                             , CUST.DS_ACCT_LEGAL_NM      AS DS_ACCT_LEGAL_NM
                                             , CUST.DS_ACCT_DUNS_NUM      AS DS_ACCT_DUNS_NUM
                                             , CUST.DS_ULT_DUNS_NUM       AS DS_ULT_DUNS_NUM
                                             , CUST.DS_CUST_SIC_DESC_TXT  AS DS_CUST_SIC_DESC_TXT
                                             , CUST.DS_ACCT_ITRL_FLG      AS DS_ACCT_ITRL_FLG
                                             , CUST.DS_XTRNL_REF_TXT      AS DS_XTRNL_REF_TXT
                                             , CUST.DS_ACCT_CLS_CD        AS DS_ACCT_CLS_CD
                                             , CUST.DS_ACCT_TP_CD         AS DS_ACCT_TP_CD
                                             , PRIN.PTY_LOC_PK            AS PTY_LOC_PK
                                             , PTY.LOC_NUM                AS LOC_NUM
                                             , PTY.CNTY_PK                AS CNTY_PK
                                             , PTY.FIRST_LINE_ADDR        AS FIRST_LINE_ADDR
                                             , PTY.SCD_LINE_ADDR          AS SCD_LINE_ADDR
                                             , PTY.THIRD_LINE_ADDR        AS THIRD_LINE_ADDR
                                             , PTY.FRTH_LINE_ADDR         AS FRTH_LINE_ADDR
                                             , PTY.CTY_ADDR               AS CTY_ADDR
                                             , PTY.ST_CD                  AS ST_CD
                                             , PTY.POST_CD                AS POST_CD
                                             , PTY.DS_LOC_NM              AS DS_LOC_NM
                                             , PTY.PROV_NM                AS PROV_NM
                                             , PTY.CTRY_CD                AS CTRY_CD
                                             , PTY.FIRST_REF_CMNT_TXT     AS FIRST_REF_CMNT_TXT
                                             , PTY.SCD_REF_CMNT_TXT       AS SCD_REF_CMNT_TXT
                                             , PTY.RGTN_STS_CD            AS PTY_RGTN_STS_CD
                                             , LOC.RGTN_STS_CD            AS LOC_RGTN_STS_CD
                                             , PRIN.PRIN_CUST_PK          AS PRIN_CUST_PK
                                             , CASE WHEN PRIN.PRIN_CUST_PK IS NOT NULL THEN 'Y' ELSE 'N' END AS XX_YES_NO_CD
                                             , PTY.DUNS_NUM               AS PTY_DUNS_NUM
                                             , PTY.DS_ULT_DUNS_NUM        AS PTY_DS_ULT_DUNS_NUM
                                             , PTY.DS_CUST_SIC_DESC_TXT   AS PTY_DS_CUST_SIC_DESC_TXT
                                        FROM   SELL_TO_CUST CUST
                                             , ACCT_LOC     LOC
                                             , PTY_LOC_WRK  PTY
                                             , PRIN_CUST    PRIN
                                        WHERE  CUST.GLBL_CMPY_CD = #glblCmpyCd#
                                        AND    CUST.EZCANCELFLAG = '0'
                                        AND    CUST.GLBL_CMPY_CD = LOC.GLBL_CMPY_CD(+)
                                        AND    CUST.SELL_TO_CUST_CD = LOC.DS_ACCT_NUM(+)
                                        <isNotEqual property="xxChkBox_01" compareValue="Y">
                                        AND    CUST.LOC_NUM = LOC.LOC_NUM(+)
                                        </isNotEqual>
                                        AND    LOC.EZCANCELFLAG(+) = '0'
                                        AND    LOC.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD(+)
                                        AND    LOC.PTY_LOC_PK = PTY.PTY_LOC_PK(+)
                                        AND    PTY.EZCANCELFLAG(+) = '0'
                                        AND    PTY.GLBL_CMPY_CD = PRIN.GLBL_CMPY_CD(+)
                                        AND    PTY.LOC_NUM = PRIN.LOC_NUM(+)
                                        AND    PRIN.EZCANCELFLAG(+) = '0'
                                    </isNotEqual>
                                    <isNull property="dsAcctTpCdCust">
                                        UNION ALL
                                    </isNull>
                                    <isNotEqual property="dsAcctTpCdCust" compareValue="Y">
                                        SELECT CUST.GLBL_CMPY_CD          AS GLBL_CMPY_CD
                                             , CUST.EZCANCELFLAG          AS EZCANCELFLAG
                                             , CUST.DS_ACCT_NM            AS DS_ACCT_NM
                                             , CUST.DS_ACCT_ACTV_CUST_FLG AS DS_ACCT_ACTV_CUST_FLG
                                             , CUST.DS_ACCT_NUM           AS DS_ACCT_NUM
                                             , CUST.DBA_NM                AS DBA_NM
                                             , CUST.DS_ACCT_LEGAL_NM      AS DS_ACCT_LEGAL_NM
                                             , CUST.DS_ACCT_DUNS_NUM      AS DS_ACCT_DUNS_NUM
                                             , CUST.DS_ULT_DUNS_NUM       AS DS_ULT_DUNS_NUM
                                             , CUST.DS_CUST_SIC_DESC_TXT  AS DS_CUST_SIC_DESC_TXT
                                             , CUST.DS_ACCT_ITRL_FLG      AS DS_ACCT_ITRL_FLG
                                             , CUST.DS_XTRNL_REF_TXT      AS DS_XTRNL_REF_TXT
                                             , CUST.DS_ACCT_CLS_CD        AS DS_ACCT_CLS_CD
                                             , CUST.DS_ACCT_TP_CD         AS DS_ACCT_TP_CD
                                             , PTY.PTY_LOC_PK             AS PTY_LOC_PK
                                             , PTY.LOC_NUM                AS LOC_NUM
                                             , PTY.CNTY_PK                AS CNTY_PK
                                             , PTY.FIRST_LINE_ADDR        AS FIRST_LINE_ADDR
                                             , PTY.SCD_LINE_ADDR          AS SCD_LINE_ADDR
                                             , PTY.THIRD_LINE_ADDR        AS THIRD_LINE_ADDR
                                             , PTY.FRTH_LINE_ADDR         AS FRTH_LINE_ADDR
                                             , PTY.CTY_ADDR               AS CTY_ADDR
                                             , PTY.ST_CD                  AS ST_CD
                                             , PTY.POST_CD                AS POST_CD
                                             , PTY.DS_LOC_NM              AS DS_LOC_NM
                                             , PTY.PROV_NM                AS PROV_NM
                                             , PTY.CTRY_CD                AS CTRY_CD
                                             , PTY.FIRST_REF_CMNT_TXT     AS FIRST_REF_CMNT_TXT
                                             , PTY.SCD_REF_CMNT_TXT       AS SCD_REF_CMNT_TXT
                                             , PTY.RGTN_STS_CD            AS PTY_RGTN_STS_CD
                                             , PTY.RGTN_STS_CD            AS LOC_RGTN_STS_CD
                                             , null                       AS PRIN_CUST_PK
                                             , CASE WHEN PTY.LOC_NUM IS NOT NULL THEN 'Y' ELSE 'N' END AS XX_YES_NO_CD
                                             , PTY.DUNS_NUM               AS PTY_DUNS_NUM
                                             , PTY.DS_ULT_DUNS_NUM        AS PTY_DS_ULT_DUNS_NUM
                                             , PTY.DS_CUST_SIC_DESC_TXT   AS PTY_DS_CUST_SIC_DESC_TXT
                                        FROM   DS_ACCT_PROS     CUST
                                             , PROS_PTY_LOC_WRK PTY
                                        WHERE  CUST.GLBL_CMPY_CD = #glblCmpyCd#
                                        AND    CUST.EZCANCELFLAG = '0'
                                        AND    CUST.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD(+)
                                        AND    CUST.PTY_LOC_PK = PTY.PTY_LOC_PK(+)
                                        <isNotEqual property="xxChkBox_01" compareValue="Y">
                                        AND    CUST.LOC_NUM = PTY.LOC_NUM(+)
                                        </isNotEqual>
                                        AND    PTY.EZCANCELFLAG(+) = '0'
                                    </isNotEqual>
                                      ) ACCT
                                    , BILL_TO_CUST BILL
                                    , SHIP_TO_CUST SHIP
                                    , CNTY CNTY
                                WHERE
                                    ACCT.GLBL_CMPY_CD = #glblCmpyCd#
                                AND ACCT.EZCANCELFLAG = '0'
                                AND ACCT.GLBL_CMPY_CD = BILL.GLBL_CMPY_CD(+)
                                AND ACCT.LOC_NUM = BILL.LOC_NUM(+)
                                AND BILL.EZCANCELFLAG(+) = '0'
                                AND ACCT.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD(+)
                                AND ACCT.LOC_NUM = SHIP.LOC_NUM(+)
                                AND SHIP.EZCANCELFLAG(+) = '0'
                                AND ACCT.CNTY_PK             = CNTY.CNTY_PK(+)
                                AND ACCT.GLBL_CMPY_CD        = CNTY.GLBL_CMPY_CD(+)
                                AND CNTY.EZCANCELFLAG(+)    = '0'
                                <isEqual property="inacLocFlg" compareValue="N">
                                AND ACCT.LOC_RGTN_STS_CD = #rgtnSts_Actv#
                                </isEqual>

                                <isNotNull property="dsAcctActvCustFlg">
                                AND ACCT.DS_ACCT_ACTV_CUST_FLG = #dsAcctActvCustFlg# 
                                </isNotNull>

                                <isNotNull property="dsAcctNm">
                                AND ACCT.DS_ACCT_NM LIKE #dsAcctNm#
                                </isNotNull>
                                <!-- Address -->
                                <isNotNull property="shipFromFullCmpyAddr">
                                AND UPPER(ACCT.FIRST_LINE_ADDR) || 
                                    DECODE(ACCT.SCD_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.SCD_LINE_ADDR)) ||
                                    DECODE(ACCT.THIRD_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.THIRD_LINE_ADDR)) ||
                                    DECODE(ACCT.FRTH_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.FRTH_LINE_ADDR)) LIKE #shipFromFullCmpyAddr#
                                </isNotNull>
                                <!-- Bill To Code -->
                                <isNotNull property="billToCustCd">
                                AND BILL.BILL_TO_CUST_CD LIKE #billToCustCd#
                                </isNotNull>
                                <!-- Ship To Code -->
                                <isNotNull property="shipToCustCd">
                                AND SHIP.SHIP_TO_CUST_CD LIKE #shipToCustCd#
                                </isNotNull>
                                <!-- City -->
                                <isNotNull property="ctyAddr">
                                AND UPPER(ACCT.CTY_ADDR) LIKE #ctyAddr#
                                </isNotNull>
                                <!-- State -->
                                <isNotNull property="stCd">
                                AND ACCT.ST_CD = #stCd#
                                </isNotNull>
                                <!-- Postal Code -->
                                <isNotNull property="postCd">
                                AND ACCT.POST_CD LIKE #postCd#
                                </isNotNull>
                                <!-- Account Number -->
                                <isNotNull property="dsAcctNum">
                                AND ACCT.DS_ACCT_NUM LIKE #dsAcctNum#
                                </isNotNull>
                                <!-- Location Number -->
                                <isNotNull property="locNum">
                                AND ACCT.LOC_NUM LIKE #locNum#
                                </isNotNull>
                                <!-- DBA Name -->
                                <isNotNull property="dbaNm">
                                AND ACCT.DBA_NM LIKE #dbaNm#
                                </isNotNull>
                                <!-- Account Legal Name -->
                                <isNotNull property="dsAcctLegalNm">
                                AND ACCT.DS_ACCT_LEGAL_NM LIKE #dsAcctLegalNm#
                                </isNotNull>
                                <!-- Account Group Code -->
                                <isNotNull property="dsAcctGrpCd">
                                AND EXISTS (SELECT 1 FROM DS_ACCT_GRP_ASG ASG 
                                            WHERE ASG.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
                                            AND ASG.EZCANCELFLAG = '0'
                                            AND ASG.DS_ACCT_NUM = ACCT.DS_ACCT_NUM
                                            AND ASG.EFF_FROM_DT &lt;= #slsDt#
                                            AND (ASG.EFF_THRU_DT &gt;= #slsDt#
                                                OR ASG.EFF_THRU_DT IS NULL ) 
                                            AND ASG.DS_ACCT_GRP_CD LIKE #dsAcctGrpCd#
                                    )
                                </isNotNull>

                                <!-- Location Name -->
                                <isNotNull property="locNm">
                                AND UPPER(ACCT.DS_LOC_NM) LIKE #locNm#
                                </isNotNull>
                                <isNotNull property="dsAcctDunsNum">
                                AND (ACCT.DS_ACCT_DUNS_NUM LIKE #dsAcctDunsNum# OR ACCT.PTY_DUNS_NUM LIKE #dsAcctDunsNum#)
                                </isNotNull>
                                <!-- UDUNS Number -->
                                <isNotNull property="dsUltDunsNum">
                                AND (ACCT.DS_ULT_DUNS_NUM LIKE #dsUltDunsNum# OR ACCT.PTY_DS_ULT_DUNS_NUM LIKE #dsUltDunsNum#)
                                </isNotNull>
                                <!-- Industry -->
                                <isNotNull property="dsCustSicDescTxt">
                                AND (UPPER(ACCT.DS_CUST_SIC_DESC_TXT) LIKE UPPER(#dsCustSicDescTxt#) 
                                    OR UPPER(ACCT.PTY_DS_CUST_SIC_DESC_TXT) LIKE UPPER(#dsCustSicDescTxt#))
                                </isNotNull>
                                <!-- Contact First Name -->
                                <isNotNull property="ctacPsnFlg">
                                    AND EXISTS (SELECT 1 
                                                FROM 
                                                    DS_CTAC_PSN_RELN    PSN_RELN
                                                  , CTAC_PSN            PSN
                                                <isNotNull property="ctacPsnTelNum">
                                                  , DS_CTAC_PNT         PNT
                                                </isNotNull>
                                                <isNotNull property="ctacPsnEmlAddr">
                                                  , DS_CTAC_PNT         PNT_EML
                                                </isNotNull>
                                                WHERE
                                                    ACCT.GLBL_CMPY_CD = PSN_RELN.GLBL_CMPY_CD
                                                AND ACCT.LOC_NUM = PSN_RELN.LOC_NUM
                                                AND PSN_RELN.EZCANCELFLAG = '0'
                                                AND PSN_RELN.GLBL_CMPY_CD = PSN.GLBL_CMPY_CD
                                                AND PSN_RELN.CTAC_PSN_PK = PSN.CTAC_PSN_PK
                                                AND PSN.EZCANCELFLAG = '0'
                                                <isNotNull property="ctacPsnFirstNm">
                                                AND UPPER(PSN.CTAC_PSN_FIRST_NM) LIKE UPPER(#ctacPsnFirstNm#)
                                                </isNotNull>
                                                <isNotNull property="ctacPsnLastNm">
                                                AND UPPER(PSN.CTAC_PSN_LAST_NM) LIKE UPPER(#ctacPsnLastNm#)
                                                </isNotNull>
                                                <isNotNull property="ctacPsnTelNum">
                                                AND PSN.GLBL_CMPY_CD = PNT.GLBL_CMPY_CD
                                                AND PSN.CTAC_PSN_PK = PNT.CTAC_PSN_PK
                                                AND PNT.EZCANCELFLAG = '0'
                                                AND PNT.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCd#
                                                AND PNT.DS_CTAC_PNT_VAL_TXT LIKE #ctacPsnTelNum#
                                                </isNotNull>
                                                <isNotNull property="ctacPsnEmlAddr">
                                                AND PSN.GLBL_CMPY_CD = PNT_EML.GLBL_CMPY_CD
                                                AND PSN.CTAC_PSN_PK = PNT_EML.CTAC_PSN_PK
                                                AND PNT_EML.EZCANCELFLAG = '0'
                                                AND PNT_EML.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCdIsEml#
                                                AND UPPER(PNT_EML.DS_CTAC_PNT_VAL_TXT) LIKE UPPER(#ctacPsnEmlAddr#)
                                                </isNotNull>
                                           )
                                </isNotNull>
                                <isNotNull property="dsAcctItrlFlg">
                                 AND ACCT.DS_ACCT_ITRL_FLG = #dsAcctItrlFlg#
                                </isNotNull>
                                <isNotNull property="dsXtrnlRefTxt">
                                 AND ACCT.DS_XTRNL_REF_TXT LIKE #dsXtrnlRefTxt#
                                </isNotNull>
                                <isNotNull property="dsAcctActvCustFlg">
                                 AND ACCT.DS_ACCT_ACTV_CUST_FLG = #dsAcctActvCustFlg# 
                                </isNotNull>
                                <isNotNull property="dsAcctClsCd">
                                 AND ACCT.DS_ACCT_CLS_CD = #dsAcctClsCd#
                                </isNotNull>
                                <isNotNull property="dsXrefAcctFlg">
                                    AND EXISTS (SELECT 1 FROM DS_XREF_ACCT XREF
                                                WHERE XREF.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
                                                AND XREF.LOC_NUM = ACCT.LOC_NUM
                                                AND XREF.EZCANCELFLAG = '0'
                                                <isNotNull property="dsXrefAcctTpCd">
                                                 AND XREF.DS_XREF_ACCT_TP_CD  = #dsXrefAcctTpCd#
                                                </isNotNull>
                                                <isNotNull property="dsXrefAcctCd">
                                                 AND XREF.DS_XREF_ACCT_CD LIKE #dsXrefAcctCd#
                                                </isNotNull>
                                           )
                                </isNotNull>
                                <isEqual property="isDisplayRelated" compareValue="N">
                                    <isEqual property="dispBillToFlg" compareValue="Y">
                                        AND BILL.RGTN_STS_CD = #rgtnSts_Actv#
                                    </isEqual>
                                    <isEqual property="dispShipToFlg" compareValue="Y">
                                        AND SHIP.RGTN_STS_CD = #rgtnSts_Actv#
                                    </isEqual>
                                </isEqual>
                                 AND ACCT.XX_YES_NO_CD = 'Y'
                                </isNotNull>
                                <!-- QC#25171-2 END -->
                                ) A_SFW2
                            )  LF_P

                   WHERE LF_A.DS_ACCT_NUM = LF_P.DS_ACCT_NUM(+)
                   <!-- AND LF_P.XX_YES_NO_CD(+) = 'Y' QC#25171 Del -->
                ) A
        )  AF
        WHERE NOT (AF.ORIG_LOC_NUM IS NULL AND AF.MAX_ORIG_LOC_NUM IS NOT NULL )
         <!-- 2018/05/15 QC#22715 mod start -->
         <!-- ORDER BY AF.DS_ACCT_NUM, AF.XX_YES_NO_CD DESC, AF.FIRST_LINE_ADDR -->
         ORDER BY AF.DS_ACCT_NM, AF.XX_YES_NO_CD DESC, AF.FIRST_LINE_ADDR
         <!-- 2018/05/15 QC#22715 mod end -->
        )
        WHERE ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getRelatedAccountList" parameterClass="Map" resultClass="Map">
    WITH WRK_PRNT_UP AS (
      -- get tree of parent
      SELECT R.RELN_DS_ACCT_NUM, LEVEL LVL
        FROM (
              SELECT RELN.*
                FROM DS_ACCT_RELN RELN 
               WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
                 AND RELN.EZCANCELFLAG = '0'
                 AND RELN.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#
                <isNotNull property="rgtnStsCd">
                 AND RELN.RGTN_STS_CD = #rgtnStsCd# 
                </isNotNull>
       ) R
       START WITH R.DS_ACCT_NUM = #dsAcctNum#
       CONNECT BY NOCYCLE
       PRIOR R.RELN_DS_ACCT_NUM = R.DS_ACCT_NUM
    )
    , WRK_TOP AS (
      -- get top parent
      SELECT RELN_DS_ACCT_NUM DS_ACCT_NUM FROM WRK_PRNT_UP WHERE LVL = ( 
        SELECT MAX(LVL) FROM WRK_PRNT_UP W
      ) AND ROWNUM = 1
      -- in the case that origin account do not have parent relation, set itself as tree top
      UNION ALL
      SELECT #dsAcctNum# DS_ACCT_NUM FROM DUAL WHERE NOT EXISTS (SELECT 1 FROM WRK_PRNT_UP)
    )
    , WRK_PRNT_ALL AS (
      -- get child tree from top parent
      SELECT R.DS_ACCT_NUM, R.RELN_DS_ACCT_NUM, R.DS_ACCT_RELN_TP_CD, R.DS_ACCT_RELN_BILL_TO_FLG, R.DS_ACCT_RELN_SHIP_TO_FLG
           , SYS_CONNECT_BY_PATH (R.RELN_DS_ACCT_NUM, '/')  || '/' || R.DS_ACCT_NUM TREE_PATH
        FROM (
              SELECT * FROM DS_ACCT_RELN RELN 
               WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
                 AND RELN.EZCANCELFLAG = '0'
                 AND RELN.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#
                <isNotNull property="rgtnStsCd">
                 AND RELN.RGTN_STS_CD = #rgtnStsCd# 
                </isNotNull>
             ) R
       START WITH R.RELN_DS_ACCT_NUM = (SELECT WRK_TOP.DS_ACCT_NUM FROM WRK_TOP)
       CONNECT BY NOCYCLE
       PRIOR R.DS_ACCT_NUM = R.RELN_DS_ACCT_NUM
      --
      UNION ALL
      --
      SELECT (SELECT WRK_TOP.DS_ACCT_NUM FROM WRK_TOP) DS_ACCT_NUM
           , '' RELN_DS_ACCT_NUM, '' DS_ACCT_RELN_TP_CD, '' DS_ACCT_RELN_BILL_TO_FLG, '' DS_ACCT_RELN_SHIP_TO_FLG
           , '/' || (SELECT WRK_TOP.DS_ACCT_NUM FROM WRK_TOP) TREE_PATH
        FROM DUAL
    )
    , WRK_LEASE_RELN AS (
      -- get lease/related relation
      SELECT RELN.RELN_DS_ACCT_NUM DS_ACCT_NUM, '' RELN_DS_ACCT_NUM, RELN.DS_ACCT_RELN_TP_CD, RELN.DS_ACCT_RELN_BILL_TO_FLG, RELN.DS_ACCT_RELN_SHIP_TO_FLG
           ---------------------------------------------------------------------
           -- Related/Lease TREE_PATH decide the its position in the search result list.
           -- Make sure the parent hierarchy separator '/' is sorted before the Related/Lease separator ';'.
           -- e.g.
           ---------------------------------------------------------------------
           -- Parent Hierarchy  Related/Lease     Tree Path   Tree Display
           -- /A                B relate to E     /A          - A
           -- /A/B              B lease to  F     /A/B        -   B  
           -- /A/B/C                              /A/B/C      -     C
           -- /A/D                                /A/B; (E)   -   E
           --                                     /A/B; (F)   -   F
           --                                     /A/D        - D
           ---------------------------------------------------------------------
           , T.TREE_PATH
        FROM DS_ACCT_RELN RELN
           , (SELECT A.TREE_PATH  || ';' AS TREE_PATH
                   , A. DS_ACCT_NUM
                FROM WRK_PRNT_ALL A 
               WHERE A.DS_ACCT_NUM = #dsAcctNum#
             ) T 
       WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
         AND RELN.EZCANCELFLAG = '0'
         AND RELN.DS_ACCT_RELN_TP_CD != #dsAcctRelnTpCd#
         <!-- START 2017/11/13 H.Sugawara [QC#17322(Sol#174),ADD] -->
         AND RELN.DS_ACCT_RELN_TP_CD != #dsAcctRelnTpCd_Exclusion#
         <!-- END 2017/11/13 H.Sugawara [QC#17322(Sol#174),ADD] -->
         AND RELN.DS_ACCT_NUM = T.DS_ACCT_NUM
        <isNotNull property="rgtnStsCd">
         AND RELN.RGTN_STS_CD = #rgtnStsCd# 
        </isNotNull>
    )
    , WRK AS (
      -- merge parent relation with lease/related relation
      SELECT * FROM WRK_PRNT_ALL
      UNION ALL
      SELECT * FROM WRK_LEASE_RELN
    )
  , ACCT_ORG_TMP AS (
        SELECT
              W.DS_ACCT_NUM                 AS DS_ACCT_NUM   
            , W.DS_ACCT_RELN_TP_CD          AS DS_ACCT_RELN_TP_CD
            , ACCT.DS_ACCT_NM               AS DS_ACCT_NM
            , ACCT.FIRST_LINE_ADDR ||
              DECODE(ACCT.SCD_LINE_ADDR, NULL, '', ' ' || ACCT.SCD_LINE_ADDR) ||
              DECODE(ACCT.THIRD_LINE_ADDR, NULL, '', ' ' || ACCT.THIRD_LINE_ADDR) ||
              DECODE(ACCT.FRTH_LINE_ADDR, NULL, '', ' ' || ACCT.FRTH_LINE_ADDR) ||
              ' ' ||
              ACCT.CTY_ADDR        || ' ' ||
              ACCT.ST_CD           || ' ' ||
              ACCT.POST_CD                  AS SHIP_FROM_FULL_CMPY_ADDR
            , ACCT.LOC_NUM                  AS LOC_NUM
            , ACCT.XX_YES_NO_CD             AS XX_YES_NO_CD
            , (SELECT DS_ACCT_TP_NM FROM DS_ACCT_TP TP
                   WHERE TP.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
                   AND TP.EZCANCELFLAG = '0'
                   AND TP.DS_ACCT_TP_CD = ACCT.DS_ACCT_TP_CD
              )                             AS DS_ACCT_TP_NM
            , #dsAcctNum#                   AS ORIG_ACCT_NUM
            , W.RELN_DS_ACCT_NUM            AS RELN_DS_ACCT_NUM
            , BTC.BILL_TO_CUST_CD           AS BILL_TO_CUST_CD
            , STC.SHIP_TO_CUST_CD           AS SHIP_TO_CUST_CD
            , ACCT.PTY_LOC_PK               AS PTY_LOC_PK
            , ACCT.FIRST_LINE_ADDR          AS FIRST_LINE_ADDR
            , ACCT.SCD_LINE_ADDR            AS SCD_LINE_ADDR
            , ACCT.THIRD_LINE_ADDR          AS THIRD_LINE_ADDR
            , ACCT.FRTH_LINE_ADDR           AS FRTH_LINE_ADDR 
            , ACCT.PROV_NM                  AS PROV_NM
            , CNTY.CNTY_NM                  AS CNTY_NM
            , ACCT.CTRY_CD                  AS CTRY_CD
            , ACCT.FIRST_REF_CMNT_TXT       AS FIRST_REF_CMNT_TXT
            , ACCT.SCD_REF_CMNT_TXT         AS SCD_REF_CMNT_TXT
            , ACCT.POST_CD                  AS POST_CD
            , ACCT.ST_CD                    AS ST_CD
            , ACCT.CTY_ADDR                 AS CTY_ADDR
            , ACCT.DS_LOC_NM                AS DS_LOC_NM
            , #glblCmpyCd#                  AS GLBL_CMPY_CD
            , ACCT.DS_ACCT_ACTV_CUST_FLG    AS DS_ACCT_ACTV_CUST_FLG
            , ACCT.LOC_RGTN_STS_CD          AS LOC_RGTN_STS_CD
            , ACCT.PTY_RGTN_STS_CD          AS PTY_RGTN_STS_CD
            , BTC.RGTN_STS_CD               AS BILL_RGTN_STS_CD
            , STC.RGTN_STS_CD               AS SHIP_RGTN_STS_CD
            , W.TREE_PATH
    FROM
        WRK W
        , ( 
        <isNotEqual property="dsAcctTpCdCust" compareValue="N">
            SELECT CUST.GLBL_CMPY_CD          AS GLBL_CMPY_CD
                 , CUST.EZCANCELFLAG          AS EZCANCELFLAG
                 , CUST.DS_ACCT_NM            AS DS_ACCT_NM
                 , CUST.DS_ACCT_ACTV_CUST_FLG AS DS_ACCT_ACTV_CUST_FLG
                 , CUST.SELL_TO_CUST_CD       AS DS_ACCT_NUM
                 , CUST.DBA_NM                AS DBA_NM
                 , CUST.DS_ACCT_LEGAL_NM      AS DS_ACCT_LEGAL_NM
                 , CUST.DS_ACCT_DUNS_NUM      AS DS_ACCT_DUNS_NUM
                 , CUST.DS_ULT_DUNS_NUM       AS DS_ULT_DUNS_NUM
                 , CUST.DS_CUST_SIC_DESC_TXT  AS DS_CUST_SIC_DESC_TXT
                 , CUST.DS_ACCT_ITRL_FLG      AS DS_ACCT_ITRL_FLG
                 , CUST.DS_XTRNL_REF_TXT      AS DS_XTRNL_REF_TXT
                 , CUST.DS_ACCT_CLS_CD        AS DS_ACCT_CLS_CD
                 , CUST.DS_ACCT_TP_CD         AS DS_ACCT_TP_CD
                 , PRIN.PTY_LOC_PK            AS PTY_LOC_PK
                 , PTY.LOC_NUM                AS LOC_NUM
                 , PTY.CNTY_PK                AS CNTY_PK
                 , PTY.FIRST_LINE_ADDR        AS FIRST_LINE_ADDR
                 , PTY.SCD_LINE_ADDR          AS SCD_LINE_ADDR
                 , PTY.THIRD_LINE_ADDR        AS THIRD_LINE_ADDR
                 , PTY.FRTH_LINE_ADDR         AS FRTH_LINE_ADDR
                 , PTY.CTY_ADDR               AS CTY_ADDR
                 , PTY.ST_CD                  AS ST_CD
                 , PTY.POST_CD                AS POST_CD
                 , PTY.DS_LOC_NM              AS DS_LOC_NM
                 , PTY.PROV_NM                AS PROV_NM
                 , PTY.CTRY_CD                AS CTRY_CD
                 , PTY.FIRST_REF_CMNT_TXT     AS FIRST_REF_CMNT_TXT
                 , PTY.SCD_REF_CMNT_TXT       AS SCD_REF_CMNT_TXT
                 , PTY.RGTN_STS_CD            AS PTY_RGTN_STS_CD
                 , LOC.RGTN_STS_CD            AS LOC_RGTN_STS_CD
                 , PRIN.PRIN_CUST_PK          AS PRIN_CUST_PK
                 , CASE WHEN PRIN.PRIN_CUST_PK IS NOT NULL THEN 'Y' ELSE 'N' END AS XX_YES_NO_CD
            FROM   SELL_TO_CUST CUST
                 , ACCT_LOC     LOC
                 , PTY_LOC_WRK  PTY
                 , PRIN_CUST    PRIN
            WHERE  CUST.GLBL_CMPY_CD = #glblCmpyCd#
            AND    CUST.EZCANCELFLAG = '0'
            AND    CUST.GLBL_CMPY_CD = LOC.GLBL_CMPY_CD(+)
            AND    CUST.SELL_TO_CUST_CD = LOC.DS_ACCT_NUM(+)
            <isNotEqual property="xxChkBox_01" compareValue="Y">
            AND    CUST.LOC_NUM = LOC.LOC_NUM(+)
            </isNotEqual>
            AND    LOC.EZCANCELFLAG(+) = '0'
            AND    LOC.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD(+)
            AND    LOC.PTY_LOC_PK = PTY.PTY_LOC_PK(+)
            AND    PTY.EZCANCELFLAG(+) = '0'
            AND    PTY.GLBL_CMPY_CD = PRIN.GLBL_CMPY_CD(+)
            AND    PTY.LOC_NUM = PRIN.LOC_NUM(+)
            AND    PRIN.EZCANCELFLAG(+) = '0'
        </isNotEqual>
        <isNull property="dsAcctTpCdCust">
            UNION ALL
        </isNull>
        <isNotEqual property="dsAcctTpCdCust" compareValue="Y">
            SELECT CUST.GLBL_CMPY_CD          AS GLBL_CMPY_CD
                 , CUST.EZCANCELFLAG          AS EZCANCELFLAG
                 , CUST.DS_ACCT_NM            AS DS_ACCT_NM
                 , CUST.DS_ACCT_ACTV_CUST_FLG AS DS_ACCT_ACTV_CUST_FLG
                 , CUST.DS_ACCT_NUM           AS DS_ACCT_NUM
                 , CUST.DBA_NM                AS DBA_NM
                 , CUST.DS_ACCT_LEGAL_NM      AS DS_ACCT_LEGAL_NM
                 , CUST.DS_ACCT_DUNS_NUM      AS DS_ACCT_DUNS_NUM
                 , CUST.DS_ULT_DUNS_NUM       AS DS_ULT_DUNS_NUM
                 , CUST.DS_CUST_SIC_DESC_TXT  AS DS_CUST_SIC_DESC_TXT
                 , CUST.DS_ACCT_ITRL_FLG      AS DS_ACCT_ITRL_FLG
                 , CUST.DS_XTRNL_REF_TXT      AS DS_XTRNL_REF_TXT
                 , CUST.DS_ACCT_CLS_CD        AS DS_ACCT_CLS_CD
                 , CUST.DS_ACCT_TP_CD         AS DS_ACCT_TP_CD
                 , PTY.PTY_LOC_PK             AS PTY_LOC_PK
                 , PTY.LOC_NUM                AS LOC_NUM
                 , PTY.CNTY_PK                AS CNTY_PK
                 , PTY.FIRST_LINE_ADDR        AS FIRST_LINE_ADDR
                 , PTY.SCD_LINE_ADDR          AS SCD_LINE_ADDR
                 , PTY.THIRD_LINE_ADDR        AS THIRD_LINE_ADDR
                 , PTY.FRTH_LINE_ADDR         AS FRTH_LINE_ADDR
                 , PTY.CTY_ADDR               AS CTY_ADDR
                 , PTY.ST_CD                  AS ST_CD
                 , PTY.POST_CD                AS POST_CD
                 , PTY.DS_LOC_NM              AS DS_LOC_NM
                 , PTY.PROV_NM                AS PROV_NM
                 , PTY.CTRY_CD                AS CTRY_CD
                 , PTY.FIRST_REF_CMNT_TXT     AS FIRST_REF_CMNT_TXT
                 , PTY.SCD_REF_CMNT_TXT       AS SCD_REF_CMNT_TXT
                 , PTY.RGTN_STS_CD            AS PTY_RGTN_STS_CD
                 , PTY.RGTN_STS_CD            AS LOC_RGTN_STS_CD
                 , null                       AS PRIN_CUST_PK
                 , CASE WHEN PTY.LOC_NUM IS NOT NULL THEN 'Y' ELSE 'N' END AS XX_YES_NO_CD
            FROM   DS_ACCT_PROS     CUST
                 , PROS_PTY_LOC_WRK PTY
            WHERE  CUST.GLBL_CMPY_CD = #glblCmpyCd#
            AND    CUST.EZCANCELFLAG = '0'
            AND    CUST.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD(+)
            AND    CUST.PTY_LOC_PK = PTY.PTY_LOC_PK(+)
            <isNotEqual property="xxChkBox_01" compareValue="Y">
            AND    CUST.LOC_NUM = PTY.LOC_NUM(+)
            </isNotEqual>
            AND    PTY.EZCANCELFLAG(+) = '0'
        </isNotEqual>
            ) ACCT
        , BILL_TO_CUST BTC
        , SHIP_TO_CUST STC
        , CNTY CNTY
    WHERE 
        W.DS_ACCT_NUM    = ACCT.DS_ACCT_NUM(+)
    AND ACCT.EZCANCELFLAG(+)      = '0' 
    AND ACCT.GLBL_CMPY_CD(+)     = #glblCmpyCd#

    AND ACCT.CNTY_PK             = CNTY.CNTY_PK(+)
    AND ACCT.GLBL_CMPY_CD        = CNTY.GLBL_CMPY_CD(+)
    AND CNTY.EZCANCELFLAG(+)    = '0'

    AND ACCT.GLBL_CMPY_CD= BTC.GLBL_CMPY_CD(+)
    AND ACCT.LOC_NUM      = BTC.LOC_NUM(+)
    AND BTC.EZCANCELFLAG  (+)    = '0'

    AND ACCT.GLBL_CMPY_CD    = STC.GLBL_CMPY_CD(+)  
    AND ACCT.LOC_NUM         = STC.LOC_NUM(+)  
    AND STC.EZCANCELFLAG  (+)     = '0'

    AND W.DS_ACCT_NUM = ACCT.DS_ACCT_NUM
    AND ACCT.GLBL_CMPY_CD = #glblCmpyCd#
    <isNotNull property="dsAcctActvCustFlg">
    AND ACCT.DS_ACCT_ACTV_CUST_FLG = #dsAcctActvCustFlg#
    </isNotNull>
    AND ACCT.EZCANCELFLAG   = '0'
    
    AND ((ACCT.DS_ACCT_NUM != #dsAcctNum# AND 1=1
     <isNotNull property="dsAcctRelnBillToFlg">
      AND W.DS_ACCT_RELN_BILL_TO_FLG = #dsAcctRelnBillToFlg#
      AND BTC.RGTN_STS_CD = #rgtnSts_Actv#
     </isNotNull>
     <isNotNull property="dsAcctRelnShipToFlg">
      AND W.DS_ACCT_RELN_SHIP_TO_FLG = #dsAcctRelnShipToFlg#
      AND STC.RGTN_STS_CD = #rgtnSts_Actv#
     </isNotNull>
     <isNotNull property="dsAcctRelnTpCdLease">
      AND W.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCdLease#
     </isNotNull>
     <isNotNull property="dsAcctNm_RT">
      AND ACCT.DS_ACCT_NM LIKE #dsAcctNm_RT#
     </isNotNull>
     <isNotNull property="dsAcctNum_RT">
      AND W.DS_ACCT_NUM LIKE #dsAcctNum_RT#
     </isNotNull>
     <isNotNull property="xxAllLineAddr_RT">
      AND UPPER(ACCT.FIRST_LINE_ADDR) || 
        DECODE(ACCT.SCD_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.SCD_LINE_ADDR)) ||
        DECODE(ACCT.THIRD_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.THIRD_LINE_ADDR)) ||
        DECODE(ACCT.FRTH_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.FRTH_LINE_ADDR)) LIKE #xxAllLineAddr_RT#
     </isNotNull>
   ) OR (ACCT.DS_ACCT_NUM = #dsAcctNum# AND 1=1
      <isEqual property="dispBillToFlg" compareValue="Y">
      AND BTC.RGTN_STS_CD = #rgtnSts_Actv#
      </isEqual>
      <isEqual property="dispShipToFlg" compareValue="Y">
      AND STC.RGTN_STS_CD = #rgtnSts_Actv#
      </isEqual>
      <isNotNull property="shipFromFullCmpyAddr">
      AND UPPER(ACCT.FIRST_LINE_ADDR) || 
          DECODE(ACCT.SCD_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.SCD_LINE_ADDR)) ||
          DECODE(ACCT.THIRD_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.THIRD_LINE_ADDR)) ||
          DECODE(ACCT.FRTH_LINE_ADDR, NULL, '', ' ' || UPPER(ACCT.FRTH_LINE_ADDR)) LIKE #shipFromFullCmpyAddr#
      </isNotNull>
      <isNotNull property="ctyAddr">
      AND UPPER(ACCT.CTY_ADDR) LIKE #ctyAddr#
      </isNotNull>
      <isNotNull property="stCd">
      AND ACCT.ST_CD = #stCd#
      </isNotNull>
      <isNotNull property="postCd">
      AND ACCT.POST_CD LIKE #postCd#
      </isNotNull>
      <isNotNull property="locNum">
      AND ACCT.LOC_NUM LIKE #locNum#
      </isNotNull>
      <isNotNull property="locNm">
      AND UPPER(ACCT.DS_LOC_NM) LIKE #locNm#
      </isNotNull>
      <isNotNull property="dsXrefAcctFlg">
          AND EXISTS (SELECT 1 FROM DS_XREF_ACCT XREF
                      WHERE XREF.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
                      AND XREF.LOC_NUM = ACCT.LOC_NUM
                      AND XREF.EZCANCELFLAG = '0'
                      <isNotNull property="dsXrefAcctTpCd">
                       AND XREF.DS_XREF_ACCT_TP_CD  = #dsXrefAcctTpCd#
                      </isNotNull>
                      <isNotNull property="dsXrefAcctCd">
                       AND XREF.DS_XREF_ACCT_CD LIKE #dsXrefAcctCd#
                      </isNotNull>
                 )
      </isNotNull>
      <isNotNull property="billToCustCd">
      AND BTC.BILL_TO_CUST_CD LIKE #billToCustCd#
      </isNotNull>
      <isNotNull property="shipToCustCd">
      AND STC.SHIP_TO_CUST_CD LIKE #shipToCustCd#
      </isNotNull>
   ))
)
    , ACCT_ORG AS (
     <isNotNull property="dispAcctFlg">
      SELECT * 
        FROM ACCT_ORG_TMP T
       WHERE T.XX_YES_NO_CD = 'Y'
         AND T.DS_ACCT_NUM != #dsAcctNum#
      UNION
      SELECT DISTINCT
          <!-- Need to keep column order same as ACCT_ORG_TMP above -->
          T.DS_ACCT_NUM   
        , T.DS_ACCT_RELN_TP_CD
        , T.DS_ACCT_NM
        , null SHIP_FROM_FULL_CMPY_ADDR
        , null LOC_NUM
        , null XX_YES_NO_CD
        , T.DS_ACCT_TP_NM
        , T.ORIG_ACCT_NUM
        , T.RELN_DS_ACCT_NUM
        , null BILL_TO_CUST_CD
        , null SHIP_TO_CUST_CD
        , null PTY_LOC_PK
        , null FIRST_LINE_ADDR
        , null SCD_LINE_ADDR
        , null THIRD_LINE_ADDR
        , null FRTH_LINE_ADDR 
        , null PROV_NM
        , null CNTY_NM
        , null CTRY_CD
        , null FIRST_REF_CMNT_TXT
        , null SCD_REF_CMNT_TXT
        , null POST_CD
        , null ST_CD
        , null CTY_ADDR
        , null DS_LOC_NM
        , T.GLBL_CMPY_CD
        , T.DS_ACCT_ACTV_CUST_FLG
        , null LOC_RGTN_STS_CD
        , null PTY_RGTN_STS_CD
        , null BILL_RGTN_STS_CD
        , null SHIP_RGTN_STS_CD
        , T.TREE_PATH
        FROM ACCT_ORG_TMP T
       WHERE NOT EXISTS (
              SELECT 1 FROM ACCT_ORG_TMP T2 WHERE T2.XX_YES_NO_CD = 'Y' AND T.DS_ACCT_NUM = T2.DS_ACCT_NUM
             )
         AND T.DS_ACCT_NUM != #dsAcctNum#
     </isNotNull>
     <isNull property="dispAcctFlg">
      SELECT * 
        FROM ACCT_ORG_TMP T
       WHERE T.DS_ACCT_NUM != #dsAcctNum#
     </isNull>
     UNION
     <isNotEqual property="xxChkBox_01" compareValue="Y">
      SELECT * 
        FROM ACCT_ORG_TMP T
       WHERE T.XX_YES_NO_CD = 'Y'
         AND T.DS_ACCT_NUM = #dsAcctNum#
      UNION
      SELECT DISTINCT
          <!-- Need to keep column order same as ACCT_ORG_TMP above -->
          T.DS_ACCT_NUM   
        , T.DS_ACCT_RELN_TP_CD
        , T.DS_ACCT_NM
        , null SHIP_FROM_FULL_CMPY_ADDR
        , null LOC_NUM
        , null XX_YES_NO_CD
        , T.DS_ACCT_TP_NM
        , T.ORIG_ACCT_NUM
        , T.RELN_DS_ACCT_NUM
        , null BILL_TO_CUST_CD
        , null SHIP_TO_CUST_CD
        , null PTY_LOC_PK
        , null FIRST_LINE_ADDR
        , null SCD_LINE_ADDR
        , null THIRD_LINE_ADDR
        , null FRTH_LINE_ADDR 
        , null PROV_NM
        , null CNTY_NM
        , null CTRY_CD
        , null FIRST_REF_CMNT_TXT
        , null SCD_REF_CMNT_TXT
        , null POST_CD
        , null ST_CD
        , null CTY_ADDR
        , null DS_LOC_NM
        , T.GLBL_CMPY_CD
        , T.DS_ACCT_ACTV_CUST_FLG
        , null LOC_RGTN_STS_CD
        , null PTY_RGTN_STS_CD
        , null BILL_RGTN_STS_CD
        , null SHIP_RGTN_STS_CD
        , T.TREE_PATH
        FROM ACCT_ORG_TMP T
       WHERE NOT EXISTS (
              SELECT 1 FROM ACCT_ORG_TMP T2 WHERE T2.XX_YES_NO_CD = 'Y' AND T.DS_ACCT_NUM = T2.DS_ACCT_NUM
             )
         AND T.DS_ACCT_NUM = #dsAcctNum#         
     </isNotEqual>
     <isEqual property="xxChkBox_01" compareValue="Y">
      SELECT * 
        FROM ACCT_ORG_TMP T
       WHERE T.DS_ACCT_NUM = #dsAcctNum#
     </isEqual>
    )
    , STS_FLTR_WRK AS (
      SELECT A.*
     <isEqual property="inacLocFlg" compareValue="N">
       <isEqual property="inacBillToShipToFlg" compareValue="N">
     , CASE 
            WHEN LOC_RGTN_STS_CD IS NULL THEN 'ACCT'
            WHEN LOC_RGTN_STS_CD != #rgtnSts_Actv# THEN 'ACCT'
            WHEN PTY_RGTN_STS_CD != #rgtnSts_Actv# THEN 'ACCT'
            WHEN BILL_RGTN_STS_CD IS NULL AND SHIP_RGTN_STS_CD IS NULL THEN 'ACCT+LOC'
            WHEN BILL_RGTN_STS_CD = #rgtnSts_Actv# THEN 'ACCT+LOC'
            WHEN SHIP_RGTN_STS_CD = #rgtnSts_Actv# THEN 'ACCT+LOC'
            WHEN LOC_RGTN_STS_CD  = #rgtnSts_Actv# THEN 'ACCT+LOC'
            ELSE 'ACCT'
        END AS DPLY_TP
       </isEqual>
       <isEqual property="inacBillToShipToFlg" compareValue="Y">
     , CASE 
            WHEN LOC_RGTN_STS_CD IS NULL THEN 'ACCT'
            WHEN BILL_RGTN_STS_CD IS NULL AND SHIP_RGTN_STS_CD IS NULL AND LOC_RGTN_STS_CD != #rgtnSts_Actv# THEN 'ACCT'
            WHEN BILL_RGTN_STS_CD IS NULL AND SHIP_RGTN_STS_CD IS NULL AND PTY_RGTN_STS_CD != #rgtnSts_Actv# THEN 'ACCT'
            ELSE 'ACCT+LOC'
        END AS DPLY_TP
       </isEqual>
     </isEqual>
     <isEqual property="inacLocFlg" compareValue="Y">
     , 'ACCT+LOC' AS DPLY_TP
     </isEqual>
      FROM ACCT_ORG A
    )
    , LOC_FLTR AS (
      SELECT DISTINCT
             A.DS_ACCT_NUM
           , A.DS_ACCT_RELN_TP_CD
           , A.DS_ACCT_NM
           , A.DS_ACCT_TP_NM
           , A.ORIG_ACCT_NUM
           , A.RELN_DS_ACCT_NUM
           , A.GLBL_CMPY_CD
           , A.DS_ACCT_ACTV_CUST_FLG
           , A.TREE_PATH
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.PTY_LOC_PK ELSE P.PTY_LOC_PK END AS PTY_LOC_PK
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.XX_YES_NO_CD ELSE P.XX_YES_NO_CD END AS XX_YES_NO_CD
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.BILL_TO_CUST_CD ELSE P.BILL_TO_CUST_CD END AS BILL_TO_CUST_CD
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.BILL_RGTN_STS_CD ELSE P.BILL_RGTN_STS_CD END AS BILL_RGTN_STS_CD
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.SHIP_TO_CUST_CD ELSE P.SHIP_TO_CUST_CD END AS SHIP_TO_CUST_CD
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.SHIP_RGTN_STS_CD ELSE P.SHIP_RGTN_STS_CD END AS SHIP_RGTN_STS_CD
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.PTY_RGTN_STS_CD ELSE P.PTY_RGTN_STS_CD END AS PTY_RGTN_STS_CD
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.LOC_RGTN_STS_CD ELSE P.LOC_RGTN_STS_CD END AS LOC_RGTN_STS_CD
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.SHIP_FROM_FULL_CMPY_ADDR ELSE P.SHIP_FROM_FULL_CMPY_ADDR END AS SHIP_FROM_FULL_CMPY_ADDR
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.LOC_NUM ELSE P.LOC_NUM END AS LOC_NUM
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.FIRST_LINE_ADDR ELSE P.FIRST_LINE_ADDR END AS FIRST_LINE_ADDR
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.SCD_LINE_ADDR ELSE P.SCD_LINE_ADDR END AS SCD_LINE_ADDR
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.THIRD_LINE_ADDR ELSE P.THIRD_LINE_ADDR END AS THIRD_LINE_ADDR
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.FRTH_LINE_ADDR  ELSE P.FRTH_LINE_ADDR  END AS FRTH_LINE_ADDR 
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.PROV_NM ELSE P.PROV_NM END AS PROV_NM
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.CNTY_NM ELSE P.CNTY_NM END AS CNTY_NM
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.CTRY_CD ELSE P.CTRY_CD END AS CTRY_CD
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.DS_LOC_NM ELSE P.DS_LOC_NM END AS DS_LOC_NM
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.CTY_ADDR ELSE P.CTY_ADDR END AS CTY_ADDR
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.ST_CD ELSE P.ST_CD END AS ST_CD
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.POST_CD ELSE P.POST_CD END AS POST_CD
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.FIRST_REF_CMNT_TXT ELSE P.FIRST_REF_CMNT_TXT END AS FIRST_REF_CMNT_TXT
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.SCD_REF_CMNT_TXT ELSE P.SCD_REF_CMNT_TXT END AS SCD_REF_CMNT_TXT
           , CASE WHEN A.DPLY_TP='ACCT+LOC' THEN A.LOC_NUM ELSE NULL END AS ORIG_LOC_NUM
           , CASE WHEN EXISTS (
                        SELECT 1 
                          FROM ACCT_LOC LOC 
                         WHERE LOC.EZCANCELFLAG = '0' 
                           AND LOC.GLBL_CMPY_CD = A.GLBL_CMPY_CD
                           AND LOC.LOC_NUM = A.LOC_NUM
                           AND LOC.RGTN_STS_CD = #rgtnSts_Actv#
                       )
                  THEN 'Y' ELSE 'N' END EXIST_ACTV_ACCT_LOC_FLG
        FROM STS_FLTR_WRK A
           , STS_FLTR_WRK P
       WHERE A.DS_ACCT_NUM = P.DS_ACCT_NUM(+)
         AND P.XX_YES_NO_CD(+) = 'Y'
    )
    , ACCT_FLTR AS (
      SELECT
             A.DS_ACCT_NUM
           , A.DS_ACCT_RELN_TP_CD
           , A.DS_ACCT_NM
           , A.DS_ACCT_TP_NM
           , A.ORIG_ACCT_NUM
           , A.RELN_DS_ACCT_NUM
           , A.GLBL_CMPY_CD
           , A.DS_ACCT_ACTV_CUST_FLG
           , A.TREE_PATH
           , A.PTY_LOC_PK
           , A.XX_YES_NO_CD
     <isEqual property="inacLocFlg" compareValue="N">
       <isEqual property="inacBillToShipToFlg" compareValue="N">
           , CASE WHEN A.EXIST_ACTV_ACCT_LOC_FLG = 'Y' AND A.PTY_RGTN_STS_CD = #rgtnSts_Actv# AND A.BILL_RGTN_STS_CD = #rgtnSts_Actv# 
                  THEN A.BILL_TO_CUST_CD ELSE NULL END BILL_TO_CUST_CD
           , CASE WHEN A.EXIST_ACTV_ACCT_LOC_FLG = 'Y' AND A.PTY_RGTN_STS_CD = #rgtnSts_Actv# AND A.SHIP_RGTN_STS_CD = #rgtnSts_Actv#
                  THEN A.SHIP_TO_CUST_CD ELSE NULL END SHIP_TO_CUST_CD
           , CASE WHEN A.EXIST_ACTV_ACCT_LOC_FLG = 'Y' AND A.PTY_RGTN_STS_CD = #rgtnSts_Actv# 
                  THEN A.PTY_RGTN_STS_CD ELSE NULL END PTY_RGTN_STS_CD
       </isEqual>
       <isEqual property="inacBillToShipToFlg" compareValue="Y">
           , A.BILL_TO_CUST_CD
           , A.SHIP_TO_CUST_CD
           , A.PTY_RGTN_STS_CD
       </isEqual>
     </isEqual>
     <isEqual property="inacLocFlg" compareValue="Y">
           , A.BILL_TO_CUST_CD
           , A.SHIP_TO_CUST_CD
           , A.PTY_RGTN_STS_CD
           , A.LOC_RGTN_STS_CD
     </isEqual>
           , A.BILL_RGTN_STS_CD
           , A.SHIP_RGTN_STS_CD
           , A.SHIP_FROM_FULL_CMPY_ADDR
           , A.LOC_NUM
           , A.FIRST_LINE_ADDR
           , A.SCD_LINE_ADDR
           , A.THIRD_LINE_ADDR
           , A.FRTH_LINE_ADDR 
           , A.PROV_NM
           , A.CNTY_NM
           , A.CTRY_CD
           , A.DS_LOC_NM
           , A.CTY_ADDR
           , A.ST_CD
           , A.POST_CD
           , A.FIRST_REF_CMNT_TXT
           , A.SCD_REF_CMNT_TXT
           , A.ORIG_LOC_NUM
        FROM LOC_FLTR A
       WHERE NOT EXISTS (
                  SELECT 1 FROM LOC_FLTR B WHERE A.DS_ACCT_NUM = B.DS_ACCT_NUM AND A.ORIG_LOC_NUM IS NULL AND B.ORIG_LOC_NUM IS NOT NULL
             )  
    )
    SELECT * FROM (
    SELECT * 
      FROM ACCT_FLTR
     ORDER BY TREE_PATH NULLS LAST, DS_ACCT_RELN_TP_CD, DS_ACCT_NUM, XX_YES_NO_CD DESC, FIRST_LINE_ADDR 
    )
    WHERE ROWNUM &lt;= #rowNum#
    </statement>
</sqlMap>