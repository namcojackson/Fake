<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL7230Query">

    <typeAlias alias="NMAL7230SMsg"    type="business.blap.NMAL7230.NMAL7230SMsg"/>
    <typeAlias alias="NMAL7230_ASMsg"  type="business.blap.NMAL7230.NMAL7230_ASMsg"/>

    <statement id="search" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM
            (SELECT
                FZ.FRT_ZONE_PK           AS FRT_ZONE_PK
                ,FZ.LINE_BIZ_TP_CD       AS LINE_BIZ_TP_CD
                ,LT.LINE_BIZ_TP_DESC_TXT AS LINE_BIZ_TP_DESC_TXT
                ,FZ.DS_ACCT_NUM          AS DS_ACCT_NUM
                ,S.DS_ACCT_NM            AS DS_ACCT_NM
                ,FZ.PRC_GRP_PK           AS PRC_GRP_PK
                ,PG.PRC_GRP_NM           AS PRC_GRP_NM
                ,FZ.FRT_ZONE_NUM         AS FRT_ZONE_NUM
                ,FZ.SHIP_TO_ST_CD        AS SHIP_TO_ST_CD
                ,FZ.SHIP_TO_CTRY_CD      AS SHIP_TO_CTRY_CD
                ,FZ.SHIP_TO_FROM_POST_CD AS SHIP_TO_FROM_POST_CD
                ,FZ.SHIP_TO_THRU_POST_CD AS SHIP_TO_THRU_POST_CD
                ,FZ.EFF_FROM_DT          AS EFF_FROM_DT
                ,FZ.EFF_THRU_DT          AS EFF_THRU_DT
                ,FZ.EZUPTIME             AS EZUPTIME
                ,FZ.EZUPTIMEZONE         AS EZUPTIMEZONE
                ,FZ.EZINTIME             AS XX_REC_HIST_CRAT_TS
                ,FZ.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
                ,FZ.EZUPTIME             AS XX_REC_HIST_UPD_TS
                ,FZ.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
                ,FZ.EZTABLEID            AS XX_REC_HIST_TBL_NM
            FROM
                FRT_ZONE      FZ
                ,PRC_GRP      PG
                ,SELL_TO_CUST S
                ,LINE_BIZ_TP  LT
            WHERE
                FZ.GLBL_CMPY_CD             = #glblCmpyCd#
            AND FZ.EZCANCELFLAG             = '0'
            <isNotNull property="lineBizTpCd">
                AND FZ.LINE_BIZ_TP_CD           = #lineBizTpCd#
            </isNotNull>
            <isNotNull property="frtZoneNum">
                AND FZ.FRT_ZONE_NUM         = #frtZoneNum#
            </isNotNull>
            <iterate property="shipToStCdList" var="shipToStCd[]" open="AND  FZ.SHIP_TO_ST_CD IN (" close=")" conjunction= ", " >
                #shipToStCd[]#
            </iterate>
            <iterate property="shipToCtryCdList" var="shipToCtryCd[]" open="AND  FZ.SHIP_TO_CTRY_CD IN (" close=")" conjunction= ", " >
                #shipToCtryCd[]#
            </iterate>
            AND FZ.GLBL_CMPY_CD             = S.GLBL_CMPY_CD(+)
            AND S.EZCANCELFLAG(+)          = '0'
            AND FZ.DS_ACCT_NUM              = S.SELL_TO_CUST_CD(+)
            <iterate property="dsAcctNmList" var="dsAcctNm[]" open="AND  S.DS_ACCT_NM IN (" close=")" conjunction= ", " >
                #dsAcctNm[]#
            </iterate>
            AND FZ.GLBL_CMPY_CD             = PG.GLBL_CMPY_CD(+)
            AND PG.EZCANCELFLAG(+)          = '0'
            AND FZ.PRC_GRP_PK               = PG.PRC_GRP_PK(+)
            AND PG.PRC_GRP_TP_CD(+)         = #prcGrpTpCust#
            <iterate property="prcGrpNmList" var="prcGrpNm[]" open="AND  PG.PRC_GRP_NM IN (" close=")" conjunction= ", " >
                #prcGrpNm[]#
            </iterate>
            <isNotNull property="shipToFromPostCd">
                AND FZ.SHIP_TO_FROM_POST_CD = #shipToFromPostCd#
            </isNotNull>
            <isNotNull property="shipToThruPostCd">
                AND FZ.SHIP_TO_THRU_POST_CD = #shipToThruPostCd#
            </isNotNull>
            <isNotNull property="actvFlg">
                AND FZ.EFF_FROM_DT      &lt;= #salesDate#
            </isNotNull>
            <isNotNull property="effFromDt">
                AND FZ.EFF_FROM_DT      &gt;= #effFromDt#
            </isNotNull>
            <isNotNull property="actvFlg">
                AND (FZ.EFF_THRU_DT     &gt;= #salesDate# OR FZ.EFF_THRU_DT IS NULL)
            </isNotNull>
            <isNotNull property="effThruDt">
                AND (FZ.EFF_THRU_DT     &lt;= #effThruDt# OR FZ.EFF_THRU_DT IS NULL)
            </isNotNull>
            AND FZ.GLBL_CMPY_CD             = LT.GLBL_CMPY_CD(+)
            AND LT.EZCANCELFLAG(+)          = '0'
            AND FZ.LINE_BIZ_TP_CD           = LT.LINE_BIZ_TP_CD(+)
            ORDER BY
                LT.LINE_BIZ_TP_DESC_TXT  ASC
                ,S.DS_ACCT_NM            ASC NULLS FIRST
                ,PG.PRC_GRP_NM           ASC NULLS FIRST
                ,FZ.FRT_ZONE_NUM         ASC
                ,FZ.SHIP_TO_ST_CD        ASC
                ,FZ.SHIP_TO_CTRY_CD      ASC
                ,FZ.SHIP_TO_FROM_POST_CD ASC
                ,FZ.EFF_FROM_DT         DESC)
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="checkActiveDuplicationZone" parameterClass="Map" resultClass="Map">
        SELECT
            FZ.FRT_ZONE_PK             AS FRT_ZONE_PK
        FROM
            FRT_ZONE      FZ
        <isNotNull property="prcGrpNm">
            ,PRC_GRP      PG
        </isNotNull>
        <isNotNull property="dsAcctNm">
            ,SELL_TO_CUST S
        </isNotNull>
        WHERE
            FZ.GLBL_CMPY_CD                     = #glblCmpyCd#
        AND FZ.EZCANCELFLAG                     = '0'
        AND FZ.LINE_BIZ_TP_CD                   = #lineBizTpCd#
        <isNotNull property="dsAcctNm">
            AND FZ.GLBL_CMPY_CD                 = S.GLBL_CMPY_CD
            AND S.EZCANCELFLAG                  = '0'
            AND S.SELL_TO_CUST_CD               = #dsAcctNm#
            AND FZ.DS_ACCT_NUM                  = S.SELL_TO_CUST_CD
        </isNotNull>
        <isNull property="dsAcctNm">
            AND FZ.DS_ACCT_NUM IS NULL
        </isNull>
        <isNotNull property="prcGrpNm">
            AND FZ.GLBL_CMPY_CD                 = PG.GLBL_CMPY_CD
            AND PG.EZCANCELFLAG                 = '0'
            AND PG.PRC_GRP_NM                   = #prcGrpNm#
            AND FZ.PRC_GRP_PK                   = PG.PRC_GRP_PK
        </isNotNull>
        <isNull property="prcGrpNm">
            AND FZ.PRC_GRP_PK IS NULL
        </isNull>
        <isNotNull property="shipToCtryCd">
            AND FZ.SHIP_TO_CTRY_CD              = #shipToCtryCd#
        </isNotNull>
        <isNotNull property="shipToStCd">
            AND FZ.SHIP_TO_ST_CD                = #shipToStCd#
        </isNotNull>
        <isNotNull property="shipToFromPostCd">
            AND FZ.SHIP_TO_THRU_POST_CD         &gt;= #shipToFromPostCd#
        </isNotNull>
        <isNotNull property="shipToThruPostCd">
            AND FZ.SHIP_TO_FROM_POST_CD         &lt;= #shipToThruPostCd#
        </isNotNull>
        <isNotNull property="effFromDt">
            AND NVL(FZ.EFF_THRU_DT, #highDate#) &gt;= #effFromDt#
        </isNotNull>
        <isNotNull property="effThruDt">
            AND (FZ.EFF_FROM_DT                 &lt;= #effThruDt#)
        </isNotNull>
        <isNull property="effThruDt">
            AND (FZ.EFF_FROM_DT                 &lt;= #highDate#)
        </isNull>
    </statement>

    <statement id="searchForDownload" parameterClass="Map" resultClass="Map">
        SELECT
            LT.LINE_BIZ_TP_DESC_TXT AS LINE_BIZ_TP_DESC_TXT
            ,S.DS_ACCT_NM            AS DS_ACCT_NM
            ,PG.PRC_GRP_NM           AS PRC_GRP_NM
            ,FZ.FRT_ZONE_NUM         AS FRT_ZONE_NUM
            ,FZ.SHIP_TO_ST_CD        AS SHIP_TO_ST_CD
            ,FZ.SHIP_TO_CTRY_CD      AS SHIP_TO_CTRY_CD
            ,FZ.SHIP_TO_FROM_POST_CD AS SHIP_TO_FROM_POST_CD
            ,FZ.SHIP_TO_THRU_POST_CD AS SHIP_TO_THRU_POST_CD
            ,FZ.EFF_FROM_DT          AS EFF_FROM_DT
            ,FZ.EFF_THRU_DT          AS EFF_THRU_DT
        FROM
            FRT_ZONE      FZ
            ,PRC_GRP      PG
            ,SELL_TO_CUST S
            ,LINE_BIZ_TP  LT
        WHERE
            FZ.GLBL_CMPY_CD             = #glblCmpyCd#
        AND FZ.EZCANCELFLAG             = '0'
        <isNotNull property="lineBizTpCd">
            AND FZ.LINE_BIZ_TP_CD           = #lineBizTpCd#
        </isNotNull>
        <isNotNull property="frtZoneNum">
            AND FZ.FRT_ZONE_NUM         = #frtZoneNum#
        </isNotNull>
        <iterate property="shipToStCdList" var="shipToStCd[]" open="AND  FZ.SHIP_TO_ST_CD IN (" close=")" conjunction= ", " >
            #shipToStCd[]#
        </iterate>
        <iterate property="shipToCtryCdList" var="shipToCtryCd[]" open="AND  FZ.SHIP_TO_CTRY_CD IN (" close=")" conjunction= ", " >
            #shipToCtryCd[]#
        </iterate>
        AND FZ.GLBL_CMPY_CD             = S.GLBL_CMPY_CD(+)
        AND S.EZCANCELFLAG(+)           = '0'
        AND FZ.DS_ACCT_NUM              = S.SELL_TO_CUST_CD(+)
        <iterate property="dsAcctNmList" var="dsAcctNm[]" open="AND  S.DS_ACCT_NM IN (" close=")" conjunction= ", " >
            #dsAcctNm[]#
        </iterate>
        AND FZ.GLBL_CMPY_CD             = PG.GLBL_CMPY_CD(+)
        AND PG.EZCANCELFLAG(+)          = '0'
        AND FZ.PRC_GRP_PK               = PG.PRC_GRP_PK(+)
        AND PG.PRC_GRP_TP_CD(+)         = #prcGrpTpCust#
        <iterate property="prcGrpNmList" var="prcGrpNm[]" open="AND  PG.PRC_GRP_NM IN (" close=")" conjunction= ", " >
            #prcGrpNm[]#
        </iterate>
        <isNotNull property="shipToFromPostCd">
            AND FZ.SHIP_TO_FROM_POST_CD = #shipToFromPostCd#
        </isNotNull>
        <isNotNull property="shipToThruPostCd">
            AND FZ.SHIP_TO_THRU_POST_CD = #shipToThruPostCd#
        </isNotNull>
        <isNotNull property="actvFlg">
            AND FZ.EFF_FROM_DT      &lt;= #salesDate#
        </isNotNull>
        <isNotNull property="effFromDt">
            AND FZ.EFF_FROM_DT      &gt;= #effFromDt#
        </isNotNull>
        <isNotNull property="actvFlg">
            AND (FZ.EFF_THRU_DT     &gt;= #salesDate# OR FZ.EFF_THRU_DT IS NULL)
        </isNotNull>
        <isNotNull property="effThruDt">
            AND (FZ.EFF_THRU_DT     &lt;= #effThruDt# OR FZ.EFF_THRU_DT IS NULL)
        </isNotNull>
        AND FZ.GLBL_CMPY_CD             = LT.GLBL_CMPY_CD(+)
        AND LT.EZCANCELFLAG(+)          = '0'
        AND FZ.LINE_BIZ_TP_CD           = LT.LINE_BIZ_TP_CD(+)
        ORDER BY
            LT.LINE_BIZ_TP_DESC_TXT  ASC
            ,S.DS_ACCT_NM            ASC NULLS FIRST
            ,PG.PRC_GRP_NM           ASC NULLS FIRST
            ,FZ.FRT_ZONE_NUM         ASC
            ,FZ.SHIP_TO_ST_CD        ASC
            ,FZ.SHIP_TO_CTRY_CD      ASC
            ,FZ.SHIP_TO_FROM_POST_CD ASC
            ,FZ.EFF_FROM_DT         DESC
    </statement>

    <statement id="getSavedSearchOptionList" parameterClass="Map" resultClass="Map">
        SELECT
               SSO.SRCH_OPT_PK
             , SSO.SRCH_OPT_NM
         FROM
             SAVE_SRCH_OPT SSO 
         WHERE
             SSO.GLBL_CMPY_CD        = #glblCmpyCd#
             AND SSO.SRCH_OPT_APL_ID = #srchOptAplId#
             AND SSO.SRCH_OPT_USR_ID = #srchOptUsrId#
             AND SSO.EZCANCELFLAG    = '0'
         ORDER BY
               SSO.SRCH_OPT_NM
    </statement>
</sqlMap>
