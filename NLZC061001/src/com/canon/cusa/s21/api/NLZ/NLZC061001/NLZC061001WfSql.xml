<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLZC061001">

    <statement id="SPECIFY_APVL_POSN_CD" parameterClass="Map" resultClass="Map">
        WITH APPROVAL_TEAM_POS AS (
            SELECT
                DISTINCT
                 ATE.APVL_TEAM_PK
                ,ATE.APVL_TEAM_NM
                ,ATE.APVL_HRCH_TP_CD
                ,ATM.APVL_TEAM_POSN_TP_CD
                ,ATP.APVL_TEAM_POSN_LAYER_NUM
                ,ATT.APVL_TEAM_TRX_PK
                ,ATT.APVL_HIST_SRC_TP_CD
                ,ATL.APVL_TEAM_LOC_PK
                ,ALT.APVL_LIMIT_PK
                ,ALT.APVL_LIMIT_AMT
                ,MAX(ATP.APVL_TEAM_POSN_LAYER_NUM) OVER (PARTITION BY 1) APPROVER_POS_LAYER_NUM
                ,MAX(ATE.APVL_TEAM_PK) OVER (PARTITION BY 1) APPROVER_TEAM_PK
            FROM
                 APVL_TEAM         ATE
                ,APVL_TEAM_MBR     ATM
                ,APVL_TEAM_TRX     ATT
                ,APVL_TEAM_LOC     ATL
                ,APVL_LIMIT        ALT
                ,APVL_TEAM_POSN_TP ATP
            WHERE 1=1
            -- JOIN TO APVL_TEAM
            AND ATE.GLBL_CMPY_CD         = #glblCmpyCd#
            AND ATE.APVL_HRCH_TP_CD      = #condStr2#
            AND ATE.EZCANCELFLAG         = '0'
            -- JOIN TO APVL_TEAM_MBR
            AND ATE.GLBL_CMPY_CD         = ATM.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK         = ATM.APVL_TEAM_PK
            AND ATM.EZCANCELFLAG         = '0'
            -- JOIN TO APVL_TEAM_TRX
            AND ATE.GLBL_CMPY_CD         = ATT.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK         = ATT.APVL_TEAM_PK
            AND ATT.APVL_HIST_SRC_TP_CD  = #condStr3#
            AND ATT.EZCANCELFLAG         = '0'
            -- JOIN TO APVL_TEAM_LOC
            AND ATE.GLBL_CMPY_CD         = ATL.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK         = ATL.APVL_TEAM_PK
            AND ATL.RTL_WH_CD            = #condStr1#
            AND ATL.EZCANCELFLAG         = '0'
            -- JOIN TO APVL_LIMIT
            AND ATE.GLBL_CMPY_CD         = ALT.GLBL_CMPY_CD
            AND ATE.APVL_HRCH_TP_CD      = ALT.APVL_HRCH_TP_CD
            AND ALT.APVL_TEAM_POSN_TP_CD = ATM.APVL_TEAM_POSN_TP_CD
            AND ALT.APVL_HIST_SRC_TP_CD  = ATT.APVL_HIST_SRC_TP_CD
            AND ALT.APVL_LIMIT_AMT      &gt;= #condNum1#
            AND ALT.EZCANCELFLAG         = '0'
            -- JOIN TO APVL_TEAM_POSN_TP
            AND ATM.APVL_TEAM_POSN_TP_CD = ATP.APVL_TEAM_POSN_TP_CD
            AND ATE.GLBL_CMPY_CD         = ATP.GLBL_CMPY_CD
            AND ATP.EZCANCELFLAG         = '0'
            ORDER BY 
                ATP.APVL_TEAM_POSN_LAYER_NUM DESC
        )
        SELECT
            APVL.COND_NUM_2
            ,APVL.COND_STR_4
            ,APVL.COND_NUM_3
            ,APVL.COND_NUM_1
            ,APVL.DEC_COND
            ,CASE WHEN APVL.DEC_COND = 'Next' THEN '0'
             ELSE '1'
             END                          AS COND_STR_10
        FROM (
            SELECT
                0                         AS SORT_KEY
                ,APVL_TEAM_PK             AS COND_NUM_2
                ,APVL_TEAM_POSN_TP_CD     AS COND_STR_4
                ,APVL_TEAM_POSN_LAYER_NUM AS COND_NUM_3
                ,APVL_LIMIT_AMT           AS COND_NUM_1
                ,'Next'                   AS DEC_COND
            FROM 
                APPROVAL_TEAM_POS A
            WHERE 
                A.APPROVER_POS_LAYER_NUM  = A.APVL_TEAM_POSN_LAYER_NUM
                AND A.APPROVER_TEAM_PK    = A.APVL_TEAM_PK
                AND ROWNUM                = 1
            UNION ALL
            SELECT
                1                         AS SORT_KEY
                ,0                        AS COND_NUM_2
                ,''                       AS COND_STR_4
                ,0                        AS COND_NUM_3
                ,0                        AS COND_NUM_1
                ,'Next2'                  AS DEC_COND
            FROM
                DUAL
            ORDER BY SORT_KEY
            ) APVL
        WHERE
            ROWNUM                       = 1
    </statement>

    <statement id="SPECIFY_APVL_PSN_CD_BY_APVL_TEAM_POSN" parameterClass="Map" resultClass="Map">
        WITH APVL AS (
            SELECT
                ATE.APVL_TEAM_PK              AS COND_NUM_2
                ,ATM.APVL_TEAM_POSN_TP_CD     AS COND_STR_4
                ,ATP.APVL_TEAM_POSN_LAYER_NUM AS COND_NUM_3
                ,MAX(ATM.PSN_CD)              AS VAL_STR_1
            FROM
                APVL_TEAM          ATE
                ,APVL_TEAM_MBR     ATM
                ,APVL_TEAM_TRX     ATT
                ,APVL_TEAM_LOC     ATL
                ,APVL_TEAM_POSN_TP ATP
            WHERE 1=1
            -- JOIN TO APVL_TEAM
            AND ATE.GLBL_CMPY_CD             = #glblCmpyCd#
            AND ATE.APVL_HRCH_TP_CD          = #condStr2#
            AND ATE.APVL_TEAM_PK             = #condNum2#
            AND ATE.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_MBR
            AND ATE.GLBL_CMPY_CD             = ATM.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATM.APVL_TEAM_PK
            AND ATM.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_TRX
            AND ATE.GLBL_CMPY_CD             = ATT.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATT.APVL_TEAM_PK
            AND ATT.APVL_HIST_SRC_TP_CD      = #condStr3#
            AND ATT.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_LOC
            AND ATE.GLBL_CMPY_CD             = ATL.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATL.APVL_TEAM_PK 
            AND ATL.RTL_WH_CD                = #condStr1#
            AND ATL.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_POSN_TP
            AND ATM.APVL_TEAM_POSN_TP_CD     = ATP.APVL_TEAM_POSN_TP_CD
            AND ATE.GLBL_CMPY_CD             = ATP.GLBL_CMPY_CD
            AND ATP.APVL_TEAM_POSN_LAYER_NUM &gt;= #condNum3#
            AND ATP.EZCANCELFLAG             = '0'
            GROUP BY
                ATE.APVL_TEAM_PK
                ,ATM.APVL_TEAM_POSN_TP_CD
                ,ATP.APVL_TEAM_POSN_LAYER_NUM
            ORDER BY
                COND_NUM_3 DESC
        )
        SELECT
            A.VAL_STR_1
        FROM
            APVL A
    </statement>

    <statement id="SPECIFY_APVL_PSN_CD_BY_APVL_TEAM_POSN_NO_USER" parameterClass="Map" resultClass="Map">
        SELECT
            NULL
        FROM
            DUAL
        WHERE
            ROWNUM = 2
    </statement>
    
    <statement id="SPECIFY_GRP_APVL_PSN_CD_BY_APVL_TEAM_POSN" parameterClass="Map" resultClass="Map">
     <isEqual property="condStr10" compareValue="1">
         SELECT
            ''                             AS BIZ_ID
            , ''                           AS USER_GROUP_NAME
            , ''                           AS USER_GROUP_LEVEL
            , ''                           AS WF_USR_ID 
         FROM
           DUAL 
         WHERE
           ROWNUM = 2
     </isEqual>
     <isNotEqual property="condStr10" compareValue="1">
        WITH APVL_LVEL AS (
            SELECT
                ATE.APVL_TEAM_PK              AS COND_NUM_2
                ,ATM.APVL_TEAM_POSN_TP_CD     AS COND_STR_4
                ,ATP.APVL_TEAM_POSN_LAYER_NUM AS COND_NUM_3
                ,ATM.PSN_CD                   AS VAL_STR_1
                ,DENSE_RANK()OVER(
                    ORDER BY ATP.APVL_TEAM_POSN_LAYER_NUM DESC) AS LEVEL_NUM
            FROM
                APVL_TEAM          ATE
                ,APVL_TEAM_MBR     ATM
                ,APVL_TEAM_TRX     ATT
                ,APVL_TEAM_LOC     ATL
                ,APVL_TEAM_POSN_TP ATP
            WHERE 1=1
            -- JOIN TO APVL_TEAM
            AND ATE.GLBL_CMPY_CD             = #glblCmpyCd#
            AND ATE.APVL_HRCH_TP_CD          = #condStr2#
            AND ATE.APVL_TEAM_PK             = #condNum2#
            AND ATE.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_MBR
            AND ATE.GLBL_CMPY_CD             = ATM.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATM.APVL_TEAM_PK
            AND ATM.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_TRX
            AND ATE.GLBL_CMPY_CD             = ATT.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATT.APVL_TEAM_PK
            AND ATT.APVL_HIST_SRC_TP_CD      = #condStr3#
            AND ATT.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_LOC
            AND ATE.GLBL_CMPY_CD             = ATL.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATL.APVL_TEAM_PK 
            AND ATL.RTL_WH_CD                = #condStr1#
            AND ATL.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_POSN_TP
            AND ATM.APVL_TEAM_POSN_TP_CD     = ATP.APVL_TEAM_POSN_TP_CD
            AND ATE.GLBL_CMPY_CD             = ATP.GLBL_CMPY_CD
            AND ATP.APVL_TEAM_POSN_LAYER_NUM &gt;= #condNum3#
            AND ATP.EZCANCELFLAG             = '0'
            ORDER BY
                ATP.APVL_TEAM_POSN_LAYER_NUM DESC
                ,ATM.PSN_CD
        )
        ,APVL AS (
            SELECT
                ATE.APVL_TEAM_PK              AS COND_NUM_2
                ,ATM.APVL_TEAM_POSN_TP_CD     AS COND_STR_4
                ,ATP.APVL_TEAM_POSN_LAYER_NUM AS COND_NUM_3
                ,Max(ATM.PSN_CD)              AS VAL_STR_1
            FROM
                APVL_TEAM          ATE
                ,APVL_TEAM_MBR     ATM
                ,APVL_TEAM_TRX     ATT
                ,APVL_TEAM_LOC     ATL
                ,APVL_TEAM_POSN_TP ATP
            WHERE 1=1
            -- JOIN TO APVL_TEAM
            AND ATE.GLBL_CMPY_CD             = #glblCmpyCd#
            AND ATE.APVL_HRCH_TP_CD          = #condStr2#
            AND ATE.APVL_TEAM_PK             = #condNum2#
            AND ATE.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_MBR
            AND ATE.GLBL_CMPY_CD             = ATM.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATM.APVL_TEAM_PK
            AND ATM.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_TRX
            AND ATE.GLBL_CMPY_CD             = ATT.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATT.APVL_TEAM_PK
            AND ATT.APVL_HIST_SRC_TP_CD      = #condStr3#
            AND ATT.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_LOC
            AND ATE.GLBL_CMPY_CD             = ATL.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATL.APVL_TEAM_PK 
            AND ATL.RTL_WH_CD                = #condStr1#
            AND ATL.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_POSN_TP
            AND ATM.APVL_TEAM_POSN_TP_CD     = ATP.APVL_TEAM_POSN_TP_CD
            AND ATE.GLBL_CMPY_CD             = ATP.GLBL_CMPY_CD
            AND ATP.APVL_TEAM_POSN_LAYER_NUM &gt;= #condNum3#
            AND ATP.EZCANCELFLAG             = '0'
            Group by
                ATE.APVL_TEAM_PK
                ,ATM.APVL_TEAM_POSN_TP_CD
                ,ATP.APVL_TEAM_POSN_LAYER_NUM
            ORDER BY
                COND_NUM_3 DESC
        )
        SELECT
            'NLZC06100101'                 AS BIZ_ID
            ,'GRP_APVL_PSN'                AS USER_GROUP_NAME
            ,A.LEVEL_NUM                   AS USER_GROUP_LEVEL
            ,A.VAL_STR_1                   AS WF_USR_ID
        FROM (
            SELECT
                AL.VAL_STR_1
                ,AL.LEVEL_NUM
            FROM
                APVL_LVEL AL
            WHERE
                NOT EXISTS(
                    SELECT  1 FROM APVL AP WHERE AP.VAL_STR_1 = AL.VAL_STR_1
                )
            ) A
     </isNotEqual>
    </statement>

    <statement id="APVL_CC_PSN_CD" parameterClass="Map" resultClass="Map">
        SELECT
            'NLZC06100101'                 AS BIZ_ID
            ,'GRP_CC_APVL_PSN'             AS USER_GROUP_NAME
            ,''                            AS USER_GROUP_LEVEL
            ,#condStr1#                    AS WF_USR_ID
        FROM
            DUAL
    </statement>

    <statement id="FYI_PSN_CD" parameterClass="Map" resultClass="Map">
        WITH APVL_LVEL AS (
            SELECT
                ATE.APVL_TEAM_PK              AS COND_NUM_2
                ,ATM.APVL_TEAM_POSN_TP_CD     AS COND_STR_4
                ,ATP.APVL_TEAM_POSN_LAYER_NUM AS COND_NUM_3
                ,ATM.PSN_CD                   AS VAL_STR_1
                ,DENSE_RANK()OVER(
                    ORDER BY ATP.APVL_TEAM_POSN_LAYER_NUM DESC) AS LEVEL_NUM
            FROM
                APVL_TEAM          ATE
                ,APVL_TEAM_MBR     ATM
                ,APVL_TEAM_TRX     ATT
                ,APVL_TEAM_LOC     ATL
                ,APVL_TEAM_POSN_TP ATP
            WHERE 1=1
            -- JOIN TO APVL_TEAM
            AND ATE.GLBL_CMPY_CD             = #glblCmpyCd#
            AND ATE.APVL_HRCH_TP_CD          = #condStr2#
            AND ATE.APVL_TEAM_PK             = #condNum2#
            AND ATE.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_MBR
            AND ATE.GLBL_CMPY_CD             = ATM.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATM.APVL_TEAM_PK
            AND ATM.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_TRX
            AND ATE.GLBL_CMPY_CD             = ATT.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATT.APVL_TEAM_PK
            AND ATT.APVL_HIST_SRC_TP_CD      = #condStr3#
            AND ATT.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_LOC
            AND ATE.GLBL_CMPY_CD             = ATL.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATL.APVL_TEAM_PK 
            AND ATL.RTL_WH_CD                = #condStr1#
            AND ATL.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_POSN_TP
            AND ATM.APVL_TEAM_POSN_TP_CD     = ATP.APVL_TEAM_POSN_TP_CD
            AND ATE.GLBL_CMPY_CD             = ATP.GLBL_CMPY_CD
            AND ATP.APVL_TEAM_POSN_LAYER_NUM &gt;= #condNum3#
            AND ATP.EZCANCELFLAG             = '0'
            ORDER BY
                ATP.APVL_TEAM_POSN_LAYER_NUM DESC
                ,ATM.PSN_CD
        )
        SELECT
            'NLZC06100101'                 AS BIZ_ID
            ,'GRP_CC_PSN'                  AS USER_GROUP_NAME
            ,AL.LEVEL_NUM                  AS USER_GROUP_LEVEL
            ,AL.VAL_STR_1                  AS WF_USR_ID
        FROM
            APVL_LVEL AL
        UNION
        SELECT
            'NLZC06100101'                 AS BIZ_ID
            ,'GRP_CC_PSN'                  AS USER_GROUP_NAME
            ,null                          AS USER_GROUP_LEVEL
            ,#condStr1#                    AS WF_USR_ID
        FROM
            DUAL 
    </statement>
    <statement id="SPECIFY_APVL_PSN_CD_BY_APVL_TEAM_POSN_FOR_WH" parameterClass="Map" resultClass="Map">
        WITH APVL AS (
            SELECT
                ATE.APVL_TEAM_PK              AS COND_NUM_2
                ,ATM.APVL_TEAM_POSN_TP_CD     AS COND_STR_4
                ,ATP.APVL_TEAM_POSN_LAYER_NUM AS COND_NUM_3
                ,MAX(ATM.PSN_CD)              AS VAL_STR_1
            FROM
                APVL_TEAM          ATE
                ,APVL_TEAM_MBR     ATM
                ,APVL_TEAM_TRX     ATT
                ,APVL_TEAM_LOC     ATL
                ,APVL_TEAM_POSN_TP ATP
            WHERE 1=1
            -- JOIN TO APVL_TEAM
            AND ATE.GLBL_CMPY_CD             = #glblCmpyCd#
            AND ATE.APVL_HRCH_TP_CD          = #condStr2#
            AND ATE.APVL_TEAM_PK             = #condNum2#
            AND ATE.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_MBR
            AND ATE.GLBL_CMPY_CD             = ATM.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATM.APVL_TEAM_PK
            AND ATM.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_TRX
            AND ATE.GLBL_CMPY_CD             = ATT.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATT.APVL_TEAM_PK
            AND ATT.APVL_HIST_SRC_TP_CD      = #condStr3#
            AND ATT.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_LOC
            AND ATE.GLBL_CMPY_CD             = ATL.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATL.APVL_TEAM_PK 
            AND ATL.RTL_WH_CD                = #condStr1#
            AND ATL.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_POSN_TP
            AND ATM.APVL_TEAM_POSN_TP_CD     = ATP.APVL_TEAM_POSN_TP_CD
            AND ATE.GLBL_CMPY_CD             = ATP.GLBL_CMPY_CD
            AND ATP.APVL_TEAM_POSN_LAYER_NUM &gt;= #condNum3#
            AND ATP.EZCANCELFLAG             = '0'
            GROUP BY
                ATE.APVL_TEAM_PK
                ,ATM.APVL_TEAM_POSN_TP_CD
                ,ATP.APVL_TEAM_POSN_LAYER_NUM
            ORDER BY
                COND_NUM_3 DESC
        )
        SELECT
            A.VAL_STR_1
        FROM
            APVL A
    </statement>
    <statement id="SPECIFY_GRP_APVL_PSN_CD_BY_APVL_TEAM_POSN_FOR_WH" parameterClass="Map" resultClass="Map">
     <isEqual property="condStr10" compareValue="1">
         SELECT
            ''                             AS BIZ_ID
            , ''                           AS USER_GROUP_NAME
            , ''                           AS USER_GROUP_LEVEL
            , ''                           AS WF_USR_ID 
         FROM
           DUAL 
         WHERE
           ROWNUM = 2
     </isEqual>
     <isNotEqual property="condStr10" compareValue="1">
        WITH APVL_LVEL AS (
            SELECT
                ATE.APVL_TEAM_PK              AS COND_NUM_2
                ,ATM.APVL_TEAM_POSN_TP_CD     AS COND_STR_4
                ,ATP.APVL_TEAM_POSN_LAYER_NUM AS COND_NUM_3
                ,ATM.PSN_CD                   AS VAL_STR_1
                ,DENSE_RANK()OVER(
                    ORDER BY ATP.APVL_TEAM_POSN_LAYER_NUM DESC) AS LEVEL_NUM
            FROM
                APVL_TEAM          ATE
                ,APVL_TEAM_MBR     ATM
                ,APVL_TEAM_TRX     ATT
                ,APVL_TEAM_LOC     ATL
                ,APVL_TEAM_POSN_TP ATP
            WHERE 1=1
            -- JOIN TO APVL_TEAM
            AND ATE.GLBL_CMPY_CD             = #glblCmpyCd#
            AND ATE.APVL_HRCH_TP_CD          = #condStr2#
            AND ATE.APVL_TEAM_PK             = #condNum2#
            AND ATE.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_MBR
            AND ATE.GLBL_CMPY_CD             = ATM.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATM.APVL_TEAM_PK
            AND ATM.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_TRX
            AND ATE.GLBL_CMPY_CD             = ATT.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATT.APVL_TEAM_PK
            AND ATT.APVL_HIST_SRC_TP_CD      = #condStr3#
            AND ATT.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_LOC
            AND ATE.GLBL_CMPY_CD             = ATL.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATL.APVL_TEAM_PK 
            AND ATL.RTL_WH_CD                = #condStr1#
            AND ATL.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_POSN_TP
            AND ATM.APVL_TEAM_POSN_TP_CD     = ATP.APVL_TEAM_POSN_TP_CD
            AND ATE.GLBL_CMPY_CD             = ATP.GLBL_CMPY_CD
            AND ATP.APVL_TEAM_POSN_LAYER_NUM &gt;= #condNum3#
            AND ATP.EZCANCELFLAG             = '0'
            ORDER BY
                ATP.APVL_TEAM_POSN_LAYER_NUM DESC
                ,ATM.PSN_CD
        )
        ,APVL AS (
            SELECT
                ATE.APVL_TEAM_PK              AS COND_NUM_2
                ,ATM.APVL_TEAM_POSN_TP_CD     AS COND_STR_4
                ,ATP.APVL_TEAM_POSN_LAYER_NUM AS COND_NUM_3
                ,Max(ATM.PSN_CD)              AS VAL_STR_1
            FROM
                APVL_TEAM          ATE
                ,APVL_TEAM_MBR     ATM
                ,APVL_TEAM_TRX     ATT
                ,APVL_TEAM_LOC     ATL
                ,APVL_TEAM_POSN_TP ATP
            WHERE 1=1
            -- JOIN TO APVL_TEAM
            AND ATE.GLBL_CMPY_CD             = #glblCmpyCd#
            AND ATE.APVL_HRCH_TP_CD          = #condStr2#
            AND ATE.APVL_TEAM_PK             = #condNum2#
            AND ATE.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_MBR
            AND ATE.GLBL_CMPY_CD             = ATM.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATM.APVL_TEAM_PK
            AND ATM.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_TRX
            AND ATE.GLBL_CMPY_CD             = ATT.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATT.APVL_TEAM_PK
            AND ATT.APVL_HIST_SRC_TP_CD      = #condStr3#
            AND ATT.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_LOC
            AND ATE.GLBL_CMPY_CD             = ATL.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATL.APVL_TEAM_PK 
            AND ATL.RTL_WH_CD                = #condStr1#
            AND ATL.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_POSN_TP
            AND ATM.APVL_TEAM_POSN_TP_CD     = ATP.APVL_TEAM_POSN_TP_CD
            AND ATE.GLBL_CMPY_CD             = ATP.GLBL_CMPY_CD
            AND ATP.APVL_TEAM_POSN_LAYER_NUM &gt;= #condNum3#
            AND ATP.EZCANCELFLAG             = '0'
            Group by
                ATE.APVL_TEAM_PK
                ,ATM.APVL_TEAM_POSN_TP_CD
                ,ATP.APVL_TEAM_POSN_LAYER_NUM
            ORDER BY
                COND_NUM_3 DESC
        )
        SELECT
            'NLZC06100102'                 AS BIZ_ID
            ,'GRP_APVL_PSN'                AS USER_GROUP_NAME
            ,A.LEVEL_NUM                   AS USER_GROUP_LEVEL
            ,A.VAL_STR_1                   AS WF_USR_ID
        FROM (
            SELECT
                AL.VAL_STR_1
                ,AL.LEVEL_NUM
            FROM
                APVL_LVEL AL
            WHERE
                NOT EXISTS(
                    SELECT  1 FROM APVL AP WHERE AP.VAL_STR_1 = AL.VAL_STR_1
                )
            ) A
     </isNotEqual>
    </statement>
    <statement id="FYI_PSN_CD_FOR_WH" parameterClass="Map" resultClass="Map">
        WITH APVL_LVEL AS (
            SELECT
                ATE.APVL_TEAM_PK              AS COND_NUM_2
                ,ATM.APVL_TEAM_POSN_TP_CD     AS COND_STR_4
                ,ATP.APVL_TEAM_POSN_LAYER_NUM AS COND_NUM_3
                ,ATM.PSN_CD                   AS VAL_STR_1
                ,DENSE_RANK()OVER(
                    ORDER BY ATP.APVL_TEAM_POSN_LAYER_NUM DESC) AS LEVEL_NUM
            FROM
                APVL_TEAM          ATE
                ,APVL_TEAM_MBR     ATM
                ,APVL_TEAM_TRX     ATT
                ,APVL_TEAM_LOC     ATL
                ,APVL_TEAM_POSN_TP ATP
            WHERE 1=1
            -- JOIN TO APVL_TEAM
            AND ATE.GLBL_CMPY_CD             = #glblCmpyCd#
            AND ATE.APVL_HRCH_TP_CD          = #condStr2#
            AND ATE.APVL_TEAM_PK             = #condNum2#
            AND ATE.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_MBR
            AND ATE.GLBL_CMPY_CD             = ATM.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATM.APVL_TEAM_PK
            AND ATM.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_TRX
            AND ATE.GLBL_CMPY_CD             = ATT.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATT.APVL_TEAM_PK
            AND ATT.APVL_HIST_SRC_TP_CD      = #condStr3#
            AND ATT.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_LOC
            AND ATE.GLBL_CMPY_CD             = ATL.GLBL_CMPY_CD
            AND ATE.APVL_TEAM_PK             = ATL.APVL_TEAM_PK 
            AND ATL.RTL_WH_CD                = #condStr1#
            AND ATL.EZCANCELFLAG             = '0'
            -- JOIN TO APVL_TEAM_POSN_TP
            AND ATM.APVL_TEAM_POSN_TP_CD     = ATP.APVL_TEAM_POSN_TP_CD
            AND ATE.GLBL_CMPY_CD             = ATP.GLBL_CMPY_CD
            AND ATP.APVL_TEAM_POSN_LAYER_NUM &gt;= #condNum3#
            AND ATP.EZCANCELFLAG             = '0'
            ORDER BY
                ATP.APVL_TEAM_POSN_LAYER_NUM DESC
                ,ATM.PSN_CD
        )
        SELECT
            'NLZC06100102'                 AS BIZ_ID
            ,'GRP_CC_PSN'                  AS USER_GROUP_NAME
            ,AL.LEVEL_NUM                  AS USER_GROUP_LEVEL
            ,AL.VAL_STR_1                  AS WF_USR_ID
        FROM
            APVL_LVEL AL
    </statement>
</sqlMap>
