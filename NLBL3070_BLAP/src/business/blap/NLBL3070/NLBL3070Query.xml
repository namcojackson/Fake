<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NLBL3070Query">

    <typeAlias alias="NLBL3070CMsg"     type="business.blap.NLBL3070.NLBL3070CMsg"/>
    <typeAlias alias="NLBL3070_ASMsg"   type="business.blap.NLBL3070.NLBL3070_ASMsg"/>
    <typeAlias alias="NLBL3070_BSMsg"   type="business.blap.NLBL3070.NLBL3070_BSMsg"/>

    <statement id ="SearchSchd" parameterClass="Map" resultMap="result.NLBL3070_ASMsg">
        WITH SCHD_V AS (
            SELECT /*+ ORDERED */
                SO.GLBL_CMPY_CD                                  AS GLBL_CMPY_CD
               ,SO.TRX_HDR_NUM                                   AS CPO_ORD_NUM
               ,SO.SVC_CONFIG_MSTR_PK                            AS SHIP_SVC_CONFIG_MSTR_PK
               ,SO.SO_NUM                                        AS SO_NUM
               ,MN.T_MDL_NM                                      AS MDL_NM
               ,SO.RDD_DT                                        AS RDD_DT
               ,SO.SCHD_CARR_PICK_UP_DT                          AS SCHD_CARR_PICK_UP_DT
               ,SO.SCHD_DELY_DT                                  AS SCHD_DELY_DT
               ,SO.SCHD_DELY_TM                                  AS SCHD_DELY_TM
               <!-- START 2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
               ,SO.TECH_MEET_TRUCK_FLG                           AS TECH_MEET_TRUCK_FLG
               <!-- END   2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
               <!-- START 2017/09/07 S.Katsuma [Sol#032(QC#13117),ADD] -->
               ,SO.NEXT_ACT_DT                                   AS NEXT_ACT_DT
               <!-- END 2017/09/07 S.Katsuma [Sol#032(QC#13117),ADD] -->
               ,SO.CARR_CD                                       AS CARR_CD
               ,V.LOC_NM                                         AS CARR_NM
               ,CASE WHEN SO.SCHD_ISTL_DT   IS NOT NULL THEN SO.SCHD_ISTL_DT
                     WHEN SO.SCHD_ISTL_TM   IS NOT NULL THEN SO.SCHD_ISTL_DT
                     WHEN DCII.RQST_ISTL_DT IS NOT NULL THEN DCII.RQST_ISTL_DT
                     WHEN DCII.RQST_ISTL_TM IS NOT NULL THEN DCII.RQST_ISTL_DT
                END                                              AS SCHD_ISTL_DT
               ,CASE WHEN SO.SCHD_ISTL_TM   IS NOT NULL THEN SO.SCHD_ISTL_TM
                     WHEN SO.SCHD_ISTL_DT   IS NOT NULL THEN SO.SCHD_ISTL_TM
                     WHEN DCII.RQST_ISTL_TM IS NOT NULL THEN DCII.RQST_ISTL_TM
                     WHEN DCII.RQST_ISTL_DT IS NOT NULL THEN DCII.RQST_ISTL_TM
                END                                              AS SCHD_ISTL_TM
               ,SO.SCHD_DURN_TM_NUM                              AS SCHD_DURN_TM_NUM
               ,SO.SCHD_COORD_STS_CD                             AS SCHD_COORD_STS_CD
               ,SCS.SCHD_COORD_STS_DESC_TXT                      AS SCHD_COORD_STS_DESC_TXT
               ,SCS.MAN_UPD_PRTY_NUM                             AS MAN_UPD_PRTY_NUM
               ,SO.SHIP_TO_CUST_ACCT_CD                          AS DS_ACCT_NUM
               ,SO.SHIP_TO_CUST_CD                               AS SHIP_TO_CUST_CD
               ,CASE WHEN LT.LOC_TP_CD = #locTpCust# THEN SEL.DS_ACCT_NM
                     ELSE SOCD.SO_CUST_LINE_LOC_NM_01
                END                                              AS SHIP_TO_CUST_NM
               ,SOCD.SO_CUST_LINE_ADDR_01                        AS SO_CUST_LINE_ADDR_01
               ,SOCD.SO_CUST_LINE_ADDR_02                        AS SO_CUST_LINE_ADDR_02
               ,SOCD.CTY_ADDR                                    AS CTY_ADDR
               ,SOCD.ST_CD                                       AS ST_CD
               ,SOCD.POST_CD                                     AS POST_CD
            <!-- START 2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
               ,SOCD.CTRY_CD                                     AS CTRY_CD
            <!-- END   2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
               ,RW.RTL_WH_CD                                     AS RTL_WH_CD
               ,RW.RTL_WH_NM                                     AS RTL_WH_NM
               ,SO.WMS_DROP_FLG                                  AS WMS_DROP_FLG
               ,SO.WMS_DROP_RQST_FLG                             AS WMS_DROP_READY_FLG
               ,CASE WHEN SO.DELY_REQ_FLG = #flgY#   THEN #flgY#
                     WHEN SO.DELY_REQ_TS IS NOT NULL THEN #flgY#
                     ELSE #flgN#
                END                                              AS SEND_RQST_FLG
               ,SO.SHPG_SVC_LVL_CD                               AS SHPG_SVC_LVL_CD
               ,SSL.SHPG_SVC_LVL_DESC_TXT                        AS SHPG_SVC_LVL_DESC_TXT
               ,SO.CARR_ACCT_NUM                                 AS CARR_ACCT_NUM
               ,TRIM(PSN.PSN_FIRST_NM || ' ' || PSN.PSN_LAST_NM) AS SCHD_COORD_PSN_NM
               ,SO.TEMP_SCHD_RSN_CD                              AS TEMP_SCHD_RSN_CD
               ,TSR.TEMP_SCHD_RSN_DESC_TXT                       AS TEMP_SCHD_RSN_DESC_TXT
               ,SO.TEMP_SCHD_CMNT_TXT                            AS TEMP_SCHD_CMNT_TXT
               ,SO.PDD_DT                                        AS PDD_DT
               ,DOC.DS_ORD_CATG_DESC_TXT                         AS DS_ORD_CATG_DESC_TXT
               ,DOT.DS_ORD_TP_DESC_TXT                           AS DS_ORD_TP_DESC_TXT
               ,CASE WHEN SS.SO_PRINT_FLG = #flgY# AND SS.SHIP_FLG = #flgN# THEN #flgY#
                     ELSE #flgN#
                END                                              AS ORD_OPEN_FLG
               ,SCS.SCHD_OPEN_FLG                                AS SCHD_OPEN_FLG
               ,WO.MAN_SEND_RQST_FLG                             AS WH_MAN_SEND_RQST_FLG
               ,CT.MAN_SEND_RQST_FLG                             AS CARR_MAN_SEND_RQST_FLG
               ,SCM.SVC_MACH_MSTR_PK                             AS SVC_MACH_MSTR_PK
               ,SO.DS_CPO_CONFIG_PK                              AS DS_CPO_CONFIG_PK
               ,SO.EZUPTIME                                      AS EZUPTIME_SO
               ,SO.EZUPTIMEZONE                                  AS EZUPTIMEZONE_SO
               ,ROW_NUMBER() OVER(PARTITION BY SO.GLBL_CMPY_CD ORDER BY SO.TRX_HDR_NUM, SO.SO_NUM) AS ROW_NUM
               <!-- START 2017/10/16 S.Katsuma [Sol#454,ADD] -->
               ,C.SELL_TO_FIRST_REF_CMNT_TXT                     AS XX_PSN_FIRST_MID_LAST_NM
               <!-- END 2017/10/16 S.Katsuma [Sol#454,ADD] -->
               ,(
                 SELECT
                     COUNT(OCB.ORD_CATG_CTX_TP_CD)
                 FROM
                     ORD_CATG_BIZ_CTX OCB
                 WHERE
                     OCB.GLBL_CMPY_CD       = C.GLBL_CMPY_CD
                 AND OCB.ORD_CATG_CTX_TP_CD IN(#ordCatgCtxTp#)
                 AND OCB.DS_ORD_CATG_CD     = C.DS_ORD_CATG_CD
                 AND (OCB.DS_ORD_TP_CD IS NULL OR OCB.DS_ORD_TP_CD = C.DS_ORD_TP_CD)
                 AND (OCB.DS_ORD_RSN_CD IS NULL OR OCB.DS_ORD_RSN_CD = C.DS_ORD_RSN_CD)
                 AND OCB.EZCANCELFLAG = '0'
               ) AS SPLY_ORD_FLG
               <!-- START 2021/05/31 A.Marte [QC#58786,ADD] -->
               ,SO.SCE_ORD_TP_CD    AS SCE_ORD_TP_CD
               <!-- END 2021/05/31 A.Marte [QC#58786,ADD] -->
            FROM
                SHPG_ORD          SO
               ,SHPG_STS          SS
               ,SCHD_COORD_STS    SCS
               ,S21_PSN           PSN
               ,VND               V
               ,CARR_TP           CT
               ,SHPG_ORD_CUST_DTL SOCD
               ,RTL_WH            RW
               ,WH_OWNR           WO
               ,CPO               C
               ,SELL_TO_CUST      SEL
               ,DS_CPO_ISTL_INFO  DCII
               ,MDL_NM            MN
               ,DS_ORD_CATG       DOC
               ,DS_ORD_TP         DOT
               ,SVC_CONFIG_MSTR   SCM
               ,SHIP_TO_CUST      STC
               ,LOC_TP            LT
               ,SHPG_SVC_LVL      SSL
               ,TEMP_SCHD_RSN     TSR
               <!-- START 2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
               ,SVC_ISTL_RULE     SIR
               <!-- END   2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
            WHERE
                SO.GLBL_CMPY_CD          = #glblCmpyCd#
            <isNotNull property="cMsg.soNum">
            AND SO.SO_NUM                = #cMsg.soNum#
            </isNotNull>
            <isNotNull property="soNumList">
                <iterate property="soNumList" var="soNumList[]" open="AND SO.SO_NUM IN (" conjunction= ", " close=")">
                    #soNumList[]#
                </iterate>
            </isNotNull>
            <isNotNull property="cMsg.rtlWhCd">
            AND SO.WH_CD                 = #cMsg.rtlWhCd#
            </isNotNull>
            <isNotNull property="cMsg.trxHdrNum">
            AND SO.TRX_HDR_NUM           = #cMsg.trxHdrNum#
            </isNotNull>
            <isNotNull property="cMsg.shipToCustCd">
            AND SO.SHIP_TO_CUST_CD       = #cMsg.shipToCustCd#
            </isNotNull>
            <isNotNull property="cMsg.rddDt_FR">
            AND SO.RDD_DT            &gt;= #cMsg.rddDt_FR#
            </isNotNull>
            <isNotNull property="cMsg.rddDt_TO">
            AND SO.RDD_DT            &lt;= #cMsg.rddDt_TO#
            </isNotNull>
            <isNotNull property="cMsg.wmsDropFlg_Y">
                <isNull property="cMsg.wmsDropFlg_N">
                AND SO.WMS_DROP_FLG      = #flgY#
                </isNull>
            </isNotNull>
            <isNotNull property="cMsg.wmsDropFlg_N">
                <isNull property="cMsg.wmsDropFlg_Y">
                AND SO.WMS_DROP_FLG      = #flgN#
                </isNull>
            </isNotNull>
            <isNotNull property="cMsg.svcConfigMstrPk">
            AND SO.SVC_CONFIG_MSTR_PK    = #cMsg.svcConfigMstrPk#
            </isNotNull>
            <isNotNull property="cMsg.delyReqFlg_Y">
                <isNull property="cMsg.delyReqFlg_N">
                AND (   SO.DELY_REQ_FLG  = #flgY#
                     <!-- START 2018/03/23 S.Katsuma [QC#24890,MOD] -->
                     <!-- OR SO.DELY_REQ_TS   IS NOT NULL -->
                     OR (SO.DELY_REQ_FLG  = #flgN# AND SO.DELY_REQ_TS   IS NOT NULL)
                     <!-- END 2018/03/23 S.Katsuma [QC#24890,MOD] -->
                    )
                </isNull>
            </isNotNull>
            <isNotNull property="cMsg.delyReqFlg_N">
                <isNull property="cMsg.delyReqFlg_Y">
                AND (   SO.DELY_REQ_FLG  = #flgN#
                     <!-- START 2018/03/23 S.Katsuma [QC#24890,MOD] -->
                     <!-- OR SO.DELY_REQ_TS   IS NULL -->
                     AND SO.DELY_REQ_TS   IS NULL
                     <!-- END 2018/03/23 S.Katsuma [QC#24890,MOD] -->
                    )
                </isNull>
            </isNotNull>
            AND SO.EZCANCELFLAG          = '0'
            AND SO.GLBL_CMPY_CD          = SS.GLBL_CMPY_CD
            AND SO.SHPG_STS_CD           = SS.SHPG_STS_CD
            AND SS.EZCANCELFLAG          = '0'
            <isNotNull property="cMsg.shpgSvcLvlCd">
            AND SO.SHPG_SVC_LVL_CD       = #cMsg.shpgSvcLvlCd#
            </isNotNull>
            <isNotNull property="cMsg.schdCoordStsCd">
            AND SO.SCHD_COORD_STS_CD     = #cMsg.schdCoordStsCd#
            </isNotNull>
            <isNotNull property="cMsg.carrCd">
            AND SO.CARR_CD               = #cMsg.carrCd#
            </isNotNull>
            <isNotNull property="cMsg.schdCoordPsnCd">
            AND SO.SCHD_COORD_PSN_CD     = #cMsg.schdCoordPsnCd#
            </isNotNull>
            <isNotNull property="cMsg.schdDelyDt_FR">
            AND SO.SCHD_DELY_DT          &gt;= #cMsg.schdDelyDt_FR#
            </isNotNull>
            <isNotNull property="cMsg.schdDelyDt_TO">
            AND SO.SCHD_DELY_DT          &lt;= #cMsg.schdDelyDt_TO#
            </isNotNull>
            <isNotNull property="cMsg.schdCarrPickUpDt_FR">
            AND SO.SCHD_CARR_PICK_UP_DT  &gt;= #cMsg.schdCarrPickUpDt_FR#
            </isNotNull>
            <isNotNull property="cMsg.schdCarrPickUpDt_TO">
            AND SO.SCHD_CARR_PICK_UP_DT  &lt;= #cMsg.schdCarrPickUpDt_TO#
            </isNotNull>
            AND SO.GLBL_CMPY_CD          = SCS.GLBL_CMPY_CD
            AND SO.SCHD_COORD_STS_CD     = SCS.SCHD_COORD_STS_CD
            AND SCS.EZCANCELFLAG         = '0'
            AND SO.GLBL_CMPY_CD          = PSN.GLBL_CMPY_CD(+)
            AND SO.SCHD_COORD_PSN_CD     = PSN.PSN_CD(+)
            AND PSN.EZCANCELFLAG(+)      = '0'
            AND SO.GLBL_CMPY_CD          = V.GLBL_CMPY_CD(+)
            AND SO.CARR_CD               = V.VND_CD(+)
            AND V.EZCANCELFLAG(+)        = '0'
            AND V.GLBL_CMPY_CD           = CT.GLBL_CMPY_CD(+)
            AND V.CARR_TP_CD             = CT.CARR_TP_CD(+)
            AND CT.EZCANCELFLAG(+)       = '0'
            AND SO.GLBL_CMPY_CD          = SOCD.GLBL_CMPY_CD
            AND SO.SO_NUM                = SOCD.SO_NUM
            AND SOCD.SO_CUST_DATA_TP_CD  = #soCustDataTpShipTo#
            AND SOCD.EZCANCELFLAG        = '0'
            AND SO.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
            AND SO.WH_CD                 = RW.RTL_WH_CD
            AND RW.EZCANCELFLAG          = '0'
            AND RW.GLBL_CMPY_CD          = WO.GLBL_CMPY_CD
            AND RW.WH_OWNR_CD            = WO.WH_OWNR_CD
            AND WO.EZCANCELFLAG          = '0'
            AND SO.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND SO.TRX_HDR_NUM           = C.CPO_ORD_NUM
            <isNotNull property="cMsg.dsOrdCatgCd">
            AND C.DS_ORD_CATG_CD         = #cMsg.dsOrdCatgCd#
            </isNotNull>
            <isNotNull property="cMsg.dsOrdTpCd">
            AND C.DS_ORD_TP_CD           = #cMsg.dsOrdTpCd#
            </isNotNull>
            AND C.EZCANCELFLAG           = '0'
            AND SO.GLBL_CMPY_CD          = SEL.GLBL_CMPY_CD
            AND SO.SHIP_TO_CUST_ACCT_CD  = SEL.SELL_TO_CUST_CD
            AND SEL.EZCANCELFLAG         = '0'
            AND SO.GLBL_CMPY_CD          = DCII.GLBL_CMPY_CD(+)
            AND SO.TRX_HDR_NUM           = DCII.CPO_ORD_NUM(+)
            AND SO.DS_CPO_CONFIG_PK      = DCII.DS_CPO_CONFIG_PK(+)
            AND DCII.EZCANCELFLAG(+)     = '0'
          <!-- START 2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
            AND DCII.GLBL_CMPY_CD        = SIR.GLBL_CMPY_CD(+)
            AND DCII.SVC_ISTL_RULE_NUM   = SIR.SVC_ISTL_RULE_NUM(+)
            AND SIR.EZCANCELFLAG(+)      = '0'
          <!-- END   2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
            <isNull property="cMsg.t_MdlNm">
            AND SO.GLBL_CMPY_CD          = MN.T_GLBL_CMPY_CD(+)
            AND SO.MDL_ID                = MN.T_MDL_ID(+)
            AND MN.EZCANCELFLAG(+)       = '0'
            </isNull>
            <isNotNull property="cMsg.t_MdlNm">
            AND SO.GLBL_CMPY_CD          = MN.T_GLBL_CMPY_CD
            AND SO.MDL_ID                = MN.T_MDL_ID
            AND MN.T_MDL_NM              = #cMsg.t_MdlNm#
            AND MN.EZCANCELFLAG          = '0'
            </isNotNull>
            AND C.GLBL_CMPY_CD           = DOC.GLBL_CMPY_CD
            AND C.DS_ORD_CATG_CD         = DOC.DS_ORD_CATG_CD
            AND DOC.EZCANCELFLAG         = '0'
            AND C.GLBL_CMPY_CD           = DOT.GLBL_CMPY_CD
            AND C.DS_ORD_TP_CD           = DOT.DS_ORD_TP_CD
            AND DOT.EZCANCELFLAG         = '0'
            AND SO.GLBL_CMPY_CD          = SCM.GLBL_CMPY_CD(+)
            AND SO.SVC_CONFIG_MSTR_PK    = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.EZCANCELFLAG(+)      = '0'
            AND SO.GLBL_CMPY_CD          = STC.GLBL_CMPY_CD
            AND SO.SHIP_TO_CUST_CD       = STC.SHIP_TO_CUST_CD
            AND STC.EZCANCELFLAG         = '0'
            AND STC.GLBL_CMPY_CD         = LT.GLBL_CMPY_CD
            AND STC.LOC_GRP_CD           = LT.LOC_GRP_CD
            AND STC.LOC_ROLE_TP_CD       = LT.LOC_ROLE_TP_CD
            AND LT.EZCANCELFLAG          = '0'
            AND SO.GLBL_CMPY_CD          = SSL.GLBL_CMPY_CD(+)
            AND SO.SHPG_SVC_LVL_CD       = SSL.SHPG_SVC_LVL_CD(+)
            AND SSL.EZCANCELFLAG(+)      = '0'
            AND SO.GLBL_CMPY_CD          = TSR.GLBL_CMPY_CD(+)
            AND SO.TEMP_SCHD_RSN_CD      = TSR.TEMP_SCHD_RSN_CD(+)
            AND TSR.EZCANCELFLAG(+)      = '0'
            <isEqual property="dsShpgOrdDtlConn" compareValue="Y">
            AND EXISTS (SELECT
                            1
                        FROM
                            SHPG_ORD_DTL SOD
                        WHERE
                            SOD.GLBL_CMPY_CD      = SO.GLBL_CMPY_CD
                        AND SOD.SO_NUM            = SO.SO_NUM
                        <isNotNull property="cMsg.dsSoLineStsCd">
                        AND SOD.DS_SO_LINE_STS_CD = #cMsg.dsSoLineStsCd#
                        </isNotNull>
                        <isNotNull property="cMsg.rtlSwhCd">
                        AND SOD.RTL_SWH_CD        = #cMsg.rtlSwhCd#
                        </isNotNull>
                        <isNotNull property="cMsg.actlDelyDt_FR">
                        AND SOD.ACTL_DELY_DT  &gt;= #cMsg.actlDelyDt_FR#
                        </isNotNull>
                        <isNotNull property="cMsg.actlDelyDt_TO">
                        AND SOD.ACTL_DELY_DT  &lt;= #cMsg.actlDelyDt_TO#
                        </isNotNull>
                        AND SOD.EZCANCELFLAG      = '0'
                       )
            </isEqual>
            <isNotNull property="cMsg.bolNum">
            <!-- QC#21913 Modify SHPG_ORD_CONF_DTL => SHPG_ORD_PRO_NUM_LIST -->
            AND EXISTS (SELECT
                            1
                        FROM
                            SHPG_ORD_PRO_NUM_LIST SOPNL
                        WHERE
                            SOPNL.GLBL_CMPY_CD = SO.GLBL_CMPY_CD
                        AND SOPNL.TRX_HDR_NUM  = SO.SO_NUM
                        AND SOPNL.PRO_NUM      = #cMsg.bolNum#
                        AND SOPNL.EZCANCELFLAG = '0'
                       )
            </isNotNull>
            <!-- START 2021/05/31 A.Marte [QC#58786,ADD] -->
            UNION
            SELECT /*+ ORDERED */
                SO.GLBL_CMPY_CD                                  AS GLBL_CMPY_CD
               ,SO.SRC_ORD_NUM                                   AS CPO_ORD_NUM
               ,SO.SVC_CONFIG_MSTR_PK                            AS SHIP_SVC_CONFIG_MSTR_PK
               ,SO.SO_NUM                                        AS SO_NUM
               ,MN.T_MDL_NM                                      AS MDL_NM
               ,SO.RDD_DT                                        AS RDD_DT
               ,SO.SCHD_CARR_PICK_UP_DT                          AS SCHD_CARR_PICK_UP_DT
               ,SO.SCHD_DELY_DT                                  AS SCHD_DELY_DT
               ,SO.SCHD_DELY_TM                                  AS SCHD_DELY_TM
               ,SO.TECH_MEET_TRUCK_FLG                           AS TECH_MEET_TRUCK_FLG
               ,SO.NEXT_ACT_DT                                   AS NEXT_ACT_DT
               ,SO.CARR_CD                                       AS CARR_CD
               ,V.LOC_NM                                         AS CARR_NM
               ,SO.SCHD_ISTL_DT                                  AS SCHD_ISTL_DT
               ,SO.SCHD_ISTL_TM                                  AS SCHD_ISTL_TM
               ,SO.SCHD_DURN_TM_NUM                              AS SCHD_DURN_TM_NUM
               ,SO.SCHD_COORD_STS_CD                             AS SCHD_COORD_STS_CD
               ,SCS.SCHD_COORD_STS_DESC_TXT                      AS SCHD_COORD_STS_DESC_TXT
               ,SCS.MAN_UPD_PRTY_NUM                             AS MAN_UPD_PRTY_NUM
               ,SO.SHIP_TO_CUST_ACCT_CD                          AS DS_ACCT_NUM
               ,SO.SHIP_TO_CUST_CD                               AS SHIP_TO_CUST_CD
               ,CASE WHEN LT.LOC_TP_CD = #locTpCust# THEN NULL
                     ELSE SOCD.SO_CUST_LINE_LOC_NM_01
                END                                              AS SHIP_TO_CUST_NM
               ,SOCD.SO_CUST_LINE_ADDR_01                        AS SO_CUST_LINE_ADDR_01
               ,SOCD.SO_CUST_LINE_ADDR_02                        AS SO_CUST_LINE_ADDR_02
               ,SOCD.CTY_ADDR                                    AS CTY_ADDR
               ,SOCD.ST_CD                                       AS ST_CD
               ,SOCD.POST_CD                                     AS POST_CD
               ,SOCD.CTRY_CD                                     AS CTRY_CD
               ,RW.RTL_WH_CD                                     AS RTL_WH_CD
               ,RW.RTL_WH_NM                                     AS RTL_WH_NM
               ,SO.WMS_DROP_FLG                                  AS WMS_DROP_FLG
               ,SO.WMS_DROP_RQST_FLG                             AS WMS_DROP_READY_FLG
               ,CASE WHEN SO.DELY_REQ_FLG = #flgY#   THEN #flgY#
                     WHEN SO.DELY_REQ_TS IS NOT NULL THEN #flgY#
                     ELSE #flgN#
                END                                              AS SEND_RQST_FLG
               ,SO.SHPG_SVC_LVL_CD                               AS SHPG_SVC_LVL_CD
               ,SSL.SHPG_SVC_LVL_DESC_TXT                        AS SHPG_SVC_LVL_DESC_TXT
               ,SO.CARR_ACCT_NUM                                 AS CARR_ACCT_NUM
               ,TRIM(PSN.PSN_FIRST_NM || ' ' || PSN.PSN_LAST_NM) AS SCHD_COORD_PSN_NM
               ,SO.TEMP_SCHD_RSN_CD                              AS TEMP_SCHD_RSN_CD
               ,TSR.TEMP_SCHD_RSN_DESC_TXT                       AS TEMP_SCHD_RSN_DESC_TXT
               ,SO.TEMP_SCHD_CMNT_TXT                            AS TEMP_SCHD_CMNT_TXT
               ,SO.PDD_DT                                        AS PDD_DT
               ,NULL                                             AS DS_ORD_CATG_DESC_TXT
               ,NULL                                             AS DS_ORD_TP_DESC_TXT
               ,CASE WHEN SS.SO_PRINT_FLG = #flgY# AND SS.SHIP_FLG = #flgN# THEN #flgY#
                     ELSE #flgN#
                END                                              AS ORD_OPEN_FLG
               ,SCS.SCHD_OPEN_FLG                                AS SCHD_OPEN_FLG
               ,WO.MAN_SEND_RQST_FLG                             AS WH_MAN_SEND_RQST_FLG
               ,CT.MAN_SEND_RQST_FLG                             AS CARR_MAN_SEND_RQST_FLG
               ,SCM.SVC_MACH_MSTR_PK                             AS SVC_MACH_MSTR_PK
               ,SO.DS_CPO_CONFIG_PK                              AS DS_CPO_CONFIG_PK
               ,SO.EZUPTIME                                      AS EZUPTIME_SO
               ,SO.EZUPTIMEZONE                                  AS EZUPTIMEZONE_SO
               ,ROW_NUMBER() OVER(PARTITION BY SO.GLBL_CMPY_CD ORDER BY SO.SRC_ORD_NUM, SO.SO_NUM) AS ROW_NUM
               ,NULL                                             AS XX_PSN_FIRST_MID_LAST_NM
               ,0                                                AS SPLY_ORD_FLG
               ,SO.SCE_ORD_TP_CD                                 AS SCE_ORD_TP_CD
            FROM
                SHPG_ORD          SO
               ,SHPG_STS          SS
               ,SCHD_COORD_STS    SCS
               ,S21_PSN           PSN
               ,VND               V
               ,CARR_TP           CT
               ,SHPG_ORD_CUST_DTL SOCD
               ,RTL_WH            RW
               ,WH_OWNR           WO
               ,PRCH_REQ          PR
               ,MDL_NM            MN
               ,SVC_CONFIG_MSTR   SCM
               ,SHIP_TO_CUST      STC
               ,LOC_TP            LT
               ,SHPG_SVC_LVL      SSL
               ,TEMP_SCHD_RSN     TSR
            WHERE
                SO.GLBL_CMPY_CD          = #glblCmpyCd#
            <isNotNull property="cMsg.soNum">
            AND SO.SO_NUM                = #cMsg.soNum#
            </isNotNull>
            <isNotNull property="soNumList">
                <iterate property="soNumList" var="soNumList[]" open="AND SO.SO_NUM IN (" conjunction= ", " close=")">
                    #soNumList[]#
                </iterate>
            </isNotNull>
            <isNotNull property="includeSceOrdTpList">
                <iterate property="includeSceOrdTpList" var="includeSceOrdTpList[]" open="AND SO.SCE_ORD_TP_CD IN (" conjunction= ", " close=")">
                    #includeSceOrdTpList[]#
                </iterate>
            </isNotNull>
            <isNotNull property="cMsg.rtlWhCd">
            AND SO.WH_CD                 = #cMsg.rtlWhCd#
            </isNotNull>
            <isNotNull property="cMsg.trxHdrNum">
            AND SO.SRC_ORD_NUM           = #cMsg.trxHdrNum#
            </isNotNull>
            <isNotNull property="cMsg.shipToCustCd">
            AND SO.SHIP_TO_CUST_CD       = #cMsg.shipToCustCd#
            </isNotNull>
            <isNotNull property="cMsg.rddDt_FR">
            AND SO.RDD_DT            &gt;= #cMsg.rddDt_FR#
            </isNotNull>
            <isNotNull property="cMsg.rddDt_TO">
            AND SO.RDD_DT            &lt;= #cMsg.rddDt_TO#
            </isNotNull>
            <isNotNull property="cMsg.wmsDropFlg_Y">
                <isNull property="cMsg.wmsDropFlg_N">
                AND SO.WMS_DROP_FLG      = #flgY#
                </isNull>
            </isNotNull>
            <isNotNull property="cMsg.wmsDropFlg_N">
                <isNull property="cMsg.wmsDropFlg_Y">
                AND SO.WMS_DROP_FLG      = #flgN#
                </isNull>
            </isNotNull>
            <isNotNull property="cMsg.svcConfigMstrPk">
            AND SO.SVC_CONFIG_MSTR_PK    = #cMsg.svcConfigMstrPk#
            </isNotNull>
            <isNotNull property="cMsg.delyReqFlg_Y">
                <isNull property="cMsg.delyReqFlg_N">
                AND (   SO.DELY_REQ_FLG  = #flgY#
                     OR (SO.DELY_REQ_FLG  = #flgN# AND SO.DELY_REQ_TS   IS NOT NULL)
                    )
                </isNull>
            </isNotNull>
            <isNotNull property="cMsg.delyReqFlg_N">
                <isNull property="cMsg.delyReqFlg_Y">
                AND (   SO.DELY_REQ_FLG  = #flgN#
                     AND SO.DELY_REQ_TS   IS NULL
                    )
                </isNull>
            </isNotNull>
            AND SO.EZCANCELFLAG          = '0'
            AND SO.GLBL_CMPY_CD          = SS.GLBL_CMPY_CD
            AND SO.SHPG_STS_CD           = SS.SHPG_STS_CD
            AND SS.EZCANCELFLAG          = '0'
            <isNotNull property="cMsg.shpgSvcLvlCd">
            AND SO.SHPG_SVC_LVL_CD       = #cMsg.shpgSvcLvlCd#
            </isNotNull>
            <isNotNull property="cMsg.schdCoordStsCd">
            AND SO.SCHD_COORD_STS_CD     = #cMsg.schdCoordStsCd#
            </isNotNull>
            <isNotNull property="cMsg.carrCd">
            AND SO.CARR_CD               = #cMsg.carrCd#
            </isNotNull>
            <isNotNull property="cMsg.schdCoordPsnCd">
            AND SO.SCHD_COORD_PSN_CD     = #cMsg.schdCoordPsnCd#
            </isNotNull>
            <isNotNull property="cMsg.schdDelyDt_FR">
            AND SO.SCHD_DELY_DT          &gt;= #cMsg.schdDelyDt_FR#
            </isNotNull>
            <isNotNull property="cMsg.schdDelyDt_TO">
            AND SO.SCHD_DELY_DT          &lt;= #cMsg.schdDelyDt_TO#
            </isNotNull>
            <isNotNull property="cMsg.schdCarrPickUpDt_FR">
            AND SO.SCHD_CARR_PICK_UP_DT  &gt;= #cMsg.schdCarrPickUpDt_FR#
            </isNotNull>
            <isNotNull property="cMsg.schdCarrPickUpDt_TO">
            AND SO.SCHD_CARR_PICK_UP_DT  &lt;= #cMsg.schdCarrPickUpDt_TO#
            </isNotNull>
            AND SO.GLBL_CMPY_CD          = SCS.GLBL_CMPY_CD
            AND SO.SCHD_COORD_STS_CD     = SCS.SCHD_COORD_STS_CD
            AND SCS.EZCANCELFLAG         = '0'
            AND SO.GLBL_CMPY_CD          = PSN.GLBL_CMPY_CD(+)
            AND SO.SCHD_COORD_PSN_CD     = PSN.PSN_CD(+)
            AND PSN.EZCANCELFLAG(+)      = '0'
            AND SO.GLBL_CMPY_CD          = V.GLBL_CMPY_CD(+)
            AND SO.CARR_CD               = V.VND_CD(+)
            AND V.EZCANCELFLAG(+)        = '0'
            AND V.GLBL_CMPY_CD           = CT.GLBL_CMPY_CD(+)
            AND V.CARR_TP_CD             = CT.CARR_TP_CD(+)
            AND CT.EZCANCELFLAG(+)       = '0'
            AND SO.GLBL_CMPY_CD          = SOCD.GLBL_CMPY_CD
            AND SO.SO_NUM                = SOCD.SO_NUM
            AND SOCD.SO_CUST_DATA_TP_CD  = #soCustDataTpShipTo#
            AND SOCD.EZCANCELFLAG        = '0'
            AND SO.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
            AND SO.WH_CD                 = RW.RTL_WH_CD
            AND RW.EZCANCELFLAG          = '0'
            AND RW.GLBL_CMPY_CD          = WO.GLBL_CMPY_CD
            AND RW.WH_OWNR_CD            = WO.WH_OWNR_CD
            AND WO.EZCANCELFLAG          = '0'
            AND SO.GLBL_CMPY_CD          = PR.GLBL_CMPY_CD
            AND SO.SRC_ORD_NUM           = PR.PRCH_REQ_NUM
            AND PR.EZCANCELFLAG          = '0'
            <isNull property="cMsg.t_MdlNm">
            AND SO.GLBL_CMPY_CD          = MN.T_GLBL_CMPY_CD(+)
            AND SO.MDL_ID                = MN.T_MDL_ID(+)
            </isNull>
            <isNotNull property="cMsg.t_MdlNm">
            AND SO.GLBL_CMPY_CD          = MN.T_GLBL_CMPY_CD
            AND SO.MDL_ID                = MN.T_MDL_ID
            AND MN.T_MDL_NM              = #cMsg.t_MdlNm#
            </isNotNull>
            AND MN.EZCANCELFLAG(+)       = '0'
            AND SO.GLBL_CMPY_CD          = SCM.GLBL_CMPY_CD(+)
            AND SO.SVC_CONFIG_MSTR_PK    = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.EZCANCELFLAG(+)      = '0'
            AND SO.GLBL_CMPY_CD          = STC.GLBL_CMPY_CD
            AND SO.SHIP_TO_CUST_CD       = STC.SHIP_TO_CUST_CD
            AND STC.EZCANCELFLAG         = '0'
            AND STC.GLBL_CMPY_CD         = LT.GLBL_CMPY_CD
            AND STC.LOC_GRP_CD           = LT.LOC_GRP_CD
            AND STC.LOC_ROLE_TP_CD       = LT.LOC_ROLE_TP_CD
            AND LT.EZCANCELFLAG          = '0'
            AND SO.GLBL_CMPY_CD          = SSL.GLBL_CMPY_CD(+)
            AND SO.SHPG_SVC_LVL_CD       = SSL.SHPG_SVC_LVL_CD(+)
            AND SSL.EZCANCELFLAG(+)      = '0'
            AND SO.GLBL_CMPY_CD          = TSR.GLBL_CMPY_CD(+)
            AND SO.TEMP_SCHD_RSN_CD      = TSR.TEMP_SCHD_RSN_CD(+)
            AND TSR.EZCANCELFLAG(+)      = '0'
            <isEqual property="dsShpgOrdDtlConn" compareValue="Y">
            AND EXISTS (SELECT
                            1
                        FROM
                            SHPG_ORD_DTL SOD
                        WHERE
                            SOD.GLBL_CMPY_CD      = SO.GLBL_CMPY_CD
                        AND SOD.SO_NUM            = SO.SO_NUM
                        <isNotNull property="cMsg.dsSoLineStsCd">
                        AND SOD.DS_SO_LINE_STS_CD = #cMsg.dsSoLineStsCd#
                        </isNotNull>
                        <isNotNull property="cMsg.rtlSwhCd">
                        AND SOD.RTL_SWH_CD        = #cMsg.rtlSwhCd#
                        </isNotNull>
                        <isNotNull property="cMsg.actlDelyDt_FR">
                        AND SOD.ACTL_DELY_DT  &gt;= #cMsg.actlDelyDt_FR#
                        </isNotNull>
                        <isNotNull property="cMsg.actlDelyDt_TO">
                        AND SOD.ACTL_DELY_DT  &lt;= #cMsg.actlDelyDt_TO#
                        </isNotNull>
                        AND SOD.EZCANCELFLAG      = '0'
                       )
            </isEqual>
            <isNotNull property="cMsg.bolNum">
            AND EXISTS (SELECT
                            1
                        FROM
                            SHPG_ORD_PRO_NUM_LIST SOPNL
                        WHERE
                            SOPNL.GLBL_CMPY_CD = SO.GLBL_CMPY_CD
                        AND SOPNL.TRX_HDR_NUM  = SO.SO_NUM
                        AND SOPNL.PRO_NUM      = #cMsg.bolNum#
                        AND SOPNL.EZCANCELFLAG = '0'
                       )
            </isNotNull>
            <!-- END 2021/05/31 A.Marte [QC#58786,ADD] -->
        ), CPO_DTL_V AS (
            SELECT
                SV.GLBL_CMPY_CD
               ,SV.SO_NUM
               ,CD.CARR_CD AS ORD_CARR_CD
               ,TC.TOC_NM
               ,ROW_NUMBER() OVER(PARTITION BY SV.SO_NUM ORDER BY CD.CPO_DTL_LINE_NUM, CD.CPO_DTL_LINE_SUB_NUM) AS ROW_NUM
            FROM
                SCHD_V  SV
               ,CPO_DTL CD
               ,TOC     TC
            WHERE
                SV.GLBL_CMPY_CD               = CD.GLBL_CMPY_CD
            AND SV.CPO_ORD_NUM                = CD.CPO_ORD_NUM
            AND CD.EZCANCELFLAG               = '0'
            AND CD.GLBL_CMPY_CD               = TC.GLBL_CMPY_CD(+)
            AND CD.SLS_REP_OR_SLS_TEAM_TOC_CD = TC.TOC_CD(+)
            AND TC.EZCANCELFLAG(+)            = '0'
        <!-- START 2021/05/31 A.Marte [QC#58786,ADD] -->
        ), PRCH_REQ_DTL_V AS (
            SELECT
                SV.GLBL_CMPY_CD
               ,SV.SO_NUM
               ,PRD.CARR_CD AS ORD_CARR_CD
               ,ROW_NUMBER() OVER(PARTITION BY SV.SO_NUM ORDER BY PRD.PRCH_REQ_LINE_NUM, PRD.PRCH_REQ_LINE_SUB_NUM) AS ROW_NUM
            FROM
                SCHD_V       SV
               ,PRCH_REQ_DTL PRD
            WHERE
                SV.GLBL_CMPY_CD               = PRD.GLBL_CMPY_CD
            AND SV.CPO_ORD_NUM                = PRD.PRCH_REQ_NUM
            AND PRD.EZCANCELFLAG               = '0'
        <!-- END 2021/05/31 A.Marte [QC#58786,ADD] -->
        ), FSR_V AS (
            SELECT
                SV.GLBL_CMPY_CD
               ,SV.SO_NUM
               ,SVT.SVC_RPR_TM_NUM
               ,SVT.FSR_NUM
               ,SVT.SVC_TASK_SCHD_DT
               ,TM.TECH_NM
               ,ROW_NUMBER() OVER(PARTITION BY SV.SO_NUM ORDER BY SVT.SVC_TASK_RCV_DT DESC, SVT.SVC_TASK_RCV_TM DESC) AS ROW_NUM
            FROM
                SCHD_V    SV
               ,SVC_TASK  SVT
               ,TECH_MSTR TM
            WHERE
                SV.GLBL_CMPY_CD       = SVT.GLBL_CMPY_CD
            AND SV.SO_NUM             = SVT.SO_NUM
            AND SV.SVC_MACH_MSTR_PK   = SVT.SVC_MACH_MSTR_PK
            AND SVT.DS_SVC_CALL_TP_CD = #dsSvcCallTpInstl#
            AND SVT.SVC_TASK_STS_CD &lt;&gt; #svcTaskStsCancel#
            AND SVT.EZCANCELFLAG      = '0'
            AND SVT.GLBL_CMPY_CD      = TM.GLBL_CMPY_CD(+)
            AND SVT.TECH_CD           = TM.TECH_TOC_CD(+)
            AND TM.EZCANCELFLAG(+)    = '0'
        ), CTAC_PSN_V AS (
            SELECT
                SV.GLBL_CMPY_CD
               ,SV.SO_NUM
               ,NVL(CTA1.XX_PSN_FIRST_MID_LAST_NM_CTAC, CTA2.XX_PSN_FIRST_MID_LAST_NM_CTAC) AS XX_PSN_FIRST_MID_LAST_NM_CTAC
               ,NVL(CTA1.CTAC_PSN_TEL_NUM, CTA2.CTAC_PSN_TEL_NUM) AS CTAC_PSN_TEL_NUM
               ,ROW_NUMBER() OVER(PARTITION BY SV.SO_NUM ORDER BY NVL(CTA1.CTAC_PSN_SORT_NUM, CTA2.CTAC_PSN_SORT_NUM)) AS ROW_NUM
            FROM
                SCHD_V          SV
               ,(
                    SELECT
                        A.GLBL_CMPY_CD      AS GLBL_CMPY_CD
                       ,A.CPO_ORD_NUM       AS CPO_ORD_NUM
                       ,A.DS_CPO_CONFIG_PK  AS DS_CPO_CONFIG_PK
                       ,A.CTAC_PSN_TEL_NUM  AS CTAC_PSN_TEL_NUM
                       ,A.CTAC_PSN_SORT_NUM AS CTAC_PSN_SORT_NUM
                       ,A.CTAC_PSN_FIRST_NM || ' ' || A.CTAC_PSN_LAST_NM AS XX_PSN_FIRST_MID_LAST_NM_CTAC
                    FROM
                        DS_CPO_CTAC_PSN A
                       ,(
                           SELECT
                               GLBL_CMPY_CD            AS GLBL_CMPY_CD
                              ,CPO_ORD_NUM             AS CPO_ORD_NUM
                              ,DS_CPO_CONFIG_PK        AS DS_CPO_CONFIG_PK
                              ,MIN(DS_CPO_CTAC_PSN_PK) AS DS_CPO_CTAC_PSN_PK
                           FROM
                               DS_CPO_CTAC_PSN
                           WHERE
                               GLBL_CMPY_CD    = #glblCmpyCd#
                           AND CTAC_PSN_TP_CD IN (#ctacPsnTpDelivIns#, #ctacPsnTpOrdCtac#)
                           AND EZCANCELFLAG    = '0'
                           GROUP BY
                               GLBL_CMPY_CD
                              ,CPO_ORD_NUM
                              ,DS_CPO_CONFIG_PK
                        ) B
                     WHERE
                         A.GLBL_CMPY_CD       = #glblCmpyCd#
                     AND A.EZCANCELFLAG       = '0'
                     AND B.GLBL_CMPY_CD       = A.GLBL_CMPY_CD
                     AND B.DS_CPO_CTAC_PSN_PK = A.DS_CPO_CTAC_PSN_PK
                ) CTA1
               ,(
                    SELECT
                        A.GLBL_CMPY_CD      AS GLBL_CMPY_CD
                       ,A.CPO_ORD_NUM       AS CPO_ORD_NUM
                       ,A.DS_CPO_CONFIG_PK  AS DS_CPO_CONFIG_PK
                       ,A.CTAC_PSN_TEL_NUM  AS CTAC_PSN_TEL_NUM
                       ,A.CTAC_PSN_SORT_NUM AS CTAC_PSN_SORT_NUM
                       ,A.CTAC_PSN_FIRST_NM || ' ' || A.CTAC_PSN_LAST_NM AS XX_PSN_FIRST_MID_LAST_NM_CTAC
                    FROM
                        DS_CPO_CTAC_PSN A
                       ,(
                           SELECT
                               GLBL_CMPY_CD            AS GLBL_CMPY_CD
                              ,CPO_ORD_NUM             AS CPO_ORD_NUM
                              ,DS_CPO_CONFIG_PK        AS DS_CPO_CONFIG_PK
                              ,MIN(DS_CPO_CTAC_PSN_PK) AS DS_CPO_CTAC_PSN_PK
                           FROM
                               DS_CPO_CTAC_PSN
                           WHERE
                               GLBL_CMPY_CD    = #glblCmpyCd#
                           AND CTAC_PSN_TP_CD IN (#ctacPsnTpDelivIns#, #ctacPsnTpOrdCtac#)
                           AND EZCANCELFLAG    = '0'
                           GROUP BY
                               GLBL_CMPY_CD
                              ,CPO_ORD_NUM
                              ,DS_CPO_CONFIG_PK
                        ) B
                     WHERE
                         A.GLBL_CMPY_CD       = #glblCmpyCd#
                     AND A.EZCANCELFLAG       = '0'
                     AND B.GLBL_CMPY_CD       = A.GLBL_CMPY_CD
                     AND B.DS_CPO_CTAC_PSN_PK = A.DS_CPO_CTAC_PSN_PK
                     AND A.DS_CPO_CONFIG_PK  IS NULL
                ) CTA2
            WHERE
            <!-- START 2017/10/16 S.Katsuma [Sol#454,ADD] -->
                SV.GLBL_CMPY_CD     = CTA1.GLBL_CMPY_CD(+)
            AND SV.CPO_ORD_NUM      = CTA1.CPO_ORD_NUM(+)
            AND SV.DS_CPO_CONFIG_PK = CTA1.DS_CPO_CONFIG_PK(+)
            AND SV.GLBL_CMPY_CD     = CTA2.GLBL_CMPY_CD(+)
            AND SV.CPO_ORD_NUM      = CTA2.CPO_ORD_NUM(+)
            <!--AND DCP.CTAC_PSN_TP_CD  = #ctacPsnTpShipTo#]
            AND DCP.EZCANCELFLAG    = '0' -->
            <!-- END 2017/10/16 S.Katsuma [Sol#454,ADD] -->
        ), CRTCL_BO_V AS (
            SELECT /*+ ORDERED */ DISTINCT
                SV.GLBL_CMPY_CD
               ,SV.SO_NUM
               ,#boImpctTpCrtcl# AS BACK_ORD_IMPCT_TP_CD
            FROM
                SCHD_V SV
               ,(
                    SELECT
                         CD.GLBL_CMPY_CD
                        ,CD.DS_CPO_CONFIG_PK
                    FROM
                         CPO_DTL      CD
                        ,SHPG_PLN     SP
                        ,(
                            SELECT
                                 M.EZCANCELFLAG
                                ,M.GLBL_CMPY_CD
                                ,M.MDSE_CD
                                ,M.BACK_ORD_IMPCT_TP_CD
                            FROM
                                 MDSE M
                            WHERE 
                                M.EZCANCELFLAG      = '0'
                            UNION ALL
                            SELECT
                                 M.EZCANCELFLAG
                                ,M.GLBL_CMPY_CD
                                ,OTM.ORD_TAKE_MDSE_CD
                                ,M.BACK_ORD_IMPCT_TP_CD
                            FROM
                                 MDSE M
                                ,ORD_TAKE_MDSE OTM
                            WHERE M.MDSE_CD         = OTM.MDSE_CD
                            AND M.GLBL_CMPY_CD      = OTM.GLBL_CMPY_CD
                            AND M.EZCANCELFLAG      = '0'
                            AND OTM.EZCANCELFLAG    = '0'
                        ) AMV
                        WHERE
                            CD.GLBL_CMPY_CD          = #glblCmpyCd#
                        AND CD.EZCANCELFLAG          = '0'
                        AND CD.GLBL_CMPY_CD          = SP.GLBL_CMPY_CD
                        AND CD.CPO_ORD_NUM           = SP.TRX_HDR_NUM
                        AND CD.CPO_DTL_LINE_NUM      = SP.TRX_LINE_NUM
                        AND CD.CPO_DTL_LINE_SUB_NUM  = SP.TRX_LINE_SUB_NUM
                        AND SP.SHPG_STS_CD           = #shpgStsCdValid#
                        AND SP.EZCANCELFLAG          = '0'
                        AND SP.GLBL_CMPY_CD          = AMV.GLBL_CMPY_CD
                        AND SP.MDSE_CD               = AMV.MDSE_CD
                        AND AMV.BACK_ORD_IMPCT_TP_CD = #boImpctTpCrtcl#
                        AND AMV.EZCANCELFLAG         = '0'
                ) AMV
            WHERE
                SV.DS_CPO_CONFIG_PK = AMV.DS_CPO_CONFIG_PK
        ), ESSTL_BO_V AS (
            SELECT /*+ ORDERED */ DISTINCT
                SV.GLBL_CMPY_CD
               ,SV.SO_NUM
               ,#boImpctTpEsstl# AS BACK_ORD_IMPCT_TP_CD
            FROM
                 SCHD_V SV
                ,(
                    SELECT
                         CD.GLBL_CMPY_CD
                        ,CD.DS_CPO_CONFIG_PK
                    FROM
                         CPO_DTL      CD
                        ,SHPG_PLN     SP
                        ,(
                            SELECT
                                 M.EZCANCELFLAG
                                ,M.GLBL_CMPY_CD
                                ,M.MDSE_CD
                                ,M.BACK_ORD_IMPCT_TP_CD
                            FROM
                                 MDSE M
                            WHERE 
                                M.EZCANCELFLAG      = '0'
                            UNION ALL
                            SELECT
                                 M.EZCANCELFLAG
                                ,M.GLBL_CMPY_CD
                                ,OTM.ORD_TAKE_MDSE_CD
                                ,M.BACK_ORD_IMPCT_TP_CD
                            FROM
                                 MDSE M
                                ,ORD_TAKE_MDSE OTM
                            WHERE M.MDSE_CD         = OTM.MDSE_CD
                            AND M.GLBL_CMPY_CD      = OTM.GLBL_CMPY_CD
                            AND M.EZCANCELFLAG      = '0'
                            AND OTM.EZCANCELFLAG    = '0'
                        ) AMV
                        WHERE
                            CD.GLBL_CMPY_CD          = #glblCmpyCd#
                        AND CD.EZCANCELFLAG          = '0'
                        AND CD.GLBL_CMPY_CD          = SP.GLBL_CMPY_CD
                        AND CD.CPO_ORD_NUM           = SP.TRX_HDR_NUM
                        AND CD.CPO_DTL_LINE_NUM      = SP.TRX_LINE_NUM
                        AND CD.CPO_DTL_LINE_SUB_NUM  = SP.TRX_LINE_SUB_NUM
                        AND SP.SHPG_STS_CD           = #shpgStsCdValid#
                        AND SP.EZCANCELFLAG          = '0'
                        AND SP.GLBL_CMPY_CD          = AMV.GLBL_CMPY_CD
                        AND SP.MDSE_CD               = AMV.MDSE_CD
                        AND AMV.BACK_ORD_IMPCT_TP_CD = #boImpctTpEsstl#
                        AND AMV.EZCANCELFLAG         = '0'
                ) AMV
            WHERE
                SV.DS_CPO_CONFIG_PK = AMV.DS_CPO_CONFIG_PK
        )
        SELECT /*+ ORDERED */
            SV.GLBL_CMPY_CD
           ,SV.CPO_ORD_NUM
           ,SV.SHIP_SVC_CONFIG_MSTR_PK
           ,NVL(BOC.BACK_ORD_IMPCT_TP_DESC_TXT, BOE.BACK_ORD_IMPCT_TP_DESC_TXT) AS BACK_ORD_IMPCT_TP_DESC_TXT
           ,SV.SO_NUM
           ,SV.MDL_NM
           ,SV.RDD_DT
           ,SV.SCHD_CARR_PICK_UP_DT
           ,SV.SCHD_DELY_DT
           ,SV.SCHD_DELY_TM
           <!-- SCHD_DELY_DT_TM -->
           <!-- ,CASE WHEN SV.SCHD_DELY_DT IS NOT NULL  AND SV.SCHD_DELY_TM  IS NOT NULL THEN TO_CHAR(TO_DATE(SV.SCHD_DELY_DT || SV.SCHD_ISTL_TM, 'YYYYMMDDHH24MISS'), 'MM/DD/YYYY HH24:MISS')
                 WHEN SV.SCHD_DELY_DT IS NOT NULL  AND SV.SCHD_DELY_TM  IS NULL     THEN TO_CHAR(TO_DATE(SV.SCHD_DELY_DT, 'YYYYMMDD'), 'MM/DD/YYYY')
                 WHEN SV.SCHD_DELY_DT IS NULL      AND SV.SCHD_DELY_TM  IS NOT NULL THEN TO_CHAR(TO_DATE(SV.SCHD_DELY_TM, 'HH24MISS'), 'HH24:MISS')
            END  AS SCHD_DELY_DT_TM
           -->
            ,CASE WHEN SV.SCHD_DELY_DT IS NOT NULL AND LENGTH(SV.SCHD_DELY_TM) >= 4 THEN TO_CHAR(TO_DATE(SV.SCHD_DELY_DT || SUBSTR(SV.SCHD_DELY_TM,1,4), 'YYYYMMDDHH24MI'), 'MM/DD/YYYY HH24:MI:SS')
                 WHEN SV.SCHD_DELY_DT IS NOT NULL AND SV.SCHD_DELY_TM IS NULL THEN TO_CHAR(TO_DATE(SV.SCHD_DELY_DT, 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS SCHD_DELY_DT_TM
           <!-- START 2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
           ,SV.TECH_MEET_TRUCK_FLG
           <!-- END   2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
           <!-- START 2017/09/07 S.Katsuma [Sol#032(QC#13117),ADD] -->
           ,SV.NEXT_ACT_DT
           <!-- END 2017/09/07 S.Katsuma [Sol#032(QC#13117),ADD] -->
           ,SV.CARR_CD
           ,SV.CARR_NM
           ,CASE WHEN SV.SCHD_ISTL_DT IS NOT NULL THEN SV.SCHD_ISTL_DT
                 WHEN SV.SCHD_ISTL_TM IS NOT NULL THEN SV.SCHD_ISTL_DT
            END  AS SCHD_ISTL_DT
           ,CASE WHEN SV.SCHD_ISTL_TM IS NOT NULL THEN SV.SCHD_ISTL_TM
                 WHEN SV.SCHD_ISTL_DT IS NOT NULL THEN SV.SCHD_ISTL_TM
            END  AS SCHD_ISTL_TM
           ,CASE WHEN SV.SCHD_ISTL_DT IS NOT NULL  AND SV.SCHD_ISTL_TM  IS NOT NULL THEN TO_CHAR(TO_DATE(SV.SCHD_ISTL_DT || SV.SCHD_ISTL_TM, 'YYYYMMDDHH24MI'), 'MM/DD/YYYY HH24:MI')
                 WHEN SV.SCHD_ISTL_DT IS NOT NULL  AND SV.SCHD_ISTL_TM  IS NULL     THEN TO_CHAR(TO_DATE(SV.SCHD_ISTL_DT, 'YYYYMMDD'), 'MM/DD/YYYY')
                 WHEN SV.SCHD_ISTL_DT IS NULL      AND SV.SCHD_ISTL_TM  IS NOT NULL THEN TO_CHAR(TO_DATE(SV.SCHD_ISTL_TM, 'HH24MI'), 'HH24:MI')
            END  AS TIME_STOP
           ,CASE WHEN SV.SCHD_ISTL_DT IS NOT NULL THEN TO_CHAR(TO_DATE(SV.SCHD_ISTL_DT, 'YYYYMMDD'), 'MM/DD/YYYY')
            END  AS TIME_STOP_DT
           ,CASE WHEN SV.SCHD_ISTL_TM IS NOT NULL THEN TO_CHAR(TO_DATE(SV.SCHD_ISTL_TM, 'HH24MI'), 'HH24:MI')
            END  AS TIME_STOP_TM
           ,NVL(FV.SVC_RPR_TM_NUM, SV.SCHD_DURN_TM_NUM) AS SCHD_DURN_TM_NUM
           ,FV.FSR_NUM
           ,FV.SVC_TASK_SCHD_DT
           ,FV.TECH_NM
           ,SV.SCHD_COORD_STS_CD
           ,SV.SCHD_COORD_STS_DESC_TXT
           ,SV.MAN_UPD_PRTY_NUM
           <!-- START 2017/10/16 S.Katsuma [Sol#454,ADD] -->
           <!--,CPV.XX_PSN_FIRST_MID_LAST_NM -->
           ,DECODE(SV.SPLY_ORD_FLG, 0, CPV.XX_PSN_FIRST_MID_LAST_NM_CTAC, SV.XX_PSN_FIRST_MID_LAST_NM) AS XX_PSN_FIRST_MID_LAST_NM
           <!-- END 2017/10/16 S.Katsuma [Sol#454,ADD] -->
           ,CDV.TOC_NM
           ,CPV.CTAC_PSN_TEL_NUM
           ,SV.DS_ACCT_NUM
           ,SV.SHIP_TO_CUST_NM
           ,SV.SO_CUST_LINE_ADDR_01
           ,SV.SO_CUST_LINE_ADDR_02
           ,SV.CTY_ADDR
           ,SV.ST_CD
           ,SV.POST_CD
            <!-- START 2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
           ,SV.CTRY_CD
            <!-- END   2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
           ,SV.RTL_WH_CD
           ,SV.RTL_WH_NM
           ,SV.WMS_DROP_FLG
           ,SV.WMS_DROP_READY_FLG
           ,SV.SEND_RQST_FLG
           ,SV.SHPG_SVC_LVL_CD
           ,SV.CARR_ACCT_NUM
           ,SV.SCHD_COORD_PSN_NM
           ,SV.TEMP_SCHD_RSN_CD
           ,SV.TEMP_SCHD_CMNT_TXT
           ,SV.PDD_DT
           ,SV.DS_ORD_CATG_DESC_TXT
           ,SV.DS_ORD_TP_DESC_TXT
           ,SV.ORD_OPEN_FLG
           ,SV.SCHD_OPEN_FLG
           ,SV.WH_MAN_SEND_RQST_FLG
           ,SV.CARR_MAN_SEND_RQST_FLG
           <!-- START 2021/05/31 A.Marte [QC#58786,MOD] -->
           ,NVL(CDV.ORD_CARR_CD, PRDV.ORD_CARR_CD)  AS ORD_CARR_CD
            <!-- END 2021/05/31 A.Marte [QC#58786,MOD] -->
           ,SV.SHPG_SVC_LVL_DESC_TXT
           ,SV.TEMP_SCHD_RSN_DESC_TXT
           ,SV.EZUPTIME_SO
           ,SV.EZUPTIMEZONE_SO
           <!-- START 2021/05/31 A.Marte [QC#58786,ADD] -->
           ,SV.SCE_ORD_TP_CD
           <!-- END 2021/05/31 A.Marte [QC#58786,ADD] -->
        FROM
            SCHD_V            SV
           ,CPO_DTL_V         CDV
           <!-- START 2021/05/31 A.Marte [QC#58786,ADD] -->
           ,PRCH_REQ_DTL_V    PRDV
           <!-- END 2021/05/31 A.Marte [QC#58786,ADD] -->
           ,FSR_V             FV
           ,CTAC_PSN_V        CPV
           ,CRTCL_BO_V        CBV
           ,BACK_ORD_IMPCT_TP BOC
           ,ESSTL_BO_V        EBV
           ,BACK_ORD_IMPCT_TP BOE
        WHERE
            SV.GLBL_CMPY_CD          = CDV.GLBL_CMPY_CD(+)
        AND SV.SO_NUM                = CDV.SO_NUM(+)
        AND CDV.ROW_NUM(+)           = 1
        AND SV.GLBL_CMPY_CD          = FV.GLBL_CMPY_CD(+)
        AND SV.SO_NUM                = FV.SO_NUM(+)
        AND FV.ROW_NUM(+)            = 1
        AND SV.GLBL_CMPY_CD          = CPV.GLBL_CMPY_CD(+)
        AND SV.SO_NUM                = CPV.SO_NUM(+)
        AND CPV.ROW_NUM(+)           = 1
        <!-- START 2021/05/31 A.Marte [QC#58786,ADD] -->
        AND SV.GLBL_CMPY_CD          = PRDV.GLBL_CMPY_CD(+)
        AND SV.SO_NUM                = PRDV.SO_NUM(+)
        AND PRDV.ROW_NUM(+)           = 1
        <!-- END 2021/05/31 A.Marte [QC#58786,ADD] -->
        AND SV.GLBL_CMPY_CD          = CBV.GLBL_CMPY_CD(+)
        AND SV.SO_NUM                = CBV.SO_NUM(+)
        AND CBV.GLBL_CMPY_CD         = BOC.GLBL_CMPY_CD(+)
        AND CBV.BACK_ORD_IMPCT_TP_CD = BOC.BACK_ORD_IMPCT_TP_CD(+)
        AND BOC.EZCANCELFLAG(+)      = '0'
        AND SV.GLBL_CMPY_CD          = EBV.GLBL_CMPY_CD(+)
        AND SV.SO_NUM                = EBV.SO_NUM(+)
        AND EBV.GLBL_CMPY_CD         = BOE.GLBL_CMPY_CD(+)
        AND EBV.BACK_ORD_IMPCT_TP_CD = BOE.BACK_ORD_IMPCT_TP_CD(+)
        AND BOE.EZCANCELFLAG(+)      = '0'
        AND SV.ROW_NUM           &lt;= #rownum#
        ORDER BY
            SV.ROW_NUM
    </statement>

    <resultMap id="result.NLBL3070_ASMsg" class="NLBL3070_ASMsg">
        <result property="trxHdrNum_A1"              column="CPO_ORD_NUM"                 javaType="EZDSStringItem"/>
        <result property="svcConfigMstrPk_A1"        column="SHIP_SVC_CONFIG_MSTR_PK"     javaType="EZDSBigDecimalItem"/>
        <result property="backOrdImpctTpDescTxt_A1"  column="BACK_ORD_IMPCT_TP_DESC_TXT"  javaType="EZDSStringItem"/>
        <result property="soNum_A1"                  column="SO_NUM"                      javaType="EZDSStringItem"/>
        <result property="t_MdlNm_A1"                column="MDL_NM"                      javaType="EZDSStringItem"/>
        <result property="rddDt_A1"                  column="RDD_DT"                      javaType="EZDSDateItem"/>
        <result property="schdCarrPickUpDt_A1"       column="SCHD_CARR_PICK_UP_DT"        javaType="EZDSDateItem"/>
        <result property="schdDelyDt_A1"             column="SCHD_DELY_DT"                javaType="EZDSDateItem"/>
        <result property="schdDelyTsDplyTxt_A2"      column="SCHD_DELY_TM"                javaType="EZDSStringItem"/>
        <result property="carrCd_A1"                 column="CARR_CD"                     javaType="EZDSStringItem"/>
        <result property="carrNm_A1"                 column="CARR_NM"                     javaType="EZDSStringItem"/>
        <result property="schdIstlDt_A1"             column="SCHD_ISTL_DT"                javaType="EZDSStringItem"/>
        <result property="schdDelyTsDplyTxt_A1"      column="SCHD_ISTL_TM"                javaType="EZDSStringItem"/>
        <result property="schdDurnTmNum_A1"          column="SCHD_DURN_TM_NUM"            javaType="EZDSStringItem"/>
        <result property="fsrNum_A1"                 column="FSR_NUM"                     javaType="EZDSStringItem"/>
        <result property="svcTaskSchdDt_A1"          column="SVC_TASK_SCHD_DT"            javaType="EZDSDateItem"/>
        <result property="techNm_A1"                 column="TECH_NM"                     javaType="EZDSStringItem"/>
        <result property="schdCoordStsCd_A1"         column="SCHD_COORD_STS_CD"           javaType="EZDSStringItem"/>
        <result property="schdCoordStsDescTxt_A1"    column="SCHD_COORD_STS_DESC_TXT"     javaType="EZDSStringItem"/>
        <result property="manUpdPrtyNum_A1"          column="MAN_UPD_PRTY_NUM"            javaType="EZDSBigDecimalItem"/>
        <result property="xxPsnFirstMidLastNm_A2"    column="XX_PSN_FIRST_MID_LAST_NM"    javaType="EZDSStringItem"/>
        <result property="tocNm_A1"                  column="TOC_NM"                      javaType="EZDSStringItem"/>
        <result property="ctacPsnTelNum_A1"          column="CTAC_PSN_TEL_NUM"            javaType="EZDSStringItem"/>
        <result property="dsAcctNum_A1"              column="DS_ACCT_NUM"                 javaType="EZDSStringItem"/>
        <result property="dsAcctNm_A1"               column="SHIP_TO_CUST_NM"             javaType="EZDSStringItem"/>
        <result property="firstLineAddr_A1"          column="SO_CUST_LINE_ADDR_01"        javaType="EZDSStringItem"/>
        <result property="scdLineAddr_A1"            column="SO_CUST_LINE_ADDR_02"        javaType="EZDSStringItem"/>
        <result property="ctyAddr_A1"                column="CTY_ADDR"                    javaType="EZDSStringItem"/>
        <result property="stCd_A1"                   column="ST_CD"                       javaType="EZDSStringItem"/>
        <result property="postCd_A1"                 column="POST_CD"                     javaType="EZDSStringItem"/>
        <result property="rtlWhCd_A1"                column="RTL_WH_CD"                   javaType="EZDSStringItem"/>
        <result property="rtlWhNm_A1"                column="RTL_WH_NM"                   javaType="EZDSStringItem"/>
        <result property="wmsDropFlg_A1"             column="WMS_DROP_FLG"                javaType="EZDSStringItem"/>
        <result property="wmsDropRqstFlg_A1"         column="WMS_DROP_READY_FLG"          javaType="EZDSStringItem"/>
        <result property="sendRqstFlg_A1"            column="SEND_RQST_FLG"               javaType="EZDSStringItem"/>
        <result property="shpgSvcLvlCd_A1"           column="SHPG_SVC_LVL_CD"             javaType="EZDSStringItem"/>
        <result property="carrAcctNum_A1"            column="CARR_ACCT_NUM"               javaType="EZDSStringItem"/>
        <result property="xxPsnFirstMidLastNm_A1"    column="SCHD_COORD_PSN_NM"           javaType="EZDSStringItem"/>
        <result property="tempSchdRsnCd_A1"          column="TEMP_SCHD_RSN_CD"            javaType="EZDSStringItem"/>
        <result property="tempSchdCmntTxt_A1"        column="TEMP_SCHD_CMNT_TXT"          javaType="EZDSStringItem"/>
        <result property="pddDt_A1"                  column="PDD_DT"                      javaType="EZDSDateItem"/>
        <result property="dsOrdCatgDescTxt_A1"       column="DS_ORD_CATG_DESC_TXT"        javaType="EZDSStringItem"/>
        <result property="dsOrdTpDescTxt_A1"         column="DS_ORD_TP_DESC_TXT"          javaType="EZDSStringItem"/>
        <!-- START 2021/05/31 A.Marte [QC#58786,ADD] -->
        <result property="sceOrdTpCd_A1"             column="SCE_ORD_TP_CD"               javaType="EZDSStringItem"/>
        <!-- END 2020/05/31 A.Marte [QC#58786,ADD] -->
        <result property="schdCarrPickUpDt_BK"       column="SCHD_CARR_PICK_UP_DT"        javaType="EZDSDateItem"/>
        <result property="schdDelyDt_BK"             column="SCHD_DELY_DT"                javaType="EZDSDateItem"/>
        <result property="carrCd_BK"                 column="CARR_CD"                     javaType="EZDSStringItem"/>
        <result property="carrNm_BK"                 column="CARR_NM"                     javaType="EZDSStringItem"/>
        <result property="schdCoordStsCd_BK"         column="SCHD_COORD_STS_CD"           javaType="EZDSStringItem"/>
        <result property="shpgSvcLvlCd_BK"           column="SHPG_SVC_LVL_CD"             javaType="EZDSStringItem"/>
        <result property="tempSchdRsnCd_BK"          column="TEMP_SCHD_RSN_CD"            javaType="EZDSStringItem"/>
        <result property="tempSchdCmntTxt_BK"        column="TEMP_SCHD_CMNT_TXT"          javaType="EZDSStringItem"/>
        <result property="schdIstlDt_BK"             column="SCHD_ISTL_DT"                javaType="EZDSStringItem"/>
        <result property="schdDelyTsDplyTxt_BK"      column="SCHD_ISTL_TM"                javaType="EZDSStringItem"/>
        <result property="schdDurnTmNum_BK"          column="SCHD_DURN_TM_NUM"            javaType="EZDSStringItem"/>
        <result property="carrAcctNum_BK"            column="CARR_ACCT_NUM"               javaType="EZDSStringItem"/>
        <result property="openFlg_A1"                column="ORD_OPEN_FLG"                javaType="EZDSStringItem"/>
        <result property="schdOpenFlg_A1"            column="SCHD_OPEN_FLG"               javaType="EZDSStringItem"/>
        <result property="manSendRqstFlg_AW"         column="WH_MAN_SEND_RQST_FLG"        javaType="EZDSStringItem"/>
        <result property="manSendRqstFlg_AC"         column="CARR_MAN_SEND_RQST_FLG"      javaType="EZDSStringItem"/>
        <result property="carrCd_OD"                 column="ORD_CARR_CD"                 javaType="EZDSStringItem"/>
        <result property="ezUpTime_SO"               column="EZUPTIME_SO"                 javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_SO"           column="EZUPTIMEZONE_SO"             javaType="EZDSStringItem"/>
        <!-- START 2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
        <result property="techMeetTruckFlg_A1"        column="TECH_MEET_TRUCK_FLG"         javaType="EZDSStringItem"/>
        <result property="techMeetTruckFlg_BK"        column="TECH_MEET_TRUCK_FLG"         javaType="EZDSStringItem"/>
        <result property="ctryCd_A1"                  column="CTRY_CD"                     javaType="EZDSStringItem"/>
        <!-- END 2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
        <!-- START 2017/09/07 S.Katsuma [Sol#032(QC#13117),ADD] -->
        <result property="nextActDt_A1"              column="NEXT_ACT_DT"                 javaType="EZDSDateItem"/>
        <result property="nextActDt_BK"              column="NEXT_ACT_DT"                 javaType="EZDSDateItem"/>
        <!-- END 2017/09/07 S.Katsuma [Sol#032(QC#13117),ADD] -->
    </resultMap>

    <statement id="getOtbdCarrRsnList" parameterClass="Map" resultClass="Map">
        SELECT
            CARR_RSN_CD
           ,CARR_RSN_DESC_TXT
       FROM
           CARR_RSN
       WHERE
           GLBL_CMPY_CD  = #glblCmpyCd#
       AND OTBD_DELY_FLG = #otbdDelyFlg#
       AND EZCANCELFLAG  = '0'
       ORDER BY
           CARR_RSN_SORT_NUM
    </statement>

    <statement id="getInitSchdCoordStsList" parameterClass="Map" resultClass="Map">
        SELECT
            SCHD_COORD_STS_CD
           ,SCHD_COORD_STS_DESC_TXT
           ,SCHD_COORD_STS_SORT_NUM
        FROM
            SCHD_COORD_STS
        WHERE
            GLBL_CMPY_CD         = #glblCmpyCd#
        AND MAN_UPD_AVAL_FLG     = #flgY#
        AND EZCANCELFLAG         = '0'
        ORDER BY
            SCHD_COORD_STS_SORT_NUM
    </statement>

    <statement id="getSchdCoordStsList" parameterClass="Map" resultClass="Map">
        SELECT
            SCHD_COORD_STS_CD
           ,SCHD_COORD_STS_DESC_TXT
           ,SCHD_COORD_STS_SORT_NUM
        FROM
            SCHD_COORD_STS
        WHERE
            GLBL_CMPY_CD      = #glblCmpyCd#
        AND SCHD_COORD_STS_CD = #schdCoordStsCd#
        AND EZCANCELFLAG      = '0'
        UNION
        SELECT
            SCHD_COORD_STS_CD
           ,SCHD_COORD_STS_DESC_TXT
           ,SCHD_COORD_STS_SORT_NUM
        FROM
            SCHD_COORD_STS
        WHERE
            GLBL_CMPY_CD         = #glblCmpyCd#
        AND MAN_UPD_PRTY_NUM &gt;= #manUpdPrtyNum#
        AND MAN_UPD_AVAL_FLG     = #flgY#
        AND EZCANCELFLAG         = '0'
        ORDER BY
            SCHD_COORD_STS_SORT_NUM
    </statement>

    <statement id ="SearchDely" parameterClass="Map" resultMap="result.NLBL3070_BSMsg">
        WITH SO_DTL_V AS (
            SELECT
                SO.GLBL_CMPY_CD                                  AS GLBL_CMPY_CD
               ,SO.SVC_CONFIG_MSTR_PK                            AS SHIP_SVC_CONFIG_MSTR_PK
               ,SO.TRX_HDR_NUM                                   AS CPO_ORD_NUM
               ,SOD.TRX_LINE_NUM                                 AS TRX_LINE_NUM
               <!-- QC#21913 Add -->
               ,SOD.TRX_LINE_SUB_NUM                             AS TRX_LINE_SUB_NUM
               ,CONCAT(CD.DS_ORD_POSN_NUM, '.')
                    || CONCAT(CD.DS_CPO_LINE_NUM, DECODE(CD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
                        || CD.DS_CPO_LINE_SUB_NUM                AS DPLY_LINE_NUM
               ,SO.SO_NUM                                        AS SO_NUM
               ,SOD.SO_SLP_NUM                                   AS SO_SLP_NUM
               ,TRIM(PSN.PSN_FIRST_NM || ' ' || PSN.PSN_LAST_NM) AS SCHD_COORD_PSN_NM
               ,RW.RTL_WH_CD                                     AS RTL_WH_CD
               ,SOD.RTL_SWH_CD                                   AS RTL_SWH_CD
               ,SOD.INVTY_LOC_CD                                 AS INVTY_LOC_CD
               ,RW.RTL_WH_NM                                     AS RTL_WH_NM
               ,RW.FIRST_LINE_ADDR                               AS RTL_WH_FIRST_LINE_ADDR
               ,RW.CTY_ADDR                                      AS RTL_WH_CTY_ADDR
               ,RW.ST_CD                                         AS RTL_WH_ST_CD
               ,RW.POST_CD                                       AS RTL_WH_POST_CD
               ,SOD.MDSE_CD                                      AS MDSE_CD
               ,M.MDSE_DESC_SHORT_TXT                            AS MDSE_DESC_SHORT_TXT
               ,SOD.SHPG_QTY                                     AS SHPG_QTY
               ,SOD.SHIP_QTY                                     AS SHIP_QTY
               ,SOD.SHPG_QTY - SOD.SHIP_QTY                      AS SHPG_BAL_QTY
               ,BOIT.BACK_ORD_IMPCT_TP_DESC_TXT                  AS BACK_ORD_IMPCT_TP_DESC_TXT
               ,SO.RDD_DT                                        AS RDD_DT
               ,SO.SCHD_DELY_DT                                  AS SCHD_DELY_DT
               ,SO.SCHD_DELY_TM                                  AS SCHD_DELY_TM
               ,SOD.CARR_RSN_CD                                  AS CARR_RSN_CD
               ,CR.CARR_RSN_DESC_TXT                             AS CARR_RSN_DESC_TXT
               ,SOD.ACTL_DELY_DT                                 AS ACTL_DELY_DT
               ,SOD.ACTL_DELY_TM                                 AS ACTL_DELY_TM
               ,DSLS.DS_SO_LINE_STS_DESC_TXT                     AS DS_SO_LINE_STS_DESC_TXT
               ,SO.CARR_CD                                       AS SCHD_CARR_CD
               ,V.LOC_NM                                         AS SCHD_CARR_NM
               ,SO.SHPG_SVC_LVL_CD                               AS SHPG_SVC_LVL_CD
               ,SSL.SHPG_SVC_LVL_DESC_TXT                        AS SHPG_SVC_LVL_DESC_TXT
               ,SCS.SCHD_COORD_STS_DESC_TXT                      AS SCHD_COORD_STS_DESC_TXT
               ,SO.DELY_REQ_TS                                   AS DELY_REQ_TS
               ,SO.SHIP_TO_CUST_ACCT_CD                          AS DS_ACCT_NUM
               ,SO.SHIP_TO_CUST_CD                               AS SHIP_TO_CUST_CD
               ,CASE WHEN LT.LOC_TP_CD = #locTpCust# THEN SEL.DS_ACCT_NM
                     ELSE SOCD.SO_CUST_LINE_LOC_NM_01
                END                                              AS SHIP_TO_CUST_NM
               ,SOCD.SO_CUST_LINE_ADDR_01                        AS SHIP_TO_LINE_ADDR_01
               ,SOCD.CTY_ADDR                                    AS SHIP_TO_CTY_ADDR
               ,SOCD.ST_CD                                       AS SHIP_TO_ST_CD
               ,SOCD.POST_CD                                     AS SHIP_TO_POST_CD
               ,SOCD.CTAC_PTNR_PSN_NM                            AS XX_PSN_FIRST_MID_LAST_NM
               ,SOD.PICK_SVC_CONFIG_MSTR_PK                      AS PICK_SVC_CONFIG_MSTR_PK
               ,SOD.FROM_STK_STS_CD                              AS STK_STS_CD
               ,DOC.DS_ORD_CATG_DESC_TXT                         AS DS_ORD_CATG_DESC_TXT
               ,SO.SCE_ORD_TP_CD                                 AS SCE_ORD_TP_CD
               ,SO.CARR_ACCT_NUM                                 AS CARR_ACCT_NUM
               ,CASE WHEN SS.SO_PRINT_FLG = #flgY# AND SS.SHIP_FLG = #flgN# THEN #flgY#
                     ELSE #flgN#
                END                                              AS ORD_OPEN_FLG
               ,DSLS.SO_LINE_OPEN_FLG                            AS SO_LINE_OPEN_FLG
               ,NVL(SRCC.SO_SCR_CANC_AVAL_FLG, #flgN#)           AS SO_SCR_CANC_AVAL_FLG
               ,NVL(CONC.DS_COND_CONST_VAL_TXT_04, #flgN#)       AS SO_LINE_SHIP_AVAL_FLG
               ,NVL(CONC.DS_COND_CONST_VAL_TXT_05, #flgN#)       AS SO_LINE_PART_SHIP_AVAL_FLG
               ,SO.WMS_DROP_FLG                                  AS WMS_DROP_FLG
               ,SO.WMS_DROP_RQST_FLG                             AS WMS_DROP_READY_FLG
               ,NVL(WO.MAN_SEND_RQST_FLG, #flgN#)                AS WH_MAN_SEND_RQST_FLG
               ,NVL(CT.MAN_SEND_RQST_FLG, #flgN#)                AS CARR_MAN_SEND_RQST_FLG
               ,CASE WHEN SO.DELY_REQ_FLG = #flgY# THEN #flgY#
                     WHEN SO.DELY_REQ_TS IS NOT NULL THEN #flgY#
                     ELSE #flgN#
                END                                              AS SEND_RQST_FLG
               ,SOD.SET_MDSE_CD                                  AS SET_MDSE_CD
               ,SP.SET_SHPG_PLN_NUM                              AS SET_SHPG_PLN_NUM
               ,MSP.IN_EACH_QTY                                  AS UOM_EACH_QTY
               ,RW.INVTY_ACCT_CD                                 AS INVTY_ACCT_CD
               ,SO.DS_CPO_CONFIG_PK                              AS DS_CPO_CONFIG_PK
               ,SCM.SVC_MACH_MSTR_PK                             AS SVC_MACH_MSTR_PK
               ,SOD.SER_NUM_TAKE_FLG                             AS SER_NUM_TAKE_FLG
               ,M.INSTL_BASE_CTRL_FLG                            AS INSTL_BASE_CTRL_FLG
               ,CD.CARR_CD                                       AS ORD_CARR_CD
               ,SO.MDL_ID                                        AS MDL_ID
               ,(
                 SELECT
                     MAX(ST.SVC_TASK_NUM)
                 FROM
                     SVC_TASK ST
                 WHERE
                     ST.GLBL_CMPY_CD      = SO.GLBL_CMPY_CD
                 AND ST.SO_NUM            = SO.SO_NUM
                 AND ST.SVC_MACH_MSTR_PK  = SCM.SVC_MACH_MSTR_PK
                 AND ST.DS_SVC_CALL_TP_CD IN (#dsSvcCallTpInstl#, #dsSvcCallTpAccInstl#)
                 AND ST.SVC_TASK_STS_CD &lt;&gt; #svcTaskStsCancel#
                 AND ST.EZCANCELFLAG      = '0'
                )                                                AS SVC_TASK_NUM
               ,SO.EZUPTIME                                      AS EZUPTIME_SO
               ,SO.EZUPTIMEZONE                                  AS EZUPTIMEZONE_SO
               ,SOD.EZUPTIME                                     AS EZUPTIME_SOD
               ,SOD.EZUPTIMEZONE                                 AS EZUPTIMEZONE_SOD
               ,ROW_NUMBER() OVER(PARTITION BY SO.GLBL_CMPY_CD ORDER BY SO.TRX_HDR_NUM, TO_NUMBER(CD.DS_ORD_POSN_NUM), SO.SO_NUM, SOD.SO_SLP_NUM) AS ROW_NUM
            <!-- START 2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
               ,SOCD.CTRY_CD                                     AS CTRY_CD
            <!-- END   2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
            FROM
                SHPG_ORD             SO
               ,SHPG_STS             SS
               ,SCHD_COORD_STS       SCS
               ,S21_PSN              PSN
               ,VND                  V
               ,CARR_TP              CT
               ,SHPG_ORD_CUST_DTL    SOCD
               ,RTL_WH               RW
               ,WH_OWNR              WO
               ,CPO                  C
               ,CPO_DTL              CD
               ,SELL_TO_CUST         SEL
               ,MDL_NM               MN
               ,DS_ORD_CATG          DOC
               ,DS_ORD_TP            DOT
               ,SVC_CONFIG_MSTR      SCM
               ,SHIP_TO_CUST         STC
               ,LOC_TP               LT
               ,SHPG_ORD_DTL         SOD
               ,MDSE                 M
               ,BACK_ORD_IMPCT_TP    BOIT
               ,DS_SO_LINE_STS       DSLS
               ,SHPG_SVC_LVL         SSL
               ,SO_RWS_SCR_CANC_CTRL SRCC
               ,DS_COND_CONST        CONC
               ,SHPG_PLN             SP
               ,MDSE_STORE_PKG       MSP
               ,CARR_RSN             CR
            WHERE
                SO.GLBL_CMPY_CD              = #glblCmpyCd#
            <isNotNull property="cMsg.soNum">
            AND SO.SO_NUM                    = #cMsg.soNum#
            </isNotNull>
            <isNotNull property="soNumList">
                <iterate property="soNumList" var="soNumList[]" open="AND SO.SO_NUM IN (" conjunction= ", " close=")">
                    #soNumList[]#
                </iterate>
            </isNotNull>
            <isNotNull property="cMsg.rtlWhCd">
            AND SO.WH_CD                     = #cMsg.rtlWhCd#
            </isNotNull>
            <isNotNull property="cMsg.trxHdrNum">
            AND SO.TRX_HDR_NUM               = #cMsg.trxHdrNum#
            </isNotNull>
            <isNotNull property="cMsg.shipToCustCd">
            AND SO.SHIP_TO_CUST_CD           = #cMsg.shipToCustCd#
            </isNotNull>
            <isNotNull property="cMsg.rddDt_FR">
            AND SO.RDD_DT                &gt;= #cMsg.rddDt_FR#
            </isNotNull>
            <isNotNull property="cMsg.rddDt_TO">
            AND SO.RDD_DT                &lt;= #cMsg.rddDt_TO#
            </isNotNull>
            <isNotNull property="cMsg.wmsDropFlg_Y">
                <isNull property="cMsg.wmsDropFlg_N">
                AND SO.WMS_DROP_FLG          = #flgY#
                </isNull>
            </isNotNull>
            <isNotNull property="cMsg.wmsDropFlg_N">
                <isNull property="cMsg.wmsDropFlg_Y">
                AND SO.WMS_DROP_FLG          = #flgN#
                </isNull>
            </isNotNull>
            <isNotNull property="cMsg.svcConfigMstrPk">
            AND SO.SVC_CONFIG_MSTR_PK        = #cMsg.svcConfigMstrPk#
            </isNotNull>
            <isNotNull property="cMsg.delyReqFlg_Y">
                <isNull property="cMsg.delyReqFlg_N">
                AND (   SO.DELY_REQ_FLG  = #flgY#
                     <!-- START 2018/03/23 S.Katsuma [QC#24890,MOD] -->
                     <!-- OR SO.DELY_REQ_TS   IS NOT NULL -->
                     OR (SO.DELY_REQ_FLG  = #flgN# AND SO.DELY_REQ_TS   IS NOT NULL)
                     <!-- END 2018/03/23 S.Katsuma [QC#24890,MOD] -->
                    )
                </isNull>
            </isNotNull>
            <isNotNull property="cMsg.delyReqFlg_N">
                <isNull property="cMsg.delyReqFlg_Y">
                AND (   SO.DELY_REQ_FLG  = #flgN#
                     <!-- START 2018/03/23 S.Katsuma [QC#24890,MOD] -->
                     <!-- OR SO.DELY_REQ_TS   IS NULL -->
                     AND SO.DELY_REQ_TS   IS NULL
                     <!-- END 2018/03/23 S.Katsuma [QC#24890,MOD] -->
                    )
                </isNull>
            </isNotNull>
            AND SO.EZCANCELFLAG              = '0'
            AND SO.GLBL_CMPY_CD              = SS.GLBL_CMPY_CD
            AND SO.SHPG_STS_CD               = SS.SHPG_STS_CD
            AND SS.EZCANCELFLAG              = '0'
            <isNotNull property="cMsg.shpgSvcLvlCd">
            AND SO.SHPG_SVC_LVL_CD           = #cMsg.shpgSvcLvlCd#
            </isNotNull>
            <isNotNull property="cMsg.schdCoordStsCd">
            AND SO.SCHD_COORD_STS_CD         = #cMsg.schdCoordStsCd#
            </isNotNull>
            <isNotNull property="cMsg.carrCd">
            AND SO.CARR_CD                   = #cMsg.carrCd#
            </isNotNull>
            <isNotNull property="cMsg.schdCoordPsnCd">
            AND SO.SCHD_COORD_PSN_CD         = #cMsg.schdCoordPsnCd#
            </isNotNull>
            <isNotNull property="cMsg.schdDelyDt_FR">
            AND SO.SCHD_DELY_DT          &gt;= #cMsg.schdDelyDt_FR#
            </isNotNull>
            <isNotNull property="cMsg.schdDelyDt_TO">
            AND SO.SCHD_DELY_DT          &lt;= #cMsg.schdDelyDt_TO#
            </isNotNull>
            <isNotNull property="cMsg.schdCarrPickUpDt_FR">
            AND SO.SCHD_CARR_PICK_UP_DT  &gt;= #cMsg.schdCarrPickUpDt_FR#
            </isNotNull>
            <isNotNull property="cMsg.schdCarrPickUpDt_TO">
            AND SO.SCHD_CARR_PICK_UP_DT  &lt;= #cMsg.schdCarrPickUpDt_TO#
            </isNotNull>
            <isNotNull property="cMsg.svcConfigMstrPk">
            AND SO.SVC_CONFIG_MSTR_PK        = #cMsg.svcConfigMstrPk#
            </isNotNull>
            AND SO.EZCANCELFLAG              = '0'
            AND SO.GLBL_CMPY_CD              = SCS.GLBL_CMPY_CD
            AND SO.SCHD_COORD_STS_CD         = SCS.SCHD_COORD_STS_CD
            AND SCS.EZCANCELFLAG             = '0'
            AND SO.GLBL_CMPY_CD              = PSN.GLBL_CMPY_CD(+)
            AND SO.SCHD_COORD_PSN_CD         = PSN.PSN_CD(+)
            AND PSN.EZCANCELFLAG(+)          = '0'
            AND SO.GLBL_CMPY_CD              = V.GLBL_CMPY_CD(+)
            AND SO.CARR_CD                   = V.VND_CD(+)
            AND V.EZCANCELFLAG(+)            = '0'
            AND V.GLBL_CMPY_CD               = CT.GLBL_CMPY_CD(+)
            AND V.CARR_TP_CD                 = CT.CARR_TP_CD(+)
            AND CT.EZCANCELFLAG(+)           = '0'
            AND SO.GLBL_CMPY_CD              = SOCD.GLBL_CMPY_CD
            AND SO.SO_NUM                    = SOCD.SO_NUM
            AND SOCD.SO_CUST_DATA_TP_CD      = #soCustDataTpShipTo#
            AND SOCD.EZCANCELFLAG            = '0'
            AND SO.GLBL_CMPY_CD              = RW.GLBL_CMPY_CD
            AND SO.WH_CD                     = RW.RTL_WH_CD
            AND RW.EZCANCELFLAG              = '0'
            AND RW.GLBL_CMPY_CD              = WO.GLBL_CMPY_CD
            AND RW.WH_OWNR_CD                = WO.WH_OWNR_CD
            AND WO.EZCANCELFLAG              = '0'
            AND SO.GLBL_CMPY_CD              = C.GLBL_CMPY_CD
            AND SO.TRX_HDR_NUM               = C.CPO_ORD_NUM
            <isNotNull property="cMsg.dsOrdCatgCd">
            AND C.DS_ORD_CATG_CD             = #cMsg.dsOrdCatgCd#
            </isNotNull>
            <isNotNull property="cMsg.dsOrdTpCd">
            AND C.DS_ORD_TP_CD               = #cMsg.dsOrdTpCd#
            </isNotNull>
            AND C.EZCANCELFLAG               = '0'
            AND SOD.GLBL_CMPY_CD             = CD.GLBL_CMPY_CD
            AND SOD.TRX_HDR_NUM              = CD.CPO_ORD_NUM
            AND SOD.TRX_LINE_NUM             = CD.CPO_DTL_LINE_NUM
            AND SOD.TRX_LINE_SUB_NUM         = CD.CPO_DTL_LINE_SUB_NUM
            AND CD.EZCANCELFLAG              = '0'
            AND SO.GLBL_CMPY_CD              = SEL.GLBL_CMPY_CD
            AND SO.SHIP_TO_CUST_ACCT_CD      = SEL.SELL_TO_CUST_CD
            AND SEL.EZCANCELFLAG             = '0'
            <isNull property="cMsg.t_MdlNm">
            AND SO.GLBL_CMPY_CD              = MN.T_GLBL_CMPY_CD(+)
            AND SO.MDL_ID                    = MN.T_MDL_ID(+)
            AND MN.EZCANCELFLAG(+)           = '0'
            </isNull>
            <isNotNull property="cMsg.t_MdlNm">
            AND SO.GLBL_CMPY_CD              = MN.T_GLBL_CMPY_CD
            AND SO.MDL_ID                    = MN.T_MDL_ID
            AND MN.T_MDL_NM                  = #cMsg.t_MdlNm#
            AND MN.EZCANCELFLAG              = '0'
            </isNotNull>
            AND C.GLBL_CMPY_CD               = DOC.GLBL_CMPY_CD
            AND C.DS_ORD_CATG_CD             = DOC.DS_ORD_CATG_CD
            AND DOC.EZCANCELFLAG             = '0'
            AND C.GLBL_CMPY_CD               = DOT.GLBL_CMPY_CD
            AND C.DS_ORD_TP_CD               = DOT.DS_ORD_TP_CD
            AND DOT.EZCANCELFLAG             = '0'
            AND SO.GLBL_CMPY_CD              = SCM.GLBL_CMPY_CD(+)
            AND SO.SVC_CONFIG_MSTR_PK        = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.EZCANCELFLAG(+)          = '0'
            AND SO.GLBL_CMPY_CD              = STC.GLBL_CMPY_CD
            AND SO.SHIP_TO_CUST_CD           = STC.SHIP_TO_CUST_CD
            AND STC.EZCANCELFLAG             = '0'
            AND STC.GLBL_CMPY_CD             = LT.GLBL_CMPY_CD
            AND STC.LOC_GRP_CD               = LT.LOC_GRP_CD
            AND STC.LOC_ROLE_TP_CD           = LT.LOC_ROLE_TP_CD
            AND LT.EZCANCELFLAG              = '0'
            AND SO.GLBL_CMPY_CD              = SOD.GLBL_CMPY_CD
            AND SO.SO_NUM                    = SOD.SO_NUM
            <isNotNull property="cMsg.dsSoLineStsCd">
            AND SOD.DS_SO_LINE_STS_CD        = #cMsg.dsSoLineStsCd#
            </isNotNull>
            <isNotNull property="cMsg.rtlSwhCd">
            AND SOD.RTL_SWH_CD               = #cMsg.rtlSwhCd#
            </isNotNull>
            <isNotNull property="cMsg.actlDelyDt_FR">
            AND SOD.ACTL_DELY_DT         &gt;= #cMsg.actlDelyDt_FR#
            </isNotNull>
            <isNotNull property="cMsg.actlDelyDt_TO">
            AND SOD.ACTL_DELY_DT         &lt;= #cMsg.actlDelyDt_TO#
            </isNotNull>
            AND SOD.EZCANCELFLAG             = '0'
            AND SOD.GLBL_CMPY_CD             = SP.GLBL_CMPY_CD
            AND SOD.SHPG_PLN_NUM             = SP.SHPG_PLN_NUM
            AND SP.EZCANCELFLAG              = '0'
            AND SOD.GLBL_CMPY_CD             = M.GLBL_CMPY_CD
            AND SOD.MDSE_CD                  = M.MDSE_CD
            AND M.EZCANCELFLAG               = '0'
            AND M.GLBL_CMPY_CD               = BOIT.GLBL_CMPY_CD(+)
            AND M.BACK_ORD_IMPCT_TP_CD       = BOIT.BACK_ORD_IMPCT_TP_CD(+)
            AND BOIT.EZCANCELFLAG(+)         = '0'
            AND SOD.GLBL_CMPY_CD             = DSLS.GLBL_CMPY_CD
            AND SOD.DS_SO_LINE_STS_CD        = DSLS.DS_SO_LINE_STS_CD
            AND DSLS.EZCANCELFLAG            = '0'
            AND SO.GLBL_CMPY_CD              = SSL.GLBL_CMPY_CD(+)
            AND SO.SHPG_SVC_LVL_CD           = SSL.SHPG_SVC_LVL_CD(+)
            AND SSL.EZCANCELFLAG(+)          = '0'
            AND SO.GLBL_CMPY_CD              = SRCC.GLBL_CMPY_CD(+)
            AND SO.SCE_ORD_TP_CD             = SRCC.SCE_ORD_TP_CD(+)
            AND RW.WH_SYS_TP_CD              = SRCC.WH_SYS_TP_CD(+)
            AND SRCC.EZCANCELFLAG(+)         = '0'
            AND SO.GLBL_CMPY_CD              = CONC.GLBL_CMPY_CD(+)
            AND SO.SCE_ORD_TP_CD             = CONC.DS_COND_CONST_CD(+)
            AND CONC.DS_COND_CONST_GRP_ID(+) = #dsCondConstShipCtrl#
            AND CONC.EZCANCELFLAG(+)         = '0'
            AND SP.GLBL_CMPY_CD              = MSP.GLBL_CMPY_CD(+)
            AND SP.MDSE_CD                   = MSP.MDSE_CD(+)
            AND SP.CUST_UOM_CD               = MSP.PKG_UOM_CD(+)
            AND MSP.EZCANCELFLAG(+)          = '0'
            AND SOD.GLBL_CMPY_CD             = CR.GLBL_CMPY_CD(+)
            AND SOD.CARR_RSN_CD              = CR.CARR_RSN_CD(+)
            AND CR.EZCANCELFLAG(+)           = '0'
            <isNotNull property="cMsg.bolNum">
            <!-- QC#21913 Modify SHPG_ORD_CONF_DTL => SHPG_ORD_PRO_NUM_LIST -->
            AND EXISTS (SELECT
                            1
                        FROM
                            SHPG_ORD_PRO_NUM_LIST SOPNL
                        WHERE
                            SOPNL.GLBL_CMPY_CD = SO.GLBL_CMPY_CD
                        AND SOPNL.TRX_HDR_NUM  = SO.SO_NUM
                        AND SOPNL.PRO_NUM      = #cMsg.bolNum#
                        AND SOPNL.EZCANCELFLAG = '0'
                       )
            </isNotNull>
            <isEqual property="boSrchFlg" compareValue="Y">
            UNION
            SELECT
                SP.GLBL_CMPY_CD
               ,DCC.SVC_CONFIG_MSTR_PK           AS SHIP_SVC_CONFIG_MSTR_PK
               ,CD.CPO_ORD_NUM                   AS CPO_ORD_NUM
               ,CD.CPO_DTL_LINE_NUM              AS TRX_LINE_NUM
               ,CD.CPO_DTL_LINE_SUB_NUM          AS TRX_LINE_SUB_NUM
               ,CONCAT(CD.DS_ORD_POSN_NUM, '.')
                    || CONCAT(CD.DS_CPO_LINE_NUM, DECODE(CD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
                    || CD.DS_CPO_LINE_SUB_NUM    AS DPLY_LINE_NUM
               ,NULL                             AS SO_NUM
               ,NULL                             AS SO_SLP_NUM
               ,NULL                             AS SCHD_COORD_PSN_NM
               ,CD.RTL_WH_CD                     AS RTL_WH_CD
               ,CD.RTL_SWH_CD                    AS RTL_SWH_CD
               ,SP.INVTY_LOC_CD                  AS INVTY_LOC_CD
               ,RW.RTL_WH_NM                     AS RTL_WH_NM
               ,RW.FIRST_LINE_ADDR               AS RTL_WH_FIRST_LINE_ADDR
               ,RW.CTY_ADDR                      AS RTL_WH_CTY_ADDR
               ,RW.ST_CD                         AS RTL_WH_ST_CD
               ,RW.POST_CD                       AS RTL_WH_POST_CD
               ,SP.MDSE_CD                       AS MDSE_CD
               ,M.MDSE_DESC_SHORT_TXT            AS MDSE_DESC_SHORT_TXT
               ,SP.ORD_QTY                       AS SHPG_QTY
               ,0                                AS SHIP_QTY
               ,SP.ORD_QTY                       AS SHPG_BAL_QTY
               ,BOIT.BACK_ORD_IMPCT_TP_DESC_TXT  AS BACK_ORD_IMPCT_TP_DESC_TXT
               ,SP.RDD_DT                        AS RDD_DT
               ,NULL                             AS SCHD_DELY_DT
               ,NULL                             AS SCHD_DELY_TM
               ,NULL                             AS CARR_RSN_CD
               ,NULL                             AS CARR_RSN_DESC_TXT
               ,NULL                             AS ACTL_DELY_DT
               ,NULL                             AS ACTL_DELY_TM
               ,#dsSoLineStsBoDesc#              AS DS_SO_LINE_STS_DESC_TXT
               ,NVL(SP.RQST_CARR_CD, SP.CARR_CD) AS SCHD_CARR_CD
               ,V.LOC_NM                         AS SCHD_CARR_NM
               ,SP.ORIG_SHPG_SVC_LVL_CD          AS SHPG_SVC_LVL_CD
               ,SSL.SHPG_SVC_LVL_DESC_TXT        AS SHPG_SVC_LVL_DESC_TXT
               ,#schdCoordStsBoDesc#             AS SCHD_COORD_STS_DESC_TXT
               ,NULL                             AS DELY_REQ_TS
               ,DCC.SHIP_TO_CUST_ACCT_CD         AS DS_ACCT_NUM
               ,DCC.SHIP_TO_CUST_LOC_CD          AS SHIP_TO_CUST_CD
               ,CASE WHEN LT.LOC_TP_CD = #locTpCust# THEN SEL.DS_ACCT_NM
                     ELSE STC.LOC_NM
                END                              AS SHIP_TO_CUST_NM
               ,DCC.SHIP_TO_FIRST_LINE_ADDR      AS SHIP_TO_LINE_ADDR_01
               ,DCC.SHIP_TO_CTY_ADDR             AS SHIP_TO_CTY_ADDR
               ,DCC.SHIP_TO_ST_CD                AS SHIP_TO_ST_CD
               ,DCC.SHIP_TO_POST_CD              AS SHIP_TO_POST_CD
               ,NULL                             AS XX_PSN_FIRST_MID_LAST_NM
               ,CD.PICK_SVC_CONFIG_MSTR_PK       AS PICK_SVC_CONFIG_MSTR_PK
               ,SP.STK_STS_CD                    AS STK_STS_CD
               ,DOC.DS_ORD_CATG_DESC_TXT         AS DS_ORD_CATG_DESC_TXT
               <iterate property="dsOrdTpList" var="dsOrdTpList[]" open=",CASE WHEN C.DS_ORD_TP_CD in ( " conjunction= "," close=") THEN 'DT' ELSE 'RS' END AS SCE_ORD_TP_CD">
                   #dsOrdTpList[]#
               </iterate>
               ,SP.CARR_ACCT_NUM                 AS CARR_ACCT_NUM
               ,#flgN#                           AS ORD_OPEN_FLG
               ,#flgN#                           AS SO_LINE_OPEN_FLG
               ,#flgN#                           AS SO_SCR_CANC_AVAL_FLG
               ,#flgN#                           AS SO_LINE_SHIP_AVAL_FLG
               ,#flgN#                           AS SO_LINE_PART_SHIP_AVAL_FLG
               ,#flgN#                           AS WMS_DROP_FLG
               ,#flgN#                           AS WMS_DROP_READY_FLG
               ,#flgN#                           AS WH_MAN_SEND_RQST_FLG
               ,#flgN#                           AS CARR_MAN_SEND_RQST_FLG
               ,#flgN#                           AS SEND_RQST_FLG
               ,SP.SET_MDSE_CD                   AS SET_MDSE_CD
               ,SP.SET_SHPG_PLN_NUM              AS SET_SHPG_PLN_NUM
               ,MSP.IN_EACH_QTY                  AS UOM_EACH_QTY
               ,RW.INVTY_ACCT_CD                 AS INVTY_ACCT_CD
               ,DCC.DS_CPO_CONFIG_PK             AS DS_CPO_CONFIG_PK
               ,SCM.SVC_MACH_MSTR_PK             AS SVC_MACH_MSTR_PK
               ,M.SHPG_SER_TAKE_FLG              AS SER_NUM_TAKE_FLG
               ,M.INSTL_BASE_CTRL_FLG            AS INSTL_BASE_CTRL_FLG
               ,NVL(SP.RQST_CARR_CD, SP.CARR_CD) AS ORD_CARR_CD
               ,DCC.MDL_ID                       AS MDL_ID
               ,NULL                             AS SVC_TASK_NUM
               ,NULL                             AS EZUPTIME_SO
               ,NULL                             AS EZUPTIMEZONE_SO
               ,NULL                             AS EZUPTIME_SOD
               ,NULL                             AS EZUPTIMEZONE_SOD
               ,ROW_NUMBER() OVER(PARTITION BY SP.GLBL_CMPY_CD ORDER BY CD.CPO_ORD_NUM, TO_NUMBER(CD.DS_ORD_POSN_NUM), TO_NUMBER(CD.DS_CPO_LINE_NUM), TO_NUMBER(CD.DS_CPO_LINE_SUB_NUM)) AS ROW_NUM
            <!-- START 2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
               ,NULL                             AS CTRY_CD
            <!-- END   2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
            FROM
                SHPG_PLN          SP
               ,CPO_DTL           CD
               ,CPO               C
               ,DS_ORD_CATG       DOC
               ,DS_CPO_CONFIG     DCC
               ,SELL_TO_CUST      SEL
               ,RTL_WH            RW
               ,MDSE              M
               ,BACK_ORD_IMPCT_TP BOIT
               ,SHPG_SVC_LVL      SSL
               ,MDSE_STORE_PKG    MSP
               ,VND               V
               ,SHIP_TO_CUST      STC
               ,LOC_TP            LT
               ,MDL_NM            MN
               ,SVC_CONFIG_MSTR   SCM
            WHERE
                SP.GLBL_CMPY_CD                  = #glblCmpyCd#
            <isNotNull property="cMsg.trxHdrNum">
            AND SP.TRX_HDR_NUM                   = #cMsg.trxHdrNum#
            </isNotNull>
            <isNotNull property="trxHrdNumList">
                <iterate property="trxHrdNumList" var="trxHrdNumList[]" open="AND SP.TRX_HDR_NUM IN (" conjunction= ", " close=")">
                    #trxHrdNumList[]#
                </iterate>
            </isNotNull>
            <isNotNull property="cMsg.shpgSvcLvlCd">
            AND SP.ORIG_SHPG_SVC_LVL_CD          = #cMsg.shpgSvcLvlCd#
            </isNotNull>
            <isNotNull property="cMsg.carrCd">
            AND NVL(SP.RQST_CARR_CD, SP.CARR_CD) = #cMsg.carrCd#
            </isNotNull>
            <isNotNull property="cMsg.rddDt_FR">
            AND SP.RDD_DT                    &gt;= #cMsg.rddDt_FR#
            </isNotNull>
            <isNotNull property="cMsg.rddDt_TO">
            AND SP.RDD_DT                    &lt;= #cMsg.rddDt_TO#
            </isNotNull>
            AND SP.SHPG_STS_CD                   = #shpgStsCdValid#
            AND SP.EZCANCELFLAG                  = '0'
            AND SP.GLBL_CMPY_CD                  = CD.GLBL_CMPY_CD
            AND SP.TRX_HDR_NUM                   = CD.CPO_ORD_NUM
            AND SP.TRX_LINE_NUM                  = CD.CPO_DTL_LINE_NUM
            AND SP.TRX_LINE_SUB_NUM              = CD.CPO_DTL_LINE_SUB_NUM
            <isNotNull property="cMsg.rtlWhCd">
            AND CD.RTL_WH_CD                     = #cMsg.rtlWhCd#
            </isNotNull>
            <isNotNull property="cMsg.rtlSwhCd">
            AND CD.RTL_SWH_CD                    = #cMsg.rtlSwhCd#
            </isNotNull>
            AND CD.EZCANCELFLAG                  ='0'
            AND CD.GLBL_CMPY_CD                  = C.GLBL_CMPY_CD
            AND CD.CPO_ORD_NUM                   = C.CPO_ORD_NUM
            <isNotNull property="cMsg.dsOrdCatgCd">
            AND C.DS_ORD_CATG_CD                 = #cMsg.dsOrdCatgCd#
            </isNotNull>
            <isNotNull property="cMsg.dsOrdTpCd">
            AND C.DS_ORD_TP_CD                   = #cMsg.dsOrdTpCd#
            </isNotNull>
            AND C.EZCANCELFLAG                   = '0'
            AND C.GLBL_CMPY_CD                   = DOC.GLBL_CMPY_CD
            AND C.DS_ORD_CATG_CD                 = DOC.DS_ORD_CATG_CD
            AND DOC.EZCANCELFLAG                 = '0'
            AND CD.GLBL_CMPY_CD                  = DCC.GLBL_CMPY_CD
            AND CD.DS_CPO_CONFIG_PK              = DCC.DS_CPO_CONFIG_PK
            <isNotNull property="cMsg.svcConfigMstrPk">
            AND DCC.SVC_CONFIG_MSTR_PK           = #cMsg.svcConfigMstrPk#
            </isNotNull>
            <isNotNull property="cMsg.shipToCustCd">
            AND DCC.SHIP_TO_CUST_LOC_CD          = #cMsg.shipToCustCd#
            </isNotNull>
            AND DCC.EZCANCELFLAG                 = '0'
            AND DCC.GLBL_CMPY_CD                 = SEL.GLBL_CMPY_CD
            AND DCC.SHIP_TO_CUST_ACCT_CD         = SEL.SELL_TO_CUST_CD
            AND SEL.EZCANCELFLAG                 = '0'
            AND CD.GLBL_CMPY_CD                  = RW.GLBL_CMPY_CD
            AND CD.RTL_WH_CD                     = RW.RTL_WH_CD
            AND RW.EZCANCELFLAG                  = '0'
            AND SP.GLBL_CMPY_CD                  = M.GLBL_CMPY_CD
            AND SP.MDSE_CD                       = M.MDSE_CD
            AND M.INVTY_CTRL_FLG                 = #flgY#
            AND M.EZCANCELFLAG                   = '0'
            AND M.GLBL_CMPY_CD                   = BOIT.GLBL_CMPY_CD(+)
            AND M.BACK_ORD_IMPCT_TP_CD           = BOIT.BACK_ORD_IMPCT_TP_CD(+)
            AND BOIT.EZCANCELFLAG(+)             = '0'
            AND SP.GLBL_CMPY_CD                  = SSL.GLBL_CMPY_CD
            AND SP.ORIG_SHPG_SVC_LVL_CD          = SSL.SHPG_SVC_LVL_CD
            AND SSL.EZCANCELFLAG(+)              = '0'
            AND SP.GLBL_CMPY_CD                  = MSP.GLBL_CMPY_CD(+)
            AND SP.MDSE_CD                       = MSP.MDSE_CD(+)
            AND SP.CUST_UOM_CD                   = MSP.PKG_UOM_CD(+)
            AND MSP.EZCANCELFLAG(+)              = '0'
            AND SP.GLBL_CMPY_CD                  = V.GLBL_CMPY_CD(+)
            AND NVL(SP.RQST_CARR_CD, SP.CARR_CD) = V.VND_CD(+)
            AND V.EZCANCELFLAG(+)                = '0'
            AND DCC.GLBL_CMPY_CD                 = STC.GLBL_CMPY_CD
            AND DCC.SHIP_TO_CUST_LOC_CD          = STC.SHIP_TO_CUST_CD
            AND STC.EZCANCELFLAG                 = '0'
            AND STC.GLBL_CMPY_CD                 = LT.GLBL_CMPY_CD
            AND STC.LOC_GRP_CD                   = LT.LOC_GRP_CD
            AND STC.LOC_ROLE_TP_CD               = LT.LOC_ROLE_TP_CD
            AND LT.EZCANCELFLAG                  = '0'
            <isNull property="cMsg.t_MdlNm">
            AND DCC.GLBL_CMPY_CD                 = MN.T_GLBL_CMPY_CD(+)
            AND DCC.MDL_ID                       = MN.T_MDL_ID(+)
            AND MN.EZCANCELFLAG(+)               = '0'
            </isNull>
            <isNotNull property="cMsg.t_MdlNm">
            AND DCC.GLBL_CMPY_CD                 = MN.T_GLBL_CMPY_CD
            AND DCC.MDL_ID                       = MN.T_MDL_ID
            AND MN.T_MDL_NM                      = #cMsg.t_MdlNm#
            AND MN.EZCANCELFLAG                  = '0'
            </isNotNull>
            AND DCC.GLBL_CMPY_CD                 = SCM.GLBL_CMPY_CD(+)
            AND DCC.SVC_CONFIG_MSTR_PK           = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.EZCANCELFLAG(+)              = '0'
            </isEqual>
            <!-- START 2021/05/31 A.Marte [QC#58786,ADD] -->
            UNION
            SELECT
                SO.GLBL_CMPY_CD                                  AS GLBL_CMPY_CD
               ,SO.SVC_CONFIG_MSTR_PK                            AS SHIP_SVC_CONFIG_MSTR_PK
               ,SO.SRC_ORD_NUM                                   AS CPO_ORD_NUM
               ,SOD.TRX_LINE_NUM                                 AS TRX_LINE_NUM
               ,SOD.TRX_LINE_SUB_NUM                             AS TRX_LINE_SUB_NUM
               ,CONCAT(PRD.PRCH_REQ_LINE_NUM, DECODE(PRD.PRCH_REQ_LINE_SUB_NUM, NULL, '', '.'))
                        || PRD.PRCH_REQ_LINE_SUB_NUM                AS DPLY_LINE_NUM
               ,SO.SO_NUM                                        AS SO_NUM
               ,SOD.SO_SLP_NUM                                   AS SO_SLP_NUM
               ,TRIM(PSN.PSN_FIRST_NM || ' ' || PSN.PSN_LAST_NM) AS SCHD_COORD_PSN_NM
               ,RW.RTL_WH_CD                                     AS RTL_WH_CD
               ,SOD.RTL_SWH_CD                                   AS RTL_SWH_CD
               ,SOD.INVTY_LOC_CD                                 AS INVTY_LOC_CD
               ,RW.RTL_WH_NM                                     AS RTL_WH_NM
               ,RW.FIRST_LINE_ADDR                               AS RTL_WH_FIRST_LINE_ADDR
               ,RW.CTY_ADDR                                      AS RTL_WH_CTY_ADDR
               ,RW.ST_CD                                         AS RTL_WH_ST_CD
               ,RW.POST_CD                                       AS RTL_WH_POST_CD
               ,SOD.MDSE_CD                                      AS MDSE_CD
               ,M.MDSE_DESC_SHORT_TXT                            AS MDSE_DESC_SHORT_TXT
               ,SOD.SHPG_QTY                                     AS SHPG_QTY
               ,SOD.SHIP_QTY                                     AS SHIP_QTY
               ,SOD.SHPG_QTY - SOD.SHIP_QTY                      AS SHPG_BAL_QTY
               ,BOIT.BACK_ORD_IMPCT_TP_DESC_TXT                  AS BACK_ORD_IMPCT_TP_DESC_TXT
               ,SO.RDD_DT                                        AS RDD_DT
               ,SO.SCHD_DELY_DT                                  AS SCHD_DELY_DT
               ,SO.SCHD_DELY_TM                                  AS SCHD_DELY_TM
               ,SOD.CARR_RSN_CD                                  AS CARR_RSN_CD
               ,CR.CARR_RSN_DESC_TXT                             AS CARR_RSN_DESC_TXT
               ,SOD.ACTL_DELY_DT                                 AS ACTL_DELY_DT
               ,SOD.ACTL_DELY_TM                                 AS ACTL_DELY_TM
               ,DSLS.DS_SO_LINE_STS_DESC_TXT                     AS DS_SO_LINE_STS_DESC_TXT
               ,SO.CARR_CD                                       AS SCHD_CARR_CD
               ,V.LOC_NM                                         AS SCHD_CARR_NM
               ,SO.SHPG_SVC_LVL_CD                               AS SHPG_SVC_LVL_CD
               ,SSL.SHPG_SVC_LVL_DESC_TXT                        AS SHPG_SVC_LVL_DESC_TXT
               ,SCS.SCHD_COORD_STS_DESC_TXT                      AS SCHD_COORD_STS_DESC_TXT
               ,SO.DELY_REQ_TS                                   AS DELY_REQ_TS
               ,SO.SHIP_TO_CUST_ACCT_CD                          AS DS_ACCT_NUM
               ,SO.SHIP_TO_CUST_CD                               AS SHIP_TO_CUST_CD
               ,CASE WHEN LT.LOC_TP_CD = #locTpCust# THEN NULL
                     ELSE SOCD.SO_CUST_LINE_LOC_NM_01
                END                                              AS SHIP_TO_CUST_NM
               ,SOCD.SO_CUST_LINE_ADDR_01                        AS SHIP_TO_LINE_ADDR_01
               ,SOCD.CTY_ADDR                                    AS SHIP_TO_CTY_ADDR
               ,SOCD.ST_CD                                       AS SHIP_TO_ST_CD
               ,SOCD.POST_CD                                     AS SHIP_TO_POST_CD
               ,SOCD.CTAC_PTNR_PSN_NM                            AS XX_PSN_FIRST_MID_LAST_NM
               ,SOD.PICK_SVC_CONFIG_MSTR_PK                      AS PICK_SVC_CONFIG_MSTR_PK
               ,SOD.FROM_STK_STS_CD                              AS STK_STS_CD
               ,NULL                                             AS DS_ORD_CATG_DESC_TXT
               ,SO.SCE_ORD_TP_CD                                 AS SCE_ORD_TP_CD
               ,SO.CARR_ACCT_NUM                                 AS CARR_ACCT_NUM
               ,CASE WHEN SS.SO_PRINT_FLG = #flgY# AND SS.SHIP_FLG = #flgN# THEN #flgY#
                     ELSE #flgN#
                END                                              AS ORD_OPEN_FLG
               ,DSLS.SO_LINE_OPEN_FLG                            AS SO_LINE_OPEN_FLG
               ,NVL(SRCC.SO_SCR_CANC_AVAL_FLG, #flgN#)           AS SO_SCR_CANC_AVAL_FLG
               ,NVL(CONC.DS_COND_CONST_VAL_TXT_04, #flgN#)       AS SO_LINE_SHIP_AVAL_FLG
               ,NVL(CONC.DS_COND_CONST_VAL_TXT_05, #flgN#)       AS SO_LINE_PART_SHIP_AVAL_FLG
               ,SO.WMS_DROP_FLG                                  AS WMS_DROP_FLG
               ,SO.WMS_DROP_RQST_FLG                             AS WMS_DROP_READY_FLG
               ,NVL(WO.MAN_SEND_RQST_FLG, #flgN#)                AS WH_MAN_SEND_RQST_FLG
               ,NVL(CT.MAN_SEND_RQST_FLG, #flgN#)                AS CARR_MAN_SEND_RQST_FLG
               ,CASE WHEN SO.DELY_REQ_FLG = #flgY# THEN #flgY#
                     WHEN SO.DELY_REQ_TS IS NOT NULL THEN #flgY#
                     ELSE #flgN#
                END                                              AS SEND_RQST_FLG
               ,SOD.SET_MDSE_CD                                  AS SET_MDSE_CD
               ,SP.SET_SHPG_PLN_NUM                              AS SET_SHPG_PLN_NUM
               ,MSP.IN_EACH_QTY                                  AS UOM_EACH_QTY
               ,RW.INVTY_ACCT_CD                                 AS INVTY_ACCT_CD
               ,SO.DS_CPO_CONFIG_PK                              AS DS_CPO_CONFIG_PK
               ,SCM.SVC_MACH_MSTR_PK                             AS SVC_MACH_MSTR_PK
               ,SOD.SER_NUM_TAKE_FLG                             AS SER_NUM_TAKE_FLG
               ,M.INSTL_BASE_CTRL_FLG                            AS INSTL_BASE_CTRL_FLG
               ,PRD.CARR_CD                                      AS ORD_CARR_CD
               ,SO.MDL_ID                                        AS MDL_ID
               ,(
                 SELECT
                     MAX(ST.SVC_TASK_NUM)
                 FROM
                     SVC_TASK ST
                 WHERE
                     ST.GLBL_CMPY_CD      = SO.GLBL_CMPY_CD
                 AND ST.SO_NUM            = SO.SO_NUM
                 AND ST.SVC_MACH_MSTR_PK  = SCM.SVC_MACH_MSTR_PK
                 AND ST.DS_SVC_CALL_TP_CD IN (#dsSvcCallTpInstl#, #dsSvcCallTpAccInstl#)
                 AND ST.SVC_TASK_STS_CD &lt;&gt; #svcTaskStsCancel#
                 AND ST.EZCANCELFLAG      = '0'
                )                                                AS SVC_TASK_NUM
               ,SO.EZUPTIME                                      AS EZUPTIME_SO
               ,SO.EZUPTIMEZONE                                  AS EZUPTIMEZONE_SO
               ,SOD.EZUPTIME                                     AS EZUPTIME_SOD
               ,SOD.EZUPTIMEZONE                                 AS EZUPTIMEZONE_SOD
               ,ROW_NUMBER() OVER(PARTITION BY SO.GLBL_CMPY_CD ORDER BY SO.TRX_HDR_NUM, SO.SO_NUM, SOD.SO_SLP_NUM) AS ROW_NUM
               ,SOCD.CTRY_CD                                     AS CTRY_CD
            FROM
                SHPG_ORD             SO
               ,SHPG_STS             SS
               ,SCHD_COORD_STS       SCS
               ,S21_PSN              PSN
               ,VND                  V
               ,CARR_TP              CT
               ,SHPG_ORD_CUST_DTL    SOCD
               ,RTL_WH               RW
               ,WH_OWNR              WO
               ,PRCH_REQ             PR
               ,PRCH_REQ_DTL         PRD
               ,MDL_NM               MN
               ,SVC_CONFIG_MSTR      SCM
               ,SHIP_TO_CUST         STC
               ,LOC_TP               LT
               ,SHPG_ORD_DTL         SOD
               ,MDSE                 M
               ,BACK_ORD_IMPCT_TP    BOIT
               ,DS_SO_LINE_STS       DSLS
               ,SHPG_SVC_LVL         SSL
               ,SO_RWS_SCR_CANC_CTRL SRCC
               ,DS_COND_CONST        CONC
               ,SHPG_PLN             SP
               ,MDSE_STORE_PKG       MSP
               ,CARR_RSN             CR
            WHERE
                SO.GLBL_CMPY_CD              = #glblCmpyCd#
            <isNotNull property="cMsg.soNum">
            AND SO.SO_NUM                    = #cMsg.soNum#
            </isNotNull>
            <isNotNull property="soNumList">
                <iterate property="soNumList" var="soNumList[]" open="AND SO.SO_NUM IN (" conjunction= ", " close=")">
                    #soNumList[]#
                </iterate>
            </isNotNull>
            <isNotNull property="includeSceOrdTpList">
                <iterate property="includeSceOrdTpList" var="includeSceOrdTpList[]" open="AND SO.SCE_ORD_TP_CD IN (" conjunction= ", " close=")">
                    #includeSceOrdTpList[]#
                </iterate>
            </isNotNull>
            <isNotNull property="cMsg.rtlWhCd">
            AND SO.WH_CD                     = #cMsg.rtlWhCd#
            </isNotNull>
            <isNotNull property="cMsg.trxHdrNum">
            AND SO.SRC_ORD_NUM               = #cMsg.trxHdrNum#
            </isNotNull>
            <isNotNull property="cMsg.shipToCustCd">
            AND SO.SHIP_TO_CUST_CD           = #cMsg.shipToCustCd#
            </isNotNull>
            <isNotNull property="cMsg.rddDt_FR">
            AND SO.RDD_DT                &gt;= #cMsg.rddDt_FR#
            </isNotNull>
            <isNotNull property="cMsg.rddDt_TO">
            AND SO.RDD_DT                &lt;= #cMsg.rddDt_TO#
            </isNotNull>
            <isNotNull property="cMsg.wmsDropFlg_Y">
                <isNull property="cMsg.wmsDropFlg_N">
                AND SO.WMS_DROP_FLG          = #flgY#
                </isNull>
            </isNotNull>
            <isNotNull property="cMsg.wmsDropFlg_N">
                <isNull property="cMsg.wmsDropFlg_Y">
                AND SO.WMS_DROP_FLG          = #flgN#
                </isNull>
            </isNotNull>
            <isNotNull property="cMsg.svcConfigMstrPk">
            AND SO.SVC_CONFIG_MSTR_PK        = #cMsg.svcConfigMstrPk#
            </isNotNull>
            <isNotNull property="cMsg.delyReqFlg_Y">
                <isNull property="cMsg.delyReqFlg_N">
                AND (   SO.DELY_REQ_FLG  = #flgY#
                     OR (SO.DELY_REQ_FLG  = #flgN# AND SO.DELY_REQ_TS   IS NOT NULL)
                    )
                </isNull>
            </isNotNull>
            <isNotNull property="cMsg.delyReqFlg_N">
                <isNull property="cMsg.delyReqFlg_Y">
                AND (   SO.DELY_REQ_FLG  = #flgN#
                     AND SO.DELY_REQ_TS   IS NULL
                    )
                </isNull>
            </isNotNull>
            AND SO.EZCANCELFLAG              = '0'
            AND SO.GLBL_CMPY_CD              = SS.GLBL_CMPY_CD
            AND SO.SHPG_STS_CD               = SS.SHPG_STS_CD
            AND SS.EZCANCELFLAG              = '0'
            <isNotNull property="cMsg.shpgSvcLvlCd">
            AND SO.SHPG_SVC_LVL_CD           = #cMsg.shpgSvcLvlCd#
            </isNotNull>
            <isNotNull property="cMsg.schdCoordStsCd">
            AND SO.SCHD_COORD_STS_CD         = #cMsg.schdCoordStsCd#
            </isNotNull>
            <isNotNull property="cMsg.carrCd">
            AND SO.CARR_CD                   = #cMsg.carrCd#
            </isNotNull>
            <isNotNull property="cMsg.schdCoordPsnCd">
            AND SO.SCHD_COORD_PSN_CD         = #cMsg.schdCoordPsnCd#
            </isNotNull>
            <isNotNull property="cMsg.schdDelyDt_FR">
            AND SO.SCHD_DELY_DT          &gt;= #cMsg.schdDelyDt_FR#
            </isNotNull>
            <isNotNull property="cMsg.schdDelyDt_TO">
            AND SO.SCHD_DELY_DT          &lt;= #cMsg.schdDelyDt_TO#
            </isNotNull>
            <isNotNull property="cMsg.schdCarrPickUpDt_FR">
            AND SO.SCHD_CARR_PICK_UP_DT  &gt;= #cMsg.schdCarrPickUpDt_FR#
            </isNotNull>
            <isNotNull property="cMsg.schdCarrPickUpDt_TO">
            AND SO.SCHD_CARR_PICK_UP_DT  &lt;= #cMsg.schdCarrPickUpDt_TO#
            </isNotNull>
            <isNotNull property="cMsg.svcConfigMstrPk">
            AND SO.SVC_CONFIG_MSTR_PK        = #cMsg.svcConfigMstrPk#
            </isNotNull>
            AND SO.EZCANCELFLAG              = '0'
            AND SO.GLBL_CMPY_CD              = SCS.GLBL_CMPY_CD
            AND SO.SCHD_COORD_STS_CD         = SCS.SCHD_COORD_STS_CD
            AND SCS.EZCANCELFLAG             = '0'
            AND SO.GLBL_CMPY_CD              = PSN.GLBL_CMPY_CD(+)
            AND SO.SCHD_COORD_PSN_CD         = PSN.PSN_CD(+)
            AND PSN.EZCANCELFLAG(+)          = '0'
            AND SO.GLBL_CMPY_CD              = V.GLBL_CMPY_CD(+)
            AND SO.CARR_CD                   = V.VND_CD(+)
            AND V.EZCANCELFLAG(+)            = '0'
            AND V.GLBL_CMPY_CD               = CT.GLBL_CMPY_CD(+)
            AND V.CARR_TP_CD                 = CT.CARR_TP_CD(+)
            AND CT.EZCANCELFLAG(+)           = '0'
            AND SO.GLBL_CMPY_CD              = SOCD.GLBL_CMPY_CD
            AND SO.SO_NUM                    = SOCD.SO_NUM
            AND SOCD.SO_CUST_DATA_TP_CD      = #soCustDataTpShipTo#
            AND SOCD.EZCANCELFLAG            = '0'
            AND SO.GLBL_CMPY_CD              = RW.GLBL_CMPY_CD
            AND SO.WH_CD                     = RW.RTL_WH_CD
            AND RW.EZCANCELFLAG              = '0'
            AND RW.GLBL_CMPY_CD              = WO.GLBL_CMPY_CD
            AND RW.WH_OWNR_CD                = WO.WH_OWNR_CD
            AND WO.EZCANCELFLAG              = '0'
            AND SO.GLBL_CMPY_CD              = PR.GLBL_CMPY_CD
            AND SO.SRC_ORD_NUM               = PR.PRCH_REQ_NUM
            AND PR.EZCANCELFLAG               = '0'
            AND SOD.GLBL_CMPY_CD             = PRD.GLBL_CMPY_CD
            AND SOD.PRCH_REQ_NUM             = PRD.PRCH_REQ_NUM
            AND SOD.PRCH_REQ_LINE_NUM        = PRD.PRCH_REQ_LINE_NUM
            AND SOD.PRCH_REQ_LINE_SUB_NUM    = PRD.PRCH_REQ_LINE_SUB_NUM
            AND PRD.EZCANCELFLAG              = '0'
            <isNull property="cMsg.t_MdlNm">
            AND SO.GLBL_CMPY_CD              = MN.T_GLBL_CMPY_CD(+)
            AND SO.MDL_ID                    = MN.T_MDL_ID(+)
            AND MN.EZCANCELFLAG(+)           = '0'
            </isNull>
            <isNotNull property="cMsg.t_MdlNm">
            AND SO.GLBL_CMPY_CD              = MN.T_GLBL_CMPY_CD
            AND SO.MDL_ID                    = MN.T_MDL_ID
            AND MN.T_MDL_NM                  = #cMsg.t_MdlNm#
            AND MN.EZCANCELFLAG              = '0'
            </isNotNull>
            AND SO.GLBL_CMPY_CD              = SCM.GLBL_CMPY_CD(+)
            AND SO.SVC_CONFIG_MSTR_PK        = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.EZCANCELFLAG(+)          = '0'
            AND SO.GLBL_CMPY_CD              = STC.GLBL_CMPY_CD
            AND SO.SHIP_TO_CUST_CD           = STC.SHIP_TO_CUST_CD
            AND STC.EZCANCELFLAG             = '0'
            AND STC.GLBL_CMPY_CD             = LT.GLBL_CMPY_CD
            AND STC.LOC_GRP_CD               = LT.LOC_GRP_CD
            AND STC.LOC_ROLE_TP_CD           = LT.LOC_ROLE_TP_CD
            AND LT.EZCANCELFLAG              = '0'
            AND SO.GLBL_CMPY_CD              = SOD.GLBL_CMPY_CD
            AND SO.SO_NUM                    = SOD.SO_NUM
            <isNotNull property="cMsg.dsSoLineStsCd">
            AND SOD.DS_SO_LINE_STS_CD        = #cMsg.dsSoLineStsCd#
            </isNotNull>
            <isNotNull property="cMsg.rtlSwhCd">
            AND SOD.RTL_SWH_CD               = #cMsg.rtlSwhCd#
            </isNotNull>
            <isNotNull property="cMsg.actlDelyDt_FR">
            AND SOD.ACTL_DELY_DT         &gt;= #cMsg.actlDelyDt_FR#
            </isNotNull>
            <isNotNull property="cMsg.actlDelyDt_TO">
            AND SOD.ACTL_DELY_DT         &lt;= #cMsg.actlDelyDt_TO#
            </isNotNull>
            AND SOD.EZCANCELFLAG             = '0'
            AND SOD.GLBL_CMPY_CD             = SP.GLBL_CMPY_CD
            AND SOD.SHPG_PLN_NUM             = SP.SHPG_PLN_NUM
            AND SP.EZCANCELFLAG              = '0'
            AND SOD.GLBL_CMPY_CD             = M.GLBL_CMPY_CD
            AND SOD.MDSE_CD                  = M.MDSE_CD
            AND M.EZCANCELFLAG               = '0'
            AND M.GLBL_CMPY_CD               = BOIT.GLBL_CMPY_CD(+)
            AND M.BACK_ORD_IMPCT_TP_CD       = BOIT.BACK_ORD_IMPCT_TP_CD(+)
            AND BOIT.EZCANCELFLAG(+)         = '0'
            AND SOD.GLBL_CMPY_CD             = DSLS.GLBL_CMPY_CD
            AND SOD.DS_SO_LINE_STS_CD        = DSLS.DS_SO_LINE_STS_CD
            AND DSLS.EZCANCELFLAG            = '0'
            AND SO.GLBL_CMPY_CD              = SSL.GLBL_CMPY_CD(+)
            AND SO.SHPG_SVC_LVL_CD           = SSL.SHPG_SVC_LVL_CD(+)
            AND SSL.EZCANCELFLAG(+)          = '0'
            AND SO.GLBL_CMPY_CD              = SRCC.GLBL_CMPY_CD(+)
            AND SO.SCE_ORD_TP_CD             = SRCC.SCE_ORD_TP_CD(+)
            AND RW.WH_SYS_TP_CD              = SRCC.WH_SYS_TP_CD(+)
            AND SRCC.EZCANCELFLAG(+)         = '0'
            AND SO.GLBL_CMPY_CD              = CONC.GLBL_CMPY_CD(+)
            AND SO.SCE_ORD_TP_CD             = CONC.DS_COND_CONST_CD(+)
            AND CONC.DS_COND_CONST_GRP_ID(+) = #dsCondConstShipCtrl#
            AND CONC.EZCANCELFLAG(+)         = '0'
            AND SP.GLBL_CMPY_CD              = MSP.GLBL_CMPY_CD(+)
            AND SP.MDSE_CD                   = MSP.MDSE_CD(+)
            AND SP.CUST_UOM_CD               = MSP.PKG_UOM_CD(+)
            AND MSP.EZCANCELFLAG(+)          = '0'
            AND SOD.GLBL_CMPY_CD             = CR.GLBL_CMPY_CD(+)
            AND SOD.CARR_RSN_CD              = CR.CARR_RSN_CD(+)
            AND CR.EZCANCELFLAG(+)           = '0'
            <!-- END 2021/05/31 A.Marte [QC#58786,ADD] -->
        )
        , PKT_V AS (
            SELECT
                 P.GLBL_CMPY_CD
                ,P.SO_NUM
                ,P.SO_SLP_NUM
                ,MAX(
                    CASE
                        WHEN P.DS_SO_LINE_STS_CD = '30' THEN P.PKT_STS_TS
                        ELSE NULL
                    END
                ) PKT_STS_TS_PC
                ,MAX(
                    CASE
                        WHEN P.DS_SO_LINE_STS_CD = '40' THEN P.PKT_STS_TS
                        ELSE NULL
                    END
                ) PKT_STS_TS_DS
                ,MAX(
                    CASE
                        WHEN P.DS_SO_LINE_STS_CD = '50' THEN P.PKT_STS_TS
                        ELSE NULL
                    END
                ) PKT_STS_TS_TA
                ,MAX(
                    CASE
                        WHEN P.DS_SO_LINE_STS_CD = '60' THEN P.PKT_STS_TS
                        ELSE NULL
                    END
                ) PKT_STS_TS_DD
            FROM
                SO_DTL_V SDV
               ,PKT      P
            WHERE
                P.GLBL_CMPY_CD = SDV.GLBL_CMPY_CD
            AND P.SO_NUM       = SDV.SO_NUM
            AND P.SO_SLP_NUM   = SDV.SO_SLP_NUM
            AND P.EZCANCELFLAG = '0'
            GROUP BY
                P.GLBL_CMPY_CD
               ,P.SO_NUM
               ,P.SO_SLP_NUM
        )
        <!-- QC#22613 Add Start -->
        , PKT_OR AS (
            SELECT
                 PK.GLBL_CMPY_CD
                ,PK.SO_NUM
                ,PK.SO_SLP_NUM
                ,PK.PKT_STS_TS    PKT_STS_TS_OR
            FROM
                PKT PK
               ,(SELECT
                     P.GLBL_CMPY_CD
                    ,P.SO_NUM
                    ,P.SO_SLP_NUM
                    ,MAX(P.PKT_SQ_NUM) MAX_PKT_SQ_NUM
                 FROM
                     SO_DTL_V SDV
                     ,PKT     P
                 WHERE
                     P.GLBL_CMPY_CD = SDV.GLBL_CMPY_CD
                 AND P.SO_NUM       = SDV.SO_NUM
                 AND P.SO_SLP_NUM   = SDV.SO_SLP_NUM
                 AND P.DS_SO_LINE_STS_CD &lt;= #dsSoLineStsAS#
                 AND P.EZCANCELFLAG = '0'
                 GROUP BY
                     P.GLBL_CMPY_CD
                    ,P.SO_NUM
                    ,P.SO_SLP_NUM
                ) P_MAX
            WHERE
                PK.GLBL_CMPY_CD = P_MAX.GLBL_CMPY_CD
            AND PK.SO_NUM       = P_MAX.SO_NUM
            AND PK.SO_SLP_NUM   = P_MAX.SO_SLP_NUM
            AND PK.PKT_SQ_NUM   = P_MAX.MAX_PKT_SQ_NUM
        )
        <!-- QC#22613 Add End -->
        SELECT
            GLBL_CMPY_CD
           ,SHIP_SVC_CONFIG_MSTR_PK
           ,CPO_ORD_NUM
           ,TRX_LINE_NUM
           <!-- QC#21913 Add. -->
           ,TRX_LINE_SUB_NUM
           ,DPLY_LINE_NUM
           ,SO_NUM
           ,SO_SLP_NUM
           ,SCHD_COORD_PSN_NM
           ,RTL_WH_CD
           ,RTL_SWH_CD
           ,INVTY_LOC_CD
           ,RTL_WH_NM
           ,RTL_WH_FIRST_LINE_ADDR
           ,RTL_WH_CTY_ADDR
           ,RTL_WH_ST_CD
           ,RTL_WH_POST_CD
           ,XX_PSN_FIRST_MID_LAST_NM
           ,MDSE_CD
           ,MDSE_DESC_SHORT_TXT
           ,BACK_ORD_IMPCT_TP_DESC_TXT
           ,SHIP_QTY
           ,RDD_DT
           ,SCHD_DELY_DT
           ,SCHD_DELY_TM
           ,CASE WHEN SCHD_DELY_DT IS NOT NULL AND LENGTH(SCHD_DELY_TM) >= 4 THEN TO_CHAR(TO_DATE(SCHD_DELY_DT || SUBSTR(SCHD_DELY_TM,1,4), 'YYYYMMDDHH24MI'), 'MM/DD/YYYY HH24:MI:SS')
                 WHEN SCHD_DELY_DT IS NOT NULL AND SCHD_DELY_TM IS NULL THEN TO_CHAR(TO_DATE(SCHD_DELY_DT, 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS SCHD_DELY_DT_TM
           ,CASE WHEN LENGTH(PKT_STS_TS_PC) >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_PC,1,14), 'YYYYMMDDHH24MISS'), 'MM/DD/YYYY HH24:MI:SS')
                 WHEN LENGTH(PKT_STS_TS_PC) >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_PC,1,12), 'YYYYMMDDHH24MI'), 'MM/DD/YYYY HH24:MI')
                 WHEN LENGTH(PKT_STS_TS_PC) >= 8  THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_PC,1,8), 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS PKT_STS_TS_PC
           ,CASE WHEN LENGTH(PKT_STS_TS_DS) >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_DS,1,14), 'YYYYMMDDHH24MISS'), 'MM/DD/YYYY HH24:MI:SS')
                 WHEN LENGTH(PKT_STS_TS_DS) >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_DS,1,12), 'YYYYMMDDHH24MI'), 'MM/DD/YYYY HH24:MI')
                 WHEN LENGTH(PKT_STS_TS_DS) >= 8  THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_DS,1,8), 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS PKT_STS_TS_DS
           ,CASE WHEN LENGTH(PKT_STS_TS_TA) >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_TA,1,14), 'YYYYMMDDHH24MISS'), 'MM/DD/YYYY HH24:MI:SS')
                 WHEN LENGTH(PKT_STS_TS_TA) >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_TA,1,12), 'YYYYMMDDHH24MI'), 'MM/DD/YYYY HH24:MI')
                 WHEN LENGTH(PKT_STS_TS_TA) >= 8  THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_TA,1,8), 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS PKT_STS_TS_TA
           ,CASE WHEN LENGTH(PKT_STS_TS_DD) >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_DD,1,14), 'YYYYMMDDHH24MISS'), 'MM/DD/YYYY HH24:MI:SS')
                 WHEN LENGTH(PKT_STS_TS_DD) >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_DD,1,12), 'YYYYMMDDHH24MI'), 'MM/DD/YYYY HH24:MI')
                 WHEN LENGTH(PKT_STS_TS_DD) >= 8  THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_DD,1,8), 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS PKT_STS_TS_DD
           ,CASE WHEN LENGTH(SHIP_DT_TM_TS) >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(SHIP_DT_TM_TS,1,14), 'YYYYMMDDHH24MISS'), 'MM/DD/YYYY HH24:MI:SS')
                 WHEN LENGTH(SHIP_DT_TM_TS) >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(SHIP_DT_TM_TS,1,12), 'YYYYMMDDHH24MI'), 'MM/DD/YYYY HH24:MI')
                 WHEN LENGTH(SHIP_DT_TM_TS) >= 8  THEN TO_CHAR(TO_DATE(SUBSTR(SHIP_DT_TM_TS,1,8), 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS SHIP_DT_TM_TS2
           ,CASE WHEN LENGTH(PKT_STS_TS_PC) >= 8  THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_PC,1,8), 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS PKT_STS_DT_PC
           ,CASE WHEN LENGTH(PKT_STS_TS_PC) >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_PC,9,6), 'HH24MISS'), 'HH24:MI:SS')
                 WHEN LENGTH(PKT_STS_TS_PC) >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_PC,9,4), 'HH24MI'), 'HH24:MI')
            END AS PKT_STS_TM_PC
           ,CASE WHEN LENGTH(PKT_STS_TS_DS) >= 8  THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_DS,1,8), 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS PKT_STS_DT_DS
           ,CASE WHEN LENGTH(PKT_STS_TS_DS) >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_DS,9,6), 'HH24MISS'), 'HH24:MI:SS')
                 WHEN LENGTH(PKT_STS_TS_DS) >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_DS,9,4), 'HH24MI'), 'HH24:MI')
            END AS PKT_STS_TM_DS
           ,CASE WHEN LENGTH(PKT_STS_TS_TA) >= 8  THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_TA,1,8), 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS PKT_STS_DT_TA
           ,CASE WHEN LENGTH(PKT_STS_TS_TA) >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_TA,9,6), 'HH24MISS'), 'HH24:MI:SS')
                 WHEN LENGTH(PKT_STS_TS_TA) >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_TA,9,4), 'HH24MI'), 'HH24:MI')
            END AS PKT_STS_TM_TA
           ,CASE WHEN LENGTH(PKT_STS_TS_DD) >= 8  THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_DD,1,8), 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS PKT_STS_DT_DD
           ,CASE WHEN LENGTH(PKT_STS_TS_DD) >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_DD,9,6), 'HH24MISS'), 'HH24:MI:SS')
                 WHEN LENGTH(PKT_STS_TS_DD) >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_DD,9,4), 'HH24MI'), 'HH24:MI')
            END AS PKT_STS_TM_DD
           ,CASE WHEN LENGTH(SHIP_DT_TM_TS) >= 8  THEN TO_CHAR(TO_DATE(SUBSTR(SHIP_DT_TM_TS,1,8), 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS SHIP_DT_TM_DT
           ,CASE WHEN LENGTH(SHIP_DT_TM_TS) >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(SHIP_DT_TM_TS,9,6), 'HH24MISS'), 'HH24:MI:SS')
                 WHEN LENGTH(SHIP_DT_TM_TS) >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(SHIP_DT_TM_TS,9,4), 'HH24MI'), 'HH24:MI')
            END AS SHIP_DT_TM_TM
           ,SHIP_DT_TM_TS
           ,CARR_RSN_CD
           ,CARR_RSN_DESC_TXT
           ,ACTL_DELY_DT
           ,ACTL_DELY_TM
           ,CASE WHEN ACTL_DELY_DT IS NOT NULL AND LENGTH(ACTL_DELY_TM) >= 4 THEN TO_CHAR(TO_DATE(ACTL_DELY_DT || SUBSTR(ACTL_DELY_TM,1,4), 'YYYYMMDDHH24MI'), 'MM/DD/YYYY HH24:MI')
                 WHEN ACTL_DELY_DT IS NOT NULL AND ACTL_DELY_TM IS NULL THEN TO_CHAR(TO_DATE(ACTL_DELY_DT, 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS ACTL_DELY_DT_TM
           ,CASE WHEN ACTL_DELY_DT IS NOT NULL THEN TO_CHAR(TO_DATE(ACTL_DELY_DT, 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS ACTL_DELY_DT
           ,CASE WHEN LENGTH(ACTL_DELY_TM) >= 4 THEN TO_CHAR(TO_DATE(SUBSTR(ACTL_DELY_TM,1,4), 'HH24MI'), 'HH24:MI')
            END AS ACTL_DELY_TM
           ,SVC_TASK_CPLT_DT
           ,SVC_TASK_STS_DESC_TXT
           ,DS_SO_LINE_STS_DESC_TXT
           ,CARR_CD
           ,CARR_NM
           ,PRO_NUM
           ,PRO_NUM_BD
           ,SHPG_SVC_LVL_CD
           ,SHPG_SVC_LVL_DESC_TXT
           ,SCHD_COORD_STS_DESC_TXT
           ,CASE WHEN LENGTH(DELY_REQ_TS) >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(DELY_REQ_TS,1,14), 'YYYYMMDDHH24MISS'), 'MM/DD/YYYY HH24:MI:SS')
                 WHEN LENGTH(DELY_REQ_TS) >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(DELY_REQ_TS,1,12), 'YYYYMMDDHH24MI'), 'MM/DD/YYYY HH24:MI')
                 WHEN LENGTH(DELY_REQ_TS) >= 8  THEN TO_CHAR(TO_DATE(SUBSTR(DELY_REQ_TS,1,8), 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS DELY_REQ_TS
           ,CASE WHEN LENGTH(DELY_REQ_TS) >= 8  THEN TO_CHAR(TO_DATE(SUBSTR(DELY_REQ_TS,1,8), 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS DELY_REQ_DT
           ,CASE WHEN LENGTH(DELY_REQ_TS) >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(DELY_REQ_TS,9,6), 'HH24MISS'), 'HH24:MI:SS')
                 WHEN LENGTH(DELY_REQ_TS) >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(DELY_REQ_TS,9,4), 'HH24MI'), 'HH24:MI')
            END AS DELY_REQ_TM 
           ,TOT_FRT_AMT
           ,DS_ACCT_NUM
           ,SHIP_TO_CUST_CD
           ,SHIP_TO_CUST_NM
           ,SHIP_TO_LINE_ADDR_01
           ,SHIP_TO_CTY_ADDR
           ,SHIP_TO_ST_CD
           ,SHIP_TO_POST_CD
           ,PICK_SVC_CONFIG_MSTR_PK
           ,STK_STS_CD
           ,DS_ORD_CATG_DESC_TXT
           ,SCE_ORD_TP_CD
           ,CARR_ACCT_NUM
           ,ORD_OPEN_FLG
           ,SO_LINE_OPEN_FLG
           ,SHIP_FLG
           ,SO_SCR_CANC_AVAL_FLG
           ,SO_LINE_SHIP_AVAL_FLG
           ,SO_LINE_PART_SHIP_AVAL_FLG
           ,WMS_DROP_FLG
           ,WMS_DROP_READY_FLG
           ,WH_MAN_SEND_RQST_FLG
           ,CARR_MAN_SEND_RQST_FLG
           ,SEND_RQST_FLG
           ,SET_MDSE_CD
           ,SET_SHPG_PLN_NUM
           ,UOM_EACH_QTY
           ,INVTY_ACCT_CD
           ,SER_NUM_TAKE_FLG
           ,INSTL_BASE_CTRL_FLG
           ,ORD_CARR_CD
           ,MDL_ID
           ,EZUPTIME_SO
           ,EZUPTIMEZONE_SO
           ,EZUPTIME_SOD
           ,EZUPTIMEZONE_SOD
       <!-- START 2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
           ,CTRY_CD
       <!-- END   2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
       <!-- QC#22613 Add Start -->
           ,CASE WHEN LENGTH(PKT_STS_TS_OR) >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_OR,1,14), 'YYYYMMDDHH24MISS'), 'MM/DD/YYYY HH24:MI:SS')
                 WHEN LENGTH(PKT_STS_TS_OR) >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_OR,1,12), 'YYYYMMDDHH24MI'), 'MM/DD/YYYY HH24:MI')
                 WHEN LENGTH(PKT_STS_TS_OR) >= 8  THEN TO_CHAR(TO_DATE(SUBSTR(PKT_STS_TS_OR,1,8), 'YYYYMMDD'), 'MM/DD/YYYY')
            END AS PKT_STS_TS_OR
       <!-- QC#22613 Add Start -->
        FROM
             (
             SELECT
                 SV.GLBL_CMPY_CD
                ,SV.SHIP_SVC_CONFIG_MSTR_PK
                ,SV.CPO_ORD_NUM
                ,SV.TRX_LINE_NUM
                <!-- QC#21913 Add. -->
                ,SV.TRX_LINE_SUB_NUM
                ,SV.DPLY_LINE_NUM
                ,SV.SO_NUM
                ,SV.SO_SLP_NUM
                ,SV.SCHD_COORD_PSN_NM
                ,SV.RTL_WH_CD
                ,SV.RTL_SWH_CD
                ,SV.INVTY_LOC_CD
                ,SV.RTL_WH_NM
                ,SV.RTL_WH_FIRST_LINE_ADDR
                ,SV.RTL_WH_CTY_ADDR
                ,SV.RTL_WH_ST_CD
                ,SV.RTL_WH_POST_CD
                ,SV.XX_PSN_FIRST_MID_LAST_NM
                ,SV.MDSE_CD
                ,SV.MDSE_DESC_SHORT_TXT
                ,SV.BACK_ORD_IMPCT_TP_DESC_TXT
                ,COND.SHIP_QTY
                ,SV.RDD_DT
                ,SV.SCHD_DELY_DT
                ,SV.SCHD_DELY_TM
                ,PV.PKT_STS_TS_PC
                ,PV.PKT_STS_TS_DS
                ,PV.PKT_STS_TS_TA
                ,PV.PKT_STS_TS_DD
                ,COND.SHIP_DT_TM_TS
                ,SV.CARR_RSN_CD
                ,SV.CARR_RSN_DESC_TXT
                ,SV.ACTL_DELY_DT
                ,SV.ACTL_DELY_TM
                ,SVT.SVC_TASK_CPLT_DT
                ,STS.SVC_TASK_STS_DESC_TXT
                ,SV.DS_SO_LINE_STS_DESC_TXT
                ,COND.VND_CD                     AS CARR_CD
                ,CASE WHEN CV.LOC_NM IS NULL AND COND.VND_CD != '*' THEN COND.VND_CD
                      ELSE CV.LOC_NM
                 END                             AS CARR_NM
                ,CASE WHEN COND.PRO_NUM != '*' THEN COND.PRO_NUM
                      WHEN COND.PRO_NUM = '*' AND COND.BOL_NUM != '*' THEN COND.BOL_NUM
                      ELSE NULL
                 END                             AS PRO_NUM
                ,CASE WHEN COND.PRO_NUM = '*' THEN NULL
                      ELSE COND.PRO_NUM
                 END                             AS PRO_NUM_BD
                ,SV.SHPG_SVC_LVL_CD
                ,SV.SHPG_SVC_LVL_DESC_TXT
                ,SV.SCHD_COORD_STS_DESC_TXT
                ,SV.DELY_REQ_TS
                ,NVL(COND.TOT_FRT_AMT, 0) AS TOT_FRT_AMT
                ,SV.DS_ACCT_NUM
                ,SV.SHIP_TO_CUST_CD
                ,SV.SHIP_TO_CUST_NM
                ,SV.SHIP_TO_LINE_ADDR_01
                ,SV.SHIP_TO_CTY_ADDR
                ,SV.SHIP_TO_ST_CD
                ,SV.SHIP_TO_POST_CD
                ,SV.PICK_SVC_CONFIG_MSTR_PK
                ,SV.STK_STS_CD
                ,SV.DS_ORD_CATG_DESC_TXT
                ,SV.SCE_ORD_TP_CD
                ,SV.CARR_ACCT_NUM
                ,SV.ORD_OPEN_FLG
                ,#flgN# AS SO_LINE_OPEN_FLG
                ,#flgY# AS SHIP_FLG
                ,SV.SO_SCR_CANC_AVAL_FLG
                ,SV.SO_LINE_SHIP_AVAL_FLG
                ,SV.SO_LINE_PART_SHIP_AVAL_FLG
                ,SV.WMS_DROP_FLG
                ,SV.WMS_DROP_READY_FLG
                ,SV.WH_MAN_SEND_RQST_FLG
                ,SV.CARR_MAN_SEND_RQST_FLG
                ,SV.SEND_RQST_FLG
                ,SV.SET_MDSE_CD
                ,SV.SET_SHPG_PLN_NUM
                ,SV.UOM_EACH_QTY
                ,SV.INVTY_ACCT_CD
                ,SV.SVC_MACH_MSTR_PK
                ,SV.SER_NUM_TAKE_FLG
                ,SV.INSTL_BASE_CTRL_FLG
                ,SV.ORD_CARR_CD
                ,SV.MDL_ID
                ,SV.EZUPTIME_SO
                ,SV.EZUPTIMEZONE_SO
                ,SV.EZUPTIME_SOD
                ,SV.EZUPTIMEZONE_SOD
       <!-- START 2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
                ,SV.CTRY_CD
       <!-- END   2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
             <!-- QC#22613 Add Start -->
                ,POR.PKT_STS_TS_OR
             <!-- QC#22613 Add End -->
             FROM
                 SO_DTL_V          SV
                ,PKT_V             PV
                ,SHPG_ORD_CONF_DTL COND
                ,VND               CV
                ,SVC_TASK          SVT
                ,SVC_TASK_STS      STS
             <!-- QC#22613 Add Start -->
                ,PKT_OR            POR
             <!-- QC#22613 Add End -->
             WHERE
                 SV.GLBL_CMPY_CD     = PV.GLBL_CMPY_CD(+)
             AND SV.SO_NUM           = PV.SO_NUM(+)
             AND SV.SO_SLP_NUM       = PV.SO_SLP_NUM(+)
             AND SV.GLBL_CMPY_CD     = COND.GLBL_CMPY_CD
             AND SV.SO_NUM           = COND.SO_NUM
             AND SV.SO_SLP_NUM       = COND.SO_SLP_NUM
             AND COND.SO_PROC_STS_CD = #soProcSts#
             AND COND.EZCANCELFLAG   = '0'
             AND COND.GLBL_CMPY_CD   = CV.GLBL_CMPY_CD(+)
             AND COND.VND_CD         = CV.VND_CD(+)
             AND CV.EZCANCELFLAG(+)  = '0'
             AND SV.GLBL_CMPY_CD     = SVT.GLBL_CMPY_CD(+)
             AND SV.SVC_TASK_NUM     = SVT.SVC_TASK_NUM(+)
             AND SVT.EZCANCELFLAG(+) = '0'
             AND SVT.GLBL_CMPY_CD    = STS.GLBL_CMPY_CD(+)
             AND SVT.SVC_TASK_STS_CD = STS.SVC_TASK_STS_CD(+)
             AND STS.EZCANCELFLAG(+) = '0'
             <!-- QC#22613 Add Start -->
             AND SV.GLBL_CMPY_CD     = POR.GLBL_CMPY_CD(+)
             AND SV.SO_NUM           = POR.SO_NUM(+)
             AND SV.SO_SLP_NUM       = POR.SO_SLP_NUM(+)
             <!-- QC#22613 Add Start -->
             AND SV.ROW_NUM      &lt;= #rownum#
             <isNull property="cMsg.bolNum">
             UNION
             SELECT
                 SV.GLBL_CMPY_CD
                ,SV.SHIP_SVC_CONFIG_MSTR_PK
                ,SV.CPO_ORD_NUM
                ,SV.TRX_LINE_NUM
                <!-- QC#21913 Add. -->
                ,SV.TRX_LINE_SUB_NUM
                ,SV.DPLY_LINE_NUM
                ,SV.SO_NUM
                ,SV.SO_SLP_NUM
                ,SV.SCHD_COORD_PSN_NM
                ,SV.RTL_WH_CD
                ,SV.RTL_SWH_CD
                ,SV.INVTY_LOC_CD
                ,SV.RTL_WH_NM
                ,SV.RTL_WH_FIRST_LINE_ADDR
                ,SV.RTL_WH_CTY_ADDR
                ,SV.RTL_WH_ST_CD
                ,SV.RTL_WH_POST_CD
                ,SV.XX_PSN_FIRST_MID_LAST_NM
                ,SV.MDSE_CD
                ,SV.MDSE_DESC_SHORT_TXT
                ,SV.BACK_ORD_IMPCT_TP_DESC_TXT
                ,SV.SHPG_BAL_QTY AS SHIP_QTY
                ,SV.RDD_DT
                ,SV.SCHD_DELY_DT
                ,SV.SCHD_DELY_TM
                ,PV.PKT_STS_TS_PC
                ,PV.PKT_STS_TS_DS
                ,PV.PKT_STS_TS_TA
                ,PV.PKT_STS_TS_DD
                ,NULL            AS SHIP_DT_TM_TS
                ,NULL            AS CARR_RSN_CD
                ,NULL            AS CARR_RSN_DESC_TXT
                ,NULL            AS ACTL_DELY_DT
                ,NULL            AS ACTL_DELY_TM
                ,SVT.SVC_TASK_CPLT_DT
                ,STS.SVC_TASK_STS_DESC_TXT
                ,SV.DS_SO_LINE_STS_DESC_TXT
                ,SV.SCHD_CARR_CD AS CARR_CD
                ,SV.SCHD_CARR_NM AS CARR_NM
                ,NULL            AS PRO_NUM
                ,NULL            AS PRO_NUM_BD
                ,SV.SHPG_SVC_LVL_CD
                ,SV.SHPG_SVC_LVL_DESC_TXT
                ,SV.SCHD_COORD_STS_DESC_TXT
                ,SV.DELY_REQ_TS
                ,NULL            AS TOT_FRT_AMT
                ,SV.DS_ACCT_NUM
                ,SV.SHIP_TO_CUST_CD
                ,SV.SHIP_TO_CUST_NM
                ,SV.SHIP_TO_LINE_ADDR_01
                ,SV.SHIP_TO_CTY_ADDR
                ,SV.SHIP_TO_ST_CD
                ,SV.SHIP_TO_POST_CD
                ,SV.PICK_SVC_CONFIG_MSTR_PK
                ,SV.STK_STS_CD
                ,SV.DS_ORD_CATG_DESC_TXT
                ,SV.SCE_ORD_TP_CD
                ,SV.CARR_ACCT_NUM
                ,SV.ORD_OPEN_FLG
                ,SV.SO_LINE_OPEN_FLG
                ,#flgN# AS SHIP_FLG
                ,SV.SO_SCR_CANC_AVAL_FLG
                ,SV.SO_LINE_SHIP_AVAL_FLG
                ,SV.SO_LINE_PART_SHIP_AVAL_FLG
                ,SV.WMS_DROP_FLG
                ,SV.WMS_DROP_READY_FLG
                ,SV.WH_MAN_SEND_RQST_FLG
                ,SV.CARR_MAN_SEND_RQST_FLG
                ,SV.SEND_RQST_FLG
                ,SV.SET_MDSE_CD
                ,SV.SET_SHPG_PLN_NUM
                ,SV.UOM_EACH_QTY
                ,SV.INVTY_ACCT_CD
                ,SV.SVC_MACH_MSTR_PK
                ,SV.SER_NUM_TAKE_FLG
                ,SV.INSTL_BASE_CTRL_FLG
                ,SV.ORD_CARR_CD
                ,SV.MDL_ID
                ,SV.EZUPTIME_SO
                ,SV.EZUPTIMEZONE_SO
                ,SV.EZUPTIME_SOD
                ,SV.EZUPTIMEZONE_SOD
       <!-- START 2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
                ,SV.CTRY_CD
       <!-- END   2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
                <!-- QC#22613 Add Start -->
                ,POR.PKT_STS_TS_OR
                <!-- QC#22613 Add End -->
             FROM
                 SO_DTL_V      SV
                ,PKT_V         PV
                ,SVC_TASK      SVT
                ,SVC_TASK_STS  STS
                <!-- QC#22613 Add Start -->
                ,PKT_OR            POR
                <!-- QC#22613 Add End -->
             WHERE
                 SV.GLBL_CMPY_CD     = PV.GLBL_CMPY_CD(+)
             AND SV.SO_NUM           = PV.SO_NUM(+)
             AND SV.SO_SLP_NUM       = PV.SO_SLP_NUM(+)
             AND SV.GLBL_CMPY_CD     = SVT.GLBL_CMPY_CD(+)
             AND SV.SVC_TASK_NUM     = SVT.SVC_TASK_NUM(+)
             AND SVT.EZCANCELFLAG(+) = '0'
             AND SVT.GLBL_CMPY_CD    = STS.GLBL_CMPY_CD(+)
             AND SVT.SVC_TASK_STS_CD = STS.SVC_TASK_STS_CD(+)
             AND STS.EZCANCELFLAG(+) = '0'
             <!-- QC#22613 Add Start -->
             AND SV.GLBL_CMPY_CD     = POR.GLBL_CMPY_CD(+)
             AND SV.SO_NUM           = POR.SO_NUM(+)
             AND SV.SO_SLP_NUM       = POR.SO_SLP_NUM(+)
             <!-- QC#22613 Add Start -->
             AND SV.ROW_NUM      &lt;= #rownum#
             AND NOT EXISTS (SELECT
                                 1
                             FROM
                                 SHPG_ORD_CONF_DTL COND
                             WHERE
                                 SV.GLBL_CMPY_CD     = COND.GLBL_CMPY_CD
                             AND SV.SO_NUM           = COND.SO_NUM
                             AND SV.SO_SLP_NUM       = COND.SO_SLP_NUM
                             AND COND.SO_PROC_STS_CD = #soProcSts#
                             AND COND.EZCANCELFLAG   = '0'
                            )
             UNION
             SELECT
                 SV.GLBL_CMPY_CD
                ,SV.SHIP_SVC_CONFIG_MSTR_PK
                ,SV.CPO_ORD_NUM
                ,SV.TRX_LINE_NUM
                ,SV.TRX_LINE_SUB_NUM
                ,SV.DPLY_LINE_NUM
                ,SV.SO_NUM
                ,SV.SO_SLP_NUM
                ,SV.SCHD_COORD_PSN_NM
                ,SV.RTL_WH_CD
                ,SV.RTL_SWH_CD
                ,SV.INVTY_LOC_CD
                ,SV.RTL_WH_NM
                ,SV.RTL_WH_FIRST_LINE_ADDR
                ,SV.RTL_WH_CTY_ADDR
                ,SV.RTL_WH_ST_CD
                ,SV.RTL_WH_POST_CD
                ,SV.XX_PSN_FIRST_MID_LAST_NM
                ,SV.MDSE_CD
                ,SV.MDSE_DESC_SHORT_TXT
                ,SV.BACK_ORD_IMPCT_TP_DESC_TXT
                ,SV.SHPG_BAL_QTY AS SHIP_QTY
                ,SV.RDD_DT
                ,SV.SCHD_DELY_DT
                ,SV.SCHD_DELY_TM
                ,PV.PKT_STS_TS_PC
                ,PV.PKT_STS_TS_DS
                ,PV.PKT_STS_TS_TA
                ,PV.PKT_STS_TS_DD
                ,NULL            AS SHIP_DT_TM_TS
                ,NULL            AS CARR_RSN_CD
                ,NULL            AS CARR_RSN_DESC_TXT
                ,NULL            AS ACTL_DELY_DT
                ,NULL            AS ACTL_DELY_TM
                ,SVT.SVC_TASK_CPLT_DT
                ,STS.SVC_TASK_STS_DESC_TXT
                ,SV.DS_SO_LINE_STS_DESC_TXT
                ,SV.SCHD_CARR_CD AS CARR_CD
                ,SV.SCHD_CARR_NM AS CARR_NM
                ,NULL            AS PRO_NUM
                ,NULL            AS PRO_NUM_BD
                ,SV.SHPG_SVC_LVL_CD
                ,SV.SHPG_SVC_LVL_DESC_TXT
                ,SV.SCHD_COORD_STS_DESC_TXT
                ,SV.DELY_REQ_TS
                ,NULL            AS TOT_FRT_AMT
                ,SV.DS_ACCT_NUM
                ,SV.SHIP_TO_CUST_CD
                ,SV.SHIP_TO_CUST_NM
                ,SV.SHIP_TO_LINE_ADDR_01
                ,SV.SHIP_TO_CTY_ADDR
                ,SV.SHIP_TO_ST_CD
                ,SV.SHIP_TO_POST_CD
                ,SV.PICK_SVC_CONFIG_MSTR_PK
                ,SV.STK_STS_CD
                ,SV.DS_ORD_CATG_DESC_TXT
                ,SV.SCE_ORD_TP_CD
                ,SV.CARR_ACCT_NUM
                ,SV.ORD_OPEN_FLG
                ,SV.SO_LINE_OPEN_FLG
                ,#flgN# AS SHIP_FLG
                ,SV.SO_SCR_CANC_AVAL_FLG
                ,SV.SO_LINE_SHIP_AVAL_FLG
                ,SV.SO_LINE_PART_SHIP_AVAL_FLG
                ,SV.WMS_DROP_FLG
                ,SV.WMS_DROP_READY_FLG
                ,SV.WH_MAN_SEND_RQST_FLG
                ,SV.CARR_MAN_SEND_RQST_FLG
                ,SV.SEND_RQST_FLG
                ,SV.SET_MDSE_CD
                ,SV.SET_SHPG_PLN_NUM
                ,SV.UOM_EACH_QTY
                ,SV.INVTY_ACCT_CD
                ,SV.SVC_MACH_MSTR_PK
                ,SV.SER_NUM_TAKE_FLG
                ,SV.INSTL_BASE_CTRL_FLG
                ,SV.ORD_CARR_CD
                ,SV.MDL_ID
                ,SV.EZUPTIME_SO
                ,SV.EZUPTIMEZONE_SO
                ,SV.EZUPTIME_SOD
                ,SV.EZUPTIMEZONE_SOD
       <!-- START 2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
                ,SV.CTRY_CD
       <!-- END   2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
                <!-- QC#22613 Add Start -->
                ,POR.PKT_STS_TS_OR
                <!-- QC#22613 Add End -->
             FROM
                 SO_DTL_V      SV
                ,PKT_V         PV
                ,SVC_TASK      SVT
                ,SVC_TASK_STS  STS
                <!-- QC#22613 Add Start -->
                ,PKT_OR            POR
                <!-- QC#22613 Add End -->
             WHERE
                 SV.GLBL_CMPY_CD     = PV.GLBL_CMPY_CD(+)
             AND SV.SO_NUM           = PV.SO_NUM(+)
             AND SV.SO_SLP_NUM       = PV.SO_SLP_NUM(+)
             AND SV.GLBL_CMPY_CD     = SVT.GLBL_CMPY_CD(+)
             AND SV.SVC_TASK_NUM     = SVT.SVC_TASK_NUM(+)
             AND SVT.EZCANCELFLAG(+) = '0'
             AND SVT.GLBL_CMPY_CD    = STS.GLBL_CMPY_CD(+)
             AND SVT.SVC_TASK_STS_CD = STS.SVC_TASK_STS_CD(+)
             AND STS.EZCANCELFLAG(+) = '0'
             <!-- QC#22613 Add Start -->
             AND SV.GLBL_CMPY_CD     = POR.GLBL_CMPY_CD(+)
             AND SV.SO_NUM           = POR.SO_NUM(+)
             AND SV.SO_SLP_NUM       = POR.SO_SLP_NUM(+)
             <!-- QC#22613 Add Start -->
             AND SV.ORD_OPEN_FLG     = #flgY#
             AND SV.SO_LINE_OPEN_FLG = #flgY#
             AND SV.ROW_NUM      &lt;= #rownum#
             AND EXISTS (SELECT
                             1
                         FROM
                             SHPG_ORD_CONF_DTL COND
                         WHERE
                             SV.GLBL_CMPY_CD     = COND.GLBL_CMPY_CD
                         AND SV.SO_NUM           = COND.SO_NUM
                         AND SV.SO_SLP_NUM       = COND.SO_SLP_NUM
                         AND COND.SO_PROC_STS_CD = #soProcSts#
                         AND COND.EZCANCELFLAG   = '0'
                        )
             </isNull>
             ORDER BY
                 CPO_ORD_NUM
                ,SO_NUM
                ,SO_SLP_NUM
                ,SHIP_DT_TM_TS NULLS FIRST
            )
        WHERE
            ROWNUM &lt;= #rownum#
    </statement>

    <resultMap id="result.NLBL3070_BSMsg" class="NLBL3070_BSMsg">
        <result property="shipSvcConfigMstrPk_B1"    column="SHIP_SVC_CONFIG_MSTR_PK"     javaType="EZDSBigDecimalItem"/>
        <result property="trxHdrNum_B1"              column="CPO_ORD_NUM"                 javaType="EZDSStringItem"/>
        <result property="trxLineNum_B1"             column="TRX_LINE_NUM"                javaType="EZDSStringItem"/>
        <result property="trxLineSubNum_B1"          column="TRX_LINE_SUB_NUM"            javaType="EZDSStringItem"/>
        <result property="dplyLineNum_B1"            column="DPLY_LINE_NUM"               javaType="EZDSStringItem"/>
        <result property="soNum_B1"                  column="SO_NUM"                      javaType="EZDSStringItem"/>
        <result property="soSlpNum_B1"               column="SO_SLP_NUM"                  javaType="EZDSStringItem"/>
        <result property="xxPsnFirstMidLastNm_B1"    column="SCHD_COORD_PSN_NM"           javaType="EZDSStringItem"/>
        <result property="rtlWhCd_B1"                column="RTL_WH_CD"                   javaType="EZDSStringItem"/>
        <result property="rtlSwhCd_B1"               column="RTL_SWH_CD"                  javaType="EZDSStringItem"/>
        <result property="invtyLocCd_B1"             column="INVTY_LOC_CD"                javaType="EZDSStringItem"/>
        <result property="rtlWhNm_B1"                column="RTL_WH_NM"                   javaType="EZDSStringItem"/>
        <result property="firstLineAddr_RW"          column="RTL_WH_FIRST_LINE_ADDR"      javaType="EZDSStringItem"/>
        <result property="ctyAddr_RW"                column="RTL_WH_CTY_ADDR"             javaType="EZDSStringItem"/>
        <result property="stCd_RW"                   column="RTL_WH_ST_CD"                javaType="EZDSStringItem"/>
        <result property="postCd_RW"                 column="RTL_WH_POST_CD"              javaType="EZDSStringItem"/>
        <result property="xxPsnFirstMidLastNm_B2"    column="XX_PSN_FIRST_MID_LAST_NM"    javaType="EZDSStringItem"/>
        <result property="mdseCd_B1"                 column="MDSE_CD"                     javaType="EZDSStringItem"/>
        <result property="mdseDescShortTxt_B1"       column="MDSE_DESC_SHORT_TXT"         javaType="EZDSStringItem"/>
        <result property="backOrdImpctTpDescTxt_B1"  column="BACK_ORD_IMPCT_TP_DESC_TXT"  javaType="EZDSStringItem"/>
        <result property="xxShipQty_B1"              column="SHIP_QTY"                    javaType="EZDSBigDecimalItem"/>
        <result property="serNum_B1"                 column="SER_NUM"                     javaType="EZDSStringItem"/>
        <result property="rddDt_B1"                  column="RDD_DT"                      javaType="EZDSDateItem"/>
        <result property="schdDelyDt_B1"             column="SCHD_DELY_DT"                javaType="EZDSDateItem"/>
       <!-- START 2017/12/28 T.Hakodate [QC#18460(SOL#087),ADD] -->
        <result property="ctryCd_B1"                 column="CTRY_CD"                     javaType="EZDSStringItem"/>
        <result property="schdDelyTsDplyTxt_B1"      column="SCHD_DELY_TM"                javaType="EZDSDateItem"/>
        <!-- END 2017/12/28 T.Hakodate [QC#18460(SOL#087), ADD] -->
        <result property="xxTsDsp19Txt_PC"           column="PKT_STS_TS_PC"               javaType="EZDSStringItem"/>
        <result property="xxTsDsp19Txt_DS"           column="PKT_STS_TS_DS"               javaType="EZDSStringItem"/>
        <result property="xxTsDsp19Txt_TA"           column="PKT_STS_TS_TA"               javaType="EZDSStringItem"/>
        <result property="xxTsDsp19Txt_DD"           column="PKT_STS_TS_DD"               javaType="EZDSStringItem"/>
        <result property="xxTsDsp19Txt_SC"           column="SHIP_DT_TM_TS2"              javaType="EZDSStringItem"/>
        <result property="shipDtTmTs_B1"             column="SHIP_DT_TM_TS"               javaType="EZDSStringItem"/>
        <result property="carrRsnCd_B1"              column="CARR_RSN_CD"                 javaType="EZDSStringItem"/>
        <result property="actlDelyDt_B1"             column="ACTL_DELY_DT"                javaType="EZDSDateItem"/>
        <result property="schdDelyTsDplyTxt_B2"      column="ACTL_DELY_TM"                javaType="EZDSStringItem"/>
        <result property="svcTaskCpltDt_B1"          column="SVC_TASK_CPLT_DT"            javaType="EZDSDateItem"/>
        <result property="svcTaskStsDescTxt_B1"      column="SVC_TASK_STS_DESC_TXT"       javaType="EZDSStringItem"/>
        <result property="dsSoLineStsDescTxt_B1"     column="DS_SO_LINE_STS_DESC_TXT"     javaType="EZDSStringItem"/>
        <result property="carrCd_B1"                 column="CARR_CD"                     javaType="EZDSStringItem"/>
        <result property="carrNm_B1"                 column="CARR_NM"                     javaType="EZDSStringItem"/>
        <result property="proNum_B1"                 column="PRO_NUM"                     javaType="EZDSStringItem"/>
        <result property="proNum_BD"                 column="PRO_NUM_BD"                  javaType="EZDSStringItem"/>
        <result property="shpgSvcLvlCd_B1"           column="SHPG_SVC_LVL_CD"             javaType="EZDSStringItem"/>
        <result property="shpgSvcLvlDescTxt_B1"      column="SHPG_SVC_LVL_DESC_TXT"       javaType="EZDSStringItem"/>
        <result property="schdCoordStsDescTxt_B1"    column="SCHD_COORD_STS_DESC_TXT"     javaType="EZDSStringItem"/>
        <result property="xxTsDsp19Txt_SR"           column="DELY_REQ_TS"                 javaType="EZDSStringItem"/>
        <result property="totFrtAmt_B1"              column="TOT_FRT_AMT"                 javaType="EZDSBigDecimalItem"/>
        <result property="dsAcctNum_B1"              column="DS_ACCT_NUM"                 javaType="EZDSStringItem"/>
        <result property="shipToCustCd_B1"           column="SHIP_TO_CUST_CD"             javaType="EZDSStringItem"/>
        <result property="dsAcctNm_B1"               column="SHIP_TO_CUST_NM"             javaType="EZDSStringItem"/>
        <result property="firstLineAddr_B1"          column="SO_CUST_LINE_ADDR_01"        javaType="EZDSStringItem"/>
        <result property="ctyAddr_B1"                column="SHIP_TO_CTY_ADDR"            javaType="EZDSStringItem"/>
        <result property="stCd_B1"                   column="SHIP_TO_ST_CD"               javaType="EZDSStringItem"/>
        <result property="postCd_B1"                 column="SHIP_TO_POST_CD"             javaType="EZDSStringItem"/>
        <result property="pickSvcConfigMstrPk_B1"    column="PICK_SVC_CONFIG_MSTR_PK"     javaType="EZDSBigDecimalItem"/>
        <result property="stkStsCd_B1"               column="STK_STS_CD"                  javaType="EZDSStringItem"/>
        <result property="dsOrdCatgDescTxt_B1"       column="DS_ORD_CATG_DESC_TXT"        javaType="EZDSStringItem"/>
        <result property="sceOrdTpCd_B1"             column="SCE_ORD_TP_CD"               javaType="EZDSStringItem"/>
        <result property="carrAcctNum_B1"            column="CARR_ACCT_NUM"               javaType="EZDSStringItem"/>
        <result property="openFlg_B1"                column="ORD_OPEN_FLG"                javaType="EZDSStringItem"/>
        <result property="soLineOpenFlg_B1"          column="SO_LINE_OPEN_FLG"            javaType="EZDSStringItem"/>
        <result property="shipFlg_B1"                column="SHIP_FLG"                    javaType="EZDSStringItem"/>
        <result property="soScrCancAvalFlg_B1"       column="SO_SCR_CANC_AVAL_FLG"        javaType="EZDSStringItem"/>
        <result property="shipAvalFlg_LS"            column="SO_LINE_SHIP_AVAL_FLG"       javaType="EZDSStringItem"/>
        <result property="shipAvalFlg_PS"            column="SO_LINE_PART_SHIP_AVAL_FLG"  javaType="EZDSStringItem"/>
        <result property="wmsDropFlg_B1"             column="WMS_DROP_FLG"                javaType="EZDSStringItem"/>
        <result property="wmsDropRqstFlg_B1"         column="WMS_DROP_READY_FLG"          javaType="EZDSStringItem"/>
        <result property="manSendRqstFlg_BW"         column="WH_MAN_SEND_RQST_FLG"        javaType="EZDSStringItem"/>
        <result property="manSendRqstFlg_BC"         column="CARR_MAN_SEND_RQST_FLG"      javaType="EZDSStringItem"/>
        <result property="sendRqstFlg_B1"            column="SEND_RQST_FLG"               javaType="EZDSStringItem"/>
        <result property="setMdseCd_B1"              column="SET_MDSE_CD"                 javaType="EZDSStringItem"/>
        <result property="setShpgPlnNum_B1"          column="SET_SHPG_PLN_NUM"            javaType="EZDSStringItem"/>
        <result property="xxQty10Num_B1"             column="UOM_EACH_QTY"                javaType="EZDSBigDecimalItem"/>
        <result property="invtyAcctCd_B1"            column="INVTY_ACCT_CD"               javaType="EZDSStringItem"/>
        <result property="serNumTakeFlg_B1"          column="SER_NUM_TAKE_FLG"            javaType="EZDSStringItem"/>
        <result property="instlBaseCtrlFlg_B1"       column="INSTL_BASE_CTRL_FLG"         javaType="EZDSStringItem"/>
        <result property="mdlId_B1"                  column="MDL_ID"                      javaType="EZDSBigDecimalItem"/>
        <result property="ezUpTime_SO"               column="EZUPTIME_SO"                 javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_SO"           column="EZUPTIMEZONE_SO"             javaType="EZDSStringItem"/>
        <result property="ezUpTime_SD"               column="EZUPTIME_SOD"                javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_SD"           column="EZUPTIMEZONE_SOD"            javaType="EZDSStringItem"/>
        <result property="shipQty_BK"                column="SHIP_QTY"                    javaType="EZDSBigDecimalItem"/>
        <result property="serNum_BK"                 column="SER_NUM"                     javaType="EZDSStringItem"/>
        <result property="carrRsnCd_BK"              column="CARR_RSN_CD"                 javaType="EZDSStringItem"/>
        <result property="actlDelyDt_BK"             column="ACTL_DELY_DT"                javaType="EZDSDateItem"/>
        <result property="schdDelyTsDplyTxt_K2"      column="ACTL_DELY_TM"                javaType="EZDSStringItem"/>
        <result property="carrCd_BK"                 column="CARR_CD"                     javaType="EZDSStringItem"/>
        <result property="carrNm_BK"                 column="CARR_NM"                     javaType="EZDSStringItem"/>
        <result property="proNum_BK"                 column="PRO_NUM"                     javaType="EZDSStringItem"/>
        <result property="totFrtAmt_BK"              column="TOT_FRT_AMT"                 javaType="EZDSBigDecimalItem"/>
        <!-- QC#22613 Add Start -->
        <result property="xxTsDsp19Txt_OR"           column="PKT_STS_TS_OR"               javaType="EZDSStringItem"/>
        <!-- QC#22613 Add End -->
    </resultMap>

    <statement id ="GetShipToCustNm" parameterClass="Map" resultClass="String">
        SELECT
<!-- START 2019/09/26 T.Ogura [QC#52362,MOD] -->
<!--        SELL.DS_ACCT_NM -->
            SUBSTR(SELL.DS_ACCT_NM, 1, 60)
<!-- END   2019/09/26 T.Ogura [QC#52362,MOD] -->
        FROM
            SHIP_TO_CUST SHIP
           ,SELL_TO_CUST SELL
        WHERE
            SHIP.GLBL_CMPY_CD    = #glblCmpyCd#
        AND SHIP.SHIP_TO_CUST_CD = #shipToCustCd#
        AND SHIP.EZCANCELFLAG    = '0'
        AND SHIP.GLBL_CMPY_CD    = SELL.GLBL_CMPY_CD
        AND SHIP.SELL_TO_CUST_CD = SELL.SELL_TO_CUST_CD
        AND SELL.EZCANCELFLAG    = '0'
        AND ROWNUM               = 1
    </statement>

    <statement id ="GetSerNumListShipped" parameterClass="Map" resultClass="Map">
        SELECT
            SSN.SO_NUM
           ,SSN.SO_SLP_NUM
           ,SSN.MDSE_CD
           ,SSN.SER_NUM
           ,SOCD.BOL_NUM
           ,SOCD.SHIP_QTY
           ,999 SO_SER_PK
           ,#flgN# WH_PICK_FLG
           ,#flgN# ORD_ASG_FLG
           ,999 SVC_MACH_MSTR_PK
        FROM
            SHIP_SER_NUM      SSN
           ,SHPG_ORD_CONF_DTL SOCD
        WHERE
            SSN.GLBL_CMPY_CD  = #glblCmpyCd#
        AND SSN.SO_NUM        = #soNum#
        AND SSN.SO_SLP_NUM    = #soSlpNum#
        AND SSN.EZCANCELFLAG  = '0'
        AND SSN.GLBL_CMPY_CD  = SOCD.GLBL_CMPY_CD
        AND SSN.SO_NUM        = SOCD.SO_NUM
        AND SSN.SO_SLP_NUM    = SOCD.SO_SLP_NUM
        AND SOCD.BOL_NUM      = #bolNum#
        AND SOCD.EZCANCELFLAG = '0'
        ORDER BY
            SSN.SO_SER_ID
    </statement>

    <statement id ="GetSerNumListNotShip" parameterClass="Map" resultClass="Map">
        SELECT
            SS.SO_NUM
           ,SS.SO_SLP_NUM
           ,SS.MDSE_CD
           ,SS.SER_NUM
           ,'' BOL_NUM
           ,0  SHIP_QTY
           ,SS.SO_SER_PK
           ,SS.WH_PICK_FLG
           ,SS.ORD_ASG_FLG
           ,SS.SVC_MACH_MSTR_PK
        FROM
            SO_SER SS
           ,SHPG_ORD_DTL SOD
        WHERE
            SS.GLBL_CMPY_CD  = #glblCmpyCd#
        AND SS.SO_NUM        = #soNum#
        AND SS.SO_SLP_NUM    = #soSlpNum#
        AND SS.EZCANCELFLAG  = '0'
        AND SS.GLBL_CMPY_CD  = SOD.GLBL_CMPY_CD
        AND SS.SO_NUM        = SOD.SO_NUM
        AND SS.SO_SLP_NUM    = SOD.SO_SLP_NUM
        AND SOD.EZCANCELFLAG = '0'
        AND SS.WH_PICK_FLG   = #flgY#
        AND NOT EXISTS (SELECT
                            1
                        FROM
                            SHIP_SER_NUM SSN
                        WHERE
                            SS.GLBL_CMPY_CD = SSN.GLBL_CMPY_CD
                        AND SS.SO_NUM       = SSN.SO_NUM
                        AND SS.SO_SLP_NUM   = SSN.SO_SLP_NUM
                        AND SS.MDSE_CD      = SSN.MDSE_CD
                       )
        UNION ALL
        SELECT
            SS.SO_NUM
           ,SS.SO_SLP_NUM
           ,SS.MDSE_CD
           ,SS.SER_NUM
           ,'' BOL_NUM
           ,0  SHIP_QTY
           ,SS.SO_SER_PK
           ,SS.WH_PICK_FLG
           ,SS.ORD_ASG_FLG
           ,SS.SVC_MACH_MSTR_PK
        FROM
            SO_SER       SS
           ,SHPG_ORD_DTL SOD
        WHERE
            SS.GLBL_CMPY_CD  = #glblCmpyCd#
        AND SS.SO_NUM        = #soNum#
        AND SS.SO_SLP_NUM    = #soSlpNum#
        AND SS.EZCANCELFLAG  = '0'
        AND SS.GLBL_CMPY_CD  = SOD.GLBL_CMPY_CD
        AND SS.SO_NUM        = SOD.SO_NUM
        AND SS.SO_SLP_NUM    = SOD.SO_SLP_NUM
        AND SOD.EZCANCELFLAG = '0'
        AND SS.ORD_ASG_FLG   = #flgY#
        AND SS.WH_PICK_FLG   = #flgN#
        AND NOT EXISTS (SELECT
                            1
                        FROM
                            SHIP_SER_NUM SSN
                        WHERE
                            SS.GLBL_CMPY_CD = SSN.GLBL_CMPY_CD
                        AND SS.SO_NUM       = SSN.SO_NUM
                        AND SS.SO_SLP_NUM   = SSN.SO_SLP_NUM
                        AND SS.MDSE_CD      = SSN.MDSE_CD
                       )
        ORDER BY
            WH_PICK_FLG DESC
           ,ORD_ASG_FLG DESC
           ,SO_SER_PK   DESC
    </statement>

    <statement id="getSavedSearchOptionList" parameterClass="Map" resultClass="Map">
        SELECT
            SSO.SRCH_OPT_PK
           ,SSO.SRCH_OPT_NM
        FROM
            SAVE_SRCH_OPT SSO 
        WHERE
            SSO.GLBL_CMPY_CD    = #glblCmpyCd#
        AND SSO.SRCH_OPT_APL_ID = #srchOptAplId#
        AND SSO.SRCH_OPT_USR_ID = #srchOptUsrId#
        AND SSO.EZCANCELFLAG    = '0'
        ORDER BY
            SSO.SRCH_OPT_NM
    </statement>

    <statement id="getCarrCdList" parameterClass="Map" resultClass="String">
        SELECT
            CARR_CD
        FROM
            OTBD_CARR_V
        WHERE
            GLBL_CMPY_CD   = #glblCmpyCd#
        AND UPPER(CARR_NM) = #carrNm#
        AND EZCANCELFLAG   = '0'
    </statement>

    <statement id="getAcctCarrCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            DS_ACCT_CARR
        WHERE
            GLBL_CMPY_CD        = #glblCmpyCd#
        AND DS_ACCT_NUM         = #dsAcctNum#
        AND VND_CD              = #carrCd#
        AND DS_CARR_ACCT_NUM    = #carrAcctNum#
        AND EFF_FROM_DT     &lt;= #slsDt#
        AND (   EFF_THRU_DT &gt;= #slsDt#
             OR EFF_THRU_DT IS NULL
            )
        AND EZCANCELFLAG        = '0'
    </statement>

    <statement id="getCarrSvcLvlCdList" parameterClass="Map" resultClass="String">
        SELECT
            CARR_SVC_LVL_CD
        FROM
            SHPG_SVC_LVL_CARR_RELN
        WHERE
            GLBL_CMPY_CD    = #glblCmpyCd#
        AND SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
        AND CARR_CD         = #carrCd#
        AND EZCANCELFLAG    = '0'
    </statement>

    <statement id ="getSoCancelAvalFlg" parameterClass="Map" resultClass="Map">
        SELECT
            WST.WH_SYS_TP_DESC_TXT
        FROM
            RTL_WH               RW
           ,SO_RWS_SCR_CANC_CTRL CC
           ,WH_SYS_TP            WST
        WHERE
            RW.GLBL_CMPY_CD         = #glblCmpyCd#
        AND RW.RTL_WH_CD            = #rtlWhCd#
        AND RW.EZCANCELFLAG         = '0'
        AND RW.GLBL_CMPY_CD         = CC.GLBL_CMPY_CD
        AND RW.WH_SYS_TP_CD         = CC.WH_SYS_TP_CD
        AND CC.SCE_ORD_TP_CD        = #sceOrdTpCd#
        AND CC.SO_SCR_CANC_AVAL_FLG = #flgN#
        AND CC.EZCANCELFLAG         = '0'
        AND RW.GLBL_CMPY_CD         = WST.GLBL_CMPY_CD
        AND RW.WH_SYS_TP_CD         = WST.WH_SYS_TP_CD
        AND WST.EZCANCELFLAG        = '0'
        AND ROWNUM                  = 1
    </statement>

    <statement id="getPermissionWhList" parameterClass="Map" resultClass="String">
        SELECT
            SCWP.RTL_WH_CD
        FROM 
            SCHD_COORD_WH_PMSN SCWP
        WHERE
            SCWP.GLBL_CMPY_CD      = #glblCmpyCd#
        AND SCWP.SCHD_COORD_PSN_CD = #schdCoordPsnCd#
        AND #salesDate# BETWEEN SCWP.EFF_FROM_DT AND NVL(SCWP.EFF_THRU_DT,'99991231')
        AND SCWP.EZCANCELFLAG      = '0'
        <!-- START 2023/10/11 G.Quan [QC#61793, ADD] -->

        UNION

        SELECT
              RW.RTL_WH_CD
        FROM 
              SCHD_COORD_WH_PMSN    SCWP
            , RTL_WH                RW
        WHERE
            SCWP.GLBL_CMPY_CD       = #glblCmpyCd#
        AND SCWP.SCHD_COORD_PSN_CD  = #schdCoordPsnCd#
        AND #salesDate# BETWEEN SCWP.EFF_FROM_DT AND NVL(SCWP.EFF_THRU_DT, '99991231')
        AND SCWP.RTL_WH_CATG_CD     IS NOT NULL
        AND SCWP.GLBL_CMPY_CD       = RW.GLBL_CMPY_CD
        AND SCWP.RTL_WH_CATG_CD     = RW.RTL_WH_CATG_CD
        AND SCWP.EZCANCELFLAG       = '0'
        AND RW.EZCANCELFLAG         = '0'

        UNION

        SELECT
              RW.RTL_WH_CD
        FROM 
              SCHD_COORD_WH_PMSN    SCWP
            , RTL_WH                RW
        WHERE
            SCWP.GLBL_CMPY_CD       = #glblCmpyCd#
        AND SCWP.SCHD_COORD_PSN_CD  = #schdCoordPsnCd#
        AND #salesDate# BETWEEN SCWP.EFF_FROM_DT AND NVL(SCWP.EFF_THRU_DT, '99991231')
        AND SCWP.PHYS_WH_CD         IS NOT NULL
        AND SCWP.GLBL_CMPY_CD       = RW.GLBL_CMPY_CD
        AND SCWP.PHYS_WH_CD         = RW.PHYS_WH_CD
        AND SCWP.EZCANCELFLAG       = '0'
        AND RW.EZCANCELFLAG         = '0'
        <!-- END 2023/10/11 G.Quan [QC#61793, ADD] -->
    </statement>

<!-- START 2017/11/30 M.Naito [QC#18889,ADD] -->
    <statement id="chkDeliveryScheduleMail" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            1
        FROM
            SHPG_ORD       SO
           ,SVC_TASK       ST
           ,DS_SVC_CALL_TP DSC
           ,FSR_VISIT      FV
        WHERE
            SO.GLBL_CMPY_CD        = #glblCmpyCd#
        AND SO.SO_NUM              = #soNum#
        AND SO.TECH_MEET_TRUCK_FLG = 'Y'
        AND SO.EZCANCELFLAG        = '0'
        AND SO.GLBL_CMPY_CD        = ST.GLBL_CMPY_CD
        AND SO.SO_NUM              = ST.SO_NUM
        AND ST.EZCANCELFLAG        = '0'
        AND ST.GLBL_CMPY_CD        = FV.GLBL_CMPY_CD
        AND ST.FSR_NUM             = FV.FSR_NUM
        <!-- START 2019/04/23 K.Kitachi [QC#31245, MOD] -->
        <!-- AND FV.FSR_VISIT_STS_CD     IN (#scheduled#, #assigned#) -->
        AND FV.FSR_VISIT_STS_CD    IN (#scheduled#, #assigned#, #tbo#)
        <!-- END 2019/04/23 K.Kitachi [QC#31245, MOD] -->
        AND FV.EZCANCELFLAG        = '0'
        AND ST.GLBL_CMPY_CD        = DSC.GLBL_CMPY_CD
        AND ST.DS_SVC_CALL_TP_CD   = DSC.DS_SVC_CALL_TP_CD
        AND DSC.SVC_ISTL_REQ_FLG   = 'Y'
        AND DSC.EZCANCELFLAG       = '0'
        AND EXISTS (SELECT
                        1
                    FROM
                        (SELECT
                              SCHD_DELY_DT
                             ,SCHD_DELY_TM
                             ,ROW_NUMBER() OVER(ORDER BY SOST.UPD_TS DESC) IDX
                         FROM
                             SHPG_ORD_SCHD_TRK SOST
                         WHERE
                             SO.GLBL_CMPY_CD = SOST.GLBL_CMPY_CD
                         AND SO.SO_NUM       = SOST.SO_NUM
                         AND SO.EZCANCELFLAG = '0'
                        ) SCHD
                    WHERE
                        NVL(CONCAT(SO.SCHD_DELY_DT, SO.SCHD_DELY_TM),'0') != NVL(CONCAT(SCHD.SCHD_DELY_DT, SCHD.SCHD_DELY_TM),'0')
                    AND IDX = 2
                   )
        AND NOT EXISTS (SELECT
                            1
                        FROM
                            SVC_MACH_MSTR  SMM
                        WHERE
                            SO.GLBL_CMPY_CD       = SMM.GLBL_CMPY_CD
                        AND SO.SO_NUM             = SMM.SO_NUM
                        AND SMM.EZCANCELFLAG      = '0'
                        AND SMM.FLD_SVC_BR_CD     = #outTrtySvcBrCd#
                       )
    </statement>

<!-- START 2018/10/03 M.Naito [QC#28539,ADD] -->
    <statement id="chkChngTechMeetTheTruck" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            1
        FROM
            SHPG_ORD       SO
           ,SVC_TASK       ST
           ,DS_SVC_CALL_TP DSC
           ,FSR_VISIT      FV
        WHERE
            SO.GLBL_CMPY_CD        = #glblCmpyCd#
        AND SO.SO_NUM              = #soNum#
        AND SO.EZCANCELFLAG        = '0'
        AND SO.GLBL_CMPY_CD        = ST.GLBL_CMPY_CD
        AND SO.SO_NUM              = ST.SO_NUM
        AND ST.EZCANCELFLAG        = '0'
        AND ST.GLBL_CMPY_CD        = FV.GLBL_CMPY_CD
        AND ST.FSR_NUM             = FV.FSR_NUM
        <!-- START 2019/04/23 K.Kitachi [QC#31245, MOD] -->
        <!-- AND FV.FSR_VISIT_STS_CD     IN (#scheduled#, #assigned#) -->
        AND FV.FSR_VISIT_STS_CD    IN (#scheduled#, #assigned#, #tbo#, #inRoute#)
        <!-- END 2019/04/23 K.Kitachi [QC#31245, MOD] -->
        AND FV.EZCANCELFLAG        = '0'
        AND ST.GLBL_CMPY_CD        = DSC.GLBL_CMPY_CD
        AND ST.DS_SVC_CALL_TP_CD   = DSC.DS_SVC_CALL_TP_CD
        AND DSC.SVC_ISTL_REQ_FLG   = 'Y'
        AND DSC.EZCANCELFLAG       = '0'
        AND NOT EXISTS (SELECT
                            1
                        FROM
                            SVC_MACH_MSTR  SMM
                        WHERE
                            SO.GLBL_CMPY_CD       = SMM.GLBL_CMPY_CD
                        AND SO.SO_NUM             = SMM.SO_NUM
                        AND SMM.EZCANCELFLAG      = '0'
                        AND SMM.FLD_SVC_BR_CD     = #outTrtySvcBrCd#
                       )
    </statement>

    <statement id="getSvcTaskInfoFromSoNum" parameterClass="Map" resultClass="Map">
        SELECT
            ST.SVC_TASK_NUM
            ,ST.SVC_MACH_MSTR_PK
        FROM
            SHPG_ORD       SO
           ,SVC_TASK       ST
        WHERE
            SO.GLBL_CMPY_CD        = #glblCmpyCd#
        AND SO.SO_NUM              = #soNum#
        AND SO.EZCANCELFLAG        = '0'
        AND SO.GLBL_CMPY_CD        = ST.GLBL_CMPY_CD
        AND SO.SO_NUM              = ST.SO_NUM
        AND ST.EZCANCELFLAG        = '0'
    </statement>
<!-- END 2018/10/03 M.Naito [QC#28539,ADD] -->

<!-- START 2018/10/10 M.Naito [QC#28738,MOD] -->
    <statement id="getSvcBrMngrEmlAddr" parameterClass="Map" resultClass="Map">
        WITH BR_TIER AS (
            SELECT
                OHSD.GLBL_CMPY_CD
                ,OHSD.ORG_TIER_CD + 1 AS ORG_TIER_CD
            FROM
                 STRU_DFN SDF
                ,ORG_HRCH_STRU_DFN OHSD
            WHERE
                SDF.GLBL_CMPY_CD     = #glblCmpyCd#
            AND SDF.BR_FLG           = 'Y'
            AND SDF.EZCANCELFLAG     = '0'
            AND SDF.GLBL_CMPY_CD     = OHSD.GLBL_CMPY_CD
            AND SDF.STRU_DFN_CD      = OHSD.STRU_DFN_CD
            AND OHSD.BIZ_AREA_ORG_CD = #service#
            AND OHSD.EZCANCELFLAG    = '0'
            AND OHSD.EFF_FROM_DT     &lt;= #slsDt#
            AND NVL(OHSD.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
            AND ROWNUM               = 1
        )
        ,BR_INFO AS (
            SELECT
                CASE BR.ORG_TIER_CD
                    WHEN 1 THEN SUBSTR(STRU.FIRST_ORG_NM, 1 ,3)
                    WHEN 2 THEN SUBSTR(STRU.SCD_ORG_NM, 1 ,3)
                    WHEN 3 THEN SUBSTR(STRU.THIRD_ORG_NM, 1 ,3)
                    WHEN 4 THEN SUBSTR(STRU.FRTH_ORG_NM, 1 ,3)
                    WHEN 5 THEN SUBSTR(STRU.FIFTH_ORG_NM, 1 ,3)
                    WHEN 6 THEN SUBSTR(STRU.SIXTH_ORG_NM, 1 ,3)
                    WHEN 7 THEN SUBSTR(STRU.SVNTH_ORG_NM, 1 ,3)
                    WHEN 8 THEN SUBSTR(STRU.EIGHTH_ORG_NM, 1 ,3)
                    WHEN 9 THEN SUBSTR(STRU.NINTH_ORG_NM, 1 ,3)
                    WHEN 10 THEN SUBSTR(STRU.TENTH_ORG_NM, 1 ,3)
                    WHEN 11 THEN SUBSTR(STRU.ELVTH_ORG_NM, 1 ,3)
                END BR_CD
                ,CASE BR.ORG_TIER_CD
                    WHEN 1 THEN STRU.FIRST_ORG_CD
                    WHEN 2 THEN STRU.SCD_ORG_CD
                    WHEN 3 THEN STRU.THIRD_ORG_CD
                    WHEN 4 THEN STRU.FRTH_ORG_CD
                    WHEN 5 THEN STRU.FIFTH_ORG_CD
                    WHEN 6 THEN STRU.SIXTH_ORG_CD
                    WHEN 7 THEN STRU.SVNTH_ORG_CD
                    WHEN 8 THEN STRU.EIGHTH_ORG_CD
                    WHEN 9 THEN STRU.NINTH_ORG_CD
                    WHEN 10 THEN STRU.TENTH_ORG_CD
                    WHEN 11 THEN STRU.ELVTH_ORG_CD
                END BR_ORG_CD
            FROM
                ORG_STRU STRU
                ,BR_TIER BR
            WHERE
                STRU.GLBL_CMPY_CD   = #glblCmpyCd#
            AND STRU.EZCANCELFLAG   = '0'
            AND STRU.FIRST_ORG_CD   = #service#
            AND STRU.ORG_LAYER_NUM  = BR.ORG_TIER_CD
        )
        SELECT
             EML_ADDR
        FROM
            (
                SELECT
                     PSN.EML_ADDR
                FROM
                     SVC_TASK          ST
                    ,SVC_MACH_MSTR     SMM
                    ,BR_INFO           BR
                    <!-- ,SVC_CONTR_BR      SCB -->
                    ,DS_ORG_UNIT       ORG
                    ,TOC_ORG_STRU_RELN RELN
                    ,ORG_TOC_CHNG_RQST RQST
                    ,ORG_FUNC_ASG      ASG
                    ,S21_PSN           PSN
                WHERE
                    ST.GLBL_CMPY_CD          = #glblCmpyCd#
                AND ST.SO_NUM                = #soNum#
                AND ST.EZCANCELFLAG          = '0'
                AND ST.GLBL_CMPY_CD          = SMM.GLBL_CMPY_CD
                AND ST.SVC_MACH_MSTR_PK      = SMM.SVC_MACH_MSTR_PK
                AND SMM.EZCANCELFLAG         = '0'
                <!-- AND SMM.GLBL_CMPY_CD         = SCB.GLBL_CMPY_CD -->
                <!-- AND SMM.FLD_SVC_BR_CD        = SCB.SVC_CONTR_BR_CD -->
                <!-- AND SCB.EZCANCELFLAG         = '0' -->
                <!-- AND SCB.GLBL_CMPY_CD         = ORG.GLBL_CMPY_CD -->
                <!-- AND SCB.ORG_CD               = ORG.ORG_CD -->
                AND SMM.FLD_SVC_BR_CD        = BR.BR_CD
                AND BR.BR_ORG_CD             = ORG.ORG_CD
                AND ORG.EZCANCELFLAG         = '0'
                AND ORG.GLBL_CMPY_CD         = RELN.GLBL_CMPY_CD
                AND ORG.ORG_CD               = RELN.ORG_CD
                AND ORG.ORG_STRU_TP_CD       = RELN.ORG_STRU_TP_CD
                AND RELN.EZCANCELFLAG        = '0'
                AND RELN.GLBL_CMPY_CD        = RQST.GLBL_CMPY_CD
                AND RELN.TOC_CD              = RQST.TOC_CD
                AND RELN.ORG_CD              = RQST.ORG_CD
                AND RQST.EZCANCELFLAG        = '0'
                AND RQST.ORG_FUNC_ROLE_TP_CD = #orgFuncRoleTp#
                AND RQST.GLBL_CMPY_CD        = ASG.GLBL_CMPY_CD
                AND RQST.TOC_CD              = ASG.TOC_CD
                AND (ASG.GNRN_TP_CD = #gnrnTpCurrent# OR ASG.GNRN_TP_CD = #gnrnTpFuture#)
                AND ASG.GNRN_TP_CD           != #gnrnTpDelete#
                AND ASG.GNRN_TP_CD           != '0'
                AND ASG.EZCANCELFLAG         = '0'
                AND ASG.GLBL_CMPY_CD         = PSN.GLBL_CMPY_CD
                AND ASG.PSN_CD               = PSN.PSN_CD
                AND PSN.EML_ADDR             IS NOT NULL
                AND PSN.EZCANCELFLAG         = '0'
                ORDER BY
                    PSN.PSN_NUM, ASG.EFF_FROM_DT DESC
            )
        WHERE
            ROWNUM = 1
    </statement>
<!-- END 2018/10/10 M.Naito [QC#28738,MOD] -->

    <!-- START 2018/01/19 K.Ochiai [QC#18889, MOD] -->
    <statement id="getDeliveryScheduleMailInfo" parameterClass="Map" resultClass="Map">
        SELECT
            ST.SVC_TASK_NUM
           ,ST.FSR_NUM
           ,ST.SER_NUM
           ,STC.DS_ACCT_NM
           ,STC.FIRST_LINE_ADDR
                         || DECODE(STC.SCD_LINE_ADDR,    null, '', ' ' || STC.SCD_LINE_ADDR)
                         || DECODE(STC.THIRD_LINE_ADDR,  null, '', ' ' || STC.THIRD_LINE_ADDR)
                         || DECODE(STC.FRTH_LINE_ADDR,   null, '', ' ' || STC.FRTH_LINE_ADDR)
                         || DECODE(STC.CTY_ADDR,         null, '', ',' || STC.CTY_ADDR)
                         || DECODE(STC.ST_CD,            null, '', ',' || STC.ST_CD)
                         || DECODE(STC.POST_CD,          null, '', ' ' || STC.POST_CD)
                              AS ISTL_LOC
           ,STC.CTRY_CD
           ,STC.POST_CD
           ,PSN.PSN_FIRST_NM
           ,PSN.PSN_MID_NM
           ,PSN.PSN_LAST_NM
           ,PSN.EML_ADDR
           ,PSN.OFC_TEL_NUM
           ,SO.SCHD_DELY_DT   AS AFTER_SCHD_DELY_DT
           ,SO.SCHD_DELY_TM   AS AFTER_SCHD_DELY_TM
           ,SCHD.SCHD_DELY_DT AS BEFORE_SCHD_DELY_DT
           ,SCHD.SCHD_DELY_TM AS BEFORE_SCHD_DELY_TM
           ,ERL_START_TS      AS BEFORE_ERL_START_TS
           ,SMM.FLD_SVC_BR_CD
        FROM
            SHPG_ORD          SO
           ,SVC_TASK          ST
           ,SHIP_TO_CUST      STC
           ,S21_PSN           PSN
           ,(
                SELECT
                     SCHD_DELY_DT
                    ,SCHD_DELY_TM
                    ,ROW_NUMBER() OVER(ORDER BY SOST.UPD_TS DESC) IDX
                FROM
                     SHPG_ORD_SCHD_TRK SOST
                WHERE
                    SOST.GLBL_CMPY_CD = SOST.GLBL_CMPY_CD
                AND SOST.SO_NUM       = #soNum#
                AND SOST.EZCANCELFLAG = '0'
             ) SCHD
           ,SVC_MACH_MSTR     SMM
           ,FSR_VISIT         FV
        WHERE
            SO.GLBL_CMPY_CD     = #glblCmpyCd#
        AND SO.SO_NUM           = #soNum#
        AND SO.EZCANCELFLAG     = '0'
        AND SO.GLBL_CMPY_CD     = ST.GLBL_CMPY_CD
        AND SO.SO_NUM           = ST.SO_NUM
        AND ST.EZCANCELFLAG     = '0'
        AND ST.GLBL_CMPY_CD     = STC.GLBL_CMPY_CD
        AND ST.SHIP_TO_CUST_CD  = STC.SHIP_TO_CUST_CD
        AND STC.EZCANCELFLAG    = '0'
        AND ST.GLBL_CMPY_CD     = FV.GLBL_CMPY_CD
        AND ST.FSR_NUM          = FV.FSR_NUM
        AND ST.SVC_TASK_NUM     = FV.SVC_TASK_NUM
        AND FV.EZCANCELFLAG     = '0'
        AND FV.GLBL_CMPY_CD     = PSN.GLBL_CMPY_CD(+)
        AND FV.TECH_CD          = PSN.PSN_CD(+)
        AND PSN.EZCANCELFLAG(+) = '0'
        AND SCHD.IDX            = 2
        AND ST.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
        AND SMM.EZCANCELFLAG    = '0'
        AND ST.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
        ORDER BY SCHD.SCHD_DELY_DT,SCHD.SCHD_DELY_TM,ST.ERL_START_TS
    </statement>
    <!-- START 2018/01/19 K.Ochiai [QC#18889, MOD] -->
<!-- END 2017/11/30 M.Naito [QC#18889,ADD] -->

<!-- START 2019/04/23 K.Kitachi [QC#31245, ADD] -->
    <statement id="getEmlAddrFromTaskSvcBrMgr" parameterClass="Map" resultClass="String">
        SELECT
            PSN.EML_ADDR
        FROM
             SVC_TASK ST
            ,S21_PSN  PSN
        WHERE
                ST.GLBL_CMPY_CD      = #glblCmpyCd#
            AND ST.SO_NUM            = #soNum#
            AND ST.EZCANCELFLAG      = '0'
            AND ST.GLBL_CMPY_CD      = PSN.GLBL_CMPY_CD
            AND ST.SVC_BR_MGR_PSN_CD = PSN.PSN_CD
            AND PSN.EML_ADDR         IS NOT NULL
            AND PSN.EZCANCELFLAG     = '0'
    </statement>
<!-- END 2019/04/23 K.Kitachi [QC#31245, ADD] -->

<!-- START 2021/05/31 A.Marte [QC#58786, ADD] -->
    <statement id="getInvtyTrxHdrNumFromSO" parameterClass="Map" resultClass="String">
        SELECT
            SO.TRX_HDR_NUM
        FROM
            SHPG_ORD SO
        WHERE
                SO.GLBL_CMPY_CD      = #glblCmpyCd#
            AND SO.SO_NUM            = #soNum#
            AND SO.EZCANCELFLAG      = '0'
    </statement>
<!-- START 2021/05/31 A.Marte [QC#58786, ADD] -->

    <!-- START 2022/04/04 R.Azucena [QC#59802, ADD] -->
    <!-- START 2022/08/08 R.Azucena [QC#60416, DEL] -->
    <!--
    <statement id="getAvailSingleQty" parameterClass="Map" resultClass="BigDecimal">
         SELECT
                COUNT(*)
         FROM
                SVC_MACH_MSTR SMM
         WHERE
                SMM.GLBL_CMPY_CD            = #glblCmpyCd#
            AND SMM.MDSE_CD                 = #mdseCd#
            AND SMM.STK_STS_CD              = #stkStsCd#
            AND SMM.CUR_LOC_NUM             = #curLocNum#
            AND SMM.SVC_MACH_MAINT_AVAL_FLG = #svcMachMaintAvalFlg#
            <isNotNull property="pickSvcConfigMstrPk">
            AND SMM.SVC_CONFIG_MSTR_PK      = #pickSvcConfigMstrPk#
            </isNotNull>
            <isNull property="pickSvcConfigMstrPk">
            AND SMM.SVC_CONFIG_MSTR_PK IS NULL
            </isNull>
            <iterate property="svcMachMstrStsCdList" var="svcMachMstrStsCd[]" open="AND SMM.SVC_MACH_MSTR_STS_CD IN (" conjunction= "," close=")">
                #svcMachMstrStsCd[]#
            </iterate>
            AND SMM.EZCANCELFLAG            = '0'
    </statement>
    -->
    <!-- END 2022/08/08 R.Azucena [QC#60416, DEL] -->
    <!-- END 2022/04/04 R.Azucena [QC#59802, ADD] -->

<!-- START 2022/12/09 T.Kuroda [QC#60810, ADD] -->
    <statement id="getCountWMSWarehouseList" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            COUNT(1) CNT
        FROM RTL_WH RTW
           , SWH_TRNSF_CTRL STC
        WHERE
            RTW.GLBL_CMPY_CD    = #glblCmpyCd#
        AND RTW.RTL_WH_CD       = #rtlWhCd#
        AND RTW.EZCANCELFLAG    = '0'
        AND STC.GLBL_CMPY_CD    = RTW.GLBL_CMPY_CD
        AND STC.RTL_WH_CATG_CD  = RTW.RTL_WH_CATG_CD
        AND STC.WH_SYS_TP_CD    = RTW.WH_SYS_TP_CD
        AND STC.EZCANCELFLAG    = '0'
    </statement>
<!-- END   2022/12/09 T.Kuroda [QC#60810, ADD] -->
</sqlMap>
