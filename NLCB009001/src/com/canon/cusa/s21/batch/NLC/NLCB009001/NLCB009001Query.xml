<!--<?xml version="1.0" encoding="UTF-8"?>-->

<sqlMap namespace="NLCB009001Query">
   
   <statement id="getVarCharConstVal" parameterClass="Map" resultClass="String">
        SELECT
            VAR_CHAR_CONST_VAL
        FROM
            VAR_CHAR_CONST
        WHERE
            GLBL_CMPY_CD        =  #glblCmpyCd#
        AND VAR_CHAR_CONST_NM   =  #varCharConstNm#
        AND EZCANCELFLAG        =  '0'
    </statement>

	<statement id="getWhCdByWmsWh" parameterClass="Map" resultClass="String">		
		SELECT
		   RSW.INVTY_LOC_CD
		FROM
		   RTL_WH    RWH 
		  ,RTL_SWH   RSW
		WHERE    
		         RWH.GLBL_CMPY_CD  = #glblCmpyCd#
		AND      NVL(RWH.WMS_WH_CD, RWH.RTL_WH_CD)    = #wmsWhCd#
		AND      RWH.EZCANCELFLAG  = '0'
		AND      RSW.GLBL_CMPY_CD  = RWH.GLBL_CMPY_CD
		AND      RSW.RTL_WH_CD     = RWH.RTL_WH_CD
		AND      RSW.EZCANCELFLAG  = '0'
    </statement>

    <statement id="getEstoreWmsWhInvtyInfo" parameterClass="Map" resultClass="Map">    
        SELECT
           T2.MDSE_CD                         AS MDSE_CD
          ,T2.INVTY_LOC_CD                    AS INVTY_LOC_CD
          ,T2.LOC_STS_CD                      AS LOC_STS_CD
          ,T2.STK_STS_CD                      AS STK_STS_CD
          ,T2.FIRST_PROD_CTRL_CD              AS FIRST_PROD_CTRL_CD
          ,T2.INVTY_QTY                       AS INVTY_QTY
          ,MAX(T2.INVTY_DISCR_RPT_CRAT_DT)    AS INVTY_DISCR_RPT_CRAT_DT
          ,MAX(T2.INVTY_DISCR_RPT_CRAT_TM)    AS INVTY_DISCR_RPT_CRAT_TM
          ,MAX(T2.MDSE_NM)                    AS MDSE_NM
          ,MAX(T2.INVTY_DISCR_RPT_PRINT_FLG)  AS INVTY_DISCR_RPT_PRINT_FLG
          ,MAX(T2.PHYS_WH_CD)                 AS PHYS_WH_CD
        FROM 
        (
          SELECT
             ISS.MDSE_CD                    AS MDSE_CD
            ,ISS.INVTY_LOC_CD || '*'        AS INVTY_LOC_CD
            ,ISS.LOC_STS_CD                 AS LOC_STS_CD
            ,ISS.STK_STS_CD                 AS STK_STS_CD
            ,ISS.INVTY_QTY                  AS INVTY_QTY
            ,T1.INVTY_DISCR_RPT_CRAT_DT     AS INVTY_DISCR_RPT_CRAT_DT
            ,T1.INVTY_DISCR_RPT_CRAT_TM     AS INVTY_DISCR_RPT_CRAT_TM
            ,T1.FIRST_PROD_CTRL_CD          AS FIRST_PROD_CTRL_CD
            ,T1.MDSE_NM                     AS MDSE_NM
            ,T1.INVTY_DISCR_RPT_PRINT_FLG   AS INVTY_DISCR_RPT_PRINT_FLG
            ,T1.PHYS_WH_CD                  AS PHYS_WH_CD
          FROM
               INVTY_SNAP_SHOT ISS
              ,(
                SELECT 
                   WH.WH_CD
                  ,WH.PHYS_WH_CD
                  ,IDR.FIRST_PROD_CTRL_CD
                  ,IDR.MDSE_CD
                  ,IDR.MDSE_NM
                  ,IDR.LOC_STS_CD
                  ,IDR.STK_STS_CD
                  ,IDR.INVTY_DISCR_RPT_CRAT_DT
                  ,IDR.INVTY_DISCR_RPT_CRAT_TM
                  ,IDR.INVTY_DISCR_RPT_PRINT_FLG
                  ,IDR.GLBL_CMPY_CD
                FROM 
                   INVTY_DISCR_RPT_WRK IDR
                  ,WH                  WH
                WHERE
                     IDR.GLBL_CMPY_CD            = #glblCmpyCd#
                AND  IDR.EZCANCELFLAG            = '0'
                AND  WH.GLBL_CMPY_CD             = #glblCmpyCd#
                AND  WH.EZCANCELFLAG             = '0'
                <!-- DEL START Def#1767 -->
                <!-- AND  WH.ESTR_WH_TP_CD            = #eStoreWMSWh# -->
                <!-- DEL START Def#1767 -->
                AND  IDR.INVTY_DISCR_RPT_CRAT_DT = #createReportDate#
                AND  IDR.INVTY_LOC_CD            =  WH.PHYS_WH_CD
              )
              T1
          WHERE   
               ISS.GLBL_CMPY_CD       = #glblCmpyCd#
          AND  ISS.EZCANCELFLAG       = '0' 
          AND  ISS.INVTY_SNAP_SHOT_DT = #invtySnapShotDt#
          AND 
          (
               ISS.INVTY_LOC_CD = T1.WH_CD
            OR ISS.INVTY_LOC_CD = T1.PHYS_WH_CD 
          )
          AND  ISS.MDSE_CD            = T1.MDSE_CD
          AND  ISS.LOC_STS_CD         = T1.LOC_STS_CD
          AND  ISS.STK_STS_CD         = T1.STK_STS_CD
        ) T2
        GROUP BY
           T2.MDSE_CD
          ,T2.INVTY_LOC_CD
          ,T2.LOC_STS_CD
          ,T2.STK_STS_CD
          ,T2.INVTY_QTY
          ,T2.FIRST_PROD_CTRL_CD
        ORDER BY
           T2.MDSE_CD
          ,T2.STK_STS_CD
          ,T2.INVTY_LOC_CD
    </statement>

    <statement id="getWrkForEStore" parameterClass="Map" resultClass="Map">
        SELECT 
             a.GLBL_CMPY_CD
            ,a.INVTY_DISCR_RPT_WRK_PK
            ,a.INVTY_DISCR_RPT_CRAT_DT
            ,a.INVTY_DISCR_RPT_CRAT_TM
            ,a.INVTY_LOC_CD
            ,a.FIRST_PROD_CTRL_CD
            ,a.MDSE_CD
            ,a.LOC_STS_CD
            ,a.STK_STS_CD
            ,a.ADJ_INVTY_ORD_NUM
            ,a.ADJ_INVTY_ORD_LINE_NUM
            ,a.S21_INVTY_QTY
            ,a.RELN_SYS_INVTY_QTY
            ,a.DIFF_INVTY_QTY
            ,a.MDSE_NM
            ,a.INVTY_DISCR_RPT_PRINT_FLG
            ,a.ADJ_ORD_REF_INVTY_QTY
            ,a.PHYS_WH_CD
        FROM  INVTY_DISCR_RPT_WRK a
        WHERE a.GLBL_CMPY_CD             = #glblCmpyCd#
        AND   a.EZCANCELFLAG             = '0'
        AND   a.MDSE_CD                  = #mdseCd#
        AND   a.LOC_STS_CD               = #locStsCd#
        AND   a.STK_STS_CD               = #stkStsCd#
        AND   a.INVTY_DISCR_RPT_CRAT_DT  = #invtyDiscrRptCratDt#
        AND   a.INVTY_DISCR_RPT_CRAT_TM  = #invtyDiscrRptCratTm#
      <isNotNull property="invtyLocCd">
        AND   a.INVTY_LOC_CD             = #invtyLocCd#
      </isNotNull>
      <isNull    property="invtyLocCd">
        <iterate property="eStrWhCdList"  var="elem[]" open="AND a.INVTY_LOC_CD IN (" close=")" conjunction=",">
                   #elem[]#
        </iterate>
      </isNull>
        AND   a.PHYS_WH_CD               = #physWhCd#
    </statement>

</sqlMap>
