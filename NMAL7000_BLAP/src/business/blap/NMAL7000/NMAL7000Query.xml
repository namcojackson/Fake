<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL7000Query">

    <typeAlias alias="NMAL7000SMsg"    type="business.blap.NMAL7000.NMAL7000SMsg"/>
    <typeAlias alias="NMAL7000_ASMsg"  type="business.blap.NMAL7000.NMAL7000_ASMsg"/>

    <statement id="searchPrcList" parameterClass="Map" resultMap="result.searchPrcList">
        WITH PRC_CATG_INFO AS (
        SELECT PC.GLBL_CMPY_CD
             , PC.PRC_CATG_CD
             , PC.PRC_CATG_NM
             , PLT.PRC_LIST_TP_DESC_TXT
             , PLT.PRC_LIST_STRU_TP_CD
             , PLST.PRC_LIST_STRU_TP_DESC_TXT
             , CASE
                 WHEN PC.ACTV_FLG = #flgY# AND PC.DEL_FLG = #flgN# AND PC.EFF_FROM_DT &lt;= #slsDt# AND NVL(PC.EFF_THRU_DT, #highValDt#) &gt;= #slsDt#
                   THEN #active#
                 WHEN (PC.ACTV_FLG = #flgN# AND PC.DEL_FLG = #flgN#) OR (PC.ACTV_FLG = #flgY# AND PC.DEL_FLG = #flgN# AND (PC.EFF_FROM_DT  &gt; #slsDt# OR NVL(PC.EFF_THRU_DT, #highValDt#)  &lt; #slsDt#))
                   THEN #inactive#
                 WHEN PC.DEL_FLG = #flgY#
                   THEN #delete#
                 ELSE #none#
               END DISP_STS
             , PC.PRC_CONTR_NUM
             , PCON.PRC_CONTR_NM
             , PLG.PRC_LIST_GRP_DESC_TXT
             , PC.EFF_FROM_DT
             , PC.EFF_THRU_DT
          FROM PRC_CATG PC
             , PRC_LIST_TP PLT
             , PRC_LIST_STRU_TP PLST
             , PRC_CONTR PCON
             , PRC_LIST_GRP PLG
         WHERE PC.GLBL_CMPY_CD = #glblCmpyCd#
           AND PC.EZCANCELFLAG = '0'
           AND PC.GLBL_CMPY_CD   = PLT.GLBL_CMPY_CD
           AND PC.EZCANCELFLAG   = PLT.EZCANCELFLAG
           AND PC.PRC_LIST_TP_CD = PLT.PRC_LIST_TP_CD
           AND PLT.GLBL_CMPY_CD   = PLST.GLBL_CMPY_CD
           AND PLT.EZCANCELFLAG   = PLST.EZCANCELFLAG
           AND PLT.PRC_LIST_STRU_TP_CD = PLST.PRC_LIST_STRU_TP_CD
           AND PC.GLBL_CMPY_CD  = PCON.GLBL_CMPY_CD(+)
           AND PC.EZCANCELFLAG  = PCON.EZCANCELFLAG(+)
           AND PC.PRC_CONTR_NUM = PCON.PRC_CONTR_NUM(+)
           AND PC.GLBL_CMPY_CD  = PLG.GLBL_CMPY_CD(+)
           AND PC.EZCANCELFLAG  = PLG.EZCANCELFLAG(+)
           AND PC.PRC_LIST_GRP_CD = PLG.PRC_LIST_GRP_CD(+)
        <isNotNull property="prcCatgNm">
           AND PC.PRC_CATG_NM  LIKE #prcCatgNm#
        </isNotNull>
        <isNotNull property="prcListDplyNm">
           AND PC.PRC_LIST_DPLY_NM  LIKE #prcListDplyNm#
        </isNotNull>
        <isNotNull property="prcCatgDescTxt">
           AND PC.PRC_CATG_DESC_TXT LIKE #prcCatgDescTxt#
        </isNotNull>
        <isNotNull property="prcContrNum">
           AND PC.PRC_CONTR_NUM = #prcContrNum#
        </isNotNull>
        <isNotNull property="prcContrNm">
           AND PCON.PRC_CONTR_NM LIKE #prcContrNm#
        </isNotNull>
        <isNotNull property="prcListTpCd">
           AND PC.PRC_LIST_TP_CD = #prcListTpCd#
        </isNotNull>
        <isNotNull property="prcListStruTpCd">
           AND PLT.PRC_LIST_STRU_TP_CD = #prcListStruTpCd#
        </isNotNull>
        <isNotNull property="prcListGrpCd">
           AND PC.PRC_LIST_GRP_CD = #prcListGrpCd#
        </isNotNull>
        <isNotNull property="effFromDt">
           AND PC.EFF_FROM_DT &gt;= #effFromDt#
        </isNotNull>
        <isNotNull property="effThruDt">
           AND NVL(PC.EFF_THRU_DT, #highValDt#) &lt;= #effThruDt#
        </isNotNull>
        )
        <isEqual property="acctFlg" compareValue="Y">
        , PRC_CUST_AUDC_ACCT AS (
        SELECT DISTINCT PCA.GLBL_CMPY_CD
             , PCA.PRC_CATG_CD
          FROM PRC_CUST_AUDC PCA
             , SELL_TO_CUST S01
             , SELL_TO_CUST S02
             , SELL_TO_CUST S03
         WHERE PCA.GLBL_CMPY_CD = #glblCmpyCd#
           AND PCA.EZCANCELFLAG = '0'
           AND PCA.GLBL_CMPY_CD   = S01.GLBL_CMPY_CD(+)
           AND PCA.EZCANCELFLAG   = S01.EZCANCELFLAG(+)
           AND PCA.DS_ACCT_NUM_01 = S01.SELL_TO_CUST_CD(+)
           AND PCA.GLBL_CMPY_CD   = S02.GLBL_CMPY_CD(+)
           AND PCA.EZCANCELFLAG   = S02.EZCANCELFLAG(+)
           AND PCA.DS_ACCT_NUM_02 = S02.SELL_TO_CUST_CD(+)
           AND PCA.GLBL_CMPY_CD   = S03.GLBL_CMPY_CD(+)
           AND PCA.EZCANCELFLAG   = S03.EZCANCELFLAG(+)
           AND PCA.DS_ACCT_NUM_03 = S03.SELL_TO_CUST_CD(+)
        <isNotNull property="dsAcctNum">
           AND (PCA.DS_ACCT_NUM_01 = #dsAcctNum#
                OR
                PCA.DS_ACCT_NUM_02 = #dsAcctNum#
                OR
                PCA.DS_ACCT_NUM_03 = #dsAcctNum#
               )
        </isNotNull>
        <isNotNull property="dsAcctNm">
           AND (S01.DS_ACCT_NM LIKE #dsAcctNm#
                OR
                S02.DS_ACCT_NM LIKE #dsAcctNm#
                OR
                S03.DS_ACCT_NM LIKE #dsAcctNm#
               )
        </isNotNull>
        )
        </isEqual>
        <isEqual property="csmpFlg" compareValue="Y">
        , PRC_CUST_AUDC_CSMP AS (
        SELECT DISTINCT PCA.GLBL_CMPY_CD
             , PCA.PRC_CATG_CD
          FROM PRC_CUST_AUDC PCA
             , CSMP_CONTR CSMP1
             , CSMP_CONTR CSMP2
             , CSMP_CONTR CSMP3
         WHERE PCA.GLBL_CMPY_CD = #glblCmpyCd#
           AND PCA.EZCANCELFLAG = '0'
           AND PCA.GLBL_CMPY_CD = CSMP1.GLBL_CMPY_CD(+)
           AND PCA.EZCANCELFLAG = CSMP1.EZCANCELFLAG(+)
           AND PCA.CSMP_NUM_01  = CSMP1.CSMP_NUM(+)
           AND PCA.GLBL_CMPY_CD = CSMP2.GLBL_CMPY_CD(+)
           AND PCA.EZCANCELFLAG = CSMP2.EZCANCELFLAG(+)
           AND PCA.CSMP_NUM_02  = CSMP2.CSMP_NUM(+)
           AND PCA.GLBL_CMPY_CD = CSMP3.GLBL_CMPY_CD(+)
           AND PCA.EZCANCELFLAG = CSMP3.EZCANCELFLAG(+)
           AND PCA.CSMP_NUM_03  = CSMP3.CSMP_NUM(+)
        <isNotNull property="csmpNum">
           AND (PCA.CSMP_NUM_01 = #csmpNum#
                OR
                PCA.CSMP_NUM_02 = #csmpNum#
                OR
                PCA.CSMP_NUM_03 = #csmpNum#
               )
        </isNotNull>
        )
        </isEqual>
        <isEqual property="coaBrFlg" compareValue="Y">
        , PRC_CUST_AUDC_BR AS (
        SELECT DISTINCT PCA.GLBL_CMPY_CD
             , PCA.PRC_CATG_CD
          FROM PRC_CUST_AUDC PCA
             , COA_BR CB01
             , COA_BR CB02
             , COA_BR CB03
         WHERE PCA.GLBL_CMPY_CD = #glblCmpyCd#
           AND PCA.EZCANCELFLAG = '0'
           AND PCA.GLBL_CMPY_CD = CB01.GLBL_CMPY_CD(+)
           AND PCA.EZCANCELFLAG = CB01.EZCANCELFLAG(+)
           AND PCA.COA_BR_CD_01 = CB01.COA_BR_CD(+)
           AND PCA.GLBL_CMPY_CD = CB02.GLBL_CMPY_CD(+)
           AND PCA.EZCANCELFLAG = CB02.EZCANCELFLAG(+)
           AND PCA.COA_BR_CD_02 = CB02.COA_BR_CD(+)
           AND PCA.GLBL_CMPY_CD = CB03.GLBL_CMPY_CD(+)
           AND PCA.EZCANCELFLAG = CB03.EZCANCELFLAG(+)
           AND PCA.COA_BR_CD_03 = CB03.COA_BR_CD(+)
        <isNotNull property="coaBrCd">
           AND (PCA.COA_BR_CD_01 = #coaBrCd#
                OR
                PCA.COA_BR_CD_02 = #coaBrCd#
                OR
                PCA.COA_BR_CD_03 = #coaBrCd#
               )
        </isNotNull>
        )
        </isEqual>
        <isEqual property="splyPlnFlg" compareValue="Y">
        , SPLY_PLN AS (
        SELECT DISTINCT PLSP.GLBL_CMPY_CD
             , PLSP.PRC_CATG_CD
          FROM PRC_LIST_SPLY_PGM PLSP
             , SPLY_AGMT_PLN SAP
         WHERE PLSP.GLBL_CMPY_CD = #glblCmpyCd#
           AND PLSP.EZCANCELFLAG = '0'
           AND PLSP.GLBL_CMPY_CD     = SAP.GLBL_CMPY_CD
           AND PLSP.EZCANCELFLAG     = SAP.EZCANCELFLAG
           AND PLSP.SPLY_AGMT_PLN_PK = SAP.SPLY_AGMT_PLN_PK
        <isNotNull property="splyAgmtPlnNm">
           AND SAP.SPLY_AGMT_PLN_NM LIKE #splyAgmtPlnNm#
        </isNotNull>
        )
        </isEqual>

        SELECT PCI.PRC_CATG_CD
             , PCI.PRC_CATG_NM
             , PCI.PRC_LIST_TP_DESC_TXT
             , PCI.PRC_LIST_STRU_TP_CD
             , PCI.PRC_LIST_STRU_TP_DESC_TXT
             , PCI.DISP_STS
             , PCI.PRC_CONTR_NUM
             , PCI.PRC_CONTR_NM
             , PCI.PRC_LIST_GRP_DESC_TXT
             , PCI.EFF_FROM_DT
             , PCI.EFF_THRU_DT
         FROM PRC_CATG_INFO PCI
        <isEqual property="acctFlg" compareValue="Y">
            , PRC_CUST_AUDC_ACCT PCAA
        </isEqual>
        <isEqual property="csmpFlg" compareValue="Y">
            , PRC_CUST_AUDC_CSMP PCAC
        </isEqual>
        <isEqual property="coaBrFlg" compareValue="Y">
            , PRC_CUST_AUDC_BR   PCAB
        </isEqual>
        <isEqual property="splyPlnFlg" compareValue="Y">
            , SPLY_PLN SP
        </isEqual>
        <!-- Add Start 2016/08/01 QC#10928 -->
        <isEqual property="itemNumFlg" compareValue="Y">
        , (
            SELECT DISTINCT PLE.GLBL_CMPY_CD
                 , PLE.PRC_CATG_CD
              FROM PRC_LIST_EQUIP PLE
             WHERE PLE.GLBL_CMPY_CD     = #glblCmpyCd#
               AND PLE.EZCANCELFLAG     = '0'
               AND PLE.PRC_QLFY_TP_CD   = #qualifierTp#
            <isNotNull property="itemNum">
               AND PLE.PRC_QLFY_VAL_TXT LIKE #itemNum#
            </isNotNull>
            UNION ALL 
            SELECT DISTINCT PLS.GLBL_CMPY_CD
                 , PLS.PRC_CATG_CD
              FROM PRC_LIST_SVC PLS
             WHERE PLS.GLBL_CMPY_CD     = #glblCmpyCd#
               AND PLS.EZCANCELFLAG     = '0'
            <isNotNull property="itemNum">
               AND PLS.PRC_LIST_MDSE_CD LIKE #itemNum#
            </isNotNull>
            UNION ALL 
            SELECT DISTINCT PLAC.GLBL_CMPY_CD
                 , PLAC.PRC_CATG_CD
              FROM PRC_LIST_ADDL_CHRG PLAC
              
             WHERE PLAC.GLBL_CMPY_CD = #glblCmpyCd#
               AND PLAC.EZCANCELFLAG = '0'
            <isNotNull property="itemNum">
               AND PLAC.MDSE_CD      LIKE #itemNum#
            </isNotNull>
        ) PL_IN
        </isEqual>
        <isEqual property="modelFlg" compareValue="Y">
        , (
            SELECT DISTINCT PLS.GLBL_CMPY_CD
                 , PLS.PRC_CATG_CD 
              FROM MDL_NM MN
                 , PRC_LIST_SVC PLS
             WHERE MN.T_GLBL_CMPY_CD = #glblCmpyCd# 
               AND MN.EZCANCELFLAG   = '0'
               AND MN.T_GLBL_CMPY_CD = PLS.GLBL_CMPY_CD
               AND MN.EZCANCELFLAG   = PLS.EZCANCELFLAG
               AND MN.T_MDL_ID       = PLS.MDL_ID
            <isNotNull property="serviseModelNm">
               AND MN.T_MDL_NM       LIKE #serviseModelNm#
            </isNotNull>
            UNION ALL 
            SELECT DISTINCT PLST.GLBL_CMPY_CD
                 , PLST.PRC_CATG_CD 
              FROM MDL_NM MN
                 , PRC_LIST_SVC_TIER PLST
             WHERE MN.T_GLBL_CMPY_CD = #glblCmpyCd# 
               AND MN.EZCANCELFLAG   = '0'
               AND MN.T_GLBL_CMPY_CD = PLST.GLBL_CMPY_CD
               AND MN.EZCANCELFLAG   = PLST.EZCANCELFLAG
               AND MN.T_MDL_ID       = PLST.MDL_ID
            <isNotNull property="serviseModelNm">
               AND MN.T_MDL_NM       LIKE #serviseModelNm#
            </isNotNull>
            UNION ALL 
            SELECT DISTINCT PLSP.GLBL_CMPY_CD
                 , PLSP.PRC_CATG_CD 
              FROM MDL_NM MN
                 , PRC_LIST_SPLY_PGM PLSP
             WHERE MN.T_GLBL_CMPY_CD = #glblCmpyCd# 
               AND MN.EZCANCELFLAG   = '0'
               AND MN.T_GLBL_CMPY_CD = PLSP.GLBL_CMPY_CD
               AND MN.EZCANCELFLAG   = PLSP.EZCANCELFLAG
               AND MN.T_MDL_ID       = PLSP.MDL_ID
            <isNotNull property="serviseModelNm">
               AND MN.T_MDL_NM       LIKE #serviseModelNm#
            </isNotNull>
            UNION ALL 
            SELECT DISTINCT PLLR.GLBL_CMPY_CD
                 , PLLR.PRC_CATG_CD 
              FROM MDL_NM MN
                 , PRC_LIST_LEASE_RATE PLLR
             WHERE MN.T_GLBL_CMPY_CD = #glblCmpyCd# 
               AND MN.EZCANCELFLAG   = '0'
               AND MN.T_GLBL_CMPY_CD = PLLR.GLBL_CMPY_CD
               AND MN.EZCANCELFLAG   = PLLR.EZCANCELFLAG
               AND MN.T_MDL_ID       = PLLR.MDL_ID
            <isNotNull property="serviseModelNm">
               AND MN.T_MDL_NM       LIKE #serviseModelNm#
            </isNotNull>
            UNION ALL 
            SELECT DISTINCT PLTI.GLBL_CMPY_CD
                 , PLTI.PRC_CATG_CD 
              FROM MDL_NM MN
                 , PRC_LIST_TI_VAL PLTI
             WHERE MN.T_GLBL_CMPY_CD = #glblCmpyCd# 
               AND MN.EZCANCELFLAG   = '0'
               AND MN.T_GLBL_CMPY_CD = PLTI.GLBL_CMPY_CD
               AND MN.EZCANCELFLAG   = PLTI.EZCANCELFLAG
               AND MN.T_MDL_ID       = PLTI.MDL_ID
            <isNotNull property="serviseModelNm">
               AND MN.T_MDL_NM       LIKE #serviseModelNm#
            </isNotNull>
        ) PL_SMN
        </isEqual>
        <!-- Add End 2016/08/01 QC#10928 -->
          WHERE PCI.GLBL_CMPY_CD = #glblCmpyCd#
        <isEqual property="acctFlg" compareValue="Y">
            AND PCI.GLBL_CMPY_CD = PCAA.GLBL_CMPY_CD
            AND PCI.PRC_CATG_CD  = PCAA.PRC_CATG_CD
        </isEqual>
        <isEqual property="csmpFlg" compareValue="Y">
            AND PCI.GLBL_CMPY_CD = PCAC.GLBL_CMPY_CD
            AND PCI.PRC_CATG_CD  = PCAC.PRC_CATG_CD
        </isEqual>
        <isEqual property="coaBrFlg" compareValue="Y">
            AND PCI.GLBL_CMPY_CD = PCAB.GLBL_CMPY_CD
            AND PCI.PRC_CATG_CD  = PCAB.PRC_CATG_CD
        </isEqual>
        <isEqual property="splyPlnFlg" compareValue="Y">
            AND PCI.GLBL_CMPY_CD = SP.GLBL_CMPY_CD
            AND PCI.PRC_CATG_CD  = SP.PRC_CATG_CD
        </isEqual>
        <isEqual property="prcDispRecTpCd" compareValue="01">
            AND PCI.DISP_STS = #active#
        </isEqual>
        <isEqual property="prcDispRecTpCd" compareValue="02">
            AND PCI.DISP_STS = #inactive#
        </isEqual>
        <isEqual property="prcDispRecTpCd" compareValue="03">
            AND PCI.DISP_STS = #delete#
        </isEqual>
        <isEqual property="prcDispRecTpCd" compareValue="04">
            AND PCI.DISP_STS IN (#active#, #inactive#)
        </isEqual>
        <!-- Add Start 2016/08/01 QC#10928 -->
        <isEqual property="itemNumFlg" compareValue="Y">
            AND PCI.GLBL_CMPY_CD = PL_IN.GLBL_CMPY_CD
            AND PCI.PRC_CATG_CD  = PL_IN.PRC_CATG_CD
        </isEqual>
        <isEqual property="modelFlg" compareValue="Y">
            AND PCI.GLBL_CMPY_CD = PL_SMN.GLBL_CMPY_CD
            AND PCI.PRC_CATG_CD  = PL_SMN.PRC_CATG_CD
        </isEqual>
        <!-- Add End 2016/08/01 QC#10928 -->
            ORDER BY PCI.PRC_CATG_CD
    </statement>
    <resultMap id="result.searchPrcList" class="NMAL7000_ASMsg">
        <result property="prcCatgCd_A1"            column="PRC_CATG_CD"                javaType="EZDSStringItem"/>
        <result property="prcCatgNm_A1"            column="PRC_CATG_NM"                javaType="EZDSStringItem"/>
        <result property="prcListTpDescTxt_A1"     column="PRC_LIST_TP_DESC_TXT"       javaType="EZDSStringItem"/>
        <result property="prcListStruTpCd_A1"      column="PRC_LIST_STRU_TP_CD"        javaType="EZDSStringItem"/>
        <result property="prcListStruTpDescTxt_A1" column="PRC_LIST_STRU_TP_DESC_TXT"  javaType="EZDSStringItem"/>
        <result property="prcDispRecTpDescTxt_A1"  column="DISP_STS"                   javaType="EZDSStringItem"/>
        <result property="prcContrNum_A1"          column="PRC_CONTR_NUM"              javaType="EZDSStringItem"/>
        <result property="prcContrNm_A1"           column="PRC_CONTR_NM"               javaType="EZDSStringItem"/>
        <result property="prcListGrpDescTxt_A1"    column="PRC_LIST_GRP_DESC_TXT"      javaType="EZDSStringItem"/>
        <result property="effFromDt_A1"            column="EFF_FROM_DT"                javaType="EZDSDateItem"/>
        <result property="effThruDt_A1"            column="EFF_THRU_DT"                javaType="EZDSDateItem"/>
    </resultMap>

    <statement id="getSavedSearchOptionList" parameterClass="Map" resultClass="Map">
        SELECT
                  SSO.SRCH_OPT_PK
                , SSO.SRCH_OPT_NM
            FROM
                SAVE_SRCH_OPT SSO 
            WHERE
                SSO.GLBL_CMPY_CD        = #glblCmpyCd#
                AND SSO.SRCH_OPT_APL_ID = #srchOptAplId#
                AND SSO.SRCH_OPT_USR_ID = #srchOptUsrId#
                AND SSO.EZCANCELFLAG    = '0'
            ORDER BY
                  SSO.SRCH_OPT_NM
    </statement>

</sqlMap>
