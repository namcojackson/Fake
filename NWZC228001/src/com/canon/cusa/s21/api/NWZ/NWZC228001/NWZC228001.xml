<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NWZC228001">

    <statement id="getRtrnData" parameterClass="Map"  resultClass="Map">
        SELECT
            CASE
                WHEN SQRC.FIRST_LINE_ADDR IS NOT NULL THEN SQRC.FIRST_LINE_ADDR
                                                           || SQRC.SCD_LINE_ADDR
                                                           || SQRC.THIRD_LINE_ADDR
                                                           || SQRC.FRTH_LINE_ADDR
                                                           || DECODE(SQRC.CTY_ADDR, NULL, ' ', ', ')
                                                           || SQRC.CTY_ADDR
                                                           || DECODE(SQRC.ST_CD, NULL, ' ', ', ')
                                                           || SQRC.ST_CD
                                                           || ' ' || SQRC.POST_CD
                ELSE NULL
            END AS GLBL_FULL_CMPY_ADDR
            ,SQRC.RMA_VLD_DAYS_AOT AS RMA_VLD_DAYS_AOT
            ,'Return Authorization' AS RPT_TTL_TXT
            ,C.CPO_ORD_NUM AS TRX_HDR_NUM
            ,TO_CHAR(TO_DATE(substr(C.CPO_ORD_TS, 1, 8), 'YYYY/MM/DD'), 'MM/DD/YYYY') AS TRX_DT_TXT
            ,C.CUST_ISS_PO_NUM AS CUST_ISS_PO_NUM
            ,C.SELL_TO_CUST_CD AS SELL_TO_CUST_CD
            ,DAC1.LOC_NM AS SELL_TO_LOC_NM
            ,CASE
                WHEN SEBTC.FIRST_LINE_ADDR IS NOT NULL THEN SEBTC.FIRST_LINE_ADDR
                                                            || ' ' || SEBTC.SCD_LINE_ADDR
                                                            || ' ' || SEBTC.THIRD_LINE_ADDR
                                                            || ' ' || SEBTC.FRTH_LINE_ADDR
                ELSE NULL
            END AS SELL_TO_ADDR_01
            ,SEBTC.CTY_ADDR
            || DECODE(SEBTC.ST_CD, NULL, ' ', ', ')
            || SEBTC.ST_CD
            || ' ' || SEBTC.POST_CD AS SELL_TO_ADDR_02
            ,C_CTAC.CTAC_PSN_NM AS FULL_CTAC_PSN_NM
            ,C_CTAC.DS_CTAC_PNT_VAL_TXT AS DS_CTAC_PNT_VAL_TXT
            ,C.SHIP_TO_CUST_ACCT_CD AS SHIP_TO_CUST_CD
            ,CASE
                WHEN C.ADD_DROP_SHIP_FLG = 'Y' THEN DECODE(C.ADD_SHIP_TO_LOC_NM, NULL, DAC3.LOC_NM, C.ADD_SHIP_TO_LOC_NM)
                                                    || DECODE(C.ADD_SHIP_TO_ADDL_LOC_NM, NULL, '', CHR(13) || CHR(10) || C.ADD_SHIP_TO_ADDL_LOC_NM)
                ELSE DAC3.LOC_NM
            END AS SHIP_TO_LOC_NM
            ,C.ADD_SHIP_TO_FIRST_LINE_ADDR
            || ' ' || C.ADD_SHIP_TO_SCD_LINE_ADDR
            || ' ' || C.ADD_SHIP_TO_THIRD_LINE_ADDR
            || ' ' || C.ADD_SHIP_TO_FRTH_LINE_ADDR AS SHIP_TO_ADDR_01
            ,C.ADD_SHIP_TO_CTY_ADDR
            || ', ' || C.ADD_SHIP_TO_ST_CD
            || ' ' || C.ADD_SHIP_TO_POST_CD AS SHIP_TO_ADDR_02
            ,CONCAT(DCRD.DS_ORD_POSN_NUM, '.')
            || CONCAT(DCRD.DS_CPO_LINE_NUM, DECODE(DCRD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
            || DCRD.DS_CPO_LINE_SUB_NUM AS CPO_WRK_LINE_NUM
            ,DCRD.MDSE_CD AS MDSE_CD
            ,DMI.MNF_ITEM_CD AS MNF_ITEM_CD
            ,DMI.MDSE_NM AS MDSE_NM
            ,DMI.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT
            ,NVL(DMSP1.BASE_PKG_UOM_CD, DMSP2.BASE_PKG_UOM_CD) AS PKG_UOM_CD
            ,TO_CHAR(DCRD.ORD_QTY, 'FM9,999,999,990') AS ORD_QTY_TXT
            ,DCRD.ORD_QTY AS ORD_QTY
            ,SQRC.SPLY_QUOTE_RPT_NOTE_TXT_01 AS SPLY_QUOTE_RPT_NOTE_TXT_01
            ,SQRC.SPLY_QUOTE_RPT_NOTE_TXT_02 AS SPLY_QUOTE_RPT_NOTE_TXT_02
            ,SQRC.SPLY_QUOTE_RPT_NOTE_TXT_03 AS SPLY_QUOTE_RPT_NOTE_TXT_03
            ,SQRC.SPLY_QUOTE_RPT_NOTE_TXT_04 AS SPLY_QUOTE_RPT_NOTE_TXT_04
            ,SQRC.SPLY_QUOTE_RPT_NOTE_TXT_05 AS SPLY_QUOTE_RPT_NOTE_TXT_05
            ,SQRC.SPLY_QUOTE_RPT_NOTE_TXT_06 AS SPLY_QUOTE_RPT_NOTE_TXT_06
            ,SQRC.SPLY_QUOTE_RPT_NOTE_TXT_07 AS SPLY_QUOTE_RPT_NOTE_TXT_07
            ,SQRC.SPLY_QUOTE_RPT_NOTE_TXT_08 AS SPLY_QUOTE_RPT_NOTE_TXT_08
            ,SQRC.SPLY_QUOTE_RPT_NOTE_TXT_09 AS SPLY_QUOTE_RPT_NOTE_TXT_09
            ,SQRC.SPLY_QUOTE_RPT_NOTE_TXT_10 AS SPLY_QUOTE_RPT_NOTE_TXT_10
            ,(
                SELECT
                    VCC.VAR_CHAR_CONST_VAL
                FROM
                    VAR_CHAR_CONST VCC
                WHERE
                    VCC.GLBL_CMPY_CD = #glblCmpyCd#
                AND VCC.VAR_CHAR_CONST_NM = #glblCmpyNm#
                AND VCC.EZCANCELFLAG = '0'
            ) AS GLBL_CMPY_NM
            <!-- 2018/08/28 QC#27971 Mod Start -->
            <!-- ,WH.LOC_NM AS RTRN_TO_LOC_NM -->
            ,RW_PLW.LOC_NM AS RTRN_TO_LOC_NM
            <!-- 2018/08/28 QC#27971 Mod End -->
            <!-- 2018/08/31 QC#27971 Mod Start -->
            <!-- ,CASE
                WHEN PLW.FIRST_LINE_ADDR IS NOT NULL THEN PLW.FIRST_LINE_ADDR
                                                            || ' ' || PLW.SCD_LINE_ADDR
                                                            || ' ' || PLW.THIRD_LINE_ADDR
                                                            || ' ' || PLW.FRTH_LINE_ADDR
                ELSE NULL
            END AS RTRN_TO_ADDR_01
            ,PLW.CTY_ADDR
            || DECODE(PLW.ST_CD, NULL, ' ', ', ')
            || PLW.ST_CD
            || ' ' || PLW.POST_CD AS RTRN_TO_ADDR_02 -->
            ,CASE
                WHEN RW.RTRN_TO_FIRST_LINE_ADDR IS NOT NULL
                THEN RW.RTRN_TO_FIRST_LINE_ADDR
                    || ' ' || RW.RTRN_TO_SCD_LINE_ADDR
                    || ' ' || RW.RTRN_TO_THIRD_LINE_ADDR
                    || ' ' || RW.RTRN_TO_FRTH_LINE_ADDR
                ELSE NULL
            END AS RTRN_TO_ADDR_01
            ,RW.RTRN_TO_CTY_ADDR
                || DECODE(RW.RTRN_TO_ST_CD, NULL, ' ', ', ')
                || RW.RTRN_TO_ST_CD
                || ' ' || RW.RTRN_TO_POST_CD AS RTRN_TO_ADDR_02
            <!-- 2018/08/31 QC#27971 Mod Start -->
            ,SQRC.TEL_NUM AS RTRN_AUTH_CTAC_TEL_NUM
        FROM
            CPO C
            ,DS_CPO_RTRN_DTL DCRD
            ,SPLY_QUOTE_RPT_COND SQRC
            ,BILL_TO_CUST SEBTC
            ,(
                SELECT
                    GLBL_CMPY_CD
                    ,CPO_ORD_NUM
                    ,CTAC_PSN_NM
                    ,DS_CTAC_PNT_VAL_TXT
                    ,EZCANCELFLAG
                FROM
                    (
                        SELECT
                            DCCP.GLBL_CMPY_CD
                            ,DCCP.CPO_ORD_NUM
                            ,DCCP.CTAC_PSN_FIRST_NM || ' ' || DCCP.CTAC_PSN_LAST_NM AS CTAC_PSN_NM
                            ,DCCP.CTAC_PSN_TEL_NUM AS DS_CTAC_PNT_VAL_TXT
                            ,DCCP.EZCANCELFLAG
                        FROM
                            DS_CPO_CTAC_PSN DCCP
                        WHERE
                            DCCP.GLBL_CMPY_CD = #glblCmpyCd#
                        AND DCCP.CPO_ORD_NUM = #cpoOrdNum#
                        AND DCCP.CTAC_PSN_TP_CD = #outputCtacTpCd#
                        AND DCCP.EZCANCELFLAG = '0'
                        ORDER BY
                            DCCP.DS_CPO_CTAC_PSN_PK
                    )
                WHERE
                    ROWNUM = 1
            ) C_CTAC
            ,ORD_TAKE_MDSE OTM
            ,MDSE_STORE_PKG DMSP1
            ,MDSE_STORE_PKG DMSP2
            ,SELL_TO_CUST DAC1
            ,SHIP_TO_CUST DAC3
            ,MDSE DMI
            ,WH WH
            ,PTY_LOC_WRK PLW
            ,RTL_WH RW <!-- 2018/08/28 QC#27971 Add -->
            ,SHIP_TO_CUST RW_SHIP <!-- 2018/08/30 QC#27971 Add -->
            ,PTY_LOC_WRK RW_PLW <!-- 2018/08/30 QC#27971 Add -->
        WHERE
            C.GLBL_CMPY_CD = #glblCmpyCd#
        AND C.CPO_ORD_NUM = #cpoOrdNum#
        AND C.EZCANCELFLAG = '0'

        AND C.GLBL_CMPY_CD = DCRD.GLBL_CMPY_CD
        AND C.CPO_ORD_NUM = DCRD.CPO_ORD_NUM
        AND DCRD.EZCANCELFLAG = '0'

        AND C.GLBL_CMPY_CD = C_CTAC.GLBL_CMPY_CD(+)
        AND C.CPO_ORD_NUM = C_CTAC.CPO_ORD_NUM(+)
        AND C_CTAC.EZCANCELFLAG(+) = '0'

        AND C.GLBL_CMPY_CD = SQRC.GLBL_CMPY_CD(+)
        AND C.DS_ORD_CATG_CD = SQRC.DS_ORD_CATG_CD(+)
        AND C.DS_ORD_TP_CD = SQRC.DS_ORD_TP_CD(+)
        AND SQRC.SPLY_QUOTE_RPT_TP_CD(+) = #splyQuoteRptTpCd#
        AND SQRC.EZCANCELFLAG(+) = '0'

        AND C.GLBL_CMPY_CD = SEBTC.GLBL_CMPY_CD(+)
        AND C.SOLD_TO_CUST_LOC_CD = SEBTC.BILL_TO_CUST_CD(+)
        AND SEBTC.EZCANCELFLAG(+) = '0'

        AND DCRD.GLBL_CMPY_CD = OTM.GLBL_CMPY_CD(+)
        AND DCRD.MDSE_CD = OTM.ORD_TAKE_MDSE_CD(+)
        AND OTM.EZCANCELFLAG(+) = '0'

        AND OTM.GLBL_CMPY_CD = DMSP1.GLBL_CMPY_CD(+)
        AND OTM.MDSE_CD = DMSP1.MDSE_CD(+)
        AND DMSP1.BASE_PKG_UOM_CD(+) IS NOT NULL
        AND DMSP1.EZCANCELFLAG(+) = '0'

        AND DCRD.GLBL_CMPY_CD = DMSP2.GLBL_CMPY_CD(+)
        AND DCRD.MDSE_CD = DMSP2.MDSE_CD(+)
        AND DMSP2.BASE_PKG_UOM_CD(+) IS NOT NULL
        AND DMSP2.EZCANCELFLAG(+) = '0'

        AND C.GLBL_CMPY_CD = DAC1.GLBL_CMPY_CD(+)
        AND C.SELL_TO_CUST_CD = DAC1.SELL_TO_CUST_CD(+)
        AND DAC1.EZCANCELFLAG(+) = '0'

        AND C.GLBL_CMPY_CD = DAC3.GLBL_CMPY_CD(+)
        AND C.ADD_SHIP_TO_CUST_CD = DAC3.SHIP_TO_CUST_CD(+)
        AND DAC3.EZCANCELFLAG(+) = '0'

        AND DCRD.GLBL_CMPY_CD = DMI.GLBL_CMPY_CD
        AND NVL(OTM.MDSE_CD, DCRD.MDSE_CD) = DMI.MDSE_CD
        AND DMI.EZCANCELFLAG = '0'

        AND DCRD.GLBL_CMPY_CD = WH.GLBL_CMPY_CD
        AND DCRD.INVTY_LOC_CD = WH.WH_CD
        AND WH.EZCANCELFLAG = '0'

        AND WH.GLBL_CMPY_CD = PLW.GLBL_CMPY_CD
        AND WH.LOC_NUM = PLW.LOC_NUM
        AND PLW.EZCANCELFLAG = '0'

        <!-- 2018/08/28 QC#27971 Add Start -->
        AND DCRD.GLBL_CMPY_CD = RW.GLBL_CMPY_CD(+)
        AND DCRD.RTL_WH_CD = RW.RTL_WH_CD (+)
        AND RW.EZCANCELFLAG(+) = '0'
        <!-- 2018/08/28 QC#27971 Add End -->

        <!-- 2018/08/30 QC#27971 Add Start -->
        AND RW.GLBL_CMPY_CD = RW_SHIP.GLBL_CMPY_CD(+)
        AND RW.SHIP_TO_CUST_CD = RW_SHIP.SHIP_TO_CUST_CD (+)
        AND RW_SHIP.EZCANCELFLAG(+) = '0'

        AND RW_SHIP.GLBL_CMPY_CD = RW_PLW.GLBL_CMPY_CD(+)
        AND RW_SHIP.PTY_LOC_PK = RW_PLW.PTY_LOC_PK(+)
        AND RW_PLW.EZCANCELFLAG(+) = '0'
        <!-- 2018/08/30 QC#27971 Add End -->

        ORDER BY
            CONCAT(DCRD.DS_ORD_POSN_NUM, '.')
            || CONCAT(DCRD.DS_CPO_LINE_NUM, DECODE(DCRD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
            || DCRD.DS_CPO_LINE_SUB_NUM
    </statement>

    <statement id="getDeleteWrk" parameterClass="Map"  resultClass="Map">
        SELECT
            R.RTRN_AUTH_RPT_WRK_PK
        FROM
            RTRN_AUTH_RPT_WRK R
        WHERE
            R.GLBL_CMPY_CD = #glblCmpyCd#
        AND R.BIZ_APP_ID = #bizAppId#
        AND R.OTPT_OP_CD = #otptOpCd#
        AND R.TRX_HDR_NUM = #trxHdrNum#
        AND R.EZCANCELFLAG = '0'
    </statement>
</sqlMap>