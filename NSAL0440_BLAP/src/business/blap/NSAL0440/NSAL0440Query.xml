<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL0440Query">
    <typeAlias alias="SVC_TERM_COND_CATGTMsg"           type="business.db.SVC_TERM_COND_CATGTMsg"/>
    <typeAlias alias="NSAL0440CMsg"                     type="business.blap.NSAL0440.NSAL0440CMsg"/>
    <typeAlias alias="NSAL0440_BSMsg"                   type="business.blap.NSAL0440.NSAL0440_BSMsg"/>
<!-- START 2016/09/29 A.Kohinata [QC#12898, ADD] -->
    <typeAlias alias="NSAL0440_YCMsg"                   type="business.blap.NSAL0440.NSAL0440_YCMsg"/>
<!-- END 2016/09/29 A.Kohinata [QC#12898, ADD] -->

    <statement id="getSvcTermCategoryPulldownList" parameterClass="Map" resultMap="result.getSvcTermCategoryPulldownList">
        SELECT
            GLBL_CMPY_CD
            ,SVC_TERM_COND_CATG_PK
            ,TO_CHAR(SVC_TERM_COND_CATG_PK) AS SVC_TERM_COND_CATG_NM
            ,SVC_TERM_COND_CATG_DESC_TXT
        FROM
            SVC_TERM_COND_CATG
        WHERE
            GLBL_CMPY_CD                        = #glblCmpyCd#
            AND EZCANCELFLAG                    = '0'
            AND EFF_FROM_DT                 &lt;= #slsDt#
            AND NVL(EFF_THRU_DT,#maxDt#)    &gt;= #slsDt#
        ORDER BY 
            SVC_TERM_COND_CATG_SORT_NUM
    </statement>
    <resultMap id="result.getSvcTermCategoryPulldownList"        class="SVC_TERM_COND_CATGTMsg">
        <result property="glblCmpyCd"                 column="GLBL_CMPY_CD"                   javaType="EZDTStringItem"/>
        <result property="svcTermCondCatgPk"          column="SVC_TERM_COND_CATG_PK"          javaType="EZDTBigDecimalItem"/>
        <result property="svcTermCondCatgNm"          column="SVC_TERM_COND_CATG_NM"          javaType="EZDTStringItem"/>
        <result property="svcTermCondCatgDescTxt"     column="SVC_TERM_COND_CATG_DESC_TXT"    javaType="EZDTStringItem"/>
    </resultMap>
       
        
    <statement id="getContractData" parameterClass="Map" resultMap="result.getContractData">
        SELECT
            CON.DS_CONTR_NUM
            ,CON.CONTR_VRSN_EFF_FROM_DT
            ,CON.CONTR_VRSN_EFF_THRU_DT
            ,ACT.DS_ACCT_NM
           <isNull property="dsContrDtlPk">
            ,NULL AS SER_NUM
           </isNull>
           <isNotNull property="dsContrDtlPk">
            ,MAC.SER_NUM
           </isNotNull>
<!-- START 2016/09/29 A.Kohinata [QC#12898, ADD] -->
            ,CON.DS_CONTR_CATG_CD
<!-- END 2016/09/29 A.Kohinata [QC#12898, ADD] -->
        FROM
            DS_CONTR                CON
            ,SELL_TO_CUST           ACT
           <isNotNull property="dsContrDtlPk">
            ,DS_CONTR_DTL           DTL
            ,SVC_MACH_MSTR          MAC
           </isNotNull>
        WHERE
            CON.GLBL_CMPY_CD                    = #glblCmpyCd#
            AND CON.DS_CONTR_PK                 = #dsContrPk#
            AND CON.EZCANCELFLAG                = '0'
            AND CON.GLBL_CMPY_CD                = ACT.GLBL_CMPY_CD(+)
            AND CON.DS_ACCT_NUM                 = ACT.SELL_TO_CUST_CD(+)
            AND ACT.EZCANCELFLAG(+)             = '0'
           <isNotNull property="dsContrDtlPk">
            AND CON.GLBL_CMPY_CD                = DTL.GLBL_CMPY_CD(+)
            AND CON.DS_CONTR_PK                 = DTL.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK(+)          = #dsContrDtlPk#
            AND DTL.EZCANCELFLAG(+)             = '0'
            AND DTL.GLBL_CMPY_CD                = MAC.GLBL_CMPY_CD(+)
            AND DTL.SVC_MACH_MSTR_PK            = MAC.SVC_MACH_MSTR_PK(+)
            AND MAC.EZCANCELFLAG(+)             = '0'
           </isNotNull>
            AND ROWNUM = 1
    </statement>
    <resultMap id="result.getContractData"        class="NSAL0440CMsg">
        <result property="dsContrNum"             column="DS_CONTR_NUM"              javaType="EZDSStringItem"/>
        <result property="contrVrsnEffFromDt"     column="CONTR_VRSN_EFF_FROM_DT"    javaType="EZDSDateItem"/>
        <result property="contrVrsnEffThruDt"     column="CONTR_VRSN_EFF_THRU_DT"    javaType="EZDSDateItem"/>
        <result property="dsAcctNm"               column="DS_ACCT_NM"                javaType="EZDSStringItem"/>
        <result property="serNum"                 column="SER_NUM"                   javaType="EZDSStringItem"/>
<!-- START 2016/09/29 A.Kohinata [QC#12898, ADD] -->
        <result property="dsContrCatgCd"          column="DS_CONTR_CATG_CD"          javaType="EZDSStringItem"/>
<!-- END 2016/09/29 A.Kohinata [QC#12898, ADD] -->
    </resultMap>
    
    <statement id="getMainData" parameterClass="Map" resultMap="result.getMainData">
        SELECT
            ROWNUM AS XX_ROW_NUM
            ,ROW_NUMBER() OVER (PARTITION BY SVC_TERM_COND_CATG_PK ORDER BY SVC_TERM_ATTRB_SORT_NUM,DS_CONTR_DTL_PK NULLS FIRST) AS XX_LIST_NUM
            ,SVC_TERM_COND_CATG_PK
            ,SVC_TERM_COND_CATG_DESC_TXT
            ,SVC_TERM_ATTRB_DESC_TXT
            ,SVC_TERM_COND_ATTRB_PK
            ,CASE WHEN SVC_TERM_DATA_TP_CD = #tpTextbox# THEN SVC_TERM_ATTRB_MAP_VAL_CD
                  <!-- add start 2018/07/31 QC#26659 -->
                  WHEN SVC_TERM_DATA_TP_CD = #tpTextNumeric# THEN SVC_TERM_ATTRB_MAP_VAL_CD
                  <!-- add end 2018/07/31 QC#26659 -->
                  ELSE NULL END AS SVC_TERM_ATTRB_MAP_VAL_CD
            ,CASE WHEN SVC_TERM_DATA_TP_CD = #tpDropdown# THEN SVC_TERM_ATTRB_MAP_VAL_CD
                  WHEN SVC_TERM_DATA_TP_CD = #tpLookup# THEN SVC_TERM_ATTRB_MAP_VAL_CD
                  <!-- add start 2018/06/25 QC#17369 -->
                  WHEN SVC_TERM_DATA_TP_CD = #tpLookupPopup# THEN SVC_TERM_ATTRB_MAP_VAL_CD
                  <!-- add end 2018/06/25 QC#17369 -->
                  ELSE NULL END AS SVC_TERM_COND_DATA_VAL_CD
            ,CASE WHEN SVC_TERM_DATA_TP_CD = #tpNumber# THEN TO_NUMBER(SVC_TERM_ATTRB_MAP_VAL_CD)
                  ELSE NULL END AS COND_VAL_NUM
            ,CASE WHEN SVC_TERM_DATA_TP_CD = #tpDate# THEN SVC_TERM_ATTRB_MAP_VAL_CD
                  ELSE NULL END AS XX_TRX_DT
            ,SVC_TERM_COND_CATG_SORT_NUM
            ,SVC_TERM_ATTRB_SORT_NUM
            ,DS_CONTR_DTL_PK
            ,SER_NUM
            ,SVC_TERM_COND_DATA_SRC_CD
            ,SVC_TERM_DATA_TP_CD
            ,CASE WHEN SER_SVC_TERM_DATA_TP_CD = #tpTextbox# THEN SER_SVC_TERM_ATTRB_MAP_VAL_CD
                  <!-- add start 2018/07/31 QC#26659 -->
                  WHEN SER_SVC_TERM_DATA_TP_CD = #tpTextNumeric# THEN SER_SVC_TERM_ATTRB_MAP_VAL_CD
                  <!-- add end 2018/07/31 QC#26659 -->
                  ELSE NULL END AS SER_SVC_TERM_ATTRB_MAP_VAL_CD
            ,CASE WHEN SER_SVC_TERM_DATA_TP_CD = #tpDropdown# THEN SER_SVC_TERM_ATTRB_MAP_VAL_CD
                  WHEN SER_SVC_TERM_DATA_TP_CD = #tpLookup# THEN SER_SVC_TERM_ATTRB_MAP_VAL_CD
                  <!-- add start 2018/06/25 QC#17369 -->
                  WHEN SER_SVC_TERM_DATA_TP_CD = #tpLookupPopup# THEN SER_SVC_TERM_ATTRB_MAP_VAL_CD
                  <!-- add end 2018/06/25 QC#17369 -->
                  ELSE NULL END AS SER_SVC_TERM_COND_DATA_VAL_CD
            ,CASE WHEN SER_SVC_TERM_DATA_TP_CD = #tpNumber# THEN SER_SVC_TERM_ATTRB_MAP_VAL_CD
                  ELSE NULL END AS SER_COND_VAL_NUM
            ,CASE WHEN SER_SVC_TERM_DATA_TP_CD = #tpDate# THEN SER_SVC_TERM_ATTRB_MAP_VAL_CD
                  ELSE NULL END AS SER_XX_TRX_DT
            ,SER_SVC_TERM_DATA_TP_CD
            ,XX_BTN_FLG
            ,XX_DPLY_CTRL_FLG
            ,EZUPTIME
            ,EZUPTIMEZONE
            ,SVC_TERM_COND_PK
            ,DS_CONTR_CTRL_STS_CD
            ,DS_CONTR_STS_CD
            ,DS_CONTR_DTL_STS_CD
            ,SVC_PGM_MDSE_CD
<!-- START 2016/12/06 K.Ochiai [QC#14204, ADD] -->
            ,XX_REC_HIST_CRAT_TS
            ,XX_REC_HIST_CRAT_BY_NM
            ,XX_REC_HIST_UPD_TS
            ,XX_REC_HIST_UPD_BY_NM
            ,XX_REC_HIST_TBL_NM
<!-- END 2016/12/06 K.Ochiai [QC#14204, ADD] -->
        FROM
            (
            SELECT
                CAT.SVC_TERM_COND_CATG_PK
                ,CAT.SVC_TERM_COND_CATG_DESC_TXT
                ,ATB.SVC_TERM_ATTRB_DESC_TXT
                ,ATB.SVC_TERM_COND_ATTRB_PK
                ,CON.SVC_TERM_ATTRB_MAP_VAL_CD
                ,CAT.SVC_TERM_COND_CATG_SORT_NUM
                ,SVC_TERM_ATTRB_SORT_NUM
                ,CON.DS_CONTR_DTL_PK
                ,CASE
                    WHEN ATB.SVC_TERM_COND_DATA_SRC_CD IS NULL
                    THEN ATB.PHYS_MAINT_TRGT_TBL_NM
                    ELSE ATB.SVC_TERM_COND_DATA_SRC_CD
                 END  AS SVC_TERM_COND_DATA_SRC_CD
                ,ATB.SVC_TERM_DATA_TP_CD
                ,NULL AS SER_NUM
                ,CON.SVC_TERM_ATTRB_MAP_VAL_CD AS SER_SVC_TERM_ATTRB_MAP_VAL_CD
                ,NULL AS SER_SVC_TERM_DATA_TP_CD 
                ,#xxBtnFlg# AS XX_BTN_FLG
                ,'Y' AS XX_DPLY_CTRL_FLG
                ,CON.EZUPTIME
                ,CON.EZUPTIMEZONE
                ,CON.SVC_TERM_COND_PK
                ,HDR.DS_CONTR_CTRL_STS_CD AS DS_CONTR_CTRL_STS_CD
                ,DSC.DS_CONTR_STS_CD      AS DS_CONTR_STS_CD
                ,NULL                     AS DS_CONTR_DTL_STS_CD
                ,DSC.SVC_PGM_MDSE_CD
<!-- START 2016/12/06 K.Ochiai [QC#14204, ADD] -->
                ,CON.EZINTIME              AS XX_REC_HIST_CRAT_TS
                ,CON.EZINUSERID            AS XX_REC_HIST_CRAT_BY_NM
                ,CON.EZUPTIME              AS XX_REC_HIST_UPD_TS
                ,CON.EZUPUSERID            AS XX_REC_HIST_UPD_BY_NM
                ,CON.EZTABLEID             AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/06 K.Ochiai [QC#14204, ADD] -->
            FROM 
                SVC_TERM_COND_ATTRB     ATB
                ,SVC_TERM_COND_CATG     CAT
                ,SVC_TERM_COND          CON
                ,DS_CONTR_STS_V         HDR
                ,DS_CONTR               DSC
            WHERE
                ATB.GLBL_CMPY_CD                    = #glblCmpyCd#
                AND ATB.SVC_TERM_ATTRB_ACTV_FLG     = 'Y'
                AND ATB.EFF_FROM_DT                 &lt;= #slsDt#
                AND NVL(ATB.EFF_THRU_DT,#maxDt#)    &gt;= #slsDt#
                AND ATB.EZCANCELFLAG                = '0'
                AND ATB.GLBL_CMPY_CD                = CAT.GLBL_CMPY_CD
                AND ATB.SVC_TERM_COND_CATG_PK       = CAT.SVC_TERM_COND_CATG_PK
                AND CAT.SVC_TERM_COND_CATG_ACTV_FLG = 'Y'
                AND CAT.EFF_FROM_DT                 &lt;= #slsDt#
                AND NVL(CAT.EFF_THRU_DT,#maxDt#)    &gt;= #slsDt#
                AND CAT.EZCANCELFLAG                = '0'
                AND ATB.GLBL_CMPY_CD                = CON.GLBL_CMPY_CD(+)
                AND ATB.SVC_TERM_COND_ATTRB_PK      = CON.SVC_TERM_COND_ATTRB_PK(+)
                AND CON.DS_CONTR_PK(+)              = #dsContrPk#
                AND CON.DS_CONTR_DTL_PK(+)          IS NULL
                AND CON.EZCANCELFLAG(+)             = '0'
                AND HDR.DS_CONTR_PK(+)              = #dsContrPk#
                AND HDR.GLBL_CMPY_CD(+)             = #glblCmpyCd#
                AND HDR.EZCANCELFLAG(+)             = '0'
                AND HDR.DS_CONTR_PK                 = DSC.DS_CONTR_PK   (+)
                AND HDR.GLBL_CMPY_CD                = DSC.GLBL_CMPY_CD  (+)
                AND DSC.EZCANCELFLAG(+)             = '0'
                <!-- START 2022/08/03 N.Takatsu [QC#60077, MOD]-->
                <!--  <isNotNull property="svcTermCondCatgPk">              -->
                <!--  AND ATB.SVC_TERM_COND_CATG_PK = #svcTermCondCatgPk#   -->
                <!--  </isNotNull>                                          -->
                <iterate property="svcTermCondCatgPkList" var="svcTermCondCatgPkList[]" open="AND ATB.SVC_TERM_COND_CATG_PK IN (" close=")" conjunction=",">
                    #svcTermCondCatgPkList[]#
                </iterate>
                <!-- END 2022/08/03 N.Takatsu [QC#60077, MOD] -->
                <isNotNull property="xxChkBox_H1">
                AND EXISTS (
                        SELECT * FROM SVC_TERM_COND DFM
                        WHERE 
                            DFM.SVC_TERM_COND_ATTRB_PK          = ATB.SVC_TERM_COND_ATTRB_PK
                            AND DFM.DS_CONTR_PK                 = CON.DS_CONTR_PK
                            AND NVL(DFM.SVC_TERM_ATTRB_MAP_VAL_CD,' ')  &lt;&gt; NVL(CON.SVC_TERM_ATTRB_MAP_VAL_CD,' ')
                            AND DFM.EZCANCELFLAG                = '0' 
                            <iterate property="dsContrDtlList" var="dsContrDtlPk[]" open="AND DFM.DS_CONTR_DTL_PK IN (" close=")" conjunction=",">
                                #dsContrDtlPk[]#
                            </iterate>
                            <isNotNull property="isExistSerNumList">
                            AND EXISTS(SELECT * FROM 
                                        DS_CONTR_DTL           DTL
                                        ,SVC_MACH_MSTR         MAC
                                        WHERE 
                                         DFM.GLBL_CMPY_CD                = DTL.GLBL_CMPY_CD
                                        AND DFM.DS_CONTR_PK              = DTL.DS_CONTR_PK
                                        AND DFM.DS_CONTR_DTL_PK          = DTL.DS_CONTR_DTL_PK
                                        AND DTL.EZCANCELFLAG             = '0'
                                        AND DTL.SVC_MACH_MSTR_PK         = MAC.SVC_MACH_MSTR_PK
                                        AND DTL.GLBL_CMPY_CD             = MAC.GLBL_CMPY_CD
                                        <iterate property="serNumList" var="serNum[]" open="AND MAC.SER_NUM IN (" close=")" conjunction=",">
                                        #serNum[]#
                                        </iterate>
                                        AND MAC.EZCANCELFLAG             = '0')
                            </isNotNull>
                            )
                </isNotNull>
            UNION ALL
            
            SELECT
                CAT.SVC_TERM_COND_CATG_PK
                ,CAT.SVC_TERM_COND_CATG_DESC_TXT
                ,ATB.SVC_TERM_ATTRB_DESC_TXT
                ,ATB.SVC_TERM_COND_ATTRB_PK
                ,CON.SVC_TERM_ATTRB_MAP_VAL_CD
                ,CAT.SVC_TERM_COND_CATG_SORT_NUM
                ,SVC_TERM_ATTRB_SORT_NUM
                ,DTL.DS_CONTR_DTL_PK
                ,CASE
                    WHEN ATB.SVC_TERM_COND_DATA_SRC_CD IS NULL
                    THEN ATB.PHYS_MAINT_TRGT_TBL_NM
                    ELSE ATB.SVC_TERM_COND_DATA_SRC_CD
                 END  AS SVC_TERM_COND_DATA_SRC_CD
                ,NULL AS SVC_TERM_DATA_TP_CD
                ,MAC.SER_NUM
                ,CON.SVC_TERM_ATTRB_MAP_VAL_CD AS SER_SVC_TERM_ATTRB_MAP_VAL_CD
                ,ATB.SVC_TERM_DATA_TP_CD AS SER_SVC_TERM_DATA_TP_CD 
                ,'N' AS XX_BTN_FLG
                ,'N' AS XX_DPLY_CTRL_FLG
                ,CON.EZUPTIME
                ,CON.EZUPTIMEZONE
                ,CON.SVC_TERM_COND_PK
                ,DTV.DS_CONTR_CTRL_STS_CD  AS DS_CONTR_CTRL_STS_CD
                ,DSC.DS_CONTR_STS_CD       AS DS_CONTR_STS_CD
                ,DTL.DS_CONTR_DTL_STS_CD   AS DS_CONTR_DTL_STS_CD
                ,CASE
                    WHEN DSC.DS_CONTR_CATG_CD = #dsContrCatgCd_Fleet# THEN
                        FLT.SVC_PGM_MDSE_CD
                    ELSE
                        DTL.SVC_PGM_MDSE_CD
                 END AS SVC_PGM_MDSE_CD
<!-- START 2016/12/06 K.Ochiai [QC#14204, ADD] -->
                ,CON.EZINTIME              AS XX_REC_HIST_CRAT_TS
                ,CON.EZINUSERID            AS XX_REC_HIST_CRAT_BY_NM
                ,CON.EZUPTIME              AS XX_REC_HIST_UPD_TS
                ,CON.EZUPUSERID            AS XX_REC_HIST_UPD_BY_NM
                ,CON.EZTABLEID             AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/06 K.Ochiai [QC#14204, ADD] -->
            FROM 
                SVC_TERM_COND_ATTRB     ATB
                ,SVC_TERM_COND_CATG     CAT
                ,SVC_TERM_COND          CON
                ,DS_CONTR_DTL           DTL
                ,SVC_MACH_MSTR          MAC
                ,DS_CONTR_DTL_STS_V     DTV
                ,DS_CONTR               DSC
                ,DS_CONTR_DTL           FLT
            WHERE
                ATB.GLBL_CMPY_CD                    = #glblCmpyCd#
                AND ATB.SVC_TERM_ATTRB_ACTV_FLG     = 'Y'
                AND ATB.EFF_FROM_DT                 &lt;= #slsDt#
                AND NVL(ATB.EFF_THRU_DT,#maxDt#)    &gt;= #slsDt#
                AND ATB.EZCANCELFLAG                = '0'
                AND ATB.GLBL_CMPY_CD                = CAT.GLBL_CMPY_CD
                AND ATB.SVC_TERM_COND_CATG_PK       = CAT.SVC_TERM_COND_CATG_PK
                AND CAT.SVC_TERM_COND_CATG_ACTV_FLG = 'Y'
                AND CAT.EFF_FROM_DT                 &lt;= #slsDt#
                AND NVL(CAT.EFF_THRU_DT,#maxDt#)    &gt;= #slsDt#
                AND CAT.EZCANCELFLAG                = '0'
                AND DTL.GLBL_CMPY_CD                = ATB.GLBL_CMPY_CD
                AND DTL.DS_CONTR_PK                 = #dsContrPk#
                AND DTL.DS_CONTR_DTL_PK             IS NOT NULL
                AND DTL.EZCANCELFLAG                = '0'
                AND DTL.GLBL_CMPY_CD                = MAC.GLBL_CMPY_CD
                AND DTL.SVC_MACH_MSTR_PK            = MAC.SVC_MACH_MSTR_PK
                AND MAC.EZCANCELFLAG                = '0'
                AND ATB.GLBL_CMPY_CD                = CON.GLBL_CMPY_CD(+)
                AND ATB.SVC_TERM_COND_ATTRB_PK      = CON.SVC_TERM_COND_ATTRB_PK(+)
                AND DTL.GLBL_CMPY_CD                = CON.GLBL_CMPY_CD(+)
                AND DTL.DS_CONTR_PK                 = CON.DS_CONTR_PK(+)
                AND DTL.DS_CONTR_DTL_PK             = CON.DS_CONTR_DTL_PK(+)
                AND CON.EZCANCELFLAG(+)             = '0'
                AND DTL.GLBL_CMPY_CD                = DTV.GLBL_CMPY_CD
                AND DTL.DS_CONTR_PK                 = DTV.DS_CONTR_PK
                AND DTL.DS_CONTR_DTL_PK             = DTV.DS_CONTR_DTL_PK
                AND DTV.EZCANCELFLAG                = '0'
                AND DTL.GLBL_CMPY_CD                = DSC.GLBL_CMPY_CD
                AND DTL.DS_CONTR_PK                 = DSC.DS_CONTR_PK
                AND DSC.EZCANCELFLAG                = '0'
                AND DSC.GLBL_CMPY_CD                = FLT.GLBL_CMPY_CD(+)
                AND DSC.DS_CONTR_PK                 = FLT.DS_CONTR_PK(+)
                AND FLT.DS_CONTR_DTL_TP_CD(+)       = #dsContrDtlTpCd_Fleet#
                AND FLT.EZCANCELFLAG(+)             = '0'
                <iterate property="dsContrDtlList" var="dsContrDtlPk[]" open="AND DTL.DS_CONTR_DTL_PK IN (" close=")" conjunction=",">
                    #dsContrDtlPk[]#
                </iterate>
                <isNotNull property="isExistSerNumList">
                <iterate property="serNumList" var="serNum[]" open="AND MAC.SER_NUM IN (" close=")" conjunction=",">
                                    #serNum[]#
                </iterate>
                </isNotNull>
                <!-- START 2022/08/03 N.Takatsu [QC#60077, MOD] -->
                <!--  <isNotNull property="svcTermCondCatgPk">              -->
                <!--  AND ATB.SVC_TERM_COND_CATG_PK = #svcTermCondCatgPk#   -->
                <!--  </isNotNull>                                          -->
                <iterate property="svcTermCondCatgPkList" var="svcTermCondCatgPkList[]" open="AND ATB.SVC_TERM_COND_CATG_PK IN (" close=")" conjunction=",">
                    #svcTermCondCatgPkList[]#
                </iterate>
                <!-- END 2022/08/03 N.Takatsu [QC#60077, MOD] -->
                <isNotNull property="xxChkBox_H1">
                AND EXISTS (
                    SELECT * FROM SVC_TERM_COND DFM
                    WHERE 
                        DFM.SVC_TERM_COND_ATTRB_PK          = ATB.SVC_TERM_COND_ATTRB_PK
                        AND DFM.DS_CONTR_PK                 = CON.DS_CONTR_PK
                        AND DFM.DS_CONTR_DTL_PK             IS NULL
                        AND NVL(DFM.SVC_TERM_ATTRB_MAP_VAL_CD,' ')  &lt;&gt; NVL(CON.SVC_TERM_ATTRB_MAP_VAL_CD,' ')
                        AND DFM.EZCANCELFLAG                = '0' )
                </isNotNull>
                <isNotNull property="xxChkBox_H2">
<!--                AND NOT EXISTS( -->
<!--                            SELECT * FROM  DS_CONTR_DTL_STS_V STS -->
<!--                            WHERE -->
<!--                                DTL.GLBL_CMPY_CD              = STS.GLBL_CMPY_CD -->
<!--                                AND DTL.DS_CONTR_PK           = STS.DS_CONTR_PK -->
<!--                                AND DTL.DS_CONTR_DTL_PK       = STS.DS_CONTR_DTL_PK -->
<!--                                AND STS.DS_CONTR_DTL_STS_CD   IN -->
<!--                                <iterate property="dsContrDtlStsList" var="dsContrDtlStsList[]" open="(" close=")" conjunction=","> -->
<!--                                #dsContrDtlStsList[]# -->
<!--                                </iterate> -->
<!--                                AND STS.EZCANCELFLAG          = '0') -->
                <iterate property="dsContrDtlStsList" var="dsContrDtlStsList[]" open="AND DTL.DS_CONTR_DTL_STS_CD NOT IN (" close=")" conjunction=",">
                #dsContrDtlStsList[]#
                </iterate>
                </isNotNull>
            ORDER BY
                SVC_TERM_COND_CATG_SORT_NUM
                ,SVC_TERM_ATTRB_SORT_NUM
                ,DS_CONTR_DTL_PK NULLS FIRST
            )
        WHERE
            ROWNUM &lt;= #limitNum#
        <!-- START 2018/12/12 T.Tomita [QC#29598, ADD] -->
        ORDER BY
             SVC_TERM_COND_CATG_SORT_NUM
            ,SVC_TERM_ATTRB_SORT_NUM
            ,DS_CONTR_DTL_PK NULLS FIRST
        <!-- END 2018/12/12 T.Tomita [QC#29598, ADD] -->
    </statement>
    <resultMap id="result.getMainData"        class="NSAL0440_BSMsg">
        <result property="xxRowNum_A"                   column="XX_ROW_NUM"                     javaType="EZDSBigDecimalItem"/>
        <result property="xxListNum_A"                  column="XX_LIST_NUM"                    javaType="EZDSBigDecimalItem"/>
        <result property="svcTermCondCatgPk_A"          column="SVC_TERM_COND_CATG_PK"          javaType="EZDSBigDecimalItem"/>
        <result property="svcTermCondCatgDescTxt_A"     column="SVC_TERM_COND_CATG_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="svcTermAttrbDescTxt_A"        column="SVC_TERM_ATTRB_DESC_TXT"        javaType="EZDSStringItem"/>
        <result property="svcTermCondAttrbPk_A"         column="SVC_TERM_COND_ATTRB_PK"         javaType="EZDSBigDecimalItem"/>
        <result property="svcTermAttrbMapValCd_A"       column="SVC_TERM_ATTRB_MAP_VAL_CD"      javaType="EZDSStringItem"/>
        <result property="svcTermCondDataValCd_PS"      column="SVC_TERM_COND_DATA_VAL_CD"      javaType="EZDSStringItem"/>
        <result property="condValNum_A"                 column="COND_VAL_NUM"                   javaType="EZDSBigDecimalItem"/>
        <result property="xxTrxDt_A"                    column="XX_TRX_DT"                      javaType="EZDSDateItem"/>
        <result property="svcTermCondCatgSortNum_A"     column="SVC_TERM_COND_CATG_SORT_NUM"    javaType="EZDSBigDecimalItem"/>
        <result property="svcTermAttrbSortNum_A"        column="SVC_TERM_ATTRB_SORT_NUM"        javaType="EZDSBigDecimalItem"/>
        <result property="dsContrDtlPk_A"               column="DS_CONTR_DTL_PK"                javaType="EZDSBigDecimalItem"/>
        <result property="serNum_A"                     column="SER_NUM"                        javaType="EZDSStringItem"/>
        <result property="svcTermCondDataSrcCd_A"       column="SVC_TERM_COND_DATA_SRC_CD"      javaType="EZDSStringItem"/>
        <result property="svcTermDataTpCd_A"            column="SVC_TERM_DATA_TP_CD"            javaType="EZDSStringItem"/>
        <result property="svcTermAttrbDescTxt_M"        column="SER_SVC_TERM_ATTRB_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="svcTermAttrbMapValCd_M"       column="SER_SVC_TERM_ATTRB_MAP_VAL_CD"  javaType="EZDSStringItem"/>
        <result property="svcTermCondDataValCd_MS"      column="SER_SVC_TERM_COND_DATA_VAL_CD"  javaType="EZDSStringItem"/>
        <result property="condValNum_M"                 column="SER_COND_VAL_NUM"               javaType="EZDSBigDecimalItem"/>
        <result property="xxTrxDt_M"                    column="SER_XX_TRX_DT"                  javaType="EZDSDateItem"/>
        <result property="svcTermDataTpCd_M"            column="SER_SVC_TERM_DATA_TP_CD"        javaType="EZDSStringItem"/>
        <result property="xxBtnFlg_A"                   column="XX_BTN_FLG"                     javaType="EZDSStringItem"/>
        <result property="xxDplyCtrlFlg_A"              column="XX_DPLY_CTRL_FLG"               javaType="EZDSStringItem"/>
        <result property="svcTermCondPk"                column="SVC_TERM_COND_PK"               javaType="EZDSBigDecimalItem"/>
        <result property="ezUpTime"                     column="EZUPTIME"                       javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone"                 column="EZUPTIMEZONE"                   javaType="EZDSStringItem"/>
        <result property="dsContrCtrlStsCd_A"           column="DS_CONTR_CTRL_STS_CD"           javaType="EZDSStringItem"/>
        <result property="dsContrStsCd_A"               column="DS_CONTR_STS_CD"                javaType="EZDSStringItem"/>
        <result property="dsContrDtlStsCd_A"            column="DS_CONTR_DTL_STS_CD"            javaType="EZDSStringItem"/>
        <result property="svcPgmMdseCd_A"               column="SVC_PGM_MDSE_CD"                javaType="EZDSStringItem"/>
<!-- START 2016/12/06 K.Ochiai [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_A"            column="XX_REC_HIST_CRAT_TS"            javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_A"          column="XX_REC_HIST_CRAT_BY_NM"         javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_A"             column="XX_REC_HIST_UPD_TS"             javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_A"           column="XX_REC_HIST_UPD_BY_NM"          javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_A"             column="XX_REC_HIST_TBL_NM"             javaType="EZDSStringItem"/>
<!-- END 2016/12/06 K.Ochiai [QC#14204, ADD] -->
   </resultMap>

    <statement id="getPhysMaintTrgtTblPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
             C.TARGET_CD
            ,C.TARGET_NAME
        FROM
            (
                SELECT
                     B.TARGET_CD
                    ,B.TARGET_NAME
                FROM
                    (
                        SELECT
                             TO_CHAR(SUBSTR(A.$physMaintTrgtColNm$, 0, #keyLen#))                                   AS TARGET_CD
                            ,SUBSTR(A.$physDplyTrgtColNm$, 0, #valLen#)                                             AS TARGET_NAME
                            ,ROW_NUMBER() OVER(PARTITION BY A.$physMaintTrgtColNm$ ORDER BY A.$physMaintTrgtColNm$) AS ROW_NUM 
                        FROM
                            $physMaintTrgtTblNm$ A
                        WHERE
                                A.GLBL_CMPY_CD = #glblCmpyCd#
                            AND A.EZCANCELFLAG = '0'
                            <!-- add start 2018/06/25 QC#17369 -->
                            <isNotNull property="valTxt" >
                            AND A.$physMaintTrgtColNm$ = #valTxt#
                            </isNotNull>
                            <!-- add end 2018/06/25 QC#17369 -->
                    ) B
                WHERE
                    B.ROW_NUM = 1
                ORDER BY
                    B.TARGET_CD
            ) C
        WHERE
            ROWNUM &lt; #rowNum#
    </statement>

<!-- START 2016/09/29 A.Kohinata [QC#12898, ADD] -->
    <statement id="getSvcTermCondAttrbPkList" parameterClass="Map" resultMap="result.getSvcTermCondAttrbPkList">
        SELECT
            A.SVC_TERM_COND_ATTRB_PK
        FROM
            SVC_TERM_COND_ATTRB A
        WHERE
                A.GLBL_CMPY_CD                  = #glblCmpyCd#
            AND A.EZCANCELFLAG                  = '0'
            AND A.EFF_FROM_DT               &lt;= #slsDt#
            AND NVL(A.EFF_THRU_DT, #maxDt#) &gt;= #slsDt#
            AND A.SVC_TERM_ATTRB_ACTV_FLG       = 'Y'
            <iterate property="svcTermCondAttrbNmList" var="svcTermCondAttrbNm[]" open="AND A.SVC_TERM_COND_ATTRB_NM IN (" close=")" conjunction=",">
                #svcTermCondAttrbNm[]#
            </iterate>
    </statement>
    <resultMap id="result.getSvcTermCondAttrbPkList" class="NSAL0440_YCMsg">
        <result property="svcTermCondAttrbPk_Y" column="SVC_TERM_COND_ATTRB_PK" javaType="EZDTBigDecimalItem"/>
    </resultMap>
<!-- END 2016/09/29 A.Kohinata [QC#12898, ADD] -->
<!-- START 2022/08/03 N.Takatsu [QC#60077, ADD] -->
    <statement id="getSerNumByDsContrDtlPk" parameterClass="Map" resultMap="String">
            SELECT
                B.SER_NUM
            FROM
                DS_CONTR_DTL            A
               ,SVC_MACH_MSTR           B
            WHERE
                    A.GLBL_CMPY_CD      = #glblCmpyCd#
                AND A.EZCANCELFLAG      = '0'
                AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
                AND B.EZCANCELFLAG      = '0'
                AND A.SVC_MACH_MSTR_PK  = B.SVC_MACH_MSTR_PK
                AND B.SER_NUM           IS NOT NULL
                AND A.DS_CONTR_DTL_PK   = #dsContrDtlPk#
    </statement>
<!-- START 2022/08/03 N.Takatsu [QC#60077, ADD] -->
</sqlMap>
