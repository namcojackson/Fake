<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPZC103001">

    <typeAlias alias="PRCH_REQ_DTLTMsg"  type="business.db.PRCH_REQ_DTLTMsg"/>
    <typeAlias alias="PRCH_REQ_SERTMsg"  type="business.db.PRCH_REQ_SERTMsg"/>

    <statement id="existInvtyLocCd" parameterClass="Map" resultClass="Map">
        SELECT
            COUNT(D.INVTY_LOC_CD) AS CNT
        FROM
            DS_INVTY_LOC_V D
        WHERE
            D.GLBL_CMPY_CD = #glblCmpyCd#
            AND D.INVTY_LOC_CD = #invtyLocCd#
            AND D.RGTN_STS_CD = #rgtnStsCd#
            AND D.EZCANCELFLAG = '0'
    </statement>

    <statement id="existMdseCd" parameterClass="Map" resultClass="Map">
        SELECT
            COUNT(M.MDSE_CD) AS CNT
        FROM
            MDSE M
        WHERE
            M.GLBL_CMPY_CD = #glblCmpyCd#
            AND M.MDSE_CD = #mdseCd#
            AND M.RGTN_STS_CD NOT IN 
            <iterate property="rgtnStsCds" var="rgtnStsCd[]" open="( " close=" )" conjunction=",">
                #rgtnStsCd[]#
            </iterate>
            AND M.EZCANCELFLAG = '0'
    </statement>

    <statement id="existVndCd" parameterClass="Map" resultClass="Map">
        SELECT
            COUNT(V.VND_CD) AS CNT
        FROM
            VND V
        WHERE
            V.GLBL_CMPY_CD = #glblCmpyCd#
            AND V.VND_CD = #vndCd#
            AND V.RGTN_STS_CD = #rgtnStsCd#
            AND V.EZCANCELFLAG = '0'
    </statement>

    <statement id="getShipTo" parameterClass="Map" resultClass="Map">
        SELECT
            S.LOC_NM
            ,S.ADDL_LOC_NM
            ,S.FIRST_LINE_ADDR
            ,S.SCD_LINE_ADDR
            ,S.THIRD_LINE_ADDR
            ,S.FRTH_LINE_ADDR
            ,S.FIRST_REF_CMNT_TXT
            ,S.SCD_REF_CMNT_TXT
            ,S.CTY_ADDR
            ,S.ST_CD
            ,S.PROV_NM
            ,C.CNTY_NM
            ,S.POST_CD
            ,S.CTRY_CD
        FROM
            SHIP_TO_CUST S
            ,CNTY C
        WHERE
            S.GLBL_CMPY_CD        = #glblCmpyCd#
            AND S.SHIP_TO_CUST_CD = #shipToCustCd#
            AND S.RGTN_STS_CD     = #rgtnStsCd#
            AND S.EZCANCELFLAG    = '0'
            AND S.GLBL_CMPY_CD    = C.GLBL_CMPY_CD(+)
            AND S.CNTY_PK         = C.CNTY_PK(+)
            AND C.EZCANCELFLAG(+) = '0'
    </statement>

    <statement id="getCurrentMaxPrchReqLineNum" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            NVL(MAX(P.PRCH_REQ_LINE_NUM), 0)
        FROM
            PRCH_REQ_DTL P
        WHERE
            P.GLBL_CMPY_CD = #glblCmpyCd#
            AND P.PRCH_REQ_NUM = #prchReqNum#
    </statement>

    <statement id="getCurrentMaxPrchReqLineSubNum" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            NVL(MAX(P.PRCH_REQ_LINE_SUB_NUM), 0)
        FROM
            PRCH_REQ_DTL P
        WHERE
            P.GLBL_CMPY_CD = #glblCmpyCd#
            AND P.PRCH_REQ_NUM = #prchReqNum#
            AND P.PRCH_REQ_LINE_NUM = #prchReqLineNum#
    </statement>

<!-- START 2023/06/13 T.Kuroda [QC#61363, DEL] -->
<!-- START 2018/10/02 M.Naito [QC#28479,MOD] -->
<!--    <statement id="getSwLicReqFlg" parameterClass="Map" resultClass="Map">-->
<!--        SELECT-->
<!--            SL.SW_LIC_REQ_FLG-->
<!--            ,AM.INTNT_CONN_SW_CTRL_FLG-->
<!--        FROM-->
<!--            ALL_MDSE_V AM-->
<!--            ,SW_LIC_CTRL_TP SL-->
<!--        WHERE-->
<!--            AM.GLBL_CMPY_CD          = #glblCmpyCd#-->
<!--            AND AM.MDSE_CD           = #mdseCd#-->
<!--            AND AM.EZCANCELFLAG      = '0'-->
<!--            AND AM.GLBL_CMPY_CD      = SL.GLBL_CMPY_CD(+)-->
<!--            AND AM.SW_LIC_CTRL_TP_CD = SL.SW_LIC_CTRL_TP_CD(+)-->
<!--            AND SL.EZCANCELFLAG(+)      = '0'-->
<!--    </statement>-->
<!-- END 2018/10/02 M.Naito [QC#28479,MOD] -->
<!-- END 2023/06/13 T.Kuroda [QC#61363, DEL] -->

    <!-- START 2018/12/17 M.Naito [QC#29599,DEL] -->
    <!-- <statement id="getCarrCdByCustomer" parameterClass="Map" resultClass="String">
        SELECT
            D.VND_CD
        FROM
            SHIP_TO_CUST S
            ,DS_ACCT_CARR D
        WHERE
            S.GLBL_CMPY_CD          = #glblCmpyCd#
            AND S.SHIP_TO_CUST_CD   = #shipToCustCd#
            AND S.EZCANCELFLAG      = '0'
            AND S.SELL_TO_CUST_CD   = D.DS_ACCT_NUM
            AND S.GLBL_CMPY_CD      = D.GLBL_CMPY_CD
            AND D.DEF_ACCT_CARR_FLG = #defAcctCarrFlg#
            AND D.EZCANCELFLAG      = '0'
    </statement> -->
    <!-- END 2018/12/17 M.Naito [QC#29599,DEL] -->

    <statement id="getVendorPayment" parameterClass="Map" resultClass="Map">
        SELECT
            V.VND_PMT_TERM_CD
            ,V.VND_PMT_TERM_DESC_TXT
        FROM
            VND V
        WHERE
            V.GLBL_CMPY_CD        = #glblCmpyCd#
            AND V.VND_CD          = #vndCd#
            AND V.EZCANCELFLAG    = '0'
    </statement>

    <statement id="existSerial" parameterClass="Map" resultClass="Map">
        SELECT
            1
        FROM
            PRCH_REQ_SER S
        WHERE
            S.GLBL_CMPY_CD = #glblCmpyCd#
            AND S.PRCH_REQ_NUM = #prchReqNum#
            AND S.PRCH_REQ_LINE_NUM = #prchReqLineNum#
            AND S.PRCH_REQ_LINE_SUB_NUM = #prchReqLineNum#
            AND S.SER_NUM = #serNum#
            AND ROWNUM &lt;= #rownum#
    </statement>

    <statement id="getDtlNoMatchLineStsCd" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)    AS CNT
        FROM
            PRCH_REQ_DTL D
        WHERE
            D.GLBL_CMPY_CD                 = #glblCmpyCd#
            AND D.EZCANCELFLAG             = '0'
            AND D.PRCH_REQ_NUM             = #prchReqNum#
          <isNotNull property="prchReqLineStsCdList">
            AND D.PRCH_REQ_LINE_STS_CD NOT IN
            <iterate property="prchReqLineStsCdList" var="prchReqLineStsCd[]" open="( " close=" )" conjunction=",">
                #prchReqLineStsCd[]#
            </iterate>
          </isNotNull>
          <isNotNull property="prchReqLineNum">
            AND D.PRCH_REQ_LINE_NUM        = #prchReqLineNum#
            AND D.PRCH_REQ_LINE_SUB_NUM    != #prchReqLineSubNum#
          </isNotNull>
    </statement>

    <statement id="getWhOwnrCd" parameterClass="Map" resultClass="Map">
        SELECT
            W.WH_OWNR_CD
        FROM
            DS_INVTY_LOC_V I
            ,RTL_WH W
        WHERE
            I.GLBL_CMPY_CD        = #glblCmpyCd#
            AND I.INVTY_LOC_CD    = #invtyLocCd#
            AND I.EFF_FROM_DT &lt;= #procDt#
            AND (I.EFF_THRU_DT IS NULL
              OR I.EFF_THRU_DT &gt; #procDt# )
            AND I.EZCANCELFLAG    = '0'
            AND I.GLBL_CMPY_CD    = W.GLBL_CMPY_CD
            AND I.RTL_WH_CD       = W.RTL_WH_CD
            AND W.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getWhAndSwhByTechTocCd" parameterClass="Map" resultClass="Map">
        SELECT
            S.INVTY_LOC_CD AS INVTY_LOC_CD
            ,S.RTL_WH_CD   AS RTL_WH_CD
            ,S.RTL_SWH_CD  AS RTL_SWH_CD
        FROM
            RTL_WH W
            ,RTL_SWH S
        WHERE
            W.GLBL_CMPY_CD        = #glblCmpyCd#
            AND W.TECH_TOC_CD     = #techTocCd#
            AND W.RTL_WH_CATG_CD  = #whCatgTechCar#
            AND W.EFF_FROM_DT &lt;= #procDt#
            AND (W.EFF_THRU_DT IS NULL
              OR W.EFF_THRU_DT &gt; #procDt# )
            AND W.EZCANCELFLAG    = '0'
            AND W.GLBL_CMPY_CD    = S.GLBL_CMPY_CD
            AND W.RTL_WH_CD       = S.RTL_WH_CD
            AND S.PRTY_LOC_FLG    = #prtyLocFlgY#
            AND S.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getPrchReqLineTpCd" parameterClass="Map" resultClass="Map">
        SELECT
            L.PRCH_REQ_LINE_TP_CD
        FROM
            PRCH_REQ_LINE_TP L
        WHERE
            L.GLBL_CMPY_CD                = #glblCmpyCd#
            AND L.RQST_FROM_SHPG_CONF_FLG = #rqstFromShpgConfFlg#
            AND L.WH_OWNR_CD              = #whOwnrCd#
            AND L.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getPrchReqDtl" parameterClass="Map" resultMap="result.PRCH_REQ_DTLTMsg">
        SELECT
            D.GLBL_CMPY_CD
            , D.PRCH_REQ_NUM
            , D.PRCH_REQ_LINE_NUM
            , D.PRCH_REQ_LINE_SUB_NUM
            , D.PRCH_REQ_INTFC_PK
            , D.ORIG_PRCH_REQ_LINE_NUM
            , D.ORIG_PRCH_REQ_LINE_SUB_NUM
            , D.PRCH_REQ_LINE_TP_CD
            , D.PRCH_REQ_LINE_STS_CD
            , D.PRCH_REQ_CRAT_DT
            , D.PRCH_REQ_CRAT_TM
            , D.RQST_RCV_DT
            , D.RQST_RCV_TM
            , D.RQST_RCV_TZ
        <!-- START 2023/02/07 T.Kuroda QC#60966 ADD -->
            , D.RQST_SHIP_DT
        <!-- END   2023/02/07 T.Kuroda QC#60966 ADD -->
            , D.RQST_RCV_DISP_DT_TM_TS
            , D.PO_SCHD_REL_DT
            , D.PRCH_REQ_REL_STS_CD
            , D.PRCH_REQ_REL_DT_TM_TS
            , D.PRCH_REQ_REL_ERR_MSG_TXT
            , D.PRCH_REQ_FRZ_FLG
            , D.SHPG_PLN_NUM
            , D.SHIP_FROM_SO_NUM
            , D.PROCR_TP_CD
            , D.DEST_INVTY_LOC_CD
            , D.DEST_RTL_WH_CD
            , D.DEST_RTL_SWH_CD
            , D.SRC_INVTY_LOC_CD
            , D.SRC_RTL_WH_CD
            , D.SRC_RTL_SWH_CD
            , D.PRNT_VND_CD
            , D.VND_CD
            , D.VND_INVTY_LOC_CD
            , D.SHPG_SVC_LVL_CD
            , D.CARR_CD
            , D.CARR_ACCT_NUM
            , D.CONFIG_TP_CD
            , D.SVC_CONFIG_MSTR_PK
            , D.MDSE_CD
            , D.PO_MDSE_CMPSN_TP_CD
            , D.ORIG_RQST_MDSE_CD
            , D.ASL_MDSE_CD
            , D.PRCH_REQ_QTY
            , D.ORD_QTY
            , D.CUST_UOM_CD
            , D.PRCH_REQ_DISP_QTY
            , D.PRCH_REQ_DSPL_UOM_CD
            , D.PRCH_REQ_REL_QTY
            , D.PRCH_REQ_BAL_QTY
            , D.PRCH_REQ_INSRC_QTY
            , D.PRCH_REQ_CANC_QTY
            , D.ROP_QTY
            , D.MIN_ORD_QTY
            , D.INCR_ORD_QTY
            , D.MAX_INVTY_QTY
            , D.CUR_INVTY_QTY
            , D.CUR_INVTY_AVAL_QTY
            , D.SCHD_INBD_QTY
            , D.SCHD_OTBD_QTY
            , D.INSRC_FLG
            , D.PO_CRAT_FLG
            , D.REL_RQST_TO_PO_ORD_NUM
            , D.PO_ORD_NUM
            , D.PO_ORD_DTL_LINE_NUM
            , D.INVTY_ORD_NUM
            , D.INVTY_ORD_LINE_NUM
            , D.WRK_ORD_NUM
            , D.WRK_ORD_DTL_LINE_NUM
            , D.TRX_REF_NUM
            , D.TRX_REF_LINE_NUM
            , D.TRX_REF_LINE_SUB_NUM
            , D.PRCH_REQ_LINE_CMNT_TXT
            , D.BO_EML_PROC_STS_CD
            , D.SO_NUM
            , D.PRO_NUM
            , D.SHIP_DT_TM_TS
            , D.SHIP_QTY
            , D.RWS_NUM
            , D.RWS_CLO_DT_TM_TS
            , D.RWS_PUT_AWAY_QTY
            , D.BACK_TO_TECH_QTY
            , D.FROM_STK_STS_CD
            , D.TO_STK_STS_CD
            , D.THIS_MTH_FOB_COST_AMT
            , D.ASL_DTL_PK
            , D.ASL_UNIT_PRC_AMT
            , D.ENT_DEAL_NET_UNIT_PRC_AMT
            , D.ENT_PO_DTL_DEAL_NET_AMT
            , D.ENT_FUNC_NET_UNIT_PRC_AMT
            , D.ENT_PO_DTL_FUNC_NET_AMT
            , D.CCY_CD
            , D.EXCH_RATE
            , D.FRT_CHRG_TO_CD
            , D.FRT_CHRG_METH_CD
            , D.FRT_COND_CD
            , D.VND_PMT_TERM_CD
            , D.VND_PMT_TERM_DESC_TXT
            , D.COA_CMPY_CD
            , D.COA_AFFL_CD
            , D.COA_BR_CD
            , D.COA_CH_CD
            , D.COA_CC_CD
            , D.COA_ACCT_CD
            , D.COA_PROJ_CD
            , D.COA_EXTN_CD
            , D.COA_PROD_CD
            , D.TECH_RQST_NTC_ML_PROC_CD
            , D.TECH_RTN_NTC_ML_PROC_CD
            , D.VND_RTRN_RSN_CD
            , D.BAT_ERR_MSG_TXT
            , D.SPCL_INSTN_CMNT_TXT
            , D.MDSE_DESC_SHORT_TXT
        FROM
            PRCH_REQ_DTL D
        WHERE
            D.GLBL_CMPY_CD = #glblCmpyCd#
            AND D.EZCANCELFLAG = '0'
            AND D.PRCH_REQ_NUM = #prchReqNum#
          <isNotNull property="prchReqLineNums">
            AND D.PRCH_REQ_LINE_NUM IN 
            <iterate property="prchReqLineNums" var="prchReqLineNum[]" open="( " close=" )" conjunction=",">
                #prchReqLineNum[]#
            </iterate>
          </isNotNull>
          <isNotNull property="prchReqLineNumSubNums">
            <iterate property="prchReqLineNumSubNums" var="prchReqLineNumSubNum[]" open="AND D.PRCH_REQ_LINE_NUM || D.PRCH_REQ_LINE_SUB_NUM IN ( " close=" )" conjunction=",">
                #prchReqLineNumSubNum[]#
            </iterate>
          </isNotNull>
          <isNotNull property="prchReqLineNum">
            AND D.PRCH_REQ_LINE_NUM = #prchReqLineNum#
          </isNotNull>
          <isNotNull property="prchReqLineSubNum">
            AND D.PRCH_REQ_LINE_SUB_NUM = #prchReqLineSubNum#
          </isNotNull>
          <isNotNull property="prchReqLineStsCd">
            AND D.PRCH_REQ_LINE_STS_CD = #prchReqLineStsCd#
          </isNotNull>
          <isNotNull property="prchReqLineStsCdExcludeList">
              <iterate property="prchReqLineStsCdExcludeList" var="prchReqLineStsCdExclude[]" open="AND D.PRCH_REQ_LINE_STS_CD NOT IN (" close=")" conjunction=",">
                #prchReqLineStsCdExclude[]#
              </iterate>
          </isNotNull>
          <isNotNull property="prchReqLineTpCdList">
              <iterate property="prchReqLineTpCdList" var="prchReqLineTpCdList[]" open="AND D.PRCH_REQ_LINE_TP_CD IN (" close=")" conjunction=",">
                #prchReqLineTpCdList[]#
              </iterate>
          </isNotNull>
          <isNotNull property="prchReqLineTpCdList">
            AND D.SO_NUM IS NULL
          </isNotNull>
          <isNotNull property="mdseCd">
            AND D.MDSE_CD = #mdseCd#
          </isNotNull>
          <isNotNull property="prchReqQty">
            AND D.PRCH_REQ_QTY = #prchReqQty#
          </isNotNull>
          <isNotNull property="tpShipConf">
           AND D.SRC_RTL_SWH_CD IS NULL
          </isNotNull>
        <isNotNull property="updFlg">
            FOR UPDATE 
        </isNotNull>
        <isNotNull property="noWaitFlg">
            NOWAIT
        </isNotNull>
    </statement>
    <!-- 2017/08/31 K.Kameoka Sol#369(QC#19243) ADD START -->
    <statement id="getPrchReqDtlPrnt" parameterClass="Map" resultMap="result.PRCH_REQ_DTLTMsg">
        SELECT
            D.GLBL_CMPY_CD
            , D.PRCH_REQ_NUM
            , D.PRCH_REQ_LINE_NUM
            , D.PRCH_REQ_LINE_SUB_NUM
            , D.PRCH_REQ_INTFC_PK
            , D.ORIG_PRCH_REQ_LINE_NUM
            , D.ORIG_PRCH_REQ_LINE_SUB_NUM
            , D.PRCH_REQ_LINE_TP_CD
            , D.PRCH_REQ_LINE_STS_CD
            , D.PRCH_REQ_CRAT_DT
            , D.PRCH_REQ_CRAT_TM
            , D.RQST_RCV_DT
            , D.RQST_RCV_TM
            , D.RQST_RCV_TZ
        <!-- START 2023/02/07 T.Kuroda QC#60966 ADD -->
            , D.RQST_SHIP_DT
        <!-- END   2023/02/07 T.Kuroda QC#60966 ADD -->
            , D.RQST_RCV_DISP_DT_TM_TS
            , D.PO_SCHD_REL_DT
            , D.PRCH_REQ_REL_STS_CD
            , D.PRCH_REQ_REL_DT_TM_TS
            , D.PRCH_REQ_REL_ERR_MSG_TXT
            , D.PRCH_REQ_FRZ_FLG
            , D.SHPG_PLN_NUM
            , D.SHIP_FROM_SO_NUM
            , D.PROCR_TP_CD
            , D.DEST_INVTY_LOC_CD
            , D.DEST_RTL_WH_CD
            , D.DEST_RTL_SWH_CD
            , D.SRC_INVTY_LOC_CD
            , D.SRC_RTL_WH_CD
            , D.SRC_RTL_SWH_CD
            , D.PRNT_VND_CD
            , D.VND_CD
            , D.VND_INVTY_LOC_CD
            , D.SHPG_SVC_LVL_CD
            , D.CARR_CD
            , D.CARR_ACCT_NUM
            , D.CONFIG_TP_CD
            , D.SVC_CONFIG_MSTR_PK
            , D.MDSE_CD
            , D.PO_MDSE_CMPSN_TP_CD
            , D.ORIG_RQST_MDSE_CD
            , D.ASL_MDSE_CD
            , D.PRCH_REQ_QTY
            , D.ORD_QTY
            , D.CUST_UOM_CD
            , D.PRCH_REQ_DISP_QTY
            , D.PRCH_REQ_DSPL_UOM_CD
            , D.PRCH_REQ_REL_QTY
            , D.PRCH_REQ_BAL_QTY
            , D.PRCH_REQ_INSRC_QTY
            , D.PRCH_REQ_CANC_QTY
            , D.ROP_QTY
            , D.MIN_ORD_QTY
            , D.INCR_ORD_QTY
            , D.MAX_INVTY_QTY
            , D.CUR_INVTY_QTY
            , D.CUR_INVTY_AVAL_QTY
            , D.SCHD_INBD_QTY
            , D.SCHD_OTBD_QTY
            , D.INSRC_FLG
            , D.PO_CRAT_FLG
            , D.REL_RQST_TO_PO_ORD_NUM
            , D.PO_ORD_NUM
            , D.PO_ORD_DTL_LINE_NUM
            , D.INVTY_ORD_NUM
            , D.INVTY_ORD_LINE_NUM
            , D.WRK_ORD_NUM
            , D.WRK_ORD_DTL_LINE_NUM
            , D.TRX_REF_NUM
            , D.TRX_REF_LINE_NUM
            , D.TRX_REF_LINE_SUB_NUM
            , D.PRCH_REQ_LINE_CMNT_TXT
            , D.BO_EML_PROC_STS_CD
            , D.SO_NUM
            , D.PRO_NUM
            , D.SHIP_DT_TM_TS
            , D.SHIP_QTY
            , D.RWS_NUM
            , D.RWS_CLO_DT_TM_TS
            , D.RWS_PUT_AWAY_QTY
            , D.BACK_TO_TECH_QTY
            , D.FROM_STK_STS_CD
            , D.TO_STK_STS_CD
            , D.THIS_MTH_FOB_COST_AMT
            , D.ASL_DTL_PK
            , D.ASL_UNIT_PRC_AMT
            , D.ENT_DEAL_NET_UNIT_PRC_AMT
            , D.ENT_PO_DTL_DEAL_NET_AMT
            , D.ENT_FUNC_NET_UNIT_PRC_AMT
            , D.ENT_PO_DTL_FUNC_NET_AMT
            , D.CCY_CD
            , D.EXCH_RATE
            , D.FRT_CHRG_TO_CD
            , D.FRT_CHRG_METH_CD
            , D.FRT_COND_CD
            , D.VND_PMT_TERM_CD
            , D.VND_PMT_TERM_DESC_TXT
            , D.COA_CMPY_CD
            , D.COA_AFFL_CD
            , D.COA_BR_CD
            , D.COA_CH_CD
            , D.COA_CC_CD
            , D.COA_ACCT_CD
            , D.COA_PROJ_CD
            , D.COA_EXTN_CD
            , D.COA_PROD_CD
            , D.TECH_RQST_NTC_ML_PROC_CD
            , D.TECH_RTN_NTC_ML_PROC_CD
            , D.VND_RTRN_RSN_CD
            , D.BAT_ERR_MSG_TXT
            , D.SPCL_INSTN_CMNT_TXT
            , D.MDSE_DESC_SHORT_TXT
        FROM
            PRCH_REQ_DTL D
        WHERE
            D.GLBL_CMPY_CD = #glblCmpyCd#
            AND D.EZCANCELFLAG = '0'
            AND D.PRCH_REQ_NUM = #prchReqNum#
          <isNotNull property="prchReqLineNums">
            AND D.PRCH_REQ_LINE_NUM IN 
            <iterate property="prchReqLineNums" var="prchReqLineNum[]" open="( " close=" )" conjunction=",">
                #prchReqLineNum[]#
            </iterate>
          </isNotNull>
          <isNotNull property="prchReqLineNumSubNums">
            <iterate property="prchReqLineNumSubNums" var="prchReqLineNumSubNum[]" open="AND D.PRCH_REQ_LINE_NUM || D.PRCH_REQ_LINE_SUB_NUM IN ( " close=" )" conjunction=",">
                #prchReqLineNumSubNum[]#
            </iterate>
          </isNotNull>
          <isNotNull property="prchReqLineNum">
            AND D.PRCH_REQ_LINE_NUM = #prchReqLineNum#
          </isNotNull>
          <isNotNull property="prchReqLineSubNum">
            AND D.PRCH_REQ_LINE_SUB_NUM = #prchReqLineSubNum#
          </isNotNull>
          <isNotNull property="prchReqLineStsCd">
            AND D.PRCH_REQ_LINE_STS_CD = #prchReqLineStsCd#
          </isNotNull>
          <isNotNull property="prchReqLineStsCdExcludeList">
              <iterate property="prchReqLineStsCdExcludeList" var="prchReqLineStsCdExclude[]" open="AND D.PRCH_REQ_LINE_STS_CD NOT IN (" close=")" conjunction=",">
                #prchReqLineStsCdExclude[]#
              </iterate>
          </isNotNull>
          <isNull property="prchReqLineTpCdList">
            AND D.PRCH_REQ_LINE_TP_CD IS NULL
          </isNull>
          <isNotNull property="mdseCd">
            AND D.MDSE_CD = #mdseCd#
          </isNotNull>
        <isNotNull property="updFlg">
            FOR UPDATE 
        </isNotNull>
        <isNotNull property="noWaitFlg">
            NOWAIT
        </isNotNull>
    </statement>
    <!-- 2017/08/31 K.Kameoka Sol#369(QC#19243) ADD END -->

    <statement id="getPrchReqSer" parameterClass="Map" resultMap="result.PRCH_REQ_SERTMsg">
        SELECT
            S.GLBL_CMPY_CD
            , S.PRCH_REQ_NUM
            , S.PRCH_REQ_LINE_NUM
            , S.PRCH_REQ_LINE_SUB_NUM
            , S.PRCH_REQ_SER_PK
            , S.SER_NUM
        FROM
            PRCH_REQ_SER S
        WHERE
            S.GLBL_CMPY_CD = #glblCmpyCd#
            AND S.EZCANCELFLAG = '0'
          <isNotNull property="prchReqNum">
            AND S.PRCH_REQ_NUM = #prchReqNum#
          </isNotNull>
          <isNotNull property="prchReqLineNum">
            AND S.PRCH_REQ_LINE_NUM = #prchReqLineNum#
          </isNotNull>
          <isNotNull property="prchReqLineSubNum">
            AND S.PRCH_REQ_LINE_SUB_NUM = #prchReqLineSubNum#
          </isNotNull>
    </statement>

    <statement id="getMRPInfo" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)    AS CNT
        FROM
            MRP_INFO M
            ,DS_INVTY_LOC_V V
        WHERE
            V.GLBL_CMPY_CD                 = #glblCmpyCd#
            AND V.EZCANCELFLAG             = '0'
            AND V.INVTY_LOC_CD             = #invtyLocCd#
            AND M.GLBL_CMPY_CD             = #glblCmpyCd#
            AND M.EZCANCELFLAG             = '0'
          <isNotNull property="mdseCdList">
            AND M.MDSE_CD IN (
              <iterate property="mdseCdList" var="mdseCd[]" open="" close="" conjunction=",">
                #mdseCd[]#
              </iterate>
            )
          </isNotNull>
            AND M.RTL_WH_CD                = V.RTL_WH_CD
            AND M.RTL_SWH_CD               = V.RTL_SWH_CD
    </statement>

    <resultMap id="result.PRCH_REQ_DTLTMsg" class="PRCH_REQ_DTLTMsg">
        <result property="glblCmpyCd" column="GLBL_CMPY_CD" javaType="EZDTStringItem" />
        <result property="prchReqNum" column="PRCH_REQ_NUM" javaType="EZDTStringItem" />
        <result property="prchReqLineNum" column="PRCH_REQ_LINE_NUM" javaType="EZDTStringItem" />
        <result property="prchReqLineSubNum" column="PRCH_REQ_LINE_SUB_NUM" javaType="EZDTBigDecimalItem" />
        <result property="prchReqIntfcPk" column="PRCH_REQ_INTFC_PK" javaType="EZDTBigDecimalItem" />
        <result property="origPrchReqLineNum" column="ORIG_PRCH_REQ_LINE_NUM" javaType="EZDTStringItem" />
        <result property="origPrchReqLineSubNum" column="ORIG_PRCH_REQ_LINE_SUB_NUM" javaType="EZDTBigDecimalItem" />
        <result property="prchReqLineTpCd" column="PRCH_REQ_LINE_TP_CD" javaType="EZDTStringItem" />
        <result property="prchReqLineStsCd" column="PRCH_REQ_LINE_STS_CD" javaType="EZDTStringItem" />
        <result property="prchReqCratDt" column="PRCH_REQ_CRAT_DT" javaType="EZDTDateItem" />
        <result property="prchReqCratTm" column="PRCH_REQ_CRAT_TM" javaType="EZDTStringItem" />
        <result property="rqstRcvDt" column="RQST_RCV_DT" javaType="EZDTDateItem" />
    <!-- START 2023/02/07 T.Kuroda QC#60966 ADD -->
        <result property="rqstShipDt" column="RQST_SHIP_DT" javaType="EZDTDateItem" />
    <!-- END   2023/02/07 T.Kuroda QC#60966 ADD -->
        <result property="rqstRcvTm" column="RQST_RCV_TM" javaType="EZDTStringItem" />
        <result property="rqstRcvTz" column="RQST_RCV_TZ" javaType="EZDTStringItem" />
        <result property="rqstRcvDispDtTmTs" column="RQST_RCV_DISP_DT_TM_TS" javaType="EZDTStringItem" />
        <result property="poSchdRelDt" column="PO_SCHD_REL_DT" javaType="EZDTDateItem" />
        <result property="prchReqRelStsCd" column="PRCH_REQ_REL_STS_CD" javaType="EZDTStringItem" />
        <result property="prchReqRelDtTmTs" column="PRCH_REQ_REL_DT_TM_TS" javaType="EZDTStringItem" />
        <result property="prchReqRelErrMsgTxt" column="PRCH_REQ_REL_ERR_MSG_TXT" javaType="EZDTStringItem" />
        <result property="prchReqFrzFlg" column="PRCH_REQ_FRZ_FLG" javaType="EZDTStringItem" />
        <result property="shpgPlnNum" column="SHPG_PLN_NUM" javaType="EZDTStringItem" />
        <result property="shipFromSoNum" column="SHIP_FROM_SO_NUM" javaType="EZDTStringItem" />
        <result property="procrTpCd" column="PROCR_TP_CD" javaType="EZDTStringItem" />
        <result property="destInvtyLocCd" column="DEST_INVTY_LOC_CD" javaType="EZDTStringItem" />
        <result property="destRtlWhCd" column="DEST_RTL_WH_CD" javaType="EZDTStringItem" />
        <result property="destRtlSwhCd" column="DEST_RTL_SWH_CD" javaType="EZDTStringItem" />
        <result property="srcInvtyLocCd" column="SRC_INVTY_LOC_CD" javaType="EZDTStringItem" />
        <result property="srcRtlWhCd" column="SRC_RTL_WH_CD" javaType="EZDTStringItem" />
        <result property="srcRtlSwhCd" column="SRC_RTL_SWH_CD" javaType="EZDTStringItem" />
        <result property="prntVndCd" column="PRNT_VND_CD" javaType="EZDTStringItem" />
        <result property="vndCd" column="VND_CD" javaType="EZDTStringItem" />
        <result property="vndInvtyLocCd" column="VND_INVTY_LOC_CD" javaType="EZDTStringItem" />
        <result property="shpgSvcLvlCd" column="SHPG_SVC_LVL_CD" javaType="EZDTStringItem" />
        <result property="carrCd" column="CARR_CD" javaType="EZDTStringItem" />
        <result property="carrAcctNum" column="CARR_ACCT_NUM" javaType="EZDTStringItem" />
        <result property="configTpCd" column="CONFIG_TP_CD" javaType="EZDTStringItem" />
        <result property="svcConfigMstrPk" column="SVC_CONFIG_MSTR_PK" javaType="EZDTBigDecimalItem" />
        <result property="mdseCd" column="MDSE_CD" javaType="EZDTStringItem" />
        <result property="poMdseCmpsnTpCd" column="PO_MDSE_CMPSN_TP_CD" javaType="EZDTStringItem" />
        <result property="origRqstMdseCd" column="ORIG_RQST_MDSE_CD" javaType="EZDTStringItem" />
        <result property="aslMdseCd" column="ASL_MDSE_CD" javaType="EZDTStringItem" />
        <result property="prchReqQty" column="PRCH_REQ_QTY" javaType="EZDTBigDecimalItem" />
        <result property="ordQty" column="ORD_QTY" javaType="EZDTBigDecimalItem" />
        <result property="custUomCd" column="CUST_UOM_CD" javaType="EZDTStringItem" />
        <result property="prchReqDispQty" column="PRCH_REQ_DISP_QTY" javaType="EZDTBigDecimalItem" />
        <result property="prchReqDsplUomCd" column="PRCH_REQ_DSPL_UOM_CD" javaType="EZDTStringItem" />
        <result property="prchReqRelQty" column="PRCH_REQ_REL_QTY" javaType="EZDTBigDecimalItem" />
        <result property="prchReqBalQty" column="PRCH_REQ_BAL_QTY" javaType="EZDTBigDecimalItem" />
        <result property="prchReqInsrcQty" column="PRCH_REQ_INSRC_QTY" javaType="EZDTBigDecimalItem" />
        <result property="prchReqCancQty" column="PRCH_REQ_CANC_QTY" javaType="EZDTBigDecimalItem" />
        <result property="ropQty" column="ROP_QTY" javaType="EZDTBigDecimalItem" />
        <result property="minOrdQty" column="MIN_ORD_QTY" javaType="EZDTBigDecimalItem" />
        <result property="incrOrdQty" column="INCR_ORD_QTY" javaType="EZDTBigDecimalItem" />
        <result property="maxInvtyQty" column="MAX_INVTY_QTY" javaType="EZDTBigDecimalItem" />
        <result property="curInvtyQty" column="CUR_INVTY_QTY" javaType="EZDTBigDecimalItem" />
        <result property="curInvtyAvalQty" column="CUR_INVTY_AVAL_QTY" javaType="EZDTBigDecimalItem" />
        <result property="schdInbdQty" column="SCHD_INBD_QTY" javaType="EZDTBigDecimalItem" />
        <result property="schdOtbdQty" column="SCHD_OTBD_QTY" javaType="EZDTBigDecimalItem" />
        <result property="insrcFlg" column="INSRC_FLG" javaType="EZDTStringItem" />
        <result property="poCratFlg" column="PO_CRAT_FLG" javaType="EZDTStringItem" />
        <result property="relRqstToPoOrdNum" column="REL_RQST_TO_PO_ORD_NUM" javaType="EZDTStringItem" />
        <result property="poOrdNum" column="PO_ORD_NUM" javaType="EZDTStringItem" />
        <result property="poOrdDtlLineNum" column="PO_ORD_DTL_LINE_NUM" javaType="EZDTStringItem" />
        <result property="invtyOrdNum" column="INVTY_ORD_NUM" javaType="EZDTStringItem" />
        <result property="invtyOrdLineNum" column="INVTY_ORD_LINE_NUM" javaType="EZDTStringItem" />
        <result property="wrkOrdNum" column="WRK_ORD_NUM" javaType="EZDTStringItem" />
        <result property="wrkOrdDtlLineNum" column="WRK_ORD_DTL_LINE_NUM" javaType="EZDTStringItem" />
        <result property="trxRefNum" column="TRX_REF_NUM" javaType="EZDTStringItem" />
        <result property="trxRefLineNum" column="TRX_REF_LINE_NUM" javaType="EZDTStringItem" />
        <result property="trxRefLineSubNum" column="TRX_REF_LINE_SUB_NUM" javaType="EZDTStringItem" />
        <result property="prchReqLineCmntTxt" column="PRCH_REQ_LINE_CMNT_TXT" javaType="EZDTStringItem" />
        <result property="boEmlProcStsCd" column="BO_EML_PROC_STS_CD" javaType="EZDTStringItem" />
        <result property="soNum" column="SO_NUM" javaType="EZDTStringItem" />
        <result property="proNum" column="PRO_NUM" javaType="EZDTStringItem" />
        <result property="shipDtTmTs" column="SHIP_DT_TM_TS" javaType="EZDTStringItem" />
        <result property="shipQty" column="SHIP_QTY" javaType="EZDTBigDecimalItem" />
        <result property="rwsNum" column="RWS_NUM" javaType="EZDTStringItem" />
        <result property="rwsCloDtTmTs" column="RWS_CLO_DT_TM_TS" javaType="EZDTStringItem" />
        <result property="rwsPutAwayQty" column="RWS_PUT_AWAY_QTY" javaType="EZDTBigDecimalItem" />
        <result property="backToTechQty" column="BACK_TO_TECH_QTY" javaType="EZDTBigDecimalItem" />
        <result property="fromStkStsCd" column="FROM_STK_STS_CD" javaType="EZDTStringItem" />
        <result property="toStkStsCd" column="TO_STK_STS_CD" javaType="EZDTStringItem" />
        <result property="thisMthFobCostAmt" column="THIS_MTH_FOB_COST_AMT" javaType="EZDTBigDecimalItem" />
        <result property="aslDtlPk" column="ASL_DTL_PK" javaType="EZDTBigDecimalItem" />
        <result property="aslUnitPrcAmt" column="ASL_UNIT_PRC_AMT" javaType="EZDTBigDecimalItem" />
        <result property="entDealNetUnitPrcAmt" column="ENT_DEAL_NET_UNIT_PRC_AMT" javaType="EZDTBigDecimalItem" />
        <result property="entPoDtlDealNetAmt" column="ENT_PO_DTL_DEAL_NET_AMT" javaType="EZDTBigDecimalItem" />
        <result property="entFuncNetUnitPrcAmt" column="ENT_FUNC_NET_UNIT_PRC_AMT" javaType="EZDTBigDecimalItem" />
        <result property="entPoDtlFuncNetAmt" column="ENT_PO_DTL_FUNC_NET_AMT" javaType="EZDTBigDecimalItem" />
        <result property="ccyCd" column="CCY_CD" javaType="EZDTStringItem" />
        <result property="exchRate" column="EXCH_RATE" javaType="EZDTBigDecimalItem" />
        <result property="frtChrgToCd" column="FRT_CHRG_TO_CD" javaType="EZDTStringItem" />
        <result property="frtChrgMethCd" column="FRT_CHRG_METH_CD" javaType="EZDTStringItem" />
        <result property="frtCondCd" column="FRT_COND_CD" javaType="EZDTStringItem" />
        <result property="vndPmtTermCd" column="VND_PMT_TERM_CD" javaType="EZDTStringItem" />
        <result property="vndPmtTermDescTxt" column="VND_PMT_TERM_DESC_TXT" javaType="EZDTStringItem" />
        <result property="coaCmpyCd" column="COA_CMPY_CD" javaType="EZDTStringItem" />
        <result property="coaAfflCd" column="COA_AFFL_CD" javaType="EZDTStringItem" />
        <result property="coaBrCd" column="COA_BR_CD" javaType="EZDTStringItem" />
        <result property="coaChCd" column="COA_CH_CD" javaType="EZDTStringItem" />
        <result property="coaCcCd" column="COA_CC_CD" javaType="EZDTStringItem" />
        <result property="coaAcctCd" column="COA_ACCT_CD" javaType="EZDTStringItem" />
        <result property="coaProjCd" column="COA_PROJ_CD" javaType="EZDTStringItem" />
        <result property="coaExtnCd" column="COA_EXTN_CD" javaType="EZDTStringItem" />
        <result property="coaProdCd" column="COA_PROD_CD" javaType="EZDTStringItem" />
        <result property="techRqstNtcMlProcCd" column="TECH_RQST_NTC_ML_PROC_CD" javaType="EZDTStringItem" />
        <result property="techRtnNtcMlProcCd" column="TECH_RTN_NTC_ML_PROC_CD" javaType="EZDTStringItem" />
        <result property="vndRtrnRsnCd" column="VND_RTRN_RSN_CD" javaType="EZDTStringItem" />
        <result property="batErrMsgTxt" column="BAT_ERR_MSG_TXT" javaType="EZDTStringItem" />
        <result property="spclInstnCmntTxt" column="SPCL_INSTN_CMNT_TXT" javaType="EZDTStringItem" />
        <result property="mdseDescShortTxt" column="MDSE_DESC_SHORT_TXT" javaType="EZDTStringItem" />
    </resultMap>

    <resultMap id="result.PRCH_REQ_SERTMsg" class="PRCH_REQ_SERTMsg">
        <result property="glblCmpyCd" column="GLBL_CMPY_CD" javaType="EZDTStringItem" />
        <result property="prchReqNum" column="PRCH_REQ_NUM" javaType="EZDTStringItem" />
        <result property="prchReqLineNum" column="PRCH_REQ_LINE_NUM" javaType="EZDTStringItem" />
        <result property="prchReqLineSubNum" column="PRCH_REQ_LINE_SUB_NUM" javaType="EZDTBigDecimalItem" />
        <result property="prchReqSerPk" column="PRCH_REQ_SER_PK" javaType="EZDTBigDecimalItem" />
        <result property="serNum" column="SER_NUM" javaType="EZDTStringItem" />
    </resultMap>

    <statement id="getFromSSFromPrchReqLineTp" parameterClass="Map" resultClass="String">
        SELECT
            FROM_STK_STS_CD
        FROM
            PRCH_REQ_LINE_TP
        WHERE
            GLBL_CMPY_CD          = #glblCmpyCd#
            AND PRCH_REQ_LINE_TP_CD           = #prchReqLineTpCd#
            AND EZCANCELFLAG      = '0'
    </statement>

    <statement id="getToSSFromPrchReqLineTp" parameterClass="Map" resultClass="String">
        SELECT
            TO_STK_STS_CD
        FROM
            PRCH_REQ_LINE_TP
        WHERE
            GLBL_CMPY_CD          = #glblCmpyCd#
            AND PRCH_REQ_LINE_TP_CD           = #prchReqLineTpCd#
            AND EZCANCELFLAG      = '0'
    </statement>

    <statement id="getSvcTask" parameterClass="Map" resultClass="Map">
        SELECT
            ST.FSR_NUM             FSR_NUM
           ,ST.SVC_TASK_NUM        SVC_TASK_NUM
           ,ST.SER_NUM             SER_NUM
        FROM
            SVC_TASK ST
        WHERE
            ST.GLBL_CMPY_CD          = #glblCmpyCd#
        <isNotNull property="svcTaskNum">
        AND ST.SVC_TASK_NUM          = #svcTaskNum#
        </isNotNull>
        <isNotNull property="fsrNum">
        AND ST.FSR_NUM               = #fsrNum#
        </isNotNull>
        <isNotNull property="svcMachSerNum">
        AND ST.SER_NUM               = #svcMachSerNum#
        </isNotNull>
        <isNotNull property="svcTaskStsList">
        AND ST.SVC_TASK_STS_CD       NOT IN (
          <iterate property="svcTaskStsList" var="svcTaskStsCd[]" open="" close="" conjunction=",">
              #svcTaskStsCd[]#
          </iterate>
        )
        </isNotNull>
        AND ST.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getSvcTaskCheckControl" parameterClass="Map" resultClass="Map">
        SELECT
               DCC.DS_COND_CONST_CD
              ,DCC.DS_COND_CONST_VAL_TXT_07
          FROM DS_COND_CONST DCC
         WHERE DCC.GLBL_CMPY_CD             = #glblCmpyCd#
           AND DCC.DS_COND_CONST_GRP_ID     = #dsCondConstGrpId#
           AND DCC.DS_COND_CONST_VAL_TXT_04 = #prchReqTpCd#
           AND DCC.EZCANCELFLAG             = '0'
           AND ROWNUM = 1
    </statement>

    <statement id="getLineStatus" parameterClass="Map" resultClass="String">
        SELECT
            PRCH_REQ_LINE_STS_CD
        FROM
            PRCH_REQ_DTL
        WHERE
            GLBL_CMPY_CD          = #glblCmpyCd#
        AND PRCH_REQ_NUM          = #prchReqNum#
        AND EZCANCELFLAG          = '0'
    </statement>

    <statement id="getConfigPrchReqDtl" parameterClass="Map" resultMap="result.PRCH_REQ_DTLTMsg">
        SELECT
              PRD.GLBL_CMPY_CD
            , PRD.PRCH_REQ_NUM
            , PRD.PRCH_REQ_LINE_NUM
            , PRD.PRCH_REQ_LINE_SUB_NUM
        FROM
            PRCH_REQ_DTL PRD
        WHERE
                PRD.GLBL_CMPY_CD = #glblCmpyCd#
            AND PRD.PRCH_REQ_NUM = #prchReqNum#
            AND PRD.CONFIG_TP_CD IS NOT NULL
            AND PRD.MDSE_CD IS NULL
            AND PRD.EZCANCELFLAG = '0'
    </statement>

    <statement id="getConfigDtlNoMatchLineStsCd" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)    AS CNT
        FROM
            PRCH_REQ_DTL D
        WHERE
            D.GLBL_CMPY_CD                 = #glblCmpyCd#
            AND D.EZCANCELFLAG             = '0'
            AND D.PRCH_REQ_NUM             = #prchReqNum#
            AND D.PRCH_REQ_LINE_NUM        = #prchReqLineNum#
            AND D.PRCH_REQ_LINE_SUB_NUM    != #prchReqLineSubNum#
          <isNotNull property="prchReqLineStsCdList">
            AND D.PRCH_REQ_LINE_STS_CD NOT IN
            <iterate property="prchReqLineStsCdList" var="prchReqLineStsCd[]" open="( " close=" )" conjunction=",">
                #prchReqLineStsCd[]#
            </iterate>
          </isNotNull>
    </statement>

    <statement id="getTpShipConfOrig" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)    AS CNT
        FROM
            PRCH_REQ P
        WHERE
            P.GLBL_CMPY_CD                 = #glblCmpyCd#
            AND P.EZCANCELFLAG             = '0'
            AND P.PRCH_REQ_NUM             = #prchReqNum#
            AND P.PRCH_REQ_REC_TP_CD       = #prchReqRecTpCd#
            AND P.PRCH_REQ_STS_CD          = #prchReqStsCd#
    </statement>

    <statement id="getFsrTaskList" parameterClass="Map" resultClass="Map">
        SELECT
            PR.FSR_NUM
           ,PR.SVC_TASK_NUM
           ,PR.RQST_TECH_TOC_CD
           ,ST.SVC_MACH_MSTR_PK
           <!-- START 2019/07/31 K.Kitachi [QC#52257, ADD] -->
           ,ST.DS_SVC_CALL_TP_CD
           <!-- END 2019/07/31 K.Kitachi [QC#52257, ADD] -->
           <!-- START 2020/12/01 [QC#58023, ADD] -->
           ,FV.TECH_CD
           ,FV.SVC_ASG_TECH_CD
           <!-- END 2020/12/01 [QC#58023, ADD] -->
           <!-- START 2022/04/11 K.Kitachi [QC#59899, ADD] -->
           ,F.SHIP_TO_UPD_CUST_CD
           <!-- END 2022/04/11 K.Kitachi [QC#59899, ADD] -->
        FROM
            PRCH_REQ PR
           ,SVC_TASK ST
           <!-- START 2022/04/11 K.Kitachi [QC#59899, ADD] -->
           ,FSR      F
           <!-- END 2022/04/11 K.Kitachi [QC#59899, ADD] -->
           <!-- START 2020/12/01 [QC#58023, ADD] -->
           ,FSR_VISIT FV
           <!-- END 2020/12/01 [QC#58023, ADD] -->
        WHERE
            PR.GLBL_CMPY_CD = #glblCmpyCd#
        AND PR.PRCH_REQ_NUM = #prchReqNum#
        AND PR.EZCANCELFLAG = '0'
        AND PR.GLBL_CMPY_CD = ST.GLBL_CMPY_CD
        AND PR.SVC_TASK_NUM = ST.SVC_TASK_NUM
        AND PR.FSR_NUM      = ST.FSR_NUM
        AND ST.EZCANCELFLAG = '0'
        <!-- START 2022/04/11 K.Kitachi [QC#59899, ADD] -->
        AND PR.GLBL_CMPY_CD = F.GLBL_CMPY_CD
        AND PR.FSR_NUM      = F.FSR_NUM
        AND F.EZCANCELFLAG  = '0'
        <!-- END 2022/04/11 K.Kitachi [QC#59899, ADD] -->
<!-- START 2020/12/01 [QC#58023, ADD] -->
        AND ST.GLBL_CMPY_CD = FV.GLBL_CMPY_CD(+)
<!-- START 2021/01/12 [QC#58238, ADD] -->
        AND ST.SVC_TASK_NUM = FV.SVC_TASK_NUM(+)
<!-- START 2021/01/12 [QC#58238, ADD] -->
        AND ST.FSR_NUM      = FV.FSR_NUM(+)
        AND FV.EZCANCELFLAG(+) = '0'
<!-- END 2020/12/01 [QC#58023, ADD] -->
<!-- START 2019/05/30 M.Naito [QC#50597,MOD] -->
        <!-- AND EXISTS (SELECT
                        1
                    FROM
                        FSR_VISIT FV
                       ,FSR_VISIT NV
                    WHERE
                        FV.GLBL_CMPY_CD       = ST.GLBL_CMPY_CD
                    AND FV.FSR_NUM            = ST.FSR_NUM
                    AND FV.SVC_TASK_NUM       = ST.SVC_TASK_NUM
                    AND FV.EZCANCELFLAG       = '0'
                    AND FV.GLBL_CMPY_CD       = NV.GLBL_CMPY_CD
                    AND FV.FSR_NUM            = NV.FSR_NUM
                    AND FV.NEXT_FSR_VISIT_NUM = NV.FSR_VISIT_NUM
                    AND NV.FSR_VISIT_STS_CD   IN (#svcTaskStsPendPrt#, #svcTaskStsTBO#)
                    AND NV.EZCANCELFLAG       = '0'
                   ) -->
<!-- END 2019/05/30 M.Naito [QC#50597,MOD] -->
        ORDER BY
            FSR_NUM
           ,SVC_TASK_NUM
    </statement>

    <statement id="getPrchReqDtlChild" parameterClass="Map" resultClass="Map">
        SELECT
            PRD.PRCH_REQ_LINE_STS_CD
           ,PRD.PRCH_REQ_LINE_TP_CD
           ,PRT.CLO_PRCH_REQ_LINE_STS_CD
           ,NVL(PRD.PRCH_REQ_QTY, 0) AS PRCH_REQ_QTY
           ,NVL(PRD.SHIP_QTY, 0) AS SHIP_QTY
           ,NVL(PRD.RWS_PUT_AWAY_QTY, 0) RWS_PUT_AWAY_QTY
           ,NVL(PRD.PRCH_REQ_CANC_QTY, 0) PRCH_REQ_CANC_QTY
           ,(
               SELECT
                   PRNT_PRD.PRCH_REQ_QTY
               FROM
                   PRCH_REQ_DTL PRNT_PRD
               WHERE PRNT_PRD.GLBL_CMPY_CD = PRD.GLBL_CMPY_CD
               AND PRNT_PRD.PRCH_REQ_NUM = PRD.PRCH_REQ_NUM
               AND PRNT_PRD.PRCH_REQ_LINE_NUM = PRD.PRCH_REQ_LINE_NUM
               AND PRNT_PRD.PRCH_REQ_LINE_SUB_NUM = 0
               AND PRNT_PRD.EZCANCELFLAG = '0'
           ) AS PRNT_PRCH_REQ_QTY
        FROM
            PRCH_REQ_DTL PRD
           ,PRCH_REQ     PR
           ,PRCH_REQ_TP  PRT
        WHERE
            PRD.GLBL_CMPY_CD          = #glblCmpyCd#
        AND PRD.PRCH_REQ_NUM          = #prchReqNum#
        AND PRD.PRCH_REQ_LINE_NUM     = #prchReqLineNum#
        AND PRD.PRCH_REQ_LINE_SUB_NUM &lt;&gt; 0
        AND PRD.EZCANCELFLAG          = '0'
        AND PRD.GLBL_CMPY_CD          = PR.GLBL_CMPY_CD
        AND PRD.PRCH_REQ_NUM          = PR.PRCH_REQ_NUM
        AND PR.EZCANCELFLAG           = '0'
        AND PR.GLBL_CMPY_CD           = PRT.GLBL_CMPY_CD
        AND PR.PRCH_REQ_TP_CD         = PRT.PRCH_REQ_TP_CD
        AND PRT.EZCANCELFLAG          = '0'
    </statement>

    <!-- START 2021/10/07 R.Azucena [QC#60664, DEL]
    <statement id="getTechReqSumQty" parameterClass="Map" resultClass="Map">
        SELECT
             SUM(PRD.PRCH_REQ_QTY) AS SUM_PRCH_REQ_QTY
            ,SUM(PRD.RWS_PUT_AWAY_QTY) AS SUM_RWS_PUT_AWAY_QTY
        FROM
            PRCH_REQ_DTL PRD
        WHERE
            PRD.GLBL_CMPY_CD          = #glblCmpyCd#
        AND PRD.PRCH_REQ_NUM          = #prchReqNum#
        <iterate property="prchReqLineStsCdExcludeList" var="prchReqLineStsCdExclude[]" open="AND PRD.PRCH_REQ_LINE_STS_CD NOT IN (" close=")" conjunction=",">
            #prchReqLineStsCdExclude[]#
        </iterate>
        <iterate property="prchReqLineTpCdList" var="prchReqLineTpCdList[]" open="AND PRD.PRCH_REQ_LINE_TP_CD NOT IN (" close=")" conjunction=",">
            #prchReqLineTpCdList[]#
        </iterate>
        AND PRD.EZCANCELFLAG          = '0'
    </statement>
    END 2021/10/07 R.Azucena [QC#60664, DEL] -->

    <statement id="countDestRtlWhInWhOwnr" parameterClass="Map" resultClass="Integer">
        SELECT
             COUNT(*)
        FROM
             PRCH_REQ_DTL   PRD
            ,RTL_WH         RW
        WHERE
            PRD.GLBL_CMPY_CD   = #glblCmpyCd#
        AND PRD.PRCH_REQ_NUM   = #prchReqNum#
        AND RW.GLBL_CMPY_CD    = PRD.GLBL_CMPY_CD
        AND RW.RTL_WH_CD       = PRD.DEST_RTL_WH_CD
        <iterate property="whOwnrCdList" var="whOwnrCd[]" open="AND RW.WH_OWNR_CD IN (" close=")" conjunction=",">
            #whOwnrCd[]#
        </iterate>
        AND PRD.EZCANCELFLAG   = '0'
        AND RW.EZCANCELFLAG    = '0'
    </statement>

    <statement id="checkHazmat" parameterClass="Map" resultClass="Map">
        SELECT
            PRD.PRCH_REQ_NUM
           ,PRD.PRCH_REQ_LINE_NUM
           ,PRD.PRCH_REQ_LINE_SUB_NUM
           ,PRD.SRC_RTL_WH_CD
           ,RW.WH_OWNR_CD
           ,PRD.MDSE_CD
           ,MSI.HAZ_MAT_FLG
        FROM
            PRCH_REQ_DTL    PRD
           ,RTL_WH          RW
           ,MDSE_SFTY_INFO  MSI
        WHERE 1=1
        AND PRD.GLBL_CMPY_CD             = #glblCmpyCd#
        AND PRD.PRCH_REQ_NUM             = #prchReqNum#
        AND PRD.PRCH_REQ_LINE_NUM        = #prchReqLineNum#
        AND PRD.PRCH_REQ_LINE_SUB_NUM    = #prchReqLineSubNum#
        AND PRD.GLBL_CMPY_CD             = RW.GLBL_CMPY_CD
        AND PRD.SRC_RTL_WH_CD            = RW.RTL_WH_CD
        <iterate property="whOwnrCdList" var="whOwnrCd[]" open="AND RW.WH_OWNR_CD IN (" close=")" conjunction=",">
            #whOwnrCd[]#
        </iterate>
        AND PRD.GLBL_CMPY_CD             = MSI.GLBL_CMPY_CD
        AND PRD.MDSE_CD                  = MSI.MDSE_CD
        AND MSI.HAZ_MAT_FLG              = #hazMatFlgY#
        AND PRD.EZCANCELFLAG             = '0'
        AND RW.EZCANCELFLAG              = '0'
        AND MSI.EZCANCELFLAG             = '0'
    </statement>

    <!-- 2017/08/31 K.Kameoka Sol#369(QC#19243) ADD START -->
    <statement id="getInsrcCtrlInfo" parameterClass="Map" resultClass="String">
        SELECT
            MAIN.RQST_NTFY_REQ_FLG
        FROM (
            SELECT 
                IC.RQST_NTFY_REQ_FLG
            FROM 
                 TECH_MSTR TM
                ,S21_PSN  PSN
                ,INSRC_CTRL IC
                ,RTL_WH   WH
           WHERE
                TM.GLBL_CMPY_CD       =  #glblCmpyCd#
            AND TM.GLBL_CMPY_CD       =  PSN.GLBL_CMPY_CD
            AND TM.TECH_TOC_CD        =  PSN.PSN_CD
            AND TM.GLBL_CMPY_CD       =  IC.GLBL_CMPY_CD
            AND PSN.LINE_BIZ_TP_CD    =  IC.LINE_BIZ_TP_CD
            AND IC.PRCH_REQ_TP_CD     =  #prchReqTpCd#
            <iterate property="shpgSvcLvlCds" var="shpgSvcLvlCd[]" open="AND IC.SHPG_SVC_LVL_CD IN ( " close=" )" conjunction=",">
                #shpgSvcLvlCd[]#
            </iterate>
            AND TM.GLBL_CMPY_CD       =  WH.GLBL_CMPY_CD
            AND TM.TECH_TOC_CD        =  WH.RTL_WH_CD
            AND WH.RTL_WH_CD          =  #rtlWhCd#
            AND TM.EZCANCELFLAG       = '0'
            AND PSN.EZCANCELFLAG      = '0'
            AND IC.EZCANCELFLAG       = '0'
            AND WH.EZCANCELFLAG       = '0'
            ORDER BY 
                IC.SHPG_SVC_LVL_CD DESC
            ) MAIN
        WHERE
            ROWNUM = 1
    </statement>
    <statement id="getTechInfo" parameterClass="Map" resultClass="Map">
        SELECT
            TM.EML_ADDR
           ,TM.TECH_CELL_PHO_NUM
           ,TM.TEL_NUM
           ,WH.TECH_MBL_MSG_ADDR
           <!-- 2018/11/28 QC#28735 Add Start -->
           ,TM.TECH_NM
           <!-- 2018/11/28 QC#28735 Add End -->
        FROM
            TECH_MSTR TM
            ,S21_PSN  PSN
            ,RTL_WH   WH
        WHERE
            TM.GLBL_CMPY_CD       =  #glblCmpyCd#
        <!-- 2019/01/10 QC#29877 Add Start -->
        AND TM.TECH_TOC_CD        =  #rqstTechTocCd#
        <!-- 2019/01/10 QC#29877 Add End -->
        AND TM.GLBL_CMPY_CD       =  PSN.GLBL_CMPY_CD
        AND TM.TECH_TOC_CD        =  PSN.PSN_CD
        AND TM.GLBL_CMPY_CD       =  WH.GLBL_CMPY_CD(+) <!-- 2019/01/10 QC#29877 Change To Left Outer Join -->
        AND TM.TECH_TOC_CD        =  WH.RTL_WH_CD(+)    <!-- 2019/01/10 QC#29877 Change To Left Outer Join -->
        <!-- 2019/01/10 QC#29877 Del Start -->
        <!-- AND WH.RTL_WH_CD          =  #rtlWhCd# -->
        <!-- 2019/01/10 QC#29877 Del End -->
        AND TM.EZCANCELFLAG       = '0'
        AND PSN.EZCANCELFLAG      = '0'
        AND WH.EZCANCELFLAG(+)    = '0'                 <!-- 2019/01/10 QC#29877 Change To Left Outer Join -->
    </statement>
    <statement id="getSvcLvlNm" parameterClass="Map" resultClass="String">
        SELECT
            MAIN.TPL_SVC_LVL_NM
        FROM (
            SELECT
                TC.TPL_SVC_LVL_NM
            FROM
                TPL_CARR_SVC_LVL TC
            WHERE
                TC.GLBL_CMPY_CD         = #glblCmpyCd#
            AND TC.WH_OWNR_CD           = #whOwnrCd#
        <isNotNull property="carrCd">
            AND TC.CARR_CD              = #carrCd#
        </isNotNull>
        <isNull property="carrCd">
            AND TC.CARR_CD              IS NULL
        </isNull>
        <isNotNull property="shpgSvcLvlCd">
            AND TC.SHPG_SVC_LVL_CD      = #shpgSvcLvlCd#
        </isNotNull>
        <isNull property="shpgSvcLvlCd">
            AND TC.SHPG_SVC_LVL_CD      IS NULL
        </isNull>
            AND TC.EZCANCELFLAG         = '0'
            ORDER BY
                TC.TPL_CARR_SVC_LVL_SORT_NUM
        ) MAIN
        WHERE
            ROWNUM&lt;=1
    </statement>
    <statement id="getPrCustomer" parameterClass="Map" resultClass="Map">
        SELECT *
        FROM (
            SELECT
                STC.LOC_NM
               ,STC.FIRST_LINE_ADDR
               ,STC.SCD_LINE_ADDR
               ,STC.THIRD_LINE_ADDR
               ,STC.FRTH_LINE_ADDR
               ,STC.CTY_ADDR
               ,STC.ST_CD
               ,STC.POST_CD
               ,STC.CTRY_CD
               ,PRD.CARR_CD
               ,PRD.SHPG_SVC_LVL_CD
            FROM 
                PRCH_REQ_DTL    PRD
               ,SHIP_TO_CUST   STC
            WHERE
                PRD.GLBL_CMPY_CD      = #glblCmpyCd#
            AND PRD.PRCH_REQ_NUM      = #prchReqNum#
            AND PRD.EZCANCELFLAG      = '0'

            AND PRD.GLBL_CMPY_CD      = STC.GLBL_CMPY_CD
            <!-- QC#21657-1 Modify Start -->
            <isNotNull property="shipToCustCd">
                AND STC.SHIP_TO_CUST_CD = #shipToCustCd#
            </isNotNull>
            <isNull property="shipToCustCd">
                AND PRD.DEST_INVTY_LOC_CD = STC.SHIP_TO_CUST_CD
            </isNull>
            <!-- QC#21657-1 Modify End -->
            AND STC.EZCANCELFLAG      = '0'
            ORDER BY
                PRD.GLBL_CMPY_CD       ASC 
               ,PRD.PRCH_REQ_NUM      ASC
               ,PRD.PRCH_REQ_LINE_NUM ASC
        )
        WHERE
            ROWNUM&lt;=1
    </statement>
    <!-- 2017/08/31 K.Kameoka Sol#369(QC#19243) ADD END -->

    <!-- 2017/12/21 QC#22747 ADD START -->
    <statement id="getAslInfoByVnd" parameterClass="Map" resultClass="Map">
        SELECT
             ASL_HDR_PK
            ,PRNT_VND_CD
            ,ASL_DTL_PK
            ,VND_CD
            ,SPLY_ITEM_NUM
            ,UNIT_PRC_AMT
        FROM (
            SELECT
                 ASH.ASL_HDR_PK         ASL_HDR_PK
                ,ASH.PRNT_VND_CD        PRNT_VND_CD
                ,ASD.ASL_DTL_PK         ASL_DTL_PK
                ,ASD.VND_CD             VND_CD
                ,ASD.SPLY_ITEM_NUM      SPLY_ITEM_NUM
                ,ASD.UNIT_PRC_AMT       UNIT_PRC_AMT
            FROM
                 ASL_HDR    ASH
                ,ASL_DTL    ASD
            WHERE
                    ASH.GLBL_CMPY_CD                         = #GLBL_CMPY_CD#
                AND ASH.EZCANCELFLAG                         = '0'
                AND NVL(ASH.ASL_START_DT, #MIN_START_DATE#)  &lt;=#SLS_DT#
                AND NVL(ASH.ASL_END_DT, #MAX_START_DATE#)    &gt;= #SLS_DT#
                AND ASD.GLBL_CMPY_CD                         = ASH.GLBL_CMPY_CD
                AND ASD.EZCANCELFLAG                         = '0'
                AND ASD.ASL_HDR_PK                           = ASH.ASL_HDR_PK
                AND ASD.MDSE_CD                              = #MDSE_CD#
                AND ASD.VND_CD                               = #VND_CD#
                AND NVL(ASD.EFF_FROM_DT, #MIN_START_DATE#)   &lt;= #SLS_DT#
                AND NVL(ASD.EFF_THRU_DT, #MAX_START_DATE#)   &gt;= #SLS_DT#
                ORDER BY
                    ASL_HDR_PK DESC
                   ,ASL_DTL_PK DESC
        )
        WHERE ROWNUM = 1
    </statement>
    <!-- 2017/12/21 QC#22747 ADD END -->

    <!-- 2018/05/22 QC#2366 ADD SQL -->
    <statement id="getHazmatItemInfo" parameterClass="Map" resultClass="Map">
        SELECT
              MSI.MDSE_CD
             ,MSI.HAZ_MAT_FLG
             ,HM.HAZ_MAT_CD
             ,HM.SHPG_SVC_LVL_CD
        FROM
            MDSE_SFTY_INFO MSI
            ,HAZ_MAT HM
        WHERE
            MSI.GLBL_CMPY_CD    = #glblCmpyCd#
        AND MSI.MDSE_CD         = #mdseCd#
        AND MSI.HAZ_MAT_FLG     = #flgOnY#
        AND MSI.EZCANCELFLAG    = '0'
        AND HM.GLBL_CMPY_CD(+)  = MSI.GLBL_CMPY_CD
        AND HM.HAZ_MAT_CD(+)    = MSI.HAZ_MAT_CD
        AND HM.EZCANCELFLAG(+)  = '0'
    </statement>

    <!-- 2018/05/22 QC#2366 ADD SQL -->
    <statement id="getShipToCustPkForTech" parameterClass="Map" resultClass="BigDecimal">
        SELECT
              STC.SHIP_TO_CUST_PK
        FROM
            SHIP_TO_CUST STC
        WHERE
            STC.GLBL_CMPY_CD    = #glblCmpyCd#
        AND STC.SHIP_TO_CUST_CD = #shipToCustCd#
        AND STC.LOC_GRP_CD      != #locGrpTech#
        AND STC.RGTN_STS_CD     = #rgtnOrderTaking#
        AND STC.EZCANCELFLAG    = '0'
    </statement>

    <!-- 2018/05/22 QC#2366 ADD SQL -->
    <statement id="getPreferredCarrierFedexForWh" parameterClass="Map" resultClass="String">
        SELECT
              RW.PRF_CARR_CD
        FROM
             RTL_WH RW
            ,VND V
            ,VND_TP_RELN VTR
        WHERE
            RW.GLBL_CMPY_CD    = #glblCmpyCd#
        AND RW.RTL_WH_CD       = #techTocCd#
        AND RW.EZCANCELFLAG    = '0'
        AND V.GLBL_CMPY_CD     = RW.GLBL_CMPY_CD
        AND V.VND_CD           = RW.PRF_CARR_CD
        AND V.CARR_TP_CD       = #carrTpFedex#
        AND V.EZCANCELFLAG     = '0'
        AND VTR.GLBL_CMPY_CD   = V.GLBL_CMPY_CD
        AND VTR.VND_CD         = V.VND_CD
        AND VTR.VND_TP_CD      = #vndTpObCarrier#
        AND VTR.EZCANCELFLAG   = '0'
    </statement>

    <!-- QC#2366 Add SQL -->
    <statement id="getShipToCustAddress" parameterClass="Map" resultClass="Map">
        SELECT
             STC.SHIP_TO_CUST_CD
            ,STC.SHIP_TO_CUST_PK
            ,STC.LOC_NM
            ,STC.FIRST_LINE_ADDR
            ,STC.SCD_LINE_ADDR
            ,STC.THIRD_LINE_ADDR
            ,STC.FRTH_LINE_ADDR
            ,STC.CTY_ADDR
            ,STC.CNTY_PK
            ,CTY.CNTY_NM
            ,STC.PROV_NM
            ,STC.ST_CD
            ,STC.POST_CD
            ,STC.CTRY_CD
            ,STC.FIRST_REF_CMNT_TXT
            ,STC.SCD_REF_CMNT_TXT
        FROM
             SHIP_TO_CUST STC
            ,CNTY CTY
        WHERE
            STC.GLBL_CMPY_CD    = #glblCmpyCd#
        AND STC.SHIP_TO_CUST_CD = #shipToCustCd#
        AND STC.RGTN_STS_CD     = #rgtnStsCd#
        AND STC.EZCANCELFLAG    = '0'
        AND STC.GLBL_CMPY_CD    = CTY.GLBL_CMPY_CD(+)
        AND STC.CNTY_PK         = CTY.CNTY_PK(+)
        AND CTY.EZCANCELFLAG(+) = '0'
    </statement>

    <!-- QC#2366 Add SQL -->
    <statement id="getCarrCdForWillCall" parameterClass="Map" resultClass="String">
        SELECT
             SLC.CARR_CD
        FROM
             SHPG_SVC_LVL_CARR_RELN SLC
        WHERE
            SLC.GLBL_CMPY_CD    = #glblCmpyCd#
        AND SLC.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
        AND SLC.EZCANCELFLAG    = '0'
    </statement>

    <!-- QC#2366 Add SQL -->
    <statement id="checkSpgSvcCarrReln" parameterClass="Map" resultClass="Integer">
        SELECT
             COUNT(*) CNT
        FROM
             SHPG_SVC_LVL_CARR_RELN SLC
        WHERE
            SLC.GLBL_CMPY_CD    = #glblCmpyCd#
        AND SLC.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
        AND SLC.CARR_CD         = #carrCd#
        AND SLC.EZCANCELFLAG    = '0'
    </statement>

    <!-- QC#2366 Add SQL -->
    <statement id="cntCustomerWh" parameterClass="Map" resultClass="Integer">
        SELECT
             COUNT(*) CNT
        FROM
             RTL_SWH RS
        WHERE
            RS.GLBL_CMPY_CD    = #glblCmpyCd#
        AND RS.INVTY_LOC_CD    = #invtyLocCd#
        AND RS.RTL_WH_CATG_CD  = #rtlWhCatgCustomer#
        AND RS.EZCANCELFLAG    = '0'
    </statement>

    <statement id="textItemCheck" parameterClass="Map" resultClass="Integer">
        SELECT
             COUNT(*) CNT
        FROM
             MDSE MDSE
        WHERE
            MDSE.GLBL_CMPY_CD     = #glblCmpyCd#
        AND MDSE.MDSE_CD          = #mdseCd#
        AND MDSE.MDSE_ITEM_TP_CD  = #mdseItemTpCd#
        AND MDSE.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getSupdInfoFromIncgFlgN" parameterClass="Map" resultClass="Map">
        SELECT
           R.SUPD_FROM_MDSE_CD,
           S.INCG_FLG
        FROM
           SUPD_RELN R,
           SUPD S
        WHERE
           R.EZCANCELFLAG          = '0'
           AND R.GLBL_CMPY_CD      = #glblCmpyCd#
           AND R.SUPD_TO_MDSE_CD   = #supdToMdseCd#
           AND S.EZCANCELFLAG      = '0'
           AND S.GLBL_CMPY_CD      = R.GLBL_CMPY_CD
           AND S.MDSE_CD           = R.SUPD_FROM_MDSE_CD
           AND S.INCG_FLG          = 'N'
    </statement>

    <statement id="getRelnMdseCd" parameterClass="Map" resultClass="Map">
        SELECT
            <isNull property="isChoice">
            RELN_MDSE_CD
            </isNull>
            <isNotNull property="isChoice">
            MDSE_CD AS RELN_MDSE_CD
            </isNotNull>
        FROM
            MDSE_ITEM_FLIP_SET
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND EZCANCELFLAG = '0'
            <isNull property="isChoice">
            AND MDSE_CD = #mdseCd#
            </isNull>
            <isNotNull property="isChoice">
            AND RELN_MDSE_CD = #mdseCd#
            </isNotNull>
            AND MDSE_ITEM_RELN_TP_CD = #srchMdseItemRelnTpCd#
        ORDER BY
            RELN_MDSE_CD
    </statement>

    <statement id="getMdseCd" parameterClass="Map" resultClass="Map">
        SELECT
            <isNull property="isChoice">
            MDSE_CD
            </isNull>
            <isNotNull property="isChoice">
            RELN_MDSE_CD AS MDSE_CD
            </isNotNull>
        FROM
            MDSE_ITEM_FLIP_SET
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND EZCANCELFLAG = '0'
            <isNull property="isChoice">
            AND RELN_MDSE_CD = #relnMdseCd#
            </isNull>
            <isNotNull property="isChoice">
            AND MDSE_CD = #relnMdseCd#
            </isNotNull>
            AND MDSE_ITEM_RELN_TP_CD = #srchMdseItemRelnTpCd#
        ORDER BY
            MDSE_CD
    </statement>
    <!-- ADD 2020/07/31 QC#57365 -->
    <statement id="sumShipQty" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            SUM(SOCD.SHIP_QTY) AS SUM_SHIP_QTY
        FROM
            SHPG_ORD SO
           ,SHPG_ORD_DTL SOD
           ,SHPG_ORD_CONF_DTL SOCD
        WHERE
            SOD.GLBL_CMPY_CD          = #glblCmpyCd#
        AND SO.GLBL_CMPY_CD           = SOD.GLBL_CMPY_CD
        AND SO.SO_NUM                 = SOD.SO_NUM
        AND SOD.PRCH_REQ_NUM          = #prchReqNum#
        AND SOD.PRCH_REQ_LINE_NUM     = #prchReqLineNum#
        AND SOD.PRCH_REQ_LINE_SUB_NUM = #prchReqLineSubNum#
        AND SOD.GLBL_CMPY_CD          = SOCD.GLBL_CMPY_CD
        AND SOD.SO_NUM                = SOCD.SO_NUM
        AND SOD.SO_SLP_NUM            = SOCD.SO_SLP_NUM
        AND SO.EZCANCELFLAG           = '0'
        AND SOD.EZCANCELFLAG          = '0'
        AND SOCD.EZCANCELFLAG         = '0'
    </statement>

    <!-- START 2021/10/07 R.Azucena [QC#60664, ADD] -->
    <statement id="getActiveRwsNum" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS CNT
        FROM
            PRCH_REQ_DTL PRD,
            RWS_DTL      RWS
        WHERE
                PRD.GLBL_CMPY_CD          = #glblCmpyCd#
            AND PRD.PRCH_REQ_NUM          = #prchReqNum#
            AND PRD.PRCH_REQ_LINE_STS_CD != #prchReqLineStsCd#
            AND PRD.EZCANCELFLAG          = '0'
            AND RWS.GLBL_CMPY_CD          = PRD.GLBL_CMPY_CD
            AND RWS.PRCH_REQ_NUM          = PRD.PRCH_REQ_NUM
            AND RWS.PRCH_REQ_LINE_NUM     = PRD.PRCH_REQ_LINE_NUM
            AND RWS.PRCH_REQ_LINE_SUB_NUM = PRD.PRCH_REQ_LINE_SUB_NUM
            AND RWS.RWS_STS_CD           != #rwsStsCd#
            AND RWS.EZCANCELFLAG          = '0'
    </statement>
    <!-- END 2021/10/07 R.Azucena [QC#60664, ADD] -->

    <!-- START 2023/3/31 E.Watabe [QC#61210, ADD] -->
    <statement id="getCountCusaSupplier" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)
        FROM 
            PO_VND_V V
        WHERE
                V.GLBL_CMPY_CD  = #glblCmpyCd#
            AND V.EZCANCELFLAG  = '0'
            AND V.PRNT_VND_CD   = #prntVndCd#
            AND V.VND_CD        = #vndCd#
    </statement>

    <statement id="getParentVendorCode" parameterClass="Map" resultClass="String">
        SELECT
            AH.PRNT_VND_CD
        FROM 
            ASL_HDR AH
           ,ASL_DTL AD
        WHERE
                AH.GLBL_CMPY_CD     = #glblCmpyCd#
            AND AH.EZCANCELFLAG     = '0'
            AND AH.ASL_START_DT     &lt;= #procDt#
            AND NVL(AH.ASL_END_DT, '99991231') &gt;= #procDt#
            AND AH.GLBL_CMPY_CD     = AD.GLBL_CMPY_CD
            AND AD.EZCANCELFLAG     = '0'
            AND AH.ASL_HDR_PK       = AD.ASL_HDR_PK
            AND AD.MDSE_CD          = #mdseCd#
            AND AD.EFF_FROM_DT      &lt;= #procDt#
            AND NVL(AD.EFF_THRU_DT, '99991231') &gt;= #procDt#
            AND AD.PRIM_SPLY_FLG    = 'Y'
    </statement>
    <!-- END 2023/3/31 E.Watabe [QC#61210, ADD] -->

    <!-- START 2023/05/25 T.Kuroda [QC#61211, ADD] -->
    <statement id="getTechLineBizType" parameterClass="Map" resultClass="String">
        SELECT
             LINE_BIZ_TP_CD
        FROM
            S21_PSN
        WHERE
            EZCANCELFLAG = '0'
            AND GLBL_CMPY_CD = #glblCmpyCd#
            AND PSN_CD = #psnCd#
            AND EFF_FROM_DT &lt;= #effFromDt#
            AND NVL(EFF_THRU_DT, '99991231') &gt;= #effThruDt#
    </statement>
    <!-- END   2023/05/25 T.Kuroda [QC#61211, ADD] -->

</sqlMap>
