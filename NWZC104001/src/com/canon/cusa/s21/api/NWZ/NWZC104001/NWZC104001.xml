<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWZC104001">

	<typeAlias alias="ShpgPlnCompBean"			type="com.canon.cusa.s21.api.NWZ.NWZC104001.ShpgPlnCompBean"/>

	
	<statement id="getCtryCd" parameterClass="Map" resultClass="String">
		SELECT
			 CTRY_CD 
		FROM
   			 CTRY_ORIG_RST 
		WHERE
				GLBL_CMPY_CD 	 = #glblCmpyCd#
			AND 
			(
					 (CUST_CD = #billToCustCd#	AND	ASG_LOC_ROLE_LAYER_NUM  = 1)
				OR	 (CUST_CD = #sellToCustCd#  AND ASG_LOC_ROLE_LAYER_NUM  = 2) 
			)
			AND EZCANCELFLAG = '0'

			
	</statement>

	<statement id="getMDSE" parameterClass="Map" >
		SELECT
		  	 A.MDSE_CD  AS MDSE_CD
		    ,B.FIRST_FLIP_FLG  AS FIRST_FLIP_FLG
		    ,B.THRHD_QTY  AS THRHD_QTY
		FROM
   			 MDSE A
   			,ALLOC_THRHD B
            ,RTL_SWH     RS     <!-- Add S21_MA#5872 -->
		WHERE
				A.GLBL_CMPY_CD 	     = 		#glblCmpyCd#
			AND A.MDSE_CD 		    like 	#mdseCd#
			AND A.SELL_HLD_FLG       =      #sellHldFlg#
			AND A.RGTN_STS_CD  	 	 =  	#rgtnStsCd#
			<isNotNull property="ctryCdList">
			AND A.ORIG_CTRY_CD NOT IN
				<iterate property="ctryCdList" var="ctryCd[]" open="(" close=")" conjunction=",">
						#ctryCd[]#
				</iterate>
			</isNotNull>
			<!-- 2017/03/13 S21_NA#16987 Add Start -->
			AND A.CUST_ORD_ENBL_FLG = #custOrdEnblFlg#
			<!-- 2017/03/13 S21_NA#16987 Add End -->
			AND A.EZCANCELFLAG       = 		'0'

            <!-- Add Start S21_NA#5872 -->
            AND RS.GLBL_CMPY_CD      =      #glblCmpyCd#
            AND RS.INVTY_LOC_CD      =      #invtyLocCd#
            AND RS.EZCANCELFLAG      =      '0'
            <!-- Add End S21_NA#5872 -->

			AND B.GLBL_CMPY_CD(+)	 = 		A.GLBL_CMPY_CD
			AND B.MDSE_CD(+)		 = 		A.MDSE_CD
			AND B.INVTY_LOC_CD(+)	 = 		#invtyLocCd#
			AND B.EZCANCELFLAG(+)    = 		'0'
            <!-- Add Start S21_NA#5872 -->
            <isEqual property="hardAllocTpCd" compareValue="10">
            AND NOT EXISTS (SELECT 1 
                            FROM    MDSE_WH_COND    MWC
                            WHERE   MWC.GLBL_CMPY_CD    = A.GLBL_CMPY_CD
                            AND     MWC.MDSE_CD         = A.MDSE_CD
                            AND     MWC.RTL_WH_CD       = RS.RTL_WH_CD
		                    AND    (MWC.RTL_SWH_CD      = RS.RTL_SWH_CD
		                            OR (MWC.RTL_SWH_CD   = '*'
		                               AND NOT EXISTS ( SELECT 1 FROM MDSE_WH_COND MWC_B
		                                                WHERE MWC_B.GLBL_CMPY_CD    = A.GLBL_CMPY_CD
                                                        AND   MWC_B.MDSE_CD         = A.MDSE_CD
		                                                AND   MWC_B.RTL_WH_CD       = RS.RTL_WH_CD 
		                                                AND   MWC_B.RTL_SWH_CD      = RS.RTL_SWH_CD
		                                                AND   MWC_B.EZCANCELFLAG    = '0'
		                                                )
		                                )
		                           )
                            AND     MWC.EZCANCELFLAG    = '0'
                           )
            </isEqual>
            <!-- Add Start S21_NA#5872 -->
		ORDER BY A.MDSE_CD
		
	</statement>

	<statement id="getShpgPlnLineNumber" parameterClass="Map" resultClass="String">
	
	
		SELECT
				MAX(TO_NUMBER(A.SHPG_PLN_DPLY_LINE_NUM)) AS MAX_NUM
        FROM
           		SHPG_PLN A
        WHERE
           	    A.GLBL_CMPY_CD 		= 	#glblCmpyCd#
           	AND A.TRX_HDR_NUM 		= 	#trxHdrNum#
           	AND A.TRX_LINE_NUM 		= 	#trxLineNum#
           	AND A.TRX_LINE_SUB_NUM 	= 	#trxLineSubNum#
           	AND A.TRX_SRC_TP_CD 	= 	#trxSrcTpCd#
           	AND A.EZCANCELFLAG      = 	'0'
	
	
	</statement>
	
	
	<statement id="getSumHardAllocQtyForSoftAllocPK" parameterClass="Map" resultClass="BigDecimal">
	
	
		SELECT
			    SUM(A.HARD_ALLOC_QTY) AS SUM_HARD_ALLOC_QTY
        FROM
           		HARD_ALLOC A
        WHERE
           	    A.GLBL_CMPY_CD 		= #glblCmpyCd#
           	AND A.TRX_HDR_NUM 		= #trxHdrNum#
           	AND A.TRX_LINE_NUM 		= #trxLineNum#
           	AND A.TRX_LINE_SUB_NUM 	= #trxLineSubNum#
           	AND A.TRX_SRC_TP_CD 	= #trxSrcTpCd#
			AND A.MDSE_CD 		    = #mdseCd#
			AND A.INVTY_LOC_CD 		= #invtyLocCd#
			AND A.SHPG_SVC_LVL_CD 	= #shpgSvcLvlCd#			
			AND A.SOFT_ALLOC_PK 	= #softAllocPk#		
		    AND A.EZCANCELFLAG      = '0'

	</statement>
	
	
	<statement id="getSumHardAllocQty" parameterClass="Map" >
	
	
		SELECT
			    SUM(A.HARD_ALLOC_QTY) AS SUM_HARD_ALLOC_QTY
			   ,A.SOFT_ALLOC_PK AS SOFT_ALLOC_PK
        FROM
           		HARD_ALLOC A
        WHERE
           	    A.GLBL_CMPY_CD 		= #glblCmpyCd#
           	AND A.TRX_HDR_NUM 		= #trxHdrNum#
           	AND A.TRX_LINE_NUM 		= #trxLineNum#
           	AND A.TRX_LINE_SUB_NUM 	= #trxLineSubNum#
           	AND A.TRX_SRC_TP_CD 	= #trxSrcTpCd#
	        AND A.EZCANCELFLAG      = '0'
	        <isNotNull property="mdseCd">
			AND A.MDSE_CD 		    = #mdseCd#
			</isNotNull>
		    <isNotNull property="invtyLocCd">
			AND A.INVTY_LOC_CD 		= #invtyLocCd#
			</isNotNull>
		    <isNotNull property="shpgSvcLvlCd">
			AND A.SHPG_SVC_LVL_CD 	= #shpgSvcLvlCd#		
			</isNotNull>
		GROUP BY
			A.SOFT_ALLOC_PK
		ORDER BY
			SUM(A.HARD_ALLOC_QTY) 
      		
	</statement>
	
		<statement id="getSumHardAllocQtyForOrderCancel" parameterClass="Map" resultClass="BigDecimal">
	
	
		SELECT
			    SUM(A.HARD_ALLOC_QTY) AS SUM_HARD_ALLOC_QTY
        FROM
           		HARD_ALLOC A
        WHERE
           	    A.GLBL_CMPY_CD 		= #glblCmpyCd#
           	AND A.TRX_HDR_NUM 		= #trxHdrNum#
           	AND A.TRX_LINE_NUM 		= #trxLineNum#
           	AND A.TRX_LINE_SUB_NUM	= #trxLineSubNum#
           	AND A.TRX_SRC_TP_CD 	= #trxSrcTpCd#
	        AND A.EZCANCELFLAG      = '0'
	        <isNotNull property="mdseCd">
			AND A.MDSE_CD 		    = #mdseCd#
			</isNotNull>
		    <isNotNull property="invtyLocCd">
			AND A.INVTY_LOC_CD 		= #invtyLocCd#
			</isNotNull>
		    <isNotNull property="shpgSvcLvlCd">
			AND A.SHPG_SVC_LVL_CD 	= #shpgSvcLvlCd#		
			</isNotNull>

	</statement>
	
		<statement id="getNotCancelOrdQtyForSoftAllocPK" parameterClass="Map" resultClass="BigDecimal">
	
	
		SELECT
			    A.ORD_QTY  AS SUM_ORD_QTY
        FROM
           		SHPG_PLN A
               ,SHPG_STS B
           	   ,SOFT_ALLOC C
        WHERE
           	    A.GLBL_CMPY_CD 			= #glblCmpyCd#
           	AND B.GLBL_CMPY_CD 			= #glblCmpyCd#
           	AND C.GLBL_CMPY_CD 			= #glblCmpyCd#               	    
           	AND A.TRX_HDR_NUM 			= #trxHdrNum#
           	AND A.TRX_LINE_NUM 			= #trxLineNum#
           	AND A.TRX_LINE_SUB_NUM 		= #trxLineSubNum#
           	AND A.TRX_SRC_TP_CD 		= #trxSrcTpCd#
			AND A.MDSE_CD 		    	= #mdseCd#
			AND A.INVTY_LOC_CD 		    = #invtyLocCd#
			AND A.ORIG_SHPG_SVC_LVL_CD 	= #orgShpgSvcLvlCd#			
			AND C.SOFT_ALLOC_PK 		= #softAllocPk#	
			AND C.SHPG_PLN_NUM 			= A.SHPG_PLN_NUM						
		    AND A.EZCANCELFLAG       	= '0'
		    AND B.EZCANCELFLAG       	= '0'
		   	AND C.EZCANCELFLAG       	= '0'	
			AND B.SHPG_STS_CD   		= A.SHPG_STS_CD
			AND
			(
					A.SHPG_STS_CD	    = #shpgStsCdHA# 
				OR  A.SHPG_STS_CD	    = #shpgStsCdSO#	
				OR	B.SO_PRINT_FLG  	= #on#  
			)   

	</statement>
	
	<statement id="getNotCancelOrdQtyForOrderCancel" parameterClass="Map" resultClass="BigDecimal">
	
	
		SELECT
			    SUM(A.ORD_QTY) AS SUM_ORD_QTY
        FROM
           		SHPG_PLN A
           	   ,SHPG_STS B
        WHERE
           	    A.GLBL_CMPY_CD 			  = #glblCmpyCd#
           	AND B.GLBL_CMPY_CD 			  = #glblCmpyCd#
           	AND A.TRX_HDR_NUM 			  = #trxHdrNum#
           	AND A.TRX_LINE_NUM 			  = #trxLineNum#
           	AND A.TRX_LINE_SUB_NUM 		  = #trxLineSubNum#
           	AND A.TRX_SRC_TP_CD 		  = #trxSrcTpCd#
			AND A.MDSE_CD 		    	  = #mdseCd#
			AND A.INVTY_LOC_CD 		      = #invtyLocCd#
			AND A.ORIG_SHPG_SVC_LVL_CD 	  = #orgShpgSvcLvlCd#				
		    AND A.EZCANCELFLAG       	  = '0'
		    AND B.EZCANCELFLAG       	  = '0'
			AND B.SHPG_STS_CD   		  = A.SHPG_STS_CD
			AND
			(
					  A.SHPG_STS_CD		  = #shpgStsCdHA# 
				  OR  A.SHPG_STS_CD	      = #shpgStsCdSO#	
				  OR  B.SO_PRINT_FLG 	  = #on#   
			)   
	</statement>
	
	<statement id="querySoftAlloc" parameterClass="Map" resultClass="BigDecimal">
	
		SELECT 
				COUNT (*)
        FROM
        		SOFT_ALLOC
        WHERE
           	    GLBL_CMPY_CD 			  = #glblCmpyCd#
           	AND TRX_SRC_TP_CD 		  	  = #trxSrcTpCd#
           	AND TRX_HDR_NUM				  = #trxHdrNum#
           	AND TRX_LINE_NUM 			  = #trxLineNum#
           	AND TRX_LINE_SUB_NUM 		  = #trxLineSubNum#
		    AND EZCANCELFLAG       	  	  = '0'

	</statement>
	
	<statement id="queryUpdateSoftAlloc" parameterClass="Map" resultClass="BigDecimal">
	
		SELECT 
				SA.SOFT_ALLOC_PK
        FROM
        		SOFT_ALLOC SA
        WHERE
           	    SA.GLBL_CMPY_CD 			  = #glblCmpyCd#
           	AND SA.TRX_SRC_TP_CD 		  	  = #trxSrcTpCd#
           	AND SA.TRX_HDR_NUM				  = #trxHdrNum#
           	AND SA.TRX_LINE_NUM 			  = #trxLineNum#
           	AND SA.TRX_LINE_SUB_NUM 		  = #trxLineSubNum#
           	AND SA.HARD_ALLOC_AVAL_QTY		  &gt;  0	
		    AND SA.EZCANCELFLAG       	  	  = '0'
	</statement>
	
	
	<statement id="queryCpoDtl" parameterClass="Map" resultClass="Map">
	
		SELECT 
           	 CD.CPO_ORD_NUM 		
           	,CD.CPO_DTL_LINE_NUM			  
            ,CD.CPO_DTL_LINE_SUB_NUM		
            ,CD.MDSE_CD
            ,CD.SET_MDSE_CD
            ,CD.CPO_ORD_TS
        FROM
        	   CPO_DTL CD
		WHERE
           	    CD.GLBL_CMPY_CD 			  = #glblCmpyCd#
           	AND CD.CPO_ORD_NUM 			  	  = #trxHdrNum#
           	AND CD.CPO_DTL_LINE_NUM			  = #trxLineNum#
           	AND CD.CPO_DTL_LINE_SUB_NUM		  &lt;&gt; #trxLineNumSet#
		    AND CD.EZCANCELFLAG       	  	  = '0'
        ORDER BY
           	 CD.CPO_ORD_NUM 		
           	,CD.CPO_DTL_LINE_NUM			  
            ,CD.CPO_DTL_LINE_SUB_NUM
	</statement>
	
	
	
	
	<statement id="queryShpgPlnEachComp" parameterClass="Map" resultMap="result.ShpgPlnCompBean">
	
		SELECT 
			  SP.GLBL_CMPY_CD				AS GLBL_CMPY_CD
            , SP.TRX_HDR_NUM				AS TRX_HDR_NUM
            , SP.TRX_LINE_NUM				AS TRX_LINE_NUM
            , SP.TRX_LINE_SUB_NUM			AS TRX_LINE_SUB_NUM
            , SP.SHPG_STS_CD				AS SHPG_STS_CD
            , SP.SHPG_PLN_NUM				AS SHPG_PLN_NUM 
            , SP.ORD_QTY					AS ORD_QTY
            , SP.MDSE_CD					AS MDSE_CD
            , SP.SET_MDSE_CD				AS SET_MDSE_CD
            , SP.SOFT_ALLOC_QTY				AS SOFT_ALLOC_QTY	
            , SP.PO_REQ_FLG					AS PO_REQ_FLG               
        FROM
        		SHPG_PLN SP
        WHERE
           	    SP.GLBL_CMPY_CD 			  = #glblCmpyCd#
           	AND SP.TRX_HDR_NUM 			  	  = #trxHdrNum#
           	AND SP.TRX_LINE_NUM 			  = #trxLineNum#
           	AND SP.TRX_SRC_TP_CD 		  	  = #trxSrcTpCd#
           	AND SP.SET_SHPG_PLN_NUM		      = #setShpgPlnNum#	
           	AND SP.TRX_LINE_SUB_NUM		  	&lt;&gt; #trxLineNumSet#
			AND
							(
									  SP.SHPG_STS_CD		  = #shpgStsCdHA#
								  OR  SP.SHPG_STS_CD	      = #shpgStsCdSO#	
								  OR  SP.SHPG_STS_CD	      = #shpgStsCdPO#	
								  OR  EXISTS (
												SELECT	*
				        						FROM	SHPG_STS SS
				       						 	WHERE		 SP.SHPG_STS_CD		  	= SS.SHPG_STS_CD 
				            	          				AND  SP.GLBL_CMPY_CD 		= SS.GLBL_CMPY_CD  
				                          				AND  SS.SO_PRINT_FLG 	   	= #on#
						                  				AND  SS.EZCANCELFLAG    	= '0'  
								  			 )
						 
								  OR  EXISTS (
												SELECT	*
				        						FROM	MDSE M
				       						 	WHERE	     M.GLBL_CMPY_CD 		= #glblCmpyCd#
				            	          				AND  SP.MDSE_CD 		    = M.MDSE_CD  
				            	          				AND  SP.SHPG_STS_CD		    = #shpgStsCdVA# 	
				                          				AND  M.INVTY_CTRL_FLG 	   	= #off# 
						    							AND  M.EZCANCELFLAG       	= '0'
								  			 )
								  OR  (
								  		 	SP.SHPG_STS_CD		  = #shpgStsCdVA#	
								  		AND	SP.PO_REQ_FLG		  = #on#
								  	  )   		 
							)            

		    AND SP.EZCANCELFLAG       	  = '0' 
        ORDER BY
				SP.TRX_HDR_NUM
            ,   SP.TRX_LINE_NUM
            ,   SP.TRX_LINE_SUB_NUM
            ,   SP.SHPG_STS_CD DESC
            ,   SP.SHPG_PLN_NUM  

	
		</statement>
		
	<resultMap id="result.ShpgPlnCompBean" class="ShpgPlnCompBean">
		<result property="glblCmpyCd"		   	column="GLBL_CMPY_CD"					javaType="String"/>
		<result property="mdseCd"   			column="MDSE_CD" 						javaType="String"/>
		<result property="trxHdrNum"   			column="TRX_HDR_NUM" 					javaType="String"/>	
		<result property="trxLineNum"   		column="TRX_LINE_NUM" 					javaType="String"/>		
		<result property="trxLineSubNum"   		column="TRX_LINE_SUB_NUM" 				javaType="String"/>
		<result property="shpgStsCd"   			column="SHPG_STS_CD" 					javaType="String"/>
		<result property="shpgPlnNum"   		column="SHPG_PLN_NUM" 					javaType="String"/>
		<result property="setMdseCd"   			column="SET_MDSE_CD" 					javaType="String"/>
		<result property="poReqFlg"   			column="PO_REQ_FLG" 					javaType="String"/>
		<result property="sotyAllocQty"   		column="SOFT_ALLOC_QTY" 				javaType="BigDecimal"/>		
		<result property="ordQty"   			column="ORD_QTY" 						javaType="BigDecimal"/>	
	</resultMap>
	
	<statement id="queryEachCompTotalQty" parameterClass="Map" resultClass="Map">
	
		SELECT 
		    CD.CPO_ORD_NUM 					AS CPO_ORD_NUM 
		   ,CD.CPO_DTL_LINE_NUM 			AS CPO_DTL_LINE_NUM
		   ,CD.CPO_DTL_LINE_SUB_NUM 		AS CPO_DTL_LINE_SUB_NUM
		   ,NVL(SPWRK.SUM_ORD_QTY,0)		AS SUM_ORD_QTY
		   ,CD.MDSE_CD 						AS MDSE_CD  
           ,CD.SET_MDSE_CD 					AS SET_MDSE_CD 
           ,CD.CPO_ORD_TS 					AS CPO_ORD_TS
        FROM

				(
				 	SELECT DISTINCT 
				 		  CD.CPO_ORD_NUM				AS CPO_ORD_NUM 
				 		, CD.CPO_DTL_LINE_NUM 			AS CPO_DTL_LINE_NUM
				 		, CD.CPO_DTL_LINE_SUB_NUM		AS CPO_DTL_LINE_SUB_NUM
					    , CD.MDSE_CD 					AS MDSE_CD  
			            , CD.SET_MDSE_CD 				AS SET_MDSE_CD 
			            , CD.CPO_ORD_TS 				AS CPO_ORD_TS
				 	FROM
				 		CPO_DTL CD
					WHERE
				        	CD.GLBL_CMPY_CD 		  	= #glblCmpyCd#
				        AND CD.CPO_ORD_NUM 			  	= #trxHdrNum#
				        AND CD.CPO_DTL_LINE_NUM			= #trxLineNum#
				        AND CD.CPO_DTL_LINE_SUB_NUM		&lt;&gt; #trxLineNumSet#
					    AND CD.EZCANCELFLAG       	  	= '0' 
				 )  CD
				LEFT JOIN
				 (
				 	SELECT 
				 		  SP.TRX_HDR_NUM				AS CPO_ORD_NUM 
				        , SP.TRX_LINE_NUM				AS CPO_DTL_LINE_NUM
				        , SP.TRX_LINE_SUB_NUM			AS CPO_DTL_LINE_SUB_NUM
						, SUM(SP.ORD_QTY)				AS SUM_ORD_QTY
				 	FROM
				 		SHPG_PLN SP
					WHERE
				        	SP.GLBL_CMPY_CD 		  	= #glblCmpyCd#
				        AND SP.TRX_HDR_NUM 				= #trxHdrNum#
				        AND SP.TRX_LINE_NUM				= #trxLineNum#
				        AND SP.TRX_LINE_SUB_NUM			&lt;&gt; #trxLineNumSet#
				        AND SP.TRX_SRC_TP_CD 		  	= #trxSrcTpCd#
				        AND SP.SET_SHPG_PLN_NUM		  	= #setShpgPlnNum#
						AND
							(
									  SP.SHPG_STS_CD		  = #shpgStsCdHA#
								  OR  SP.SHPG_STS_CD	      = #shpgStsCdSO#	
								  OR  SP.SHPG_STS_CD	      = #shpgStsCdPO#	
								  OR  EXISTS (
												SELECT	*
				        						FROM	SHPG_STS SS
				       						 	WHERE		 SP.SHPG_STS_CD		  	= SS.SHPG_STS_CD 
				            	          				AND  SP.GLBL_CMPY_CD 		= SS.GLBL_CMPY_CD  
				                          				AND  SS.SO_PRINT_FLG 	   	= #on#
						                  				AND  SS.EZCANCELFLAG    	= '0'  
								  			 )
						 
								  OR  EXISTS (
												SELECT	*
				        						FROM	MDSE M
				       						 	WHERE	     M.GLBL_CMPY_CD 		= #glblCmpyCd#
				            	          				AND  SP.MDSE_CD 		    = M.MDSE_CD  
				            	          				AND  SP.SHPG_STS_CD		    = #shpgStsCdVA# 	
				                          				AND  M.INVTY_CTRL_FLG 	   	= #off# 
						    							AND  M.EZCANCELFLAG       	= '0'
								  			 )
								  OR  (
								  		 	SP.SHPG_STS_CD		  = #shpgStsCdVA#	
								  		AND	SP.PO_REQ_FLG		  = #on#
								  	  )   		 
							)        
						AND SP.EZCANCELFLAG       	  = '0'   
					GROUP BY
				      		SP.TRX_HDR_NUM
				        ,   SP.TRX_LINE_NUM
				        ,   SP.TRX_LINE_SUB_NUM
				) SPWRK
		ON 
				CD.CPO_ORD_NUM			= SPWRK.CPO_ORD_NUM
			AND CD.CPO_DTL_LINE_NUM		= SPWRK.CPO_DTL_LINE_NUM
			AND CD.CPO_DTL_LINE_SUB_NUM	= SPWRK.CPO_DTL_LINE_SUB_NUM
		
	</statement>
	
	
		<statement id="queryCancelShpgPln" parameterClass="Map" resultClass="Map">
	
	
		SELECT
				SP.SHPG_PLN_NUM				
			,   SP.ORD_QTY					
        FROM
           		SHPG_PLN SP
        WHERE
           	    SP.GLBL_CMPY_CD 			= 	#glblCmpyCd#
           	AND SP.TRX_HDR_NUM 				= 	#trxHdrNum#
           	AND SP.TRX_LINE_NUM 			= 	#trxLineNum#
           	AND SP.TRX_LINE_SUB_NUM 		= 	#trxLineSubNum#
           	AND SP.TRX_SRC_TP_CD 			= 	#trxSrcTpCd#			
           	AND SP.EZCANCELFLAG      		= 	'0'
           	AND SP.SHPG_STS_CD		   	 NOT IN 	
		<iterate property="shpgStsList" var="shpgSts[]" open="(" close=")" conjunction=",">
				#shpgSts[]#
		</iterate>
	
	</statement>
	
	
	
	<statement id="queryCancelHardAlloc" parameterClass="Map" resultClass="Map">

		SELECT
				HA.HARD_ALLOC_PK
			,   HA.MDSE_CD		
			,   HA.INVTY_LOC_CD
			,   HA.SHPG_SVC_LVL_CD					
        FROM
           		HARD_ALLOC HA
        WHERE
           	    HA.GLBL_CMPY_CD 			= 	#glblCmpyCd#
           	AND HA.TRX_HDR_NUM 				= 	#trxHdrNum#
           	AND HA.TRX_LINE_NUM 			= 	#trxLineNum#
           	AND HA.TRX_LINE_SUB_NUM 		= 	#trxLineSubNum#
           	AND HA.TRX_SRC_TP_CD 			= 	#trxSrcTpCd#	
		<isEqual property="allShpgPlnNumFlg" compareValue="N">
           	AND HA.SHPG_PLN_NUM			NOT IN 	
		<iterate property="shpgPlnNumList" var="shpgPlnNum[]" open="(" close=")" conjunction=",">
				#shpgPlnNum[]#
		</iterate>
        </isEqual>
		<isNotNull property="softAllocPk">
			AND HA.SOFT_ALLOC_PK 	= #softAllocPk#		
		</isNotNull>
           	AND HA.EZCANCELFLAG      	= 	'0'
		ORDER BY 
			HA.MDSE_CD
		  ,	HA.INVTY_LOC_CD
		  ,	HA.SHPG_SVC_LVL_CD
		  ,	HA.SOFT_ALLOC_PK 
		  
	</statement>
	
	<statement id="getSoftAllocationTM" parameterClass="Map" resultClass="Map">
	
		SELECT 	  
				DPF.TM_FRAME_FROM_DT	TM_FRAME_FROM_DT
		FROM 	 
				 SOFT_ALLOC  		SA
				,DIST_PLN_TM_FRAME  DPF
		WHERE 
				SA.GLBL_CMPY_CD 			= #glblCmpyCd#
			AND SA.TRX_SRC_TP_CD 			= #trxSrcTpCd#
			AND SA.TRX_HDR_NUM 				= #trxHdrNum#
			AND SA.TRX_LINE_NUM 			= #trxLineNum#
			AND SA.TRX_LINE_SUB_NUM 		= #trxLineSubNum#
			AND SA.SHPG_PLN_NUM 			= #shpgPlnNum#
			AND DPF.GLBL_CMPY_CD 			= SA.GLBL_CMPY_CD		
			AND DPF.DIST_PLN_NUM 			= SA.DIST_PLN_NUM			
			AND DPF.DIST_TM_FRAME_NUM	 	= SA.DIST_TM_FRAME_NUM	
			AND SA.EZCANCELFLAG 			= '0' 	
			AND DPF.EZCANCELFLAG 			= '0' 	
		ORDER BY
			DPF.TM_FRAME_FROM_DT ASC	
	
	</statement>
	
</sqlMap>
