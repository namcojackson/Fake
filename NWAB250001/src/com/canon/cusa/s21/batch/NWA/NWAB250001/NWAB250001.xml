<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NWAB250001">
    <statement id="searchCsaLakRpst" parameterClass="Map">
        SELECT
             DCD.CPO_ORD_NUM
            ,DCD.CPO_DTL_LINE_NUM
            ,DCD.CPO_DTL_LINE_SUB_NUM
            ,NVL(CLR.ILMS_LIC_ACCS_NUM, CLR.LIC_ACCS_NUM) AS LIC_ACCS_NUM
        FROM
             CPO                C
            ,SHPG_PLN           SP
            ,ALL_MDSE_V         M
            ,SW_LIC_CTRL_TP     SLC
            ,CPO_DTL            DCD
            ,PO_DTL             PD
            ,CSA_CPO_V          CC
            ,CSA_CPO_DTL_V      CCD
            ,CSA_LAK_RPST_V     CLR
        WHERE
                C.GLBL_CMPY_CD              = #glblCmpyCd#
            AND C.ORD_HDR_STS_CD            = #ordHdrStsCd#
            AND EXISTS (
                    SELECT
                        1
                    FROM
                        ORD_CATG_BIZ_CTX  BC
                    WHERE
                            BC.GLBL_CMPY_CD         = C.GLBL_CMPY_CD
                        AND BC.ORD_CATG_CTX_TP_CD   = #ordCatgCtxTpCd#
                        AND BC.DS_ORD_CATG_CD       = C.DS_ORD_CATG_CD
                        AND (BC.DS_ORD_TP_CD        = C.DS_ORD_TP_CD OR BC.DS_ORD_TP_CD IS NULL)
                        AND BC.EZCANCELFLAG         = '0'
            )
            AND C.GLBL_CMPY_CD              = DCD.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM               = DCD.CPO_ORD_NUM
            AND DCD.GLBL_CMPY_CD            = SP.GLBL_CMPY_CD
            AND DCD.CPO_ORD_NUM             = SP.TRX_HDR_NUM
            AND DCD.CPO_DTL_LINE_NUM        = SP.TRX_LINE_NUM
            AND DCD.CPO_DTL_LINE_SUB_NUM    = SP.TRX_LINE_SUB_NUM
            AND DCD.SER_NUM                 IS NULL
            AND SP.GLBL_CMPY_CD             = M.GLBL_CMPY_CD
            AND SP.MDSE_CD                  = M.MDSE_CD
            AND M.GLBL_CMPY_CD              = SLC.GLBL_CMPY_CD
            AND M.SW_LIC_CTRL_TP_CD         = SLC.SW_LIC_CTRL_TP_CD
            AND SLC.SW_LIC_REQ_FLG          = 'Y'
            AND SP.GLBL_CMPY_CD             = PD.GLBL_CMPY_CD
            AND SP.TRX_HDR_NUM              = PD.TRX_REF_NUM
            AND SP.TRX_LINE_NUM             = PD.TRX_REF_LINE_NUM
            AND SP.TRX_LINE_SUB_NUM         = PD.TRX_REF_LINE_SUB_NUM
            AND CC.GLBL_CMPY_CD             = #glblCmpyCd_CUSA#
            AND PD.CUST_ISS_PO_NUM          = CC.CUST_ISS_PO_NUM
            AND CC.GLBL_CMPY_CD             = CCD.GLBL_CMPY_CD
            AND CC.CPO_ORD_NUM              = CCD.CPO_ORD_NUM
            AND PD.PO_ORD_DTL_LINE_NUM      = CCD.EDI_NUM
            AND CCD.GLBL_CMPY_CD            = CLR.GLBL_CMPY_CD
            AND CCD.CPO_ORD_NUM             = CLR.CPO_ORD_NUM
            AND CCD.CPO_DTL_LINE_NUM        = CLR.CPO_DTL_LINE_NUM
            AND CCD.CPO_DTL_LINE_SUB_NUM    = CLR.CPO_DTL_LINE_SUB_NUM
            AND C.EZCANCELFLAG              = '0'
            AND DCD.EZCANCELFLAG            = '0'
            AND SP.EZCANCELFLAG             = '0'
            AND M.EZCANCELFLAG              = '0'
            AND SLC.EZCANCELFLAG            = '0'
            AND PD.EZCANCELFLAG             = '0'
            AND CC.EZCANCELFLAG             = '0'
            AND CCD.EZCANCELFLAG            = '0'
            AND CLR.EZCANCELFLAG            = '0'
        ORDER BY
             DCD.CPO_ORD_NUM
            ,DCD.CPO_DTL_LINE_NUM
            ,DCD.CPO_DTL_LINE_SUB_NUM
    </statement>
</sqlMap>