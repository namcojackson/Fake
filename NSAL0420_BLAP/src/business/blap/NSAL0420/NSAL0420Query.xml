<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSAL0420Query">
    <typeAlias alias="NSAL0420_ASMsg"  type="business.blap.NSAL0420.NSAL0420_ASMsg"/>
    
    <statement id="getSearchData" parameterClass="Map" resultMap="result.getSearchData">
        <!-- START 2018/02/02 K.Kojima [QC#23595,ADD] -->
        SELECT
             SVC_RG_PK
            ,SVC_RG_NM
            ,LINE_BIZ_TP_CD
            ,LINE_BIZ_TP_DESC_TXT
            ,SVC_CONTR_BR_CD
            ,SVC_CONTR_BR_DESC_TXT
            ,PSN_CD
            ,CORP_RESRC_NM
            ,ORG_FUNC_ROLE_TP_NM
        FROM
            (
        <!-- END 2018/02/02 K.Kojima [QC#23595,ADD] -->
        SELECT
             SR.SVC_RG_PK                   AS SVC_RG_PK
            ,SR.SVC_RG_NM                   AS SVC_RG_NM
            ,LBT.LINE_BIZ_TP_CD             AS LINE_BIZ_TP_CD
            ,LBT.LINE_BIZ_TP_DESC_TXT       AS LINE_BIZ_TP_DESC_TXT
            ,SCB.SVC_CONTR_BR_CD            AS SVC_CONTR_BR_CD
            ,SCB.SVC_CONTR_BR_DESC_TXT      AS SVC_CONTR_BR_DESC_TXT
            ,SP.PSN_CD                      AS PSN_CD
<!-- START 2017/01/24 N.Arai [QC#17228, MOD] -->
<!--        ,TRIM(SP.PSN_FIRST_NM || ' ' || SP.PSN_MID_NM || ' ' || SP.PSN_LAST_NM) AS CORP_RESRC_NM    -->
            ,SP.PSN_FIRST_NM || NVL2(SP.PSN_MID_NM, ' ' || SP.PSN_MID_NM, '') || ' ' || SP.PSN_LAST_NM AS CORP_RESRC_NM
<!-- END 2017/01/24 N.Arai [QC#17228, MOD] -->
            ,OFRT.ORG_FUNC_ROLE_TP_NM       AS ORG_FUNC_ROLE_TP_NM
        FROM
             SVC_RG                 SR
            ,LINE_BIZ_TP            LBT
            ,AVAL_LINE_BIZ_TP_SRC   ALB
            ,SVC_RG_BR_RELN         SRBR
            ,SVC_CONTR_BR           SCB
            ,SVC_BR_RESRC_RELN      SBRR
            ,S21_PSN                SP
            ,ORG_FUNC_ROLE_TP       OFRT
        WHERE
                SR.GLBL_CMPY_CD                 = #glblCmpyCd#
            <isNotNull property="svcRgNm">
            AND SR.SVC_RG_NM                    LIKE #svcRgNm#
            </isNotNull>
            AND SR.SVC_RG_ACTV_FLG              = 'Y'
            AND SR.EFF_FROM_DT                  &lt;= #slsDt#
            AND NVL(SR.EFF_THRU_DT, #thruDtLimit#) &gt;= #slsDt#
            AND SR.EZCANCELFLAG                 = '0'
            AND LBT.GLBL_CMPY_CD                = SR.GLBL_CMPY_CD
            AND LBT.LINE_BIZ_TP_CD              = SR.SVC_LINE_BIZ_CD
<!-- START 2017/08/31 U.Kim [QC#20815, MOD] -->
<!--        <isNotNull property="svcLineBizDescTxt"> -->
            <isNotNull property="lineBizTpDescTxt">
<!-- END 2017/08/31 U.Kim [QC#20815, MOD] -->
            AND LBT.LINE_BIZ_TP_DESC_TXT        LIKE #lineBizTpDescTxt#
            </isNotNull>
            AND LBT.EZCANCELFLAG                = '0'
            AND LBT.GLBL_CMPY_CD                = ALB.GLBL_CMPY_CD
            AND LBT.LINE_BIZ_TP_CD              = ALB.LINE_BIZ_TP_CD
            AND ALB.SYS_SRC_CD                  = #sysSrcCd#
            AND ALB.EZCANCELFLAG                = '0'
            AND SRBR.GLBL_CMPY_CD               = SR.GLBL_CMPY_CD
            AND SRBR.SVC_RG_PK                  = SR.SVC_RG_PK
            <isNotNull property="svcContrBrCd">
            AND SRBR.SVC_CONTR_BR_CD            LIKE #svcContrBrCd#
            </isNotNull>
            AND SRBR.EZCANCELFLAG               = '0'
            AND SRBR.GLBL_CMPY_CD               = SCB.GLBL_CMPY_CD
            AND SRBR.SVC_CONTR_BR_CD            = SCB.SVC_CONTR_BR_CD
            <isNotNull property="svcContrBrDescTxt">
            AND SCB.SVC_CONTR_BR_DESC_TXT       LIKE #svcContrBrDescTxt#
            </isNotNull>
            AND SCB.SVC_CONTR_BR_ACTV_FLG       = 'Y'
            AND SCB.EFF_FROM_DT                 &lt;= #slsDt#
            AND NVL(SCB.EFF_THRU_DT, #thruDtLimit#) &gt;= #slsDt#
            AND SCB.EZCANCELFLAG                = '0'
            AND SCB.GLBL_CMPY_CD                = SBRR.GLBL_CMPY_CD
            AND SCB.SVC_CONTR_BR_CD             = SBRR.SVC_CONTR_BR_CD
            AND SBRR.SVC_BR_RESRC_ACTV_FLG      = 'Y'
            AND SBRR.EFF_FROM_DT                &lt;= #slsDt#
            AND NVL(SBRR.EFF_THRU_DT, #thruDtLimit#) &gt;= #slsDt#
            AND SBRR.EZCANCELFLAG               = '0'
            AND SBRR.GLBL_CMPY_CD               = SP.GLBL_CMPY_CD
            AND SBRR.PSN_CD                     = SP.PSN_CD
            <isNotNull property="xxGenlFldAreaTxt">
<!-- START 2017/01/24 N.Arai [QC#17228, MOD] -->
<!--        AND TRIM(SP.PSN_FIRST_NM || ' ' || SP.PSN_MID_NM || ' ' || SP.PSN_LAST_NM) LIKE #xxGenlFldAreaTxt#  -->
            AND SP.PSN_FIRST_NM || NVL2(SP.PSN_MID_NM, ' ' || SP.PSN_MID_NM, '') || ' ' || SP.PSN_LAST_NM LIKE #xxGenlFldAreaTxt#
            </isNotNull>
            <!-- START 2019/02/12 S.Kitamura [QC#30264, DEL] -->
            <!-- AND SP.PSN_TP_CD                    = #psnTpCd# -->
            <!-- END 2019/02/12 S.Kitamura [QC#30264, DEL] -->
<!-- END 2017/01/24 N.Arai [QC#17228, MOD] -->
            AND SP.EZCANCELFLAG                 = '0'
            AND SBRR.GLBL_CMPY_CD               = OFRT.GLBL_CMPY_CD
            AND SBRR.SVC_ORG_FUNC_ROLE_TP_CD    = OFRT.ORG_FUNC_ROLE_TP_CD
            AND OFRT.FIRST_ORG_CD               = #firstOrgCd#
            AND OFRT.EZCANCELFLAG               = '0'
            <!-- START 2018/02/02 K.Kojima [QC#23595,DEL] -->
            <!-- AND ROWNUM                          &lt;= #searchLimitCnt# -->
            <!-- END 2018/02/02 K.Kojima [QC#23595,DEL] -->
        ORDER BY
             SR.SVC_RG_NM
            ,SCB.SVC_CONTR_BR_CD
            <!-- START 2018/02/02 K.Kojima [QC#23595,ADD] -->
            ,OFRT.APVL_LIMIT_AMT DESC NULLS FIRST
            <!-- START 2018/02/02 K.Kojima [QC#23595,ADD] -->
            ,SBRR.PSN_CD
        <!-- START 2018/02/02 K.Kojima [QC#23595,ADD] -->
            )
        WHERE
            ROWNUM                          &lt;= #searchLimitCnt#
        <!-- END 2018/02/02 K.Kojima [QC#23595,ADD] -->
    </statement>

    <resultMap id="result.getSearchData"        class="NSAL0420_ASMsg">
        <result property="svcRgPk_A"            column="SVC_RG_PK"                 javaType="EZDSBigDecimalItem"/>
        <result property="svcRgNm_A"            column="SVC_RG_NM"                  javaType="EZDSStringItem"/>
        <result property="lineBizTpCd_A"        column="LINE_BIZ_TP_CD"             javaType="EZDSStringItem"/>
        <result property="lineBizTpDescTxt_A"   column="LINE_BIZ_TP_DESC_TXT"       javaType="EZDSStringItem"/>
        <result property="svcContrBrCd_A"       column="SVC_CONTR_BR_CD"            javaType="EZDSStringItem"/>
        <result property="svcContrBrDescTxt_A"  column="SVC_CONTR_BR_DESC_TXT"      javaType="EZDSStringItem"/>
        <result property="psnCd_A"              column="PSN_CD"                     javaType="EZDSStringItem"/>
        <result property="xxGenlFldAreaTxt_A"   column="CORP_RESRC_NM"              javaType="EZDSStringItem"/>
        <result property="orgFuncRoleTpNm_A"    column="ORG_FUNC_ROLE_TP_NM"        javaType="EZDSStringItem"/>
    </resultMap>

</sqlMap>
