<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NFAB003001">

<!-- #################### Type Alias #################### -->

<!-- #################### Statement #################### -->

   	<statement id="getIntfcTrxPtrn" parameterClass="Map" resultClass="Map">
        SELECT AMRI.SYS_SRC_CD AS SYS_SRC_CD,
               AMRI.TRX_CD     AS TRX_CD,         
               AMRI.TRX_RSN_CD AS TRX_RSN_CD
          FROM AJE_MDSE_RVAL_INTFC AMRI
         WHERE AMRI.EZCANCELFLAG = '0'
           AND AMRI.GLBL_CMPY_CD = #glblCmpyCd#
           AND NOT EXISTS (
                           SELECT '*'
                             FROM AJE_INTFC_CTRL      AIC
                            WHERE AIC.EZCANCELFLAG    = '0'
                              AND AIC.GLBL_CMPY_CD    = #glblCmpyCd#
                              AND AIC.AJE_INTFC_TP_CD = #ajeIntfcTpCd#
                              AND AIC.JRNL_CPLT_FLG   = #jrnlCpltFlg#
                              AND AIC.GLBL_CMPY_CD    = AMRI.GLBL_CMPY_CD
                              AND AIC.AJE_INTFC_PK    = AMRI.AJE_MDSE_RVAL_INTFC_PK
                          )
         GROUP BY AMRI.SYS_SRC_CD,
                  AMRI.TRX_CD,         
                  AMRI.TRX_RSN_CD
         ORDER BY AMRI.TRX_CD,         
                  AMRI.TRX_RSN_CD,
                  AMRI.SYS_SRC_CD
    </statement>

<statement id="getAjeMdseRvalIntfcNotJrnlized" parameterClass="Map" resultClass="Map">
        SELECT AMRI.GLBL_CMPY_CD                AS GLBL_CMPY_CD,
               AMRI.AJE_MDSE_RVAL_INTFC_PK      AS AJE_MDSE_RVAL_INTFC_PK,
               AMRI.GL_DT                       AS GL_DT,
               AMRI.SYS_SRC_CD                  AS SYS_SRC_CD,
               SS.SYS_SRC_NM                    AS SYS_SRC_NM,
               AMRI.TRX_CD                      AS TRX_CD,
               TRX.TRX_NM                       AS TRX_NM,
               AMRI.TRX_RSN_CD                  AS TRX_RSN_CD,
               TRX_RSN.TRX_RSN_NM               AS TRX_RSN_NM,
               AMRI.INVTY_SNAP_SHOT_PK          AS INVTY_SNAP_SHOT_PK,
               AMRI.INVTY_SNAP_SHOT_DT          AS INVTY_SNAP_SHOT_DT,
               AMRI.MDSE_CD                     AS MDSE_CD,
               MDSE.MDSE_NM                     AS MDSE_NM,
               AMRI.INVTY_LOC_CD                AS INVTY_LOC_CD,
               AMRI.LOC_STS_CD                  AS LOC_STS_CD,
               AMRI.STK_STS_CD                  AS STK_STS_CD,
               AMRI.MLY_CLO_YR_MTH              AS MLY_CLO_YR_MTH,
               AMRI.INVTY_QTY                   AS INVTY_QTY,
               AMRI.ASSET_CD                    AS ASSET_CD,
               AMRI.MDSE_OR_PRT_CD              AS MDSE_OR_PRT_CD,
               AMRI.WRT_DOWN_FLG                AS WRT_DOWN_FLG,
               AMRI.THIS_MTH_FOB_AMT            AS THIS_MTH_FOB_AMT,
               AMRI.THIS_MTH_INLND_FRT_AMT      AS THIS_MTH_INLND_FRT_AMT,
               AMRI.THIS_MTH_INTL_FRT_AMT       AS THIS_MTH_INTL_FRT_AMT,
               AMRI.THIS_MTH_IMPT_DTY_AMT       AS THIS_MTH_IMPT_DTY_AMT,
               AMRI.THIS_MTH_INS_AMT            AS THIS_MTH_INS_AMT,
               AMRI.THIS_MTH_TOT_STD_COST_AMT   AS THIS_MTH_TOT_STD_COST_AMT,
               AMRI.LAST_MTH_TOT_STD_COST_AMT   AS LAST_MTH_TOT_STD_COST_AMT,
               AMRI.NEXT_MTH_TOT_STD_COST_AMT   AS NEXT_MTH_TOT_STD_COST_AMT,
               AMRI.COST_CCY_CD                 AS COST_CCY_CD,
               CCY.ACCT_ARTH_TP_CD              AS ACCT_ARTH_TP_CD,
               CCY.ORCL_CCY_CD                  AS ORCL_CCY_CD,
               AMRI.RVAL_AMT                    AS RVAL_AMT,
               AMRI.TOT_RVAL_AMT                AS TOT_RVAL_AMT,
               AMRI.AJE_INTFC_CMNT_TXT          AS AJE_INTFC_CMNT_TXT,
               AMRI.MDSE_CATG_CD                AS MDSE_CATG_CD,
               MDSE.COA_PROD_CD                 AS COA_PROD_CD,
               
               -- at WH
               RW.COA_BR_CD                     AS "WH_BR_CD",
               
               -- at Item
               MDSE.COA_PROD_CD                 AS "ITEM_PROD_CD",
               MDSE.COA_MDSE_TP_CD              AS "ITEM_PROJ_CD",
               MDSE.COA_CC_CD                   AS "ITEM_CC_CD",
               
               -- CSA new
               AMRI.RTL_WH_CD                    AS RTL_WH_CD,
               AMRI.RTL_SWH_CD                   AS RTL_SWH_CD,
               AMRI.MDSE_CST_UPD_TP_CD           AS MDSE_CST_UPD_TP_CD,
               TO_CHAR(AMRI.MDSE_INVTY_COST_PCT) AS MDSE_INVTY_COST_PCT,
               
               CPA_WIP.COA_ACCT_CD               AS COA_ACCT_CD_WIP,
               CPA_CI.COA_ACCT_CD                AS COA_ACCT_CD_CI
          FROM AJE_MDSE_RVAL_INTFC  AMRI,
               SYS_SRC              SS,
               TRX                  TRX,
               TRX_RSN              TRX_RSN,
               MDSE_DLY_SNAP_SHOT   MDSE,
               CCY                  CCY,
               RTL_WH               RW,
               COA_PROJ_ACCT        CPA_WIP,
               COA_PROJ_ACCT        CPA_CI
         WHERE AMRI.EZCANCELFLAG        = '0'
           AND SS.EZCANCELFLAG          = '0'
           AND TRX.EZCANCELFLAG         = '0'
           AND TRX_RSN.EZCANCELFLAG     = '0'
           AND (MDSE.EZCANCELFLAG        = '0' OR MDSE.EZCANCELFLAG IS NULL)
           AND CCY.EZCANCELFLAG         = '0'
           AND CPA_WIP.EZCANCELFLAG(+)  = '0'
           AND CPA_CI.EZCANCELFLAG(+)   = '0'
           AND AMRI.GLBL_CMPY_CD        = #glblCmpyCd#
           AND AMRI.GLBL_CMPY_CD        = SS.GLBL_CMPY_CD
           AND AMRI.SYS_SRC_CD          = SS.SYS_SRC_CD
           AND TRX.GLBL_CMPY_CD         = TRX_RSN.GLBL_CMPY_CD
           AND TRX.TRX_CD               = TRX_RSN.TRX_CD
           AND AMRI.GLBL_CMPY_CD        = TRX.GLBL_CMPY_CD
           AND AMRI.TRX_CD              = TRX.TRX_CD
           AND AMRI.GLBL_CMPY_CD        = TRX_RSN.GLBL_CMPY_CD
           AND AMRI.TRX_RSN_CD          = TRX_RSN.TRX_RSN_CD
           AND AMRI.GLBL_CMPY_CD        = CCY.GLBL_CMPY_CD
           AND AMRI.GLBL_CMPY_CD        = MDSE.GLBL_CMPY_CD (+)
           AND AMRI.MDSE_CD             = MDSE.MDSE_CD (+)
           AND MDSE.LTST_REC_FLG        = #ltstRecFlg#
           AND AMRI.COST_CCY_CD         = CCY.CCY_CD
           AND AMRI.GLBL_CMPY_CD        = RW.GLBL_CMPY_CD
           AND AMRI.EZCANCELFLAG        = RW.EZCANCELFLAG
           AND AMRI.RTL_WH_CD           = RW.RTL_WH_CD
           AND MDSE.GLBL_CMPY_CD              = CPA_WIP.GLBL_CMPY_CD(+)
           AND MDSE.COA_MDSE_TP_CD            = CPA_WIP.COA_PROJ_CD(+)
           AND CPA_WIP.COA_PROJ_ACCT_TP_CD(+) = #coaProjAcctTp_WIP#
           AND MDSE.GLBL_CMPY_CD              = CPA_CI.GLBL_CMPY_CD(+)
           AND MDSE.COA_MDSE_TP_CD            = CPA_CI.COA_PROJ_CD(+)
           AND CPA_CI.COA_PROJ_ACCT_TP_CD(+)  = #coaProjAcctTp_CI#
           AND NOT EXISTS (
                           SELECT '*'
                             FROM AJE_INTFC_CTRL      AIC
                            WHERE AIC.EZCANCELFLAG    = '0'
                              AND AIC.GLBL_CMPY_CD    = #glblCmpyCd#
                              AND AIC.AJE_INTFC_TP_CD = #ajeIntfcTpCd#
                              AND AIC.JRNL_CPLT_FLG   = #jrnlCpltFlg#
                              AND AIC.GLBL_CMPY_CD    = AMRI.GLBL_CMPY_CD
                              AND AIC.AJE_INTFC_PK    = AMRI.AJE_MDSE_RVAL_INTFC_PK
                          )
         ORDER BY AMRI.INVTY_SNAP_SHOT_PK
    </statement>
    
    <statement id="back_getAjeMdseRvalIntfcNotJrnlized" parameterClass="Map" resultClass="Map">
        SELECT AMRI.GLBL_CMPY_CD                AS GLBL_CMPY_CD,
               AMRI.AJE_MDSE_RVAL_INTFC_PK      AS AJE_MDSE_RVAL_INTFC_PK,
               AMRI.GL_DT                       AS GL_DT,
               AMRI.SYS_SRC_CD                  AS SYS_SRC_CD,
               SS.SYS_SRC_NM                    AS SYS_SRC_NM,
               AMRI.TRX_CD                      AS TRX_CD,
               TRX.TRX_NM                       AS TRX_NM,
               AMRI.TRX_RSN_CD                  AS TRX_RSN_CD,
               TRX_RSN.TRX_RSN_NM               AS TRX_RSN_NM,
               AMRI.INVTY_SNAP_SHOT_PK          AS INVTY_SNAP_SHOT_PK,
               AMRI.INVTY_SNAP_SHOT_DT          AS INVTY_SNAP_SHOT_DT,
               AMRI.MDSE_CD                     AS MDSE_CD,
               MDSE.MDSE_NM                     AS MDSE_NM,
               AMRI.INVTY_LOC_CD                AS INVTY_LOC_CD,
               AMRI.LOC_STS_CD                  AS LOC_STS_CD,
               AMRI.STK_STS_CD                  AS STK_STS_CD,
               AMRI.MLY_CLO_YR_MTH              AS MLY_CLO_YR_MTH,
               AMRI.INVTY_QTY                   AS INVTY_QTY,
               AMRI.ASSET_CD                    AS ASSET_CD,
               AMRI.MDSE_OR_PRT_CD              AS MDSE_OR_PRT_CD,
               NVL(AMRI.COA_PROD_CD, #prodCdZZ#) AS COA_PROD_CD,
               NVL(CSPP.COA_BR_CD, CSPP_ANY.COA_BR_CD)  AS COA_BR_CD,
               NVL(CSPP.COA_CC_CD, CSPP_ANY.COA_CC_CD)  AS COA_CC_CD,
               NVL(CSPP.COA_CH_CD, CSPP_ANY.COA_CH_CD)  AS COA_CH_CD,
               AMRI.WRT_DOWN_FLG                AS WRT_DOWN_FLG,
               AMRI.THIS_MTH_FOB_AMT            AS THIS_MTH_FOB_AMT,
               AMRI.THIS_MTH_INLND_FRT_AMT      AS THIS_MTH_INLND_FRT_AMT,
               AMRI.THIS_MTH_INTL_FRT_AMT       AS THIS_MTH_INTL_FRT_AMT,
               AMRI.THIS_MTH_IMPT_DTY_AMT       AS THIS_MTH_IMPT_DTY_AMT,
               AMRI.THIS_MTH_INS_AMT            AS THIS_MTH_INS_AMT,
               AMRI.THIS_MTH_TOT_STD_COST_AMT   AS THIS_MTH_TOT_STD_COST_AMT,
               AMRI.LAST_MTH_TOT_STD_COST_AMT   AS LAST_MTH_TOT_STD_COST_AMT,
               AMRI.NEXT_MTH_TOT_STD_COST_AMT   AS NEXT_MTH_TOT_STD_COST_AMT,
               AMRI.COST_CCY_CD                 AS COST_CCY_CD,
               CCY.ACCT_ARTH_TP_CD              AS ACCT_ARTH_TP_CD,
               CCY.ORCL_CCY_CD                  AS ORCL_CCY_CD,
               AMRI.RVAL_AMT                    AS RVAL_AMT,
               AMRI.TOT_RVAL_AMT                AS TOT_RVAL_AMT,
               AMRI.AJE_INTFC_CMNT_TXT          AS AJE_INTFC_CMNT_TXT,
               AMRI.COA_ACCT_CD                 AS COA_ACCT_CD_MC,
               AMRI.MDSE_CATG_CD                AS MDSE_CATG_CD
          FROM AJE_MDSE_RVAL_INTFC  AMRI,
               SYS_SRC              SS,
               TRX                  TRX,
               TRX_RSN              TRX_RSN,
               MDSE_DLY_SNAP_SHOT   MDSE,
               (SELECT COA_BR_CD,
                       COA_CC_CD,
                       COA_CH_CD,
                       SYS_SRC_CD,
                       TRX_CD,
                       TRX_RSN_CD,
                       COA_PROD_CD
                  FROM COA_SEG_PROD_PTRN
                 WHERE EZCANCELFLAG        = '0'
                   AND GLBL_CMPY_CD        = #glblCmpyCd#
                   AND MDSE_OR_PRT_CD      = #mdseOrPrtCd#
               ) CSPP,
               (SELECT COA_BR_CD,
                       COA_CC_CD,
                       COA_CH_CD,
                       SYS_SRC_CD,
                       TRX_CD,
                       TRX_RSN_CD,
                       COA_PROD_CD,
                       FIRST_PROD_CTRL_CD
                  FROM COA_SEG_PROD_PTRN
                 WHERE EZCANCELFLAG        = '0'
                   AND GLBL_CMPY_CD        = #glblCmpyCd#
                   AND MDSE_OR_PRT_CD      = #mdseOrPrtCd#
                   AND COA_PROD_CD         = #anyProdCd#
               ) CSPP_ANY,
               CCY                  CCY
         WHERE AMRI.EZCANCELFLAG        = '0'
           AND SS.EZCANCELFLAG          = '0'
           AND TRX.EZCANCELFLAG         = '0'
           AND TRX_RSN.EZCANCELFLAG     = '0'
           AND (MDSE.EZCANCELFLAG        = '0' OR MDSE.EZCANCELFLAG IS NULL)
           AND CCY.EZCANCELFLAG         = '0'
           AND AMRI.GLBL_CMPY_CD        = #glblCmpyCd#
           AND AMRI.GLBL_CMPY_CD        = SS.GLBL_CMPY_CD
           AND AMRI.SYS_SRC_CD          = SS.SYS_SRC_CD
           AND TRX.GLBL_CMPY_CD         = TRX_RSN.GLBL_CMPY_CD
           AND TRX.TRX_CD               = TRX_RSN.TRX_CD
           AND AMRI.GLBL_CMPY_CD        = TRX.GLBL_CMPY_CD
           AND AMRI.TRX_CD              = TRX.TRX_CD
           AND AMRI.GLBL_CMPY_CD        = TRX_RSN.GLBL_CMPY_CD
           AND AMRI.TRX_RSN_CD          = TRX_RSN.TRX_RSN_CD
           AND AMRI.GLBL_CMPY_CD        = CCY.GLBL_CMPY_CD
           AND AMRI.GLBL_CMPY_CD        = MDSE.GLBL_CMPY_CD (+)
           AND AMRI.MDSE_CD             = MDSE.MDSE_CD (+)
           AND AMRI.SYS_SRC_CD          = CSPP.SYS_SRC_CD (+)
           AND AMRI.TRX_CD              = CSPP.TRX_CD (+)
           AND AMRI.TRX_RSN_CD          = CSPP.TRX_RSN_CD (+)
           AND AMRI.COA_PROD_CD         = CSPP.COA_PROD_CD (+)
           AND AMRI.SYS_SRC_CD          = CSPP_ANY.SYS_SRC_CD (+)
           AND AMRI.TRX_CD              = CSPP_ANY.TRX_CD (+)
           AND AMRI.TRX_RSN_CD          = CSPP_ANY.TRX_RSN_CD (+)
           AND SUBSTR(AMRI.COA_PROD_CD,1,1)  = CSPP_ANY.FIRST_PROD_CTRL_CD (+)
           AND AMRI.COST_CCY_CD         = CCY.CCY_CD
           AND NOT EXISTS (
                           SELECT '*'
                             FROM AJE_INTFC_CTRL      AIC
                            WHERE AIC.EZCANCELFLAG    = '0'
                              AND AIC.GLBL_CMPY_CD    = #glblCmpyCd#
                              AND AIC.AJE_INTFC_TP_CD = #ajeIntfcTpCd#
                              AND AIC.JRNL_CPLT_FLG   = #jrnlCpltFlg#
                              AND AIC.GLBL_CMPY_CD    = AMRI.GLBL_CMPY_CD
                              AND AIC.AJE_INTFC_PK    = AMRI.AJE_MDSE_RVAL_INTFC_PK
                          )
         ORDER BY AMRI.INVTY_SNAP_SHOT_PK
    </statement>

</sqlMap>	
