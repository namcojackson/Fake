<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NFAB040001">

<!-- #################### Type Alias #################### -->

<!-- #################### Statement #################### -->

     <statement id="getJrnlEntry" parameterClass="Map" resultClass="Map">
		SELECT 
		       GL_DT,
		       AJE_ID,
               JRNL_SRC_CD,
		       JRNL_CATG_CD,
		       JRNL_SRC_NM,
		       JRNL_CATG_NM,
		       COA_CMPY_CD,
		       COA_BR_CD,
		       COA_CC_CD,
		       COA_ACCT_CD,
		       COA_PROD_CD,
		       COA_CH_CD,
		       COA_AFFL_CD,
		       <!-- start add 2016/02/23 In S21, COA_PROJ_CD is Merchandise Type. When links to ARCS, it should be converted to 4 digits. -->
		       '00' || COA_PROJ_CD AS COA_PROJ_CD,
		       <!-- end 2016/02/23 -->
		       COA_EXTN_CD,
		       DEAL_CCY_CD,
		       EXCH_RATE,
               ACCT_ARTH_TP_CD,
		       JRNL_DEAL_DR_AMT,
		       JRNL_DEAL_CR_AMT,
		       JRNL_FUNC_DR_AMT,
		       JRNL_FUNC_CR_AMT,
		       ORCL_REF_10_TXT,
		       ORCL_ATTRB_11_TXT,
               <!-- start del 2017/10/12 QC#21413 -->
		       <!-- AJE_INTFC_CMNT_TXT, -->
               <!-- end 2017/10/12 -->
		       STD_CCY_CD,
               <!-- start del 2017/10/12 QC#21413 -->
		       <!-- TOC_CD, -->
               <!-- end 2017/10/12 -->
		       BILL_TO_CUST_CD
               <!-- start del 2017/10/12 QC#21413 -->
               <!--
		       MAN_JRNL_ENTRY_HDR_PK,
		       PSN_NUM
               -->
               <!-- end 2017/10/12 -->
		FROM
            (SELECT
                   JE.GL_DT                    AS GL_DT,
                   JE.AJE_ID                   AS AJE_ID,
                   JE.JRNL_SRC_CD              AS JRNL_SRC_CD,
                   JE.JRNL_CATG_CD             AS JRNL_CATG_CD,
                   MAX(JE.JRNL_SRC_NM)         AS JRNL_SRC_NM,
                   MAX(JE.JRNL_CATG_NM)        AS JRNL_CATG_NM,
                   JE.DR_COA_CMPY_CD           AS COA_CMPY_CD,
                   JE.DR_COA_BR_CD             AS COA_BR_CD,
                   JE.DR_COA_CC_CD             AS COA_CC_CD,
                   JE.DR_COA_ACCT_CD           AS COA_ACCT_CD,
                   JE.DR_COA_PROD_CD           AS COA_PROD_CD,
                   JE.DR_COA_CH_CD             AS COA_CH_CD,
                   JE.DR_COA_AFFL_CD           AS COA_AFFL_CD,
                   JE.DR_COA_PROJ_CD           AS COA_PROJ_CD,
                   JE.DR_COA_EXTN_CD           AS COA_EXTN_CD,
                   CCY.ORCL_CCY_CD              AS DEAL_CCY_CD,
                   JE.EXCH_RATE                AS EXCH_RATE,
                   CCY.ACCT_ARTH_TP_CD         AS ACCT_ARTH_TP_CD,
                   SUM(JE.JRNL_DEAL_DR_AMT)    AS JRNL_DEAL_DR_AMT,
                   0                           AS JRNL_DEAL_CR_AMT,
                   SUM(JE.JRNL_FUNC_DR_AMT)    AS JRNL_FUNC_DR_AMT,
                   0                           AS JRNL_FUNC_CR_AMT,
                   JE.ORCL_REF_10_TXT          AS ORCL_REF_10_TXT,
                   JE.ORCL_ATTRB_11_TXT        AS ORCL_ATTRB_11_TXT,
                   <!-- start del 2017/10/12 QC#21413 -->
                   <!-- JE.AJE_INTFC_CMNT_TXT       AS AJE_INTFC_CMNT_TXT, -->
                   <!-- end 2017/10/12 -->
		           SUM(JE.JRNL_FUNC_CR_AMT)+SUM(JE.JRNL_FUNC_DR_AMT)
		                                       AS SUM_JRNL_FUNC_AMT,
		           GC.STD_CCY_CD               AS STD_CCY_CD,
                   <!-- start del 2017/10/12 QC#21413 -->
                   <!-- JE.TOC_CD                   AS TOC_CD, -->
                   <!-- end 2017/10/12 -->
		           NULL                        AS BILL_TO_CUST_CD
                   <!-- start del 2017/10/12 QC#21413 -->
                   <!--
		           MAN_JRNL_ENTRY_HDR_PK       AS MAN_JRNL_ENTRY_HDR_PK,
		           NVL(SP.PSN_NUM, JE.TOC_CD)  AS PSN_NUM
                   -->
                   <!-- end 2017/10/12 -->
              FROM JRNL_ENTRY    JE,
                   CCY           CCY,
                   GLBL_CMPY     GC,
                   ORG_FUNC_ASG  OFA,
                   S21_PSN       SP
             WHERE JE.EZCANCELFLAG     = '0'
               AND CCY.EZCANCELFLAG    = '0'
               AND JE.GLBL_CMPY_CD     = #glblCmpyCd#
               AND JE.GL_SEND_CPLT_FLG = #glSendCpltFlg#
               AND CCY.GLBL_CMPY_CD    = #glblCmpyCd#
               AND JE.DEAL_CCY_CD      = CCY.CCY_CD
               AND GC.GLBL_CMPY_CD     = #glblCmpyCd#
               <!-- start 2016/08/01 ignore dummy entry which is created by manual journal entry screen -->
               AND JE.DR_COA_CMPY_CD IS NOT NULL
               <!-- end 2016/08/01 -->
               AND JE.GLBL_CMPY_CD     = OFA.GLBL_CMPY_CD (+)
               AND JE.TOC_CD           = OFA.TOC_CD (+)
               AND OFA.EFF_FROM_DT(+)  &lt;= JE.GL_DT
               AND NVL(OFA.EFF_THRU_DT(+),'99991231')   &gt;= JE.GL_DT
               AND OFA.EZCANCELFLAG(+) = '0'
               AND OFA.GLBL_CMPY_CD    = SP.GLBL_CMPY_CD (+)
               AND OFA.PSN_CD          = SP.PSN_CD (+)
               AND SP.EFF_FROM_DT(+)   &lt;= JE.GL_DT
               AND NVL(SP.EFF_THRU_DT(+),'99991231')   &gt;= JE.GL_DT
               AND SP.EZCANCELFLAG(+)  = '0'
             GROUP BY JE.GL_DT,
                      JE.AJE_ID,
                      JE.JRNL_SRC_CD,
                      JE.JRNL_CATG_CD,
                      JE.DR_COA_CMPY_CD,
                      JE.DR_COA_BR_CD,
                      JE.DR_COA_CC_CD,
                      JE.DR_COA_ACCT_CD,
                      JE.DR_COA_PROD_CD,
                      JE.DR_COA_CH_CD,
                      JE.DR_COA_AFFL_CD,
                      JE.DR_COA_PROJ_CD,
                      JE.DR_COA_EXTN_CD,
                      CCY.ORCL_CCY_CD,
                      JE.EXCH_RATE,
                      CCY.ACCT_ARTH_TP_CD,
                      JE.ORCL_REF_10_TXT,
                      JE.ORCL_ATTRB_11_TXT,
                      <!-- start del 2017/10/12 QC#21413 -->
                      <!-- JE.AJE_INTFC_CMNT_TXT, -->
                      <!-- end 2017/10/12 -->
                      GC.STD_CCY_CD
                      <!-- start del 2017/10/12 QC#21413 -->
                      <!-- 
                      JE.TOC_CD,
                      JE.MAN_JRNL_ENTRY_HDR_PK,
                      SP.PSN_NUM
                      -->
                      <!-- end 2017/10/12 -->
            UNION ALL
            SELECT
                   JE.GL_DT                     AS GL_DT,
                   JE.AJE_ID                    AS AJE_ID,
                   JE.JRNL_SRC_CD               AS JRNL_SRC_CD,
                   JE.JRNL_CATG_CD              AS JRNL_CATG_CD,
                   MAX(JE.JRNL_SRC_NM)          AS JRNL_SRC_NM,
                   MAX(JE.JRNL_CATG_NM)         AS JRNL_CATG_NM,
                   JE.CR_COA_CMPY_CD            AS COA_CMPY_CD,
                   JE.CR_COA_BR_CD              AS COA_BR_CD,
                   JE.CR_COA_CC_CD              AS COA_CC_CD,
                   JE.CR_COA_ACCT_CD            AS COA_ACCT_CD,
                   JE.CR_COA_PROD_CD            AS COA_PROD_CD,
                   JE.CR_COA_CH_CD              AS COA_CH_CD,
                   JE.CR_COA_AFFL_CD            AS COA_AFFL_CD,
                   JE.CR_COA_PROJ_CD            AS COA_PROJ_CD,
                   JE.CR_COA_EXTN_CD            AS COA_EXTN_CD,
                   CCY.ORCL_CCY_CD              AS DEAL_CCY_CD,
                   JE.EXCH_RATE                 AS EXCH_RATE,
                   CCY.ACCT_ARTH_TP_CD          AS ACCT_ARTH_TP_CD,
                   0                            AS JRNL_DEAL_DR_AMT,
                   SUM(JE.JRNL_DEAL_CR_AMT)     AS JRNL_DEAL_CR_AMT,
                   0                            AS JRNL_FUNC_DR_AMT,
                   SUM(JE.JRNL_FUNC_CR_AMT)     AS JRNL_FUNC_CR_AMT,
                   JE.ORCL_REF_10_TXT           AS ORCL_REF_10_TXT,
                   JE.ORCL_ATTRB_11_TXT         AS ORCL_ATTRB_11_TXT,
                   <!-- start del 2017/10/12 QC#21413 -->
                   <!-- JE.AJE_INTFC_CMNT_TXT        AS AJE_INTFC_CMNT_TXT, -->
                   <!-- end 2017/10/12 -->
		           SUM(JE.JRNL_FUNC_CR_AMT)+SUM(JE.JRNL_FUNC_DR_AMT)
		                                        AS SUM_JRNL_FUNC_AMT,
		           GC.STD_CCY_CD                AS STD_CCY_CD,
		           <!-- start del 2017/10/12 QC#21413 -->
		           <!-- JE.TOC_CD                    AS TOC_CD, -->
		           <!-- end 2017/10/12 -->
  		           NULL                         AS BILL_TO_CUST_CD
  		           <!-- start del 2017/10/12 QC#21413 -->
  		           <!-- 
  		           MAN_JRNL_ENTRY_HDR_PK       AS MAN_JRNL_ENTRY_HDR_PK,
  		           NVL(SP.PSN_NUM, JE.TOC_CD)  AS PSN_NUM
  		           -->
  		           <!-- end 2017/10/12 -->
               FROM JRNL_ENTRY JE,
                   CCY        CCY,
                   GLBL_CMPY  GC,
                   ORG_FUNC_ASG  OFA,
                   S21_PSN       SP
             WHERE JE.EZCANCELFLAG     = '0'
               AND CCY.EZCANCELFLAG    = '0'
               AND JE.GLBL_CMPY_CD     = #glblCmpyCd#
               AND JE.GL_SEND_CPLT_FLG = #glSendCpltFlg#
               AND CCY.GLBL_CMPY_CD    = #glblCmpyCd#
               AND JE.DEAL_CCY_CD      = CCY.CCY_CD
               AND GC.GLBL_CMPY_CD     = #glblCmpyCd#
               <!-- start 2016/08/01 ignore dummy entry which is created by manual journal entry screen -->
               AND JE.CR_COA_CMPY_CD IS NOT NULL
               <!-- end 2016/08/01 -->
               AND JE.GLBL_CMPY_CD     = OFA.GLBL_CMPY_CD (+)
               AND JE.TOC_CD           = OFA.TOC_CD (+)
               AND OFA.EFF_FROM_DT(+)  &lt;= JE.GL_DT
               AND NVL(OFA.EFF_THRU_DT(+),'99991231')   &gt;= JE.GL_DT
               AND OFA.EZCANCELFLAG(+) = '0'
               AND OFA.GLBL_CMPY_CD    = SP.GLBL_CMPY_CD (+)
               AND OFA.PSN_CD          = SP.PSN_CD (+)
               AND SP.EFF_FROM_DT(+)   &lt;= JE.GL_DT
               AND NVL(SP.EFF_THRU_DT(+),'99991231')   &gt;= JE.GL_DT
               AND SP.EZCANCELFLAG(+)  = '0'
             GROUP BY JE.GL_DT,
                      JE.AJE_ID,
                      JE.JRNL_SRC_CD,
                      JE.JRNL_CATG_CD,
                      JE.CR_COA_CMPY_CD,
                      JE.CR_COA_BR_CD,
                      JE.CR_COA_CC_CD,
                      JE.CR_COA_ACCT_CD,
                      JE.CR_COA_PROD_CD,
                      JE.CR_COA_CH_CD,
                      JE.CR_COA_AFFL_CD,
                      JE.CR_COA_PROJ_CD,
                      JE.CR_COA_EXTN_CD,
                      CCY.ORCL_CCY_CD,
                      JE.EXCH_RATE,
                      CCY.ACCT_ARTH_TP_CD,
                      JE.ORCL_REF_10_TXT,
                      JE.ORCL_ATTRB_11_TXT,
                      <!-- start del 2017/10/12 QC#21413 -->
                      <!-- JE.AJE_INTFC_CMNT_TXT, -->
                      <!-- end 2017/10/12 -->
                      GC.STD_CCY_CD
                      <!-- start del 2017/10/12 QC#21413 -->
                      <!-- 
                      JE.TOC_CD,
                      JE.MAN_JRNL_ENTRY_HDR_PK,
                      SP.PSN_NUM
                      -->
                      <!-- end 2017/10/12 -->
         )
		WHERE SUM_JRNL_FUNC_AMT != 0
    </statement>
    
    <statement id="back_getJrnlEntry" parameterClass="Map" resultClass="Map">
		SELECT 
		       GL_DT,
		       AJE_ID,
               JRNL_SRC_CD,
		       JRNL_CATG_CD,
		       JRNL_SRC_NM,
		       JRNL_CATG_NM,
		       COA_CMPY_CD,
		       COA_BR_CD,
		       COA_CC_CD,
		       COA_ACCT_CD,
		       COA_PROD_CD,
		       COA_CH_CD,
		       COA_AFFL_CD,
		       COA_PROJ_CD,
		       COA_EXTN_CD,
		       DEAL_CCY_CD,
		       EXCH_RATE,
               ACCT_ARTH_TP_CD,
		       JRNL_DEAL_DR_AMT,
		       JRNL_DEAL_CR_AMT,
		       JRNL_FUNC_DR_AMT,
		       JRNL_FUNC_CR_AMT,
		       ORCL_REF_10_TXT,
		       ORCL_ATTRB_11_TXT,
		       AJE_INTFC_CMNT_TXT,
		       STD_CCY_CD,
		       TOC_CD,
		       BILL_TO_CUST_CD
		FROM
            (SELECT
                   JE.GL_DT                    AS GL_DT,
                   JE.AJE_ID                   AS AJE_ID,
                   JE.JRNL_SRC_CD              AS JRNL_SRC_CD,
                   JE.JRNL_CATG_CD             AS JRNL_CATG_CD,
                   MAX(JE.JRNL_SRC_NM)         AS JRNL_SRC_NM,
                   MAX(JE.JRNL_CATG_NM)        AS JRNL_CATG_NM,
                   JE.DR_COA_CMPY_CD           AS COA_CMPY_CD,
                   JE.DR_COA_BR_CD             AS COA_BR_CD,
                   JE.DR_COA_CC_CD             AS COA_CC_CD,
                   JE.DR_COA_ACCT_CD           AS COA_ACCT_CD,
                   JE.DR_COA_PROD_CD           AS COA_PROD_CD,
                   JE.DR_COA_CH_CD             AS COA_CH_CD,
                   JE.DR_COA_AFFL_CD           AS COA_AFFL_CD,
                   JE.DR_COA_PROJ_CD           AS COA_PROJ_CD,
                   JE.DR_COA_EXTN_CD           AS COA_EXTN_CD,
                   CCY.ORCL_CCY_CD              AS DEAL_CCY_CD,
                   JE.EXCH_RATE                AS EXCH_RATE,
                   CCY.ACCT_ARTH_TP_CD         AS ACCT_ARTH_TP_CD,
                   SUM(JE.JRNL_DEAL_DR_AMT)    AS JRNL_DEAL_DR_AMT,
                   0                           AS JRNL_DEAL_CR_AMT,
                   SUM(JE.JRNL_FUNC_DR_AMT)    AS JRNL_FUNC_DR_AMT,
                   0                           AS JRNL_FUNC_CR_AMT,
                   JE.ORCL_REF_10_TXT          AS ORCL_REF_10_TXT,
                   JE.ORCL_ATTRB_11_TXT        AS ORCL_ATTRB_11_TXT,
                   JE.AJE_INTFC_CMNT_TXT       AS AJE_INTFC_CMNT_TXT,
		           SUM(JE.JRNL_FUNC_CR_AMT)+SUM(JE.JRNL_FUNC_DR_AMT)
		                                       AS SUM_JRNL_FUNC_AMT,
		           GC.STD_CCY_CD               AS STD_CCY_CD,
		           JE.TOC_CD                   AS TOC_CD,
		           NULL                        AS BILL_TO_CUST_CD
              FROM JRNL_ENTRY JE,
                   CCY        CCY,
                   GLBL_CMPY  GC
             WHERE JE.EZCANCELFLAG     = '0'
               AND CCY.EZCANCELFLAG    = '0'
               AND JE.GLBL_CMPY_CD     = #glblCmpyCd#
               AND JE.GL_SEND_CPLT_FLG = #glSendCpltFlg#
               AND CCY.GLBL_CMPY_CD    = #glblCmpyCd#
               AND JE.DEAL_CCY_CD      = CCY.CCY_CD
               AND GC.GLBL_CMPY_CD     = #glblCmpyCd#
               AND (DR_COA_ACCT_CD     NOT IN (#billToReqAcct1#, #billToReqAcct2#)
               AND  CR_COA_ACCT_CD     NOT IN (#billToReqAcct1#, #billToReqAcct2#))
             GROUP BY JE.GL_DT,
                      JE.AJE_ID,
                      JE.JRNL_SRC_CD,
                      JE.JRNL_CATG_CD,
                      JE.DR_COA_CMPY_CD,
                      JE.DR_COA_BR_CD,
                      JE.DR_COA_CC_CD,
                      JE.DR_COA_ACCT_CD,
                      JE.DR_COA_PROD_CD,
                      JE.DR_COA_CH_CD,
                      JE.DR_COA_AFFL_CD,
                      JE.DR_COA_PROJ_CD,
                      JE.DR_COA_EXTN_CD,
                      CCY.ORCL_CCY_CD,
                      JE.EXCH_RATE,
                      CCY.ACCT_ARTH_TP_CD,
                      JE.ORCL_REF_10_TXT,
                      JE.ORCL_ATTRB_11_TXT,
                      JE.AJE_INTFC_CMNT_TXT,
                      GC.STD_CCY_CD,
                      JE.TOC_CD
            UNION ALL
            SELECT
                   JE.GL_DT                     AS GL_DT,
                   JE.AJE_ID                    AS AJE_ID,
                   JE.JRNL_SRC_CD               AS JRNL_SRC_CD,
                   JE.JRNL_CATG_CD              AS JRNL_CATG_CD,
                   MAX(JE.JRNL_SRC_NM)          AS JRNL_SRC_NM,
                   MAX(JE.JRNL_CATG_NM)         AS JRNL_CATG_NM,
                   JE.CR_COA_CMPY_CD            AS COA_CMPY_CD,
                   JE.CR_COA_BR_CD              AS COA_BR_CD,
                   JE.CR_COA_CC_CD              AS COA_CC_CD,
                   JE.CR_COA_ACCT_CD            AS COA_ACCT_CD,
                   JE.CR_COA_PROD_CD            AS COA_PROD_CD,
                   JE.CR_COA_CH_CD              AS COA_CH_CD,
                   JE.CR_COA_AFFL_CD            AS COA_AFFL_CD,
                   JE.CR_COA_PROJ_CD            AS COA_PROJ_CD,
                   JE.CR_COA_EXTN_CD            AS COA_EXTN_CD,
                   CCY.ORCL_CCY_CD              AS DEAL_CCY_CD,
                   JE.EXCH_RATE                 AS EXCH_RATE,
                   CCY.ACCT_ARTH_TP_CD          AS ACCT_ARTH_TP_CD,
                   0                            AS JRNL_DEAL_DR_AMT,
                   SUM(JE.JRNL_DEAL_CR_AMT)     AS JRNL_DEAL_CR_AMT,
                   0                            AS JRNL_FUNC_DR_AMT,
                   SUM(JE.JRNL_FUNC_CR_AMT)     AS JRNL_FUNC_CR_AMT,
                   JE.ORCL_REF_10_TXT           AS ORCL_REF_10_TXT,
                   JE.ORCL_ATTRB_11_TXT         AS ORCL_ATTRB_11_TXT,
                   JE.AJE_INTFC_CMNT_TXT        AS AJE_INTFC_CMNT_TXT,
		           SUM(JE.JRNL_FUNC_CR_AMT)+SUM(JE.JRNL_FUNC_DR_AMT)
		                                        AS SUM_JRNL_FUNC_AMT,
		           GC.STD_CCY_CD                AS STD_CCY_CD,
		           JE.TOC_CD                    AS TOC_CD,
  		           NULL                         AS BILL_TO_CUST_CD
               FROM JRNL_ENTRY JE,
                   CCY        CCY,
                   GLBL_CMPY  GC
             WHERE JE.EZCANCELFLAG     = '0'
               AND CCY.EZCANCELFLAG    = '0'
               AND JE.GLBL_CMPY_CD     = #glblCmpyCd#
               AND JE.GL_SEND_CPLT_FLG = #glSendCpltFlg#
               AND CCY.GLBL_CMPY_CD    = #glblCmpyCd#
               AND JE.DEAL_CCY_CD      = CCY.CCY_CD
               AND GC.GLBL_CMPY_CD     = #glblCmpyCd#
               AND (DR_COA_ACCT_CD     NOT IN (#billToReqAcct1#, #billToReqAcct2#)
               AND  CR_COA_ACCT_CD     NOT IN (#billToReqAcct1#, #billToReqAcct2#)) 
             GROUP BY JE.GL_DT,
                      JE.AJE_ID,
                      JE.JRNL_SRC_CD,
                      JE.JRNL_CATG_CD,
                      JE.CR_COA_CMPY_CD,
                      JE.CR_COA_BR_CD,
                      JE.CR_COA_CC_CD,
                      JE.CR_COA_ACCT_CD,
                      JE.CR_COA_PROD_CD,
                      JE.CR_COA_CH_CD,
                      JE.CR_COA_AFFL_CD,
                      JE.CR_COA_PROJ_CD,
                      JE.CR_COA_EXTN_CD,
                      CCY.ORCL_CCY_CD,
                      JE.EXCH_RATE,
                      CCY.ACCT_ARTH_TP_CD,
                      JE.ORCL_REF_10_TXT,
                      JE.ORCL_ATTRB_11_TXT,
                      JE.AJE_INTFC_CMNT_TXT,
                      GC.STD_CCY_CD,
                      JE.TOC_CD
		 UNION ALL
		 SELECT
                   JE.GL_DT                    AS GL_DT,
                   JE.AJE_ID                   AS AJE_ID,
                   JE.JRNL_SRC_CD              AS JRNL_SRC_CD,
                   JE.JRNL_CATG_CD             AS JRNL_CATG_CD,
                   MAX(JE.JRNL_SRC_NM)         AS JRNL_SRC_NM,
                   MAX(JE.JRNL_CATG_NM)        AS JRNL_CATG_NM,
                   JE.DR_COA_CMPY_CD           AS COA_CMPY_CD,
                   JE.DR_COA_BR_CD             AS COA_BR_CD,
                   JE.DR_COA_CC_CD             AS COA_CC_CD,
                   JE.DR_COA_ACCT_CD           AS COA_ACCT_CD,
                   JE.DR_COA_PROD_CD           AS COA_PROD_CD,
                   JE.DR_COA_CH_CD             AS COA_CH_CD,
                   JE.DR_COA_AFFL_CD           AS COA_AFFL_CD,
                   JE.DR_COA_PROJ_CD           AS COA_PROJ_CD,
                   JE.DR_COA_EXTN_CD           AS COA_EXTN_CD,
                   CCY.ORCL_CCY_CD              AS DEAL_CCY_CD,
                   JE.EXCH_RATE                AS EXCH_RATE,
                   CCY.ACCT_ARTH_TP_CD         AS ACCT_ARTH_TP_CD,
                   SUM(JE.JRNL_DEAL_DR_AMT)    AS JRNL_DEAL_DR_AMT,
                   0                           AS JRNL_DEAL_CR_AMT,
                   SUM(JE.JRNL_FUNC_DR_AMT)    AS JRNL_FUNC_DR_AMT,
                   0                           AS JRNL_FUNC_CR_AMT,
                   JE.ORCL_REF_10_TXT          AS ORCL_REF_10_TXT,
                   JE.ORCL_ATTRB_11_TXT        AS ORCL_ATTRB_11_TXT,
                   JE.AJE_INTFC_CMNT_TXT       AS AJE_INTFC_CMNT_TXT,
		           SUM(JE.JRNL_FUNC_CR_AMT)+SUM(JE.JRNL_FUNC_DR_AMT)
		                                       AS SUM_JRNL_FUNC_AMT,
		           GC.STD_CCY_CD               AS STD_CCY_CD,
		           JE.TOC_CD                   AS TOC_CD,
		           JE.BILL_TO_CUST_CD          AS BILL_TO_CUST_CD
              FROM JRNL_ENTRY JE,
                   CCY        CCY,
                   GLBL_CMPY  GC
             WHERE JE.EZCANCELFLAG     = '0'
               AND CCY.EZCANCELFLAG    = '0'
               AND JE.GLBL_CMPY_CD     = #glblCmpyCd#
               AND JE.GL_SEND_CPLT_FLG = #glSendCpltFlg#
               AND CCY.GLBL_CMPY_CD    = #glblCmpyCd#
               AND JE.DEAL_CCY_CD      = CCY.CCY_CD
               AND GC.GLBL_CMPY_CD     = #glblCmpyCd#
               AND (DR_COA_ACCT_CD     IN (#billToReqAcct1#, #billToReqAcct2#)
                OR  CR_COA_ACCT_CD     IN (#billToReqAcct1#, #billToReqAcct2#))
             GROUP BY JE.GL_DT,
                      JE.AJE_ID,
                      JE.JRNL_SRC_CD,
                      JE.JRNL_CATG_CD,
                      JE.DR_COA_CMPY_CD,
                      JE.DR_COA_BR_CD,
                      JE.DR_COA_CC_CD,
                      JE.DR_COA_ACCT_CD,
                      JE.DR_COA_PROD_CD,
                      JE.DR_COA_CH_CD,
                      JE.DR_COA_AFFL_CD,
                      JE.DR_COA_PROJ_CD,
                      JE.DR_COA_EXTN_CD,
                      CCY.ORCL_CCY_CD,
                      JE.EXCH_RATE,
                      CCY.ACCT_ARTH_TP_CD,
                      JE.ORCL_REF_10_TXT,
                      JE.ORCL_ATTRB_11_TXT,
                      JE.AJE_INTFC_CMNT_TXT,
                      GC.STD_CCY_CD,
                      JE.TOC_CD,
                      JE.BILL_TO_CUST_CD
            UNION ALL
            SELECT
                   JE.GL_DT                     AS GL_DT,
                   JE.AJE_ID                    AS AJE_ID,
                   JE.JRNL_SRC_CD               AS JRNL_SRC_CD,
                   JE.JRNL_CATG_CD              AS JRNL_CATG_CD,
                   MAX(JE.JRNL_SRC_NM)          AS JRNL_SRC_NM,
                   MAX(JE.JRNL_CATG_NM)         AS JRNL_CATG_NM,
                   JE.CR_COA_CMPY_CD            AS COA_CMPY_CD,
                   JE.CR_COA_BR_CD              AS COA_BR_CD,
                   JE.CR_COA_CC_CD              AS COA_CC_CD,
                   JE.CR_COA_ACCT_CD            AS COA_ACCT_CD,
                   JE.CR_COA_PROD_CD            AS COA_PROD_CD,
                   JE.CR_COA_CH_CD              AS COA_CH_CD,
                   JE.CR_COA_AFFL_CD            AS COA_AFFL_CD,
                   JE.CR_COA_PROJ_CD            AS COA_PROJ_CD,
                   JE.CR_COA_EXTN_CD            AS COA_EXTN_CD,
                   CCY.ORCL_CCY_CD              AS DEAL_CCY_CD,
                   JE.EXCH_RATE                 AS EXCH_RATE,
                   CCY.ACCT_ARTH_TP_CD          AS ACCT_ARTH_TP_CD,
                   0                            AS JRNL_DEAL_DR_AMT,
                   SUM(JE.JRNL_DEAL_CR_AMT)     AS JRNL_DEAL_CR_AMT,
                   0                            AS JRNL_FUNC_DR_AMT,
                   SUM(JE.JRNL_FUNC_CR_AMT)     AS JRNL_FUNC_CR_AMT,
                   JE.ORCL_REF_10_TXT           AS ORCL_REF_10_TXT,
                   JE.ORCL_ATTRB_11_TXT         AS ORCL_ATTRB_11_TXT,
                   JE.AJE_INTFC_CMNT_TXT        AS AJE_INTFC_CMNT_TXT,
		           SUM(JE.JRNL_FUNC_CR_AMT)+SUM(JE.JRNL_FUNC_DR_AMT)
		                                        AS SUM_JRNL_FUNC_AMT,
		           GC.STD_CCY_CD                AS STD_CCY_CD,
		           JE.TOC_CD                    AS TOC_CD,
		           JE.BILL_TO_CUST_CD          AS BILL_TO_CUST_CD
               FROM JRNL_ENTRY JE,
                   CCY        CCY,
                   GLBL_CMPY  GC
             WHERE JE.EZCANCELFLAG     = '0'
               AND CCY.EZCANCELFLAG    = '0'
               AND JE.GLBL_CMPY_CD     = #glblCmpyCd#
               AND JE.GL_SEND_CPLT_FLG = #glSendCpltFlg#
               AND CCY.GLBL_CMPY_CD    = #glblCmpyCd#
               AND JE.DEAL_CCY_CD      = CCY.CCY_CD
               AND GC.GLBL_CMPY_CD     = #glblCmpyCd#
               AND (DR_COA_ACCT_CD     IN (#billToReqAcct1#, #billToReqAcct2#)
                OR  CR_COA_ACCT_CD     IN (#billToReqAcct1#, #billToReqAcct2#)) 
             GROUP BY JE.GL_DT,
                      JE.AJE_ID,
                      JE.JRNL_SRC_CD,
                      JE.JRNL_CATG_CD,
                      JE.CR_COA_CMPY_CD,
                      JE.CR_COA_BR_CD,
                      JE.CR_COA_CC_CD,
                      JE.CR_COA_ACCT_CD,
                      JE.CR_COA_PROD_CD,
                      JE.CR_COA_CH_CD,
                      JE.CR_COA_AFFL_CD,
                      JE.CR_COA_PROJ_CD,
                      JE.CR_COA_EXTN_CD,
                      CCY.ORCL_CCY_CD,
                      JE.EXCH_RATE,
                      CCY.ACCT_ARTH_TP_CD,
                      JE.ORCL_REF_10_TXT,
                      JE.ORCL_ATTRB_11_TXT,
                      JE.AJE_INTFC_CMNT_TXT,
                      GC.STD_CCY_CD,
                      JE.TOC_CD,
                      JE.BILL_TO_CUST_CD
		)
		WHERE SUM_JRNL_FUNC_AMT != 0
    </statement>

	<statement id="getAJEErrorCount" parameterClass="Map" resultClass="Integer">
		SELECT count(*) AS CNT
		  FROM AJE_INTFC_CTRL
		 WHERE EZCANCELFLAG  = '0'
		   AND GLBL_CMPY_CD  = #glblCmpyCd#
		   AND JRNL_CPLT_FLG = #jrnlCpltFlgN#
	</statement>
	
	<statement id="getAJEErrors" parameterClass="Map" resultClass="Map">
		SELECT AJE_INTFC_TP_CD, 
		       SYS_SRC_CD,
		       TRX_CD,
		       TRX_RSN_CD
		  FROM AJE_INTFC_CTRL
		 WHERE EZCANCELFLAG  = '0'
		   AND GLBL_CMPY_CD  = #glblCmpyCd#
		   AND JRNL_CPLT_FLG = #jrnlCpltFlgN#
	  GROUP BY AJE_INTFC_TP_CD, SYS_SRC_CD, TRX_CD, TRX_RSN_CD
	  ORDER BY AJE_INTFC_TP_CD
	</statement>
	
	<statement id="getPartsVariance" parameterClass="Map" resultClass="BigDecimal">
		SELECT SUM(NVL(PRT_INVTY_END_AMT,0)) - 
		       (SUM(NVL(PRT_INVTY_OPEN_AMT,0)) + SUM(NVL(RVAL_AMT,0))
		     + SUM(NVL(SHIP_IN_AMT,0)) - SUM(NVL(SHIP_OUT_AMT,0))
		       ) AS VARIANCE
		  FROM DLY_AJE_RPT_PRT_INVTY
		 WHERE EZCANCELFLAG  = '0'
		   AND GLBL_CMPY_CD  = #glblCmpyCd#
		   AND GL_DT         = #glDt#
		   AND COA_PROD_CD   IS NULL
	</statement>
	
	<!-- mod 2016/02/23 variance amount is calculated by batch and set to VAR_AMT -->
	<statement id="getMDSEVariance" parameterClass="Map" resultClass="BigDecimal">
		SELECT VAR_AMT AS VARIANCE
		  FROM DLY_AJE_RPT_INVTY
		 WHERE EZCANCELFLAG  = '0'
		   AND GLBL_CMPY_CD  = #glblCmpyCd#
		   AND GL_DT         = #glDt#
		   AND COA_PROD_CD   IS NULL
	</statement>
	
	<statement id="back_getMDSEVariance" parameterClass="Map" resultClass="BigDecimal">
		SELECT SUM(NVL(INVTY_END_AMT,0)) - 
		       (SUM(NVL(INVTY_OPEN_AMT,0)) + SUM(NVL(RVAL_AMT,0))
		     + SUM(NVL(SHIP_IN_AMT,0)) - SUM(NVL(SHIP_OUT_AMT,0))
		       ) AS VARIANCE
		  FROM DLY_AJE_RPT_INVTY
		 WHERE EZCANCELFLAG  = '0'
		   AND GLBL_CMPY_CD  = #glblCmpyCd#
		   AND GL_DT         = #glDt#
		   AND COA_PROD_CD   IS NULL
	</statement>

</sqlMap>	
