<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NMAB496001">

    <statement id="getPostDelta" parameterClass="Map" resultClass="Map">
<!-- QC#15947 Del Start
      SELECT CASE WHEN W.GLBL_CMPY_CD IS NULL THEN 'I' ELSE 'C' END AS DELTA_TP
           , V.POST_PK
           , V.POST_CD
           , V.CTY_ADDR
           , V.ST_CD
        FROM CSA_POST_V V
           , POST W
       WHERE V.GLBL_CMPY_CD = #cusaGlblCmpyCd#
         AND V.EZCANCELFLAG = '0'
         AND W.GLBL_CMPY_CD(+) = #glblCmpyCd#
         AND W.POST_PK(+) = V.POST_PK
         AND NOT EXISTS(
                 SELECT 1
                   FROM POST A
                  WHERE A.GLBL_CMPY_CD = #glblCmpyCd#
                    AND A.EZCANCELFLAG = '0'
                    AND A.POST_PK = V.POST_PK
             )
     UNION ALL
      SELECT 'U' AS DELTA_TP
           , V.POST_PK
           , V.POST_CD
           , V.CTY_ADDR
           , V.ST_CD
        FROM CSA_POST_V V
           , POST A
       WHERE V.GLBL_CMPY_CD = #cusaGlblCmpyCd#
         AND V.EZCANCELFLAG = '0'
         AND A.GLBL_CMPY_CD = #glblCmpyCd#
         AND A.EZCANCELFLAG = '0'
         AND A.POST_PK = V.POST_PK
         AND (
             RTRIM(A.POST_CD) != RTRIM(V.POST_CD)
          OR RTRIM(A.CTY_ADDR) != RTRIM(V.CTY_ADDR)
          OR RTRIM(A.ST_CD) != RTRIM(V.ST_CD)
         )
     UNION ALL
      SELECT 'D' AS DELTA_TP
           , A.POST_PK
           , A.POST_CD
           , A.CTY_ADDR
           , A.ST_CD
        FROM POST A
       WHERE A.GLBL_CMPY_CD = #glblCmpyCd#
         AND A.EZCANCELFLAG = '0'
         AND NOT EXISTS(
                 SELECT 1
                   FROM CSA_POST_V V
                  WHERE V.GLBL_CMPY_CD = #cusaGlblCmpyCd#
                    AND V.EZCANCELFLAG = '0'
                    AND V.POST_PK = A.POST_PK
             )
     QC#15947 Del End -->
<!-- QC#15947 Add Start -->
    WITH POST_V AS (
                    SELECT
                        V.POST_PK
                       ,V.POST_CD
                       ,V.CTY_ADDR
                       ,V.ST_CD
                    FROM
                        CSA_POST_V V
                    WHERE
                        V.GLBL_CMPY_CD     = #cusaGlblCmpyCd#
                        AND V.EZCANCELFLAG = '0'
                   )
    SELECT
       <!-- QC#18481 Add Start -->
       'C'           AS DELTA_TP
       <!-- QC#18481 Add End -->
       ,V.POST_PK
       ,V.POST_CD
       ,V.CTY_ADDR
       ,V.ST_CD
    FROM
        POST_V V
       ,POST   POST
    WHERE
        POST.GLBL_CMPY_CD(+)     = #glblCmpyCd#
        AND POST.POST_PK(+)      = V.POST_PK
        AND POST.EZCANCELFLAG(+) = '0'
        AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            POST P
                        WHERE
                            P.GLBL_CMPY_CD     = #glblCmpyCd#
                            AND P.POST_PK      = V.POST_PK
                            AND P.EZCANCELFLAG = '0'
                       )

    UNION ALL

    SELECT
        'U' AS DELTA_TP
       ,V.POST_PK
       ,V.POST_CD
       ,V.CTY_ADDR
       ,V.ST_CD
    FROM
        POST_V V
       ,POST   POST
    WHERE
        POST.GLBL_CMPY_CD     = #glblCmpyCd#
        AND POST.POST_PK      = V.POST_PK
        AND POST.EZCANCELFLAG = '0'
        AND (
             RTRIM(POST.POST_CD)     != RTRIM(V.POST_CD)
             OR RTRIM(POST.CTY_ADDR) != RTRIM(V.CTY_ADDR)
             OR RTRIM(POST.ST_CD)    != RTRIM(V.ST_CD)
            )

    UNION ALL

    SELECT
        'D' AS DELTA_TP
       ,POST.POST_PK
       ,POST.POST_CD
       ,POST.CTY_ADDR
       ,POST.ST_CD
    FROM
        POST POST
    WHERE
        POST.GLBL_CMPY_CD     = #glblCmpyCd#
        AND POST.EZCANCELFLAG = '0'
        AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            POST_V V
                        WHERE
                            V.POST_PK = POST.POST_PK
                       )
<!-- QC#15947 Add End -->
    </statement>

    <statement id="getCntyPostRelnDelta" parameterClass="Map" resultClass="Map">
<!-- QC#15947 Del Start
      SELECT CASE WHEN W.GLBL_CMPY_CD IS NULL THEN 'I' ELSE 'C' END AS DELTA_TP
           , V.CNTY_PK
           , V.POST_PK
           , V.GEO_CD
        FROM CSA_CNTY_POST_RELN_V V
           , CNTY_POST_RELN W
       WHERE V.GLBL_CMPY_CD = #cusaGlblCmpyCd#
         AND V.EZCANCELFLAG = '0'
         AND W.GLBL_CMPY_CD(+) = #glblCmpyCd#
         AND W.CNTY_PK(+) = V.CNTY_PK
         AND W.POST_PK(+) = V.POST_PK
         AND NOT EXISTS(
                 SELECT 1
                   FROM CNTY_POST_RELN A
                  WHERE A.GLBL_CMPY_CD = #glblCmpyCd#
                    AND A.EZCANCELFLAG = '0'
                    AND A.CNTY_PK = V.CNTY_PK
                    AND A.POST_PK = V.POST_PK
             )
     UNION ALL
      SELECT 'U' AS DELTA_TP
           , V.CNTY_PK
           , V.POST_PK
           , V.GEO_CD
        FROM CSA_CNTY_POST_RELN_V V
           , CNTY_POST_RELN A
       WHERE V.GLBL_CMPY_CD = #cusaGlblCmpyCd#
         AND V.EZCANCELFLAG = '0'
         AND A.GLBL_CMPY_CD = #glblCmpyCd#
         AND A.EZCANCELFLAG = '0'
         AND A.CNTY_PK = V.CNTY_PK
         AND A.POST_PK = V.POST_PK
         AND (
             RTRIM(A.GEO_CD) != RTRIM(V.GEO_CD)
         )
     UNION ALL
      SELECT 'D' AS DELTA_TP
           , A.CNTY_PK
           , A.POST_PK
           , A.GEO_CD
        FROM CNTY_POST_RELN A
       WHERE A.GLBL_CMPY_CD = #glblCmpyCd#
         AND A.EZCANCELFLAG = '0'
         AND NOT EXISTS(
                 SELECT 1
                   FROM CSA_CNTY_POST_RELN_V V
                  WHERE V.GLBL_CMPY_CD = #cusaGlblCmpyCd#
                    AND V.EZCANCELFLAG = '0'
                    AND V.CNTY_PK = A.CNTY_PK
                    AND V.POST_PK = A.POST_PK
             )
     QC#15947 Del End -->
<!-- QC#15947 Add Start -->
    WITH CNTY_POST_RELN_V AS (
                              SELECT
                                  V.POST_PK
                                 ,V.CNTY_PK
                                 ,V.GEO_CD
                              FROM
                                  CSA_CNTY_POST_RELN_V V
                              WHERE
                                  V.GLBL_CMPY_CD     = #cusaGlblCmpyCd#
                                  AND V.EZCANCELFLAG = '0'
                             )
    SELECT
       <!-- QC#18481 Add Start -->
       'C'           AS DELTA_TP
       <!-- QC#18481 Add End -->
       ,V.CNTY_PK
       ,V.POST_PK
       ,V.GEO_CD
    FROM
        CNTY_POST_RELN_V V
       ,CNTY_POST_RELN   POST
    WHERE
        POST.GLBL_CMPY_CD(+)     = #glblCmpyCd#
        AND POST.CNTY_PK(+)      = V.CNTY_PK
        AND POST.POST_PK(+)      = V.POST_PK
        AND POST.EZCANCELFLAG(+) = '0'
        AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            CNTY_POST_RELN P
                        WHERE
                            P.GLBL_CMPY_CD     = #glblCmpyCd#
                            AND P.CNTY_PK      = V.CNTY_PK
                            AND P.POST_PK      = V.POST_PK
                            AND P.EZCANCELFLAG = '0'
                       )

    UNION ALL

    SELECT
        'U' AS DELTA_TP
       ,V.CNTY_PK
       ,V.POST_PK
       ,V.GEO_CD
    FROM
        CNTY_POST_RELN_V V
       ,CNTY_POST_RELN   POST
    WHERE
        POST.GLBL_CMPY_CD       = #glblCmpyCd#
        AND POST.CNTY_PK        = V.CNTY_PK
        AND POST.POST_PK        = V.POST_PK
        AND RTRIM(POST.GEO_CD) != RTRIM(V.GEO_CD)
        AND POST.EZCANCELFLAG   = '0'

    UNION ALL

    SELECT
        'D' AS DELTA_TP
       ,POST.CNTY_PK
       ,POST.POST_PK
       ,POST.GEO_CD
    FROM
        CNTY_POST_RELN POST
    WHERE
        POST.GLBL_CMPY_CD     = #glblCmpyCd#
        AND POST.EZCANCELFLAG = '0'
        AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            CNTY_POST_RELN_V V
                        WHERE
                            V.CNTY_PK     = POST.CNTY_PK
                            AND V.POST_PK = POST.POST_PK
                       )
<!-- QC#15947 Add End -->
    </statement>

    <statement id="getCntyDelta" parameterClass="Map" resultClass="Map">
<!-- QC#15947 Del Start
      SELECT CASE WHEN W.GLBL_CMPY_CD IS NULL THEN 'I' ELSE 'C' END AS DELTA_TP
           , V.CNTY_PK
           , V.CNTY_NM
           , V.ST_CD
        FROM CSA_CNTY_V V
           , CNTY W
       WHERE V.GLBL_CMPY_CD = #cusaGlblCmpyCd#
         AND V.EZCANCELFLAG = '0'
         AND W.GLBL_CMPY_CD(+) = #glblCmpyCd#
         AND W.CNTY_PK(+) = V.CNTY_PK
         AND NOT EXISTS(
                 SELECT 1
                   FROM CNTY A
                  WHERE A.GLBL_CMPY_CD = #glblCmpyCd#
                    AND A.EZCANCELFLAG = '0'
                    AND A.CNTY_PK = V.CNTY_PK
             )
     UNION ALL
      SELECT 'U' AS DELTA_TP
           , V.CNTY_PK
           , V.CNTY_NM
           , V.ST_CD
        FROM CSA_CNTY_V V
           , CNTY A
       WHERE V.GLBL_CMPY_CD = #cusaGlblCmpyCd#
         AND V.EZCANCELFLAG = '0'
         AND A.GLBL_CMPY_CD = #glblCmpyCd#
         AND A.EZCANCELFLAG = '0'
         AND A.CNTY_PK = V.CNTY_PK
         AND (
             RTRIM(A.CNTY_NM) != RTRIM(V.CNTY_NM)
          OR RTRIM(A.ST_CD) != RTRIM(V.ST_CD)
         )
     UNION ALL
      SELECT 'D' AS DELTA_TP
           , A.CNTY_PK
           , A.CNTY_NM
           , A.ST_CD
        FROM CNTY A
       WHERE A.GLBL_CMPY_CD = #glblCmpyCd#
         AND A.EZCANCELFLAG = '0'
         AND NOT EXISTS(
                 SELECT 1
                   FROM CSA_CNTY_V V
                  WHERE V.GLBL_CMPY_CD = #cusaGlblCmpyCd#
                    AND V.EZCANCELFLAG = '0'
                    AND V.CNTY_PK = A.CNTY_PK
             )
     QC#15947 Del End -->
<!-- QC#15947 Add Start -->
    WITH CNTY_V AS (
                    SELECT
                        V.CNTY_PK
                       ,V.CNTY_NM
                       ,V.ST_CD
                    FROM
                        CSA_CNTY_V V
                    WHERE
                        V.GLBL_CMPY_CD     = #cusaGlblCmpyCd#
                        AND V.EZCANCELFLAG = '0'
                   )
    SELECT
       <!-- QC#18481 Add Start -->
       'C'           AS DELTA_TP
       <!-- QC#18481 Add End -->
       ,V.CNTY_PK
       ,V.CNTY_NM
       ,V.ST_CD
    FROM
        CNTY_V V
       ,CNTY   CNTY
    WHERE
        CNTY.GLBL_CMPY_CD(+)     = #glblCmpyCd#
        AND CNTY.CNTY_PK(+)      = V.CNTY_PK
        AND CNTY.EZCANCELFLAG(+) = '0'
        AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            CNTY C
                        WHERE
                            C.GLBL_CMPY_CD     = #glblCmpyCd#
                            AND C.CNTY_PK      = V.CNTY_PK
                            AND C.EZCANCELFLAG = '0'
                       )

    UNION ALL

    SELECT
        'U' AS DELTA_TP
       ,V.CNTY_PK
       ,V.CNTY_NM
       ,V.ST_CD
    FROM
        CNTY_V V
       ,CNTY   CNTY
    WHERE
        CNTY.GLBL_CMPY_CD = #glblCmpyCd#
        AND CNTY.CNTY_PK  = V.CNTY_PK
        AND (
             RTRIM(CNTY.CNTY_NM)  != RTRIM(V.CNTY_NM)
             OR RTRIM(CNTY.ST_CD) != RTRIM(V.ST_CD)
            )
        AND CNTY.EZCANCELFLAG = '0'

    UNION ALL

    SELECT
        'D' AS DELTA_TP
       ,CNTY.CNTY_PK
       ,CNTY.CNTY_NM
       ,CNTY.ST_CD
    FROM
        CNTY CNTY
    WHERE
        CNTY.GLBL_CMPY_CD     = #glblCmpyCd#
        AND CNTY.EZCANCELFLAG = '0'
        AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            CNTY_V V
                        WHERE
                            V.CNTY_PK = CNTY.CNTY_PK
                       )
<!-- QC#15947 Add End -->
    </statement>

</sqlMap>
