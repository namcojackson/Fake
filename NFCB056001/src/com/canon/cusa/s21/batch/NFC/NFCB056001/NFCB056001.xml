<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NFCB056001">

<statement id="getTargetData" parameterClass="Map">

  SELECT CCT.CR_CARD_TRX_PK
        ,CCT.CR_CARD_AUTH_REF_NUM
        ,NVL(CCT.BILL_TO_CUST_ACCT_CD, ATB.BILL_TO_CUST_ACCT_CD) AS BILL_TO_CUST_ACCT_CD 
        ,CCT.CR_CARD_SETL_DT
        ,CCT.CR_CARD_AUTH_AMT
        ,ATB.AR_TRX_BAL_PK
        ,ATB.AR_TRX_NUM
        ,ATB.GRP_INV_NUM
        ,ATB.DEAL_RMNG_BAL_GRS_AMT
        ,ATB.DEAL_ORIG_GRS_AMT
    FROM CR_CARD_TRX               CCT
        ,AR_TRX_BAL                ATB
   WHERE CCT.GLBL_CMPY_CD           = #glblCmpyCd#
     AND CCT.EZCANCELFLAG           = '0'
     AND CCT.GLBL_CMPY_CD           = ATB.GLBL_CMPY_CD
     AND CCT.EZCANCELFLAG           = ATB.EZCANCELFLAG
     AND CCT.CR_CARD_TRX_TP_CD      = #crCardTrxTp#
     AND CCT.CR_CARD_SETL_DT        IS NOT NULL
     AND CCT.CR_CARD_AUTH_STS_CD    = #crAuthStsCd#
     AND CCT.FIRST_TRX_INFO_TXT     = ATB.AR_TRX_NUM
     AND ATB.AR_TRX_TP_CD           &lt;&gt; #rcp#
     AND NOT EXISTS
          (SELECT '*'
             FROM AR_CR_CARD_TRX_INTFC_MNG MNG
            WHERE MNG.GLBL_CMPY_CD = CCT.GLBL_CMPY_CD
              AND MNG.CR_CARD_TRX_PK = CCT.CR_CARD_TRX_PK
          )
   ORDER BY CCT.BILL_TO_CUST_ACCT_CD

</statement>

<statement id="getSumOfTargetData" parameterClass="Map" resultClass="Map">

  SELECT SUM(CCT.CR_CARD_AUTH_AMT) AS CR_CARD_AUTH_AMT
        ,COUNT(*)                  AS CNT
    FROM CR_CARD_TRX               CCT
        ,AR_TRX_BAL                ATB
   WHERE CCT.GLBL_CMPY_CD       = #glblCmpyCd#
     AND CCT.EZCANCELFLAG       = '0'
     AND CCT.GLBL_CMPY_CD       = ATB.GLBL_CMPY_CD
     AND CCT.EZCANCELFLAG       = ATB.EZCANCELFLAG
     AND CCT.CR_CARD_TRX_TP_CD  = #crCardTrxTp#
     AND CCT.CR_CARD_SETL_DT IS NOT NULL
     AND CCT.FIRST_TRX_INFO_TXT = ATB.AR_TRX_NUM
     AND ATB.AR_TRX_TP_CD       &lt;&gt; #rcp#
     AND NOT EXISTS
          (SELECT '*'
             FROM AR_CR_CARD_TRX_INTFC_MNG MNG
            WHERE MNG.GLBL_CMPY_CD = CCT.GLBL_CMPY_CD
              AND MNG.CR_CARD_TRX_PK = CCT.CR_CARD_TRX_PK
          )

</statement>

</sqlMap>