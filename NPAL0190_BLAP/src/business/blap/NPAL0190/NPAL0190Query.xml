<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPAL0190Query">
<!-- 01/25/2016 CSA Update START
    <typeAlias alias="ASMsg" type="business.blap.NPAL0190.NPAL0190_ASMsg"/>

    <statement id="getBizProcLog" parameterClass="Map" resultMap="result.getBizProcLog">
    SELECT
        BL.EVENT_ID                   EVENT_ID
      , BE.EVENT_NM                   EVENT_NM
      , BL.EZUPTIME                   EZUPTIME
      , BL.DOC_ID                     DOC_ID
      , BL.EZUPUSERID                 EZUPUSERID
      , PS.PO_STS_NM                  BIZ_PROC_CMNT_TXT_01
      , BL.BIZ_PROC_CMNT_TXT_02       BIZ_PROC_CMNT_TXT_02
      , BL.BIZ_PROC_CMNT_TXT_03       BIZ_PROC_CMNT_TXT_03
      , BL.BIZ_PROC_LOG_PK            BIZ_PROC_LOG_PK
    FROM
        BIZ_PROC_LOG BL
      , BIZ_EVENT BE
      , PO_STS PS
    WHERE
        BL.DOC_TP_CD            = #docTpCd#
    AND BL.PROC_ID              = #procId#
    AND BL.PRNT_DOC_ID          = #poOrdNum#
    AND BL.EZCANCELFLAG         = '0'
    AND BE.GLBL_CMPY_CD(+)      = #glblCmpyCd#
    AND BL.PROC_ID              = BE.PROC_ID(+)
    AND BL.EVENT_ID             = BE.EVENT_ID(+)
    AND BE.EZCANCELFLAG(+)      = '0'
    AND PS.GLBL_CMPY_CD(+)      = #glblCmpyCd#
    AND BL.BIZ_PROC_CMNT_TXT_01 = PS.PO_STS_CD(+)
    AND PS.EZCANCELFLAG(+) = '0'
    AND ROWNUM         &lt;= #ROWNUM#
    ORDER BY
        BL.EZUPTIME
      , BL.DOC_ID
      , PS.PO_STS_SORT_NUM
    </statement>

    <resultMap id="result.getBizProcLog" class="ASMsg">
        <result property="eventId"      column="EVENT_ID"               javaType="EZDSStringItem"/>
        <result property="eventNm"      column="EVENT_NM"               javaType="EZDSStringItem"/>
        <result property="ezUpTime"     column="EZUPTIME"               javaType="EZDSStringItem"/>
        <result property="docId"        column="DOC_ID"                 javaType="EZDSStringItem"/>
        <result property="ezUpUserID"   column="EZUPUSERID"             javaType="EZDSStringItem"/>
        <result property="poStsNm"      column="BIZ_PROC_CMNT_TXT_01"   javaType="EZDSStringItem"/>
        <result property="poQty"        column="BIZ_PROC_CMNT_TXT_02"   javaType="EZDSBigDecimalItem"/>
        <result property="poBalQty"     column="BIZ_PROC_CMNT_TXT_03"   javaType="EZDSBigDecimalItem"/>
        <result property="bizProcLogPk" column="BIZ_PROC_LOG_PK"        javaType="EZDSBigDecimalItem"/>
    </resultMap>
 01/25/2016 CSA Update END -->
 
 <statement id="getBizProcLog" parameterClass="Map">
     SELECT
         EVENT_ID
         , PO_BIZ_PROC_LOG_UPD_TS
         , PO_SUBMT_PSN_CD
         , PO_HDR_STS_DESC_TXT
         , PO_APVL_STS_DESC_TXT
         , DISP_PO_DTL_LINE_NUM
         , PO_LINE_STS_DESC_TXT
         , MDSE_CD
         , ASL_MDSE_CD
         , MDSE_DESC_SHORT_TXT
         , ENT_DEAL_NET_UNIT_PRC_AMT
         , PO_DISP_QTY
         , PKG_UOM_CLS_DESC_TXT
         , ENT_PO_DTL_DEAL_NET_AMT
         , RQST_RCV_DT
         , SRC_RTL_WH_CD
         , SRC_RTL_SWH_CD
         , DEST_RTL_WH_CD
         , DEST_RTL_SWH_CD
         , SHIP_TO_CUST_CD
         , SHIP_TO_LOC_NM
         , PO_MATCH_TP_DESC_TXT
         , PO_RCV_QTY
         , PO_CANC_QTY
         , PO_INV_QTY
         , FROM_STK_STS_DESC_TXT
         , TO_STK_STS_DESC_TXT
         , SER_NUM_LIST_TXT
         , CHRG_COA_XXXX_CD
         , ACRL_COA_XXXX_CD
         , VAR_COA_XXXX_CD
         , PO_ORD_DTL_CMNT_TXT
     FROM (
        SELECT
            PBRL.EVENT_ID
            , PBRL.PO_BIZ_PROC_LOG_UPD_TS
            , PBRL.PO_SUBMT_PSN_CD
            , PHS.PO_HDR_STS_DESC_TXT
            , PAS.PO_APVL_STS_DESC_TXT
            , PBRL.DISP_PO_DTL_LINE_NUM
            , PLS.PO_LINE_STS_DESC_TXT
            <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
            --, PBRL.MDSE_CD
            , DECODE(
                   DMI.MDSE_ITEM_TP_CD
                 , #mdseItemTpCdTextItem#
                 , NULL
                 , PBRL.MDSE_CD
              ) MDSE_CD
            <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
            , PBRL.ASL_MDSE_CD
            <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
            --, DMI.MDSE_DESC_SHORT_TXT
            , DECODE(
                   DMI.MDSE_ITEM_TP_CD
                 , #mdseItemTpCdTextItem#
                 , PD.MDSE_DESC_SHORT_TXT
                 , DMI.MDSE_DESC_SHORT_TXT
              ) MDSE_DESC_SHORT_TXT
            <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
            , PBRL.ENT_DEAL_NET_UNIT_PRC_AMT
            , PBRL.PO_DISP_QTY
            , PBRL.PO_DISP_UOM_CD AS PKG_UOM_CLS_DESC_TXT
            , PBRL.ENT_PO_DTL_DEAL_NET_AMT
            , PBRL.RQST_RCV_DT
            , PBRL.SRC_RTL_WH_CD
            , PBRL.SRC_RTL_SWH_CD
            , PBRL.DEST_RTL_WH_CD
            , PBRL.DEST_RTL_SWH_CD
            , PBRL.SHIP_TO_CUST_CD
            , PBRL.SHIP_TO_LOC_NM
            , PMT.PO_MATCH_TP_DESC_TXT
            , PBRL.PO_RCV_QTY
            , PBRL.PO_CANC_QTY
            , PBRL.PO_INV_QTY
            , FROM_STK_STS.STK_STS_DESC_TXT AS FROM_STK_STS_DESC_TXT
            , TO_STK_STS.STK_STS_DESC_TXT AS TO_STK_STS_DESC_TXT
            , PBRL.SER_NUM_LIST_TXT
            , PBRL.CHRG_COA_CMPY_CD || '.' || PBRL.CHRG_COA_BR_CD || '.' || PBRL.CHRG_COA_CC_CD || '.' || PBRL.CHRG_COA_ACCT_CD || '.' || PBRL.CHRG_COA_PROD_CD || '.' || PBRL.CHRG_COA_CH_CD || '.' || PBRL.CHRG_COA_AFFL_CD || '.' || PBRL.CHRG_COA_PROJ_CD || '.' || PBRL.CHRG_COA_EXTN_CD AS CHRG_COA_XXXX_CD
            , PBRL.ACRL_COA_CMPY_CD || '.' || PBRL.ACRL_COA_BR_CD || '.' || PBRL.ACRL_COA_CC_CD || '.' || PBRL.ACRL_COA_ACCT_CD || '.' || PBRL.ACRL_COA_PROD_CD || '.' || PBRL.ACRL_COA_CH_CD || '.' || PBRL.ACRL_COA_AFFL_CD || '.' || PBRL.ACRL_COA_PROJ_CD || '.' || PBRL.ACRL_COA_EXTN_CD AS ACRL_COA_XXXX_CD
            , PBRL.VAR_COA_CMPY_CD || '.' || PBRL.VAR_COA_BR_CD || '.' || PBRL.VAR_COA_CC_CD || '.' || PBRL.VAR_COA_ACCT_CD || '.' || PBRL.VAR_COA_PROD_CD || '.' || PBRL.VAR_COA_CH_CD || '.' || PBRL.VAR_COA_AFFL_CD || '.' || PBRL.VAR_COA_PROJ_CD || '.' || PBRL.VAR_COA_EXTN_CD AS VAR_COA_XXXX_CD
            , PBRL.PO_ORD_DTL_CMNT_TXT
        FROM
            PO_BIZ_PROC_LOG PBRL
            , PO_HDR_STS PHS
            , PO_APVL_STS PAS
            , PO_LINE_STS PLS
            , PO_STS PS_H
            , PO_STS PS_D
            , PO_MATCH_TP PMT
            , STK_STS FROM_STK_STS
            , STK_STS TO_STK_STS
            , MDSE DMI
            <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
            , PO_DTL PD
            <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
        WHERE
            -- JOIN TO PO_BIZ_PROC_LOG
            PBRL.GLBL_CMPY_CD = #glblCmpyCd#
            AND PBRL.EZCANCELFLAG = '0'
            AND PBRL.PO_ORD_NUM = #poOrdNum#
            -- LEFT JOIN TO PO_HDR_STS
            AND PBRL.GLBL_CMPY_CD = PHS.GLBL_CMPY_CD(+)
            AND PHS.EZCANCELFLAG(+) = '0'
            AND PBRL.PO_HDR_STS_CD = PHS.PO_HDR_STS_CD(+)
            -- LEFT JOIN TO PO_APVL_STS
            AND PBRL.GLBL_CMPY_CD = PAS.GLBL_CMPY_CD(+)
            AND PAS.EZCANCELFLAG(+) = '0'
            AND PBRL.PO_APVL_STS_CD = PAS.PO_APVL_STS_CD(+)
            -- LEFT JOIN TO PO_LINE_STS
            AND PBRL.GLBL_CMPY_CD = PLS.GLBL_CMPY_CD(+)
            AND PLS.EZCANCELFLAG(+) = '0'
            AND PBRL.PO_LINE_STS_CD = PLS.PO_LINE_STS_CD(+)
            -- LEFT JOIN TO PO_STS H
            AND PBRL.GLBL_CMPY_CD = PS_H.GLBL_CMPY_CD(+)
            AND PS_H.EZCANCELFLAG(+) = '0'
            AND PBRL.HDR_PO_STS_CD = PS_H.PO_STS_CD(+)
            -- LEFT JOIN TO PO_STS D
            AND PBRL.GLBL_CMPY_CD = PS_D.GLBL_CMPY_CD(+)
            AND PS_D.EZCANCELFLAG(+) = '0'
            AND PBRL.DTL_PO_STS_CD = PS_D.PO_STS_CD(+)
            -- LEFT JOIN PO_MATCH_TP
            AND PBRL.GLBL_CMPY_CD = PMT.GLBL_CMPY_CD(+)
            AND PMT.EZCANCELFLAG(+) = '0'
            AND PBRL.PO_MATCH_TP_CD = PMT.PO_MATCH_TP_CD(+)
            -- LEFT JOIN FROM_STK_STS
            AND PBRL.GLBL_CMPY_CD = FROM_STK_STS.GLBL_CMPY_CD(+)
            AND FROM_STK_STS.EZCANCELFLAG(+) = '0'
            AND PBRL.FROM_STK_STS_CD = FROM_STK_STS.STK_STS_CD(+)
            -- LEFT JOIN TO_STK_STS
            AND PBRL.GLBL_CMPY_CD = TO_STK_STS.GLBL_CMPY_CD(+)
            AND TO_STK_STS.EZCANCELFLAG(+) = '0'
            AND PBRL.TO_STK_STS_CD = TO_STK_STS.STK_STS_CD(+)
            -- LEFT JOIN MDSE
            AND PBRL.GLBL_CMPY_CD = DMI.GLBL_CMPY_CD(+)
            AND DMI.EZCANCELFLAG(+) = '0'
            AND PBRL.MDSE_CD = DMI.MDSE_CD(+)
            <isNotNull property="poDispLineNum">
            AND PBRL.PO_ORD_DTL_LINE_NUM = #poDispLineNum#
            </isNotNull>
            <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
            AND PBRL.GLBL_CMPY_CD = PD.GLBL_CMPY_CD(+)
            AND PBRL.PO_ORD_NUM = PD.PO_ORD_NUM(+)
            AND PBRL.PO_ORD_DTL_LINE_NUM = PD.PO_ORD_DTL_LINE_NUM(+)
            AND PBRL.DISP_PO_DTL_LINE_NUM = PD.DISP_PO_DTL_LINE_NUM(+)
            AND PD.EZCANCELFLAG(+) = '0'
            <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
        ORDER BY
            PBRL.PO_ORD_NUM ASC
            <isNotNull property="poDispLineNum">
            , PBRL.PO_ORD_DTL_LINE_NUM ASC
            </isNotNull>
            , PO_BIZ_PROC_LOG_UPD_TS DESC
            , PS_H.PO_STS_SORT_NUM DESC
            , PS_D.PO_STS_SORT_NUM DESC
        )
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>
</sqlMap>
