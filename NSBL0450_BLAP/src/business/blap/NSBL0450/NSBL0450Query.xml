<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSBL0450Query">
    <typeAlias alias="NSBL0450_ASMsg"                   type="business.blap.NSBL0450.NSBL0450_ASMsg"/>

    <statement id="getMainData" parameterClass="Map" resultMap="result.getMainData">
        SELECT
            SVC_SUPPL_TASK_NUM
            ,SVC_SUPPL_TASK_TP_CD
            ,SVC_SUPPL_TASK_TP_DESC_TXT
            ,TECH_CD
            ,TECH_PSN_NM
            ,MGR_NM
            ,XX_CMNT_TXT
            ,SVC_SUPPL_FROM_DT
            ,TO_CHAR(TO_DATE(SVC_SUPPL_FROM_DT, #dtFormat#),#dlFormat#) AS SVC_SUPPL_FROM_DT_DL
            ,SVC_SUPPL_FROM_TM
            ,SVC_SUPPL_TO_DT
            ,TO_CHAR(TO_DATE(SVC_SUPPL_TO_DT, #dtFormat#),#dlFormat#) AS SVC_SUPPL_TO_DT_DL
            ,SVC_SUPPL_TO_TM
            ,SVC_SUPPL_FROM_DT||SVC_SUPPL_FROM_TM AS START_TS
            ,SVC_SUPPL_TO_DT||SVC_SUPPL_TO_TM AS END_TS
            ,SVC_TRVL_TM_NUM
            ,SVC_SUPPL_TM_NUM
            ,DURN_TM_NUM
<!-- START 2017/07/14 K.Kim [QC#19067, MOD] -->
            <!-- ,CRAT_PSN_NM -->
            ,CASE WHEN CRAT_PSN_NM_TMP1 IS NULL THEN CRAT_PSN_NM_TMP2 END CRAT_PSN_NM
<!-- END 2017/07/14 K.Kim [QC#19067, MOD] -->
            ,CRAT_DT
            ,CRAT_TM
<!-- START 2017/07/14 K.Kim [QC#19067, MOD] -->
            <!-- ,UPD_PSN_NM -->
            ,CASE WHEN UPD_PSN_NM_TMP1 IS NULL THEN UPD_PSN_NM_TMP2 END UPD_PSN_NM
<!-- END 2017/07/14 K.Kim [QC#19067, MOD] -->
            ,UPD_DT
            ,UPD_TM
            ,SVC_SUPPL_TASK_STS_CD
            ,SVC_TASK_NUM
            ,ROWNUM AS XX_ROW_NUM
            ,'N' AS SUBMIT_FLG
            ,EZUPTIME
            ,EZUPTIMEZONE
            ,SVC_SUPPL_FROM_TM_WK
            ,SVC_SUPPL_TO_TM_WK
            ,CRAT_TM_WK
            ,UPD_TM_WK
        FROM
        (
            SELECT
                SUP.SVC_SUPPL_TASK_NUM
                ,SUP.SVC_SUPPL_TASK_TP_CD
                ,STP.SVC_SUPPL_TASK_TP_DESC_TXT
                ,SUP.TECH_CD
                ,TPN.PSN_FIRST_NM
                     || CASE WHEN TPN.PSN_MID_NM IS NOT NULL THEN ' '  || TPN.PSN_MID_NM END
                     || CASE WHEN TPN.PSN_LAST_NM IS NOT NULL THEN ' ' || TPN.PSN_LAST_NM END TECH_PSN_NM
                ,MPN.PSN_FIRST_NM
                     || CASE WHEN MPN.PSN_MID_NM IS NOT NULL THEN ' '  || MPN.PSN_MID_NM END
                     || CASE WHEN MPN.PSN_LAST_NM IS NOT NULL THEN ' ' || MPN.PSN_LAST_NM END MGR_NM
                ,CASE WHEN STP.SVC_ITRPT_FLG = 'Y' THEN #categoryY#
                      ELSE #categoryN# END AS XX_CMNT_TXT
                ,SUP.SVC_SUPPL_FROM_DT
                ,CASE WHEN LENGTH(SUP.SVC_SUPPL_FROM_TM)>0 THEN  SUBSTR(SUP.SVC_SUPPL_FROM_TM,0,2)||':'|| SUBSTR(SUP.SVC_SUPPL_FROM_TM,3,2)
                      ELSE NULL END AS SVC_SUPPL_FROM_TM
                ,SUP.SVC_SUPPL_TO_DT
                ,CASE WHEN LENGTH(SUP.SVC_SUPPL_TO_TM)>0 THEN  SUBSTR(SUP.SVC_SUPPL_TO_TM,0,2)||':'|| SUBSTR(SUP.SVC_SUPPL_TO_TM,3,2)
                      ELSE NULL END AS SVC_SUPPL_TO_TM
                ,CASE WHEN SUP.SVC_TRVL_TM_NUM IS NULL  THEN NULL
                      WHEN SUP.SVC_TRVL_TM_NUM >= #maxMinute# THEN #maxTime#
                      ELSE TO_CHAR(TRUNC(SUP.SVC_TRVL_TM_NUM/#minute#),#pad00#)||':'||TO_CHAR(MOD(SUP.SVC_TRVL_TM_NUM,#minute#),#pad00#) END SVC_TRVL_TM_NUM
                ,CASE WHEN SUP.SVC_SUPPL_TM_NUM IS NULL  THEN NULL
                      WHEN SUP.SVC_SUPPL_TM_NUM >= #maxMinute# THEN #maxTime#
                      ELSE TO_CHAR(TRUNC(SUP.SVC_SUPPL_TM_NUM/#minute#),#pad00#)||':'||TO_CHAR(MOD(SUP.SVC_SUPPL_TM_NUM,#minute#),#pad00#) END SVC_SUPPL_TM_NUM
                ,CASE WHEN SUP.DURN_TM_NUM IS NULL  THEN NULL
                      WHEN SUP.DURN_TM_NUM >= #maxMinute# THEN #maxTime#
                      ELSE TO_CHAR(TRUNC(SUP.DURN_TM_NUM/#minute#),#pad00#)||':'||TO_CHAR(MOD(SUP.DURN_TM_NUM,#minute#),#pad00#) END DURN_TM_NUM
                ,CPN.FIRST_NM
                     || CASE WHEN CPN.MID_NM IS NOT NULL THEN ' '  || CPN.MID_NM END
                     || CASE WHEN CPN.LAST_NM IS NOT NULL THEN ' ' || CPN.LAST_NM END CRAT_PSN_NM_TMP1
                ,SUP.CRAT_DT
                ,TO_CHAR(TO_DATE(SUP.CRAT_TM,#timeFormatPre#),#timeFormat#)AS  CRAT_TM
                ,UPN.FIRST_NM
                     || CASE WHEN UPN.MID_NM IS NOT NULL THEN ' '  || UPN.MID_NM END
                     || CASE WHEN UPN.LAST_NM IS NOT NULL THEN ' ' || UPN.LAST_NM END UPD_PSN_NM_TMP1
                ,SUP.UPD_DT
                ,TO_CHAR(TO_DATE(SUP.UPD_TM,#timeFormatPre#),#timeFormat#)AS  UPD_TM
                ,SUP.SVC_SUPPL_TASK_STS_CD
                ,SUP.SVC_TASK_NUM
                ,SUP.EZUPTIME
                ,SUP.EZUPTIMEZONE
                ,SUP.SVC_SUPPL_FROM_TM AS SVC_SUPPL_FROM_TM_WK
                ,SUP.SVC_SUPPL_TO_TM   AS SVC_SUPPL_TO_TM_WK
                ,SUP.CRAT_TM           AS CRAT_TM_WK
                ,SUP.UPD_TM            AS UPD_TM_WK
<!-- START 2017/07/14 K.Kim [QC#19067, ADD] -->
                ,CPN2.PSN_FIRST_NM
                     || CASE WHEN CPN2.PSN_MID_NM IS NOT NULL THEN ' '  || CPN2.PSN_MID_NM END
                     || CASE WHEN CPN2.PSN_LAST_NM IS NOT NULL THEN ' ' || CPN2.PSN_LAST_NM END CRAT_PSN_NM_TMP2
                ,UPN2.PSN_FIRST_NM
                     || CASE WHEN UPN2.PSN_MID_NM IS NOT NULL THEN ' '  || UPN2.PSN_MID_NM END
                     || CASE WHEN UPN2.PSN_LAST_NM IS NOT NULL THEN ' ' || UPN2.PSN_LAST_NM END UPD_PSN_NM_TMP2
<!-- END 2017/07/14 K.Kim [QC#19067, ADD] -->
            FROM
                SVC_SUPPL_TASK      SUP
                ,SVC_SUPPL_TASK_TP  STP
                ,S21_PSN            TPN
                ,S21_PSN            MPN
                ,AUTH_PSN           CPN
                ,AUTH_PSN           UPN
<!-- START 2017/07/14 K.Kim [QC#19067, ADD] -->
                ,S21_PSN            CPN2
                ,S21_PSN            UPN2
<!-- END 2017/07/14 K.Kim [QC#19067, ADD] -->
            WHERE
                SUP.GLBL_CMPY_CD             = #glblCmpyCd#
                AND SUP.EZCANCELFLAG         = '0'
                AND SUP.GLBL_CMPY_CD         = STP.GLBL_CMPY_CD
                AND SUP.SVC_SUPPL_TASK_TP_CD = STP.SVC_SUPPL_TASK_TP_CD
                AND SUP.EZCANCELFLAG         = STP.EZCANCELFLAG
                AND SUP.GLBL_CMPY_CD         = TPN.GLBL_CMPY_CD(+)
                AND SUP.TECH_CD              = TPN.PSN_CD(+)
                AND SUP.EZCANCELFLAG         = TPN.EZCANCELFLAG(+)
                AND SUP.GLBL_CMPY_CD         = MPN.GLBL_CMPY_CD(+)
                AND SUP.TECH_MGR_CD          = MPN.PSN_CD(+)
                AND SUP.EZCANCELFLAG         = MPN.EZCANCELFLAG(+)
                AND SUP.GLBL_CMPY_CD         = CPN.GLBL_CMPY_CD(+)
                AND SUP.CRAT_PSN_CD          = CPN.USR_NM(+)
                AND SUP.EZCANCELFLAG         = CPN.EZCANCELFLAG(+)
                AND SUP.GLBL_CMPY_CD         = UPN.GLBL_CMPY_CD(+)
                AND SUP.UPD_PSN_CD           = UPN.USR_NM(+)
                AND SUP.EZCANCELFLAG         = UPN.EZCANCELFLAG(+)
                <isNotNull property="svcSupplTaskNum">
                AND SUP.SVC_SUPPL_TASK_NUM   LIKE #svcSupplTaskNum# 
                </isNotNull>
                <isNotNull property="svcSupplTaskTpCd">
                AND SUP.SVC_SUPPL_TASK_TP_CD = #svcSupplTaskTpCd#
                </isNotNull>
                <isNotNull property="cratDt">
                AND SUP.CRAT_DT              = #cratDt#
                </isNotNull>
                <isNotNull property="techPsnNm">
                AND (TPN.PSN_FIRST_NM
                     || CASE WHEN TPN.PSN_MID_NM IS NOT NULL THEN ' '  || TPN.PSN_MID_NM END
                     || CASE WHEN TPN.PSN_LAST_NM IS NOT NULL THEN ' ' || TPN.PSN_LAST_NM END) LIKE #techPsnNm#
                </isNotNull>
                <isNotNull property="mgrNm">
                AND (MPN.PSN_FIRST_NM
                     || CASE WHEN MPN.PSN_MID_NM IS NOT NULL THEN ' '  || MPN.PSN_MID_NM END
                     || CASE WHEN MPN.PSN_LAST_NM IS NOT NULL THEN ' ' || MPN.PSN_LAST_NM END) LIKE #mgrNm#
                </isNotNull>
<!-- START 2017/07/14 K.Kim [QC#19067, ADD] -->
                AND SUP.GLBL_CMPY_CD         = CPN2.GLBL_CMPY_CD(+)
                AND SUP.CRAT_PSN_CD          = CPN2.PSN_CD(+)
                AND SUP.EZCANCELFLAG         = CPN2.EZCANCELFLAG(+)
                AND SUP.GLBL_CMPY_CD         = UPN2.GLBL_CMPY_CD(+)
                AND SUP.UPD_PSN_CD           = UPN2.PSN_CD(+)
                AND SUP.EZCANCELFLAG         = UPN2.EZCANCELFLAG(+)
<!-- END 2017/07/14 K.Kim [QC#19067, ADD] -->
            ORDER BY
                SUP.TECH_CD
                ,SUP.SVC_SUPPL_FROM_DT
                ,SUP.SVC_SUPPL_FROM_TM
            )
        WHERE
            ROWNUM &lt;= #limitNum#

    </statement>
    <resultMap id="result.getMainData"        class="NSBL0450_ASMsg">
        <result property="svcSupplTaskNum_A"                column="SVC_SUPPL_TASK_NUM"             javaType="EZDSStringItem"/>
        <result property="svcSupplTaskTpDescTxt_A"          column="SVC_SUPPL_TASK_TP_DESC_TXT"     javaType="EZDSStringItem"/>
        <result property="techCd_A"                         column="TECH_CD"                        javaType="EZDSStringItem"/>
        <result property="techPsnNm_A"                      column="TECH_PSN_NM"                    javaType="EZDSStringItem"/>
        <result property="mgrNm_A"                          column="MGR_NM"                         javaType="EZDSStringItem"/>
        <result property="xxCmntTxt_A"                      column="XX_CMNT_TXT"                    javaType="EZDSStringItem"/>
        <result property="svcSupplFromDt_A"                 column="SVC_SUPPL_FROM_DT"              javaType="EZDSDateItem"/>
        <result property="xxDtTm_A1"                        column="SVC_SUPPL_FROM_TM"              javaType="EZDSStringItem"/>
        <result property="svcSupplToDt_A"                   column="SVC_SUPPL_TO_DT"                javaType="EZDSDateItem"/>
        <result property="xxDtTm_A2"                        column="SVC_SUPPL_TO_TM"                javaType="EZDSStringItem"/>
        <result property="xxDtTm_ST"                        column="START_TS"                       javaType="EZDSStringItem"/>
        <result property="xxDtTm_EN"                        column="END_TS"                         javaType="EZDSStringItem"/>
        <result property="xxDtTm_A3"                        column="SVC_TRVL_TM_NUM"                javaType="EZDSStringItem"/>
        <result property="xxDtTm_A4"                        column="SVC_SUPPL_TM_NUM"               javaType="EZDSStringItem"/>
        <result property="xxDtTm_A5"                        column="DURN_TM_NUM"                    javaType="EZDSStringItem"/>
        <result property="xxAllPsnNm_A1"                    column="CRAT_PSN_NM"                    javaType="EZDSStringItem"/>
        <result property="cratDt_A"                         column="CRAT_DT"                        javaType="EZDSDateItem"/>
        <result property="xxDtTm_A6"                        column="CRAT_TM"                        javaType="EZDSStringItem"/>
        <result property="xxAllPsnNm_A2"                    column="UPD_PSN_NM"                     javaType="EZDSStringItem"/>
        <result property="updDt_A"                          column="UPD_DT"                         javaType="EZDSDateItem"/>
        <result property="xxDtTm_A7"                        column="UPD_TM"                         javaType="EZDSStringItem"/>
        <result property="svcSupplTaskStsCd_A"              column="SVC_SUPPL_TASK_STS_CD"          javaType="EZDSStringItem"/>
        <result property="svcTaskNum_A"                     column="SVC_TASK_NUM"                   javaType="EZDSStringItem"/>
        <result property="xxRowNum_A"                       column="XX_ROW_NUM"                     javaType="EZDSBigDecimalItem"/>
        <result property="submtFlg_A"                       column="SUBMIT_FLG"                     javaType="EZDSStringItem"/>
        <result property="ezUpTime"                         column="EZUPTIME"                       javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone"                     column="EZUPTIMEZONE"                   javaType="EZDSStringItem"/>
        <result property="xxDtTm_W1"                        column="SVC_SUPPL_FROM_TM_WK"           javaType="EZDSStringItem"/>
        <result property="xxDtTm_W2"                        column="SVC_SUPPL_TO_TM_WK"             javaType="EZDSStringItem"/>
        <result property="xxDtTm_W6"                        column="CRAT_TM_WK"                     javaType="EZDSStringItem"/>
        <result property="xxDtTm_W7"                        column="UPD_TM_WK"                      javaType="EZDSStringItem"/>
   </resultMap>
</sqlMap>
