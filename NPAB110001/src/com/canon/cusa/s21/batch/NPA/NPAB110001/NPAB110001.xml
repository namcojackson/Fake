<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPAB110001">

    <statement id="getEdiAsnHeader" parameterClass="Map">
        SELECT
            DISTINCT
            EH.GLBL_CMPY_CD                          EH_GLBL_CMPY_CD
           ,EH.ASN_SO_NUM                            EH_ASN_SO_NUM
           ,EH.EDI_PO_ORD_NUM                        EH_EDI_PO_ORD_NUM
           ,EH.SHIP_FROM_SO_NUM                      EH_SHIP_FROM_SO_NUM
           ,EH.EDI_RCV_TS                            EH_EDI_RCV_TS
           ,EH.ASN_EDI_PROC_STS_CD                   EH_ASN_EDI_PROC_STS_CD
           ,XR.PO_ORD_NUM                            XR_PO_ORD_NUM
           ,P1.PO_STS_CD                             P1_PO_STS_CD
           ,P1.INVTY_LOC_CD                          P1_INVTY_LOC_CD
           ,P1.PO_ORD_CMNT_TXT                       P1_PO_ORD_CMNT_TXT
           ,P1.VND_DROP_SHIP_FLG                     P1_VND_DROP_SHIP_FLG
           ,P1.PO_ORD_NUM                            P1_PO_ORD_NUM
           ,P1.VND_CD                                P1_VND_CD
           ,P1.VND_NM                                P1_VND_NM
           ,P2.PO_STS_CD                             P2_PO_STS_CD
           ,P2.INVTY_LOC_CD                          P2_INVTY_LOC_CD
           ,P2.PO_ORD_CMNT_TXT                       P2_PO_ORD_CMNT_TXT
           ,P2.VND_DROP_SHIP_FLG                     P2_VND_DROP_SHIP_FLG
           ,P2.PO_ORD_NUM                            P2_PO_ORD_NUM
           ,P2.VND_CD                                P2_VND_CD
           ,P2.VND_NM                                P2_VND_NM
           ,NVL(EH.SHIP_FROM_SO_NUM, EH.ASN_SO_NUM)  H_SO_NUM
           ,(SELECT COUNT(PO_ORD_NUM) FROM CMBN_PO_SO_XREF CPSX WHERE EH.GLBL_CMPY_CD = CPSX.GLBL_CMPY_CD AND EH.EDI_PO_ORD_NUM = CPSX.PO_ORD_NUM AND CPSX.EZCANCELFLAG = '0') AS CMBN_SO_CNT
           ,(SELECT COUNT(SO_NUM) FROM CMBN_PO_SO_XREF CPSX WHERE EH.GLBL_CMPY_CD = CPSX.GLBL_CMPY_CD AND EH.EDI_PO_ORD_NUM = CPSX.SO_NUM AND CPSX.PO_ORD_NUM IS NULL AND CPSX.EZCANCELFLAG = '0') AS SO_ONLY_CNT
        FROM
            EDI_ASN_HDR_WRK                   EH
           ,EDI_PO_DTL_XREF                   XR
           ,PO                                P1
           ,PO                                P2
        WHERE 1=1
            AND EH.GLBL_CMPY_CD               = #glblCmpyCd#
          <isNotNull property="itrlIntfcId">
            AND EH.ITRL_INTFC_ID              = #itrlIntfcId#
          </isNotNull>
            AND EH.PROC_FLG                   = #procFlg#
            AND EH.GLBL_CMPY_CD               = XR.GLBL_CMPY_CD(+)
            AND EH.EZCANCELFLAG               = '0'
            AND EH.EDI_PO_ORD_NUM             = XR.EDI_PO_ORD_NUM(+)
            AND XR.EZCANCELFLAG(+)            = '0'
            AND XR.EDI_PO_ORD_DTL_LINE_NUM(+) = #ediPoOrdDtlLineNum#
            AND XR.GLBL_CMPY_CD               = P1.GLBL_CMPY_CD(+)
            AND XR.PO_ORD_NUM                 = P1.PO_ORD_NUM(+)
            AND P1.EZCANCELFLAG(+)            = '0'
            AND EH.GLBL_CMPY_CD               = P2.GLBL_CMPY_CD(+)
            AND EH.EDI_PO_ORD_NUM             = P2.PO_ORD_NUM(+)
            AND P2.EZCANCELFLAG(+)            = '0'
        ORDER BY
            H_SO_NUM
    </statement>

    <statement id="getEdiAsnDetail" parameterClass="Map" resultClass="Map">
        SELECT
            ED.GLBL_CMPY_CD                      ED_GLBL_CMPY_CD
           ,ED.ASN_SO_NUM                        ED_ASN_SO_NUM
           ,ED.ASN_LINE_NUM                      ED_ASN_LINE_NUM
           ,ED.ASN_SO_SLP_NUM                    ED_ASN_SO_SLP_NUM
           ,ED.VND_INVTY_LOC_CD                  ED_VND_INVTY_LOC_CD
           ,ED.ASN_PRO_NUM                       ED_ASN_PRO_NUM
           ,ED.ASN_CARR_CD                       ED_ASN_CARR_CD
           ,ED.ASN_BOL_NUM                       ED_ASN_BOL_NUM
           ,ED.EDI_PO_ORD_DTL_LINE_NUM           ED_EDI_PO_ORD_DTL_LINE_NUM
           ,ED.EDI_SUB_NUM                       ED_EDI_SUB_NUM
           ,ED.ASN_TTL_WT                        ED_ASN_TTL_WT
           ,ED.ASN_TOT_FRT_AMT                   ED_ASN_TOT_FRT_AMT
           ,ED.ASN_PLN_DELY_DT                   ED_ASN_PLN_DELY_DT
           ,ED.MDSE_CD                           ED_MDSE_CD
           ,ED.ASN_MDSE_CD                       ED_ASN_MDSE_CD
           ,ED.ASN_QTY                           ED_ASN_QTY
           ,ED.ASN_STK_STS_CD                    ED_ASN_STK_STS_CD
           ,ED.MDSE_CD_UPD_FLG                   ED_MDSE_CD_UPD_FLG
           ,ED.PO_ORD_NUM                        ED_PO_ORD_NUM
           ,ED.PO_ORD_DTL_LINE_NUM               ED_PO_ORD_DTL_LINE_NUM
           ,CPSX.SO_NUM
        FROM
              EDI_ASN_DTL_WRK      ED
             ,CMBN_PO_SO_XREF  CPSX
        WHERE 1=1
            AND ED.GLBL_CMPY_CD            = #glblCmpyCd#
            AND ED.ASN_SO_NUM              = #asnSoNum#
            AND ED.EZCANCELFLAG            = '0'
            AND ED.GLBL_CMPY_CD            = CPSX.GLBL_CMPY_CD(+)
            AND ED.EDI_PO_ORD_DTL_LINE_NUM = CPSX.PO_ORD_DTL_LINE_NUM(+)
            AND CPSX.PO_ORD_NUM(+)         = #ediPoOrdNum#
            AND CPSX.EZCANCELFLAG(+)       = '0'
        ORDER BY
            ED.ASN_SO_SLP_NUM
           ,ED.VND_INVTY_LOC_CD
           ,ED.ASN_PRO_NUM
           ,ED.ASN_CARR_CD
           ,ED.ASN_BOL_NUM
    </statement>

    <statement id="getEdiAsnSerNumWrk" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            ES.ASN_MDSE_CD                  ES_ASN_MDSE_CD
           ,ES.SO_SER_ID                    ES_SO_SER_ID
           ,NVL(ED.ASN_MDSE_CD, ES.ASN_MDSE_CD) XR_MDSE_CD
           ,ED.EDI_PO_ORD_DTL_LINE_NUM      ED_EDI_PO_ORD_DTL_LINE_NUM
           ,ED.ASN_SO_SLP_NUM               ED_ASN_SO_SLP_NUM
        FROM
            EDI_ASN_SER_NUM_WRK    ES
           ,EDI_ASN_DTL_WRK        ED
        WHERE 1=1
            AND ES.GLBL_CMPY_CD    = #glblCmpyCd#
            AND ES.ASN_SO_NUM      = #asnSoNum#
            AND ES.GLBL_CMPY_CD    = ED.GLBL_CMPY_CD
            AND ES.ASN_SO_NUM      = ED.ASN_SO_NUM
            AND ES.ASN_SO_SLP_NUM  = ED.ASN_SO_SLP_NUM
            AND ES.EZCANCELFLAG    = '0'
            AND ED.EZCANCELFLAG    = '0'
    </statement>

    <statement id="mdseCdFromAsnDtl" parameterClass="Map" resultClass="String">
        SELECT
            AD.MDSE_CD
        FROM
            ASL_HDR AH
           ,ASL_DTL AD
        WHERE 1=1
        AND AH.GLBL_CMPY_CD                            = #glblCmpyCd#
        AND NVL ( AH.ASL_START_DT , '19000101' )  &lt; = #aslStartDt#
        AND NVL ( AH.ASL_END_DT   , '99991231' )  &gt; = #aslEndDt#
        AND NVL ( AD.EFF_FROM_DT  , '19000101' )  &lt; = #slsDate#
        AND NVL ( AD.EFF_THRU_DT  , '99991231' )  &gt; = #slsDate#
        AND AH.ASL_HDR_PK                              = AD.ASL_HDR_PK
        AND AH.GLBL_CMPY_CD                            = AD.GLBL_CMPY_CD
        AND AD.VND_CD                                  = #vndCd#
        AND NVL(AD.SPLY_ITEM_NUM , AD.MDSE_CD)         = #splyItemNum#
        AND AH.EZCANCELFLAG                            = '0'
        AND AD.EZCANCELFLAG                            = '0'
    </statement>

    <statement id="mdseCdFromSerNumWrk" parameterClass="Map" resultClass="String">
        SELECT
            ES.MDSE_CD
        FROM
            ASL_HDR              AH
           ,ASL_DTL              AD
           ,EDI_ASN_SER_NUM_WRK  ES
        WHERE 1=1
        AND AH.GLBL_CMPY_CD                           = #glblCmpyCd#
        AND NVL ( AH.ASL_START_DT , '19000101' ) &lt; = #aslStartDt#
        AND NVL ( AH.ASL_END_DT   , '99991231' ) &gt; = #aslEndDt#
        AND NVL ( AD.EFF_FROM_DT  , '19000101' ) &lt; = #slsDate#
        AND NVL ( AD.EFF_THRU_DT  , '99991231' ) &gt; = #slsDate#
        AND AH.ASL_HDR_PK                             = AD.ASL_HDR_PK
        AND AH.GLBL_CMPY_CD                           = AD.GLBL_CMPY_CD
        AND AD.VND_CD                                 = #vndCd#
        AND NVL(AD.SPLY_ITEM_NUM , AD.MDSE_CD)        = ES.ASN_MDSE_CD
        AND NVL(AD.SPLY_ITEM_NUM , AD.MDSE_CD)        = #splyItemNum#
        AND ES.ASN_SO_NUM                             = #asnSoNum#
        AND AH.EZCANCELFLAG                           = '0'
        AND AD.EZCANCELFLAG                           = '0'
        AND ES.EZCANCELFLAG                           = '0'
        AND ROWNUM = 1
    </statement>

    <statement id="getPoMsgList" parameterClass="Map" resultClass="Map">
        SELECT
            PM.PO_MSG_PK                  PM_PO_MSG_PK
           ,PM.PO_MSG_TP_CD               PM_PO_MSG_TP_CD
           ,PM.PO_MSG_SUBMT_PSN_CD        PM_PO_MSG_SUBMT_PSN_CD
           ,PM.PRCH_REQ_NUM               PM_PRCH_REQ_NUM
           ,PM.PRCH_REQ_LINE_NUM          PM_PRCH_REQ_LINE_NUM
           ,PM.PRCH_REQ_LINE_SUB_NUM      PM_PRCH_REQ_LINE_SUB_NUM
           ,PM.PO_MSG_TXT                 PM_PO_MSG_TXT
        FROM
            PO_MSG           PM
        WHERE 1=1
            AND PM.GLBL_CMPY_CD    = #glblCmpyCd#
            AND PM.PO_ORD_NUM      = #poOrdNum#
            AND PM.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getEdiAsnDtl" parameterClass="Map" resultClass="Map">
    WITH CAL AS
        (
            SELECT
                DECODE(COUNT(PO_ORD_NUM || PO_ORD_DTL_LINE_NUM) , 1 , 'N' , 'Y') AS SPLIT_FLAG
               ,COUNT(PO_ORD_NUM || PO_ORD_DTL_LINE_NUM)                         AS SPLIT_LINE_COUNT
               ,PO_ORD_NUM || PO_ORD_DTL_LINE_NUM                                AS ORD_PLUS_LINE_NUM
               ,SUM(ASN_QTY)                                                     AS TOT_ASN_QTY
            FROM
                EDI_ASN_DTL_WRK
            WHERE 1=1
            AND GLBL_CMPY_CD        = #glblCmpyCd#
            AND ASN_SO_NUM          = #asnSoNum#
            AND EZCANCELFLAG        = '0'
            GROUP BY  
                PO_ORD_NUM || PO_ORD_DTL_LINE_NUM
        ) 
        SELECT
            ED.GLBL_CMPY_CD               ED_GLBL_CMPY_CD
           ,ED.ASN_SO_NUM                 ED_ASN_SO_NUM
           ,ED.ASN_LINE_NUM               ED_ASN_LINE_NUM
           ,ED.ASN_SO_SLP_NUM             ED_ASN_SO_SLP_NUM
           ,ED.VND_INVTY_LOC_CD           ED_VND_INVTY_LOC_CD
           ,ED.ASN_PRO_NUM                ED_ASN_PRO_NUM
           ,ED.ASN_CARR_CD                ED_ASN_CARR_CD
           ,ED.ASN_BOL_NUM                ED_ASN_BOL_NUM
           ,ED.PO_ORD_NUM                 ED_PO_ORD_NUM
           ,ED.PO_ORD_DTL_LINE_NUM        ED_PO_ORD_DTL_LINE_NUM
           ,ED.ASN_MDSE_CD                ED_ASN_MDSE_CD
           ,ED.MDSE_CD_UPD_FLG            D_MDSE_CD_UPD_FLG
           ,ED.MDSE_CD                    D_MDSE_CD
           ,ED.ASN_QTY                    D_ASN_QTY
           ,ED.TRX_LINE_NUM               ED_TRX_LINE_NUM
           ,ED.TRX_LINE_SUB_NUM           ED_TRX_LINE_SUB_NUM
           ,PD.ADMIN_PSN_CD               PD_ADMIN_PSN_CD
           ,PD.BILL_TO_CUST_CD            PD_BILL_TO_CUST_CD
           ,PD.CARR_CD                    PD_CARR_CD
           ,PD.CCY_CD                     PD_CCY_CD
           ,PD.CPO_DTL_LINE_NUM           PD_CPO_DTL_LINE_NUM
           ,PD.CPO_DTL_LINE_SUB_NUM       PD_CPO_DTL_LINE_SUB_NUM
           ,PD.CPO_ORD_NUM                PD_CPO_ORD_NUM
           ,PD.CPO_ORD_TP_CD              PD_CPO_ORD_TP_CD
           ,PD.CUST_ISS_PO_DT             PD_CUST_ISS_PO_DT
           ,PD.CUST_ISS_PO_NUM            PD_CUST_ISS_PO_NUM
           ,PD.CUST_UOM_CD                PD_CUST_UOM_CD
           ,PD.FRT_CHRG_METH_CD           PD_FRT_CHRG_METH_CD
           ,PD.FRT_CHRG_TO_CD             PD_FRT_CHRG_TO_CD
           ,PD.MDSE_CD                    PD_MDSE_CD
           ,PD.MDSE_NM                    PD_MDSE_NM
           ,PD.ORD_QTY                    PD_ORD_QTY
           ,PD.PO_QTY                     PD_PO_QTY
           ,PD.PO_BAL_QTY                 PD_PO_BAL_QTY
           ,PD.PO_ORD_DTL_CMNT_TXT        PD_PO_ORD_DTL_CMNT_TXT
           ,PD.PO_ORD_NUM                 PD_PO_ORD_NUM
           ,PD.PO_RCV_QTY                 PD_PO_RCV_QTY
           ,PD.SELL_TO_CUST_CD            PD_SELL_TO_CUST_CD
           ,PD.SHIP_TO_ADDL_LOC_NM        PD_SHIP_TO_ADDL_LOC_NM
           ,PD.SHIP_TO_CNTY_NM            PD_SHIP_TO_CNTY_NM
           ,PD.SHIP_TO_CTRY_CD            PD_SHIP_TO_CTRY_CD
           ,PD.SHIP_TO_CTY_ADDR           PD_SHIP_TO_CTY_ADDR
           ,PD.SHIP_TO_FIRST_LINE_ADDR    PD_SHIP_TO_FIRST_LINE_ADDR
           ,PD.SHIP_TO_FIRST_REF_CMNT_TXT PD_SHIP_TO_FIRST_REF_CMNT_TXT
           ,PD.SHIP_TO_FRTH_LINE_ADDR     PD_SHIP_TO_FRTH_LINE_ADDR
           ,PD.SHIP_TO_POST_CD            PD_SHIP_TO_POST_CD
           ,PD.SHIP_TO_PROV_NM            PD_SHIP_TO_PROV_NM
           ,PD.SHIP_TO_SCD_LINE_ADDR      PD_SHIP_TO_SCD_LINE_ADDR
           ,PD.SHIP_TO_SCD_REF_CMNT_TXT   PD_SHIP_TO_SCD_REF_CMNT_TXT
           ,PD.SHIP_TO_ST_CD              PD_SHIP_TO_ST_CD
           ,PD.SHIP_TO_THIRD_LINE_ADDR    PD_SHIP_TO_THIRD_LINE_ADDR
           ,PD.SHPG_SVC_LVL_CD            PD_SHPG_SVC_LVL_CD
           ,PD.THIS_MTH_FOB_COST_AMT      PD_THIS_MTH_FOB_COST_AMT
           ,PD.ADMIN_PSN_CD               PD_ADMIN_PSN_CD
           ,PD.BILL_TO_CUST_CD            PD_BILL_TO_CUST_CD
           ,PD.CARR_CD                    PD_CARR_CD
           ,PD.CCY_CD                     PD_CCY_CD
           ,PD.CPO_DTL_LINE_NUM           PD_CPO_DTL_LINE_NUM
           ,PD.CPO_DTL_LINE_SUB_NUM       PD_CPO_DTL_LINE_SUB_NUM
           ,PD.CPO_ORD_NUM                PD_CPO_ORD_NUM
           ,PD.CPO_ORD_TP_CD              PD_CPO_ORD_TP_CD
           ,PD.CUST_ISS_PO_DT             PD_CUST_ISS_PO_DT
           ,PD.CUST_ISS_PO_NUM            PD_CUST_ISS_PO_NUM
           ,PD.CUST_UOM_CD                PD_CUST_UOM_CD
           ,PD.FRT_CHRG_METH_CD           PD_FRT_CHRG_METH_CD
           ,PD.FRT_CHRG_TO_CD             PD_FRT_CHRG_TO_CD
           ,PD.MDSE_CD                    PD_MDSE_CD
           ,PD.MDSE_NM                    PD_MDSE_NM
           ,PD.ORD_QTY                    PD_ORD_QTY
           ,PD.PO_BAL_QTY                 PD_PO_BAL_QTY
           ,PD.PO_ORD_DTL_CMNT_TXT        PD_PO_ORD_DTL_CMNT_TXT
           ,PD.PO_ORD_NUM                 PD_PO_ORD_NUM
           ,PD.PO_RCV_QTY                 PD_PO_RCV_QTY
           ,PD.SELL_TO_CUST_CD            PD_SELL_TO_CUST_CD
           ,PD.SHIP_TO_ADDL_LOC_NM        PD_SHIP_TO_ADDL_LOC_NM
           ,PD.SHIP_TO_CNTY_NM            PD_SHIP_TO_CNTY_NM
           ,PD.SHIP_TO_CTRY_CD            PD_SHIP_TO_CTRY_CD
           ,PD.SHIP_TO_CTY_ADDR           PD_SHIP_TO_CTY_ADDR
           ,PD.SHIP_TO_CUST_CD            PD_SHIP_TO_CUST_CD
           ,PD.SHIP_TO_LOC_NM             PD_SHIP_TO_LOC_NM
           ,PD.SHIP_TO_FIRST_LINE_ADDR    PD_SHIP_TO_FIRST_LINE_ADDR
           ,PD.SHIP_TO_FIRST_REF_CMNT_TXT PD_SHIP_TO_FIRST_REF_CMNT_TXT
           ,PD.SHIP_TO_FRTH_LINE_ADDR     PD_SHIP_TO_FRTH_LINE_ADDR
           ,PD.SHIP_TO_POST_CD            PD_SHIP_TO_POST_CD
           ,PD.SHIP_TO_PROV_NM            PD_SHIP_TO_PROV_NM
           ,PD.SHIP_TO_SCD_LINE_ADDR      PD_SHIP_TO_SCD_LINE_ADDR
           ,PD.SHIP_TO_SCD_REF_CMNT_TXT   PD_SHIP_TO_SCD_REF_CMNT_TXT
           ,PD.SHIP_TO_ST_CD              PD_SHIP_TO_ST_CD
           ,PD.SHIP_TO_THIRD_LINE_ADDR    PD_SHIP_TO_THIRD_LINE_ADDR
           ,PD.SHPG_PLN_NUM               PD_SHPG_PLN_NUM
           ,PD.SHPG_SVC_LVL_CD            PD_SHPG_SVC_LVL_CD
           ,PD.THIS_MTH_FOB_COST_AMT      PD_THIS_MTH_FOB_COST_AMT
           ,PO.PO_SUBMT_PSN_CD            PO_PO_SUBMT_PSN_CD
           ,PO.PO_SUBMT_TS                PO_PO_SUBMT_TS
           ,PO.PO_APVL_STS_CD             DP_PO_APVL_STS_CD
           ,PO.PO_APVL_PSN_CD             PO_PO_APVL_PSN_CD
           ,PO.PO_APVL_DT                 PO_PO_APVL_DT
           ,PO.PO_APVL_TS                 PO_PO_APVL_TS
           ,PO.PO_ORD_SRC_CD              PO_PO_ORD_SRC_CD
           ,PO.VND_CD                     PO_VND_CD
           ,PO.VND_NM                     PO_VND_NM
           ,PO.VND_DROP_SHIP_FLG          PO_VND_DROP_SHIP_FLG
           ,PO.PO_ORD_CMNT_TXT            PO_PO_ORD_CMNT_TXT
           ,PO.PO_SEND_FLG                PO_PO_SEND_FLG
           ,PO.PO_PRINT_FLG               PO_PO_PRINT_FLG
           ,PO.VND_ISS_ORD_NUM            PO_VND_ISS_ORD_NUM
           ,PO.DEST_RTL_WH_CD             DP_DEST_RTL_WH_CD
           ,PO.VND_PMT_TERM_CD            DP_VND_PMT_TERM_CD
           ,PO.VND_PMT_TERM_DESC_TXT      DP_VND_PMT_TERM_DESC_TXT
           ,PO.RQST_TECH_TOC_CD           DP_RQST_TECH_TOC_CD
           ,PO.RQST_RCV_TM                DP_RQST_RCV_TM
           <!-- START 2023/07/20 S.Dong [QC#61638, ADD] -->
           ,PO.RQST_SHIP_DT               DP_RQST_SHIP_DT
           <!-- END 2023/07/20 S.Dong [QC#61638, ADD] -->
           ,PO.RTRN_SHIP_TO_RTL_WH_CD     DP_RTRN_SHIP_TO_RTL_WH_CD
           ,PO.SHIP_FROM_SO_NUM_LIST_TXT  DP_SHIP_FROM_SO_NUM_LIST_TXT
           ,PO.CARR_ACCT_NUM              DP_CARR_ACCT_NUM
           ,PO.LINE_BIZ_TP_CD             DP_LINE_BIZ_TP_CD
           ,PO.TRSMT_METH_TP_CD           DP_TRSMT_METH_TP_CD
           ,PO.SEND_PO_FAX_NUM            DP_SEND_PO_FAX_NUM
           ,PO.SEND_PO_EML_ADDR           DP_SEND_PO_EML_ADDR
           ,PO.PO_SEND_TS                 DP_PO_SEND_TS
           ,PO.EIP_RPT_RQST_PK            DP_EIP_RPT_RQST_PK
           ,PO.DS_PO_TP_CD                DP_DS_PO_TP_CD
<!-- QC#55617 Mod Start -->
           <!-- ,PO.DS_PO_TP_CD                DP_DS_PO_TP_NM -->
           ,PO.DS_PO_TP_NM                DP_DS_PO_TP_NM
<!-- QC#55617 Mod End -->
           ,PO.PO_QLFY_CD                 DP_PO_QLFY_CD
           ,PO.PRNT_VND_CD                DP_PRNT_VND_CD
           ,PO.PRNT_VND_NM                DP_PRNT_VND_NM
           ,PD.ASL_DTL_PK                DPD_ASL_DTL_PK
           ,PD.ASL_MDSE_CD               DPD_ASL_MDSE_CD
           ,PD.ASL_UNIT_PRC_AMT          DPD_ASL_UNIT_PRC_AMT
           ,PD.CTAC_PSN_NM               DPD_CTAC_PSN_NM
           ,PD.DEST_RTL_SWH_CD           DPD_DEST_RTL_SWH_CD
           ,PD.DISP_PO_DTL_LINE_NUM      DPD_DISP_PO_DTL_LINE_NUM
           ,PD.ENT_DEAL_NET_UNIT_PRC_AMT DPD_ENT_DEAL_NET_UNIT_PRC_AMT
           ,PD.ENT_FUNC_NET_UNIT_PRC_AMT DPD_ENT_FUNC_NET_UNIT_PRC_AMT
           ,PD.ENT_PO_DTL_DEAL_NET_AMT   DPD_ENT_PO_DTL_DEAL_NET_AMT
           ,PD.ENT_PO_DTL_FUNC_NET_AMT   DPD_ENT_PO_DTL_FUNC_NET_AMT
           ,PD.EXCH_RATE                 DPD_EXCH_RATE
           ,PD.FROM_STK_STS_CD           DPD_FROM_STK_STS_CD
           ,PD.FRT_COND_CD               DPD_FRT_COND_CD
           ,PD.INVTY_LOC_CD              DPD_INVTY_LOC_CD
           ,PD.MDSE_DESC_SHORT_TXT       DPD_MDSE_DESC_SHORT_TXT
           ,PD.ORIG_DISP_PO_DTL_LINE_NUM DPD_ORIG_DISP_PO_DTL_LINE_NUM
           ,PD.ORIG_MDSE_CD              DPD_ORIG_MDSE_CD
           ,PD.ORIG_PO_ORD_DTL_LINE_NUM  DPD_ORIG_PO_ORD_DTL_LINE_NUM
           ,PD.ORIG_PO_ORD_NUM           DPD_ORIG_PO_ORD_NUM
           ,PD.PO_DISP_QTY               DPD_PO_DISP_QTY
           ,PD.PO_DISP_UOM_CD            DPD_PO_DISP_UOM_CD
           ,PD.PO_INV_QTY                DPD_PO_INV_QTY
           ,PD.PO_LINE_TP_CD             DPD_PO_LINE_TP_CD
           ,PD.PO_MATCH_TP_CD            DPD_PO_MATCH_TP_CD
           ,PD.PO_MDSE_CMPSN_TP_CD       DPD_PO_MDSE_CMPSN_TP_CD
           ,PD.PO_SEND_TS                DPD_PO_SEND_TS
           ,PD.PO_ORD_DTL_LINE_NUM       DPD_PO_ORD_DTL_LINE_NUM
           ,PD.PRCH_GRP_CD               DPD_PRCH_GRP_CD
           ,PD.PRCH_REQ_LINE_NUM         DPD_PRCH_REQ_LINE_NUM
           ,PD.PRCH_REQ_LINE_SUB_NUM     DPD_PRCH_REQ_LINE_SUB_NUM
           ,PD.PRCH_REQ_NUM              DPD_PRCH_REQ_NUM
           ,PD.PRO_NUM                   DPD_PRO_NUM
           ,PD.RQST_RCV_DT               DPD_RQST_RCV_DT
           ,PD.RQST_RCV_TM               DPD_RQST_RCV_TM
           <!-- START 2023/07/20 S.Dong [QC#61638, ADD] -->
           ,PD.RQST_SHIP_DT              DPD_RQST_SHIP_DT
           <!-- END 2023/07/20 S.Dong [QC#61638, ADD] -->
           ,PD.SET_PO_ORD_DTL_LINE_NUM   DPD_SET_PO_ORD_DTL_LINE_NUM
           ,PD.SHIP_FROM_SO_NUM_LIST_TXT DPD_SHIP_FROM_SO_NUM_LIST_TXT
           ,PD.SHIP_TO_ACCT_NM           DPD_SHIP_TO_ACCT_NM
           ,PD.SRC_RTL_SWH_CD            DPD_SRC_RTL_SWH_CD
           ,PD.SVC_CONFIG_MSTR_PK        DPD_SVC_CONFIG_MSTR_PK
           ,PD.TO_STK_STS_CD             DPD_TO_STK_STS_CD
           ,PD.TRX_REF_LINE_NUM          DPD_TRX_REF_LINE_NUM
           ,PD.TRX_REF_LINE_SUB_NUM      DPD_TRX_REF_LINE_SUB_NUM
           ,PD.TRX_REF_NUM               DPD_TRX_REF_NUM
           ,PD.VND_INVTY_LOC_CD          DPD_VND_INVTY_LOC_CD
           ,PD.VND_ISS_PO_ORD_NUM        DPD_VND_ISS_PO_ORD_NUM
           ,PD.VND_PO_ACK_STS_CD         DPD_VND_PO_ACK_STS_CD
           ,M.MDSE_NM                     M_MDSE_NM
           ,CAL.SPLIT_FLAG                CAL_SPLIT_FLAG
           ,CAL.SPLIT_LINE_COUNT          CAL_SPLIT_LINE_COUNT
           ,CAL.ORD_PLUS_LINE_NUM         CAL_ORD_PLUS_LINE_NUM
           ,CAL.TOT_ASN_QTY               CAL_TOT_ASN_QTY
           ,SUM(ED.ASN_QTY) OVER(PARTITION BY ED.PO_ORD_NUM, ED.ASN_SO_NUM, ED.MDSE_CD, ED.TRX_LINE_NUM, ED.TRX_LINE_SUB_NUM)          AS TOT_SHIP_QTY
           ,ROW_NUMBER() OVER(PARTITION BY ED.PO_ORD_NUM || ED.PO_ORD_DTL_LINE_NUM ORDER BY ED.PO_ORD_NUM || ED.PO_ORD_DTL_LINE_NUM) AS SPLIT_LINE_NUM
           <isNotNull property="setFlg">
           ,MAX(ED.MDSE_CD_UPD_FLG) OVER(PARTITION BY PD.PO_ORD_NUM, PD.SET_PO_ORD_DTL_LINE_NUM, ED.ASN_SO_NUM) SET_MDSE_UPD_FLG
           ,COUNT(PD.SET_PO_ORD_DTL_LINE_NUM) OVER(PARTITION BY PD.PO_ORD_NUM, PD.SET_PO_ORD_DTL_LINE_NUM, ED.ASN_SO_NUM) SET_PARENT_UPD_LINE
           </isNotNull>
        FROM
            EDI_ASN_DTL_WRK  ED
           ,PO_DTL           PD
           ,PO               PO
           ,MDSE             M
           ,CAL              CAL
        WHERE 1=1
            AND ED.GLBL_CMPY_CD                              = #glblCmpyCd#
            AND ED.ASN_SO_NUM                                = #asnSoNum#
            AND ED.GLBL_CMPY_CD                              = PD.GLBL_CMPY_CD
            AND ED.PO_ORD_NUM                                = PD.PO_ORD_NUM
            AND ED.PO_ORD_DTL_LINE_NUM                       = PD.PO_ORD_DTL_LINE_NUM
            AND PD.GLBL_CMPY_CD                              = PO.GLBL_CMPY_CD
            AND PD.PO_ORD_NUM                                = PO.PO_ORD_NUM
            <isNotNull property="setFlg">
            AND PD.SET_PO_ORD_DTL_LINE_NUM                   IS NOT NULL
            </isNotNull>
            <isNull property="setFlg">
            AND PD.SET_PO_ORD_DTL_LINE_NUM                   IS NULL
            </isNull>
            AND ED.GLBL_CMPY_CD                              = M.GLBL_CMPY_CD
            AND ED.MDSE_CD                                   = M.MDSE_CD
            AND (ED.PO_ORD_NUM || ED.PO_ORD_DTL_LINE_NUM)    = CAL.ORD_PLUS_LINE_NUM
            AND ED.EZCANCELFLAG                              = '0'
            AND PD.EZCANCELFLAG                              = '0'
            AND PO.EZCANCELFLAG                              = '0'
            AND M.EZCANCELFLAG                               = '0'
        ORDER BY
            ED.PO_ORD_NUM
            <isNotNull property="setFlg">
           ,SPLIT_LINE_NUM
           </isNotNull>
           ,ED.PO_ORD_DTL_LINE_NUM
           ,ED.ASN_LINE_NUM
    </statement>

    <statement id="getMdseCdFopmShpgPln" parameterClass="Map" resultClass="String">
        SELECT
            MDSE_CD
        FROM
            SHPG_PLN
        WHERE 1=1
        AND GLBL_CMPY_CD   = #glblCmpyCd#
        AND SHPG_PLN_NUM   = #shpgPlnNum#
        AND EZCANCELFLAG   = '0'
        AND ROWNUM         = 1
    </statement>

    <statement id="getToSendPoReceivingInfo" parameterClass="Map" resultClass="Map">
        SELECT
            PD.PRCH_REQ_NUM
           ,PD.PRCH_REQ_LINE_NUM
           ,PD.PRCH_REQ_LINE_SUB_NUM
           ,PD.INVTY_LOC_CD
           ,PD.CUST_ISS_PO_NUM
           ,PD.PO_BAL_QTY
           ,PD.SHPG_PLN_NUM
           ,DILV.RTL_WH_CD
        FROM
            PO_DTL         PD
           ,PO_STS         PS
           ,DS_INVTY_LOC_V DILV
        WHERE 1=1
        AND PD.GLBL_CMPY_CD             = #glblCmpyCd#
        AND PD.ORIG_PO_ORD_NUM          = #origPoOrdNum#
        AND PD.ORIG_PO_ORD_DTL_LINE_NUM = #origPoOrdDtlLineNum#
        AND PD.GLBL_CMPY_CD              = PS.GLBL_CMPY_CD
        AND PD.PO_STS_CD                 = PS.PO_STS_CD
        AND PS.OPEN_PO_FLG               = #openPoFlag#
        AND PD.GLBL_CMPY_CD             = DILV.GLBL_CMPY_CD
        AND PD.INVTY_LOC_CD             = DILV.INVTY_LOC_CD
        AND PD.EZCANCELFLAG              = '0'
        AND PS.EZCANCELFLAG              = '0'
        AND DILV.EZCANCELFLAG            = '0'
    </statement>

<!-- START 04/27/2020 T.Ogura [QC#56546,ADD] -->
    <statement id="getToSendPoReceivingInfoAgain" parameterClass="Map" resultClass="Map">
        SELECT
            PD.PRCH_REQ_NUM
           ,PD.PRCH_REQ_LINE_NUM
           ,PD.PRCH_REQ_LINE_SUB_NUM
           ,PD.INVTY_LOC_CD
           ,PD.CUST_ISS_PO_NUM
           ,PD.PO_BAL_QTY
           ,PD.SHPG_PLN_NUM
           ,DILV.RTL_WH_CD
        FROM
            PO_DTL         PD
           ,PO_STS         PS
           ,DS_INVTY_LOC_V DILV
        WHERE 1=1
        AND PD.GLBL_CMPY_CD             = #glblCmpyCd#
        AND PD.ORIG_PO_ORD_NUM          = #origPoOrdNum#
        AND PD.PO_ORD_DTL_LINE_NUM      = #origPoOrdDtlLineNum#
        AND PD.GLBL_CMPY_CD              = PS.GLBL_CMPY_CD
        AND PD.PO_STS_CD                 = PS.PO_STS_CD
        AND PS.OPEN_PO_FLG               = #openPoFlag#
        AND PD.GLBL_CMPY_CD             = DILV.GLBL_CMPY_CD
        AND PD.INVTY_LOC_CD             = DILV.INVTY_LOC_CD
        AND PD.EZCANCELFLAG              = '0'
        AND PS.EZCANCELFLAG              = '0'
        AND DILV.EZCANCELFLAG            = '0'
    </statement>
<!-- END   04/27/2020 T.Ogura [QC#56546,ADD] -->

    <statement id="getCarrCdFromXref" parameterClass="Map" resultClass="String">
            SELECT
                CASE 
                     WHEN VND_CD = #cusaPatVndCd# AND CARR_CD != #ast# THEN CARR_CD
                     WHEN VND_CD = #cusaPatVndCd# AND CARR_CD = #ast# AND CARR_TP_CD IS NULL THEN #otherCarrCd#
                     WHEN VND_CD = #cusaPatVndCd# AND CARR_TP_CD = #carrTpF# THEN #carrCdF#
                     WHEN VND_CD = #cusaPatVndCd# AND CARR_TP_CD = #carrTpU# THEN #carrCdU#
                     ELSE CARR_CD
                END AS CARR_CD
            FROM
                TRD_PTNR_SHPG_X_REF
            WHERE 1=1
            AND GLBL_CMPY_CD      = #glblCmpyCd#
            AND VND_CD            = #vndCd#
            <!-- START 2021/04/16 QC#58256 -->
            AND (TRD_PTNR_CARR_CD  = #trdPtnrCarrCd# OR TRD_PTNR_SHIP_VIA_CD = #trdPtnrCarrCd#)
            <!-- End 2021/04/16 QC#58256 -->
            <isNotNull property="shpgSvcLclCd">
            AND SHPG_SVC_LCL_CD  = #shpgSvcLclCd#
            </isNotNull>
            AND EZCANCELFLAG      = '0'
            ORDER BY CARR_TP_CD NULLS LAST
    </statement>

    <statement id="getRwsRefNum" parameterClass="Map" resultClass="String">
            SELECT
                RWS_REF_NUM
            FROM
                RWS_HDR           R
            WHERE 1=1
            AND GLBL_CMPY_CD      = #glblCmpyCd#
             <isNotNull property="whCd">
            AND WH_CD             = #whCd#
            </isNotNull>
            AND RWS_REF_NUM       = #rwsRefNum#
            AND EZCANCELFLAG      = '0'
    </statement>

    <statement id="getMaxRwsRefNum" parameterClass="Map" resultClass="String">
            SELECT
                MAX(R.RWS_REF_NUM)    R_RWS_REF_NUM
            FROM
                RWS_HDR               R
            WHERE 1=1
            AND R.GLBL_CMPY_CD        = #glblCmpyCd#
            AND R.WH_CD               = #whCd#
            AND REGEXP_LIKE(R.RWS_REF_NUM, #rwsRefNum#)
            AND R.EZCANCELFLAG        = '0'
            GROUP BY
                R.WH_CD
    </statement>

    <statement id="getSceOrdTpCd" parameterClass="Map" resultClass="String">
            SELECT
                'X'
            FROM
                PRNT_CMPY_VND
            WHERE 1=1
            AND GLBL_CMPY_CD     = #glblCmpyCd#
            AND PRNT_CMPY_VND_CD = #prntCmpyVndCd#
            AND EZCANCELFLAG     = '0'
            AND ROWNUM = 1
    </statement>

    <statement id="getInvtyCtrlFlg" parameterClass="Map" resultClass="String">
        SELECT
            M.INVTY_CTRL_FLG    M_INVTY_CTRL_FLG
        FROM
            MDSE M
        WHERE 1=1
            AND M.GLBL_CMPY_CD  = #glblCmpyCd#
            AND M.MDSE_CD       = #mdseCd#
            AND M.EZCANCELFLAG  = '0'
    </statement>

    <statement id="getPoRcvDtl" parameterClass="Map" resultClass="Map">
        SELECT
            PO_RCV_LINE_NUM
        FROM
            PO_RCV_DTL
        WHERE 1=1
            AND GLBL_CMPY_CD  = #glblCmpyCd#
            AND PO_RCV_NUM    = #poRcvNum#
            AND EZCANCELFLAG  = '0'
    </statement>

    <statement id="getRwsSerInfo" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            RD.RWS_DTL_LINE_NUM    RD_RWS_DTL_LINE_NUM
           ,ES.SER_NUM             ES_SER_NUM
           ,ES.MDSE_CD             ES_MDSE_CD
           ,RD.RWS_QTY             RD_RWS_QTY
           ,ES.MDSE_CD || ES.SER_NUM AS MDSE_SER_NUM
        FROM
            RWS_DTL             RD
           ,RWS_HDR             RH
           ,PO_RCV_DTL          PD
           ,EDI_ASN_DTL_WRK     ED
           ,EDI_ASN_SER_NUM_WRK ES
           ,MDSE                M
        WHERE 1=1
            AND RH.GLBL_CMPY_CD    = #glblCmpyCd#
            AND RH.RWS_NUM         = #rwsNum#
            AND RH.TRX_ORD_NUM     = PD.PO_RCV_NUM
            AND RH.EZCANCELFLAG    = '0'
            AND RH.GLBL_CMPY_CD    = RD.GLBL_CMPY_CD
            AND RH.RWS_NUM         = RD.RWS_NUM
            AND RD.GLBL_CMPY_CD    = ES.GLBL_CMPY_CD
            AND RD.TRX_LINE_NUM    = PD.PO_RCV_LINE_NUM
            AND RD.EZCANCELFLAG    = '0'
            AND PD.GLBL_CMPY_CD    = ED.GLBL_CMPY_CD
            AND PD.ASN_SO_NUM      = ED.ASN_SO_NUM
            AND PD.ASN_LINE_NUM    = ED.ASN_LINE_NUM
            AND PD.EZCANCELFLAG    = '0'
            AND ED.GLBL_CMPY_CD    = ES.GLBL_CMPY_CD
            AND ED.ASN_SO_NUM      = ES.ASN_SO_NUM
            AND ED.ASN_SO_SLP_NUM  = ES.ASN_SO_SLP_NUM
            AND ED.ASN_MDSE_CD     = ES.ASN_MDSE_CD
            AND ES.GLBL_CMPY_CD    = M.GLBL_CMPY_CD
            AND ES.MDSE_CD         = M.MDSE_CD
            AND M.RCV_SER_TAKE_FLG = #flgY#
            AND ED.EZCANCELFLAG    = '0'
            AND ES.EZCANCELFLAG    = '0'
            AND M.EZCANCELFLAG     = '0'
        ORDER BY RD.RWS_DTL_LINE_NUM
    </statement>

    <statement id="getPoDtl" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM(
            SELECT
                PD.PO_ORD_DTL_LINE_NUM      PD_PO_ORD_DTL_LINE_NUM
               ,PD.MDSE_CD                  PD_MDSE_CD
               ,PD.CPO_DTL_LINE_SUB_NUM     PD_CPO_DTL_LINE_SUB_NUM
               ,PD.PO_BAL_QTY               PD_PO_BAL_QTY
               ,PD.CUST_UOM_CD              PD_CUST_UOM_CD
               ,PD.PO_STS_CD                PD_PO_STS_CD
               ,PD.SHPG_PLN_NUM             PD_SHPG_PLN_NUM
               <!-- START 2023/07/18 TZ.Win [QC#61614, ADD] -->
               ,PD.PO_LINE_STS_CD           PD_PO_LINE_STS_CD
               <!-- END 2023/07/18 TZ.Win [QC#61614, ADD] -->
            FROM
                PO_DTL                      PD
            WHERE 1=1
                AND PD.GLBL_CMPY_CD              = #glblCmpyCd#
                AND PD.PO_ORD_NUM                = #poOrdNum#
                AND PD.ORIG_PO_ORD_DTL_LINE_NUM  = #poOrdDtlLineNum#
                AND PD.EZCANCELFLAG               = '0'
            ORDER BY TO_NUMBER(PO_ORD_DTL_LINE_NUM) ASC
        )
        WHERE ROWNUM                        = 1
    </statement>

<!-- START 04/27/2020 T.Ogura [QC#56546,ADD] -->
    <statement id="getPoDtlAgain" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM(
            SELECT
                PD.PO_ORD_DTL_LINE_NUM      PD_PO_ORD_DTL_LINE_NUM
               ,PD.MDSE_CD                  PD_MDSE_CD
               ,PD.CPO_DTL_LINE_SUB_NUM     PD_CPO_DTL_LINE_SUB_NUM
               ,PD.PO_BAL_QTY               PD_PO_BAL_QTY
               ,PD.CUST_UOM_CD              PD_CUST_UOM_CD
               ,PD.PO_STS_CD                PD_PO_STS_CD
               ,PD.SHPG_PLN_NUM             PD_SHPG_PLN_NUM
               <!-- START 2023/07/18 TZ.Win [QC#61614, ADD] -->
               ,PD.PO_LINE_STS_CD           PD_PO_LINE_STS_CD
               <!-- END 2023/07/18 TZ.Win [QC#61614, ADD] -->
            FROM
                PO_DTL                      PD
            WHERE 1=1
                AND PD.GLBL_CMPY_CD              = #glblCmpyCd#
                AND PD.PO_ORD_NUM                = #poOrdNum#
                AND PD.PO_ORD_DTL_LINE_NUM       = #poOrdDtlLineNum#
                AND PD.EZCANCELFLAG               = '0'
            ORDER BY TO_NUMBER(PO_ORD_DTL_LINE_NUM) ASC
        )
        WHERE ROWNUM                        = 1
    </statement>
<!-- END   04/27/2020 T.Ogura [QC#56546,ADD] -->

    <statement id="getMdse" parameterClass="Map" resultClass="String">
        SELECT
            M.MDSE_CD                  M_MDSE_CD
        FROM
            MDSE  M
        WHERE 1=1
            AND M.MDSE_CD       = #mdseCd#
            AND M.GLBL_CMPY_CD  = #glblCmpyCd#
            AND M.EZCANCELFLAG  = '0'
            AND ROWNUM          = 1
    </statement>

    <statement id="getPoQlfyCd" parameterClass="Map" resultClass="String">
        SELECT 
            PO.PO_QLFY_CD 
        FROM 
            PO  PO
        WHERE 1=1
            AND PO.GLBL_CMPY_CD  = #glblCmpyCd#
            AND PO.PO_ORD_NUM    = #poOrdNum#
            AND PO.EZCANCELFLAG  = '0'
            AND ROWNUM           = 1
    </statement>

    <statement id="getFsrTaskList" parameterClass="Map" resultClass="Map">
        SELECT
            PR.FSR_NUM                AS FSR_NUM
           ,PR.SVC_TASK_NUM           AS SVC_TASK_NUM
           ,PR.RQST_TECH_TOC_CD       AS RQST_TECH_TOC_CD
           ,MAX(RH.LTST_WH_IN_ETA_DT) AS LTST_WH_IN_ETA_DT
        FROM
            RWS_HDR    RH
           ,RWS_DTL    RD
           ,PRCH_REQ   PR
           ,SVC_TASK   ST
        WHERE
            RH.GLBL_CMPY_CD       = #glblCmpyCd#
        AND RH.RWS_NUM            = #rwsNum#
        AND RH.EZCANCELFLAG       = '0'
        AND RH.GLBL_CMPY_CD       = RD.GLBL_CMPY_CD
        AND RH.RWS_NUM            = RD.RWS_NUM
        AND RD.EZCANCELFLAG       = '0'
        AND RD.GLBL_CMPY_CD       = PR.GLBL_CMPY_CD
        AND RD.PRCH_REQ_NUM       = PR.PRCH_REQ_NUM
        AND PR.PRCH_REQ_REC_TP_CD = #prchReqRecTpCd#
        AND PR.EZCANCELFLAG       = '0'
        AND PR.GLBL_CMPY_CD       = ST.GLBL_CMPY_CD
        AND PR.SVC_TASK_NUM       = ST.SVC_TASK_NUM
        AND PR.FSR_NUM            = ST.FSR_NUM
        AND ST.EZCANCELFLAG       = '0'
        AND EXISTS (SELECT
                        1
                    FROM
                        FSR_VISIT FV
                       ,FSR_VISIT NV
                    WHERE
                        FV.GLBL_CMPY_CD       = ST.GLBL_CMPY_CD
                    AND FV.FSR_NUM            = ST.FSR_NUM
                    AND FV.SVC_TASK_NUM       = ST.SVC_TASK_NUM
                    AND FV.EZCANCELFLAG       = '0'
                    AND FV.GLBL_CMPY_CD       = NV.GLBL_CMPY_CD
                    AND FV.FSR_NUM            = NV.FSR_NUM
                    AND FV.NEXT_FSR_VISIT_NUM = NV.FSR_VISIT_NUM
                    AND NV.FSR_VISIT_STS_CD   = #svcTaskStsPendPrt#
                    AND NV.EZCANCELFLAG       = '0'
                   )
        GROUP BY
            PR.FSR_NUM
           ,PR.SVC_TASK_NUM
           ,PR.RQST_TECH_TOC_CD
        ORDER BY
            FSR_NUM
           ,SVC_TASK_NUM
           ,LTST_WH_IN_ETA_DT
    </statement>

    <statement id="getRwsCreatedByPoCreateApi" parameterClass="Map" resultClass="Map">
        SELECT 
            RH.RWS_NUM
            ,RH.SCE_ORD_TP_CD
            ,RD.RWS_DTL_LINE_NUM
            ,RD.MDSE_CD
            ,RD.INVTY_STK_STS_CD                RWS_STK_STS_CD
            ,RD.RWS_QTY - RD.RWS_PUT_AWAY_QTY   RWS_BAL_QTY
            ,RH.TRX_ORD_NUM
            ,RD.TRX_LINE_NUM
            ,RH.RWS_REF_NUM
            ,PD.PO_ORD_NUM
            ,PD.PO_ORD_DTL_LINE_NUM
            ,RH.FROM_LOC_CD                     SHIP_FROM_LOC_CD
            ,RS.INVTY_LOC_CD
        FROM 
            RWS_HDR          RH
            ,RWS_DTL         RD
            ,RTL_WH          RW
            ,RTL_SWH         RS
            ,SCE_ORD_TP ST
            ,PO_DTL          PD
        WHERE 1=1
            AND RH.GLBL_CMPY_CD             =    #glblCmpyCd#
            AND RH.PO_RCV_TRX_HDR_NUM       =    #poOrdNum#
<!-- START 04/21/2020 T.Ogura [QC#56545,MOD] -->
<!--        AND RH.RWS_STS_CD        &lt;&gt;    #rwsStsCd# -->
            <iterate property="rwsStsCd" var="elem[]" open="AND RH.RWS_STS_CD NOT IN (" close=")" conjunction=",">
                #elem[]#
            </iterate>
<!-- END   04/21/2020 T.Ogura [QC#56545,MOD] -->
            AND RH.SCE_ORD_TP_CD     &lt;&gt;    #sceOrdTpCd#
            AND RH.GLBL_CMPY_CD             =    RD.GLBL_CMPY_CD
            AND RH.RWS_NUM                  =    RD.RWS_NUM
<!-- START 04/21/2020 T.Ogura [QC#56545,MOD] -->
<!--        AND RD.RWS_STS_CD        &lt;&gt;    #rwsStsCd# -->
            <iterate property="rwsStsCd" var="elem[]" open="AND RD.RWS_STS_CD NOT IN (" close=")" conjunction=",">
                #elem[]#
            </iterate>
<!-- END   04/21/2020 T.Ogura [QC#56545,MOD] -->
            AND RD.GLBL_CMPY_CD             =    RW.GLBL_CMPY_CD
            AND RD.RTL_WH_CD                =    RW.RTL_WH_CD
            AND RD.GLBL_CMPY_CD             =    RS.GLBL_CMPY_CD
            AND RD.RTL_WH_CD                =    RS.RTL_WH_CD
            AND RD.RTL_SWH_CD               =    RS.RTL_SWH_CD
            AND RH.GLBL_CMPY_CD             =    ST.GLBL_CMPY_CD
            AND RH.SCE_ORD_TP_CD            =    ST.SCE_ORD_TP_CD
            AND ST.INBD_OTBD_CD             =    '1'
            AND RH.GLBL_CMPY_CD             =    PD.GLBL_CMPY_CD(+)
            AND RH.PO_RCV_TRX_HDR_NUM       =    PD.PO_ORD_NUM(+)
            AND RD.PO_RCV_TRX_LINE_NUM      =    PD.PO_ORD_DTL_LINE_NUM(+)
            AND PD.EZCANCELFLAG(+)          =    '0'
            AND ST.EZCANCELFLAG             =    '0'
            AND RH.EZCANCELFLAG             =    '0'
            AND RD.EZCANCELFLAG             =    '0'
            AND RW.EZCANCELFLAG             =    '0'
            AND RS.EZCANCELFLAG             =    '0'
    </statement>

    <statement id="getRwsCreatedByAsnUnReceived" parameterClass="Map" resultClass="Map">
SELECT 
            RD.MDSE_CD
            ,SUM(RD.RWS_QTY - RD.RWS_PUT_AWAY_QTY) AS RWS_BAL_QTY

        FROM 
            RWS_HDR          RH
            ,RWS_DTL         RD
            ,RTL_WH          RW
            ,RTL_SWH         RSW
            ,SCE_ORD_TP      ST
            ,PO_DTL          PD
        WHERE 1=1
            AND RH.GLBL_CMPY_CD             =    #glblCmpyCd#
            AND RH.PO_RCV_TRX_HDR_NUM       =    #poOrdNum#
            AND RH.SCE_ORD_TP_CD            =    #sceOrdTpCd#
            AND RH.GLBL_CMPY_CD             =    RD.GLBL_CMPY_CD
            AND RH.RWS_NUM                  =    RD.RWS_NUM
        <iterate property="rwsStsCd" var="elem[]" open="AND  RD.RWS_STS_CD IN (" close=")" conjunction=",">
             #elem[]#
        </iterate>
            AND RD.GLBL_CMPY_CD  = RW.GLBL_CMPY_CD
            AND RD.RTL_WH_CD     = RW.RTL_WH_CD
            AND RD.GLBL_CMPY_CD  = RSW.GLBL_CMPY_CD
            AND RD.RTL_WH_CD     = RSW.RTL_WH_CD
            AND RD.RTL_SWH_CD    = RSW.RTL_SWH_CD
            AND RH.GLBL_CMPY_CD  = ST.GLBL_CMPY_CD
            AND RH.SCE_ORD_TP_CD = ST.SCE_ORD_TP_CD
            AND ST.INBD_OTBD_CD  = '1'
            AND RH.GLBL_CMPY_CD             =    PD.GLBL_CMPY_CD(+)
            AND RH.PO_RCV_TRX_HDR_NUM       =    PD.PO_ORD_NUM(+)
            AND RD.PO_RCV_TRX_LINE_NUM      =    PD.PO_ORD_DTL_LINE_NUM(+)
            AND PD.PO_ORD_NUM               =    #poOrdNum#
            AND PD.PO_ORD_DTL_LINE_NUM      =    #poOrdDtlLineNum#
            AND RH.EZCANCELFLAG             =    '0'
            AND RD.EZCANCELFLAG             =    '0'
            AND RW.EZCANCELFLAG             =    '0'
            AND RSW.EZCANCELFLAG            =    '0'
            AND ST.EZCANCELFLAG             =    '0'
            AND PD.EZCANCELFLAG(+)          =    '0'
        GROUP BY RD.MDSE_CD
    </statement>

    <statement id="getRecvedPoDtl" parameterClass="Map" resultClass="Map">
        SELECT 
             PD.PO_ORD_NUM
            ,PD.PO_ORD_DTL_LINE_NUM 
        FROM 
            PO_DTL      PD
        WHERE 1=1
            AND PD.GLBL_CMPY_CD             =    #glblCmpyCd#
            AND PD.PO_ORD_NUM               =    #poOrdNum#
            AND PD.PO_RCV_QTY        &lt;&gt;    #poRcvQty#
            AND PD.EZCANCELFLAG             =    '0'
    </statement>

    <statement id="getPoMatchTpCd" parameterClass="Map" resultClass="String">
        SELECT 
            PD.PO_MATCH_TP_CD
        FROM
            PO_DTL  PD
        WHERE 1=1
            AND PD.GLBL_CMPY_CD             =    #glblCmpyCd#
            AND PD.PO_ORD_NUM               =    #poOrdNum#
            AND PD.PO_ORD_DTL_LINE_NUM      =    #poOrdDtlLineNum#
            AND PD.EZCANCELFLAG             =    '0'
    </statement>

    <statement id="getNextPoOrdDtlLineNum" parameterClass="Map" resultClass="String">
        SELECT 
            LPAD (MAX(PO_ORD_DTL_LINE_NUM) + 1 , 3 , 0) AS SPLIT_PO_ORD_DTL_LINE_NUM
        FROM
            PO_DTL PD
        WHERE 1=1
            AND PD.GLBL_CMPY_CD             =    #glblCmpyCd#
            AND PD.PO_ORD_NUM               =    #poOrdNum#
            AND PD.EZCANCELFLAG             =    '0'
    </statement>
    
    <statement id="getPoOrdDtlLineNum" parameterClass="Map" resultClass="String">
        SELECT 
            ED.PO_ORD_DTL_LINE_NUM
        FROM
            EDI_ASN_DTL_WRK ED
        WHERE 1=1
            AND ED.GLBL_CMPY_CD             =    #glblCmpyCd#
            AND ED.ASN_SO_NUM               =    #asnSoNum#
            AND ED.ASN_LINE_NUM             =    #asnLineNum#
            AND ED.EZCANCELFLAG             =    '0'
    </statement>

    <statement id="getPrByPrUpdateApi" parameterClass="Map" resultClass="Map">
        SELECT
            PD1.PRCH_REQ_NUM          AS ORG_PRCH_REQ_NUM
           ,PD1.PRCH_REQ_LINE_NUM     AS ORG_PRCH_REQ_LINE_NUM
           ,PD1.PRCH_REQ_LINE_SUB_NUM AS ORG_PRCH_REQ_LINE_SUB_NUM
           ,PD1.SHIP_QTY              AS ORG_SHIP_QTY
           ,PR1.PRCH_REQ_REC_TP_CD
           ,PD2.PRCH_REQ_NUM          AS BASE_PRCH_REQ_NUM
           ,PD2.PRCH_REQ_LINE_NUM     AS BASE_PRCH_REQ_LINE_NUM
           ,PD2.PRCH_REQ_LINE_SUB_NUM AS BASE_PRCH_REQ_LINE_SUB_NUM
           ,PD2.SHIP_QTY              AS BASE_SHIP_QTY
        FROM
            PO_DTL       POD
           ,PRCH_REQ     PR1
           ,PRCH_REQ_DTL PD1
           ,PRCH_REQ_DTL PD2
        WHERE
            1=1
        AND POD.GLBL_CMPY_CD           = #glblCmpyCd#
        AND POD.PO_ORD_NUM             = #poOrdNum#
        AND POD.PO_ORD_DTL_LINE_NUM    = #poOrdDtlLineNum#
        AND POD.GLBL_CMPY_CD           = PD1.GLBL_CMPY_CD
        AND POD.TRX_REF_NUM            = PD1.PRCH_REQ_NUM
        AND POD.TRX_REF_LINE_NUM       = PD1.PRCH_REQ_LINE_NUM
        <!--AND POD.TRX_REF_LINE_SUB_NUM = PD1.PRCH_REQ_LINE_SUB_NUM -->
        AND PD1.PRCH_REQ_LINE_TP_CD    = #prchReqLineTpCdInsourcedPo#
        AND PD1.GLBL_CMPY_CD           = PR1.GLBL_CMPY_CD
        AND PD1.PRCH_REQ_NUM           = PR1.PRCH_REQ_NUM
        AND PR1.PRCH_REQ_REC_TP_CD     = #prchReqRecTpCdTech#
        AND POD.GLBL_CMPY_CD           = PD2.GLBL_CMPY_CD
        AND POD.PO_ORD_NUM             = PD2.PO_ORD_NUM
        AND POD.PO_ORD_DTL_LINE_NUM    = PD2.PO_ORD_DTL_LINE_NUM
        AND POD.EZCANCELFLAG           = '0'
        AND PD1.EZCANCELFLAG           = '0'
        AND PD2.EZCANCELFLAG           = '0'
        AND PR1.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getCmpsnChildQty" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            CMP.CHILD_MDSE_QTY
        FROM
            CMPSN CMP
        WHERE
            1=1
        AND CMP.GLBL_CMPY_CD           = #glblCmpyCd#
        AND CMP.PRNT_MDSE_CD           = #prntMdseCd#
        AND CMP.CHILD_MDSE_CD          = #childMdseCd#
        AND CMP.EZCANCELFLAG           = '0'
        UNION SELECT
            CMP.CHILD_MDSE_QTY
        FROM
             CMPSN CMP
            ,ORD_TAKE_MDSE OTM
        WHERE
            1=1
        AND CMP.GLBL_CMPY_CD           = #glblCmpyCd#
        AND CMP.PRNT_MDSE_CD           = #prntMdseCd#
        AND CMP.CHILD_ORD_TAKE_MDSE_CD = OTM.ORD_TAKE_MDSE_CD
        AND OTM.MDSE_CD                = #childMdseCd#
        AND CMP.EZCANCELFLAG           = '0'
        AND OTM.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getMdseCdFromPoDtl" parameterClass="Map" resultClass="Map">
        SELECT 
            PD.ASL_MDSE_CD ASL_MDSE_CD
           ,PD.MDSE_CD     MDSE_CD
        FROM
            PO_DTL PD
        WHERE 1=1
            AND PD.GLBL_CMPY_CD             =    #glblCmpyCd#
            AND PD.PO_ORD_NUM               =    #poOrdNum#
            AND PD.PO_ORD_DTL_LINE_NUM      =    #poOrdDtlLineNum#
            AND PD.EZCANCELFLAG             =    '0'
    </statement>

    <!-- START 2018/03/23 S.Katsuma [QC#24353,ADD] -->
    <statement id="getCarrCdFromOtbdCarr" parameterClass="Map" resultClass="String">
        SELECT
            OCV.CARR_CD
        FROM
            OTBD_CARR_V OCV
        WHERE
            OCV.GLBL_CMPY_CD =   #glblCmpyCd#
        AND OCV.CARR_CD      =   #carrCd#
        AND OCV.EZCANCELFLAG =   '0'
    </statement>
    <!-- END 2018/03/23 S.Katsuma [QC#24353,ADD] -->

    <statement id="cntCmbnSoCnt" parameterClass="Map" resultClass="Map">
        SELECT
             COUNT(CPSX.SO_NUM) AS SO_CNT
             ,COUNT(ED.GLBL_CMPY_CD) AS ED_CNT
        FROM
             EDI_ASN_DTL_WRK     ED
            ,CMBN_PO_SO_XREF     CPSX
            ,SHPG_ORD            SO
            ,SHPG_ORD_DTL        SOD
        WHERE 1=1
            AND ED.GLBL_CMPY_CD            = #glblCmpyCd#
            AND ED.ASN_SO_NUM              = #asnSoNum#
            AND ED.EZCANCELFLAG            = '0'
            AND ED.EDI_PO_ORD_DTL_LINE_NUM = CPSX.PO_ORD_DTL_LINE_NUM(+)
            AND CPSX.PO_ORD_NUM(+)         = #ediPoOrdNum#
            AND CPSX.EZCANCELFLAG(+)       = '0'
            AND CPSX.GLBL_CMPY_CD          = SO.GLBL_CMPY_CD(+)
            AND CPSX.SO_NUM                = SO.SO_NUM(+)
            AND SO.EZCANCELFLAG(+)         = '0'
            AND CPSX.GLBL_CMPY_CD          = SOD.GLBL_CMPY_CD(+)
            AND CPSX.SO_NUM                = SOD.SO_NUM(+)
            AND CPSX.SO_SLP_NUM            = SOD.SO_SLP_NUM(+)
            AND SOD.SHPG_STS_CD(+)         = #soPrinted#
            AND SOD.EZCANCELFLAG(+)        = '0'
    </statement>

    <statement id="getCmbnSoList" parameterClass="Map" resultClass="Map">
        SELECT
            CPSX.SO_NUM
           ,CPSX.SO_SLP_NUM
           ,SO.SCE_ORD_TP_CD
           ,SOD.INVTY_LOC_CD
           ,SOD.MDSE_CD
           ,SOD.FROM_STK_STS_CD
           ,SOD.SHPG_STS_CD
        FROM
             CMBN_PO_SO_XREF     CPSX
            ,SHPG_ORD            SO
            ,SHPG_ORD_DTL        SOD
        WHERE 1=1
            AND CPSX.GLBL_CMPY_CD = #glblCmpyCd#
            <isNotNull property="ediPoOrdNum">
            AND CPSX.PO_ORD_NUM   = #ediPoOrdNum#
            AND CPSX.PO_ORD_DTL_LINE_NUM = #ediPoOrdDtlLineNum#
            </isNotNull>
            <isNotNull property="soNum">
            AND CPSX.SO_NUM       = #soNum#
            AND CPSX.SO_SLP_NUM   = #soSlpNum#
            </isNotNull>
            AND CPSX.EZCANCELFLAG = '0'
            AND CPSX.GLBL_CMPY_CD = SO.GLBL_CMPY_CD
            AND CPSX.SO_NUM       = SO.SO_NUM
            AND SO.EZCANCELFLAG     = '0'
            AND CPSX.GLBL_CMPY_CD = SOD.GLBL_CMPY_CD
            AND CPSX.SO_NUM       = SOD.SO_NUM
            AND CPSX.SO_SLP_NUM   = SOD.SO_SLP_NUM
            AND SOD.SHPG_STS_CD   = #soPrinted#
            AND SOD.EZCANCELFLAG  = '0'
        ORDER BY
            CPSX.SO_NUM
           ,CPSX.SO_SLP_NUM
    </statement>

    <statement id="getSoSum" parameterClass="Map" resultClass="Map">
        SELECT
            COUNT(*)            COUNT
           ,SUM(SOD.SHPG_QTY)   SUM_ORD_QTY
        FROM
            SHPG_ORD_DTL        SOD
        WHERE
            SOD.GLBL_CMPY_CD    = #glblCmpyCd#
        AND SOD.SO_NUM          = #soNum#
        AND SOD.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getCmbnAsnSerNumWrk" parameterClass="Map" resultClass="Map">
        SELECT
            ES.SER_NUM
        FROM
             CMBN_PO_SO_XREF     CPSX
            ,EDI_ASN_HDR_WRK     EH
            ,EDI_ASN_DTL_WRK     ED
            ,EDI_ASN_SER_NUM_WRK ES
        WHERE 1=1
            AND CPSX.GLBL_CMPY_CD        = #glblCmpyCd#
            <isNotNull property="ediPoOrdNum">
            AND CPSX.PO_ORD_NUM          = #ediPoOrdNum#
            AND CPSX.PO_ORD_DTL_LINE_NUM = #ediPoOrdDtlLineNum#
            </isNotNull>
            <isNotNull property="soNum">
            AND CPSX.SO_NUM              = #soNum#
            AND CPSX.SO_SLP_NUM          = #soSlpNum#
            </isNotNull>
            AND CPSX.EZCANCELFLAG        = '0'
            AND CPSX.GLBL_CMPY_CD        = EH.GLBL_CMPY_CD
            AND CPSX.PO_ORD_NUM          = EH.EDI_PO_ORD_NUM
            AND EH.ASN_SO_NUM            = #asnSoNum#
            AND EH.EZCANCELFLAG          = '0'
            AND EH.GLBL_CMPY_CD          = ED.GLBL_CMPY_CD
            AND EH.ASN_SO_NUM            = ED.ASN_SO_NUM
            AND CPSX.PO_ORD_DTL_LINE_NUM = ED.EDI_PO_ORD_DTL_LINE_NUM
            AND ED.EZCANCELFLAG          = '0'
            AND ED.GLBL_CMPY_CD          = ES.GLBL_CMPY_CD
            AND ED.ASN_SO_NUM            = ES.ASN_SO_NUM
            AND ED.ASN_SO_SLP_NUM        = ES.ASN_SO_SLP_NUM
            AND ES.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getVndSysTpCd" parameterClass="Map" resultClass="String">
            SELECT
                VND_SYS_TP_CD
            FROM
                RCV_ASN_VND
            WHERE 1=1
            AND GLBL_CMPY_CD     = #glblCmpyCd#
            AND RCV_ASN_VND_CD   = #rcvAsnVndCd#
            AND EZCANCELFLAG     = '0'
            AND ROWNUM           = 1
    </statement>
    <!-- START 2023/07/18 TZ.Win [QC#61614, DEL] -->
    <!-- START 2023/05/24 TZ.Win [QC#60960, ADD] -->
    <!--
    <statement id="getPoDtlAsnDtlCount" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             EDI_ASN_HDR_WRK     EH
             ,EDI_ASN_DTL_WRK    ED
             ,PO_DTL             POD
             ,PO                 P
             ,ASL_DTL            AD
        WHERE 1=1
            AND EH.GLBL_CMPY_CD            = #glblCmpyCd#
            <isNotNull property="poOrdNum">
            AND EH.EDI_PO_ORD_NUM          = #poOrdNum#
            </isNotNull>
            AND EH.ASN_SO_NUM              = #asnSoNum#
            AND EH.EZCANCELFLAG            = '0'
            AND EH.GLBL_CMPY_CD            = ED.GLBL_CMPY_CD
            AND EH.ASN_SO_NUM              = ED.ASN_SO_NUM
            <isNotNull property="ediPoOrdDtlLineNum">
            AND ED.EDI_PO_ORD_DTL_LINE_NUM = #ediPoOrdDtlLineNum#
            </isNotNull>
            AND ED.EZCANCELFLAG            = '0'
            AND EH.GLBL_CMPY_CD            = POD.GLBL_CMPY_CD
            AND EH.EDI_PO_ORD_NUM          = POD.PO_ORD_NUM
            AND ED.PO_ORD_DTL_LINE_NUM     = POD.PO_ORD_DTL_LINE_NUM
            <isNotNull property="poOrdDtlLineNum">
            AND POD.PO_ORD_DTL_LINE_NUM    = #poOrdDtlLineNum#
            </isNotNull>
            AND POD.PO_LINE_STS_CD        IN (
            <iterate property="poLineStsCdList" var="poLineStsCd[]" open="" close="" conjunction=",">
            #poLineStsCd[]#
            </iterate>
            )
            AND POD.EZCANCELFLAG           = '0'
            AND POD.GLBL_CMPY_CD           = P.GLBL_CMPY_CD
	        AND POD.PO_ORD_NUM             = P.PO_ORD_NUM
	        AND P.EZCANCELFLAG             = '0'
            AND POD.GLBL_CMPY_CD           = AD.GLBL_CMPY_CD
	        AND POD.MDSE_CD                = AD.MDSE_CD
	        AND ED.ASN_MDSE_CD             = AD.SPLY_ITEM_NUM
	        AND AD.VND_CD                  = P.VND_CD
	        AND AD.EFF_FROM_DT        &lt; = #slsDate#
	        AND NVL ( AD.EFF_THRU_DT  , '99991231' )  &gt; = #slsDate#
	        AND AD.EZCANCELFLAG            = '0'
    </statement>
    -->
    <!-- END 2023/05/24 TZ.Win [QC#60960, ADD] -->
    <!-- END 2023/07/18 TZ.Win [QC#61614, DEL] -->
</sqlMap>
