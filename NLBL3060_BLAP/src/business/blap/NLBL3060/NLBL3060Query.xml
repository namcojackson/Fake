<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NLBL3060Query">

    <typeAlias alias="NLBL3060CMsg"      type="business.blap.NLBL3060.NLBL3060CMsg"/>
    <typeAlias alias="NLBL3060_ASMsg"    type="business.blap.NLBL3060.NLBL3060_ASMsg"/>

    <resultMap id="result.getNLBL3060"    class="NLBL3060_ASMsg">
        <result property="glblCmpyCd_A1"        column="GLBL_CMPY_CD"           javaType="EZDCStringItem"/>
        <!-- QC#61793 Start -->
        <result property="rtlWhCatgCd_A1"       column="RTL_WH_CATG_CD"         javaType="EZDCStringItem"/>
        <result property="physWhCd_A1"          column="PHYS_WH_CD"             javaType="EZDCStringItem"/>
        <result property="schdCoordWhPmsnPk_A1" column="SCHD_COORD_WH_PMSN_PK"  javaType="EZDCStringItem"/>
        <!-- QC#61793 End -->
        <result property="rtlWhCd_A1"           column="RTL_WH_CD"              javaType="EZDCStringItem"/>
        <result property="rtlWhNm_A1"           column="RTL_WH_NM"              javaType="EZDCStringItem"/>
        <result property="schdCoordPsnCd_A1"    column="SCHD_COORD_PSN_CD"      javaType="EZDCStringItem"/>
        <result property="fullPsnNm_A1"         column="FULL_PSN_NM"            javaType="EZDCStringItem"/>
        <result property="effFromDt_A1"         column="EFF_FROM_DT"            javaType="EZDCStringItem"/>
        <result property="effThruDt_A1"         column="EFF_THRU_DT"            javaType="EZDCStringItem"/>
        <result property="effThruDt_A2"         column="EFF_THRU_DT"            javaType="EZDCStringItem"/>
        <result property="ezUpTime_A1"          column="EZUPTIME"               javaType="EZDCStringItem"/>
        <result property="ezUpTimeZone_A1"      column="EZUPTIMEZONE"           javaType="EZDCStringItem"/>
    </resultMap>

    <statement id="getMasterTable" parameterClass="Map" resultMap="result.getNLBL3060">
        SELECT 
             PMSN.GLBL_CMPY_CD              GLBL_CMPY_CD
            <!-- QC#61793 Start -->
            ,PMSN.SCHD_COORD_WH_PMSN_PK     SCHD_COORD_WH_PMSN_PK
            ,PMSN.RTL_WH_CATG_CD            RTL_WH_CATG_CD
            ,PMSN.PHYS_WH_CD                PHYS_WH_CD
            <!-- QC#61793 End -->
            ,PMSN.SCHD_COORD_PSN_CD         SCHD_COORD_PSN_CD
            <!-- QC#15574 Start ,PSN.FULL_PSN_NM                FULL_PSN_NM QC#15574 End-->
            <!-- QC#15574 Start -->
            ,PSN.FIRST_NM || ' ' || PSN.LAST_NM  FULL_PSN_NM
            <!-- QC#15574 End -->
            ,PMSN.RTL_WH_CD                 RTL_WH_CD
            ,RWH.RTL_WH_NM                  RTL_WH_NM
            ,PMSN.EFF_FROM_DT               EFF_FROM_DT
            ,PMSN.EFF_THRU_DT               EFF_THRU_DT
            ,NVL(PMSN.EZUPTIME, '*')        EZUPTIME
            ,NVL(PMSN.EZUPTIMEZONE, '*')    EZUPTIMEZONE
        FROM 
            SCHD_COORD_WH_PMSN PMSN
            <!-- QC#15574 Start -->
            <!-- ,S21_PSN_V          PSN  -->
           ,AUTH_PSN          PSN
            <!-- QC#15574 End -->
           ,RTL_WH             RWH
        WHERE
                PMSN.GLBL_CMPY_CD          = #glblCmpyCd#
            AND    PMSN.EZCANCELFLAG       = '0'
        <isNotNull property="rtlWhCd">
            AND    PMSN.RTL_WH_CD          = #rtlWhCd#
        </isNotNull>

        <isNotNull property="schdCoordPsnCd">
            AND    PMSN.SCHD_COORD_PSN_CD  = #schdCoordPsnCd#
        </isNotNull>
        <!-- QC#61793 Start -->
        <isNotNull property="rtlWhCatgCd">
            AND PMSN.RTL_WH_CATG_CD = #rtlWhCatgCd#
        </isNotNull>
        <isNotNull property="physWhCd">
            AND PMSN.PHYS_WH_CD LIKE #physWhCd#
        </isNotNull>
        <!-- QC#61793 End -->
            AND PMSN.GLBL_CMPY_CD          = RWH.GLBL_CMPY_CD (+)
            AND PMSN.RTL_WH_CD             = RWH.RTL_WH_CD (+)
            AND PMSN.EZCANCELFLAG (+)      = '0'

            AND PMSN.GLBL_CMPY_CD          = PSN.GLBL_CMPY_CD (+)
            <!-- QC#15574 Start -->
            <!-- AND PMSN.SCHD_COORD_PSN_CD     = PSN.PSN_CD (+) -->
            AND PMSN.SCHD_COORD_PSN_CD     = PSN.USR_NM (+) 
            <!-- QC#15574 End -->
            AND PMSN.EZCANCELFLAG (+)      = '0'

        <isEqual property="xxChkBox" compareValue="Y">
            AND PMSN.EFF_FROM_DT           &lt;= #slsDt#
            AND NVL(PMSN.EFF_THRU_DT, '99991231') &gt;= #slsDt#
        </isEqual>

        ORDER BY
            <!-- QC#61793 Start -->
            RTL_WH_CATG_CD
            ,PHYS_WH_CD
            
            <!-- QC#61793 End -->
            ,RTL_WH_CD
            ,SCHD_COORD_PSN_CD
    </statement>

    <statement id="countDuplicate" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            COUNT(1)
        FROM 
            SCHD_COORD_WH_PMSN PMSN
        WHERE
                PMSN.GLBL_CMPY_CD          =     #glblCmpyCd#
            <!-- QC#61793 Start -->
            <isNotNull property="rtlWhCatgCd">
            AND PMSN.RTL_WH_CATG_CD        =     #rtlWhCatgCd#
            </isNotNull>
            <isNotNull property="physWhCd">
            AND PMSN.PHYS_WH_CD            =     #physWhCd#
            </isNotNull>
            <isNotNull property="rtlWhCd">
            <!-- QC#61793 End -->
            AND PMSN.RTL_WH_CD             =     #rtlWhCd#
            <!-- QC#61793 Start -->
            </isNotNull>
            <!-- QC#61793 End -->
            AND PMSN.SCHD_COORD_PSN_CD     =     #schdCoordPsnCd#
            AND PMSN.EFF_FROM_DT           &lt;= #effThruDt#
            AND NVL(PMSN.EFF_THRU_DT, '99991231') &gt;= #effFromDt#
            AND PMSN.EZCANCELFLAG          =     '0'
    </statement>
<!-- QC#15574 Start
    <statement id="getPersonNm" parameterClass="Map" resultClass="String">
        SELECT 
             FULL_PSN_NM
        FROM 
            S21_PSN_V PSN
        WHERE
                   PSN.GLBL_CMPY_CD          = #glblCmpyCd#
            AND    PSN.PSN_CD                = #psnCd#
            AND    PSN.EZCANCELFLAG          = '0'
    </statement>
QC#15574 End --> 

<!-- QC#15574 Start -->
    <statement id="getPersonNm" parameterClass="Map" resultClass="String">
        SELECT 
             PSN.FIRST_NM || ' ' || PSN.LAST_NM  FULL_PSN_NM
        FROM 
            AUTH_PSN PSN
        WHERE
                   PSN.GLBL_CMPY_CD          = #glblCmpyCd#
            AND    PSN.USR_NM                = #psnCd#
            AND    PSN.EZCANCELFLAG          = '0'
    </statement>
<!-- QC#15574 End -->

<!-- QC#61793 Start -->
    <statement id="getGroupName" parameterClass="Map" resultClass="String">
        SELECT
             RWH.PHYS_WH_CD
        FROM 
             RTL_WH RWH
        WHERE
              RWH.GLBL_CMPY_CD                = #glblCmpyCd#
              AND    RWH.PHYS_WH_CD           = #physWhCd#
              AND    RWH.EZCANCELFLAG         = '0'
    </statement>
    
    <statement id="countDuplicateForUpdate" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            COUNT(1)
        FROM 
            SCHD_COORD_WH_PMSN PMSN
        WHERE
                PMSN.GLBL_CMPY_CD          =     #glblCmpyCd#
             AND PMSN.SCHD_COORD_WH_PMSN_PK         ! =     #schdCoordWhPmsnPk#
            <isNotNull property="rtlWhCatgCd">
            AND PMSN.RTL_WH_CATG_CD        =     #rtlWhCatgCd#
            </isNotNull>
            <isNotNull property="physWhCd">
            AND PMSN.PHYS_WH_CD            =     #physWhCd#
            </isNotNull>
            <isNotNull property="rtlWhCd">
            AND PMSN.RTL_WH_CD             =     #rtlWhCd#
            </isNotNull>
            AND PMSN.SCHD_COORD_PSN_CD     =     #schdCoordPsnCd#
            AND PMSN.EFF_FROM_DT           &lt;= #effThruDt#
            AND NVL(PMSN.EFF_THRU_DT, '99991231') &gt;= #effFromDt#
            AND PMSN.EZCANCELFLAG          =     '0'
    </statement>
    
    <statement id="getWhTypeList" parameterClass="Map" resultClass="Map">
          SELECT
               RWC.RTL_WH_CATG_CD
              ,RWC.RTL_WH_CATG_DESC_TXT AS RTL_WH_CATG_NM
              ,RWC.LOC_TP_CD
              ,RWC.WH_OWNR_CD
              ,RWC.WH_SYS_TP_CD
          FROM
               RTL_WH_CATG RWC
         WHERE
               1=1
           AND RWC.GLBL_CMPY_CD  = #glblCmpyCd#
           AND RWC.EZCANCELFLAG  = '0'
         ORDER BY
               RWC.RTL_WH_CATG_SORT_NUM

    </statement>
    <statement id="getSchdCoordWhPmsnPk" parameterClass="Map" resultClass="String">
        SELECT 
             PMSN.SCHD_COORD_WH_PMSN_PK SCHD_COORD_WH_PMSN_PK
        FROM 
            SCHD_COORD_WH_PMSN PMSN
        WHERE
            PMSN.GLBL_CMPY_CD          =     #glblCmpyCd#
            <isNotNull property="rtlWhCatgCd">
            AND PMSN.RTL_WH_CATG_CD        =     #rtlWhCatgCd#
            </isNotNull>
            <isNotNull property="physWhCd">
            AND PMSN.PHYS_WH_CD            =     #physWhCd#
            </isNotNull>
            <isNotNull property="rtlWhCd">
            AND PMSN.RTL_WH_CD             =     #rtlWhCd#
            </isNotNull>
            AND PMSN.SCHD_COORD_PSN_CD     =     #schdCoordPsnCd#
            AND PMSN.EFF_FROM_DT           =     #effFromDt#
            AND PMSN.EZCANCELFLAG          =     '0'
    </statement>
    <statement id="getRtlWhCatgCdList" parameterClass="Map" resultClass="Map">
          SELECT
              RTL_WH_CATG_CD
              ,RTL_WH_CATG_NM
          FROM
              RTL_WH_CATG RWC
          WHERE
              RWC.GLBL_CMPY_CD  =  #glblCmpyCd#
          AND RWC.EZCANCELFLAG  =  '0'
          ORDER BY RWC.RTL_WH_CATG_CD
    </statement>
<!-- QC#61793 End -->

</sqlMap>
