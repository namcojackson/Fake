<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPAB139001">
    <statement id="getPrInterface" parameterClass="Map" resultClass="Map">
        SELECT
             PRCH.PRCH_REQ_NUM
            ,PRCD.PRCH_REQ_LINE_NUM
            ,PRCD.PRCH_REQ_LINE_SUB_NUM
            ,PRCH.GLBL_CMPY_CD
            ,PRCH.PRCH_REQ_REC_TP_CD
            ,PRCH.PRCH_REQ_TP_CD
            ,PRCH.PRCH_REQ_STS_CD
            ,PRCH.PRCH_REQ_CRAT_DT
            ,PRCH.PRCH_REQ_CRAT_TM
            ,PRCH.PRCH_REQ_CRAT_TZ
            ,PRCH.PRCH_REQ_CRAT_DISP_DT_TM_TS
            ,PRCH.PRCH_REQ_CRAT_BY_PSN_CD
            ,PRCH.PRCH_REQ_CRAT_BY_NM
            ,PRCH.PRCH_REQ_RQST_BY_PSN_CD
            ,PRCH.PRCH_REQ_SRC_TP_CD
            ,PRCH.PRCH_GRP_CD
            ,PRCH.FSR_NUM
            ,PRCH.SVC_TASK_NUM
            ,PRCH.SVC_MACH_SER_NUM
            ,PRCH.TRX_REF_NUM
            ,PRCH.CPO_ORD_NUM
            ,PRCH.CUST_ISS_PO_NUM
            ,PRCH.CUST_ISS_PO_DT
            ,PRCH.CPO_ORD_TP_CD
            ,PRCH.CTAC_PSN_NM
            ,PRCH.ADMIN_PSN_CD
            ,PRCH.PRCH_REQ_APVL_STS_CD
            ,PRCH.PRCH_REQ_APVL_DT
            ,PRCH.PRCH_REQ_APVL_BY_PSN_CD
            ,PRCH.PRCH_REQ_APVL_BY_NM
            ,PRCH.RQST_TECH_TOC_CD
            ,PRCH.SHIP_TO_CUST_CD
            ,PRCH.SHIP_TO_LOC_NM
            ,PRCH.SHIP_TO_ADDL_LOC_NM
            ,PRCH.SHIP_TO_FIRST_LINE_ADDR
            ,PRCH.SHIP_TO_SCD_LINE_ADDR
            ,PRCH.SHIP_TO_THIRD_LINE_ADDR
            ,PRCH.SHIP_TO_FRTH_LINE_ADDR
            ,PRCH.SHIP_TO_FIRST_REF_CMNT_TXT
            ,PRCH.SHIP_TO_SCD_REF_CMNT_TXT
            ,PRCH.SHIP_TO_CTY_ADDR
            ,PRCH.SHIP_TO_ST_CD
            ,PRCH.SHIP_TO_PROV_NM
            ,PRCH.SHIP_TO_CNTY_NM
            ,PRCH.SHIP_TO_POST_CD
            ,PRCH.SHIP_TO_CTRY_CD
            ,PRCH.BILL_TO_CUST_CD
            ,PRCH.SELL_TO_CUST_CD
            ,PRCH.ASL_SHIP_TO_CUST_CD
            ,PRCH.LINE_BIZ_TP_CD
            ,PRCH.PO_QLFY_CD
            ,PRCH.VND_DROP_SHIP_FLG
            ,PRCH.PRCH_REQ_CMNT_TXT
            ,PRCD.SPCL_INSTN_CMNT_TXT
            ,PRCH.DELY_ADDL_CMNT_TXT
            ,PRCH.RCV_ADDL_CMNT_TXT
            ,PRCH.BAT_ERR_MSG_TXT
            <!-- START 2023/02/16 TZ.Win [QC#60966, ADD] -->
            <!-- ,PRCH.RQST_SHIP_DT -->
            <!-- END 2023/02/16 TZ.Win [QC#60966, ADD] -->
            <!--  2023/10/18 QC#61870 START -->
            ,PRCH.RQST_SHIP_DT AS RQST_SHIP_DT_H
            <!--  2023/10/18 QC#61870 END -->
            ,PRCD.PRCH_REQ_LINE_NUM
            ,PRCD.PRCH_REQ_LINE_SUB_NUM
            ,PRCD.GLBL_CMPY_CD
            ,PRCD.PRCH_REQ_INTFC_PK
            ,PRCD.ORIG_PRCH_REQ_LINE_NUM
            ,PRCD.ORIG_PRCH_REQ_LINE_SUB_NUM
            ,PRCD.PRCH_REQ_LINE_TP_CD
            ,PRCD.PRCH_REQ_LINE_STS_CD
            ,PRCD.PRCH_REQ_CRAT_DT
            ,PRCD.PRCH_REQ_CRAT_TM
            ,PRCD.RQST_RCV_DT
            ,PRCD.RQST_RCV_TM
            ,PRCD.RQST_RCV_TZ
            ,PRCD.RQST_RCV_DISP_DT_TM_TS
            ,PRCD.PO_SCHD_REL_DT
            ,PRCD.PRCH_REQ_REL_STS_CD
            ,PRCD.PRCH_REQ_REL_DT_TM_TS
            ,PRCD.PRCH_REQ_REL_ERR_MSG_TXT
            ,PRCD.PRCH_REQ_FRZ_FLG
            ,PRCD.SHPG_PLN_NUM
            ,PRCD.SHIP_FROM_SO_NUM
            ,PRCD.PROCR_TP_CD
            ,PRCD.DEST_INVTY_LOC_CD
            ,PRCD.DEST_RTL_WH_CD
            ,PRCD.DEST_RTL_SWH_CD
            ,PRCD.SRC_INVTY_LOC_CD
            ,PRCD.SRC_RTL_WH_CD
            ,PRCD.SRC_RTL_SWH_CD
            ,PRCD.PRNT_VND_CD
            ,PRCD.VND_CD
            ,PRCD.VND_INVTY_LOC_CD
            ,PRCD.SHPG_SVC_LVL_CD
            ,PRCD.CARR_CD
            ,PRCD.CARR_ACCT_NUM
            ,PRCD.CONFIG_TP_CD
            ,PRCD.SVC_CONFIG_MSTR_PK
            ,PRCD.MDSE_CD
            ,PRCD.PO_MDSE_CMPSN_TP_CD
            ,PRCD.ORIG_RQST_MDSE_CD
            ,PRCD.ASL_MDSE_CD
            ,PRCD.PRCH_REQ_QTY
            ,PRCD.ORD_QTY
            ,PRCD.CUST_UOM_CD
            ,PRCD.PRCH_REQ_DISP_QTY
            ,PRCD.PRCH_REQ_DSPL_UOM_CD
            ,PRCD.PRCH_REQ_REL_QTY
            ,PRCD.PRCH_REQ_BAL_QTY
            ,PRCD.PRCH_REQ_INSRC_QTY
            ,PRCD.PRCH_REQ_CANC_QTY
            ,PRCD.ROP_QTY
            ,PRCD.MIN_ORD_QTY
            ,PRCD.INCR_ORD_QTY
            ,PRCD.MAX_INVTY_QTY
            ,PRCD.CUR_INVTY_QTY
            ,PRCD.CUR_INVTY_AVAL_QTY
            ,PRCD.SCHD_INBD_QTY
            ,PRCD.SCHD_OTBD_QTY
            ,PRCD.INSRC_FLG
            ,PRCD.PO_CRAT_FLG
            ,PRCD.REL_RQST_TO_PO_ORD_NUM
            ,PRCD.PO_ORD_NUM
            ,PRCD.PO_ORD_DTL_LINE_NUM
            ,PRCD.INVTY_ORD_NUM
            ,PRCD.INVTY_ORD_LINE_NUM
            ,PRCD.WRK_ORD_NUM
            ,PRCD.WRK_ORD_DTL_LINE_NUM
            ,PRCD.TRX_REF_NUM
            ,PRCD.TRX_REF_LINE_NUM
            ,PRCD.TRX_REF_LINE_SUB_NUM
            ,PRCD.PRCH_REQ_LINE_CMNT_TXT
            ,PRCD.BO_EML_PROC_STS_CD
            ,PRCD.SO_NUM
            ,PRCD.PRO_NUM
            ,PRCD.SHIP_DT_TM_TS
            ,PRCD.SHIP_QTY
            ,PRCD.RWS_NUM
            ,PRCD.RWS_CLO_DT_TM_TS
            ,PRCD.RWS_PUT_AWAY_QTY
            ,PRCD.BACK_TO_TECH_QTY
            ,PRCD.FROM_STK_STS_CD
            ,PRCD.TO_STK_STS_CD
            ,PRCD.THIS_MTH_FOB_COST_AMT
            ,PRCD.ASL_DTL_PK
            ,PRCD.ASL_UNIT_PRC_AMT
            ,PRCD.ENT_DEAL_NET_UNIT_PRC_AMT
            ,PRCD.ENT_PO_DTL_DEAL_NET_AMT
            ,PRCD.ENT_FUNC_NET_UNIT_PRC_AMT
            ,PRCD.ENT_PO_DTL_FUNC_NET_AMT
            ,PRCD.CCY_CD
            ,PRCD.EXCH_RATE
            ,PRCD.FRT_CHRG_TO_CD
            ,PRCD.FRT_CHRG_METH_CD
            ,PRCD.FRT_COND_CD
            ,PRCD.VND_PMT_TERM_CD
            ,PRCD.VND_PMT_TERM_DESC_TXT
            ,PRCD.COA_CMPY_CD
            ,PRCD.COA_AFFL_CD
            ,PRCD.COA_BR_CD
            ,PRCD.COA_CH_CD
            ,PRCD.COA_CC_CD
            ,PRCD.COA_ACCT_CD
            ,PRCD.COA_PROJ_CD
            ,PRCD.COA_EXTN_CD
            ,PRCD.COA_PROD_CD
            ,PRCD.TECH_RQST_NTC_ML_PROC_CD
            ,PRCD.TECH_RTN_NTC_ML_PROC_CD
            ,PRCD.VND_RTRN_RSN_CD
            ,PRCD.BAT_ERR_MSG_TXT
            ,PRCT.DS_PO_TP_CD
            ,PRCS.PO_ORD_SRC_CD
            ,DACT.DS_ACCT_NM
            ,PRLT.PO_LINE_TP_CD
            ,PRCD.PO_MDSE_CMPSN_TP_CD
            <!-- START 2023/02/16 TZ.Win [QC#60966, ADD] -->
            <!-- ,PRCD.RQST_SHIP_DT -->
            <!-- END 2023/02/16 TZ.Win [QC#60966, ADD] -->
            <!--  2023/10/18 QC#61870 START -->
            ,PRCD.RQST_SHIP_DT AS RQST_SHIP_DT_D
            <!--  2023/10/18 QC#61870 END -->
            <iterate property="constValues" var="constValue[]" open=",CASE WHEN PRCD.MDSE_CD IN(" conjunction= ", " close=")">
                #constValue[]#
            </iterate>
            <isNotNull property="constValues">
                THEN 
                    'Y'
                ELSE
                    'N'
                END AS CUSTOM_FLG
            </isNotNull>
            <isNull property="constValues">
            ,'N' AS CUSTOM_FLG
            </isNull>
            ,CASE WHEN PRCD.PO_MDSE_CMPSN_TP_CD IN(#parent#, #child#) THEN 1
                  WHEN EXISTS (SELECT
                                   1
                               FROM
                                   RCV_ASN_VND RAV
                               WHERE
                                   RAV.GLBL_CMPY_CD   = PRCD.GLBL_CMPY_CD
                               AND RAV.RCV_ASN_VND_CD = PRCD.VND_CD
                               AND RAV.VND_SYS_TP_CD  = #parts#
                               AND RAV.EZCANCELFLAG   = '0'
                               ) 
                  THEN
                      ROW_NUMBER() OVER(PARTITION BY PRCD.PRCH_REQ_NUM ,PRCD.MDSE_CD ORDER BY PRCD.PRCH_REQ_NUM, PRCD.PRCH_REQ_LINE_NUM, PRCD.PRCH_REQ_LINE_SUB_NUM)
                  ELSE 1
             END AS MDSE_ROW_NUMBER
            ,PRCD.MDSE_DESC_SHORT_TXT
            ,P.PO_STS_CD AS EXIST_PO_STS_CD
            ,P.PO_APVL_STS_CD AS EXIST_PO_APVL_STS_CD
            <!-- START 2023/07/28 R.Takau [QC#60676,ADD] -->
            ,(
             SELECT
                 B.SPCL_HDLG_TP_DESC_TXT
             FROM
                  CPO A
                 ,SPCL_HDLG_TP B
             WHERE
                     A.GLBL_CMPY_CD    = PRCH.GLBL_CMPY_CD
                 AND A.CPO_ORD_NUM     = PRCH.CPO_ORD_NUM
                 AND A.EZCANCELFLAG    = '0'
                 AND A.GLBL_CMPY_CD    = B.GLBL_CMPY_CD
                 AND A.SPCL_HDLG_TP_CD = B.SPCL_HDLG_TP_CD
                 AND EXISTS (SELECT
                                 1
                             FROM
                                 PRCH_REQ_INTFC C
                             WHERE
                                 C.GLBL_CMPY_CD = PRCH.GLBL_CMPY_CD
                             AND C.PRCH_REQ_NUM = PRCH.PRCH_REQ_NUM
                             AND C.EZCANCELFLAG = '0'
                             )
            )  AS SPCL_HDLG_TP_DESC_TXT
            <!-- END 2023/07/28 R.Takau [QC#60676,ADD] -->
        FROM
            PRCH_REQ                PRCH
           ,PRCH_REQ_DTL            PRCD
           ,PRCH_REQ_APVL_STS       PRCA
           ,PRCH_REQ_TP             PRCT
           ,PRCH_REQ_SRC_TP         PRCS
           ,SELL_TO_CUST            DACT
           ,PRCH_REQ_LINE_TP        PRLT
           ,PO                      P
        WHERE
            PRCH.GLBL_CMPY_CD                        = #GLBL_CMPY_CD#
        AND PRCH.PRCH_REQ_REC_TP_CD                  = #PRCH_REQ_REC_TP_CD#
        <!-- STR 2017/09/25 QC#21006 -->
        AND PRCH.PRCH_REQ_TP_CD                     != #prchReqTpITTO#
        <!-- END 2017/09/25 QC#21006 -->
        AND PRCH.EZCANCELFLAG                        = '0'
        AND PRCH.GLBL_CMPY_CD                        = PRCA.GLBL_CMPY_CD
        AND PRCH.PRCH_REQ_APVL_STS_CD                = PRCA.PRCH_REQ_APVL_STS_CD
        AND PRCA.PRCH_REQ_APVL_FLG                   = #PRCH_REQ_APVL_FLG#
        AND PRCA.EZCANCELFLAG                        = '0'
        AND PRCH.GLBL_CMPY_CD                        = PRCD.GLBL_CMPY_CD
        AND PRCH.PRCH_REQ_NUM                        = PRCD.PRCH_REQ_NUM
        <!-- STR 2016/07/11 R.Shimamoto QC#9150 MOD -->
        AND PRCD.PO_SCHD_REL_DT                    &lt;= #PO_SCHD_REL_DT#
        <!-- END 2016/07/11 R.Shimamoto QC#9150 MOD -->
        AND NVL(PRCD.PRCH_REQ_REL_STS_CD, ' ')       = #PRCH_REQ_REL_STS_CD#
        AND PRCD.EZCANCELFLAG                        = '0'
        AND PRCH.GLBL_CMPY_CD                        = PRCT.GLBL_CMPY_CD
        AND PRCH.PRCH_REQ_TP_CD                      = PRCT.PRCH_REQ_TP_CD
        AND PRCT.EZCANCELFLAG                        = '0'
        AND PRCH.GLBL_CMPY_CD                        = PRCS.GLBL_CMPY_CD
        AND PRCH.PRCH_REQ_SRC_TP_CD                  = PRCS.PRCH_REQ_SRC_TP_CD
        AND PRCS.EZCANCELFLAG                        = '0'
        AND PRCH.GLBL_CMPY_CD                        = DACT.GLBL_CMPY_CD(+)
        AND PRCH.SELL_TO_CUST_CD                     = DACT.SELL_TO_CUST_CD (+)
        AND DACT.EZCANCELFLAG(+)                     = '0'
        AND PRCD.GLBL_CMPY_CD                        = PRLT.GLBL_CMPY_CD(+)
        AND PRCD.PRCH_REQ_LINE_TP_CD                 = PRLT.PRCH_REQ_LINE_TP_CD (+)
        AND PRLT.EZCANCELFLAG(+)                     = '0'
        AND PRCD.GLBL_CMPY_CD                        = P.GLBL_CMPY_CD(+)
        AND PRCD.REL_RQST_TO_PO_ORD_NUM              = P.PO_ORD_NUM(+)
        AND P.EZCANCELFLAG(+)                        = '0'
        ORDER BY
            MDSE_ROW_NUMBER
           ,PRCH.PRCH_REQ_SRC_TP_CD
           ,PRCH.TRX_REF_NUM
           ,PRCD.PRCH_REQ_NUM
           ,PRCD.REL_RQST_TO_PO_ORD_NUM
           ,PRCD.VND_CD
           ,PRCD.DEST_INVTY_LOC_CD
           ,PRCD.RQST_RCV_DT
           ,PRCD.RQST_RCV_TM
           ,PRCD.VND_INVTY_LOC_CD
           ,PRCD.FRT_CHRG_TO_CD
           ,PRCD.FRT_CHRG_METH_CD
           ,PRCD.FRT_COND_CD
           ,PRCD.SHPG_SVC_LVL_CD
           ,PRCD.CARR_CD
           ,PRCD.CARR_ACCT_NUM
           <isNotNull property="constValues">
           ,CUSTOM_FLG
           </isNotNull>
           ,PRCD.PRCH_REQ_LINE_NUM
           ,PRCD.PRCH_REQ_LINE_SUB_NUM
    </statement>

    <statement id="getPoMsgTxt" parameterClass="Map" resultClass="Map">
        SELECT
            PM.PO_MSG_PK
           ,PM.PO_MSG_TP_CD
           ,PM.PO_MSG_SUBMT_PSN_CD
           ,PM.PO_MSG_TXT
           ,PM.PRCH_REQ_NUM
           ,PM.PRCH_REQ_LINE_NUM
           ,PM.PRCH_REQ_LINE_SUB_NUM
        FROM
            PO_MSG PM
        WHERE
            PM.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND PM.EZCANCELFLAG             = '0'
        AND PM.PRCH_REQ_NUM             = #PRCH_REQ_NUM#
        ORDER BY
            PM.PO_MSG_PK
    </statement>

    <statement id="getSerNum" parameterClass="Map" resultClass="Map">
        SELECT
            PRD.MDSE_CD
           ,PRS.SER_NUM
        FROM
            PRCH_REQ_DTL PRD
           ,PRCH_REQ_SER PRS
        WHERE
            PRD.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND PRD.PRCH_REQ_NUM             = #PRCH_REQ_NUM#
        AND PRD.PRCH_REQ_LINE_NUM        = #PRCH_REQ_LINE_NUM#
        AND PRD.PRCH_REQ_LINE_SUB_NUM    = #PRCH_REQ_LINE_SUB_NUM#
        AND PRD.PRCH_REQ_NUM             = PRS.PRCH_REQ_NUM
        AND PRD.PRCH_REQ_LINE_NUM        = PRS.PRCH_REQ_LINE_NUM
        AND PRD.PRCH_REQ_LINE_SUB_NUM    = PRS.PRCH_REQ_LINE_SUB_NUM
        AND PRD.EZCANCELFLAG             = '0'
        AND PRS.EZCANCELFLAG             = '0'
        AND ROWNUM                   = 1
        ORDER BY
            PRS.SER_NUM DESC
    </statement>

    <statement id="getReleasePoInfo" parameterClass="Map" resultClass="Map">
        SELECT 
            PO.PO_ORD_NUM
           ,PO.DS_PO_TP_CD
           ,PO.DS_PO_TP_NM
           ,PO.PO_QLFY_CD
           ,PO.PO_SUBMT_PSN_CD
           ,PO.PO_SUBMT_TS
           ,PO.PO_APVL_STS_CD
           ,PO.PO_APVL_PSN_CD
           ,PO.PO_APVL_DT
           ,PO.PO_APVL_TS
           ,PO.DEST_RTL_WH_CD
           ,PO.SRC_RTL_WH_CD
           ,PO.PO_ORD_SRC_CD
           ,PO.PRNT_VND_CD
           ,PO.PRNT_VND_NM
           ,PO.VND_CD
           ,PO.VND_NM
           ,PDT.CCY_CD
           ,PO.VND_DROP_SHIP_FLG
           ,PO.PRCH_GRP_CD
           ,PO.VND_PMT_TERM_CD
           ,PO.VND_PMT_TERM_DESC_TXT
           ,PO.RQST_TECH_TOC_CD
           ,PO.RQST_RCV_DT
           ,PO.RQST_RCV_TM
           ,PDT.SHIP_TO_CUST_CD
           ,PDT.SHIP_TO_LOC_NM
           ,PDT.SHIP_TO_ACCT_NM
           ,PDT.SHIP_TO_ADDL_LOC_NM
           ,PDT.SHIP_TO_FIRST_LINE_ADDR
           ,PDT.SHIP_TO_SCD_LINE_ADDR
           ,PDT.SHIP_TO_THIRD_LINE_ADDR
           ,PDT.SHIP_TO_FRTH_LINE_ADDR
           ,PDT.SHIP_TO_FIRST_REF_CMNT_TXT
           ,PDT.SHIP_TO_SCD_REF_CMNT_TXT
           ,PDT.SHIP_TO_CTY_ADDR
           ,PDT.SHIP_TO_ST_CD
           ,PDT.SHIP_TO_PROV_NM
           ,PDT.SHIP_TO_CNTY_NM
           ,PDT.SHIP_TO_POST_CD
           ,PDT.SHIP_TO_CTRY_CD
           ,PDT.CTAC_PSN_NM
           ,PO.RTRN_SHIP_TO_RTL_WH_CD
           ,PO.SHIP_FROM_SO_NUM_LIST_TXT
           ,PDT.CARR_CD
           ,PO.CARR_ACCT_NUM
           ,PDT.SHPG_SVC_LVL_CD
           ,PDT.FRT_CHRG_TO_CD
           ,PDT.FRT_CHRG_METH_CD
           ,PO.LINE_BIZ_TP_CD
           ,PO.PO_ORD_CMNT_TXT
           ,PO.TRSMT_METH_TP_CD
           ,PO.SEND_PO_FAX_NUM
           ,PO.SEND_PO_EML_ADDR
           ,PO.PO_SEND_FLG
           ,PO.PO_SEND_TS
           ,PO.EIP_RPT_RQST_PK
           ,PO.PO_PRINT_FLG
           ,PDT.PO_ORD_DTL_LINE_NUM
           ,PDT.DISP_PO_DTL_LINE_NUM
           ,PDT.PO_LINE_TP_CD
           ,PDT.PO_MDSE_CMPSN_TP_CD
           ,PDT.SET_PO_ORD_DTL_LINE_NUM
           ,PDT.MDSE_CD
           ,PDT.MDSE_NM
           ,PDT.MDSE_DESC_SHORT_TXT
           ,PDT.PO_QTY
           ,PDT.PO_DISP_QTY
           ,PDT.PO_INV_QTY
           ,PDT.PO_DISP_UOM_CD
           ,PDT.THIS_MTH_FOB_COST_AMT
           ,PDT.ENT_DEAL_NET_UNIT_PRC_AMT
           ,PDT.ENT_PO_DTL_DEAL_NET_AMT
           ,PDT.ENT_FUNC_NET_UNIT_PRC_AMT
           ,PDT.ENT_PO_DTL_FUNC_NET_AMT
           ,PDT.EXCH_RATE
           ,PDT.CUST_UOM_CD
           ,PDT.DEST_RTL_SWH_CD
           ,PDT.SRC_RTL_SWH_CD
           ,PDT.INVTY_LOC_CD
           ,PDT.RQST_RCV_DT
           ,PDT.RQST_RCV_TM
           ,PDT.FRT_COND_CD
           ,PDT.ORIG_MDSE_CD
           ,PDT.FROM_STK_STS_CD
           ,PDT.TO_STK_STS_CD
           ,PDT.ADMIN_PSN_CD
           ,PDT.PO_MATCH_TP_CD
           ,PDT.ORD_QTY
           ,PDT.CPO_ORD_NUM
           ,PDT.CPO_DTL_LINE_NUM
           ,PDT.CPO_DTL_LINE_SUB_NUM
           ,PDT.CUST_ISS_PO_NUM
           ,PDT.CUST_ISS_PO_DT
           ,PDT.CPO_ORD_TP_CD
           ,PDT.BILL_TO_CUST_CD
           ,PDT.SELL_TO_CUST_CD
           ,PDT.SHPG_PLN_NUM
           ,PDT.PRCH_REQ_NUM
           ,PDT.PRCH_REQ_LINE_NUM
           ,PDT.PRCH_REQ_LINE_SUB_NUM
           ,PDT.TRX_REF_NUM
           ,PDT.TRX_REF_LINE_NUM
           ,PDT.TRX_REF_LINE_SUB_NUM
           ,PDT.ASL_DTL_PK
           ,PDT.ASL_MDSE_CD
           ,PDT.ASL_UNIT_PRC_AMT
           ,PDT.SHIP_FROM_SO_NUM_LIST_TXT
           ,PDT.VND_INVTY_LOC_CD
           ,PDT.VND_ISS_PO_ORD_NUM
           ,PDT.PRO_NUM
           ,PDT.VND_PO_ACK_STS_CD
           ,PDT.ORIG_PO_ORD_NUM
           ,PDT.ORIG_PO_ORD_DTL_LINE_NUM
           ,PDT.ORIG_DISP_PO_DTL_LINE_NUM
           ,PDT.SVC_CONFIG_MSTR_PK
           ,PDT.PO_SEND_TS
           ,PDT.PO_ORD_DTL_CMNT_TXT
        FROM
            PO               PO
           ,PO_DTL           PDT
        WHERE
            PO.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND PO.EZCANCELFLAG             = '0'
        AND PO.PO_ORD_NUM               = #PO_ORD_NUM#
        AND PO.VND_CD                   = #VND_CD#
        AND PO.PO_HDR_STS_CD            = #PO_HDR_STS_CD#
        AND PO.DEST_RTL_WH_CD           = #DEST_RTL_WH_CD#
        AND PO.GLBL_CMPY_CD             = PDT.GLBL_CMPY_CD
        AND PO.PO_ORD_NUM               = PDT.PO_ORD_NUM
        AND PDT.SHIP_TO_CUST_CD         = #SHIP_TO_CUST_CD#
        AND PDT.EZCANCELFLAG            = '0'
    </statement>

    <statement id="isShpgPlnCheck" parameterClass="Map" resultClass="String">
        SELECT
             SHPG.SHPG_PLN_NUM
        FROM
             SHPG_PLN           SHPG
            ,CPO                CPO
            ,CPO_DTL            CPOD
        WHERE
             SHPG.GLBL_CMPY_CD                   = #glblCmpyCd#
        AND  SHPG.SHPG_PLN_NUM                   = #shpgPlnNum#
        AND  SHPG.AVAL_PO_QTY                    > 0
        AND  SHPG.PO_REQ_FLG                     = #flgOnY#
        AND  SHPG.SO_CLOSE_FLG                   = #flgOffN#
        AND  SHPG.RTE_STS_CD                     = #rteStsCd#
        AND  SHPG.SHPG_STS_CD                    = #shpgStsCd#
        AND  SHPG.EZCANCELFLAG                   = '0'
        AND  SHPG.GLBL_CMPY_CD                   = CPO.GLBL_CMPY_CD
        AND  SHPG.TRX_HDR_NUM                    = CPO.CPO_ORD_NUM
        AND  CPO.EZCANCELFLAG                    = '0'
        AND  SHPG.GLBL_CMPY_CD                   = CPOD.GLBL_CMPY_CD
        AND  CPO.CPO_ORD_NUM                     = CPOD.CPO_ORD_NUM
        AND  SHPG.TRX_LINE_NUM                   = CPOD.CPO_DTL_LINE_NUM
        AND  SHPG.TRX_LINE_SUB_NUM               = CPOD.CPO_DTL_LINE_SUB_NUM
        AND  CPOD.EZCANCELFLAG                   = '0'
        AND  EXISTS (SELECT 1
                     FROM   ORD_LINE_SRC OLS
                     WHERE  OLS.GLBL_CMPY_CD = CPOD.GLBL_CMPY_CD
                     AND    OLS.ORD_LINE_SRC_CD = CPOD.ORD_LINE_SRC_CD
                     AND    OLS.ITT_DROP_SHIP_FLG = #flgOffN#
                     AND    OLS.EZCANCELFLAG = 0)
        UNION ALL
        SELECT
             SHPG.SHPG_PLN_NUM
        FROM
             SHPG_PLN           SHPG
            ,ORD_LINE_SRC       ORLS
            ,CPO                CPO
            ,CPO_DTL            CPOD
        WHERE
             SHPG.GLBL_CMPY_CD                   = #glblCmpyCd#
        AND  SHPG.SHPG_PLN_NUM                   = #shpgPlnNum#
        AND  SHPG.AVAL_PO_QTY                    = 0
        AND  SHPG.PO_REQ_FLG                     = #flgOffN#
        AND  SHPG.SO_CLOSE_FLG                   = #flgOffN#
        AND  SHPG.RTE_STS_CD                     = #rteStsCd#
        AND  SHPG.SHPG_STS_CD                    = #shpgStsCd#
        AND  SHPG.EZCANCELFLAG                   = '0'
        AND  SHPG.GLBL_CMPY_CD                   = CPO.GLBL_CMPY_CD
        AND  SHPG.TRX_HDR_NUM                    = CPO.CPO_ORD_NUM
        AND  CPO.EZCANCELFLAG                    = '0'
        AND  CPO.GLBL_CMPY_CD                    = CPOD.GLBL_CMPY_CD
        AND  CPO.CPO_ORD_NUM                     = CPOD.CPO_ORD_NUM
        AND  SHPG.TRX_LINE_NUM                   = CPOD.CPO_DTL_LINE_NUM
        AND  SHPG.TRX_LINE_SUB_NUM               = CPOD.CPO_DTL_LINE_SUB_NUM
        AND  CPOD.EZCANCELFLAG                   = '0'
        AND  EXISTS (SELECT 1
                     FROM   ORD_LINE_SRC OLS
                     WHERE  OLS.GLBL_CMPY_CD = CPOD.GLBL_CMPY_CD
                     AND    OLS.ORD_LINE_SRC_CD = CPOD.ORD_LINE_SRC_CD
                     AND    OLS.ITT_DROP_SHIP_FLG = #flgOffN#
                     AND    OLS.EZCANCELFLAG = 0)
        AND  CPOD.GLBL_CMPY_CD                   = ORLS.GLBL_CMPY_CD
        AND  CPOD.ORD_LINE_SRC_CD                = ORLS.ORD_LINE_SRC_CD
        AND  ORLS.ORD_LINE_SRC_CATG_CD           = #ordLineSrcCatgCd#
        AND  ORLS.EZCANCELFLAG                   = '0'
        AND  CPOD.GLBL_CMPY_CD                   = CPO.GLBL_CMPY_CD
        AND  CPOD.CPO_ORD_NUM                    = CPO.CPO_ORD_NUM
    </statement>

    <statement id="checkPrFromITTOutbound" parameterClass="Map" resultClass="Map">
        SELECT
            PR.PRCH_REQ_NUM            AS PRCH_REQ_NUM
           ,PR.PRCH_REQ_STS_CD         AS PRCH_REQ_STS_CD
           ,PRD.PRCH_REQ_LINE_NUM      AS PRCH_REQ_LINE_NUM
           ,PRD.PRCH_REQ_LINE_SUB_NUM  AS PRCH_REQ_LINE_SUB_NUM
           ,PRD.PRCH_REQ_LINE_STS_CD   AS PRCH_REQ_LINE_STS_CD
           ,CP.CPO_ORD_NUM             AS CPO_ORD_NUM
           ,CP.ORD_HDR_STS_CD          AS ORD_HDR_STS_CD
           ,CPD.CPO_DTL_LINE_NUM       AS CPO_DTL_LINE_NUM
           ,CPD.CPO_DTL_LINE_SUB_NUM   AS CPO_DTL_LINE_SUB_NUM
           ,CPD.ORD_LINE_STS_CD        AS ORD_LINE_STS_CD
           ,SP.EZCANCELFLAG            AS SHPG_PLN_CANCELFLAG
           ,NULL                       AS PO_ORD_NUM
           ,NULL                       AS PO_STS_CD
           ,NULL                       AS PO_ORD_DTL_LINE_NUM
           ,NULL                       AS PO_LINE_STS_CD
        FROM
	        PRCH_REQ           PR
           ,PRCH_REQ_DTL       PRD
           ,CPO                CP
           ,CPO_DTL            CPD
           ,SHPG_PLN           SP
        WHERE
            PR.GLBL_CMPY_CD          = #glblCmpyCd#
        AND PR.PRCH_REQ_TP_CD        = #prchReqTpITTO#
        AND PR.GLBL_CMPY_CD          = PRD.GLBL_CMPY_CD
        AND PR.PRCH_REQ_NUM          = PRD.PRCH_REQ_NUM
        AND PR.GLBL_CMPY_CD          = CP.GLBL_CMPY_CD
        AND PR.CPO_ORD_NUM           = CP.CPO_ORD_NUM
        AND CP.GLBL_CMPY_CD          = CPD.GLBL_CMPY_CD
        AND CP.CPO_ORD_NUM           = CPD.CPO_ORD_NUM
        AND PRD.TRX_REF_NUM          = CPD.CPO_ORD_NUM
        AND PRD.TRX_REF_LINE_NUM     = CPD.CPO_DTL_LINE_NUM
        AND PRD.TRX_REF_LINE_SUB_NUM = CPD.CPO_DTL_LINE_SUB_NUM
        AND PRD.PRCH_REQ_LINE_STS_CD NOT IN (#prchReqLineStsCancel#, #prchReqLineStsClose#)
        AND (
             CPD.ORD_LINE_STS_CD     = #ordLineStsCancel#
            OR
             SP.EZCANCELFLAG         = '1'
            )
        AND PRD.GLBL_CMPY_CD         = SP.GLBL_CMPY_CD
        AND PRD.SHPG_PLN_NUM         = SP.SHPG_PLN_NUM
        AND PR.EZCANCELFLAG          = '0'
        AND PRD.EZCANCELFLAG         = '0'
        AND CP.EZCANCELFLAG          = '0'
        AND CPD.EZCANCELFLAG         = '0'

        UNION ALL

        SELECT
            PR.PRCH_REQ_NUM             AS PRCH_REQ_NUM
           ,PR.PRCH_REQ_STS_CD          AS PRCH_REQ_STS_CD
           ,PRD.PRCH_REQ_LINE_NUM       AS PRCH_REQ_LINE_NUM
           ,PRD.PRCH_REQ_LINE_SUB_NUM   AS PRCH_REQ_LINE_SUB_NUM
           ,PRD.PRCH_REQ_LINE_STS_CD    AS PRCH_REQ_LINE_STS_CD
           ,CP.CPO_ORD_NUM              AS CPO_ORD_NUM
           ,CP.ORD_HDR_STS_CD           AS ORD_HDR_STS_CD
           ,CPD.CPO_DTL_LINE_NUM        AS CPO_DTL_LINE_NUM
           ,CPD.CPO_DTL_LINE_SUB_NUM    AS CPO_DTL_LINE_SUB_NUM
           ,CPD.ORD_LINE_STS_CD         AS ORD_LINE_STS_CD
           ,NULL                        AS SHPG_PLN_CANCELFLAG
           ,PO.PO_ORD_NUM               AS PO_ORD_NUM
           ,PO.PO_STS_CD                AS PO_STS_CD
           ,POD.PO_ORD_DTL_LINE_NUM     AS PO_ORD_DTL_LINE_NUM
           ,POD.PO_LINE_STS_CD          AS PO_LINE_STS_CD
        FROM
            PRCH_REQ        PR
           ,PRCH_REQ_DTL    PRD
           ,CPO             CP
           ,CPO_DTL         CPD
           ,PO              PO
           ,PO_DTL          POD
        WHERE
            PR.GLBL_CMPY_CD          = #glblCmpyCd#
        AND PR.PRCH_REQ_TP_CD        = #prchReqTpITTO#
        AND PR.GLBL_CMPY_CD          = PRD.GLBL_CMPY_CD
        AND PR.PRCH_REQ_NUM          = PRD.PRCH_REQ_NUM
        AND PR.GLBL_CMPY_CD          = CP.GLBL_CMPY_CD
        AND PR.CPO_ORD_NUM           = CP.CPO_ORD_NUM
        AND CP.GLBL_CMPY_CD          = CPD.GLBL_CMPY_CD
        AND CP.CPO_ORD_NUM           = CPD.CPO_ORD_NUM
        AND PRD.TRX_REF_NUM          = CPD.CPO_ORD_NUM
        AND PRD.TRX_REF_LINE_NUM     = CPD.CPO_DTL_LINE_NUM
        AND PRD.TRX_REF_LINE_SUB_NUM = CPD.CPO_DTL_LINE_SUB_NUM
        AND PRD.PRCH_REQ_LINE_STS_CD NOT IN (#prchReqLineStsCancel#, #prchReqLineStsClose#)
        AND CPD.GLBL_CMPY_CD         = POD.GLBL_CMPY_CD
        AND CPD.CPO_ORD_NUM          = POD.CPO_ORD_NUM
        AND CPD.CPO_DTL_LINE_NUM     = POD.CPO_DTL_LINE_NUM
        AND CPD.CPO_DTL_LINE_SUB_NUM = POD.CPO_DTL_LINE_SUB_NUM
        AND POD.GLBL_CMPY_CD         = PO.GLBL_CMPY_CD
        AND POD.PO_ORD_NUM           = PO.PO_ORD_NUM
        AND PR.EZCANCELFLAG          = '0'
        AND PRD.EZCANCELFLAG         = '0'
        AND CP.EZCANCELFLAG          = '0'
        AND CPD.EZCANCELFLAG         = '0'
        AND PO.EZCANCELFLAG          = '0'
        AND POD.EZCANCELFLAG         = '0'
    </statement>

    <statement id="searchSupplier" parameterClass="Map" resultClass="Map">
        SELECT
            RAV.RCV_ASN_VND_CD
        FROM
            RCV_ASN_VND RAV
        WHERE 1=1
        AND RAV.GLBL_CMPY_CD       = #glblCmpyCd#
        AND RAV.RCV_ASN_VND_CD     = #vndCd#
        AND RAV.EZCANCELFLAG       = '0'
        AND ROWNUM                 = 1
    </statement>

</sqlMap>
