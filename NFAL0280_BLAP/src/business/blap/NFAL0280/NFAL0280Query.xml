<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NFAL0280Query">

    <typeAlias alias="NFAL0280CMsg"      type="business.blap.NFAL0280.NFAL0280CMsg"/>

    <statement id="getSvcInvChrgTpCdList" parameterClass="Map" resultClass="Map">
        SELECT
            SICT.SVC_INV_CHRG_TP_CD
            ,SICT.SVC_INV_CHRG_TP_DESC_TXT
        FROM
            SVC_INV_CHRG_TP SICT
        WHERE
            SICT.GLBL_CMPY_CD = #glblCmpyCd#
        AND SICT.SVC_INV_CHRG_TP_CD IN (#svcInvChrgTpCdBc#, #svcInvChrgTpCdMc#)
        AND SICT.EZCANCELFLAG = '0'
        ORDER BY SICT.SVC_INV_CHRG_TP_SORT_NUM DESC
    </statement>
    <statement id="setPulldownTrgtDataToBeRvrsList" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
             AAI.EZINTIME
        FROM
            AJE_ACRL_INTFC AAI
        WHERE
            AAI.GLBL_CMPY_CD     = #glblCmpyCd#
            AND AAI.EZCANCELFLAG = '0'
            <isEqual property="cMsg.svcInvChrgTpCd_A1" compareValue="BC">
            AND AAI.TRX_RSN_CD IN (#svcInvChrgTpX1#, #svcInvChrgTpX2#, #svcInvChrgTpX3#)
            </isEqual>
            <isEqual property="cMsg.svcInvChrgTpCd_A1" compareValue="MC">
            AND AAI.TRX_RSN_CD IN (#svcInvChrgTpX4#, #svcInvChrgTpX5#)
            </isEqual>
            AND AAI.GL_DT LIKE #trgtMth#
            AND NOT EXISTS (
                SELECT 1
                FROM
                    AJE_ACRL_RVSL_INTFC AARI
                WHERE
                    AAI.GLBL_CMPY_CD = AARI.GLBL_CMPY_CD
                    AND AARI.EZCANCELFLAG = '0'
                    AND AARI.SVC_INV_CHRG_TP_CD = #svcInvChrgTpCd#
                    AND (AARI.RVSL_TRGT_TS = AAI.EZINTIME OR AARI.RQST_CRAT_TS = AAI.EZINTIME)
            )
        ORDER BY
            AAI.EZINTIME DESC
    </statement>
    <statement id="getAjeAcrlIntfcList" parameterClass="Map" resultClass="Map">
        SELECT
            AAI.AJE_ACRL_INTFC_PK
            ,AAI.GL_DT
            ,AAI.SYS_SRC_CD
            ,AAI.TRX_CD
            ,AAI.TRX_RSN_CD
            ,AAI.DEAL_CCY_CD
            ,AAI.FUNC_CCY_CD
            ,AAI.EXCH_RATE
            ,AAI.JRNL_DEAL_AMT
            ,AAI.JRNL_FUNC_AMT
            ,AAI.COA_CMPY_CD
            ,AAI.COA_BR_CD
            ,AAI.COA_CC_CD
            ,AAI.COA_ACCT_CD
            ,AAI.COA_PROD_CD
            ,AAI.COA_CH_CD
            ,AAI.COA_AFFL_CD
            ,AAI.COA_PROJ_CD
            ,AAI.COA_EXTN_CD
            ,AAI.SLS_REP_CR_PCT
            ,AAI.SER_NUM
            ,AAI.SVC_MACH_MSTR_PK
            ,AAI.SVC_CONFIG_MSTR_PK
            ,AAI.DS_CONTR_PK
            ,AAI.DS_CONTR_NUM
            ,AAI.DS_CONTR_DTL_PK
            ,AAI.DS_ACCT_NUM
            ,AAI.TOC_CD
            ,AAI.AJE_ITEM_CD
            ,AAI.AJE_ITEM_DESC_TXT
        FROM
            AJE_ACRL_INTFC AAI
        WHERE
            AAI.GLBL_CMPY_CD = #glblCmpyCd#
        AND AAI.EZINTIME     = #xxDtNm#
        <isEqual property="cMsg.svcInvChrgTpCd_A1" compareValue="BC">
        AND AAI.TRX_RSN_CD IN (#svcInvChrgTpX1#, #svcInvChrgTpX2#, #svcInvChrgTpX3#)
        </isEqual>
        <isEqual property="cMsg.svcInvChrgTpCd_A1" compareValue="MC">
        AND AAI.TRX_RSN_CD IN (#svcInvChrgTpX4#, #svcInvChrgTpX5#)
        </isEqual>
        AND AAI.GL_DT LIKE #trgtMth#
        FOR UPDATE NOWAIT
    </statement>
    <statement id="chkAjeAcrlRvslIntfcDup" parameterClass="Map" resultClass="BigDecimal">
        SELECT COUNT(*)
        FROM
            AJE_ACRL_RVSL_INTFC AARI
        WHERE
            AARI.GLBL_CMPY_CD           = #glblCmpyCd#
            AND AARI.EZCANCELFLAG       = '0'
            AND AARI.RVSL_TRGT_TS       = #rvslTrgtTs#
            AND AARI.SVC_INV_CHRG_TP_CD = #svcInvChrgTpCd#
    </statement>
    <statement id="getAjeAcrlIntfcEzInTime" parameterClass="Map" resultClass="String">
        SELECT
             MAX(AAI.EZINTIME) AS EZINTIME
        FROM
            AJE_ACRL_INTFC AAI
        WHERE
            AAI.GLBL_CMPY_CD     = #glblCmpyCd#
            AND AAI.EZCANCELFLAG = '0'
            <isEqual property="cMsg.svcInvChrgTpCd_A1" compareValue="BC">
            AND AAI.TRX_RSN_CD IN (#svcInvChrgTpX1#, #svcInvChrgTpX2#, #svcInvChrgTpX3#)
            </isEqual>
            <isEqual property="cMsg.svcInvChrgTpCd_A1" compareValue="MC">
            AND AAI.TRX_RSN_CD IN (#svcInvChrgTpX4#, #svcInvChrgTpX5#)
            </isEqual>
            AND AAI.GL_DT        = #trgtMth#
    </statement>
</sqlMap>
