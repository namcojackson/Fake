<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAB034001">
    <statement id="getInputData" parameterClass="Map" resultClass="Map">
       SELECT
             DCR.DS_CONTR_NUM
            ,DCD.DS_CONTR_DTL_PK
            ,CBS.NEXT_BLLG_DT
            ,CBS.BLLG_SCHD_THRU_DT
            ,CBS.DS_CONTR_BLLG_MTR_PK
        FROM
             DS_CONTR                       DCR
            ,DS_CONTR_STS_V                 DSV
            ,DS_CONTR_CTRL_STS              DCS
            ,DS_CONTR_DTL                   DCD
            ,DS_CONTR_BLLG_SCHD             CBS
        WHERE
                DCR.GLBL_CMPY_CD                  = #glblCmpyCd#
            AND DCR.DS_CONTR_CATG_CD              = #dsContrCatgCd#
            AND DCR.EZCANCELFLAG                  = '0'
            AND DCR.GLBL_CMPY_CD                  = DSV.GLBL_CMPY_CD
            AND DCR.DS_CONTR_PK                   = DSV.DS_CONTR_PK
            AND DSV.EZCANCELFLAG                  = '0'
            AND DSV.GLBL_CMPY_CD                  = DCS.GLBL_CMPY_CD
            AND DSV.DS_CONTR_CTRL_STS_CD          = DCS.DS_CONTR_CTRL_STS_CD
            AND DCS.EZCANCELFLAG                  = '0'
            AND DCS.BLLBL_FLG                     = 'Y'
            AND DCR.GLBL_CMPY_CD                  = DCD.GLBL_CMPY_CD
            AND DCR.DS_CONTR_PK                   = DCD.DS_CONTR_PK
            AND DCD.DS_CONTR_DTL_TP_CD            = #dsContrDtlTpCd#
            AND DCD.EZCANCELFLAG                  = '0'
            AND DCD.GLBL_CMPY_CD                  = CBS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK               = CBS.DS_CONTR_DTL_PK
            AND CBS.USG_CHRG_FLG                  = 'Y'
            AND CBS.BLLG_SCHD_THRU_DT         &lt;= #bllgSchdThruDt#
            AND CBS.EZCANCELFLAG                  = '0'
            AND EXISTS (
                SELECT
                    *
                FROM
                     DS_CONTR_DTL           DCX
                    ,DS_CONTR_BLLG_SCHD     CBX
                WHERE
                        DCR.GLBL_CMPY_CD          = DCX.GLBL_CMPY_CD
                    AND DCR.DS_CONTR_PK           = DCX.DS_CONTR_PK
                    AND DCX.EZCANCELFLAG          = '0'
                    AND DCX.GLBL_CMPY_CD          = CBX.GLBL_CMPY_CD
                    AND DCX.DS_CONTR_DTL_PK       = CBX.DS_CONTR_DTL_PK
                    AND CBX.BLLG_CALC_FLG         = 'N'
                    AND CBX.USG_CHRG_FLG          = 'Y'
                    AND CBX.BLLG_SCHD_THRU_DT &lt;= #bllgSchdThruDt#
                    AND CBX.EZCANCELFLAG          = '0'
            )
            AND NOT EXISTS (
                SELECT
                    *
                FROM
                     DS_CONTR_DTL           DCX
                    ,DS_CONTR_BLLG_SCHD     CBX
                WHERE
                        DCR.GLBL_CMPY_CD          = DCX.GLBL_CMPY_CD
                    AND DCR.DS_CONTR_PK           = DCX.DS_CONTR_PK
                    AND DCX.DS_CONTR_DTL_TP_CD   != #dsContrDtlTpCd#
                    AND DCX.EZCANCELFLAG          = '0'
                    AND DCX.GLBL_CMPY_CD          = CBX.GLBL_CMPY_CD
                    AND DCX.DS_CONTR_DTL_PK       = CBX.DS_CONTR_DTL_PK
                    AND CBX.MTR_ENTRY_CPLT_FLG    = 'N'
                    AND CBX.USG_CHRG_FLG          = 'Y'
                    AND CBX.BLLG_SCHD_THRU_DT &lt;= #bllgSchdThruDt#
                    AND CBX.EZCANCELFLAG          = '0'
            )
        ORDER BY
             DCR.DS_CONTR_PK
            ,CBS.NEXT_BLLG_DT
            ,CBS.BLLG_SCHD_THRU_DT
            ,CBS.DS_CONTR_BLLG_MTR_PK
    </statement>
</sqlMap>
