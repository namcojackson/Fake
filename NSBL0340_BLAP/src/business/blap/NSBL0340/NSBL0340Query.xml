<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSBL0340Query">

    <typeAlias alias="NSBL0340_ASMsg"    type="business.blap.NSBL0340.NSBL0340_ASMsg"/>

    <statement id="getOpenSvcTaskDtlInfoList" parameterClass="Map" resultMap="result.getOpenSvcTaskDtlInfoList">
<!-- mod start 2016/10/18 CSA Defect#11030 --> 
        SELECT
             FSR_NUM
            ,SVC_TASK_NUM
            ,ITT_NUM
            ,SVC_TASK_STS_DESC_TXT_FSR
            ,SVC_TASK_STS_DESC_TXT_VISIT
            ,SER_NUM
            ,T_MDL_NM
            ,DS_ACCT_NM
            ,FILLER_L272_IF
            ,CUST_TEL_NUM
            ,SVC_AVAL_TXT
            ,SVC_TASK_RCV_DT_TM
            ,TECH_NM
            ,XX_DS_RTRN_RSN_NM_A
            ,XX_DS_RTRN_RSN_NM_B
            ,SVC_CMNT_TXT
            ,SVC_TASK_CPLT_DT_TM
            ,XX_RCV_TM
            ,XX_SCR_ITEM_54_TXT_A
            ,XX_SCR_ITEM_54_TXT_B
            ,XX_DS_RTRN_RSN_NM_C
            ,XX_DS_RTRN_RSN_NM_D
            ,TO_CUST_NM
        FROM (
            SELECT
                 FSR_NUM
                ,SVC_TASK_NUM
                ,ITT_NUM
                ,SVC_TASK_STS_DESC_TXT_FSR
                ,SVC_TASK_STS_DESC_TXT_VISIT
                ,SER_NUM
                ,T_MDL_NM
                ,DS_ACCT_NM
                ,FILLER_L272_IF
                ,CUST_TEL_NUM
                ,SVC_AVAL_TXT
                ,SVC_TASK_RCV_DT_TM
                ,TECH_NM
                ,XX_DS_RTRN_RSN_NM_A
                ,XX_DS_RTRN_RSN_NM_B
                ,SVC_CMNT_TXT
                ,SVC_TASK_CPLT_DT_TM
                ,XX_RCV_TM
                ,XX_SCR_ITEM_54_TXT_A
                ,XX_SCR_ITEM_54_TXT_B
                ,XX_DS_RTRN_RSN_NM_C
                ,XX_DS_RTRN_RSN_NM_D
                ,TO_CUST_NM
            FROM (
                SELECT
                     OSTD.FSR_NUM                                 AS FSR_NUM
                    ,OSTD.SVC_TASK_NUM                            AS SVC_TASK_NUM
                    ,OSTD.ITT_NUM                                 AS ITT_NUM
                    ,SFSR.SVC_TASK_STS_DESC_TXT                   AS SVC_TASK_STS_DESC_TXT_FSR
                    ,SVISIT.SVC_TASK_STS_DESC_TXT                 AS SVC_TASK_STS_DESC_TXT_VISIT
                    ,OSTD.SER_NUM                                 AS SER_NUM
                    ,MN.T_MDL_NM                                  AS T_MDL_NM
                    ,SEL.DS_ACCT_NM                               AS DS_ACCT_NM
                    ,SUBSTR(DECODE(STC.FIRST_LINE_ADDR,    null, '', STC.FIRST_LINE_ADDR)
                     || DECODE(STC.SCD_LINE_ADDR,   null, '', ', ' || STC.SCD_LINE_ADDR)
                     || DECODE(STC.THIRD_LINE_ADDR, null, '', ', ' || STC.THIRD_LINE_ADDR)
                     || DECODE(STC.FRTH_LINE_ADDR,  null, '', ', ' || STC.FRTH_LINE_ADDR)
                     || DECODE(STC.CTY_ADDR,        null, '', ', ' || STC.CTY_ADDR)
                     || DECODE(STC.ST_CD,           null, '', ' ' || STC.ST_CD), 1, 272)
                                                                  AS FILLER_L272_IF
                    ,OSTD.CUST_TEL_NUM                            AS CUST_TEL_NUM
                    ,OSTD.SVC_AVAL_TXT                            AS SVC_AVAL_TXT
                    ,DECODE(OSTD.SVC_TASK_RCV_DT, null, '',
                            TO_CHAR(TO_DATE(OSTD.SVC_TASK_RCV_DT, #dateFormatPre#), #dateFormat#))
                     || DECODE(OSTD.SVC_TASK_RCV_TM, null, '',
                               ' ' || TO_CHAR(TO_DATE(OSTD.SVC_TASK_RCV_TM, #timeFormatPre#), #timeFormat#))
                                                                  AS SVC_TASK_RCV_DT_TM
                    ,TM.TECH_NM                                   AS TECH_NM
                    ,DSCT.DS_SVC_CALL_TP_CD || '-' || DSCT.DS_SVC_CALL_TP_DESC_TXT
                                                                  AS XX_DS_RTRN_RSN_NM_A
                    ,SBT.SVC_BILL_TP_DESC_TXT                     AS XX_DS_RTRN_RSN_NM_B
                    ,OSTD.SVC_CMNT_TXT                            AS SVC_CMNT_TXT
                    ,DECODE(OSTD.SVC_TASK_CPLT_DT, null, '',
                            TO_CHAR(TO_DATE(OSTD.SVC_TASK_CPLT_DT, #dateFormatPre#), #dateFormat#))
                     || DECODE(OSTD.SVC_TASK_CPLT_TM, null, '',
                               ' ' || TO_CHAR(TO_DATE(OSTD.SVC_TASK_CPLT_TM, #timeFormatPre#), #timeFormat#))
                                                                  AS SVC_TASK_CPLT_DT_TM
                    ,DECODE(OSTD.SVC_RSP_TM_NUM, null, '',
                            TO_CHAR(TRUNC(OSTD.SVC_RSP_TM_NUM / 60)) || ':' || TO_CHAR(MOD(OSTD.SVC_RSP_TM_NUM, 60), #pad00#))
                                                                  AS XX_RCV_TM
                    ,SUBSTR(DECODE(SPT.SVC_PBLM_TP_DESC_TXT, null, SPT2.SVC_PBLM_TP_DESC_TXT, SPT.SVC_PBLM_TP_DESC_TXT), 1, 54)
                                                                  AS XX_SCR_ITEM_54_TXT_A
                    ,SUBSTR(DECODE(SPLT.SVC_PBLM_LOC_TP_DESC_TXT, null, SPLT2.SVC_PBLM_LOC_TP_DESC_TXT, SPLT.SVC_PBLM_LOC_TP_DESC_TXT), 1, 54)
                                                                  AS XX_SCR_ITEM_54_TXT_B
                    ,SUBSTR(DECODE(SPRT.SVC_PBLM_RSN_TP_DESC_TXT, null, SPRT2.SVC_PBLM_RSN_TP_DESC_TXT, SPRT.SVC_PBLM_RSN_TP_DESC_TXT), 1, 53)
                                                                  AS XX_DS_RTRN_RSN_NM_C
                    ,SUBSTR(DECODE(SPCT.SVC_PBLM_CRCT_TP_DESC_TXT, null, SPCT2.SVC_PBLM_CRCT_TP_DESC_TXT, SPCT.SVC_PBLM_CRCT_TP_DESC_TXT), 1, 53)
                                                                  AS XX_DS_RTRN_RSN_NM_D
                    ,SUBSTR(DECODE(SP.PSN_FIRST_NM,   null, '', SP.PSN_FIRST_NM)
                     || DECODE(SP.PSN_LAST_NM, null, '', ' ' || SP.PSN_LAST_NM), 1, 60)
                                                                  AS TO_CUST_NM
                    ,ROW_NUMBER() OVER (PARTITION BY OSTD.SVC_MGR_PSN_CD, OSTD.SVC_TASK_NUM ORDER BY OSTD.OPEN_SVC_TASK_DTL_PK ASC) AS ROW_NUMBER 
                FROM
                     OPEN_SVC_TASK_DTL     OSTD
                    ,SVC_TASK_STS          SFSR
                    ,SVC_TASK_STS          SVISIT
                    ,SHIP_TO_CUST          STC
                    ,SELL_TO_CUST          SEL
                    ,DS_SVC_CALL_TP        DSCT
                    ,SVC_BILL_TP           SBT
                    ,MDL_NM                MN
                    ,TECH_MSTR             TM
                    ,SVC_PBLM_TP           SPT
                    ,SVC_PBLM_TP           SPT2
                    ,SVC_PBLM_LOC_TP       SPLT
                    ,SVC_PBLM_LOC_TP       SPLT2
                    ,SVC_PBLM_RSN_TP       SPRT
                    ,SVC_PBLM_RSN_TP       SPRT2
                    ,SVC_PBLM_CRCT_TP      SPCT
                    ,SVC_PBLM_CRCT_TP      SPCT2
                    ,S21_PSN               SP
                    <isEqual property="bizMsg.svcRqstCritTpCd" compareValue="STS">
                    ,FSR_SVC_TASK_STS_RELN FSTSR
                    </isEqual>
                WHERE
                        OSTD.GLBL_CMPY_CD                     = #bizMsg.glblCmpyCd#
                    <isEqual property="bizMsg.orgLayerNum" compareValue="1">
                    AND OSTD.FIRST_ORG_CD                     = #bizMsg.orgCd#
                    </isEqual>
                    <isEqual property="bizMsg.orgLayerNum" compareValue="2">
                    AND OSTD.SCD_ORG_CD                       = #bizMsg.orgCd#
                    </isEqual>
                    <isEqual property="bizMsg.orgLayerNum" compareValue="3">
                    AND OSTD.THIRD_ORG_CD                     = #bizMsg.orgCd#
                    </isEqual>
                    <isEqual property="bizMsg.orgLayerNum" compareValue="4">
                    AND OSTD.FRTH_ORG_CD                      = #bizMsg.orgCd#
                    </isEqual>
                    <isEqual property="bizMsg.orgLayerNum" compareValue="5">
                    AND OSTD.FIFTH_ORG_CD                     = #bizMsg.orgCd#
                    </isEqual>
                    <isEqual property="bizMsg.orgLayerNum" compareValue="6">
                    AND OSTD.SIXTH_ORG_CD                     = #bizMsg.orgCd#
                    </isEqual>
                    <isEqual property="bizMsg.orgLayerNum" compareValue="7">
                    AND OSTD.SVNTH_ORG_CD                     = #bizMsg.orgCd#
                    </isEqual>
                    <isEqual property="bizMsg.orgLayerNum" compareValue="8">
                    AND OSTD.EIGHTH_ORG_CD                    = #bizMsg.orgCd#
                    </isEqual>
                    <isEqual property="bizMsg.orgLayerNum" compareValue="9">
                    AND OSTD.NINTH_ORG_CD                     = #bizMsg.orgCd#
                    </isEqual>
                    <isEqual property="bizMsg.orgLayerNum" compareValue="10">
                    AND OSTD.TENTH_ORG_CD                     = #bizMsg.orgCd#
                    </isEqual>
                    <isEqual property="bizMsg.orgLayerNum" compareValue="11">
                    AND OSTD.ELVTH_ORG_CD                     = #bizMsg.orgCd#
                    </isEqual>
                    <isNull property="bizMsg.orgLayerNum">
                    AND (
                            OSTD.FIRST_ORG_CD                 = #bizMsg.orgCd#
                        OR  OSTD.SCD_ORG_CD                   = #bizMsg.orgCd#
                        OR  OSTD.THIRD_ORG_CD                 = #bizMsg.orgCd#
                        OR  OSTD.FRTH_ORG_CD                  = #bizMsg.orgCd#
                        OR  OSTD.FIFTH_ORG_CD                 = #bizMsg.orgCd#
                        OR  OSTD.SIXTH_ORG_CD                 = #bizMsg.orgCd#
                        OR  OSTD.SVNTH_ORG_CD                 = #bizMsg.orgCd#
                        OR  OSTD.EIGHTH_ORG_CD                = #bizMsg.orgCd#
                        OR  OSTD.NINTH_ORG_CD                 = #bizMsg.orgCd#
                        OR  OSTD.TENTH_ORG_CD                 = #bizMsg.orgCd#
                        OR  OSTD.ELVTH_ORG_CD                 = #bizMsg.orgCd#
                    )
                    </isNull>
                    AND OSTD.SVC_MGR_TP_CD                    = #bizMsg.svcMgrTpCd#
                    AND OSTD.SVC_MGR_PSN_CD                   = #bizMsg.svcMgrPsnCd#
<!-- START 2017/12/04 M.Kidokoro [QC#22483, DEL] -->
<!--                    AND OSTD.OPEN_TASK_LTST_FLG               = 'Y' -->
<!-- END 2017/12/04 M.Kidokoro [QC#22483, DEL] -->
                    AND OSTD.EZCANCELFLAG                     = '0'
                    AND OSTD.GLBL_CMPY_CD                     = SFSR.GLBL_CMPY_CD
                    AND OSTD.FSR_STS_CD                       = SFSR.SVC_TASK_STS_CD
                    AND SFSR.EZCANCELFLAG                     = '0'
                    AND OSTD.GLBL_CMPY_CD                     = SVISIT.GLBL_CMPY_CD
                    AND OSTD.FSR_VISIT_STS_CD                 = SVISIT.SVC_TASK_STS_CD
                    AND SVISIT.EZCANCELFLAG                   = '0'
                    AND OSTD.GLBL_CMPY_CD                     = STC.GLBL_CMPY_CD
                    AND OSTD.SHIP_TO_CUST_CD                  = STC.SHIP_TO_CUST_CD
                    AND STC.EZCANCELFLAG                      = '0'
                    AND STC.GLBL_CMPY_CD                      = SEL.GLBL_CMPY_CD
                    AND STC.SELL_TO_CUST_CD                   = SEL.SELL_TO_CUST_CD
                    AND SEL.EZCANCELFLAG                      = '0'
                    AND OSTD.GLBL_CMPY_CD                     = DSCT.GLBL_CMPY_CD
                    AND OSTD.DS_SVC_CALL_TP_CD                = DSCT.DS_SVC_CALL_TP_CD
                    AND DSCT.EZCANCELFLAG                     = '0'
                    AND OSTD.GLBL_CMPY_CD                     = SBT.GLBL_CMPY_CD
                    AND OSTD.SVC_BILL_TP_CD                   = SBT.SVC_BILL_TP_CD
                    AND SBT.EZCANCELFLAG                      = '0'
                    AND OSTD.GLBL_CMPY_CD                     = MN.T_GLBL_CMPY_CD(+)
                    AND OSTD.MDL_ID                           = MN.T_MDL_ID (+)
                    AND MN.EZCANCELFLAG (+)                   = '0'
                    AND OSTD.GLBL_CMPY_CD                     = TM.GLBL_CMPY_CD(+)
                    AND OSTD.TECH_CD                          = TM.TECH_TOC_CD(+)
                    AND TM.EZCANCELFLAG (+)                   = '0'

                    AND OSTD.GLBL_CMPY_CD                     = SPT.GLBL_CMPY_CD(+)
                    AND OSTD.FIRST_PROD_CTRL_CD               = SPT.FIRST_PROD_CTRL_CD(+)
                    AND OSTD.SVC_PBLM_TP_CD                   = SPT.SVC_PBLM_TP_CD(+)
                    AND SPT.EZCANCELFLAG (+)                  = '0'
                    AND OSTD.GLBL_CMPY_CD                     = SPT2.GLBL_CMPY_CD(+)
                    AND OSTD.SVC_PBLM_TP_CD                   = SPT2.SVC_PBLM_TP_CD(+)
                    AND SPT2.EZCANCELFLAG (+)                 = '0'
                    AND SPT2.FIRST_PROD_CTRL_CD (+)           = #asterisk#

                    AND OSTD.GLBL_CMPY_CD                     = SPLT.GLBL_CMPY_CD(+)
                    AND OSTD.FIRST_PROD_CTRL_CD               = SPLT.FIRST_PROD_CTRL_CD(+)
                    AND OSTD.SVC_PBLM_LOC_TP_CD               = SPLT.SVC_PBLM_LOC_TP_CD(+)
                    AND SPLT.EZCANCELFLAG (+)                 = '0'
                    AND OSTD.GLBL_CMPY_CD                     = SPLT2.GLBL_CMPY_CD(+)
                    AND OSTD.SVC_PBLM_LOC_TP_CD               = SPLT2.SVC_PBLM_LOC_TP_CD(+)
                    AND SPLT2.EZCANCELFLAG (+)                = '0'
                    AND SPLT2.FIRST_PROD_CTRL_CD (+)          = #asterisk#

                    AND OSTD.GLBL_CMPY_CD                     = SPRT.GLBL_CMPY_CD(+)
                    AND OSTD.FIRST_PROD_CTRL_CD               = SPRT.FIRST_PROD_CTRL_CD(+)
                    AND OSTD.SVC_PBLM_RSN_TP_CD               = SPRT.SVC_PBLM_RSN_TP_CD(+)
                    AND SPRT.EZCANCELFLAG(+)                  = '0'
                    AND OSTD.GLBL_CMPY_CD                     = SPRT2.GLBL_CMPY_CD(+)
                    AND OSTD.SVC_PBLM_RSN_TP_CD               = SPRT2.SVC_PBLM_RSN_TP_CD(+)
                    AND SPRT2.EZCANCELFLAG(+)                 = '0'
                    AND SPRT2.FIRST_PROD_CTRL_CD (+)          = #asterisk#

                    AND OSTD.GLBL_CMPY_CD                     = SPCT.GLBL_CMPY_CD(+)
                    AND OSTD.FIRST_PROD_CTRL_CD               = SPCT.FIRST_PROD_CTRL_CD(+)
                    AND OSTD.SVC_PBLM_CRCT_TP_CD              = SPCT.SVC_PBLM_CRCT_TP_CD(+)
                    AND SPCT.EZCANCELFLAG (+)                 = '0'
                    AND OSTD.GLBL_CMPY_CD                     = SPCT2.GLBL_CMPY_CD(+)
                    AND OSTD.SVC_PBLM_CRCT_TP_CD              = SPCT2.SVC_PBLM_CRCT_TP_CD(+)
                    AND SPCT2.EZCANCELFLAG (+)                = '0'
                    AND SPCT2.FIRST_PROD_CTRL_CD (+)          = #asterisk#

                    AND OSTD.GLBL_CMPY_CD                     = SP.GLBL_CMPY_CD(+)
                    AND OSTD.CLTR_PSN_CD                      = SP.PSN_CD(+)
                    AND SP.EZCANCELFLAG (+)                   = '0'

                    <isEqual property="bizMsg.svcRqstCritTpCd" compareValue="CLTP">
                        <isNotNull property="bizMsg.dsSvcCallTpCd">
                    AND DSCT.DS_SVC_CALL_TP_CD                = #bizMsg.dsSvcCallTpCd#
                        </isNotNull>
                    </isEqual>
                    <isEqual property="bizMsg.svcRqstCritTpCd" compareValue="STS">
                    AND OSTD.GLBL_CMPY_CD                     = FSTSR.GLBL_CMPY_CD
                    AND OSTD.FSR_STS_CD || OSTD.FSR_VISIT_STS_CD
                                                              = FSTSR.FSR_STS_CD || FSTSR.FSR_VISIT_STS_CD
                    AND FSTSR.EZCANCELFLAG = '0'
                        <isNotNull property="bizMsg.fsrSvcTaskStsRelnPk">
                    AND FSTSR.FSR_SVC_TASK_STS_RELN_PK        = #bizMsg.fsrSvcTaskStsRelnPk#
                        </isNotNull>
                    </isEqual>
                    <isEqual property="bizMsg.svcRqstCritTpCd" compareValue="ASGN">
                        <isNotNull property="bizMsg.techCd">
                    AND OSTD.TECH_CD                          = #bizMsg.techCd#
                        </isNotNull>
                    </isEqual>
                    <isEqual property="bizMsg.svcRqstCritTpCd" compareValue="CNNL">
                        <isNotNull property="bizMsg.svcCallSrcTpCd">
                    AND OSTD.SVC_CALL_SRC_TP_CD               = #bizMsg.svcCallSrcTpCd#
                        </isNotNull>
                    </isEqual>
                    <isNotNull property="bizMsg.svcRqstDownFlgColNm">
                    AND OSTD.$bizMsg.svcRqstDownFlgColNm$     = 'Y'
                    </isNotNull>
                ORDER BY
                     OSTD.FSR_NUM      ASC
                    ,OSTD.SVC_TASK_NUM ASC
                )
            WHERE
                ROW_NUMBER = 1
            )
        WHERE
            ROWNUM                          &lt;=   #limitCount#
<!-- mod end 2016/10/18 CSA Defect#11030 --> 
    </statement>

    <resultMap id="result.getOpenSvcTaskDtlInfoList" class="NSBL0340_ASMsg">
        <result property="fsrNum"                    column="FSR_NUM"                      javaType="EZDSStringItem"/>
        <result property="svcTaskNum"                column="SVC_TASK_NUM"                 javaType="EZDSStringItem"/>
        <result property="ittNum"                    column="ITT_NUM"                      javaType="EZDSStringItem"/>
        <result property="svcTaskStsDescTxt_S"       column="SVC_TASK_STS_DESC_TXT_FSR"    javaType="EZDSStringItem"/>
        <result property="svcTaskStsDescTxt_V"       column="SVC_TASK_STS_DESC_TXT_VISIT"  javaType="EZDSStringItem"/>
        <result property="serNum"                    column="SER_NUM"                      javaType="EZDSStringItem"/>
        <result property="t_MdlNm"                   column="T_MDL_NM"                     javaType="EZDSStringItem"/>
        <result property="dsAcctNm"                  column="DS_ACCT_NM"                   javaType="EZDSStringItem"/>
        <result property="shipToFullAddr"            column="FILLER_L272_IF"               javaType="EZDSStringItem"/>
        <result property="custTelNum"                column="CUST_TEL_NUM"                 javaType="EZDSStringItem"/>
        <result property="xxScrItem30Txt"            column="SVC_AVAL_TXT"                 javaType="EZDSStringItem"/>
        <result property="rqstDtTmTsTxt_A"           column="SVC_TASK_RCV_DT_TM"           javaType="EZDSStringItem"/>
        <result property="techNm"                    column="TECH_NM"                      javaType="EZDSStringItem"/>
        <result property="xxDsRtrnRsnNm_A"           column="XX_DS_RTRN_RSN_NM_A"          javaType="EZDSStringItem"/>
        <result property="xxDsRtrnRsnNm_B"           column="XX_DS_RTRN_RSN_NM_B"          javaType="EZDSStringItem"/>
        <result property="svcCmntTxt"                column="SVC_CMNT_TXT"                 javaType="EZDSStringItem"/>
        <result property="rqstDtTmTsTxt_B"           column="SVC_TASK_CPLT_DT_TM"          javaType="EZDSStringItem"/>
        <result property="xxRcvTm"                   column="XX_RCV_TM"                    javaType="EZDSStringItem"/>
        <result property="xxScrItem54Txt_A"          column="XX_SCR_ITEM_54_TXT_A"         javaType="EZDSStringItem"/>
        <result property="xxScrItem54Txt_B"          column="XX_SCR_ITEM_54_TXT_B"         javaType="EZDSStringItem"/>
        <result property="xxDsRtrnRsnNm_C"           column="XX_DS_RTRN_RSN_NM_C"          javaType="EZDSStringItem"/>
        <result property="xxDsRtrnRsnNm_D"           column="XX_DS_RTRN_RSN_NM_D"          javaType="EZDSStringItem"/>
        <result property="fullPsnNm"                 column="TO_CUST_NM"                   javaType="EZDSStringItem"/>
    </resultMap>
</sqlMap>
