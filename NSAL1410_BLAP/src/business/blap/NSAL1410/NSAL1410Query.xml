<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL1410Query">
    <typeAlias alias="NSAL1410_ASMsg" type="business.blap.NSAL1410.NSAL1410_ASMsg"/>
    <statement id="getSearchData" parameterClass="Map" resultMap="result.getSearchData">
        SELECT
             X.DS_CONTR_PK
            ,X.DS_CONTR_NUM
            ,X.BILL_TO_CUST_CD
            ,X.LOC_NM
            ,X.SVC_CONTR_BR_CD
            ,X.SVC_CONTR_BR_DESC_TXT
            ,X.SVC_LINE_BIZ_CD
            ,X.XX_GENL_FLD_AREA_TXT
            ,X.PSN_CD
            ,X.PSN_NM
            ,X.EZUPTIME
            ,X.EZUPTIMEZONE
        FROM
            (
             SELECT
                  A.DS_CONTR_PK
                 ,A.DS_CONTR_NUM
                 ,A.ALT_PAYER_CUST_CD AS BILL_TO_CUST_CD
                 ,B.LOC_NM
                 ,A.SVC_CONTR_BR_CD
                 ,D.SVC_CONTR_BR_DESC_TXT
                 ,A.SVC_LINE_BIZ_CD
                 ,NVL2(D.SVC_CONTR_BR_DESC_TXT
                       ,TRIM(A.SVC_LINE_BIZ_CD || NVL2(A.SVC_LINE_BIZ_CD, '-' || D.SVC_CONTR_BR_DESC_TXT, D.SVC_CONTR_BR_DESC_TXT))
                       ,'') AS XX_GENL_FLD_AREA_TXT
                 ,A.CONTR_ADMIN_PSN_CD AS PSN_CD
                 ,(C.PSN_FIRST_NM || ' ' || C.PSN_LAST_NM) AS PSN_NM
                 ,A.EZUPTIME
                 ,A.EZUPTIMEZONE
             FROM
                  DS_CONTR           A
                 ,BILL_TO_CUST       B
                 ,S21_PSN            C
                 ,SVC_CONTR_BR       D
             WHERE
                     A.GLBL_CMPY_CD          = #glblCmpyCd#
                 AND A.EZCANCELFLAG          = '0'
                 <iterate property="dsContrStsCdList" var="dsContrStsCd[]" open="AND A.DS_CONTR_STS_CD NOT IN (" close=")" conjunction=",">
                     #dsContrStsCd[]#
                 </iterate>
                 AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD(+)
                 AND A.ALT_PAYER_CUST_CD     = B.BILL_TO_CUST_CD(+)
                 AND B.EZCANCELFLAG(+)       = '0'
                 AND A.GLBL_CMPY_CD          = C.GLBL_CMPY_CD(+)
                 AND A.CONTR_ADMIN_PSN_CD    = C.PSN_CD(+)
                 AND C.EZCANCELFLAG(+)       = '0'
                 AND A.SVC_CONTR_BR_CD       = D.SVC_CONTR_BR_CD(+)
                 AND A.GLBL_CMPY_CD          = D.GLBL_CMPY_CD(+)
                 AND D.EZCANCELFLAG(+)       = '0'
                 <isNotNull property="dsContrNum">
                 AND A.DS_CONTR_NUM          = #dsContrNum#
                 </isNotNull>
                 <isNotNull property="billToCustCd">
                 AND A.ALT_PAYER_CUST_CD     = #billToCustCd#
                 </isNotNull>
                 <isNotNull property="locNm">
                 AND B.LOC_NM                LIKE #locNm#
                 </isNotNull>
                 <isNotNull property="svcContrBrCd">
                 AND A.SVC_CONTR_BR_CD       = #svcContrBrCd#
                 </isNotNull>
                 <isNotNull property="svcContrBrDescTxt">
                 AND D.SVC_CONTR_BR_DESC_TXT LIKE #svcContrBrDescTxt#
                 </isNotNull>
                 <isNotNull property="psnCd">
                 AND A.CONTR_ADMIN_PSN_CD    = #psnCd#
                 </isNotNull>
                 <isNotNull property="xxPsnNm">
                 AND (C.PSN_FIRST_NM || ' ' || C.PSN_LAST_NM)
                                             LIKE #xxPsnNm#
                 </isNotNull>
             ORDER BY
                  DS_CONTR_NUM
                 ,ALT_PAYER_CUST_CD
            ) X
        WHERE
            ROWNUM &lt;= #limitNum#
    </statement>

    <resultMap id="result.getSearchData"  class="NSAL1410_ASMsg">
        <result property="dsContrPk_A"         column="DS_CONTR_PK"           javaType="EZDSBigDecimalItem"/>
        <result property="dsContrNum_A"        column="DS_CONTR_NUM"          javaType="EZDSStringItem"/>
        <result property="billToCustCd_A"      column="BILL_TO_CUST_CD"       javaType="EZDSStringItem"/>
        <result property="locNm_A"             column="LOC_NM"                javaType="EZDCStringItem"/>
        <result property="svcContrBrCd_A"      column="SVC_CONTR_BR_CD"       javaType="EZDCStringItem"/>
        <result property="svcContrBrDescTxt_A" column="SVC_CONTR_BR_DESC_TXT" javaType="EZDCStringItem"/>
        <result property="svcLineBizCd_A"      column="SVC_LINE_BIZ_CD"       javaType="EZDSStringItem"/>
        <result property="xxGenlFldAreaTxt_A"  column="XX_GENL_FLD_AREA_TXT"  javaType="EZDSStringItem"/>
        <result property="psnCd_A1"            column="PSN_CD"                javaType="EZDCStringItem"/>
        <result property="xxPsnNm_A1"          column="PSN_NM"                javaType="EZDSStringItem"/>
        <result property="ezUpTime_A"          column="EZUPTIME"              javaType="EZDSStringItem" />
        <result property="ezUpTimeZone_A"      column="EZUPTIMEZONE"          javaType="EZDSStringItem" />
    </resultMap>

    <statement id="getContrInfo" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_PK
            ,A.DS_CONTR_NUM
            ,A.ALT_PAYER_CUST_CD AS BILL_TO_CUST_CD
            ,B.LOC_NM
            ,A.SVC_CONTR_BR_CD
            ,D.SVC_CONTR_BR_DESC_TXT
            ,A.SVC_LINE_BIZ_CD
            ,TRIM(A.SVC_LINE_BIZ_CD 
                 || NVL2(A.SVC_LINE_BIZ_CD, '-' || D.SVC_CONTR_BR_DESC_TXT, D.SVC_CONTR_BR_DESC_TXT)) AS XX_GENL_FLD_AREA_TXT
            ,A.CONTR_ADMIN_PSN_CD AS PSN_CD
            ,(C.PSN_FIRST_NM || ' ' || C.PSN_LAST_NM) AS XX_PSN_NM
            ,A.EZUPTIME
            ,A.EZUPTIMEZONE
        FROM
             DS_CONTR           A
            ,BILL_TO_CUST       B
            ,S21_PSN            C
            ,SVC_CONTR_BR       D
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.DS_CONTR_NUM          = #dsContrNum#
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD(+)
            AND A.ALT_PAYER_CUST_CD     = B.BILL_TO_CUST_CD(+)
            AND B.EZCANCELFLAG(+)       = '0'
            AND A.GLBL_CMPY_CD          = C.GLBL_CMPY_CD(+)
            AND A.CONTR_ADMIN_PSN_CD    = C.PSN_CD(+)
            AND C.EZCANCELFLAG(+)       = '0'
            AND A.SVC_CONTR_BR_CD       = D.SVC_CONTR_BR_CD(+)
            AND A.GLBL_CMPY_CD          = D.GLBL_CMPY_CD(+)
            AND D.EZCANCELFLAG(+)       = '0'
    </statement>

    <statement id="getPsnInfo" parameterClass="Map" resultClass="Map">
        SELECT
             A.PSN_CD
            ,(A.PSN_FIRST_NM || ' ' || A.PSN_LAST_NM) AS XX_PSN_NM
        FROM
            S21_PSN A
        WHERE
                A.GLBL_CMPY_CD                  = #glblCmpyCd#
            AND A.PSN_CD                        = #psnCd#
            AND A.EFF_FROM_DT               &lt;= #slsDt#
            AND NVL(A.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
            AND A.EZCANCELFLAG                  = '0'
    </statement>

    <statement id="getAdminPsnAuthority" parameterClass="Map" resultClass="BigDecimal">
    SELECT
        COUNT(*)  AS CNT
    FROM
         SVC_BR_RESRC_RELN A
        ,SVC_CONTR_BR      B
        ,SVC_RG_BR_RELN    C
        ,SVC_RG            D
    WHERE
        A.GLBL_CMPY_CD                  =  #glblCmpyCd#
    AND A.EZCANCELFLAG                  =  '0'
    AND A.SVC_CONTR_BR_CD               =  #svcContrBrCd#
    AND A.PSN_CD                        =  #psnCd#
    AND A.SVC_BR_RESRC_ACTV_FLG         =  'Y'
    AND A.EFF_FROM_DT                  &lt;=  #effFromDt#
    AND NVL(A.EFF_THRU_DT, #maxData#)  &gt;=  #effFromDt#
    AND A.GLBL_CMPY_CD                  =  B.GLBL_CMPY_CD
    AND A.SVC_CONTR_BR_CD               =  B.SVC_CONTR_BR_CD
    AND B.EZCANCELFLAG                  =  '0'
    AND B.SVC_CONTR_BR_ACTV_FLG         =  'Y'
    AND B.EFF_FROM_DT                  &lt;=  #effFromDt#
    AND NVL(B.EFF_THRU_DT, #maxData#)  &gt;=  #effFromDt#
    AND B.GLBL_CMPY_CD                  =  C.GLBL_CMPY_CD
    AND B.SVC_CONTR_BR_CD               =  C.SVC_CONTR_BR_CD
    AND C.EZCANCELFLAG                  =  '0'
    AND C.GLBL_CMPY_CD                  =  D.GLBL_CMPY_CD
    AND C.SVC_RG_PK                     =  D.SVC_RG_PK
    AND D.EZCANCELFLAG                  =  '0'
    AND D.SVC_RG_ACTV_FLG               =  'Y'
    AND D.EFF_FROM_DT                  &lt;= #effFromDt#
    AND NVL(D.EFF_THRU_DT, #maxData#)  &gt;= #effFromDt#
    </statement>

</sqlMap>
