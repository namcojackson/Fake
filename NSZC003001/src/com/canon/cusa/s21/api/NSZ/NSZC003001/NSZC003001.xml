<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSZC003001">

    <typeAlias alias="FSR_VISITTMsg" type="business.db.FSR_VISITTMsg"/>
    <typeAlias alias="TECH_MSTRTMsg" type="business.db.TECH_MSTRTMsg"/>
    <typeAlias alias="DS_CUST_TRX_RULETMsg" type="business.db.DS_CUST_TRX_RULETMsg"/>

    <statement id="getSvcTaskList" parameterClass="Map" resultClass="Map">
        SELECT
            ST.SVC_TASK_NUM
           ,ST.SVC_TASK_STS_CD
           ,ST.SVC_TASK_RCV_DT
           ,ST.SVC_TASK_RCV_TM
           ,ST.DS_SVC_CALL_TP_CD
           ,ST.MACH_DOWN_FLG
           ,ST.SVC_RSP_TM_MN_AOT
           ,ST.FSR_NUM
           ,ST.SVC_CR_HLD_FLG
           ,ST.SO_NUM
           ,ST.ORG_LAYER_NUM
           ,ST.ORG_CD
           ,ST.MDL_NM
           ,ST.TECH_CD
           ,ST.ORIG_INV_CCY_CD
           ,ST.INV_CCY_CD
           ,ST.CCY_EXCH_RATE
           ,ST.SVC_MACH_MSTR_PK
           ,ST.SHIP_TO_CUST_CD
           ,ST.SER_NUM
           ,ST.CUST_TEL_NUM
           ,ST.CUST_TEL_EXTN_NUM
           ,ST.PMT_TERM_CASH_DISC_CD
           ,FV.FSR_VISIT_NUM
           ,FV.FSR_VISIT_STS_CD
           ,FV.TECH_SCHD_FROM_DT
           ,FV.TECH_SCHD_FROM_TM
           ,FV.TECH_SCHD_TO_DT
           ,FV.TECH_SCHD_TO_TM
           ,(
               SELECT
                   CT.DS_SVC_CALL_TP_NM
               FROM
                   DS_SVC_CALL_TP CT
               WHERE
                   CT.GLBL_CMPY_CD      = ST.GLBL_CMPY_CD
               AND CT.DS_SVC_CALL_TP_CD = ST.DS_SVC_CALL_TP_CD
               AND CT.EZCANCELFLAG      = '0'
            )      AS DS_SVC_CALL_TP_NM
           ,(
               SELECT
                   TM.EML_ADDR
               FROM
                   TECH_MSTR TM
               WHERE
                   TM.GLBL_CMPY_CD = ST.GLBL_CMPY_CD
               AND TM.TECH_TOC_CD  = ST.TECH_CD
               AND TM.EML_ADDR     IS NOT NULL
               AND TM.EZCANCELFLAG = '0'
               AND ROWNUM          = 1
            )      AS EML_ADDR
        FROM
            SVC_TASK      ST
           ,FSR_VISIT     FV
        WHERE
            ST.GLBL_CMPY_CD          = #glblCmpyCd#
        AND (
                ST.SVC_TASK_NUM      IN 
                <iterate property="svcTaskNumList" var="svcTaskNum[]" open="(" conjunction= "," close=")">
                    #svcTaskNum[]#
                </iterate>
                <isNotNull property="fsrNum">
                OR  ST.FSR_NUM       = #fsrNum#
                </isNotNull>
            )
        <isNotNull property="svcTaskStsCd">
        AND ST.SVC_TASK_STS_CD      != #svcTaskStsCd#
        </isNotNull>
        AND ST.GLBL_CMPY_CD          = FV.GLBL_CMPY_CD(+)
        AND ST.FSR_NUM               = FV.FSR_NUM(+)
        AND FV.FSR_VISIT_LTST_FLG(+) = 'Y'
        AND ST.EZCANCELFLAG          = '0'
        AND FV.EZCANCELFLAG(+)       = '0'
    </statement>

    <statement id="searchSvcTaskList" parameterClass="Map" resultClass="Map">
        SELECT
            ST.SVC_TASK_NUM
           ,ST.SVC_TASK_STS_CD
           ,ST.SVC_TASK_RCV_DT
           ,ST.SVC_TASK_RCV_TM
           ,ST.DS_SVC_CALL_TP_CD
           ,ST.MACH_DOWN_FLG
           ,ST.SVC_RSP_TM_MN_AOT
           ,ST.FSR_NUM
           ,ST.SVC_CR_HLD_FLG
           ,ST.SO_NUM
           ,ST.ORG_LAYER_NUM
           ,ST.ORG_CD
           ,ST.MDL_NM
           ,ST.TECH_CD
           ,ST.ORIG_INV_CCY_CD
           ,ST.INV_CCY_CD
           ,ST.CCY_EXCH_RATE
           ,ST.SVC_MACH_MSTR_PK
           ,ST.SHIP_TO_CUST_CD
           ,ST.SER_NUM
           ,ST.CUST_TEL_NUM
           ,ST.CUST_TEL_EXTN_NUM
           ,ST.PMT_TERM_CASH_DISC_CD
<!--
           ,ST.SVC_TASK_TP_CD
-->
           ,FV.FSR_VISIT_NUM
           ,FV.FSR_VISIT_STS_CD
           ,FV.TECH_SCHD_FROM_DT
           ,FV.TECH_SCHD_FROM_TM
           ,FV.TECH_SCHD_TO_DT
           ,FV.TECH_SCHD_TO_TM
           ,(
               SELECT
                   CT.DS_SVC_CALL_TP_NM
               FROM
                   DS_SVC_CALL_TP CT
               WHERE
                   CT.GLBL_CMPY_CD      = ST.GLBL_CMPY_CD
               AND CT.DS_SVC_CALL_TP_CD = ST.DS_SVC_CALL_TP_CD
               AND CT.EZCANCELFLAG      = '0'
            )      AS DS_SVC_CALL_TP_NM
           ,(
               SELECT
                   TM.EML_ADDR
               FROM
                   TECH_MSTR TM
               WHERE
                   TM.GLBL_CMPY_CD = ST.GLBL_CMPY_CD
               AND TM.TECH_TOC_CD  = ST.TECH_CD
               AND TM.EML_ADDR     IS NOT NULL
               AND TM.EZCANCELFLAG = '0'
               AND ROWNUM          = 1
            )      AS EML_ADDR
<!--
           ,STP.ADD_SVC_TASK_SEL_FLG
-->
        FROM
            SVC_TASK      ST
           ,FSR_VISIT     FV
<!--
           ,SVC_TASK_TP   STP
-->
        WHERE
            ST.GLBL_CMPY_CD          = #glblCmpyCd#
        AND (
                ST.SVC_TASK_NUM      IN 
                <iterate property="svcTaskNumList" var="svcTaskNum[]" open="(" conjunction= "," close=")">
                    #svcTaskNum[]#
                </iterate>
                <isNotNull property="fsrNum">
                OR  ST.FSR_NUM       = #fsrNum#
                </isNotNull>
            )
        <isNotNull property="svcTaskStsCd">
        AND ST.SVC_TASK_STS_CD      != #svcTaskStsCd#
        </isNotNull>
        AND ST.GLBL_CMPY_CD          = FV.GLBL_CMPY_CD(+)
        AND ST.FSR_NUM               = FV.FSR_NUM(+)
        AND ST.SVC_TASK_NUM          = FV.SVC_TASK_NUM(+)
<!--
        AND ST.GLBL_CMPY_CD          = STP.GLBL_CMPY_CD(+)
        AND ST.SVC_TASK_TP_CD        = STP.SVC_TASK_TP_CD(+)
-->
        AND ST.EZCANCELFLAG          = '0'
        AND FV.EZCANCELFLAG(+)       = '0'
<!--
        AND STP.EZCANCELFLAG(+)      = '0'
-->
    </statement>
    
    <statement id="getSvcTaskCnt" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*) AS CNT
        FROM
            SVC_TASK ST
        WHERE
            ST.GLBL_CMPY_CD = #glblCmpyCd#
        AND ST.FSR_NUM      = #fsrNum#
        AND ST.EZCANCELFLAG = '0'
    </statement>

    <statement id="getFsrVisitCnt" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*) AS CNT
        FROM
            FSR_VISIT FV
        WHERE
            FV.GLBL_CMPY_CD = #glblCmpyCd#
        AND FV.FSR_NUM      = #fsrNum#
        AND FV.EZCANCELFLAG = '0'
    </statement>

    <statement id="checkTechMstr"  parameterClass="Map" resultMap="result.TECH_MSTRTMsg">
        SELECT
            TM.TECH_TOC_CD
           ,TM.EML_ADDR
        FROM
            TECH_MSTR TM
        WHERE
            TM.GLBL_CMPY_CD = #glblCmpyCd#
        AND TM.TECH_TOC_CD  = #techCd#
        AND TM.EZCANCELFLAG = '0'
        AND ROWNUM          = 1
        <!-- START 2016/12/16 K.Kojima [QC#15653,ADD] -->
        AND EXISTS(
                SELECT
                    1
                FROM
                     ORG_FUNC_ASG     OFA
                    ,TOC              T
                    ,ORG_FUNC_ROLE_TP OFRT
                WHERE
                        OFA.GLBL_CMPY_CD                  = TM.GLBL_CMPY_CD
                    AND OFA.PSN_CD                        = TM.TECH_TOC_CD
                    AND OFA.EFF_FROM_DT               &lt;= #effDt#
                    AND NVL(OFA.EFF_THRU_DT, #effDt#) &gt;= #effDt#
                    AND OFA.GLBL_CMPY_CD                  = T.GLBL_CMPY_CD
                    AND OFA.TOC_CD                        = T.TOC_CD
                    AND T.GLBL_CMPY_CD                    = OFRT.GLBL_CMPY_CD
                    AND T.ORG_FUNC_ROLE_TP_CD             = OFRT.ORG_FUNC_ROLE_TP_CD
                    AND OFRT.TECH_MSTR_REQ_FLG            = #flgY#
                    AND OFRT.ACTV_FLG                     = #flgY#
                    AND OFA.EZCANCELFLAG                  = '0'
                    AND T.EZCANCELFLAG                    = '0'
                    AND OFRT.EZCANCELFLAG                 = '0'
            )
        <!-- END 2016/12/16 K.Kojima [QC#15653,ADD] -->
    </statement>

    <statement id="getMachMstrAddr" parameterClass="Map" resultClass="Map">
        SELECT
            SMM.LOC_NM          AS LOC_NUM
           ,SMM.FIRST_LINE_ADDR AS FIRST_LINE_ADDR
           ,SMM.SCD_LINE_ADDR   AS SCD_LINE_ADDR
           ,SMM.THIRD_LINE_ADDR AS THIRD_LINE_ADDR
           ,SMM.FRTH_LINE_ADDR  AS FRTH_LINE_ADDR
           ,SMM.CTY_ADDR        AS CTY_ADDR
           ,SMM.CNTY_NM         AS CNTY_NM
           ,SMM.ST_CD           AS ST_CD
           ,SMM.POST_CD         AS POST_CD
        FROM
            SVC_MACH_MSTR SMM
        WHERE
            SMM.GLBL_CMPY_CD     = #glblCmpyCd#
        AND SMM.SVC_MACH_MSTR_PK = #svcMachMstrPk#
        AND SMM.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getShpgPlnAddr" parameterClass="Map" resultClass="Map">
        SELECT
            SP.SHIP_TO_LOC_NM          AS LOC_NUM
           ,SP.SHIP_TO_FIRST_LINE_ADDR AS FIRST_LINE_ADDR
           ,SP.SHIP_TO_SCD_LINE_ADDR   AS SCD_LINE_ADDR
           ,SP.SHIP_TO_THIRD_LINE_ADDR AS THIRD_LINE_ADDR
           ,SP.SHIP_TO_FRTH_LINE_ADDR  AS FRTH_LINE_ADDR
           ,SP.SHIP_TO_CTY_ADDR        AS CTY_ADDR
           ,SP.SHIP_TO_CNTY_NM         AS CNTY_NM
           ,SP.SHIP_TO_ST_CD           AS ST_CD
           ,SP.SHIP_TO_POST_CD         AS POST_CD
        FROM
            SHPG_ORD     SO
           ,SHPG_ORD_DTL SOD
           ,SHPG_PLN     SP
        WHERE
            SO.GLBL_CMPY_CD  = #glblCmpyCd#
        AND SO.GLBL_CMPY_CD  = SOD.GLBL_CMPY_CD
        AND SO.GLBL_CMPY_CD  = SP.GLBL_CMPY_CD
        AND SO.SO_NUM        = #soNum#
        AND SO.SO_NUM        = SOD.SO_NUM
        AND SOD.SHPG_PLN_NUM = SP.SHPG_PLN_NUM
        AND SO.EZCANCELFLAG  = '0'
        AND SOD.EZCANCELFLAG = '0'
        AND SP.EZCANCELFLAG  = '0'
    </statement>

    <statement id="getShipToAddr" parameterClass="Map" resultClass="Map">
        SELECT
            STC.LOC_NM          AS LOC_NUM
           ,STC.FIRST_LINE_ADDR AS FIRST_LINE_ADDR
           ,STC.SCD_LINE_ADDR   AS SCD_LINE_ADDR
           ,STC.THIRD_LINE_ADDR AS THIRD_LINE_ADDR
           ,STC.FRTH_LINE_ADDR  AS FRTH_LINE_ADDR
           ,STC.CTY_ADDR        AS CTY_ADDR
           ,C.CNTY_NM           AS CNTY_NM
           ,STC.ST_CD           AS ST_CD
           ,STC.POST_CD         AS POST_CD
        FROM
            SHIP_TO_CUST STC
           ,CNTY         C
        WHERE
            STC.GLBL_CMPY_CD    = #glblCmpyCd#
        AND STC.GLBL_CMPY_CD    = C.GLBL_CMPY_CD(+)
        AND STC.SHIP_TO_CUST_CD = #shipToCustCd#
        AND STC.CNTY_PK         = C.CNTY_PK(+)
        AND STC.EZCANCELFLAG    = '0'
        AND C.EZCANCELFLAG(+)   = '0'
    </statement>

    <resultMap id="result.FSR_VISITTMsg" class="FSR_VISITTMsg">
        <result property="fsrNum"          column="FSR_NUM"            javaType="EZDTStringItem"/>
        <result property="fsrVisitNum"     column="FSR_VISIT_NUM"      javaType="EZDTStringItem"/>
        <result property="prevFsrVisitNum" column="PREV_FSR_VISIT_NUM" javaType="EZDTStringItem"/>
        <result property="fsrVisitStsCd"   column="FSR_VISIT_STS_CD"   javaType="EZDTStringItem"/>
    </resultMap>

    <resultMap id="result.TECH_MSTRTMsg" class="TECH_MSTRTMsg">
        <result property="techTocCd"       column="TECH_TOC_CD"        javaType="EZDTStringItem"/>
        <result property="emlAddr"         column="EML_ADDR"           javaType="EZDTStringItem"/>
    </resultMap>

    <statement id="getLatestFsrEventPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            MAX(FE.FSR_EVENT_PK)
        FROM
            FSR_EVENT FE
        WHERE
            FE.GLBL_CMPY_CD  = #glblCmpyCd#
        AND FE.SVC_TASK_NUM  = #svcTaskNum#
        AND FE.FSR_NUM       = #fsrNum#
        AND FE.FSR_VISIT_NUM = #fsrVisitNum#
        AND FE.EZCANCELFLAG  = '0'
    </statement>
    
    <statement id="getSvcMemo" parameterClass="Map" resultClass="Map">
        SELECT
            SMFU.SVC_MEMO_PK
        FROM (
            SELECT
                SM.SVC_MEMO_PK
            FROM
                SVC_MEMO SM
            WHERE
                    SM.GLBL_CMPY_CD     = #glblCmpyCd#
                AND SM.SVC_MEMO_CATG_CD = #svcMemoCatgCd#
                AND SM.SVC_MEMO_TP_CD   = #svcMemoTypeCd#
                AND SM.FSR_NUM          = #fsrNum#
                AND SM.EZCANCELFLAG     = '0'
            ORDER BY
                SM.SVC_MEMO_PK DESC
        ) SMFU
        WHERE
            ROWNUM = #rowNum#
    </statement>
    
    <statement id="getExchRate" parameterClass="Map" resultClass="BigDecimal">
        WITH AER AS (
            SELECT
                EX.ACTL_EXCH_RATE
            FROM
                ACCT_DLY_ACTL_EXCH_RATES EX
            WHERE
                EX.GLBL_CMPY_CD              = #glblCmpyCd#
            AND EX.CCY_CD                    = #ccyCd#
            AND EX.ACTL_EXCH_RATE_ENT_DT &lt;= #slsDt#
            AND EX.ACTL_EXCH_RATE            IS NOT NULL
            AND EX.EZCANCELFLAG              = '0'
            ORDER BY
                EX.ACTL_EXCH_RATE_ENT_DT DESC
        )
        SELECT
            AER.ACTL_EXCH_RATE
        FROM
            AER
        WHERE
            ROWNUM &lt;= 1
    </statement>

    <statement id="getAccount"  parameterClass="Map" resultClass="Map">
        SELECT
            B.BILL_TO_CUST_PK
           ,B.SELL_TO_CUST_CD
        FROM
            BILL_TO_CUST      B
        WHERE
            B.EZCANCELFLAG                     = '0'
        AND B.GLBL_CMPY_CD                     = #glblCmpyCd#
        AND B.RGTN_STS_CD                      = #rgtnStsCd#
        AND B.BILL_TO_CUST_CD                  = #billToCustCd#
    </statement>
    <statement id="getSvcTaskStsCdList"  parameterClass="Map" resultClass="Map">
        SELECT
            ST.SVC_TASK_STS_CD
        FROM
            SVC_TASK ST

        WHERE
            ST.GLBL_CMPY_CD                     = #glblCmpyCd#
            AND ST.FSR_NUM                      = #fsrNum#
            AND ST.SVC_TASK_NUM                 NOT IN 
            <iterate property="svcTaskNumList" var="svcTaskNum[]" open="(" conjunction= "," close=")">
                    #svcTaskNum[]#
            </iterate>
            AND ST.EZCANCELFLAG                 = '0'
    </statement>
    <statement id="getFsrVisitBySvcTaskNumFsrNum"  parameterClass="Map" resultClass="Map">
        SELECT
              FV.FSR_NUM
             ,FV.FSR_VISIT_NUM
              <!-- START 2019/08/23 K.Fujimoto [QC#53116,ADD] -->
             ,ST.SVC_TASK_NUM
              <!-- END   2019/08/23 K.Fujimoto [QC#53116,ADD] -->
             ,ST.SVC_MACH_MSTR_PK
             ,ST.INV_CCY_CD
             ,ST.CCY_EXCH_RATE
             ,ST.SVC_BILL_TP_CD
             ,FV.FSR_VISIT_CPLT_DT
             ,FV.FSR_VISIT_CPLT_TM
             ,FV.FSR_VISIT_ARV_DT
             ,FV.FSR_VISIT_ARV_TM
             ,FV.SVC_TRVL_TM_NUM
             ,FV.SVC_PRT_DEAL_AMT
             ,FV.SVC_PRT_FUNC_AMT
             ,FV.SVC_PRT_DEAL_TAX_AMT
             ,FV.SVC_PRT_DEAL_DISC_AMT
             ,FV.SVC_PRT_FUNC_DISC_AMT
             ,FV.SVC_CHRG_CONT_FLG
             ,FV.SVC_CALL_CPLT_TP_CD
             ,FV.SVC_CPLT_LTTD_NUM
             ,FV.SVC_CPLT_LGTD_NUM
             ,FV.SVC_CPLT_LOC_GAP_DST_NUM
             ,FSR.PMT_TERM_CASH_DISC_CD
        FROM
             FSR_VISIT FV
            ,SVC_TASK ST
            ,FSR FSR

        WHERE
            FV.GLBL_CMPY_CD                     = #glblCmpyCd#
            AND FV.SVC_TASK_NUM                 = #svcTaskNum#
            AND FV.EZCANCELFLAG                 = '0'
            AND FV.GLBL_CMPY_CD                 = ST.GLBL_CMPY_CD
            AND FV.SVC_TASK_NUM                 = ST.SVC_TASK_NUM
            AND ST.EZCANCELFLAG                 = '0'
            AND FV.GLBL_CMPY_CD                 = FSR.GLBL_CMPY_CD
            AND FV.FSR_NUM                      = FSR.FSR_NUM
            AND FSR.EZCANCELFLAG                = '0'
    </statement>
    <statement id="getExchRateData"  parameterClass="Map" resultClass="BigDecimal">
    SELECT 
         CCY_EXCH_RATE
    FROM (
        SELECT
            ST.CCY_EXCH_RATE AS CCY_EXCH_RATE
        FROM
            ACCT_DLY_ACTL_EXCH_RATES ADAER
            ,SVC_TASK ST

        WHERE
            ADAER.GLBL_CMPY_CD                  = #glblCmpyCd#
            AND ADAER.CCY_CD                    = #ccyCd#
            AND ADAER.ACTL_EXCH_RATE_ENT_DT &lt;= #slsDt#
            AND ADAER.EZCANCELFLAG              = '0'
            AND ADAER.GLBL_CMPY_CD              = ST.GLBL_CMPY_CD
            AND ADAER.CCY_CD                    = ST.INV_CCY_CD
            AND ST.EZCANCELFLAG                 = '0'
        ORDER BY
            ADAER.ACTL_EXCH_RATE_ENT_DT DESC
    )
    WHERE ROWNUM = 1
    </statement>

<!-- START 2016/11/16 N.Arai [QC#15860, MOD] -->
    <statement id="getAssignTech"  parameterClass="Map" resultClass="Map">
        SELECT
             NVL(SMM.REQ_TECH_CD, SMM.PRF_TECH_CD)  AS SVC_ASG_TECH_CD
            ,CASE WHEN SMM.REQ_TECH_CD IS NOT NULL
                  THEN #required#
                  WHEN SMM.PRF_TECH_CD IS NOT NULL
                  THEN #preferred#
                  ELSE NULL END                     AS SVC_ASG_TP_CD
        FROM
             SVC_TASK       ST
            ,SVC_MACH_MSTR  SMM
        WHERE
                ST.GLBL_CMPY_CD     = #glblCmpyCd#
            AND ST.SVC_TASK_NUM     = #svcTaskNum#
            AND ST.EZCANCELFLAG     = '0'
            AND ST.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
            AND ST.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
            AND SMM.EZCANCELFLAG    = '0'
    </statement>
<!-- END 2016/11/16 N.Arai [QC#15860, MOD] -->
<!-- START 2018/08/30 K.Kitachi [QC#22665, ADD] -->
    <statement id="getAftHrsFlg"  parameterClass="Map" resultClass="String">
        SELECT
            B.AFT_HRS_FLG
        FROM
             SVC_TASK       A
            ,DS_SVC_CALL_TP B
        WHERE
            A.GLBL_CMPY_CD      = #glblCmpyCd#
        AND A.SVC_TASK_NUM      = #svcTaskNum#
        AND A.EZCANCELFLAG      = '0'
        AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
        AND A.DS_SVC_CALL_TP_CD = B.DS_SVC_CALL_TP_CD
        AND B.EZCANCELFLAG      = '0'
    </statement>
<!-- END 2018/08/30 K.Kitachi [QC#22665, ADD] -->

    <!-- START 2021/10/06 R.Jabal [QC#59183, ADD] -->
    <statement id="getAccessPermits" parameterClass="Map" resultClass="Map">
        WITH PMT_WK AS (
            SELECT
                 ACCS.GLBL_CMPY_CD                          AS GLBL_CMPY_CD
                ,ACCS.SVC_PMIT_LVL_VAL_TXT                  AS SVC_ACCS_PMIT_VAL_TXT
                ,ACCS.SVC_ACCS_PMIT_NUM                     AS SVC_ACCS_PMIT_NUM
                ,ACV.SVC_ACCS_PMIT_DESC_TXT                 AS SVC_ACCS_PMIT_DESC_TXT
                ,TP.MACH_LVL_FLG                            AS MACH_LVL_FLG
                ,TP.SITE_LVL_FLG                            AS SITE_LVL_FLG
                ,TP.PTY_LVL_FLG                             AS PTY_LVL_FLG
            FROM
                 SVC_ACCS_PMIT ACCS
                ,SVC_PMIT_LVL_TP TP 
                ,SVC_ACCS_PMIT_VAL ACV
            WHERE
                    ACCS.GLBL_CMPY_CD                       = #glblCmpyCd#
                AND ACCS.EZCANCELFLAG                       = '0'
                AND ACCS.GLBL_CMPY_CD                       = ACV.GLBL_CMPY_CD
                AND ACCS.SVC_ACCS_PMIT_NUM                  = ACV.SVC_ACCS_PMIT_NUM
                AND ACV.EZCANCELFLAG                        = '0'
                AND ACCS.SVC_PMIT_LVL_TP_CD                 = TP.SVC_PMIT_LVL_TP_CD
                AND ACCS.GLBL_CMPY_CD                       = TP.GLBL_CMPY_CD
                AND TP.EZCANCELFLAG                         = '0'
        )
        ,TASK_WK AS (
            SELECT
                 SVC_TASK_NUM
                ,SER_NUM
                ,FSR_NUM
                ,GLBL_CMPY_CD
                ,SHIP_TO_CUST_CD
            FROM
                SVC_TASK TASK
            WHERE
                    TASK.SVC_TASK_NUM                       = #svcTaskNum#
                AND TASK.GLBL_CMPY_CD                       = #glblCmpyCd#
                AND TASK.EZCANCELFLAG                       = '0'
        )
        SELECT
             TASK.SVC_TASK_NUM                              AS SVC_TASK_NUM
            ,PMT.SVC_ACCS_PMIT_NUM                          AS SVC_ACCS_PMIT_NUM
            ,PMT.SVC_ACCS_PMIT_DESC_TXT                     AS SVC_ACCS_PMIT_DESC_TXT
        FROM
             TASK_WK TASK
            ,PMT_WK PMT
        WHERE
                PMT.MACH_LVL_FLG                            = 'Y'
            AND TASK.SER_NUM                                = PMT.SVC_ACCS_PMIT_VAL_TXT
        <!--UNION ALL-->
        UNION
        SELECT
             TASK.SVC_TASK_NUM                              AS SVC_TASK_NUM
            ,PMT.SVC_ACCS_PMIT_NUM                          AS SVC_ACCS_PMIT_NUM
            ,PMT.SVC_ACCS_PMIT_DESC_TXT                     AS SVC_ACCS_PMIT_DESC_TXT
        FROM
             TASK_WK TASK
            ,FSR FSR
            ,PMT_WK PMT
        WHERE
                TASK.FSR_NUM                                = FSR.FSR_NUM
            AND TASK.GLBL_CMPY_CD                           = FSR.GLBL_CMPY_CD
            AND FSR.EZCANCELFLAG                            = '0'
            AND PMT.SITE_LVL_FLG                            = 'Y'
            AND ((FSR.SHIP_TO_CUST_UPD_FLG                  = 'N' AND TASK.SHIP_TO_CUST_CD    = PMT.SVC_ACCS_PMIT_VAL_TXT) 
                OR (FSR.SHIP_TO_CUST_UPD_FLG                = 'Y' AND FSR.SHIP_TO_UPD_CUST_CD = PMT.SVC_ACCS_PMIT_VAL_TXT))
        <!--UNION ALL-->
        UNION
        SELECT
             TASK.SVC_TASK_NUM                              AS SVC_TASK_NUM
            ,PMT.SVC_ACCS_PMIT_NUM                          AS SVC_ACCS_PMIT_NUM
            ,PMT.SVC_ACCS_PMIT_DESC_TXT                     AS SVC_ACCS_PMIT_DESC_TXT
        FROM
             TASK_WK TASK
            ,FSR FSR
            ,PMT_WK PMT
        WHERE
                TASK.FSR_NUM                                = FSR.FSR_NUM
            AND TASK.GLBL_CMPY_CD                           = FSR.GLBL_CMPY_CD
            AND FSR.EZCANCELFLAG                            = '0'
            AND PMT.SITE_LVL_FLG                            = 'Y'
            AND ((FSR.BILL_TO_CUST_UPD_FLG                  = 'N' AND FSR.BILL_TO_CUST_CD     = PMT.SVC_ACCS_PMIT_VAL_TXT)
                OR (FSR.BILL_TO_CUST_UPD_FLG                = 'Y' AND FSR.BILL_TO_UPD_CUST_CD = PMT.SVC_ACCS_PMIT_VAL_TXT))
        <!--UNION ALL-->
        UNION
        SELECT
             TASK.SVC_TASK_NUM                              AS SVC_TASK_NUM
            ,PMT.SVC_ACCS_PMIT_NUM                          AS SVC_ACCS_PMIT_NUM
            ,PMT.SVC_ACCS_PMIT_DESC_TXT                     AS SVC_ACCS_PMIT_DESC_TXT
        FROM
             TASK_WK TASK
            ,FSR FSR
            ,PMT_WK PMT
        WHERE
                TASK.FSR_NUM                                = FSR.FSR_NUM
            AND TASK.GLBL_CMPY_CD                           = FSR.GLBL_CMPY_CD
            AND FSR.EZCANCELFLAG                            = '0'
            AND PMT.PTY_LVL_FLG                             = 'Y'
            AND FSR.SHIP_TO_CUST_ACCT_CD                    = PMT.SVC_ACCS_PMIT_VAL_TXT
        <!--UNION ALL-->
        UNION
        SELECT
             TASK.SVC_TASK_NUM                              AS SVC_TASK_NUM
            ,PMT.SVC_ACCS_PMIT_NUM                          AS SVC_ACCS_PMIT_NUM
            ,PMT.SVC_ACCS_PMIT_DESC_TXT                     AS SVC_ACCS_PMIT_DESC_TXT
        FROM
             TASK_WK TASK
            ,FSR FSR
            ,PMT_WK PMT
        WHERE
                TASK.FSR_NUM                                = FSR.FSR_NUM
            AND TASK.GLBL_CMPY_CD                           = FSR.GLBL_CMPY_CD
            AND FSR.EZCANCELFLAG                            = '0'
            AND PMT.PTY_LVL_FLG                             = 'Y'
            AND FSR.BILL_TO_CUST_ACCT_CD                    = PMT.SVC_ACCS_PMIT_VAL_TXT
        ORDER BY SVC_ACCS_PMIT_NUM
    </statement>
    <!-- END 2021/10/06 R.Jabal [QC#59183, ADD] -->
</sqlMap>
