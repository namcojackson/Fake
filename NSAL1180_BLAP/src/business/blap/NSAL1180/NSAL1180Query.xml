<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSAL1180Query">

    <statement id="findRgAndBr" parameterClass="Map" resultClass="Map">
        SELECT
            A.SVC_RG_PK
            ,A.SVC_RG_NM
            ,B1.LINE_BIZ_TP_CD
            ,B1.LINE_BIZ_TP_DESC_TXT
            ,D.SVC_CONTR_BR_CD
            ,D.SVC_CONTR_BR_DESC_TXT
        FROM
            SVC_RG          A
            ,LINE_BIZ_TP    B1
            ,AVAL_LINE_BIZ_TP_SRC B2
            ,SVC_RG_BR_RELN C
            ,SVC_CONTR_BR   D
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.SVC_RG_PK             = #svcRgPk#
            AND A.SVC_RG_ACTV_FLG       = 'Y'
            AND A.EFF_FROM_DT           &lt;= #slsDt#
            AND NVL(A.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = B1.GLBL_CMPY_CD
            AND A.SVC_LINE_BIZ_CD       = B1.LINE_BIZ_TP_CD
            AND B1.EZCANCELFLAG         = '0'
            AND B1.GLBL_CMPY_CD         = B2.GLBL_CMPY_CD
            AND B1.LINE_BIZ_TP_CD       = B2.LINE_BIZ_TP_CD
            AND B2.SYS_SRC_CD           = #sysSrcCd#
            AND B2.EZCANCELFLAG         = '0'
            AND A.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND A.SVC_RG_PK             = C.SVC_RG_PK
            <isNotNull property="svcContrBrCd">
            AND C.SVC_CONTR_BR_CD       = #svcContrBrCd#
            </isNotNull>
            AND C.EZCANCELFLAG          = '0'
            AND C.GLBL_CMPY_CD          = D.GLBL_CMPY_CD
            AND C.SVC_CONTR_BR_CD       = D.SVC_CONTR_BR_CD
            AND D.SVC_CONTR_BR_ACTV_FLG = 'Y'
            AND D.EFF_FROM_DT           &lt;= #slsDt#
            AND NVL(D.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
            AND D.EZCANCELFLAG          = '0'
    </statement>
    <statement id="findResource" parameterClass="Map" resultClass="Map">
        SELECT
             PSN_CD
            ,PSN_FIRST_NM
            ,PSN_MID_NM
            ,PSN_LAST_NM
            ,ORG_FUNC_ROLE_TP_CD
            ,ORG_FUNC_ROLE_TP_NM
            ,APVL_LIMIT_AMT
        FROM
            (SELECT
                 A.PSN_CD
                ,B.PSN_FIRST_NM
                ,B.PSN_MID_NM
                ,B.PSN_LAST_NM
                ,C.ORG_FUNC_ROLE_TP_CD
                ,C.ORG_FUNC_ROLE_TP_NM
                ,C.APVL_LIMIT_AMT
            FROM
                 SVC_BR_RESRC_RELN  A
                ,S21_PSN            B
                ,ORG_FUNC_ROLE_TP   C
            WHERE
                    A.GLBL_CMPY_CD              = #glblCmpyCd#
                AND A.SVC_CONTR_BR_CD           = #svcContrBrCd#
                AND A.SVC_BR_RESRC_ACTV_FLG     = 'Y'
                AND A.EFF_FROM_DT               &lt;= #slsDt#
                AND NVL(A.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
                AND A.EZCANCELFLAG              = '0'
                AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
                AND A.PSN_CD                    = B.PSN_CD
                AND B.EZCANCELFLAG              = '0'
                AND A.GLBL_CMPY_CD              = C.GLBL_CMPY_CD
                AND A.SVC_ORG_FUNC_ROLE_TP_CD   = C.ORG_FUNC_ROLE_TP_CD
                AND C.FIRST_ORG_CD              = #firstOrgCd#
                AND C.ACTV_FLG                  = 'Y'
                AND C.EZCANCELFLAG              = '0'
            ORDER BY
                 C.APVL_LIMIT_AMT DESC NULLS FIRST
                ,A.PSN_CD
            ) RESRC
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>
</sqlMap>
