<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NMAL6740Query">

    <statement id="getShipToCustInfoByShipToCustCd" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM
            (
            SELECT
                  STC.EZUPTIME
                , STC.EZUPTIMEZONE
                , ACCT.COA_CH_CD AS COA_CH_CD_ACCT
                , ACCT.COA_AFFL_CD AS COA_AFFL_CD_ACCT
                , STC.SHIP_TO_CUST_PK
                , STC.SHIP_TO_CUST_CD
                , STC.LOC_NUM
                --, STC.FIRST_LINE_ADDR || ' ' || STC.SCD_LINE_ADDR || ' ' || STC.THIRD_LINE_ADDR || ' ' || STC.FRTH_LINE_ADDR AS ALL_ADDR
                , STC.FIRST_LINE_ADDR ||
                  DECODE(STC.SCD_LINE_ADDR, NULL, '', ' ' || STC.SCD_LINE_ADDR) ||
                  DECODE(STC.THIRD_LINE_ADDR, NULL, '', ' ' || STC.THIRD_LINE_ADDR) ||
                  DECODE(STC.FRTH_LINE_ADDR, NULL, '', ' ' || STC.FRTH_LINE_ADDR) AS ALL_ADDR
                , STC.CTY_ADDR
                , STC.ST_CD
                , STC.POST_CD
                , STC.DS_CUST_TAX_CD
                , ACCT.DS_ACCT_NM 
                , STC.COA_CH_CD
                , STC.COA_AFFL_CD
                <!-- QC#6382 -->
                , CH.COA_CH_NM
                , AFFL.COA_AFFL_NM
                , STC.COA_CMPY_CD
                , STC.COA_BR_CD
                , STC.COA_CC_CD
                , STC.COA_ACCT_CD
                , STC.COA_PROD_CD
                , STC.COA_PROJ_CD
                , STC.COA_EXTN_CD
                , STC.DS_CUST_TAX_CD      AS TAX_CD
                , STC.DS_CUST_TAX_CALC_CD AS TAX_CALC_CD
                , STC.DS_TAX_EXEM_FLG
                , STC.DS_EXEM_EXPR_DT
                , STC.DS_TAX_GRP_EXEM_CD
                , STC.DS_TAX_PRNT_TP_CD
                , STC.BIG_DEAL_NUM
                <!-- Add Start 2016/11/02 M.Ohno S21_NA#2680 -->
                , STC.EZINTIME                  AS XX_REC_HIST_CRAT_TS
                , STC.EZINUSERID                AS XX_REC_HIST_CRAT_BY_NM
                , STC.EZUPTIME                  AS XX_REC_HIST_UPD_TS
                , STC.EZUPUSERID                AS XX_REC_HIST_UPD_BY_NM
                <!-- Add End   2016/11/02 M.Ohno S21_NA#2680 -->
            FROM
                  SHIP_TO_CUST STC
                , (
                    SELECT
                          CUST.GLBL_CMPY_CD
                        , CUST.EZCANCELFLAG
                        , CUST.SELL_TO_CUST_CD DS_ACCT_NUM
                        , CUST.COA_CH_CD
                        , CUST.COA_AFFL_CD
                        , CUST.DS_ACCT_NM
                    FROM
                        SELL_TO_CUST CUST
                    UNION ALL 
                    SELECT
                           PROS.GLBL_CMPY_CD
                         , PROS.EZCANCELFLAG
                         , PROS.DS_ACCT_NUM
                         , PROS.COA_CH_CD 
                         , PROS.COA_AFFL_CD
                         , PROS.DS_ACCT_NM
                    FROM
                        DS_ACCT_PROS PROS
                  ) ACCT 
                  <!-- QC#6382 -->
                , COA_CH CH
                , COA_AFFL AFFL 
            WHERE
                STC.GLBL_CMPY_CD    = #glblCmpyCd#
            AND STC.SHIP_TO_CUST_CD = #shipToCustCd#
            AND STC.EZCANCELFLAG    = '0'

            AND STC.GLBL_CMPY_CD    = ACCT.GLBL_CMPY_CD
            AND STC.SELL_TO_CUST_CD = ACCT.DS_ACCT_NUM
            AND ACCT.EZCANCELFLAG   = '0'
            <!-- QC#6382 -->
            AND STC.GLBL_CMPY_CD   = CH.GLBL_CMPY_CD(+)
            AND STC.COA_CH_CD      = CH.COA_CH_CD(+)
            AND CH.EZCANCELFLAG(+)  = '0'
            
            AND STC.GLBL_CMPY_CD   = AFFL.GLBL_CMPY_CD(+)
            AND STC.COA_AFFL_CD    = AFFL.COA_AFFL_CD(+)
            AND AFFL.EZCANCELFLAG(+)= '0'
            )
        WHERE 
            ROWNUM = #rowNum#
    </statement>
 
</sqlMap>
