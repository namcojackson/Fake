<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAL1330Query">

    <statement id="getItemCvrItem" parameterClass="Map" resultClass="Map">
        SELECT
            MD.MDSE_DESC_SHORT_TXT
            ,CDV.CPO_DTL_LINE_NUM
            ,CDV.CPO_DTL_LINE_SUB_NUM
            <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
            <!-- ,CDV.DPLY_LINE_NUM -->
            , CONCAT (CDV.DS_ORD_POSN_NUM, '.')
                || CONCAT (CDV.DS_CPO_LINE_NUM, DECODE (CDV.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
                || CDV.DS_CPO_LINE_SUB_NUM AS DPLY_LINE_NUM
            <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
        FROM 
             ALL_MDSE_V     MD
            <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
            <!-- ,CPO_DTL_V   CDV -->
            ,CPO_DTL       CDV
            <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
        WHERE
                MD.GLBL_CMPY_CD     = #glblCmpyCd#
            AND MD.MDSE_CD          = #itemCd#
            AND MD.GLBL_CMPY_CD     = CDV.GLBL_CMPY_CD
            AND CDV.CPO_ORD_NUM     = #orderNum#
            AND MD.MDSE_CD          = CDV.MDSE_CD
            AND MD.EZCANCELFLAG     = '0'
            AND CDV.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getItemAddItem" parameterClass="Map" resultClass="Map">
        SELECT
            MD.MDSE_DESC_SHORT_TXT
        FROM 
             ALL_MDSE_V MD
        WHERE
                MD.GLBL_CMPY_CD     = #glblCmpyCd#
            AND MD.MDSE_CD          = #itemCd#
            AND MD.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getTieredPrcListBox" parameterClass="Map" resultClass="Map">
        SELECT
             PTSO.PRC_TIER_SVC_OFFER_CD
            ,PTSO.PRC_TIER_SVC_OFFER_NM
        FROM 
            PRC_TIER_SVC_OFFER PTSO
        WHERE
                PTSO.GLBL_CMPY_CD = #glblCmpyCd#
            AND PTSO.EZCANCELFLAG = '0'
        ORDER BY
           PTSO.PRC_TIER_SVC_OFFER_SORT_NUM
    </statement>

    <statement id="getTierdByCatg" parameterClass="Map" resultClass="Map">
        SELECT
             PTSO.PRC_TIER_SVC_OFFER_CD
            ,PTSO.PRC_TIER_SVC_OFFER_NM
        FROM 
            PRC_TIER_SVC_OFFER          PTSO
            ,PRC_SVC_TIER_CONTR_ATTRB   PSTC
        WHERE
                PSTC.GLBL_CMPY_CD = #glblCmpyCd#
            AND PSTC.PRC_CATG_CD  = #prcCatgCd#
            AND PSTC.EZCANCELFLAG = '0'
            AND PSTC.GLBL_CMPY_CD = PTSO.GLBL_CMPY_CD
            AND PSTC.PRC_TIER_SVC_OFFER_CD  = PTSO.PRC_TIER_SVC_OFFER_CD
            AND PTSO.EZCANCELFLAG = '0'
        ORDER BY 
           PTSO.PRC_TIER_SVC_OFFER_SORT_NUM
    </statement>

    <statement id="getHeaderUpdate" parameterClass="Map" resultClass="Map">
        SELECT 
             DC.DS_CONTR_PK
            ,DC.MAN_CONTR_OVRD_FLG
            ,SM.SVC_MEMO_CATG_CD
            ,SM.SVC_MEMO_TP_CD
            ,SM.SVC_CMNT_TXT
            ,SM.SVC_MEMO_RSN_CD
            ,SMR.SVC_MEMO_RSN_DESC_TXT
        FROM 
             DS_CONTR            DC
            ,SVC_MEMO            SM
            ,SVC_MEMO_RSN        SMR
        WHERE
                DC.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DC.DS_CONTR_PK          = #dsContrPk#
            AND DC.EZCANCELFLAG         = '0'
            AND DC.GLBL_CMPY_CD         = SM.GLBL_CMPY_CD(+)
            AND DC.DS_CONTR_PK          = SM.DS_CONTR_PK(+)
            <!-- START 2017/07/28 [QC#20088, ADD] -->
            AND SM.SVC_MEMO_TP_CD(+)    = #svcMemoTpCd#
            AND SM.SVC_MEMO_TRX_NM(+)   = #svcMemoTrxNm#
            <!-- END   2017/07/28 [QC#20088, ADD] -->
            AND SM.EZCANCELFLAG(+)      = '0'
            AND SM.GLBL_CMPY_CD         = SMR.GLBL_CMPY_CD(+)
            AND SM.SVC_MEMO_RSN_CD      = SMR.SVC_MEMO_RSN_CD(+)
            AND SMR.EZCANCELFLAG(+)     = '0'
    </statement>
    
    <statement id="getInitAcsryForRental" parameterClass="Map" resultClass="Map">
        SELECT
                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                <!--   CD.DPLY_LINE_NUM -->
                  CONCAT (CD.DS_ORD_POSN_NUM, '.')
                    || CONCAT (CD.DS_CPO_LINE_NUM, DECODE (CD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
                    || CD.DS_CPO_LINE_SUB_NUM AS DPLY_LINE_NUM
                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                , CD.CPO_DTL_LINE_NUM
                , CD.CPO_DTL_LINE_SUB_NUM
                , CD.PRC_CATG_CD
                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                <!-- , CD.PRC_CATG_NM -->
                , PC.PRC_CATG_NM
                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                , M.MDSE_CD
                , M.MDSE_DESC_SHORT_TXT
                , CD.PRC_LIST_EQUIP_CONFIG_NUM
                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                <!-- , CD.PRC_LIST_EQUIP_CONFIG_NM -->
                , (
                     SELECT
                         PLE.PRC_LIST_EQUIP_CONFIG_NM
                     FROM
                          CPO            C
                         ,PRC_LIST_EQUIP PLE
                     WHERE
                             CD.GLBL_CMPY_CD                       = C.GLBL_CMPY_CD
                         AND CD.CPO_ORD_NUM                        = C.CPO_ORD_NUM
                         AND C.EZCANCELFLAG                        = '0'
                         AND CD.GLBL_CMPY_CD                       = PLE.GLBL_CMPY_CD
                         AND CD.PRC_LIST_EQUIP_CONFIG_NUM          = PLE.PRC_LIST_EQUIP_CONFIG_NUM
                         AND CD.PRC_CATG_CD                        = PLE.PRC_CATG_CD
                         AND PLE.PRC_QLFY_TP_CD                    = #prcQlfyTpItemCode#
                         AND SUBSTR (CD.MDSE_CD, 1, 8)             = PLE.PRC_QLFY_VAL_TXT
                         AND CD.CUST_UOM_CD                        = PLE.PKG_UOM_CD
                         AND PLE.EZCANCELFLAG                      = '0'
                         AND PLE.DEL_FLG                           = 'N'
                         AND PLE.EFF_FROM_DT                   &lt;= NVL (CD.CPO_ORD_TS, C.CPO_ORD_TS)
                         AND NVL (PLE.EFF_THRU_DT, '99991231') &gt;= NVL (CD.CPO_ORD_TS, C.CPO_ORD_TS)
                         AND ROWNUM = 1
                  ) AS PRC_LIST_EQUIP_CONFIG_NM
                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                , CASE 
                    WHEN 
                  <isNotEqual property="checkFlg" compareValue="Y">
                    NOT EXISTS (
                        SELECT
                                  CAC.GLBL_CMPY_CD
                            FROM
                                  DS_CONTR_ADDL_CHRG    CAC
                                , DS_CONTR_DTL          DCD
                            WHERE
                                    CAC.GLBL_CMPY_CD            = DCD.GLBL_CMPY_CD
                                AND CAC.DS_CONTR_PK             = DCD.DS_CONTR_PK
                                AND CAC.DS_CONTR_DTL_PK         = DCD.DS_CONTR_DTL_PK
                                AND CAC.EZCANCELFLAG            = '0'
                                --
                                AND DCD.CPO_ORD_NUM             = CD.CPO_ORD_NUM
                                AND DCD.CPO_DTL_LINE_NUM        = CD.CPO_DTL_LINE_NUM
                                AND DCD.CPO_DTL_LINE_SUB_NUM    = CD.CPO_DTL_LINE_SUB_NUM
                                AND DCD.SVC_PRC_CATG_CD         = #svcPrcCatgRentalEq#  --'REBC'
                                AND DCD.SHELL_LINE_NUM          = #shellLineNum#
                                AND DCD.EZCANCELFLAG            = '0'
                    ) 
                    AND 
                  </isNotEqual>
                    EXISTS (
                        SELECT
                                  MTVS.GLBL_CMPY_CD
                            FROM
                                MDSE_TP_VAL_SET     MTVS
                            WHERE
                                MTVS.GLBL_CMPY_CD           = M.GLBL_CMPY_CD 
                                AND MTVS.COA_MDSE_TP_CD     = M.COA_MDSE_TP_CD 
                                AND MTVS.MDSE_TP_CTX_TP_CD IN
                                <iterate property="mdseTpCtxTp" var="mdseTpCtxTp[]" open=" (" close=")" conjunction=",">
                                     #mdseTpCtxTp[]#
                                </iterate>
                                AND MTVS.EZCANCELFLAG       = '0'
                    ) 
                    THEN    'Y'
                    ELSE    'N'
                    END             RENTAL_FLG
                , CASE 
                    WHEN CD.BASE_CMPT_FLG = 'Y' THEN 'N'    <!-- QC#27738 -->
                    WHEN 
                  <isNotEqual property="checkFlg" compareValue="Y">
                    NOT EXISTS (
                        SELECT
                                  CAC.GLBL_CMPY_CD
                            FROM
                                  DS_CONTR_ADDL_CHRG    CAC
                                , DS_CONTR_DTL          DCD
                            WHERE
                                    CAC.GLBL_CMPY_CD            = DCD.GLBL_CMPY_CD
                                AND CAC.DS_CONTR_PK             = DCD.DS_CONTR_PK
                                AND CAC.DS_CONTR_DTL_PK         = DCD.DS_CONTR_DTL_PK
                                AND CAC.EZCANCELFLAG            = '0'
                                --
                                AND DCD.CPO_ORD_NUM             = CD.CPO_ORD_NUM
                                AND DCD.CPO_DTL_LINE_NUM        = CD.CPO_DTL_LINE_NUM
                                AND DCD.CPO_DTL_LINE_SUB_NUM    = CD.CPO_DTL_LINE_SUB_NUM
                                AND DCD.SVC_PRC_CATG_CD         = #svcPrcCatgAcsryChrg#  --'AUBC'
                                AND DCD.SHELL_LINE_NUM          = #shellLineNum#
                                AND DCD.EZCANCELFLAG            = '0'
                    )
                    AND 
                  </isNotEqual>
                    EXISTS (
                        SELECT
                                  MTVS.GLBL_CMPY_CD
                            FROM
                                MDSE_TP_VAL_SET     MTVS
                            WHERE
                                MTVS.GLBL_CMPY_CD           = M.GLBL_CMPY_CD
                                AND MTVS.COA_MDSE_TP_CD     = M.COA_MDSE_TP_CD
                                AND MTVS.MDSE_TP_CTX_TP_CD  = #mdseTpCtxCpoSvcAddlBaseItems#    -- 'CPO_SVC_ADDL_BASE_ITEMS'
                                AND MTVS.EZCANCELFLAG       = '0'
                    ) 
                    THEN 'Y'
                    ELSE 'N'
                    END         ACSRY_FLG
                    --
            FROM
                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                <!--   CPO_DTL_V         CD -->
                  CPO_DTL           CD
                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                , ALL_MDSE_V        M
                <!-- START 2017/07/24 K.Kojima [QC#19793,ADD] -->
                , PRC_CATG          PC
                <!-- END 2017/07/24 K.Kojima [QC#19793,ADD] -->
            WHERE
                CD.GLBL_CMPY_CD             = #glblCmpyCd#
                AND CD.CPO_ORD_NUM          = #cpoOrdNum#
                <!-- START 2017/07/24 K.Kojima [QC#19793,DEL] -->
                <!-- <isNotNull property="closeFlg"> -->
                <!-- AND CD.DPLY_LINE_NUM   NOT IN -->
                <!-- <iterate property="dplyLineNum" var="dplyLineNum[]" open=" (" close=")" conjunction=","> -->
                <!-- #dplyLineNum[]# -->
                <!-- </iterate> -->
                <!-- </isNotNull> -->
                <!-- END 2017/07/24 K.Kojima [QC#19793,DEL] -->
                AND CD.EZCANCELFLAG         = '0'
                AND CD.GLBL_CMPY_CD         = M.GLBL_CMPY_CD
                AND CD.MDSE_CD              = M.MDSE_CD
                AND M.INSTL_BASE_CTRL_FLG   = 'Y'
                AND M.EZCANCELFLAG          = '0'
                <!-- START 2017/07/24 K.Kojima [QC#19793,ADD] -->
                AND CD.GLBL_CMPY_CD         = PC.GLBL_CMPY_CD(+)
                AND CD.PRC_CATG_CD          = PC.PRC_CATG_CD(+)
                AND PC.EZCANCELFLAG(+)      = '0'
                <!-- END 2017/07/24 K.Kojima [QC#19793,ADD] -->
                --
                AND EXISTS (
                    SELECT
                              OCBC.GLBL_CMPY_CD
                        FROM
                            ORD_CATG_BIZ_CTX OCBC
                        WHERE
                            OCBC.GLBL_CMPY_CD           = #glblCmpyCd#
                            AND OCBC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTp#
                            AND OCBC.DS_ORD_CATG_CD     = #dsOrdCatgCd#
                            AND ( 
                                OCBC.DS_ORD_TP_CD       = #dsOrdTpCd#
                                OR OCBC.DS_ORD_TP_CD   IS NULL
                            ) 
                            AND OCBC.EZCANCELFLAG = '0'
                )
                AND EXISTS (
                        SELECT
                                  DCD.GLBL_CMPY_CD
                            FROM
                                  DS_CONTR_DTL          DCD
                            WHERE
                                    DCD.GLBL_CMPY_CD            = CD.GLBL_CMPY_CD
                                AND DCD.CPO_ORD_NUM             = CD.CPO_ORD_NUM
                                AND (
                                       (DCD.CPO_DTL_LINE_NUM = CD.REF_CPO_DTL_LINE_NUM 
                                          AND DCD.CPO_DTL_LINE_SUB_NUM = CD.REF_CPO_DTL_LINE_SUB_NUM)
                                    OR
                                       (DCD.CPO_DTL_LINE_NUM = CD.CPO_DTL_LINE_NUM 
                                          AND DCD.CPO_DTL_LINE_SUB_NUM = CD.CPO_DTL_LINE_SUB_NUM)
                                )
                                AND DCD.SHELL_LINE_NUM          = #shellLineNum#
                                AND DCD.EZCANCELFLAG            = '0'
                )
                --
                <!-- 2019/05/08 QC#50174 Mod Start -->
                AND CD.ORD_LINE_STS_CD          &lt;&gt; #ordLineStsCancel#
                <!-- 2019/05/08 QC#50174 Mod End -->
            ORDER BY
            <!-- START 2017/09/01 [QC#20820, ADD] -->
            <!-- CD.DS_ORD_POSN_NUM               -->
                  TO_NUMBER(CD.DS_ORD_POSN_NUM)
            <!-- END   2017/09/01 [QC#20820, ADD] -->
                , CD.DS_CPO_LINE_NUM
                , CD.DS_CPO_LINE_SUB_NUM
    </statement>

    <statement id="getUpdateAcsry" parameterClass="Map" resultClass="Map">
        SELECT
              DPC.PRC_LIST_DPLY_NM
            , DCD.PRC_CATG_CD
            <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
            <!-- , CD.DPLY_LINE_NUM -->
            , CONCAT (CD.DS_ORD_POSN_NUM, '.')
               || CONCAT (CD.DS_CPO_LINE_NUM, DECODE (CD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
               || CD.DS_CPO_LINE_SUB_NUM AS DPLY_LINE_NUM
            <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
            , CD.CPO_DTL_LINE_NUM
            , CD.CPO_DTL_LINE_SUB_NUM
            , M.MDSE_CD
            , M.MDSE_DESC_SHORT_TXT
            , CD.PRC_LIST_EQUIP_CONFIG_NUM
            <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
            <!-- , CD.PRC_LIST_EQUIP_CONFIG_NM -->
            , (
                 SELECT
                     PLE.PRC_LIST_EQUIP_CONFIG_NM
                 FROM
                      CPO            C
                     ,PRC_LIST_EQUIP PLE
                 WHERE
                         CD.GLBL_CMPY_CD                       = C.GLBL_CMPY_CD
                     AND CD.CPO_ORD_NUM                        = C.CPO_ORD_NUM
                     AND C.EZCANCELFLAG                        = '0'
                     AND CD.GLBL_CMPY_CD                       = PLE.GLBL_CMPY_CD
                     AND CD.PRC_LIST_EQUIP_CONFIG_NUM          = PLE.PRC_LIST_EQUIP_CONFIG_NUM
                     AND CD.PRC_CATG_CD                        = PLE.PRC_CATG_CD
                     AND PLE.PRC_QLFY_TP_CD                    = #prcQlfyTpItemCode#
                     AND SUBSTR (CD.MDSE_CD, 1, 8)             = PLE.PRC_QLFY_VAL_TXT
                     AND CD.CUST_UOM_CD                        = PLE.PKG_UOM_CD
                     AND PLE.EZCANCELFLAG                      = '0'
                     AND PLE.DEL_FLG                           = 'N'
                     AND PLE.EFF_FROM_DT                   &lt;= NVL (CD.CPO_ORD_TS, C.CPO_ORD_TS)
                     AND NVL (PLE.EFF_THRU_DT, '99991231') &gt;= NVL (CD.CPO_ORD_TS, C.CPO_ORD_TS)
                     AND ROWNUM = 1
              ) AS PRC_LIST_EQUIP_CONFIG_NM
            <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
            , DCD.BASE_PRC_DEAL_AMT
        FROM 
            <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
            <!--   CPO_DTL_V             CD -->
              CPO_DTL               CD
            <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
            , DS_CONTR_DTL          DCD
            , PRC_CATG              DPC
            , ALL_MDSE_V            M
        WHERE
                CD.GLBL_CMPY_CD           = #glblCmpyCd#
            AND CD.CPO_ORD_NUM            = #orderNum#
            AND CD.CPO_DTL_LINE_NUM       = #lineNum#
            AND CD.CPO_DTL_LINE_SUB_NUM   = #lineSubNum#
            AND CD.EZCANCELFLAG           = '0'
            AND CD.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD(+)
            AND CD.CPO_ORD_NUM            = DCD.CPO_ORD_NUM(+)
            AND CD.CPO_DTL_LINE_NUM       = DCD.CPO_DTL_LINE_NUM(+)
            AND CD.CPO_DTL_LINE_SUB_NUM   = DCD.CPO_DTL_LINE_SUB_NUM(+)
            <!-- START 2019/02/26  K.Fujimoto [QC#30525, MOD] -->
            <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
            <!-- AND DCD.DS_CONTR_CRAT_TP_CD   IN (#dsContrCratTpShell#, #dsContrCratTpSupply#)  -->
            AND DCD.DS_CONTR_CRAT_TP_CD   = #dsContrCratTpShell#
            <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
            <!-- END   2019/02/26  K.Fujimoto [QC#30525, MOD] -->
            AND DCD.DS_CONTR_DTL_TP_CD    = #dsContrDtlTpCd#
            AND DCD.EZCANCELFLAG          = '0'
            AND DCD.GLBL_CMPY_CD          = DPC.GLBL_CMPY_CD(+)
            AND DCD.PRC_CATG_CD           = DPC.PRC_CATG_CD(+)
            AND DPC.EZCANCELFLAG(+)       = '0'
            AND CD.GLBL_CMPY_CD           = M.GLBL_CMPY_CD(+)
            AND CD.MDSE_CD                = M.MDSE_CD(+)
            AND M.EZCANCELFLAG(+)         = '0'
    </statement>

    <statement id="getUpdateAddChrg" parameterClass="Map" resultClass="Map">
        SELECT
              DPC.PRC_LIST_DPLY_NM
            , CAC.PRC_CATG_CD
            <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
            <!-- , CD.DPLY_LINE_NUM -->
            , CONCAT (CD.DS_ORD_POSN_NUM, '.')
               || CONCAT (CD.DS_CPO_LINE_NUM, DECODE (CD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
               || CD.DS_CPO_LINE_SUB_NUM AS DPLY_LINE_NUM
            <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
            , CD.CPO_DTL_LINE_NUM
            , CD.CPO_DTL_LINE_SUB_NUM
            , CD.MDSE_CD
            , M.MDSE_DESC_SHORT_TXT              UNIT_MDSE
            , CAC.ADDL_CHRG_TP_CD
            , CAC.ADDL_CHRG_FLAT_DEAL_PRC_AMT
        FROM 
            <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
            <!--   CPO_DTL_V             CD -->
              CPO_DTL               CD
            <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
            , DS_CONTR_DTL          DCD
            , DS_CONTR_ADDL_CHRG    CAC
            , PRC_CATG              DPC
            , ALL_MDSE_V            M
        WHERE
                CD.GLBL_CMPY_CD             = #glblCmpyCd#
            AND CD.CPO_ORD_NUM              = #orderNum#
            AND CD.CPO_DTL_LINE_NUM         = #lineNum#
            AND CD.CPO_DTL_LINE_SUB_NUM     = #lineSubNum#
            AND CD.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD(+)
            AND CD.CPO_ORD_NUM              = DCD.CPO_ORD_NUM(+)
            AND CD.CPO_DTL_LINE_NUM         = DCD.CPO_DTL_LINE_NUM(+)
            AND CD.CPO_DTL_LINE_SUB_NUM     = DCD.CPO_DTL_LINE_SUB_NUM(+)
            AND DCD.SHELL_LINE_NUM(+)       IS NOT NULL
            AND DCD.EZCANCELFLAG(+)         = '0'
            AND DCD.GLBL_CMPY_CD            = CAC.GLBL_CMPY_CD(+)
            AND DCD.DS_CONTR_PK             = CAC.DS_CONTR_PK(+)
            AND DCD.DS_CONTR_DTL_PK         = CAC.DS_CONTR_DTL_PK(+)
            <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
            AND DCD.DS_CONTR_CRAT_TP_CD(+)  = #dsContrCratTpShell#
            <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
            AND CAC.EZCANCELFLAG(+)         = '0'
            AND CAC.GLBL_CMPY_CD            = DPC.GLBL_CMPY_CD(+)
            AND CAC.PRC_CATG_CD             = DPC.PRC_CATG_CD(+)
            AND DPC.EZCANCELFLAG(+)         = '0'
            AND CD.GLBL_CMPY_CD             = M.GLBL_CMPY_CD(+)
            AND CD.MDSE_CD                  = M.MDSE_CD(+)
            AND M.EZCANCELFLAG(+)           = '0'
    </statement>
    
    <statement id="getContrRsnNm" parameterClass="Map" resultClass="Map">
        SELECT 
            SMR.SVC_MEMO_RSN_DESC_TXT
        FROM 
            SVC_MEMO_RSN       SMR
        WHERE
                SMR.GLBL_CMPY_CD            = #glblCmpyCd#
            AND SMR.SVC_MEMO_RSN_CD         = #rsnCd#
            AND SMR.EZCANCELFLAG            = '0'
    </statement>
        
    <statement id="getDsContrNum" parameterClass="Map" resultClass="Map">
        SELECT
            DC.DS_CONTR_NUM
        FROM 
            DS_CONTR      DC
        WHERE
                DC.DS_CONTR_PK          = #dsContrPk#
            AND DC.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DC.EZCANCELFLAG         = '0'
    </statement>
    
    <statement id="getSvcPricingPkList" parameterClass="Map" resultClass="Map">
        SELECT 
            PMP.PRC_MTR_PKG_NM
            ,PMP.PRC_MTR_PKG_PK
        FROM 
            PRC_MTR_PKG            PMP
        WHERE
                PMP.GLBL_CMPY_CD    = #glblCmpyCd#
            AND PMP.PRC_MTR_PKG_PK  = #pkgPk#
            AND PMP.EZCANCELFLAG    = '0'
    </statement>
           
    <statement id="getbllgCycle" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            BC.BLLG_CYCLE_MTH_AOT
        FROM
            BLLG_CYCLE  BC
        WHERE
                BC.GLBL_CMPY_CD         = #glblCmpyCd#
            AND BC.BLLG_CYCLE_CD        = #bllgCycleCd#
            AND BC.BLLG_CYCLE_ACTV_FLG  = 'Y'
            AND BC.EFF_FROM_DT      &lt;= #effFromDt#
            AND ( BC.EFF_THRU_DT        &gt;= #effFromDt#
                OR BC.EFF_THRU_DT     IS NULL )
            AND BC.EZCANCELFLAG         = '0'
    </statement>
       
                  
    <statement id="getMdlNm" parameterClass="Map" resultClass="Map">
        SELECT
            MN.T_MDL_NM
        FROM 
            MDL_NM      MN
        WHERE
                MN.T_MDL_ID         = #mdlId#
            AND MN.T_GLBL_CMPY_CD   = #glblCmpyCd#
            AND MN.EZCANCELFLAG     = '0'
    </statement>
       
           
    <statement id="getMdseNm" parameterClass="Map" resultClass="String">
        SELECT
            MD.MDSE_DESC_SHORT_TXT
        FROM 
            ALL_MDSE_V      MD
        WHERE
                MD.MDSE_CD          = #mdseCd#
            AND MD.GLBL_CMPY_CD     = #glblCmpyCd#
            AND MD.EZCANCELFLAG     = '0'
    </statement>
       
           
    <statement id="getPrcCatgNm" parameterClass="Map" resultClass="Map">
        SELECT
            PC.PRC_CATG_NM
        FROM 
            PRC_CATG      PC
        WHERE
                PC.PRC_CATG_CD      = #prcCatgCd#
            AND PC.GLBL_CMPY_CD     = #glblCmpyCd#
            AND PC.EZCANCELFLAG     = '0'
    </statement>
           
    <statement id="getPrcListTp" parameterClass="Map" resultClass="Map">
        SELECT
            PLT.PRC_LIST_TP_CD
        FROM
             PRC_CATG                PC
            ,PRC_LIST_TP             PLT
        WHERE
                PC.GLBL_CMPY_CD      = #glblCmpyCd#
            AND PC.PRC_CATG_CD       = #prcCatgCd#
            AND PC.GLBL_CMPY_CD      = PLT.GLBL_CMPY_CD
            AND PC.PRC_LIST_TP_CD    = PLT.PRC_LIST_TP_CD
            AND PC.EZCANCELFLAG      = '0'
            AND PLT.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getSvcPkg21" parameterClass="Map" resultClass="Map">
        SELECT
            PM.PRC_MTR_PKG_PK
            ,PM.PRC_MTR_PKG_NM
        FROM 
             PRC_LIST_SPLY_PGM       PL
            ,PRC_MTR_PKG             PM
            ,PRC_MTR_PKG_MTR_STRU_V  V
        WHERE
            PL.GLBL_CMPY_CD             = #glblCmpyCd#
            AND PL.PRC_CATG_CD          = #prcCatgCd#
            AND PL.MDL_ID               = #modelId#
            AND PL.PRC_SVC_PLN_TP_CD    = #prcSvcPlnTp#
            AND PL.PRC_SVC_CONTR_TP_CD  = #prcSvcContrTp#
            --
            AND PL.DEL_FLG              = 'N'
            AND PL.EFF_FROM_DT         &lt;= #slsDt#
            AND ( 
                PL.EFF_THRU_DT         IS NULL 
                OR PL.EFF_THRU_DT      &gt;= #slsDt#
            )
            --
            AND PL.GLBL_CMPY_CD         = PM.GLBL_CMPY_CD 
            AND PL.PRC_MTR_PKG_PK       = PM.PRC_MTR_PKG_PK
            --
            AND PM.GLBL_CMPY_CD                 = V.GLBL_CMPY_CD
            AND PM.PRC_MTR_PKG_PK               = V.PRC_MTR_PKG_PK
            AND V.MDL_MTR_EFF_FROM_DT          &lt;= #slsDt#
            AND (
                V.MDL_MTR_EFF_THRU_DT          IS NULL
                OR V.MDL_MTR_EFF_THRU_DT       &gt;= #slsDt#
                )
            AND V.BLLG_MTR_MAP_EFF_FROM_DT     &lt;= #slsDt#
            AND (
                V.BLLG_MTR_MAP_EFF_THRU_DT     IS NULL
                OR V.BLLG_MTR_MAP_EFF_THRU_DT  &gt;= #slsDt#
                )
            AND V.MTR_PKG_EFF_FROM_DT          &lt;= #slsDt#
            AND (
                V.MTR_PKG_EFF_THRU_DT          IS NULL
                OR V.MTR_PKG_EFF_THRU_DT       &gt;= #slsDt#
                )
            AND V.MTR_PKG_MDL_EFF_FROM_DT      &lt;= #slsDt#
            AND (
                V.MTR_PKG_MDL_EFF_THRU_DT      IS NULL
                OR V.MTR_PKG_MDL_EFF_THRU_DT   &gt;= #slsDt#
                )
            AND V.EZCANCELFLAG          = '0'
            --
            AND PL.EZCANCELFLAG         = '0'
            AND PM.EZCANCELFLAG         = '0'
        GROUP BY
            PM.PRC_MTR_PKG_PK
            ,PM.PRC_MTR_PKG_NM
        ORDER BY
            PM.PRC_MTR_PKG_NM
    </statement>

    <statement id="getSvcPkg21FL" parameterClass="Map" resultClass="Map">
        SELECT
            PM.PRC_MTR_PKG_PK
            ,PM.PRC_MTR_PKG_NM
        FROM 
             PRC_LIST_SPLY_PGM       PL
            ,PRC_MTR_PKG             PM
            ,PRC_MTR_PKG_MTR_STRU_V  V
        WHERE
            PL.GLBL_CMPY_CD             = #glblCmpyCd#
            AND PL.PRC_CATG_CD          = #prcCatgCd#
            AND PL.MDL_ID               IN
            <iterate property="modelId" var="modelId[]" open="(" close=")" conjunction=",">#modelId[]#</iterate>
            AND PL.PRC_SVC_PLN_TP_CD    = #prcSvcPlnTp#
            AND PL.PRC_SVC_CONTR_TP_CD  = #prcSvcContrTp#
            --
            AND PL.DEL_FLG              = 'N'
            AND PL.EFF_FROM_DT         &lt;= #slsDt#
            AND ( 
                PL.EFF_THRU_DT         IS NULL 
                OR PL.EFF_THRU_DT      &gt;= #slsDt#
            )
            --
            AND PL.GLBL_CMPY_CD         = PM.GLBL_CMPY_CD
            AND PL.PRC_MTR_PKG_PK       = PM.PRC_MTR_PKG_PK
            --
            AND PM.GLBL_CMPY_CD                 = V.GLBL_CMPY_CD
            AND PM.PRC_MTR_PKG_PK               = V.PRC_MTR_PKG_PK
            AND V.MDL_MTR_EFF_FROM_DT          &lt;= #slsDt#
            AND (
                V.MDL_MTR_EFF_THRU_DT          IS NULL
                OR V.MDL_MTR_EFF_THRU_DT       &gt;= #slsDt#
                )
            AND V.BLLG_MTR_MAP_EFF_FROM_DT     &lt;= #slsDt#
            AND (
                V.BLLG_MTR_MAP_EFF_THRU_DT     IS NULL
                OR V.BLLG_MTR_MAP_EFF_THRU_DT  &gt;= #slsDt#
                )
            AND V.MTR_PKG_EFF_FROM_DT          &lt;= #slsDt#
            AND (
                V.MTR_PKG_EFF_THRU_DT          IS NULL
                OR V.MTR_PKG_EFF_THRU_DT       &gt;= #slsDt#
                )
            AND V.MTR_PKG_MDL_EFF_FROM_DT      &lt;= #slsDt#
            AND (
                V.MTR_PKG_MDL_EFF_THRU_DT      IS NULL
                OR V.MTR_PKG_MDL_EFF_THRU_DT   &gt;= #slsDt#
                )
            AND V.EZCANCELFLAG          = '0'
            --
            AND PL.EZCANCELFLAG         = '0'
            AND PM.EZCANCELFLAG         = '0'
        GROUP BY
            PM.PRC_MTR_PKG_PK
            ,PM.PRC_MTR_PKG_NM
        ORDER BY
            PM.PRC_MTR_PKG_NM
    </statement>

    <statement id="getSvcPkg07" parameterClass="Map" resultClass="Map">
        SELECT
            PM.PRC_MTR_PKG_PK
            ,PM.PRC_MTR_PKG_NM
        FROM 
             PRC_LIST_SVC_TIER       PL
            ,PRC_MTR_PKG             PM
            ,PRC_MTR_PKG_MTR_STRU_V  V
        WHERE
            PL.GLBL_CMPY_CD             = #glblCmpyCd#
            AND PL.PRC_CATG_CD          = #prcCatgCd#
            AND PL.MDL_ID               = #modelId#
            AND PL.PRC_SVC_PLN_TP_CD    = #prcSvcPlnTp#
            AND PL.PRC_SVC_CONTR_TP_CD  = #prcSvcContrTp#
            --
            AND PL.DEL_FLG              = 'N'
            AND PL.EFF_FROM_DT         &lt;= #slsDt#
            AND ( 
                PL.EFF_THRU_DT         IS NULL 
                OR PL.EFF_THRU_DT      &gt;= #slsDt#
            )
            --
            AND PL.GLBL_CMPY_CD         = PM.GLBL_CMPY_CD
            AND PL.PRC_MTR_PKG_PK       = PM.PRC_MTR_PKG_PK
            --
            AND PM.GLBL_CMPY_CD                 = V.GLBL_CMPY_CD
            AND PM.PRC_MTR_PKG_PK               = V.PRC_MTR_PKG_PK
            AND V.MDL_MTR_EFF_FROM_DT          &lt;= #slsDt#
            AND (
                V.MDL_MTR_EFF_THRU_DT          IS NULL
                OR V.MDL_MTR_EFF_THRU_DT       &gt;= #slsDt#
                )
            AND V.BLLG_MTR_MAP_EFF_FROM_DT     &lt;= #slsDt#
            AND (
                V.BLLG_MTR_MAP_EFF_THRU_DT     IS NULL
                OR V.BLLG_MTR_MAP_EFF_THRU_DT  &gt;= #slsDt#
                )
            AND V.MTR_PKG_EFF_FROM_DT          &lt;= #slsDt#
            AND (
                V.MTR_PKG_EFF_THRU_DT          IS NULL
                OR V.MTR_PKG_EFF_THRU_DT       &gt;= #slsDt#
                )
            AND V.MTR_PKG_MDL_EFF_FROM_DT      &lt;= #slsDt#
            AND (
                V.MTR_PKG_MDL_EFF_THRU_DT      IS NULL
                OR V.MTR_PKG_MDL_EFF_THRU_DT   &gt;= #slsDt#
                )
            AND V.EZCANCELFLAG          = '0'
            --
            AND PL.EZCANCELFLAG         = '0'
            AND PM.EZCANCELFLAG         = '0'
        GROUP BY
            PM.PRC_MTR_PKG_PK
            ,PM.PRC_MTR_PKG_NM
        ORDER BY
            PM.PRC_MTR_PKG_NM
    </statement>

    <statement id="getSvcPkg07FL" parameterClass="Map" resultClass="Map">
        SELECT
            PM.PRC_MTR_PKG_PK
            ,PM.PRC_MTR_PKG_NM
        FROM 
             PRC_LIST_SVC_TIER       PL
            ,PRC_MTR_PKG             PM
            ,PRC_MTR_PKG_MTR_STRU_V  V
        WHERE
            PL.GLBL_CMPY_CD             = #glblCmpyCd#
            AND PL.PRC_CATG_CD          = #prcCatgCd#
            AND PL.MDL_ID               IN
            <iterate property="modelId" var="modelId[]" open="(" close=")" conjunction=",">#modelId[]#</iterate>
            AND PL.PRC_SVC_PLN_TP_CD    = #prcSvcPlnTp#
            AND PL.PRC_SVC_CONTR_TP_CD  = #prcSvcContrTp#
            --
            AND PL.DEL_FLG              = 'N'
            AND PL.EFF_FROM_DT         &lt;= #slsDt#
            AND ( 
                PL.EFF_THRU_DT         IS NULL 
                OR PL.EFF_THRU_DT      &gt;= #slsDt#
            )
            --
            AND PL.GLBL_CMPY_CD         = PM.GLBL_CMPY_CD
            AND PL.PRC_MTR_PKG_PK       = PM.PRC_MTR_PKG_PK
            --
            AND PM.GLBL_CMPY_CD                 = V.GLBL_CMPY_CD
            AND PM.PRC_MTR_PKG_PK               = V.PRC_MTR_PKG_PK
            AND V.MDL_MTR_EFF_FROM_DT          &lt;= #slsDt#
            AND (
                V.MDL_MTR_EFF_THRU_DT          IS NULL
                OR V.MDL_MTR_EFF_THRU_DT       &gt;= #slsDt#
                )
            AND V.BLLG_MTR_MAP_EFF_FROM_DT     &lt;= #slsDt#
            AND (
                V.BLLG_MTR_MAP_EFF_THRU_DT     IS NULL
                OR V.BLLG_MTR_MAP_EFF_THRU_DT  &gt;= #slsDt#
                )
            AND V.MTR_PKG_EFF_FROM_DT          &lt;= #slsDt#
            AND (
                V.MTR_PKG_EFF_THRU_DT          IS NULL
                OR V.MTR_PKG_EFF_THRU_DT       &gt;= #slsDt#
                )
            AND V.MTR_PKG_MDL_EFF_FROM_DT      &lt;= #slsDt#
            AND (
                V.MTR_PKG_MDL_EFF_THRU_DT      IS NULL
                OR V.MTR_PKG_MDL_EFF_THRU_DT   &gt;= #slsDt#
                )
            AND V.EZCANCELFLAG          = '0'
            --
            AND PL.EZCANCELFLAG         = '0'
            AND PM.EZCANCELFLAG         = '0'
        GROUP BY
            PM.PRC_MTR_PKG_PK
            ,PM.PRC_MTR_PKG_NM
        ORDER BY
            PM.PRC_MTR_PKG_NM
    </statement>

    <statement id="getSvcPkg" parameterClass="Map" resultClass="Map">
        SELECT
            PM.PRC_MTR_PKG_PK
            ,PM.PRC_MTR_PKG_NM
        FROM 
             PRC_LIST_SVC           PL
            ,PRC_MTR_PKG            PM
            ,PRC_MTR_PKG_MTR_STRU_V V
        WHERE
            PL.GLBL_CMPY_CD             = #glblCmpyCd#
            AND PL.PRC_CATG_CD          = #prcCatgCd#
            AND PL.MDL_ID               = #modelId#
            AND PL.PRC_SVC_PLN_TP_CD    = #prcSvcPlnTp#
            AND PL.PRC_SVC_CONTR_TP_CD  = #prcSvcContrTp#
            --
            AND PL.DEL_FLG              = 'N'
            AND PL.EFF_FROM_DT         &lt;= #slsDt#
            AND ( 
                PL.EFF_THRU_DT         IS NULL 
                OR PL.EFF_THRU_DT      &gt;= #slsDt#
            )
            --
            AND PL.GLBL_CMPY_CD         = PM.GLBL_CMPY_CD
            AND PL.PRC_MTR_PKG_PK       = PM.PRC_MTR_PKG_PK
            --
            AND PM.GLBL_CMPY_CD                 = V.GLBL_CMPY_CD
            AND PM.PRC_MTR_PKG_PK               = V.PRC_MTR_PKG_PK
            AND V.MDL_MTR_EFF_FROM_DT          &lt;= #slsDt#
            AND (
                V.MDL_MTR_EFF_THRU_DT          IS NULL
                OR V.MDL_MTR_EFF_THRU_DT       &gt;= #slsDt#
                )
            AND V.BLLG_MTR_MAP_EFF_FROM_DT     &lt;= #slsDt#
            AND (
                V.BLLG_MTR_MAP_EFF_THRU_DT     IS NULL
                OR V.BLLG_MTR_MAP_EFF_THRU_DT  &gt;= #slsDt#
                )
            AND V.MTR_PKG_EFF_FROM_DT          &lt;= #slsDt#
            AND (
                V.MTR_PKG_EFF_THRU_DT          IS NULL
                OR V.MTR_PKG_EFF_THRU_DT       &gt;= #slsDt#
                )
            AND V.MTR_PKG_MDL_EFF_FROM_DT      &lt;= #slsDt#
            AND (
                V.MTR_PKG_MDL_EFF_THRU_DT      IS NULL
                OR V.MTR_PKG_MDL_EFF_THRU_DT   &gt;= #slsDt#
                )
            AND V.EZCANCELFLAG          = '0'
            --
            AND PL.EZCANCELFLAG         = '0'
            AND PM.EZCANCELFLAG         = '0'
        GROUP BY
            PM.PRC_MTR_PKG_PK
            ,PM.PRC_MTR_PKG_NM
        ORDER BY
            PM.PRC_MTR_PKG_NM
    </statement>

    <statement id="getSvcPkgFL" parameterClass="Map" resultClass="Map">
        SELECT
            PM.PRC_MTR_PKG_PK
            ,PM.PRC_MTR_PKG_NM
        FROM 
             PRC_LIST_SVC           PL
            ,PRC_MTR_PKG            PM
            ,PRC_MTR_PKG_MTR_STRU_V V
        WHERE
            PL.GLBL_CMPY_CD             = #glblCmpyCd#
            AND PL.PRC_CATG_CD          = #prcCatgCd#
            AND PL.MDL_ID               IN
            <iterate property="modelId" var="modelId[]" open="(" close=")" conjunction=",">#modelId[]#</iterate>
            AND PL.PRC_SVC_PLN_TP_CD    = #prcSvcPlnTp#
            AND PL.PRC_SVC_CONTR_TP_CD  = #prcSvcContrTp#
            --
            AND PL.DEL_FLG              = 'N'
            AND PL.EFF_FROM_DT         &lt;= #slsDt#
            AND ( 
                PL.EFF_THRU_DT         IS NULL 
                OR PL.EFF_THRU_DT      &gt;= #slsDt#
            )
            --
            AND PL.GLBL_CMPY_CD         = PM.GLBL_CMPY_CD
            AND PL.PRC_MTR_PKG_PK       = PM.PRC_MTR_PKG_PK
            --
            AND PM.GLBL_CMPY_CD                 = V.GLBL_CMPY_CD
            AND PM.PRC_MTR_PKG_PK               = V.PRC_MTR_PKG_PK
            AND V.MDL_MTR_EFF_FROM_DT          &lt;= #slsDt#
            AND (
                V.MDL_MTR_EFF_THRU_DT          IS NULL
                OR V.MDL_MTR_EFF_THRU_DT       &gt;= #slsDt#
                )
            AND V.BLLG_MTR_MAP_EFF_FROM_DT     &lt;= #slsDt#
            AND (
                V.BLLG_MTR_MAP_EFF_THRU_DT     IS NULL
                OR V.BLLG_MTR_MAP_EFF_THRU_DT  &gt;= #slsDt#
                )
            AND V.MTR_PKG_EFF_FROM_DT          &lt;= #slsDt#
            AND (
                V.MTR_PKG_EFF_THRU_DT          IS NULL
                OR V.MTR_PKG_EFF_THRU_DT       &gt;= #slsDt#
                )
            AND V.MTR_PKG_MDL_EFF_FROM_DT      &lt;= #slsDt#
            AND (
                V.MTR_PKG_MDL_EFF_THRU_DT      IS NULL
                OR V.MTR_PKG_MDL_EFF_THRU_DT   &gt;= #slsDt#
                )
            AND V.EZCANCELFLAG          = '0'
            --
            AND PL.EZCANCELFLAG         = '0'
            AND PM.EZCANCELFLAG         = '0'
        GROUP BY
            PM.PRC_MTR_PKG_PK
            ,PM.PRC_MTR_PKG_NM
        ORDER BY
            PM.PRC_MTR_PKG_NM
    </statement>

    <statement id="getPrcListStru" parameterClass="Map" resultClass="Map">
        SELECT 
            PLS.PRC_LIST_STRU_TP_CD
        FROM 
             PRC_CATG           DPC
            ,PRC_LIST_TP        PLT
            ,PRC_LIST_STRU_TP   PLS
        WHERE
                DPC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DPC.PRC_CATG_CD         = #prcCatgCd#
            AND DPC.GLBL_CMPY_CD        = PLT.GLBL_CMPY_CD
            AND DPC.PRC_LIST_TP_CD      = PLT.PRC_LIST_TP_CD
            AND PLT.GLBL_CMPY_CD        = PLS.GLBL_CMPY_CD
            AND PLT.PRC_LIST_STRU_TP_CD = PLS.PRC_LIST_STRU_TP_CD
            AND DPC.EZCANCELFLAG        = '0'
            AND PLT.EZCANCELFLAG        = '0'
            AND PLS.EZCANCELFLAG        = '0'
    </statement>

    <statement id="getTierInfo_BandSearch" parameterClass="Map" resultClass="Map">
        SELECT 
             PSTT.PRC_SVC_TIER_TP_CD
            ,PSTT.PRC_SVC_TIER_TP_DESC_TXT
            ,PLST.MIN_COPY_VOL_CNT
            ,PLST.MAX_COPY_VOL_CNT
            ,PLST.CPC_AMT_RATE
            ,PLST.BASE_AMT
            ,PLST.PRC_LIST_BAND_CD
        FROM
            PRC_LIST_SVC_TIER   PLST
            , PRC_SVC_TIER_TP   PSTT
            , PRC_LIST_BAND     PLB
        WHERE
                PLST.GLBL_CMPY_CD           = #glblCmpyCd#
            AND PLST.PRC_CATG_CD            = #prcCatgCd#
            AND PLST.MDL_ID                 = $modelId$
            AND PLST.PRC_MTR_PKG_PK         = $prcMtrPkgPk$
            AND PLST.PRC_SVC_PLN_TP_CD      = #prcSvcPlnTpCd#
            AND PLST.PRC_SVC_CONTR_TP_CD    = #prcSvcContrTp#
            AND PLST.BLLG_MTR_LB_CD         = #bllgMtrBLbCd#
            AND PLST.DEL_FLG                = #delFlg#
            AND PLST.EFF_FROM_DT         &lt;= #prcBaseDt#
            AND (
                PLST.EFF_THRU_DT         &gt;= #prcBaseDt#
              OR
                PLST.EFF_THRU_DT         IS NULL
                )
            AND PLST.EZCANCELFLAG           = '0'
            --
            AND PLST.GLBL_CMPY_CD           = PSTT.GLBL_CMPY_CD
            AND PLST.PRC_SVC_TIER_TP_CD     = PSTT.PRC_SVC_TIER_TP_CD
            AND PSTT.EZCANCELFLAG           = '0'
            --
            AND PLST.GLBL_CMPY_CD           = PLB.GLBL_CMPY_CD
            AND PLST.PRC_LIST_BAND_CD       = PLB.PRC_LIST_BAND_CD
            AND PLB.PRC_LIST_BAND_DESC_TXT  = #prcListBandDescTxt#
            AND PLB.EZCANCELFLAG            = '0'
        ORDER BY
            PSTT.PRC_SVC_TIER_TP_SORT_NUM
    </statement>

    <statement id="getPrcConfName" parameterClass="Map" resultClass="Map">
        SELECT
            PLE.PRC_LIST_EQUIP_CONFIG_NUM
            ,PLE.PRC_LIST_EQUIP_CONFIG_NM
        FROM
            PRC_LIST_EQUIP  PLE
        WHERE
                PLE.GLBL_CMPY_CD        = #glblCmpyCd#
            AND PLE.PRC_QLFY_VAL_TXT    = #coveredItem#
            AND PLE.PRC_CATG_CD         = #prcList#
            AND PLE.PRC_QLFY_TP_CD      = #itemCd#
            AND PLE.EFF_FROM_DT        &lt;= #slsDt#
            AND (
                PLE.EFF_THRU_DT        &gt;= #slsDt#
                OR
                PLE.EFF_THRU_DT        IS NULL
                )
            AND PLE.DEL_FLG             = 'N'
            AND PLE.EZCANCELFLAG        = '0'
    </statement>

    <statement id="getLineBizTpCd" parameterClass="Map" resultClass="Map">
        SELECT 
            DOT.LINE_BIZ_TP_CD
        FROM
             CPO  DC
            ,DS_ORD_TP_PROC_DFN   DOT
        WHERE  
                DC.CPO_ORD_NUM      = #orderNum#
            AND DC.GLBL_CMPY_CD     = #glblCmpyCd#
            AND DC.DS_ORD_TP_CD     = DOT.DS_ORD_TP_CD
            AND DC.GLBL_CMPY_CD     = DOT.GLBL_CMPY_CD
            AND DC.EZCANCELFLAG     = '0'
            AND DOT.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getApiData" parameterClass="Map" resultClass="Map">
        SELECT
            DCC.BILL_TO_CUST_LOC_CD
            , DCC.SHIP_TO_CUST_LOC_CD
            , DCC.SHIP_TO_CUST_ACCT_CD
            , DCC.BILL_TO_CUST_ACCT_CD
            , DCD.SHIP_TO_CTY_ADDR
            , DCD.SHIP_TO_ST_CD
            , DCD.SHIP_TO_CTRY_CD
            , DCD.DS_ORD_LINE_CATG_CD
        FROM
            <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
            <!--  CPO_DTL_V      DCD -->
             CPO_DTL        DCD
            <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
            ,DS_CPO_CONFIG     DCC
        WHERE
                DCD.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DCD.CPO_ORD_NUM          = #orderNum#
            AND DCD.CPO_DTL_LINE_NUM     = #lineNum#
            AND DCD.CPO_DTL_LINE_SUB_NUM = #lineSubNum#
            AND DCD.DS_CPO_CONFIG_PK     = DCC.DS_CPO_CONFIG_PK
            AND DCD.GLBL_CMPY_CD         = DCC.GLBL_CMPY_CD
            AND DCD.EZCANCELFLAG         = '0'
            AND DCC.EZCANCELFLAG         = '0'
     </statement>

    <statement id="getMtrLb" parameterClass="Map" resultClass="Map">
        WITH MTR_PKG_V AS ( 
            SELECT DISTINCT
                      MS.BLLG_MTR_LB_CD         AS BILLING_COUNTER_CD
                    , MS.BLLG_MTR_LB_NM         AS BILLING_COUNTER_NM
                    , MS.INTG_MDSE_CD           AS USAGE_ITEM_CD
                    , MS.INTG_MDSE_NM           AS USAGE_ITEM_NM
                    , MS.REG_MTR_LB_CD          AS HARD_COUNTER_CD
                    , MS.REG_MTR_LB_NM          AS HARD_COUNTER_NM
                    , MS.MTR_MULT_RATE          AS MTR_MULT_RATE
                    , MS.BLLG_MTR_LB_SORT_NUM
                    , MS.REG_MTR_LB_SORT_NUM
                FROM
                    PRC_MTR_PKG_MTR_STRU_V MS
                WHERE
                    MS.GLBL_CMPY_CD                     = #glblCmpyCd#
                    AND MS.MDL_ID                       = $mdlId$
                    AND MS.PRC_MTR_PKG_PK               = $prcMtrPkgPk$
                    AND MS.ACTV_FLG                     = 'Y'
                    AND MS.BLLBL_FLG                    = 'Y'
                    AND MS.MDL_MTR_EFF_FROM_DT          &lt;= #slsDt#
                    AND ( 
                        MS.MDL_MTR_EFF_THRU_DT          &gt;= #slsDt#
                        OR MS.MDL_MTR_EFF_THRU_DT       IS NULL
                    ) 
                    AND MS.BLLG_MTR_MAP_EFF_FROM_DT     &lt;= #slsDt#
                    AND ( 
                        MS.BLLG_MTR_MAP_EFF_THRU_DT     &gt;= #slsDt#
                        OR MS.BLLG_MTR_MAP_EFF_THRU_DT  IS NULL
                    ) 
                    AND MS.MTR_PKG_EFF_FROM_DT          &lt;= #slsDt#
                    AND ( 
                        MS.MTR_PKG_EFF_THRU_DT          &gt;= #slsDt#
                        OR MS.MTR_PKG_EFF_THRU_DT       IS NULL
                    ) 
                    AND MS.MTR_PKG_MDL_EFF_FROM_DT      &lt;= #slsDt#
                    AND ( 
                        MS.MTR_PKG_MDL_EFF_THRU_DT      &gt;= #slsDt#
                        OR MS.MTR_PKG_MDL_EFF_THRU_DT   IS NULL
                    )
        ) 
        SELECT
                  V.BILLING_COUNTER_CD
                -- , V.BILLING_COUNTER_NM
                , MB.MTR_LB_DESC_TXT    BILLING_COUNTER_NM
                , V.USAGE_ITEM_CD
                , V.USAGE_ITEM_NM
                , V.HARD_COUNTER_CD
                -- , V.HARD_COUNTER_NM
                , MH.MTR_LB_DESC_TXT    HARD_COUNTER_NM
                , V.MTR_MULT_RATE
            FROM
                MTR_PKG_V       V
                , MTR_LB        MB
                , MTR_LB        MH
            WHERE
                MB.GLBL_CMPY_CD     = #glblCmpyCd#
                AND MB.MTR_LB_CD    = V.BILLING_COUNTER_CD
                AND MB.EZCANCELFLAG = '0'
                AND MH.GLBL_CMPY_CD = #glblCmpyCd#
                AND MH.MTR_LB_CD    = V.HARD_COUNTER_CD
                AND MH.EZCANCELFLAG = '0'
            ORDER BY
                V.BLLG_MTR_LB_SORT_NUM
                , V.REG_MTR_LB_SORT_NUM
    </statement>

    <statement id="isInMtrDB" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
                  MS.MDL_ID
            FROM
                PRC_MTR_PKG_MTR_STRU_V MS
            WHERE
                MS.GLBL_CMPY_CD                     = #glblCmpyCd#
                AND MS.MDL_ID                      IN
                <iterate property="mdlId" var="mdlId[]" open="(" close=")" conjunction=",">
                #mdlId[]#
                </iterate>
                AND MS.PRC_MTR_PKG_PK               = $prcMtrPkgPk$
                AND MS.ACTV_FLG                     = 'Y'
                AND MS.BLLBL_FLG                    = 'Y'
                AND MS.MDL_MTR_EFF_FROM_DT          &lt;= #slsDt#
                AND ( 
                    MS.MDL_MTR_EFF_THRU_DT          &gt;= #slsDt#
                    OR MS.MDL_MTR_EFF_THRU_DT       IS NULL
                ) 
                AND MS.BLLG_MTR_MAP_EFF_FROM_DT     &lt;= #slsDt#
                AND ( 
                    MS.BLLG_MTR_MAP_EFF_THRU_DT     &gt;= #slsDt#
                    OR MS.BLLG_MTR_MAP_EFF_THRU_DT  IS NULL
                ) 
                AND MS.MTR_PKG_EFF_FROM_DT          &lt;= #slsDt#
                AND ( 
                    MS.MTR_PKG_EFF_THRU_DT          &gt;= #slsDt#
                    OR MS.MTR_PKG_EFF_THRU_DT       IS NULL
                ) 
                AND MS.MTR_PKG_MDL_EFF_FROM_DT      &lt;= #slsDt#
                AND ( 
                    MS.MTR_PKG_MDL_EFF_THRU_DT      &gt;= #slsDt#
                    OR MS.MTR_PKG_MDL_EFF_THRU_DT   IS NULL
                )
    </statement>

    <statement id="getMtrLbFL" parameterClass="Map" resultClass="Map">
        WITH MTR_PKG_V AS ( 
            SELECT DISTINCT
                      MS.BLLG_MTR_LB_CD         AS BILLING_COUNTER_CD
                    , MS.BLLG_MTR_LB_NM         AS BILLING_COUNTER_NM
                    , MS.INTG_MDSE_CD           AS USAGE_ITEM_CD
                    , MS.INTG_MDSE_NM           AS USAGE_ITEM_NM
                    , MS.REG_MTR_LB_CD          AS HARD_COUNTER_CD
                    , MS.REG_MTR_LB_NM          AS HARD_COUNTER_NM
                    , MS.MTR_MULT_RATE          AS MTR_MULT_RATE
                    , MS.BLLG_MTR_LB_SORT_NUM
                    , MS.REG_MTR_LB_SORT_NUM
                FROM
                    PRC_MTR_PKG_MTR_STRU_V MS
                WHERE
                    MS.GLBL_CMPY_CD                     = #glblCmpyCd#
                    AND MS.MDL_ID                      IN
                    <iterate property="mdlId" var="mdlId[]" open="(" close=")" conjunction=",">
                    #mdlId[]#
                    </iterate>
                    AND MS.PRC_MTR_PKG_PK               = $prcMtrPkgPk$
                    AND MS.ACTV_FLG                     = 'Y'
                    AND MS.BLLBL_FLG                    = 'Y'
                    AND MS.MDL_MTR_EFF_FROM_DT          &lt;= #slsDt#
                    AND ( 
                        MS.MDL_MTR_EFF_THRU_DT          &gt;= #slsDt#
                        OR MS.MDL_MTR_EFF_THRU_DT       IS NULL
                    ) 
                    AND MS.BLLG_MTR_MAP_EFF_FROM_DT     &lt;= #slsDt#
                    AND ( 
                        MS.BLLG_MTR_MAP_EFF_THRU_DT     &gt;= #slsDt#
                        OR MS.BLLG_MTR_MAP_EFF_THRU_DT  IS NULL
                    ) 
                    AND MS.MTR_PKG_EFF_FROM_DT          &lt;= #slsDt#
                    AND ( 
                        MS.MTR_PKG_EFF_THRU_DT          &gt;= #slsDt#
                        OR MS.MTR_PKG_EFF_THRU_DT       IS NULL
                    ) 
                    AND MS.MTR_PKG_MDL_EFF_FROM_DT      &lt;= #slsDt#
                    AND ( 
                        MS.MTR_PKG_MDL_EFF_THRU_DT      &gt;= #slsDt#
                        OR MS.MTR_PKG_MDL_EFF_THRU_DT   IS NULL
                    )
        ) 
        SELECT
                  V.BILLING_COUNTER_CD
                , V.BILLING_COUNTER_NM
                , V.USAGE_ITEM_CD
                , V.USAGE_ITEM_NM
                , V.HARD_COUNTER_CD
                , V.HARD_COUNTER_NM
                , V.MTR_MULT_RATE
            FROM
                MTR_PKG_V V
            ORDER BY
                V.BLLG_MTR_LB_SORT_NUM
                , V.REG_MTR_LB_SORT_NUM
    </statement>

    <statement id="getMtrNm" parameterClass="Map" resultClass="String">
        SELECT      
            <!-- ML.MTR_LB_NM -->
                 ML.MTR_LB_DESC_TXT
        FROM        MTR_LB ML
        WHERE
                ML.MTR_LB_CD     = #mtrLbCd#
            AND ML.GLBL_CMPY_CD  = #glblCmpyCd#
            AND ML.EZCANCELFLAG = '0'
    </statement>

    <statement id="cntRentalOrder" parameterClass="Map" resultClass="Integer">
        SELECT
                  COUNT(DC.GLBL_CMPY_CD)    CNT
            FROM
                ORD_CATG_BIZ_CTX    BC
                , CPO            DC
            WHERE
                BC.GLBL_CMPY_CD             = #glblCmpyCd#
                AND BC.ORD_CATG_CTX_TP_CD   = #ordCatgCtxTpCd# -- 'RENTAL_ORDER'
                AND BC.EZCANCELFLAG         = '0'
                AND BC.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD
                AND BC.DS_ORD_CATG_CD       = DC.DS_ORD_CATG_CD
                AND (
                    BC.DS_ORD_TP_CD         = DC.DS_ORD_TP_CD
                    OR BC.DS_ORD_TP_CD     IS NULL
                ) 
                AND (
                    BC.DS_ORD_RSN_CD        = DC.DS_ORD_RSN_CD
                    OR BC.DS_ORD_RSN_CD    IS NULL
                ) 
                AND DC.CPO_ORD_NUM          = #xxScrItem50Txt#
                AND DC.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getBookItemNm" parameterClass="Map" resultClass="String">
        <!-- START 2018/07/09 K.Kojima [QC#27135,MOD] -->
        <!-- SELECT -->
        <!--      M.MDSE_DESC_SHORT_TXT -->
        <!-- FROM -->
        <!--       ITEM_TP_VAL_SET   ITVS -->
        <!--     , MDSE              M -->
        <!-- WHERE -->
        <!--         ITVS.EZCANCELFLAG               = '0' -->
        <!--     AND ITVS.GLBL_CMPY_CD               = #glblCmpyCd# -->
        <!--     AND ITVS.ITEM_TP_CTX_TP_CD          = #itemTpCtxTpCd# -->
        <!--     AND ITVS.EZCANCELFLAG               = M.EZCANCELFLAG -->
        <!--     AND ITVS.GLBL_CMPY_CD               = M.GLBL_CMPY_CD -->
        <!--     AND ITVS.MDSE_ITEM_TP_CD            = M.MDSE_ITEM_TP_CD -->
        <!--     AND ITVS.FIRST_BIZ_CTX_ATTRB_TXT    = M.DS_INTG_MDSE_TP_CD -->
        <!--     AND M.EZCANCELFLAG                = M.EZCANCELFLAG -->
        <!--     AND M.MDSE_CD                     = NVL( -->
        <!--                                         ( -->
        <!--                                             SELECT -->
        <!--                                                       OTM.MDSE_CD -->
        <!--                                                 FROM -->
        <!--                                                     ORD_TAKE_MDSE   OTM -->
        <!--                                                 WHERE -->
        <!--                                                     OTM.ORD_TAKE_MDSE_CD = #mdseCd# -->
        <!--                                                     AND OTM.EZCANCELFLAG = M.EZCANCELFLAG -->
        <!--                                                     AND OTM.GLBL_CMPY_CD = M.GLBL_CMPY_CD -->
        <!--                                         ) -->
        <!--                                         , #mdseCd# -->
        <!--                                     ) -->
        <!-- ORDER BY -->
        <!--     M.MDSE_CD -->
        WITH ORD_TAKE AS (
            SELECT
                OTM.MDSE_CD
            FROM
                ORD_TAKE_MDSE OTM
            WHERE
                    OTM.GLBL_CMPY_CD     = #glblCmpyCd#
                AND OTM.ORD_TAKE_MDSE_CD = #mdseCd#
                AND OTM.EZCANCELFLAG     = '0'
        )
        SELECT
             1                     AS SORT_NUM
            ,M.MDSE_CD             AS MDSE_CD
            ,M.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT
        FROM
             ITEM_TP_VAL_SET ITVS
            ,MDSE            M
        WHERE
                ITVS.GLBL_CMPY_CD               = #glblCmpyCd#
            AND ITVS.ITEM_TP_CTX_TP_CD          = #itemTpCtxTpCd#
            AND ITVS.EZCANCELFLAG               = '0'
            AND ITVS.GLBL_CMPY_CD               = M.GLBL_CMPY_CD
            AND ITVS.MDSE_ITEM_TP_CD            = M.MDSE_ITEM_TP_CD
            AND ITVS.FIRST_BIZ_CTX_ATTRB_TXT    = M.DS_INTG_MDSE_TP_CD
            AND M.EZCANCELFLAG                  = '0'
            AND EXISTS(SELECT 1 FROM ORD_TAKE OT WHERE OT.MDSE_CD = M.MDSE_CD)
        UNION ALL
        SELECT
             2                     AS SORT_NUM
            ,M.MDSE_CD             AS MDSE_CD
            ,M.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT
        FROM
             ITEM_TP_VAL_SET ITVS
            ,MDSE            M
        WHERE
                ITVS.GLBL_CMPY_CD               = #glblCmpyCd#
            AND ITVS.ITEM_TP_CTX_TP_CD          = #itemTpCtxTpCd#
            AND ITVS.EZCANCELFLAG               = '0'
            AND ITVS.GLBL_CMPY_CD               = M.GLBL_CMPY_CD
            AND ITVS.MDSE_ITEM_TP_CD            = M.MDSE_ITEM_TP_CD
            AND ITVS.FIRST_BIZ_CTX_ATTRB_TXT    = M.DS_INTG_MDSE_TP_CD
            AND M.MDSE_CD                       = #mdseCd#
            AND M.EZCANCELFLAG                  = '0'
            AND NOT EXISTS(SELECT 1 FROM ORD_TAKE OT WHERE OT.MDSE_CD = M.MDSE_CD)
        ORDER BY
             SORT_NUM
            ,MDSE_CD
        <!-- START 2018/07/09 K.Kojima [QC#27135,MOD] -->
    </statement>

    <statement id="getAnnualPrc" parameterClass="Map" resultClass="Map">
        SELECT
                   PLS.BASE_AMT
                  ,PLS.TERM_FROM_MTH_AOT
                  ,PLS.TERM_THRU_MTH_AOT
            FROM
                PRC_LIST_SVC    PLS
            WHERE
                PLS.GLBL_CMPY_CD              = #glblCmpyCd#
                AND PLS.PRC_RATE_TP_CD        = #annual#
                AND PLS.PRC_CATG_CD           = #prcCatgCd#
                AND PLS.MDL_ID                = $mdlId$
                AND PLS.PRC_MTR_PKG_PK        = #prcMtrPkgPk#
                AND PLS.PRC_SVC_PLN_TP_CD     = #prcSvcPlnTpCd#
                AND PLS.PRC_SVC_CONTR_TP_CD   = #prcSvcContrTpCd#
                AND PLS.EFF_FROM_DT          &lt;= #slsDt#
                AND (
                    PLS.EFF_THRU_DT          &gt;= #slsDt#
                    OR PLS.EFF_THRU_DT       IS NULL
                )
                AND PLS.DEL_FLG               = 'N'
                --
                AND PLS.TERM_FROM_MTH_AOT  &lt;=  #termMthNum#
                AND
                  (
                   PLS.TERM_THRU_MTH_AOT   &gt;=  #termMthNum#
                 OR
                   PLS.TERM_THRU_MTH_AOT   IS NULL
                  )
                --
                AND PLS.EZCANCELFLAG = '0'
            ORDER BY
                PLS.PRC_LIST_SVC_PK
    </statement>

    <statement id="getBllgCycleList" parameterClass="Map" resultClass="Map">
        SELECT
                  BC.BLLG_CYCLE_CD
                , BC.BLLG_CYCLE_DESC_TXT
                , BLLG_CYCLE_MTH_AOT 
            FROM
                BLLG_CYCLE BC
            WHERE
                BC.GLBL_CMPY_CD             = #glblCmpyCd#
                AND BC.BLLG_CYCLE_ACTV_FLG  = 'Y'
                AND BC.EFF_FROM_DT         &lt;= #slsDt#
                AND ( 
                    BC.EFF_THRU_DT         &gt;= #slsDt#
                    OR BC.EFF_THRU_DT       IS NULL
                )
                AND BC.OM_CYCLE_FLG = 'Y'
                AND BC.EZCANCELFLAG = '0'
            ORDER BY
                BC.BLLG_CYCLE_SORT_NUM
    </statement>

    <statement id="getContractIndicatorList" parameterClass="Map" resultClass="Map">
        SELECT
                  C.DS_CONTR_CATG_CD
                , C.DS_CONTR_CATG_DESC_TXT
            FROM
                DS_CONTR_CATG   C
            WHERE
                C.GLBL_CMPY_CD      = #glblCmpyCd#
                AND C.OM_CATG_FLG   = 'Y'
                AND C.EZCANCELFLAG  = '0'
            ORDER BY
                C.DS_CONTR_CATG_SORT_NUM
    </statement>

    <!-- START 2017/10/25 K.Kojima [QC#21690,DEL] -->
    <!-- <statement id="getDefaultMdlSvcPrc" parameterClass="Map" resultClass="Map"> -->
    <!-- </statement> -->
    <!-- END 2017/10/25 K.Kojima [QC#21690,DEL] -->

    <!-- START 2017/10/25 K.Kojima [QC#21690,DEL] -->
    <!-- <statement id="getDefaultMdlSvcPrcByQlfy" parameterClass="Map" resultClass="Map"> -->
    <!-- </statement> -->
    <!-- END 2017/10/25 K.Kojima [QC#21690,DEL] -->

    <statement id="getPrcCatgNmForOnBlur" parameterClass="Map" resultClass="Map">
        SELECT
                  PC.PRC_CATG_CD
                , PC.PRC_CATG_NM
            FROM
                PRC_CATG PC
            WHERE
                PC.GLBL_CMPY_CD        = #glblCmpyCd#
                AND PC.PRC_CATG_NM  LIKE #prcCatgNm#
                AND PC.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getMdseInfoForOnBlurAddlChrgWithLike" parameterClass="Map" resultClass="Map">
        SELECT
             NVL(OTM.ORD_TAKE_MDSE_CD, M.MDSE_CD) AS MDSE_CD
            ,M.MDSE_NM
            ,M.MDSE_DESC_SHORT_TXT
        FROM
             ITEM_TP_VAL_SET ITVS
            ,MDSE            M
            ,ORD_TAKE_MDSE   OTM
        WHERE
                ITVS.EZCANCELFLAG       = '0'
            AND ITVS.GLBL_CMPY_CD       = #glblCmpyCd#
            AND ITVS.ITEM_TP_CTX_TP_CD  = #itemTpCtxTpCd#
            AND ITVS.EZCANCELFLAG       = M.EZCANCELFLAG
            AND ITVS.GLBL_CMPY_CD       = M.GLBL_CMPY_CD
            AND ITVS.MDSE_ITEM_TP_CD    = M.MDSE_ITEM_TP_CD
            AND M.RGTN_STS_CD           = #rgtnStsCd#
            <isNotNull property="mdseCd">
            AND M.MDSE_CD             LIKE #mdseCd#
            AND OTM.MDSE_CD(+)          LIKE #mdseCd#
            </isNotNull>
            AND M.EZCANCELFLAG          = OTM.EZCANCELFLAG(+)
            AND M.GLBL_CMPY_CD          = OTM.GLBL_CMPY_CD(+)
            AND M.MDSE_CD               = OTM.MDSE_CD(+)
        ORDER BY
            M.MDSE_CD
    </statement>

    <statement id="getMdseInfoForOnBlurAddlChrg" parameterClass="Map" resultClass="Map">
        SELECT
            #mdseCd#    MDSE_CD
            , M.MDSE_NM
            , M.MDSE_DESC_SHORT_TXT
        FROM
              ITEM_TP_VAL_SET ITVS
            , MDSE            M
        WHERE
                ITVS.EZCANCELFLAG       = '0'
            AND ITVS.GLBL_CMPY_CD       = #glblCmpyCd#
            AND ITVS.ITEM_TP_CTX_TP_CD  = #itemTpCtxTpCd#
            AND ITVS.EZCANCELFLAG       = M.EZCANCELFLAG
            AND ITVS.GLBL_CMPY_CD       = M.GLBL_CMPY_CD
            AND ITVS.MDSE_ITEM_TP_CD    = M.MDSE_ITEM_TP_CD
            AND M.RGTN_STS_CD           = #rgtnStsCd#
            AND M.MDSE_CD             = NVL(
                                                ( 
                                                    SELECT
                                                              OTM.MDSE_CD
                                                        FROM
                                                            ORD_TAKE_MDSE OTM
                                                        WHERE
                                                            OTM.ORD_TAKE_MDSE_CD = #mdseCd#
                                                            AND OTM.EZCANCELFLAG = M.EZCANCELFLAG
                                                            AND OTM.GLBL_CMPY_CD = M.GLBL_CMPY_CD
                                                ) 
                                                , #mdseCd#
            ) 
    </statement>

    <statement id="getMdseInfoForOnBlurCoveredUnit" parameterClass="Map" resultClass="Map">
        SELECT
                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                <!--   CD.DPLY_LINE_NUM -->
                  CONCAT (CD.DS_ORD_POSN_NUM, '.')
                   || CONCAT (CD.DS_CPO_LINE_NUM, DECODE (CD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
                   || CD.DS_CPO_LINE_SUB_NUM AS DPLY_LINE_NUM
                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                , CD.CPO_DTL_LINE_NUM
                , CD.CPO_DTL_LINE_SUB_NUM
                , MTVS.MDSE_TP_CTX_TP_CD
                , MDSE.MDSE_CD
                , MDSE.MDSE_DESC_SHORT_TXT
            FROM
                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                <!-- CPO_DTL_V        CD -->
                  CPO_DTL           CD
                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                , MDSE_TP_VAL_SET   MTVS
                , ALL_MDSE_V        MDSE
            WHERE
                CD.GLBL_CMPY_CD             = #glblCmpyCd#
                AND CD.CPO_ORD_NUM          = #cpoOrdNum#
                AND CD.MDSE_CD           LIKE #mdseCd#
                AND CD.EZCANCELFLAG         = '0'
                --
                AND CD.GLBL_CMPY_CD         = MDSE.GLBL_CMPY_CD
                AND CD.MDSE_CD              = MDSE.MDSE_CD
                AND MDSE.EZCANCELFLAG       = '0'
                -- 
                AND MTVS.GLBL_CMPY_CD       = MDSE.GLBL_CMPY_CD
                AND MTVS.COA_MDSE_TP_CD     = MDSE.COA_MDSE_TP_CD
                AND MTVS.MDSE_TP_CTX_TP_CD  = #mdseTpCtxTp#
                AND MTVS.EZCANCELFLAG       = '0'
                --
                AND EXISTS ( 
                    SELECT
                              1
                        FROM
                            DS_CONTR_DTL        DCD
                        WHERE
                            DCD.GLBL_CMPY_CD             = CD.GLBL_CMPY_CD
                            AND DCD.CPO_ORD_NUM          = CD.CPO_ORD_NUM
                            AND DCD.CPO_DTL_LINE_NUM     = CD.CPO_DTL_LINE_NUM
                            AND DCD.CPO_DTL_LINE_SUB_NUM = CD.CPO_DTL_LINE_SUB_NUM
                            AND DCD.EZCANCELFLAG         = '0'
                ) 
    </statement>

    <statement id="getMdseInfoForOnBlurCoveredItem" parameterClass="Map" resultClass="Map">
        SELECT
                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                <!--   CD.DPLY_LINE_NUM -->
                  CONCAT (CD.DS_ORD_POSN_NUM, '.')
                   || CONCAT (CD.DS_CPO_LINE_NUM, DECODE (CD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
                   || CD.DS_CPO_LINE_SUB_NUM AS DPLY_LINE_NUM
                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                , CD.CPO_DTL_LINE_NUM
                , CD.CPO_DTL_LINE_SUB_NUM
                , MTVS.MDSE_TP_CTX_TP_CD
                , MDSE.MDSE_CD
                , MDSE.MDSE_DESC_SHORT_TXT
            FROM
                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                <!-- CPO_DTL_V        CD -->
                  CPO_DTL           CD
                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                , MDSE_TP_VAL_SET   MTVS
                , ALL_MDSE_V        MDSE
            WHERE
                CD.GLBL_CMPY_CD            = #glblCmpyCd#
                AND CD.CPO_ORD_NUM         = #cpoOrdNum#
                AND CD.MDSE_CD          LIKE #mdseCd#
                AND CD.EZCANCELFLAG        = '0'
                --
                AND CD.GLBL_CMPY_CD        = MDSE.GLBL_CMPY_CD
                AND CD.MDSE_CD             = MDSE.MDSE_CD
                AND MDSE.EZCANCELFLAG      = '0'
                -- 
                AND MTVS.GLBL_CMPY_CD      = MDSE.GLBL_CMPY_CD
                AND MTVS.COA_MDSE_TP_CD    = MDSE.COA_MDSE_TP_CD
              <isNotNull property="mdseTpCtxTp">
                AND MTVS.MDSE_TP_CTX_TP_CD != #mdseTpCtxTp#
              </isNotNull>
                AND MTVS.EZCANCELFLAG      = '0'
    </statement>

    <statement id="getLineOfBusinessCd" parameterClass="Map" resultClass="Map">
        SELECT
             PD.LINE_BIZ_TP_CD
        FROM
             DS_ORD_TP_PROC_DFN       PD
        WHERE
                PD.GLBL_CMPY_CD      = #glblCmpyCd#
            AND PD.DS_ORD_TP_CD      = #dsOrdTpCd#
            AND PD.EZCANCELFLAG      = '0'
    </statement>

    <statement id="getPriceCategoryNm" parameterClass="Map" resultClass="Map">
        SELECT
             PC.PRC_LIST_DPLY_NM
            ,PC.PRC_CATG_NM
            ,PLT.PRC_LIST_TP_DESC_TXT
            ,PLT.PRC_LIST_TP_CD
            ,PLT.PRC_LIST_TP_NM
        FROM
             PRC_CATG                PC
            ,PRC_LIST_TP             PLT
        WHERE
                PC.GLBL_CMPY_CD      = #glblCmpyCd#
            AND PC.PRC_CATG_CD       = #prcCatgCd#
            <!-- START 2017/10/24 K.Kojima [QC#21690,ADD] -->
            <isNotNull property="prcCatgNm">
            <!-- END 2017/10/24 K.Kojima [QC#21690,ADD] -->
            AND PC.PRC_CATG_NM    LIKE #prcCatgNm#
            <!-- START 2017/10/24 K.Kojima [QC#21690,ADD] -->
            </isNotNull>
            <!-- END 2017/10/24 K.Kojima [QC#21690,ADD] -->
            AND PC.GLBL_CMPY_CD     = PLT.GLBL_CMPY_CD
            AND PC.PRC_LIST_TP_CD   = PLT.PRC_LIST_TP_CD
            AND PC.EZCANCELFLAG      = '0'
            AND PLT.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getPrcCatgInfoForSave" parameterClass="Map" resultClass="Map">
        SELECT
                  PC.PRC_CATG_CD
                , PC.PRC_CATG_NM
                , PC.PRC_LIST_TP_CD
            FROM
                PRC_CATG        PC
            WHERE
                PC.GLBL_CMPY_CD      = #glblCmpyCd#
                AND PC.PRC_CATG_NM   = #prcCatgNm#
                AND PC.EZCANCELFLAG  = '0'
                --
                AND PC.EFF_FROM_DT &lt;= #slsDt#
                AND (
                    PC.EFF_THRU_DT     IS NULL
                    OR PC.EFF_THRU_DT &gt;= #slsDt#
                )
                AND PC.ACTV_FLG     = 'Y'
                AND PC.DEL_FLG      = 'N'
    </statement>

    <statement id="getPrcRateTpCd" parameterClass="Map" resultClass="String">
        SELECT
                PLS.PRC_RATE_TP_CD
                , PLS.MDL_ID
                , PLS.PRC_MTR_PKG_PK
                , PLS.BASE_AMT
            FROM
                 PRC_CATG       DPC
               , PRC_LIST_SVC   PLS
            WHERE
                DPC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DPC.EZCANCELFLAG        = '0'
            AND DPC.PRC_CATG_CD         = #prcCatgCd#
            AND DPC.ACTV_FLG            = #activFlg#
            ANd DPC.DEL_FLG             = #delFlg#
            AND DPC.EFF_FROM_DT        &lt;= #prcBaseDt#
            AND (
                DPC.EFF_THRU_DT        &gt;= #prcBaseDt#
             OR DPC.EFF_THRU_DT        IS NULL )
            AND DPC.GLBL_CMPY_CD        = PLS.GLBL_CMPY_CD
            AND DPC.EZCANCELFLAG        = PLS.EZCANCELFLAG
            AND DPC.PRC_CATG_CD         = PLS.PRC_CATG_CD
<!--            AND PLS.MDL_ID              = #mdlId#--><!-- QC#29248 -->
            AND PLS.MDL_ID             IN 
            <iterate property="mdlIdList" var="mdlId[]" open="(" close=")" conjunction=",">
            #mdlId[]#
            </iterate>
        <isNotNull property="prcMtrPkgPk">
            AND PLS.PRC_MTR_PKG_PK      = #prcMtrPkgPk#
        </isNotNull>
            AND PLS.PRC_SVC_PLN_TP_CD   = #prcSvcPlnTpCd#
            AND PLS.PRC_SVC_CONTR_TP_CD = #prcSvcContrTpCd#
            --
                AND PLS.TERM_FROM_MTH_AOT  &lt;=  #termMthNum#
                AND
                  (
                   PLS.TERM_THRU_MTH_AOT   &gt;=  #termMthNum#
                 OR
                   PLS.TERM_THRU_MTH_AOT   IS NULL
                  )
            --
            AND PLS.EFF_FROM_DT        &lt;= #prcBaseDt#
            AND (
                PLS.EFF_THRU_DT        &gt;= #prcBaseDt#
             OR PLS.EFF_THRU_DT        IS NULL )
            AND PLS.DEL_FLG             = #delFlg#
            AND ROWNUM                  = #rownum1#
    </statement>

    <statement id="getBasePrcForNonMeter" parameterClass="Map" resultClass="Map">
        SELECT
                  PL.BASE_AMT
                 ,PL.PRC_RATE_TP_CD
                 ,PL.TERM_FROM_MTH_AOT
                 ,PL.TERM_THRU_MTH_AOT
            FROM
                PRC_LIST_SVC    PL
                , PRC_MTR_PKG   PM
            WHERE
                PL.GLBL_CMPY_CD             = #glblCmpyCd#
                AND PL.PRC_CATG_CD          = #prcCatgCd#
                AND PL.MDL_ID               = #mdlId#
                AND PL.PRC_SVC_PLN_TP_CD    = #prcSvcPlnTpCd#
                AND PL.PRC_SVC_CONTR_TP_CD  = #prcSvcContrTpCd#
                --
                AND PL.TERM_FROM_MTH_AOT   &lt;=  #termMthNum#
                AND
                  (
                   PL.TERM_THRU_MTH_AOT    &gt;=  #termMthNum#
                 OR
                   PL.TERM_THRU_MTH_AOT    IS NULL
                  )
                --
                AND PL.DEL_FLG              = 'N'
                AND PL.EFF_FROM_DT         &lt;= #slsDt#
                AND ( 
                    PL.EFF_THRU_DT          IS NULL
                    OR PL.EFF_THRU_DT      &gt;= #slsDt#
                )
                AND PL.EZCANCELFLAG         = '0'
                AND PL.GLBL_CMPY_CD         = PM.GLBL_CMPY_CD
                AND PL.PRC_MTR_PKG_PK       = PM.PRC_MTR_PKG_PK
                AND PM.PRC_MTR_PKG_PK       = #prcMtrPkgPk#
                AND PM.EZCANCELFLAG         = '0'
                AND ROWNUM                  = #rownum1#
    </statement>

    <statement id="getPeriodicServicePriceFromPriceList" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                  PLS.BASE_AMT
            FROM
                PRC_LIST_SVC    PLS
            WHERE
                PLS.GLBL_CMPY_CD            = #glblCmpyCd#
                AND PLS.PRC_CATG_CD         = #prcCatgCd#
                AND PLS.PRC_RATE_TP_CD      = #baseOnly# -- '03'
                --
                AND ( 
                    (PLS.PRC_LIST_MDSE_CD   = #prcListMdseCd#)
                    OR (
                        PLS.PRC_LIST_MDSE_CD = (
                            SELECT
                                      OTM.ORD_TAKE_MDSE_CD
                                FROM
                                    ORD_TAKE_MDSE   OTM
                                WHERE
                                    OTM.GLBL_CMPY_CD         = PLS.GLBL_CMPY_CD
                                    AND OTM.ORD_TAKE_MDSE_CD = SUBSTR(#prcListMdseCd#, 1, 8)
                                    AND OTM.EZCANCELFLAG     = '0'
                        )
                    )
                ) 
                --
                AND PLS.PRC_SVC_PLN_TP_CD   = #prcSvcPlnTpCd#
                AND PLS.PRC_SVC_CONTR_TP_CD = #prcSvcContrTpCd#
                --
                AND PLS.TERM_FROM_MTH_AOT  &lt;=  #termMthNum#
                AND
                  (
                   PLS.TERM_THRU_MTH_AOT   &gt;=  #termMthNum#
                 OR
                   PLS.TERM_THRU_MTH_AOT   IS NULL
                  )
                --
                AND PLS.EFF_FROM_DT        &lt;= #slsDt#
                AND ( 
                    PLS.EFF_THRU_DT        &gt;= #slsDt#
                    OR PLS.EFF_THRU_DT     IS NULL
                ) 
                AND PLS.DEL_FLG             = 'N'
                AND PLS.EZCANCELFLAG        = '0'
    </statement>

    <statement id="getPrcListBandCd" parameterClass="Map" resultClass="String">
        SELECT
                  B.PRC_LIST_BAND_CD
            FROM
                PRC_LIST_BAND   B
            WHERE
                B.GLBL_CMPY_CD                  = #glblCmpyCd#
                AND B.PRC_LIST_BAND_DESC_TXT    = #prcListBandDescTxt#
                AND B.EZCANCELFLAG              = '0'
    </statement>

    <statement id="getBandBasePrc" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                  CASE 
                    WHEN PLT.PRC_LIST_STRU_TP_CD = #prcListStruTpService#
                    THEN ( 
                        SELECT
                                  PLS.BASE_AMT
                            FROM
                                PRC_LIST_SVC        PLS
                                , PRC_LIST_BAND     PLB
                            WHERE
                                PLS.GLBL_CMPY_CD                = DPC.GLBL_CMPY_CD
                                AND PLS.PRC_CATG_CD             = DPC.PRC_CATG_CD
                                --
                                AND PLS.MDL_ID                  = #mdlId#
                                AND PLS.PRC_MTR_PKG_PK          = #prcMtrPkgPk#
                                AND PLS.PRC_SVC_PLN_TP_CD       = #prcSvcPlnTpCd#
                                AND PLS.PRC_SVC_CONTR_TP_CD     = #prcSvcContrTpCd#
                                AND PLS.BLLG_MTR_LB_CD          = #bllgMtrLbCd#
                                AND PLS.EFF_FROM_DT             &lt;= #slsDt#
                                AND ( 
                                    PLS.EFF_THRU_DT             IS NULL
                                    OR PLS.EFF_THRU_DT          &gt;= #slsDt#
                                ) 
                                AND PLS.DEL_FLG                  = 'N'
                                --
                                AND PLS.TERM_FROM_MTH_AOT       &lt;= #termMth#
                                AND (
                                    PLS.TERM_THRU_MTH_AOT       &gt;= #termMth#
                                    OR PLS.TERM_THRU_MTH_AOT    IS NULL
                                )
                                AND PLS.EZCANCELFLAG             = '0'
                                -- 
                                AND PLS.PRC_LIST_BAND_CD         = PLB.PRC_LIST_BAND_CD
                                AND PLS.GLBL_CMPY_CD             = PLB.GLBL_CMPY_CD
                                AND PLB.PRC_LIST_BAND_DESC_TXT   = #prcListBandDescTxt#
                                AND PLB.EZCANCELFLAG             = '0'
                                AND ROWNUM = 1
                    ) 
                    WHEN PLT.PRC_LIST_STRU_TP_CD = #prcListStruTpServiceTiers#
                    THEN ( 
                        SELECT
                                  PLST.BASE_AMT
                            FROM
                                PRC_LIST_SVC_TIER   PLST
                                , PRC_LIST_BAND     PLB
                            WHERE
                                PLST.GLBL_CMPY_CD                = DPC.GLBL_CMPY_CD
                                AND PLST.PRC_CATG_CD             = DPC.PRC_CATG_CD 
                                --
                                AND PLST.MDL_ID                  = #mdlId#
                                AND PLST.PRC_MTR_PKG_PK          = #prcMtrPkgPk#
                                AND PLST.PRC_SVC_PLN_TP_CD       = #prcSvcPlnTpCd#
                                AND PLST.PRC_SVC_CONTR_TP_CD     = #prcSvcContrTpCd#
                                AND PLST.BLLG_MTR_LB_CD          = #bllgMtrLbCd#
                                AND PLST.EFF_FROM_DT            &lt;= #slsDt#
                                AND ( 
                                    PLST.EFF_THRU_DT            IS NULL
                                    OR PLST.EFF_THRU_DT         &gt;= #slsDt#
                                ) 
                                AND PLST.DEL_FLG                = 'N'
                                --
                                AND PLST.TERM_FROM_MTH_AOT      &lt;= #termMth#
                                AND ( 
                                    PLST.TERM_THRU_MTH_AOT      &gt;= #termMth#
                                    OR PLST.TERM_THRU_MTH_AOT   IS NULL
                                )
                                AND PLST.EZCANCELFLAG = '0'
                                -- 
                                AND PLST.GLBL_CMPY_CD            = PLB.GLBL_CMPY_CD
                                AND PLST.PRC_LIST_BAND_CD        = PLB.PRC_LIST_BAND_CD
                                AND PLB.PRC_LIST_BAND_DESC_TXT   = #prcListBandDescTxt#
                                AND PLB.EZCANCELFLAG             = '0'
                                AND ROWNUM = 1
                    ) 
                    WHEN PLT.PRC_LIST_STRU_TP_CD = #prcListStruTpSupplyProgram#
                    THEN ( 
                        SELECT
                                  PLSP.TOT_BASE_AMT
                            FROM
                                PRC_LIST_SPLY_PGM   PLSP
                                , PRC_LIST_BAND     PLB
                            WHERE
                                PLSP.GLBL_CMPY_CD                = DPC.GLBL_CMPY_CD
                                AND PLSP.PRC_CATG_CD             = DPC.PRC_CATG_CD
                                --
                                AND PLSP.MDL_ID                  = #mdlId#
                                AND PLSP.PRC_MTR_PKG_PK          = #prcMtrPkgPk#
                                AND PLSP.PRC_SVC_PLN_TP_CD       = #prcSvcPlnTpCd#
                                AND PLSP.PRC_SVC_CONTR_TP_CD     = #prcSvcContrTpCd#
                                AND PLSP.BLLG_MTR_LB_CD          = #bllgMtrLbCd#
                                AND PLSP.EFF_FROM_DT            &lt;= #slsDt#
                                AND ( 
                                    PLSP.EFF_THRU_DT            IS NULL 
                                    OR PLSP.EFF_THRU_DT         &gt;= #slsDt#
                                ) 
                                AND PLSP.DEL_FLG                = 'N'
                                --
                                AND PLSP.TERM_FROM_MTH_AOT      &lt;= #termMth#
                                AND ( 
                                    PLSP.TERM_THRU_MTH_AOT      &gt;= #termMth#
                                    OR PLSP.TERM_THRU_MTH_AOT   IS NULL
                                )
                                AND PLSP.EZCANCELFLAG            = '0'
                                -- 
                                AND PLSP.GLBL_CMPY_CD            = PLB.GLBL_CMPY_CD
                                AND PLSP.PRC_LIST_BAND_CD        = PLB.PRC_LIST_BAND_CD
                                AND PLB.PRC_LIST_BAND_DESC_TXT   = #prcListBandDescTxt#
                                AND PLB.EZCANCELFLAG             = '0'
                                AND ROWNUM = 1
                    ) 
                    END BASE_AMT
            FROM
                  PRC_CATG      DPC
                , PRC_LIST_TP   PLT
            WHERE
                DPC.GLBL_CMPY_CD         = #glblCmpyCd#
                AND DPC.PRC_CATG_CD      = #prcCatgCd#
                AND DPC.EFF_FROM_DT     &lt;= #slsDt#
                AND (
                    DPC.EFF_THRU_DT     IS NULL
                    OR DPC.EFF_THRU_DT  &gt;= #slsDt#
                )
                AND DPC.ACTV_FLG         = 'Y'
                AND DPC.EZCANCELFLAG     = '0'
                --
                AND DPC.GLBL_CMPY_CD     = PLT.GLBL_CMPY_CD
                AND DPC.PRC_LIST_TP_CD   = PLT.PRC_LIST_TP_CD
                AND PLT.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getPrcListStruTp" parameterClass="Map" resultClass="String">
        SELECT
                  PLT.PRC_LIST_STRU_TP_CD
            FROM
                  PRC_CATG     DPC
                , PRC_LIST_TP   PLT
            WHERE
                DPC.GLBL_CMPY_CD        = #glblCmpyCd#
                AND DPC.PRC_CATG_CD     = #prcCatgCd#
                AND DPC.EZCANCELFLAG    = '0'
                --
                AND DPC.GLBL_CMPY_CD    = PLT.GLBL_CMPY_CD
                AND DPC.PRC_LIST_TP_CD  = PLT.PRC_LIST_TP_CD
                AND PLT.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getDefaultBandForService" parameterClass="Map" resultClass="Map">
        SELECT
                  PLS.MIN_COPY_VOL_CNT          AS MIN_COPY_VOL_CNT
                , PLS.MAX_COPY_VOL_CNT          AS MAX_COPY_VOL_CNT
                , PLS.PRC_LIST_BAND_CD          AS PRC_LIST_BAND_CD
                , PLB.PRC_LIST_BAND_DESC_TXT    AS PRC_LIST_BAND_DESC_TXT
                , PLS.BASE_AMT                  AS BASE_AMT
                , PLS.CPC_AMT_RATE              AS CPC_AMT_RATE
                , PLS.MDSE_CD                   AS MDSE_CD
            FROM
                PRC_LIST_SVC    PLS
                , PRC_LIST_BAND PLB
            WHERE
                PLS.GLBL_CMPY_CD             = #glblCmpyCd#
                AND PLS.PRC_CATG_CD          = #prcCatgCd#
                AND PLS.MDL_ID               = #mdlId#
                AND PLS.PRC_MTR_PKG_PK       = #prcMtrPkgPk#
                AND PLS.PRC_SVC_PLN_TP_CD    = #prcSvcPlnTpCd#
                AND PLS.PRC_SVC_CONTR_TP_CD  = #prcSvcContrTpCd#
                AND PLS.BLLG_MTR_LB_CD       = #bllgMtrLbCd#
                AND PLS.PRC_RATE_TP_CD      IN (#cpc#, #annual#)
                AND PLS.EFF_FROM_DT         &lt;= #slsDt#
                AND (
                    PLS.EFF_THRU_DT         IS NULL
                    OR PLS.EFF_THRU_DT      &gt;= #slsDt#
                ) 
                AND PLS.DEL_FLG              = 'N'
                AND PLS.TERM_FROM_MTH_AOT   &lt;= #termMth#
                AND ( 
                    PLS.TERM_THRU_MTH_AOT   &gt;= #termMth#
                    OR PLS.TERM_THRU_MTH_AOT IS NULL
                )
                AND PLS.EZCANCELFLAG         = '0'
                --
                AND PLS.GLBL_CMPY_CD         = PLB.GLBL_CMPY_CD
                AND PLS.PRC_LIST_BAND_CD     = PLB.PRC_LIST_BAND_CD
              <isNotNull property="prcListBandDescTxt">
                AND PLB.PRC_LIST_BAND_DESC_TXT  = #prcListBandDescTxt#
              </isNotNull>
                AND PLB.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getDefaultBandForServiceTiers" parameterClass="Map" resultClass="Map">
        SELECT
                --  PLST.MIN_COPY_VOL_CNT      AS MIN_COPY_VOL_CNT
                --, PLST.MAX_COPY_VOL_CNT      AS MAX_COPY_VOL_CNT
                PLST.PRC_LIST_BAND_CD      AS PRC_LIST_BAND_CD
                , PLB.PRC_LIST_BAND_DESC_TXT AS PRC_LIST_BAND_DESC_TXT
                --, PLST.BASE_AMT              AS BASE_AMT
                --, PLST.CPC_AMT_RATE          AS CPC_AMT_RATE
                , PLST.MDSE_CD               AS MDSE_CD
                --, PLST.PRC_SVC_TIER_TP_CD    AS PRC_SVC_TIER_TP_CD
            FROM
                PRC_LIST_SVC_TIER   PLST
                , PRC_LIST_BAND     PLB
            WHERE
                PLST.GLBL_CMPY_CD            = #glblCmpyCd#
                AND PLST.PRC_CATG_CD         = #prcCatgCd#
                AND PLST.MDL_ID              = #mdlId#
                AND PLST.PRC_MTR_PKG_PK      = #prcMtrPkgPk#
                AND PLST.PRC_SVC_PLN_TP_CD   = #prcSvcPlnTpCd#
                AND PLST.PRC_SVC_CONTR_TP_CD = #prcSvcContrTpCd#
                AND PLST.BLLG_MTR_LB_CD      = #bllgMtrLbCd#
                AND PLST.EFF_FROM_DT        &lt;= #slsDt#
                AND ( 
                    PLST.EFF_THRU_DT        IS NULL 
                    OR PLST.EFF_THRU_DT     &gt;= #slsDt#
                ) 
                AND PLST.DEL_FLG             = 'N' 
                AND PLST.TERM_FROM_MTH_AOT  &lt;= #termMth#
                AND ( 
                    PLST.TERM_THRU_MTH_AOT  &gt;= #termMth#
                    OR PLST.TERM_THRU_MTH_AOT IS NULL
                ) 
                AND PLST.EZCANCELFLAG        = '0'
                               --
                AND PLST.GLBL_CMPY_CD        = PLB.GLBL_CMPY_CD
                AND PLST.PRC_LIST_BAND_CD    = PLB.PRC_LIST_BAND_CD
              <isNotNull property="prcListBandDescTxt">
                AND PLB.PRC_LIST_BAND_DESC_TXT  = #prcListBandDescTxt#
              </isNotNull>
                AND PLB.EZCANCELFLAG         = '0'
            GROUP BY
                PLST.PRC_LIST_BAND_CD
                , PLB.PRC_LIST_BAND_DESC_TXT
                , PLST.MDSE_CD
    </statement>

    <statement id="getDefaultBandForSupplyProgram" parameterClass="Map" resultClass="Map">
        SELECT
                  PLSP.MIN_COPY_VOL_CNT      AS MIN_COPY_VOL_CNT
                , PLSP.MAX_COPY_VOL_CNT      AS MAX_COPY_VOL_CNT
                , PLSP.PRC_LIST_BAND_CD      AS PRC_LIST_BAND_CD
                , PLB.PRC_LIST_BAND_DESC_TXT AS PRC_LIST_BAND_DESC_TXT
                , PLSP.TOT_BASE_AMT          AS BASE_AMT
                , PLSP.CPC_AMT_RATE          AS CPC_AMT_RATE
                , PLSP.MDSE_CD               AS MDSE_CD
                , PLSP.PRC_CATG_CD
            FROM
                PRC_LIST_SPLY_PGM   PLSP
                , PRC_LIST_BAND     PLB
            WHERE
                PLSP.GLBL_CMPY_CD            = #glblCmpyCd#
                AND PLSP.PRC_CATG_CD         = #prcCatgCd#
                AND PLSP.MDL_ID              = #mdlId#
                AND PLSP.PRC_MTR_PKG_PK      = #prcMtrPkgPk#
                AND PLSP.PRC_SVC_PLN_TP_CD   = #prcSvcPlnTpCd#
                AND PLSP.PRC_SVC_CONTR_TP_CD = #prcSvcContrTpCd#
                AND PLSP.BLLG_MTR_LB_CD      = #bllgMtrLbCd#
                AND PLSP.EFF_FROM_DT        &lt;= #slsDt#
                AND (
                    PLSP.EFF_THRU_DT        IS NULL
                    OR PLSP.EFF_THRU_DT     &gt;= #slsDt#
                ) 
                AND PLSP.DEL_FLG             = 'N'
                AND PLSP.TERM_FROM_MTH_AOT  &lt;= #termMth#
                AND ( 
                    PLSP.TERM_THRU_MTH_AOT  &gt;= #termMth#
                    OR PLSP.TERM_THRU_MTH_AOT IS NULL
                ) 
                AND PLSP.EZCANCELFLAG        = '0'
                --
                AND (
                    PLSP.SPLY_AGMT_PLN_PK  IS NULL
                    OR EXISTS (
                        SELECT
                                  1
                            FROM
                                SPLY_AGMT_PLN   SAP
                            WHERE
                                SAP.GLBL_CMPY_CD            = PLSP.GLBL_CMPY_CD
                                AND SAP.SPLY_AGMT_PLN_PK    = PLSP.SPLY_AGMT_PLN_PK
                                AND SAP.ACTV_FLG            = 'Y'
                                AND SAP.EFF_FROM_DT        &lt;= #slsDt#
                                AND (
                                    SAP.EFF_THRU_DT        IS NULL
                                    OR SAP.EFF_THRU_DT     &gt;= #slsDt#
                                )
                                AND SAP.DEL_FLG             = 'N'
                                AND SAP.EZCANCELFLAG        = '0'
                    )
                )
                --
                AND PLSP.GLBL_CMPY_CD        = PLB.GLBL_CMPY_CD
                AND PLSP.PRC_LIST_BAND_CD    = PLB.PRC_LIST_BAND_CD
              <isNotNull property="prcListBandDescTxt">
                AND PLB.PRC_LIST_BAND_DESC_TXT  = #prcListBandDescTxt#
              </isNotNull>
                AND PLB.EZCANCELFLAG         = '0'
    </statement>

    <!-- <statement id="getDefaultHeaderRentalEqPrcListFromCPO" parameterClass="Map" resultClass="String"> -->
    <statement id="getDefaultHeaderRentalEqPrcListFromCPO" parameterClass="Map" resultClass="Map"><!-- 2018/08/24 K.Ishizuka [QC#25105,Mod] -->
        SELECT
                <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                <!-- C.PRC_CATG_NM -->
                PC.PRC_CATG_NM
                <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                ,PC.PRC_CATG_CD <!-- 2018/08/24 K.Ishizuka [QC#25105,ADD] -->
            FROM
                <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                <!-- CPO_V    C -->
                 CPO      C
                <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                ,PRC_CATG PC
                <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
            WHERE
                C.GLBL_CMPY_CD      = #glblCmpyCd#
                AND C.CPO_ORD_NUM   = #cpoOrdNum#
                AND C.EZCANCELFLAG  = '0'
                <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                AND C.GLBL_CMPY_CD     = PC.GLBL_CMPY_CD(+)
                AND C.PRC_CATG_CD      = PC.PRC_CATG_CD(+)
                AND PC.EZCANCELFLAG(+) = '0'
                <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
    </statement>

    <statement id="getCountPrcListBandFromDescTxt" parameterClass="Map" resultClass="Integer">
        SELECT
                  COUNT(PLB.GLBL_CMPY_CD)   CNT
            FROM
                PRC_LIST_BAND PLB 
            WHERE
                PLB.GLBL_CMPY_CD                = #glblCmpyCd#
                AND PLB.PRC_LIST_BAND_DESC_TXT  = #prcListBandDescTxt#
                AND PLB.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getCountValidItem" parameterClass="Map" resultClass="Integer">
        SELECT
                  COUNT(CD.GLBL_CMPY_CD)    CNT
            FROM
                CPO_DTL         CD
                , ALL_MDSE_V    M
            WHERE
                CD.GLBL_CMPY_CD             = #glblCmpyCd#
                AND CD.CPO_ORD_NUM          = #cpoOrdNum#
                AND CD.CPO_DTL_LINE_NUM     = #cpoDtlLineNum#
                AND CD.CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
                AND CD.EZCANCELFLAG         = '0'
                AND CD.GLBL_CMPY_CD         = M.GLBL_CMPY_CD
                AND CD.MDSE_CD              = M.MDSE_CD
                AND M.INSTL_BASE_CTRL_FLG   = 'Y'
                AND M.EZCANCELFLAG          = '0'
              <isNotNull property="mdseTpCtxTp">
                <!-- Mod Start 2018/07/20 QC#27268 -->
                <!-- Mod Start 2018/07/27 QC#27492 -->
                <!-- <isNotEqual property="target" compareValue="addlSvcChrg"> -->
                <isEqual property="targetFlg" compareValue="Y">
                AND CD.BASE_CMPT_FLG        = 'N'
                </isEqual>
                <!-- Mod End 2018/07/27 QC#27492 -->
                <!-- AND <isNotEqual property="target" compareValue="addlSvcChrg">NOT</isNotEqual> EXISTS ( -->
                <isNull property="targetFlg">
                AND EXISTS (
                    SELECT
                              1
                        FROM
                            MDSE_TP_VAL_SET MTVS 
                        WHERE
                            MTVS.GLBL_CMPY_CD            = M.GLBL_CMPY_CD
                            AND MTVS.COA_MDSE_TP_CD      = M.COA_MDSE_TP_CD
                            AND MTVS.MDSE_TP_CTX_TP_CD  IN
                          <iterate property="mdseTpCtxTp" var="mdseTpCtxTp[]" open=" (" close=")" conjunction=",">
                            #mdseTpCtxTp[]#
                          </iterate>
                            AND MTVS.EZCANCELFLAG        = '0'
                )
                </isNull>
                <!-- Mod End 2018/07/20 QC#27268 -->
              </isNotNull>
    </statement>

    <statement id="getSplyAgmtPlnNm" parameterClass="Map" resultClass="Map">
        SELECT
                  SAP.SPLY_AGMT_PLN_PK || ':' || SAP.SPLY_AGMT_PLN_DESC_TXT     EDIT_SPLY_AGMT_PLN_NM
                  ,(
                    SELECT
                              'Y'
                        FROM
                            SPLY_AGMT_PLN   SAP
                        WHERE
                            SAP.GLBL_CMPY_CD            = PLSP.GLBL_CMPY_CD
                            AND SAP.SPLY_AGMT_PLN_PK    = PLSP.SPLY_AGMT_PLN_PK
                            AND SAP.EFF_FROM_DT        &lt;= #slsDt#
                            AND (
                                SAP.EFF_THRU_DT IS NULL
                                OR SAP.EFF_THRU_DT     &gt;= #slsDt#
                            ) 
                            AND SAP.ACTV_FLG             = 'Y'
                            AND SAP.DEL_FLG              = 'N'
                            AND SAP.EZCANCELFLAG         = '0'
                )   EXISTS_FLG
            FROM
                PRC_LIST_SPLY_PGM   PLSP
                , PRC_LIST_BAND     PLB
                , SPLY_AGMT_PLN     SAP
            WHERE
                PLSP.GLBL_CMPY_CD               = #glblCmpyCd#
                AND PLSP.MDL_ID                 = #mdlId#
                AND PLSP.PRC_MTR_PKG_PK         = #prcMtrPkgPk#
                AND PLSP.PRC_SVC_PLN_TP_CD      = #prcSvcPlnTpCd#
                AND PLSP.PRC_SVC_CONTR_TP_CD    = #prcSvcContrTpCd#
                AND PLSP.BLLG_MTR_LB_CD         = #bllgMtrLbCd#
                AND PLSP.PRC_CATG_CD            = #prcCatgCd#
                AND PLSP.EFF_FROM_DT           &lt;= #slsDt#
                AND ( 
                    PLSP.EFF_THRU_DT           IS NULL 
                    OR PLSP.EFF_THRU_DT        &gt;= #slsDt#
                ) 
                AND PLSP.TERM_FROM_MTH_AOT     &lt;= #termMth#
                AND ( 
                    PLSP.TERM_THRU_MTH_AOT     IS NULL 
                    OR PLSP.TERM_THRU_MTH_AOT  &gt;= #termMth#
                ) 
                AND PLSP.EZCANCELFLAG           = '0'
                --
                AND PLSP.GLBL_CMPY_CD           = PLB.GLBL_CMPY_CD
                AND PLSP.PRC_LIST_BAND_CD       = PLB.PRC_LIST_BAND_CD
                AND PLB.PRC_LIST_BAND_DESC_TXT    = #prcListBandDescTxt#
                AND PLB.EZCANCELFLAG            = '0'
                AND PLSP.GLBL_CMPY_CD           = SAP.GLBL_CMPY_CD
                AND PLSP.SPLY_AGMT_PLN_PK       = SAP.SPLY_AGMT_PLN_PK
                AND SAP.EZCANCELFLAG            = '0'
    </statement>

    <!--     // QC#16141 ADD START -->
    <statement id="getBillToCustInfoList" parameterClass="Map" resultClass="Map">
        SELECT
            BTC.BILL_TO_CUST_CD AS BILL_TO_CUST_CD

                , ( 
                    RPAD( 
                        BTC.FIRST_LINE_ADDR
                        , LENGTH(BTC.FIRST_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.SCD_LINE_ADDR
                        , LENGTH(BTC.SCD_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.THIRD_LINE_ADDR
                        , LENGTH(BTC.THIRD_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.FRTH_LINE_ADDR
                        , LENGTH(BTC.FRTH_LINE_ADDR) + 1
                    ) || CONCAT(BTC.CTY_ADDR, ',') || RPAD(BTC.ST_CD, LENGTH(BTC.ST_CD) + 1) || RPAD(BTC.POST_CD, LENGTH(BTC.POST_CD) + 1)
                ) BILL_TO_ADDR

            ,(
              CASE WHEN BTC.FIRST_LINE_ADDR IS NOT NULL THEN
                  
                     DECODE (BTC.FIRST_LINE_ADDR, NULL, '', CONCAT(BTC.FIRST_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (BTC.SCD_LINE_ADDR, NULL, '', CONCAT(BTC.SCD_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (BTC.THIRD_LINE_ADDR, NULL, '', CONCAT(BTC.THIRD_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (BTC.FRTH_LINE_ADDR, NULL, '', CONCAT(BTC.FRTH_LINE_ADDR, CHR(13) || CHR(10)))
                  || CONCAT (BTC.CTY_ADDR, ',')
                  || RPAD (BTC.ST_CD, LENGTH (BTC.ST_CD) + 1)
                  || BTC.POST_CD
              END)               AS ENT_BILL_TO_ADDR
            ,DAC.SELL_TO_CUST_CD AS DS_ACCT_NUM
            ,DAC.DS_ACCT_NM      AS DS_ACCT_NM
        FROM
            BILL_TO_CUST    BTC
           ,SELL_TO_CUST    DAC
        WHERE
            BTC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND BTC.BILL_TO_CUST_CD LIKE #custCd#
            AND BTC.RGTN_STS_CD     = #rgtnStsCd#
            AND BTC.EZCANCELFLAG    = '0'
            
            AND BTC.GLBL_CMPY_CD    = DAC.GLBL_CMPY_CD
            AND BTC.SELL_TO_CUST_CD = DAC.SELL_TO_CUST_CD
            AND DAC.RGTN_STS_CD      = #rgtnStsCd#
            AND DAC.EZCANCELFLAG     = '0'
            AND ROWNUM          &lt;= 2  <!-- 2018/03/12 S21_NA#24090 Add -->
    </statement>
    <!--     // QC#16141 ADD END -->

    <statement id="cntOverlappingTerm" parameterClass="Map" resultClass="Integer">
        SELECT
                  COUNT(DCD.GLBL_CMPY_CD)    CNT
            FROM
                  DS_CONTR_DTL          DCD
                , DS_CONTR              DC
                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                <!-- , CPO_DTL_V             CD -->
                , CPO_DTL               CD
                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                , DS_CONTR_BLLG_MTR     CBM
            WHERE
                    DCD.GLBL_CMPY_CD            = #glblCmpyCd#
                AND DCD.DS_CONTR_PK             = #dsContrPk#
                AND DCD.CPO_ORD_NUM             = #refCpoOrdNum#
                AND DCD.SHELL_LINE_NUM   &lt;&gt; #shellLineNum#
                AND DCD.EZCANCELFLAG            = '0'
                --
                AND DCD.GLBL_CMPY_CD            = DC.GLBL_CMPY_CD
                AND DCD.DS_CONTR_PK             = DC.DS_CONTR_PK
                AND DC.EZCANCELFLAG             = '0'
                --
                AND DCD.GLBL_CMPY_CD            = CD.GLBL_CMPY_CD
                AND DCD.CPO_ORD_NUM             = CD.CPO_ORD_NUM
                AND DCD.CPO_DTL_LINE_NUM        = CD.CPO_DTL_LINE_NUM
                AND DCD.CPO_DTL_LINE_SUB_NUM    = CD.CPO_DTL_LINE_SUB_NUM
                <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                AND DCD.DS_CONTR_CRAT_TP_CD     = #dsContrCratTpShell#
                <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                AND CD.DS_ORD_POSN_NUM          = #dsOrdPosnNum#
                AND CD.EZCANCELFLAG             = '0'
                --
                AND DCD.GLBL_CMPY_CD            = CBM.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_PK         = CBM.DS_CONTR_DTL_PK
                AND CBM.EZCANCELFLAG            = '0'
                --
                AND ( 
                    ( 
                        DCD.FROM_PER_MTH_NUM          &lt;= #fromMth#
                        AND DCD.TO_PER_MTH_NUM   BETWEEN #fromMth# AND #toMth#
                    ) 
                    OR ( 
                        DCD.TO_PER_MTH_NUM            &gt;= #toMth#
                        AND DCD.FROM_PER_MTH_NUM BETWEEN #fromMth# AND #toMth#
                    ) 
                    OR ( 
                        DCD.TO_PER_MTH_NUM            &gt;= #toMth#
                        AND DCD.FROM_PER_MTH_NUM      &lt;= #fromMth#
                    ) 
                    OR ( 
                        DCD.TO_PER_MTH_NUM            &lt;= #toMth#
                        AND DCD.FROM_PER_MTH_NUM      &gt;= #fromMth#
                    )
                ) 
                AND CBM.BLLG_MTR_LB_CD          = #bllgMtrLbCd#
    </statement>

    <statement id="getInitDataFromShellContrHeader" parameterClass="Map" resultClass="Map">
        SELECT
                  WK_V.DS_CONTR_PK
                , WK_V.SHELL_LINE_NUM
                , WK_V.CPO_ORD_NUM
                , WK_V.SVC_PGM_MDSE_CD
                , WK_V.MDSE_DESC_SHORT_TXT
                , WK_V.PRC_SVC_CONTR_TP_CD
                , WK_V.PRC_SVC_CONTR_TP_DESC_TXT
                , WK_V.PRC_SVC_PLN_TP_CD
                , WK_V.PRC_SVC_PLN_TP_DESC_TXT
                , WK_V.DS_CONTR_CATG_CD
                , WK_V.DS_CONTR_CATG_DESC_TXT
                , WK_V.DS_CONTR_NUM
                , WK_V.BASE_BLLG_CYCLE_CD
                , WK_V.BASE_BLLG_CYCLE_DESC_TXT
                , WK_V.MTR_BLLG_CYCLE_CD
                , WK_V.MTR_BLLG_CYCLE_DESC_TXT
                , WK_V.FROM_PER_MTH_NUM
                , WK_V.TO_PER_MTH_NUM
                , WK_V.TERM_MTH_AOT
                <!-- START 2018/11/15 [QC#28638, ADD] -->
                , WK_V.FIX_TERM_IN_MTH_AOT
                <!-- END 2018/11/15 [QC#28638, ADD] -->
                , WK_V.BILL_WITH_EQUIP_FLG
                , WK_V.BILL_BY_TP_CD
                , WK_V.BILL_BY_TP_DESC_TXT
                , WK_V.CPO_SVC_AGMT_VER_NUM
                , WK_V.MAN_CONTR_OVRD_FLG
                , WK_V.SVC_MEMO_RSN_CD
                , WK_V.SVC_MEMO_RSN_DESC_TXT
                , WK_V.SVC_CMNT_TXT
                , WK_V.APPLY_EQUIP_BILL_TO_FLG
                , WK_V.TOT_BASE_PRC_DEAL_AMT
                , WK_V.TOT_BASE_PRC_FUNC_AMT
                , WK_V.DS_ACCT_NUM
                , WK_V.DS_ACCT_NM
                , WK_V.ALT_PAYER_CUST_CD
                , WK_V.BILL_TO_SRCH_TXT
                , WK_V.DS_ORD_TP_CD
                , WK_V.DS_ORD_CATG_CD
                , WK_V.ADD_ASRY_FLG
                , WK_V.ADD_CONTR_FLG
                , (
                    CASE 
                        WHEN WK_V.DS_CONTR_STS_CD &lt;&gt; #dsContrStsCd#
                        THEN 'Y'
                        ELSE 'N'
                    END
                  ) AS CONTR_CRAT_FLG

                , WK_V.EZUPTIME
                , WK_V.EZUPTIMEZONE
                <!-- START 2018/07/02 [QC#26738, ADD] -->
                , WK_V.ORD_BOOK_FLG
                <!-- END 2018/07/02 [QC#26738, ADD] -->
                <!-- 2018/08/24 S21_NA#25105 Add Start -->
                , WK_V.ADDL_BASE_PRC_CATG_CD
                , WK_V.RNTL_PRC_CATG_CD
                , WK_V.ADDL_CHRG_PRC_CATG_CD
                <!-- 2018/08/24 S21_NA#25105 Add End -->
        FROM (
                SELECT
                          CD.DS_CONTR_PK
                        , CD.SHELL_LINE_NUM
                        , DC.CPO_ORD_NUM
                        , C.SVC_PGM_MDSE_CD
                        , AMV.MDSE_DESC_SHORT_TXT
                        , C.PRC_SVC_CONTR_TP_CD
                        , PSCT.PRC_SVC_CONTR_TP_DESC_TXT
                        , C.PRC_SVC_PLN_TP_CD
                        , PSPT.PRC_SVC_PLN_TP_DESC_TXT
                        , C.DS_CONTR_CATG_CD
                        , CC.DS_CONTR_CATG_DESC_TXT
                        , C.DS_CONTR_NUM
                        , C.BASE_BLLG_CYCLE_CD
                        , BBC.BLLG_CYCLE_DESC_TXT AS BASE_BLLG_CYCLE_DESC_TXT
                        <!-- START 2018/01/30 [QC#23857, MOD] -->
                        , NVL(C.MTR_BLLG_CYCLE_CD,BC.BLLG_CYCLE_CD) AS MTR_BLLG_CYCLE_CD
                        , NVL(UBC.BLLG_CYCLE_DESC_TXT,BC.BLLG_CYCLE_DESC_TXT) AS MTR_BLLG_CYCLE_DESC_TXT
                        <!-- START 2018/01/30 [QC#23857, MOD] -->
                        , CD.FROM_PER_MTH_NUM
                        , CD.TO_PER_MTH_NUM
                        , (
                            CD.TO_PER_MTH_NUM - CD.FROM_PER_MTH_NUM + 1
                          ) AS TERM_MTH_AOT
                        <!-- START 2018/11/15 [QC#28638, ADD] -->
                        , C.FIX_TERM_IN_MTH_AOT
                        <!-- END 2018/11/15 [QC#28638, ADD] -->
                        , CD.BILL_WITH_EQUIP_FLG
                        , C.BILL_BY_TP_CD
                        , BBT.BILL_BY_TP_DESC_TXT
                        , C.CPO_SVC_AGMT_VER_NUM
                        , C.MAN_CONTR_OVRD_FLG
                        , SM.SVC_MEMO_RSN_CD
                        , SMR.SVC_MEMO_RSN_DESC_TXT
                        , SM.SVC_CMNT_TXT
                        , C.APPLY_EQUIP_BILL_TO_FLG
                        , CD.TOT_BASE_PRC_DEAL_AMT
                        , CD.TOT_BASE_PRC_FUNC_AMT
                        , C.DS_ACCT_NUM
                        , DAC.DS_ACCT_NM
                        , C.ALT_PAYER_CUST_CD
                        , (
                            RPAD( 
                                BTC.FIRST_LINE_ADDR
                                , LENGTH(BTC.FIRST_LINE_ADDR) + 1
                            ) || RPAD( 
                                BTC.SCD_LINE_ADDR
                                , LENGTH(BTC.SCD_LINE_ADDR) + 1
                            ) || RPAD( 
                                BTC.THIRD_LINE_ADDR
                                , LENGTH(BTC.THIRD_LINE_ADDR) + 1
                            ) || RPAD( 
                                BTC.FRTH_LINE_ADDR
                                , LENGTH(BTC.FRTH_LINE_ADDR) + 1
                            ) || CONCAT(BTC.CTY_ADDR, ',') || RPAD(BTC.ST_CD, LENGTH(BTC.ST_CD) + 1) || RPAD(BTC.POST_CD, LENGTH(BTC.POST_CD) + 1)
                          ) AS BILL_TO_SRCH_TXT
                        , DC.DS_ORD_TP_CD
                        , DC.DS_ORD_CATG_CD
                        , CD.ADD_ASRY_FLG
                        , CD.ADD_CONTR_FLG
                        , C.DS_CONTR_STS_CD
                        , C.EZUPTIME
                        , C.EZUPTIMEZONE
                        <!-- START 2018/07/02 [QC#26738, ADD] -->
                        , DC.ORD_BOOK_FLG
                        <!-- END 2018/07/02 [QC#26738, ADD] -->
                        <!-- 2018/08/24 S21_NA#25105 Add Start -->
                        , C.ADDL_BASE_PRC_CATG_CD
                        , C.RNTL_PRC_CATG_CD
                        , C.ADDL_CHRG_PRC_CATG_CD
                        <!-- 2018/08/24 S21_NA#25105 Add End -->
                    FROM
                          DS_CONTR_DTL          CD
                        , DS_CONTR              C
                        , SVC_MEMO              SM
                        <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                        <!-- , CPO_DTL_V             DCD -->
                        , CPO_DTL               DCD
                        <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                        , ALL_MDSE_V            AMV
                        <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                        <!-- , CPO_V                 DC -->
                        , CPO                   DC
                        <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                        , SELL_TO_CUST          DAC
                        , BILL_TO_CUST          BTC
                        , PRC_SVC_CONTR_TP      PSCT
                        , PRC_SVC_PLN_TP        PSPT
                        , DS_CONTR_CATG         CC
                        , BLLG_CYCLE            BBC
                        , BLLG_CYCLE            UBC
                        , BILL_BY_TP            BBT
                        , SVC_MEMO_RSN          SMR
                        <!-- START 2018/01/30 [QC#23857, ADD] -->
                        ,(
                            SELECT
                                *
                            FROM
                               (
                                SELECT
                                    CD2.DS_CONTR_PK
                                   ,UBC2.BLLG_CYCLE_CD
                                   ,UBC2.BLLG_CYCLE_DESC_TXT
                                FROM
                                     DS_CONTR_DTL           CD2
                                    ,DS_CONTR_BLLG_MTR      CBM
                                    ,BLLG_CYCLE             UBC2
                                WHERE
                                        CD2.GLBL_CMPY_CD           = #glblCmpyCd#
                                    AND CD2.DS_CONTR_PK            = #dsContrPk#
                                    AND CD2.EZCANCELFLAG           = '0'
                                    --
                                    AND CD2.DS_CONTR_DTL_PK        = CBM.DS_CONTR_DTL_PK
                                    AND CBM.EZCANCELFLAG           = '0'
                                    --
                                    AND CBM.GLBL_CMPY_CD           = UBC2.GLBL_CMPY_CD
                                    AND UBC2.EZCANCELFLAG          = '0'
                                    AND CBM.BLLG_MTR_BLLG_CYCLE_CD = UBC2.BLLG_CYCLE_CD
                                ORDER BY CBM.DS_CONTR_DTL_PK,CBM.BLLG_MTR_LB_CD
                               )     A
                            WHERE
                                ROWNUM = 1
                        )   BC
                        <!-- START 2018/01/30 [QC#23857, ADD] -->
                    WHERE
                            CD.GLBL_CMPY_CD             = #glblCmpyCd#
                        AND CD.DS_CONTR_PK              = #dsContrPk#
                        AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                        AND CD.SHELL_LINE_NUM           = #shellLineNum#
                        AND CD.EZCANCELFLAG             = '0'
                        --
                        AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                        AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                        AND C.EZCANCELFLAG              = '0'
                        --
                        AND C.GLBL_CMPY_CD              = SM.GLBL_CMPY_CD(+)
                        AND C.DS_CONTR_PK               = SM.DS_CONTR_PK(+)
                        <!-- START 2017/07/28 [QC#20088, ADD] -->
                        AND SM.SVC_MEMO_TP_CD(+)        = #svcMemoTpCd#
                        AND SM.SVC_MEMO_TRX_NM(+)       = #svcMemoTrxNm#
                        <!-- END   2017/07/28 [QC#20088, ADD] -->
                        AND SM.EZCANCELFLAG(+)          = '0'
                        --
                        AND CD.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
                        AND CD.CPO_ORD_NUM              = DCD.CPO_ORD_NUM
                        AND CD.CPO_DTL_LINE_NUM         = DCD.CPO_DTL_LINE_NUM
                        AND CD.CPO_DTL_LINE_SUB_NUM     = DCD.CPO_DTL_LINE_SUB_NUM
                        AND DCD.EZCANCELFLAG            = '0'
                        --
                        AND DCD.GLBL_CMPY_CD            = DC.GLBL_CMPY_CD
                        AND DCD.CPO_ORD_NUM             = DC.CPO_ORD_NUM
                        AND DCD.EZCANCELFLAG            = '0'
                        <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                        AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                        <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                        --
                        AND C.GLBL_CMPY_CD              = AMV.GLBL_CMPY_CD(+)
                        AND C.SVC_PGM_MDSE_CD           = AMV.MDSE_CD(+)
                        AND AMV.EZCANCELFLAG(+)         = '0'
                        --
                        AND C.GLBL_CMPY_CD              = DAC.GLBL_CMPY_CD(+)
                        AND C.DS_ACCT_NUM               = DAC.SELL_TO_CUST_CD(+)
                        AND DAC.EZCANCELFLAG(+)         = '0'
                        --
                        AND C.GLBL_CMPY_CD              = BTC.GLBL_CMPY_CD(+)
                        AND C.ALT_PAYER_CUST_CD         = BTC.BILL_TO_CUST_CD(+)
                        AND BTC.EZCANCELFLAG(+)         = '0'
                        --
                        AND C.GLBL_CMPY_CD              = PSCT.GLBL_CMPY_CD(+)
                        AND C.PRC_SVC_CONTR_TP_CD       = PSCT.PRC_SVC_CONTR_TP_CD(+)
                        AND PSCT.EZCANCELFLAG(+)        = '0'
                        --
                        AND C.GLBL_CMPY_CD              = PSPT.GLBL_CMPY_CD(+)
                        AND C.PRC_SVC_PLN_TP_CD         = PSPT.PRC_SVC_PLN_TP_CD(+)
                        AND PSPT.EZCANCELFLAG(+)        = '0'
                        --
                        AND C.GLBL_CMPY_CD              = CC.GLBL_CMPY_CD
                        AND C.DS_CONTR_CATG_CD          = CC.DS_CONTR_CATG_CD
                        AND CC.EZCANCELFLAG             = '0'
                        --
                        AND C.GLBL_CMPY_CD              = BBC.GLBL_CMPY_CD(+)
                        AND C.BASE_BLLG_CYCLE_CD        = BBC.BLLG_CYCLE_CD(+)
                        AND BBC.EZCANCELFLAG(+)         = '0'
                        --
                        AND C.GLBL_CMPY_CD              = UBC.GLBL_CMPY_CD(+)
                        AND C.MTR_BLLG_CYCLE_CD         = UBC.BLLG_CYCLE_CD(+)
                        AND UBC.EZCANCELFLAG(+)         = '0'
                        --
                        AND C.GLBL_CMPY_CD              = BBT.GLBL_CMPY_CD(+)
                        AND C.BILL_BY_TP_CD             = BBT.BILL_BY_TP_CD(+)
                        AND BBT.EZCANCELFLAG(+)         = '0'
                        --
                        AND SM.GLBL_CMPY_CD             = SMR.GLBL_CMPY_CD(+)
                        AND SM.SVC_MEMO_RSN_CD          = SMR.SVC_MEMO_RSN_CD(+)
                        AND SMR.EZCANCELFLAG(+)         = '0'
                        <!-- START 2018/01/30 [QC#23857, MOD] -->
                        AND C.DS_CONTR_PK               = BC.DS_CONTR_PK(+)
                        <!-- START 2018/01/30 [QC#23857, MOD] -->
        ) WK_V
        WHERE
            ROWNUM = 1
    </statement>

    <statement id="getInitDataFromModelPricingHeader" parameterClass="Map" resultClass="Map">
        SELECT
                  WK_V.DS_CONTR_DTL_PK
                , WK_V.MDL_ID
                , WK_V.T_MDL_NM
                , (
                    SELECT COUNT(1)
                        FROM DS_CONTR_DTL CD1
                    WHERE   
                            CD1.GLBL_CMPY_CD        = WK_V.GLBL_CMPY_CD
                        AND CD1.DS_CONTR_PK         = WK_V.DS_CONTR_PK
                        AND CD1.CPO_ORD_NUM         = WK_V.CPO_ORD_NUM
                        <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                        AND CD1.DS_CONTR_CRAT_TP_CD = #dsContrCratTpShell#
                        <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    <isNotEqual property="isFleet" compareValue="Y">
                        AND CD1.MDL_ID              = WK_V.MDL_ID
                    </isNotEqual>
                        AND CD1.DS_CONTR_DTL_TP_CD IN
                        <iterate property="dsContrDtlTpCdMac" var="dsContrDtlTpCdMac[]" open=" (" close=")" conjunction=",">
                                #dsContrDtlTpCdMac[]#
                        </iterate>
                        AND CD1.EZCANCELFLAG        = '0'
                  ) AS MDL_QTY
                , WK_V.SVC_PRC_CATG_CD
                , WK_V.PRC_CATG_CD
                , WK_V.PRC_CATG_NM
                , WK_V.PRC_LIST_TP_CD
                , WK_V.PRC_MTR_PKG_PK
                , WK_V.PRC_MTR_PKG_NM
                , CASE
                      WHEN
                          EXISTS
                              (SELECT 1 
                                  FROM    CONTR_XS_COPY            CXC 
                                         ,DS_CONTR_BLLG_MTR        CBM
                                  WHERE   CXC.GLBL_CMPY_CD         = CBM.GLBL_CMPY_CD
                                  AND     CXC.DS_CONTR_BLLG_MTR_PK = CBM.DS_CONTR_BLLG_MTR_PK
                                  <!-- 2018/07/09 S21_NA#26528 Mod Start -->
                                  <!-- AND     CXC.XS_MTR_FIRST_FLG     = #xsMtrFirstFlgN# -->
                                  <!-- 2018/07/09 S21_NA#26528 Mod End -->
                                  AND     CXC.PRC_SVC_TIER_TP_CD   IS NOT NULL
                                  AND     CXC.EZCANCELFLAG         = '0'
                                  AND     CBM.GLBL_CMPY_CD         = WK_V.GLBL_CMPY_CD
                                  AND     CBM.DS_CONTR_DTL_PK      = WK_V.DS_CONTR_DTL_PK
                                  AND     CBM.EZCANCELFLAG         = '0')
                      THEN
                          WK_V.PRC_TIER_SVC_OFFER_CD
                      ELSE
                          NULL
                  END AS PRC_TIER_SVC_OFFER_CD
                , WK_V.BASE_PRC_DEAL_AMT
                , (WK_V.TO_PER_MTH_NUM - WK_V.FROM_PER_MTH_NUM + 1) AS TERM_MTH_AOT
                , (
                    CASE 
                        WHEN WK_V.DS_CONTR_STS_CD &lt;&gt; #dsContrStsCd#
                        THEN 'Y'
                        ELSE 'N'
                    END
                  ) AS CONTR_CRAT_FLG
                , (
                    CASE 
                        WHEN WK_V.DS_CONTR_DTL_STS_CD &lt;&gt; #dsContrDtlStsCd#
                        THEN 'N'
                        --
                        WHEN WK_V.ORD_LINE_STS_CD &gt;= #ordLineStsPartiallyShipped#
                        THEN 'N'
                        --
                        WHEN EXISTS (
                            SELECT
                                      1
                                FROM
                                    <!-- START 2018/01/23 M.Naito [QC#19793,MOD] -->
                                    <!--  DS_CPO_CONFIG_V   CV -->
                                      DS_CPO_CONFIG     CV
                                    <!-- END 2018/01/23 M.Naito [QC#19793,MOD] -->
                                    <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                                    <!-- , CPO_DTL_V         DV -->
                                    , CPO_DTL           DV
                                    <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                                    , SHPG_PLN          SP
                                WHERE
                                    CV.GLBL_CMPY_CD             = #glblCmpyCd#
                                    AND CV.CPO_ORD_NUM          = #cpoOrdNum#
                                    AND CV.MDL_ID               = WK_V.MDL_ID
                                    AND CV.EZCANCELFLAG         = '0'
                                    AND CV.GLBL_CMPY_CD         = DV.GLBL_CMPY_CD
                                    AND CV.DS_CPO_CONFIG_PK     = DV.DS_CPO_CONFIG_PK
                                    AND CV.DS_ORD_POSN_NUM      = DV.DS_ORD_POSN_NUM
                                    AND DV.BASE_CMPT_FLG        = 'Y'
                                    <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                    AND DV.ORD_LINE_STS_CD &lt;&gt; #ordLineStsCancelled#
                                    <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                    AND DV.EZCANCELFLAG         = '0'
                                     
                                    AND DV.GLBL_CMPY_CD         = SP.GLBL_CMPY_CD
                                    AND DV.CPO_ORD_NUM          = SP.TRX_HDR_NUM
                                    AND DV.CPO_DTL_LINE_NUM     = SP.TRX_LINE_NUM
                                    AND DV.CPO_DTL_LINE_SUB_NUM = SP.TRX_LINE_SUB_NUM
                                    AND SP.SHPG_STS_CD      &gt;= #shpgStsArrived#
                                    <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                    AND SP.SHPG_STS_CD   &lt;&gt; #shpgStsCancelled#
                                    <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                    AND SP.EZCANCELFLAG         = '0'
                        ) 
                        THEN 'N'
                        --
                        ELSE 'Y'
                    END
                  ) AS SCR_ENT_AVAL_FLG
                  <!-- START 2017/10/05 [QC#20059,ADD] -->
                  , (
                    <isEqual property="isFleet" compareValue="Y">
                    'N'
                    </isEqual>
                    <isNotEqual property="isFleet" compareValue="Y">
                    CASE 
                        WHEN WK_V.PRC_CATG_CD IS NULL
                        THEN 'Y'
                        ELSE 'N'
                    END
                    </isNotEqual>
                  ) AS CONFIG_PRC_SET_FLG
                  <!-- END   2017/10/05 [QC#20059,ADD] -->
        FROM (
            SELECT
                      CD.DS_CONTR_DTL_PK
                    , CD.MDL_ID
                    , MN.T_MDL_NM
                    , CD.SVC_PRC_CATG_CD
                    , CD.PRC_CATG_CD
                    , PC.PRC_CATG_NM
                    , PC.PRC_LIST_TP_CD
                    , CD.PRC_MTR_PKG_PK
                    , PMP.PRC_MTR_PKG_NM
                    , TSO.PRC_TIER_SVC_OFFER_CD
                    , CD.BASE_PRC_DEAL_AMT
                    , CD.FROM_PER_MTH_NUM 
                    , CD.TO_PER_MTH_NUM
                    , C.DS_CONTR_STS_CD
                    , CD.DS_CONTR_DTL_STS_CD
                    , MAX(DCD.ORD_LINE_STS_CD)  ORD_LINE_STS_CD
                    , C.DS_CONTR_PK
                    , DCD.CPO_ORD_NUM
                    , CD.GLBL_CMPY_CD
                FROM
                      DS_CONTR_DTL          CD
                    , DS_CONTR              C
                    <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                    <!-- , CPO_DTL_V             DCD -->
                    , CPO_DTL               DCD
                    <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                    , DS_CONTR_BLLG_MTR     CBM
                    , MDL_NM                MN
                    <!-- QC#28398
                    , ALL_MDSE_V            AMV
                     -->
                    , PRC_MTR_PKG           PMP
                    , PRC_CATG              PC
                    , XS_CHRG_TP            XCT
                    , PRC_TIER_SVC_OFFER    TSO
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCd#
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
                    AND CD.CPO_ORD_NUM              = DCD.CPO_ORD_NUM
                    <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                    AND DCD.ORD_LINE_STS_CD  &lt;&gt; #ordLineStsCancelled#
                    <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                    AND DCD.EZCANCELFLAG            = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = PMP.GLBL_CMPY_CD(+)
                    AND CD.PRC_MTR_PKG_PK           = PMP.PRC_MTR_PKG_PK(+)
                    AND PMP.EZCANCELFLAG(+)         = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD(+)
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK(+)
                    AND CBM.EZCANCELFLAG(+)         = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = MN.T_GLBL_CMPY_CD(+)
                    AND CD.MDL_ID                   = MN.T_MDL_ID(+)
                    AND MN.EZCANCELFLAG(+)          = '0'
                    --
                    <!-- QC#28398
                    AND CD.GLBL_CMPY_CD             = AMV.GLBL_CMPY_CD(+)
                    AND CD.SVC_PGM_MDSE_CD          = AMV.MDSE_CD(+)
                    AND AMV.EZCANCELFLAG(+)         = '0'
                     -->
                    --
                    AND CD.GLBL_CMPY_CD             = PC.GLBL_CMPY_CD(+)
                    AND CD.PRC_CATG_CD              = PC.PRC_CATG_CD(+)
                    AND PC.EZCANCELFLAG(+)          = '0'
                    --
                    AND CBM.GLBL_CMPY_CD            = XCT.GLBL_CMPY_CD(+)
                    AND CBM.XS_CHRG_TP_CD           = XCT.XS_CHRG_TP_CD(+)
                    AND XCT.EZCANCELFLAG(+)         = '0'
                    --
                    AND XCT.GLBL_CMPY_CD            = TSO.GLBL_CMPY_CD(+)
                    AND XCT.PRC_TIER_SVC_OFFER_CD   = TSO.PRC_TIER_SVC_OFFER_CD(+)
                    AND TSO.EZCANCELFLAG(+)         = '0'
                GROUP BY
                      CD.DS_CONTR_DTL_PK
                    , CD.MDL_ID
                    , MN.T_MDL_NM
                    , CD.SVC_PRC_CATG_CD
                    , CD.PRC_CATG_CD
                    , PC.PRC_CATG_NM
                    , PC.PRC_LIST_TP_CD
                    , CD.PRC_MTR_PKG_PK
                    , PMP.PRC_MTR_PKG_NM
                    , TSO.PRC_TIER_SVC_OFFER_CD
                    , CD.BASE_PRC_DEAL_AMT
                    , CD.FROM_PER_MTH_NUM 
                    , CD.TO_PER_MTH_NUM
                    , C.DS_CONTR_STS_CD
                    , CD.DS_CONTR_DTL_STS_CD
                    , C.DS_CONTR_PK
                    , DCD.CPO_ORD_NUM
                    , CD.GLBL_CMPY_CD
        ) WK_V
        ORDER BY
            WK_V.MDL_ID
    </statement>

    <statement id="getInitDataFromModelPricingDetail" parameterClass="Map" resultClass="Map">
        SELECT
                  WK_V.DS_CONTR_DTL_PK
                , WK_V.DS_CONTR_BLLG_MTR_PK
                , WK_V.CONTR_PHYS_BLLG_MTR_RELN_PK
                , WK_V.CONTR_XS_COPY_PK
                , WK_V.MDL_ID
                , WK_V.T_MDL_NM
                , WK_V.PRC_CATG_CD
                , WK_V.PRC_LIST_BAND_CD
                , WK_V.PRC_LIST_BAND_DESC_TXT
                , WK_V.PRC_BOOK_MDSE_CD
                , WK_V.BLLG_MTR_LB_CD
                , WK_V.BLLG_MTR_LB_DESC_TXT
                , WK_V.REG_MTR_LB_CD
                , WK_V.REG_MTR_LB_DESC_TXT
                , WK_V.CONTR_MTR_MULT_RATE
                , WK_V.XS_MTR_COPY_QTY
                , WK_V.MAX_COPY_VOL_CNT
                , WK_V.XS_MTR_AMT_RATE
                , WK_V.DS_ACCT_NM
                , WK_V.SELL_TO_CUST_CD
                , WK_V.BILL_TO_SRCH_TXT
                , WK_V.BILL_TO_CUST_CD
                , WK_V.INTG_MDSE_CD
                , WK_V.REG_MTR_LB_SORT_NUM
                , WK_V.PRC_SVC_TIER_TP_CD
                , WK_V.PRC_SVC_TIER_TP_DESC_TXT
                , WK_V.PRC_SVC_TIER_TP_SORT_NUM
                , WK_V.ACTV_FLG
                , WK_V.XX_FLG_NM
                <!-- 2018/05/09 QC#25030 add start -->
                , WK_V.BLLG_FREE_COPY_CNT
                , WK_V.BLLG_MIN_CNT
                , WK_V.BLLG_MIN_AMT_RATE
                , WK_V.BLLG_ROLL_OVER_RATIO
                <!-- 2018/05/09 QC#25030 add end -->
        FROM (
            SELECT DISTINCT
                      CD.DS_CONTR_DTL_PK
                    , CBM.DS_CONTR_BLLG_MTR_PK
                    , NULL AS CONTR_PHYS_BLLG_MTR_RELN_PK
                    , CXC.CONTR_XS_COPY_PK
                    , CD.MDL_ID
                    , MN.T_MDL_NM
                    , CD.PRC_CATG_CD
                    , CBM.PRC_LIST_BAND_CD
                    , PLB.PRC_LIST_BAND_DESC_TXT
                    , CBM.PRC_BOOK_MDSE_CD
                    , MLB.MTR_LB_CD AS BLLG_MTR_LB_CD
                    , MLB.MTR_LB_DESC_TXT AS BLLG_MTR_LB_DESC_TXT
                    , NULL AS REG_MTR_LB_CD
                    , NULL AS REG_MTR_LB_DESC_TXT
                    , NULL AS CONTR_MTR_MULT_RATE
                    , CXC.XS_MTR_COPY_QTY
                    , CXC.MAX_COPY_VOL_CNT
                    , CXC.XS_MTR_AMT_RATE
                    , DAC.DS_ACCT_NM
                    , CBM.SELL_TO_CUST_CD
                    , (
                        RPAD( 
                            BTC.FIRST_LINE_ADDR
                            , LENGTH(BTC.FIRST_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.SCD_LINE_ADDR
                            , LENGTH(BTC.SCD_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.THIRD_LINE_ADDR
                            , LENGTH(BTC.THIRD_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.FRTH_LINE_ADDR
                            , LENGTH(BTC.FRTH_LINE_ADDR) + 1
                        ) || CONCAT(BTC.CTY_ADDR, ',') || RPAD(BTC.ST_CD, LENGTH(BTC.ST_CD) + 1) || RPAD(BTC.POST_CD, LENGTH(BTC.POST_CD) + 1)
                      ) AS BILL_TO_SRCH_TXT
                    , CBM.BLLG_MTR_BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                    , CBM.INTG_MDSE_CD
                    , NULL AS REG_MTR_LB_SORT_NUM
                    , CXC.PRC_SVC_TIER_TP_CD
                    , PTT.PRC_SVC_TIER_TP_DESC_TXT
                    , PTT.PRC_SVC_TIER_TP_SORT_NUM
                    , CBR.ACTV_FLG
                    , #flgNmP# AS XX_FLG_NM
                    <!-- 2018/05/09 QC#25030 add start -->
                    , CBM.BLLG_FREE_COPY_CNT
                    , CBM.BLLG_MIN_CNT
                    , CBM.BLLG_MIN_AMT_RATE
                    , CBM.BLLG_ROLL_OVER_RATIO
                   <!-- 2018/05/09 QC#25030 add end -->
                FROM
                      DS_CONTR_DTL              CD
                    , DS_CONTR                  C
                    , DS_CONTR_BLLG_MTR         CBM
                    , CONTR_PHYS_BLLG_MTR_RELN  CBR
                    , CONTR_XS_COPY             CXC
                    , MDL_NM                    MN
                    , PRC_LIST_BAND             PLB
                    , MTR_LB                    MLB
                    , SELL_TO_CUST              DAC
                    , BILL_TO_CUST              BTC
                    , PRC_SVC_TIER_TP           PTT
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCd#
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = MN.T_GLBL_CMPY_CD(+)
                    AND CD.MDL_ID                   = MN.T_MDL_ID(+)
                    AND MN.EZCANCELFLAG(+)          = '0'
                    --
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG            = '0'
                    --
                    AND CBM.PRC_LIST_BAND_CD        = PLB.PRC_LIST_BAND_CD(+)
                    AND CBM.GLBL_CMPY_CD            = PLB.GLBL_CMPY_CD(+)
                    AND PLB.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = MLB.MTR_LB_CD(+)
                    AND CBM.GLBL_CMPY_CD            = MLB.GLBL_CMPY_CD(+)
                    AND MLB.EZCANCELFLAG(+)         = '0'
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            PRC_MTR_PKG_BLLG_MTR PBM
                        WHERE
                                PBM.GLBL_CMPY_CD    = CD.GLBL_CMPY_CD
                            AND PBM.PRC_MTR_PKG_PK  = CD.PRC_MTR_PKG_PK
                            AND PBM.MTR_LB_CD       = MLB.MTR_LB_CD
                            AND PBM.EZCANCELFLAG    = '0'
                    )
                    --
                    AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
                    AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                    AND CBR.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.DS_CONTR_BLLG_MTR_PK    = CXC.DS_CONTR_BLLG_MTR_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CXC.GLBL_CMPY_CD(+)
                    AND CXC.XS_MTR_FIRST_FLG        = #xsMtrFirstFlg# -- 'Y'
                    AND CXC.EZCANCELFLAG(+)         = '0'
                    --
                    AND CD.SELL_TO_CUST_CD          = DAC.SELL_TO_CUST_CD(+)
                    AND CD.GLBL_CMPY_CD             = DAC.GLBL_CMPY_CD(+)
                    AND DAC.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_BILL_TO_CUST_CD = BTC.BILL_TO_CUST_CD(+)
                    AND CBM.GLBL_CMPY_CD             = BTC.GLBL_CMPY_CD(+)
                    AND BTC.EZCANCELFLAG(+)          = '0'
                    --
                    AND CXC.GLBL_CMPY_CD            = PTT.GLBL_CMPY_CD(+)
                    AND CXC.PRC_SVC_TIER_TP_CD      = PTT.PRC_SVC_TIER_TP_CD(+)
                    AND PTT.EZCANCELFLAG(+)         = '0'
            UNION ALL
            SELECT
                      CD.DS_CONTR_DTL_PK
                    , CBM.DS_CONTR_BLLG_MTR_PK
                    , CBR.CONTR_PHYS_BLLG_MTR_RELN_PK
                    , NULL AS CONTR_XS_COPY_PK
                    , CD.MDL_ID
                    , MN.T_MDL_NM
                    , CD.PRC_CATG_CD
                    , CBM.PRC_LIST_BAND_CD
                    , PLB.PRC_LIST_BAND_DESC_TXT
                    , CBM.PRC_BOOK_MDSE_CD
                    , MLB.MTR_LB_CD AS BLLG_MTR_LB_CD
                    , MLB.MTR_LB_DESC_TXT AS BLLG_MTR_LB_DESC_TXT
                    , CBR.REG_MTR_LB_CD
                    , MLP.MTR_LB_DESC_TXT AS REG_MTR_LB_DESC_TXT
                    , CBR.CONTR_MTR_MULT_RATE
                    , NULL AS XS_MTR_COPY_QTY
                    , NULL AS MAX_COPY_VOL_CNT
                    , NULL AS XS_MTR_AMT_RATE
                    , NULL AS DS_ACCT_NM
                    , NULL AS BILL_TO_CUST_CD
                    , NULL AS BILL_TO_SRCH_TXT
                    , NULL AS BILL_TO_LOC_NUM
                    , CBM.INTG_MDSE_CD
                    , MLP.MTR_LB_SORT_NUM AS REG_MTR_LB_SORT_NUM
                    , NULL AS PRC_SVC_TIER_TP_CD
                    , NULL AS PRC_SVC_TIER_TP_DESC_TXT
                    , NULL AS PRC_SVC_TIER_TP_SORT_NUM
                    , CBR.ACTV_FLG
                    , #flgNmH# AS XX_FLG_NM
                    <!-- 2018/05/09 QC#25030 add start -->
                    , CBM.BLLG_FREE_COPY_CNT
                    , CBM.BLLG_MIN_CNT
                    , CBM.BLLG_MIN_AMT_RATE
                    , CBM.BLLG_ROLL_OVER_RATIO
                   <!-- 2018/05/09 QC#25030 add end -->
                FROM
                      DS_CONTR_DTL              CD
                    , DS_CONTR                  C
                    , DS_CONTR_BLLG_MTR         CBM
                    , CONTR_PHYS_BLLG_MTR_RELN  CBR
                    , MDL_NM                    MN
                    , PRC_LIST_BAND             PLB
                    , MTR_LB                    MLB
                    , MTR_LB                    MLP
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCd#
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = MN.T_GLBL_CMPY_CD(+)
                    AND CD.MDL_ID                   = MN.T_MDL_ID(+)
                    AND MN.EZCANCELFLAG(+)          = '0'
                    --
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG            = '0'
                    --
                    AND CBM.PRC_LIST_BAND_CD        = PLB.PRC_LIST_BAND_CD(+)
                    AND CBM.GLBL_CMPY_CD            = PLB.GLBL_CMPY_CD(+)
                    AND PLB.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = MLB.MTR_LB_CD(+)
                    AND CBM.GLBL_CMPY_CD            = MLB.GLBL_CMPY_CD(+)
                    AND MLB.EZCANCELFLAG(+)         = '0'
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            PRC_MTR_PKG_BLLG_MTR PBM
                        WHERE
                                PBM.GLBL_CMPY_CD    = CD.GLBL_CMPY_CD
                            AND PBM.PRC_MTR_PKG_PK  = CD.PRC_MTR_PKG_PK
                            AND PBM.MTR_LB_CD       = MLB.MTR_LB_CD
                            AND PBM.EZCANCELFLAG    = '0'
                    )
                    --
                    AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
                    AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                    AND CBR.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBR.REG_MTR_LB_CD           = MLP.MTR_LB_CD(+)
                    AND CBR.GLBL_CMPY_CD            = MLP.GLBL_CMPY_CD(+)
                    AND MLP.EZCANCELFLAG(+)         = '0'
            UNION ALL
            SELECT
                      CD.DS_CONTR_DTL_PK
                    , CBM.DS_CONTR_BLLG_MTR_PK
                    , CBR.CONTR_PHYS_BLLG_MTR_RELN_PK
                    , CXC.CONTR_XS_COPY_PK
                    , CD.MDL_ID
                    , NULL AS T_MDL_NM
                    , NULL AS PRC_CATG_CD
                    , NULL AS PRC_LIST_BAND_CD
                    , NULL AS PRC_LIST_BAND_DESC_TXT
                    , NULL AS PRC_BOOK_MDSE_CD
                    , MLB.MTR_LB_CD AS BLLG_MTR_LB_CD
                    , NULL AS BLLG_MTR_LB_DESC_TXT
                    , NULL AS REG_MTR_LB_CD
                    , NULL AS REG_MTR_LB_DESC_TXT
                    , NULL AS CONTR_MTR_MULT_RATE
                    , CXC.XS_MTR_COPY_QTY
                    , CXC.MAX_COPY_VOL_CNT
                    , CXC.XS_MTR_AMT_RATE
                    , NULL AS DS_ACCT_NM
                    , NULL AS SELL_TO_CUST_CD
                    , NULL AS BILL_TO_SRCH_TXT
                    , NULL AS BILL_TO_CUST_CD
                    , NULL AS INTG_MDSE_CD
                    , NULL AS REG_MTR_LB_SORT_NUM
                    , CXC.PRC_SVC_TIER_TP_CD
                    , PTT.PRC_SVC_TIER_TP_DESC_TXT
                    , PTT.PRC_SVC_TIER_TP_SORT_NUM
                    , CBR.ACTV_FLG
                    , #flgNmT# AS XX_FLG_NM
                    <!-- 2018/05/09 QC#25030 add start -->
                    , NULL AS BLLG_FREE_COPY_CNT
                    , NULL AS BLLG_MIN_CNT
                    , NULL AS BLLG_MIN_AMT_RATE
                    , NULL AS BLLG_ROLL_OVER_RATIO
                   <!-- 2018/05/09 QC#25030 add end -->
                FROM
                      DS_CONTR_DTL              CD
                    , DS_CONTR                  C
                    , DS_CONTR_BLLG_MTR         CBM
                    , CONTR_PHYS_BLLG_MTR_RELN  CBR
                    , CONTR_XS_COPY             CXC
                    , PRC_SVC_TIER_TP           PTT
                    , MTR_LB                    MLB
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCd#
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG            = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = MLB.MTR_LB_CD(+)
                    AND CBM.GLBL_CMPY_CD            = MLB.GLBL_CMPY_CD(+)
                    AND MLB.EZCANCELFLAG(+)         = '0'
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            PRC_MTR_PKG_BLLG_MTR PBM
                        WHERE
                                PBM.GLBL_CMPY_CD    = CD.GLBL_CMPY_CD
                            AND PBM.PRC_MTR_PKG_PK  = CD.PRC_MTR_PKG_PK
                            AND PBM.MTR_LB_CD       = MLB.MTR_LB_CD
                            AND PBM.EZCANCELFLAG    = '0'
                    )
                    --
                    AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
                    AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                    AND CBR.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.DS_CONTR_BLLG_MTR_PK    = CXC.DS_CONTR_BLLG_MTR_PK
                    AND CBM.GLBL_CMPY_CD            = CXC.GLBL_CMPY_CD
                    AND CXC.XS_MTR_FIRST_FLG        = #xsMtrFirstFlgN#
                    AND CXC.EZCANCELFLAG            = '0'
                    --
                    AND CXC.GLBL_CMPY_CD            = PTT.GLBL_CMPY_CD(+)
                    AND CXC.PRC_SVC_TIER_TP_CD      = PTT.PRC_SVC_TIER_TP_CD(+)
                    AND PTT.EZCANCELFLAG(+)         = '0'
        ) WK_V
        ORDER BY
              MDL_ID
            , BLLG_MTR_LB_CD
            , INTG_MDSE_CD              NULLS LAST
            , XS_MTR_COPY_QTY           NULLS LAST
            , REG_MTR_LB_SORT_NUM       NULLS FIRST
            , PRC_SVC_TIER_TP_SORT_NUM


    </statement>

    <statement id="getInitDataFromConfigPricingHeader" parameterClass="Map" resultClass="Map">
        SELECT
                  WK_V.DS_CONTR_DTL_PK
                , WK_V.MDL_ID
                , WK_V.T_MDL_NM
                , WK_V.DS_ORD_POSN_NUM
                , WK_V.SVC_PRC_CATG_CD
                , WK_V.PRC_CATG_CD
                , WK_V.PRC_CATG_NM
                , WK_V.PRC_LIST_TP_CD
                , WK_V.PRC_MTR_PKG_PK
                , WK_V.PRC_MTR_PKG_NM
                , WK_V.DS_ACCT_NM
                , WK_V.SELL_TO_CUST_CD
                , WK_V.BILL_TO_SRCH_TXT
                , WK_V.BASE_BILL_TO_CUST_CD
                , CASE
                      WHEN
                          EXISTS
                              (SELECT 1 
                                  FROM    CONTR_XS_COPY            CXC 
                                         ,DS_CONTR_BLLG_MTR        CBM
                                  WHERE   CXC.GLBL_CMPY_CD         = CBM.GLBL_CMPY_CD
                                  AND     CXC.DS_CONTR_BLLG_MTR_PK = CBM.DS_CONTR_BLLG_MTR_PK
                                  <!-- 2018/07/09 S21_NA#26528 Mod Start -->
                                  <!-- AND     CXC.XS_MTR_FIRST_FLG     = #xsMtrFirstFlgN# -->
                                  <!-- 2018/07/09 S21_NA#26528 Mod End -->
                                  AND     CXC.PRC_SVC_TIER_TP_CD   IS NOT NULL
                                  AND     CXC.EZCANCELFLAG         = '0'
                                  AND     CBM.GLBL_CMPY_CD         = WK_V.GLBL_CMPY_CD
                                  AND     CBM.DS_CONTR_DTL_PK      = WK_V.DS_CONTR_DTL_PK
                                  AND     CBM.EZCANCELFLAG         = '0')
                      THEN
                          WK_V.PRC_TIER_SVC_OFFER_CD
                      ELSE
                          NULL
                  END AS PRC_TIER_SVC_OFFER_CD
                <!-- START 2018/03/14 M.Naito [QC#23378,MOD] -->
                <!-- , WK_V.BASE_PRC_DEAL_AMT -->
                , (
                    CASE 
                        WHEN WK_V.RNTL_PRC_AMT IS NOT NULL
                        THEN WK_V.BASE_PRC_DEAL_AMT - WK_V.RNTL_PRC_AMT
                        ELSE WK_V.BASE_PRC_DEAL_AMT
                    END
                  ) AS BASE_PRC_DEAL_AMT
                <!-- END 2018/03/14 M.Naito [QC#23378,MOD] -->
                , (WK_V.TO_PER_MTH_NUM - WK_V.FROM_PER_MTH_NUM + 1) AS TERM_MTH_AOT
                , (
                    CASE 
                        WHEN WK_V.DS_CONTR_STS_CD &lt;&gt; #dsContrStsCd#
                        THEN 'Y'
                        ELSE 'N'
                    END
                  ) AS CONTR_CRAT_FLG
                , (
                    CASE 
                        WHEN WK_V.DS_CONTR_DTL_STS_CD &lt;&gt; #dsContrDtlStsCd#
                        THEN 'N'
                        --
                        WHEN WK_V.ORD_LINE_STS_CD >= #ordLineStsPartiallyShipped#
                        THEN 'N'
                        --
                        WHEN EXISTS (
                            SELECT
                                      1
                                FROM
                                    <!-- START 2018/01/23 M.Naito [QC#19793,MOD] -->
                                    <!--  DS_CPO_CONFIG_V   CV -->
                                      DS_CPO_CONFIG     CV
                                    <!-- END 2018/01/23 M.Naito [QC#19793,MOD] -->
                                    <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                                    <!-- , CPO_DTL_V         DV -->
                                    , CPO_DTL           DV
                                    <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                                    , SHPG_PLN          SP
                                WHERE
                                    CV.GLBL_CMPY_CD             = #glblCmpyCd#
                                    AND CV.CPO_ORD_NUM          = #cpoOrdNum#
                                    AND CV.MDL_ID               = WK_V.MDL_ID
                                    <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                    AND CV.DS_ORD_POSN_NUM      = WK_V.DS_ORD_POSN_NUM
                                    <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                    AND CV.EZCANCELFLAG         = '0'
                                    AND CV.GLBL_CMPY_CD         = DV.GLBL_CMPY_CD
                                    AND CV.DS_CPO_CONFIG_PK     = DV.DS_CPO_CONFIG_PK
                                    AND CV.DS_ORD_POSN_NUM      = DV.DS_ORD_POSN_NUM
                                    AND DV.BASE_CMPT_FLG        = 'Y'
                                    <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                    AND DV.ORD_LINE_STS_CD &lt;&gt; #ordLineStsCancel#
                                    <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                    AND DV.EZCANCELFLAG         = '0'
                                     
                                    AND DV.GLBL_CMPY_CD         = SP.GLBL_CMPY_CD
                                    AND DV.CPO_ORD_NUM          = SP.TRX_HDR_NUM
                                    AND DV.CPO_DTL_LINE_NUM     = SP.TRX_LINE_NUM
                                    AND DV.CPO_DTL_LINE_SUB_NUM = SP.TRX_LINE_SUB_NUM
                                    AND SP.SHPG_STS_CD      &gt;= #shpgStsArrived#
                                    <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                    AND SP.SHPG_STS_CD   &lt;&gt; #shpgStsCancelled#
                                    <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                    AND SP.EZCANCELFLAG         = '0'
                        ) 
                        THEN 'N'
                        --
                        ELSE 'Y'
                    END
                  ) AS SCR_ENT_AVAL_FLG
              <!-- START 2017/09/01 [QC#20820, ADD] -->
                , WK_V.DS_ORD_POSN_NUM_SORT
              <!-- END   2017/09/01 [QC#20820, ADD] -->
        FROM (
            SELECT DISTINCT
                      CD.DS_CONTR_DTL_PK
                    , CD.MDL_ID
                    , MN.T_MDL_NM
                    , DCD.DS_ORD_POSN_NUM
                    , CD.SVC_PRC_CATG_CD
                    , CD.PRC_CATG_CD
                    , PC.PRC_CATG_NM
                    , PC.PRC_LIST_TP_CD
                    , CD.PRC_MTR_PKG_PK
                    , PMP.PRC_MTR_PKG_NM
                    , TSO.PRC_TIER_SVC_OFFER_CD
                    <!-- START 2019/02/26  K.Fujimoto [QC#30525, MOD] -->
                    , CD.BASE_PRC_DEAL_AMT + NVL(CDSUP.BASE_PRC_DEAL_AMT, 0) AS BASE_PRC_DEAL_AMT
                    <!-- END 2019/02/26  K.Fujimoto [QC#30525, MOD] -->
                    , CD.FROM_PER_MTH_NUM 
                    , CD.TO_PER_MTH_NUM
                    , DAC.DS_ACCT_NM
                    , CD.SELL_TO_CUST_CD
                    , (
                        RPAD( 
                            BTC.FIRST_LINE_ADDR
                            , LENGTH(BTC.FIRST_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.SCD_LINE_ADDR
                            , LENGTH(BTC.SCD_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.THIRD_LINE_ADDR
                            , LENGTH(BTC.THIRD_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.FRTH_LINE_ADDR
                            , LENGTH(BTC.FRTH_LINE_ADDR) + 1
                        ) || CONCAT(BTC.CTY_ADDR, ',') || RPAD(BTC.ST_CD, LENGTH(BTC.ST_CD) + 1) || RPAD(BTC.POST_CD, LENGTH(BTC.POST_CD) + 1)
                      ) AS BILL_TO_SRCH_TXT
                    , CD.BASE_BILL_TO_CUST_CD
                    , C.DS_CONTR_STS_CD
                    , CD.DS_CONTR_DTL_STS_CD
                    , DCD.ORD_LINE_STS_CD
                    , C.DS_CONTR_PK
                    , DCD.CPO_ORD_NUM
                    , CD.GLBL_CMPY_CD
                    <!-- START 2017/09/01 [QC#20820, ADD] -->
                    , TO_NUMBER(DCD.DS_ORD_POSN_NUM) AS DS_ORD_POSN_NUM_SORT
                    <!-- END   START 2017/09/01 [QC#20820, ADD] -->
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, MOD] -->
                    <!-- START 2018/03/14 M.Naito [QC#23378,MOD] -->
                    , CASE WHEN
                       EXISTS(
                        SELECT
                             1
                          FROM
                             DS_CONTR_DTL CD2
                         WHERE
                             CD2.GLBL_CMPY_CD               = CD.GLBL_CMPY_CD 
                         AND CD2.EZCANCELFLAG               = '0'
                         AND CD2.DS_CONTR_PK                = CD.DS_CONTR_PK
                         AND CD2.DS_CONTR_DTL_PK     &lt;&gt; CD.DS_CONTR_DTL_PK
                         AND CD2.CPO_ORD_NUM                = CD.CPO_ORD_NUM
                         AND CD2.CPO_DTL_LINE_NUM           = CD.CPO_DTL_LINE_NUM
                         AND CD2.CPO_DTL_LINE_SUB_NUM       = CD.CPO_DTL_LINE_SUB_NUM
                         AND CD2.DS_CONTR_CRAT_TP_CD &lt;&gt; #dsContrCratTpShell#
                         )
                     THEN
                       0
                     ELSE
                       CD.RNTL_PRC_AMT
                     END AS RNTL_PRC_AMT
                    <!-- END 2018/03/14 M.Naito [QC#23378,MOD] -->
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, MOD] -->
                FROM
                      DS_CONTR_DTL          CD
                    <!-- START 2019/02/26  K.Fujimoto [QC#30525, ADD] -->
                    , DS_CONTR_DTL          CDSUP
                    <!-- END   2019/02/26  K.Fujimoto [QC#30525, ADD] -->
                    , DS_CONTR              C
                    <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                    <!-- , CPO_DTL_V             DCD -->
                    , CPO_DTL               DCD
                    <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                    , DS_CPO_CONFIG         DCC
                    , MDL_NM                MN
                    <!-- QC#28398
                    , ALL_MDSE_V            AMV
                     -->
                    , DS_CONTR_BLLG_MTR     CBM
                    , PRC_MTR_PKG           PMP
                    , PRC_CATG              PC
                    , SELL_TO_CUST          DAC
                    , BILL_TO_CUST          BTC
                    , XS_CHRG_TP            XCT
                    , PRC_TIER_SVC_OFFER    TSO
                WHERE
                        CD.GLBL_CMPY_CD                 = #glblCmpyCd#
                    AND CD.DS_CONTR_PK                  = #dsContrPk#
                    AND CD.CPO_ORD_NUM                  = #cpoOrdNum#
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD          = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_DTL_TP_CD IN
                    <iterate property="dsContrDtlTpCdMac" var="dsContrDtlTpCdMac[]" open=" (" close=")" conjunction=",">
                            #dsContrDtlTpCdMac[]#
                    </iterate>
                    AND CD.EZCANCELFLAG                 = '0'
                    --
                    AND CD.GLBL_CMPY_CD                 = C.GLBL_CMPY_CD
                    AND CD.DS_CONTR_PK                  = C.DS_CONTR_PK
                    AND C.EZCANCELFLAG                  = '0'
                    --
                    AND CD.GLBL_CMPY_CD                 = DCD.GLBL_CMPY_CD
                    AND CD.CPO_ORD_NUM                  = DCD.CPO_ORD_NUM
                    AND CD.CPO_DTL_LINE_NUM             = DCD.CPO_DTL_LINE_NUM
                    AND CD.CPO_DTL_LINE_SUB_NUM         = DCD.CPO_DTL_LINE_SUB_NUM
                    <!-- 2019/05/08 QC#50174 Mod Start -->
                    AND DCD.ORD_LINE_STS_CD             &lt;&gt; #ordLineStsCancel#
                    <!-- 2019/05/08 QC#50174 Mod End -->
                    AND DCD.EZCANCELFLAG                = '0'
                    --
                    <!-- START 2019/02/26  K.Fujimoto [QC#30525, ADD] -->
                    AND CD.GLBL_CMPY_CD                 = CDSUP.GLBL_CMPY_CD(+)
                    AND CD.DS_CONTR_PK                  = CDSUP.DS_CONTR_PK(+)
                    AND CD.DS_CONTR_DTL_PK              = CDSUP.PRNT_DS_CONTR_DTL_PK(+)
                    AND CD.SVC_CONFIG_MSTR_PK           = CDSUP.SVC_CONFIG_MSTR_PK(+)
                    AND CDSUP.EZCANCELFLAG(+)           = '0'
                    AND CDSUP.DS_CONTR_CRAT_TP_CD(+)    = #dsContrCratTpSupply#
                    <!-- END   2019/02/26  K.Fujimoto [QC#30525, ADD] -->
                    --
                    AND CD.GLBL_CMPY_CD                 = PMP.GLBL_CMPY_CD(+)
                    AND CD.PRC_MTR_PKG_PK               = PMP.PRC_MTR_PKG_PK(+)
                    AND PMP.EZCANCELFLAG(+)             = '0'
                    --
                    AND CD.GLBL_CMPY_CD                 = CBM.GLBL_CMPY_CD(+)
                    AND CD.DS_CONTR_DTL_PK              = CBM.DS_CONTR_DTL_PK(+)
                    AND CBM.EZCANCELFLAG(+)             = '0'
                    --
                    AND DCD.GLBL_CMPY_CD                = DCC.GLBL_CMPY_CD
                    AND DCD.DS_CPO_CONFIG_PK            = DCC.DS_CPO_CONFIG_PK
                    AND DCC.CONFIG_CATG_CD              = #configCatgOutBound#
                    AND DCC.EZCANCELFLAG                = '0'
                    --
                    AND DCC.GLBL_CMPY_CD                = MN.T_GLBL_CMPY_CD(+)
                    AND DCC.MDL_ID                      = MN.T_MDL_ID(+)
                    AND MN.EZCANCELFLAG(+)              = '0'
                    --
                    <!-- QC#28398
                    AND CD.GLBL_CMPY_CD                 = AMV.GLBL_CMPY_CD(+)
                    AND CD.SVC_PGM_MDSE_CD              = AMV.MDSE_CD(+)
                    AND AMV.EZCANCELFLAG(+)             = '0'
                    -->
                    --
                    AND CD.GLBL_CMPY_CD                 = PC.GLBL_CMPY_CD(+)
                    AND CD.PRC_CATG_CD                  = PC.PRC_CATG_CD(+)
                    AND PC.EZCANCELFLAG(+)              = '0'
                    --
                    AND CD.GLBL_CMPY_CD                 = DAC.GLBL_CMPY_CD(+)
                    AND CD.SELL_TO_CUST_CD              = DAC.SELL_TO_CUST_CD(+)
                    AND DAC.EZCANCELFLAG(+)             = '0'
                    --
                    AND CD.GLBL_CMPY_CD                 = BTC.GLBL_CMPY_CD(+)
                    AND CD.BASE_BILL_TO_CUST_CD         = BTC.BILL_TO_CUST_CD(+)
                    AND BTC.EZCANCELFLAG(+)             = '0'
                    --
                    AND CBM.GLBL_CMPY_CD                = XCT.GLBL_CMPY_CD(+)
                    AND CBM.XS_CHRG_TP_CD               = XCT.XS_CHRG_TP_CD(+)
                    AND XCT.EZCANCELFLAG(+)             = '0'
                    --
                    AND XCT.GLBL_CMPY_CD                = TSO.GLBL_CMPY_CD(+)
                    AND XCT.PRC_TIER_SVC_OFFER_CD       = TSO.PRC_TIER_SVC_OFFER_CD(+)
                    AND TSO.EZCANCELFLAG(+)             = '0'
        ) WK_V
        ORDER BY
            WK_V.MDL_ID
        <!-- START 2017/09/01 [QC#20820, MOD] -->
        <!-- ,WK_V.DS_ORD_POSN_NUM -->   
           ,WK_V.DS_ORD_POSN_NUM_SORT
        <!-- END   2017/09/01 [QC#20820, MOD] -->
    </statement>

    <statement id="getInitDataFromConfigPricingDetail" parameterClass="Map" resultClass="Map">
        SELECT
                  WK_V.DS_CONTR_DTL_PK
                , WK_V.DS_CONTR_BLLG_MTR_PK
                , WK_V.CONTR_PHYS_BLLG_MTR_RELN_PK
                , WK_V.CONTR_XS_COPY_PK
                , WK_V.MDL_ID
                , WK_V.T_MDL_NM
                , WK_V.PRC_CATG_CD
                , WK_V.PRC_LIST_BAND_CD
                , WK_V.PRC_LIST_BAND_DESC_TXT
                , WK_V.PRC_BOOK_MDSE_CD
                , WK_V.BLLG_MTR_LB_CD
                , WK_V.BLLG_MTR_LB_DESC_TXT
                , WK_V.REG_MTR_LB_CD
                , WK_V.REG_MTR_LB_DESC_TXT
                , WK_V.CONTR_MTR_MULT_RATE
                , WK_V.XS_MTR_COPY_QTY
                , WK_V.MAX_COPY_VOL_CNT
                , WK_V.XS_MTR_AMT_RATE
                , WK_V.DS_ACCT_NM
                , WK_V.SELL_TO_CUST_CD
                , WK_V.BILL_TO_SRCH_TXT
                , WK_V.BILL_TO_CUST_CD
                , WK_V.INTG_MDSE_CD
                , WK_V.REG_MTR_LB_SORT_NUM
                , WK_V.PRC_SVC_TIER_TP_CD
                , WK_V.PRC_SVC_TIER_TP_DESC_TXT
                , WK_V.PRC_SVC_TIER_TP_SORT_NUM
                , WK_V.DS_ORD_POSN_NUM
                , WK_V.ACTV_FLG
                , WK_V.XX_FLG_NM
              <!-- START 2017/09/01 [QC#20820, ADD] -->
                , WK_V.DS_ORD_POSN_NUM_SORT
              <!-- END   2017/09/01 [QC#20820, ADD] -->
                <!-- 2018/05/09 QC#25030 add start -->
                , WK_V.BLLG_FREE_COPY_CNT
                , WK_V.BLLG_MIN_CNT
                , WK_V.BLLG_MIN_AMT_RATE
                , WK_V.BLLG_ROLL_OVER_RATIO
                <!-- 2018/05/09 QC#25030 add end -->
        FROM (
            SELECT DISTINCT
                      CD.DS_CONTR_DTL_PK
                    , CBM.DS_CONTR_BLLG_MTR_PK
                    , NULL AS CONTR_PHYS_BLLG_MTR_RELN_PK
                    , CXC.CONTR_XS_COPY_PK
                    , CD.MDL_ID
                    , MN.T_MDL_NM
                    , CD.PRC_CATG_CD
                    , CBM.PRC_LIST_BAND_CD
                    , PLB.PRC_LIST_BAND_DESC_TXT
                    , CBM.PRC_BOOK_MDSE_CD
                    , MLB.MTR_LB_CD AS BLLG_MTR_LB_CD
                    , MLB.MTR_LB_DESC_TXT AS BLLG_MTR_LB_DESC_TXT
                    , NULL AS REG_MTR_LB_CD
                    , NULL AS REG_MTR_LB_DESC_TXT
                    , NULL AS CONTR_MTR_MULT_RATE
                    , CXC.XS_MTR_COPY_QTY
                    , CXC.MAX_COPY_VOL_CNT
                    , CXC.XS_MTR_AMT_RATE
                    , DAC.DS_ACCT_NM
                    , CBM.SELL_TO_CUST_CD
                    , (
                        RPAD( 
                            BTC.FIRST_LINE_ADDR
                            , LENGTH(BTC.FIRST_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.SCD_LINE_ADDR
                            , LENGTH(BTC.SCD_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.THIRD_LINE_ADDR
                            , LENGTH(BTC.THIRD_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.FRTH_LINE_ADDR
                            , LENGTH(BTC.FRTH_LINE_ADDR) + 1
                        ) || CONCAT(BTC.CTY_ADDR, ',') || RPAD(BTC.ST_CD, LENGTH(BTC.ST_CD) + 1) || RPAD(BTC.POST_CD, LENGTH(BTC.POST_CD) + 1)
                      ) AS BILL_TO_SRCH_TXT
                    , CBM.BLLG_MTR_BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                    , CBM.INTG_MDSE_CD
                    , NULL AS REG_MTR_LB_SORT_NUM
                    , CXC.PRC_SVC_TIER_TP_CD
                    , PTT.PRC_SVC_TIER_TP_DESC_TXT
                    , PTT.PRC_SVC_TIER_TP_SORT_NUM
                    , DCD.DS_ORD_POSN_NUM
                    , CBR.ACTV_FLG
                    , #flgNmP# AS XX_FLG_NM
                    <!-- START 2017/09/01 [QC#20820, ADD] -->
                    , TO_NUMBER(DCD.DS_ORD_POSN_NUM) AS DS_ORD_POSN_NUM_SORT
                    <!-- END   START 2017/09/01 [QC#20820, ADD] -->
                    <!-- 2018/05/09 QC#25030 add start -->
                    , CBM.BLLG_FREE_COPY_CNT
                    , CBM.BLLG_MIN_CNT
                    , CBM.BLLG_MIN_AMT_RATE
                    , CBM.BLLG_ROLL_OVER_RATIO
                    <!-- 2018/05/09 QC#25030 add end -->
                FROM
                      DS_CONTR_DTL              CD
                    , DS_CONTR                  C
                    <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                    <!-- , CPO_DTL_V                 DCD -->
                    , CPO_DTL                   DCD
                    <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                    , DS_CONTR_BLLG_MTR         CBM
                    , CONTR_PHYS_BLLG_MTR_RELN  CBR
                    , CONTR_XS_COPY             CXC
                    , MDL_NM                    MN
                    , PRC_LIST_BAND             PLB
                    , MTR_LB                    MLB
                    , SELL_TO_CUST              DAC
                    , BILL_TO_CUST              BTC
                    , PRC_SVC_TIER_TP           PTT
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                    AND CD.DS_CONTR_DTL_TP_CD IN
                    <iterate property="dsContrDtlTpCd" var="dsContrDtlTpCd[]" open=" (" close=")" conjunction=",">
                            #dsContrDtlTpCd[]#
                    </iterate>
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD     = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
                    AND CD.CPO_ORD_NUM              = DCD.CPO_ORD_NUM
                    AND CD.CPO_DTL_LINE_NUM         = DCD.CPO_DTL_LINE_NUM
                    AND CD.CPO_DTL_LINE_SUB_NUM     = DCD.CPO_DTL_LINE_SUB_NUM
                    <!-- 2019/05/08 QC#50174 Mod Start -->
                    AND DCD.ORD_LINE_STS_CD         &lt;&gt; #ordLineStsCancel#
                    <!-- 2019/05/08 QC#50174 Mod End -->
                    AND DCD.EZCANCELFLAG            = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = MN.T_GLBL_CMPY_CD(+)
                    AND CD.MDL_ID                   = MN.T_MDL_ID(+)
                    AND MN.EZCANCELFLAG(+)          = '0'
                    --
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG            = '0'
                    --
                    AND CBM.PRC_LIST_BAND_CD        = PLB.PRC_LIST_BAND_CD(+)
                    AND CBM.GLBL_CMPY_CD            = PLB.GLBL_CMPY_CD(+)
                    AND PLB.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = MLB.MTR_LB_CD(+)
                    AND CBM.GLBL_CMPY_CD            = MLB.GLBL_CMPY_CD(+)
                    AND MLB.EZCANCELFLAG(+)         = '0'
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            PRC_MTR_PKG_BLLG_MTR PBM
                        WHERE
                                PBM.GLBL_CMPY_CD    = CD.GLBL_CMPY_CD
                            AND PBM.PRC_MTR_PKG_PK  = CD.PRC_MTR_PKG_PK
                            AND PBM.MTR_LB_CD       = MLB.MTR_LB_CD
                            AND PBM.EZCANCELFLAG    = '0'
                    )
                    --
                    AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
                    AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                    AND CBR.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.DS_CONTR_BLLG_MTR_PK    = CXC.DS_CONTR_BLLG_MTR_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CXC.GLBL_CMPY_CD(+)
                    AND CXC.XS_MTR_FIRST_FLG        = #xsMtrFirstFlg#
                    AND CXC.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.SELL_TO_CUST_CD         = DAC.SELL_TO_CUST_CD(+)
                    AND CBM.GLBL_CMPY_CD            = DAC.GLBL_CMPY_CD(+)
                    AND DAC.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_BILL_TO_CUST_CD = BTC.BILL_TO_CUST_CD(+)
                    AND CBM.GLBL_CMPY_CD             = BTC.GLBL_CMPY_CD(+)
                    AND BTC.EZCANCELFLAG(+)          = '0'
                    --
                    AND CXC.GLBL_CMPY_CD            = PTT.GLBL_CMPY_CD(+)
                    AND CXC.PRC_SVC_TIER_TP_CD      = PTT.PRC_SVC_TIER_TP_CD(+)
                    AND PTT.EZCANCELFLAG(+)         = '0'
            UNION ALL
            SELECT
                      CD.DS_CONTR_DTL_PK
                    , CBM.DS_CONTR_BLLG_MTR_PK
                    , CBR.CONTR_PHYS_BLLG_MTR_RELN_PK
                    , NULL AS CONTR_XS_COPY_PK
                    , CD.MDL_ID
                    , MN.T_MDL_NM
                    , CD.PRC_CATG_CD
                    , CBM.PRC_LIST_BAND_CD
                    , PLB.PRC_LIST_BAND_DESC_TXT
                    , CBM.PRC_BOOK_MDSE_CD
                    , MLB.MTR_LB_CD AS BLLG_MTR_LB_CD
                    , MLB.MTR_LB_DESC_TXT AS BLLG_MTR_LB_DESC_TXT
                    , CBR.REG_MTR_LB_CD
                    , MLP.MTR_LB_DESC_TXT AS REG_MTR_LB_DESC_TXT
                    , CBR.CONTR_MTR_MULT_RATE
                    , NULL AS XS_MTR_COPY_QTY
                    , NULL AS MAX_COPY_VOL_CNT
                    , NULL AS XS_MTR_AMT_RATE
                    , NULL AS DS_ACCT_NM
                    , NULL AS SELL_TO_CUST_CD
                    , NULL AS BILL_TO_SRCH_TXT
                    , NULL AS BILL_TO_CUST_CD
                    , CBM.INTG_MDSE_CD
                    , MLP.MTR_LB_SORT_NUM AS REG_MTR_LB_SORT_NUM
                    , NULL AS PRC_SVC_TIER_TP_CD
                    , NULL AS PRC_SVC_TIER_TP_DESC_TXT
                    , NULL AS PRC_SVC_TIER_TP_SORT_NUM
                    , DCD.DS_ORD_POSN_NUM
                    , CBR.ACTV_FLG
                    , #flgNmH# AS XX_FLG_NM
                    <!-- START 2017/09/01 [QC#20820, ADD] -->
                    , TO_NUMBER(DCD.DS_ORD_POSN_NUM) AS DS_ORD_POSN_NUM_SORT
                    <!-- END   START 2017/09/01 [QC#20820, ADD] -->
                    <!-- 2018/05/09 QC#25030 add start -->
                    , CBM.BLLG_FREE_COPY_CNT
                    , CBM.BLLG_MIN_CNT
                    , CBM.BLLG_MIN_AMT_RATE
                    , CBM.BLLG_ROLL_OVER_RATIO
                    <!-- 2018/05/09 QC#25030 add end -->
               FROM
                      DS_CONTR_DTL              CD
                    , DS_CONTR                  C
                    <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                    <!-- , CPO_DTL_V                 DCD -->
                    , CPO_DTL                   DCD
                    <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                    , DS_CONTR_BLLG_MTR         CBM
                    , CONTR_PHYS_BLLG_MTR_RELN  CBR
                    , MDL_NM                    MN
                    , PRC_LIST_BAND             PLB
                    , MTR_LB                    MLB
                    , MTR_LB                    MLP
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                    AND CD.DS_CONTR_DTL_TP_CD IN
                    <iterate property="dsContrDtlTpCd" var="dsContrDtlTpCd[]" open=" (" close=")" conjunction=",">
                            #dsContrDtlTpCd[]#
                    </iterate>
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD   = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
                    AND CD.CPO_ORD_NUM              = DCD.CPO_ORD_NUM
                    AND CD.CPO_DTL_LINE_NUM         = DCD.CPO_DTL_LINE_NUM
                    AND CD.CPO_DTL_LINE_SUB_NUM     = DCD.CPO_DTL_LINE_SUB_NUM
                    AND DCD.EZCANCELFLAG            = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = MN.T_GLBL_CMPY_CD(+)
                    AND CD.MDL_ID                   = MN.T_MDL_ID(+)
                    AND MN.EZCANCELFLAG(+)          = '0'
                    --
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG            = '0'
                    --
                    AND CBM.PRC_LIST_BAND_CD        = PLB.PRC_LIST_BAND_CD(+)
                    AND CBM.GLBL_CMPY_CD            = PLB.GLBL_CMPY_CD(+)
                    AND PLB.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = MLB.MTR_LB_CD(+)
                    AND CBM.GLBL_CMPY_CD            = MLB.GLBL_CMPY_CD(+)
                    AND MLB.EZCANCELFLAG(+)         = '0'
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            PRC_MTR_PKG_BLLG_MTR PBM
                        WHERE
                                PBM.GLBL_CMPY_CD    = CD.GLBL_CMPY_CD
                            AND PBM.PRC_MTR_PKG_PK  = CD.PRC_MTR_PKG_PK
                            AND PBM.MTR_LB_CD       = MLB.MTR_LB_CD
                            AND PBM.EZCANCELFLAG    = '0'
                    )
                    --
                    AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
                    AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                    AND CBR.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBR.REG_MTR_LB_CD           = MLP.MTR_LB_CD(+)
                    AND CBR.GLBL_CMPY_CD            = MLP.GLBL_CMPY_CD(+)
                    AND MLP.EZCANCELFLAG(+)         = '0'
            UNION ALL
            SELECT
                      CD.DS_CONTR_DTL_PK
                    , CBM.DS_CONTR_BLLG_MTR_PK
                    , CBR.CONTR_PHYS_BLLG_MTR_RELN_PK
                    , CXC.CONTR_XS_COPY_PK
                    , CD.MDL_ID
                    , NULL AS T_MDL_NM
                    , NULL AS PRC_CATG_CD
                    , NULL AS PRC_LIST_BAND_CD
                    , NULL AS PRC_LIST_BAND_DESC_TXT
                    , NULL AS PRC_BOOK_MDSE_CD
                    , MLB.MTR_LB_CD AS BLLG_MTR_LB_CD
                    , NULL AS BLLG_MTR_LB_DESC_TXT
                    , NULL AS REG_MTR_LB_CD
                    , NULL AS REG_MTR_LB_DESC_TXT
                    , NULL AS CONTR_MTR_MULT_RATE
                    , CXC.XS_MTR_COPY_QTY
                    , CXC.MAX_COPY_VOL_CNT
                    , CXC.XS_MTR_AMT_RATE
                    , NULL AS DS_ACCT_NM
                    , NULL AS SELL_TO_CUST_CD
                    , NULL AS BILL_TO_SRCH_TXT
                    , NULL AS BILL_TO_CUST_CD
                    , NULL AS INTG_MDSE_CD
                    , NULL AS REG_MTR_LB_SORT_NUM
                    , CXC.PRC_SVC_TIER_TP_CD
                    , PTT.PRC_SVC_TIER_TP_DESC_TXT
                    , PTT.PRC_SVC_TIER_TP_SORT_NUM
                    , DCD.DS_ORD_POSN_NUM
                    , CBR.ACTV_FLG
                    , #flgNmT# AS XX_FLG_NM
                    <!-- START 2017/09/01 [QC#20820, ADD] -->
                    , TO_NUMBER(DCD.DS_ORD_POSN_NUM) AS DS_ORD_POSN_NUM_SORT
                    <!-- END   START 2017/09/01 [QC#20820, ADD] -->
                    <!-- 2018/05/09 QC#25030 add start -->
                    , NULL AS BLLG_FREE_COPY_CNT
                    , NULL AS BLLG_MIN_CNT
                    , NULL AS BLLG_MIN_AMT_RATE
                    , NULL AS BLLG_ROLL_OVER_RATIO
                    <!-- 2018/05/09 QC#25030 add end -->
                FROM
                      DS_CONTR_DTL              CD
                    , DS_CONTR                  C
                    <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                    <!-- , CPO_DTL_V                 DCD -->
                    , CPO_DTL                   DCD
                    <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                    , DS_CONTR_BLLG_MTR         CBM
                    , CONTR_PHYS_BLLG_MTR_RELN  CBR
                    , CONTR_XS_COPY             CXC
                    , PRC_SVC_TIER_TP           PTT
                    , MTR_LB                    MLB
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                    AND CD.DS_CONTR_DTL_TP_CD IN
                    <iterate property="dsContrDtlTpCd" var="dsContrDtlTpCd[]" open=" (" close=")" conjunction=",">
                            #dsContrDtlTpCd[]#
                    </iterate>
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD     = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
                    AND CD.CPO_ORD_NUM              = DCD.CPO_ORD_NUM
                    AND CD.CPO_DTL_LINE_NUM         = DCD.CPO_DTL_LINE_NUM
                    AND CD.CPO_DTL_LINE_SUB_NUM     = DCD.CPO_DTL_LINE_SUB_NUM
                    AND DCD.EZCANCELFLAG            = '0'
                    --
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG            = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = MLB.MTR_LB_CD(+)
                    AND CBM.GLBL_CMPY_CD            = MLB.GLBL_CMPY_CD(+)
                    AND MLB.EZCANCELFLAG(+)         = '0'
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            PRC_MTR_PKG_BLLG_MTR PBM
                        WHERE
                                PBM.GLBL_CMPY_CD    = CD.GLBL_CMPY_CD
                            AND PBM.PRC_MTR_PKG_PK  = CD.PRC_MTR_PKG_PK
                            AND PBM.MTR_LB_CD       = MLB.MTR_LB_CD
                            AND PBM.EZCANCELFLAG    = '0'
                    )
                    --
                    AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
                    AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                    AND CBR.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.DS_CONTR_BLLG_MTR_PK    = CXC.DS_CONTR_BLLG_MTR_PK
                    AND CBM.GLBL_CMPY_CD            = CXC.GLBL_CMPY_CD
                    AND CXC.XS_MTR_FIRST_FLG        = #xsMtrFirstFlgN#
                    AND CXC.EZCANCELFLAG            = '0'
                    --
                    AND CXC.GLBL_CMPY_CD            = PTT.GLBL_CMPY_CD(+)
                    AND CXC.PRC_SVC_TIER_TP_CD      = PTT.PRC_SVC_TIER_TP_CD(+)
                    AND PTT.EZCANCELFLAG(+)         = '0'
        ) WK_V
        ORDER BY
              MDL_ID
        <!-- START 2017/09/01 [QC#20820, MOD] -->
        <!--, DS_ORD_POSN_NUM                 -->
            , DS_ORD_POSN_NUM_SORT
        <!-- END   2017/09/01 [QC#20820, MOD] -->
            , BLLG_MTR_LB_CD
            , INTG_MDSE_CD              NULLS LAST
            , XS_MTR_COPY_QTY           NULLS LAST
            , REG_MTR_LB_SORT_NUM       NULLS FIRST
            , PRC_SVC_TIER_TP_SORT_NUM
    </statement>

    <statement id="getInitDataFromAccCharge" parameterClass="Map" resultClass="Map">
        SELECT
                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                <!--   DCD.DPLY_LINE_NUM -->
                  CONCAT (DCD.DS_ORD_POSN_NUM, '.')
                     || CONCAT (DCD.DS_CPO_LINE_NUM, DECODE (DCD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
                     || DCD.DS_CPO_LINE_SUB_NUM AS DPLY_LINE_NUM
                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                , DCD.MDSE_CD
                , AMV.MDSE_DESC_SHORT_TXT
                <isEqual property="isFleet" compareValue="Y">
                , NULL AS BASE_PRC_DEAL_AMT
                </isEqual>
                <isNotEqual property="isFleet" compareValue="Y">
                <!-- START 2018/03/14 M.Naito [QC#23378,MOD] -->
                <!-- START 2019/01/18  K.Fujimoto [QC#29782, MOD] -->
                ,CASE WHEN
                    EXISTS(SELECT 
                               1
                             FROM 
                              DS_CONTR_DTL CD2
                            WHERE CD2.DS_CONTR_PK            = CD.DS_CONTR_PK
                              AND CD2.DS_CONTR_DTL_PK &lt;&gt; CD.DS_CONTR_DTL_PK
                              AND CD2.GLBL_CMPY_CD           = CD.GLBL_CMPY_CD
                              AND CD2.EZCANCELFLAG           = '0'
                              AND CD2.CPO_ORD_NUM            = CD.CPO_ORD_NUM
                              AND CD2.CPO_DTL_LINE_NUM       = CD.CPO_DTL_LINE_NUM
                              AND CD2.CPO_DTL_LINE_SUB_NUM   = CD.CPO_DTL_LINE_SUB_NUM
                              AND CD2.DS_CONTR_CRAT_TP_CD    = #dsContrCratTpOther#)
                    OR CD.DS_CONTR_CRAT_TP_CD = #dsContrCratTpSupply#
                  THEN
                    CD.BASE_PRC_DEAL_AMT
                  ELSE
                    CD.BASE_PRC_DEAL_AMT - NVL(CD.RNTL_PRC_AMT, 0) 
                  END AS BASE_PRC_DEAL_AMT
                <!-- END 2019/01/18  K.Fujimoto [QC#29782, MOD] -->
                <!-- END 2018/03/14 M.Naito [QC#23378,MOD] -->
                </isNotEqual>
                , CD.DEAL_PRC_LIST_PRC_AMT
                , CD.PRC_CATG_CD
                , PC.PRC_CATG_NM
                , DCD.CPO_DTL_LINE_NUM
                , DCD.CPO_DTL_LINE_SUB_NUM
                , CD.SVC_PRC_CATG_CD
                , CD.BILL_WITH_EQUIP_INVD_FLG
                , CD.PRC_LIST_EQUIP_CONFIG_NUM
                , CD.CR_REBIL_CD
                , (
                    CASE 
                        WHEN CD.DS_CONTR_DTL_STS_CD &lt;&gt; #dsContrDtlStsCd#
                        THEN 'N'
                        --
                        WHEN DCD.ORD_LINE_STS_CD &gt;= #ordLineStsPartiallyShipped#
                        THEN 'N'
                        --
                        WHEN EXISTS (
                            SELECT
                                      1
                            FROM
                                <!-- START 2018/01/23 M.Naito [QC#19793,MOD] -->
                                <!--  DS_CPO_CONFIG_V   CV -->
                                  DS_CPO_CONFIG     CV
                                <!-- END 2018/01/23 M.Naito [QC#19793,MOD] -->
                                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                                <!-- , CPO_DTL_V         DV -->
                                , CPO_DTL           DV
                                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                                , SHPG_PLN          SP
                            WHERE
                                    CV.GLBL_CMPY_CD         = #glblCmpyCd#
                                AND CV.CPO_ORD_NUM          = #cpoOrdNum#
                                AND CV.EZCANCELFLAG         = '0'
                                AND CV.GLBL_CMPY_CD         = DV.GLBL_CMPY_CD
                                AND CV.DS_CPO_CONFIG_PK     = DV.DS_CPO_CONFIG_PK
                                AND CV.DS_ORD_POSN_NUM      = DV.DS_ORD_POSN_NUM
                                AND DV.BASE_CMPT_FLG        = 'Y'
                                <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND DV.ORD_LINE_STS_CD &lt;&gt; #ordLineStsCancelled#
                                <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND DV.EZCANCELFLAG         = '0'
                                AND DV.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                                AND DV.CPO_ORD_NUM          = CD.CPO_ORD_NUM
                                AND DV.CPO_DTL_LINE_NUM     = CD.CPO_DTL_LINE_NUM
                                AND DV.CPO_DTL_LINE_SUB_NUM = CD.CPO_DTL_LINE_SUB_NUM
                                AND DV.CPO_ORD_NUM          = SP.TRX_HDR_NUM
                                AND DV.CPO_DTL_LINE_NUM     = SP.TRX_LINE_NUM
                                AND DV.CPO_DTL_LINE_SUB_NUM = SP.TRX_LINE_SUB_NUM
                                AND SP.SHPG_STS_CD      &gt;= #shpgStsArrived#
                                <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND SP.SHPG_STS_CD   &lt;&gt; #shpgStsCancelled#
                                <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND SP.EZCANCELFLAG         = '0'
                    <!-- Start 2019/02/25 K.Fujimoto [QC#30458, ADD] -->
                    )     OR EXISTS (
                            <!-- Parent -->
                            SELECT
                                        1
                            FROM
                                 DS_CPO_CONFIG     CV
                               , DS_CONTR_DTL      DCD
                               , CPO_DTL           DV
                               , SHPG_PLN          SP
                            WHERE
                                    CV.GLBL_CMPY_CD          = #glblCmpyCd#
                                AND CV.CPO_ORD_NUM           = #cpoOrdNum#
                                AND CV.EZCANCELFLAG          = '0'
                                AND CV.GLBL_CMPY_CD          = DV.GLBL_CMPY_CD
                                AND CV.DS_CPO_CONFIG_PK      = DV.DS_CPO_CONFIG_PK
                                AND CV.DS_ORD_POSN_NUM       = DV.DS_ORD_POSN_NUM
                                <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND DV.ORD_LINE_STS_CD &lt;&gt; #ordLineStsCancelled#
                                <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND DV.CPO_ORD_NUM           = DCD.CPO_ORD_NUM
                                AND DV.CPO_DTL_LINE_NUM      = DCD.CPO_DTL_LINE_NUM
                                AND DV.CPO_DTL_LINE_SUB_NUM  = DCD.CPO_DTL_LINE_SUB_NUM
                                AND DCD.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                                AND DCD.DS_CONTR_DTL_PK      = CD.PRNT_DS_CONTR_DTL_PK
                                AND DV.CPO_ORD_NUM           = SP.TRX_HDR_NUM
                                AND DV.CPO_DTL_LINE_NUM      = SP.TRX_LINE_NUM
                                AND DV.CPO_DTL_LINE_SUB_NUM  = SP.TRX_LINE_SUB_NUM
                                AND SP.SHPG_STS_CD       &gt;= #shpgStsArrived#
                                <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND SP.SHPG_STS_CD    &lt;&gt; #shpgStsCancelled#
                                <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND SP.EZCANCELFLAG          = '0'
                                AND DCD.EZCANCELFLAG         = '0'
                                AND DV.EZCANCELFLAG          = '0'
                    )
                    <!-- End   2019/02/25 K.Fujimoto [QC#30458, ADD] -->
                    THEN 'N'
                    --
                    ELSE 'Y'
                    END
                  ) AS SCR_ENT_AVAL_FLG
                , CD.SHELL_LINE_NUM
                , CD.DS_CONTR_DTL_PK
            FROM
                  DS_CONTR_DTL          CD
                , DS_CONTR              C
                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                <!-- , CPO_DTL_V             DCD -->
                , CPO_DTL               DCD
                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                , ALL_MDSE_V            AMV
                , PRC_CATG              PC
            WHERE
                    CD.GLBL_CMPY_CD             = #glblCmpyCd#
                AND CD.DS_CONTR_PK              = #dsContrPk#
                AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                AND CD.DS_CONTR_DTL_TP_CD IN
                <iterate property="dsContrDtlTpCd" var="dsContrDtlTpCd[]" open=" (" close=")" conjunction=",">
                        #dsContrDtlTpCd[]#
                </iterate>
                <!-- START 2019/02/26  K.Fujimoto [QC#30525, MOD] -->
                <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                <!-- AND CD.DS_CONTR_CRAT_TP_CD      IN (#dsContrCratTpShell#, #dsContrCratTpSupply#) -->
                AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                <!-- END   2019/02/26  K.Fujimoto [QC#30525, MOD] -->
                AND CD.EZCANCELFLAG             = '0'
                --
                AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                AND C.EZCANCELFLAG              = '0'
                --
                AND CD.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
                AND CD.CPO_ORD_NUM              = DCD.CPO_ORD_NUM
                AND CD.CPO_DTL_LINE_NUM         = DCD.CPO_DTL_LINE_NUM
                AND CD.CPO_DTL_LINE_SUB_NUM     = DCD.CPO_DTL_LINE_SUB_NUM
                <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                AND DCD.ORD_LINE_STS_CD  &lt;&gt; #ordLineStsCancelled#
                <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                AND DCD.EZCANCELFLAG            = '0'
                --
                AND DCD.GLBL_CMPY_CD            = AMV.GLBL_CMPY_CD(+) <!-- QC#28398 -->
                AND DCD.MDSE_CD                 = AMV.MDSE_CD(+)      <!-- QC#28398 -->
                AND AMV.EZCANCELFLAG(+)         = '0'
                --
                AND CD.GLBL_CMPY_CD             = PC.GLBL_CMPY_CD(+)
                AND CD.PRC_CATG_CD              = PC.PRC_CATG_CD(+)
                AND PC.EZCANCELFLAG(+)          = '0'
            ORDER BY
                  CD.SHELL_LINE_NUM
            <!-- START 2017/09/01 [QC#20820, MOD] -->
            <!--, DCD.DS_ORD_POSN_NUM             -->
                , TO_NUMBER(DCD.DS_ORD_POSN_NUM)
            <!-- END   2017/09/01 [QC#20820, MOD] -->
                , DCD.DS_CPO_LINE_NUM
                , DCD.DS_CPO_LINE_SUB_NUM
    </statement>

    <statement id="getInitDataFromRentalEqChargeBaseAcc" parameterClass="Map" resultClass="Map">
        SELECT
                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                <!--   DCD.DPLY_LINE_NUM -->
                  CONCAT (DCD.DS_ORD_POSN_NUM, '.')
                     || CONCAT (DCD.DS_CPO_LINE_NUM, DECODE (DCD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
                     || DCD.DS_CPO_LINE_SUB_NUM AS DPLY_LINE_NUM
                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                , DCD.MDSE_CD
                , AMV.MDSE_DESC_SHORT_TXT
                <!-- START 2018/03/14 M.Naito [QC#23378,MOD] -->
                , CD.RNTL_PRC_AMT    AS ADDL_CHRG_FLAT_DEAL_PRC_AMT
                , NULL               AS DEAL_PRC_LIST_PRC_AMT
                <!-- END 2018/03/14 M.Naito [QC#23378,MOD] -->
                , CD.PRC_CATG_CD
                , PC.PRC_CATG_NM
                <!-- START 2018/03/14 M.Naito [QC#23378,MOD] -->
                , NULL               AS PRC_LIST_EQUIP_CONFIG_NUM
                <!-- END 2018/03/14 M.Naito [QC#23378,MOD] -->
                , PLE.PRC_LIST_EQUIP_CONFIG_NM
                , DCD.CPO_DTL_LINE_NUM
                , DCD.CPO_DTL_LINE_SUB_NUM
                <!-- START 2018/03/14 M.Naito [QC#23378,MOD] -->
                , CD.RNTL_PRC_CATG_CD AS PRC_CATG_CD
                , NULL               AS DEAL_PRC_LIST_PRC_AMT
                , NULL               AS SVC_PRC_CATG_CD
                , NULL               AS BILL_WITH_EQUIP_INVD_FLG
                , NULL               AS CR_REBIL_CD
                <!-- END 2018/03/14 M.Naito [QC#23378,MOD] -->
                , (
                    CASE 
                        WHEN CD.DS_CONTR_DTL_STS_CD &lt;&gt; #dsContrDtlStsCd#
                        THEN 'N'
                        --
                        WHEN DCD.ORD_LINE_STS_CD &gt;= #ordLineStsPartiallyShipped#
                        THEN 'N'
                        --
                        WHEN EXISTS (
                            SELECT
                                      1
                            FROM
                                <!-- START 2018/01/23 M.Naito [QC#19793,MOD] -->
                                <!--  DS_CPO_CONFIG_V   CV -->
                                  DS_CPO_CONFIG     CV
                                <!-- END 2018/01/23 M.Naito [QC#19793,MOD] -->
                                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                                <!-- , CPO_DTL_V         DV -->
                                , CPO_DTL           DV
                                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                                , SHPG_PLN          SP
                            WHERE
                                    CV.GLBL_CMPY_CD         = #glblCmpyCd#
                                AND CV.CPO_ORD_NUM          = #cpoOrdNum#
                                AND CV.EZCANCELFLAG         = '0'
                                AND CV.GLBL_CMPY_CD         = DV.GLBL_CMPY_CD
                                AND CV.DS_CPO_CONFIG_PK     = DV.DS_CPO_CONFIG_PK
                                AND CV.DS_ORD_POSN_NUM      = DV.DS_ORD_POSN_NUM
                                AND DV.BASE_CMPT_FLG        = 'Y'
                                <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND DV.ORD_LINE_STS_CD &lt;&gt; #ordLineStsCancelled#
                                <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND DV.EZCANCELFLAG         = '0'
                                AND DV.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                                AND DV.CPO_ORD_NUM          = CD.CPO_ORD_NUM
                                AND DV.CPO_DTL_LINE_NUM     = CD.CPO_DTL_LINE_NUM
                                AND DV.CPO_DTL_LINE_SUB_NUM = CD.CPO_DTL_LINE_SUB_NUM
                                AND DV.CPO_ORD_NUM          = SP.TRX_HDR_NUM
                                AND DV.CPO_DTL_LINE_NUM     = SP.TRX_LINE_NUM
                                AND DV.CPO_DTL_LINE_SUB_NUM = SP.TRX_LINE_SUB_NUM
                                AND SP.SHPG_STS_CD      &gt;= #shpgStsArrived#
                                <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND SP.SHPG_STS_CD   &lt;&gt; #shpgStsCancelled#
                                <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND SP.EZCANCELFLAG         = '0'
                    ) 
                    <!-- Start 2019/03/04 K.Fujimoto [QC#30574, ADD] -->
                         OR EXISTS (
                            <!-- Parent -->
                            SELECT
                                        1
                            FROM
                                 DS_CPO_CONFIG     CV
                               , DS_CONTR_DTL      DCD
                               , CPO_DTL           DV
                               , SHPG_PLN          SP
                            WHERE
                                    CV.GLBL_CMPY_CD          = #glblCmpyCd#
                                AND CV.CPO_ORD_NUM           = #cpoOrdNum#
                                AND CV.EZCANCELFLAG          = '0'
                                AND CV.GLBL_CMPY_CD          = DV.GLBL_CMPY_CD
                                AND CV.DS_CPO_CONFIG_PK      = DV.DS_CPO_CONFIG_PK
                                AND CV.DS_ORD_POSN_NUM       = DV.DS_ORD_POSN_NUM
                                <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND DV.ORD_LINE_STS_CD &lt;&gt; #ordLineStsCancelled#
                                <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND DV.CPO_ORD_NUM           = DCD.CPO_ORD_NUM
                                AND DV.CPO_DTL_LINE_NUM      = DCD.CPO_DTL_LINE_NUM
                                AND DV.CPO_DTL_LINE_SUB_NUM  = DCD.CPO_DTL_LINE_SUB_NUM
                                AND DCD.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                                AND DCD.DS_CONTR_DTL_PK      = CD.PRNT_DS_CONTR_DTL_PK
                                AND DV.CPO_ORD_NUM           = SP.TRX_HDR_NUM
                                AND DV.CPO_DTL_LINE_NUM      = SP.TRX_LINE_NUM
                                AND DV.CPO_DTL_LINE_SUB_NUM  = SP.TRX_LINE_SUB_NUM
                                AND SP.SHPG_STS_CD       &gt;= #shpgStsArrived#
                                <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND SP.SHPG_STS_CD    &lt;&gt; #shpgStsCancelled#
                                <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND SP.EZCANCELFLAG          = '0'
                                AND DCD.EZCANCELFLAG         = '0'
                                AND DV.EZCANCELFLAG          = '0'
                    )
                    <!-- End   2019/03/04 K.Fujimoto [QC#30574, ADD] -->
                    THEN 'N'
                    --
                    ELSE 'Y'
                    END
                  ) AS SCR_ENT_AVAL_FLG
                , CD.SHELL_LINE_NUM
                <!-- START 2018/03/14 M.Naito [QC#23378,MOD] -->
                , CD.DS_CONTR_DTL_PK
                , NULL               AS DS_CONTR_ADDL_CHRG_PK
                <!-- END 2018/03/14 M.Naito [QC#23378,MOD] -->
            FROM
                  DS_CONTR_DTL          CD
                , DS_CONTR              C
                <!-- START 2018/03/14 M.Naito [QC#23378,MOD] -->
                <!-- , DS_CONTR_ADDL_CHRG    CAC -->
                <!-- END 2018/03/14 M.Naito [QC#23378,MOD] -->
                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                <!-- , CPO_DTL_V             DCD -->
                , CPO_DTL               DCD
                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                , ALL_MDSE_V            AMV
                , PRC_CATG              PC
                , PRC_LIST_EQUIP        PLE
            WHERE
                    CD.GLBL_CMPY_CD             = #glblCmpyCd#
                AND CD.DS_CONTR_PK              = #dsContrPk#
                AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                <!-- START 2018/12/13 W.Honda [QC#29423,ADD] -->
                AND CD.RNTL_PRC_AMT             IS NOT NULL
                <!-- END 2018/12/13 W.Honda [QC#29423,ADD] -->
                <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                AND CD.EZCANCELFLAG             = '0'
                --
                AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                AND C.EZCANCELFLAG              = '0'
                --
                <!-- START 2018/03/14 M.Naito [QC#23378,MOD] -->
                <!-- AND CD.GLBL_CMPY_CD             = CAC.GLBL_CMPY_CD -->
                <!-- AND CD.DS_CONTR_PK              = CAC.DS_CONTR_PK -->
                <!-- AND CD.DS_CONTR_DTL_PK          = CAC.DS_CONTR_DTL_PK -->
                <!-- AND C.EZCANCELFLAG              = '0' -->
                --
                <!-- END 2018/03/14 M.Naito [QC#23378,MOD] -->
                AND CD.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
                AND CD.CPO_ORD_NUM              = DCD.CPO_ORD_NUM
                AND CD.CPO_DTL_LINE_NUM         = DCD.CPO_DTL_LINE_NUM
                AND CD.CPO_DTL_LINE_SUB_NUM     = DCD.CPO_DTL_LINE_SUB_NUM
                <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                AND DCD.ORD_LINE_STS_CD  &lt;&gt; #ordLineStsCancelled#
                <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                AND DCD.EZCANCELFLAG            = '0'
                --
                <!-- START 2018/03/14 M.Naito [QC#23378,MOD] -->
                <!-- AND CD.GLBL_CMPY_CD             = CAC.GLBL_CMPY_CD -->
                <!-- AND CD.DS_CONTR_PK              = CAC.DS_CONTR_PK -->
                <!-- AND CD.DS_CONTR_DTL_PK          = CAC.DS_CONTR_DTL_PK -->
                <!-- AND CAC.ADDL_CHRG_CATG_CD       = #addlChrgCatgCd# -->
                <!-- AND CAC.EZCANCELFLAG            = '0' -->
                --
                <!-- END 2018/03/14 M.Naito [QC#23378,MOD] -->
                AND DCD.GLBL_CMPY_CD            = AMV.GLBL_CMPY_CD(+)
                AND DCD.MDSE_CD                 = AMV.MDSE_CD(+)
                AND AMV.EZCANCELFLAG(+)         = '0'
                --
                AND CD.GLBL_CMPY_CD             = PC.GLBL_CMPY_CD(+)
                AND CD.PRC_CATG_CD              = PC.PRC_CATG_CD(+)
                AND PC.EZCANCELFLAG(+)          = '0'
                --
                AND CD.GLBL_CMPY_CD              = PLE.GLBL_CMPY_CD(+)
                AND CD.PRC_LIST_EQUIP_CONFIG_NUM = PLE.PRC_LIST_EQUIP_CONFIG_NUM(+)
                AND PLE.EZCANCELFLAG(+)          = '0'
            ORDER BY
            <!-- START 2017/09/01 [QC#20820, MOD] -->
            <!-- DCD.DS_ORD_POSN_NUM              -->
                  TO_NUMBER(DCD.DS_ORD_POSN_NUM)
            <!-- END   2017/09/01 [QC#20820, MOD] -->
                , DCD.DS_CPO_LINE_NUM
                , DCD.DS_CPO_LINE_SUB_NUM
    </statement>

    <statement id="getInitDataFromAddlSvcCharge" parameterClass="Map" resultClass="Map">
        SELECT
                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                <!--   DCD.DPLY_LINE_NUM -->
                  CONCAT (DCD.DS_ORD_POSN_NUM, '.')
                     || CONCAT (DCD.DS_CPO_LINE_NUM, DECODE (DCD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
                     || DCD.DS_CPO_LINE_SUB_NUM AS DPLY_LINE_NUM
                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                , CAC.ADDL_CHRG_CATG_CD
                , CAC.ADDL_CHRG_TP_CD
                , CAC.ADDL_CHRG_TP_CD       AS MDSE_CD_CI
                , AMVI.MDSE_DESC_SHORT_TXT  AS MDSE_DESC_SHORT_TXT_CI
                , DCD.MDSE_CD               AS MDSE_CD_CU
                , AMVU.MDSE_DESC_SHORT_TXT  AS MDSE_DESC_SHORT_TXT_CU
                , CAC.ADDL_CHRG_FLAT_DEAL_PRC_AMT
                , CAC.ADDL_CHRG_FLAT_FUNC_PRC_AMT
                , CAC.DEAL_PRC_LIST_PRC_AMT
                , DCD.CPO_DTL_LINE_NUM
                , DCD.CPO_DTL_LINE_SUB_NUM
                , CAC.PRC_CATG_CD
                , CAC.DEAL_PRC_LIST_PRC_AMT
                , CAC.SVC_PRC_CATG_CD
                , CAC.BILL_WITH_EQUIP_INVD_FLG
                , CAC.CR_REBIL_CD
                , CAC.PRINT_DTL_FLG
                , (
                    CASE 
                        WHEN CD.DS_CONTR_DTL_STS_CD &lt;&gt; #dsContrDtlStsCd#
                        THEN 'N'
                        --
                        WHEN DCD.ORD_LINE_STS_CD &gt;= #ordLineStsPartiallyShipped#
                        THEN 'N'
                        --
                        WHEN EXISTS (
                            SELECT
                                      1
                            FROM
                                <!-- START 2018/01/23 M.Naito [QC#19793,MOD] -->
                                <!--  DS_CPO_CONFIG_V   CV -->
                                  DS_CPO_CONFIG     CV
                                <!-- END 2018/01/23 M.Naito [QC#19793,MOD] -->
                                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                                <!-- , CPO_DTL_V         DV -->
                                , CPO_DTL           DV
                                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                                , SHPG_PLN          SP
                            WHERE
                                    CV.GLBL_CMPY_CD         = #glblCmpyCd#
                                AND CV.CPO_ORD_NUM          = #cpoOrdNum#
                                AND CV.EZCANCELFLAG         = '0'
                                AND CV.GLBL_CMPY_CD         = DV.GLBL_CMPY_CD
                                AND CV.DS_CPO_CONFIG_PK     = DV.DS_CPO_CONFIG_PK
                                AND CV.DS_ORD_POSN_NUM      = DV.DS_ORD_POSN_NUM
                                AND DV.BASE_CMPT_FLG        = 'Y'
                                <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND DV.ORD_LINE_STS_CD &lt;&gt; #ordLineStsCancelled#
                                <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND DV.EZCANCELFLAG         = '0'
                                AND DV.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                                AND DV.CPO_ORD_NUM          = CD.CPO_ORD_NUM
                                AND DV.CPO_DTL_LINE_NUM     = CD.CPO_DTL_LINE_NUM
                                AND DV.CPO_DTL_LINE_SUB_NUM = CD.CPO_DTL_LINE_SUB_NUM
                                AND DV.CPO_ORD_NUM          = SP.TRX_HDR_NUM
                                AND DV.CPO_DTL_LINE_NUM     = SP.TRX_LINE_NUM
                                AND DV.CPO_DTL_LINE_SUB_NUM = SP.TRX_LINE_SUB_NUM
                                AND SP.SHPG_STS_CD      &gt;= #shpgStsArrived#
                                <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND SP.SHPG_STS_CD   &lt;&gt; #shpgStsCancelled#
                                <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND SP.EZCANCELFLAG         = '0'
                    ) 
                    <!-- Start 2019/03/04 K.Fujimoto [QC#30574, ADD] -->
                         OR EXISTS (
                            <!-- Parent -->
                            SELECT
                                        1
                            FROM
                                 DS_CPO_CONFIG     CV
                               , DS_CONTR_DTL      DCD
                               , CPO_DTL           DV
                               , SHPG_PLN          SP
                            WHERE
                                    CV.GLBL_CMPY_CD          = #glblCmpyCd#
                                AND CV.CPO_ORD_NUM           = #cpoOrdNum#
                                AND CV.EZCANCELFLAG          = '0'
                                AND CV.GLBL_CMPY_CD          = DV.GLBL_CMPY_CD
                                AND CV.DS_CPO_CONFIG_PK      = DV.DS_CPO_CONFIG_PK
                                AND CV.DS_ORD_POSN_NUM       = DV.DS_ORD_POSN_NUM
                                <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND DV.ORD_LINE_STS_CD &lt;&gt; #ordLineStsCancelled#
                                <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND DV.CPO_ORD_NUM           = DCD.CPO_ORD_NUM
                                AND DV.CPO_DTL_LINE_NUM      = DCD.CPO_DTL_LINE_NUM
                                AND DV.CPO_DTL_LINE_SUB_NUM  = DCD.CPO_DTL_LINE_SUB_NUM
                                AND DCD.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                                AND DCD.DS_CONTR_DTL_PK      = CD.PRNT_DS_CONTR_DTL_PK
                                AND DV.CPO_ORD_NUM           = SP.TRX_HDR_NUM
                                AND DV.CPO_DTL_LINE_NUM      = SP.TRX_LINE_NUM
                                AND DV.CPO_DTL_LINE_SUB_NUM  = SP.TRX_LINE_SUB_NUM
                                AND SP.SHPG_STS_CD       &gt;= #shpgStsArrived#
                                <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND SP.SHPG_STS_CD    &lt;&gt; #shpgStsCancelled#
                                <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                AND SP.EZCANCELFLAG          = '0'
                                AND DCD.EZCANCELFLAG         = '0'
                                AND DV.EZCANCELFLAG          = '0'
                    )
                    <!-- End   2019/03/04 K.Fujimoto [QC#30574, ADD] -->
                    THEN 'N'
                    --
                    ELSE 'Y'
                    END
                  ) AS SCR_ENT_AVAL_FLG
                , CD.SHELL_LINE_NUM
                , CAC.DS_CONTR_DTL_PK
                , CAC.DS_CONTR_ADDL_CHRG_PK
            FROM
                  DS_CONTR_DTL          CD
                , DS_CONTR              C
                , DS_CONTR_ADDL_CHRG    CAC
                <!-- START 2017/07/24 K.Kojima [QC#19793,MOD] -->
                <!-- , CPO_DTL_V             DCD -->
                , CPO_DTL               DCD
                <!-- END 2017/07/24 K.Kojima [QC#19793,MOD] -->
                , ALL_MDSE_V            AMVI
                , ALL_MDSE_V            AMVU
                , PRC_CATG              PC
            WHERE
                    CD.GLBL_CMPY_CD             = #glblCmpyCd#
                AND CD.DS_CONTR_PK              = #dsContrPk#
                AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                AND CD.DS_CONTR_DTL_TP_CD IN
                <iterate property="dsContrDtlTpCd" var="dsContrDtlTpCd[]" open=" (" close=")" conjunction=",">
                        #dsContrDtlTpCd[]#
                </iterate>
                AND CD.EZCANCELFLAG             = '0'
                --
                AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                AND C.EZCANCELFLAG              = '0'
                --
                AND CD.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
                AND CD.CPO_ORD_NUM              = DCD.CPO_ORD_NUM
                AND CD.CPO_DTL_LINE_NUM         = DCD.CPO_DTL_LINE_NUM
                AND CD.CPO_DTL_LINE_SUB_NUM     = DCD.CPO_DTL_LINE_SUB_NUM
                <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                AND DCD.ORD_LINE_STS_CD  &lt;&gt; #ordLineStsCancelled#
                <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                AND DCD.EZCANCELFLAG            = '0'
                --
                AND CD.GLBL_CMPY_CD             = CAC.GLBL_CMPY_CD
                AND CD.DS_CONTR_PK              = CAC.DS_CONTR_PK
                AND CD.DS_CONTR_DTL_PK          = CAC.DS_CONTR_DTL_PK
                AND CAC.ADDL_CHRG_CATG_CD       = #addlChrgCatgCd#
                AND CAC.EZCANCELFLAG            = '0'
                --
                AND CAC.GLBL_CMPY_CD            = AMVI.GLBL_CMPY_CD(+) <!-- QC#28398 -->
                AND CAC.ADDL_CHRG_TP_CD         = AMVI.MDSE_CD(+)      <!-- QC#28398 -->
                AND AMVI.EZCANCELFLAG(+)        = '0'
                --
                AND DCD.GLBL_CMPY_CD            = AMVU.GLBL_CMPY_CD(+)
                AND DCD.MDSE_CD                 = AMVU.MDSE_CD(+)
                AND AMVU.EZCANCELFLAG(+)        = '0'
                --
                AND CD.GLBL_CMPY_CD             = PC.GLBL_CMPY_CD(+)
                AND CD.PRC_CATG_CD              = PC.PRC_CATG_CD(+)
                AND PC.EZCANCELFLAG(+)          = '0'
            ORDER BY
            <!-- START 2017/09/01 [QC#20820, MOD] -->
            <!-- DCD.DS_ORD_POSN_NUM              -->
                  TO_NUMBER(DCD.DS_ORD_POSN_NUM)
            <!-- END   2017/09/01 [QC#20820, MOD] -->
                , DCD.DS_CPO_LINE_NUM
                , DCD.DS_CPO_LINE_SUB_NUM
                , CAC.ADDL_CHRG_TP_CD   <!-- QC#28398 -->
    </statement>

    <statement id="getDsOrdPosnInfo" parameterClass="Map" resultClass="Map">
        <!-- START 2019/05/24 [QC#50157, MOD] -->
        SELECT
                  CPO_ORD_NUM
                , SHELL_LINE_NUM
                , CPO_DTL_LINE_NUM
                , CPO_DTL_LINE_SUB_NUM
                , DS_ORD_POSN_NUM
                , DS_CONTR_PK
                , DS_CONTR_DTL_PK
                , MDL_ID
                , T_MDL_NM
                , MTR_READ_METH_CD
                , CR_REBIL_CD
                , SVC_CONFIG_MSTR_PK
                , CUST_PO_NUM
                , DS_PO_EXPR_DT
                , PO_DT
            FROM
                (
                SELECT
                          DC.CPO_ORD_NUM
                        , CD.SHELL_LINE_NUM
                        , DCD.CPO_DTL_LINE_NUM
                        , DCD.CPO_DTL_LINE_SUB_NUM
                        , DCD.DS_ORD_POSN_NUM
                        , CD.DS_CONTR_PK
                        , CD.DS_CONTR_DTL_PK
                        <!-- 2019/05/08 QC#50174 Mod Start -->
                        <!-- , DCC.MDL_ID -->
                        , CD.MDL_ID
                        <!-- 2019/05/08 QC#50174 Mod End -->
                        , MN.T_MDL_NM
                        , CD.MTR_READ_METH_CD
                        , CD.CR_REBIL_CD
                        , CD.SVC_CONFIG_MSTR_PK
                        , CCP.CUST_PO_NUM
                        <!-- 2018/04/24 QC#20162 Mod Start -->
                        <!-- , CCP.PO_DT -->
                        , CCP.PO_DT                DS_PO_EXPR_DT
                        , CCP.CUST_ISS_PO_DT       PO_DT
                        <!-- 2018/04/24 QC#20162 Mod End -->
                        , RANK() OVER(PARTITION BY CD.DS_CONTR_DTL_PK ORDER BY CCP.EZINTIME, CCP.DS_CONTR_CR_CARD_PO_PK) AS RANK
                    FROM
                        <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                        <!--   CPO_V                 DC -->
                        <!-- , CPO_DTL_V             DCD -->
                          CPO                   DC
                        , CPO_DTL               DCD
                        <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                        , DS_CPO_CONFIG         DCC
                        , DS_CONTR_DTL          CD
                        , DS_CONTR              C
                        , MDL_NM                MN
                        , DS_CONTR_CR_CARD_PO   CCP
                    WHERE
                            DC.GLBL_CMPY_CD           = #glblCmpyCd#
                        AND DC.CPO_ORD_NUM            = #refCpoOrdNum#
                        AND DC.EZCANCELFLAG           = '0'
                        --
                        AND DC.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
                        AND DC.CPO_ORD_NUM            = DCD.CPO_ORD_NUM
                        AND DCD.EZCANCELFLAG          = '0'
                        --
                        AND DCD.GLBL_CMPY_CD          = DCC.GLBL_CMPY_CD
                        AND DCD.DS_CPO_CONFIG_PK      = DCC.DS_CPO_CONFIG_PK
                        AND DCC.EZCANCELFLAG          = '0'
                        --
                        AND DCD.GLBL_CMPY_CD          = CD.GLBL_CMPY_CD
                        AND DCD.CPO_ORD_NUM           = CD.CPO_ORD_NUM
                        AND DCD.CPO_DTL_LINE_NUM      = CD.CPO_DTL_LINE_NUM
                        AND DCD.CPO_DTL_LINE_SUB_NUM  = CD.CPO_DTL_LINE_SUB_NUM
                        AND CD.EZCANCELFLAG           = '0'
                        --
                        AND CD.GLBL_CMPY_CD           = C.GLBL_CMPY_CD
                        AND CD.DS_CONTR_PK            = C.DS_CONTR_PK
                        AND CD.SHELL_LINE_NUM         = #shellLineNum#
                        AND CD.DS_CONTR_DTL_TP_CD IN
                        <iterate property="dsContrDtlTpCd" var="dsContrDtlTpCd[]" open=" (" close=")" conjunction=",">
                                #dsContrDtlTpCd[]#
                        </iterate>
                        <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                        AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                        <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                        AND C.EZCANCELFLAG(+)         = '0'
                        --
                        AND CD.GLBL_CMPY_CD           = CCP.GLBL_CMPY_CD(+)
                        AND CD.DS_CONTR_DTL_PK        = CCP.DS_CONTR_DTL_PK(+)
                        AND CCP.EZCANCELFLAG (+)      = '0'
                        --
                        AND CD.GLBL_CMPY_CD           = MN.T_GLBL_CMPY_CD(+)
                        AND CD.MDL_ID                 = MN.T_MDL_ID(+)
                        AND MN.EZCANCELFLAG(+)        = '0'
                        <!-- START 2019/01/09 S.Kitamura [QC#26928,ADD] -->
                        AND CCP.CR_CARD_FLG(+)        = 'N'
                        <!-- AND CCP.PO_FROM_DT(+)         &lt;= #slsDt# -->
                        <!-- AND CCP.PO_DT(+)              &gt;= #slsDt# -->
                        <!-- END 2019/01/09 S.Kitamura [QC#26928,ADD] -->
                    ORDER BY
                          MDL_ID
                    <!-- START 2017/09/01 [QC#20820, MOD] -->
                    <!-- , DS_ORD_POSN_NUM                -->
                        , TO_NUMBER(DS_ORD_POSN_NUM)
                    <!-- END   2017/09/01 [QC#20820, MOD] -->
                )
            WHERE
                    RANK = 1
        <!-- END   2019/05/24 [QC#50157, MOD] -->
    </statement>
    <!-- START 2017/10/25 [QC#21556, ADD] -->
    <statement id="getInitDataFromModelPricingHeaderForFleetAddMachine" parameterClass="Map" resultClass="Map">
        SELECT
                  WK_V.PRIORITY
                , WK_V.DS_CONTR_DTL_PK
                , WK_V.MDL_ID
                , WK_V.T_MDL_NM
                , (
                    SELECT COUNT(1)
                        FROM DS_CONTR_DTL CD1
                    WHERE   
                            CD1.GLBL_CMPY_CD        = WK_V.GLBL_CMPY_CD
                        AND CD1.DS_CONTR_PK         = WK_V.DS_CONTR_PK
                        AND CD1.CPO_ORD_NUM         = #cpoOrdNum#
                        <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                        AND CD1.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                        <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                        AND CD1.DS_CONTR_DTL_TP_CD IN
                        <iterate property="dsContrDtlTpCdMac" var="dsContrDtlTpCdMac[]" open=" (" close=")" conjunction=",">
                                #dsContrDtlTpCdMac[]#
                        </iterate>
                        AND CD1.EZCANCELFLAG        = '0'
                  ) AS MDL_QTY
                , WK_V.SVC_PRC_CATG_CD
                , WK_V.PRC_CATG_CD
                , WK_V.PRC_CATG_NM
                , WK_V.PRC_LIST_TP_CD
                , WK_V.PRC_MTR_PKG_PK
                , WK_V.PRC_MTR_PKG_NM
                , CASE
                      WHEN
                          EXISTS
                              (SELECT 1 
                                  FROM    CONTR_XS_COPY            CXC 
                                         ,DS_CONTR_BLLG_MTR        CBM
                                  WHERE   CXC.GLBL_CMPY_CD         = CBM.GLBL_CMPY_CD
                                  AND     CXC.DS_CONTR_BLLG_MTR_PK = CBM.DS_CONTR_BLLG_MTR_PK
                                  AND     CXC.XS_MTR_FIRST_FLG     = #xsMtrFirstFlgN#
                                  AND     CXC.EZCANCELFLAG         = '0'
                                  AND     CBM.GLBL_CMPY_CD         = WK_V.GLBL_CMPY_CD
                                  AND     CBM.DS_CONTR_DTL_PK      = WK_V.DS_CONTR_DTL_PK
                                  AND     CBM.EZCANCELFLAG         = '0')
                      THEN
                          WK_V.PRC_TIER_SVC_OFFER_CD
                      ELSE
                          NULL
                  END AS PRC_TIER_SVC_OFFER_CD
                , WK_V.BASE_PRC_DEAL_AMT
                , (WK_V.TO_PER_MTH_NUM - WK_V.FROM_PER_MTH_NUM + 1) AS TERM_MTH_AOT
                , (
                    'N'
                  ) AS CONTR_CRAT_FLG
                , (
                    'Y'
                  ) AS SCR_ENT_AVAL_FLG
                  , (
                    'N'
                  ) AS CONFIG_PRC_SET_FLG
        FROM (
            SELECT
                      1 AS PRIORITY
                    , CD.DS_CONTR_DTL_PK
                    , CD.MDL_ID
                    , MN.T_MDL_NM
                    , CD.SVC_PRC_CATG_CD
                    , CD.PRC_CATG_CD
                    , PC.PRC_CATG_NM
                    , PC.PRC_LIST_TP_CD
                    , CD.PRC_MTR_PKG_PK
                    , PMP.PRC_MTR_PKG_NM
                    , TSO.PRC_TIER_SVC_OFFER_CD
                    , CD.BASE_PRC_DEAL_AMT
                    , CD.FROM_PER_MTH_NUM 
                    , CD.TO_PER_MTH_NUM
                    , C.DS_CONTR_STS_CD
                    , CD.DS_CONTR_DTL_STS_CD
                    , C.DS_CONTR_PK
                    , CD.GLBL_CMPY_CD
                FROM
                      DS_CONTR_DTL          CD
                    , DS_CONTR              C
                    , DS_CONTR_BLLG_MTR     CBM
                    , MDL_NM                MN
                    , PRC_MTR_PKG           PMP
                    , PRC_CATG              PC
                    , XS_CHRG_TP            XCT
                    , PRC_TIER_SVC_OFFER    TSO
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCd#
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = PMP.GLBL_CMPY_CD(+)
                    AND CD.PRC_MTR_PKG_PK           = PMP.PRC_MTR_PKG_PK(+)
                    AND PMP.EZCANCELFLAG(+)         = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD(+)
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK(+)
                    AND CBM.EZCANCELFLAG(+)         = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = MN.T_GLBL_CMPY_CD(+)
                    AND CD.MDL_ID                   = MN.T_MDL_ID(+)
                    AND MN.EZCANCELFLAG(+)          = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = PC.GLBL_CMPY_CD(+)
                    AND CD.PRC_CATG_CD              = PC.PRC_CATG_CD(+)
                    AND PC.EZCANCELFLAG(+)          = '0'
                    --
                    AND CBM.GLBL_CMPY_CD            = XCT.GLBL_CMPY_CD(+)
                    AND CBM.XS_CHRG_TP_CD           = XCT.XS_CHRG_TP_CD(+)
                    AND XCT.EZCANCELFLAG(+)         = '0'
                    --
                    AND XCT.GLBL_CMPY_CD            = TSO.GLBL_CMPY_CD(+)
                    AND XCT.PRC_TIER_SVC_OFFER_CD   = TSO.PRC_TIER_SVC_OFFER_CD(+)
                    AND TSO.EZCANCELFLAG(+)         = '0'
                    -- 
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            DS_CONTR_DTL CD1
                        WHERE
                                CD1.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                            AND CD1.DS_CONTR_PK         = CD.DS_CONTR_PK
                            AND CD1.CPO_ORD_NUM         = CD.CPO_ORD_NUM
                            AND CD1.DS_CONTR_DTL_TP_CD  = #dsContrDtlTpCdFlt#
                            AND CD1.EZCANCELFLAG        = '0'
                    )
                GROUP BY
                      CD.DS_CONTR_DTL_PK
                    , CD.MDL_ID
                    , MN.T_MDL_NM
                    , CD.SVC_PRC_CATG_CD
                    , CD.PRC_CATG_CD
                    , PC.PRC_CATG_NM
                    , PC.PRC_LIST_TP_CD
                    , CD.PRC_MTR_PKG_PK
                    , PMP.PRC_MTR_PKG_NM
                    , TSO.PRC_TIER_SVC_OFFER_CD
                    , CD.BASE_PRC_DEAL_AMT
                    , CD.FROM_PER_MTH_NUM 
                    , CD.TO_PER_MTH_NUM
                    , C.DS_CONTR_STS_CD
                    , CD.DS_CONTR_DTL_STS_CD
                    , C.DS_CONTR_PK
                    , CD.GLBL_CMPY_CD
            UNION ALL
            SELECT
                      2 AS PRIORITY
                    , CD.DS_CONTR_DTL_PK
                    , CD.MDL_ID
                    , NULL AS T_MDL_NM
                    , CD.SVC_PRC_CATG_CD
                    , CD.PRC_CATG_CD
                    , NULL AS PRC_CATG_NM
                    , NULL AS PRC_LIST_TP_CD
                    , CD.PRC_MTR_PKG_PK
                    , NULL AS PRC_MTR_PKG_NM
                    , TSO.PRC_TIER_SVC_OFFER_CD
                    , CD.BASE_PRC_DEAL_AMT
                    , 1 AS FROM_PER_MTH_NUM
                    , CEIL(MONTHS_BETWEEN( 
                        TO_DATE(C.CONTR_VRSN_EFF_THRU_DT, 'yyyymmdd'), TO_DATE(C.CONTR_VRSN_EFF_FROM_DT, 'yyyymmdd')
                      )) AS TO_PER_MTH_NUM
                    , C.DS_CONTR_STS_CD
                    , CD.DS_CONTR_DTL_STS_CD
                    , C.DS_CONTR_PK
                    , CD.GLBL_CMPY_CD
                FROM
                      DS_CONTR_DTL          CD
                    , DS_CONTR              C
                    , DS_CONTR_BLLG_MTR     CBM
                    , XS_CHRG_TP            XCT
                    , PRC_TIER_SVC_OFFER    TSO
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCdFlt#
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD(+)
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK(+)
                    AND CBM.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.GLBL_CMPY_CD            = XCT.GLBL_CMPY_CD(+)
                    AND CBM.XS_CHRG_TP_CD           = XCT.XS_CHRG_TP_CD(+)
                    AND XCT.EZCANCELFLAG(+)         = '0'
                    --
                    AND XCT.GLBL_CMPY_CD            = TSO.GLBL_CMPY_CD(+)
                    AND XCT.PRC_TIER_SVC_OFFER_CD   = TSO.PRC_TIER_SVC_OFFER_CD(+)
                    AND TSO.EZCANCELFLAG(+)         = '0'
                    AND ROWNUM                      = 1
        ) WK_V
        ORDER BY
            WK_V.PRIORITY
    </statement>

    <statement id="getInitDataFromModelPricingDetailForFleetAddMachine" parameterClass="Map" resultClass="Map">
        SELECT
                  WK_V.PRIORITY
                , WK_V.DS_CONTR_DTL_PK
                , WK_V.DS_CONTR_BLLG_MTR_PK
                , WK_V.CONTR_PHYS_BLLG_MTR_RELN_PK
                , WK_V.CONTR_XS_COPY_PK
                , WK_V.MDL_ID
                , WK_V.T_MDL_NM
                , WK_V.PRC_CATG_CD
                , WK_V.PRC_LIST_BAND_CD
                , WK_V.PRC_LIST_BAND_DESC_TXT
                , WK_V.PRC_BOOK_MDSE_CD
                , WK_V.BLLG_MTR_LB_CD
                , WK_V.BLLG_MTR_LB_DESC_TXT
                , WK_V.REG_MTR_LB_CD
                , WK_V.REG_MTR_LB_DESC_TXT
                , WK_V.CONTR_MTR_MULT_RATE
                , WK_V.XS_MTR_COPY_QTY
                , WK_V.MAX_COPY_VOL_CNT
                , WK_V.XS_MTR_AMT_RATE
                , WK_V.DS_ACCT_NM
                , WK_V.SELL_TO_CUST_CD
                , WK_V.BILL_TO_SRCH_TXT
                , WK_V.BILL_TO_CUST_CD
                , WK_V.INTG_MDSE_CD
                , WK_V.REG_MTR_LB_SORT_NUM
                , WK_V.PRC_SVC_TIER_TP_CD
                , WK_V.PRC_SVC_TIER_TP_DESC_TXT
                , WK_V.PRC_SVC_TIER_TP_SORT_NUM
                , WK_V.ACTV_FLG
                , WK_V.XX_FLG_NM
                <!-- 2018/05/09 QC#25030 add start -->
                , WK_V.BLLG_FREE_COPY_CNT
                , WK_V.BLLG_MIN_CNT
                , WK_V.BLLG_MIN_AMT_RATE
                , WK_V.BLLG_ROLL_OVER_RATIO
                <!-- 2018/05/09 QC#25030 add end -->
                
        FROM (
            SELECT DISTINCT
                      1 AS PRIORITY
                    , CD.DS_CONTR_DTL_PK
                    , CBM.DS_CONTR_BLLG_MTR_PK
                    , NULL AS CONTR_PHYS_BLLG_MTR_RELN_PK
                    , CXC.CONTR_XS_COPY_PK
                    , CD.MDL_ID
                    , MN.T_MDL_NM
                    , CD.PRC_CATG_CD
                    , CBM.PRC_LIST_BAND_CD
                    , PLB.PRC_LIST_BAND_DESC_TXT
                    , CBM.PRC_BOOK_MDSE_CD
                    , MLB.MTR_LB_CD AS BLLG_MTR_LB_CD
                    , MLB.MTR_LB_DESC_TXT AS BLLG_MTR_LB_DESC_TXT
                    , NULL AS REG_MTR_LB_CD
                    , NULL AS REG_MTR_LB_DESC_TXT
                    , NULL AS CONTR_MTR_MULT_RATE
                    , CXC.XS_MTR_COPY_QTY
                    , CXC.MAX_COPY_VOL_CNT
                    , CXC.XS_MTR_AMT_RATE
                    , DAC.DS_ACCT_NM
                    , CBM.SELL_TO_CUST_CD
                    , (
                        RPAD( 
                            BTC.FIRST_LINE_ADDR
                            , LENGTH(BTC.FIRST_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.SCD_LINE_ADDR
                            , LENGTH(BTC.SCD_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.THIRD_LINE_ADDR
                            , LENGTH(BTC.THIRD_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.FRTH_LINE_ADDR
                            , LENGTH(BTC.FRTH_LINE_ADDR) + 1
                        ) || CONCAT(BTC.CTY_ADDR, ',') || RPAD(BTC.ST_CD, LENGTH(BTC.ST_CD) + 1) || RPAD(BTC.POST_CD, LENGTH(BTC.POST_CD) + 1)
                      ) AS BILL_TO_SRCH_TXT
                    , CBM.BLLG_MTR_BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                    , CBM.INTG_MDSE_CD
                    , NULL AS REG_MTR_LB_SORT_NUM
                    , CXC.PRC_SVC_TIER_TP_CD
                    , PTT.PRC_SVC_TIER_TP_DESC_TXT
                    , PTT.PRC_SVC_TIER_TP_SORT_NUM
                    , CBR.ACTV_FLG
                    , #flgNmP# AS XX_FLG_NM
                    <!-- 2018/05/09 QC#25030 add start -->
                    , CBM.BLLG_FREE_COPY_CNT
                    , CBM.BLLG_MIN_CNT
                    , CBM.BLLG_MIN_AMT_RATE
                    , CBM.BLLG_ROLL_OVER_RATIO
                    <!-- 2018/05/09 QC#25030 add end -->
                FROM
                      DS_CONTR_DTL              CD
                    , DS_CONTR                  C
                    , DS_CONTR_BLLG_MTR         CBM
                    , CONTR_PHYS_BLLG_MTR_RELN  CBR
                    , CONTR_XS_COPY             CXC
                    , MDL_NM                    MN
                    , PRC_LIST_BAND             PLB
                    , MTR_LB                    MLB
                    , SELL_TO_CUST              DAC
                    , BILL_TO_CUST              BTC
                    , PRC_SVC_TIER_TP           PTT
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCd#
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = MN.T_GLBL_CMPY_CD(+)
                    AND CD.MDL_ID                   = MN.T_MDL_ID(+)
                    AND MN.EZCANCELFLAG(+)          = '0'
                    --
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG            = '0'
                    --
                    AND CBM.PRC_LIST_BAND_CD        = PLB.PRC_LIST_BAND_CD(+)
                    AND CBM.GLBL_CMPY_CD            = PLB.GLBL_CMPY_CD(+)
                    AND PLB.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = MLB.MTR_LB_CD(+)
                    AND CBM.GLBL_CMPY_CD            = MLB.GLBL_CMPY_CD(+)
                    AND MLB.EZCANCELFLAG(+)         = '0'
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            PRC_MTR_PKG_BLLG_MTR PBM
                        WHERE
                                PBM.GLBL_CMPY_CD    = CD.GLBL_CMPY_CD
                            AND PBM.PRC_MTR_PKG_PK  = CD.PRC_MTR_PKG_PK
                            AND PBM.MTR_LB_CD       = MLB.MTR_LB_CD
                            AND PBM.EZCANCELFLAG    = '0'
                    )
                    -- 
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            DS_CONTR_DTL CD1
                        WHERE
                                CD1.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                            AND CD1.DS_CONTR_PK         = CD.DS_CONTR_PK
                            AND CD1.CPO_ORD_NUM         = CD.CPO_ORD_NUM
                            AND CD1.DS_CONTR_DTL_TP_CD  = #dsContrDtlTpCdFlt#
                            AND CD1.EZCANCELFLAG        = '0'
                    )
                    --
                    AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
                    AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                    AND CBR.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.DS_CONTR_BLLG_MTR_PK    = CXC.DS_CONTR_BLLG_MTR_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CXC.GLBL_CMPY_CD(+)
                    AND CXC.XS_MTR_FIRST_FLG        = #xsMtrFirstFlg# -- 'Y'
                    AND CXC.EZCANCELFLAG(+)         = '0'
                    --
                    AND CD.SELL_TO_CUST_CD          = DAC.SELL_TO_CUST_CD(+)
                    AND CD.GLBL_CMPY_CD             = DAC.GLBL_CMPY_CD(+)
                    AND DAC.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_BILL_TO_CUST_CD = BTC.BILL_TO_CUST_CD(+)
                    AND CBM.GLBL_CMPY_CD             = BTC.GLBL_CMPY_CD(+)
                    AND BTC.EZCANCELFLAG(+)          = '0'
                    --
                    AND CXC.GLBL_CMPY_CD            = PTT.GLBL_CMPY_CD(+)
                    AND CXC.PRC_SVC_TIER_TP_CD      = PTT.PRC_SVC_TIER_TP_CD(+)
                    AND PTT.EZCANCELFLAG(+)         = '0'
            UNION ALL
            SELECT
                      1 AS PRIORITY
                    , CD.DS_CONTR_DTL_PK
                    , CBM.DS_CONTR_BLLG_MTR_PK
                    , CBR.CONTR_PHYS_BLLG_MTR_RELN_PK
                    , NULL AS CONTR_XS_COPY_PK
                    , CD.MDL_ID
                    , MN.T_MDL_NM
                    , CD.PRC_CATG_CD
                    , CBM.PRC_LIST_BAND_CD
                    , PLB.PRC_LIST_BAND_DESC_TXT
                    , CBM.PRC_BOOK_MDSE_CD
                    , MLB.MTR_LB_CD AS BLLG_MTR_LB_CD
                    , MLB.MTR_LB_DESC_TXT AS BLLG_MTR_LB_DESC_TXT
                    , CBR.REG_MTR_LB_CD
                    , MLP.MTR_LB_DESC_TXT AS REG_MTR_LB_DESC_TXT
                    , CBR.CONTR_MTR_MULT_RATE
                    , NULL AS XS_MTR_COPY_QTY
                    , NULL AS MAX_COPY_VOL_CNT
                    , NULL AS XS_MTR_AMT_RATE
                    , NULL AS DS_ACCT_NM
                    , NULL AS BILL_TO_CUST_CD
                    , NULL AS BILL_TO_SRCH_TXT
                    , NULL AS BILL_TO_LOC_NUM
                    , CBM.INTG_MDSE_CD
                    , MLP.MTR_LB_SORT_NUM AS REG_MTR_LB_SORT_NUM
                    , NULL AS PRC_SVC_TIER_TP_CD
                    , NULL AS PRC_SVC_TIER_TP_DESC_TXT
                    , NULL AS PRC_SVC_TIER_TP_SORT_NUM
                    , CBR.ACTV_FLG
                    , #flgNmH# AS XX_FLG_NM
                    <!-- 2018/05/09 QC#25030 add start -->
                    , CBM.BLLG_FREE_COPY_CNT
                    , CBM.BLLG_MIN_CNT
                    , CBM.BLLG_MIN_AMT_RATE
                    , CBM.BLLG_ROLL_OVER_RATIO
                    <!-- 2018/05/09 QC#25030 add end -->
                FROM
                      DS_CONTR_DTL              CD
                    , DS_CONTR                  C
                    , DS_CONTR_BLLG_MTR         CBM
                    , CONTR_PHYS_BLLG_MTR_RELN  CBR
                    , MDL_NM                    MN
                    , PRC_LIST_BAND             PLB
                    , MTR_LB                    MLB
                    , MTR_LB                    MLP
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCd#
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = MN.T_GLBL_CMPY_CD(+)
                    AND CD.MDL_ID                   = MN.T_MDL_ID(+)
                    AND MN.EZCANCELFLAG(+)          = '0'
                    --
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG            = '0'
                    --
                    AND CBM.PRC_LIST_BAND_CD        = PLB.PRC_LIST_BAND_CD(+)
                    AND CBM.GLBL_CMPY_CD            = PLB.GLBL_CMPY_CD(+)
                    AND PLB.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = MLB.MTR_LB_CD(+)
                    AND CBM.GLBL_CMPY_CD            = MLB.GLBL_CMPY_CD(+)
                    AND MLB.EZCANCELFLAG(+)         = '0'
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            PRC_MTR_PKG_BLLG_MTR PBM
                        WHERE
                                PBM.GLBL_CMPY_CD    = CD.GLBL_CMPY_CD
                            AND PBM.PRC_MTR_PKG_PK  = CD.PRC_MTR_PKG_PK
                            AND PBM.MTR_LB_CD       = MLB.MTR_LB_CD
                            AND PBM.EZCANCELFLAG    = '0'
                    )
                    -- 
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            DS_CONTR_DTL CD1
                        WHERE
                                CD1.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                            AND CD1.DS_CONTR_PK         = CD.DS_CONTR_PK
                            AND CD1.CPO_ORD_NUM         = CD.CPO_ORD_NUM
                            AND CD1.DS_CONTR_DTL_TP_CD  = #dsContrDtlTpCdFlt#
                            AND CD1.EZCANCELFLAG        = '0'
                    )
                    --
                    AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
                    AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                    AND CBR.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBR.REG_MTR_LB_CD           = MLP.MTR_LB_CD(+)
                    AND CBR.GLBL_CMPY_CD            = MLP.GLBL_CMPY_CD(+)
                    AND MLP.EZCANCELFLAG(+)         = '0'
            UNION ALL
            SELECT
                      1 AS PRIORITY
                    , CD.DS_CONTR_DTL_PK
                    , CBM.DS_CONTR_BLLG_MTR_PK
                    , CBR.CONTR_PHYS_BLLG_MTR_RELN_PK
                    , CXC.CONTR_XS_COPY_PK
                    , CD.MDL_ID
                    , NULL AS T_MDL_NM
                    , NULL AS PRC_CATG_CD
                    , NULL AS PRC_LIST_BAND_CD
                    , NULL AS PRC_LIST_BAND_DESC_TXT
                    , NULL AS PRC_BOOK_MDSE_CD
                    , MLB.MTR_LB_CD AS BLLG_MTR_LB_CD
                    , NULL AS BLLG_MTR_LB_DESC_TXT
                    , NULL AS REG_MTR_LB_CD
                    , NULL AS REG_MTR_LB_DESC_TXT
                    , NULL AS CONTR_MTR_MULT_RATE
                    , CXC.XS_MTR_COPY_QTY
                    , CXC.MAX_COPY_VOL_CNT
                    , CXC.XS_MTR_AMT_RATE
                    , NULL AS DS_ACCT_NM
                    , NULL AS SELL_TO_CUST_CD
                    , NULL AS BILL_TO_SRCH_TXT
                    , NULL AS BILL_TO_CUST_CD
                    , NULL AS INTG_MDSE_CD
                    , NULL AS REG_MTR_LB_SORT_NUM
                    , CXC.PRC_SVC_TIER_TP_CD
                    , PTT.PRC_SVC_TIER_TP_DESC_TXT
                    , PTT.PRC_SVC_TIER_TP_SORT_NUM
                    , CBR.ACTV_FLG
                    , #flgNmT# AS XX_FLG_NM
                    <!-- 2018/05/09 QC#25030 add start -->
                    , NULL AS BLLG_FREE_COPY_CNT
                    , NULL AS BLLG_MIN_CNT
                    , NULL AS BLLG_MIN_AMT_RATE
                    , NULL AS BLLG_ROLL_OVER_RATIO
                    <!-- 2018/05/09 QC#25030 add end -->
                FROM
                      DS_CONTR_DTL              CD
                    , DS_CONTR                  C
                    , DS_CONTR_BLLG_MTR         CBM
                    , CONTR_PHYS_BLLG_MTR_RELN  CBR
                    , CONTR_XS_COPY             CXC
                    , PRC_SVC_TIER_TP           PTT
                    , MTR_LB                    MLB
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCd#
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG            = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = MLB.MTR_LB_CD(+)
                    AND CBM.GLBL_CMPY_CD            = MLB.GLBL_CMPY_CD(+)
                    AND MLB.EZCANCELFLAG(+)         = '0'
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            PRC_MTR_PKG_BLLG_MTR PBM
                        WHERE
                                PBM.GLBL_CMPY_CD    = CD.GLBL_CMPY_CD
                            AND PBM.PRC_MTR_PKG_PK  = CD.PRC_MTR_PKG_PK
                            AND PBM.MTR_LB_CD       = MLB.MTR_LB_CD
                            AND PBM.EZCANCELFLAG    = '0'
                    )
                    -- 
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            DS_CONTR_DTL CD1
                        WHERE
                                CD1.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                            AND CD1.DS_CONTR_PK         = CD.DS_CONTR_PK
                            AND CD1.CPO_ORD_NUM         = CD.CPO_ORD_NUM
                            AND CD1.DS_CONTR_DTL_TP_CD  = #dsContrDtlTpCdFlt#
                            AND CD1.EZCANCELFLAG        = '0'
                    )
                    --
                    AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
                    AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                    AND CBR.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.DS_CONTR_BLLG_MTR_PK    = CXC.DS_CONTR_BLLG_MTR_PK
                    AND CBM.GLBL_CMPY_CD            = CXC.GLBL_CMPY_CD
                    AND CXC.XS_MTR_FIRST_FLG        = #xsMtrFirstFlgN#
                    AND CXC.EZCANCELFLAG            = '0'
                    --
                    AND CXC.GLBL_CMPY_CD            = PTT.GLBL_CMPY_CD(+)
                    AND CXC.PRC_SVC_TIER_TP_CD      = PTT.PRC_SVC_TIER_TP_CD(+)
                    AND PTT.EZCANCELFLAG(+)         = '0'

            UNION ALL
            SELECT DISTINCT
                      2 AS PRIORITY
                    , CD.DS_CONTR_DTL_PK
                    , CBM.DS_CONTR_BLLG_MTR_PK
                    , NULL AS CONTR_PHYS_BLLG_MTR_RELN_PK
                    , CXC.CONTR_XS_COPY_PK
                    , CD.MDL_ID
                    , NULL AS T_MDL_NM
                    , CD.PRC_CATG_CD
                    , CBM.PRC_LIST_BAND_CD
                    , NULL AS PRC_LIST_BAND_DESC_TXT
                    , CBM.PRC_BOOK_MDSE_CD
                    , MLB.MTR_LB_CD AS BLLG_MTR_LB_CD
                    , MLB.MTR_LB_DESC_TXT AS BLLG_MTR_LB_DESC_TXT
                    , NULL AS REG_MTR_LB_CD
                    , NULL AS REG_MTR_LB_DESC_TXT
                    , NULL AS CONTR_MTR_MULT_RATE
                    , CXC.XS_MTR_COPY_QTY
                    , CXC.MAX_COPY_VOL_CNT
                    , CXC.XS_MTR_AMT_RATE
                    , DAC.DS_ACCT_NM
                    , CBM.SELL_TO_CUST_CD
                    , (
                        RPAD( 
                            BTC.FIRST_LINE_ADDR
                            , LENGTH(BTC.FIRST_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.SCD_LINE_ADDR
                            , LENGTH(BTC.SCD_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.THIRD_LINE_ADDR
                            , LENGTH(BTC.THIRD_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.FRTH_LINE_ADDR
                            , LENGTH(BTC.FRTH_LINE_ADDR) + 1
                        ) || CONCAT(BTC.CTY_ADDR, ',') || RPAD(BTC.ST_CD, LENGTH(BTC.ST_CD) + 1) || RPAD(BTC.POST_CD, LENGTH(BTC.POST_CD) + 1)
                      ) AS BILL_TO_SRCH_TXT
                    , CBM.BLLG_MTR_BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                    , CBM.INTG_MDSE_CD
                    , NULL AS REG_MTR_LB_SORT_NUM
                    , CXC.PRC_SVC_TIER_TP_CD
                    , PTT.PRC_SVC_TIER_TP_DESC_TXT
                    , PTT.PRC_SVC_TIER_TP_SORT_NUM
                    , CBR.ACTV_FLG
                    , #flgNmP# AS XX_FLG_NM
                    <!-- 2018/05/09 QC#25030 add start -->
                    , CBM.BLLG_FREE_COPY_CNT
                    , CBM.BLLG_MIN_CNT
                    , CBM.BLLG_MIN_AMT_RATE
                    , CBM.BLLG_ROLL_OVER_RATIO
                    <!-- 2018/05/09 QC#25030 add end -->
                FROM
                      DS_CONTR_DTL              CD
                    , DS_CONTR                  C
                    , DS_CONTR_BLLG_MTR         CBM
                    , CONTR_PHYS_BLLG_MTR_RELN  CBR
                    , CONTR_XS_COPY             CXC
                    , MTR_LB                    MLB
                    , SELL_TO_CUST              DAC
                    , BILL_TO_CUST              BTC
                    , PRC_SVC_TIER_TP           PTT
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCdFlt#
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG            = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = MLB.MTR_LB_CD(+)
                    AND CBM.GLBL_CMPY_CD            = MLB.GLBL_CMPY_CD(+)
                    AND MLB.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
                    AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                    AND CBR.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.DS_CONTR_BLLG_MTR_PK    = CXC.DS_CONTR_BLLG_MTR_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CXC.GLBL_CMPY_CD(+)
                    AND CXC.XS_MTR_FIRST_FLG        = #xsMtrFirstFlg# -- 'Y'
                    AND CXC.EZCANCELFLAG(+)         = '0'
                    --
                    AND CD.SELL_TO_CUST_CD          = DAC.SELL_TO_CUST_CD(+)
                    AND CD.GLBL_CMPY_CD             = DAC.GLBL_CMPY_CD(+)
                    AND DAC.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_BILL_TO_CUST_CD = BTC.BILL_TO_CUST_CD(+)
                    AND CBM.GLBL_CMPY_CD             = BTC.GLBL_CMPY_CD(+)
                    AND BTC.EZCANCELFLAG(+)          = '0'
                    --
                    AND CXC.GLBL_CMPY_CD            = PTT.GLBL_CMPY_CD(+)
                    AND CXC.PRC_SVC_TIER_TP_CD      = PTT.PRC_SVC_TIER_TP_CD(+)
                    AND PTT.EZCANCELFLAG(+)         = '0'
            UNION ALL
            SELECT
                      2 AS PRIORITY
                    , CD.DS_CONTR_DTL_PK
                    , CBM.DS_CONTR_BLLG_MTR_PK
                    , CBR.CONTR_PHYS_BLLG_MTR_RELN_PK
                    , NULL AS CONTR_XS_COPY_PK
                    , CD.MDL_ID
                    , NULL AS T_MDL_NM
                    , CD.PRC_CATG_CD
                    , CBM.PRC_LIST_BAND_CD
                    , NULL AS PRC_LIST_BAND_DESC_TXT
                    , CBM.PRC_BOOK_MDSE_CD
                    , MLB.MTR_LB_CD AS BLLG_MTR_LB_CD
                    , MLB.MTR_LB_DESC_TXT AS BLLG_MTR_LB_DESC_TXT
                    , CBR.REG_MTR_LB_CD
                    , MLP.MTR_LB_DESC_TXT AS REG_MTR_LB_DESC_TXT
                    , CBR.CONTR_MTR_MULT_RATE
                    , NULL AS XS_MTR_COPY_QTY
                    , NULL AS MAX_COPY_VOL_CNT
                    , NULL AS XS_MTR_AMT_RATE
                    , NULL AS DS_ACCT_NM
                    , NULL AS BILL_TO_CUST_CD
                    , NULL AS BILL_TO_SRCH_TXT
                    , NULL AS BILL_TO_LOC_NUM
                    , CBM.INTG_MDSE_CD
                    , MLP.MTR_LB_SORT_NUM AS REG_MTR_LB_SORT_NUM
                    , NULL AS PRC_SVC_TIER_TP_CD
                    , NULL AS PRC_SVC_TIER_TP_DESC_TXT
                    , NULL AS PRC_SVC_TIER_TP_SORT_NUM
                    , CBR.ACTV_FLG
                    , #flgNmH# AS XX_FLG_NM
                    <!-- 2018/05/09 QC#25030 add start -->
                    , CBM.BLLG_FREE_COPY_CNT
                    , CBM.BLLG_MIN_CNT
                    , CBM.BLLG_MIN_AMT_RATE
                    , CBM.BLLG_ROLL_OVER_RATIO
                    <!-- 2018/05/09 QC#25030 add end -->
                FROM
                      DS_CONTR_DTL              CD
                    , DS_CONTR                  C
                    , DS_CONTR_BLLG_MTR         CBM
                    , CONTR_PHYS_BLLG_MTR_RELN  CBR
                    , MTR_LB                    MLB
                    , MTR_LB                    MLP
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCdFlt#
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG            = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = MLB.MTR_LB_CD(+)
                    AND CBM.GLBL_CMPY_CD            = MLB.GLBL_CMPY_CD(+)
                    AND MLB.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
                    AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                    AND CBR.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBR.REG_MTR_LB_CD           = MLP.MTR_LB_CD(+)
                    AND CBR.GLBL_CMPY_CD            = MLP.GLBL_CMPY_CD(+)
                    AND MLP.EZCANCELFLAG(+)         = '0'
            UNION ALL
            SELECT
                      2 AS PRIORITY
                    , CD.DS_CONTR_DTL_PK
                    , CBM.DS_CONTR_BLLG_MTR_PK
                    , CBR.CONTR_PHYS_BLLG_MTR_RELN_PK
                    , CXC.CONTR_XS_COPY_PK
                    , CD.MDL_ID
                    , NULL AS T_MDL_NM
                    , NULL AS PRC_CATG_CD
                    , NULL AS PRC_LIST_BAND_CD
                    , NULL AS PRC_LIST_BAND_DESC_TXT
                    , NULL AS PRC_BOOK_MDSE_CD
                    , MLB.MTR_LB_CD AS BLLG_MTR_LB_CD
                    , NULL AS BLLG_MTR_LB_DESC_TXT
                    , NULL AS REG_MTR_LB_CD
                    , NULL AS REG_MTR_LB_DESC_TXT
                    , NULL AS CONTR_MTR_MULT_RATE
                    , CXC.XS_MTR_COPY_QTY
                    , CXC.MAX_COPY_VOL_CNT
                    , CXC.XS_MTR_AMT_RATE
                    , NULL AS DS_ACCT_NM
                    , NULL AS SELL_TO_CUST_CD
                    , NULL AS BILL_TO_SRCH_TXT
                    , NULL AS BILL_TO_CUST_CD
                    , NULL AS INTG_MDSE_CD
                    , NULL AS REG_MTR_LB_SORT_NUM
                    , CXC.PRC_SVC_TIER_TP_CD
                    , PTT.PRC_SVC_TIER_TP_DESC_TXT
                    , PTT.PRC_SVC_TIER_TP_SORT_NUM
                    , CBR.ACTV_FLG
                    , #flgNmT# AS XX_FLG_NM
                    <!-- 2018/05/09 QC#25030 add start -->
                    , NULL AS BLLG_FREE_COPY_CNT
                    , NULL AS BLLG_MIN_CNT
                    , NULL AS BLLG_MIN_AMT_RATE
                    , NULL AS BLLG_ROLL_OVER_RATIO
                    <!-- 2018/05/09 QC#25030 add end -->
                FROM
                      DS_CONTR_DTL              CD
                    , DS_CONTR                  C
                    , DS_CONTR_BLLG_MTR         CBM
                    , CONTR_PHYS_BLLG_MTR_RELN  CBR
                    , CONTR_XS_COPY             CXC
                    , PRC_SVC_TIER_TP           PTT
                    , MTR_LB                    MLB
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCdFlt#
                    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.DS_CONTR_CRAT_TP_CD      = #dsContrCratTpShell#
                    <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG            = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = MLB.MTR_LB_CD(+)
                    AND CBM.GLBL_CMPY_CD            = MLB.GLBL_CMPY_CD(+)
                    AND MLB.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
                    AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                    AND CBR.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.DS_CONTR_BLLG_MTR_PK    = CXC.DS_CONTR_BLLG_MTR_PK
                    AND CBM.GLBL_CMPY_CD            = CXC.GLBL_CMPY_CD
                    AND CXC.XS_MTR_FIRST_FLG        = #xsMtrFirstFlgN#
                    AND CXC.EZCANCELFLAG            = '0'
                    --
                    AND CXC.GLBL_CMPY_CD            = PTT.GLBL_CMPY_CD(+)
                    AND CXC.PRC_SVC_TIER_TP_CD      = PTT.PRC_SVC_TIER_TP_CD(+)
                    AND PTT.EZCANCELFLAG(+)         = '0'

        ) WK_V
        ORDER BY
              PRIORITY
            , BLLG_MTR_LB_CD
            , INTG_MDSE_CD              NULLS LAST
            , XS_MTR_COPY_QTY           NULLS LAST
            , REG_MTR_LB_SORT_NUM       NULLS FIRST
            , PRC_SVC_TIER_TP_SORT_NUM
    </statement>

    <statement id="getMtrLbAggAddMachine" parameterClass="Map" resultClass="Map">
        WITH MTR_PKG_V AS ( 
            SELECT DISTINCT
                      MS.BLLG_MTR_LB_CD         AS BILLING_COUNTER_CD
                    , MS.BLLG_MTR_LB_NM         AS BILLING_COUNTER_NM
                    , MS.INTG_MDSE_CD           AS USAGE_ITEM_CD
                    , MS.INTG_MDSE_NM           AS USAGE_ITEM_NM
                    , MS.REG_MTR_LB_CD          AS HARD_COUNTER_CD
                    , MS.REG_MTR_LB_NM          AS HARD_COUNTER_NM
                    , MS.MTR_MULT_RATE          AS MTR_MULT_RATE
                    , MS.BLLG_MTR_LB_SORT_NUM
                    , MS.REG_MTR_LB_SORT_NUM
                FROM
                    PRC_MTR_PKG_MTR_STRU_V MS
                WHERE
                    MS.GLBL_CMPY_CD                     = #glblCmpyCd#
                    AND MS.MDL_ID                       = $mdlId$
                    AND MS.PRC_MTR_PKG_PK               = $prcMtrPkgPk$
                    AND MS.ACTV_FLG                     = 'Y'
                    AND MS.BLLBL_FLG                    = 'Y'
                    AND MS.MDL_MTR_EFF_FROM_DT          &lt;= #slsDt#
                    AND ( 
                        MS.MDL_MTR_EFF_THRU_DT          &gt;= #slsDt#
                        OR MS.MDL_MTR_EFF_THRU_DT       IS NULL
                    ) 
                    AND MS.BLLG_MTR_MAP_EFF_FROM_DT     &lt;= #slsDt#
                    AND ( 
                        MS.BLLG_MTR_MAP_EFF_THRU_DT     &gt;= #slsDt#
                        OR MS.BLLG_MTR_MAP_EFF_THRU_DT  IS NULL
                    ) 
                    AND MS.MTR_PKG_EFF_FROM_DT          &lt;= #slsDt#
                    AND ( 
                        MS.MTR_PKG_EFF_THRU_DT          &gt;= #slsDt#
                        OR MS.MTR_PKG_EFF_THRU_DT       IS NULL
                    ) 
                    AND MS.MTR_PKG_MDL_EFF_FROM_DT      &lt;= #slsDt#
                    AND ( 
                        MS.MTR_PKG_MDL_EFF_THRU_DT      &gt;= #slsDt#
                        OR MS.MTR_PKG_MDL_EFF_THRU_DT   IS NULL
                    )
        ) 
        SELECT
                  V.BILLING_COUNTER_CD
                , MB.MTR_LB_DESC_TXT    BILLING_COUNTER_NM
                , V.USAGE_ITEM_CD
                , V.USAGE_ITEM_NM
                , V.HARD_COUNTER_CD
                , MH.MTR_LB_DESC_TXT    HARD_COUNTER_NM
                , V.MTR_MULT_RATE
            FROM
                  MTR_PKG_V     V
                , MTR_LB        MB
                , MTR_LB        MH
            WHERE
                    MB.GLBL_CMPY_CD = #glblCmpyCd#
                AND MB.MTR_LB_CD    = V.BILLING_COUNTER_CD
                AND MB.EZCANCELFLAG = '0'
                AND MH.GLBL_CMPY_CD = #glblCmpyCd#
                AND MH.MTR_LB_CD    = V.HARD_COUNTER_CD
                AND MH.EZCANCELFLAG = '0'
                AND V.BILLING_COUNTER_CD IN
                <iterate property="bllgMtrLbCd" var="bllgMtrLbCd[]" open=" (" close=")" conjunction=",">
                    #bllgMtrLbCd[]#
                </iterate>
            ORDER BY
                  V.BLLG_MTR_LB_SORT_NUM
                , V.REG_MTR_LB_SORT_NUM
    </statement>

    <statement id="getAggContrBllgLbCdList" parameterClass="Map" resultClass="String">
        SELECT DISTINCT
                  CBM.BLLG_MTR_LB_CD
            FROM
                  DS_CONTR            C
                , DS_CONTR_DTL        CD
                , DS_CONTR_BLLG_MTR   CBM
            WHERE
                    C.GLBL_CMPY_CD        = #glblCmpyCd#
                AND C.DS_CONTR_PK         = #dsContrPk#
                AND C.DS_CONTR_CATG_CD    = #dsContrCatgCd#
                AND C.EZCANCELFLAG        = '0'
                AND C.DS_CONTR_PK         = CD.DS_CONTR_PK
                AND CD.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd#
                AND CD.EZCANCELFLAG = '0'
                AND CD.DS_CONTR_DTL_PK    = CBM.DS_CONTR_DTL_PK
                AND CBM.EZCANCELFLAG = '0'
    </statement>

    <statement id="getAggContrXsMtrAmtRate" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                  CXC.XS_MTR_AMT_RATE
            FROM
                  DS_CONTR            C
                , DS_CONTR_DTL        CD
                , DS_CONTR_BLLG_MTR   CBM
                , CONTR_XS_COPY       CXC 
            WHERE
                    C.GLBL_CMPY_CD            = #glblCmpyCd#
                AND C.DS_CONTR_PK             = #dsContrPk#
                AND C.DS_CONTR_CATG_CD        = #dsContrCatgCd#
                AND C.EZCANCELFLAG            = '0'
                AND C.DS_CONTR_PK             = CD.DS_CONTR_PK
                AND CD.DS_CONTR_DTL_TP_CD     = #dsContrDtlTpCd#
                AND CD.EZCANCELFLAG            = '0'
                AND CD.DS_CONTR_DTL_PK        = CBM.DS_CONTR_DTL_PK
                AND CBM.BLLG_MTR_LB_CD        = #bllgMtrLbCd#
                AND CBM.EZCANCELFLAG = '0'
                AND CBM.GLBL_CMPY_CD          = CXC.GLBL_CMPY_CD
                AND CBM.DS_CONTR_BLLG_MTR_PK  = CXC.DS_CONTR_BLLG_MTR_PK
                AND CXC.XS_MTR_FIRST_FLG      = #xsMtrFirstFlg#
                AND CXC.EZCANCELFLAG          = '0'
                AND ROWNUM                    = 1
    </statement>
    <statement id="getTierInfo_BandSearchForAggAddMachine" parameterClass="Map" resultClass="Map">
        SELECT
             CXC.PRC_SVC_TIER_TP_CD
            ,NULL AS PRC_SVC_TIER_TP_DESC_TXT
            ,(CXC.XS_MTR_COPY_QTY + 1) AS MIN_COPY_VOL_CNT
            ,CXC.MAX_COPY_VOL_CNT
            ,CXC.XS_MTR_AMT_RATE AS CPC_AMT_RATE
        FROM
              DS_CONTR_DTL              CD
            , DS_CONTR                  C
            , DS_CONTR_BLLG_MTR         CBM
            , CONTR_PHYS_BLLG_MTR_RELN  CBR
            , CONTR_XS_COPY             CXC
        WHERE
                CD.GLBL_CMPY_CD             = #glblCmpyCd#
            AND CD.DS_CONTR_PK              = #dsContrPk#
            AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCd#
            AND CD.EZCANCELFLAG             = '0'
            --
            AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
            AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
            AND C.EZCANCELFLAG              = '0'
            --
            AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
            AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
            AND CBM.BLLG_MTR_LB_CD          = #bllgMtrLbCd#
            AND CBM.EZCANCELFLAG            = '0'
            --
            AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
            AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
            AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
            AND CBR.EZCANCELFLAG(+)         = '0'
            --
            AND CBM.DS_CONTR_BLLG_MTR_PK    = CXC.DS_CONTR_BLLG_MTR_PK
            AND CBM.GLBL_CMPY_CD            = CXC.GLBL_CMPY_CD
            AND CXC.EZCANCELFLAG            = '0'
        ORDER BY
            CXC.XS_MTR_COPY_QTY ASC
    </statement>

    <statement id="getPrcTierSvcOfferCdFromContrForAddMachine" parameterClass="Map" resultClass="String">
        SELECT
                  TSO.PRC_TIER_SVC_OFFER_CD
            FROM
                  DS_CONTR_DTL          CD
                , DS_CONTR              C
                , DS_CONTR_BLLG_MTR     CBM
                , XS_CHRG_TP            XCT
                , PRC_TIER_SVC_OFFER    TSO
            WHERE
                    CD.GLBL_CMPY_CD             = #glblCmpyCd#
                AND CD.DS_CONTR_PK              = #dsContrPk#
                AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCd#
                AND CD.EZCANCELFLAG             = '0'
                --
                AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                AND C.EZCANCELFLAG              = '0'
                --
                AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD(+)
                AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK(+)
                AND CBM.EZCANCELFLAG(+)         = '0'
                --
                AND CBM.GLBL_CMPY_CD            = XCT.GLBL_CMPY_CD(+)
                AND CBM.XS_CHRG_TP_CD           = XCT.XS_CHRG_TP_CD(+)
                AND XCT.EZCANCELFLAG(+)         = '0'
                --
                AND XCT.GLBL_CMPY_CD            = TSO.GLBL_CMPY_CD(+)
                AND XCT.PRC_TIER_SVC_OFFER_CD   = TSO.PRC_TIER_SVC_OFFER_CD(+)
                AND TSO.EZCANCELFLAG(+)         = '0'
                AND ROWNUM                      = 1
    </statement>
    <!-- END   2017/10/25 [QC#21556, ADD] -->
    <!-- START 2018/10/10 K.Kojima [QC#28715,ADD] -->
    <statement id="getAddlChrgMdseItemTpCd" parameterClass="Map" resultClass="String">
        SELECT
            ITVS.MDSE_ITEM_TP_CD
        FROM
           ITEM_TP_VAL_SET ITVS
        WHERE
                ITVS.GLBL_CMPY_CD       = #glblCmpyCd#
            AND ITVS.ITEM_TP_CTX_TP_CD  = #itemTpCtxTpCd#
            AND ITVS.EZCANCELFLAG       = '0'
            AND ROWNUM                  = '1'
    </statement>
    <!-- END 2018/10/10 K.Kojima [QC#28715,ADD] -->


    <!-- 2019/07/18 QC#51327 Add Start -->
    <!-- <statement id="checkCreatedContract" parameterclass="Map" resultClass="Map"> -->
    <!--     SELECT -->
    <!--         CNTD.DS_CONTR_PK -->
    <!--     FROM -->
    <!--             DS_CONTR_DTL        CNTD -->
    <!--          ,  DS_CONTR            CNT -->
    <!--     WHERE -->
    <!--             CNTD.GLBL_CMPY_CD         = #glblCmpyCd# -->
    <!--         AND CNTD.DS_CONTR_DTL_PK      IN -->
    <!--         <iterate property="dsContrDtlPk" var="dsContrDtlPk[]" open=" (" close=")" conjunction=","> -->
    <!--             #dsContrDtlPk[]# -->
    <!--         </iterate> -->
    <!--         AND CNTD.EZCANCELFLAG         = '0' -->
    <!--  -->
    <!--         AND CNTD.GLBL_CMPY_CD         = CNT.GLBL_CMPY_CD -->
    <!--         AND CNTD.CPO_ORD_NUM          = CNT.CPO_ORD_NUM -->
    <!--         AND CNTD.DS_CONTR_PK          = CNT.DS_CONTR_PK -->
    <!--         AND CNT.DS_CONTR_STS_CD       &lt;&gt; #dsContrStsCd# -->
    <!--         AND CNT.EZCANCELFLAG          = '0' -->
    <!--  -->
    <!--         AND ROWNUM                    = 1 -->
    <!-- </statement> -->
    <!-- 2019/07/18 QC#51327 Add End -->
</sqlMap>
