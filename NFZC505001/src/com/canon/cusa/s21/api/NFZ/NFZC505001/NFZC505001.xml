<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NFZC505001">
    <statement id="getBizDoc" parameterClass="Map" resultClass="Map">
    <!-- START 2018/03/22 T.Kikuhara [QC#20316,MOD] -->
        SELECT
             CAIH.AP_VND_CD             AS AP_VND_CD
            ,CAIH.AP_VND_INV_NUM        AS AP_VND_INV_NUM
            ,CAIH.AP_VND_INV_SQ_NUM     AS AP_VND_INV_SQ_CD
            ,CAIH.INV_DT                AS INV_DT
            ,AIS.ACCT_INV_STS_DESC_TXT  AS ACCT_INV_STS_DESC_TXT
            ,CAIH.AC_INV_TOT_COST_AMT   AS AC_INV_TOT_COST_AMT
            ,CASE
                 WHEN EXISTS(
                      SELECT
                          1
                      FROM
                          CM_INV_PMT_HLD IPH
                      WHERE
                          CAIH.GLBL_CMPY_CD      = IPH.GLBL_CMPY_CD
                      AND CAIH.AP_VND_CD         = IPH.AP_VND_CD
                      AND CAIH.AP_VND_INV_NUM    = IPH.AP_VND_INV_NUM
                      AND CAIH.AP_VND_INV_SQ_NUM = IPH.AP_VND_INV_SQ_NUM
                      AND IPH.PMT_HLD_CD         = #pmtHldCdTherefore#
                      AND IPH.PMT_HLD_FLG        = 'Y'
                      AND IPH.EZCANCELFLAG       = '0')
                 THEN 'Hold'
                 WHEN EXISTS(
                      SELECT
                          1
                      FROM
                          CM_INV_PMT_HLD IPH
                      WHERE
                          CAIH.GLBL_CMPY_CD      = IPH.GLBL_CMPY_CD
                      AND CAIH.AP_VND_CD         = IPH.AP_VND_CD
                      AND CAIH.AP_VND_INV_NUM    = IPH.AP_VND_INV_NUM
                      AND CAIH.AP_VND_INV_SQ_NUM = IPH.AP_VND_INV_SQ_NUM
                      AND IPH.PMT_HLD_CD         = #pmtHldCdTherefore#
                      AND IPH.PMT_HLD_FLG        = 'N'
                      AND IPH.EZCANCELFLAG       = '0')
                 THEN 'Released'
                 ELSE ''
             END                       AS PMT_HLD_DESC_TXT
            ,(SELECT  PHR.PMT_HLD_RSN_DESC_TXT
               FROM   PMT_HLD_RSN PHR
               WHERE  PHR.GLBL_CMPY_CD         = #glblCmpyCd#
               AND    PHR.PMT_HLD_RSN_CD       = #pmtHldRsnCdTherefore#
               AND    PHR.EZCANCELFLAG         = '0')  AS PMT_HLD_RSN_DESC_TXT
            ,'1' AS SORT_ORDER
            ,CAIH.PRNT_VND_CD           AS AP_VND_CD
            ,(SELECT  PV.PRNT_VND_NM || ' - ' || VND.LOC_NM
               FROM   VND      VND
                     ,PRNT_VND PV
               WHERE     VND.GLBL_CMPY_CD  = #glblCmpyCd#
                     AND VND.VND_CD        = CAIH.AP_VND_CD
                     AND VND.EZCANCELFLAG  = '0'
                     AND VND.GLBL_CMPY_CD  = PV.GLBL_CMPY_CD
                     AND VND.PRNT_VND_PK   = PV.PRNT_VND_PK
                     AND PV.EZCANCELFLAG   = '0')  AS AP_VND_NM
        FROM
             CM_AP_INV_HDR  CAIH
            ,ACCT_INV_STS   AIS
        WHERE
            CAIH.GLBL_CMPY_CD      = #glblCmpyCd#
        AND CAIH.AP_VND_CD         = #apVndCd#
        AND CAIH.AP_VND_INV_NUM    = #apVndInvNum#
        AND CAIH.AP_VND_INV_SQ_NUM = #apVndInvSqNum#
        AND CAIH.EZCANCELFLAG      = '0'
        AND CAIH.GLBL_CMPY_CD      = AIS.GLBL_CMPY_CD
        AND CAIH.ACCT_INV_STS_CD   = AIS.ACCT_INV_STS_CD
        AND AIS.EZCANCELFLAG       = '0'
        AND ROWNUM                 = 1
        UNION ALL
        SELECT
             CMI.AP_VND_CD                     AS AP_VND_CD
            ,CMI.AP_INV_NUM                    AS AP_VND_INV_NUM
            ,'00'                              AS AP_VND_INV_SQ_CD
            ,CMI.INV_DT                        AS INV_DT
            ,AIS.ACCT_INV_STS_DESC_TXT         AS ACCT_INV_STS_DESC_TXT
            ,CMI.AP_INV_AMT                    AS AC_INV_TOT_COST_AMT
            ,NULL                              AS PMT_HLD_DESC_TXT
            ,NULL                              AS PMT_HLD_RSN_DESC_TXT
            ,'2'                               AS SORT_ORDER
            ,(SELECT  PV.PRNT_VND_CD
               FROM   VND      VND
                     ,PRNT_VND PV
               WHERE     VND.GLBL_CMPY_CD = #glblCmpyCd#
                     AND VND.VND_CD       = CMI.AP_VND_CD
                     AND VND.EZCANCELFLAG = '0'
                     AND VND.GLBL_CMPY_CD = PV.GLBL_CMPY_CD
                     AND VND.PRNT_VND_PK  = PV.PRNT_VND_PK
                     AND PV.EZCANCELFLAG  = '0')  AS AP_VND_CD
            ,(SELECT  PV.PRNT_VND_NM || ' - ' || VND.LOC_NM
               FROM   VND      VND
                     ,PRNT_VND PV
               WHERE     VND.GLBL_CMPY_CD = #glblCmpyCd#
                     AND VND.VND_CD       = CMI.AP_VND_CD
                     AND VND.EZCANCELFLAG = '0'
                     AND VND.GLBL_CMPY_CD = PV.GLBL_CMPY_CD
                     AND VND.PRNT_VND_PK  = PV.PRNT_VND_PK
                     AND PV.EZCANCELFLAG  = '0')  AS AP_VND_NM
        FROM
             CM_MAINT_INV CMI
            ,ACCT_INV_STS AIS
        WHERE
            CMI.GLBL_CMPY_CD        = #glblCmpyCd#
        AND CMI.EZCANCELFLAG        = '0'
        AND CMI.AP_VND_CD           = #apVndCd#
        AND CMI.AP_INV_NUM          = #apVndInvNum#
        AND CMI.AP_MAINT_INV_STS_CD = AIS.ACCT_INV_STS_CD
        AND AIS.EZCANCELFLAG        = '0'
        AND ROWNUM                  = 1
    ORDER BY SORT_ORDER ASC
    <!-- END 2018/03/22 T.Kikuhara [QC#20316,MOD] -->
    </statement>

    <statement id="getIdxAttrbInfo" parameterClass="Map" resultClass="Map">
        SELECT
            DMI.IDX_ATTRB_TRGT_COL_NM
            ,DMI.DOC_MGT_FLD_CD
            ,DMF.DOC_MGT_FLD_DESC_TXT
            ,DMF.DOC_MGT_FLD_NUM
            ,DMF.DOC_MGT_FLD_TP_CD
            ,DMC.DOC_MGT_CATG_CD
            ,DMC.DOC_MGT_CATG_NUM
        FROM
            DOC_MGT_IDX_ATTRB_DFN DMI
            ,DOC_MGT_FLD          DMF
            ,DOC_MGT_CATG         DMC
        WHERE
            DMI.GLBL_CMPY_CD              = #glblCmpyCd#
        AND DMI.ACTV_FLG                  = 'Y'
        AND DMI.DOC_MGT_CATG_CD           = #docMgtCatgCd#
        <isNull property="trgtTblNm">
            AND DMI.IDX_ATTRB_TRGT_TBL_NM     IS NULL
        </isNull>
        <isNotNull property="trgtTblNm">
            AND DMI.IDX_ATTRB_TRGT_TBL_NM = #trgtTblNm#
        </isNotNull>
        AND DMI.EZCANCELFLAG              = '0'
        AND DMI.GLBL_CMPY_CD              = DMF.GLBL_CMPY_CD
        AND DMI.DOC_MGT_FLD_CD            = DMF.DOC_MGT_FLD_CD
        AND DMF.EZCANCELFLAG              = '0'
        AND DMI.GLBL_CMPY_CD              = DMC.GLBL_CMPY_CD
        AND DMI.DOC_MGT_CATG_CD           = DMC.DOC_MGT_CATG_CD
        AND DMC.EZCANCELFLAG              = '0'
    </statement>

    <statement id="getBizDocDtl" parameterClass="Map" resultClass="Map">
    <!-- START 2018/03/22 T.Kikuhara [QC#20316,MOD] -->
        SELECT
            CIAD.CM_INV_ACCT_DIST_LINE_NUM        CM_INV_ACCT_DIST_LINE_NUM   <!-- line Number -->
            ,APLT.AP_LINE_TP_DESC_TXT             AP_LINE_TP_DESC_TXT         <!-- Line Type -->
            ,CIAD.MDSE_CD                         MDSE_CD                     <!-- Item -->
            ,CIAD.MDSE_DESC_SHORT_TXT             MDSE_DESC_SHORT_TXT         <!-- Line Description -->
            ,NVL (CAID.AC_SC_TOT_INV_AMT, CIAD.AC_INV_JRNL_COST_AMT)
                                                  AC_INV_JRNL_COST_AMT        <!-- Line Amount -->
            ,CIAD.UOM_CD                          UOM_CD                      <!-- Unit Of Measure -->
            ,DECODE(CIAD.DR_COA_CMPY_CD,NULL,NULL,CIAD.DR_COA_CMPY_CD || '.' ||
                                                  CIAD.DR_COA_BR_CD   || '.' ||
                                                  CIAD.DR_COA_CC_CD   || '.' ||
                                                  CIAD.DR_COA_ACCT_CD || '.' ||
                                                  CIAD.DR_COA_PROD_CD || '.' ||
                                                  CIAD.DR_COA_CH_CD   || '.' ||
                                                  CIAD.DR_COA_AFFL_CD || '.' ||
                                                  CIAD.DR_COA_PROJ_CD || '.' ||
                                                  CIAD.DR_COA_EXTN_CD)
                                                  XX_CMNT_TXT                 <!-- Charge Account -->
            ,CIAD.AP_ACCT_DESC_TXT                AP_ACCT_DESC_TXT            <!-- Account Description -->
            ,NVL(CIAD.ENT_DEAL_NET_UNIT_PRC_AMT, 0)
                                                  ENT_DEAL_NET_UNIT_PRC_AMT   <!-- Unit Price -->
            ,CIAD.INV_QTY                         INV_QTY                     <!-- Invoice Quantity -->
            ,CIAD.PO_QTY                          PO_QTY                      <!-- Ordered Quantity -->
            ,CIAD.INV_RCV_QTY                     INV_RCV_QTY                 <!-- Received Quantity -->
            ,CIAD.AP_REJ_QTY                      AP_REJ_QTY                  <!-- Rejected Quantity -->
            ,CIAD.AP_BILL_QTY                     AP_BILL_QTY                 <!-- Billed Quantity -->
            ,CIAD.CONTR_NUM                       CONTR_NUM                   <!-- Contract -->
            ,CIAD.CUST_DLR_CD                     CUST_DLR_CD                 <!-- Dealer Code -->
            ,CIAD.SER_NUM                         SER_NUM                     <!-- Serial Number -->
            ,CIAD.CSMP_INV_NUM                    CSMP_INV_NUM                <!-- CSMP Invoice -->
            ,DECODE(
                 ISTL_LOC_FIRST_LINE_ADDR ||
                 ISTL_LOC_FL_NM           ||
                 ISTL_LOC_CTY_ADDR        ||
                 ISTL_LOC_ST_CD           ||
                 ISTL_LOC_POST_CD
                ,NULL
                ,NULL
                ,ISTL_LOC_FIRST_LINE_ADDR || ', '||
                 ISTL_LOC_FL_NM           || ', '||
                 ISTL_LOC_CTY_ADDR        || ', '||
                 ISTL_LOC_ST_CD           || ', '||
                 ISTL_LOC_POST_CD)                ISTL_LOC                    <!-- Install Location -->
        FROM
            CM_INV_ACCT_DIST CIAD
            ,CM_AP_INV_DTL   CAID
            ,AP_LINE_TP      APLT
        WHERE
            CIAD.GLBL_CMPY_CD                   =     #glblCmpyCd#
        AND CIAD.AP_VND_CD                      =     #apVndCd#
        AND CIAD.AP_VND_INV_NUM                 =     #apVndInvNum#
        AND CIAD.AP_LINE_TP_CD                  !=    #apLineTpCdVariance#
        AND CIAD.EZCANCELFLAG                   =     '0'
        AND CIAD.GLBL_CMPY_CD                   =     CAID.GLBL_CMPY_CD(+)
        AND CIAD.AP_VND_CD                      =     CAID.AP_VND_CD(+)
        AND CIAD.AP_VND_INV_NUM                 =     CAID.AP_VND_INV_NUM(+)
        AND CIAD.AP_VND_INV_SQ_NUM              =     CAID.AP_VND_INV_SQ_NUM(+)
        AND CIAD.AP_VND_INV_LINE_NUM            =     CAID.AP_VND_INV_LINE_NUM(+)
        AND CAID.EZCANCELFLAG(+)                =     '0'
        AND CIAD.GLBL_CMPY_CD                   =     APLT.GLBL_CMPY_CD
        AND CIAD.AP_LINE_TP_CD                  =     APLT.AP_LINE_TP_CD
        AND APLT.EZCANCELFLAG                   =     '0'
        ORDER BY
            CM_INV_ACCT_DIST_LINE_NUM
    <!-- END 2018/03/22 T.Kikuhara [QC#20316,MOD] -->
    </statement>
</sqlMap>