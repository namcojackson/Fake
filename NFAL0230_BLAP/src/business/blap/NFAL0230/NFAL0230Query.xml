<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NFAL0230Query">

    <typeAlias alias="NFAL0230_ASMsg"   type="business.blap.NFAL0230.NFAL0230_ASMsg"/>
    
    <statement id="getTopLevelValue" parameterClass="Map" resultClass="Map">

    SELECT  
        COA_VAL
       ,COA_VAL_TXT
    FROM
          (
        <isNotNull property="seg2Flg">
        SELECT
            W.PRNT_COA_VAL_CD                                 COA_VAL
           ,W.PRNT_COA_VAL_CD||'     '||MAX(COA.COA_DESC_TXT) COA_VAL_TXT
        FROM
            (SELECT PRNT_COA_VAL_CD
               FROM COA_HRCH
              WHERE 
                    GLBL_CMPY_CD = #glblCmpyCd#
                AND EZCANCELFLAG = '0'
                AND COA_SEG_NM   = #segNm#
              GROUP BY PRNT_COA_VAL_CD)     W

            , (SELECT PCB.COA_BR_CD         COA_CD
                     ,PCB.COA_BR_DESC_TXT   COA_DESC_TXT
                 FROM PRNT_COA_BR PCB
                WHERE 
                      PCB.GLBL_CMPY_CD = #glblCmpyCd#
                  AND PCB.EZCANCELFLAG = '0'
               UNION ALL
               SELECT CB.COA_BR_CD         COA_CD
                     ,CB.COA_BR_DESC_TXT   COA_DESC_TXT
                 FROM COA_BR CB
                WHERE 
                      CB.GLBL_CMPY_CD = #glblCmpyCd#
                  AND CB.EZCANCELFLAG = '0')   COA
            , COA_HRCH      CH
        WHERE
            W.PRNT_COA_VAL_CD   &lt;&gt; #strKome#
        AND W.PRNT_COA_VAL_CD   = COA.COA_CD
        AND CH.GLBL_CMPY_CD(+)  = #glblCmpyCd#
        AND W.PRNT_COA_VAL_CD   = CH.CHILD_COA_VAL_CD(+)
        AND CH.COA_SEG_NM(+)    = #segNm#
        AND CH.CHILD_COA_VAL_CD IS NULL
        AND CH.EZCANCELFLAG(+)  = '0'
        GROUP BY 
            W.PRNT_COA_VAL_CD
        </isNotNull>
        <isNotNull property="seg3Flg">
        SELECT
            W.PRNT_COA_VAL_CD                                 COA_VAL
           ,W.PRNT_COA_VAL_CD||'     '||MAX(COA.COA_DESC_TXT) COA_VAL_TXT
        FROM
            (SELECT PRNT_COA_VAL_CD
               FROM COA_HRCH
              WHERE 
                    GLBL_CMPY_CD = #glblCmpyCd#
                AND EZCANCELFLAG = '0'
                AND COA_SEG_NM   = #segNm#
              GROUP BY PRNT_COA_VAL_CD)     W

            , (SELECT PCC.COA_CC_CD         COA_CD
                     ,PCC.COA_CC_DESC_TXT   COA_DESC_TXT
                 FROM PRNT_COA_CC PCC
                WHERE PCC.GLBL_CMPY_CD = #glblCmpyCd#
                  AND PCC.EZCANCELFLAG = '0'
               UNION ALL
               SELECT CC.COA_CC_CD         COA_CD
                     ,CC.COA_CC_DESC_TXT   COA_DESC_TXT
                 FROM COA_CC CC
                WHERE CC.GLBL_CMPY_CD  = #glblCmpyCd#
                  AND CC.EZCANCELFLAG  = '0')   COA
            , COA_HRCH      CH
        WHERE
            W.PRNT_COA_VAL_CD   &lt;&gt; #strKome#
        AND W.PRNT_COA_VAL_CD   = COA.COA_CD
        AND CH.GLBL_CMPY_CD(+)  = #glblCmpyCd#
        AND W.PRNT_COA_VAL_CD   = CH.CHILD_COA_VAL_CD(+)
        AND CH.COA_SEG_NM(+)    = #segNm#
        AND CH.CHILD_COA_VAL_CD IS NULL
        AND CH.EZCANCELFLAG(+)  = '0'
        GROUP BY 
            W.PRNT_COA_VAL_CD
        </isNotNull>
        <isNotNull property="seg4Flg">
        SELECT
            W.PRNT_COA_VAL_CD                                 COA_VAL
           ,W.PRNT_COA_VAL_CD||'     '||MAX(COA.COA_DESC_TXT) COA_VAL_TXT
        FROM
            (SELECT PRNT_COA_VAL_CD
               FROM COA_HRCH
              WHERE 
                    GLBL_CMPY_CD = #glblCmpyCd#
                AND EZCANCELFLAG = '0'
                AND COA_SEG_NM   = #segNm#
              GROUP BY PRNT_COA_VAL_CD)     W

            , (SELECT PCA.COA_ACCT_CD         COA_CD
                     ,PCA.COA_ACCT_DESC_TXT   COA_DESC_TXT
                 FROM PRNT_COA_ACCT PCA
                WHERE PCA.GLBL_CMPY_CD = #glblCmpyCd#
                  AND PCA.EZCANCELFLAG = '0'
               UNION ALL
               SELECT CA.COA_ACCT_CD         COA_CD
                     ,CA.COA_ACCT_DESC_TXT   COA_DESC_TXT
                 FROM COA_ACCT CA
                WHERE CA.GLBL_CMPY_CD  = #glblCmpyCd#
                  AND CA.EZCANCELFLAG  = '0')   COA
            , COA_HRCH      CH
        WHERE
             W.PRNT_COA_VAL_CD   &lt;&gt; #strKome#
         AND W.PRNT_COA_VAL_CD   = COA.COA_CD
         AND CH.GLBL_CMPY_CD(+)  = #glblCmpyCd#
         AND W.PRNT_COA_VAL_CD   = CH.CHILD_COA_VAL_CD(+)
         AND CH.COA_SEG_NM(+)    = #segNm#
         AND CH.CHILD_COA_VAL_CD IS NULL
         AND CH.EZCANCELFLAG(+)  = '0'
        GROUP BY 
            W.PRNT_COA_VAL_CD
        </isNotNull>
        <isNotNull property="seg5Flg">
            SELECT
                W.PRNT_COA_VAL_CD                                 COA_VAL
               ,W.PRNT_COA_VAL_CD||'     '||MAX(COA.COA_DESC_TXT) COA_VAL_TXT
            FROM
                (SELECT PRNT_COA_VAL_CD
                   FROM COA_HRCH
                  WHERE 
                        GLBL_CMPY_CD = #glblCmpyCd#
                    AND EZCANCELFLAG = '0'
                    AND COA_SEG_NM   = #segNm#
                  GROUP BY PRNT_COA_VAL_CD)     W

            , (SELECT PCP.COA_PROD_CD         COA_CD
                     ,PCP.COA_PROD_DESC_TXT   COA_DESC_TXT
                 FROM PRNT_COA_PROD PCP
                WHERE PCP.GLBL_CMPY_CD = #glblCmpyCd#
                  AND PCP.EZCANCELFLAG = '0'
               UNION ALL
               SELECT CP.COA_PROD_CD         COA_CD
                     ,CP.COA_PROD_DESC_TXT   COA_DESC_TXT
                 FROM COA_PROD CP
                WHERE CP.GLBL_CMPY_CD  = #glblCmpyCd#
                  AND CP.EZCANCELFLAG  = '0')   COA
            , COA_HRCH      CH
        WHERE
            W.PRNT_COA_VAL_CD   &lt;&gt; #strKome#
        AND W.PRNT_COA_VAL_CD   = COA.COA_CD
        AND CH.GLBL_CMPY_CD(+)  = #glblCmpyCd#
        AND W.PRNT_COA_VAL_CD   = CH.CHILD_COA_VAL_CD(+)
        AND CH.COA_SEG_NM(+)    = #segNm#
        AND CH.CHILD_COA_VAL_CD IS NULL
        AND CH.EZCANCELFLAG(+)  = '0'
        GROUP BY 
            W.PRNT_COA_VAL_CD
        </isNotNull>
        <isNotNull property="seg6Flg">
            SELECT
                W.PRNT_COA_VAL_CD                                 COA_VAL
               ,W.PRNT_COA_VAL_CD||'     '||MAX(COA.COA_DESC_TXT) COA_VAL_TXT
            FROM
                (SELECT PRNT_COA_VAL_CD
                   FROM COA_HRCH
                  WHERE 
                        GLBL_CMPY_CD = #glblCmpyCd#
                    AND EZCANCELFLAG = '0'
                    AND COA_SEG_NM   = #segNm#
                  GROUP BY PRNT_COA_VAL_CD)     W

            , (SELECT PCC.COA_CH_CD         COA_CD
                     ,PCC.COA_CH_DESC_TXT   COA_DESC_TXT
                 FROM PRNT_COA_CH PCC
                WHERE PCC.GLBL_CMPY_CD = #glblCmpyCd#
                  AND PCC.EZCANCELFLAG = '0'
               UNION ALL
               SELECT CC.COA_CH_CD         COA_CD
                     ,CC.COA_CH_DESC_TXT   COA_DESC_TXT
                 FROM COA_CH CC
                WHERE CC.GLBL_CMPY_CD  = #glblCmpyCd#
                  AND CC.EZCANCELFLAG  = '0')   COA
            , COA_HRCH      CH
        WHERE
            W.PRNT_COA_VAL_CD   &lt;&gt; #strKome#
        AND W.PRNT_COA_VAL_CD   = COA.COA_CD
        AND CH.GLBL_CMPY_CD(+)  = #glblCmpyCd#
        AND W.PRNT_COA_VAL_CD   = CH.CHILD_COA_VAL_CD(+)
        AND CH.COA_SEG_NM(+)    = #segNm#
        AND CH.CHILD_COA_VAL_CD IS NULL
        AND CH.EZCANCELFLAG(+)  = '0'
        GROUP BY 
            W.PRNT_COA_VAL_CD
        </isNotNull>
        <isNotNull property="seg7Flg">
            SELECT
                W.PRNT_COA_VAL_CD                                 COA_VAL
               ,W.PRNT_COA_VAL_CD||'     '||MAX(COA.COA_DESC_TXT) COA_VAL_TXT
            FROM
                (SELECT PRNT_COA_VAL_CD
                   FROM COA_HRCH
                  WHERE 
                        GLBL_CMPY_CD = #glblCmpyCd#
                    AND EZCANCELFLAG = '0'
                    AND COA_SEG_NM   = #segNm#
                  GROUP BY PRNT_COA_VAL_CD)     W

            , (SELECT PCA.COA_AFFL_CD         COA_CD
                     ,PCA.COA_AFFL_DESC_TXT   COA_DESC_TXT
                 FROM PRNT_COA_AFFL PCA
                WHERE PCA.GLBL_CMPY_CD = #glblCmpyCd#
                  AND PCA.EZCANCELFLAG = '0'
               UNION ALL
               SELECT CA.COA_AFFL_CD         COA_CD
                     ,CA.COA_AFFL_DESC_TXT   COA_DESC_TXT
                 FROM COA_AFFL CA
                WHERE CA.GLBL_CMPY_CD  = #glblCmpyCd#
                  AND CA.EZCANCELFLAG  = '0')   COA
            , COA_HRCH      CH
        WHERE
            W.PRNT_COA_VAL_CD   &lt;&gt; #strKome#
        AND W.PRNT_COA_VAL_CD   = COA.COA_CD
        AND CH.GLBL_CMPY_CD(+)  = #glblCmpyCd#
        AND W.PRNT_COA_VAL_CD   = CH.CHILD_COA_VAL_CD(+)
        AND CH.COA_SEG_NM(+)    = #segNm#
        AND CH.CHILD_COA_VAL_CD IS NULL
        AND CH.EZCANCELFLAG(+)  = '0'
        GROUP BY 
            W.PRNT_COA_VAL_CD
        </isNotNull>
        <isNotNull property="seg8Flg">
            SELECT
                W.PRNT_COA_VAL_CD                                 COA_VAL
               ,W.PRNT_COA_VAL_CD||'     '||MAX(COA.COA_DESC_TXT) COA_VAL_TXT
            FROM
                (SELECT PRNT_COA_VAL_CD
                   FROM COA_HRCH
                  WHERE 
                        GLBL_CMPY_CD = #glblCmpyCd#
                    AND EZCANCELFLAG = '0'
                    AND COA_SEG_NM   = #segNm#
                  GROUP BY PRNT_COA_VAL_CD)     W

            , (SELECT PCP.COA_PROJ_CD         COA_CD
                     ,PCP.COA_PROJ_DESC_TXT   COA_DESC_TXT
                 FROM PRNT_COA_PROJ PCP
                WHERE PCP.GLBL_CMPY_CD = #glblCmpyCd#
                  AND PCP.EZCANCELFLAG = '0'
               UNION ALL
               SELECT CP.COA_PROJ_CD         COA_CD
                     ,CP.COA_PROJ_DESC_TXT   COA_DESC_TXT
                 FROM COA_PROJ CP
                WHERE CP.GLBL_CMPY_CD  = #glblCmpyCd#
                  AND CP.EZCANCELFLAG  = '0')   COA
            , COA_HRCH      CH
        WHERE
            W.PRNT_COA_VAL_CD   &lt;&gt; #strKome#
        AND W.PRNT_COA_VAL_CD   = COA.COA_CD
        AND CH.GLBL_CMPY_CD(+)  = #glblCmpyCd#
        AND W.PRNT_COA_VAL_CD   = CH.CHILD_COA_VAL_CD(+)
        AND CH.COA_SEG_NM(+)    = #segNm#
        AND CH.CHILD_COA_VAL_CD IS NULL
        AND CH.EZCANCELFLAG(+)  = '0'
        GROUP BY 
            W.PRNT_COA_VAL_CD
        </isNotNull>
        <isNotNull property="seg9Flg">
            SELECT
                W.PRNT_COA_VAL_CD                                 COA_VAL
               ,W.PRNT_COA_VAL_CD||'     '||MAX(COA.COA_DESC_TXT) COA_VAL_TXT
            FROM
                (SELECT PRNT_COA_VAL_CD
                   FROM COA_HRCH
                  WHERE 
                        GLBL_CMPY_CD = #glblCmpyCd#
                    AND EZCANCELFLAG = '0'
                    AND COA_SEG_NM   = #segNm#
                  GROUP BY PRNT_COA_VAL_CD)     W

            , (SELECT PCE.COA_EXTN_CD         COA_CD
                     ,PCE.COA_EXTN_DESC_TXT   COA_DESC_TXT
                 FROM PRNT_COA_EXTN PCE
                WHERE PCE.GLBL_CMPY_CD = #glblCmpyCd#
                  AND PCE.EZCANCELFLAG = '0'
               UNION ALL
               SELECT CE.COA_EXTN_CD         COA_CD
                     ,CE.COA_EXTN_DESC_TXT   COA_DESC_TXT
                 FROM COA_EXTN CE
                WHERE CE.GLBL_CMPY_CD  = #glblCmpyCd#
                  AND CE.EZCANCELFLAG  = '0')   COA
            , COA_HRCH      CH
        WHERE
            W.PRNT_COA_VAL_CD   &lt;&gt; #strKome#
        AND W.PRNT_COA_VAL_CD   = COA.COA_CD
        AND CH.GLBL_CMPY_CD(+)  = #glblCmpyCd#
        AND W.PRNT_COA_VAL_CD   = CH.CHILD_COA_VAL_CD(+)
        AND CH.COA_SEG_NM(+)    = #segNm#
        AND CH.CHILD_COA_VAL_CD IS NULL
        AND CH.EZCANCELFLAG(+)  = '0'
        GROUP BY 
            W.PRNT_COA_VAL_CD
        </isNotNull>
          ) 
    </statement>
    <statement id="getTreeInfo" parameterClass="Map" resultMap="result.getTreeInfo">

    SELECT  
        #topCoaValTxt#  T0
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 1) > 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 2) > 0 THEN 
                SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 1) + 1, INSTR(TREE_INFO.TREE_PATH,'~', 1, 2)-2)
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 1) + 1)
            END
        ELSE '' END T1
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 2) > 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 3) > 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 2) + 1, INSTR(TREE_INFO.TREE_PATH,'~', 1, 3) - INSTR(TREE_INFO.TREE_PATH,'~', 1, 2) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 2) + 1)
            END
        ELSE '' END T2
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 3) > 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 4) > 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 3) + 1, INSTR(TREE_INFO.TREE_PATH,'~', 1, 4) - INSTR(TREE_INFO.TREE_PATH,'~', 1, 3) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 3) + 1)
            END
        ELSE '' END T3
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 4) > 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 5) > 0 THEN 
             SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 4) + 1, INSTR(TREE_INFO.TREE_PATH,'~', 1, 5) - INSTR(TREE_INFO.TREE_PATH,'~', 1, 4) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 4) + 1)
            END
        ELSE '' END T4
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 5) > 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 6) > 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 5) + 1, INSTR(TREE_INFO.TREE_PATH,'~', 1, 6) - INSTR(TREE_INFO.TREE_PATH,'~', 1, 5) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 5) + 1)
            END
        ELSE '' END T5
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 6) > 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 7) > 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 6) + 1, INSTR(TREE_INFO.TREE_PATH,'~', 1, 7) - INSTR(TREE_INFO.TREE_PATH,'~', 1, 6) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 6) + 1)
            END
        ELSE '' END T6
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 7) > 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 8) > 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 7) + 1, INSTR(TREE_INFO.TREE_PATH,'~', 1, 8) - INSTR(TREE_INFO.TREE_PATH,'~', 1, 7) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 7) + 1)
            END
        ELSE '' END T7
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 8) > 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 9) > 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 8) + 1, INSTR(TREE_INFO.TREE_PATH,'~', 1, 9) - INSTR(TREE_INFO.TREE_PATH,'~', 1, 8) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 8) + 1)
            END
        ELSE '' END T8
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 9) > 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 10) > 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 9) + 1, INSTR(TREE_INFO.TREE_PATH,'~', 1, 10) - INSTR(TREE_INFO.TREE_PATH,'~', 1, 9) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 9) + 1)
            END
        ELSE '' END T9
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 10) > 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'~', 1, 11) > 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 10) + 1, INSTR(TREE_INFO.TREE_PATH,'~', 1, 11) - INSTR(TREE_INFO.TREE_PATH,'~', 1, 10) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'~', 1, 10) + 1)
            END
        ELSE '' END T10
    FROM
          (
          
        <isNotNull property="seg2Flg">
            SELECT
                CH.PRNT_COA_VAL_CD          PRNT_COA_VAL_CD
               ,CH.CHILD_COA_VAL_CD         CHILD_COA_VAL_CD
               ,SYS_CONNECT_BY_PATH (CH.CHILD_COA_VAL_CD||'     '|| COA.COA_DESC_TXT, '~') TREE_PATH
            FROM 
               COA_HRCH CH
              ,(SELECT PCB.COA_BR_CD            COA_CD
                      ,PCB.COA_BR_DESC_TXT      COA_DESC_TXT
                  FROM PRNT_COA_BR PCB
                 WHERE PCB.GLBL_CMPY_CD = #glblCmpyCd#
                   AND PCB.EZCANCELFLAG = '0'
               UNION ALL
                SELECT CB.COA_BR_CD            COA_CD
                      ,CB.COA_BR_DESC_TXT      COA_DESC_TXT
                  FROM COA_BR CB
                 WHERE CB.GLBL_CMPY_CD = #glblCmpyCd#
                   AND CB.EZCANCELFLAG = '0')   COA
            WHERE
                  CH.GLBL_CMPY_CD      = #glblCmpyCd#
              AND CH.EZCANCELFLAG      = '0'
              AND CH.COA_SEG_NM        = #segNm#
              AND CH.CHILD_COA_VAL_CD  = COA.COA_CD 
              
            START WITH CH.PRNT_COA_VAL_CD = #topCoaValCd#
            CONNECT BY NOCYCLE PRIOR CH.CHILD_COA_VAL_CD = CH.PRNT_COA_VAL_CD
                                 AND CH.CHILD_COA_VAL_CD &lt;&gt; CH.PRNT_COA_VAL_CD
                                 AND CH.COA_SEG_NM       = CH.COA_SEG_NM
        </isNotNull>
        <isNotNull property="seg3Flg">
            SELECT
                CH.PRNT_COA_VAL_CD          PRNT_COA_VAL_CD
               ,CH.CHILD_COA_VAL_CD         CHILD_COA_VAL_CD
               ,SYS_CONNECT_BY_PATH (CH.CHILD_COA_VAL_CD||'     '|| COA.COA_DESC_TXT, '~') TREE_PATH
            FROM 
               COA_HRCH CH
            , (SELECT PCC.COA_CC_CD         COA_CD
                     ,PCC.COA_CC_DESC_TXT   COA_DESC_TXT
                 FROM PRNT_COA_CC PCC
                WHERE PCC.GLBL_CMPY_CD = #glblCmpyCd#
                  AND PCC.EZCANCELFLAG = '0'
               UNION ALL
               SELECT CC.COA_CC_CD         COA_CD
                     ,CC.COA_CC_DESC_TXT   COA_DESC_TXT
                 FROM COA_CC CC
                WHERE CC.GLBL_CMPY_CD  = #glblCmpyCd#
                  AND CC.EZCANCELFLAG  = '0')   COA
            WHERE
                  CH.GLBL_CMPY_CD      = #glblCmpyCd#
              AND CH.EZCANCELFLAG      = '0'
              AND CH.COA_SEG_NM        = #segNm#
              AND CH.CHILD_COA_VAL_CD  = COA.COA_CD 
              
            START WITH CH.PRNT_COA_VAL_CD = #topCoaValCd#
            CONNECT BY NOCYCLE PRIOR CH.CHILD_COA_VAL_CD = CH.PRNT_COA_VAL_CD
                                 AND CH.CHILD_COA_VAL_CD &lt;&gt; CH.PRNT_COA_VAL_CD
                                 AND CH.COA_SEG_NM       = CH.COA_SEG_NM
        </isNotNull>
        <isNotNull property="seg4Flg">
            SELECT
                CH.PRNT_COA_VAL_CD          PRNT_COA_VAL_CD
               ,CH.CHILD_COA_VAL_CD         CHILD_COA_VAL_CD
               ,SYS_CONNECT_BY_PATH (CH.CHILD_COA_VAL_CD||'     '|| COA.COA_DESC_TXT, '~') TREE_PATH
            FROM 
               COA_HRCH CH
            , (SELECT PCA.COA_ACCT_CD         COA_CD
                     ,PCA.COA_ACCT_DESC_TXT   COA_DESC_TXT
                 FROM PRNT_COA_ACCT PCA
                WHERE PCA.GLBL_CMPY_CD = #glblCmpyCd#
                  AND PCA.EZCANCELFLAG = '0'
               UNION ALL
               SELECT CA.COA_ACCT_CD         COA_CD
                     ,CA.COA_ACCT_DESC_TXT   COA_DESC_TXT
                 FROM COA_ACCT CA
                WHERE CA.GLBL_CMPY_CD  = #glblCmpyCd#
                  AND CA.EZCANCELFLAG  = '0')   COA
            WHERE
                  CH.GLBL_CMPY_CD      = #glblCmpyCd#
              AND CH.EZCANCELFLAG      = '0'
              AND CH.COA_SEG_NM        = #segNm#
              AND CH.CHILD_COA_VAL_CD  = COA.COA_CD 
              
            START WITH CH.PRNT_COA_VAL_CD = #topCoaValCd#
            CONNECT BY NOCYCLE PRIOR CH.CHILD_COA_VAL_CD = CH.PRNT_COA_VAL_CD
                                 AND CH.CHILD_COA_VAL_CD &lt;&gt; CH.PRNT_COA_VAL_CD
                                 AND CH.COA_SEG_NM       = CH.COA_SEG_NM
        </isNotNull>
        <isNotNull property="seg5Flg">
            SELECT
                CH.PRNT_COA_VAL_CD          PRNT_COA_VAL_CD
               ,CH.CHILD_COA_VAL_CD         CHILD_COA_VAL_CD
               ,SYS_CONNECT_BY_PATH (CH.CHILD_COA_VAL_CD||'     '|| COA.COA_DESC_TXT, '~') TREE_PATH
            FROM 
               COA_HRCH CH
            , (SELECT PCP.COA_PROD_CD         COA_CD
                     ,PCP.COA_PROD_DESC_TXT   COA_DESC_TXT
                 FROM PRNT_COA_PROD PCP
                WHERE PCP.GLBL_CMPY_CD = #glblCmpyCd#
                  AND PCP.EZCANCELFLAG = '0'
               UNION ALL
               SELECT CP.COA_PROD_CD         COA_CD
                     ,CP.COA_PROD_DESC_TXT   COA_DESC_TXT
                 FROM COA_PROD CP
                WHERE CP.GLBL_CMPY_CD  = #glblCmpyCd#
                  AND CP.EZCANCELFLAG  = '0')   COA
            WHERE
                  CH.GLBL_CMPY_CD      = #glblCmpyCd#
              AND CH.EZCANCELFLAG      = '0'
              AND CH.COA_SEG_NM        = #segNm#
              AND CH.CHILD_COA_VAL_CD  = COA.COA_CD 
              
            START WITH CH.PRNT_COA_VAL_CD = #topCoaValCd#
            CONNECT BY NOCYCLE PRIOR CH.CHILD_COA_VAL_CD = CH.PRNT_COA_VAL_CD
                                 AND CH.CHILD_COA_VAL_CD &lt;&gt; CH.PRNT_COA_VAL_CD
                                 AND CH.COA_SEG_NM       = CH.COA_SEG_NM
        </isNotNull>
        <isNotNull property="seg6Flg">
            SELECT
                CH.PRNT_COA_VAL_CD          PRNT_COA_VAL_CD
               ,CH.CHILD_COA_VAL_CD         CHILD_COA_VAL_CD
               ,SYS_CONNECT_BY_PATH (CH.CHILD_COA_VAL_CD||'     '|| COA.COA_DESC_TXT, '~') TREE_PATH
            FROM 
               COA_HRCH CH
            , (SELECT PCC.COA_CH_CD         COA_CD
                     ,PCC.COA_CH_DESC_TXT   COA_DESC_TXT
                 FROM PRNT_COA_CH PCC
                WHERE PCC.GLBL_CMPY_CD = #glblCmpyCd#
                  AND PCC.EZCANCELFLAG = '0'
               UNION ALL
               SELECT CC.COA_CH_CD         COA_CD
                     ,CC.COA_CH_DESC_TXT   COA_DESC_TXT
                 FROM COA_CH CC
                WHERE CC.GLBL_CMPY_CD  = #glblCmpyCd#
                  AND CC.EZCANCELFLAG  = '0')   COA
            WHERE
                  CH.GLBL_CMPY_CD      = #glblCmpyCd#
              AND CH.EZCANCELFLAG      = '0'
              AND CH.COA_SEG_NM        = #segNm#
              AND CH.CHILD_COA_VAL_CD  = COA.COA_CD 
              
            START WITH CH.PRNT_COA_VAL_CD = #topCoaValCd#
            CONNECT BY NOCYCLE PRIOR CH.CHILD_COA_VAL_CD = CH.PRNT_COA_VAL_CD
                                 AND CH.CHILD_COA_VAL_CD &lt;&gt; CH.PRNT_COA_VAL_CD
                                 AND CH.COA_SEG_NM       = CH.COA_SEG_NM
        </isNotNull>
        <isNotNull property="seg7Flg">
            SELECT
                CH.PRNT_COA_VAL_CD          PRNT_COA_VAL_CD
               ,CH.CHILD_COA_VAL_CD         CHILD_COA_VAL_CD
               ,SYS_CONNECT_BY_PATH (CH.CHILD_COA_VAL_CD||'     '|| COA.COA_DESC_TXT, '~') TREE_PATH
            FROM 
               COA_HRCH CH
            , (SELECT PCA.COA_AFFL_CD         COA_CD
                     ,PCA.COA_AFFL_DESC_TXT   COA_DESC_TXT
                 FROM PRNT_COA_AFFL PCA
                WHERE PCA.GLBL_CMPY_CD = #glblCmpyCd#
                  AND PCA.EZCANCELFLAG = '0'
               UNION ALL
               SELECT CA.COA_AFFL_CD         COA_CD
                     ,CA.COA_AFFL_DESC_TXT   COA_DESC_TXT
                 FROM COA_AFFL CA
                WHERE CA.GLBL_CMPY_CD  = #glblCmpyCd#
                  AND CA.EZCANCELFLAG  = '0')   COA
            WHERE
                  CH.GLBL_CMPY_CD      = #glblCmpyCd#
              AND CH.EZCANCELFLAG      = '0'
              AND CH.COA_SEG_NM        = #segNm#
              AND CH.CHILD_COA_VAL_CD  = COA.COA_CD 
              
            START WITH CH.PRNT_COA_VAL_CD = #topCoaValCd#
            CONNECT BY NOCYCLE PRIOR CH.CHILD_COA_VAL_CD = CH.PRNT_COA_VAL_CD
                                 AND CH.CHILD_COA_VAL_CD &lt;&gt; CH.PRNT_COA_VAL_CD
                                 AND CH.COA_SEG_NM       = CH.COA_SEG_NM
        </isNotNull>
        <isNotNull property="seg8Flg">
            SELECT
                CH.PRNT_COA_VAL_CD          PRNT_COA_VAL_CD
               ,CH.CHILD_COA_VAL_CD         CHILD_COA_VAL_CD
               ,SYS_CONNECT_BY_PATH (CH.CHILD_COA_VAL_CD||'     '|| COA.COA_DESC_TXT, '~') TREE_PATH
            FROM 
               COA_HRCH CH
            , (SELECT PCP.COA_PROJ_CD         COA_CD
                     ,PCP.COA_PROJ_DESC_TXT   COA_DESC_TXT
                 FROM PRNT_COA_PROJ PCP
                WHERE PCP.GLBL_CMPY_CD = #glblCmpyCd#
                  AND PCP.EZCANCELFLAG = '0'
               UNION ALL
               SELECT CP.COA_PROJ_CD         COA_CD
                     ,CP.COA_PROJ_DESC_TXT   COA_DESC_TXT
                 FROM COA_PROJ CP
                WHERE CP.GLBL_CMPY_CD  = #glblCmpyCd#
                  AND CP.EZCANCELFLAG  = '0')   COA
            WHERE
                  CH.GLBL_CMPY_CD      = #glblCmpyCd#
              AND CH.EZCANCELFLAG      = '0'
              AND CH.COA_SEG_NM        = #segNm#
              AND CH.CHILD_COA_VAL_CD  = COA.COA_CD 
              
            START WITH CH.PRNT_COA_VAL_CD = #topCoaValCd#
            CONNECT BY NOCYCLE PRIOR CH.CHILD_COA_VAL_CD = CH.PRNT_COA_VAL_CD
                                 AND CH.CHILD_COA_VAL_CD &lt;&gt; CH.PRNT_COA_VAL_CD
                                 AND CH.COA_SEG_NM       = CH.COA_SEG_NM
        </isNotNull>
        <isNotNull property="seg9Flg">
            SELECT
                CH.PRNT_COA_VAL_CD          PRNT_COA_VAL_CD
               ,CH.CHILD_COA_VAL_CD         CHILD_COA_VAL_CD
               ,SYS_CONNECT_BY_PATH (CH.CHILD_COA_VAL_CD||'     '|| COA.COA_DESC_TXT, '~') TREE_PATH
            FROM 
               COA_HRCH CH
            , (SELECT PCE.COA_EXTN_CD         COA_CD
                     ,PCE.COA_EXTN_DESC_TXT   COA_DESC_TXT
                 FROM PRNT_COA_EXTN PCE
                WHERE PCE.GLBL_CMPY_CD = #glblCmpyCd#
                  AND PCE.EZCANCELFLAG = '0'
               UNION ALL
               SELECT CE.COA_EXTN_CD         COA_CD
                     ,CE.COA_EXTN_DESC_TXT   COA_DESC_TXT
                 FROM COA_EXTN CE
                WHERE CE.GLBL_CMPY_CD  = #glblCmpyCd#
                  AND CE.EZCANCELFLAG  = '0')   COA
            WHERE
                  CH.GLBL_CMPY_CD      = #glblCmpyCd#
              AND CH.EZCANCELFLAG      = '0'
              AND CH.COA_SEG_NM        = #segNm#
              AND CH.CHILD_COA_VAL_CD  = COA.COA_CD 
              
            START WITH CH.PRNT_COA_VAL_CD = #topCoaValCd#
            CONNECT BY NOCYCLE PRIOR CH.CHILD_COA_VAL_CD = CH.PRNT_COA_VAL_CD
                                 AND CH.CHILD_COA_VAL_CD &lt;&gt; CH.PRNT_COA_VAL_CD
                                 AND CH.COA_SEG_NM       = CH.COA_SEG_NM
        </isNotNull>
                                 AND LEVEL &lt;= #maxLevel#
          ) TREE_INFO
    </statement>
        
    <resultMap id="result.getTreeInfo" class="NFAL0230_ASMsg">
        <result property="xxCoaExtnSrchTxt_1"     column="T0"        javaType="EZDCStringItem"/>
        <result property="xxCoaExtnSrchTxt_2"     column="T1"        javaType="EZDCStringItem"/>
        <result property="xxCoaExtnSrchTxt_3"     column="T2"        javaType="EZDCStringItem"/>
        <result property="xxCoaExtnSrchTxt_4"     column="T3"        javaType="EZDCStringItem"/>
        <result property="xxCoaExtnSrchTxt_5"     column="T4"        javaType="EZDCStringItem"/>
        <result property="xxCoaExtnSrchTxt_6"     column="T5"        javaType="EZDCStringItem"/>
        <result property="xxCoaExtnSrchTxt_7"     column="T6"        javaType="EZDCStringItem"/>
        <result property="xxCoaExtnSrchTxt_8"     column="T7"        javaType="EZDCStringItem"/>
        <result property="xxCoaExtnSrchTxt_9"     column="T8"        javaType="EZDCStringItem"/>
        <result property="xxCoaExtnSrchTxt_10"    column="T9"        javaType="EZDCStringItem"/>
        <result property="xxCoaExtnSrchTxt_11"    column="T10"       javaType="EZDCStringItem"/>
    </resultMap>
    
    <statement id="getMaxTreeLevel" parameterClass="Map" resultClass="Integer">
        SELECT
            *
        FROM    (
                SELECT
                    LEVEL AS LEVEL_NUM
                FROM 
                    COA_HRCH CH
                WHERE 
                    CH.GLBL_CMPY_CD = #glblCmpyCd#
                AND CH.EZCANCELFLAG = '0'
                AND CH.COA_SEG_NM   = #segNm#
                START WITH CH.PRNT_COA_VAL_CD IN 
                      (SELECT CH2.PRNT_COA_VAL_CD 
                         FROM COA_HRCH CH2
                        WHERE CH2.GLBL_CMPY_CD = #glblCmpyCd#
                          AND CH2.EZCANCELFLAG = '0'
                          AND CH2.COA_SEG_NM   = #segNm#
                        GROUP BY CH2.PRNT_COA_VAL_CD) 
                 CONNECT BY NOCYCLE PRIOR CH.CHILD_COA_VAL_CD = CH.PRNT_COA_VAL_CD
           ORDER BY LEVEL_NUM DESC
        ) W
        WHERE 
            ROWNUM = 1
    </statement>
</sqlMap>
