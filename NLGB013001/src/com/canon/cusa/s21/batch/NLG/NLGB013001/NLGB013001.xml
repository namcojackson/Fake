<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NLGB013001">
    <statement id="getProcInvty" parameterClass="Map">
    SELECT
           TRX.WMS_REC_ID
          ,TRX.WH_CD
          ,TRX.WMS_MDSE_CD
          ,TRX.WMS_STK_STS_CD
          ,TRX.WMS_RESRC_TXT
          ,TRX.WMS_ORD_QTY
          ,WHMM.WMS_MDSE_CD   AS WHMM_WMS_MDSE_CD
          ,WHMM.HOST_MDSE_CD
          ,#selectWmsTrxDtTmTs# AS INVTY_DT
          ,TRX.WMS_BAT_ID
          ,TRX.WMS_PKG_CD
          ,TRX.SER_NUM
          <!-- QC#21969 Start  -->
          <!-- ,TRX.SVC_CONFIG_MSTR_PK -->
          ,TRX.WMS_CNTNR_ID
          <!-- QC#21969 End  -->
          <!-- QC#53025 Start  -->
          ,TRX.WMS_INBD_TRX_PK
          <!-- QC#53025 End  -->
      FROM
           (
               SELECT
                      MAX(TRX.WMS_REC_ID)  AS WMS_REC_ID
                     ,TRX.WH_CD
                     ,TRX.WMS_MDSE_CD
                     ,TRX.WMS_STK_STS_CD
                     ,TRX.WMS_RESRC_TXT
                     ,SUM(TRX.WMS_ORD_QTY) AS WMS_ORD_QTY
                     ,TRX.WMS_BAT_ID
                     ,TRX.WMS_PKG_CD
                     ,TRX.SER_NUM
                     <!-- QC#21969 Start  -->
                     <!-- ,TRX.SVC_CONFIG_MSTR_PK -->
                     ,TRX.WMS_CNTNR_ID
                     <!-- QC#21969 End  -->
                     <!-- QC#53025 Start  -->
                     ,TRX.WMS_INBD_TRX_PK
                     <!-- QC#53025 End  -->
                 FROM
                      WMS_INBD_TRX TRX
                WHERE
                      TRX.GLBL_CMPY_CD        = #glblCmpyCd#
                  AND TRX.EZCANCELFLAG        = '0'
                  AND TRX.WMS_TASK_CD         = #wmsTaskCd#
                  AND TRX.WMS_TRX_DT_TM_TS LIKE #condWmsTrxDtTmTs# || '%'
                  <iterate property="wmsTrgtWhCd" var="elem[]" open="AND TRX.WH_CD IN (" close=")" conjunction=",">
                  #elem[]#
                  </iterate>
                  <!-- QC#16961 MOD STRAT -->
                  <!--
                  AND TRX.WMS_BAT_ID       = (
                          SELECT
                                 MAX(TRX2.WMS_BAT_ID)
                            FROM
                                 WMS_INBD_TRX TRX2
                           WHERE
                                 TRX2.GLBL_CMPY_CD        = TRX.GLBL_CMPY_CD
                             AND TRX2.WH_CD               = TRX.WH_CD
                             AND TRX2.EZCANCELFLAG        = '0'
                             AND TRX2.WMS_TASK_CD         = #wmsTaskCd#
                             AND TRX2.WMS_TRX_DT_TM_TS LIKE #condWmsTrxDtTmTs# || '%'
                      )
                  -->
                  AND TRX.PROC_STS_CD = #procStsCd#
                  <!-- QC#16961 MOD END -->
                GROUP BY
                      TRX.WH_CD
                     ,TRX.WMS_MDSE_CD
                     ,TRX.WMS_STK_STS_CD
                     ,TRX.WMS_RESRC_TXT
                     ,TRX.WMS_BAT_ID
                     ,TRX.WMS_PKG_CD
                     ,TRX.SER_NUM
                     <!-- QC#21969 Start  -->
                     <!--,TRX.SVC_CONFIG_MSTR_PK-->
                     ,TRX.WMS_CNTNR_ID
                     <!-- QC#21969 End  -->
                     <!-- QC#53025 Start  -->
                     <!--,TRX.SVC_CONFIG_MSTR_PK-->
                     ,TRX.WMS_INBD_TRX_PK
                     <!-- QC#53025 End  -->
           ) TRX
          ,WMS_HOST_MDSE_MAP WHMM
     WHERE
           TRX.WMS_MDSE_CD      = WHMM.WMS_MDSE_CD(+)
       AND WHMM.GLBL_CMPY_CD(+) = #glblCmpyCd#
       AND WHMM.EZCANCELFLAG(+) = '0'
     ORDER BY   
                WH_CD
               ,WMS_PKG_CD
               ,WMS_MDSE_CD
               ,WMS_STK_STS_CD
               ,SER_NUM
               <!-- QC#21969 Start  -->
               <!-- ,SVC_CONFIG_MSTR_PK -->
               ,TRX.WMS_CNTNR_ID
               <!-- QC#21969 End  -->
    </statement>

    <statement id="getRtlWhCdByOwnrCd" parameterClass="Map" resultClass="String">
        SELECT
                 MAX(RWH.RTL_WH_CD) RTL_WH_CD
        FROM
                 RTL_WH RWH
        WHERE
                   RWH.GLBL_CMPY_CD    = #glblCmpyCd#
               AND RWH.INVTY_OWNR_CD   = #invtyOwnrCd#
               AND RWH.WMS_WH_CD       = #wmsWhCd#
               AND RWH.EZCANCELFLAG    = '0'
    </statement>
</sqlMap>
