<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NFAB080001">

<!-- #################### Type Alias #################### -->
<typeAlias alias="MDSE_DLY_SNAP_SHOTTMsg" type="business.db.MDSE_DLY_SNAP_SHOTTMsg"/>

<!-- #################### Statement #################### -->
	
	<statement id="getMdse" parameterClass="Map" resultClass="Map">
		SELECT 
			MDSE.GLBL_CMPY_CD				AS GLBL_CMPY_CD,
			MDSE.MDSE_CD					AS MDSE_CD,
			MDSE.MDSE_NM					AS MDSE_NM,
			MDSE.FIRST_PROD_CTRL_CD			AS FIRST_PROD_CTRL_CD,
			MDSE.COA_PROD_CD				AS COA_PROD_CD,
			MDSE.WRT_DOWN_FLG				AS WRT_DOWN_FLG,
			MDSE.THIS_MTH_FOB_AMT			AS THIS_MTH_FOB_AMT,
			MDSE.THIS_MTH_INLND_FRT_AMT		AS THIS_MTH_INLND_FRT_AMT,
			MDSE.THIS_MTH_INTL_FRT_AMT		AS THIS_MTH_INTL_FRT_AMT,
			MDSE.THIS_MTH_IMPT_DTY_AMT		AS THIS_MTH_IMPT_DTY_AMT,
			MDSE.THIS_MTH_INS_AMT			AS THIS_MTH_INS_AMT,
			MDSE.THIS_MTH_TOT_STD_COST_AMT	AS THIS_MTH_TOT_STD_COST_AMT,
			MDSE.LAST_MTH_TOT_STD_COST_AMT	AS LAST_MTH_TOT_STD_COST_AMT,
			MDSE.NEXT_MTH_TOT_STD_COST_AMT	AS NEXT_MTH_TOT_STD_COST_AMT,
			MDSE.VND_CD						AS VND_CD,
			MDSE.COST_CCY_CD				AS COST_CCY_CD,
			MDSE.RGTN_STS_CD				AS RGTN_STS_CD,
			MDSE.INVTY_CTRL_FLG             AS INVTY_CTRL_FLG,
			MDSE.INVTY_VAL_FLG              AS INVTY_VAL_FLG,
			NULL                            AS COA_ACCT_CD,
			MDSE.MDSE_CATG_CD                AS MDSE_CATG_CD,
			MDSE.FOB_RE_CALC_EXCL_FLG       AS FOB_RE_CALC_EXCL_FLG,
			MDSE.MDSE_TP_CD                 AS MDSE_TP_CD,
			MDSE.COA_MDSE_TP_CD              AS COA_MDSE_TP_CD,
			MDSE.MDSE_CST_UPD_EFF_FROM_DT    AS MDSE_CST_UPD_EFF_FROM_DT,
			MDSE.ASSET_RECOV_COST_AMT        AS ASSET_RECOV_COST_AMT,
			MDSE.PREV_ASSET_RECOV_COST_AMT   AS PREV_ASSET_RECOV_COST_AMT,
			MDSE.NEXT_ASSET_RECOV_COST_AMT   AS NEXT_ASSET_RECOV_COST_AMT,
			MDSE.ASSET_RECOV_CST_EFF_FROM_DT AS ASSET_RECOV_CST_EFF_FROM_DT,
			MDSE.REV_COA_ACCT_CD             AS REV_COA_ACCT_CD,
			MDSE.COGS_COA_ACCT_CD            AS COGS_COA_ACCT_CD,
			MDSE.EXP_COA_ACCT_CD             AS EXP_COA_ACCT_CD,
			LBT.COA_CC_CD                   AS COA_CC_CD,
			MDSE.LINE_BIZ_TP_CD              AS LINE_BIZ_TP_CD
		FROM MDSE
		    <!-- start 2016/05/24 QC#8792 Get COA_CC_CD from LINE_BIZ_TP -->
		    ,LINE_BIZ_TP  LBT
		    <!-- end 2016/05/24 -->
		WHERE 
		      MDSE.EZCANCELFLAG   = '0'
		  AND MDSE.GLBL_CMPY_CD   = #glblCmpyCd#
		  AND MDSE.GLBL_CMPY_CD    = LBT.GLBL_CMPY_CD(+)
		  AND MDSE.EZCANCELFLAG    = LBT.EZCANCELFLAG(+)
		  AND MDSE.LINE_BIZ_TP_CD  = LBT.LINE_BIZ_TP_CD(+)
	</statement>
	
	<statement id="getOldData" parameterClass="Map" resultMap="result.queryMDSE_DLY_SNAP_SHOT">
	 SELECT GLBL_CMPY_CD
	       ,CRAT_DT
	       ,MDSE_CD
	   FROM MDSE_DLY_SNAP_SHOT
	  WHERE EZCANCELFLAG = '0'
	    AND GLBL_CMPY_CD = #glblCmpyCd#
	    <!-- 2016/06/13 include today to be able to run the job several times in same day. -->
	    AND (CRAT_DT &lt;= TO_CHAR(TO_DATE(#batProcDt#, 'YYYYMMDD') - TO_NUMBER(#retenDt#), 'YYYYMMDD')
	     OR  CRAT_DT = #batProcDt#)
	    <!-- end 2016/06/13 -->
	</statement>

	<statement id="getMdseDlySnapShotData" parameterClass="Map" resultMap="result.queryMDSE_DLY_SNAP_SHOT">
	 SELECT GLBL_CMPY_CD
	       ,CRAT_DT
	       ,MDSE_CD
	   FROM MDSE_DLY_SNAP_SHOT
	  WHERE EZCANCELFLAG = '0'
	    AND GLBL_CMPY_CD = #glblCmpyCd#
	    AND LTST_REC_FLG = #ltstRecFlg#
	</statement>

    <resultMap id="result.queryMDSE_DLY_SNAP_SHOT" class="MDSE_DLY_SNAP_SHOTTMsg">
		<result property="glblCmpyCd"			column="GLBL_CMPY_CD"			javaType="EZDTStringItem"/>
		<result property="cratDt"		        column="CRAT_DT"		        javaType="EZDTStringItem"/>
		<result property="mdseCd"			    column="MDSE_CD"			    javaType="EZDTStringItem"/>
	</resultMap>
</sqlMap>
