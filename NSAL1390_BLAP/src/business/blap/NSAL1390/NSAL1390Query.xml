<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL1390Query">

    <typeAlias alias="NSAL1390_ASMsg" type="business.blap.NSAL1390.NSAL1390_ASMsg" />

    <statement id="search" parameterClass="Map" resultMap="result.search">
        SELECT
            *
        FROM
            ( SELECT
                 RSL.SVC_LINE_BIZ_CD        SVC_LINE_BIZ_CD
                ,RSL.SVC_RG_PK              SVC_RG_PK
                ,SR.SVC_RG_DESC_TXT         SVC_RG_DESC_TXT
                ,RSL.SVC_CONTR_BR_CD        SVC_CONTR_BR_CD
                ,SCB.SVC_CONTR_BR_DESC_TXT  SVC_CONTR_BR_DESC_TXT
                ,RSL.RNW_LTR_FLG            RNW_LTR_FLG
                ,RSL.ANN_ESCL_LTR_FLG       ANN_ESCL_LTR_FLG
                ,RSL.PRINT_OLD_PRC_FLG      PRINT_OLD_PRC_FLG
                ,RSL.EZUPTIME               EZUPTIME
                ,RSL.EZUPTIMEZONE           EZUPTIMEZONE
            FROM
                RNW_ESCL_LTR_CTRL   RSL
                ,SVC_RG             SR
                ,SVC_CONTR_BR       SCB
            WHERE
                RSL.GLBL_CMPY_CD    = #glblCmpyCd#
            <isNotNull property="lineBizTpCd">
            AND RSL.SVC_LINE_BIZ_CD = #lineBizTpCd#
            </isNotNull>

            <isNotNull property="svcRgPk">
            AND RSL.SVC_RG_PK       = #svcRgPk#
            </isNotNull>

            <isNotNull property="svcContrBr">
            AND RSL.SVC_CONTR_BR_CD LIKE #svcContrBr#
            </isNotNull>
            AND RSL.EZCANCELFLAG    = '0'
            AND RSL.GLBL_CMPY_CD    = SR.GLBL_CMPY_CD
            AND RSL.SVC_RG_PK       = SR.SVC_RG_PK
            AND SR.EZCANCELFLAG     = '0'
            AND RSL.GLBL_CMPY_CD    = SCB.GLBL_CMPY_CD
            AND RSL.SVC_CONTR_BR_CD = SCB.SVC_CONTR_BR_CD
            AND SCB.EZCANCELFLAG    = '0'
            ORDER BY
                RSL.SVC_LINE_BIZ_CD
               ,SR.SVC_RG_DESC_TXT
               ,SCB.SVC_CONTR_BR_DESC_TXT
        ) RESULT
        WHERE
        ROWNUM &lt;= #count#
    </statement>

    <resultMap id="result.search" class="NSAL1390_ASMsg">
        <result property="lineBizTpCd_A"            column="SVC_LINE_BIZ_CD"        javaType="EZDCStringItem"/>
        <result property="svcRgPk_A"                column="SVC_RG_PK"              javaType="EZDCBigDecimalItem"/>
        <result property="svcRgDescTxt_A"           column="SVC_RG_DESC_TXT"        javaType="EZDCStringItem"/>
        <result property="svcContrBrCd_A"           column="SVC_CONTR_BR_CD"        javaType="EZDCStringItem"/>
        <result property="svcContrBrDescTxt_A"      column="SVC_CONTR_BR_DESC_TXT"  javaType="EZDCStringItem"/>
        <result property="xxChkBox_A2"              column="RNW_LTR_FLG"            javaType="EZDCStringItem"/>
        <result property="xxChkBox_A3"              column="ANN_ESCL_LTR_FLG"       javaType="EZDCStringItem"/>
        <result property="xxChkBox_A4"              column="PRINT_OLD_PRC_FLG"      javaType="EZDCStringItem"/>
        <result property="ezUpTime_A"               column="EZUPTIME"               javaType="EZDCStringItem"/>
        <result property="ezUpTimeZone_A"           column="EZUPTIMEZONE"           javaType="EZDCStringItem"/>
    </resultMap>

    <statement id="cntLobRgBrRelation" parameterClass="Map" resultClass="Integer">
        SELECT 
            COUNT(*) 
        FROM 
            SVC_RG              SR  
           ,SVC_RG_BR_RELN      SRBR
        WHERE
            SR.GLBL_CMPY_CD     = #glblCmpyCd#
        AND SR.SVC_RG_PK        = #svcRgPk#
        AND SR.SVC_LINE_BIZ_CD  = #lineBizTpCd#
        AND SR.EZCANCELFLAG     = '0'

        AND SR.GLBL_CMPY_CD         = SRBR.GLBL_CMPY_CD
        AND SR.SVC_RG_PK            = SRBR.SVC_RG_PK
        AND SRBR.SVC_CONTR_BR_CD    = #svcContrBrCd#
        AND SRBR.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getSvcContrBrNmLike" parameterClass="Map" resultClass="String">
        SELECT
            SCB.SVC_CONTR_BR_DESC_TXT
        FROM
            SVC_CONTR_BR    SCB
        WHERE
            SCB.GLBL_CMPY_CD            = #glblCmpyCd#
        AND SCB.SVC_CONTR_BR_CD      LIKE #svcContrBrCd#
        AND SCB.EFF_FROM_DT         &lt;= #slsDt#
        AND ( SCB.EFF_THRU_DT       &gt;= #slsDt#
              OR  SCB.EFF_THRU_DT       IS NULL )
        AND SCB.SVC_CONTR_BR_ACTV_FLG   = 'Y'
        AND SCB.EZCANCELFLAG            = '0'
    </statement>

    <!-- START 2017/10/27 K.Kojima [QC#21586,ADD] -->
    <statement id="getSvcLineBiz" parameterClass="Map" resultClass="Map">
        SELECT
             A.LINE_BIZ_TP_CD           LINE_BIZ_TP_CD
            ,A.LINE_BIZ_TP_DESC_TXT     LINE_BIZ_TP_DESC_TXT
        FROM
             LINE_BIZ_TP          A
            ,AVAL_LINE_BIZ_TP_SRC B
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.EZCANCELFLAG         = '0'
            AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD
            AND A.LINE_BIZ_TP_CD       = B.LINE_BIZ_TP_CD
            AND B.SYS_SRC_CD           = #sysSrcCd#
            AND B.EZCANCELFLAG         = '0'
        ORDER BY
            A.LINE_BIZ_TP_SORT_NUM
    </statement>
    <!-- END 2017/10/27 K.Kojima [QC#21586,ADD] -->

</sqlMap>
