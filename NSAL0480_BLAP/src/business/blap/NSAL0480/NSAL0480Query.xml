<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSAL0480Query">

    <statement id="getSavedSearchOptionList" parameterClass="Map" resultClass="Map">
        SELECT
                  SSO.SRCH_OPT_PK
                , SSO.SRCH_OPT_NM
            FROM
                SAVE_SRCH_OPT SSO 
            WHERE
                SSO.GLBL_CMPY_CD        = #glblCmpyCd#
                AND SSO.SRCH_OPT_APL_ID = #srchOptAplId#
                AND SSO.SRCH_OPT_USR_ID = #srchOptUsrId#
                AND SSO.EZCANCELFLAG    = '0'
            ORDER BY
                  SSO.SRCH_OPT_PK
    </statement>


    <statement id="getMeterGroupList" parameterClass="Map" resultClass="Map">
        SELECT
                  MG.MTR_GRP_PK
                , MG.MTR_GRP_NM
            FROM
                MTR_GRP MG 
            WHERE
                MG.GLBL_CMPY_CD     = #glblCmpyCd#
                AND MG.EZCANCELFLAG = '0'
            ORDER BY
                  MG.MTR_GRP_PK
    </statement>

    <statement id="getServiceSkillList" parameterClass="Map" resultClass="Map">
        SELECT
                  SK.SVC_SKILL_NUM
                , SK.SVC_SKILL_NM 
            FROM
                SVC_SKILL SK 
            WHERE
                SK.GLBL_CMPY_CD     = #glblCmpyCd#
                AND SK.EZCANCELFLAG = '0'
            ORDER BY
                  SK.SVC_SKILL_NUM
    </statement>

    <statement id="getInstallationRuleList" parameterClass="Map" resultClass="Map">
        SELECT
                  SIR.SVC_ISTL_RULE_NUM
                , SIR.SVC_ISTL_RULE_NM 
            FROM
                SVC_ISTL_RULE SIR 
            WHERE
                SIR.SVC_ISTL_RULE_FLG = #svcIstlRuleFlg#
                AND SIR.GLBL_CMPY_CD  = #glblCmpyCd#
                AND SIR.EZCANCELFLAG  = '0'
            ORDER BY
                  SIR.SVC_ISTL_RULE_NUM
    </statement>

    <statement id="getSearchData" parameterClass="Map" resultClass="Map">
        WITH SRCH_RSLT AS ( 
            SELECT DISTINCT
                      MN.T_MDL_ID
                    , NVL(MN.T_MDL_NM                   , '') T_MDL_NM
                    , NVL(DM.MDL_DESC_TXT               , '') MDL_DESC_TXT
                    , NVL(DMG.MDL_GRP_NM                , '') MDL_GRP_NM
                    , NVL(DM.SVC_SEG_CD                 , '') SVC_SEG_CD
                    , ( 
                        CASE DM.MDL_ACTV_FLG 
                            WHEN 'Y' THEN #mdlActvFlgActive# 
                            ELSE          #mdlActvFlgInActive# 
                            END
                    )                                         XX_SCR_ITEM_10_TXT
                    , SUBSTR(DM.EZINTIME, #one#, #len#)       XX_CRAT_DT
                    , NVL(MG.MTR_GRP_NM                 , '') MTR_GRP_NM
                    , NVL(DM.MTR_GRP_PK                 , '') MTR_GRP_PK
                    , NVL(DM.SVC_SKILL_NUM              , '') SVC_SKILL_NUM
                    , NVL(SK.SVC_SKILL_NM               , '') SVC_SKILL_NM
                    --
                    , NVL(DM.RCLL_INTVL_DAYS_AOT        , '') RCLL_INTVL_DAYS_AOT
                    , NVL(DM.RCLL_COPY_VOL_CNT          , '') RCLL_COPY_VOL_CNT
                    , NVL(DM.RCLL_GLBL_INTVL_DAYS_AOT   , '') RCLL_GLBL_INTVL_DAYS_AOT
                    , NVL(DM.RCLL_GLBL_COPY_VOL_CNT     , '') RCLL_GLBL_COPY_VOL_CNT
                    , NVL(DM.RSP_TM_UP_MN_AOT           , '') RSP_TM_UP_MN_AOT
                    , NVL(DM.XS_VISIT_CNT               , '') XS_VISIT_CNT
                    , NVL(DM.PHONE_FIX_FLG              , '') PHONE_FIX_FLG
                    , NVL(DM.PHONE_FIX_INTVL_DAYS_AOT   , '') PHONE_FIX_INTVL_DAYS_AOT
                    , NVL(DM.AFTER_HOUR_ALLW_FLG        , '') AFTER_HOUR_ALLW_FLG
                    , NVL(DM.COPY_VOL_DAYS_AOT          , '') COPY_VOL_DAYS_AOT
                    , NVL(DM.MAX_COPY_PER_DAY_TOT_CNT   , '') MAX_COPY_PER_DAY_TOT_CNT
                    , NVL(DM.MAX_COPY_PER_DAY_BLACK_CNT , '') MAX_COPY_PER_DAY_BLACK_CNT
                    , NVL(DM.MAX_COPY_TEST_CNT          , '') MAX_COPY_TEST_CNT
                    , NVL(DM.MDL_SPEED_BLACK_RATE       , '') MDL_SPEED_BLACK_RATE
                    , NVL(DM.MDL_SPEED_COLOR_RATE       , '') MDL_SPEED_COLOR_RATE
                    , NVL(DM.DS_MDL_PAPER_SIZE_CD       , '') DS_MDL_PAPER_SIZE_CD
                    , NVL(DMPS.DS_MDL_PAPER_SIZE_NM     , '') DS_MDL_PAPER_SIZE_NM
                    , NVL(DM.SVC_ISTL_RULE_NUM   , '')        SVC_ISTL_RULE_NUM
                    , NVL(DM.SVC_DEINS_RULE_NUM  , '')        SVC_DEINS_RULE_NUM
                    , DM.CUST_ISTL_FLG                        CUST_ISTL_FLG
                    , DM.SVC_ISTL_REQ_FLG                     SVC_ISTL_REQ_FLG
                    , DM.SITE_SRVY_REQ_FLG                    SITE_SRVY_REQ_FLG
                    , SIR_IN.SVC_ISTL_RULE_NM                 SVC_ISTL_RULE_NM_IN
                    , SIR_DE.SVC_ISTL_RULE_NM                 SVC_ISTL_RULE_NM_DE
                    , NVL(DM.MACH_IN_FLD_INAC_MTH_AOT   , '') MACH_IN_FLD_INAC_MTH_AOT
                    <!-- START 2016/12/02 K.Kojima [QC#14204, ADD] -->
                    ,DM.EZINTIME                           AS XX_REC_HIST_CRAT_TS_A
                    ,DM.EZINUSERID                         AS XX_REC_HIST_CRAT_BY_NM_A
                    ,DM.EZUPTIME                           AS XX_REC_HIST_UPD_TS_A
                    ,DM.EZUPUSERID                         AS XX_REC_HIST_UPD_BY_NM_A
                    ,DM.EZTABLEID                          AS XX_REC_HIST_TBL_NM_A
                    <!-- END 2016/12/02 K.Kojima [QC#14204, ADD] -->
                FROM
                    DS_MDL              DM
                    , MDL_NM            MN
                    , DS_MDL_GRP        DMG
                    , MTR_GRP           MG
                    , SVC_SKILL         SK
                    , DS_MDL_CONFIG     DMC
                    , DS_MDL_SPLY_RELN  DMSR
                    , MDSE              DMI
                    , DS_MDL_PAPER_SIZE DMPS
                    , ORD_TAKE_MDSE     OTMC
                    , SVC_ISTL_RULE     SIR_IN
                    , SVC_ISTL_RULE     SIR_DE
                WHERE
                    1 = 1
                    <isNotNull property="mdlDescTxt">
<!-- START 2019/11/21 [QC#54597, MOD] -->
                    AND UPPER(DM.MDL_DESC_TXT) LIKE UPPER(#mdlDescTxt#)
<!-- END   2019/11/21 [QC#54597, MOD] -->
                    </isNotNull>

                    <isNotNull property="mdlActvFlg">
                    AND DM.MDL_ACTV_FLG     = #mdlActvFlg#
                    </isNotNull>

                    <isNotNull property="xxCratDt">
                    AND DM.EZINTIME      LIKE #xxCratDt#
                    </isNotNull>

                    <isNotNull property="svcSegCd">
                    AND DM.SVC_SEG_CD       = #svcSegCd#
                    </isNotNull>

                    <isNotNull property="svcSkillNum">
                    AND DM.SVC_SKILL_NUM    = #svcSkillNum#
                    </isNotNull>

                    <isNotNull property="svcIstlRuleNum">
                    AND DM.SVC_ISTL_RULE_NUM = #svcIstlRuleNum#
                    </isNotNull>
                    <isNotNull property="svcDeistlRuleNum">
                    AND DM.SVC_DEINS_RULE_NUM = #svcDeistlRuleNum#
                    </isNotNull>

                    <isNull property="custIstlFlgOff">
                        <isNotNull property="custIstlFlgOn">
                        AND DM.CUST_ISTL_FLG        = #custIstlFlgOn#
                        </isNotNull>
                    </isNull>

                    <isNull property="custIstlFlgOn">
                        <isNotNull property="custIstlFlgOff">
                        AND DM.CUST_ISTL_FLG        = #custIstlFlgOff#
                        </isNotNull>
                    </isNull>

                    <isNull property="svcIstlReqFlgOff">
                        <isNotNull property="svcIstlReqFlgOn">
                        AND DM.SVC_ISTL_REQ_FLG     = #svcIstlReqFlgOn#
                        </isNotNull>
                    </isNull>

                    <isNull property="svcIstlReqFlgOn">
                        <isNotNull property="svcIstlReqFlgOff">
                        AND DM.SVC_ISTL_REQ_FLG     = #svcIstlReqFlgOff#
                        </isNotNull>
                    </isNull>

                    <isNull property="siteSrvyReqFlgOff">
                        <isNotNull property="siteSrvyReqFlgOn">
                        AND DM.SITE_SRVY_REQ_FLG    = #siteSrvyReqFlgOn#
                        </isNotNull>
                    </isNull>

                    <isNull property="siteSrvyReqFlgOn">
                        <isNotNull property="siteSrvyReqFlgOff">
                        AND DM.SITE_SRVY_REQ_FLG    = #siteSrvyReqFlgOff#
                        </isNotNull>
                    </isNull>

                    AND DM.GLBL_CMPY_CD     = #glblCmpyCd#
                    AND DM.EZCANCELFLAG     = '0'             --
                                                          --
                    AND DM.MDL_ID           = MN.T_MDL_ID 
                    AND DM.GLBL_CMPY_CD     = MN.T_GLBL_CMPY_CD 
                    AND MN.EZCANCELFLAG     = '0'             --
                    <isNotNull property="t_mdlNm">
                    AND MN.T_MDL_NM      LIKE #t_mdlNm#
                    </isNotNull>
                                                          --
                    AND DM.MDL_GRP_ID       = DMG.MDL_GRP_ID(+)
                    AND DM.GLBL_CMPY_CD     = DMG.GLBL_CMPY_CD(+)
                    AND DMG.EZCANCELFLAG(+) = '0'            --
                    <isNotNull property="mdlGrpNm">
                    AND DMG.MDL_GRP_NM   LIKE #mdlGrpNm#
                    </isNotNull>
                                                          --
                    AND DM.MTR_GRP_PK       = MG.MTR_GRP_PK(+) 
                    AND DM.GLBL_CMPY_CD     = MG.GLBL_CMPY_CD(+) 
                    AND MG.EZCANCELFLAG(+)  = '0'         --
                    <isNotNull property="mtrGrpPk">
                    AND MG.MTR_GRP_Pk       = #mtrGrpPk#
                    </isNotNull>
                                                          --
                    AND DM.SVC_SKILL_NUM    = SK.SVC_SKILL_NUM(+) 
                    AND DM.GLBL_CMPY_CD     = SK.GLBL_CMPY_CD(+) 
                    AND SK.EZCANCELFLAG(+)  = '0'         --
                                                          --
                    AND DM.MDL_ID           = DMC.MDL_ID(+) 
                    AND DM.GLBL_CMPY_CD     = DMC.GLBL_CMPY_CD(+) 
                    AND DMC.EZCANCELFLAG(+) = '0'
                    <isNotNull property="t_ItemCd">
                    AND (
                          DMC.PRNT_MDSE_CD  LIKE #t_ItemCd#
                       OR DMC.CHILD_MDSE_CD LIKE #t_ItemCd#
                    )
                    </isNotNull>

                                                          --
                    AND DM.MDL_ID               = DMSR.MDL_ID(+)
                    AND DM.GLBL_CMPY_CD         = DMSR.GLBL_CMPY_CD(+)
                    AND DMSR.EZCANCELFLAG(+)    = '0'
                    <isNotNull property="mdseCd">
                    AND (   DMSR.MDSE_CD          LIKE #mdseCd#
                         OR DMSR.ORD_TAKE_MDSE_CD LIKE #mdseCd#)
                    </isNotNull>
                                                          --
                    AND DM.DS_MDL_PAPER_SIZE_CD = DMPS.DS_MDL_PAPER_SIZE_CD(+)
                    AND DM.GLBL_CMPY_CD         = DMPS.GLBL_CMPY_CD(+)
                    AND DMPS.EZCANCELFLAG(+)    = '0'
                    AND DMSR.GLBL_CMPY_CD       = OTMC.GLBL_CMPY_CD(+)
                    AND DMSR.ORD_TAKE_MDSE_CD   = OTMC.ORD_TAKE_MDSE_CD(+)
                    AND OTMC.EZCANCELFLAG(+)    = '0'
                    AND OTMC.GLBL_CMPY_CD       = DMI.GLBL_CMPY_CD(+)
                    AND OTMC.MDSE_CD            = DMI.MDSE_CD(+)
                    <isNotNull property="imgSplyOemCd">
                    AND DMI.IMG_SPLY_OEM_CD     LIKE #imgSplyOemCd#
                    </isNotNull>
                    <isNotNull property="mdseItemClsTpCd">
                    AND DMI.MDSE_ITEM_CLS_TP_CD = #mdseItemClsTpCd#
                    </isNotNull>
                    AND DMI.EZCANCELFLAG(+)     = '0'
                    AND DM.GLBL_CMPY_CD         = SIR_IN.GLBL_CMPY_CD(+)
                    AND DM.SVC_ISTL_RULE_NUM    = SIR_IN.SVC_ISTL_RULE_NUM(+)
                    AND SIR_IN.EZCANCELFLAG(+)  = '0'
                    AND DM.GLBL_CMPY_CD         = SIR_DE.GLBL_CMPY_CD(+)
                    AND DM.SVC_DEINS_RULE_NUM   = SIR_DE.SVC_ISTL_RULE_NUM(+)
                    AND SIR_DE.EZCANCELFLAG(+)  = '0'
                ORDER BY
                    T_MDL_NM
        ) 
        SELECT
                  T_MDL_NM
                , MDL_DESC_TXT
                , MDL_GRP_NM
                , SVC_SEG_CD
                , XX_SCR_ITEM_10_TXT
                , XX_CRAT_DT
                , MTR_GRP_NM
                , MTR_GRP_PK
                , SVC_SKILL_NUM
                , SVC_SKILL_NM
                --
                , RCLL_INTVL_DAYS_AOT
                , RCLL_COPY_VOL_CNT
                , RCLL_GLBL_INTVL_DAYS_AOT
                , RCLL_GLBL_COPY_VOL_CNT
                , RSP_TM_UP_MN_AOT
                , XS_VISIT_CNT
                , PHONE_FIX_FLG
                , PHONE_FIX_INTVL_DAYS_AOT
                , AFTER_HOUR_ALLW_FLG
                , COPY_VOL_DAYS_AOT
                , MAX_COPY_PER_DAY_TOT_CNT
                , MAX_COPY_PER_DAY_BLACK_CNT
                , MAX_COPY_TEST_CNT
                , MDL_SPEED_BLACK_RATE
                , MDL_SPEED_COLOR_RATE
                , DS_MDL_PAPER_SIZE_NM
                , SVC_ISTL_RULE_NUM
                , SVC_DEINS_RULE_NUM
                , CUST_ISTL_FLG
                , SVC_ISTL_REQ_FLG
                , SITE_SRVY_REQ_FLG
                , SVC_ISTL_RULE_NM_IN
                , SVC_ISTL_RULE_NM_DE
                , MACH_IN_FLD_INAC_MTH_AOT
                <!-- START 2016/12/02 K.Kojima [QC#14204, ADD] -->
                ,XX_REC_HIST_CRAT_TS_A
                ,XX_REC_HIST_CRAT_BY_NM_A
                ,XX_REC_HIST_UPD_TS_A
                ,XX_REC_HIST_UPD_BY_NM_A
                ,XX_REC_HIST_TBL_NM_A
           <!-- END 2016/12/02 K.Kojima [QC#14204, ADD] -->
            FROM
                SRCH_RSLT 
            WHERE
                ROWNUM &lt; #limitRownum#
            ORDER BY
                T_MDL_NM
    </statement>

</sqlMap>
