<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMZC271001">

<!-- QC#5786 - Mode 1 is not used anymore.
    <statement id="getActiveRule" parameterClass="Map" resultClass="Map">
        SELECT
            TR.ORG_CD                      ORG_CD
          , TR.TRTY_RULE_PK                TRTY_RULE_PK
          , TR.TRTY_RULE_TP_CD             TRTY_RULE_TP_CD
          , TR.TRTY_RULE_FROM_VAL_TXT      TRTY_RULE_FROM_VAL_TXT
          , TR.TRTY_RULE_THRU_VAL_TXT      TRTY_RULE_THRU_VAL_TXT
          , TR.TRTY_RULE_OPRD_TP_CD        TRTY_RULE_OPRD_TP_CD
          , TR.TRTY_RULE_LOGIC_TP_CD       TRTY_RULE_LOGIC_TP_CD
          , DOU.ORG_NM                     ORG_NM

        FROM
            TRTY_RULE           TR
          , TRTY_RULE_TP        TRP
          , DS_ORG_UNIT         DOU 
          , TRTY_TP             TT

        WHERE
            TR.GLBL_CMPY_CD              = #glblCmpyCd#
        AND TR.EZCANCELFLAG              = '0'
        AND TR.EFF_FROM_DT               &lt;= #slsDt#
        AND   (TR.EFF_THRU_DT  IS NULL
            OR TR.EFF_THRU_DT  &gt;= #slsDt#)
        AND TR.ORG_CD                    = #orgCd#
        AND TR.TRTY_RULE_TP_CD in ('1','2','3','4','5','6','7')

        <isNotNull property="trtyRulePk">
        AND TR.TRTY_RULE_PK              = #trtyRulePk#
        </isNotNull>

        AND TR.GLBL_CMPY_CD              = TRP.GLBL_CMPY_CD
        AND TRP.EZCANCELFLAG             = '0'
        AND TRP.TRTY_RULE_TP_CD          = TRP.TRTY_RULE_TP_CD

        AND TR.GLBL_CMPY_CD              = DOU.GLBL_CMPY_CD
        AND DOU.EZCANCELFLAG             = '0'
        AND TR.ORG_CD                    = DOU.ORG_CD
        AND DOU.GNRN_TP_CD               IN(#gnrnTpCurrent#, #gnrnTpFuture#)

        AND DOU.GLBL_CMPY_CD             = TT.GLBL_CMPY_CD
        AND TT.EZCANCELFLAG              = '0'
        AND DOU.TRTY_TP_CD               = TT.TRTY_TP_CD
        AND TT.DEF_SLS_REP_BAT_FLG       = #defSlsRepBatFlg#

        ORDER BY TR.TRTY_RULE_PK ASC

    </statement>

    <statement id="getLocations" parameterClass="Map" resultClass="Map">
        SELECT 
            ACCT_CUST_PROS.DS_ACCT_NUM
          , ACCT_CUST_PROS.LOC_NUM
          , ACCT_CUST_PROS.DS_ACCT_NM
          , ACCT_CUST_PROS.DS_ACCT_TP_CD
          , ACCT_CUST_PROS.PTY_LOC_PK

        FROM
            (SELECT
                DAP.DS_ACCT_NM      DS_ACCT_NM
              , DAP.DS_ACCT_TP_CD   DS_ACCT_TP_CD
              , DAP.DS_ACCT_CLS_CD  DS_ACCT_CLS_CD
              , DAP.DS_CUST_SIC_CD  DS_CUST_SIC_CD
              , AL.ACCT_LOC_PK      ACCT_LOC_PK
              , AL.DS_ACCT_NUM      DS_ACCT_NUM
              , AL.LOC_NUM          LOC_NUM
              , AL.PTY_LOC_PK       PTY_LOC_PK
              , PLW.FIRST_LINE_ADDR FIRST_LINE_ADDR
              , PLW.SCD_LINE_ADDR   SCD_LINE_ADDR
              , PLW.THIRD_LINE_ADDR THIRD_LINE_ADDR
              , PLW.FRTH_LINE_ADDR  FRTH_LINE_ADDR
              , PLW.CTY_ADDR        CTY_ADDR
              , PLW.ST_CD           ST_CD
              , PLW.PROV_NM         PROV_NM
              , PLW.POST_CD         POST_CD
              , CN.CNTY_NM          CNTY_NM
              , DAGA.DS_ACCT_GRP_CD DS_ACCT_GRP_CD
              , STC.SHIP_TO_CUST_CD SHIP_TO_CUST_CD
              , STC.BILL_TO_CUST_CD BILL_TO_CUST_CD

            FROM
                DS_ACCT_PROS     DAP
              , ACCT_LOC         AL
              , PTY_LOC_WRK      PLW
              , CNTY             CN
              , DS_ACCT_GRP_ASG  DAGA
              , SHIP_TO_CUST     STC

            WHERE
                DAP.GLBL_CMPY_CD     = #glblCmpyCd#
            AND DAP.EZCANCELFLAG     = '0'
            AND DAP.RGTN_STS_CD      &lt;&gt; #rgtnStsTerminated#

            AND DAP.GLBL_CMPY_CD     = AL.GLBL_CMPY_CD
            AND AL.EZCANCELFLAG      = '0'
            AND AL.RGTN_STS_CD       &lt;&gt; #rgtnStsTerminated#
            AND DAP.DS_ACCT_NUM      = AL.DS_ACCT_NUM

            AND DAP.GLBL_CMPY_CD     = PLW.GLBL_CMPY_CD
            AND PLW.EZCANCELFLAG      = '0'
            AND PLW.RGTN_STS_CD      &lt;&gt; #rgtnStsTerminated#
            AND AL.PTY_LOC_PK        = PLW.PTY_LOC_PK

            AND DAP.GLBL_CMPY_CD     = CN.GLBL_CMPY_CD
            AND CN.EZCANCELFLAG      = '0'
            AND PLW.CNTY_PK          = CN.CNTY_PK

            AND DAP.GLBL_CMPY_CD     = DAGA.GLBL_CMPY_CD(+)
            AND DAGA.EZCANCELFLAG    = '0'
            AND DAP.DS_ACCT_NUM      = DAGA.DS_ACCT_NUM (+)

            AND DAGA.EFF_FROM_DT     &lt;= #slsDt#
            AND   (DAGA.EFF_THRU_DT  IS NULL 
                OR DAGA.EFF_THRU_DT  &gt;= #slsDt# )

            AND DAP.GLBL_CMPY_CD     = STC.GLBL_CMPY_CD
            AND STC.EZCANCELFLAG     = '0'
            AND PLW.LOC_NUM          = STC.LOC_NUM
            AND STC.RGTN_STS_CD      &lt;&gt; #rgtnStsTerminated#

            UNION ALL

            SELECT
                DAC.DS_ACCT_NM
              , DAC.DS_ACCT_TP_CD
              , DAC.DS_ACCT_CLS_CD
              , DAC.DS_CUST_SIC_CD
              , AL.ACCT_LOC_PK
              , AL.DS_ACCT_NUM
              , AL.LOC_NUM
              , AL.PTY_LOC_PK
              , PLW.FIRST_LINE_ADDR
              , PLW.SCD_LINE_ADDR
              , PLW.THIRD_LINE_ADDR
              , PLW.FRTH_LINE_ADDR
              , PLW.CTY_ADDR
              , PLW.ST_CD
              , PLW.PROV_NM
              , PLW.POST_CD
              , CN.CNTY_NM
              , DAGA.DS_ACCT_GRP_CD
              , STC.SHIP_TO_CUST_CD
              , STC.BILL_TO_CUST_CD

            FROM
                DS_ACCT_CUST    DAC
              , ACCT_LOC        AL
              , PTY_LOC_WRK     PLW
              , CNTY            CN
              , DS_ACCT_GRP_ASG DAGA
              , SHIP_TO_CUST    STC
            WHERE
                DAC.GLBL_CMPY_CD     =  #glblCmpyCd#
            AND DAC.EZCANCELFLAG     = '0'
            AND DAC.RGTN_STS_CD      &lt;&gt; #rgtnStsTerminated#

            AND DAC.GLBL_CMPY_CD     =  AL.GLBL_CMPY_CD
            AND AL.EZCANCELFLAG      = '0'
            AND AL.RGTN_STS_CD       &lt;&gt; #rgtnStsTerminated#
            AND DAC.DS_ACCT_NUM      =  AL.DS_ACCT_NUM

            AND DAC.GLBL_CMPY_CD     =  PLW.GLBL_CMPY_CD
            AND PLW.EZCANCELFLAG     = '0'
            AND PLW.RGTN_STS_CD      &lt;&gt; #rgtnStsTerminated#
            AND AL.PTY_LOC_PK        =  PLW.PTY_LOC_PK

            AND DAC.GLBL_CMPY_CD     =  CN.GLBL_CMPY_CD
            AND CN.EZCANCELFLAG      = '0'
            AND PLW.CNTY_PK          =  CN.CNTY_PK

            AND DAC.GLBL_CMPY_CD     = DAGA.GLBL_CMPY_CD(+)
            AND DAGA.EZCANCELFLAG    = '0'
            AND DAC.DS_ACCT_NUM      = DAGA.DS_ACCT_NUM (+)

            AND DAGA.EFF_FROM_DT     &lt;= #slsDt#
            AND   (DAGA.EFF_THRU_DT IS NULL 
                OR DAGA.EFF_THRU_DT  &gt;= #slsDt# )

            AND DAC.GLBL_CMPY_CD     = STC.GLBL_CMPY_CD
            AND STC.EZCANCELFLAG     = '0'
            AND PLW.LOC_NUM          = STC.LOC_NUM
            AND STC.RGTN_STS_CD      &lt;&gt; #rgtnStsTerminated#

            )ACCT_CUST_PROS

        WHERE
        <isEqual property="trtyRuleTpCd" compareValue="1">
            ST_CD
        </isEqual>
        <isEqual property="trtyRuleTpCd" compareValue="2">
            POST_CD
        </isEqual>
        <isEqual property="trtyRuleTpCd" compareValue="3">
            DS_ACCT_NM
        </isEqual>
        <isEqual property="trtyRuleTpCd" compareValue="4">
            LOC_NUM
        </isEqual>
        <isEqual property="trtyRuleTpCd" compareValue="5">
            DS_ACCT_CLS_CD
        </isEqual>
        <isEqual property="trtyRuleTpCd" compareValue="6">
            DS_ACCT_GRP_CD
        </isEqual>
        <isEqual property="trtyRuleTpCd" compareValue="7">
            DS_CUST_SIC_CD
        </isEqual>

        <isEqual property="trtyRuleOprdTpCd" compareValue="2">
            = #trtyRuleFromValTxt#
        </isEqual>
        <isEqual property="trtyRuleOprdTpCd" compareValue="4">
            BETWEEN
                #trtyRuleFromValTxt#
            AND
                #trtyRuleThruValTxt#
        </isEqual>
        <isEqual property="trtyRuleOprdTpCd" compareValue="3">
            LIKE #trtyRuleFromValTxt#
        </isEqual>
        <isEqual property="trtyRuleOprdTpCd" compareValue="1">
            !=  #trtyRuleFromValTxt#
        </isEqual>

    </statement>
-->

    <statement id="getExactMatchTerritory" parameterClass="Map" resultClass="Map">
<!-- QC#15214 Del Start
    WITH WRK AS (
        <iterate property="wrkDataList" var="wrkDataList[]" open="" close="" conjunction="UNION ALL">
            SELECT #wrkDataList[].xxRowNum# XX_ROW_NUM, #wrkDataList[].stCd# ST_CD, #wrkDataList[].postCd# POST_CD, #wrkDataList[].dsAcctNm# DS_ACCT_NM, #wrkDataList[].dsCustSicCd# DS_CUST_SIC_CD FROM DUAL 
        </iterate>
    )
     SELECT DISTINCT
            DOU.ORG_CD
          , DOU.ORG_NM
          , WRK.XX_ROW_NUM
        FROM
            DS_ORG_UNIT DOU
          , WRK
      WHERE 
            DOU.GLBL_CMPY_CD             = #glblCmpyCd#
        AND DOU.EZCANCELFLAG             = '0'
        AND DOU.GNRN_TP_CD               IN(#gnrnTpCurrent#, #gnrnTpFuture#)
        AND EXISTS (
            SELECT 1 FROM    
                 TRTY_RULE   TR
            WHERE
                TR.GLBL_CMPY_CD              = #glblCmpyCd#
            AND TR.EZCANCELFLAG              = '0'
            AND TR.ORG_CD                    = DOU.ORG_CD
            AND TR.TRTY_RULE_LOGIC_TP_CD     != #trtyRuleLogicTpCd#
            AND TR.EFF_FROM_DT               &lt;= #slsDt#
            AND (TR.EFF_THRU_DT IS NULL      OR TR.EFF_THRU_DT &gt;= #slsDt#)
            AND TR.TRTY_RULE_TP_CD           IN (#trtyRuleTpCdState#, #trtyRuleTpCdSicCode#, #trtyRuleTpCdPostalCode#, #trtyRuleTpCdAccountName#)
        )
          AND NOT EXISTS (
            SELECT 1 FROM    
                 TRTY_RULE   TR
            WHERE
                TR.GLBL_CMPY_CD              = #glblCmpyCd#
            AND TR.EZCANCELFLAG              = '0'
            AND TR.ORG_CD                    = DOU.ORG_CD
            AND TR.TRTY_RULE_LOGIC_TP_CD     != #trtyRuleLogicTpCd#
            AND TR.EFF_FROM_DT               &lt;= #slsDt#
            AND (TR.EFF_THRU_DT IS NULL      OR TR.EFF_THRU_DT &gt;= #slsDt#)
            AND TR.TRTY_RULE_TP_CD           NOT IN (#trtyRuleTpCdState#, #trtyRuleTpCdSicCode#, #trtyRuleTpCdPostalCode#, #trtyRuleTpCdAccountName#)
       )
        AND 
        (
            (
                SELECT COUNT(1) FROM    
                     TRTY_RULE   TR
                WHERE
                    TR.GLBL_CMPY_CD              = #glblCmpyCd#
                AND TR.EZCANCELFLAG              = '0'
                AND TR.ORG_CD                    = DOU.ORG_CD
                AND TR.TRTY_RULE_LOGIC_TP_CD     != #trtyRuleLogicTpCd#
                AND TR.EFF_FROM_DT               &lt;= #slsDt#
                AND (TR.EFF_THRU_DT IS NULL      OR TR.EFF_THRU_DT &gt;= #slsDt#)
                AND TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdState#
                AND (
                      (
                            TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdEqual#
                        AND TR.TRTY_RULE_FROM_VAL_TXT    = WRK.ST_CD
                      )
                      OR
                      (
                            TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdIn#
                        AND (
                               TR.TRTY_RULE_FROM_VAL_TXT = WRK.ST_CD
                            OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, WRK.ST_CD || ',') = 1
                            OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, ',' || WRK.ST_CD || ',') > 0
                            OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, ',' || WRK.ST_CD) = (LENGTH(TR.TRTY_RULE_FROM_VAL_TXT) - LENGTH(WRK.ST_CD) + 1) 
                        )
                      )
                      OR  
                      (
                            TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdLike#
                        AND WRK.ST_CD                      LIKE TR.TRTY_RULE_FROM_VAL_TXT
                      )
                      OR
                      (
                            TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdBetween#
                        AND TR.TRTY_RULE_FROM_VAL_TXT    &lt;= WRK.ST_CD
                        AND TR.TRTY_RULE_THRU_VAL_TXT    &gt;= WRK.ST_CD
                      )
                ) 
            )
            =
            (
                SELECT COUNT(1) FROM    
                     TRTY_RULE   TR
                WHERE
                    TR.GLBL_CMPY_CD              = #glblCmpyCd#
                AND TR.EZCANCELFLAG              = '0'
                AND TR.ORG_CD                    = DOU.ORG_CD
                AND TR.TRTY_RULE_LOGIC_TP_CD     != #trtyRuleLogicTpCd#
                AND TR.EFF_FROM_DT               &lt;= #slsDt#
                AND (TR.EFF_THRU_DT IS NULL      OR TR.EFF_THRU_DT &gt;= #slsDt#)
                AND TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdState#
            )
        )
        AND
        (
            (
                SELECT COUNT(1) FROM    
                     TRTY_RULE   TR
                WHERE
                    TR.GLBL_CMPY_CD              = #glblCmpyCd#
                AND TR.EZCANCELFLAG              = '0'
                AND TR.ORG_CD                    = DOU.ORG_CD
                AND TR.TRTY_RULE_LOGIC_TP_CD     != #trtyRuleLogicTpCd#
                AND TR.EFF_FROM_DT               &lt;= #slsDt#
                AND (TR.EFF_THRU_DT IS NULL      OR TR.EFF_THRU_DT &gt;= #slsDt#)
                AND TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdSicCode#
                AND (
                      (
                            TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdEqual#
                        AND TR.TRTY_RULE_FROM_VAL_TXT    = WRK.DS_CUST_SIC_CD
                      )
                      OR
                      (
                            TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdIn#
                        AND (
                               TR.TRTY_RULE_FROM_VAL_TXT = WRK.DS_CUST_SIC_CD
                            OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, WRK.DS_CUST_SIC_CD || ',') = 1
                            OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, ',' || WRK.DS_CUST_SIC_CD || ',') > 0
                            OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, ',' || WRK.DS_CUST_SIC_CD) = (LENGTH(TR.TRTY_RULE_FROM_VAL_TXT) - LENGTH(WRK.DS_CUST_SIC_CD) + 1) 
                        )
                      )
                      OR  
                      (
                            TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdLike#
                        AND WRK.DS_CUST_SIC_CD           LIKE TR.TRTY_RULE_FROM_VAL_TXT
                      )
                      OR
                      (
                            TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdBetween#
                        AND TR.TRTY_RULE_FROM_VAL_TXT    &lt;= WRK.DS_CUST_SIC_CD
                        AND TR.TRTY_RULE_THRU_VAL_TXT    &gt;= WRK.DS_CUST_SIC_CD
                      )
                )
            )
            =
            (
                SELECT COUNT(1) FROM    
                     TRTY_RULE   TR
                WHERE
                    TR.GLBL_CMPY_CD              = #glblCmpyCd#
                AND TR.EZCANCELFLAG              = '0'
                AND TR.ORG_CD                    = DOU.ORG_CD
                AND TR.TRTY_RULE_LOGIC_TP_CD     != #trtyRuleLogicTpCd#
                AND TR.EFF_FROM_DT               &lt;= #slsDt#
                AND (TR.EFF_THRU_DT IS NULL      OR TR.EFF_THRU_DT &gt;= #slsDt#)
                AND TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdSicCode#
            )
        )
        AND
        (
            (
                SELECT COUNT(1) FROM    
                     TRTY_RULE   TR
                WHERE
                    TR.GLBL_CMPY_CD              = #glblCmpyCd#
                AND TR.EZCANCELFLAG              = '0'
                AND TR.ORG_CD                    = DOU.ORG_CD
                AND TR.TRTY_RULE_LOGIC_TP_CD     != #trtyRuleLogicTpCd#
                AND TR.EFF_FROM_DT               &lt;= #slsDt#
                AND (TR.EFF_THRU_DT IS NULL      OR TR.EFF_THRU_DT &gt;= #slsDt#)
                AND TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdPostalCode#
                AND 
                (
                    (   
                          TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdEqual#
                      AND TR.TRTY_RULE_FROM_VAL_TXT    = WRK.POST_CD
                    )
                    OR
                    (
                          TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdLike#
                      AND WRK.POST_CD             LIKE TR.TRTY_RULE_FROM_VAL_TXT
                    )
                    OR
                    (
                          TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdBetween#
                      AND TR.TRTY_RULE_FROM_VAL_TXT    &lt;= WRK.POST_CD
                      AND TR.TRTY_RULE_THRU_VAL_TXT    &gt;= WRK.POST_CD
                    )
                )
            )
            =
            (
                SELECT COUNT(1) FROM    
                     TRTY_RULE   TR
                WHERE
                    TR.GLBL_CMPY_CD              = #glblCmpyCd#
                AND TR.EZCANCELFLAG              = '0'
                AND TR.ORG_CD                    = DOU.ORG_CD
                AND TR.TRTY_RULE_LOGIC_TP_CD     != #trtyRuleLogicTpCd#
                AND TR.EFF_FROM_DT               &lt;= #slsDt#
                AND (TR.EFF_THRU_DT IS NULL      OR TR.EFF_THRU_DT &gt;= #slsDt#)
                AND TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdPostalCode#
            )
        )
        AND
        (
            (
                SELECT COUNT(1) FROM    
                     TRTY_RULE   TR
                WHERE
                    TR.GLBL_CMPY_CD              = #glblCmpyCd#
                AND TR.EZCANCELFLAG              = '0'
                AND TR.ORG_CD                    = DOU.ORG_CD
                AND TR.TRTY_RULE_LOGIC_TP_CD     != #trtyRuleLogicTpCd#
                AND TR.EFF_FROM_DT               &lt;= #slsDt#
                AND (TR.EFF_THRU_DT IS NULL      OR TR.EFF_THRU_DT &gt;= #slsDt#)
                AND TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdAccountName#
                AND 
                (
                    (   
                          TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdEqual#
                      AND TR.TRTY_RULE_FROM_VAL_TXT    = WRK.DS_ACCT_NM 
                    )
                    OR
                    (
                          TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdLike#
                      AND WRK.DS_ACCT_NM            LIKE TR.TRTY_RULE_FROM_VAL_TXT
                    )
                    OR
                    (   
                          TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdBetween#
                      AND TR.TRTY_RULE_FROM_VAL_TXT    &lt;= WRK.DS_ACCT_NM
                      AND TR.TRTY_RULE_THRU_VAL_TXT    &gt;= WRK.DS_ACCT_NM
                    )
                )
            )
            =
            (
                SELECT COUNT(1) FROM    
                     TRTY_RULE   TR
                WHERE
                    TR.GLBL_CMPY_CD              = #glblCmpyCd#
                AND TR.EZCANCELFLAG              = '0'
                AND TR.ORG_CD                    = DOU.ORG_CD
                AND TR.TRTY_RULE_LOGIC_TP_CD     != #trtyRuleLogicTpCd#
                AND TR.EFF_FROM_DT               &lt;= #slsDt#
                AND (TR.EFF_THRU_DT IS NULL      OR TR.EFF_THRU_DT &gt;= #slsDt#)
                AND TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdAccountName#
            )
        )
     QC#15214 Del End -->
<!-- QC#15214 Add Start -->
    WITH
        <!-- START 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
        <!-- WRK AS ( -->
        WRK_LIST AS (
        <!-- END 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
            <iterate property="wrkDataList" var="wrkDataList[]" open="" close="" conjunction="UNION ALL">
                SELECT
                    #wrkDataList[].xxRowNum#    XX_ROW_NUM
                   ,#wrkDataList[].stCd#        ST_CD
                   ,#wrkDataList[].postCd#      POST_CD
                   ,#wrkDataList[].dsAcctNm#    DS_ACCT_NM
                   ,#wrkDataList[].dsCustSicCd# DS_CUST_SIC_CD
                FROM
                    DUAL
            </iterate>
        )
       <!-- START 2018/06/01 Hd.Sugawara [QC#24293,ADD] -->
       ,WRK AS (
            SELECT
                WRK_LIST.XX_ROW_NUM
               ,STC.SELL_TO_CUST_CD AS DS_ACCT_NUM
               ,WRK_LIST.ST_CD
               ,WRK_LIST.POST_CD
               ,WRK_LIST.DS_CUST_SIC_CD
            FROM
                SELL_TO_CUST STC
               ,ACCT_LOC LOC
               ,PTY_LOC_WRK PTY
               ,WRK_LIST
            WHERE
                    STC.GLBL_CMPY_CD          = #glblCmpyCd#
                AND STC.EZCANCELFLAG          = '0'
                AND STC.DS_ACCT_ACTV_CUST_FLG = #flgOnY#
                AND STC.GLBL_CMPY_CD          = LOC.GLBL_CMPY_CD
                AND STC.SELL_TO_CUST_CD       = LOC.DS_ACCT_NUM
                AND LOC.EZCANCELFLAG          = '0'
                AND LOC.GLBL_CMPY_CD          = PTY.GLBL_CMPY_CD
                AND LOC.PTY_LOC_PK            = PTY.PTY_LOC_PK
                AND PTY.EZCANCELFLAG          = '0'
                AND PTY.RGTN_STS_CD           = #rgtnStsCd#
                AND WRK_LIST.DS_ACCT_NM       = STC.DS_ACCT_NM
                AND (
                    WRK_LIST.ST_CD            IS NULL
                    OR
                    WRK_LIST.ST_CD            = PTY.ST_CD
                )
                AND (
                    WRK_LIST.POST_CD          IS NULL
                    OR
                    WRK_LIST.POST_CD          = PTY.POST_CD
                )
                AND (
                    WRK_LIST.DS_CUST_SIC_CD   IS NULL
                    OR
                    WRK_LIST.DS_CUST_SIC_CD   = PTY.DS_CUST_SIC_CD
                ) 
            UNION ALL
            SELECT
                WRK_LIST.XX_ROW_NUM
               ,DAP.DS_ACCT_NUM
               ,WRK_LIST.ST_CD
               ,WRK_LIST.POST_CD
               ,WRK_LIST.DS_CUST_SIC_CD
            FROM
                DS_ACCT_PROS DAP
               ,PROS_PTY_LOC_WRK PTY
               ,WRK_LIST
            WHERE
                    DAP.GLBL_CMPY_CD          = #glblCmpyCd#
                AND DAP.EZCANCELFLAG          = '0'
                AND DAP.DS_ACCT_ACTV_CUST_FLG = #flgOnY#
                AND DAP.GLBL_CMPY_CD          = PTY.GLBL_CMPY_CD
                AND DAP.PTY_LOC_PK            = PTY.PTY_LOC_PK
                AND PTY.EZCANCELFLAG          = '0'
                AND PTY.RGTN_STS_CD           = #rgtnStsCd#
                AND WRK_LIST.DS_ACCT_NM       = DAP.DS_ACCT_NM
                AND (
                    WRK_LIST.ST_CD            IS NULL
                    OR
                    WRK_LIST.ST_CD            = PTY.ST_CD
                ) 
                AND (
                    WRK_LIST.POST_CD          IS NULL
                    OR
                    WRK_LIST.POST_CD          = PTY.POST_CD
                )
                AND (
                    WRK_LIST.DS_CUST_SIC_CD   IS NULL
                    OR
                    WRK_LIST.DS_CUST_SIC_CD   = PTY.DS_CUST_SIC_CD
                )
       )
       <!-- END 2018/06/01 Hd.Sugawara [QC#24293,ADD] -->
       ,TRTY_CNT AS (
            SELECT
                <!-- START 2018/06/01 Hd.Sugawara [QC#24293,ADD] -->
                WRK.XX_ROW_NUM,
                WRK.DS_ACCT_NUM,
                <!-- END 2018/06/01 Hd.Sugawara [QC#24293,ADD] -->
                TR.ORG_CD,
                SUM(
                    CASE
                        WHEN
                            TR.TRTY_RULE_TP_CD = #trtyRuleTpCdState#
                        AND
                            (
                                (
                                 TR.TRTY_RULE_OPRD_TP_CD       = #trtyRuleOprdTpCdEqual#
                                 AND TR.TRTY_RULE_FROM_VAL_TXT = WRK.ST_CD
                                )
                            <!-- START 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
                            <!-- OR -->
                            <!--     ( -->
                            <!--         TR.TRTY_RULE_OPRD_TP_CD = #trtyRuleOprdTpCdIn# -->
                            <!--     AND -->
                            <!--         ( -->
                            <!--          TR.TRTY_RULE_FROM_VAL_TXT = WRK.ST_CD -->
                            <!--          OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, WRK.ST_CD || ',') = 1 -->
                            <!--          OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, ',' || WRK.ST_CD || ',') &gt; 0 -->
                            <!--          OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, ',' || WRK.ST_CD) = (LENGTH(TR.TRTY_RULE_FROM_VAL_TXT) - LENGTH(WRK.ST_CD) + 1) -->
                            <!--         ) -->
                            <!--     ) -->
                            <!-- OR -->
                            <!--     ( -->
                            <!--      TR.TRTY_RULE_OPRD_TP_CD = #trtyRuleOprdTpCdLike# -->
                            <!--      AND WRK.ST_CD           LIKE TR.TRTY_RULE_FROM_VAL_TXT -->
                            <!--     ) -->
                            <!-- OR -->
                            <!--     ( -->
                            <!--      TR.TRTY_RULE_OPRD_TP_CD       = #trtyRuleOprdTpCdBetween# -->
                            <!--      AND TR.TRTY_RULE_FROM_VAL_TXT &lt;= WRK.ST_CD -->
                            <!--      AND TR.TRTY_RULE_THRU_VAL_TXT &gt;= WRK.ST_CD -->
                            <!--     ) -->
                            <!-- END 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
                            )
                        THEN 1
                        ELSE 0
                    END
                ) AS CNT1_1,
                SUM(
                    CASE
                        WHEN TR.TRTY_RULE_TP_CD = #trtyRuleTpCdState# THEN 1
                        ELSE 0
                    END
                ) AS CNT1_2,
                <!-- START 2018/06/01 Hd.Sugawara [QC#24293,ADD] -->
                SUM(
                    CASE
                        WHEN WRK.ST_CD IS NOT NULL THEN 1
                        ELSE 0
                    END
                ) AS CNT1_3,
                <!-- END 2018/06/01 Hd.Sugawara [QC#24293,ADD] -->
                SUM(
                    CASE
                        WHEN
                            TR.TRTY_RULE_TP_CD = #trtyRuleTpCdSicCode#
                        AND
                            (
                                (
                                 TR.TRTY_RULE_OPRD_TP_CD       = #trtyRuleOprdTpCdEqual#
                                 AND TR.TRTY_RULE_FROM_VAL_TXT = WRK.DS_CUST_SIC_CD
                                )
                            <!-- START 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
                            <!-- OR -->
                            <!--     ( -->
                            <!--      TR.TRTY_RULE_OPRD_TP_CD = #trtyRuleOprdTpCdIn# -->
                            <!--      AND -->
                            <!--         ( -->
                            <!--          TR.TRTY_RULE_FROM_VAL_TXT = WRK.DS_CUST_SIC_CD -->
                            <!--          OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, WRK.DS_CUST_SIC_CD || ',') = 1 -->
                            <!--          OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, ',' || WRK.DS_CUST_SIC_CD || ',') &gt; 0 -->
                            <!--          OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, ',' || WRK.DS_CUST_SIC_CD) = (LENGTH(TR.TRTY_RULE_FROM_VAL_TXT) - LENGTH(WRK.DS_CUST_SIC_CD) + 1) -->
                            <!--         ) -->
                            <!--     ) -->
                            <!-- OR -->
                            <!--     ( -->
                            <!--      TR.TRTY_RULE_OPRD_TP_CD = #trtyRuleOprdTpCdLike# -->
                            <!--      AND WRK.DS_CUST_SIC_CD  LIKE TR.TRTY_RULE_FROM_VAL_TXT -->
                            <!--     ) -->
                            <!-- OR -->
                            <!--     ( -->
                            <!--      TR.TRTY_RULE_OPRD_TP_CD       = #trtyRuleOprdTpCdBetween# -->
                            <!--      AND TR.TRTY_RULE_FROM_VAL_TXT &lt;= WRK.DS_CUST_SIC_CD -->
                            <!--      AND TR.TRTY_RULE_THRU_VAL_TXT &gt;= WRK.DS_CUST_SIC_CD -->
                            <!--     ) -->
                            <!-- END 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
                            )
                        THEN 1
                        ELSE 0
                    END
                ) AS CNT2_1,
                SUM(
                    CASE
                        WHEN TR.TRTY_RULE_TP_CD = #trtyRuleTpCdSicCode# THEN 1
                        ELSE 0
                    END
                ) AS CNT2_2,
                <!-- START 2018/06/01 Hd.Sugawara [QC#24293,ADD] -->
                SUM(
                    CASE
                        WHEN WRK.DS_CUST_SIC_CD IS NOT NULL THEN 1
                        ELSE 0
                    END
                ) AS CNT2_3,
                <!-- END 2018/06/01 Hd.Sugawara [QC#24293,ADD] -->
                SUM(
                    CASE
                        WHEN
                            TR.TRTY_RULE_TP_CD = #trtyRuleTpCdPostalCode#
                        AND
                            (
                                (
                                 TR.TRTY_RULE_OPRD_TP_CD       = #trtyRuleOprdTpCdEqual#
                                 AND TR.TRTY_RULE_FROM_VAL_TXT = WRK.POST_CD
                                )
                            OR
                            <!-- START 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
                            <!--     ( -->
                            <!--      TR.TRTY_RULE_OPRD_TP_CD = #trtyRuleOprdTpCdLike# -->
                            <!--      AND WRK.POST_CD         LIKE TR.TRTY_RULE_FROM_VAL_TXT -->
                            <!--     ) -->
                            <!-- OR -->
                            <!-- END 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
                                (
                                 TR.TRTY_RULE_OPRD_TP_CD       = #trtyRuleOprdTpCdBetween#
                                 AND TR.TRTY_RULE_FROM_VAL_TXT &lt;= WRK.POST_CD
                                 AND TR.TRTY_RULE_THRU_VAL_TXT &gt;= WRK.POST_CD
                                )
                            )
                        THEN 1
                        ELSE 0
                    END
                ) AS CNT3_1,
                SUM(
                    CASE
                        WHEN TR.TRTY_RULE_TP_CD = #trtyRuleTpCdPostalCode# THEN 1
                        ELSE 0
                    END
                ) AS CNT3_2,
                <!-- START 2018/06/01 Hd.Sugawara [QC#24293,ADD] -->
                SUM(
                    CASE
                        WHEN WRK.POST_CD IS NOT NULL THEN 1
                        ELSE 0
                    END
                ) AS CNT3_3,
                <!-- END 2018/06/01 Hd.Sugawara [QC#24293,ADD] -->
                SUM(
                    CASE
                        WHEN
                            <!-- START 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
                            <!-- TR.TRTY_RULE_TP_CD = #trtyRuleTpCdAccountName# -->
                            TR.TRTY_RULE_TP_CD = #trtyRuleTpCdAccountNumber#
                            <!-- END 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
                            AND
                            (
                                (
                                 TR.TRTY_RULE_OPRD_TP_CD       = #trtyRuleOprdTpCdEqual#
                                 <!-- START 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
                                 <!-- AND TR.TRTY_RULE_FROM_VAL_TXT = WRK.DS_ACCT_NM -->
                                 AND TR.TRTY_RULE_FROM_VAL_TXT = WRK.DS_ACCT_NUM
                                 <!-- END 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
                                )
                             <!-- START 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
                             <!-- OR -->
                             <!--    ( -->
                             <!--     TR.TRTY_RULE_OPRD_TP_CD = #trtyRuleOprdTpCdLike# -->
                             <!--     AND WRK.DS_ACCT_NM      LIKE TR.TRTY_RULE_FROM_VAL_TXT -->
                             <!--    ) -->
                            <!-- OR -->
                             <!--    ( -->
                             <!--     TR.TRTY_RULE_OPRD_TP_CD       = #trtyRuleOprdTpCdBetween# -->
                             <!--     AND TR.TRTY_RULE_FROM_VAL_TXT &lt;= WRK.DS_ACCT_NM -->
                             <!--     AND TR.TRTY_RULE_THRU_VAL_TXT &gt;= WRK.DS_ACCT_NM -->
                             <!--    ) -->
                             <!-- END 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
                            )
                        THEN 1
                        ELSE 0
                    END
                ) AS CNT4_1,
                SUM(
                    CASE
                        <!-- START 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
                        <!-- WHEN TR.TRTY_RULE_TP_CD = #trtyRuleTpCdAccountName# THEN 1 -->
                        WHEN TR.TRTY_RULE_TP_CD = #trtyRuleTpCdAccountNumber# THEN 1
                        <!-- END 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
                        ELSE 0
                    END
                <!-- START 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
                <!-- ) AS CNT4_2 -->
                ) AS CNT4_2,
                SUM(
                    CASE
                        WHEN WRK.DS_ACCT_NUM IS NOT NULL THEN 1
                        ELSE 0
                    END
                ) AS CNT4_3
                <!-- END 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
            FROM
                TRTY_RULE TR
               ,WRK
            WHERE
                TR.GLBL_CMPY_CD              = #glblCmpyCd#
                AND TR.EZCANCELFLAG          = '0'
                AND TR.TRTY_RULE_LOGIC_TP_CD != #trtyRuleLogicTpCd#
                AND TR.EFF_FROM_DT           &lt;= #slsDt#
                AND (TR.EFF_THRU_DT IS NULL OR TR.EFF_THRU_DT &gt;= #slsDt#)
            GROUP BY
            <!-- START 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
            <!--     TR.ORG_CD -->
                WRK.XX_ROW_NUM
               ,WRK.DS_ACCT_NUM
               ,TR.ORG_CD
            <!-- END 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
        ) -- WITH END
    SELECT DISTINCT
        DOU.ORG_CD
       ,DOU.ORG_NM
    <!-- START 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
    <!--    ,WRK.XX_ROW_NUM -->
       ,TRTY_CNT.XX_ROW_NUM
    <!-- END 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
    FROM
        DS_ORG_UNIT DOU
       ,TRTY_CNT
    <!-- START 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
    <!--    ,WRK -->
    <!-- END 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
    WHERE
        DOU.GLBL_CMPY_CD     = #glblCmpyCd#
        AND DOU.GNRN_TP_CD   IN(#gnrnTpCurrent#, #gnrnTpFuture#)
        AND DOU.EZCANCELFLAG = '0'
        AND DOU.ORG_CD       = TRTY_CNT.ORG_CD
        AND TRTY_CNT.CNT1_1  = TRTY_CNT.CNT1_2
        AND TRTY_CNT.CNT2_1  = TRTY_CNT.CNT2_2
        AND TRTY_CNT.CNT3_1  = TRTY_CNT.CNT3_2
        AND TRTY_CNT.CNT4_1  = TRTY_CNT.CNT4_2
        <!-- START 2018/06/01 Hd.Sugawara [QC#24293,ADD] -->
        AND (
                (TRTY_CNT.CNT1_2 > 0 AND TRTY_CNT.CNT1_3 > 0)
                OR
                (TRTY_CNT.CNT1_2 = 0 AND TRTY_CNT.CNT1_3 = 0)
            )
        AND (
                (TRTY_CNT.CNT2_2 > 0 AND TRTY_CNT.CNT2_3 > 0)
                OR
                (TRTY_CNT.CNT2_2 = 0 AND TRTY_CNT.CNT2_3 = 0)
            )
        AND (
                (TRTY_CNT.CNT3_2 > 0 AND TRTY_CNT.CNT3_3 > 0)
                OR
                (TRTY_CNT.CNT3_2 = 0 AND TRTY_CNT.CNT3_3 = 0)
            )
        AND (
                (TRTY_CNT.CNT4_2 > 0 AND TRTY_CNT.CNT4_3 > 0)
                OR
                (TRTY_CNT.CNT4_2 = 0 AND TRTY_CNT.CNT4_3 = 0)
            )
        <!-- END 2018/06/01 Hd.Sugawara [QC#24293,ADD] -->
        AND EXISTS (
                    SELECT
                        1
                    FROM
                        TRTY_RULE   TR
                    WHERE
                        TR.GLBL_CMPY_CD              = #glblCmpyCd#
                        AND TR.TRTY_RULE_LOGIC_TP_CD != #trtyRuleLogicTpCd#
                        AND TR.EFF_FROM_DT           &lt;= #slsDt#
                        AND (TR.EFF_THRU_DT IS NULL OR TR.EFF_THRU_DT &gt;= #slsDt#)
                        <!-- START 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
                        <!-- AND TR.TRTY_RULE_TP_CD       IN (#trtyRuleTpCdPostalCode#, #trtyRuleTpCdState#, #trtyRuleTpCdAccountName#, #trtyRuleTpCdSicCode#) -->
                        AND TR.TRTY_RULE_TP_CD       IN (#trtyRuleTpCdPostalCode#, #trtyRuleTpCdState#, #trtyRuleTpCdAccountNumber#, #trtyRuleTpCdSicCode#)
                        <!-- END 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
                        AND TR.EZCANCELFLAG          = '0'
                        AND TR.GLBL_CMPY_CD          = DOU.GLBL_CMPY_CD
                        AND TR.ORG_CD                = DOU.ORG_CD
                   )
        AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            TRTY_RULE   TR
                        WHERE
                            TR.GLBL_CMPY_CD              = #glblCmpyCd#
                            AND TR.TRTY_RULE_LOGIC_TP_CD != #trtyRuleLogicTpCd#
                            AND TR.EFF_FROM_DT           &lt;= #slsDt#
                            AND (TR.EFF_THRU_DT IS NULL OR TR.EFF_THRU_DT &gt;= #slsDt#)
                            <!-- START 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
                            <!-- AND TR.TRTY_RULE_TP_CD       NOT IN (#trtyRuleTpCdPostalCode#, #trtyRuleTpCdState#, #trtyRuleTpCdAccountName#, #trtyRuleTpCdSicCode#) -->
                            AND TR.TRTY_RULE_TP_CD       NOT IN (#trtyRuleTpCdPostalCode#, #trtyRuleTpCdState#, #trtyRuleTpCdAccountNumber#, #trtyRuleTpCdSicCode#)
                            <!-- END 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
                            AND TR.EZCANCELFLAG          = '0'
                            AND TR.GLBL_CMPY_CD          = DOU.GLBL_CMPY_CD
                            AND TR.ORG_CD                = DOU.ORG_CD
                       )
<!-- QC#15214 Add End -->
    </statement>

   <statement id="getPartialMatchTerritory" parameterClass="Map" resultClass="Map">
    <!-- QC#12258 -->
    <!-- START 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
    <!-- WITH WRK AS ( -->
    WITH WRK_LIST AS (
    <!-- END 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
        <iterate property="wrkDataList" var="wrkDataList[]" open="" close="" conjunction="UNION ALL">
            SELECT #wrkDataList[].xxRowNum# XX_ROW_NUM, #wrkDataList[].stCd# ST_CD, #wrkDataList[].postCd# POST_CD, #wrkDataList[].dsAcctNm# DS_ACCT_NM, #wrkDataList[].dsCustSicCd# DS_CUST_SIC_CD FROM DUAL 
        </iterate>
    )
    <!-- START 2018/06/01 Hd.Sugawara [QC#24293,ADD] -->
    ,WRK AS (
            SELECT
                WRK_LIST.XX_ROW_NUM
               ,STC.SELL_TO_CUST_CD AS DS_ACCT_NUM
               ,WRK_LIST.ST_CD
               ,WRK_LIST.POST_CD
               ,WRK_LIST.DS_CUST_SIC_CD
            FROM
                SELL_TO_CUST STC
               ,ACCT_LOC LOC
               ,PTY_LOC_WRK PTY
               ,WRK_LIST
            WHERE
                    STC.GLBL_CMPY_CD          = #glblCmpyCd#
                AND STC.EZCANCELFLAG          = '0'
                AND STC.DS_ACCT_ACTV_CUST_FLG = #flgOnY#
                AND STC.GLBL_CMPY_CD          = LOC.GLBL_CMPY_CD
                AND STC.SELL_TO_CUST_CD       = LOC.DS_ACCT_NUM
                AND LOC.EZCANCELFLAG          = '0'
                AND LOC.GLBL_CMPY_CD          = PTY.GLBL_CMPY_CD
                AND LOC.PTY_LOC_PK            = PTY.PTY_LOC_PK
                AND PTY.EZCANCELFLAG          = '0'
                AND PTY.RGTN_STS_CD           = #rgtnStsCd#
                AND WRK_LIST.DS_ACCT_NM       = STC.DS_ACCT_NM
                AND (
                    WRK_LIST.ST_CD            IS NULL
                    OR
                    WRK_LIST.ST_CD            = PTY.ST_CD
                )
                AND (
                    WRK_LIST.POST_CD          IS NULL
                    OR
                    WRK_LIST.POST_CD          = PTY.POST_CD
                )
                AND (
                    WRK_LIST.DS_CUST_SIC_CD   IS NULL
                    OR
                    WRK_LIST.DS_CUST_SIC_CD   = PTY.DS_CUST_SIC_CD
                ) 
            UNION ALL
            SELECT
                WRK_LIST.XX_ROW_NUM
               ,DAP.DS_ACCT_NUM
               ,WRK_LIST.ST_CD
               ,WRK_LIST.POST_CD
               ,WRK_LIST.DS_CUST_SIC_CD
            FROM
                DS_ACCT_PROS DAP
               ,PROS_PTY_LOC_WRK PTY
               ,WRK_LIST
            WHERE
                    DAP.GLBL_CMPY_CD          = #glblCmpyCd#
                AND DAP.EZCANCELFLAG          = '0'
                AND DAP.DS_ACCT_ACTV_CUST_FLG = #flgOnY#
                AND DAP.GLBL_CMPY_CD          = PTY.GLBL_CMPY_CD
                AND DAP.PTY_LOC_PK            = PTY.PTY_LOC_PK
                AND PTY.EZCANCELFLAG          = '0'
                AND PTY.RGTN_STS_CD           = #rgtnStsCd#
                AND WRK_LIST.DS_ACCT_NM       = DAP.DS_ACCT_NM
                AND (
                    WRK_LIST.ST_CD            IS NULL
                    OR
                    WRK_LIST.ST_CD            = PTY.ST_CD
                ) 
                AND (
                    WRK_LIST.POST_CD          IS NULL
                    OR
                    WRK_LIST.POST_CD          = PTY.POST_CD
                )
                AND (
                    WRK_LIST.DS_CUST_SIC_CD   IS NULL
                    OR
                    WRK_LIST.DS_CUST_SIC_CD   = PTY.DS_CUST_SIC_CD
                )
    )
    <!-- END 2018/06/01 Hd.Sugawara [QC#24293,ADD] -->
         <iterate property="condTpList" var="condTpList[]" open="" close="" conjunction="UNION">
        SELECT DISTINCT
            DOU.ORG_CD
          , DOU.ORG_NM
          , WRK.XX_ROW_NUM
        FROM
            TRTY_RULE   TR
          , DS_ORG_UNIT DOU 
          , WRK
        WHERE
            TR.GLBL_CMPY_CD              = #glblCmpyCd#
        AND TR.EZCANCELFLAG              = '0'
        AND TR.TRTY_RULE_LOGIC_TP_CD     != #trtyRuleLogicTpCd#
        AND TR.EFF_FROM_DT               &lt;= #slsDt#
        AND   (TR.EFF_THRU_DT IS NULL
            OR TR.EFF_THRU_DT            &gt;= #slsDt#)
        AND (1=0
        <isEqual property="condTpList[]" compareValue="state_equal">
        OR
        (
                TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdState#
            AND TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdEqual#
            AND TR.TRTY_RULE_FROM_VAL_TXT    = WRK.ST_CD
        )
        </isEqual>
        <!-- START 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
        <!-- <isEqual property="condTpList[]" compareValue="state_in"> -->
        <!-- OR -->
        <!-- ( -->
        <!--         TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdState# -->
        <!--     AND TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdIn# -->
        <!--     AND ( -->
        <!--            TR.TRTY_RULE_FROM_VAL_TXT = WRK.DS_CUST_SIC_CD -->
        <!--         OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, WRK.DS_CUST_SIC_CD || ',') = 1 -->
        <!--         OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, ',' || WRK.DS_CUST_SIC_CD || ',') > 0 -->
        <!--         OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, ',' || WRK.DS_CUST_SIC_CD) = (LENGTH(TR.TRTY_RULE_FROM_VAL_TXT) - LENGTH(WRK.DS_CUST_SIC_CD) + 1) --> 
        <!--     ) -->
        <!-- ) -->
        <!-- </isEqual> -->
        <!-- <isEqual property="condTpList[]" compareValue="state_like"> -->
        <!-- OR -->
        <!-- ( -->
        <!--         TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdState# -->
        <!--     AND TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdLike# -->
        <!--     AND WRK.ST_CD                 LIKE TR.TRTY_RULE_FROM_VAL_TXT  -->
        <!-- ) -->
        <!-- </isEqual> -->
        <!-- <isEqual property="condTpList[]" compareValue="state_between"> -->
        <!-- OR -->
        <!-- ( -->
        <!--         TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdState# -->
        <!--     AND TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdBetween# -->
        <!--     AND TR.TRTY_RULE_FROM_VAL_TXT    &lt;= WRK.ST_CD -->
        <!--     AND TR.TRTY_RULE_THRU_VAL_TXT    &gt;= WRK.ST_CD -->
        <!-- ) -->
        <!-- </isEqual> -->
        <!-- END 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
        <isEqual property="condTpList[]" compareValue="post_equal">
        OR 
        (   
                TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdPostalCode#
            AND TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdEqual#
            AND TR.TRTY_RULE_FROM_VAL_TXT    = WRK.POST_CD
        )
        </isEqual>
        <!-- START 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
        <!-- <isEqual property="condTpList[]" compareValue="post_like"> -->
        <!-- OR -->
        <!-- ( -->
        <!--         TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdPostalCode# -->
        <!--     AND TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdLike#  -->
        <!--     AND WRK.POST_CD               LIKE TR.TRTY_RULE_FROM_VAL_TXT -->
        <!-- ) -->
        <!-- </isEqual> -->
        <!-- END 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
        <isEqual property="condTpList[]" compareValue="post_between_sameHeader">
        OR
        (
                TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdPostalCode#
            AND TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdBetween#
            AND SUBSTR(TR.TRTY_RULE_FROM_VAL_TXT,1,5) = SUBSTR(TR.TRTY_RULE_THRU_VAL_TXT,1,5)
            AND SUBSTR(TR.TRTY_RULE_FROM_VAL_TXT,1,5) = SUBSTR(WRK.POST_CD,1,5)
            AND TR.TRTY_RULE_FROM_VAL_TXT    &lt;= WRK.POST_CD
            AND TR.TRTY_RULE_THRU_VAL_TXT    &gt;= WRK.POST_CD
        )
        </isEqual>
        <isEqual property="condTpList[]" compareValue="post_between_diffHeader">
        OR
        (
                TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdPostalCode#
            AND TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdBetween#
            AND SUBSTR(TR.TRTY_RULE_FROM_VAL_TXT,1,5) != SUBSTR(TR.TRTY_RULE_THRU_VAL_TXT,1,5)
            AND TR.TRTY_RULE_FROM_VAL_TXT    &lt;= WRK.POST_CD
            AND TR.TRTY_RULE_THRU_VAL_TXT    &gt;= WRK.POST_CD
        )
        </isEqual>
        <isEqual property="condTpList[]" compareValue="account_equal">
        OR 
        (
            <!-- START 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
            <!--     TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdAccountName# -->
                TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdAccountNumber#
            <!-- END 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
            AND TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdEqual#
            <!-- START 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
            <!-- AND TR.TRTY_RULE_FROM_VAL_TXT    = WRK.DS_ACCT_NM -->
            AND TR.TRTY_RULE_FROM_VAL_TXT    = WRK.DS_ACCT_NUM
            <!-- END 2018/06/01 Hd.Sugawara [QC#24293,MOD] -->
        )
        </isEqual>
        <!-- START 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
        <!-- <isEqual property="condTpList[]" compareValue="account_like"> -->
        <!-- OR -->
        <!-- ( -->
        <!--         TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdAccountName# -->
        <!--     AND TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdLike#  -->
        <!--     AND WRK.DS_ACCT_NM            LIKE TR.TRTY_RULE_FROM_VAL_TXT -->
        <!-- ) -->
        <!-- </isEqual> -->
        <!-- <isEqual property="condTpList[]" compareValue="account_between"> -->
        <!-- OR -->
        <!-- ( -->
        <!--         TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdAccountName# -->
        <!--     AND TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdBetween#  -->
        <!--     AND TR.TRTY_RULE_FROM_VAL_TXT    &lt;= WRK.DS_ACCT_NM -->
        <!--     AND TR.TRTY_RULE_THRU_VAL_TXT    &gt;= WRK.DS_ACCT_NM -->
        <!-- ) -->
        <!-- </isEqual> -->
        <!-- END 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
        <isEqual property="condTpList[]" compareValue="sic_equal">
        OR
        (
                TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdSicCode#
            AND TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdEqual#
            AND TR.TRTY_RULE_FROM_VAL_TXT    = WRK.DS_CUST_SIC_CD
        )
        </isEqual>
        <!-- START 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
        <!-- <isEqual property="condTpList[]" compareValue="sic_in"> -->
        <!-- OR -->
        <!-- ( -->
        <!--         TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdSicCode# -->
        <!--     AND TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdIn# -->
        <!--     AND ( -->
        <!--            TR.TRTY_RULE_FROM_VAL_TXT = WRK.DS_CUST_SIC_CD -->
        <!--         OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, WRK.DS_CUST_SIC_CD || ',') = 1 -->
        <!--         OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, ',' || WRK.DS_CUST_SIC_CD || ',') > 0 -->
        <!--         OR INSTR(TR.TRTY_RULE_FROM_VAL_TXT, ',' || WRK.DS_CUST_SIC_CD) = (LENGTH(TR.TRTY_RULE_FROM_VAL_TXT) - LENGTH(WRK.DS_CUST_SIC_CD) + 1) --> 
        <!--     ) -->
        <!-- ) -->
        <!-- </isEqual> -->
        <!-- <isEqual property="condTpList[]" compareValue="sic_like"> -->
        <!-- OR -->
        <!-- ( -->
        <!--         TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdSicCode# -->
        <!--     AND TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdLike# -->
        <!--     AND WRK.DS_CUST_SIC_CD        LIKE TR.TRTY_RULE_FROM_VAL_TXT  -->
        <!-- ) -->
        <!-- </isEqual> -->
        <!-- <isEqual property="condTpList[]" compareValue="sic_between"> -->
        <!-- OR -->
        <!-- ( -->
        <!--         TR.TRTY_RULE_TP_CD           = #trtyRuleTpCdSicCode# -->
        <!--     AND TR.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCdBetween# -->
        <!--     AND TR.TRTY_RULE_FROM_VAL_TXT    &lt;= WRK.DS_CUST_SIC_CD -->
        <!--     AND TR.TRTY_RULE_THRU_VAL_TXT    &gt;= WRK.DS_CUST_SIC_CD -->
        <!-- ) -->
        <!-- </isEqual> -->
        <!-- END 2018/06/01 Hd.Sugawara [QC#24293,DEL] -->
        )
        AND TR.GLBL_CMPY_CD              = DOU.GLBL_CMPY_CD
        AND TR.ORG_CD                    = DOU.ORG_CD
        AND DOU.GNRN_TP_CD               IN(#gnrnTpCurrent#, #gnrnTpFuture#)
        AND DOU.EZCANCELFLAG             = '0'
      </iterate>

    </statement>

</sqlMap>
