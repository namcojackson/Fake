<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWAB254001">

    <statement id="getChangeOrder" parameterClass="Map" resultClass="Map">
        SELECT
             CV.CPO_ORD_NUM                           AS CPO_ORD_NUM
            ,CV.CPO_ORD_TS                            AS CPO_ORD_TS
            ,CV.CUST_ISS_PO_NUM                       AS CUST_ISS_PO_NUM
            ,CV.CUST_ISS_PO_DT                        AS CUST_ISS_PO_DT
            ,(SELECT OSV.ORD_HDR_STS_NM
                FROM DS_ORD_STS_V OSV
               WHERE OSV.GLBL_CMPY_CD = CV.GLBL_CMPY_CD
                 AND OSV.CPO_ORD_NUM  = CV.CPO_ORD_NUM
                 AND OSV.EZCANCELFLAG = '0'
                 AND ROWNUM           = 1)             AS ORD_HDR_STS_NM
            ,(SELECT ADM.FULL_PSN_NM
                FROM S21_PSN_V ADM
               WHERE ADM.GLBL_CMPY_CD = CV.GLBL_CMPY_CD
                 AND ADM.PSN_CD       = CV.ADMIN_PSN_CD
                 AND ADM.EZCANCELFLAG = '0'
                 AND ROWNUM           = 1)             AS ADMIN_PSN_NM
            ,CV.ADD_RDD_DT                            AS ADD_RDD_DT
            ,CV.CPO_CANC_DT                           AS CPO_CANC_DT
            ,CV.BILL_TO_CUST_CD                       AS BILL_TO_CUST_CD
            ,CV.ADD_SHIP_TO_CUST_CD                   AS ADD_SHIP_TO_CUST_CD
            ,CV.SELL_TO_CUST_CD                       AS SELL_TO_CUST_CD
            ,CV.ADD_PMT_TERM_CASH_DISC_CD             AS ADD_PMT_TERM_CASH_DISC_CD
            ,CV.ORD_SGN_DT                            AS ORD_SGN_DT
            ,CV.ORG_RQST_DELY_DT                      AS ORG_RQST_DELY_DT
            ,CV.CARR_ACCT_NUM                         AS CARR_ACCT_NUM
            ,CV.BILL_TO_CUST_ACCT_CD                  AS BILL_TO_CUST_ACCT_CD
            ,CV.SHIP_TO_CUST_ACCT_CD                  AS SHIP_TO_CUST_ACCT_CD
            ,CV.NEGO_DEAL_AMT                         AS NEGO_DEAL_AMT
            ,CV.COA_BR_CD                             AS COA_BR_CD
            ,CV.COA_EXTN_CD                           AS COA_EXTN_CD
            ,CV.AQU_NUM                               AS AQU_NUM
            ,CV.ORD_SRC_REF_NUM                       AS ORD_SRC_REF_NUM
            ,CV.PRC_CONTR_NM                          AS PRC_CONTR_NM
            ,CV.PRC_CONTR_NUM                         AS PRC_CONTR_NUM
            ,CV.LOAN_PER_DAYS_AOT                     AS LOAN_PER_DAYS_AOT
            ,CV.CSMP_CONTR_NUM                        AS CSMP_CONTR_NUM
            ,CV.LEASE_CMPY_PO_NUM                     AS LEASE_CMPY_PO_NUM
            ,CV.LEASE_TOT_PMT_AMT                     AS LEASE_TOT_PMT_AMT
            ,CV.ORD_BOOK_TS                           AS ORD_BOOK_TS
            ,CV.DLR_REF_NUM                           AS DLR_REF_NUM
            ,CV.DS_ORD_CATG_DESC_TXT                  AS DS_ORD_CATG_DESC_TXT
            ,CV.ORD_TOT_DEAL_NET_AMT                  AS ORD_TOT_DEAL_NET_AMT
            ,CV.BILL_TO_CUST_ACCT_NM                  AS BILL_TO_CUST_ACCT_NM
            ,CV.BILL_TO_CUST_LOC_ADDR                 AS BILL_TO_CUST_LOC_ADDR
            ,CV.SHIP_TO_CUST_ACCT_NM                  AS SHIP_TO_CUST_ACCT_NM
            ,CV.SHIP_TO_CUST_LOC_ADDR                 AS SHIP_TO_CUST_LOC_ADDR
            ,CV.SOLD_TO_CUST_ACCT_NM                  AS SOLD_TO_CUST_ACCT_NM
            ,CV.SOLD_TO_CUST_LOC_ADDR                 AS SOLD_TO_CUST_LOC_ADDR
            ,CV.SLS_REP_TOC_NM                        AS SLS_REP_TOC_NM
            ,CV.COA_BR_DESC_TXT                       AS COA_BR_DESC_TXT
            ,CV.COA_EXTN_DESC_TXT                     AS COA_EXTN_DESC_TXT
            ,CV.PRC_CATG_NM                           AS PRC_CATG_NM
            ,CV.CPO_SRC_TP_DESC_TXT                   AS CPO_SRC_TP_DESC_TXT
            ,CV.FRT_COND_DESC_TXT                     AS FRT_COND_DESC_TXT
            ,CV.CARR_SVC_LVL_DESC_TXT                 AS CARR_SVC_LVL_DESC_TXT
            ,CV.FL_PRC_LIST_NM                        AS FL_PRC_LIST_NM
            ,CV.LINE_BIZ_TP_CD                        AS LINE_BIZ_TP_CD
            ,CV.DS_ORD_TP_DESC_TXT                    AS DS_ORD_TP_DESC_TXT
            ,CV.LEASE_TERM_MTH_AOT                    AS LEASE_TERM_MTH_AOT
            ,(SELECT APV.FULL_PSN_NM
                FROM S21_PSN_V APV
               WHERE APV.GLBL_CMPY_CD = CV.GLBL_CMPY_CD
                 AND APV.PSN_CD       = CV.SLS_REP_PSN_NUM
                 AND APV.EZCANCELFLAG = '0'
                 AND ROWNUM           = 1)             AS SLS_REP_PSN_NM
            ,CV.ORD_BOOK_REQ_TS_DPLY_TXT              AS ORD_BOOK_REQ_TS_DPLY_TXT
            ,CV.ORD_BOOK_REQ_USR_NM                   AS ORD_BOOK_REQ_USR_NM
            ,CV.ORD_SRC_IMPT_TS                       AS ORD_SRC_IMPT_TS
        FROM
             CPO_V CV
             ,PROC_LAST_EXEC PLE
             ,(SELECT
                 IT.DOC_MGT_BIZ_DOC_NUM
                 ,IT.GLBL_CMPY_CD
                 ,IT.EZCANCELFLAG
             FROM
                 DOC_MGT_INTFC_TRX IT
             WHERE
                 IT.GLBL_CMPY_CD = #glblCmpyCd#
             AND IT.EZCANCELFLAG = '0'
             GROUP BY
                 IT.DOC_MGT_BIZ_DOC_NUM
                 ,IT.GLBL_CMPY_CD
                 ,IT.EZCANCELFLAG
             )        IT_ORD_NUM
        WHERE
            CV.GLBL_CMPY_CD    = IT_ORD_NUM.GLBL_CMPY_CD
        AND CV.CPO_ORD_NUM     = IT_ORD_NUM.DOC_MGT_BIZ_DOC_NUM
        AND CV.EZCANCELFLAG    = '0'

        AND CV.GLBL_CMPY_CD    = PLE.GLBL_CMPY_CD
        AND CV.EZUPTIME        &gt;= PLE.LAST_EXEC_TS
        AND PLE.PROC_PGM_ID     = #procPgmId#
        AND PLE.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getDocMgtIntfcTrx" parameterClass="Map" resultClass="Map">
        SELECT
            DIT.DOC_MGT_INTFC_TRX_PK
            ,DIT.DOC_MGT_DOC_ID
            ,DIT.DOC_MGT_BIZ_DOC_NUM
            ,DIT.DOC_MGT_CATG_CD
            ,DIT.DOC_MGT_FLD_CD
            ,DIT.DOC_MGT_FLD_VAL_TXT
            ,IAD.IDX_ATTRB_TRGT_COL_NM
        FROM
            DOC_MGT_INTFC_TRX      DIT
            ,DOC_MGT_IDX_ATTRB_DFN IAD
            ,(SELECT
                DIT2.GLBL_CMPY_CD                AS GLBL_CMPY_CD
                ,DIT2.DOC_MGT_DOC_ID             AS DOC_MGT_DOC_ID
                ,DIT2.DOC_MGT_BIZ_DOC_NUM        AS DOC_MGT_BIZ_DOC_NUM
                ,DIT2.DOC_MGT_CATG_CD            AS DOC_MGT_CATG_CD
                ,DIT2.DOC_MGT_FLD_CD             AS DOC_MGT_FLD_CD
                ,MAX(DIT2.DOC_MGT_INTFC_PROC_TS) AS DOC_MGT_INTFC_PROC_TS
            FROM
                DOC_MGT_INTFC_TRX      DIT2
            WHERE
                DIT2.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DIT2.DOC_MGT_BIZ_DOC_NUM = #cpoOrdNum#
            AND DIT2.DOC_MGT_CATG_CD     = #docMgtCatgCd#
            AND DIT2.EZCANCELFLAG        = '0'
            GROUP BY
                DIT2.GLBL_CMPY_CD
                ,DIT2.DOC_MGT_DOC_ID
                ,DIT2.DOC_MGT_BIZ_DOC_NUM
                ,DIT2.DOC_MGT_CATG_CD
                ,DIT2.DOC_MGT_FLD_CD
            ) DIT_MAX
        WHERE
            DIT.GLBL_CMPY_CD          = DIT_MAX.GLBL_CMPY_CD
        AND DIT.DOC_MGT_DOC_ID        = DIT_MAX.DOC_MGT_DOC_ID
        AND DIT.DOC_MGT_BIZ_DOC_NUM   = DIT_MAX.DOC_MGT_BIZ_DOC_NUM
        AND DIT.DOC_MGT_CATG_CD       = DIT_MAX.DOC_MGT_CATG_CD
        AND DIT.DOC_MGT_FLD_CD        = DIT_MAX.DOC_MGT_FLD_CD
        AND DIT.DOC_MGT_INTFC_PROC_TS = DIT_MAX.DOC_MGT_INTFC_PROC_TS
        AND DIT.EZCANCELFLAG          = '0'

        AND IAD.GLBL_CMPY_CD          = 'ADB'
        AND IAD.DOC_MGT_CATG_CD       = DIT.DOC_MGT_CATG_CD
        AND IAD.DOC_MGT_FLD_CD        = DIT.DOC_MGT_FLD_CD
        AND IAD.ACTV_FLG              = 'Y'
        AND IAD.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getPurgeTargetOrder" parameterClass="Map" resultClass="Map">
        SELECT
            C.CPO_ORD_NUM
        FROM
            CPO     C
            ,PROC_LAST_EXEC PLE
            ,(SELECT
                IT.DOC_MGT_BIZ_DOC_NUM
                ,IT.GLBL_CMPY_CD
                ,IT.EZCANCELFLAG
            FROM
                DOC_MGT_INTFC_TRX IT
            WHERE
                IT.GLBL_CMPY_CD = #glblCmpyCd#
            AND IT.EZCANCELFLAG = '0'
            GROUP BY
                IT.DOC_MGT_BIZ_DOC_NUM
                ,IT.GLBL_CMPY_CD
                ,IT.EZCANCELFLAG
            )                IT_ORD_NUM
        WHERE
            C.GLBL_CMPY_CD   = IT_ORD_NUM.GLBL_CMPY_CD
        AND C.CPO_ORD_NUM    = IT_ORD_NUM.DOC_MGT_BIZ_DOC_NUM
        AND C.ORD_HDR_STS_CD in (#ordStsCancelled#, #ordStsClosed#)
        AND C.GLBL_CMPY_CD   = PLE.GLBL_CMPY_CD
        AND C.EZUPTIME       &gt;= PLE.LAST_EXEC_TS
        AND PLE.PROC_PGM_ID  = #procPgmId#
        AND PLE.EZCANCELFLAG = '0'
        AND C.EZCANCELFLAG   = '0'
    </statement>

    <statement id="getDocIdFromAttData" parameterClass="Map" resultClass="Map">  
        SELECT
            AD.GLBL_CMPY_CD        AS GLBL_CMPY_CD
            ,AD.ATT_DATA_PK        AS ATT_DATA_PK
            ,AD.ATT_DATA_NM        AS DOC_ID
        FROM
            ATT_DATA AD
        WHERE
            AD.GLBL_CMPY_CD      = #glblCmpyCd#
        AND AD.ATT_DATA_GRP_TXT  = #attDataGrpTxt#
        AND AD.ATT_DOC_TP_CD     = #attDocTpCd#
        AND AD.ATT_DATA_TP_CD    = 'TF'     <!-- QC#26963 add -->
        AND AD.EZCANCELFLAG      = '0'
    </statement>
</sqlMap>