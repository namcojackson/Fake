<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NFCB272002">
      
    <statement id="getArCashApp" parameterClass="Map">
    
<!-- 120,130,150 -->
SELECT ACA.GL_DT                                             GL_DT
      ,NVL(ACA.AR_CASH_APP_PK, 0)                            AR_CASH_APP_PK
      ,ACA.AR_CASH_APP_SQ_NUM                                AR_CASH_APP_SQ_NUM
      ,ACA.AR_APPLY_TP_CD                                    AR_APPLY_TP_CD
      ,NVL(ACA.DEAL_APPLY_AMT, 0)                            DEAL_APPLY_AMT
      ,NVL(ACA.FUNC_APPLY_AMT, 0)                            FUNC_APPLY_AMT
      ,ACA.EZUPTIME                                          EZUPTIME
      ,ACA.EZUPTIMEZONE                                      EZUPTIMEZONE
      ,ATB.AR_TRX_NUM                                        AR_TRX_NUM
      ,NVL(ATB.AR_TRX_BAL_PK, 0)                             AR_TRX_BAL_PK
      ,ATB.AR_TRX_TP_CD                                      AR_TRX_TP_CD
      ,NVL(AR.PAYER_CUST_CD, ATB.BILL_TO_CUST_CD)            BILL_TO_CUST_CD
      <!-- added 2016/01/19 -->
      ,NVL(AR.PAYER_CUST_CD, ATB.BILL_TO_CUST_ACCT_CD)       DS_ACCT_NUM
      <!-- end 2016/01/19 -->
      ,NVL(AR.DEAL_CCY_CD, ATB.DEAL_CCY_CD)                  DEAL_CCY_CD
      ,NVL(AR.FUNC_CCY_CD, ATB.FUNC_CCY_CD)                  FUNC_CCY_CD
      ,NVL(AR.EXCH_RATE, NVL(ATB.EXCH_RATE, 0))              EXCH_RATE
      ,ATB.COA_PROD_CD                                       COA_PROD_CD
      ,AR.RCPT_NUM                                           RCPT_NUM
      ,AR.AR_RCPT_TRX_TP_CD                                  AR_RCPT_TRX_TP_CD
      ,AR.AR_RCPT_TP_CD                                      AR_RCPT_TP_CD
      ,AR.AR_BANK_ACCT_CD                                    AR_BANK_ACCT_CD
      ,ADJ.AR_ADJ_NUM                                        AR_ADJ_NUM
      ,ADJ.AR_ADJ_TRX_TP_CD                                  AR_ADJ_TRX_TP_CD
      ,ADJ.AR_ADJ_TP_CD                                      AR_ADJ_TP_CD
      ,NVL(AR.TOC_CD, ADJ.TOC_CD)                            TOC_CD
      ,0                                                     DEAL_AR_ADJ_AMT
      ,0                                                     FUNC_AR_ADJ_AMT
      ,NULL                                                  ADJ_DT
      ,(CASE WHEN ADJ.AR_ADJ_TP_CD IS NULL THEN #trxRsnOnAcct#
             ELSE AAT.AR_ADJ_TRX_RSN_CD END)                 TRX_RSN_CD 
      , (CASE WHEN ADJ.AR_ADJ_TP_CD IS NULL THEN #trxOnAcct#
              ELSE AAT.AR_ADJ_TRX_CD END)                    TRX_CD
      ,NVL(AR.AR_RCPT_SRC_CD, #rcptSrcDef#)                  AR_RCPT_SRC_CD
      ,ATB.DS_INV_TP_CD                                      DS_INV_TP_CD
      ,NULL                                                  ORIG_AR_RCPT_SRC_CD
      ,NULL                                                  CRM_AR_TRX_NUM
      ,NULL                                                  CRM_DS_INV_TP_CD
      ,#flagY#                                               AJE_CRAT_REQ_FLG
<!-- START 2019/10/07 H.Umeda [QC#53990,ADD] -->
      ,AAD.ACCT_DT                                           ACCT_DT
<!-- END   2019/10/07 H.Umeda [QC#53990,ADD] -->
<!-- add start 2022/11/28 QC#57252 -->
      ,ACI.ADJ_COA_CMPY_CD                                   ADJ_COA_CMPY_CD
      ,ACI.ADJ_COA_BR_CD                                     ADJ_COA_BR_CD
      ,ACI.ADJ_COA_CC_CD                                     ADJ_COA_CC_CD
      ,ACI.ADJ_COA_ACCT_CD                                   ADJ_COA_ACCT_CD
      ,ACI.ADJ_COA_PROD_CD                                   ADJ_COA_PROD_CD
      ,ACI.ADJ_COA_CH_CD                                     ADJ_COA_CH_CD
      ,ACI.ADJ_COA_AFFL_CD                                   ADJ_COA_AFFL_CD
      ,ACI.ADJ_COA_PROJ_CD                                   ADJ_COA_PROJ_CD
      ,ACI.ADJ_COA_EXTN_CD                                   ADJ_COA_EXTN_CD
<!-- add end 2022/11/28 QC#57252 -->
  FROM AR_CASH_APP ACA
      ,AR_TRX_BAL ATB
      ,AR_ADJ     ADJ
      ,AR_RCPT    AR
      ,AR_ADJ_TP AAT
<!-- START 2019/10/07 H.Umeda [QC#53990,ADD] -->
      ,(SELECT ACCT_DT
        FROM   AR_ACCT_DT
        WHERE  EZCANCELFLAG  = '0'
        AND    GLBL_CMPY_CD  = #glblCmpyCd#
        AND    ONL_BAT_TP_CD = #batch#
       ) AAD
<!-- END   2019/10/07 H.Umeda [QC#53990,ADD] -->
<!-- add start 2022/11/28 QC#57252 -->
      ,AR_ADJ_COA_INFO ACI
<!-- add end 2022/11/28 QC#57252 -->
 WHERE ACA.GLBL_CMPY_CD      = #glblCmpyCd#
   AND ACA.EZCANCELFLAG      = '0'
   AND ACA.GLBL_CMPY_CD      = ATB.GLBL_CMPY_CD(+)
   AND ACA.EZCANCELFLAG      = ATB.EZCANCELFLAG(+)
   AND ACA.AR_TRX_NUM        = ATB.AR_TRX_NUM(+)
   AND ACA.GLBL_CMPY_CD      = ADJ.GLBL_CMPY_CD
   AND ACA.EZCANCELFLAG      = ADJ.EZCANCELFLAG
   AND ACA.GLBL_CMPY_CD      = AR.GLBL_CMPY_CD(+)
   AND ACA.EZCANCELFLAG      = AR.EZCANCELFLAG(+)
   AND ADJ.GLBL_CMPY_CD      = AAT.GLBL_CMPY_CD(+)
   AND ADJ.EZCANCELFLAG      = AAT.EZCANCELFLAG(+)
   AND ACA.AJE_CRAT_CPLT_FLG = #flagN#
   AND ACA.AR_ADJ_NUM        = ADJ.AR_ADJ_NUM
   AND ACA.RCPT_NUM          = AR.RCPT_NUM(+)
   AND ACA.AR_APPLY_TP_CD    &lt;&gt; #arApplyTpCash#
   AND (ADJ.AR_ADJ_TP_CD     &lt;&gt; #adjTpCMRef# OR ADJ.AR_ADJ_TP_CD IS NULL) 
   AND ADJ.AR_ADJ_TP_CD      = AAT.AR_ADJ_TP_CD(+)
<!-- add start 2022/11/28 QC#57252 -->
   AND ADJ.GLBL_CMPY_CD      = ACI.GLBL_CMPY_CD(+)
   AND ADJ.AR_ADJ_NUM        = ACI.AR_ADJ_NUM(+)
   AND ACI.EZCANCELFLAG(+)   = '0'
<!-- add end 2022/11/28 QC#57252 -->
UNION ALL
  <!-- 120-04 CRM Refund. Cash Application data of 'ADJ' and 'CSH'  are in 1:1 relationship. Otherwise, it will return duplicate data.  -->
  SELECT ACA.GL_DT                                             GL_DT
        ,NVL(ACA.AR_CASH_APP_PK, 0)                            AR_CASH_APP_PK
        ,ACA.AR_CASH_APP_SQ_NUM                                AR_CASH_APP_SQ_NUM
        ,ACA.AR_APPLY_TP_CD                                    AR_APPLY_TP_CD
        ,NVL(ACA.DEAL_APPLY_AMT, 0)                            DEAL_APPLY_AMT
        ,NVL(ACA.FUNC_APPLY_AMT, 0)                            FUNC_APPLY_AMT
        ,ACA.EZUPTIME                                          EZUPTIME
        ,ACA.EZUPTIMEZONE                                      EZUPTIMEZONE
        ,ATB.AR_TRX_NUM                                        AR_TRX_NUM
        ,NVL(ATB.AR_TRX_BAL_PK, 0)                             AR_TRX_BAL_PK
        ,ATB.AR_TRX_TP_CD                                      AR_TRX_TP_CD
        ,NVL(AR.PAYER_CUST_CD, ATB.BILL_TO_CUST_CD)            BILL_TO_CUST_CD
        <!-- added 2016/01/19 -->
        ,NVL(AR.PAYER_CUST_CD, ATB.BILL_TO_CUST_ACCT_CD)       DS_ACCT_NUM
        <!-- end 2016/01/19 -->
        ,NVL(AR.DEAL_CCY_CD, ATB.DEAL_CCY_CD)                  DEAL_CCY_CD
        ,NVL(AR.FUNC_CCY_CD, ATB.FUNC_CCY_CD)                  FUNC_CCY_CD
        ,NVL(AR.EXCH_RATE, NVL(ATB.EXCH_RATE, 0))              EXCH_RATE
        ,ATB.COA_PROD_CD                                       COA_PROD_CD
        ,AR.RCPT_NUM                                           RCPT_NUM
        ,AR.AR_RCPT_TRX_TP_CD                                  AR_RCPT_TRX_TP_CD
        ,AR.AR_RCPT_TP_CD                                      AR_RCPT_TP_CD
        ,AR.AR_BANK_ACCT_CD                                    AR_BANK_ACCT_CD
        ,ADJ.AR_ADJ_NUM                                        AR_ADJ_NUM
        ,ADJ.AR_ADJ_TRX_TP_CD                                  AR_ADJ_TRX_TP_CD
        ,ADJ.AR_ADJ_TP_CD                                      AR_ADJ_TP_CD
        ,NVL(AR.TOC_CD, ADJ.TOC_CD)                            TOC_CD
        ,0                                                     DEAL_AR_ADJ_AMT
        ,0                                                     FUNC_AR_ADJ_AMT
        ,NULL                                                  ADJ_DT
        ,AAT.AR_ADJ_TRX_RSN_CD                                 TRX_RSN_CD 
        ,AAT.AR_ADJ_TRX_CD                                     TRX_CD
        ,NVL(AR.AR_RCPT_SRC_CD, #rcptSrcDef#)                  AR_RCPT_SRC_CD
        ,ATB.DS_INV_TP_CD                                      DS_INV_TP_CD
        ,NULL                                                  ORIG_AR_RCPT_SRC_CD
        ,ATB2.AR_TRX_NUM                                       CRM_AR_TRX_NUM
        ,ATB2.DS_INV_TP_CD                                     CRM_DS_INV_TP_CD
        ,'Y'                                                   AJE_CRAT_REQ_FLG
<!-- START 2019/10/07 H.Umeda [QC#53990,ADD] -->
        ,AAD.ACCT_DT                                           ACCT_DT
<!-- END   2019/10/07 H.Umeda [QC#53990,ADD] -->
<!-- add start 2022/11/28 QC#57252 -->
        ,ACI.ADJ_COA_CMPY_CD                                   ADJ_COA_CMPY_CD
        ,ACI.ADJ_COA_BR_CD                                     ADJ_COA_BR_CD
        ,ACI.ADJ_COA_CC_CD                                     ADJ_COA_CC_CD
        ,ACI.ADJ_COA_ACCT_CD                                   ADJ_COA_ACCT_CD
        ,ACI.ADJ_COA_PROD_CD                                   ADJ_COA_PROD_CD
        ,ACI.ADJ_COA_CH_CD                                     ADJ_COA_CH_CD
        ,ACI.ADJ_COA_AFFL_CD                                   ADJ_COA_AFFL_CD
        ,ACI.ADJ_COA_PROJ_CD                                   ADJ_COA_PROJ_CD
        ,ACI.ADJ_COA_EXTN_CD                                   ADJ_COA_EXTN_CD
<!-- add end 2022/11/28 QC#57252 -->
    FROM AR_CASH_APP ACA
        ,AR_TRX_BAL ATB
        ,AR_ADJ     ADJ
        ,AR_RCPT    AR
        ,AR_ADJ_TP AAT
        ,AR_CASH_APP ACA2
        ,AR_TRX_BAL ATB2
<!-- START 2019/10/07 H.Umeda [QC#53990,ADD] -->
        ,(SELECT ACCT_DT
          FROM   AR_ACCT_DT
          WHERE  EZCANCELFLAG  = '0'
          AND    GLBL_CMPY_CD  = #glblCmpyCd#
          AND    ONL_BAT_TP_CD = #batch#
         ) AAD
<!-- END   2019/10/07 H.Umeda [QC#53990,ADD] -->
<!-- add start 2022/11/28 QC#57252 -->
        ,AR_ADJ_COA_INFO ACI
<!-- add end 2022/11/28 QC#57252 -->
   WHERE ACA.GLBL_CMPY_CD       = #glblCmpyCd#
     AND ACA.EZCANCELFLAG       = '0'
     AND ACA.GLBL_CMPY_CD       = ATB.GLBL_CMPY_CD(+)
     AND ACA.EZCANCELFLAG       = ATB.EZCANCELFLAG(+)
     AND ACA.AR_TRX_NUM         = ATB.AR_TRX_NUM(+)
     AND ACA.GLBL_CMPY_CD       = ADJ.GLBL_CMPY_CD
     AND ACA.EZCANCELFLAG       = ADJ.EZCANCELFLAG
     AND ACA.GLBL_CMPY_CD       = AR.GLBL_CMPY_CD(+)
     AND ACA.EZCANCELFLAG       = AR.EZCANCELFLAG(+)
     AND ADJ.GLBL_CMPY_CD       = AAT.GLBL_CMPY_CD(+)
     AND ADJ.EZCANCELFLAG       = AAT.EZCANCELFLAG(+)
     AND ACA.GLBL_CMPY_CD       = ACA2.GLBL_CMPY_CD(+)
     AND ACA.EZCANCELFLAG       = ACA2.EZCANCELFLAG(+)
     AND ACA2.GLBL_CMPY_CD      = ATB2.GLBL_CMPY_CD(+)
     AND ACA2.EZCANCELFLAG      = ATB2.EZCANCELFLAG(+)
     AND ACA.AJE_CRAT_CPLT_FLG  = #flagN#
     AND ACA.AR_ADJ_NUM         = ADJ.AR_ADJ_NUM
     AND ADJ.AR_ADJ_TP_CD       = #adjTpCMRef#
     AND ACA.RCPT_NUM           = AR.RCPT_NUM(+)
     AND ACA.AR_APPLY_TP_CD     &lt;&gt; #arApplyTpCash#
     AND ADJ.AR_ADJ_TP_CD       = AAT.AR_ADJ_TP_CD(+)
     AND ACA.AR_CASH_APP_PK     = ACA2.AR_CASH_APP_PK(+)
     AND ACA.AR_CASH_APP_SQ_NUM &lt;&gt; ACA2.AR_CASH_APP_SQ_NUM(+)
     AND #arApplyTpCash#        = ACA2.AR_APPLY_TP_CD(+)
     AND ACA2.AR_TRX_NUM        = ATB2.AR_TRX_NUM(+)
<!-- add start 2022/11/28 QC#57252 -->
     AND ADJ.GLBL_CMPY_CD       = ACI.GLBL_CMPY_CD(+)
     AND ADJ.AR_ADJ_NUM         = ACI.AR_ADJ_NUM(+)
     AND ACI.EZCANCELFLAG(+)    = '0'
<!-- add end 2022/11/28 QC#57252 -->
UNION ALL
<!-- 160 -->
SELECT ACA.GL_DT                                                     GL_DT
      ,NVL(ACA.AR_CASH_APP_PK, 0)                                    AR_CASH_APP_PK
      ,ACA.AR_CASH_APP_SQ_NUM                                        AR_CASH_APP_SQ_NUM
      ,ACA.AR_APPLY_TP_CD                                            AR_APPLY_TP_CD
      ,NVL(ACA.DEAL_APPLY_AMT, 0)                                    DEAL_APPLY_AMT
      ,NVL(ACA.FUNC_APPLY_AMT, 0)                                    FUNC_APPLY_AMT
      ,ACA.EZUPTIME                                                  EZUPTIME
      ,ACA.EZUPTIMEZONE                                              EZUPTIMEZONE
      ,ATB.AR_TRX_NUM                                                AR_TRX_NUM
      ,NVL(ATB.AR_TRX_BAL_PK, 0)                                     AR_TRX_BAL_PK
      ,ATB.AR_TRX_TP_CD                                              AR_TRX_TP_CD
      ,ATB.BILL_TO_CUST_CD                                           BILL_TO_CUST_CD
      <!-- added 2016/01/19 -->
      ,ATB.BILL_TO_CUST_ACCT_CD                                      DS_ACCT_NUM
      <!-- end 2016/01/19 -->
      ,NVL(AR.DEAL_CCY_CD, ATB.DEAL_CCY_CD)                          DEAL_CCY_CD
      ,NVL(AR.FUNC_CCY_CD, ATB.FUNC_CCY_CD)                          FUNC_CCY_CD
      ,NVL(AR.EXCH_RATE, NVL(ATB.EXCH_RATE, 0))                      EXCH_RATE
      ,ATB.COA_PROD_CD                                               COA_PROD_CD
      ,AR.RCPT_NUM                                                   RCPT_NUM
      ,AR.AR_RCPT_TRX_TP_CD                                          AR_RCPT_TRX_TP_CD
      ,AR.AR_RCPT_TP_CD                                              AR_RCPT_TP_CD
      ,AR.AR_BANK_ACCT_CD                                            AR_BANK_ACCT_CD
      ,NULL                                                          AR_ADJ_NUM
      ,NULL                                                          AR_ADJ_TRX_TP_CD
      ,NULL                                                          AR_ADJ_TP_CD
      ,ATB.TOC_CD                                                    TOC_CD
      ,0                                                             DEAL_AR_ADJ_AMT
      ,0                                                             FUNC_AR_ADJ_AMT
      ,NULL                                                          ADJ_DT
      , (CASE WHEN ATB.AR_TRX_TP_CD = #trxTpAcc# THEN #trxRsnApp02# 
              WHEN ATB.AR_TRX_TP_CD = #trxTpDed# THEN #trxRsnApp03#
              ELSE #trxRsnApp01# END)                                TRX_RSN_CD
      ,#trxCashApp#                                                  TRX_CD
      ,NVL(AR.AR_RCPT_SRC_CD, #rcptSrcDef#)                          AR_RCPT_SRC_CD
      ,ATB.DS_INV_TP_CD                                              DS_INV_TP_CD
      ,AR2.AR_RCPT_SRC_CD                                            ORIG_AR_RCPT_SRC_CD
      ,NULL                                                          CRM_AR_TRX_NUM
      ,NULL                                                          CRM_DS_INV_TP_CD
      ,(CASE WHEN ACA3.AR_CASH_APP_PK IS NULL THEN #flagY# 
             ELSE #flagN# END)                                       AJE_CRAT_REQ_FLG
<!-- START 2019/10/07 H.Umeda [QC#53990,ADD] -->
      ,AAD.ACCT_DT                                                    ACCT_DT
<!-- END   2019/10/07 H.Umeda [QC#53990,ADD] -->
<!-- add start 2022/11/28 QC#57252 -->
      ,NULL                                                          ADJ_COA_CMPY_CD
      ,NULL                                                          ADJ_COA_BR_CD
      ,NULL                                                          ADJ_COA_CC_CD
      ,NULL                                                          ADJ_COA_ACCT_CD
      ,NULL                                                          ADJ_COA_PROD_CD
      ,NULL                                                          ADJ_COA_CH_CD
      ,NULL                                                          ADJ_COA_AFFL_CD
      ,NULL                                                          ADJ_COA_PROJ_CD
      ,NULL                                                          ADJ_COA_EXTN_CD
<!-- add end 2022/11/28 QC#57252 -->
  FROM AR_CASH_APP ACA
      ,AR_TRX_BAL ATB
      ,AR_RCPT    AR
      <!-- cash application when 'ACC' is created -->
      ,AR_CASH_APP  ACA2
      <!-- receipt info of ACC's origin -->
      ,AR_RCPT  AR2
      <!-- to exclude Cash Application Record for Credit Memo Refund. It should be only one record in case Credit Memo Refund -->
      ,(SELECT AR_CASH_APP_PK
          FROM AR_CASH_APP A
              ,AR_ADJ      B
         WHERE A.GLBL_CMPY_CD       = #glblCmpyCd#
           AND A.EZCANCELFLAG       = '0'
           AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD
           AND A.EZCANCELFLAG       = B.EZCANCELFLAG
           AND A.AR_ADJ_NUM         = B.AR_ADJ_NUM
           AND A.AR_APPLY_TP_CD     &lt;&gt; #arApplyTpCash#
           AND B.AR_ADJ_TP_CD       = #adjTpCMRef#
         GROUP BY A.AR_CASH_APP_PK
        ) ACA3
<!-- START 2019/10/07 H.Umeda [QC#53990,ADD] -->
      ,(SELECT ACCT_DT
        FROM   AR_ACCT_DT
        WHERE  EZCANCELFLAG  = '0'
        AND    GLBL_CMPY_CD  = #glblCmpyCd#
        AND    ONL_BAT_TP_CD = #batch#
       ) AAD
<!-- END   2019/10/07 H.Umeda [QC#53990,ADD] -->
 WHERE ACA.GLBL_CMPY_CD        = #glblCmpyCd#
   AND ACA.EZCANCELFLAG        = '0'
   AND ACA.GLBL_CMPY_CD        = ATB.GLBL_CMPY_CD(+)
   AND ACA.EZCANCELFLAG        = ATB.EZCANCELFLAG(+)
   AND ACA.AR_TRX_NUM          = ATB.AR_TRX_NUM(+)
   AND ACA.GLBL_CMPY_CD        = AR.GLBL_CMPY_CD(+)
   AND ACA.EZCANCELFLAG        = AR.EZCANCELFLAG(+)
   AND ATB.GLBL_CMPY_CD        = ACA2.GLBL_CMPY_CD(+)
   AND ATB.EZCANCELFLAG        = ACA2.EZCANCELFLAG(+)
   AND ACA2.GLBL_CMPY_CD       = AR2.GLBL_CMPY_CD(+)
   AND ACA2.EZCANCELFLAG       = AR2.EZCANCELFLAG(+)
   AND ACA.AJE_CRAT_CPLT_FLG   = #flagN#
   AND ACA.RCPT_NUM            = AR.RCPT_NUM(+)
   AND ACA.AR_APPLY_TP_CD      = #arApplyTpCash#
   AND ATB.ATT_ADJ_NUM         = ACA2.AR_ADJ_NUM(+)
   AND ACA2.RCPT_NUM           = AR2.RCPT_NUM(+)
   AND ACA.AR_CASH_APP_PK      = ACA3.AR_CASH_APP_PK(+)
   <!-- 2016/04/15 change from 130-02 to 150-02 -->
 <!-- 150-02 Late Fee -->
 UNION ALL
 SELECT 
        ADJ.GL_DT                                    GL_DT
       ,0                                            AR_CASH_APP_PK
       ,NULL                                         AR_CASH_APP_SQ_NUM
       ,NULL                                         AR_APPLY_TP_CD
       ,0                                            DEAL_APPLY_AMT
       ,0                                            FUNC_APPLY_AMT
       ,ADJ.EZUPTIME                                 EZUPTIME
       ,ADJ.EZUPTIMEZONE                             EZUPTIMEZONE
       ,ATB.AR_TRX_NUM                               AR_TRX_NUM
       ,NVL(ATB.AR_TRX_BAL_PK, 0)                    AR_TRX_BAL_PK
       ,ATB.AR_TRX_TP_CD                             AR_TRX_TP_CD
       ,ATB.BILL_TO_CUST_CD                          BILL_TO_CUST_CD
       <!-- added 2016/01/19 -->
       ,ATB.BILL_TO_CUST_ACCT_CD                     DS_ACCT_NUM
       <!-- end 2016/01/19 -->
       ,ATB.DEAL_CCY_CD                              DEAL_CCY_CD
       ,ATB.FUNC_CCY_CD                              FUNC_CCY_CD
       ,NVL(ATB.EXCH_RATE, 0)                        EXCH_RATE
       ,ATB.COA_PROD_CD                              COA_PROD_CD
       ,NULL                                         RCPT_NUM
       ,NULL                                         AR_RCPT_TRX_TP_CD
       ,NULL                                         AR_RCPT_TP_CD
       ,NULL                                         AR_BANK_ACCT_CD
       ,ADJ.AR_ADJ_NUM                               AR_ADJ_NUM
       ,ADJ.AR_ADJ_TRX_TP_CD                         AR_ADJ_TRX_TP_CD
       ,ADJ.AR_ADJ_TP_CD                             AR_ADJ_TP_CD
       ,ADJ.TOC_CD                                   TOC_CD
       ,NVL(ADJ.DEAL_AR_ADJ_AMT, 0)                  DEAL_AR_ADJ_AMT
       ,NVL(ADJ.FUNC_AR_ADJ_AMT, 0)                  FUNC_AR_ADJ_AMT
       ,ADJ.ADJ_DT                                   ADJ_DT
       ,#trxRsnLateFee#                              TRX_RSN_CD
       ,#trxLateFee#                                 TRX_CD
       ,NULL                                         AR_RCPT_SRC_CD
       ,ATB.DS_INV_TP_CD                             DS_INV_TP_CD 
       ,NULL                                         ORIG_AR_RCPT_SRC_CD
       ,NULL                                         CRM_AR_TRX_NUM
       ,NULL                                         CRM_DS_INV_TP_CD
       ,#flagY#                                      AJE_CRAT_REQ_FLG
<!-- START 2019/10/07 H.Umeda [QC#53990,ADD] -->
       ,AAD.ACCT_DT                                  ACCT_DT
<!-- END   2019/10/07 H.Umeda [QC#53990,ADD] -->
<!-- add start 2022/11/28 QC#57252 -->
       ,NULL                                         ADJ_COA_CMPY_CD
       ,NULL                                         ADJ_COA_BR_CD
       ,NULL                                         ADJ_COA_CC_CD
       ,NULL                                         ADJ_COA_ACCT_CD
       ,NULL                                         ADJ_COA_PROD_CD
       ,NULL                                         ADJ_COA_CH_CD
       ,NULL                                         ADJ_COA_AFFL_CD
       ,NULL                                         ADJ_COA_PROJ_CD
       ,NULL                                         ADJ_COA_EXTN_CD
<!-- add end 2022/11/28 QC#57252 -->
  FROM AR_ADJ ADJ
      ,AR_TRX_BAL ATB
      ,AR_ADJ_TP AAT
      ,DS_INV_TP DIT
<!-- START 2019/10/07 H.Umeda [QC#53990,ADD] -->
      ,(SELECT ACCT_DT
        FROM   AR_ACCT_DT
        WHERE  EZCANCELFLAG  = '0'
        AND    GLBL_CMPY_CD  = #glblCmpyCd#
        AND    ONL_BAT_TP_CD = #batch#
       ) AAD
<!-- END   2019/10/07 H.Umeda [QC#53990,ADD] -->
 WHERE ADJ.GLBL_CMPY_CD      = #glblCmpyCd#
   AND ADJ.EZCANCELFLAG      = '0'
   AND ADJ.GLBL_CMPY_CD      = ATB.GLBL_CMPY_CD(+)
   AND ADJ.EZCANCELFLAG      = ATB.EZCANCELFLAG(+) 
   AND ADJ.GLBL_CMPY_CD      = AAT.GLBL_CMPY_CD(+)
   AND ADJ.EZCANCELFLAG      = AAT.EZCANCELFLAG(+)
   AND ATB.GLBL_CMPY_CD      = DIT.GLBL_CMPY_CD(+)
   AND ATB.EZCANCELFLAG      = DIT.EZCANCELFLAG(+)
   AND ADJ.AR_ADJ_NUM        = ATB.ATT_ADJ_NUM
   AND ADJ.AJE_CRAT_CPLT_FLG = #flagN#
   AND ADJ.AR_ADJ_TRX_TP_CD  = #trxTpDed#
   AND ADJ.AR_ADJ_TP_CD      = AAT.AR_ADJ_TP_CD(+)
   AND ATB.DS_INV_TP_CD      = DIT.DS_INV_TP_CD(+)
    </statement>
    
   </sqlMap>
