<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPAL1090Query">
    <statement id="getSearchOptionPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
            SSO.SRCH_OPT_PK
            ,SSO.SRCH_OPT_NM
        FROM
            SAVE_SRCH_OPT SSO
        WHERE
                SSO.GLBL_CMPY_CD    = #glblCmpyCd#
            AND SSO.SRCH_OPT_APL_ID = #srchOptAplId#
            AND SSO.SRCH_OPT_USR_ID = #srchOptUsrId#
            AND SSO.EZCANCELFLAG    = '0'
        ORDER BY
            SSO.SRCH_OPT_NM ASC
    </statement>
    
    <statement id="getRequisitionTypePulldownList" parameterClass="Map" resultClass="Map">
        SELECT
            PRT.PRCH_REQ_TP_CD
            ,PRT.PRCH_REQ_TP_DESC_TXT
        FROM
            PRCH_REQ_TP PRT
        WHERE
                PRT.GLBL_CMPY_CD       = #glblCmpyCd#
            AND PRT.PRCH_REQ_REC_TP_CD IN (#prchReqRecTpCdRequest#,#prchReqRecTpCdReturn#)
            AND PRT.EZCANCELFLAG       = '0'
        ORDER BY
            PRT.PRCH_REQ_TP_SORT_NUM ASC
    </statement>
    
    <statement id="getHeaderStatusPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
            PRS.PRCH_REQ_STS_CD
            ,PRS.PRCH_REQ_STS_DESC_TXT
        FROM
            PRCH_REQ_STS PRS
        WHERE
                PRS.GLBL_CMPY_CD = #glblCmpyCd#
            AND PRS.EZCANCELFLAG = '0'
        ORDER BY
            PRS.PRCH_REQ_STS_SORT_NUM ASC
    </statement>
    
    <statement id="getApprovalStatusPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
            PRAS.PRCH_REQ_APVL_STS_CD
            ,PRAS.PRCH_REQ_APVL_STS_DESC_TXT
        FROM
            PRCH_REQ_APVL_STS PRAS
        WHERE
                PRAS.GLBL_CMPY_CD = #glblCmpyCd#
            AND PRAS.EZCANCELFLAG = '0'
        ORDER BY
            PRAS.PRCH_REQ_APVL_STS_SORT_NUM ASC
    </statement>
    
    <statement id="getDocumentSourceTypePulldownList" parameterClass="Map" resultClass="Map">
        SELECT
            PRST.PRCH_REQ_SRC_TP_CD
            ,PRST.PRCH_REQ_SRC_TP_DESC_TXT
        FROM
            PRCH_REQ_SRC_TP_XREF PRSTX
            ,PRCH_REQ_SRC_TP     PRST
        WHERE
                PRSTX.GLBL_CMPY_CD       = #glblCmpyCd#
            AND PRSTX.PRCH_REQ_REC_TP_CD = #prchReqRecTpCd#
            AND PRSTX.PRCH_REQ_SRC_TP_CD = PRST.PRCH_REQ_SRC_TP_CD
            AND PRSTX.GLBL_CMPY_CD       = PRST.GLBL_CMPY_CD
            AND PRSTX.EZCANCELFLAG       = '0'
            AND PRST.EZCANCELFLAG        = '0'
        ORDER BY
            PRST.PRCH_REQ_SRC_TP_SORT_NUM ASC
    </statement>
    
    <statement id="getRequestedShipMethodPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
            SSL.SHPG_SVC_LVL_CD
            ,SSL.SHPG_SVC_LVL_DESC_TXT
        FROM
            SHPG_SVC_LVL SSL
        WHERE
                SSL.GLBL_CMPY_CD = #glblCmpyCd#
            AND SSL.EZCANCELFLAG = '0'
        ORDER BY
            SSL.SHPG_SVC_LVL_SORT_NUM ASC
    </statement>

    <!--Search-->
    <statement id="search" parameterClass="Map" resultClass="Map">
        SELECT
            R.PRCH_REQ_NUM
            ,R.PRCH_REQ_TP_CD
            ,R.PRCH_REQ_STS_CD
            ,R.PRCH_REQ_APVL_STS_CD
            ,R.PRCH_REQ_CRAT_DT
            ,R.PRCH_REQ_CRAT_DISP_DT_TM_TS
            ,R.PRCH_REQ_CRAT_TZ
            ,R.PRCH_REQ_SRC_TP_CD
            ,R.TRX_REF_NUM
            ,R.PRCH_REQ_RQST_BY_PSN_CD AS PRCH_REQ_CRAT_BY_PSN_CD
            ,R.RQST_TECH_TOC_CD
            ,R.FSR_NUM
            ,R.SVC_TASK_NUM
            ,R.SVC_MACH_SER_NUM
            ,R.SHIP_TO_CUST_CD
            ,R.RQST_RCV_DT
            ,R.RQST_RCV_TM
            ,R.SRC_RTL_WH_CD
            ,R.DEST_RTL_WH_CD
            ,R.DEST_RTL_SWH_CD
            ,R.CARR_CD
            ,R.PRCH_REQ_TP_DESC_TXT
            ,R.PRCH_REQ_STS_DESC_TXT
            ,R.PRCH_REQ_APVL_STS_DESC_TXT
            ,R.PRCH_REQ_SRC_TP_DESC_TXT
            ,R.LINE_BIZ_TP_CD
            ,R.FULL_PSN_NM
            ,R.TECH_NM
            ,R.RTL_WH_NM
            ,R.RTL_SWH_NM
            ,R.LOC_NM
            ,R.SHPG_SVC_LVL_DESC_TXT
            ,R.CARR_NM
            ,R.PRCH_REQ_CRAT_TM
        FROM (
        SELECT DISTINCT
            PR.PRCH_REQ_NUM
            ,PR.PRCH_REQ_TP_CD
            ,PR.PRCH_REQ_STS_CD
            ,PR.PRCH_REQ_APVL_STS_CD
            ,PR.PRCH_REQ_CRAT_DT
            ,PR.PRCH_REQ_CRAT_DISP_DT_TM_TS
            ,PR.PRCH_REQ_CRAT_TZ
            ,PR.PRCH_REQ_SRC_TP_CD
            ,PR.TRX_REF_NUM
            ,PR.PRCH_REQ_RQST_BY_PSN_CD
            ,PR.RQST_TECH_TOC_CD
            ,PR.FSR_NUM
            ,PR.SVC_TASK_NUM
            ,PR.SVC_MACH_SER_NUM
            ,PR.SHIP_TO_CUST_CD
            ,PRD.RQST_RCV_DT
            ,PRD.RQST_RCV_TM
            ,PRD.SRC_RTL_WH_CD
            ,PRD.DEST_RTL_WH_CD
            ,PRD.DEST_RTL_SWH_CD
            ,PRD.CARR_CD
            ,PRT.PRCH_REQ_TP_DESC_TXT
            ,PRS.PRCH_REQ_STS_DESC_TXT
            ,PRAS.PRCH_REQ_APVL_STS_DESC_TXT
            ,PRST.PRCH_REQ_SRC_TP_DESC_TXT
            ,SP.LINE_BIZ_TP_CD
            ,SPV.FULL_PSN_NM
            ,TM.TECH_NM
            ,RW.RTL_WH_NM
            ,S.RTL_SWH_NM
            ,STC.LOC_NM
            ,SSL.SHPG_SVC_LVL_DESC_TXT
            ,OCV.CARR_NM
            ,PR.PRCH_REQ_CRAT_TM
        FROM
            PRCH_REQ PR
            ,PRCH_REQ_DTL PRD
            ,PRCH_REQ_TP PRT
            ,PRCH_REQ_STS PRS
            ,PRCH_REQ_APVL_STS PRAS
            ,PRCH_REQ_SRC_TP PRST
            ,S21_PSN SP
            ,S21_PSN_V SPV
            ,TECH_MSTR TM
            ,RTL_WH RW
            ,SWH S
            ,SHIP_TO_CUST STC
            ,SHPG_SVC_LVL SSL
            ,OTBD_CARR_V OCV
        WHERE
                PR.GLBL_CMPY_CD             = #glblCmpyCd#
            AND PR.PRCH_REQ_REC_TP_CD IN (#prchReqRecTpCdRequest#,#prchReqRecTpCdReturn#)
            AND PR.GLBL_CMPY_CD             = PRD.GLBL_CMPY_CD
            AND PR.PRCH_REQ_NUM             = PRD.PRCH_REQ_NUM
            AND PRD.PRCH_REQ_LINE_SUB_NUM   = 0
            AND PR.GLBL_CMPY_CD             = PRT.GLBL_CMPY_CD (+)
            AND PR.PRCH_REQ_TP_CD           = PRT.PRCH_REQ_TP_CD (+)
            AND PR.GLBL_CMPY_CD             = PRS.GLBL_CMPY_CD (+)
            AND PR.PRCH_REQ_STS_CD          = PRS.PRCH_REQ_STS_CD (+)
            AND PR.GLBL_CMPY_CD             = PRAS.GLBL_CMPY_CD (+)
            AND PR.PRCH_REQ_APVL_STS_CD     = PRAS.PRCH_REQ_APVL_STS_CD (+)
            AND PR.GLBL_CMPY_CD             = PRST.GLBL_CMPY_CD (+)
            AND PR.PRCH_REQ_SRC_TP_CD       = PRST.PRCH_REQ_SRC_TP_CD (+)
            AND PR.GLBL_CMPY_CD             = SP.GLBL_CMPY_CD (+)
            AND PR.RQST_TECH_TOC_CD         = SP.PSN_CD (+)
            AND PR.GLBL_CMPY_CD             = SPV.GLBL_CMPY_CD (+)
            AND PR.PRCH_REQ_RQST_BY_PSN_CD  = SPV.PSN_CD (+)
            AND PR.GLBL_CMPY_CD             = TM.GLBL_CMPY_CD (+)
            AND PR.RQST_TECH_TOC_CD         = TM.TECH_TOC_CD (+)
            AND PRD.GLBL_CMPY_CD            = RW.GLBL_CMPY_CD (+)
            AND PRD.DEST_RTL_WH_CD          = RW.RTL_WH_CD (+)
            AND PRD.GLBL_CMPY_CD            = S.GLBL_CMPY_CD (+)
            AND PRD.DEST_RTL_SWH_CD         = S.RTL_SWH_CD (+)
            AND PR.GLBL_CMPY_CD             = STC.GLBL_CMPY_CD (+)
            AND PR.SHIP_TO_CUST_CD          = STC.SHIP_TO_CUST_CD (+)
            AND PRD.GLBL_CMPY_CD            = SSL.GLBL_CMPY_CD (+)
            AND PRD.SHPG_SVC_LVL_CD         = SSL.SHPG_SVC_LVL_CD (+)
            AND PRD.GLBL_CMPY_CD            = OCV.GLBL_CMPY_CD (+)
            AND PRD.CARR_CD                 = OCV.CARR_CD (+)
            AND PR.EZCANCELFLAG             = '0'
            AND PRD.EZCANCELFLAG            = '0'
            AND PRT.EZCANCELFLAG (+)        = '0'
            AND PRS.EZCANCELFLAG (+)        = '0'
            AND PRAS.EZCANCELFLAG (+)       = '0'
            AND PRST.EZCANCELFLAG (+)       = '0'
            AND SP.EZCANCELFLAG (+)         = '0'
            AND SPV.EZCANCELFLAG (+)        = '0'
            AND TM.EZCANCELFLAG (+)         = '0'
            AND RW.EZCANCELFLAG (+)         = '0'
            AND S.EZCANCELFLAG (+)          = '0'
            AND STC.EZCANCELFLAG (+)        = '0'
            AND SSL.EZCANCELFLAG (+)        = '0'
            AND OCV.EZCANCELFLAG (+)        = '0'
            <isNotNull property="prchReqNum_H1">
                AND PR.PRCH_REQ_NUM = #prchReqNum_H1#
            </isNotNull>
            <isNotNull property="prchReqTpCd_SE">
                AND PR.PRCH_REQ_TP_CD = #prchReqTpCd_SE#
            </isNotNull>
            <isNotNull property="prchReqStsCd_SE">
                AND PR.PRCH_REQ_STS_CD = #prchReqStsCd_SE#
            </isNotNull>
            <isNotNull property="prchReqApvlStsCd_SE">
                AND PR.PRCH_REQ_APVL_STS_CD = #prchReqApvlStsCd_SE#
            </isNotNull>
            <isNotNull property="prchReqCratDt_HF">
                AND PR.PRCH_REQ_CRAT_DT &gt;= #prchReqCratDt_HF#
            </isNotNull>
            <isNotNull property="prchReqCratDt_HT">
                AND PR.PRCH_REQ_CRAT_DT &lt;= #prchReqCratDt_HT#
            </isNotNull>
            <isNotNull property="prchReqSrcTpCd_SE">
                AND PR.PRCH_REQ_SRC_TP_CD = #prchReqSrcTpCd_SE#
            </isNotNull>
            <isNotNull property="fsrNum_H1">
                AND PR.FSR_NUM = #fsrNum_H1#
            </isNotNull>
            <isNotNull property="svcTaskNum_H1">
                AND PR.SVC_TASK_NUM = #svcTaskNum_H1#
            </isNotNull>
            <isNotNull property="svcMachSerNum_H1">
                AND PR.SVC_MACH_SER_NUM = #svcMachSerNum_H1#
            </isNotNull>
            <isNotNull property="rqstTechTocCd_AC">
                AND PR.RQST_TECH_TOC_CD = #rqstTechTocCd_AC#
            </isNotNull>
            <isNotNull property="shipToCustCd_H1">
                AND PR.SHIP_TO_CUST_CD LIKE #shipToCustCd_H1#
            </isNotNull>
            <isNotNull property="locNm_H1">
                AND UPPER(STC.LOC_NM) LIKE UPPER(#locNm_H1#)
            </isNotNull>
            <isNotNull property="rqstRcvDt_HF">
                AND PRD.RQST_RCV_DT &gt;= #rqstRcvDt_HF#
            </isNotNull>
            <isNotNull property="rqstRcvDt_HT">
                AND PRD.RQST_RCV_DT &lt;= #rqstRcvDt_HT#
            </isNotNull>
            <isNotNull property="rtlWhCd_H1">
                AND PRD.DEST_RTL_WH_CD LIKE #rtlWhCd_H1#
            </isNotNull>
            <isNotNull property="rtlSwhCd_H1">
                AND PRD.DEST_RTL_SWH_CD LIKE #rtlSwhCd_H1#
            </isNotNull>
            <isNotNull property="shpgSvcLvlCd_SE">
                AND PRD.SHPG_SVC_LVL_CD = #shpgSvcLvlCd_SE#
            </isNotNull>
            <isNotNull property="carrNm_H1">
                AND UPPER(OCV.CARR_NM) LIKE UPPER(#carrNm_H1#)
            </isNotNull>
            <isNotNull property="techNm_H1">
                AND UPPER(TM.TECH_NM) LIKE UPPER(#techNm_H1#)
            </isNotNull>
        ORDER BY
            PR.PRCH_REQ_NUM ASC
        ) R 
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>
</sqlMap>
