<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NMAL6890Query">

    <typeAlias alias="NMAL6890CMsg"      type="business.blap.NMAL6890.NMAL6890CMsg"/>
    <typeAlias alias="NMAL6890SMsg"      type="business.blap.NMAL6890.NMAL6890SMsg"/>
    <typeAlias alias="NMAL6890_ASMsg"    type="business.blap.NMAL6890.NMAL6890_ASMsg"/>

    <statement id="getSrchOptnPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
               SSO.SRCH_OPT_PK AS SRCH_OPT_PK
              ,SSO.SRCH_OPT_NM AS SRCH_OPT_NM
          FROM
               SAVE_SRCH_OPT SSO
         WHERE
               1=1
           AND SSO.GLBL_CMPY_CD     = #glblCmpyCd#
           AND SSO.SRCH_OPT_APL_ID  = #srchOptAplId#
           AND SSO.SRCH_OPT_USR_ID  = #srchOptUsrId#
         ORDER BY
               SSO.SRCH_OPT_NM
    </statement>

    <statement id="getWhTypePulldownList" parameterClass="Map" resultClass="Map">
        SELECT
               RWC.RTL_WH_CATG_CD       AS RTL_WH_CATG_CD
              ,RWC.RTL_WH_CATG_DESC_TXT AS RTL_WH_CATG_DESC_TXT
          FROM
               RTL_WH_CATG RWC
         WHERE
               1=1
           AND RWC.GLBL_CMPY_CD  = #glblCmpyCd#
           AND RWC.EZCANCELFLAG  = '0'
         ORDER BY
               RWC.RTL_WH_CATG_SORT_NUM
    </statement>

    <statement id="getInvtyAcctPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
               IA.INVTY_ACCT_CD       AS INVTY_ACCT_CD
              ,IA.INVTY_ACCT_DESC_TXT AS INVTY_ACCT_DESC_TXT
          FROM
               INVTY_ACCT IA
         WHERE
               1=1
           AND IA.GLBL_CMPY_CD  = #glblCmpyCd#
           AND IA.EZCANCELFLAG  = '0'
         ORDER BY
               IA.INVTY_ACCT_SORT_NUM
    </statement>
    
    <statement id="getSrcTypePulldownList" parameterClass="Map" resultClass="Map">
        SELECT
               PT.PROCR_TP_CD       AS PROCR_TP_CD
              ,PT.PROCR_TP_DESC_TXT AS PROCR_TP_DESC_TXT
          FROM
               PROCR_TP PT
         WHERE
               1=1
           AND PT.GLBL_CMPY_CD      = #glblCmpyCd#
           AND PT.EZCANCELFLAG      = '0'
           AND PT.TECH_MAN_RQST_FLG = #flgOn#
         ORDER BY
               PT.PROCR_TP_SORT_NUM
    </statement>

    <statement id="getPlnItmInsrcPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
               PII.PLN_ITEM_INSRC_CD       AS PLN_ITEM_INSRC_CD
              ,PII.PLN_ITEM_INSRC_DESC_TXT AS PLN_ITEM_INSRC_DESC_TXT
          FROM
               PLN_ITEM_INSRC PII
         WHERE
               1=1
           AND PII.GLBL_CMPY_CD      = #glblCmpyCd#
           AND PII.EZCANCELFLAG      = '0'
         ORDER BY
               PII.PLN_ITEM_INSRC_SORT_NUM
    </statement>

    <statement id="getInvtyOwnrPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
               IO.INVTY_OWNR_CD       AS INVTY_OWNR_CD
              ,IO.INVTY_OWNR_DESC_TXT AS INVTY_OWNR_DESC_TXT
          FROM
               INVTY_OWNR IO
         WHERE
               1=1
           AND IO.GLBL_CMPY_CD      = #glblCmpyCd#
           AND IO.EZCANCELFLAG      = '0'
         ORDER BY
               IO.INVTY_OWNR_SORT_NUM
    </statement>

    <statement id="searchWarehouses" parameterClass="Map" resultMap="result.NMAL6890_ASMsg">
        SELECT * FROM (
        SELECT
               RW1.RTL_WH_CD               AS WAREHOUSE_CODE
              ,RW1.RTL_WH_NM               AS WAREHOUSE_NAME
              ,RW1.RTL_WH_DESC_TXT         AS WAREHOUSE_DESC
              ,RWC.RTL_WH_CATG_DESC_TXT    AS WAREHOUSE_TYPE
              ,OWN.FULL_PSN_NM             AS OWNER
              ,ALTOWN.FULL_PSN_NM          AS ALT_OWNER
              ,IA.INVTY_ACCT_DESC_TXT      AS INVENTORY_ACCOUNT
              ,DPLW1.DS_LOC_NM             AS SHIP_TO_LOC
              ,DPLW2.DS_LOC_NM             AS RETURN_LOC
              ,PT1.PROCR_TP_DESC_TXT       AS DEFAULT_SOURCE_TYPE
              ,RW2.RTL_WH_NM               AS SOURCE_WH
              ,PT2.PROCR_TP_DESC_TXT       AS DEFAULT_RETURN_TYPE
              ,RW3.RTL_WH_NM               AS RETURN_WH
              ,PT3.PROCR_TP_DESC_TXT       AS EMERGENCY_SOURCE_TYPE
              ,RW4.RTL_WH_NM               AS EMERGENCY_SOURCE
              ,PII.PLN_ITEM_INSRC_DESC_TXT AS ALLOW_MIN_MAX_INSRC
              ,VSTX.VND_LOC_CD             AS TRADING_PARTNER_ID
              ,IO.INVTY_OWNR_DESC_TXT      AS INVENTORY_OWNERSHIP
              ,RW1.FIRST_REF_CMNT_TXT      AS SPACE
              ,RW1.EFF_FROM_DT             AS WH_START_DATE
              ,RW1.EFF_THRU_DT             AS WH_END_DATE
              <isNotNull property="rtlSwhCd">
              ,RS.RTL_SWH_CD               AS SUB_WH_CD
              </isNotNull>
              ,RW1.CTY_ADDR                AS CTY_ADDR
          FROM
               RTL_WH              RW1
              ,S21_PSN_V           OWN
              ,S21_PSN_V           ALTOWN
              ,SHIP_TO_CUST        STC1
              ,PTY_LOC_WRK         DPLW1
              ,SHIP_TO_CUST        STC2
              ,PTY_LOC_WRK         DPLW2
              ,RTL_WH              RW2
              ,RTL_WH              RW3
              ,RTL_WH              RW4
              ,RTL_WH_CATG         RWC
              ,INVTY_ACCT          IA
              ,PLN_ITEM_INSRC      PII
              ,INVTY_OWNR          IO
              ,PROCR_TP            PT1
              ,PROCR_TP            PT2
              ,PROCR_TP            PT3
              ,VND_SHIP_TO_XREF    VSTX
              <isNotNull property="rtlSwhCd">
              ,RTL_SWH             RS
              </isNotNull>
         WHERE 
               1=1
         <!-- join condition. -->
           AND RW1.GLBL_CMPY_CD                        = OWN.GLBL_CMPY_CD       (+)
           AND NVL(RW1.WH_MGR_PSN_CD, RW1.TECH_TOC_CD) = OWN.PSN_CD             (+)
           AND OWN.EZCANCELFLAG            (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = ALTOWN.GLBL_CMPY_CD    (+)
           AND RW1.ALT_PSN_CD                          = ALTOWN.PSN_CD          (+)
           AND ALTOWN.EZCANCELFLAG         (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = STC1.GLBL_CMPY_CD      (+)
           AND RW1.SHIP_TO_CUST_CD                     = STC1.SHIP_TO_CUST_CD   (+)
           AND STC1.EZCANCELFLAG           (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = DPLW1.GLBL_CMPY_CD     (+)
           AND STC1.PTY_LOC_PK                         = DPLW1.PTY_LOC_PK       (+)
           AND DPLW1.EZCANCELFLAG          (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = STC2.GLBL_CMPY_CD      (+)
           AND RW1.RTRN_TO_CUST_CD                     = STC2.SHIP_TO_CUST_CD   (+)
           AND STC2.EZCANCELFLAG           (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = DPLW2.GLBL_CMPY_CD     (+)
           AND STC2.PTY_LOC_PK                         = DPLW2.PTY_LOC_PK       (+)
           AND DPLW2.EZCANCELFLAG          (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = RW2.GLBL_CMPY_CD       (+)
           AND RW1.DEF_SRC_RTL_WH_CD                   = RW2.RTL_WH_CD          (+)
           AND RW2.EZCANCELFLAG            (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = RW3.GLBL_CMPY_CD       (+)
           AND RW1.DEF_RTRN_TO_RTL_WH_CD               = RW3.RTL_WH_CD          (+)
           AND RW3.EZCANCELFLAG            (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = RW4.GLBL_CMPY_CD       (+)
           AND RW1.EMER_SRC_RTL_WH_CD                  = RW4.RTL_WH_CD          (+)
           AND RW4.EZCANCELFLAG            (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = RWC.GLBL_CMPY_CD       (+)
           AND RW1.RTL_WH_CATG_CD                      = RWC.RTL_WH_CATG_CD     (+)
           AND RWC.EZCANCELFLAG            (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = IA.GLBL_CMPY_CD        (+)
           AND RW1.INVTY_ACCT_CD                       = IA.INVTY_ACCT_CD       (+)
           AND IA.EZCANCELFLAG             (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = PII.GLBL_CMPY_CD       (+)
           AND RW1.PLN_ITEM_INSRC_CD                   = PII.PLN_ITEM_INSRC_CD  (+)
           AND PII.EZCANCELFLAG            (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = IO.GLBL_CMPY_CD        (+)
           AND RW1.INVTY_OWNR_CD                       = IO.INVTY_OWNR_CD       (+)
           AND IO.EZCANCELFLAG             (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = PT1.GLBL_CMPY_CD       (+)
           AND RW1.DEF_SRC_PROCR_TP_CD                 = PT1.PROCR_TP_CD        (+)
           AND PT1.EZCANCELFLAG            (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = PT2.GLBL_CMPY_CD       (+)
           AND RW1.DEF_RTRN_TO_PROCR_TP_CD             = PT2.PROCR_TP_CD        (+)
           AND PT2.EZCANCELFLAG            (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = PT3.GLBL_CMPY_CD       (+)
           AND RW1.EMER_SRC_PROCR_TP_CD                = PT3.PROCR_TP_CD        (+)
           AND PT3.EZCANCELFLAG            (+)= '0'

           AND RW1.GLBL_CMPY_CD                        = VSTX.GLBL_CMPY_CD      (+)
           AND RW1.RTL_WH_CD                           = VSTX.RTL_WH_CD         (+)
           AND VSTX.VND_XREF_TP_CD         (+)= #vndXrefTpCd#
           AND VSTX.EZCANCELFLAG           (+)= '0'

           <isNotNull property="rtlSwhCd">
           AND RW1.GLBL_CMPY_CD                        = RS.GLBL_CMPY_CD        (+)
           AND RW1.RTL_WH_CD                           = RS.RTL_WH_CD           (+)
           AND RS.EZCANCELFLAG             (+)= '0'
           </isNotNull>

         <!-- query condition. -->
           AND RW1.GLBL_CMPY_CD                   =    #glblCmpyCd#
           AND RW1.EZCANCELFLAG                   =    '0'
           <isNotNull property="rtlWhNm_H1">
           AND UPPER(RW1.RTL_WH_NM)               LIKE UPPER(#rtlWhNm_H1#)
           </isNotNull>
           <isNotNull property="rtlWhDescTxt">
           AND UPPER(RW1.RTL_WH_DESC_TXT)         LIKE UPPER(#rtlWhDescTxt#)
           </isNotNull>
           <isNotNull property="rtlWhCd">
            <iterate property="rtlWhCd" var="rtlWhCd[]" open="AND (RW1.RTL_WH_CD LIKE " conjunction= "OR RW1.RTL_WH_CD LIKE " close=")">
                #rtlWhCd[]#
            </iterate>
           </isNotNull>
           <isNotNull property="rtlWhCatgCd_RS">
           AND RW1.RTL_WH_CATG_CD                 =    #rtlWhCatgCd_RS#
           </isNotNull>
           <isNotNull property="invtyAcctCd_IS">
           AND RW1.INVTY_ACCT_CD                  =    #invtyAcctCd_IS#
           </isNotNull>
           <isNotNull property="telNum">
           AND RW1.TEL_NUM                        LIKE #telNum#
           </isNotNull>
           <isNotNull property="procrTpCd_SS">
           AND RW1.DEF_SRC_PROCR_TP_CD            =    #procrTpCd_SS#
           </isNotNull>
           <isNotNull property="procrTpCd_RS">
           AND RW1.DEF_RTRN_TO_PROCR_TP_CD        =    #procrTpCd_RS#
           </isNotNull>
           <isNotNull property="procrTpCd_ES">
           AND RW1.EMER_SRC_PROCR_TP_CD           =    #procrTpCd_ES#
           </isNotNull>
           <isNotNull property="plnItemInsrcCd_MS">
           AND RW1.PLN_ITEM_INSRC_CD              =    #plnItemInsrcCd_MS#
           </isNotNull>
           <isNotNull property="invtyOwnrCd_OS">
           AND RW1.INVTY_OWNR_CD                  =    #invtyOwnrCd_OS#
           </isNotNull>
           <isNotNull property="firstRefCmntTxt">
           AND UPPER(RW1.FIRST_REF_CMNT_TXT)      LIKE UPPER(#firstRefCmntTxt#)
           </isNotNull>
           <isNotNull property="effFromDt">
           AND RW1.EFF_FROM_DT                    =    #effFromDt#
           </isNotNull>
           <isNotNull property="effThruDt">
           AND RW1.EFF_THRU_DT                    =    #effThruDt#
           </isNotNull>
            <!-- START 2023/03/07 S.Dong [QC#61205, ADD] -->
           <isNotNull property="whOwnrCd_H1">                                                                    
           AND RW1.WH_OWNR_CD                     =    #whOwnrCd_H1#                                                                  
           </isNotNull>
            <!-- END 2023/03/07 S.Dong [QC#61205, ADD] -->
           <isNotNull property="fullPsnNm_O1">
           AND UPPER(OWN.FULL_PSN_NM)             LIKE UPPER(#fullPsnNm_O1#)
           </isNotNull>
           <isNotNull property="fullPsnNm_O2">
           AND UPPER(ALTOWN.FULL_PSN_NM)          LIKE UPPER(#fullPsnNm_O2#)
           </isNotNull>
           <isNotNull property="shipToLocNm">
           AND UPPER(DPLW1.DS_LOC_NM)             LIKE UPPER(#shipToLocNm#)
           </isNotNull>
           <isNotNull property="rtrnToLocNm">
           AND UPPER(DPLW2.DS_LOC_NM)             LIKE UPPER(#rtrnToLocNm#)
           </isNotNull>
           <isNotNull property="rtlWhNm_H2">
           AND UPPER(RW2.RTL_WH_NM)               LIKE UPPER(#rtlWhNm_H2#)
           </isNotNull>
           <isNotNull property="rtlWhNm_H3">
           AND UPPER(RW3.RTL_WH_NM)               LIKE UPPER(#rtlWhNm_H3#)
           </isNotNull>
           <isNotNull property="rtlWhNm_H4">
           AND UPPER(RW4.RTL_WH_NM)               LIKE UPPER(#rtlWhNm_H4#)
           </isNotNull>
           <isNotNull property="vndLocCd">
           AND UPPER(VSTX.VND_LOC_CD)             LIKE UPPER(#vndLocCd#)
           </isNotNull>
           <isNotNull property="ctyAddr">
           AND UPPER(RW1.CTY_ADDR)                LIKE UPPER(#ctyAddr#)
           </isNotNull>          
         ORDER BY
               RW1.RTL_WH_CD
         )
         WHERE ROWNUM &lt;= #limitRownum#

    </statement>

    <resultMap id="result.NMAL6890_ASMsg" class="NMAL6890_ASMsg">
        <result property="rtlWhCd_A"              column="WAREHOUSE_CODE"         javaType="EZDSStringItem"/>
        <result property="rtlWhNm_A1"             column="WAREHOUSE_NAME"         javaType="EZDSStringItem"/>
        <result property="rtlWhDescTxt_A"         column="WAREHOUSE_DESC"         javaType="EZDSStringItem"/>
        <result property="rtlWhCatgDescTxt_A"     column="WAREHOUSE_TYPE"         javaType="EZDSStringItem"/>
        <result property="fullPsnNm_AO"           column="OWNER"                  javaType="EZDSStringItem"/>
        <result property="fullPsnNm_AA"           column="ALT_OWNER"              javaType="EZDSStringItem"/>
        <result property="invtyAcctDescTxt_A"     column="INVENTORY_ACCOUNT"      javaType="EZDSStringItem"/>
        <result property="shipToLocNm_A"          column="SHIP_TO_LOC"            javaType="EZDSStringItem"/>
        <result property="rtrnToLocNm_A"          column="RETURN_LOC"             javaType="EZDSStringItem"/>
        <result property="procrTpDescTxt_AD"      column="DEFAULT_SOURCE_TYPE"    javaType="EZDSStringItem"/>
        <result property="rtlWhNm_A2"             column="SOURCE_WH"              javaType="EZDSStringItem"/>
        <result property="procrTpDescTxt_AR"      column="DEFAULT_RETURN_TYPE"    javaType="EZDSStringItem"/>
        <result property="rtlWhNm_A3"             column="RETURN_WH"              javaType="EZDSStringItem"/>
        <result property="procrTpDescTxt_AE"      column="EMERGENCY_SOURCE_TYPE"  javaType="EZDSStringItem"/>
        <result property="rtlWhNm_A4"             column="EMERGENCY_SOURCE"       javaType="EZDSStringItem"/>
        <result property="plnItemInsrcDescTxt_A"  column="ALLOW_MIN_MAX_INSRC"    javaType="EZDSStringItem"/>
        <result property="vndLocCd_A"             column="TRADING_PARTNER_ID"     javaType="EZDSStringItem"/>
        <result property="invtyOwnrDescTxt_A"     column="INVENTORY_OWNERSHIP"    javaType="EZDSStringItem"/>
        <result property="firstRefCmntTxt_A"      column="SPACE"                  javaType="EZDSStringItem"/>
        <result property="effFromDt_A"            column="WH_START_DATE"          javaType="EZDSStringItem"/>
        <result property="effThruDt_A"            column="WH_END_DATE"            javaType="EZDSStringItem"/>
        <result property="rtlSwhCd_A"             column="SUB_WH_CD"              javaType="EZDSStringItem"/>
        <result property="ctyAddr_A"              column="CTY_ADDR"               javaType="EZDSStringItem"/>
    </resultMap>

</sqlMap>
