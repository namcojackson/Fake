<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSAL0110Query">
    <typeAlias alias="NSAL0110_ASMsg" type="business.blap.NSAL0110.NSAL0110_ASMsg"/>

    <statement id="searchContractList" parameterClass="Map" resultMap="result.searchContractList">
        SELECT 
                HDR.DS_CONTR_PK
              , HDR.DS_CONTR_NUM
<!-- START 2017/01/30 K.Kitachi [QC#17308, DEL] -->
<!--          , HDR.DS_CONTR_SQ_NUM -->
<!-- END 2017/01/30 K.Kitachi [QC#17308, DEL] -->
              , HDR.DS_CONTR_NM
        <isEqual property="displayMode" compareValue="Detail">
              , DTL.DS_CONTR_DTL_PK
        </isEqual>
              , VW1.DS_CONTR_CTRL_STS_CD        HDR_STS_CD
              , VW1.DS_CONTR_CTRL_STS_NM        HDR_STS_NM
              , STC.SELL_TO_CUST_CD             DS_ACCT_NUM
              , STC.DS_ACCT_NM
              , HDR.DS_CONTR_CATG_CD
<!-- START 2015/12/11 [QC#899, ADD] -->
              , HTP.DS_CONTR_TP_NM
<!-- END 2015/12/11 [QC#899, ADD] -->
        <isEqual property="displayMode" compareValue="Detail">
              , DTL.DS_CONTR_DTL_TP_CD
              , VW2.DS_CONTR_CTRL_STS_CD       DTL_STS_CD
              , VW2.DS_CONTR_CTRL_STS_NM       DTL_STS_NM
              , DTL.CONTR_EFF_FROM_DT
              , DTL.CONTR_EFF_THRU_DT
              , MAC.SER_NUM
              , MDL.T_MDL_NM
<!-- START 2015/12/11 [QC#899, ADD] -->
              , DTP.DS_CONTR_DTL_TP_NM
<!-- END 2015/12/11 [QC#899, ADD] -->
        </isEqual>

        FROM
                DS_CONTR           HDR
              , DS_CONTR_STS_V     VW1
              , SELL_TO_CUST       STC
<!-- START 2015/12/11 [QC#899, ADD] -->
              , DS_CONTR_TP        HTP
<!-- END 2015/12/11 [QC#899, ADD] -->
        <isEqual property="displayMode" compareValue="Detail">
              , DS_CONTR_DTL       DTL
              , DS_CONTR_DTL_TP    DTP
              , DS_CONTR_DTL_STS_V VW2
              , SVC_MACH_MSTR      MAC
              , SVC_CONFIG_MSTR    CNF
              , MDL_NM             MDL
        </isEqual>

        WHERE
                HDR.GLBL_CMPY_CD        = #glblCmpyCd#
        <isNotNull property="dsContrNum">
          AND   HDR.DS_CONTR_NUM     LIKE #dsContrNum#
        </isNotNull>
        <isNotNull property="dsContrNm">
          <!-- START 2017/08/02 K.Kojima [QC#18559, MOD] -->
          <!-- AND   HDR.DS_CONTR_NM      LIKE #dsContrNm# -->
          AND   UPPER(HDR.DS_CONTR_NM) LIKE UPPER(#dsContrNm#)
          <!-- END 2017/08/02 K.Kojima [QC#18559, MOD] -->
        </isNotNull>
        <isNotNull property="dsContrCatgCd">
          AND   HDR.DS_CONTR_CATG_CD    = #dsContrCatgCd#
        </isNotNull>
        <isNotNull property="dsAcctNum">
<!-- START 2015/12/11 [QC#888, MOD] -->
          AND   HDR.DS_ACCT_NUM      LIKE #dsAcctNum#
<!-- END 2015/12/11 [QC#888, MOD] -->
        </isNotNull>
        <isNotNull property="dsContrClsCd">
          AND   HDR.DS_CONTR_CLS_CD     = #dsContrClsCd#
        </isNotNull>
        <isNotNull property="svcContrBrCd">
          AND   HDR.SVC_CONTR_BR_CD     = #svcContrBrCd#
        </isNotNull>
          AND   HDR.EZCANCELFLAG        = '0'

          AND   HDR.GLBL_CMPY_CD        = VW1.GLBL_CMPY_CD
          AND   HDR.DS_CONTR_PK         = VW1.DS_CONTR_PK
        <isNotNull property="dsContrCtrlStsHdr">
          AND   VW1.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsHdr#
        </isNotNull>
          AND   VW1.EZCANCELFLAG        = '0'

          AND   HDR.GLBL_CMPY_CD        = STC.GLBL_CMPY_CD
          AND   HDR.DS_ACCT_NUM         = STC.SELL_TO_CUST_CD
          AND   STC.EZCANCELFLAG        = '0'

<!-- START 2015/12/11 [QC#899, ADD] -->
          AND   HDR.GLBL_CMPY_CD        = HTP.GLBL_CMPY_CD
          AND   HDR.DS_CONTR_TP_CD      = HTP.DS_CONTR_TP_CD
          AND   HTP.EZCANCELFLAG        = '0'
<!-- END 2015/12/11 [QC#899, ADD] -->

        <isEqual property="displayMode" compareValue="Summary">
        <isNotNull property="dsContrDtlTpCd">
          AND   EXISTS (
                    SELECT * 
                    FROM
                            DS_CONTR_DTL      A
                    WHERE
                            HDR.GLBL_CMPY_CD        = A.GLBL_CMPY_CD
                      AND   HDR.DS_CONTR_PK         = A.DS_CONTR_PK
                      AND   A.EZCANCELFLAG          = '0'
                      AND   A.DS_CONTR_DTL_TP_CD    = #dsContrDtlTpCd#
                )
        </isNotNull>

        <isNotNull property="dsContrDtlStsCd">
          AND   EXISTS (
                    SELECT * 
                    FROM
                            DS_CONTR_DTL_STS_V    B
                    WHERE
                            HDR.GLBL_CMPY_CD         = B.GLBL_CMPY_CD
                      AND   HDR.DS_CONTR_PK          = B.DS_CONTR_PK
                      AND   B.EZCANCELFLAG           = '0'
                      AND   B.DS_CONTR_CTRL_STS_CD   = #dsContrCtrlStsDtl#
                )
        </isNotNull>

        <isNotNull property="serNum">
          AND   EXISTS (
                    SELECT * 
                    FROM
                            DS_CONTR_DTL      C
                          , SVC_MACH_MSTR     D
                    WHERE
                            HDR.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
                      AND   HDR.DS_CONTR_PK         = C.DS_CONTR_PK
                      AND   C.EZCANCELFLAG          = '0'
                      AND   C.GLBL_CMPY_CD          = D.GLBL_CMPY_CD
                      AND   C.SVC_MACH_MSTR_PK      = D.SVC_MACH_MSTR_PK
                      AND   D.EZCANCELFLAG          = '0'
                      AND   D.SER_NUM            LIKE #serNum#
                )
        </isNotNull>

        <isNotNull property="mdlNm">
          AND   EXISTS (
                    SELECT * 
                    FROM
                            DS_CONTR_DTL      E
                          , SVC_MACH_MSTR     F
                          , SVC_CONFIG_MSTR   G
                          , MDL_NM            H
                    WHERE
                            HDR.GLBL_CMPY_CD        = E.GLBL_CMPY_CD
                      AND   HDR.DS_CONTR_PK         = E.DS_CONTR_PK
                      AND   E.EZCANCELFLAG          = '0'
                      AND   E.GLBL_CMPY_CD          = F.GLBL_CMPY_CD
                      AND   E.SVC_MACH_MSTR_PK      = F.SVC_MACH_MSTR_PK
                      AND   F.EZCANCELFLAG          = '0'
                      AND   E.GLBL_CMPY_CD          = G.GLBL_CMPY_CD(+)
                      AND   E.SVC_CONFIG_MSTR_PK    = G.SVC_CONFIG_MSTR_PK(+)
                      AND   G.EZCANCELFLAG(+)       = '0'
                      AND   G.GLBL_CMPY_CD          = H.T_GLBL_CMPY_CD
                      AND   G.MDL_ID                = H.T_MDL_ID
                      AND   H.EZCANCELFLAG          = '0'
                      AND   H.T_MDL_NM           LIKE #mdlNm#
                )
        </isNotNull>
        </isEqual>

        <isEqual property="displayMode" compareValue="Detail">
          AND   HDR.GLBL_CMPY_CD        = DTL.GLBL_CMPY_CD
          AND   HDR.DS_CONTR_PK         = DTL.DS_CONTR_PK
        <isNotNull property="dsContrDtlTpCd">
          AND   DTL.DS_CONTR_DTL_TP_CD  = #dsContrDtlTpCd#
        </isNotNull>
          AND   DTL.EZCANCELFLAG        = '0'

          AND   DTL.GLBL_CMPY_CD        = DTP.GLBL_CMPY_CD
          AND   DTL.DS_CONTR_DTL_TP_CD  = DTP.DS_CONTR_DTL_TP_CD
          AND   DTP.MAIN_UNIT_LINE_FLG  = #mainUnitLineFlg#
          AND   DTP.EZCANCELFLAG        = '0'

          AND   DTL.GLBL_CMPY_CD        = VW2.GLBL_CMPY_CD
          AND   DTL.DS_CONTR_DTL_PK     = VW2.DS_CONTR_DTL_PK
        <isNotNull property="dsContrCtrlStsDtl">
          AND   VW2.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsDtl#
        </isNotNull>
          AND   VW2.EZCANCELFLAG        = '0'

          AND   DTL.GLBL_CMPY_CD        = MAC.GLBL_CMPY_CD
          AND   DTL.SVC_MACH_MSTR_PK    = MAC.SVC_MACH_MSTR_PK
        <isNotNull property="serNum">
          AND   MAC.SER_NUM          LIKE #serNum#
        </isNotNull>
          AND   MAC.EZCANCELFLAG        = '0'

          AND   MAC.GLBL_CMPY_CD        = CNF.GLBL_CMPY_CD(+)
          AND   MAC.SVC_CONFIG_MSTR_PK  = CNF.SVC_CONFIG_MSTR_PK(+)
          AND   CNF.EZCANCELFLAG(+)     = '0'

          AND   CNF.GLBL_CMPY_CD        = MDL.T_GLBL_CMPY_CD
          AND   CNF.MDL_ID              = MDL.T_MDL_ID
        <isNotNull property="mdlNm">
          AND   MDL.T_MDL_NM         LIKE #mdlNm#
        </isNotNull>
          AND   MDL.EZCANCELFLAG        = '0'
        </isEqual>

          AND   ROWNUM                 &lt;= #rownum#
<!-- START 2017/01/30 K.Kitachi [QC#17308, MOD] -->
        ORDER BY HDR.DS_CONTR_NUM
<!-- END 2017/01/30 K.Kitachi [QC#17308, MOD] -->
        <isEqual property="displayMode" compareValue="Detail">
        , DTL.DS_CONTR_DTL_PK
        </isEqual>
    </statement>

    <resultMap id="result.searchContractList" class="NSAL0110_ASMsg">
        <result property="dsContrPk_RS" column="DS_CONTR_PK"  javaType="EZDSBigDecimalItem" />
        <result property="dsContrNum_RS" column="DS_CONTR_NUM"  javaType="EZDSStringItem" />
<!-- START 2017/01/30 K.Kitachi [QC#17308, DEL] -->
<!--    <result property="dsContrSqNum_RS" column="DS_CONTR_SQ_NUM"  javaType="EZDSStringItem" /> -->
<!-- END 2017/01/30 K.Kitachi [QC#17308, DEL] -->
        <result property="dsContrNm_RS" column="DS_CONTR_NM"  javaType="EZDSStringItem" />
        <result property="dsContrDtlPk_RS" column="DS_CONTR_DTL_PK"  javaType="EZDSBigDecimalItem" />
        <result property="dsContrCtrlStsCd_HS" column="HDR_STS_CD"  javaType="EZDSStringItem" />
        <result property="dsContrCtrlStsNm_HS" column="HDR_STS_NM"  javaType="EZDSStringItem" />
        <result property="dsAcctNum_RS" column="DS_ACCT_NUM"  javaType="EZDSStringItem" />
        <result property="dsAcctNm_RS" column="DS_ACCT_NM"  javaType="EZDSStringItem" />
        <result property="dsContrCatgCd_RS" column="DS_CONTR_CATG_CD"  javaType="EZDSStringItem" />
        <result property="dsContrCtrlStsCd_DS" column="DTL_STS_CD"  javaType="EZDSStringItem" />
        <result property="dsContrCtrlStsNm_DS" column="DTL_STS_NM"  javaType="EZDSStringItem" />
        <result property="dsContrDtlTpCd_RS" column="DS_CONTR_DTL_TP_CD"  javaType="EZDSStringItem" />
        <result property="contrVrsnEffFromDt_RS" column="CONTR_EFF_FROM_DT"  javaType="EZDSDateItem" />
        <result property="contrVrsnEffThruDt_RS" column="CONTR_EFF_THRU_DT"  javaType="EZDSDateItem" />
        <result property="serNum_RS" column="SER_NUM"  javaType="EZDSStringItem" />
        <result property="mdlNm_RS" column="T_MDL_NM"  javaType="EZDSStringItem" />
<!-- START 2015/12/11 [QC#899, ADD] -->
        <result property="dsContrCatgDescTxt_RS" column="DS_CONTR_TP_NM"  javaType="EZDSStringItem" />
        <result property="dsContrDtlTpDescTxt_RS" column="DS_CONTR_DTL_TP_NM"  javaType="EZDSStringItem" />
<!-- END 2015/12/11 [QC#899, ADD] -->
    </resultMap>

    <!-- Pulldown -->
<!-- START 2015/12/11 [QC#1586, DEL] -->
<!--    <statement id="getContrCtrStsHeader" parameterClass="Map" resultClass="Map"> -->
<!--        WITH AVAL_DS_CONTR_CTRL_STS -->
<!--                AS (SELECT D.* -->
<!--                      FROM DT_MGT M, DS_CONTR_CTRL_STS D -->
<!--                     WHERE     D.CONTR_MACH_AVAL_FLG = 'Y' -->
<!--                           AND M.GLBL_CMPY_CD = D.GLBL_CMPY_CD -->
<!--                           AND M.DT_MGT_PGM_ID = '*' -->
<!--                           AND M.DT_PROC_CD = 'S' -->
<!--                           AND D.ACTV_FLG = 'Y' -->
<!--                           AND M.MGT_DT BETWEEN D.EFF_FROM_DT -->
<!--                                            AND NVL (D.EFF_THRU_DT, M.MGT_DT) -->
<!--                           AND M.EZCANCELFLAG = '0' -->
<!--                           AND D.EZCANCELFLAG = '0') -->
<!--        SELECT -->
<!--              B.DS_CONTR_CTRL_STS_CD -->
<!--             ,B.DS_CONTR_CTRL_STS_NM -->
<!--        FROM -->
<!--             DS_CONTR_STS               A -->
<!--            ,AVAL_DS_CONTR_CTRL_STS     B -->
<!--        WHERE -->
<!--                A.GLBL_CMPY_CD              = #glblCmpyCd# -->
<!--            AND A.EZCANCELFLAG              = '0' -->
<!--            AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD -->
<!--            AND A.DS_CONTR_STS_CD           = B.DS_CONTR_STS_CD -->
<!--            AND B.EZCANCELFLAG              = '0' -->
<!--        ORDER BY -->
<!--            DS_CONTR_STS_SORT_NUM -->
<!--    </statement> -->
<!-- END 2015/12/11 [QC#1586, DEL] -->

<!-- START 2015/12/11 [QC#1586, ADD] -->
    <statement id="getContrCtrSts" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_CTRL_STS_CD
            ,A.DS_CONTR_CTRL_STS_NM
        FROM
             DS_CONTR_CTRL_STS A
        WHERE
                A.GLBL_CMPY_CD                  = #glblCmpyCd#
            AND A.EZCANCELFLAG                  = '0'
            AND A.CONTR_AVAL_FLG                = 'Y'
            AND A.ACTV_FLG                      = 'Y'
            AND A.EFF_FROM_DT               &lt;= #slsDt#
            AND NVL(A.EFF_THRU_DT, #endDt#) &gt;= #slsDt#
        ORDER BY
             A.DS_CONTR_CTRL_STS_CD
    </statement>
<!-- END 2015/12/11 [QC#1586, ADD] -->

    <statement id="getContractCategory" parameterClass="Map" resultClass="Map">
        SELECT
            DS_CONTR_CATG_CD
          , DS_CONTR_CATG_CD || ':' || DS_CONTR_CATG_DESC_TXT DS_CONTR_CATG_DESC_TXT
        FROM
            DS_CONTR_CATG
        WHERE
              GLBL_CMPY_CD = #glblCmpyCd#
          AND EZCANCELFLAG = '0'
        ORDER BY DS_CONTR_CATG_SORT_NUM
    </statement>

    <statement id="getContractClass" parameterClass="Map" resultClass="Map">
        SELECT
            DS_CONTR_CLS_CD
          , DS_CONTR_CLS_DESC_TXT
        FROM
            DS_CONTR_CLS
        WHERE
              GLBL_CMPY_CD = #glblCmpyCd#
          AND EZCANCELFLAG = '0'
        ORDER BY DS_CONTR_CLS_SORT_NUM
    </statement>

    <statement id="getContractDetailType" parameterClass="Map" resultClass="Map">
        SELECT
            DS_CONTR_DTL_TP_CD
          , DS_CONTR_DTL_TP_DESC_TXT DS_CONTR_DTL_TP_DESC_TXT
        FROM
            DS_CONTR_DTL_TP
        WHERE
              GLBL_CMPY_CD = #glblCmpyCd#
          AND EZCANCELFLAG = '0'
        ORDER BY DS_CONTR_DTL_TP_SORT_NUM
    </statement>

<!-- START 2015/12/11 [QC#1586, DEL] -->
<!--    <statement id="getContractDetailStatus" parameterClass="Map" resultClass="Map"> -->
<!--        WITH AVAL_DS_CONTR_CTRL_STS -->
<!--                AS (SELECT D.* -->
<!--                      FROM DT_MGT M, DS_CONTR_CTRL_STS D -->
<!--                     WHERE     D.CONTR_MACH_AVAL_FLG = 'Y' -->
<!--                           AND M.GLBL_CMPY_CD = D.GLBL_CMPY_CD -->
<!--                           AND M.DT_MGT_PGM_ID = '*' -->
<!--                           AND M.DT_PROC_CD = 'S' -->
<!--                           AND D.ACTV_FLG = 'Y' -->
<!--                           AND M.MGT_DT BETWEEN D.EFF_FROM_DT -->
<!--                                            AND NVL (D.EFF_THRU_DT, M.MGT_DT) -->
<!--                           AND M.EZCANCELFLAG = '0' -->
<!--                           AND D.EZCANCELFLAG = '0') -->
<!--        SELECT -->
<!--              B.DS_CONTR_CTRL_STS_CD -->
<!--             ,B.DS_CONTR_CTRL_STS_NM -->
<!--        FROM -->
<!--             DS_CONTR_DTL_STS           A -->
<!--            ,AVAL_DS_CONTR_CTRL_STS     B -->
<!--        WHERE -->
<!--                A.GLBL_CMPY_CD              = #glblCmpyCd# -->
<!--            AND A.EZCANCELFLAG              = '0' -->
<!--            AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD -->
<!--            AND A.DS_CONTR_DTL_STS_CD       = B.DS_CONTR_DTL_STS_CD -->
<!--            AND B.EZCANCELFLAG              = '0' -->
<!--        ORDER BY -->
<!--            DS_CONTR_DTL_STS_SORT_NUM -->
<!--    </statement> -->
<!-- END 2015/12/11 [QC#1586, DEL] -->

</sqlMap>
