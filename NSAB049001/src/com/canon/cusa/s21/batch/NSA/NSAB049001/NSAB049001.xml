<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAB049001">
    <statement id="getTargetSers" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT 
            DISTINCT
                 IMR.SER_NUM
                ,IMR.MDSE_CD
                ,IMR.MTR_READ_DT
        FROM
            ROSS_INTFC_MTR_READ IMR
        WHERE
               IMR.GLBL_CMPY_CD            = #GLBL_CMPY_CD#
        AND    IMR.ROSS_INTFC_MTR_PROC_CD  = #ROSS_INTFC_MTR_PROC_CD#
        AND    IMR.EZCANCELFLAG            = '0'
     ]]>
	</statement>
    <statement id="getSerialMtrReadList" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT 
             IMR.GLBL_CMPY_CD
            ,IMR.ROSS_INTFC_MTR_READ_PK
            ,IMR.ROSS_INTFC_MTR_PROC_CD
            ,IMR.ROSS_INTFC_MTR_PROC_TXT
            ,IMR.MTR_READ_SRC_TP_CD
            ,IMR.DS_MTR_READ_TP_CD
            ,IMR.SER_NUM
            ,IMR.MDSE_CD
            ,IMR.BLLG_REVN_CD
            ,IMR.SVC_DLR_CD
            ,IMR.MACH_MSTR_PK
            ,IMR.PHYS_MTR_NUM
            ,IMR.PHYS_MTR_NM
            ,IMR.PHYS_MTR_READ_PK
            ,IMR.MTR_READ_DT
            ,IMR.RGTN_MTR_DT
            ,IMR.MTR_LB_CD
            ,IMR.READ_MTR_CNT
            ,IMR.TEST_MTR_CNT
            ,IMR.EST_FLG
            ,IMR.MRC_CRAT_DT
            ,IMR.MRC_MOD_DT
        FROM
            ROSS_INTFC_MTR_READ IMR
        WHERE
               IMR.GLBL_CMPY_CD            = #GLBL_CMPY_CD#
        AND    IMR.SER_NUM                 = #SER_NUM#
        AND    IMR.MDSE_CD                 = #MDSE_CD#
        AND    IMR.MTR_READ_DT             = #MTR_READ_DT#
        AND    IMR.ROSS_INTFC_MTR_PROC_CD  = #ROSS_INTFC_MTR_PROC_CD#
        AND    IMR.EZCANCELFLAG = '0'
        ORDER BY
             IMR.SER_NUM
            ,IMR.MTR_READ_DT
            ,IMR.READ_MTR_CNT
    ]]>
	</statement>
    <statement id="getSvcMachMstr" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
             SMM.GLBL_CMPY_CD
            ,SMM.SVC_MACH_MSTR_PK
        FROM
            SVC_MACH_MSTR SMM
        WHERE
            SMM.GLBL_CMPY_CD = #GLBL_CMPY_CD#
        AND SMM.SER_NUM      = #SER_NUM#
        AND SMM.MDSE_CD      = #MDSE_CD#
        AND SMM.EZCANCELFLAG = '0'
        AND ROWNUM           = 1
    ]]>
	</statement>

    <statement id="getPhysMtrList" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
             SPM.SVC_PHYS_MTR_PK
            ,ML.MTR_LB_CD
            ,ML.BW_MTR_FLG
            ,ML.COLOR_MTR_FLG
            ,ML.TOT_MTR_FLG
        FROM
             SVC_PHYS_MTR SPM
            ,MTR_LB ML
        WHERE
            SPM.GLBL_CMPY_CD                  = #GLBL_CMPY_CD#
        AND SPM.SVC_MACH_MSTR_PK              = #SVC_MACH_MSTR_PK#
        AND SPM.ACTV_FLG                      = #ACTV_FLG#
        AND NVL(SPM.EFF_FROM_DT, '20000101') <= #SALES_DATE#
        AND NVL(SPM.EFF_THRU_DT, '99991231') >= #SALES_DATE#
        AND SPM.GLBL_CMPY_CD                  = ML.GLBL_CMPY_CD
        AND SPM.MDL_MTR_LB_CD                 = ML.MTR_LB_CD
        AND ML.ACTV_FLG                       = #ACTV_FLG#
        AND (ML.BW_MTR_FLG = #BW_MTR_FLG# OR ML.COLOR_MTR_FLG = #COLOR_MTR_FLG# OR ML.TOT_MTR_FLG = #TOT_MTR_FLG#)
        AND NVL(ML.EFF_FROM_DT, '20000101') <= #SALES_DATE#
        AND NVL(ML.EFF_THRU_DT, '99991231') >= #SALES_DATE#
        AND SPM.EZCANCELFLAG                 = '0'
        AND ML.EZCANCELFLAG                  = '0'
    ]]>
	</statement>

    <statement id="getMtrReadForDupCheck" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            COUNT(*) 
        FROM 
            SVC_PHYS_MTR_READ SPMR
        WHERE
            SPMR.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND SPMR.SVC_PHYS_MTR_PK          = #SVC_PHYS_MTR_PK#
        AND SPMR.DS_MTR_READ_TP_GRP_CD    = #DS_MTR_READ_TP_GRP_CD#
        AND SPMR.MTR_READ_DT              = #MTR_READ_DT#
        AND SPMR.EST_FLG                  = #EST_FLG#
        AND SPMR.VLD_MTR_FLG              = #VLD_MTR_FLG#
        AND SPMR.EZCANCELFLAG             = '0'
	</statement>
    <statement id="getLastMtrCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             A.READ_MTR_CNT
        FROM (
            SELECT
                 SPMR.READ_MTR_CNT  AS READ_MTR_CNT
            FROM
                 SVC_PHYS_MTR_READ SPMR
            WHERE
                SPMR.GLBL_CMPY_CD          = #GLBL_CMPY_CD#
            AND SPMR.SVC_PHYS_MTR_PK       = #SVC_PHYS_MTR_PK#
            AND SPMR.DS_MTR_READ_TP_GRP_CD = #DS_MTR_READ_TP_GRP_CD#
            AND SPMR.EST_FLG               = #EST_FLG#
            AND SPMR.VLD_MTR_FLG           = #VLD_MTR_FLG#
            AND SPMR.EZCANCELFLAG          = '0'
            ORDER BY
                 SPMR.MTR_READ_DT              DESC
                ,SPMR.SVC_PHYS_MTR_READ_GRP_SQ DESC
            ) A
        WHERE
            ROWNUM = 1
    </statement>
    <statement id="getDsMsgTxt" parameterClass="Map" resultClass="Map">
        SELECT
             DMI.DS_MTR_PROC_STS_CD
            ,DM.DS_MSG_TXT 
        FROM 
            DS_MTR_INTFC DMI
            ,DS_MSG DM
        WHERE
            DMI.GLBL_CMPY_CD          = #GLBL_CMPY_CD#
        AND DMI.SER_NUM               = #SER_NUM#
        AND DMI.MDSE_CD               = #MDSE_CD#
        AND DMI.MDL_MTR_LB_CD         = #MDL_MTR_LB_CD#
        AND DMI.MTR_READ_DT           = #MTR_READ_DT#
        AND (
            DMI.DS_MTR_PROC_STS_CD    = #ST_WARN# 
            OR 
            DMI.DS_MTR_PROC_STS_CD    = #ST_ERR# 
            )
            
        AND DMI.GLBL_CMPY_CD          = DM.GLBL_CMPY_CD
        AND DMI.DS_MTR_INTFC_PK       = DM.DS_MSG_TRX_NUM
        AND DM.DS_MSG_TRX_NM          = #DS_MSG_TRX_NM#
        AND DMI.EZCANCELFLAG          = '0'
        AND DM.EZCANCELFLAG           = '0'
    </statement>
</sqlMap>
