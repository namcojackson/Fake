<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NMAL6790Query">

    <typeAlias alias="NMAL6790CMsg"      type="business.blap.NMAL6790.NMAL6790CMsg"/>
    <typeAlias alias="NMAL6790_ASMsg"    type="business.blap.NMAL6790.NMAL6790_ASMsg"/>
    <typeAlias alias="NMAL6790_BSMsg"    type="business.blap.NMAL6790.NMAL6790_BSMsg"/>

    <statement id="getContact" parameterClass="Map" resultMap="result.getContact">
<!-- QC#15528 Add Start -->
<!-- QC#8598 Add DISTINCT statement. Dell No use select Column. Add CTAC_TP_DESC_TXT -->
    <!-- 2018/10/11 QC#27869 Add Start -->
    WITH ALL_CONTACTS AS (
    <!-- 2018/10/11 QC#27869 Add End -->
    <isNotEqual property="contSrchType" compareValue="2"> <!-- 2018/10/11 QC#27869 Add -->
    SELECT DISTINCT
        CONT.*
       ,CN_SER.SER_NUM
       ,1  AS SORT_NUM <!-- 2018/10/11 QC#27869 Add -->
    FROM
        (
         SELECT
             CP.CTAC_PSN_PK
            ,CP.CTAC_PSN_NUM
            ,CT.CTAC_TP_CD
            ,CT.CTAC_TP_DESC_TXT
            ,CP.CTAC_PSN_LAST_NM
            ,CP.CTAC_PSN_FIRST_NM
            ,DCPR.DS_ACCT_NUM
            ,STC.DS_ACCT_NM
            ,DCPR.LOC_NUM
            ,'' AS DS_LOC_NM
            ,'' AS LINE_ADDR
            ,CP.CTAC_PSN_ACTV_FLG
            ,DCPR.DS_PRIM_LOC_FLG
            ,CP.DS_CTAC_PSN_DEPT_CD
            ,CP.DS_CTAC_PSN_TTL_CD
            ,CP.DS_PRIM_CTAC_TP_CD
            
            ,CP.CTAC_PSN_CMNT_TXT
            <!-- 2018/10/11 QC#27869 Add Start -->
            ,DCPT.DS_CTAC_PSN_TTL_NM
            ,DCPD.DS_CTAC_PSN_DEPT_NM
            ,CPT.DS_CTAC_PNT_TP_NM
            <!-- 2018/10/11 QC#27869 Add End-->
         FROM
             DS_CTAC_PSN_RELN DCPR
            ,CTAC_PSN         CP
            ,SELL_TO_CUST     STC
            ,CTAC_TP          CT
            <!-- 2018/10/11 QC#27869 Add Start -->
            ,DS_CTAC_PSN_TTL  DCPT
            ,DS_CTAC_PSN_DEPT DCPD
            ,DS_CTAC_PNT_TP   CPT
            <!-- 2018/10/11 QC#27869 Add End -->
         WHERE
             DCPR.GLBL_CMPY_CD       = #glblCmpyCd#
             AND DCPR.LOC_NUM        IS NULL
             AND DCPR.EZCANCELFLAG   = '0'
             AND DCPR.GLBL_CMPY_CD   = CP.GLBL_CMPY_CD
             AND DCPR.CTAC_PSN_PK    = CP.CTAC_PSN_PK
             AND CP.EZCANCELFLAG     = '0'
             AND DCPR.GLBL_CMPY_CD   = STC.GLBL_CMPY_CD
             AND DCPR.DS_ACCT_NUM    = STC.SELL_TO_CUST_CD
             AND STC.EZCANCELFLAG    = '0'
             AND DCPR.GLBL_CMPY_CD   = CT.GLBL_CMPY_CD
             AND DCPR.CTAC_TP_CD     = CT.CTAC_TP_CD
             AND CT.EZCANCELFLAG     = '0'
             <!-- 2018/10/11 QC#27869 Add Start -->
             AND CP.GLBL_CMPY_CD        = DCPT.GLBL_CMPY_CD(+)
             AND CP.DS_CTAC_PSN_TTL_CD  = DCPT.DS_CTAC_PSN_TTL_CD(+)
             AND DCPT.EZCANCELFLAG(+)   = '0'
             AND CP.GLBL_CMPY_CD        = DCPD.GLBL_CMPY_CD (+)
             AND CP.DS_CTAC_PSN_DEPT_CD = DCPD.DS_CTAC_PSN_DEPT_CD (+)
             AND DCPD.EZCANCELFLAG (+)  = '0'
             AND CP.GLBL_CMPY_CD        = CPT.GLBL_CMPY_CD
             AND CP.DS_PRIM_CTAC_TP_CD  = CPT.DS_CTAC_PNT_TP_CD
             AND CPT.EZCANCELFLAG       = '0'
             <!-- 2018/10/11 QC#27869 Add End -->
         UNION ALL
         SELECT
             CP.CTAC_PSN_PK
            ,CP.CTAC_PSN_NUM
            ,CT.CTAC_TP_CD
            ,CT.CTAC_TP_DESC_TXT
            ,CP.CTAC_PSN_LAST_NM
            ,CP.CTAC_PSN_FIRST_NM
            ,DCPR.DS_ACCT_NUM
            ,'' AS DS_ACCT_NM
            ,DCPR.LOC_NUM
            ,PLW.DS_LOC_NM
            ,TRIM(PLW.FIRST_LINE_ADDR || ' ' || PLW.SCD_LINE_ADDR || ' ' || PLW.THIRD_LINE_ADDR || ' ' || PLW.FRTH_LINE_ADDR) AS LINE_ADDR
            ,CP.CTAC_PSN_ACTV_FLG
            ,DCPR.DS_PRIM_LOC_FLG
            ,CP.DS_CTAC_PSN_DEPT_CD
            ,CP.DS_CTAC_PSN_TTL_CD
            ,CP.DS_PRIM_CTAC_TP_CD
            ,CP.CTAC_PSN_CMNT_TXT
            <!-- 2018/10/11 QC#27869 Add Start -->
            ,DCPT.DS_CTAC_PSN_TTL_NM
            ,DCPD.DS_CTAC_PSN_DEPT_NM
            ,CPT.DS_CTAC_PNT_TP_NM
            <!-- 2018/10/11 QC#27869 Add End-->
         FROM
             DS_CTAC_PSN_RELN DCPR
            ,CTAC_PSN        CP
            ,PTY_LOC_WRK     PLW
            ,CTAC_TP         CT
            <!-- 2018/10/11 QC#27869 Add Start -->
            ,DS_CTAC_PSN_TTL  DCPT
            ,DS_CTAC_PSN_DEPT DCPD
            ,DS_CTAC_PNT_TP   CPT
            <!-- 2018/10/11 QC#27869 Add End -->
         WHERE
             DCPR.GLBL_CMPY_CD          = #glblCmpyCd#
             AND DCPR.DS_ACCT_NUM       IS NULL
             AND DCPR.EZCANCELFLAG      = '0'
             AND DCPR.GLBL_CMPY_CD      = CP.GLBL_CMPY_CD
             AND DCPR.CTAC_PSN_PK       = CP.CTAC_PSN_PK
             AND CP.EZCANCELFLAG        = '0'
             AND DCPR.GLBL_CMPY_CD      = PLW.GLBL_CMPY_CD(+)
             AND DCPR.LOC_NUM           = PLW.LOC_NUM(+)
             AND PLW.EZCANCELFLAG(+)    = '0'
             AND DCPR.GLBL_CMPY_CD      = CT.GLBL_CMPY_CD
             AND DCPR.CTAC_TP_CD        = CT.CTAC_TP_CD
             AND CT.EZCANCELFLAG        = '0'
             <!-- 2018/10/11 QC#27869 Add Start -->
             AND CP.GLBL_CMPY_CD        = DCPT.GLBL_CMPY_CD(+)
             AND CP.DS_CTAC_PSN_TTL_CD  = DCPT.DS_CTAC_PSN_TTL_CD(+)
             AND DCPT.EZCANCELFLAG(+)   = '0'
             AND CP.GLBL_CMPY_CD        = DCPD.GLBL_CMPY_CD (+)
             AND CP.DS_CTAC_PSN_DEPT_CD = DCPD.DS_CTAC_PSN_DEPT_CD (+)
             AND DCPD.EZCANCELFLAG (+)  = '0'
             AND CP.GLBL_CMPY_CD        = CPT.GLBL_CMPY_CD
             AND CP.DS_PRIM_CTAC_TP_CD  = CPT.DS_CTAC_PNT_TP_CD
             AND CPT.EZCANCELFLAG       = '0'
             <!-- 2018/10/11 QC#27869 Add End -->
             <isNotNull property="cMsg.dsAcctNum_H1">
                 AND EXISTS (
                             SELECT
                                 1
                             FROM
                                 ACCT_LOC AL
                             WHERE
                                 AL.GLBL_CMPY_CD     = DCPR.GLBL_CMPY_CD
                                 AND AL.LOC_NUM      = DCPR.LOC_NUM
                                 AND AL.DS_ACCT_NUM  = #cMsg.dsAcctNum_H1#
                                 AND AL.EZCANCELFLAG = '0'
                            )
             </isNotNull>
        ) CONT
       ,(
         SELECT
             DCP.CTAC_PSN_PK
            ,SMM.SER_NUM
            ,SMCP.SVC_CTAC_TP_CD
         FROM
             SVC_MACH_MSTR     SMM
            ,SVC_MACH_CTAC_PSN SMCP
            ,DS_CTAC_PNT       DCP
         WHERE
             SMM.GLBL_CMPY_CD         = #glblCmpyCd#
             AND SMM.EZCANCELFLAG     = '0'
             AND SMM.GLBL_CMPY_CD     = SMCP.GLBL_CMPY_CD
             AND SMM.SVC_MACH_MSTR_PK = SMCP.SVC_MACH_MSTR_PK
             AND SMCP.EZCANCELFLAG    = '0'
             AND SMCP.GLBL_CMPY_CD    = DCP.GLBL_CMPY_CD
             AND SMCP.DS_CTAC_PNT_PK  = DCP.DS_CTAC_PNT_PK
             AND DCP.EZCANCELFLAG     = '0'
         GROUP BY
             DCP.CTAC_PSN_PK
            ,SMM.SER_NUM
            ,SMCP.SVC_CTAC_TP_CD
        ) CN_SER
       ,(
         SELECT
             B.CTAC_PSN_PK
            ,B.DS_CTAC_PNT_TP_CD
            ,P2.DS_CTAC_PNT_VAL_TXT
            ,MAX(CASE WHEN B.DS_CTAC_PNT_TP_CD = #phoneWork# THEN P2.DS_CTAC_PNT_VAL_TXT  ELSE NULL END) DS_CTAC_PNT_VAL_TXT_TP02
            ,MAX(CASE WHEN B.DS_CTAC_PNT_TP_CD = #eMailWork# THEN P2.DS_CTAC_PNT_VAL_TXT  ELSE NULL END) DS_CTAC_PNT_VAL_TXT_TP04
         FROM
             DS_CTAC_PNT P2
            ,(
              SELECT
                  X.CTAC_PSN_PK
                 ,X.DS_CTAC_PNT_TP_CD
                 ,MAX(X.DS_CTAC_PNT_PK) AS DS_CTAC_PNT_PK
              FROM
                  (
                   SELECT
                       P.CTAC_PSN_PK
                      ,TP.DS_CTAC_PNT_TP_CD
                      ,P.DS_CTAC_PNT_PK
                      ,RANK() OVER(PARTITION BY P.CTAC_PSN_PK, TP.DS_CTAC_PNT_TP_CD ORDER BY P.EZUPTIME DESC) AS RNK
                   FROM
                       DS_CTAC_PNT    P
                      ,DS_CTAC_PNT_TP TP
                   WHERE
                       P.GLBL_CMPY_CD             = #glblCmpyCd#
                       AND P.DS_CTAC_PNT_ACTV_FLG = 'Y'
                       AND P.DS_CTAC_PNT_TP_CD    IN (#phoneWork# ,#eMailWork#)
                       AND P.EZCANCELFLAG         = '0'
                       AND P.GLBL_CMPY_CD         = TP.GLBL_CMPY_CD
                       AND P.DS_CTAC_PNT_TP_CD    = TP.DS_CTAC_PNT_TP_CD
                       AND TP.EZCANCELFLAG        = '0'
                  ) X
              WHERE
                  X.RNK = 1
              GROUP BY
                  X.CTAC_PSN_PK
                 ,X.DS_CTAC_PNT_TP_CD
             ) B
          WHERE
             P2.GLBL_CMPY_CD       = #glblCmpyCd#
             AND P2.EZCANCELFLAG   = '0'
             AND P2.DS_CTAC_PNT_PK = B.DS_CTAC_PNT_PK
         GROUP BY
             B.CTAC_PSN_PK
            ,B.DS_CTAC_PNT_TP_CD
            ,P2.DS_CTAC_PNT_VAL_TXT
        ) A
    WHERE
        CONT.CTAC_PSN_PK     = CN_SER.CTAC_PSN_PK(+)
        AND CONT.CTAC_PSN_PK = A.CTAC_PSN_PK(+)
        <isNotNull property="cMsg.ctacTpCd_H1">
            AND CONT.CTAC_TP_CD = #cMsg.ctacTpCd_H1#
        </isNotNull>
        <isNotNull property="cMsg.dsAcctNm_H1">
            AND CONT.DS_ACCT_NM LIKE #cMsg.dsAcctNm_H1#
        </isNotNull>
        <isNotNull property="cMsg.dsAcctNum_H1">
            AND CONT.DS_ACCT_NUM LIKE #cMsg.dsAcctNum_H1#
        </isNotNull>
        <isNotNull property="cMsg.locNum_H1">
            AND CONT.LOC_NUM LIKE #cMsg.locNum_H1#
        </isNotNull>
        <isNotNull property="cMsg.xxChkBox_H1">
            AND CONT.CTAC_PSN_ACTV_FLG = #cMsg.xxChkBox_H1#
        </isNotNull>
        <isNotNull property="cMsg.ctacPsnFirstNm_H1">
            AND UPPER(CONT.CTAC_PSN_FIRST_NM) LIKE UPPER(#cMsg.ctacPsnFirstNm_H1#)
        </isNotNull>
        <isNotNull property="cMsg.ctacPsnLastNm_H1">
            AND UPPER(CONT.CTAC_PSN_LAST_NM) LIKE UPPER(#cMsg.ctacPsnLastNm_H1#)
        </isNotNull>
        <isNotNull property="cMsg.dsLocNm_H1">
            AND CONT.DS_LOC_NM LIKE #cMsg.dsLocNm_H1#
        </isNotNull>
        <isNotNull property="cMsg.xxDplyByItemNm_H1">
            AND CONT.LINE_ADDR LIKE #cMsg.xxDplyByItemNm_H1#
        </isNotNull>
        <isNotNull property="cMsg.dsCtacPsnTtlCd_H1">
            AND CONT.DS_CTAC_PSN_TTL_CD = #cMsg.dsCtacPsnTtlCd_H1#
        </isNotNull>
        <isNotNull property="cMsg.dsCtacPsnDeptCd_H1">
            AND CONT.DS_CTAC_PSN_DEPT_CD = #cMsg.dsCtacPsnDeptCd_H1#
        </isNotNull>
        <!-- 2018/10/11 QC#27869 Mod Start -->
        <!--
        <isNotNull property="cMsg.dsCtacPntValTxt_H1">
            AND A.DS_CTAC_PNT_TP_CD = #phoneWork#
            <isNotNull property="cMsg.dsCtacPntValTxt_H1">
                AND A.DS_CTAC_PNT_VAL_TXT LIKE #cMsg.dsCtacPntValTxt_H1#
            </isNotNull>
        </isNotNull>
        <isNotNull property="cMsg.dsCtacPntValTxt_H2">
            AND A.DS_CTAC_PNT_TP_CD = #eMailWork#
            <isNotNull property="cMsg.dsCtacPntValTxt_H2">
                AND A.DS_CTAC_PNT_VAL_TXT LIKE #cMsg.dsCtacPntValTxt_H2#
            </isNotNull>
        </isNotNull>
        -->
        <isNotNull property="cMsg.dsCtacPntValTxt_H1">
            AND EXISTS
            (
               SELECT
                  PNT.CTAC_PSN_PK
               FROM
                  DS_CTAC_PNT PNT
               WHERE
                  PNT.GLBL_CMPY_CD            = #glblCmpyCd#
                  AND PNT.CTAC_PSN_PK         = CONT.CTAC_PSN_PK
                  AND PNT.DS_CTAC_PNT_TP_CD   = #phoneWork#
                  AND UPPER(PNT.DS_CTAC_PNT_VAL_TXT) LIKE #cMsg.dsCtacPntValTxt_H1#
                  AND PNT.EZCANCELFLAG        = '0'
             )
        </isNotNull>
        <isNotNull property="cMsg.dsCtacPntValTxt_H2">
            AND EXISTS
            (
                SELECT
                   PNT.CTAC_PSN_PK
                FROM
                   DS_CTAC_PNT PNT
                WHERE
                   PNT.GLBL_CMPY_CD          = #glblCmpyCd#
                   AND PNT.CTAC_PSN_PK       = CONT.CTAC_PSN_PK
                   AND PNT.DS_CTAC_PNT_TP_CD = #eMailWork#
                   AND UPPER(PNT.DS_CTAC_PNT_VAL_TXT) LIKE #cMsg.dsCtacPntValTxt_H2#
                   AND PNT.EZCANCELFLAG      = '0'
            )
        </isNotNull>
        <!-- 2018/10/11 QC#27869 Mod End -->
        <isNotNull property="cMsg.xxChkBox_H2">
            AND A.DS_CTAC_PNT_TP_CD = #eMailWork#
        </isNotNull>
        <!-- 2018/10/11 QC#27869 Del Start -->
        <!--
        <isNotNull property="cMsg.svcCtacTpCd_H1">
            AND CN_SER.SVC_CTAC_TP_CD = #cMsg.svcCtacTpCd_H1#
        </isNotNull>
        -->
        <!-- 2018/10/11 QC#27869 Del End -->
        <isNotNull property="cMsg.serNum_H1">
            AND CN_SER.SER_NUM LIKE #cMsg.serNum_H1#
        </isNotNull>
    <!-- 2018/10/11 QC#27869 Add Start -->
    </isNotEqual>
    <isEqual property="contSrchType" compareValue="0">
    UNION ALL
    </isEqual>
    <isNotEqual property="contSrchType" compareValue="1">
    SELECT DISTINCT
        CONT.*
       ,2  AS SORT_NUM
    FROM
        (
         SELECT
             CP.CTAC_PSN_PK
            ,CP.CTAC_PSN_NUM
            ,SCT.SVC_CTAC_TP_CD       AS CTAC_TP_CD
            ,SCT.SVC_CTAC_TP_DESC_TXT AS CTAC_TP_DESC_TXT
            ,CP.CTAC_PSN_LAST_NM
            ,CP.CTAC_PSN_FIRST_NM
            ,DCPR.DS_ACCT_NUM
            ,STC.DS_ACCT_NM
            ,DCPR.LOC_NUM
            ,'' AS DS_LOC_NM
            ,'' AS LINE_ADDR
            ,CASE WHEN SMCP.EFF_FROM_DT &lt;= #salesDate# AND SMCP.EFF_THRU_DT &gt;= #salesDate# THEN 'Y' ELSE 'N' END AS CTAC_PSN_ACTV_FLG
            ,'N' AS DS_PRIM_LOC_FLG
            ,'' AS DS_CTAC_PSN_DEPT_CD
            ,CP.DS_CTAC_PSN_TTL_CD
            ,CP.DS_PRIM_CTAC_TP_CD
            ,CP.CTAC_PSN_CMNT_TXT
            ,DCPT.DS_CTAC_PSN_TTL_NM
            ,'' AS DS_CTAC_PSN_DEPT_NM
            ,CPT.DS_CTAC_PNT_TP_NM
            ,SMM.SER_NUM
         FROM
             DS_CTAC_PSN_RELN DCPR
            ,CTAC_PSN         CP
            ,SELL_TO_CUST     STC
            ,DS_CTAC_PNT      DCP
            ,SVC_CTAC_TP      SCT
            ,SVC_MACH_MSTR    SMM
            ,(
             SELECT
                 GLBL_CMPY_CD
                ,DS_CTAC_PNT_PK
                ,SVC_CTAC_TP_CD
                ,SVC_MACH_MSTR_PK
                ,MIN(EFF_FROM_DT)                 AS EFF_FROM_DT
                ,MAX(NVL(EFF_THRU_DT, #maxDate#)) AS EFF_THRU_DT
             FROM
                 SVC_MACH_CTAC_PSN
             WHERE
                 EZCANCELFLAG = '0'
             GROUP BY
                 GLBL_CMPY_CD
                ,DS_CTAC_PNT_PK
                ,SVC_CTAC_TP_CD
                ,SVC_MACH_MSTR_PK
             ) SMCP
            ,DS_CTAC_PSN_TTL  DCPT
            ,DS_CTAC_PNT_TP   CPT
         WHERE
             DCPR.GLBL_CMPY_CD         = #glblCmpyCd#
             AND DCPR.LOC_NUM          IS NULL
             AND DCPR.EZCANCELFLAG     = '0'
             AND DCPR.GLBL_CMPY_CD     = CP.GLBL_CMPY_CD
             AND DCPR.CTAC_PSN_PK      = CP.CTAC_PSN_PK
             AND CP.EZCANCELFLAG       = '0'
             AND DCPR.GLBL_CMPY_CD     = STC.GLBL_CMPY_CD
             AND DCPR.DS_ACCT_NUM      = STC.SELL_TO_CUST_CD
             AND STC.EZCANCELFLAG      = '0'
             AND CP.GLBL_CMPY_CD       = DCP.GLBL_CMPY_CD
             AND CP.CTAC_PSN_PK        = DCP.CTAC_PSN_PK
             AND DCP.EZCANCELFLAG      = '0'
             AND DCP.GLBL_CMPY_CD      = SMCP.GLBL_CMPY_CD
             AND DCP.DS_CTAC_PNT_PK    = SMCP.DS_CTAC_PNT_PK
             AND SMCP.GLBL_CMPY_CD     = SCT.GLBL_CMPY_CD
             AND SMCP.SVC_CTAC_TP_CD   = SCT.SVC_CTAC_TP_CD
             AND SCT.EZCANCELFLAG      = '0'
             AND SMCP.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
             AND SMCP.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
             AND DCPR.DS_ACCT_NUM      = SMM.CUR_LOC_ACCT_NUM
             AND SMM.EZCANCELFLAG(+)   = '0'
             AND CP.GLBL_CMPY_CD       = DCPT.GLBL_CMPY_CD(+)
             AND CP.DS_CTAC_PSN_TTL_CD = DCPT.DS_CTAC_PSN_TTL_CD(+)
             AND DCPT.EZCANCELFLAG(+)  = '0'
             AND CP.GLBL_CMPY_CD       = CPT.GLBL_CMPY_CD
             AND CP.DS_PRIM_CTAC_TP_CD = CPT.DS_CTAC_PNT_TP_CD
             AND CPT.EZCANCELFLAG      = '0'
         UNION ALL
         SELECT
             CP.CTAC_PSN_PK
            ,CP.CTAC_PSN_NUM
            ,SCT.SVC_CTAC_TP_CD       AS CTAC_TP_CD
            ,SCT.SVC_CTAC_TP_DESC_TXT AS CTAC_TP_DESC_TXT
            ,CP.CTAC_PSN_LAST_NM
            ,CP.CTAC_PSN_FIRST_NM
            ,DCPR.DS_ACCT_NUM
            ,'' AS DS_ACCT_NM
            ,DCPR.LOC_NUM
            ,PLW.DS_LOC_NM
            ,TRIM(PLW.FIRST_LINE_ADDR || ' ' || PLW.SCD_LINE_ADDR || ' ' || PLW.THIRD_LINE_ADDR || ' ' || PLW.FRTH_LINE_ADDR) AS LINE_ADDR
            ,CASE WHEN SMCP.EFF_FROM_DT &lt;= #salesDate# AND SMCP.EFF_THRU_DT &gt;= #salesDate# THEN 'Y' ELSE 'N' END AS CTAC_PSN_ACTV_FLG
            ,'N' AS DS_PRIM_LOC_FLG
            ,'' AS DS_CTAC_PSN_DEPT_CD
            ,CP.DS_CTAC_PSN_TTL_CD
            ,CP.DS_PRIM_CTAC_TP_CD
            ,CP.CTAC_PSN_CMNT_TXT
            ,DCPT.DS_CTAC_PSN_TTL_NM
            ,'' AS DS_CTAC_PSN_DEPT_NM
            ,CPT.DS_CTAC_PNT_TP_NM
            ,SMM.SER_NUM
         FROM
             DS_CTAC_PSN_RELN DCPR
            ,CTAC_PSN         CP
            ,PTY_LOC_WRK      PLW
            ,DS_CTAC_PNT      DCP
            ,SVC_CTAC_TP      SCT
            ,SVC_MACH_MSTR    SMM
            ,(
             SELECT
                 GLBL_CMPY_CD
                ,DS_CTAC_PNT_PK
                ,SVC_CTAC_TP_CD
                ,SVC_MACH_MSTR_PK
                ,MIN(EFF_FROM_DT) AS EFF_FROM_DT
                ,MAX(NVL(EFF_THRU_DT, #maxDate#)) AS EFF_THRU_DT
             FROM
                 SVC_MACH_CTAC_PSN
             WHERE
                 EZCANCELFLAG = '0'
             GROUP BY
                 GLBL_CMPY_CD
                ,DS_CTAC_PNT_PK
                ,SVC_CTAC_TP_CD
                ,SVC_MACH_MSTR_PK
             ) SMCP
            ,DS_CTAC_PSN_TTL  DCPT
            ,DS_CTAC_PNT_TP   CPT
         WHERE
             DCPR.GLBL_CMPY_CD          = #glblCmpyCd#
             AND DCPR.DS_ACCT_NUM       IS NULL
             AND DCPR.EZCANCELFLAG      = '0'
             AND DCPR.GLBL_CMPY_CD      = CP.GLBL_CMPY_CD
             AND DCPR.CTAC_PSN_PK       = CP.CTAC_PSN_PK
             AND CP.EZCANCELFLAG        = '0'
             AND DCPR.GLBL_CMPY_CD      = PLW.GLBL_CMPY_CD(+)
             AND DCPR.LOC_NUM           = PLW.LOC_NUM(+)
             AND PLW.EZCANCELFLAG(+)    = '0'
             AND CP.GLBL_CMPY_CD        = DCP.GLBL_CMPY_CD
             AND CP.CTAC_PSN_PK         = DCP.CTAC_PSN_PK
             AND DCP.EZCANCELFLAG       = '0'
             AND DCP.GLBL_CMPY_CD       = SMCP.GLBL_CMPY_CD
             AND DCP.DS_CTAC_PNT_PK     = SMCP.DS_CTAC_PNT_PK
             AND SMCP.GLBL_CMPY_CD      = SCT.GLBL_CMPY_CD
             AND SMCP.SVC_CTAC_TP_CD    = SCT.SVC_CTAC_TP_CD
             AND SCT.EZCANCELFLAG       = '0'
             AND SMCP.GLBL_CMPY_CD      = SMM.GLBL_CMPY_CD
             AND SMCP.SVC_MACH_MSTR_PK  = SMM.SVC_MACH_MSTR_PK
             AND DCPR.LOC_NUM           = SMM.IND_CUR_LOC_NUM
             AND SMM.EZCANCELFLAG       = '0'
             AND CP.GLBL_CMPY_CD        = DCPT.GLBL_CMPY_CD(+)
             AND CP.DS_CTAC_PSN_TTL_CD  = DCPT.DS_CTAC_PSN_TTL_CD(+)
             AND DCPT.EZCANCELFLAG(+)   = '0'
             AND CP.GLBL_CMPY_CD        = CPT.GLBL_CMPY_CD
             AND CP.DS_PRIM_CTAC_TP_CD  = CPT.DS_CTAC_PNT_TP_CD
             AND CPT.EZCANCELFLAG       = '0'
             <isNotNull property="cMsg.dsAcctNum_H1">
                 AND EXISTS (
                             SELECT
                                 1
                             FROM
                                 ACCT_LOC AL
                             WHERE
                                 AL.GLBL_CMPY_CD     = DCPR.GLBL_CMPY_CD
                                 AND AL.LOC_NUM      = DCPR.LOC_NUM
                                 AND AL.DS_ACCT_NUM  = #cMsg.dsAcctNum_H1#
                                 AND AL.EZCANCELFLAG = '0'
                            )
             </isNotNull>
        ) CONT
       ,(
         SELECT
             B.CTAC_PSN_PK
            ,B.DS_CTAC_PNT_TP_CD
            ,P2.DS_CTAC_PNT_VAL_TXT
            ,MAX(CASE WHEN B.DS_CTAC_PNT_TP_CD = #phoneWork# THEN P2.DS_CTAC_PNT_VAL_TXT  ELSE NULL END) DS_CTAC_PNT_VAL_TXT_TP02
            ,MAX(CASE WHEN B.DS_CTAC_PNT_TP_CD = #eMailWork# THEN P2.DS_CTAC_PNT_VAL_TXT  ELSE NULL END) DS_CTAC_PNT_VAL_TXT_TP04
         FROM
             DS_CTAC_PNT P2
            ,(
              SELECT
                  X.CTAC_PSN_PK
                 ,X.DS_CTAC_PNT_TP_CD
                 ,MAX(X.DS_CTAC_PNT_PK) AS DS_CTAC_PNT_PK
              FROM
                  (
                   SELECT
                       P.CTAC_PSN_PK
                      ,TP.DS_CTAC_PNT_TP_CD
                      ,P.DS_CTAC_PNT_PK
                      ,RANK() OVER(PARTITION BY P.CTAC_PSN_PK, TP.DS_CTAC_PNT_TP_CD ORDER BY P.EZUPTIME DESC) AS RNK
                   FROM
                       DS_CTAC_PNT    P
                      ,DS_CTAC_PNT_TP TP
                   WHERE
                       P.GLBL_CMPY_CD             = #glblCmpyCd#
                       AND P.DS_CTAC_PNT_ACTV_FLG = 'Y'
                       AND P.DS_CTAC_PNT_TP_CD    IN (#phoneWork# ,#eMailWork#)
                       AND P.EZCANCELFLAG         = '0'
                       AND P.GLBL_CMPY_CD         = TP.GLBL_CMPY_CD
                       AND P.DS_CTAC_PNT_TP_CD    = TP.DS_CTAC_PNT_TP_CD
                       AND TP.EZCANCELFLAG        = '0'
                  ) X
              WHERE
                  X.RNK = 1
              GROUP BY
                  X.CTAC_PSN_PK
                 ,X.DS_CTAC_PNT_TP_CD
             ) B
          WHERE
             P2.GLBL_CMPY_CD       = #glblCmpyCd#
             AND P2.EZCANCELFLAG   = '0'
             AND P2.DS_CTAC_PNT_PK = B.DS_CTAC_PNT_PK
         GROUP BY
             B.CTAC_PSN_PK
            ,B.DS_CTAC_PNT_TP_CD
            ,P2.DS_CTAC_PNT_VAL_TXT
        ) A
    WHERE
        CONT.CTAC_PSN_PK = A.CTAC_PSN_PK(+)
        <isNotNull property="cMsg.ctacTpCd_H1">
            AND CONT.CTAC_TP_CD = #cMsg.ctacTpCd_H1#
        </isNotNull>
        <isNotNull property="cMsg.dsAcctNm_H1">
            AND CONT.DS_ACCT_NM LIKE #cMsg.dsAcctNm_H1#
        </isNotNull>
        <isNotNull property="cMsg.dsAcctNum_H1">
            AND CONT.DS_ACCT_NUM LIKE #cMsg.dsAcctNum_H1#
        </isNotNull>
        <isNotNull property="cMsg.locNum_H1">
            AND CONT.LOC_NUM LIKE #cMsg.locNum_H1#
        </isNotNull>
        <isNotNull property="cMsg.xxChkBox_H1">
            AND CONT.CTAC_PSN_ACTV_FLG = #cMsg.xxChkBox_H1#
        </isNotNull>
        <isNotNull property="cMsg.ctacPsnFirstNm_H1">
            AND UPPER(CONT.CTAC_PSN_FIRST_NM) LIKE UPPER(#cMsg.ctacPsnFirstNm_H1#)
        </isNotNull>
        <isNotNull property="cMsg.ctacPsnLastNm_H1">
            AND UPPER(CONT.CTAC_PSN_LAST_NM) LIKE UPPER(#cMsg.ctacPsnLastNm_H1#)
        </isNotNull>
        <isNotNull property="cMsg.dsLocNm_H1">
            AND CONT.DS_LOC_NM LIKE #cMsg.dsLocNm_H1#
        </isNotNull>
        <isNotNull property="cMsg.xxDplyByItemNm_H1">
            AND CONT.LINE_ADDR LIKE #cMsg.xxDplyByItemNm_H1#
        </isNotNull>
        <isNotNull property="cMsg.dsCtacPntValTxt_H1">
            AND EXISTS
            (
               SELECT
                  PNT.CTAC_PSN_PK
               FROM
                  DS_CTAC_PNT PNT
               WHERE
                  PNT.GLBL_CMPY_CD            = #glblCmpyCd#
                  AND PNT.CTAC_PSN_PK         = CONT.CTAC_PSN_PK
                  AND PNT.DS_CTAC_PNT_TP_CD   = #phoneWork#
                  AND UPPER(PNT.DS_CTAC_PNT_VAL_TXT) LIKE #cMsg.dsCtacPntValTxt_H1#
                  AND PNT.EZCANCELFLAG        = '0'
             )
        </isNotNull>
        <isNotNull property="cMsg.dsCtacPntValTxt_H2">
            AND EXISTS
            (
                SELECT
                   PNT.CTAC_PSN_PK
                FROM
                   DS_CTAC_PNT PNT
                WHERE
                   PNT.GLBL_CMPY_CD          = #glblCmpyCd#
                   AND PNT.CTAC_PSN_PK       = CONT.CTAC_PSN_PK
                   AND PNT.DS_CTAC_PNT_TP_CD = #eMailWork#
                   AND UPPER(PNT.DS_CTAC_PNT_VAL_TXT) LIKE #cMsg.dsCtacPntValTxt_H2#
                   AND PNT.EZCANCELFLAG      = '0'
            )
        </isNotNull>
        <isNotNull property="cMsg.dsCtacPsnTtlCd_H1">
            AND CONT.DS_CTAC_PSN_TTL_CD = #cMsg.dsCtacPsnTtlCd_H1#
        </isNotNull>
        <isNotNull property="cMsg.xxChkBox_H2">
            AND A.DS_CTAC_PNT_TP_CD = #eMailWork#
        </isNotNull>
        <isNotNull property="cMsg.serNum_H1">
            AND CONT.SER_NUM LIKE #cMsg.serNum_H1#
        </isNotNull>
    </isNotEqual>
     )
    SELECT
       *
    FROM
       ALL_CONTACTS
    ORDER BY
       CTAC_PSN_NUM
      ,SORT_NUM
      ,CTAC_TP_DESC_TXT
    <!-- 2018/10/11 QC#27869 Add Start -->
    <!-- 2018/10/11 QC#27869 Del Start -->
    <!--
    ORDER BY
        CONT.CTAC_PSN_NUM
    -->
    <!-- 2018/10/11 QC#27869 Del End -->
    </statement>

    <statement id="getDsCtacPntWithoutSerialIB" parameterClass="Map" resultMap="result.getDsCtacPnt">
    <!--  POINT DETAIL -->
    SELECT
        '' AS CHK_BOX
        ,P.CTAC_PSN_PK
        ,P.DS_CTAC_PNT_PK
        <!-- !QC#4866 -->
        ,P.DS_CTAC_PNT_TP_CD
        ,TP.DS_CTAC_PNT_TP_NM
        ,P.DS_CTAC_PNT_VAL_TXT
        ,P.DS_CTAC_PSN_EXTN_NUM
        ,P.DS_OPS_OUT_FLG
        ,P.DS_CTAC_PNT_ACTV_FLG
    FROM
        DS_CTAC_PNT P
        ,DS_CTAC_PNT_TP TP
    WHERE
        P.GLBL_CMPY_CD = #glblCmpyCd#
    AND P.EZCANCELFLAG = '0'
    AND P.GLBL_CMPY_CD = TP.GLBL_CMPY_CD
    AND P.EZCANCELFLAG = TP.EZCANCELFLAG 
    AND P.DS_CTAC_PNT_TP_CD = TP.DS_CTAC_PNT_TP_CD
    <!--  FROM SELECTED CTAC PERSON PRIMARY KEY FROM CONTACT DETAIL -->
    AND P.CTAC_PSN_PK = #ctacPsnPk#
    </statement>
    
    <statement id="getDsCtacPntWithSerialIB" parameterClass="Map" resultMap="result.getDsCtacPnt">
    SELECT
        <isNotNull property="serNum">
        CASE
            WHEN CN_SER.SER_NUM IS NOT NULL THEN 'Y'
            ELSE 'N'
        END AS CHK_BOX,
        </isNotNull>
         P.CTAC_PSN_PK
        ,P.DS_CTAC_PNT_PK
        <!-- !QC#4866 -->
        ,P.DS_CTAC_PNT_TP_CD
        ,TP.DS_CTAC_PNT_TP_NM
        ,P.DS_CTAC_PNT_VAL_TXT
        ,P.DS_CTAC_PSN_EXTN_NUM
        ,P.DS_OPS_OUT_FLG
        ,P.DS_CTAC_PNT_ACTV_FLG
        ,CN_SER.SVC_CTAC_TP_CD
    FROM
        DS_CTAC_PNT P
        ,DS_CTAC_PNT_TP TP
<!-- QC#15528 Add Start -->
        ,(
          SELECT
              DCP.CTAC_PSN_PK
              ,DCP.DS_CTAC_PNT_PK
              ,M.SER_NUM
              ,P.SVC_CTAC_TP_CD
              ,SCT.SVC_CTAC_TP_NM
          FROM
              SVC_MACH_MSTR M
              ,SVC_MACH_CTAC_PSN P
              ,DS_CTAC_PNT DCP
              ,SVC_CTAC_TP SCT
          WHERE
              M.EZCANCELFLAG = '0'
              AND M.GLBL_CMPY_CD = #glblCmpyCd#
              AND M.EZCANCELFLAG = P.EZCANCELFLAG
              AND M.GLBL_CMPY_CD = P.GLBL_CMPY_CD
              AND M.EZCANCELFLAG = DCP.EZCANCELFLAG
              AND M.GLBL_CMPY_CD = DCP.GLBL_CMPY_CD
              AND M.EZCANCELFLAG = SCT.EZCANCELFLAG
              AND M.GLBL_CMPY_CD = SCT.GLBL_CMPY_CD
              AND M.SVC_MACH_MSTR_PK = P.SVC_MACH_MSTR_PK
              AND P.DS_CTAC_PNT_PK = DCP.DS_CTAC_PNT_PK
              AND P.SVC_CTAC_TP_CD = SCT.SVC_CTAC_TP_CD
          GROUP BY
              DCP.CTAC_PSN_PK
              ,DCP.DS_CTAC_PNT_PK
              ,M.SER_NUM
              ,P.SVC_CTAC_TP_CD
              ,SCT.SVC_CTAC_TP_NM
         ) CN_SER
<!-- QC#15528 Add End -->
    WHERE
        P.GLBL_CMPY_CD = #glblCmpyCd#
    AND P.EZCANCELFLAG = '0'
    AND P.GLBL_CMPY_CD = TP.GLBL_CMPY_CD
    AND P.EZCANCELFLAG = TP.EZCANCELFLAG
    AND P.DS_CTAC_PNT_TP_CD = TP.DS_CTAC_PNT_TP_CD
    AND P.CTAC_PSN_PK = CN_SER.CTAC_PSN_PK(+)
    AND P.DS_CTAC_PNT_PK = CN_SER.DS_CTAC_PNT_PK(+)
    <!--  FROM SELECTED CTAC PERSON PRIMARY KEY FROM CONTACT DETAIL -->
    AND P.CTAC_PSN_PK = #ctacPsnPk#

    <!--  FOR SERIAL -->
    <isNotNull property="serNum">
    AND CN_SER.SER_NUM LIKE #serNum#
    </isNotNull>

    <isNotNull property="svcCtacTpCd">
    <!--  AND CN_SER.SVC_CTAC_TP_NM LIKE #svcCtacTpNm# -->
    AND CN_SER.SVC_CTAC_TP_CD = #svcCtacTpCd#
    </isNotNull>
    
    </statement>

    <!-- 2018/10/11 QC#27869 Add Start -->
    <statement id="getSvcCatgTpList" parameterClass="Map" resultClass="Map">
        SELECT
            SCT.SVC_CTAC_TP_CD
           ,SCT.SVC_CTAC_TP_DESC_TXT
        FROM
            SVC_CTAC_TP SCT
        WHERE
            SCT.GLBL_CMPY_CD      = #glblCmpyCd#
        AND SCT.EZCANCELFLAG      = '0'
        ORDER BY
            SCT.SVC_CTAC_TP_SORT_NUM
    </statement>
    <!-- 2018/10/11 QC#27869 Add End -->

    <resultMap id="result.getContact"  class="NMAL6790_ASMsg">
        <result property="ctacPsnPk_A1"        column="CTAC_PSN_PK"          javaType="EZDSBigDecimalItem"/>
        <result property="ctacPsnNum_A1"       column="CTAC_PSN_NUM"         javaType="EZDSStringItem"/>
        <result property="ctacPsnLastNm_A1"    column="CTAC_PSN_LAST_NM"     javaType="EZDSStringItem"/>
        <result property="ctacPsnFirstNm_A1"   column="CTAC_PSN_FIRST_NM"    javaType="EZDSStringItem"/>
        <result property="dsAcctNum_A1"        column="DS_ACCT_NUM"          javaType="EZDSStringItem"/>
        <result property="dsAcctNm_A1"         column="DS_ACCT_NM"           javaType="EZDSStringItem"/>
        <result property="locNum_A1"           column="LOC_NUM"              javaType="EZDSStringItem"/>
        <result property="xxDplyByItemNm_A1"   column="LINE_ADDR"            javaType="EZDSStringItem"/>
        <result property="xxChkBox_A1"         column="CTAC_PSN_ACTV_FLG"    javaType="EZDSStringItem"/>
        <result property="dsLocNm_A1"          column="DS_LOC_NM"            javaType="EZDSStringItem"/>
        <result property="ctacTpCd_A1"         column="CTAC_TP_CD"           javaType="EZDSStringItem"/>
        <result property="ctacTpNm_A1"         column="CTAC_TP_DESC_TXT"     javaType="EZDSStringItem"/>
        <result property="dsCtacPsnDeptCd_A1"  column="DS_CTAC_PSN_DEPT_CD"  javaType="EZDSStringItem"/>
        <result property="dsCtacPsnDeptNm_A1"  column="DS_CTAC_PSN_DEPT_NM"  javaType="EZDSStringItem"/>
        <result property="dsCtacPsnTtlCd_A1"   column="DS_CTAC_PSN_TTL_CD"   javaType="EZDSStringItem"/>
        <result property="dsCtacPsnTtlNm_A1"   column="DS_CTAC_PSN_TTL_NM"   javaType="EZDSStringItem"/>
        <result property="serNum_A1"           column="SER_NUM"              javaType="EZDSStringItem"/>
        <result property="dsPrimCtacTpCd_A1"   column="DS_PRIM_CTAC_TP_CD"   javaType="EZDSStringItem"/>
        <result property="dsCtacPntTpNm_A1"    column="DS_CTAC_PNT_TP_NM"    javaType="EZDSStringItem"/>
        <result property="ctacPsnCmntTxt_A1"   column="CTAC_PSN_CMNT_TXT"    javaType="EZDSStringItem"/>
        <result property="xxChkBox_A2"         column="DS_PRIM_LOC_FLG"      javaType="EZDSStringItem"/>
        <result property="dsPrimLocFlg_A1"     column="DS_PRIM_LOC_FLG"      javaType="EZDSStringItem"/>
    </resultMap>

    <resultMap id="result.getDsCtacPnt"  class="NMAL6790_BSMsg">
        <result property="xxChkBox_B1"         column="CHK_BOX"               javaType="EZDSStringItem"/>
        <result property="dsCtacPntTpCd_B1"    column="DS_CTAC_PNT_TP_CD"    javaType="EZDSStringItem"/>
        <result property="dsCtacPntTpNm_B1"    column="DS_CTAC_PNT_TP_NM"    javaType="EZDSStringItem"/>
        <result property="dsCtacPntValTxt_B1"  column="DS_CTAC_PNT_VAL_TXT"  javaType="EZDSStringItem"/>
        <result property="dsCtacPsnExtnNum_B1" column="DS_CTAC_PSN_EXTN_NUM" javaType="EZDSStringItem"/>
        <result property="xxChkBox_B2"         column="DS_OPS_OUT_FLG"       javaType="EZDSStringItem"/>
        <result property="xxChkBox_B3"         column="DS_CTAC_PNT_ACTV_FLG" javaType="EZDSStringItem"/>
        <result property="ctacPsnPk_B1"        column="CTAC_PSN_PK"          javaType="EZDSBigDecimalItem"/>
        <result property="dsCtacPntPk_B1"      column="DS_CTAC_PNT_PK"       javaType="EZDSBigDecimalItem"/>
        <result property="svcCtacTpCd_B1"      column="SVC_CTAC_TP_CD"       javaType="EZDSStringItem"/>
    </resultMap>
</sqlMap>
