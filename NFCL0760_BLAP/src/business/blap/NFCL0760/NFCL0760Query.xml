<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NFCL0760Query">
    <typeAlias alias="NFCL0760CMsg"  type="business.blap.NFCL0760.NFCL0760CMsg"/>
    <typeAlias alias="NFCL0760_ASMsg"  type="business.blap.NFCL0760.NFCL0760_ASMsg"/>

    <statement id="getHeaderData" parameterClass="Map" resultMap="result.getHeaderData">
    SELECT
         AWOR.LOW_RMNG_BAL_AMT
        ,AWOR.HIGH_RMNG_BAL_AMT
        ,AWOR.LOW_INV_NUM
        ,AWOR.HIGH_INV_NUM
        ,AWOR.LOW_INV_DUE_DT
        ,AWOR.HIGH_INV_DUE_DT
        ,AWOR.LOW_DS_ACCT_NUM
        ,AWOR.HIGH_DS_ACCT_NUM
        ,AWOR.LOW_RMNG_BAL_AMT
        ,AWOR.LOW_DS_ACCT_NUM
        ,AWOR.HIGH_DS_ACCT_NUM
        ,AWOR.INCL_CONSL_INV_FLG
        ,NVL(ADR.AR_ADJ_RSN_DESC_TXT, AWON.AR_WRT_OFF_NOTE_DESC_TXT) AS AR_ADJ_RSN_DESC_TXT
        ,AAT.AR_ADJ_TP_DESC_TXT
        ,AWOR.AR_WRT_OFF_NOTE_TXT
        ,IT.INV_TP_DESC_TXT
        ,AWOR.WRT_OFF_OPT_TP_CD
        ,AWOR.AR_DS_WF_STS_CD
        ,AWOR.AR_WRT_OFF_RQST_PK
    FROM
         AR_WRT_OFF_RQST    AWOR
        ,AR_ADJ_RSN         ADR
        ,AR_ADJ_TP          AAT
        ,INV_TP             IT
        ,AR_WRT_OFF_NOTE    AWON
    WHERE
            AWOR.GLBL_CMPY_CD       = #cMsg.glblCmpyCd#
        <!-- QC#24747 -->
        <!-- AND AWOR.AR_WRT_OFF_RQST_PK = #arWrtOffRqstPk_H# -->
        <isNotNull property="cMsg.arWrtOffRqstPk_H">
        AND AWOR.AR_WRT_OFF_RQST_PK = #cMsg.arWrtOffRqstPk_H#
        </isNotNull>
        <isNotNull property="cMsg.wrtOffRqstGrpCd_H">
        AND AWOR.WRT_OFF_RQST_GRP_CD = #cMsg.wrtOffRqstGrpCd_H#
        </isNotNull>
        <!-- QC#24747 -->
        AND AWOR.EZCANCELFLAG       = '0'
        AND AWOR.GLBL_CMPY_CD       = ADR.GLBL_CMPY_CD(+)
        AND AWOR.AR_ADJ_RSN_CD      = ADR.AR_ADJ_RSN_CD(+)
        AND ADR.EZCANCELFLAG(+)     = '0'
        AND AWOR.GLBL_CMPY_CD       = AAT.GLBL_CMPY_CD
        AND AWOR.AR_ADJ_TP_CD       = AAT.AR_ADJ_TP_CD
        AND AAT.EZCANCELFLAG        = '0'
        AND AWOR.GLBL_CMPY_CD       = IT.GLBL_CMPY_CD(+)
        AND AWOR.INV_TP_CD          = IT.INV_TP_CD(+)
        AND IT.EZCANCELFLAG(+)      = '0'
        AND AWOR.GLBL_CMPY_CD       = AWON.GLBL_CMPY_CD(+)
        AND AWOR.AR_WRT_OFF_NOTE_CD = AWON.AR_WRT_OFF_NOTE_CD(+)
        AND AWON.EZCANCELFLAG(+)    = '0'
        AND ROWNUM                  = 1
    </statement>
    <resultMap id="result.getHeaderData"      class="NFCL0760CMsg">
        <result property="lowRmngBalAmt_H"      column="LOW_RMNG_BAL_AMT"       javaType="EZDCBigDecimalItem"/>
        <result property="highRmngBalAmt_H"     column="HIGH_RMNG_BAL_AMT"      javaType="EZDCBigDecimalItem"/>
        <result property="lowInvNum_H"          column="LOW_INV_NUM"            javaType="EZDCStringItem"/>
        <result property="highInvNum_H"         column="HIGH_INV_NUM"           javaType="EZDCStringItem"/>
        <result property="lowInvDueDt_H"        column="LOW_INV_DUE_DT"         javaType="EZDCDateItem"/>
        <result property="highInvDueDt_H"       column="HIGH_INV_DUE_DT"        javaType="EZDCDateItem"/>
        <result property="lowDsAcctNum_H"       column="LOW_DS_ACCT_NUM"        javaType="EZDCStringItem"/>
        <result property="highDsAcctNum_H"      column="HIGH_DS_ACCT_NUM"       javaType="EZDCStringItem"/>
        <result property="inclConslInvFlg_H"    column="INCL_CONSL_INV_FLG"     javaType="EZDCStringItem"/>
        <result property="arAdjRsnDescTxt_H"    column="AR_ADJ_RSN_DESC_TXT"    javaType="EZDCStringItem"/>
        <result property="arAdjTpDescTxt_H"     column="AR_ADJ_TP_DESC_TXT"     javaType="EZDCStringItem"/>
        <result property="arWrtOffNoteTxt_H"    column="AR_WRT_OFF_NOTE_TXT"    javaType="EZDCStringItem"/>
        <result property="invTpDescTxt_H"       column="INV_TP_DESC_TXT"        javaType="EZDCStringItem"/>
        <result property="wrtOffOptTpCd_H"      column="WRT_OFF_OPT_TP_CD"      javaType="EZDCStringItem"/>
        <result property="arDsWfStsCd_H"        column="AR_DS_WF_STS_CD"        javaType="EZDCStringItem"/>
        <result property="arWrtOffRqstPk_H"     column="AR_WRT_OFF_RQST_PK"     javaType="EZDCBigDecimalItem"/>
    </resultMap>

    <statement id="getDetailData" parameterClass="Map" resultMap="result.getDetailData">
    SELECT
         ADJ_DT
        ,BILL_TO_CUST_ACCT_CD
        ,DS_ACCT_NM
        ,AR_TRX_NUM
        ,INV_TP_DESC_TXT
        ,DS_INV_TP_DESC_TXT
        ,DEAL_ORIG_GRS_AMT
        ,INV_DUE_DT
        ,DEAL_APPLY_ADJ_RSVD_AMT
        ,DEAL_RMNG_BAL_GRS_AMT
        ,AR_ADJ_NUM
        ,DEAL_AR_ADJ_AMT
        ,AR_DS_WF_STS_CD
        ,AR_DS_WF_STS_DESC_TXT
        ,WRT_OFF_ERR_MSG_TXT
    FROM
        (SELECT
             NVL(AA.ADJ_DT, SUBSTR(AWOR.EZINTIME,1,8)) AS ADJ_DT
            ,ATB.BILL_TO_CUST_ACCT_CD
            ,STC.DS_ACCT_NM
            ,ATB.AR_TRX_NUM
            ,ATT.AR_TRX_TP_DESC_TXT              AS INV_TP_DESC_TXT
            ,DIT.DS_INV_TP_DESC_TXT
            ,NVL(ATB.DEAL_ORIG_GRS_AMT, 0)       AS DEAL_ORIG_GRS_AMT
            ,ATB.INV_DUE_DT
            ,NVL(ATB.DEAL_APPLY_ADJ_RSVD_AMT, 0) AS DEAL_APPLY_ADJ_RSVD_AMT
            ,NVL(ATB.DEAL_RMNG_BAL_GRS_AMT, 0)   AS DEAL_RMNG_BAL_GRS_AMT
            ,AWORR.AR_ADJ_NUM
            ,NVL(AA.DEAL_AR_ADJ_AMT, 0)          AS DEAL_AR_ADJ_AMT
            ,AWOR.AR_DS_WF_STS_CD
            ,AWS.AR_DS_WF_STS_DESC_TXT
            ,AWORR.WRT_OFF_ERR_MSG_TXT
            ,AWOR.EZINTIME
        FROM
             AR_WRT_OFF_RQST        AWOR
            ,AR_WRT_OFF_RQST_RSLT   AWORR
            ,AR_TRX_BAL             ATB
            ,AR_ADJ                 AA
            ,SELL_TO_CUST           STC
            ,AR_TRX_TP              ATT
            ,DS_INV_TP              DIT
            ,AR_DS_WF_STS           AWS
        WHERE
                AWOR.GLBL_CMPY_CD               = #cMsg.glblCmpyCd#
            <isNull property="cMsg.wrtOffRqstGrpCd_H">
            AND AWOR.AR_WRT_OFF_RQST_PK         = #cMsg.arWrtOffRqstPk_H#
            </isNull>
            <isNotNull property="cMsg.wrtOffRqstGrpCd_H">
            AND AWOR.WRT_OFF_RQST_GRP_CD        = #cMsg.wrtOffRqstGrpCd_H#
            </isNotNull>
            AND AWOR.AR_WRT_OFF_RQST_TP_CD      = #arWrtOffRqstTpCdIsSystem#
            AND AWOR.EZCANCELFLAG               = '0'
            AND AWOR.GLBL_CMPY_CD               = AWORR.GLBL_CMPY_CD
            AND AWOR.AR_WRT_OFF_RQST_PK         = AWORR.AR_WRT_OFF_RQST_PK
            AND AWORR.EZCANCELFLAG              = '0'
            AND AWORR.GLBL_CMPY_CD              = ATB.GLBL_CMPY_CD
            AND AWORR.AR_TRX_BAL_PK             = ATB.AR_TRX_BAL_PK
            AND ATB.EZCANCELFLAG                = '0'
            AND AWORR.GLBL_CMPY_CD              = AA.GLBL_CMPY_CD(+)
            AND AWORR.AR_ADJ_NUM                = AA.AR_ADJ_NUM(+)
            AND AA.EZCANCELFLAG(+)              = '0'
            AND ATB.GLBL_CMPY_CD                = STC.GLBL_CMPY_CD
            AND ATB.BILL_TO_CUST_ACCT_CD        = STC.SELL_TO_CUST_CD
            AND STC.EZCANCELFLAG                = '0'
            AND ATB.GLBL_CMPY_CD                = ATT.GLBL_CMPY_CD
            AND ATB.AR_TRX_TP_CD                = ATT.AR_TRX_TP_CD
            AND ATT .EZCANCELFLAG               = '0'
            AND ATB.GLBL_CMPY_CD                = DIT.GLBL_CMPY_CD
            AND ATB.DS_INV_TP_CD                = DIT.DS_INV_TP_CD
            AND DIT.EZCANCELFLAG                = '0'
            AND AWOR.GLBL_CMPY_CD               = AWS.GLBL_CMPY_CD
            AND AWOR.AR_DS_WF_STS_CD            = AWS.AR_DS_WF_STS_CD
            AND AWS.EZCANCELFLAG                = '0'
            <isNotNull property="cMsg.xxFromDt_P">
            AND NVL(AA.ADJ_DT, SUBSTR(AWOR.EZINTIME,1,8)) &gt;= #cMsg.xxFromDt_P#
            </isNotNull>
            <isNotNull property="cMsg.xxThruDt_P">
            AND NVL(AA.ADJ_DT, SUBSTR(AWOR.EZINTIME,1,8)) &lt;= #cMsg.xxThruDt_P#
            </isNotNull>
        UNION ALL
        SELECT
             NVL(AA.ADJ_DT, SUBSTR(AWOR.EZINTIME,1,8)) AS ADJ_DT
            ,ATB.BILL_TO_CUST_ACCT_CD
            ,STC.DS_ACCT_NM
            ,ATB.AR_TRX_NUM
            ,ATT.AR_TRX_TP_DESC_TXT              AS INV_TP_DESC_TXT
            ,DIT.DS_INV_TP_DESC_TXT
            ,NVL(ATB.DEAL_ORIG_GRS_AMT, 0)       AS DEAL_ORIG_GRS_AMT
            ,ATB.INV_DUE_DT
            ,NVL(ATB.DEAL_APPLY_ADJ_RSVD_AMT, 0) AS DEAL_APPLY_ADJ_RSVD_AMT
            ,NVL(ATB.DEAL_RMNG_BAL_GRS_AMT, 0)   AS DEAL_RMNG_BAL_GRS_AMT
            ,AWORR.AR_ADJ_NUM
            ,NVL(AA.DEAL_AR_ADJ_AMT, 0)          AS DEAL_AR_ADJ_AMT
            ,NVL(AWOR.AR_DS_WF_STS_CD, AWORR.PROC_STS_CD)            AS AR_DS_WF_STS_CD
            ,NVL(AS_D.AR_DS_WF_STS_DESC_TXT, PS_H.PROC_STS_DESC_TXT) AS AR_DS_WF_STS_DESC_TXT
            ,AWORR.WRT_OFF_ERR_MSG_TXT
            ,AWOR.EZINTIME
        FROM
             AR_WRT_OFF_RQST        AWOR
            ,AR_WRT_OFF_RQST_DTL    AWORD
            ,AR_WRT_OFF_RQST_RSLT   AWORR
            ,AR_TRX_BAL             ATB
            ,AR_ADJ                 AA
            ,SELL_TO_CUST           STC
            ,AR_TRX_TP              ATT
            ,DS_INV_TP              DIT
            ,PROC_STS               PS_H
            ,AR_DS_WF_STS           AS_D
        WHERE
                AWOR.GLBL_CMPY_CD               = #cMsg.glblCmpyCd#
            <isNull property="cMsg.wrtOffRqstGrpCd_H">
            AND AWOR.AR_WRT_OFF_RQST_PK         = #cMsg.arWrtOffRqstPk_H#
            </isNull>
            <isNotNull property="cMsg.wrtOffRqstGrpCd_H">
            AND AWOR.WRT_OFF_RQST_GRP_CD        = #cMsg.wrtOffRqstGrpCd_H#
            </isNotNull>
            AND AWOR.AR_WRT_OFF_RQST_TP_CD      &lt;&gt; #arWrtOffRqstTpCdIsSystem#
            AND AWOR.EZCANCELFLAG               = '0'
            AND AWOR.GLBL_CMPY_CD               = AWORD.GLBL_CMPY_CD
            AND AWOR.AR_WRT_OFF_RQST_PK         = AWORD.AR_WRT_OFF_RQST_PK
            AND AWORD.EZCANCELFLAG              = '0'
            AND AWORD.GLBL_CMPY_CD              = AWORR.GLBL_CMPY_CD(+)
            AND AWORD.AR_WRT_OFF_RQST_PK        = AWORR.AR_WRT_OFF_RQST_PK(+)
            AND AWORD.AR_TRX_BAL_PK             = AWORR.AR_TRX_BAL_PK(+)
            AND AWORR.EZCANCELFLAG(+)           = '0'
            AND AWORD.GLBL_CMPY_CD              = ATB.GLBL_CMPY_CD
            AND AWORD.AR_TRX_BAL_PK             = ATB.AR_TRX_BAL_PK
            AND ATB.EZCANCELFLAG                = '0'
            AND AWORR.GLBL_CMPY_CD              = AA.GLBL_CMPY_CD(+)
            AND AWORR.AR_ADJ_NUM                = AA.AR_ADJ_NUM(+)
            AND AA.EZCANCELFLAG(+)              = '0'
            AND ATB.GLBL_CMPY_CD                = STC.GLBL_CMPY_CD
            AND ATB.BILL_TO_CUST_ACCT_CD        = STC.SELL_TO_CUST_CD
            AND STC.EZCANCELFLAG                = '0'
            AND ATB.GLBL_CMPY_CD                = ATT.GLBL_CMPY_CD
            AND ATB.AR_TRX_TP_CD                = ATT.AR_TRX_TP_CD
            AND ATT.EZCANCELFLAG                = '0'
            AND ATB.GLBL_CMPY_CD                = DIT.GLBL_CMPY_CD
            AND ATB.DS_INV_TP_CD                = DIT.DS_INV_TP_CD
            AND DIT.EZCANCELFLAG                = '0'
            AND AWORR.GLBL_CMPY_CD              = PS_H.GLBL_CMPY_CD(+)
            AND AWORR.PROC_STS_CD               = PS_H.PROC_STS_CD(+)
            AND PS_H.EZCANCELFLAG(+)            = '0'
            AND AWOR.GLBL_CMPY_CD               = AS_D.GLBL_CMPY_CD(+)
            AND AWOR.AR_DS_WF_STS_CD            = AS_D.AR_DS_WF_STS_CD(+)
            AND AS_D.EZCANCELFLAG(+)            = '0'
            <isNotNull property="cMsg.xxFromDt_P">
            AND NVL(AA.ADJ_DT, SUBSTR(AWOR.EZINTIME,1,8)) &gt;= #cMsg.xxFromDt_P#
            </isNotNull>
            <isNotNull property="cMsg.xxThruDt_P">
            AND NVL(AA.ADJ_DT, SUBSTR(AWOR.EZINTIME,1,8)) &lt;= #cMsg.xxThruDt_P#
            </isNotNull>
        ORDER BY
            EZINTIME DESC
        )
    WHERE
            ROWNUM                  &lt;= #limitCnt#
    </statement>

    <resultMap id="result.getDetailData"      class="NFCL0760_ASMsg">
         <result property="adjDt_A"               column="ADJ_DT"                   javaType="EZDSDateItem"/>
         <result property="billToCustAcctCd_A"    column="BILL_TO_CUST_ACCT_CD"     javaType="EZDSStringItem"/>
         <result property="dsAcctNm_A"            column="DS_ACCT_NM"               javaType="EZDSStringItem"/>
         <result property="arTrxNum_A"            column="AR_TRX_NUM"               javaType="EZDSStringItem"/>
         <result property="invTpDescTxt_A"        column="INV_TP_DESC_TXT"          javaType="EZDSStringItem"/>
         <result property="dsInvTpDescTxt_A"      column="DS_INV_TP_DESC_TXT"       javaType="EZDSStringItem"/>
         <result property="dealOrigGrsAmt_A"      column="DEAL_ORIG_GRS_AMT"        javaType="EZDSBigDecimalItem"/>
         <result property="invDueDt_A"            column="INV_DUE_DT"               javaType="EZDSDateItem"/>
         <result property="dealApplyAdjRsvdAmt_A" column="DEAL_APPLY_ADJ_RSVD_AMT"  javaType="EZDSBigDecimalItem"/>
         <result property="dealRmngBalGrsAmt_A"   column="DEAL_RMNG_BAL_GRS_AMT"    javaType="EZDSBigDecimalItem"/>
         <result property="arAdjNum_A"            column="AR_ADJ_NUM"               javaType="EZDSStringItem"/>
         <result property="dealArAdjAmt_A"        column="DEAL_AR_ADJ_AMT"          javaType="EZDSBigDecimalItem"/>
         <result property="arDsWfStsCd_A"         column="AR_DS_WF_STS_CD"          javaType="EZDSStringItem"/>
         <result property="arDsWfStsDescTxt_A"    column="AR_DS_WF_STS_DESC_TXT"    javaType="EZDSStringItem"/>
         <result property="wrtOffErrMsgTxt_A"     column="WRT_OFF_ERR_MSG_TXT"      javaType="EZDSStringItem"/>
    </resultMap>
</sqlMap>
