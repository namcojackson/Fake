<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL1400Query">
    <typeAlias alias="NSAL1400_ASMsg" type="business.blap.NSAL1400.NSAL1400_ASMsg" />

    <statement id="getSvcLineBizTp" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
             A.SVC_LINE_BIZ_CD
            ,B.LINE_BIZ_TP_DESC_TXT
            ,B.LINE_BIZ_TP_SORT_NUM
        FROM
             SVC_LINE_BIZ_RELN A
            ,LINE_BIZ_TP       B
        WHERE
            A.GLBL_CMPY_CD    = #glblCmpyCd#
        AND A.EZCANCELFLAG    = '0'
        AND A.GLBL_CMPY_CD    = B.GLBL_CMPY_CD
        AND A.SVC_LINE_BIZ_CD = B.LINE_BIZ_TP_CD
        AND B.EZCANCELFLAG    = '0'
        ORDER BY
            B.LINE_BIZ_TP_SORT_NUM
    </statement>

    <statement id="search" parameterClass="Map" resultMap="result.search">
        SELECT
             RST.ACCT_CONTR_ADMIN_RELN_PK
            ,RST.EZUPTIME
            ,RST.EZUPTIMEZONE
            ,RST.SVC_LINE_BIZ_CD
            ,RST.DS_ACCT_NUM
            ,RST.DS_ACCT_NM
            ,RST.CONTR_ADMIN_PSN_CD
            ,RST.XX_CUST_PSN_NM
            ,RST.ACTV_FLG
            ,RST.EFF_FROM_DT
            ,RST.EFF_THRU_DT
        FROM (
            SELECT
                 A.ACCT_CONTR_ADMIN_RELN_PK AS ACCT_CONTR_ADMIN_RELN_PK
                ,A.EZUPTIME                 AS EZUPTIME
                ,A.EZUPTIMEZONE             AS EZUPTIMEZONE
                ,A.SVC_LINE_BIZ_CD          AS SVC_LINE_BIZ_CD
                ,A.DS_ACCT_NUM              AS DS_ACCT_NUM
                ,B.DS_ACCT_NM               AS DS_ACCT_NM
                ,A.CONTR_ADMIN_PSN_CD       AS CONTR_ADMIN_PSN_CD
                ,NVL(C.PSN_FIRST_NM, '')
                    || DECODE(C.PSN_MID_NM,  NULL, '', ' ' || C.PSN_MID_NM)
                    || DECODE(C.PSN_LAST_NM, NULL, '', ' ' || C.PSN_LAST_NM)
                    AS XX_CUST_PSN_NM
                ,A.ACTV_FLG
                ,A.EFF_FROM_DT
                ,A.EFF_THRU_DT
            FROM
                 ACCT_CONTR_ADMIN_RELN A
                ,SELL_TO_CUST          B
                ,S21_PSN               C
            WHERE
            
                A.GLBL_CMPY_CD                   =  #glblCmpyCd#
            AND A.EZCANCELFLAG                   =  '0'
            <isNotNull property="svcLineBizCd">
            AND A.SVC_LINE_BIZ_CD                =  #svcLineBizCd#
            </isNotNull>
            <isNotNull property="actvFlg">
            AND A.ACTV_FLG                       =  #actvFlg#
            AND A.EFF_FROM_DT                    &lt;= #slsDt#
            AND NVL(A.EFF_THRU_DT, #slsDt#)      &gt;= #slsDt#
            </isNotNull>
            AND A.GLBL_CMPY_CD                   =  B.GLBL_CMPY_CD     (+)
            AND A.DS_ACCT_NUM                    =  B.SELL_TO_CUST_CD  (+)
            AND B.EZCANCELFLAG               (+) =  '0'
            AND B.RGTN_STS_CD                (+) = #rgtnStsCd#
            AND B.EFF_FROM_DT                (+) &lt;= #slsDt#
            AND NVL(B.EFF_THRU_DT(+), #slsDt#)   &gt;= #slsDt#
            <isNotNull property="dsAcctNm">
            AND B.DS_ACCT_NM                     LIKE #dsAcctNm#
            </isNotNull>
            AND A.GLBL_CMPY_CD                   = C.GLBL_CMPY_CD      (+)
            AND A.CONTR_ADMIN_PSN_CD             = C.PSN_CD            (+)
            AND C.EZCANCELFLAG               (+) = '0'
            ORDER BY
                 A.SVC_LINE_BIZ_CD
                ,A.DS_ACCT_NUM
                ,A.EFF_FROM_DT
                ,A.CONTR_ADMIN_PSN_CD
            ) RST
        WHERE
            ROWNUM &lt;= #count# + 1
    </statement>

    <resultMap id="result.search" class="NSAL1400_ASMsg">
        <result property="ezUpTime_A"               column="EZUPTIME"                    javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_A"           column="EZUPTIMEZONE"                javaType="EZDSStringItem"/>
        <result property="acctContrAdminRelnPk_A"   column="ACCT_CONTR_ADMIN_RELN_PK"    javaType="EZDSBigDecimalItem"/>
        <result property="svcLineBizCd_A"           column="SVC_LINE_BIZ_CD"             javaType="EZDSStringItem"/>
        <result property="dsAcctNum_A"              column="DS_ACCT_NUM"                 javaType="EZDSStringItem"/>
        <result property="dsAcctNm_A"               column="DS_ACCT_NM"                  javaType="EZDSStringItem"/>
        <result property="contrAdminPsnCd_A"        column="CONTR_ADMIN_PSN_CD"          javaType="EZDSStringItem"/>
        <result property="xxCustPsnNm_A"            column="XX_CUST_PSN_NM"              javaType="EZDSStringItem"/>
        <result property="xxChkBox_A2"              column="ACTV_FLG"                    javaType="EZDSStringItem"/>
        <result property="effFromDt_A"              column="EFF_FROM_DT"                 javaType="EZDSDateItem"/>
        <result property="effThruDt_A"              column="EFF_THRU_DT"                 javaType="EZDSDateItem"/>
    </resultMap>

    <statement id="countCustomer" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS CNT
        FROM
            SELL_TO_CUST A
        WHERE
            A.GLBL_CMPY_CD                  =  #glblCmpyCd#
        AND A.EZCANCELFLAG                  =  '0'
        AND A.SELL_TO_CUST_CD               =  #sellToCustCd#
        AND A.RGTN_STS_CD                   =  #rgtnStsCd#
        AND A.EFF_FROM_DT                   &lt;= #slsDt#
        AND NVL(A.EFF_THRU_DT, #slsDt#)  &gt;= #slsDt#
    </statement>

    <statement id="countResource" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS CNT
        FROM
             SVC_RG             A
            ,SVC_RG_BR_RELN     B
            ,SVC_BR_RESRC_RELN  C
            ,S21_PSN            D
        WHERE
                A.GLBL_CMPY_CD                       =  #glblCmpyCd#
            AND A.EZCANCELFLAG                       =  '0'
            AND A.SVC_LINE_BIZ_CD                    =  #svcLineBizCd#
            AND A.SVC_RG_ACTV_FLG                    =  'Y'
            AND A.EFF_FROM_DT                        &lt;= #slsDt#
            AND NVL(A.EFF_THRU_DT, #slsDt#)       &gt;= #slsDt#
            AND A.GLBL_CMPY_CD                       =  B.GLBL_CMPY_CD
            AND A.SVC_RG_PK                          =  B.SVC_RG_PK
            AND B.EZCANCELFLAG                       =  '0'
            AND B.GLBL_CMPY_CD                       =  C.GLBL_CMPY_CD
            AND B.SVC_CONTR_BR_CD                    =  C.SVC_CONTR_BR_CD
            AND C.EZCANCELFLAG                       =  '0'
            AND C.SVC_BR_RESRC_ACTV_FLG              =  'Y'
            AND C.EFF_FROM_DT                        &lt;= #slsDt#
            AND NVL(C.EFF_THRU_DT, #slsDt#)       &gt;= #slsDt#
            AND C.GLBL_CMPY_CD                       =  D.GLBL_CMPY_CD
            AND C.PSN_CD                             =  D.PSN_CD
            AND D.EZCANCELFLAG                       =  '0'
            AND D.DEL_FLG                            =  'N'
            AND D.EFF_FROM_DT                        &lt;= #slsDt#
            AND NVL(D.EFF_THRU_DT, #slsDt#)       &gt;= #slsDt#
            AND D.PSN_CD                             =  #contrAdminPsnCd#
    </statement>

    <statement id="countDuplicatePeriod" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS CNT
        FROM
            ACCT_CONTR_ADMIN_RELN A
        WHERE
            A.GLBL_CMPY_CD                 =  #glblCmpyCd#
        AND A.DS_ACCT_NUM                  =  #dsAcctNum#
        AND A.SVC_LINE_BIZ_CD              =  #svcLineBizCd#
        AND A.ACTV_FLG                     =  'Y'
        AND NVL(A.EFF_THRU_DT, #slsDt#) &gt;= #effFromDt#
        AND A.EFF_FROM_DT                  &lt;= #effThruDt#
        AND A.EZCANCELFLAG                 =  '0'
        <isNotNull property="acctContrAdminRelnPk">
        AND A.ACCT_CONTR_ADMIN_RELN_PK     &lt;&gt; #acctContrAdminRelnPk#
        </isNotNull>
    </statement>
</sqlMap>
