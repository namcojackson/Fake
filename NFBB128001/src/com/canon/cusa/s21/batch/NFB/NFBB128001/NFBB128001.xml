<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NFBB128001">

    <statement id="getLeaseBuyoutLine" parameterClass="Map" resultClass="Map">
        SELECT
             ALBWR.GLBL_CMPY_CD
            ,ALBWR.CPO_ORD_NUM
            ,ALBWR.CPO_DTL_LINE_NUM
            ,ALBWR.INV_NUM
            ,ALBWR.INV_BOL_NUM
            ,ALBWR.INV_LINE_NUM
            ,ALBWR.INV_LINE_SUB_NUM
            ,ALBWR.INV_LINE_SUB_TRX_NUM
            ,NVL(ALBWR.AP_INV_AMT,0)     AP_INV_AMT
            ,V.SPLY_COA_CMPY_CD
            ,V.SPLY_COA_BR_CD
            ,V.SPLY_COA_CC_CD
            ,V.SPLY_COA_ACCT_CD
            ,V.SPLY_COA_PROD_CD
            ,V.SPLY_COA_CH_CD
            ,V.SPLY_COA_AFFL_CD
            ,V.SPLY_COA_PROJ_CD
            ,V.SPLY_COA_EXTN_CD
            <!-- start 2018/03/22 QC#20316 ADD -->
            ,LPAD(TO_CHAR(ROW_NUMBER() OVER (PARTITION BY ALBWR.AP_INV_NUM ORDER BY ALBWR.AP_INV_NUM, ALBWR.INV_BOL_NUM, ALBWR.INV_LINE_NUM)), 4, '0')
                                         AP_VND_INV_LINE_NUM
            <!-- end 2018/03/22 QC#20316 ADD -->
            <!-- start 2016/11/14 QC#15785 ADD -->
            ,LPAD(TO_CHAR(ROW_NUMBER() OVER (PARTITION BY ALBWR.AP_INV_NUM ORDER BY ALBWR.AP_INV_NUM, ALBWR.INV_BOL_NUM, ALBWR.INV_LINE_NUM)), 3, '0')
                                         CM_INV_ACCT_DIST_LINE_NUM
            <!-- end 2016/11/14 QC#15785 ADD -->
            ,CD.CCY_CD
            ,PV.VND_PMT_TERM_CD
        FROM
             AP_LSE_BO_WF_RQST ALBWR
            ,VND               V
            ,CPO_DTL           CD
            ,PRNT_VND          PV
        WHERE
                ALBWR.GLBL_CMPY_CD    = #glblCmpyCd#
            AND ALBWR.AP_DS_WF_STS_CD = #apDsWfStsCd#
            AND ALBWR.GLBL_CMPY_CD    = V.GLBL_CMPY_CD
            AND ALBWR.VND_PK          = V.VND_PK
            AND V.GLBL_CMPY_CD        = PV.GLBL_CMPY_CD(+)
            AND V.PRNT_VND_PK         = PV.PRNT_VND_PK(+)
            AND ALBWR.GLBL_CMPY_CD    = CD.GLBL_CMPY_CD(+)
            AND ALBWR.CPO_ORD_NUM     = CD.CPO_ORD_NUM(+)
            AND ALBWR.CPO_DTL_LINE_NUM = CD.CPO_DTL_LINE_NUM(+)
            AND ALBWR.EZCANCELFLAG    = '0'
            AND V.EZCANCELFLAG        = '0'
            AND PV.EZCANCELFLAG(+)    = '0'
            AND CD.EZCANCELFLAG(+)    = '0'
        ORDER BY
             ALBWR.GLBL_CMPY_CD
            ,ALBWR.CPO_ORD_NUM
            ,ALBWR.CPO_ORD_TP_CD
            ,ALBWR.CPO_DTL_LINE_NUM
            ,ALBWR.CPO_ORD_TS
            ,ALBWR.DS_ORD_LINE_CATG_CD
            ,ALBWR.APVL_TP_TXT
    </statement>

    <statement id="getPrntVndCd" parameterClass="Map" resultClass="Map">
        SELECT
            V.GLBL_CMPY_CD
        ,   V.INV_VND_CD
        ,   MAX(PV.PRNT_VND_CD)           PRNT_VND_CD
        FROM
            PRNT_VND PV
        ,   VND      V
        WHERE
            PV.GLBL_CMPY_CD   = #glblCmpyCd#
        AND PV.GLBL_CMPY_CD   = V.GLBL_CMPY_CD
        AND PV.PRNT_VND_PK    = V.PRNT_VND_PK
        AND V.INV_VND_CD      = #invVndCd#
        AND PV.EZCANCELFLAG   = '0'
        AND V.EZCANCELFLAG    = '0'
        GROUP BY
            V.GLBL_CMPY_CD
        ,   V.INV_VND_CD
    </statement>

</sqlMap>
