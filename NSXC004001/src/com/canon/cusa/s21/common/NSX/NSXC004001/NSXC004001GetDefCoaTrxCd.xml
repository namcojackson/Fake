<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSXC004001GetDefCoaTrxCd">
    <statement id="getMdlId" parameterClass="Map" resultClass="String">
        SELECT
            B.MDL_ID
        FROM
             SVC_MACH_MSTR      A
            ,SVC_CONFIG_MSTR    B
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.SVC_MACH_MSTR_PK      = #svcMachMstrPk#
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.SVC_CONFIG_MSTR_PK    = B.SVC_CONFIG_MSTR_PK
            AND B.EZCANCELFLAG          = '0'
    </statement>
    <statement id="getAllocInfo" parameterClass="Map" resultClass="Map">
        SELECT
             B.EQUIP_ALLOC_PCT
            ,B.SVC_ALLOC_PCT
            ,B.SPLY_ALLOC_PCT
            ,B.SVC_COA_CC_CD
            ,B.SPLY_COA_CC_CD
            <!--start 2017/09/22 mod QC#17116-->
            <!--
            ,B.SPLY_LFS_COA_CC_CD
            ,B.SPLY_PPS_COA_CC_CD
            ,B.SPLY_ESS_COA_CC_CD
            -->
            ,C.CM_COA_CC_CD AS SPLY_LFS_COA_CC_CD
            ,C.CM_COA_CC_CD AS SPLY_PPS_COA_CC_CD
            ,C.CM_COA_CC_CD AS SPLY_ESS_COA_CC_CD
            <!--end 2017/09/22 mod QC#17116-->
            ,B.EQUIP_COA_ACCT_CD
            <!--start 2017/09/22 mod QC#17116-->
            <!--
            ,B.SVC_COA_ACCT_CD
            ,B.SPLY_COA_ACCT_CD
            -->
            ,C.CM_COA_ACCT_CD AS SVC_COA_ACCT_CD
            ,C.CM_COA_ACCT_CD AS SPLY_COA_ACCT_CD
            <!--end 2017/09/22 mod QC#17116-->
            ,B.EQUIP_TRX_CD
            ,B.EQUIP_TRX_RSN_CD
            ,B.SVC_TRX_CD
            ,B.SVC_TRX_RSN_CD
            ,B.SPLY_TRX_CD
            ,B.SPLY_TRX_RSN_CD
            ,B.EQUIP_ACCTG_RULE_CD
            ,B.SVC_ACCTG_RULE_CD
            ,B.SPLY_ACCTG_RULE_CD
            ,B.AJE_INV_LINE_ALLOC_CD
        FROM
             MDSE               A
            ,AJE_INV_LINE_ALLOC B
            ,CM_DEF_ACCT        C <!-- 2017/09/22 add QC#17116-->
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.MDSE_CD               = #mdseCd#
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.SVC_ALLOC_TP_CD       = B.SVC_ALLOC_TP_CD
            AND B.EZCANCELFLAG          = '0'
            AND B.SVC_INV_CHRG_TP_CD    = #svcInvChrgTpCd#
            <isNull property="mdlId">
            AND B.MDL_ID                IS NULL
            </isNull>
            <isNotNull property="mdlId">
            AND B.MDL_ID                = #mdlId#
            </isNotNull>
            <isEqual property="paramAddlChrgFlg" compareValue="Y">
            AND B.ADDL_CHRG_FLG         = #addlChrgFlg#
            </isEqual>
            <!--start 2017/09/22 add QC#17116-->
            AND A.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND C.EZCANCELFLAG          = '0'
            AND C.CM_DEF_ACCT_CD        = #defAcctCd#
            <!--end 2017/09/22 add QC#17116-->
    </statement>
    <statement id="getAllocInfoForAddl" parameterClass="Map" resultClass="Map">
        SELECT
             A.EQUIP_ALLOC_PCT
            ,A.SVC_ALLOC_PCT
            ,A.SPLY_ALLOC_PCT
            ,A.SVC_COA_CC_CD
            ,A.SPLY_COA_CC_CD
            <!--start 2017/09/22 mod QC#17116-->
            <!--
            ,A.SPLY_LFS_COA_CC_CD
            ,A.SPLY_PPS_COA_CC_CD
            ,A.SPLY_ESS_COA_CC_CD
            -->
            ,B.CM_COA_CC_CD AS SPLY_LFS_COA_CC_CD
            ,B.CM_COA_CC_CD AS SPLY_PPS_COA_CC_CD
            ,B.CM_COA_CC_CD AS SPLY_ESS_COA_CC_CD
            <!--end 2017/09/22 mod QC#17116-->
            ,A.EQUIP_COA_ACCT_CD
            <!--start 2017/09/22 mod QC#17116-->
            <!--
            ,A.SVC_COA_ACCT_CD
            ,A.SPLY_COA_ACCT_CD
            -->
            ,B.CM_COA_ACCT_CD AS SVC_COA_ACCT_CD
            ,B.CM_COA_ACCT_CD AS SPLY_COA_ACCT_CD
            <!--end 2017/09/22 mod QC#17116-->
            ,A.EQUIP_TRX_CD
            ,A.EQUIP_TRX_RSN_CD
            ,A.SVC_TRX_CD
            ,A.SVC_TRX_RSN_CD
            ,A.SPLY_TRX_CD
            ,A.SPLY_TRX_RSN_CD
            ,(
                SELECT
                    C.DFRD_ACCTG_RULE_CD
                FROM
                     MDSE               B
                    ,DFRD_ACCTG_RULE    C
                WHERE
                        B.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND B.MDSE_CD               = #mdseCd#
                    AND B.EZCANCELFLAG          = '0'
                    AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
                    AND B.DFRD_ACCTG_RULE_CD    = C.DFRD_ACCTG_RULE_CD
                    AND C.EZCANCELFLAG          = '0'
            ) AS DFRD_ACCTG_RULE_CD
            ,(
                SELECT
                    C.DFRD_ACCTG_RULE_DURN_AOT
                FROM
                     MDSE               B
                    ,DFRD_ACCTG_RULE    C
                WHERE
                        B.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND B.MDSE_CD               = #mdseCd#
                    AND B.EZCANCELFLAG          = '0'
                    AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
                    AND B.DFRD_ACCTG_RULE_CD    = C.DFRD_ACCTG_RULE_CD
                    AND C.EZCANCELFLAG          = '0'
            ) AS DFRD_ACCTG_RULE_DURN_AOT
            ,A.AJE_INV_LINE_ALLOC_CD
        FROM
            AJE_INV_LINE_ALLOC A
            ,CM_DEF_ACCT       B <!-- 2017/09/22 add QC#17116-->
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.SVC_INV_CHRG_TP_CD    = #svcInvChrgTpCd#
            AND A.ADDL_CHRG_FLG         = 'Y'
            <!--start 2017/09/22 add QC#17116-->
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND B.EZCANCELFLAG          = '0'
            AND B.CM_DEF_ACCT_CD        = #defAcctCd#
            <!--end 2017/09/22 add QC#17116-->
    </statement>
    <statement id="getAjeInvLineAllocCdForAddl" parameterClass="Map" resultClass="String">
        SELECT
             A.AJE_INV_LINE_ALLOC_CD
        FROM
            AJE_INV_LINE_ALLOC A
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.SVC_INV_CHRG_TP_CD    = #svcInvChrgTpCd#
            AND A.ADDL_CHRG_FLG         = 'Y'
    </statement>
    <statement id="getContrInfo" parameterClass="Map" resultClass="Map">
        SELECT
             B.TOC_CD
            ,C.FLEET_LINE_FLG
            ,B.SVC_LINE_BIZ_CD
        FROM
             DS_CONTR_DTL       A
            ,DS_CONTR           B
            ,DS_CONTR_DTL_TP    C
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.DS_CONTR_DTL_PK       = #dsContrDtlPk#
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK           = B.DS_CONTR_PK
            AND B.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_TP_CD    = C.DS_CONTR_DTL_TP_CD
            AND C.EZCANCELFLAG          = '0'
    </statement>
    <statement id="getRegContrCnt" parameterClass="Map" resultClass="Map">
        SELECT
            COUNT(*)
        FROM
             DS_CONTR_DTL       A
            ,DS_CONTR           B
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.DS_CONTR_DTL_PK       = #dsContrDtlPk#
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK           = B.DS_CONTR_PK
            AND B.DS_CONTR_CATG_CD      = #dsContrCatgCd#
            AND B.EZCANCELFLAG          = '0'
    </statement>
    <statement id="getAggMachContrCnt" parameterClass="Map" resultClass="Map">
        SELECT
            COUNT(*)
        FROM
             DS_CONTR_DTL       A
            ,DS_CONTR           B
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.SVC_MACH_MSTR_PK      IS NOT NULL
            AND A.DS_CONTR_DTL_PK       = #dsContrDtlPk#
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK           = B.DS_CONTR_PK
            AND B.DS_CONTR_CATG_CD      = #dsContrCatgCd#
            AND B.EZCANCELFLAG          = '0'
    </statement>
    <statement id="getFleetBrCd" parameterClass="Map" resultClass="String">
        SELECT
             B.SVC_BR_CD
        FROM
             SHIP_TO_CUST       A
            ,SVC_BR_POST_XREF   B
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.SHIP_TO_CUST_CD   = #shipToCustCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.POST_CD           = B.POST_CD
            AND B.EZCANCELFLAG      = '0'
    </statement>
<!-- START 2016/08/24 T.Tomita [QC#10787, ADD] -->
    <statement id="getCoaAfflCdAndCoaChCd" parameterClass="Map" resultClass="Map">
        SELECT
             C.COA_AFFL_CD                 AS COA_AFFL_CD
            ,NVL(A.COA_CH_CD, C.COA_CH_CD) AS COA_CH_CD
        FROM
             BILL_TO_CUST    A
            ,SELL_TO_CUST    C
        WHERE
                A.GLBL_CMPY_CD    = #glblCmpyCd#
            AND A.BILL_TO_CUST_CD = #billToCustCd#
            AND A.EZCANCELFLAG    = '0'
            AND A.GLBL_CMPY_CD    = C.GLBL_CMPY_CD
            AND A.SELL_TO_CUST_CD = C.SELL_TO_CUST_CD
            AND C.EZCANCELFLAG    = '0'
    </statement>
<!-- END 2016/08/24 T.Tomita [QC#10787, ADD] -->
</sqlMap>
