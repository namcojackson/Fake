<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSAL1020Query">
    <typeAlias alias="NSAL1020_ACMsg"  type="business.blap.NSAL1020.NSAL1020_ACMsg"/>
    <statement id="getSearchData" parameterClass="Map" resultMap="result.getSearchData">
        SELECT
             SVC_CONFIG_MSTR_PK
            ,SVC_MACH_MSTR_PK
            ,DS_CONTR_DTL_PK
            ,SER_NUM
            ,T_MDL_NM
            ,XX_RSLT_FLG
            ,DS_CONTR_NUM
            ,DS_ACCT_NM
            ,FIRST_LINE_ADDR
            ,SCD_LINE_ADDR
            ,THIRD_LINE_ADDR
            ,FRTH_LINE_ADDR
            ,CTY_ADDR
            ,ST_CD
            ,POST_CD
            ,SVC_PGM_MDSE_CD
            ,SVC_BY_LINE_BIZ_TP_CD
<!-- START 2019/07/30 T.Kanasaka [QC#51976, ADD] -->
            ,SLD_BY_LINE_BIZ_TP_CD
<!-- END   2019/07/30 T.Kanasaka [QC#51976, ADD] -->
            ,SHIP_TO_CUST_CD
<!-- START 2017/09/26 K.Kim [QC#18744, ADD] -->
            ,SPLY_INCL_FLG
<!-- END 2017/09/26 K.Kim [QC#18744, ADD] -->
        FROM
            (
                SELECT
                     SCM.SVC_CONFIG_MSTR_PK    AS SVC_CONFIG_MSTR_PK
                    ,SMM.SVC_MACH_MSTR_PK      AS SVC_MACH_MSTR_PK
                    ,DCD.DS_CONTR_DTL_PK       AS DS_CONTR_DTL_PK
                    ,SMM.SER_NUM               AS SER_NUM
                    ,MNM.T_MDL_NM              AS T_MDL_NM
                    ,'Y'                       AS XX_RSLT_FLG
                    ,DCH.DS_CONTR_NUM          AS DS_CONTR_NUM
                    ,SEL.DS_ACCT_NM            AS DS_ACCT_NM
                    ,STC.FIRST_LINE_ADDR       AS FIRST_LINE_ADDR
                    ,STC.SCD_LINE_ADDR         AS SCD_LINE_ADDR
                    ,STC.THIRD_LINE_ADDR       AS THIRD_LINE_ADDR
                    ,STC.FRTH_LINE_ADDR        AS FRTH_LINE_ADDR
                    ,STC.CTY_ADDR              AS CTY_ADDR
                    ,STC.ST_CD                 AS ST_CD
                    ,STC.POST_CD               AS POST_CD
                    ,DCD.SVC_PGM_MDSE_CD       AS SVC_PGM_MDSE_CD
<!-- START 2016/03/11 [QC5211, MOD] -->
                    ,NVL(SMM.SVC_BY_LINE_BIZ_TP_CD, DCH.SVC_LINE_BIZ_CD)
                                               AS SVC_BY_LINE_BIZ_TP_CD
<!-- END 2016/03/11 [QC5211, MOD] -->
<!-- START 2019/07/30 T.Kanasaka [QC#51976, ADD] -->
                    ,SMM.SLD_BY_LINE_BIZ_TP_CD AS SLD_BY_LINE_BIZ_TP_CD
<!-- END   2019/07/30 T.Kanasaka [QC#51976, ADD] -->
                    ,SMM.SHIP_TO_CUST_CD       AS SHIP_TO_CUST_CD
<!-- START 2017/09/26 K.Kim [QC#18744, ADD] -->
                    ,DSC.SPLY_INCL_FLG         AS SPLY_INCL_FLG
<!-- END 2017/09/26 K.Kim [QC#18744, ADD] -->
                FROM
                     SVC_MACH_MSTR      SMM
                    ,DS_CONTR_DTL       DCD
                    ,DS_CONTR_DTL_STS_V DSV
                    ,SVC_CONFIG_MSTR    SCM
                    ,MDL_NM             MNM
                    ,MDSE               MDS
                    ,SHIP_TO_CUST       STC
                    ,DS_CONTR           DCH
                    ,SELL_TO_CUST       SEL
<!-- START 2017/09/26 K.Kim [QC#18744, ADD] -->
                    ,DS_SUB_CONTR       DSC
<!-- END 2017/09/26 K.Kim [QC#18744, ADD] -->
                WHERE
                        SMM.GLBL_CMPY_CD           = #glblCmpyCd#
<!-- START 2018/10/23 [QC#28721, DEL] -->
                    <!-- AND SMM.OWNR_ACCT_NUM          = #ownrAcctNum#  -->
<!-- END 2018/10/23 [QC#28721, DEL] -->
                    <isNotNull property="serNum">
                    AND SMM.SER_NUM             LIKE #serNum#
                    </isNotNull>
                    <!-- START 2018/10/30 [QC#28721, ADD] -->
                    AND SMM.SVC_MACH_TP_CD         = #svcMachTpMachine#
                    <!-- END 2018/10/30 [QC#28721, ADD] -->
                    AND SMM.EZCANCELFLAG           = '0'
                    AND SMM.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
                    AND SMM.SVC_MACH_MSTR_PK       = DCD.SVC_MACH_MSTR_PK
                    AND DCD.EZCANCELFLAG           = '0'
                    AND DCD.GLBL_CMPY_CD           = DSV.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK        = DSV.DS_CONTR_DTL_PK
                    AND DSV.ETTL_AVAL_FLG          = 'Y'
                    AND DSV.EZCANCELFLAG           = '0'
                    AND SMM.GLBL_CMPY_CD           = SCM.GLBL_CMPY_CD
                    AND SMM.SVC_CONFIG_MSTR_PK     = SCM.SVC_CONFIG_MSTR_PK
                    AND SCM.EZCANCELFLAG           = '0'
                    AND SCM.GLBL_CMPY_CD           = MNM.T_GLBL_CMPY_CD
                    AND SCM.MDL_ID                 = MNM.T_MDL_ID
                    AND MNM.EZCANCELFLAG           = '0'
                    AND DCD.GLBL_CMPY_CD           = MDS.GLBL_CMPY_CD
                    AND DCD.SVC_PGM_MDSE_CD        = MDS.MDSE_CD
                    AND MDS.EZCANCELFLAG           = '0'
<!-- START 2018/07/19 K.Kim [QC#27009, MOD] -->
                    AND SMM.GLBL_CMPY_CD           = STC.GLBL_CMPY_CD
                    AND SMM.CUR_LOC_NUM            = STC.SHIP_TO_CUST_CD
                    <iterate property="relnShipToCustCdList" var="relnShipToCustCd[]" open="AND STC.SHIP_TO_CUST_CD IN (" conjunction= "," close=")">
                    #relnShipToCustCd[]#
                    </iterate>
                    AND STC.EZCANCELFLAG           = '0'
                    AND STC.GLBL_CMPY_CD           = SEL.GLBL_CMPY_CD
                    AND STC.SELL_TO_CUST_CD        = SEL.SELL_TO_CUST_CD
                    AND SEL.EZCANCELFLAG           = '0'
<!-- END 2018/07/19 K.Kim [QC#27009, MOD] -->
                    AND DCD.GLBL_CMPY_CD           = DCH.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_PK            = DCH.DS_CONTR_PK
                    <!-- START 2018/07/19 K.Kitachi [QC#26981, ADD] -->
                    AND DCH.DS_CONTR_CATG_CD       &lt;&gt; #dsContrCatgCd#
                    <!-- END 2018/07/19 K.Kitachi [QC#26981, ADD] -->
                    AND DCH.EZCANCELFLAG           = '0'
<!-- START 2017/09/26 K.Kim [QC#18744, ADD] -->
                    AND DSC.GLBL_CMPY_CD(+)        = DCD.GLBL_CMPY_CD
                    AND DSC.DS_CONTR_DTL_PK(+)     = DCD.DS_CONTR_DTL_PK
                    AND DSC.EZCANCELFLAG(+)        = '0'
<!-- END 2017/09/26 K.Kim [QC#18744, ADD] -->
                <!-- START 2018/07/19 K.Kitachi [QC#26981, ADD] -->
                UNION
                SELECT
                     SCM.SVC_CONFIG_MSTR_PK    AS SVC_CONFIG_MSTR_PK
                    ,SMM.SVC_MACH_MSTR_PK      AS SVC_MACH_MSTR_PK
                    ,DCD.DS_CONTR_DTL_PK       AS DS_CONTR_DTL_PK
                    ,SMM.SER_NUM               AS SER_NUM
                    ,MNM.T_MDL_NM              AS T_MDL_NM
                    ,'Y'                       AS XX_RSLT_FLG
                    ,DCH.DS_CONTR_NUM          AS DS_CONTR_NUM
                    ,SEL.DS_ACCT_NM            AS DS_ACCT_NM
                    ,STC.FIRST_LINE_ADDR       AS FIRST_LINE_ADDR
                    ,STC.SCD_LINE_ADDR         AS SCD_LINE_ADDR
                    ,STC.THIRD_LINE_ADDR       AS THIRD_LINE_ADDR
                    ,STC.FRTH_LINE_ADDR        AS FRTH_LINE_ADDR
                    ,STC.CTY_ADDR              AS CTY_ADDR
                    ,STC.ST_CD                 AS ST_CD
                    ,STC.POST_CD               AS POST_CD
                    ,FLT.SVC_PGM_MDSE_CD       AS SVC_PGM_MDSE_CD
                    ,NVL(SMM.SVC_BY_LINE_BIZ_TP_CD, DCH.SVC_LINE_BIZ_CD)
                                               AS SVC_BY_LINE_BIZ_TP_CD
<!-- START 2019/07/30 T.Kanasaka [QC#51976, ADD] -->
                    ,SMM.SLD_BY_LINE_BIZ_TP_CD AS SLD_BY_LINE_BIZ_TP_CD
<!-- END   2019/07/30 T.Kanasaka [QC#51976, ADD] -->
                    ,SMM.SHIP_TO_CUST_CD       AS SHIP_TO_CUST_CD
                    ,DSC.SPLY_INCL_FLG         AS SPLY_INCL_FLG
                FROM
                     SVC_MACH_MSTR      SMM
                    ,DS_CONTR_DTL       DCD
                    ,DS_CONTR_DTL_STS_V DSV
                    ,SVC_CONFIG_MSTR    SCM
                    ,MDL_NM             MNM
                    ,DS_CONTR_DTL       FLT
                    ,MDSE               MDS
                    ,SHIP_TO_CUST       STC
                    ,DS_CONTR           DCH
                    ,SELL_TO_CUST       SEL
                    ,DS_SUB_CONTR       DSC
                WHERE
                        SMM.GLBL_CMPY_CD           = #glblCmpyCd#
<!-- START 2018/10/23 [QC#28721, DEL] -->
                    <!-- AND SMM.OWNR_ACCT_NUM          = #ownrAcctNum#  -->
<!-- END 2018/10/23 [QC#28721, DEL] -->
                    <isNotNull property="serNum">
                    AND SMM.SER_NUM             LIKE #serNum#
                    </isNotNull>
                    <!-- START 2018/10/30 [QC#28721, ADD] -->
                    AND SMM.SVC_MACH_TP_CD         = #svcMachTpMachine#
                    <!-- END 2018/10/30 [QC#28721, ADD] -->
                    AND SMM.EZCANCELFLAG           = '0'
                    AND SMM.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
                    AND SMM.SVC_MACH_MSTR_PK       = DCD.SVC_MACH_MSTR_PK
                    AND DCD.EZCANCELFLAG           = '0'
                    AND DCD.GLBL_CMPY_CD           = DSV.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK        = DSV.DS_CONTR_DTL_PK
                    AND DSV.ETTL_AVAL_FLG          = 'Y'
                    AND DSV.EZCANCELFLAG           = '0'
                    AND SMM.GLBL_CMPY_CD           = SCM.GLBL_CMPY_CD
                    AND SMM.SVC_CONFIG_MSTR_PK     = SCM.SVC_CONFIG_MSTR_PK
                    AND SCM.EZCANCELFLAG           = '0'
                    AND SCM.GLBL_CMPY_CD           = MNM.T_GLBL_CMPY_CD
                    AND SCM.MDL_ID                 = MNM.T_MDL_ID
                    AND MNM.EZCANCELFLAG           = '0'
                    AND DCD.GLBL_CMPY_CD           = FLT.GLBL_CMPY_CD
                    AND DCD.PRNT_DS_CONTR_DTL_PK   = FLT.DS_CONTR_DTL_PK
                    AND FLT.EZCANCELFLAG           = '0'
                    AND FLT.GLBL_CMPY_CD           = MDS.GLBL_CMPY_CD
                    AND FLT.SVC_PGM_MDSE_CD        = MDS.MDSE_CD
                    AND MDS.EZCANCELFLAG           = '0'
                    AND SMM.GLBL_CMPY_CD           = STC.GLBL_CMPY_CD
                    AND SMM.CUR_LOC_NUM            = STC.SHIP_TO_CUST_CD
                    <iterate property="relnShipToCustCdList" var="relnShipToCustCd[]" open="AND STC.SHIP_TO_CUST_CD IN (" conjunction= "," close=")">
                    #relnShipToCustCd[]#
                    </iterate>
                    AND STC.EZCANCELFLAG           = '0'
                    AND STC.GLBL_CMPY_CD           = SEL.GLBL_CMPY_CD
                    AND STC.SELL_TO_CUST_CD        = SEL.SELL_TO_CUST_CD
                    AND SEL.EZCANCELFLAG           = '0'
                    AND DCD.GLBL_CMPY_CD           = DCH.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_PK            = DCH.DS_CONTR_PK
                    AND DCH.DS_CONTR_CATG_CD       = #dsContrCatgCd#
                    AND DCH.EZCANCELFLAG           = '0'
                    AND DSC.GLBL_CMPY_CD(+)        = DCD.GLBL_CMPY_CD
                    AND DSC.DS_CONTR_DTL_PK(+)     = DCD.DS_CONTR_DTL_PK
                    AND DSC.EZCANCELFLAG(+)        = '0'
                <!-- END 2018/07/19 K.Kitachi [QC#26981, ADD] -->
                ORDER BY
                    <!-- START 2018/07/19 K.Kitachi [QC#26981, MOD] -->
                    <!-- SMM.SER_NUM -->
                    SER_NUM
                    <!-- END 2018/07/19 K.Kitachi [QC#26981, MOD] -->
            )
        WHERE
                ROWNUM &lt;= #rowNum#
    </statement>
    <resultMap id="result.getSearchData"  class="NSAL1020_ACMsg">
        <result property="svcConfigMstrPk_D"  column="SVC_CONFIG_MSTR_PK"    javaType="EZDCBigDecimalItem"/>
        <result property="svcMachMstrPk_D"    column="SVC_MACH_MSTR_PK"      javaType="EZDCBigDecimalItem"/>
        <result property="dsContrDtlPk_D"     column="DS_CONTR_DTL_PK"       javaType="EZDCBigDecimalItem"/>
        <result property="serNum_D"           column="SER_NUM"               javaType="EZDCStringItem"/>
        <result property="t_MdlNm_D"          column="T_MDL_NM"              javaType="EZDCStringItem"/>
        <result property="xxRsltFlg_D"        column="XX_RSLT_FLG"           javaType="EZDCStringItem"/>
        <result property="dsContrNum_D"       column="DS_CONTR_NUM"          javaType="EZDCStringItem"/>
        <result property="dsAcctNm_D"         column="DS_ACCT_NM"            javaType="EZDCStringItem"/>
        <result property="firstLineAddr_D"    column="FIRST_LINE_ADDR"       javaType="EZDCStringItem"/>
        <result property="scdLineAddr_D"      column="SCD_LINE_ADDR"         javaType="EZDCStringItem"/>
        <result property="thirdLineAddr_D"    column="THIRD_LINE_ADDR"       javaType="EZDCStringItem"/>
        <result property="frthLineAddr_D"     column="FRTH_LINE_ADDR"        javaType="EZDCStringItem"/>
        <result property="ctyAddr_D"          column="CTY_ADDR"              javaType="EZDCStringItem"/>
        <result property="stCd_D"             column="ST_CD"                 javaType="EZDCStringItem"/>
        <result property="postCd_D"           column="POST_CD"               javaType="EZDCStringItem"/>
        <result property="svcPgmMdseCd_D"     column="SVC_PGM_MDSE_CD"       javaType="EZDCStringItem"/>
        <result property="svcByLineBizTpCd_D" column="SVC_BY_LINE_BIZ_TP_CD" javaType="EZDCStringItem"/>
<!-- START 2019/07/30 T.Kanasaka [QC#51976, ADD] -->
        <result property="sldByLineBizTpCd_D" column="SLD_BY_LINE_BIZ_TP_CD" javaType="EZDCStringItem"/>
<!-- END   2019/07/30 T.Kanasaka [QC#51976, ADD] -->
        <result property="shipToCustCd_D"     column="SHIP_TO_CUST_CD"       javaType="EZDCStringItem"/>
<!-- START 2017/09/26 K.Kim [QC#18744, ADD] -->
        <result property="splyInclFlg_D"      column="SPLY_INCL_FLG"         javaType="EZDCStringItem"/>
<!-- END 2017/09/26 K.Kim [QC#18744, ADD] -->
    </resultMap>

<!-- del start 2019/01/15 QC#29917 -->
<!--    <statement id="cntCpo" parameterClass="Map" resultClass="Integer">-->
<!--
        SELECT
            COUNT(*)
        FROM
             CPO       CH
            ,CPO_DTL_V CD
        WHERE
                CH.GLBL_CMPY_CD                = #glblCmpyCd#
            AND CH.BILL_TO_CUST_ACCT_CD        = #billToCustAcctCd#
            AND EXISTS (SELECT
                            *
                        FROM
                            SVC_SPLY_ORD_TP_RELN RL1
                        WHERE
                                RL1.GLBL_CMPY_CD        = CH.GLBL_CMPY_CD
                            AND RL1.DS_ORD_CATG_CD      = CH.DS_ORD_CATG_CD
                            AND RL1.EZCANCELFLAG        = '0')
            AND CH.EZCANCELFLAG                = '0'
            AND CH.GLBL_CMPY_CD                = CD.GLBL_CMPY_CD
            AND CH.CPO_ORD_NUM                 = CD.CPO_ORD_NUM
            AND EXISTS (SELECT
                            *
                        FROM
                            SVC_SPLY_ORD_TP_RELN RL2
                        WHERE
                                RL2.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                            AND RL2.DS_ORD_LINE_CATG_CD = CD.DS_ORD_LINE_CATG_CD
                            AND RL2.EZCANCELFLAG        = '0')
            AND CD.PICK_SVC_CONFIG_MSTR_PK     = #pickSvcConfigMstrPk#
            AND CD.ORD_LINE_STS_CD             = #ordLineStsCd#
            AND CD.EZCANCELFLAG                = '0'
            AND ROWNUM                          = 1
-->
<!--   </statement>-->
<!-- del end 2019/01/15 QC#29917 -->

<!-- START 2018/07/19 K.Kitachi [QC#26981, ADD] -->
    <statement id="getFltMachPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            C.SVC_MACH_MSTR_PK
        FROM
             DS_CONTR_DTL A
            ,DS_CONTR     B
            ,DS_CONTR_DTL C
        WHERE
                A.GLBL_CMPY_CD     = #glblCmpyCd#
            <iterate property="svcMachMstrPkList" var="svcMachMstrPk[]"  open="AND A.SVC_MACH_MSTR_PK IN (" close=" )" conjunction=",">
                #svcMachMstrPk[]#
            </iterate>
            AND A.EZCANCELFLAG     = '0'
            AND A.GLBL_CMPY_CD     = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK      = B.DS_CONTR_PK
            AND B.DS_CONTR_CATG_CD = #dsContrCatgCd#
            AND B.EZCANCELFLAG     = '0'
            AND B.GLBL_CMPY_CD     = C.GLBL_CMPY_CD
            AND B.DS_CONTR_PK      = C.DS_CONTR_PK
            AND C.SVC_MACH_MSTR_PK IS NOT NULL
            AND C.EZCANCELFLAG     = '0'
        GROUP BY
            C.SVC_MACH_MSTR_PK
    </statement>
<!-- END 2018/07/19 K.Kitachi [QC#26981, ADD] -->

<!-- START 2024/04/11 T.Kawasue [QC#63717, ADD] -->
    <statement id="getSplyReadExclCustCnt" parameterClass="Map" resultMap="BigDecimal">
          SELECT
              COUNT(*)
          FROM
               SVC_MACH_MSTR       A
              ,SPLY_READ_EXCL_CUST B
          WHERE
                  A.GLBL_CMPY_CD                 = #glblCmpyCd#
              AND A.SVC_MACH_MSTR_PK             = #svcMachMstrPk#
              AND A.EZCANCELFLAG                 = '0'
              AND A.GLBL_CMPY_CD                 = B.GLBL_CMPY_CD
              AND (   A.CUR_LOC_ACCT_NUM         = B.DS_ACCT_NUM
                  OR  A.BILL_TO_ACCT_NUM         = B.DS_ACCT_NUM
                  OR  A.OWNR_ACCT_NUM            = B.DS_ACCT_NUM)
              AND B.ACTV_FLG                     = 'Y'
              AND B.EFF_FROM_DT                  &lt;= #slsDt#
              AND NVL(B.EFF_THRU_DT, #slsDt#)    &gt;= #slsDt#
              AND B.EZCANCELFLAG                 = '0'
    </statement>
    
    <statement id="convLineBizTpToSvcLineBiz" parameterClass="Map" resultClass="String">
        SELECT
            RELN.SVC_LINE_BIZ_CD
        FROM
            SVC_LINE_BIZ_RELN RELN
        WHERE
                RELN.GLBL_CMPY_CD   = #glblCmpyCd#
            AND RELN.LINE_BIZ_TP_CD = #lineBizTpCd#
            AND RELN.EZCANCELFLAG   = '0'
    </statement>
<!-- END 2024/04/11 T.Kawasue [QC#63717, ADD] -->
</sqlMap>
