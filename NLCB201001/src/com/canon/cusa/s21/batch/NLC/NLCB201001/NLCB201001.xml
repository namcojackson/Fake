<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLCB201001">
    <statement id="getInvty" parameterClass="Map">
        WITH
            PO_INVTY_INFO AS(
                <!-- Purchase Order for MNX warehouse -->
                SELECT DISTINCT
                    SUM(PO_BAL_QTY) VIS_QTY
                   ,MDSE_CD
                   ,WH_RG_CD
                   ,RTL_WH_CD
                   ,STK_LOC_CD
                   ,STK_STS_NM
                   ,INVTY_STS_CD
                   ,SER_NUM
                   ,RSVD_FIRST_CD
                   ,INVTY_SRC_CD
                FROM (
                    SELECT DISTINCT
                        PD.PO_BAL_QTY
                       ,PD.MDSE_CD
                       ,TPWRX.TRD_PTNR_WH_RG_NM            AS WH_RG_CD
                       <!-- START 2021/11/04 A.Marte [QC#58989-2,MOD] -->
                       <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD -->
                       <!-- ,#stkLocCd#                         AS STK_LOC_CD -->
                       <isEqual property="convtFlg" compareValue="Y">
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD IN
                           <iterate property="convtFromWhList" var="convtFromWhList[]" open="(" close=")" conjunction=",">
                               #convtFromWhList[]#
                           </iterate>
                           THEN #convtIntoWh#
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD) -->
                           ELSE NVL(RS.RTL_WH_CD, PD.INVTY_LOC_CD)
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       END RTL_WH_CD 
                       </isEqual>
                       <isEqual property="convtFlg" compareValue="N">
                       <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                       <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD -->
                       ,NVL(RS.RTL_WH_CD, PD.INVTY_LOC_CD)  AS RTL_WH_CD
                       <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       </isEqual>
                       <isNotNull property="stkLocCdList">
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD || TPWRX.RTL_SWH_CD IN
                           <iterate property="stkLocCdList" var="stkLocCdList[]" open="(" close=")" conjunction=",">
                               #stkLocCdList[]#
                           </iterate>
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- THEN I.INVTY_LOC_CD -->
                           THEN PD.INVTY_LOC_CD
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                           ELSE #stkLocCd#
                       END STK_LOC_CD
                       </isNotNull>
                       <isNull property="stkLocCdList">
                       ,#stkLocCd#                         AS STK_LOC_CD
                       </isNull>                    
                       <!-- END 2021/11/04 A.Marte [QC#58989-2,MOD] -->
                       ,UPPER(SS.STK_STS_NM)               AS STK_STS_NM
                       ,#inboundInvty#                     AS INVTY_STS_CD
                       ,NULL                               AS SER_NUM
                       ,NULL                               AS RSVD_FIRST_CD
                       ,#S21#                              AS INVTY_SRC_CD
                       ,PO.PO_ORD_NUM                      AS PO_ORD_NUM
                       ,PD.PO_ORD_DTL_LINE_NUM             AS PO_ORD_DTL_LINE_NUM
                    FROM
                        PO                    PO
                       ,PO_DTL                PD 
                       ,DS_PO_TP              DPT
                       ,PO_HDR_STS            PHS
                       ,PO_APVL_STS           PAS
                       ,PO_STS                PS
                       <!-- START 2021/12/07 [QC#58989-3, DEL] -->
                       <!--,INVTY                 I -->
                       <!-- END 2021/12/07 [QC#58989-3, DEL] -->
                       ,MDSE                  M
                       ,RTL_SWH               RS
                       ,RTL_WH                RW
                       ,STK_STS               SS
                       ,TRD_PTNR_WH_RG_XREF   TPWRX
                    WHERE
                        PO.EZCANCELFLAG                 = '0'
                    AND PO.GLBL_CMPY_CD                 = #glblCmpyCd#
                    AND PO.PO_ORD_NUM                   = PD.PO_ORD_NUM
                    AND PO.GLBL_CMPY_CD                 = PD.GLBL_CMPY_CD
                    AND PD.EZCANCELFLAG                 = '0'
                    AND PO.GLBL_CMPY_CD                 = DPT.GLBL_CMPY_CD
                    AND PO.DS_PO_TP_CD                  = DPT.DS_PO_TP_CD
                    AND DPT.EZCANCELFLAG                = '0'
                    AND PHS.EZCANCELFLAG                = '0'
                    AND PO.GLBL_CMPY_CD                 = PHS.GLBL_CMPY_CD
                    AND PO.PO_HDR_STS_CD                = PHS.PO_HDR_STS_CD
                    AND PO.GLBL_CMPY_CD                 = PAS.GLBL_CMPY_CD
                    AND PO.PO_APVL_STS_CD               = PAS.PO_APVL_STS_CD
                    AND PAS.EZCANCELFLAG                = '0'
                    AND PO.PO_HDR_STS_CD                = #openPoHdr#
                    AND PD.PO_BAL_QTY                   &gt; #ZERO#
                    <iterate property="poLineExclusionTp" var="poLineExclusionTp[]"
                    open="AND PD.PO_LINE_TP_CD NOT IN  (" conjunction=", " close=")"> #poLineExclusionTp[]#
                    </iterate>
                    AND PS.OPEN_PO_FLG                  = #flagY#
                    AND PD.GLBL_CMPY_CD                 = PS.GLBL_CMPY_CD
                    AND PD.PO_STS_CD                    = PS.PO_STS_CD
                    AND PS.EZCANCELFLAG                 = '0'
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND PD.GLBL_CMPY_CD                 = I.GLBL_CMPY_CD
                    AND PD.INVTY_LOC_CD                 = I.INVTY_LOC_CD
                    AND PD.MDSE_CD                      = I.MDSE_CD
                    AND PD.TO_STK_STS_CD                = I.STK_STS_CD
                    AND I.STK_STS_CD                    = #goodStkSts#
                    AND I.EZCANCELFLAG                  = '0'
                    AND M.GLBL_CMPY_CD                  = I.GLBL_CMPY_CD
                    AND M.MDSE_CD                       = I.MDSE_CD -->
                    AND PD.TO_STK_STS_CD                = #goodStkSts#
                    AND PD.GLBL_CMPY_CD                  = M.GLBL_CMPY_CD
                    AND PD.MDSE_CD                       = M.MDSE_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND M.EXP_ITEM_FLG           &lt;&gt; #flagY#
                    <iterate property="includeMdseSts" var="includeMdseSts[]"
                    open="AND M.MDSE_ITEM_STS_CD IN  (" conjunction=", " close=")"> #includeMdseSts[]#
                    </iterate>
                    <iterate property="includeMdseTp" var="includeMdseTp[]"
                    open="AND M.MDSE_ITEM_TP_CD IN  (" conjunction=", " close=")"> #includeMdseTp[]#
                    </iterate>
                    <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                    open="AND M.MDSE_ITEM_CLS_TP_CD IN  (" conjunction=", " close=")"> #includeMdseClsTp[]#
                    </iterate>
                    AND M.EZCANCELFLAG                  = '0'
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND RS.GLBL_CMPY_CD                 = I.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD                 = I.INVTY_LOC_CD -->
                    AND RS.GLBL_CMPY_CD                 = PD.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD                 = PD.INVTY_LOC_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND RS.EZCANCELFLAG                 = '0'
                    AND TPWRX.GLBL_CMPY_CD              = RS.GLBL_CMPY_CD
                    AND TPWRX.RTL_WH_CD                 = RS.RTL_WH_CD
                    AND TPWRX.RTL_SWH_CD                = RS.RTL_SWH_CD
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    <isNotNull property="inboundTrgtWhList">
                    <isEqual property="inbdInclMNX" compareValue="Y">
                    AND (TPWRX.RTL_WH_CD IN
                    <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundTrgtWhList[]#
                    </iterate>
                        OR (RW.RTL_WH_CD               = TPWRX.RTL_WH_CD
                        AND RW.WH_OWNR_CD              = #whOwnrCd#
                        AND RW.EZCANCELFLAG            = '0'
                        )
                    )
                    </isEqual>
                    <isEqual property="inbdInclMNX" compareValue="N">
                    AND TPWRX.RTL_WH_CD IN
                    <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundTrgtWhList[]#
                    </iterate>
                    </isEqual>
                    </isNotNull>
                    <isNull property="inboundTrgtWhList">
                    AND TPWRX.RTL_WH_CD IN              #emptyList#
                    </isNull>
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    AND TPWRX.EZCANCELFLAG              = '0'
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!--
                    AND RW.GLBL_CMPY_CD                 = RS.GLBL_CMPY_CD
                    AND RW.RTL_WH_CD                    = RS.RTL_WH_CD
                    AND RW.WH_OWNR_CD                   = #whOwnrCd#
                    AND RW.EZCANCELFLAG                 = '0' -->
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND SS.GLBL_CMPY_CD                 = I.GLBL_CMPY_CD
                    AND SS.STK_STS_CD                   = I.STK_STS_CD -->
                    AND SS.GLBL_CMPY_CD                 = PD.GLBL_CMPY_CD
                    AND SS.STK_STS_CD                   = PD.TO_STK_STS_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND SS.EZCANCELFLAG                 = '0'
                )
                GROUP BY 
                    MDSE_CD
                   ,WH_RG_CD
                   ,RTL_WH_CD
                   ,STK_LOC_CD
                   ,STK_STS_NM
                   ,INVTY_STS_CD
                   ,SER_NUM
                   ,RSVD_FIRST_CD
                   ,INVTY_SRC_CD
                <!-- Purchase Requisition for MNX warehouse -->
                UNION ALL
                SELECT DISTINCT
                    SUM(PRCH_REQ_BAL_QTY) VIS_QTY
                   ,MDSE_CD
                   ,WH_RG_CD
                   ,RTL_WH_CD
                   ,STK_LOC_CD
                   ,STK_STS_NM
                   ,INVTY_STS_CD
                   ,SER_NUM
                   ,RSVD_FIRST_CD
                   ,INVTY_SRC_CD
                FROM (
                    SELECT DISTINCT
                        PRDT.PRCH_REQ_BAL_QTY
                       ,PRDT.MDSE_CD
                       ,TPWRX.TRD_PTNR_WH_RG_NM             AS WH_RG_CD
                       <!-- START 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                       <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)   AS RTL_WH_CD -->
                       <!-- ,#stkLocCd#                          AS STK_LOC_CD -->
                       <isEqual property="convtFlg" compareValue="Y">
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD IN
                           <iterate property="convtFromWhList" var="convtFromWhList[]" open="(" close=")" conjunction=",">
                               #convtFromWhList[]#
                           </iterate>
                           THEN #convtIntoWh#
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD) -->
                           ELSE NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       END RTL_WH_CD 
                       </isEqual>
                       <isEqual property="convtFlg" compareValue="N">
                       <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                       <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD -->
                       ,NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)  AS RTL_WH_CD
                       <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       </isEqual>
                       <isNotNull property="stkLocCdList">
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD || TPWRX.RTL_SWH_CD IN
                           <iterate property="stkLocCdList" var="stkLocCdList[]" open="(" close=")" conjunction=",">
                               #stkLocCdList[]#
                           </iterate>
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- THEN I.INVTY_LOC_CD -->
                           THEN PRDT.DEST_INVTY_LOC_CD
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                           ELSE #stkLocCd#
                       END STK_LOC_CD
                       </isNotNull>
                       <isNull property="stkLocCdList">
                       ,#stkLocCd#                         AS STK_LOC_CD                     
                       </isNull>
                       <!-- END 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                       ,UPPER(SS.STK_STS_NM)                AS STK_STS_NM
                       ,#inboundInvty#                      AS INVTY_STS_CD
                       ,NULL                                AS SER_NUM
                       ,NULL                                AS RSVD_FIRST_CD
                       ,#S21#                               AS INVTY_SRC_CD
                       ,PRDT.PRCH_REQ_NUM
                       ,PRDT.PRCH_REQ_LINE_NUM
                    FROM
                        PRCH_REQ              PRRQ
                       ,PRCH_REQ_DTL          PRDT
                       ,PRCH_REQ_APVL_STS     PRAS
                       ,PRCH_REQ_LINE_STS     PRLS
                       ,PRCH_REQ_TP           PRRT
                       <!-- START 2021/12/07 [QC#58989-3, DEL] -->
                       <!-- ,INVTY                 I -->
                       <!-- END 2021/12/07 [QC#58989-3, DEL] -->
                       ,MDSE                  M
                       ,RTL_SWH               RS
                       ,RTL_WH                RW
                       ,STK_STS               SS
                       ,TRD_PTNR_WH_RG_XREF   TPWRX
                    WHERE
                        PRRQ.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND PRRQ.EZCANCELFLAG          = '0'
                    AND PRRQ.PRCH_REQ_REC_TP_CD    = #prchReqRecTp#
                    <iterate property="incldPrchReqSts" var="incldPrchReqSts[]"
                    open="AND PRRQ.PRCH_REQ_STS_CD IN (" conjunction=", " close=")"> #incldPrchReqSts[]#
                    </iterate>
                    AND NOT (
                            PRRQ.PRCH_REQ_APVL_STS_CD   = #prchReqApvlSts#
                        AND PRRQ.PRCH_REQ_SRC_TP_CD     = #prchReqSrcTp#
                    )
                    AND PRRQ.GLBL_CMPY_CD          = PRDT.GLBL_CMPY_CD
                    AND PRRQ.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
                    AND PRDT.EZCANCELFLAG          = '0'
                    AND PRDT.PRCH_REQ_BAL_QTY      &gt; #ZERO#
                    AND PRRQ.GLBL_CMPY_CD          = PRAS.GLBL_CMPY_CD
                    AND PRRQ.PRCH_REQ_APVL_STS_CD  = PRAS.PRCH_REQ_APVL_STS_CD
                    AND PRAS.EZCANCELFLAG          = '0'
                    AND PRDT.GLBL_CMPY_CD          = PRLS.GLBL_CMPY_CD
                    AND PRDT.PRCH_REQ_LINE_STS_CD  = PRLS.PRCH_REQ_LINE_STS_CD
                    AND PRLS.EZCANCELFLAG          = '0'
                    AND PRLS.OPEN_STS_FLG          = #flagY#
                    AND PRRQ.GLBL_CMPY_CD          = PRRT.GLBL_CMPY_CD
                    AND PRRQ.PRCH_REQ_TP_CD        = PRRT.PRCH_REQ_TP_CD
                    AND PRRT.EZCANCELFLAG          = '0'
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND PRDT.GLBL_CMPY_CD          = I.GLBL_CMPY_CD
                    AND PRDT.DEST_INVTY_LOC_CD     = I.INVTY_LOC_CD
                    AND PRDT.MDSE_CD               = I.MDSE_CD
                    AND PRDT.TO_STK_STS_CD         = I.STK_STS_CD
                    AND I.STK_STS_CD               = #goodStkSts#
                    AND I.EZCANCELFLAG             = '0'
                    AND M.GLBL_CMPY_CD             = I.GLBL_CMPY_CD
                    AND M.MDSE_CD                  = I.MDSE_CD -->
                    AND PRDT.TO_STK_STS_CD         = #goodStkSts#
                    AND PRDT.GLBL_CMPY_CD          = M.GLBL_CMPY_CD
                    AND PRDT.MDSE_CD               = M.MDSE_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND M.EXP_ITEM_FLG      &lt;&gt; #flagY#
                    <iterate property="includeMdseSts" var="includeMdseSts[]"
                    open="AND M.MDSE_ITEM_STS_CD IN  (" conjunction=", " close=")"> #includeMdseSts[]#
                    </iterate>
                    <iterate property="includeMdseTp" var="includeMdseTp[]"
                    open="AND M.MDSE_ITEM_TP_CD IN  (" conjunction=", " close=")"> #includeMdseTp[]#
                    </iterate>
                    <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                    open="AND M.MDSE_ITEM_CLS_TP_CD IN  (" conjunction=", " close=")"> #includeMdseClsTp[]#
                    </iterate>
                    AND M.EZCANCELFLAG             = '0'
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND RS.GLBL_CMPY_CD            = I.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD            = I.INVTY_LOC_CD -->
                    AND RS.GLBL_CMPY_CD            = PRDT.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD            = PRDT.DEST_INVTY_LOC_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND RS.EZCANCELFLAG            = '0'
                    AND TPWRX.GLBL_CMPY_CD         = RS.GLBL_CMPY_CD
                    AND TPWRX.RTL_WH_CD            = RS.RTL_WH_CD
                    AND TPWRX.RTL_SWH_CD           = RS.RTL_SWH_CD
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    <isNotNull property="inboundTrgtWhList">
                    <isEqual property="inbdInclMNX" compareValue="Y">
                    AND (TPWRX.RTL_WH_CD IN
                    <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundTrgtWhList[]#
                    </iterate>
                        OR (RW.RTL_WH_CD               = TPWRX.RTL_WH_CD
                        AND RW.WH_OWNR_CD              = #whOwnrCd#
                        AND RW.EZCANCELFLAG            = '0'
                        )
                    )
                    </isEqual>
                    <isEqual property="inbdInclMNX" compareValue="N">
                    AND TPWRX.RTL_WH_CD IN
                    <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundTrgtWhList[]#
                    </iterate>
                    </isEqual>
                    </isNotNull>
                    <isNull property="inboundTrgtWhList">
                    AND TPWRX.RTL_WH_CD IN              #emptyList#
                    </isNull>
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    AND TPWRX.EZCANCELFLAG         = '0'
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!--
                    AND RW.GLBL_CMPY_CD            = RS.GLBL_CMPY_CD
                    AND RW.RTL_WH_CD               = RS.RTL_WH_CD
                    AND RW.WH_OWNR_CD              = #whOwnrCd#
                    AND RW.EZCANCELFLAG            = '0'
                    -->
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND SS.GLBL_CMPY_CD            = I.GLBL_CMPY_CD
                    AND SS.STK_STS_CD              = I.STK_STS_CD -->
                    AND SS.GLBL_CMPY_CD            = PRDT.GLBL_CMPY_CD
                    AND SS.STK_STS_CD              = PRDT.TO_STK_STS_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND SS.EZCANCELFLAG            = '0'
                )
                GROUP BY MDSE_CD 
                        ,WH_RG_CD
                        ,RTL_WH_CD
                        ,STK_LOC_CD
                        ,STK_STS_NM
                        ,INVTY_STS_CD
                        ,SER_NUM
                        ,RSVD_FIRST_CD
                        ,INVTY_SRC_CD
                <!-- Inventory Requisition (before shipping) for MNX warehouse -->
                UNION ALL
                SELECT DISTINCT
                    SUM(SCHD_QTY) VIS_QTY
                    ,MDSE_CD
                    ,WH_RG_CD
                    ,RTL_WH_CD
                    ,STK_LOC_CD
                    ,STK_STS_NM
                    ,INVTY_STS_CD
                    ,SER_NUM
                    ,RSVD_FIRST_CD
                    ,INVTY_SRC_CD
                 FROM (
                   SELECT DISTINCT
                       PRDT.PRCH_REQ_QTY - PRDT.SHIP_QTY   AS SCHD_QTY
                      ,PRDT.MDSE_CD                        AS MDSE_CD
                      ,TPWRX.TRD_PTNR_WH_RG_NM             AS WH_RG_CD
                      <!-- START 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                      <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)   AS RTL_WH_CD -->
                      <!-- ,#stkLocCd#                          AS STK_LOC_CD -->
                      <isEqual property="convtFlg" compareValue="Y">
                      ,CASE
                          WHEN TPWRX.RTL_WH_CD IN
                          <iterate property="convtFromWhList" var="convtFromWhList[]" open="(" close=")" conjunction=",">
                              #convtFromWhList[]#
                          </iterate>
                          THEN #convtIntoWh#
                          <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                          <!-- ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD) -->
                          ELSE NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)
                          <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                      END RTL_WH_CD 
                      </isEqual>
                      <isEqual property="convtFlg" compareValue="N">
                      <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                      <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD -->
                      ,NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)  AS RTL_WH_CD
                      <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                      </isEqual>
                      <isNotNull property="stkLocCdList">
                      ,CASE
                          WHEN TPWRX.RTL_WH_CD || TPWRX.RTL_SWH_CD IN
                          <iterate property="stkLocCdList" var="stkLocCdList[]" open="(" close=")" conjunction=",">
                              #stkLocCdList[]#
                          </iterate>
                          <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                          <!-- THEN I.INVTY_LOC_CD -->
                          THEN PRDT.DEST_INVTY_LOC_CD
                          <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                          ELSE #stkLocCd#
                      END STK_LOC_CD
                      </isNotNull>
                      <isNull property="stkLocCdList">
                      ,#stkLocCd#                         AS STK_LOC_CD
                      </isNull>
                      <!-- END 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                      ,UPPER(SS.STK_STS_NM)                AS STK_STS_NM
                      ,#inboundInvty#                      AS INVTY_STS_CD
                      ,NULL                                AS SER_NUM
                      ,NULL                                AS RSVD_FIRST_CD
                      ,#S21#                               AS INVTY_SRC_CD
                      ,PRDT.PRCH_REQ_NUM
                      ,PRDT.PRCH_REQ_LINE_NUM
                   FROM
                       PRCH_REQ              PRRQ
                      ,PRCH_REQ_DTL          PRDT
                      ,PRCH_REQ_APVL_STS     PRAS
                      ,PRCH_REQ_LINE_STS     PRLS
                      ,PRCH_REQ_TP           PRRT
                      <!-- START 2021/12/07 [QC#58989-3, DEL] -->
                      <!-- ,INVTY                 I -->
                      <!-- END 2021/12/07 [QC#58989-3, DEL] -->
                      ,MDSE                  M
                      ,RTL_SWH               RS
                      ,RTL_WH                RW
                      ,STK_STS               SS
                      ,TRD_PTNR_WH_RG_XREF   TPWRX
                   WHERE
                       PRRQ.GLBL_CMPY_CD                 = #glblCmpyCd#
                   AND PRRQ.PRCH_REQ_TP_CD          NOT IN(#whTransfer#, #expenseOrder#)
                   AND PRRQ.EZCANCELFLAG                 = '0'
                   AND PRRQ.PRCH_REQ_REC_TP_CD           = #invtyReq#
                   <iterate property="incldPrchReqSts" var="incldPrchReqSts[]"
                   open="AND PRRQ.PRCH_REQ_STS_CD IN (" conjunction=", " close=")"> #incldPrchReqSts[]#
                   </iterate>
                   AND NOT (
                       PRRQ.PRCH_REQ_APVL_STS_CD         = #prchReqApvlSts#
                   AND PRRQ.PRCH_REQ_SRC_TP_CD           = #prchReqSrcTp#
                   )
                   AND PRRQ.GLBL_CMPY_CD                 = PRDT.GLBL_CMPY_CD
                   AND PRRQ.PRCH_REQ_NUM                 = PRDT.PRCH_REQ_NUM
                   AND PRDT.EZCANCELFLAG                 = '0'
                   AND PRDT.PRCH_REQ_QTY - PRDT.SHIP_QTY &gt; #ZERO#
                   AND PRDT.RWS_NUM                      IS NULL
                   AND PRRQ.GLBL_CMPY_CD                 = PRAS.GLBL_CMPY_CD
                   AND PRRQ.PRCH_REQ_APVL_STS_CD         = PRAS.PRCH_REQ_APVL_STS_CD
                   AND PRAS.EZCANCELFLAG                 = '0'
                   AND PRDT.GLBL_CMPY_CD                 = PRLS.GLBL_CMPY_CD
                   AND PRDT.PRCH_REQ_LINE_STS_CD         = PRLS.PRCH_REQ_LINE_STS_CD
                   AND PRLS.EZCANCELFLAG                 = '0'
                   AND PRLS.OPEN_STS_FLG                 = #flagY#
                   AND PRRQ.GLBL_CMPY_CD                 = PRRT.GLBL_CMPY_CD
                   AND PRRQ.PRCH_REQ_TP_CD               = PRRT.PRCH_REQ_TP_CD
                   AND PRRT.EZCANCELFLAG                 = '0'
                   <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                   <!-- AND PRDT.GLBL_CMPY_CD                 = I.GLBL_CMPY_CD
                   AND PRDT.DEST_INVTY_LOC_CD            = I.INVTY_LOC_CD
                   AND PRDT.MDSE_CD                      = I.MDSE_CD
                   AND PRDT.TO_STK_STS_CD                = I.STK_STS_CD
                   AND I.STK_STS_CD                      = #goodStkSts#
                   AND I.EZCANCELFLAG                    = '0'
                   AND M.GLBL_CMPY_CD                    = I.GLBL_CMPY_CD
                   AND M.MDSE_CD                         = I.MDSE_CD -->
                   AND PRDT.TO_STK_STS_CD                = #goodStkSts#
                   AND PRDT.GLBL_CMPY_CD                 = M.GLBL_CMPY_CD
                   AND PRDT.MDSE_CD                      = M.MDSE_CD
                   <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                   AND M.EXP_ITEM_FLG             &lt;&gt; #flagY#
                   <iterate property="includeMdseSts" var="includeMdseSts[]"
                   open="AND M.MDSE_ITEM_STS_CD IN  (" conjunction=", " close=")"> #includeMdseSts[]#
                   </iterate>
                   <iterate property="includeMdseTp" var="includeMdseTp[]"
                   open="AND M.MDSE_ITEM_TP_CD IN  (" conjunction=", " close=")"> #includeMdseTp[]#
                   </iterate>
                   <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                   open="AND M.MDSE_ITEM_CLS_TP_CD IN  (" conjunction=", " close=")"> #includeMdseClsTp[]#
                   </iterate>
                   AND M.EZCANCELFLAG                    = '0'
                   <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                   <!-- AND RS.GLBL_CMPY_CD                   = I.GLBL_CMPY_CD
                   AND RS.INVTY_LOC_CD                   = I.INVTY_LOC_CD -->
                   AND RS.GLBL_CMPY_CD                   = PRDT.GLBL_CMPY_CD
                   AND RS.INVTY_LOC_CD                   = PRDT.DEST_INVTY_LOC_CD
                   <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                   AND RS.EZCANCELFLAG                   = '0'
                   AND TPWRX.GLBL_CMPY_CD                = RS.GLBL_CMPY_CD
                   AND TPWRX.RTL_WH_CD                   = RS.RTL_WH_CD
                   AND TPWRX.RTL_SWH_CD                  = RS.RTL_SWH_CD
                   <!-- START 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                   <isNotNull property="inboundTrgtWhList">
                   <isEqual property="inbdInclMNX" compareValue="Y">
                   AND (TPWRX.RTL_WH_CD IN
                   <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                       #inboundTrgtWhList[]#
                   </iterate>
                       OR (RW.RTL_WH_CD               = TPWRX.RTL_WH_CD
                       AND RW.WH_OWNR_CD              = #whOwnrCd#
                       AND RW.EZCANCELFLAG            = '0'
                       )
                   )
                   </isEqual>
                   <isEqual property="inbdInclMNX" compareValue="N">
                   AND TPWRX.RTL_WH_CD IN
                   <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                       #inboundTrgtWhList[]#
                   </iterate>
                   </isEqual>
                   </isNotNull>
                   <isNull property="inboundTrgtWhList">
                   AND TPWRX.RTL_WH_CD IN              #emptyList#
                   </isNull>
                   <!-- END 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                   AND TPWRX.EZCANCELFLAG                = '0'
                   <!-- START 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                   <!-- 
                   AND RW.GLBL_CMPY_CD                   = RS.GLBL_CMPY_CD
                   AND RW.RTL_WH_CD                      = RS.RTL_WH_CD
                   AND RW.WH_OWNR_CD                     = #whOwnrCd#
                   AND RW.EZCANCELFLAG                   = '0'
                   -->
                   <!-- END 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                   <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                   <!-- AND SS.GLBL_CMPY_CD                   = I.GLBL_CMPY_CD
                   AND SS.STK_STS_CD                     = I.STK_STS_CD -->
                   AND SS.GLBL_CMPY_CD                   = PRDT.GLBL_CMPY_CD
                   AND SS.STK_STS_CD                     = PRDT.TO_STK_STS_CD
                   <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                   AND SS.EZCANCELFLAG                   = '0'
                   UNION ALL
                   SELECT DISTINCT
                       MAIN.SCHD_QTY
                      ,MAIN.MDSE_CD
                      ,MAIN.WH_RG_CD
                      ,MAIN.RTL_WH_CD
                      ,MAIN.STK_LOC_CD
                      ,MAIN.STK_STS_NM
                      ,MAIN.INVTY_STS_CD
                      ,MAIN.SER_NUM
                      ,MAIN.RSVD_FIRST_CD
                      ,MAIN.INVTY_SRC_CD
                      ,MAIN.PRCH_REQ_NUM
                      ,MAIN.PRCH_REQ_LINE_NUM
                   FROM(
                       SELECT
                           PRDT.PRCH_REQ_QTY - PRDT.SHIP_QTY - NVL((SELECT
                               SUM(CD.CANC_QTY) CANC_QTY
                           FROM
                               CPO C
                              ,CPO_DTL CD
                           WHERE
                               PRRQ.PRCH_REQ_NUM          = C.ORD_SRC_REF_NUM
                           AND C.EZCANCELFLAG             = '0'
                           AND C.CPO_ORD_NUM              = CD.CPO_ORD_NUM
                           AND PRDT.PRCH_REQ_LINE_NUM     = CD.ORD_SRC_REF_LINE_NUM
                           AND PRDT.PRCH_REQ_LINE_SUB_NUM = CD.ORD_SRC_REF_LINE_SUB_NUM
                           AND CD.EZCANCELFLAG            = '0'
                           ), 0) AS SCHD_QTY
                          ,PRDT.MDSE_CD
                          ,TPWRX.TRD_PTNR_WH_RG_NM             AS WH_RG_CD
                          <!-- START 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                          <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)   AS RTL_WH_CD -->
                          <!-- ,#stkLocCd#                          AS STK_LOC_CD -->
                          <isEqual property="convtFlg" compareValue="Y">
                          ,CASE
                              WHEN TPWRX.RTL_WH_CD IN
                               <iterate property="convtFromWhList" var="convtFromWhList[]" open="(" close=")" conjunction=",">
                                   #convtFromWhList[]#
                               </iterate>
                               THEN #convtIntoWh#
                               <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                               <!-- ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD) -->
                               ELSE NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)
                               <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                          END RTL_WH_CD 
                          </isEqual>
                          <isEqual property="convtFlg" compareValue="N">
                          <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                          <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD -->
                          ,NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)  AS RTL_WH_CD
                          <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                          </isEqual>
                          <isNotNull property="stkLocCdList">
                          ,CASE
                              WHEN TPWRX.RTL_WH_CD || TPWRX.RTL_SWH_CD IN
                              <iterate property="stkLocCdList" var="stkLocCdList[]" open="(" close=")" conjunction=",">
                                  #stkLocCdList[]#
                              </iterate>
                              <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                              <!-- THEN I.INVTY_LOC_CD -->
                              THEN PRDT.DEST_INVTY_LOC_CD
                              <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                              ELSE #stkLocCd#
                          END STK_LOC_CD
                          </isNotNull>
                          <isNull property="stkLocCdList">
                          ,#stkLocCd#                         AS STK_LOC_CD
                          </isNull>
                          <!-- END 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                          ,UPPER(SS.STK_STS_NM)                AS STK_STS_NM
                          ,#inboundInvty#                      AS INVTY_STS_CD
                          ,NULL                                AS SER_NUM
                          ,NULL                                AS RSVD_FIRST_CD
                          ,#S21#                               AS INVTY_SRC_CD
                          ,PRDT.PRCH_REQ_NUM
                          ,PRDT.PRCH_REQ_LINE_NUM
                      FROM
                          PRCH_REQ              PRRQ
                         ,PRCH_REQ_DTL          PRDT
                         ,PRCH_REQ_APVL_STS     PRAS
                         ,PRCH_REQ_LINE_STS     PRLS
                         ,PRCH_REQ_TP           PRRT
                         <!-- START 2021/12/07 [QC#58989-3, DEL] -->
                         <!-- ,INVTY                 I -->
                         <!-- END 2021/12/07 [QC#58989-3, DEL] -->
                         ,MDSE                  M
                         ,RTL_SWH               RS
                         ,RTL_WH                RW
                         ,STK_STS               SS
                         ,TRD_PTNR_WH_RG_XREF   TPWRX
                      WHERE
                          PRRQ.GLBL_CMPY_CD                 = #glblCmpyCd#
                      AND PRRQ.PRCH_REQ_TP_CD               = #whTransfer#
                      AND PRRQ.EZCANCELFLAG                 = '0'
                      AND PRRQ.PRCH_REQ_REC_TP_CD           = #invtyReq#
                      <iterate property="incldPrchReqSts" var="incldPrchReqSts[]"
                      open="AND PRRQ.PRCH_REQ_STS_CD IN (" conjunction=", " close=")"> #incldPrchReqSts[]#
                      </iterate>
                      AND NOT (
                          PRRQ.PRCH_REQ_APVL_STS_CD         = #prchReqApvlSts#
                      AND PRRQ.PRCH_REQ_SRC_TP_CD           = #prchReqSrcTp#
                      )
                      AND PRRQ.GLBL_CMPY_CD                 = PRDT.GLBL_CMPY_CD
                      AND PRRQ.PRCH_REQ_NUM                 = PRDT.PRCH_REQ_NUM
                      AND PRDT.EZCANCELFLAG                 = '0'
                      AND PRDT.PRCH_REQ_QTY - PRDT.SHIP_QTY &gt; #ZERO#
                      AND PRRQ.GLBL_CMPY_CD                 = PRAS.GLBL_CMPY_CD
                      AND PRRQ.PRCH_REQ_APVL_STS_CD         = PRAS.PRCH_REQ_APVL_STS_CD
                      AND PRAS.EZCANCELFLAG                 = '0'
                      AND PRDT.GLBL_CMPY_CD                 = PRLS.GLBL_CMPY_CD
                      AND PRDT.PRCH_REQ_LINE_STS_CD         = PRLS.PRCH_REQ_LINE_STS_CD
                      AND PRLS.EZCANCELFLAG                 = '0'
                      AND PRLS.OPEN_STS_FLG                 = #flagY#
                      AND PRRQ.GLBL_CMPY_CD                 = PRRT.GLBL_CMPY_CD
                      AND PRRQ.PRCH_REQ_TP_CD               = PRRT.PRCH_REQ_TP_CD
                      AND PRRT.EZCANCELFLAG                 = '0'
                      <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                      <!-- AND PRDT.GLBL_CMPY_CD                 = I.GLBL_CMPY_CD
                      AND PRDT.DEST_INVTY_LOC_CD            = I.INVTY_LOC_CD
                      AND PRDT.MDSE_CD                      = I.MDSE_CD
                      AND PRDT.TO_STK_STS_CD                = I.STK_STS_CD
                      AND I.STK_STS_CD                      = #goodStkSts#
                      AND I.EZCANCELFLAG                    = '0'
                      AND M.GLBL_CMPY_CD                    = I.GLBL_CMPY_CD
                      AND M.MDSE_CD                         = I.MDSE_CD -->
                      AND PRDT.TO_STK_STS_CD                = #goodStkSts#
                      AND PRDT.GLBL_CMPY_CD                 = M.GLBL_CMPY_CD
                      AND PRDT.MDSE_CD                      = M.MDSE_CD
                      <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                      AND M.EXP_ITEM_FLG             &lt;&gt; #flagY#
                      <iterate property="includeMdseSts" var="includeMdseSts[]"
                      open="AND M.MDSE_ITEM_STS_CD IN  (" conjunction=", " close=")"> #includeMdseSts[]#
                      </iterate>
                      <iterate property="includeMdseTp" var="includeMdseTp[]"
                      open="AND M.MDSE_ITEM_TP_CD IN  (" conjunction=", " close=")"> #includeMdseTp[]#
                      </iterate>
                      <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                      open="AND M.MDSE_ITEM_CLS_TP_CD IN  (" conjunction=", " close=")"> #includeMdseClsTp[]#
                      </iterate>
                      AND M.EZCANCELFLAG                    = '0'
                      <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                      <!-- AND RS.GLBL_CMPY_CD                   = I.GLBL_CMPY_CD
                      AND RS.INVTY_LOC_CD                   = I.INVTY_LOC_CD -->
                      AND RS.GLBL_CMPY_CD                   = PRDT.GLBL_CMPY_CD
                      AND RS.INVTY_LOC_CD                   = PRDT.DEST_INVTY_LOC_CD
                      <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                      AND RS.EZCANCELFLAG                   = '0'
                      AND TPWRX.GLBL_CMPY_CD                = RS.GLBL_CMPY_CD
                      AND TPWRX.RTL_WH_CD                   = RS.RTL_WH_CD
                      AND TPWRX.RTL_SWH_CD                  = RS.RTL_SWH_CD
                      <!-- START 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                      <isNotNull property="inboundTrgtWhList">
                      <isEqual property="inbdInclMNX" compareValue="Y">
                      AND (TPWRX.RTL_WH_CD IN
                      <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                          #inboundTrgtWhList[]#
                      </iterate>
                          OR (RW.RTL_WH_CD               = TPWRX.RTL_WH_CD
                         AND RW.WH_OWNR_CD              = #whOwnrCd#
                          AND RW.EZCANCELFLAG            = '0'
                          )
                      )
                      </isEqual>
                      <isEqual property="inbdInclMNX" compareValue="N">
                      AND TPWRX.RTL_WH_CD IN
                      <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                          #inboundTrgtWhList[]#
                      </iterate>
                      </isEqual>
                      </isNotNull>
                      <isNull property="inboundTrgtWhList">
                      AND TPWRX.RTL_WH_CD IN              #emptyList#
                      </isNull>
                      <!-- END 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                      AND TPWRX.EZCANCELFLAG                = '0'
                      <!-- START 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                      <!--
                      AND RW.GLBL_CMPY_CD                   = RS.GLBL_CMPY_CD
                      AND RW.RTL_WH_CD                      = RS.RTL_WH_CD
                      AND RW.WH_OWNR_CD                     = #whOwnrCd#
                      AND RW.EZCANCELFLAG                   = '0'
                      -->
                      <!-- END 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                      <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                      <!-- AND SS.GLBL_CMPY_CD                   = I.GLBL_CMPY_CD
                      AND SS.STK_STS_CD                     = I.STK_STS_CD -->
                      AND SS.GLBL_CMPY_CD                   = PRDT.GLBL_CMPY_CD
                      AND SS.STK_STS_CD                     = PRDT.TO_STK_STS_CD
                      <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                      AND SS.EZCANCELFLAG                   = '0'
                  ) MAIN
                  WHERE
                      MAIN.SCHD_QTY &gt; #ZERO#
                  )
                GROUP BY MDSE_CD
                        ,WH_RG_CD
                        ,RTL_WH_CD
                        ,STK_LOC_CD
                        ,STK_STS_NM
                        ,INVTY_STS_CD
                        ,SER_NUM
                        ,RSVD_FIRST_CD
                        ,INVTY_SRC_CD
                 <!-- Inventory Requisition (after shipping and before stock-in) for MNX warehouse -->
                 UNION ALL
                 SELECT DISTINCT
                     SUM(VIS_QTY)
                    ,MDSE_CD
                    ,WH_RG_CD
                    ,RTL_WH_CD
                    ,STK_LOC_CD
                    ,STK_STS_NM
                    ,INVTY_STS_CD
                    ,SER_NUM
                    ,RSVD_FIRST_CD
                    ,INVTY_SRC_CD
                 FROM (
                     SELECT DISTINCT
                         INBD.VIS_QTY
                        ,INBD.MDSE_CD
                        ,TPWRX.TRD_PTNR_WH_RG_NM             AS WH_RG_CD
                        <!-- START 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                        <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)   AS RTL_WH_CD -->
                        <!-- ,#stkLocCd#                          AS STK_LOC_CD -->
                        <isEqual property="convtFlg" compareValue="Y">
                        ,CASE
                            WHEN TPWRX.RTL_WH_CD IN
                            <iterate property="convtFromWhList" var="convtFromWhList[]" open="(" close=")" conjunction=",">
                                #convtFromWhList[]#
                            </iterate>
                            THEN #convtIntoWh#
                            <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                            <!-- ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD) -->
                            ELSE NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)
                            <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                        END RTL_WH_CD 
                        </isEqual>
                        <isEqual property="convtFlg" compareValue="N">
                        <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                        <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD -->
                        ,NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)  AS RTL_WH_CD
                        <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                        </isEqual>
                        <isNotNull property="stkLocCdList">
                        ,CASE
                            WHEN TPWRX.RTL_WH_CD || TPWRX.RTL_SWH_CD IN
                            <iterate property="stkLocCdList" var="stkLocCdList[]" open="(" close=")" conjunction=",">
                                #stkLocCdList[]#
                            </iterate>
                            <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                            <!-- THEN I.INVTY_LOC_CD -->
                            THEN PRDT.DEST_INVTY_LOC_CD
                            <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                            ELSE #stkLocCd#
                        END STK_LOC_CD
                        </isNotNull>
                        <isNull property="stkLocCdList">
                        ,#stkLocCd#                         AS STK_LOC_CD
                        </isNull>
                        <!-- END 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                        ,UPPER(STS.STK_STS_NM)               AS STK_STS_NM
                        ,#inboundInvty#                      AS INVTY_STS_CD
                        ,NULL                                AS SER_NUM
                        ,NULL                                AS RSVD_FIRST_CD
                        ,#S21#                               AS INVTY_SRC_CD
                        ,PRDT.PRCH_REQ_NUM
                        ,PRDT.PRCH_REQ_LINE_NUM
                     FROM
                         PRCH_REQ           PRRQ
                        ,PRCH_REQ_DTL       PRDT
                        ,PRCH_REQ_LINE_STS  PRLS
                        ,PO_RCV_DTL         PRD
                        ,INBD_VIS           INBD
                        ,PRCH_REQ_TP        PRRT
                        ,PRCH_REQ_APVL_STS  PRAS
                        ,SHPG_PLN           SP
                        ,SHPG_STS           SS
                        ,(SELECT
                             P.GLBL_CMPY_CD
                            ,P.SO_NUM
                            ,P.SO_SLP_NUM
                            ,P.PKT_STS_TS
                          FROM
                             PKT P
                             ,(SELECT
                                   MP.GLBL_CMPY_CD
                                  ,MP.SO_NUM
                                  ,MP.SO_SLP_NUM
                                  ,MAX(MP.PKT_SQ_NUM) MAX_PKT_SQ_NUM
                               FROM
                                   PKT MP
                               WHERE
                                   MP.EZCANCELFLAG = '0'
                               GROUP BY
                                   MP.GLBL_CMPY_CD
                                  ,MP.SO_NUM
                                  ,MP.SO_SLP_NUM
                              ) M
                          WHERE
                              P.GLBL_CMPY_CD = M.GLBL_CMPY_CD
                          AND P.SO_NUM       = M.SO_NUM
                          AND P.SO_SLP_NUM   = M.SO_SLP_NUM
                          AND P.PKT_SQ_NUM   = M.MAX_PKT_SQ_NUM
                         ) PKT
                         <!-- START 2021/12/07 [QC#58989-3, DEL] -->
                         <!-- ,INVTY                 I -->
                         <!-- END 2021/12/07 [QC#58989-3, DEL] -->
                         ,MDSE                  M
                         ,RTL_SWH               RS
                         ,RTL_WH                RW
                         ,STK_STS               STS
                         ,TRD_PTNR_WH_RG_XREF   TPWRX
                     WHERE
                         PRRQ.GLBL_CMPY_CD          = #glblCmpyCd#
                     AND PRRQ.EZCANCELFLAG          = '0'
                     AND PRRQ.PRCH_REQ_REC_TP_CD    = #invtyReq#
                     AND PRRQ.PRCH_REQ_STS_CD       = #openStatus#
                     AND PRRQ.GLBL_CMPY_CD          = PRDT.GLBL_CMPY_CD
                     AND PRRQ.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
                     AND PRDT.EZCANCELFLAG          = '0'
                     AND PRDT.SO_NUM                IS NOT NULL
                     AND PRDT.GLBL_CMPY_CD          = PRLS.GLBL_CMPY_CD
                     AND PRDT.PRCH_REQ_LINE_STS_CD  = PRLS.PRCH_REQ_LINE_STS_CD
                     AND PRLS.EZCANCELFLAG          = '0'
                     AND PRLS.OPEN_STS_FLG          = #flagY#
                     AND PRDT.GLBL_CMPY_CD          = PRD.GLBL_CMPY_CD
                     AND PRDT.PRCH_REQ_NUM          = PRD.PRCH_REQ_NUM
                     AND PRDT.PRCH_REQ_LINE_NUM     = PRD.PRCH_REQ_LINE_NUM
                     AND PRDT.PRCH_REQ_LINE_SUB_NUM = PRD.PRCH_REQ_LINE_SUB_NUM
                     AND PRD.EZCANCELFLAG           = '0'
                     AND PRD.GLBL_CMPY_CD           = INBD.GLBL_CMPY_CD
                     AND PRD.PO_RCV_NUM             = INBD.PO_RCV_NUM
                     AND PRD.PO_RCV_LINE_NUM        = INBD.PO_RCV_LINE_NUM
                     AND INBD.EZCANCELFLAG          = '0'
                     AND INBD.INBD_LTST_REC_FLG     = #flagY#
                     AND INBD.INBD_VIS_EVENT_CD     = #dcTransferReceive#
                     AND INBD.INBD_VIS_DATA_TP_CD   = #stockInDc#
                     AND PRRQ.GLBL_CMPY_CD          = PRRT.GLBL_CMPY_CD
                     AND PRRQ.PRCH_REQ_TP_CD        = PRRT.PRCH_REQ_TP_CD
                     AND PRRT.EZCANCELFLAG          = '0'
                     AND PRRQ.GLBL_CMPY_CD          = PRAS.GLBL_CMPY_CD
                     AND PRRQ.PRCH_REQ_APVL_STS_CD  = PRAS.PRCH_REQ_APVL_STS_CD
                     AND PRAS.EZCANCELFLAG          = '0'
                     AND PRDT.GLBL_CMPY_CD          = SP.GLBL_CMPY_CD(+)
                     AND PRDT.PRCH_REQ_NUM          = SP.TRX_HDR_NUM(+)
                     AND PRDT.PRCH_REQ_LINE_NUM     = SP.TRX_LINE_NUM(+)
                     AND SP.EZCANCELFLAG(+)         = '0'
                     AND SP.GLBL_CMPY_CD            = SS.GLBL_CMPY_CD(+)
                     AND SP.SHPG_STS_CD             = SS.SHPG_STS_CD(+)
                     AND SS.EZCANCELFLAG(+)         = '0'
                     AND SP.GLBL_CMPY_CD            = PKT.GLBL_CMPY_CD(+)
                     AND SP.SO_NUM                  = PKT.SO_NUM(+)
                     AND SP.SO_SLP_NUM              = PKT.SO_SLP_NUM(+)
                     <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                     <!-- AND PRDT.GLBL_CMPY_CD          = I.GLBL_CMPY_CD
                     AND PRDT.DEST_INVTY_LOC_CD     = I.INVTY_LOC_CD
                     AND PRDT.MDSE_CD               = I.MDSE_CD
                     AND PRDT.TO_STK_STS_CD         = I.STK_STS_CD
                     AND I.STK_STS_CD               = #goodStkSts#
                     AND I.EZCANCELFLAG             = '0'
                     AND M.GLBL_CMPY_CD             = I.GLBL_CMPY_CD
                     AND M.MDSE_CD                  = I.MDSE_CD -->
                     AND PRDT.TO_STK_STS_CD         = #goodStkSts#
                     AND PRDT.GLBL_CMPY_CD          = M.GLBL_CMPY_CD
                     AND PRDT.MDSE_CD               = M.MDSE_CD
                     <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                     AND M.EXP_ITEM_FLG      &lt;&gt; #flagY#
                     <iterate property="includeMdseSts" var="includeMdseSts[]"
                     open="AND M.MDSE_ITEM_STS_CD IN  (" conjunction=", " close=")"> #includeMdseSts[]#
                     </iterate>
                     <iterate property="includeMdseTp" var="includeMdseTp[]"
                     open="AND M.MDSE_ITEM_TP_CD IN  (" conjunction=", " close=")"> #includeMdseTp[]#
                     </iterate>
                     <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                     open="AND M.MDSE_ITEM_CLS_TP_CD IN  (" conjunction=", " close=")"> #includeMdseClsTp[]#
                     </iterate>
                     AND M.EZCANCELFLAG             = '0'
                     <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                     <!-- AND RS.GLBL_CMPY_CD            = I.GLBL_CMPY_CD
                     AND RS.INVTY_LOC_CD            = I.INVTY_LOC_CD -->
                     AND RS.GLBL_CMPY_CD            = PRDT.GLBL_CMPY_CD
                     AND RS.INVTY_LOC_CD            = PRDT.DEST_INVTY_LOC_CD
                     <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                     AND RS.EZCANCELFLAG            = '0'
                     AND TPWRX.GLBL_CMPY_CD         = RS.GLBL_CMPY_CD
                     AND TPWRX.RTL_WH_CD            = RS.RTL_WH_CD
                     AND TPWRX.RTL_SWH_CD           = RS.RTL_SWH_CD
                     <!-- START 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                     <isNotNull property="inboundTrgtWhList">
                     <isEqual property="inbdInclMNX" compareValue="Y">
                     AND (TPWRX.RTL_WH_CD IN
                     <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                         #inboundTrgtWhList[]#
                     </iterate>
                         OR (RW.RTL_WH_CD               = TPWRX.RTL_WH_CD
                         AND RW.WH_OWNR_CD              = #whOwnrCd#
                         AND RW.EZCANCELFLAG            = '0'
                         )
                     )
                     </isEqual>
                     <isEqual property="inbdInclMNX" compareValue="N">
                     AND TPWRX.RTL_WH_CD IN
                     <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                         #inboundTrgtWhList[]#
                     </iterate>
                     </isEqual>
                     </isNotNull>
                     <isNull property="inboundTrgtWhList">
                     AND TPWRX.RTL_WH_CD IN              #emptyList#
                     </isNull>
                     <!-- END 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                     AND TPWRX.EZCANCELFLAG         = '0'
                     <!-- START 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                     <!--
                     AND RW.GLBL_CMPY_CD            = RS.GLBL_CMPY_CD
                     AND RW.RTL_WH_CD               = RS.RTL_WH_CD
                     AND RW.WH_OWNR_CD              = #whOwnrCd#
                     AND RW.EZCANCELFLAG            = '0'
                     -->
                     <!-- END 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                     <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                     <!-- AND STS.GLBL_CMPY_CD           = I.GLBL_CMPY_CD
                     AND STS.STK_STS_CD             = I.STK_STS_CD -->
                     AND STS.GLBL_CMPY_CD           = PRDT.GLBL_CMPY_CD
                     AND STS.STK_STS_CD             = PRDT.TO_STK_STS_CD
                     <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                     AND STS.EZCANCELFLAG           = '0'
                     UNION ALL
                     SELECT DISTINCT
                         PRDT.PRCH_REQ_QTY AS VIS_QTY
                        ,PRDT.MDSE_CD
                        ,TPWRX.TRD_PTNR_WH_RG_NM             AS WH_RG_CD
                        <!-- START 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                        <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)   AS RTL_WH_CD -->
                        <!-- ,#stkLocCd#                          AS STK_LOC_CD -->
                        <isEqual property="convtFlg" compareValue="Y">
                        ,CASE
                            WHEN TPWRX.RTL_WH_CD IN
                            <iterate property="convtFromWhList" var="convtFromWhList[]" open="(" close=")" conjunction=",">
                                #convtFromWhList[]#
                            </iterate>
                            THEN #convtIntoWh#
                            <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                            <!-- ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD) -->
                            ELSE NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)
                            <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                        END RTL_WH_CD 
                        </isEqual>
                        <isEqual property="convtFlg" compareValue="N">
                        <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                        <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD -->
                        ,NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)  AS RTL_WH_CD
                        <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                        </isEqual>
                        <isNotNull property="stkLocCdList">
                        ,CASE
                            WHEN TPWRX.RTL_WH_CD || TPWRX.RTL_SWH_CD IN
                            <iterate property="stkLocCdList" var="stkLocCdList[]" open="(" close=")" conjunction=",">
                                #stkLocCdList[]#
                            </iterate>
                            <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                            <!-- THEN I.INVTY_LOC_CD -->
                            THEN PRDT.DEST_INVTY_LOC_CD
                            <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                            ELSE #stkLocCd#
                        END STK_LOC_CD
                        </isNotNull>
                        <isNull property="stkLocCdList">
                        ,#stkLocCd#                         AS STK_LOC_CD
                        </isNull>
                        <!-- END 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                        ,UPPER(STS.STK_STS_NM)               AS STK_STS_NM
                        ,#inboundInvty#                      AS INVTY_STS_CD
                        ,NULL                                AS SER_NUM
                        ,NULL                                AS RSVD_FIRST_CD
                        ,#S21#                               AS INVTY_SRC_CD
                        ,PRDT.PRCH_REQ_NUM
                        ,PRDT.PRCH_REQ_LINE_NUM
                     FROM
                         PRCH_REQ           PRRQ
                        ,PRCH_REQ_DTL       PRDT
                        ,PRCH_REQ_LINE_STS  PRLS
                        ,PRCH_REQ_TP        PRRT
                        ,PRCH_REQ_APVL_STS  PRAS
                        ,SHPG_PLN           SP
                        ,SHPG_STS           SS
                        ,(SELECT
                             P.GLBL_CMPY_CD
                            ,P.SO_NUM
                            ,P.SO_SLP_NUM
                            ,P.PKT_STS_TS
                          FROM
                             PKT P
                             ,(SELECT
                                   MP.GLBL_CMPY_CD
                                  ,MP.SO_NUM
                                  ,MP.SO_SLP_NUM
                                  ,MAX(MP.PKT_SQ_NUM) MAX_PKT_SQ_NUM
                               FROM
                                   PKT MP
                               WHERE
                                   MP.EZCANCELFLAG = '0'
                               GROUP BY
                                   MP.GLBL_CMPY_CD
                                  ,MP.SO_NUM
                                  ,MP.SO_SLP_NUM
                              ) M
                          WHERE
                              P.GLBL_CMPY_CD = M.GLBL_CMPY_CD
                          AND P.SO_NUM       = M.SO_NUM
                          AND P.SO_SLP_NUM   = M.SO_SLP_NUM
                          AND P.PKT_SQ_NUM   = M.MAX_PKT_SQ_NUM
                         ) PKT
                        <!-- START 2021/12/07 [QC#58989-3, DEL] -->
                        <!-- ,INVTY                 I -->
                        <!-- END 2021/12/07 [QC#58989-3, DEL] -->
                        ,MDSE                  M
                        ,RTL_SWH               RS
                        ,RTL_WH                RW
                        ,STK_STS               STS
                        ,TRD_PTNR_WH_RG_XREF   TPWRX
                    WHERE
                        PRRQ.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND PRRQ.EZCANCELFLAG          = '0'
                    AND PRRQ.PRCH_REQ_TP_CD        = #kitting#
                    AND PRRQ.PRCH_REQ_REC_TP_CD    = #invtyReq#
                    AND PRRQ.PRCH_REQ_STS_CD       = #openStatus#
                    AND PRRQ.GLBL_CMPY_CD          = PRDT.GLBL_CMPY_CD
                    AND PRRQ.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
                    AND PRDT.EZCANCELFLAG          = '0'
                    AND PRDT.FROM_STK_STS_CD       = #goodStkSts#
                    AND PRDT.WRK_ORD_NUM           IS NULL
                    AND PRDT.GLBL_CMPY_CD          = PRLS.GLBL_CMPY_CD
                    AND PRDT.PRCH_REQ_LINE_STS_CD  = PRLS.PRCH_REQ_LINE_STS_CD
                    AND PRLS.EZCANCELFLAG          = '0'
                    AND PRRQ.GLBL_CMPY_CD          = PRRT.GLBL_CMPY_CD
                    AND PRRQ.PRCH_REQ_TP_CD        = PRRT.PRCH_REQ_TP_CD
                    AND PRRT.EZCANCELFLAG          = '0'
                    AND PRRQ.GLBL_CMPY_CD          = PRAS.GLBL_CMPY_CD
                    AND PRRQ.PRCH_REQ_APVL_STS_CD  = PRAS.PRCH_REQ_APVL_STS_CD
                    AND PRAS.PRCH_REQ_APVL_FLG     = #flagY#
                    AND PRAS.EZCANCELFLAG          = '0'
                    AND PRDT.GLBL_CMPY_CD          = SP.GLBL_CMPY_CD(+)
                    AND PRDT.PRCH_REQ_NUM          = SP.TRX_HDR_NUM(+)
                    AND PRDT.PRCH_REQ_LINE_NUM     = SP.TRX_LINE_NUM(+)
                    AND SP.EZCANCELFLAG(+)         = '0'
                    AND SP.GLBL_CMPY_CD            = SS.GLBL_CMPY_CD(+)
                    AND SP.SHPG_STS_CD             = SS.SHPG_STS_CD(+)
                    AND SS.EZCANCELFLAG(+)         = '0'
                    AND SP.GLBL_CMPY_CD            = PKT.GLBL_CMPY_CD(+)
                    AND SP.SO_NUM                  = PKT.SO_NUM(+)
                    AND SP.SO_SLP_NUM              = PKT.SO_SLP_NUM(+)
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND PRDT.GLBL_CMPY_CD          = I.GLBL_CMPY_CD
                    AND PRDT.DEST_INVTY_LOC_CD     = I.INVTY_LOC_CD
                    AND PRDT.MDSE_CD               = I.MDSE_CD
                    AND PRDT.TO_STK_STS_CD         = I.STK_STS_CD
                    AND I.STK_STS_CD               = #goodStkSts#
                    AND I.EZCANCELFLAG             = '0'
                    AND M.GLBL_CMPY_CD             = I.GLBL_CMPY_CD
                    AND M.MDSE_CD                  = I.MDSE_CD -->
                    AND PRDT.TO_STK_STS_CD         = #goodStkSts#
                    AND PRDT.GLBL_CMPY_CD          = M.GLBL_CMPY_CD
                    AND PRDT.MDSE_CD               = M.MDSE_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND M.EXP_ITEM_FLG      &lt;&gt; #flagY#
                    <iterate property="includeMdseSts" var="includeMdseSts[]"
                    open="AND M.MDSE_ITEM_STS_CD IN  (" conjunction=", " close=")"> #includeMdseSts[]#
                    </iterate>
                    <iterate property="includeMdseTp" var="includeMdseTp[]"
                    open="AND M.MDSE_ITEM_TP_CD IN  (" conjunction=", " close=")"> #includeMdseTp[]#
                    </iterate>
                    <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                    open="AND M.MDSE_ITEM_CLS_TP_CD IN  (" conjunction=", " close=")"> #includeMdseClsTp[]#
                    </iterate>
                    AND M.EZCANCELFLAG             = '0'
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND RS.GLBL_CMPY_CD            = I.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD            = I.INVTY_LOC_CD -->
                    AND RS.GLBL_CMPY_CD            = PRDT.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD            = PRDT.DEST_INVTY_LOC_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND RS.EZCANCELFLAG            = '0'
                    AND TPWRX.GLBL_CMPY_CD         = RS.GLBL_CMPY_CD
                    AND TPWRX.RTL_WH_CD            = RS.RTL_WH_CD
                    AND TPWRX.RTL_SWH_CD           = RS.RTL_SWH_CD
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    <isNotNull property="inboundTrgtWhList">
                    <isEqual property="inbdInclMNX" compareValue="Y">
                    AND (TPWRX.RTL_WH_CD IN
                    <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundTrgtWhList[]#
                    </iterate>
                        OR (RW.RTL_WH_CD               = TPWRX.RTL_WH_CD
                        AND RW.WH_OWNR_CD              = #whOwnrCd#
                        AND RW.EZCANCELFLAG            = '0'
                        )
                    )
                    </isEqual>
                    <isEqual property="inbdInclMNX" compareValue="N">
                    AND TPWRX.RTL_WH_CD IN
                    <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundTrgtWhList[]#
                    </iterate>
                    </isEqual>
                    </isNotNull>
                    <isNull property="inboundTrgtWhList">
                    AND TPWRX.RTL_WH_CD IN              #emptyList#
                    </isNull>
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    AND TPWRX.EZCANCELFLAG         = '0'
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!--
                    AND RW.GLBL_CMPY_CD            = RS.GLBL_CMPY_CD
                    AND RW.RTL_WH_CD               = RS.RTL_WH_CD
                    AND RW.WH_OWNR_CD              = #whOwnrCd#
                    AND RW.EZCANCELFLAG            = '0'
                    -->
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND STS.GLBL_CMPY_CD           = I.GLBL_CMPY_CD
                    AND STS.STK_STS_CD             = I.STK_STS_CD -->
                    AND STS.GLBL_CMPY_CD           = PRDT.GLBL_CMPY_CD
                    AND STS.STK_STS_CD             = PRDT.TO_STK_STS_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND STS.EZCANCELFLAG           = '0'
                )
                GROUP BY MDSE_CD
                        ,WH_RG_CD
                        ,RTL_WH_CD
                        ,STK_LOC_CD
                        ,STK_STS_NM
                        ,INVTY_STS_CD
                        ,SER_NUM
                        ,RSVD_FIRST_CD
                        ,INVTY_SRC_CD
                <!-- Work Order (Kit) for MNX warehouse -->
                UNION ALL
                SELECT DISTINCT
                    SUM(FNSH_GOODS_BAL_QTY) VIS_QTY
                   ,MDSE_CD
                   ,WH_RG_CD
                   ,RTL_WH_CD
                   ,STK_LOC_CD
                   ,STK_STS_NM
                   ,INVTY_STS_CD
                   ,SER_NUM
                   ,RSVD_FIRST_CD
                   ,INVTY_SRC_CD
                FROM (
                    SELECT DISTINCT
                        WKOD.FNSH_GOODS_BAL_QTY
                       ,WKOD.FNSH_GOODS_MDSE_CD             AS MDSE_CD
                       ,TPWRX.TRD_PTNR_WH_RG_NM             AS WH_RG_CD
                       <!-- START 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                       <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)   AS RTL_WH_CD -->
                       <!-- ,#stkLocCd#                          AS STK_LOC_CD -->
                       <isEqual property="convtFlg" compareValue="Y">
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD IN
                           <iterate property="convtFromWhList" var="convtFromWhList[]" open="(" close=")" conjunction=",">
                               #convtFromWhList[]#
                           </iterate>
                           THEN #convtIntoWh#
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD) -->
                           ELSE NVL(RS.RTL_WH_CD, WKOD.RCV_INVTY_LOC_CD)
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       END RTL_WH_CD 
                       </isEqual>
                       <isEqual property="convtFlg" compareValue="N">
                       <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                       <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD -->
                       ,NVL(RS.RTL_WH_CD, WKOD.RCV_INVTY_LOC_CD)  AS RTL_WH_CD
                       <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       </isEqual>
                       <isNotNull property="stkLocCdList">
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD || TPWRX.RTL_SWH_CD IN
                           <iterate property="stkLocCdList" var="stkLocCdList[]" open="(" close=")" conjunction=",">
                               #stkLocCdList[]#
                           </iterate>
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- THEN I.INVTY_LOC_CD -->
                           THEN WKOD.RCV_INVTY_LOC_CD
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                           ELSE #stkLocCd#
                       END STK_LOC_CD
                       </isNotNull>
                       <isNull property="stkLocCdList">
                       ,#stkLocCd#                         AS STK_LOC_CD
                       </isNull>
                       <!-- END 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                       ,UPPER(SS.STK_STS_NM)                AS STK_STS_NM
                       ,#inboundInvty#                      AS INVTY_STS_CD
                       ,NULL                                AS SER_NUM
                       ,NULL                                AS RSVD_FIRST_CD
                       ,#S21#                               AS INVTY_SRC_CD
                       ,WKOD.WRK_ORD_NUM
                    FROM
                        WRK_ORD                WKOD
                       ,DS_WRK_ORD_TP          DWOT
                       ,WRK_ORD_STS            WOS
                       <!-- START 2021/12/07 [QC#58989-3, DEL] -->
                       <!-- ,INVTY                  I -->
                       <!-- END 2021/12/07 [QC#58989-3, DEL] -->
                       ,MDSE                   M
                       ,RTL_SWH                RS
                       ,RTL_WH                 RW
                       ,STK_STS                SS
                       ,TRD_PTNR_WH_RG_XREF    TPWRX
                    WHERE
                        WKOD.GLBL_CMPY_CD                     = #glblCmpyCd#
                    AND WKOD.EZCANCELFLAG                     = '0'
                    <iterate property="incldWrkOrdSts" var="incldWrkOrdSts[]"
                    open="AND WKOD.WRK_ORD_STS_CD IN  (" conjunction=", " close=")"> #incldWrkOrdSts[]#
                    </iterate>
                    AND WKOD.FNSH_GOODS_BAL_QTY               &gt; #ZERO#
                    AND WKOD.DS_WRK_ORD_TP_CD                 = #kitDsWrkOrdTp#
                    AND WKOD.GLBL_CMPY_CD                     = DWOT.GLBL_CMPY_CD
                    AND WKOD.DS_WRK_ORD_TP_CD                 = DWOT.DS_WRK_ORD_TP_CD
                    AND DWOT.EZCANCELFLAG                     = '0'
                    AND WKOD.GLBL_CMPY_CD                     = WOS.GLBL_CMPY_CD
                    AND WKOD.WRK_ORD_STS_CD                   = WOS.WRK_ORD_STS_CD
                    AND WOS.EZCANCELFLAG                      = '0'
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND WKOD.GLBL_CMPY_CD                     = I.GLBL_CMPY_CD
                    AND WKOD.RCV_INVTY_LOC_CD                 = I.INVTY_LOC_CD
                    AND WKOD.FNSH_GOODS_MDSE_CD               = I.MDSE_CD
                    AND WKOD.STK_STS_CD                       = I.STK_STS_CD
                    AND I.STK_STS_CD                          = #goodStkSts#
                    AND I.EZCANCELFLAG                        = '0'
                    AND M.GLBL_CMPY_CD                        = I.GLBL_CMPY_CD
                    AND M.MDSE_CD                             = I.MDSE_CD -->
                    AND WKOD.STK_STS_CD                       = #goodStkSts#
                    AND WKOD.GLBL_CMPY_CD                     = M.GLBL_CMPY_CD
                    AND WKOD.FNSH_GOODS_MDSE_CD               = M.MDSE_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND M.EXP_ITEM_FLG                 &lt;&gt; #flagY#
                    <iterate property="includeMdseSts" var="includeMdseSts[]"
                    open="AND M.MDSE_ITEM_STS_CD IN  (" conjunction=", " close=")"> #includeMdseSts[]#
                    </iterate>
                    <iterate property="includeMdseTp" var="includeMdseTp[]"
                    open="AND M.MDSE_ITEM_TP_CD IN  (" conjunction=", " close=")"> #includeMdseTp[]#
                    </iterate>
                    <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                    open="AND M.MDSE_ITEM_CLS_TP_CD IN  (" conjunction=", " close=")"> #includeMdseClsTp[]#
                    </iterate>
                    AND M.EZCANCELFLAG                        = '0'
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND RS.GLBL_CMPY_CD                       = I.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD                       = I.INVTY_LOC_CD -->
                    AND RS.GLBL_CMPY_CD                       = WKOD.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD                       = WKOD.RCV_INVTY_LOC_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND RS.EZCANCELFLAG                       = '0'
                    AND TPWRX.GLBL_CMPY_CD                    = RS.GLBL_CMPY_CD
                    AND TPWRX.RTL_WH_CD                       = RS.RTL_WH_CD
                    AND TPWRX.RTL_SWH_CD                      = RS.RTL_SWH_CD
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    <isNotNull property="inboundTrgtWhList">
                    <isEqual property="inbdInclMNX" compareValue="Y">
                    AND (TPWRX.RTL_WH_CD IN
                    <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundTrgtWhList[]#
                    </iterate>
                        OR (RW.RTL_WH_CD               = TPWRX.RTL_WH_CD
                        AND RW.WH_OWNR_CD              = #whOwnrCd#
                        AND RW.EZCANCELFLAG            = '0'
                        )
                    )
                    </isEqual>
                    <isEqual property="inbdInclMNX" compareValue="N">
                    AND TPWRX.RTL_WH_CD IN
                    <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundTrgtWhList[]#
                    </iterate>
                    </isEqual>
                    </isNotNull>
                    <isNull property="inboundTrgtWhList">
                        AND TPWRX.RTL_WH_CD IN         #emptyList#
                    </isNull>
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    AND TPWRX.EZCANCELFLAG                    = '0'
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!--
                    AND RW.GLBL_CMPY_CD                       = RS.GLBL_CMPY_CD
                    AND RW.RTL_WH_CD                          = RS.RTL_WH_CD
                    AND RW.WH_OWNR_CD                         = #whOwnrCd#
                    AND RW.EZCANCELFLAG                       = '0'
                    -->
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND SS.GLBL_CMPY_CD                       = I.GLBL_CMPY_CD
                    AND SS.STK_STS_CD                         = I.STK_STS_CD -->
                    AND SS.GLBL_CMPY_CD                       = WKOD.GLBL_CMPY_CD
                    AND SS.STK_STS_CD                         = WKOD.STK_STS_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND SS.EZCANCELFLAG                       = '0'
                )
                GROUP BY MDSE_CD
                        ,WH_RG_CD
                        ,RTL_WH_CD
                        ,STK_LOC_CD
                        ,STK_STS_NM
                        ,INVTY_STS_CD
                        ,SER_NUM
                        ,RSVD_FIRST_CD
                        ,INVTY_SRC_CD
                <!-- Reman Order for MNX warehouse -->
                UNION ALL
                SELECT DISTINCT
                    SUM(VIS_QTY)
                   ,MDSE_CD
                   ,WH_RG_CD
                   ,RTL_WH_CD
                   ,STK_LOC_CD
                   ,STK_STS_NM
                   ,INVTY_STS_CD
                   ,SER_NUM
                   ,RSVD_FIRST_CD
                   ,INVTY_SRC_CD
                FROM (
                    SELECT 
                        RPR.PRT_RQST_QTY                    AS VIS_QTY
                       ,RPR.MDSE_CD
                       ,TPWRX.TRD_PTNR_WH_RG_NM             AS WH_RG_CD
                       <!-- START 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                       <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)   AS RTL_WH_CD -->
                       <!-- ,#stkLocCd#                          AS STK_LOC_CD -->
                       <isEqual property="convtFlg" compareValue="Y">
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD IN
                           <iterate property="convtFromWhList" var="convtFromWhList[]" open="(" close=")" conjunction=",">
                               #convtFromWhList[]#
                           </iterate>
                           THEN #convtIntoWh#
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD) -->
                           ELSE NVL(RS.RTL_WH_CD, ROH.RMNF_INVTY_LOC_CD)
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       END RTL_WH_CD 
                       </isEqual>
                       <isEqual property="convtFlg" compareValue="N">
                       <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                       <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD -->
                       ,NVL(RS.RTL_WH_CD, ROH.RMNF_INVTY_LOC_CD)  AS RTL_WH_CD
                       <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       </isEqual>
                       <isNotNull property="stkLocCdList">
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD || TPWRX.RTL_SWH_CD IN
                           <iterate property="stkLocCdList" var="stkLocCdList[]" open="(" close=")" conjunction=",">
                               #stkLocCdList[]#
                           </iterate>
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- THEN I.INVTY_LOC_CD -->
                           THEN ROH.RMNF_INVTY_LOC_CD
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                           ELSE #stkLocCd#
                       END STK_LOC_CD
                       </isNotNull>
                       <isNull property="stkLocCdList">
                       ,#stkLocCd#                         AS STK_LOC_CD
                       </isNull>
                       <!-- END 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                       ,UPPER(STS.STK_STS_NM)               AS STK_STS_NM
                       ,#inboundInvty#                      AS INVTY_STS_CD
                       ,NULL                                AS SER_NUM
                       ,NULL                                AS RSVD_FIRST_CD
                       ,#S21#                               AS INVTY_SRC_CD
                       ,SOD.SHPG_STS_CD
                       ,ROH.RMNF_ORD_NUM
                       ,RPR.RMNF_PRT_REQ_LINE_NUM
                    FROM   
                        RMNF_ORD               ROH
                       ,RMNF_ORD_DTL           ROD
                       ,RMNF_PRT_REQ           RPR
                       ,RMNF_ORD_TP            ROT
                       ,SHPG_ORD_DTL           SOD
                       ,RMNF_ORD_STS           ROS
                       ,SHPG_STS               SS
                       ,(SELECT
                             P.GLBL_CMPY_CD
                            ,P.SO_NUM
                            ,P.SO_SLP_NUM
                            ,P.PKT_STS_TS
                         FROM
                             PKT P
                            ,(SELECT
                                  MP.GLBL_CMPY_CD
                                 ,MP.SO_NUM
                                 ,MP.SO_SLP_NUM
                                 ,MAX(MP.PKT_SQ_NUM) MAX_PKT_SQ_NUM
                              FROM
                                  PKT MP
                              WHERE
                                  MP.EZCANCELFLAG = '0'
                              GROUP BY
                                  MP.GLBL_CMPY_CD
                                 ,MP.SO_NUM
                                 ,MP.SO_SLP_NUM
                              ) M
                         WHERE
                             P.GLBL_CMPY_CD = M.GLBL_CMPY_CD
                         AND P.SO_NUM       = M.SO_NUM
                         AND P.SO_SLP_NUM   = M.SO_SLP_NUM
                         AND P.PKT_SQ_NUM   = M.MAX_PKT_SQ_NUM
                       ) PKT
                       <!-- START 2021/12/07 [QC#58989-3, DEL] -->
                       <!-- ,INVTY                 I -->
                       <!-- END 2021/12/07 [QC#58989-3, DEL] -->
                       ,MDSE                  M
                       ,RTL_SWH               RS
                       ,RTL_WH                RW
                       ,STK_STS               STS
                       ,TRD_PTNR_WH_RG_XREF   TPWRX
                    WHERE  
                        ROH.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND ROH.EZCANCELFLAG          = '0'
                    AND ROH.GLBL_CMPY_CD          = ROD.GLBL_CMPY_CD
                    AND ROH.RMNF_ORD_NUM          = ROD.RMNF_ORD_NUM
                    AND ROD.EZCANCELFLAG          = '0'
                    AND ROH.GLBL_CMPY_CD          = RPR.GLBL_CMPY_CD
                    AND ROH.RMNF_ORD_NUM          = RPR.RMNF_ORD_NUM
                    AND RPR.EZCANCELFLAG          = '0'
                    AND ROH.GLBL_CMPY_CD          = ROT.GLBL_CMPY_CD
                    AND ROH.RMNF_ORD_TP_CD        = ROT.RMNF_ORD_TP_CD
                    AND ROT.EZCANCELFLAG          = '0'
                    AND RPR.GLBL_CMPY_CD          = SOD.GLBL_CMPY_CD(+)
                    AND RPR.RMNF_ORD_NUM          = SOD.TRX_HDR_NUM(+)
                    AND RPR.RMNF_PRT_REQ_LINE_NUM = SOD.TRX_LINE_NUM(+)
                    AND SOD.EZCANCELFLAG(+)       = '0'
                    AND ROH.GLBL_CMPY_CD          = ROS.GLBL_CMPY_CD
                    AND ROH.RMNF_ORD_STS_CD       = ROS.RMNF_ORD_STS_CD
                    AND ROS.OPEN_STS_FLG          = #flagY#
                    AND ROS.EZCANCELFLAG          = '0'
                    AND SOD.GLBL_CMPY_CD          = SS.GLBL_CMPY_CD(+)
                    AND SOD.SHPG_STS_CD           = SS.SHPG_STS_CD(+)
                    AND SS.EZCANCELFLAG(+)        = '0'
                    AND SOD.GLBL_CMPY_CD          = PKT.GLBL_CMPY_CD(+)
                    AND SOD.SO_NUM                = PKT.SO_NUM(+)
                    AND SOD.SO_SLP_NUM            = PKT.SO_SLP_NUM(+)
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND ROH.GLBL_CMPY_CD          = I.GLBL_CMPY_CD
                    AND ROH.RMNF_INVTY_LOC_CD     = I.INVTY_LOC_CD
                    AND RPR.MDSE_CD               = I.MDSE_CD
                    AND ROD.STK_STS_CD            = I.STK_STS_CD
                    AND I.STK_STS_CD              = #goodStkSts#
                    AND I.EZCANCELFLAG            = '0'
                    AND M.GLBL_CMPY_CD            = I.GLBL_CMPY_CD
                    AND M.MDSE_CD                 = I.MDSE_CD -->
                    AND ROD.STK_STS_CD            = #goodStkSts#
                    AND RPR.GLBL_CMPY_CD          = M.GLBL_CMPY_CD
                    AND RPR.MDSE_CD               = M.MDSE_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND M.EXP_ITEM_FLG     &lt;&gt; #flagY#
                    <iterate property="includeMdseSts" var="includeMdseSts[]"
                    open="AND M.MDSE_ITEM_STS_CD IN  (" conjunction=", " close=")"> #includeMdseSts[]#
                    </iterate>
                    <iterate property="includeMdseTp" var="includeMdseTp[]"
                    open="AND M.MDSE_ITEM_TP_CD IN  (" conjunction=", " close=")"> #includeMdseTp[]#
                    </iterate>
                    <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                    open="AND M.MDSE_ITEM_CLS_TP_CD IN  (" conjunction=", " close=")"> #includeMdseClsTp[]#
                    </iterate>
                    AND M.EZCANCELFLAG            = '0'
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND RS.GLBL_CMPY_CD           = I.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD           = I.INVTY_LOC_CD -->
                    AND RS.GLBL_CMPY_CD           = ROH.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD           = ROH.RMNF_INVTY_LOC_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND RS.EZCANCELFLAG           = '0'
                    AND TPWRX.GLBL_CMPY_CD        = RS.GLBL_CMPY_CD
                    AND TPWRX.RTL_WH_CD           = RS.RTL_WH_CD
                    AND TPWRX.RTL_SWH_CD          = RS.RTL_SWH_CD
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    <isNotNull property="inboundTrgtWhList">
                    <isEqual property="inbdInclMNX" compareValue="Y">
                    AND (TPWRX.RTL_WH_CD IN
                    <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundTrgtWhList[]#
                    </iterate>
                        OR (RW.RTL_WH_CD               = TPWRX.RTL_WH_CD
                        AND RW.WH_OWNR_CD              = #whOwnrCd#
                        AND RW.EZCANCELFLAG            = '0'
                        )
                    )
                    </isEqual>
                    <isEqual property="inbdInclMNX" compareValue="N">
                    AND TPWRX.RTL_WH_CD IN
                    <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundTrgtWhList[]#
                    </iterate>
                    </isEqual>
                    </isNotNull>
                    <isNull property="inboundTrgtWhList">
                        AND TPWRX.RTL_WH_CD IN          #emptyList#
                    </isNull>
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    AND TPWRX.EZCANCELFLAG        = '0'
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!--
                    AND RW.GLBL_CMPY_CD           = RS.GLBL_CMPY_CD
                    AND RW.RTL_WH_CD              = RS.RTL_WH_CD
                    AND RW.WH_OWNR_CD             = #whOwnrCd#
                    AND RW.EZCANCELFLAG           = '0'
                    -->
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND STS.GLBL_CMPY_CD          = I.GLBL_CMPY_CD
                    AND STS.STK_STS_CD            = I.STK_STS_CD -->
                    AND STS.GLBL_CMPY_CD          = ROD.GLBL_CMPY_CD
                    AND STS.STK_STS_CD            = ROD.STK_STS_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND STS.EZCANCELFLAG          = '0'
                )
                WHERE
                    NVL(SHPG_STS_CD , 0)  &lt; #shippedShpgSts#
                GROUP BY MDSE_CD
                        ,WH_RG_CD
                        ,RTL_WH_CD
                        ,STK_LOC_CD
                        ,STK_STS_NM
                        ,INVTY_STS_CD
                        ,SER_NUM
                        ,RSVD_FIRST_CD
                        ,INVTY_SRC_CD
                UNION ALL
                SELECT DISTINCT
                    SUM(SCHD_INBD_QTY) VIS_QTY
                   ,MDSE_CD
                   ,WH_RG_CD
                   ,RTL_WH_CD
                   ,STK_LOC_CD
                   ,STK_STS_NM
                   ,INVTY_STS_CD
                   ,SER_NUM
                   ,RSVD_FIRST_CD
                   ,INVTY_SRC_CD
                FROM (
                    SELECT DISTINCT 
                        1                                   SCHD_INBD_QTY
                       ,ROD.RMNF_TO_CMPT_MDSE_CD            AS MDSE_CD
                       ,TPWRX.TRD_PTNR_WH_RG_NM             AS WH_RG_CD
                       <!-- START 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                       <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)   AS RTL_WH_CD -->
                       <!-- ,#stkLocCd#                          AS STK_LOC_CD -->
                       <isEqual property="convtFlg" compareValue="Y">
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD IN
                           <iterate property="convtFromWhList" var="convtFromWhList[]" open="(" close=")" conjunction=",">
                               #convtFromWhList[]#
                           </iterate>
                           THEN #convtIntoWh#
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD) -->
                           ELSE NVL(RS.RTL_WH_CD, ROH.RMNF_RTL_WH_CD || ROH.RMNF_RTL_SWH_CD)
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       END RTL_WH_CD 
                       </isEqual>
                       <isEqual property="convtFlg" compareValue="N">
                       <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                       <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD -->
                       ,NVL(RS.RTL_WH_CD, ROH.RMNF_RTL_WH_CD || ROH.RMNF_RTL_SWH_CD)  AS RTL_WH_CD
                       <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       </isEqual>
                       <isNotNull property="stkLocCdList">
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD || TPWRX.RTL_SWH_CD IN
                           <iterate property="stkLocCdList" var="stkLocCdList[]" open="(" close=")" conjunction=",">
                               #stkLocCdList[]#
                           </iterate>
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- THEN I.INVTY_LOC_CD -->
                           THEN ROH.RMNF_RTL_WH_CD || ROH.RMNF_RTL_SWH_CD
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                           ELSE #stkLocCd#
                       END STK_LOC_CD
                       </isNotNull>
                       <isNull property="stkLocCdList">
                       ,#stkLocCd#                         AS STK_LOC_CD
                       </isNull>
                       <!-- END 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                       ,UPPER(SS.STK_STS_NM)                AS STK_STS_NM
                       ,#inboundInvty#                      AS INVTY_STS_CD
                       ,NULL                                AS SER_NUM
                       ,NULL                                AS RSVD_FIRST_CD
                       ,#S21#                               AS INVTY_SRC_CD
                       ,ROH.RMNF_ORD_NUM
                       ,ROD.RMNF_ORD_DTL_LINE_NUM
                    FROM   
                        RMNF_ORD              ROH
                       ,RMNF_ORD_DTL          ROD
                       ,RMNF_ORD_STS          ROS
                       ,RWS_HDR               RWH
                       ,RMNF_ORD_TP           ROT
                       <!-- START 2021/12/07 [QC#58989-3, DEL] -->
                       <!-- ,INVTY                 I -->
                       <!-- END 2021/12/07 [QC#58989-3, DEL] -->
                       ,MDSE                  M
                       ,RTL_SWH               RS
                       ,RTL_WH                RW
                       ,STK_STS               SS
                       ,TRD_PTNR_WH_RG_XREF   TPWRX
                    WHERE  
                        ROH.GLBL_CMPY_CD                          = #glblCmpyCd#
                    AND ROH.EZCANCELFLAG                          = '0'
                    AND ROH.GLBL_CMPY_CD                          = ROD.GLBL_CMPY_CD
                    AND ROH.RMNF_ORD_NUM                          = ROD.RMNF_ORD_NUM
                    AND ROD.EZCANCELFLAG                          = '0'
                    AND ROH.GLBL_CMPY_CD                          = ROS.GLBL_CMPY_CD
                    AND ROH.RMNF_ORD_STS_CD                       = ROS.RMNF_ORD_STS_CD
                    AND ROS.OPEN_STS_FLG                          = #flagY#
                    AND ROS.EZCANCELFLAG                          = '0'
                    AND ROD.GLBL_CMPY_CD                          = RWH.GLBL_CMPY_CD(+)
                    AND ROD.RMNF_ORD_NUM                          = RWH.PO_RCV_TRX_HDR_NUM(+)
                    AND RWH.EZCANCELFLAG(+)                       = '0'
                    AND ROH.GLBL_CMPY_CD                          = ROT.GLBL_CMPY_CD
                    AND ROH.RMNF_ORD_TP_CD                        = ROT.RMNF_ORD_TP_CD
                    AND ROT.EZCANCELFLAG                          = '0'
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND ROH.GLBL_CMPY_CD                          = I.GLBL_CMPY_CD
                    AND ROH.RMNF_RTL_WH_CD || ROH.RMNF_RTL_SWH_CD = I.INVTY_LOC_CD
                    AND ROD.RMNF_TO_CMPT_MDSE_CD                  = I.MDSE_CD
                    AND ROD.STK_STS_CD                            = I.STK_STS_CD
                    AND I.STK_STS_CD                              = #goodStkSts#
                    AND I.EZCANCELFLAG                            = '0'
                    AND M.GLBL_CMPY_CD                            = I.GLBL_CMPY_CD
                    AND M.MDSE_CD                                 = I.MDSE_CD -->
                    AND ROD.STK_STS_CD                            = #goodStkSts#
                    AND ROD.GLBL_CMPY_CD                          = M.GLBL_CMPY_CD
                    AND ROD.RMNF_TO_CMPT_MDSE_CD                  = M.MDSE_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND M.EXP_ITEM_FLG                     &lt;&gt; #flagY#
                    <iterate property="includeMdseSts" var="includeMdseSts[]"
                    open="AND M.MDSE_ITEM_STS_CD IN  (" conjunction=", " close=")"> #includeMdseSts[]#
                    </iterate>
                    <iterate property="includeMdseTp" var="includeMdseTp[]"
                    open="AND M.MDSE_ITEM_TP_CD IN  (" conjunction=", " close=")"> #includeMdseTp[]#
                    </iterate>
                    <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                    open="AND M.MDSE_ITEM_CLS_TP_CD IN  (" conjunction=", " close=")"> #includeMdseClsTp[]#
                    </iterate>
                    AND M.EZCANCELFLAG                            = '0'
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND RS.GLBL_CMPY_CD                           = I.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD                           = I.INVTY_LOC_CD -->
                    AND RS.GLBL_CMPY_CD                           = ROH.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD                           = ROH.RMNF_RTL_WH_CD || ROH.RMNF_RTL_SWH_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND RS.EZCANCELFLAG                           = '0'
                    AND TPWRX.GLBL_CMPY_CD                        = RS.GLBL_CMPY_CD
                    AND TPWRX.RTL_WH_CD                           = RS.RTL_WH_CD
                    AND TPWRX.RTL_SWH_CD                          = RS.RTL_SWH_CD
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    <isNotNull property="inboundTrgtWhList">
                    <isEqual property="inbdInclMNX" compareValue="Y">
                    AND (TPWRX.RTL_WH_CD IN
                    <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundTrgtWhList[]#
                    </iterate>
                        OR (RW.RTL_WH_CD               = TPWRX.RTL_WH_CD
                        AND RW.WH_OWNR_CD              = #whOwnrCd#
                        AND RW.EZCANCELFLAG            = '0'
                        )
                    )
                    </isEqual>
                    <isEqual property="inbdInclMNX" compareValue="N">
                    AND TPWRX.RTL_WH_CD IN
                    <iterate property="inboundTrgtWhList" var="inboundTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundTrgtWhList[]#
                    </iterate>
                    </isEqual>
                    </isNotNull>
                    <isNull property="inboundTrgtWhList">
                        AND TPWRX.RTL_WH_CD IN          #emptyList#
                    </isNull>
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    AND TPWRX.EZCANCELFLAG                        = '0'
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!--
                    AND RW.GLBL_CMPY_CD                           = RS.GLBL_CMPY_CD
                    AND RW.RTL_WH_CD                              = RS.RTL_WH_CD
                    AND RW.WH_OWNR_CD                             = #whOwnrCd#
                    AND RW.EZCANCELFLAG                           = '0'
                    -->
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND SS.GLBL_CMPY_CD                           = I.GLBL_CMPY_CD
                    AND SS.STK_STS_CD                             = I.STK_STS_CD -->
                    AND SS.GLBL_CMPY_CD                           = ROD.GLBL_CMPY_CD
                    AND SS.STK_STS_CD                             = ROD.STK_STS_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND SS.EZCANCELFLAG                           = '0'
                )
                GROUP BY MDSE_CD
                        ,WH_RG_CD
                        ,RTL_WH_CD
                        ,STK_LOC_CD
                        ,STK_STS_NM
                        ,INVTY_STS_CD
                        ,SER_NUM
                        ,RSVD_FIRST_CD
                        ,INVTY_SRC_CD
                <!-- Inventory Requisition (before shipping) for 2P1/3Z1ITA warehouse -->
                UNION ALL
                SELECT DISTINCT
                    SUM(SCHD_QTY) VIS_QTY
                   ,MDSE_CD
                   ,WH_RG_CD
                   ,RTL_WH_CD
                   ,STK_LOC_CD
                   ,STK_STS_NM
                   ,INVTY_STS_CD
                   ,SER_NUM
                   ,RSVD_FIRST_CD
                   ,INVTY_SRC_CD
                FROM (
                    SELECT DISTINCT
                        PRDT.PRCH_REQ_QTY - PRDT.SHIP_QTY   AS SCHD_QTY
                       ,PRDT.MDSE_CD                        AS MDSE_CD
                       <!-- 2024/04/03 QC#63814 Mod Start -->
                       <!-- ,TPWRX.TRD_PTNR_WH_RG_NM             AS WH_RG_CD -->
                       ,CASE
                          WHEN RS.RTL_SWH_CD = #cmpToSWh#
                          THEN (
                             SELECT TPWRXF.TRD_PTNR_WH_RG_NM AS TRD_PTNR_WH_RG_NM
                             FROM TRD_PTNR_WH_RG_XREF TPWRXF
                             WHERE GLBL_CMPY_CD              = #glblCmpyCd#
                             AND TPWRXF.RTL_WH_CD            = #3Z1#
                             AND TPWRXF.RTL_SWH_CD           = #cmpToSWh#
                             AND TPWRXF.TRD_PTNR_WH_RG_TP_CD = #trdPtnrWhTgTpCdCSA#
                             AND TPWRXF.EZCANCELFLAG         = '0'
                             )
                          ELSE (
                             SELECT TPWRXF.TRD_PTNR_WH_RG_NM AS TRD_PTNR_WH_RG_NM
                             FROM TRD_PTNR_WH_RG_XREF TPWRXF
                             WHERE GLBL_CMPY_CD              = RS.GLBL_CMPY_CD
                             AND TPWRXF.RTL_WH_CD            = RS.RTL_WH_CD
                             AND TPWRXF.RTL_SWH_CD           = RS.RTL_SWH_CD
                             AND TPWRXF.EZCANCELFLAG         = '0'
                             )
                       END WH_RG_CD
                       <!-- 2024/04/03 QC#63814 Mod End -->
                       <!-- START 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                       <!--
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD = #3Z1# THEN #2P1#
                           ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)
                       END RTL_WH_CD
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD = #3Z1# THEN I.INVTY_LOC_CD
                           ELSE '0'
                       END STK_LOC_CD -->
                       <isEqual property="convtFlg" compareValue="Y">
                       ,CASE
                           <!-- 2024/04/03 QC#63814 Mod Start -->
                           <!-- WHEN TPWRX.RTL_WH_CD IN
                           <iterate property="convtFromWhList" var="convtFromWhList[]" open="(" close=")" conjunction=",">
                               #convtFromWhList[]#
                           </iterate> -->
                           WHEN RS.RTL_SWH_CD IN
                           <iterate property="convtFromSWhList" var="convtFromSWhList[]" open="(" close=")" conjunction=",">
                               #convtFromSWhList[]#
                           </iterate>
                           <!-- 2024/04/03 QC#63814 Mod End -->
                           THEN #convtIntoWh#
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD) -->
                           ELSE NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       END RTL_WH_CD 
                       </isEqual>
                       <isEqual property="convtFlg" compareValue="N">
                       <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                       <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD -->
                       ,NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)  AS RTL_WH_CD
                       <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       </isEqual>
                       <isNotNull property="stkLocCdList">
                       ,CASE
                           <!-- 2024/04/03 QC#63814 Mod Start -->
                           <!-- WHEN TPWRX.RTL_WH_CD || TPWRX.RTL_SWH_CD IN -->
                           WHEN RS.RTL_WH_CD || RS.RTL_SWH_CD IN
                           <!-- 2024/04/03 QC#63814 Mod End -->
                           <iterate property="stkLocCdList" var="stkLocCdList[]" open="(" close=")" conjunction=",">
                               #stkLocCdList[]#
                           </iterate>
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- THEN I.INVTY_LOC_CD -->
                           THEN PRDT.DEST_INVTY_LOC_CD
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                           ELSE #stkLocCd#
                       END STK_LOC_CD
                       </isNotNull>
                       <isNull property="stkLocCdList">
                       ,#stkLocCd#                         AS STK_LOC_CD
                       </isNull>
                       <!-- END 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                       ,UPPER(SS.STK_STS_NM)                AS STK_STS_NM
                       ,#inboundInvty#                      AS INVTY_STS_CD
                       ,NULL                                AS SER_NUM
                       ,NULL                                AS RSVD_FIRST_CD
                       ,#S21#                               AS INVTY_SRC_CD
                       ,PRDT.PRCH_REQ_NUM
                       ,PRDT.PRCH_REQ_LINE_NUM
                    FROM
                        PRCH_REQ              PRRQ
                       ,PRCH_REQ_DTL          PRDT
                       ,PRCH_REQ_APVL_STS     PRAS
                       ,PRCH_REQ_LINE_STS     PRLS
                       ,PRCH_REQ_TP           PRRT
                       <!-- START 2021/12/07 [QC#58989-3, DEL] -->
                       <!-- ,INVTY                 I -->
                       <!-- END 2021/12/07 [QC#58989-3, DEL] -->
                       ,MDSE                  M
                       ,RTL_SWH               RS
                       ,RTL_WH                RW
                       ,STK_STS               SS
                       <!-- 2024/04/03 QC#63814 Del Start -->
                       <!-- ,TRD_PTNR_WH_RG_XREF   TPWRX -->
                       <!-- 2024/04/03 QC#63814 Del Start -->
                    WHERE
                        PRRQ.GLBL_CMPY_CD                 = #glblCmpyCd#
                    AND PRRQ.PRCH_REQ_TP_CD          NOT IN(#whTransfer#, #expenseOrder#)
                    AND PRRQ.EZCANCELFLAG                 = '0'
                    AND PRRQ.PRCH_REQ_REC_TP_CD           = #invtyReq#
                    <iterate property="incldPrchReqSts" var="incldPrchReqSts[]"
                    open="AND PRRQ.PRCH_REQ_STS_CD IN (" conjunction=", " close=")"> #incldPrchReqSts[]#
                    </iterate>
                    AND NOT (
                        PRRQ.PRCH_REQ_APVL_STS_CD         = #prchReqApvlSts#
                    AND PRRQ.PRCH_REQ_SRC_TP_CD           = #prchReqSrcTp#
                    )
                    AND PRRQ.GLBL_CMPY_CD                 = PRDT.GLBL_CMPY_CD
                    AND PRRQ.PRCH_REQ_NUM                 = PRDT.PRCH_REQ_NUM
                    AND PRDT.EZCANCELFLAG                 = '0'
                    AND PRDT.PRCH_REQ_QTY - PRDT.SHIP_QTY &gt; #ZERO#
                    AND PRDT.RWS_NUM                      IS NULL
                    AND PRRQ.GLBL_CMPY_CD                 = PRAS.GLBL_CMPY_CD
                    AND PRRQ.PRCH_REQ_APVL_STS_CD         = PRAS.PRCH_REQ_APVL_STS_CD
                    AND PRAS.EZCANCELFLAG                 = '0'
                    AND PRDT.GLBL_CMPY_CD                 = PRLS.GLBL_CMPY_CD
                    AND PRDT.PRCH_REQ_LINE_STS_CD         = PRLS.PRCH_REQ_LINE_STS_CD
                    AND PRLS.EZCANCELFLAG                 = '0'
                    AND PRLS.OPEN_STS_FLG                 = #flagY#
                    AND PRRQ.GLBL_CMPY_CD                 = PRRT.GLBL_CMPY_CD
                    AND PRRQ.PRCH_REQ_TP_CD               = PRRT.PRCH_REQ_TP_CD
                    AND PRRT.EZCANCELFLAG                 = '0'
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND PRDT.GLBL_CMPY_CD                 = I.GLBL_CMPY_CD
                    AND PRDT.DEST_INVTY_LOC_CD            = I.INVTY_LOC_CD
                    AND PRDT.MDSE_CD                      = I.MDSE_CD
                    AND PRDT.TO_STK_STS_CD                = I.STK_STS_CD
                    AND I.STK_STS_CD                      = #goodStkSts#
                    AND I.EZCANCELFLAG                    = '0'
                    AND M.GLBL_CMPY_CD                    = I.GLBL_CMPY_CD
                    AND M.MDSE_CD                         = I.MDSE_CD -->
                    AND PRDT.TO_STK_STS_CD                = #goodStkSts#
                    AND PRDT.GLBL_CMPY_CD                 = M.GLBL_CMPY_CD
                    AND PRDT.MDSE_CD                      = M.MDSE_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND M.EXP_ITEM_FLG             &lt;&gt; #flagY# 
                    <iterate property="includeMdseSts" var="includeMdseSts[]"
                    open="AND M.MDSE_ITEM_STS_CD IN  (" conjunction=", " close=")"> #includeMdseSts[]#
                    </iterate>
                    <iterate property="includeMdseTp" var="includeMdseTp[]"
                    open="AND M.MDSE_ITEM_TP_CD IN  (" conjunction=", " close=")"> #includeMdseTp[]#
                    </iterate>
                    <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                    open="AND M.MDSE_ITEM_CLS_TP_CD IN  (" conjunction=", " close=")"> #includeMdseClsTp[]#
                    </iterate>
                    AND M.EZCANCELFLAG                    = '0'
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND RS.GLBL_CMPY_CD                   = I.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD                   = I.INVTY_LOC_CD -->
                    AND RS.GLBL_CMPY_CD                   = PRDT.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD                   = PRDT.DEST_INVTY_LOC_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND RS.EZCANCELFLAG                   = '0'
                    <!-- 2024/04/03 QC#63814 Mod Start -->
                    <!-- AND TPWRX.GLBL_CMPY_CD                = RS.GLBL_CMPY_CD
                    AND TPWRX.RTL_WH_CD                   = RS.RTL_WH_CD
                    AND TPWRX.RTL_SWH_CD                  = RS.RTL_SWH_CD -->
                    AND (
                           (EXISTS(SELECT 1
                                       FROM TRD_PTNR_WH_RG_XREF TPWRX
                                       WHERE TPWRX.GLBL_CMPY_CD                = RS.GLBL_CMPY_CD
                                         AND TPWRX.RTL_WH_CD                   = RS.RTL_WH_CD
                                         AND TPWRX.RTL_SWH_CD                  = RS.RTL_SWH_CD
                                         AND TPWRX.EZCANCELFLAG                = '0'))
                         OR (RS.RTL_SWH_CD = #cmpToSWh#)
                         )
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    <isNotNull property="inboundIrTrgtWhList">
                    <isEqual property="inbdIrInclMNX" compareValue="Y">
                    <!--
                    AND (TPWRX.RTL_WH_CD IN
                    <iterate property="inboundIrTrgtWhList" var="inboundIrTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundIrTrgtWhList[]#
                    </iterate>
                    -->
                    AND (RS.RTL_SWH_CD                 = #cmpToSWh#
                        OR (RW.RTL_WH_CD               = TPWRX.RTL_WH_CD
                        AND RW.WH_OWNR_CD              = #whOwnrCd#
                        AND RW.EZCANCELFLAG            = '0'
                        )
                    <!-- 2024/04/03 QC#63814 Mod End -->
                    )
                    </isEqual>
                    <isEqual property="inbdIrInclMNX" compareValue="N">
                    <!-- 2024/04/08 QC#63814 Mod Start -->
                    <!-- AND TPWRX.RTL_WH_CD IN
                    <iterate property="inboundIrTrgtWhList" var="inboundIrTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundIrTrgtWhList[]#
                    </iterate> -->
                    <!-- 2024/04/03 QC#63814 Mod Start -->
                    <!-- AND RS.RTL_SWH_CD                 = #cmpToSWh# -->
                    AND (
                           (EXISTS(SELECT 1
                                       FROM TRD_PTNR_WH_RG_XREF TPWRX
                                       WHERE TPWRX.GLBL_CMPY_CD                = RS.GLBL_CMPY_CD
                                         AND TPWRX.RTL_WH_CD                   = RS.RTL_WH_CD
                                         AND TPWRX.RTL_SWH_CD                  = RS.RTL_SWH_CD
                                         AND TPWRX.EZCANCELFLAG                = '0'))
                         OR (RS.RTL_SWH_CD = #cmpToSWh#)
                         )
                    <!-- 2024/04/03 QC#63814 Mod End -->
                    </isEqual>
                    </isNotNull>
                    <isNull property="inboundIrTrgtWhList">
                        AND RS.RTL_WH_CD IN          #emptyList#
                    </isNull>
                    <!-- 2024/04/08 QC#63814 Mod End -->
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    <!-- 2024/04/08 QC#63814 Del Start -->
                    <!-- AND TPWRX.EZCANCELFLAG                = '0' -->
                    <!-- 2024/04/08 QC#63814 Del End -->
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!--
                    AND RW.GLBL_CMPY_CD                   = RS.GLBL_CMPY_CD
                    AND RW.RTL_WH_CD                      = RS.RTL_WH_CD
                    AND RW.WH_OWNR_CD              &lt;&gt; #whOwnrCd#
                    AND RW.EZCANCELFLAG                   = '0'
                    -->
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND SS.GLBL_CMPY_CD                   = I.GLBL_CMPY_CD
                    AND SS.STK_STS_CD                     = I.STK_STS_CD -->
                    AND SS.GLBL_CMPY_CD                   = PRDT.GLBL_CMPY_CD
                    AND SS.STK_STS_CD                     = PRDT.TO_STK_STS_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND SS.EZCANCELFLAG                   = '0'
                    UNION ALL
                    SELECT DISTINCT
                        MAIN.SCHD_QTY
                       ,MAIN.MDSE_CD
                       ,MAIN.WH_RG_CD
                       ,MAIN.RTL_WH_CD
                       ,MAIN.STK_LOC_CD
                       ,MAIN.STK_STS_NM
                       ,MAIN.INVTY_STS_CD
                       ,MAIN.SER_NUM
                       ,MAIN.RSVD_FIRST_CD
                       ,MAIN.INVTY_SRC_CD
                       ,MAIN.PRCH_REQ_NUM
                       ,MAIN.PRCH_REQ_LINE_NUM
                    FROM(
                        SELECT
                            PRDT.PRCH_REQ_QTY - PRDT.SHIP_QTY - NVL((SELECT
                                    SUM(CD.CANC_QTY) CANC_QTY
                                FROM
                                    CPO C
                                   ,CPO_DTL CD
                                 WHERE
                                     PRRQ.PRCH_REQ_NUM          = C.ORD_SRC_REF_NUM
                                 AND C.EZCANCELFLAG             = '0'
                                 AND C.CPO_ORD_NUM              = CD.CPO_ORD_NUM
                                 AND PRDT.PRCH_REQ_LINE_NUM     = CD.ORD_SRC_REF_LINE_NUM
                                 AND PRDT.PRCH_REQ_LINE_SUB_NUM = CD.ORD_SRC_REF_LINE_SUB_NUM
                                 AND CD.EZCANCELFLAG            = '0'
                                 ), 0) AS SCHD_QTY
                           ,PRDT.MDSE_CD
                           <!-- 2024/04/04 QC#63814 Mod Start -->
                           <!-- ,TPWRX.TRD_PTNR_WH_RG_NM             AS WH_RG_CD  -->
                           ,CASE
                              WHEN RS.RTL_SWH_CD = #cmpToSWh#
                              THEN (
                                 SELECT TPWRXF.TRD_PTNR_WH_RG_NM AS TRD_PTNR_WH_RG_NM
                                 FROM TRD_PTNR_WH_RG_XREF TPWRXF
                                 WHERE GLBL_CMPY_CD              = #glblCmpyCd#
                                 AND TPWRXF.RTL_WH_CD            = #3Z1#
                                 AND TPWRXF.RTL_SWH_CD           = #cmpToSWh#
                                 AND TPWRXF.TRD_PTNR_WH_RG_TP_CD = #trdPtnrWhTgTpCdCSA#
                                 AND TPWRXF.EZCANCELFLAG         = '0'
                                 )
                              ELSE (
                                 SELECT TPWRXF.TRD_PTNR_WH_RG_NM AS TRD_PTNR_WH_RG_NM
                                 FROM TRD_PTNR_WH_RG_XREF TPWRXF
                                 WHERE GLBL_CMPY_CD              = RS.GLBL_CMPY_CD
                                 AND TPWRXF.RTL_WH_CD            = RS.RTL_WH_CD
                                 AND TPWRXF.RTL_SWH_CD           = RS.RTL_SWH_CD
                                 AND TPWRXF.EZCANCELFLAG         = '0'
                                 )
                            END WH_RG_CD
                           <!-- 2024/04/04 QC#63814 Mod End -->
                           <!-- START 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                           <!--
                           ,CASE
                               WHEN TPWRX.RTL_WH_CD = #3Z1# THEN #2P1#
                               ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)
                           END RTL_WH_CD
                           ,CASE
                               WHEN TPWRX.RTL_WH_CD = #3Z1# THEN I.INVTY_LOC_CD
                               ELSE '0'
                           END STK_LOC_CD -->
                           <isEqual property="convtFlg" compareValue="Y">
                           ,CASE
                           <!-- 2024/04/04 QC#63814 Mod Start -->
                           <!-- WHEN TPWRX.RTL_WH_CD IN
                               <iterate property="convtFromWhList" var="convtFromWhList[]" open="(" close=")" conjunction=",">
                                   #convtFromWhList[]#
                               </iterate> -->
                           WHEN RS.RTL_SWH_CD IN
                           <iterate property="convtFromSWhList" var="convtFromSWhList[]" open="(" close=")" conjunction=",">
                               #convtFromSWhList[]#
                           </iterate>
                           <!-- 2024/04/04 QC#63814 Mod End -->
                               THEN #convtIntoWh#
                               <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                               <!-- ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD) -->
                               ELSE NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)
                               <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                           END RTL_WH_CD 
                           </isEqual>
                           <isEqual property="convtFlg" compareValue="N">
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD -->
                           ,NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)  AS RTL_WH_CD
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                           </isEqual>
                           <isNotNull property="stkLocCdList">
                           ,CASE
                           <!-- 2024/04/04 QC#63814 Mod Start -->
                           <!-- WHEN TPWRX.RTL_WH_CD || TPWRX.RTL_SWH_CD IN -->
                               WHEN RS.RTL_WH_CD || RS.RTL_SWH_CD IN
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                               <iterate property="stkLocCdList" var="stkLocCdList[]" open="(" close=")" conjunction=",">
                                   #stkLocCdList[]#
                              </iterate>
                               <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                               <!--THEN I.INVTY_LOC_CD -->
                               THEN PRDT.DEST_INVTY_LOC_CD
                               <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                               ELSE #stkLocCd#
                           END STK_LOC_CD
                           </isNotNull>
                           <isNull property="stkLocCdList">
                           ,#stkLocCd#                         AS STK_LOC_CD
                           </isNull>
                           <!-- END 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                           ,UPPER(SS.STK_STS_NM)                AS STK_STS_NM
                           ,#inboundInvty#                      AS INVTY_STS_CD
                           ,NULL                                AS SER_NUM
                           ,NULL                                AS RSVD_FIRST_CD
                           ,#S21#                               AS INVTY_SRC_CD
                           ,PRDT.PRCH_REQ_NUM
                           ,PRDT.PRCH_REQ_LINE_NUM
                        FROM
                            PRCH_REQ              PRRQ
                           ,PRCH_REQ_DTL          PRDT
                           ,PRCH_REQ_APVL_STS     PRAS
                           ,PRCH_REQ_LINE_STS     PRLS
                           ,PRCH_REQ_TP           PRRT
                           <!-- START 2021/12/07 [QC#58989-3, DEL] -->
                           <!-- ,INVTY                 I -->
                           <!-- END 2021/12/07 [QC#58989-3, DEL] -->
                           ,MDSE                  M
                           ,RTL_SWH               RS
                           ,RTL_WH                RW
                           ,STK_STS               SS
                           <!-- 2024/04/04 QC#63814 Del Start -->
                           <!-- ,TRD_PTNR_WH_RG_XREF   TPWRX -->
                           <!-- 2024/04/04 QC#63814 Del End -->
                        WHERE
                            PRRQ.GLBL_CMPY_CD                 = #glblCmpyCd#
                        AND PRRQ.PRCH_REQ_TP_CD               = #whTransfer#
                        AND PRRQ.EZCANCELFLAG                 = '0'
                        AND PRRQ.PRCH_REQ_REC_TP_CD           = #invtyReq#
                        <iterate property="incldPrchReqSts" var="incldPrchReqSts[]"
                        open="AND PRRQ.PRCH_REQ_STS_CD IN  (" conjunction=", " close=")"> #incldPrchReqSts[]#
                        </iterate>
                        AND NOT (
                                PRRQ.PRCH_REQ_APVL_STS_CD     = #prchReqApvlSts#
                            AND PRRQ.PRCH_REQ_SRC_TP_CD       = #prchReqSrcTp#
                        )
                        AND PRRQ.GLBL_CMPY_CD                 = PRDT.GLBL_CMPY_CD
                        AND PRRQ.PRCH_REQ_NUM                 = PRDT.PRCH_REQ_NUM
                        AND PRDT.EZCANCELFLAG                 = '0'
                        AND PRDT.PRCH_REQ_QTY - PRDT.SHIP_QTY &gt; #ZERO#
                        AND PRRQ.GLBL_CMPY_CD                 = PRAS.GLBL_CMPY_CD
                        AND PRRQ.PRCH_REQ_APVL_STS_CD         = PRAS.PRCH_REQ_APVL_STS_CD
                        AND PRAS.EZCANCELFLAG                 = '0'
                        AND PRDT.GLBL_CMPY_CD                 = PRLS.GLBL_CMPY_CD
                        AND PRDT.PRCH_REQ_LINE_STS_CD         = PRLS.PRCH_REQ_LINE_STS_CD
                        AND PRLS.EZCANCELFLAG                 = '0'
                        AND PRLS.OPEN_STS_FLG                 = #flagY#
                        AND PRRQ.GLBL_CMPY_CD                 = PRRT.GLBL_CMPY_CD
                        AND PRRQ.PRCH_REQ_TP_CD               = PRRT.PRCH_REQ_TP_CD
                        AND PRRT.EZCANCELFLAG                 = '0'
                        <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                        <!-- AND PRDT.GLBL_CMPY_CD                 = I.GLBL_CMPY_CD
                        AND PRDT.DEST_INVTY_LOC_CD            = I.INVTY_LOC_CD
                        AND PRDT.MDSE_CD                      = I.MDSE_CD
                        AND PRDT.TO_STK_STS_CD                = I.STK_STS_CD
                        AND I.STK_STS_CD                      = #goodStkSts#
                        AND I.EZCANCELFLAG                    = '0'
                        AND M.GLBL_CMPY_CD                    = I.GLBL_CMPY_CD
                        AND M.MDSE_CD                         = I.MDSE_CD -->
                        AND PRDT.TO_STK_STS_CD                = #goodStkSts#
                        AND PRDT.GLBL_CMPY_CD                 = M.GLBL_CMPY_CD
                        AND PRDT.MDSE_CD                      = M.MDSE_CD
                        <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                        AND M.EXP_ITEM_FLG             &lt;&gt; #flagY#
                        <iterate property="includeMdseSts" var="includeMdseSts[]"
                        open="AND M.MDSE_ITEM_STS_CD IN  (" conjunction=", " close=")"> #includeMdseSts[]#
                        </iterate>
                        <iterate property="includeMdseTp" var="includeMdseTp[]"
                        open="AND M.MDSE_ITEM_TP_CD IN  (" conjunction=", " close=")"> #includeMdseTp[]#
                        </iterate>
                        <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                        open="AND M.MDSE_ITEM_CLS_TP_CD IN  (" conjunction=", " close=")"> #includeMdseClsTp[]#
                        </iterate>
                        AND M.EZCANCELFLAG                    = '0'
                        <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                        <!-- AND RS.GLBL_CMPY_CD                   = I.GLBL_CMPY_CD
                        AND RS.INVTY_LOC_CD                   = I.INVTY_LOC_CD -->
                        AND RS.GLBL_CMPY_CD                   = PRDT.GLBL_CMPY_CD
                        AND RS.INVTY_LOC_CD                   = PRDT.DEST_INVTY_LOC_CD
                        <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                        AND RS.EZCANCELFLAG                   = '0'
                        <!-- 2024/04/03 QC#63814 Mod Start -->
                        <!-- AND TPWRX.GLBL_CMPY_CD                = RS.GLBL_CMPY_CD
                             AND TPWRX.RTL_WH_CD                   = RS.RTL_WH_CD
                             AND TPWRX.RTL_SWH_CD                  = RS.RTL_SWH_CD -->
                        AND (
                               (EXISTS(SELECT 1
                                       FROM TRD_PTNR_WH_RG_XREF TPWRX
                                       WHERE TPWRX.GLBL_CMPY_CD                = RS.GLBL_CMPY_CD
                                         AND TPWRX.RTL_WH_CD                   = RS.RTL_WH_CD
                                         AND TPWRX.RTL_SWH_CD                  = RS.RTL_SWH_CD
                                         AND TPWRX.EZCANCELFLAG                = '0'))
                             OR (RS.RTL_SWH_CD = #cmpToSWh#)
                             )
                        <!-- START 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                        <isNotNull property="inboundIrTrgtWhList">
                        <isEqual property="inbdIrInclMNX" compareValue="Y">
                        <!--
                        AND (TPWRX.RTL_WH_CD IN
                        <iterate property="inboundIrTrgtWhList" var="inboundIrTrgtWhList[]" open="(" close=")" conjunction=",">
                            #inboundIrTrgtWhList[]#
                        </iterate> -->
                        AND (RS.RTL_SWH_CD                 = #cmpToSWh#
                            OR (RW.RTL_WH_CD               = TPWRX.RTL_WH_CD
                            AND RW.WH_OWNR_CD              = #whOwnrCd#
                            AND RW.EZCANCELFLAG            = '0'
                            )
                        )
                        <!-- 2024/04/03 QC#63814 Mod End -->
                        </isEqual>
                        <isEqual property="inbdIrInclMNX" compareValue="N">
                        <!-- 2024/04/08 QC#63814 Mod Start -->
                        <!--
                        AND TPWRX.RTL_WH_CD IN
                        <iterate property="inboundIrTrgtWhList" var="inboundIrTrgtWhList[]" open="(" close=")" conjunction=",">
                            #inboundIrTrgtWhList[]#
                        </iterate> -->
                        <!-- AND RS.RTL_SWH_CD                 = #cmpToSWh# -->
                        AND (
                               (EXISTS(SELECT 1
                                           FROM TRD_PTNR_WH_RG_XREF TPWRX
                                           WHERE TPWRX.GLBL_CMPY_CD                = RS.GLBL_CMPY_CD
                                             AND TPWRX.RTL_WH_CD                   = RS.RTL_WH_CD
                                             AND TPWRX.RTL_SWH_CD                  = RS.RTL_SWH_CD
                                             AND TPWRX.EZCANCELFLAG                = '0'))
                             OR (RS.RTL_SWH_CD = #cmpToSWh#)
                             )
                        </isEqual>
                        <!-- 2024/04/08 QC#63814 Mod End -->
                        </isNotNull>
                        <isNull property="inboundIrTrgtWhList">
                        AND RS.RTL_WH_CD IN          #emptyList#
                        </isNull>
                        <!-- 2024/04/08 QC#63814 Mod End -->
                        <!-- END 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                        <!-- 2024/04/08 QC#63814 Del Start -->
                        <!-- AND TPWRX.EZCANCELFLAG                = '0' -->
                        <!-- 2024/04/08 QC#63814 Del End -->
                        <!-- START 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                        <!--
                        AND RW.GLBL_CMPY_CD                   = RS.GLBL_CMPY_CD
                        AND RW.RTL_WH_CD                      = RS.RTL_WH_CD
                        AND RW.WH_OWNR_CD              &lt;&gt; #whOwnrCd#
                        AND RW.EZCANCELFLAG                   = '0'
                        -->
                        <!-- END 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                        <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                        <!-- AND SS.GLBL_CMPY_CD                   = I.GLBL_CMPY_CD
                        AND SS.STK_STS_CD                     = I.STK_STS_CD -->
                        AND SS.GLBL_CMPY_CD                   = PRDT.GLBL_CMPY_CD
                        AND SS.STK_STS_CD                     = PRDT.TO_STK_STS_CD
                        <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                        AND SS.EZCANCELFLAG                   = '0'
                    ) MAIN
                    WHERE
                        MAIN.SCHD_QTY &gt; #ZERO#
                    )
                GROUP BY MDSE_CD
                        ,WH_RG_CD
                        ,RTL_WH_CD
                        ,STK_LOC_CD
                        ,STK_STS_NM
                        ,INVTY_STS_CD
                        ,SER_NUM
                        ,RSVD_FIRST_CD
                        ,INVTY_SRC_CD
 
                <!-- Inventory Requisition (after shipping and before stock-in) for 2P1/3Z1ITA warehouse -->
                UNION ALL
                SELECT DISTINCT
                    SUM(VIS_QTY)
                   ,MDSE_CD
                   ,WH_RG_CD
                   ,RTL_WH_CD
                   ,STK_LOC_CD
                   ,STK_STS_NM
                   ,INVTY_STS_CD
                   ,SER_NUM
                   ,RSVD_FIRST_CD
                   ,INVTY_SRC_CD
                FROM (
                    SELECT DISTINCT
                        INBD.VIS_QTY
                       ,INBD.MDSE_CD
                       <!-- 2024/04/03 QC#63814 Mod Start -->
                       <!-- ,TPWRX.TRD_PTNR_WH_RG_NM             AS WH_RG_CD -->
                       ,CASE
                          WHEN RS.RTL_SWH_CD = #cmpToSWh#
                          THEN (
                             SELECT TPWRXF.TRD_PTNR_WH_RG_NM AS TRD_PTNR_WH_RG_NM
                             FROM TRD_PTNR_WH_RG_XREF TPWRXF
                             WHERE TPWRXF.RTL_WH_CD= #3Z1#
                             AND TPWRXF.RTL_SWH_CD= #cmpToSWh#
                             AND TPWRXF.TRD_PTNR_WH_RG_TP_CD= #trdPtnrWhTgTpCdCSA#
                             )
                          ELSE TPWRX.TRD_PTNR_WH_RG_NM
                       END WH_RG_CD
                       <!-- 2024/04/03 QC#63814 Mod End -->
                       <!-- START 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                       <!--
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD = #3Z1# THEN #2P1#
                           ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)
                       END RTL_WH_CD
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD = #3Z1# THEN I.INVTY_LOC_CD
                           ELSE '0'
                       END STK_LOC_CD-->
                       <isEqual property="convtFlg" compareValue="Y">
                       ,CASE
                           <!-- 2024/04/03 QC#63814 Mod Start -->
                           <!--WHEN TPWRX.RTL_WH_CD IN
                           <iterate property="convtFromWhList" var="convtFromWhList[]" open="(" close=")" conjunction=",">
                               #convtFromWhList[]#
                           </iterate> -->
                           WHEN RS.RTL_SWH_CD IN
                           <iterate property="convtFromSWhList" var="convtFromSWhList[]" open="(" close=")" conjunction=",">
                               #convtFromSWhList[]#
                           </iterate>
                           <!-- 2024/04/03 QC#63814 Mod End -->
                           THEN #convtIntoWh#
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD) -->
                           ELSE NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       END RTL_WH_CD 
                       </isEqual>
                       <isEqual property="convtFlg" compareValue="N">
                       <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                       <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD -->
                       ,NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)  AS RTL_WH_CD
                       <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       </isEqual>
                       <isNotNull property="stkLocCdList">
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD || TPWRX.RTL_SWH_CD IN
                           <iterate property="stkLocCdList" var="stkLocCdList[]" open="(" close=")" conjunction=",">
                               #stkLocCdList[]#
                          </iterate>
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- THEN I.INVTY_LOC_CD -->
                           THEN PRDT.DEST_INVTY_LOC_CD
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                           ELSE #stkLocCd#
                       END STK_LOC_CD
                       </isNotNull>
                       <isNull property="stkLocCdList">
                       ,#stkLocCd#                         AS STK_LOC_CD
                       </isNull>
                       <!-- END 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                       ,UPPER(STS.STK_STS_NM)          AS STK_STS_NM
                       ,#inboundInvty#                 AS INVTY_STS_CD
                       ,NULL                           AS SER_NUM
                       ,NULL                           AS RSVD_FIRST_CD
                       ,#S21#                          AS INVTY_SRC_CD
                       ,PRDT.PRCH_REQ_NUM
                       ,PRDT.PRCH_REQ_LINE_NUM
                    FROM
                        PRCH_REQ              PRRQ
                       ,PRCH_REQ_DTL          PRDT
                       ,PRCH_REQ_LINE_STS     PRLS
                       ,PO_RCV_DTL            PRD
                       ,INBD_VIS              INBD
                       ,PRCH_REQ_TP           PRRT
                       ,PRCH_REQ_APVL_STS     PRAS
                       ,SHPG_PLN              SP
                       ,SHPG_STS              SS
                       ,(SELECT
                            P.GLBL_CMPY_CD
                           ,P.SO_NUM
                           ,P.SO_SLP_NUM
                           ,P.PKT_STS_TS
                         FROM
                            PKT P
                            ,(SELECT
                                  MP.GLBL_CMPY_CD
                                 ,MP.SO_NUM
                                 ,MP.SO_SLP_NUM
                                 ,MAX(MP.PKT_SQ_NUM) MAX_PKT_SQ_NUM
                              FROM
                                  PKT MP
                              WHERE
                                  MP.EZCANCELFLAG = '0'
                              GROUP BY
                                  MP.GLBL_CMPY_CD
                                 ,MP.SO_NUM
                                 ,MP.SO_SLP_NUM
                            ) M
                         WHERE
                             P.GLBL_CMPY_CD = M.GLBL_CMPY_CD
                         AND P.SO_NUM       = M.SO_NUM
                         AND P.SO_SLP_NUM   = M.SO_SLP_NUM
                         AND P.PKT_SQ_NUM   = M.MAX_PKT_SQ_NUM
                       ) PKT
                       <!-- START 2021/12/07 [QC#58989-3, DEL] -->
                       <!-- ,INVTY                 I -->
                       <!-- END 2021/12/07 [QC#58989-3, DEL] -->
                       ,MDSE                  M
                       ,RTL_SWH               RS
                       ,RTL_WH                RW
                       ,STK_STS               STS
                       ,TRD_PTNR_WH_RG_XREF   TPWRX
                    WHERE
                        PRRQ.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND PRRQ.EZCANCELFLAG          = '0'
                    AND PRRQ.PRCH_REQ_REC_TP_CD    = #invtyReq#
                    AND PRRQ.PRCH_REQ_STS_CD       = #openStatus#
                    AND PRRQ.GLBL_CMPY_CD          = PRDT.GLBL_CMPY_CD
                    AND PRRQ.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
                    AND PRDT.EZCANCELFLAG          = '0'
                    AND PRDT.SO_NUM                IS NOT NULL
                    AND PRDT.GLBL_CMPY_CD          = PRLS.GLBL_CMPY_CD
                    AND PRDT.PRCH_REQ_LINE_STS_CD  = PRLS.PRCH_REQ_LINE_STS_CD
                    AND PRLS.EZCANCELFLAG          = '0'
                    AND PRLS.OPEN_STS_FLG          = #flagY#
                    AND PRDT.GLBL_CMPY_CD          = PRD.GLBL_CMPY_CD
                    AND PRDT.PRCH_REQ_NUM          = PRD.PRCH_REQ_NUM
                    AND PRDT.PRCH_REQ_LINE_NUM     = PRD.PRCH_REQ_LINE_NUM
                    AND PRDT.PRCH_REQ_LINE_SUB_NUM = PRD.PRCH_REQ_LINE_SUB_NUM
                    AND PRD.EZCANCELFLAG           = '0'
                    AND PRD.GLBL_CMPY_CD           = INBD.GLBL_CMPY_CD
                    AND PRD.PO_RCV_NUM             = INBD.PO_RCV_NUM
                    AND PRD.PO_RCV_LINE_NUM        = INBD.PO_RCV_LINE_NUM
                    AND INBD.EZCANCELFLAG          = '0'
                    AND INBD.INBD_LTST_REC_FLG     = #flagY#
                    AND INBD.INBD_VIS_EVENT_CD     = #dcTransferReceive#
                    AND INBD.INBD_VIS_DATA_TP_CD   = #stockInDc#
                    AND PRRQ.GLBL_CMPY_CD          = PRRT.GLBL_CMPY_CD
                    AND PRRQ.PRCH_REQ_TP_CD        = PRRT.PRCH_REQ_TP_CD
                    AND PRRT.EZCANCELFLAG          = '0'
                    AND PRRQ.GLBL_CMPY_CD          = PRAS.GLBL_CMPY_CD
                    AND PRRQ.PRCH_REQ_APVL_STS_CD  = PRAS.PRCH_REQ_APVL_STS_CD
                    AND PRAS.EZCANCELFLAG          = '0'
                    AND PRDT.GLBL_CMPY_CD          = SP.GLBL_CMPY_CD(+)
                    AND PRDT.PRCH_REQ_NUM          = SP.TRX_HDR_NUM(+)
                    AND PRDT.PRCH_REQ_LINE_NUM     = SP.TRX_LINE_NUM(+)
                    AND SP.EZCANCELFLAG(+)         = '0'
                    AND SP.GLBL_CMPY_CD            = SS.GLBL_CMPY_CD(+)
                    AND SP.SHPG_STS_CD             = SS.SHPG_STS_CD(+)
                    AND SS.EZCANCELFLAG(+)         = '0'
                    AND SP.GLBL_CMPY_CD            = PKT.GLBL_CMPY_CD(+)
                    AND SP.SO_NUM                  = PKT.SO_NUM(+)
                    AND SP.SO_SLP_NUM              = PKT.SO_SLP_NUM(+)
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND PRDT.GLBL_CMPY_CD          = I.GLBL_CMPY_CD
                    AND PRDT.DEST_INVTY_LOC_CD     = I.INVTY_LOC_CD
                    AND PRDT.MDSE_CD               = I.MDSE_CD
                    AND PRDT.TO_STK_STS_CD         = I.STK_STS_CD
                    AND I.STK_STS_CD               = #goodStkSts#
                    AND I.EZCANCELFLAG             = '0'
                    AND M.GLBL_CMPY_CD             = I.GLBL_CMPY_CD
                    AND M.MDSE_CD                  = I.MDSE_CD -->
                    AND PRDT.TO_STK_STS_CD         = #goodStkSts#
                    AND PRDT.GLBL_CMPY_CD          = M.GLBL_CMPY_CD
                    AND PRDT.MDSE_CD               = M.MDSE_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND M.EXP_ITEM_FLG      &lt;&gt; #flagY#
                    <iterate property="includeMdseSts" var="includeMdseSts[]"
                    open="AND M.MDSE_ITEM_STS_CD IN  (" conjunction=", " close=")"> #includeMdseSts[]#
                    </iterate>
                    <iterate property="includeMdseTp" var="includeMdseTp[]"
                    open="AND M.MDSE_ITEM_TP_CD IN  (" conjunction=", " close=")"> #includeMdseTp[]#
                    </iterate>
                    <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                    open="AND M.MDSE_ITEM_CLS_TP_CD IN  (" conjunction=", " close=")"> #includeMdseClsTp[]#
                    </iterate>
                    AND M.EZCANCELFLAG             = '0'
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND RS.GLBL_CMPY_CD            = I.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD            = I.INVTY_LOC_CD -->
                    AND RS.GLBL_CMPY_CD            = PRDT.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD            = PRDT.DEST_INVTY_LOC_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND RS.EZCANCELFLAG            = '0'
                    <!-- 2024/04/03 QC#63814 Mod Start -->
                    AND TPWRX.GLBL_CMPY_CD(+)         = RS.GLBL_CMPY_CD
                    AND TPWRX.RTL_WH_CD(+)            = RS.RTL_WH_CD
                    AND TPWRX.RTL_SWH_CD(+)           = RS.RTL_SWH_CD
                    <!-- 2024/04/03 QC#63814 Mod End -->
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    <isNotNull property="inboundIrTrgtWhList">
                    <isEqual property="inbdIrInclMNX" compareValue="Y">
                    <!-- 2024/04/03 QC#63814 Mod Start -->
                    <!--
                    AND (TPWRX.RTL_WH_CD IN
                    <iterate property="inboundIrTrgtWhList" var="inboundIrTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundIrTrgtWhList[]#
                    </iterate>
                    -->
                    AND (RS.RTL_SWH_CD                 = #cmpToSWh#
                        OR (RW.RTL_WH_CD               = TPWRX.RTL_WH_CD
                        AND RW.WH_OWNR_CD              = #whOwnrCd#
                        AND RW.EZCANCELFLAG            = '0'
                        )
                    <!-- 2024/04/03 QC#63814 Mod End -->
                    )
                    </isEqual>
                    <isEqual property="inbdIrInclMNX" compareValue="N">
                    <!-- 2024/04/08 QC#63814 Mod Start -->
                    <!--
                    AND TPWRX.RTL_WH_CD IN
                    <iterate property="inboundIrTrgtWhList" var="inboundIrTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundIrTrgtWhList[]#
                    </iterate> -->
                    <!-- 2024/04/03 QC#63814 Mod Start -->
                    <!-- AND RS.RTL_SWH_CD                 = #cmpToSWh# -->
                    AND (
                           (EXISTS(SELECT 1
                                       FROM TRD_PTNR_WH_RG_XREF TPWRX
                                       WHERE TPWRX.GLBL_CMPY_CD                = RS.GLBL_CMPY_CD
                                         AND TPWRX.RTL_WH_CD                   = RS.RTL_WH_CD
                                         AND TPWRX.RTL_SWH_CD                  = RS.RTL_SWH_CD
                                         AND TPWRX.EZCANCELFLAG                = '0'))
                         OR (RS.RTL_SWH_CD = #cmpToSWh#)
                         )
                    <!-- 2024/04/03 QC#63814 Mod End -->
                    </isEqual>
                    </isNotNull>
                    <isNull property="inboundIrTrgtWhList">
                        AND TPWRX.RTL_WH_CD IN          #emptyList#
                    </isNull>
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    AND TPWRX.EZCANCELFLAG(+)         = '0'
                    <!-- 2024/04/08 QC#63814 Mod End -->
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!--
                    AND RW.GLBL_CMPY_CD            = RS.GLBL_CMPY_CD
                    AND RW.RTL_WH_CD               = RS.RTL_WH_CD
                    AND RW.WH_OWNR_CD       &lt;&gt; #whOwnrCd#
                    AND RW.EZCANCELFLAG            = '0'
                    -->
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND STS.GLBL_CMPY_CD           = I.GLBL_CMPY_CD
                    AND STS.STK_STS_CD             = I.STK_STS_CD -->
                    AND STS.GLBL_CMPY_CD           = PRDT.GLBL_CMPY_CD
                    AND STS.STK_STS_CD             = PRDT.TO_STK_STS_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND STS.EZCANCELFLAG           = '0'
                    UNION ALL
                    SELECT DISTINCT
                        PRDT.PRCH_REQ_QTY AS VIS_QTY
                       ,PRDT.MDSE_CD
                       <!-- 2024/04/04 QC#63814 Mod Start -->
                       <!-- ,TPWRX.TRD_PTNR_WH_RG_NM             AS WH_RG_CD  -->
                       ,CASE
                          WHEN RS.RTL_SWH_CD = #cmpToSWh#
                          THEN (
                             SELECT TPWRXF.TRD_PTNR_WH_RG_NM AS TRD_PTNR_WH_RG_NM
                             FROM TRD_PTNR_WH_RG_XREF TPWRXF
                             WHERE TPWRXF.RTL_WH_CD= #3Z1#
                             AND TPWRXF.RTL_SWH_CD= #cmpToSWh#
                             AND TPWRXF.TRD_PTNR_WH_RG_TP_CD= #trdPtnrWhTgTpCdCSA#
                             )
                          ELSE TPWRX.TRD_PTNR_WH_RG_NM
                       END WH_RG_CD
                       <!-- 2024/04/04 QC#63814 Mod End -->
                       <!-- START 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                       <!--
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD = #3Z1# THEN #2P1#
                           ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)
                       END RTL_WH_CD
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD = #3Z1# THEN I.INVTY_LOC_CD
                           ELSE '0'
                       END STK_LOC_CD -->
                       <isEqual property="convtFlg" compareValue="Y">
                       ,CASE
                       <!-- 2024/04/04 QC#63814 Mod Start -->
                       <!-- WHEN TPWRX.RTL_WH_CD IN
                           <iterate property="convtFromWhList" var="convtFromWhList[]" open="(" close=")" conjunction=",">
                               #convtFromWhList[]#
                           </iterate> -->
                           WHEN RS.RTL_SWH_CD IN
                           <iterate property="convtFromSWhList" var="convtFromSWhList[]" open="(" close=")" conjunction=",">
                               #convtFromSWhList[]#
                           </iterate>
                           <!-- 2024/04/04 QC#63814 Mod End -->
                           THEN #convtIntoWh#
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD) -->
                           ELSE NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       END RTL_WH_CD 
                       </isEqual>
                       <isEqual property="convtFlg" compareValue="N">
                       <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                       <!-- ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD -->
                       ,NVL(RS.RTL_WH_CD, PRDT.DEST_INVTY_LOC_CD)  AS RTL_WH_CD
                       <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                       </isEqual>
                       <isNotNull property="stkLocCdList">
                       ,CASE
                           WHEN TPWRX.RTL_WH_CD || TPWRX.RTL_SWH_CD IN
                           <iterate property="stkLocCdList" var="stkLocCdList[]" open="(" close=")" conjunction=",">
                               #stkLocCdList[]#
                           </iterate>
                           <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                           <!-- THEN I.INVTY_LOC_CD -->
                           THEN PRDT.DEST_INVTY_LOC_CD
                           <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                           ELSE #stkLocCd#
                       END STK_LOC_CD
                       </isNotNull>
                       <isNull property="stkLocCdList">
                       ,#stkLocCd#                         AS STK_LOC_CD
                       </isNull>
                       <!-- END 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                       ,UPPER(STS.STK_STS_NM)               AS STK_STS_NM
                       ,#inboundInvty#                      AS INVTY_STS_CD
                       ,NULL                                AS SER_NUM
                       ,NULL                                AS RSVD_FIRST_CD
                       ,#S21#                               AS INVTY_SRC_CD
                       ,PRDT.PRCH_REQ_NUM
                       ,PRDT.PRCH_REQ_LINE_NUM
                    FROM
                        PRCH_REQ           PRRQ
                       ,PRCH_REQ_DTL       PRDT
                       ,PRCH_REQ_LINE_STS  PRLS
                       ,PRCH_REQ_TP        PRRT
                       ,PRCH_REQ_APVL_STS  PRAS
                       ,SHPG_PLN           SP
                       ,SHPG_STS           SS
                       ,(SELECT
                            P.GLBL_CMPY_CD
                           ,P.SO_NUM
                           ,P.SO_SLP_NUM
                           ,P.PKT_STS_TS
                         FROM
                            PKT P
                            ,(SELECT
                                  MP.GLBL_CMPY_CD
                                 ,MP.SO_NUM
                                 ,MP.SO_SLP_NUM
                                 ,MAX(MP.PKT_SQ_NUM) MAX_PKT_SQ_NUM
                              FROM
                                  PKT MP
                              WHERE
                                  MP.EZCANCELFLAG = '0'
                              GROUP BY
                                  MP.GLBL_CMPY_CD
                                 ,MP.SO_NUM
                                 ,MP.SO_SLP_NUM
                             ) M
                         WHERE
                             P.GLBL_CMPY_CD = M.GLBL_CMPY_CD
                         AND P.SO_NUM       = M.SO_NUM
                         AND P.SO_SLP_NUM   = M.SO_SLP_NUM
                         AND P.PKT_SQ_NUM   = M.MAX_PKT_SQ_NUM
                         ) PKT
                        <!-- START 2021/12/07 [QC#58989-3, DEL] -->
                        <!-- ,INVTY           I -->
                        <!-- END 2021/12/07 [QC#58989-3, DEL] -->
                        ,MDSE M
                        ,RTL_SWH         RS
                        ,RTL_WH          RW
                        ,STK_STS         STS
                        ,TRD_PTNR_WH_RG_XREF   TPWRX
                    WHERE
                        PRRQ.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND PRRQ.EZCANCELFLAG          = '0'
                    AND PRRQ.PRCH_REQ_TP_CD        = #kitting#
                    AND PRRQ.PRCH_REQ_REC_TP_CD    = #invtyReq#
                    AND PRRQ.PRCH_REQ_STS_CD       = #openStatus#
                    AND PRRQ.GLBL_CMPY_CD          = PRDT.GLBL_CMPY_CD
                    AND PRRQ.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
                    AND PRDT.EZCANCELFLAG          = '0'
                    AND PRDT.FROM_STK_STS_CD       = #goodStkSts#
                    AND PRDT.WRK_ORD_NUM           IS NULL
                    AND PRDT.GLBL_CMPY_CD          = PRLS.GLBL_CMPY_CD
                    AND PRDT.PRCH_REQ_LINE_STS_CD  = PRLS.PRCH_REQ_LINE_STS_CD
                    AND PRLS.EZCANCELFLAG          = '0'
                    AND PRRQ.GLBL_CMPY_CD          = PRRT.GLBL_CMPY_CD
                    AND PRRQ.PRCH_REQ_TP_CD        = PRRT.PRCH_REQ_TP_CD
                    AND PRRT.EZCANCELFLAG          = '0'
                    AND PRRQ.GLBL_CMPY_CD          = PRAS.GLBL_CMPY_CD
                    AND PRRQ.PRCH_REQ_APVL_STS_CD  = PRAS.PRCH_REQ_APVL_STS_CD
                    AND PRAS.PRCH_REQ_APVL_FLG     = #flagY#
                    AND PRAS.EZCANCELFLAG          = '0'
                    AND PRDT.GLBL_CMPY_CD          = SP.GLBL_CMPY_CD(+)
                    AND PRDT.PRCH_REQ_NUM          = SP.TRX_HDR_NUM(+)
                    AND PRDT.PRCH_REQ_LINE_NUM     = SP.TRX_LINE_NUM(+)
                    AND SP.EZCANCELFLAG(+)         = '0'
                    AND SP.GLBL_CMPY_CD            = SS.GLBL_CMPY_CD(+)
                    AND SP.SHPG_STS_CD             = SS.SHPG_STS_CD(+)
                    AND SS.EZCANCELFLAG(+)         = '0'
                    AND SP.GLBL_CMPY_CD            = PKT.GLBL_CMPY_CD(+)
                    AND SP.SO_NUM                  = PKT.SO_NUM(+)
                    AND SP.SO_SLP_NUM              = PKT.SO_SLP_NUM(+)
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND PRDT.GLBL_CMPY_CD          = I.GLBL_CMPY_CD
                    AND PRDT.DEST_INVTY_LOC_CD     = I.INVTY_LOC_CD
                    AND PRDT.MDSE_CD               = I.MDSE_CD
                    AND PRDT.TO_STK_STS_CD         = I.STK_STS_CD
                    AND I.STK_STS_CD               = #goodStkSts#
                    AND I.EZCANCELFLAG             = '0'
                    AND M.GLBL_CMPY_CD             = I.GLBL_CMPY_CD
                    AND M.MDSE_CD                  = I.MDSE_CD -->
                    AND PRDT.TO_STK_STS_CD         = #goodStkSts#
                    AND PRDT.GLBL_CMPY_CD          = M.GLBL_CMPY_CD
                    AND PRDT.MDSE_CD               = M.MDSE_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND M.EXP_ITEM_FLG      &lt;&gt; #flagY#
                    <iterate property="includeMdseSts" var="includeMdseSts[]"
                    open="AND M.MDSE_ITEM_STS_CD IN  (" conjunction=", " close=")"> #includeMdseSts[]#
                    </iterate>
                    <iterate property="includeMdseTp" var="includeMdseTp[]"
                    open="AND M.MDSE_ITEM_TP_CD IN  (" conjunction=", " close=")"> #includeMdseTp[]#
                    </iterate>
                    <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                    open="AND M.MDSE_ITEM_CLS_TP_CD IN  (" conjunction=", " close=")"> #includeMdseClsTp[]#
                    </iterate>
                    AND M.EZCANCELFLAG             = '0'
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND RS.GLBL_CMPY_CD            = I.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD            = I.INVTY_LOC_CD -->
                    AND RS.GLBL_CMPY_CD            = PRDT.GLBL_CMPY_CD
                    AND RS.INVTY_LOC_CD            = PRDT.DEST_INVTY_LOC_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND RS.EZCANCELFLAG            = '0'
                    <!-- 2024/04/08 QC#63814 Mod Start -->
                    AND TPWRX.GLBL_CMPY_CD(+)         = RS.GLBL_CMPY_CD
                    AND TPWRX.RTL_WH_CD(+)            = RS.RTL_WH_CD
                    AND TPWRX.RTL_SWH_CD(+)           = RS.RTL_SWH_CD
                    <!-- 2024/04/08 QC#63814 Mod End -->
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    <isNotNull property="inboundIrTrgtWhList">
                    <isEqual property="inbdIrInclMNX" compareValue="Y">
                    <!-- 2024/04/04 QC#63814 Mod Start -->
                    <!--
                    AND (TPWRX.RTL_WH_CD IN
                    <iterate property="inboundIrTrgtWhList" var="inboundIrTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundIrTrgtWhList[]#
                    </iterate> -->
                    AND (RS.RTL_SWH_CD                 = #cmpToSWh#
                        OR (RW.RTL_WH_CD               = TPWRX.RTL_WH_CD
                        AND RW.WH_OWNR_CD              = #whOwnrCd#
                        AND RW.EZCANCELFLAG            = '0'
                        )
                    )
                    <!-- 2024/04/04 QC#63814 Mod End -->
                    </isEqual>
                    <isEqual property="inbdIrInclMNX" compareValue="N">
                    <!-- 2024/04/08 QC#63814 Mod Start -->
                    <!--
                    AND TPWRX.RTL_WH_CD IN
                    <iterate property="inboundIrTrgtWhList" var="inboundIrTrgtWhList[]" open="(" close=")" conjunction=",">
                        #inboundIrTrgtWhList[]#
                    </iterate> -->
                    <!-- 2024/04/03 QC#63814 Mod Start -->
                    <!-- AND RS.RTL_SWH_CD                 = #cmpToSWh# -->
                    AND (
                           (EXISTS(SELECT 1
                                       FROM TRD_PTNR_WH_RG_XREF TPWRX
                                       WHERE TPWRX.GLBL_CMPY_CD                = RS.GLBL_CMPY_CD
                                         AND TPWRX.RTL_WH_CD                   = RS.RTL_WH_CD
                                         AND TPWRX.RTL_SWH_CD                  = RS.RTL_SWH_CD
                                         AND TPWRX.EZCANCELFLAG                = '0'))
                         OR (RS.RTL_SWH_CD = #cmpToSWh#)
                         )
                    <!-- 2024/04/03 QC#63814 Mod End -->
                    </isEqual>
                    <!-- 2024/04/08 QC#63814 Mod End -->
                    </isNotNull>
                    <isNull property="inboundIrTrgtWhList">
                        AND TPWRX.RTL_WH_CD IN          #emptyList#
                    </isNull>
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                    AND TPWRX.EZCANCELFLAG(+)         = '0'
                    <!-- START 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!--
                    AND RW.GLBL_CMPY_CD            = RS.GLBL_CMPY_CD
                    AND RW.RTL_WH_CD               = RS.RTL_WH_CD
                    AND RW.WH_OWNR_CD       &lt;&gt; #whOwnrCd#
                    AND RW.EZCANCELFLAG            = '0' 
                    -->
                    <!-- END 2021/11/04 A.Marte [QC#58989-2, DEL] -->
                    <!-- START 2021/12/07 [QC#58989-3, MOD] -->
                    <!-- AND STS.GLBL_CMPY_CD           = I.GLBL_CMPY_CD
                    AND STS.STK_STS_CD             = I.STK_STS_CD -->
                    AND STS.GLBL_CMPY_CD           = PRDT.GLBL_CMPY_CD
                    AND STS.STK_STS_CD             = PRDT.TO_STK_STS_CD
                    <!-- END 2021/12/07 [QC#58989-3, MOD] -->
                    AND STS.EZCANCELFLAG           = '0'
                )
                GROUP BY MDSE_CD
                        ,WH_RG_CD
                        ,RTL_WH_CD
                        ,STK_LOC_CD
                        ,STK_STS_NM
                        ,INVTY_STS_CD
                        ,SER_NUM
                        ,RSVD_FIRST_CD
                        ,INVTY_SRC_CD
                <!-- On Hand Inventory Data-->
                UNION ALL
                SELECT 
                    I.INVTY_AVAL_QTY
                   ,I.MDSE_CD
                   <!-- 2024/04/03 QC#63814 Mod Start -->
                   <!-- ,TPWRX.TRD_PTNR_WH_RG_NM             AS WH_RG_CD -->
                   ,CASE
                      WHEN RS.RTL_SWH_CD = #cmpToSWh#
                      THEN (
                         SELECT TPWRXF.TRD_PTNR_WH_RG_NM AS TRD_PTNR_WH_RG_NM
                         FROM TRD_PTNR_WH_RG_XREF TPWRXF
                         WHERE TPWRXF.RTL_WH_CD= #3Z1#
                         AND TPWRXF.RTL_SWH_CD= #cmpToSWh#
                         AND TPWRXF.TRD_PTNR_WH_RG_TP_CD= #trdPtnrWhTgTpCdCSA#
                         )
                      ELSE TPWRX.TRD_PTNR_WH_RG_NM
                   END WH_RG_CD
                   <!-- 2024/04/03 QC#63814 Mod End -->
                   <!-- START 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                   <!--
                   ,CASE
                       WHEN TPWRX.RTL_WH_CD = #3Z1# THEN #2P1#
                       ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)
                   END RTL_WH_CD
                   ,CASE
                       WHEN TPWRX.RTL_WH_CD = #3Z1# THEN I.INVTY_LOC_CD
                       ELSE #stkLocCd#
                   END STK_LOC_CD -->
                   <isEqual property="convtFlg" compareValue="Y">
                   ,CASE
                       <!-- 2024/04/03 QC#63814 Mod Start -->
                       <!--WHEN TPWRX.RTL_WH_CD IN
                       <iterate property="convtFromWhList" var="convtFromWhList[]" open="(" close=")" conjunction=",">
                           #convtFromWhList[]#
                       </iterate> -->
                       WHEN RS.RTL_SWH_CD IN
                       <iterate property="convtFromSWhList" var="convtFromSWhList[]" open="(" close=")" conjunction=",">
                           #convtFromSWhList[]#
                       </iterate>
                       <!-- 2024/04/03 QC#63814 Mod End -->
                       THEN #convtIntoWh#
                       ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)
                   END RTL_WH_CD 
                   </isEqual>
                   <isEqual property="convtFlg" compareValue="N">
                   ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD
                   </isEqual>
                   <isNotNull property="stkLocCdList">
                   ,CASE
                       WHEN TPWRX.RTL_WH_CD || TPWRX.RTL_SWH_CD IN
                       <iterate property="stkLocCdList" var="stkLocCdList[]" open="(" close=")" conjunction=",">
                           #stkLocCdList[]#
                       </iterate>
                       THEN I.INVTY_LOC_CD
                       ELSE #stkLocCd#
                   END STK_LOC_CD
                   </isNotNull>
                   <isNull property="stkLocCdList">
                   ,#stkLocCd#                         AS STK_LOC_CD
                   </isNull>
                   <!-- END 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                   <!-- START 2022/06/22 R.Azucena [QC#60240 MOD] -->
                   <!-- START 2022/07/06 R.Azucena [QC#60240-1 MOD] -->
                   ,UPPER(SS.STK_STS_NM)                AS STK_STS_NM
                   <!-- ,CASE -->
                   <!--     WHEN RS.RTL_SWH_CD = #swhCdG# -->
                   <!--     THEN #subWarehouse# || ' ' || UPPER(SS.STK_STS_NM) -->
                   <!--     ELSE UPPER(SS.STK_STS_NM) -->
                   <!-- END AS STK_STS_NM -->
                   <!-- END 2022/07/06 R.Azucena [QC#60240-1 MOD] -->
                   <!-- END 2022/06/22 R.Azucena [QC#60240 MOD] -->
                   ,#onhandInvty#                       AS INVTY_STS_CD
                   ,NULL                                AS SER_NUM
                   ,NULL                                AS RSVD_FIRST_CD
                   ,#S21#                               AS INVTY_SRC_CD
                FROM
                    INVTY                 I
                   ,MDSE                  M
                   ,RTL_SWH               RS
                   ,RTL_WH                RW
                   ,STK_STS               SS
                   ,TRD_PTNR_WH_RG_XREF   TPWRX
                WHERE
                    I.GLBL_CMPY_CD             = #glblCmpyCd#
                AND I.LOC_STS_CD               = #dcStock#
                AND I.STK_STS_CD               = #goodStkSts#
                AND I.INVTY_AVAL_QTY           &gt; #ZERO#
                AND I.EZCANCELFLAG             = '0'
                AND M.GLBL_CMPY_CD             = I.GLBL_CMPY_CD
                AND M.MDSE_CD                  = I.MDSE_CD
                AND M.EXP_ITEM_FLG      &lt;&gt; #flagY#
                <iterate property="includeMdseSts" var="includeMdseSts[]"
                open="AND M.MDSE_ITEM_STS_CD IN  (" conjunction=", " close=")"> #includeMdseSts[]#
                </iterate>
                <iterate property="includeMdseTp" var="includeMdseTp[]"
                open="AND M.MDSE_ITEM_TP_CD IN  (" conjunction=", " close=")"> #includeMdseTp[]#
                </iterate>
                <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                open="AND M.MDSE_ITEM_CLS_TP_CD IN  (" conjunction=", " close=")"> #includeMdseClsTp[]#
                </iterate>
                AND M.EZCANCELFLAG             = '0'
                AND RS.GLBL_CMPY_CD(+)         = I.GLBL_CMPY_CD
                AND RS.INVTY_LOC_CD(+)         = I.INVTY_LOC_CD
                AND RS.EZCANCELFLAG(+)         = '0'
                AND RW.GLBL_CMPY_CD            = RS.GLBL_CMPY_CD
                AND RW.RTL_WH_CD               = RS.RTL_WH_CD
                AND RW.EZCANCELFLAG            = '0'
                <!-- 2024/04/03 QC#63814 Mod Start -->
                AND TPWRX.GLBL_CMPY_CD(+)         = RS.GLBL_CMPY_CD
                AND TPWRX.RTL_WH_CD(+)            = RS.RTL_WH_CD
                AND TPWRX.RTL_SWH_CD(+)           = RS.RTL_SWH_CD
                <!-- 2024/04/03 QC#63814 Mod End -->
                <!-- START 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                <isNotNull property="onhandTrgtWhList">
                <isEqual property="ohInclMNX" compareValue="Y">
                AND (TPWRX.RTL_WH_CD IN
                <iterate property="onhandTrgtWhList" var="onhandTrgtWhList[]" open="(" close=")" conjunction=",">
                    #onhandTrgtWhList[]#
                </iterate>
                    OR (RW.RTL_WH_CD               = TPWRX.RTL_WH_CD
                    AND RW.WH_OWNR_CD              = #whOwnrCd#
                    AND RW.EZCANCELFLAG            = '0'
                    )
                    <!-- START 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                    <isNotNull property="rtlWhCatgCdList">
                    OR (
                            RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                        <iterate property="rtlWhCatgCdList" var="rtlWhCatgCdList[]"
                        open="AND RW.RTL_WH_CATG_CD IN (" conjunction=", " close=")"> #rtlWhCatgCdList[]#
                        </iterate>
                        AND RW.EZCANCELFLAG = '0'
                    )
                    </isNotNull>
                    <!-- END 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                    <!-- START 2022/06/22 R.Azucena [QC#60240 ADD] -->
                    <isEqual property="ohInclTECH" compareValue="Y">
                    OR (
                            RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                        <iterate property="locTpCdList" var="locTpCdList[]"
                        open="AND RW.LOC_TP_CD IN (" conjunction=", " close=")"> #locTpCdList[]#
                        </iterate>
                        AND RW.EZCANCELFLAG = '0'
                        AND RS.RTL_SWH_CD   = TPWRX.RTL_SWH_CD
                        AND RS.RTL_SWH_CD   = #swhCdG#
                        AND RS.EZCANCELFLAG = '0'
                    )
                    </isEqual>
                    <!-- END 2022/06/22 R.Azucena [QC#60240 ADD] -->
                    <!-- 2024/04/03 QC#63814 Add Start -->
                    OR RS.RTL_SWH_CD = #cmpToSWh#
                    <!-- 2024/04/03 QC#63814 Add End -->
                )
                </isEqual>
                <isEqual property="ohInclMNX" compareValue="N">
                <!-- START 2022/06/22 R.Azucena [QC#60240 ADD] -->
                <isEqual property="ohInclTECH" compareValue="Y">
                AND (TPWRX.RTL_WH_CD IN
                <iterate property="onhandTrgtWhList" var="onhandTrgtWhList[]" open="(" close=")" conjunction=",">
                    #onhandTrgtWhList[]#
                </iterate>
                    <!-- START 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                    <isNotNull property="rtlWhCatgCdList">
                    OR (
                            RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                        <iterate property="rtlWhCatgCdList" var="rtlWhCatgCdList[]"
                        open="AND RW.RTL_WH_CATG_CD IN (" conjunction=", " close=")"> #rtlWhCatgCdList[]#
                        </iterate>
                        AND RW.EZCANCELFLAG = '0'
                    )
                    </isNotNull>
                    <!-- END 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                    OR (
                            RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                        <iterate property="locTpCdList" var="locTpCdList[]"
                        open="AND RW.LOC_TP_CD IN (" conjunction=", " close=")"> #locTpCdList[]#
                        </iterate>
                        AND RW.EZCANCELFLAG = '0'
                        AND RS.RTL_SWH_CD   = TPWRX.RTL_SWH_CD
                        AND RS.RTL_SWH_CD   = #swhCdG#
                        AND RS.EZCANCELFLAG = '0'
                    )
                )
                </isEqual>
                <!-- 2024/04/08 QC#63814 Add Start -->
                OR RS.RTL_SWH_CD = #cmpToSWh#
                <!-- 2024/04/08 QC#63814 Add End -->
                <isEqual property="ohInclTECH" compareValue="N">
                <!-- END 2022/06/22 R.Azucena [QC#60240 ADD] -->
                <!-- START 2022/07/21 R.Azucena [QC#60240-2 MOD] -->
                <!-- AND TPWRX.RTL_WH_CD IN -->
                AND (TPWRX.RTL_WH_CD IN
                <!-- END 2022/07/21 R.Azucena [QC#60240-2 MOD] -->
                <iterate property="onhandTrgtWhList" var="onhandTrgtWhList[]" open="(" close=")" conjunction=",">
                    #onhandTrgtWhList[]#
                </iterate>
                <!-- START 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                    <isNotNull property="rtlWhCatgCdList">
                    OR (
                            RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                        <iterate property="rtlWhCatgCdList" var="rtlWhCatgCdList[]"
                        open="AND RW.RTL_WH_CATG_CD IN (" conjunction=", " close=")"> #rtlWhCatgCdList[]#
                        </iterate>
                        AND RW.EZCANCELFLAG = '0'
                    )
                    </isNotNull>
                )
                <!-- END 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                <!-- START 2022/06/22 R.Azucena [QC#60240 ADD] -->
                </isEqual>
                <!-- END 2022/06/22 R.Azucena [QC#60240 ADD] -->
                </isEqual>
                </isNotNull>
                <isNull property="onhandTrgtWhList">
                    AND TPWRX.RTL_WH_CD IN          #emptyList#
                </isNull>
                <!-- END 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                <!-- 2024/04/03 QC#63814 Mod Start -->
                AND TPWRX.EZCANCELFLAG(+)         = '0'
                <!-- 2024/04/03 QC#63814 Mod End -->
                AND SS.GLBL_CMPY_CD(+)         = I.GLBL_CMPY_CD
                AND SS.STK_STS_CD(+)           = I.STK_STS_CD
                AND SS.EZCANCELFLAG(+)         = '0'
                <!-- Allocated Inventory Data -->
                UNION ALL
                SELECT 
                    I.INVTY_ALLOC_QTY
                   ,I.MDSE_CD
                   <!-- 2024/04/03 QC#63814 Mod Start -->
                   <!-- ,TPWRX.TRD_PTNR_WH_RG_NM             AS WH_RG_CD -->
                   ,CASE
                      WHEN RS.RTL_SWH_CD = #cmpToSWh#
                      THEN (
                         SELECT TPWRXF.TRD_PTNR_WH_RG_NM AS TRD_PTNR_WH_RG_NM
                         FROM TRD_PTNR_WH_RG_XREF TPWRXF
                         WHERE TPWRXF.RTL_WH_CD= #3Z1#
                         AND TPWRXF.RTL_SWH_CD= #cmpToSWh#
                         AND TPWRXF.TRD_PTNR_WH_RG_TP_CD= #trdPtnrWhTgTpCdCSA#
                         )
                      ELSE TPWRX.TRD_PTNR_WH_RG_NM
                   END WH_RG_CD
                   <!-- 2024/04/03 QC#63814 Mod End -->
                   <!-- START 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                   <!--
                   ,CASE
                        WHEN TPWRX.RTL_WH_CD = #3Z1# THEN #2P1#
                        ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)
                    END RTL_WH_CD
                   ,CASE
                        WHEN TPWRX.RTL_WH_CD = #3Z1# THEN I.INVTY_LOC_CD
                        ELSE '0'
                    END STK_LOC_CD -->
                   <isEqual property="convtFlg" compareValue="Y">
                   ,CASE
                       <!-- 2024/04/03 QC#63814 Mod Start -->
                       <!--WHEN TPWRX.RTL_WH_CD IN
                       <iterate property="convtFromWhList" var="convtFromWhList[]" open="(" close=")" conjunction=",">
                           #convtFromWhList[]#
                       </iterate> -->
                       WHEN RS.RTL_SWH_CD IN
                       <iterate property="convtFromSWhList" var="convtFromSWhList[]" open="(" close=")" conjunction=",">
                           #convtFromSWhList[]#
                       </iterate>
                       <!-- 2024/04/03 QC#63814 Mod End -->
                       THEN #convtIntoWh#
                       ELSE NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)
                   END RTL_WH_CD 
                   </isEqual>
                   <isEqual property="convtFlg" compareValue="N">
                   ,NVL(RS.RTL_WH_CD, I.INVTY_LOC_CD)  AS RTL_WH_CD
                   </isEqual>
                   <isNotNull property="stkLocCdList">
                   ,CASE
                       WHEN TPWRX.RTL_WH_CD || TPWRX.RTL_SWH_CD IN
                       <iterate property="stkLocCdList" var="stkLocCdList[]" open="(" close=")" conjunction=",">
                           #stkLocCdList[]#
                       </iterate>
                       THEN I.INVTY_LOC_CD
                       ELSE #stkLocCd#
                   END STK_LOC_CD
                   </isNotNull>
                   <isNull property="stkLocCdList">
                   ,#stkLocCd#                         AS STK_LOC_CD
                   </isNull>
                   <!-- END 2021/11/04 A.Marte [QC#58989-2, MOD] -->
                   <!-- START 2022/06/22 R.Azucena [QC#60240 MOD] -->
                   <!-- START 2022/07/06 R.Azucena [QC#60240-1 MOD] -->
                   ,UPPER(SS.STK_STS_NM)               AS STK_STS_NM
                   <!-- ,CASE -->
                   <!--     WHEN RS.RTL_SWH_CD = #swhCdG# -->
                   <!--     THEN #subWarehouse# || ' ' || UPPER(SS.STK_STS_NM) -->
                   <!--     ELSE UPPER(SS.STK_STS_NM) -->
                   <!-- END AS STK_STS_NM -->
                   <!-- END 2022/07/06 R.Azucena [QC#60240-1 MOD] -->
                   <!-- END 2022/06/22 R.Azucena [QC#60240 MOD] -->
                   ,#allocatedInvty#                   AS LOC_STS_CD
                   ,NULL                               AS SER_NUM
                   ,NULL                               AS RSVD_FIRST_CD
                   ,#S21#                              AS INVTY_SRC_CD
                FROM
                    INVTY                 I
                   ,MDSE                  M
                   ,RTL_SWH               RS
                   ,RTL_WH                RW
                   ,STK_STS               SS
                   ,TRD_PTNR_WH_RG_XREF   TPWRX
                WHERE
                    I.GLBL_CMPY_CD             = #glblCmpyCd#
                AND I.LOC_STS_CD               = #dcStock#
                AND I.STK_STS_CD               = #goodStkSts#
                AND I.INVTY_ALLOC_QTY          &gt; #ZERO#
                AND I.EZCANCELFLAG             = '0'
                AND M.GLBL_CMPY_CD             = I.GLBL_CMPY_CD
                AND M.MDSE_CD                  = I.MDSE_CD
                AND M.EXP_ITEM_FLG             &lt;&gt; #flagY#
                <iterate property="includeMdseSts" var="includeMdseSts[]"
                open="AND M.MDSE_ITEM_STS_CD IN  (" conjunction=", " close=")"> #includeMdseSts[]#
                </iterate>
                <iterate property="includeMdseTp" var="includeMdseTp[]"
                open="AND M.MDSE_ITEM_TP_CD IN  (" conjunction=", " close=")"> #includeMdseTp[]#
                </iterate>
                <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                open="AND M.MDSE_ITEM_CLS_TP_CD IN  (" conjunction=", " close=")"> #includeMdseClsTp[]#
                </iterate>
                AND M.EZCANCELFLAG             = '0'
                AND RS.GLBL_CMPY_CD(+)         = I.GLBL_CMPY_CD
                AND RS.INVTY_LOC_CD(+)         = I.INVTY_LOC_CD
                AND RS.EZCANCELFLAG(+)         = '0'
                AND RW.GLBL_CMPY_CD            = RS.GLBL_CMPY_CD
                AND RW.RTL_WH_CD               = RS.RTL_WH_CD
                AND RW.EZCANCELFLAG            = '0'
                <!-- 2024/04/03 QC#63814 Mod Start -->
                AND TPWRX.GLBL_CMPY_CD(+)         = RS.GLBL_CMPY_CD
                AND TPWRX.RTL_WH_CD(+)            = RS.RTL_WH_CD
                AND TPWRX.RTL_SWH_CD(+)           = RS.RTL_SWH_CD
                <!-- 2024/04/03 QC#63814 Mod End -->
                <!-- START 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                <isNotNull property="allocTrgtWhList">
                <isEqual property="allocInclMNX" compareValue="Y">
                AND (TPWRX.RTL_WH_CD IN
                <iterate property="allocTrgtWhList" var="allocTrgtWhList[]" open="(" close=")" conjunction=",">
                    #allocTrgtWhList[]#
                </iterate>
                    OR (RW.RTL_WH_CD               = TPWRX.RTL_WH_CD
                    AND RW.WH_OWNR_CD              = #whOwnrCd#
                    AND RW.EZCANCELFLAG            = '0'
                    )
                    <!-- START 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                    <isNotNull property="rtlWhCatgCdList">
                    OR (
                            RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                        <iterate property="rtlWhCatgCdList" var="rtlWhCatgCdList[]"
                        open="AND RW.RTL_WH_CATG_CD IN (" conjunction=", " close=")"> #rtlWhCatgCdList[]#
                        </iterate>
                        AND RW.EZCANCELFLAG = '0'
                    )
                    </isNotNull>
                    <!-- END 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                    <!-- START 2022/06/22 R.Azucena [QC#60240 ADD] -->
                    <isEqual property="allocInclTECH" compareValue="Y">
                    OR (
                            RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                        <iterate property="locTpCdList" var="locTpCdList[]"
                        open="AND RW.LOC_TP_CD IN (" conjunction=", " close=")"> #locTpCdList[]#
                        </iterate>
                        AND RW.EZCANCELFLAG = '0'
                        AND RS.RTL_SWH_CD   = TPWRX.RTL_SWH_CD
                        AND RS.RTL_SWH_CD   = #swhCdG#
                        AND RS.EZCANCELFLAG = '0'
                    )
                    </isEqual>
                    <!-- END 2022/06/22 R.Azucena [QC#60240 ADD] -->
                    <!-- 2024/04/03 QC#63814 Add Start -->
                    OR RS.RTL_SWH_CD = #cmpToSWh#
                    <!-- 2024/04/03 QC#63814 Add End -->
                )
                </isEqual>
                <isEqual property="allocInclMNX" compareValue="N">
                <!-- START 2022/06/22 R.Azucena [QC#60240 ADD] -->
                <isEqual property="allocInclTECH" compareValue="Y">
                AND (TPWRX.RTL_WH_CD IN
                <iterate property="allocTrgtWhList" var="allocTrgtWhList[]" open="(" close=")" conjunction=",">
                    #allocTrgtWhList[]#
                </iterate>
                    <!-- START 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                    <isNotNull property="rtlWhCatgCdList">
                    OR (
                            RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                        <iterate property="rtlWhCatgCdList" var="rtlWhCatgCdList[]"
                        open="AND RW.RTL_WH_CATG_CD IN (" conjunction=", " close=")"> #rtlWhCatgCdList[]#
                        </iterate>
                        AND RW.EZCANCELFLAG = '0'
                    )
                    </isNotNull>
                    <!-- END 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                    OR (
                            RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                        <iterate property="locTpCdList" var="locTpCdList[]"
                        open="AND RW.LOC_TP_CD IN (" conjunction=", " close=")"> #locTpCdList[]#
                        </iterate>
                        AND RW.EZCANCELFLAG = '0'
                        AND RS.RTL_SWH_CD   = TPWRX.RTL_SWH_CD
                        AND RS.RTL_SWH_CD   = #swhCdG#
                        AND RS.EZCANCELFLAG = '0'
                    )
                )
                </isEqual>
                <!-- 2024/04/08 QC#63814 Add Start -->
                OR RS.RTL_SWH_CD = #cmpToSWh#
                <!-- 2024/04/08 QC#63814 Add End -->
                <isEqual property="allocInclTECH" compareValue="N">
                <!-- END 2022/06/22 R.Azucena [QC#60240 ADD] -->
                <!-- START 2022/07/21 R.Azucena [QC#60240-2 MOD] -->
                <!-- AND TPWRX.RTL_WH_CD IN -->
                AND (TPWRX.RTL_WH_CD IN
                <!-- END 2022/07/21 R.Azucena [QC#60240-2 MOD] -->
                <iterate property="allocTrgtWhList" var="allocTrgtWhList[]" open="(" close=")" conjunction=",">
                    #allocTrgtWhList[]#
                </iterate>
                <!-- START 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                    <isNotNull property="rtlWhCatgCdList">
                    OR (
                            RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                        <iterate property="rtlWhCatgCdList" var="rtlWhCatgCdList[]"
                        open="AND RW.RTL_WH_CATG_CD IN (" conjunction=", " close=")"> #rtlWhCatgCdList[]#
                        </iterate>
                        AND RW.EZCANCELFLAG = '0'
                    )
                    </isNotNull>
                )
                <!-- END 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                <!-- START 2022/06/22 R.Azucena [QC#60240 ADD] -->
                </isEqual>
                <!-- END 2022/06/22 R.Azucena [QC#60240 ADD] -->
                </isEqual>
                </isNotNull>
                <isNull property="allocTrgtWhList">
                    AND TPWRX.RTL_WH_CD IN         #emptyList#
                </isNull>
                <!-- END 2021/11/04 A.Marte [QC#58989-2, ADD] -->
                <!-- 2024/04/03 QC#63814 Mod Start -->
                AND TPWRX.EZCANCELFLAG(+)         = '0'
                <!-- 2024/04/03 QC#63814 Mod End -->
                AND SS.GLBL_CMPY_CD(+)         = I.GLBL_CMPY_CD
                AND SS.STK_STS_CD(+)           = I.STK_STS_CD
                AND SS.EZCANCELFLAG(+)         = '0'
                <!-- START 2022/06/22 R.Azucena [QC#60240 ADD] -->
                <!-- Inbound Tech Request -->
                UNION ALL
                SELECT DISTINCT
                   SUM(TR_INVTY_QTY) AS VIS_QTY
                  ,MDSE_CD
                  ,WH_RG_CD
                  ,RTL_WH_CD
                  ,STK_LOC_CD
                  ,STK_STS_NM
                  ,INVTY_STS_CD
                  ,SER_NUM
                  ,RSVD_FIRST_CD
                  ,INVTY_SRC_CD
                FROM (
                   SELECT DISTINCT
                       CASE WHEN PRDT.PRCH_REQ_LINE_STS_CD = #prchReqLineStsOpen# THEN PRDT.PRCH_REQ_QTY
                            WHEN PRDT.PRCH_REQ_LINE_STS_CD = #prchReqLineStsPartialRcvd# THEN (
                                SELECT
                                    REQQ.PRCH_REQ_QTY - SUBQ.CALC
                                FROM
                                    (
                                        SELECT
                                            PRD.PRCH_REQ_NUM
                                           ,PRD.PRCH_REQ_LINE_NUM
                                           ,PRD.PRCH_REQ_QTY
                                        FROM
                                            PRCH_REQ_DTL PRD
                                        WHERE
                                            PRD.PRCH_REQ_LINE_SUB_NUM = 0
                                        AND PRD.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
                                        AND PRD.PRCH_REQ_LINE_NUM     = PRDT.PRCH_REQ_LINE_NUM
                                    ) REQQ
                                   ,(
                                        SELECT
                                            PRD.PRCH_REQ_NUM,
                                            PRD.PRCH_REQ_LINE_NUM,
                                            SUM(PRD.RWS_PUT_AWAY_QTY + PRD.PRCH_REQ_CANC_QTY) AS CALC
                                        FROM
                                            PRCH_REQ_DTL PRD
                                        WHERE
                                            PRD.PRCH_REQ_LINE_SUB_NUM > 0
                                        AND PRD.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
                                        AND PRD.PRCH_REQ_LINE_NUM     = PRDT.PRCH_REQ_LINE_NUM
                                        GROUP BY
                                            PRD.PRCH_REQ_NUM
                                           ,PRD.PRCH_REQ_LINE_NUM
                                    ) SUBQ 
                                WHERE
                                    REQQ.PRCH_REQ_NUM      = SUBQ.PRCH_REQ_NUM
                                AND REQQ.PRCH_REQ_LINE_NUM = SUBQ.PRCH_REQ_LINE_NUM
                            )
                            ELSE PRDT.PRCH_REQ_QTY - PRDT.PRCH_REQ_CANC_QTY - PRDT.RWS_PUT_AWAY_QTY - PRDT.SHIP_QTY
                       END AS TR_INVTY_QTY
                      ,PRDT.MDSE_CD
                      ,TPWRX.TRD_PTNR_WH_RG_NM AS WH_RG_CD
                      ,PRDT.DEST_RTL_WH_CD     AS RTL_WH_CD
                      ,'0'                     AS STK_LOC_CD
                      <!-- START 2022/07/06 R.Azucena [QC#60240-1 MOD] -->
                      <!-- ,CASE -->
                      <!--      WHEN RS.RTL_SWH_CD = #swhCdG# THEN #subWarehouse# || ' ' || UPPER(SS.STK_STS_NM) -->
                      <!--      ELSE UPPER(SS.STK_STS_NM) -->
                      <!--  END AS STK_STS_NM -->
                      <!-- START 2022/07/21 R.Azucena [QC#60240-2 MOD] -->
                      <!-- ,UPPER(SS.STK_STS_NM)    AS STK_STS_NM -->
                      ,NVL(UPPER(SS.STK_STS_NM), #goodNm#) AS STK_STS_NM
                      <!-- END 2022/07/21 R.Azucena [QC#60240-2 MOD] -->
                      <!-- END 2022/07/06 R.Azucena [QC#60240-1 MOD] -->
                      ,#inboundInvty#          AS INVTY_STS_CD
                      ,NULL                    AS SER_NUM
                      ,NULL                    AS RSVD_FIRST_CD
                      ,#S21#                   AS INVTY_SRC_CD
                      ,PRDT.PRCH_REQ_NUM
                      ,PRDT.PRCH_REQ_LINE_NUM
                   FROM
                       PRCH_REQ            PRRQ
                      ,PRCH_REQ_DTL        PRDT
                      ,PRCH_REQ_LINE_STS   PRLS
                      ,MDSE                M
                      ,STK_STS             SS
                      ,TRD_PTNR_WH_RG_XREF TPWRX
                      ,RTL_SWH             RS
                      ,RTL_WH              RW
                   WHERE
                       PRRQ.GLBL_CMPY_CD          = #glblCmpyCd#
                   AND PRRQ.EZCANCELFLAG          = '0'
                   AND PRRQ.PRCH_REQ_REC_TP_CD    = #techReq#
                   AND PRRQ.PRCH_REQ_STS_CD       = #openStatus#
                   <iterate property="techReqPrchReqTpCdList" var="techReqPrchReqTpCdList[]"
                   open="AND PRRQ.PRCH_REQ_TP_CD IN (" conjunction=", " close=")"> #techReqPrchReqTpCdList[]#
                   </iterate>
                   <iterate property="techReqPrchReqApvlStsCdList" var="techReqPrchReqApvlStsCdList[]"
                   open="AND PRRQ.PRCH_REQ_APVL_STS_CD IN (" conjunction=", " close=")"> #techReqPrchReqApvlStsCdList[]#
                   </iterate>
                   AND PRRQ.GLBL_CMPY_CD          = PRDT.GLBL_CMPY_CD
                   AND PRRQ.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
                   AND PRDT.EZCANCELFLAG          = '0'
                   AND PRDT.PRCH_REQ_LINE_SUB_NUM = '0'
                   <iterate property="techReqPrchReqLineStsCdList" var="techReqPrchReqLineStsCdList[]"
                   open="AND PRDT.PRCH_REQ_LINE_STS_CD IN (" conjunction=", " close=")"> #techReqPrchReqLineStsCdList[]#
                   </iterate>
                   <!-- START 2022/07/21 R.Azucena [QC#60240-2 DEL] -->
                   <!-- AND PRDT.TO_STK_STS_CD         = #goodStkSts# -->
                   <!-- END 2022/07/21 R.Azucena [QC#60240-2 DEL] -->
                   AND (   (PRDT.PRCH_REQ_BAL_QTY = 0 AND PRDT.PRCH_REQ_LINE_STS_CD = #prchReqLineStsOpen#) 
                        OR (PRDT.PRCH_REQ_QTY - PRDT.PRCH_REQ_CANC_QTY - PRDT.RWS_PUT_AWAY_QTY - PRDT.SHIP_QTY > 0))
                   AND PRDT.GLBL_CMPY_CD          = PRLS.GLBL_CMPY_CD
                   AND PRDT.PRCH_REQ_LINE_STS_CD  = PRLS.PRCH_REQ_LINE_STS_CD
                   AND PRLS.EZCANCELFLAG          = '0'
                   AND PRLS.OPEN_STS_FLG          = #flagY#
                   AND PRDT.GLBL_CMPY_CD          = M.GLBL_CMPY_CD
                   AND PRDT.MDSE_CD               = M.MDSE_CD
                   AND M.EXP_ITEM_FLG             &lt;&gt; #flagY#
                   <iterate property="includeMdseSts" var="includeMdseSts[]"
                   open="AND M.MDSE_ITEM_STS_CD IN (" conjunction=", " close=")"> #includeMdseSts[]#
                   </iterate>
                   <iterate property="includeMdseTp" var="includeMdseTp[]"
                   open="AND M.MDSE_ITEM_TP_CD IN (" conjunction=", " close=")"> #includeMdseTp[]#
                   </iterate>
                   <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                   open="AND M.MDSE_ITEM_CLS_TP_CD IN (" conjunction=", " close=")"> #includeMdseClsTp[]#
                   </iterate>
                   AND M.EZCANCELFLAG             = '0'
                   AND TPWRX.GLBL_CMPY_CD         = PRDT.GLBL_CMPY_CD
                   AND TPWRX.RTL_WH_CD            = PRDT.DEST_RTL_WH_CD
                   AND TPWRX.RTL_SWH_CD           = PRDT.DEST_RTL_SWH_CD
                   <isNotNull property="inboundTrPoTrgtWhList">
                   <isEqual property="inboundTrPoInclTECH" compareValue="Y">
                   AND (TPWRX.RTL_WH_CD IN
                   <iterate property="inboundTrPoTrgtWhList" var="inboundTrPoTrgtWhList[]" open="(" close=")" conjunction=",">
                       #inboundTrPoTrgtWhList[]#
                   </iterate>
                       <!-- START 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                       <isNotNull property="rtlWhCatgCdList">
                       OR (
                               RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                           <iterate property="rtlWhCatgCdList" var="rtlWhCatgCdList[]"
                           open="AND RW.RTL_WH_CATG_CD IN (" conjunction=", " close=")"> #rtlWhCatgCdList[]#
                           </iterate>
                           AND RW.EZCANCELFLAG = '0'
                       )
                       </isNotNull>
                       <!-- END 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                       OR (
                               RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                           <iterate property="locTpCdList" var="locTpCdList[]"
                           open="AND RW.LOC_TP_CD IN (" conjunction=", " close=")"> #locTpCdList[]#
                           </iterate>
                           AND RW.EZCANCELFLAG = '0'
                           AND RS.RTL_SWH_CD   = TPWRX.RTL_SWH_CD
                           AND RS.RTL_SWH_CD   = #swhCdG#
                           AND RS.EZCANCELFLAG = '0'
                       )
                   )
                   </isEqual>
                   <isEqual property="inboundTrPoInclTECH" compareValue="N">
                   <!-- START 2022/07/21 R.Azucena [QC#60240-2 MOD] -->
                   <!-- AND TPWRX.RTL_WH_CD IN -->
                   AND (TPWRX.RTL_WH_CD IN
                   <!-- END 2022/07/21 R.Azucena [QC#60240-2 MOD] -->
                   <iterate property="inboundTrPoTrgtWhList" var="inboundTrPoTrgtWhList[]" open="(" close=")" conjunction=",">
                       #inboundTrPoTrgtWhList[]#
                   </iterate>
                   <!-- START 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                       <isNotNull property="rtlWhCatgCdList">
                       OR (
                               RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                           <iterate property="rtlWhCatgCdList" var="rtlWhCatgCdList[]"
                           open="AND RW.RTL_WH_CATG_CD IN (" conjunction=", " close=")"> #rtlWhCatgCdList[]#
                           </iterate>
                           AND RW.EZCANCELFLAG = '0'
                       )
                       </isNotNull>
                   )
                   <!-- END 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                   </isEqual>
                   </isNotNull>
                   <isNull property="inboundTrPoTrgtWhList">
                   AND TPWRX.RTL_WH_CD IN         #emptyList#
                   </isNull>
                   <!-- 2024/04/03 QC#63814 Mod Start -->
                   AND TPWRX.EZCANCELFLAG(+)         = '0'
                   <!-- 2024/04/03 QC#63814 Mod End -->
                   <!-- START 2022/07/21 R.Azucena [QC#60240-2 MOD] -->
                   <!-- AND SS.GLBL_CMPY_CD            = PRDT.GLBL_CMPY_CD -->
                   <!-- AND SS.STK_STS_CD              = PRDT.TO_STK_STS_CD -->
                   <!-- AND SS.EZCANCELFLAG            = '0' -->
                   AND SS.GLBL_CMPY_CD(+)         = PRDT.GLBL_CMPY_CD
                   AND SS.STK_STS_CD(+)           = PRDT.TO_STK_STS_CD
                   AND SS.EZCANCELFLAG(+)         = '0'
                   <!-- END 2022/07/21 R.Azucena [QC#60240-2 MOD] -->
                   AND RS.GLBL_CMPY_CD            = PRDT.GLBL_CMPY_CD
                   AND RS.RTL_SWH_CD              = PRDT.DEST_RTL_SWH_CD
                   AND RS.EZCANCELFLAG            = '0'
                   AND RW.GLBL_CMPY_CD            = PRDT.GLBL_CMPY_CD
                   AND RW.RTL_WH_CD               = PRDT.DEST_RTL_WH_CD
                   AND RW.EZCANCELFLAG            = '0'
                )
                WHERE 1=1
                AND TR_INVTY_QTY &gt; 0
                GROUP BY
                    MDSE_CD
                   ,WH_RG_CD
                   ,RTL_WH_CD
                   ,STK_LOC_CD
                   ,STK_STS_NM
                   ,INVTY_STS_CD
                   ,SER_NUM
                   ,RSVD_FIRST_CD
                   ,INVTY_SRC_CD
                <!-- Inbound PO -->
                UNION ALL
                SELECT DISTINCT
                    SUM(PO_INVTY_QTY) AS VIS_QTY
                   ,MDSE_CD
                   ,WH_RG_CD
                   ,RTL_WH_CD
                   ,STK_LOC_CD
                   ,STK_STS_NM
                   ,INVTY_STS_CD
                   ,SER_NUM
                   ,RSVD_FIRST_CD
                   ,INVTY_SRC_CD
                FROM (
                   SELECT DISTINCT
                       PD.PO_QTY               AS PO_INVTY_QTY
                      ,PD.MDSE_CD
                      ,TPWRX.TRD_PTNR_WH_RG_NM AS WH_RG_CD
                      ,PD.DEST_RTL_WH_CD       AS RTL_WH_CD
                      ,'0'                     AS STK_LOC_CD
                      <!-- START 2022/07/06 R.Azucena [QC#60240-1 MOD] -->
                      <!-- ,CASE -->
                      <!--      WHEN RS.RTL_SWH_CD = #swhCdG# THEN #subWarehouse# || ' ' || UPPER(SS.STK_STS_NM) -->
                      <!--      ELSE UPPER(SS.STK_STS_NM) -->
                      <!--  END AS STK_STS_NM -->
                      ,UPPER(SS.STK_STS_NM)    AS STK_STS_NM
                      <!-- END 2022/07/06 R.Azucena [QC#60240-1 MOD] -->
                      ,#inboundInvty#          AS INVTY_STS_CD
                      ,NULL                    AS SER_NUM
                      ,NULL                    AS RSVD_FIRST_CD
                      ,#S21#                   AS INVTY_SRC_CD
                      ,PD.PO_ORD_NUM
                      ,PD.PO_ORD_DTL_LINE_NUM
                   FROM
                       PO_DTL              PD
                      ,MDSE                M
                      ,RTL_WH              RW
                      ,STK_STS             SS
                      ,TRD_PTNR_WH_RG_XREF TPWRX
                      ,RTL_SWH             RS
                   WHERE 1 = 1
                   AND PD.EZCANCELFLAG    = '0'
                   AND PD.GLBL_CMPY_CD    = #glblCmpyCd#
                   AND PD.TO_STK_STS_CD   = #goodStkSts#
                   <iterate property="poTechLineStsCdList" var="poTechLineStsCdList[]"
                   open="AND PD.PO_LINE_STS_CD IN (" conjunction=", " close=")"> #poTechLineStsCdList[]#
                   </iterate>
                   AND PD.PRCH_REQ_LINE_NUM IS NULL
                   AND PD.MDSE_CD         &lt;&gt; #createMaterial#
                   AND PD.GLBL_CMPY_CD    = M.GLBL_CMPY_CD
                   AND PD.MDSE_CD         = M.MDSE_CD
                   AND M.EXP_ITEM_FLG     &lt;&gt; #flagY#
                   <iterate property="includeMdseSts" var="includeMdseSts[]"
                   open="AND M.MDSE_ITEM_STS_CD IN (" conjunction=", " close=")"> #includeMdseSts[]#
                   </iterate>
                   <iterate property="includeMdseTp" var="includeMdseTp[]"
                   open="AND M.MDSE_ITEM_TP_CD IN (" conjunction=", " close=")"> #includeMdseTp[]#
                   </iterate>
                   <iterate property="includeMdseClsTp" var="includeMdseClsTp[]"
                   open="AND M.MDSE_ITEM_CLS_TP_CD IN (" conjunction=", " close=")"> #includeMdseClsTp[]#
                   </iterate>
                   AND M.EZCANCELFLAG     = '0'
                   AND TPWRX.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                   AND TPWRX.RTL_WH_CD    = PD.DEST_RTL_WH_CD
                   AND TPWRX.RTL_SWH_CD   = PD.DEST_RTL_SWH_CD
                   <isNotNull property="inboundTrPoTrgtWhList">
                   <isEqual property="inboundTrPoInclTECH" compareValue="Y">
                   AND (TPWRX.RTL_WH_CD IN
                   <iterate property="inboundTrPoTrgtWhList" var="inboundTrPoTrgtWhList[]" open="(" close=")" conjunction=",">
                       #inboundTrPoTrgtWhList[]#
                   </iterate>
                       <!-- START 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                       <isNotNull property="rtlWhCatgCdList">
                       OR (
                               RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                           <iterate property="rtlWhCatgCdList" var="rtlWhCatgCdList[]"
                           open="AND RW.RTL_WH_CATG_CD IN (" conjunction=", " close=")"> #rtlWhCatgCdList[]#
                           </iterate>
                           AND RW.EZCANCELFLAG = '0'
                       )
                       </isNotNull>
                       <!-- END 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                       OR (
                               RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                           <iterate property="locTpCdList" var="locTpCdList[]"
                           open="AND RW.LOC_TP_CD IN (" conjunction=", " close=")"> #locTpCdList[]#
                           </iterate>
                           AND RW.EZCANCELFLAG = '0'
                           AND RS.RTL_SWH_CD   = TPWRX.RTL_SWH_CD
                           AND RS.RTL_SWH_CD   = #swhCdG#
                           AND RS.EZCANCELFLAG = '0'
                       )
                   )
                   </isEqual>
                   <isEqual property="inboundTrPoInclTECH" compareValue="N">
                   <!-- START 2022/07/21 R.Azucena [QC#60240-2 MOD] -->
                   <!-- AND TPWRX.RTL_WH_CD IN -->
                   AND (TPWRX.RTL_WH_CD IN
                   <!-- END 2022/07/21 R.Azucena [QC#60240-2 MOD] -->
                   <iterate property="inboundTrPoTrgtWhList" var="inboundTrPoTrgtWhList[]" open="(" close=")" conjunction=",">
                       #inboundTrPoTrgtWhList[]#
                   </iterate>
                   <!-- START 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                       <isNotNull property="rtlWhCatgCdList">
                       OR (
                               RW.RTL_WH_CD    = TPWRX.RTL_WH_CD
                           <iterate property="rtlWhCatgCdList" var="rtlWhCatgCdList[]"
                           open="AND RW.RTL_WH_CATG_CD IN (" conjunction=", " close=")"> #rtlWhCatgCdList[]#
                           </iterate>
                           AND RW.EZCANCELFLAG = '0'
                       )
                       </isNotNull>
                   )
                   <!-- END 2022/07/21 R.Azucena [QC#60240-2 ADD] -->
                   </isEqual>
                   </isNotNull>
                   <isNull property="inboundTrPoTrgtWhList">
                   AND TPWRX.RTL_WH_CD    IN #emptyList#
                   </isNull>
                   AND TPWRX.EZCANCELFLAG = '0'
                   AND RW.GLBL_CMPY_CD    = PD.GLBL_CMPY_CD
                   AND RW.RTL_WH_CD       = PD.DEST_RTL_WH_CD
                   AND RW.EZCANCELFLAG    = '0'
                   AND SS.GLBL_CMPY_CD    = PD.GLBL_CMPY_CD
                   AND SS.STK_STS_CD      = PD.TO_STK_STS_CD
                   AND SS.EZCANCELFLAG    = '0'
                   AND RS.GLBL_CMPY_CD    = PD.GLBL_CMPY_CD
                   AND RS.RTL_SWH_CD      = PD.DEST_RTL_SWH_CD
                   AND RS.EZCANCELFLAG    = '0'
                )
                WHERE 1=1
                GROUP BY
                    MDSE_CD
                   ,WH_RG_CD
                   ,RTL_WH_CD
                   ,STK_LOC_CD
                   ,STK_STS_NM
                   ,INVTY_STS_CD
                   ,SER_NUM
                   ,RSVD_FIRST_CD
                   ,INVTY_SRC_CD
                <!-- END 2022/06/22 R.Azucena [QC#60240 ADD] -->
            )
            SELECT
                PII.MDSE_CD
               ,PII.WH_RG_CD
               ,PII.RTL_WH_CD
               ,PII.STK_LOC_CD
               ,PII.STK_STS_NM
               ,PII.INVTY_STS_CD
               ,SUM(PII.VIS_QTY) AS VIS_QTY
               ,PII.SER_NUM
               ,PII.RSVD_FIRST_CD
               ,PII.INVTY_SRC_CD
            FROM
                PO_INVTY_INFO PII
            GROUP BY
                PII.MDSE_CD
               ,PII.WH_RG_CD
               ,PII.RTL_WH_CD
               ,PII.STK_LOC_CD
               ,PII.STK_STS_NM
               ,PII.INVTY_STS_CD
               ,PII.SER_NUM
               ,PII.RSVD_FIRST_CD
               ,PII.INVTY_SRC_CD
            ORDER BY PII.MDSE_CD
    </statement>
</sqlMap>
