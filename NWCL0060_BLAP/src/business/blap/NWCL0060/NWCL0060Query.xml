<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWCL0060Query">
    
    <statement id="getBill" parameterClass="Map" resultClass="Map">
        SELECT
            DS_BIZ_AREA_CD
            ,IPH.LINE_BIZ_TP_CD 
        FROM 
             INV_PRT_CTRL IPC
            ,INV_PRT_HDR  IPH 
            ,(SELECT
                IPC.GLBL_CMPY_CD
               ,IPC.CONSL_BILL_NUM
               ,MAX(DI.DS_BIZ_AREA_CD) AS DS_BIZ_AREA_CD
             FROM
                INV_PRT_CTRL IPC
               ,INV DI
             WHERE
                 IPC.GLBL_CMPY_CD   = #glblCmpyCd#
             AND IPC.CONSL_BILL_NUM = #conslBillNum#
             AND IPC.EZCANCELFLAG   = '0'
             AND IPC.GLBL_CMPY_CD   = DI.GLBL_CMPY_CD
             AND IPC.INV_NUM        = DI.INV_NUM
             AND DI.EZCANCELFLAG    = '0'
             GROUP BY IPC.GLBL_CMPY_CD
                     ,IPC.CONSL_BILL_NUM
            ) DI
        WHERE
            IPC.GLBL_CMPY_CD        = #glblCmpyCd#
        AND IPC.INV_PRT_CTRL_REC_CD = #invPrtCtrlRecCd#
        AND IPC.EZCANCELFLAG        = '0'
        AND IPH.GLBL_CMPY_CD        = IPC.GLBL_CMPY_CD
        AND IPH.INV_PRT_CTRL_PK     = IPC.INV_PRT_CTRL_PK
        AND IPH.EZCANCELFLAG        = '0'
        AND DI.GLBL_CMPY_CD         = IPC.GLBL_CMPY_CD
        AND DI.CONSL_BILL_NUM       = IPC.CONSL_BILL_NUM
    </statement>

    <statement id="getInvoice" parameterClass="Map" resultClass="Map">
        SELECT
            DS_BIZ_AREA_CD
            ,IPH.LINE_BIZ_TP_CD
        FROM 
             INV_PRT_CTRL IPC
            ,INV_PRT_HDR  IPH
            ,INV DI
        WHERE
            IPC.GLBL_CMPY_CD        = #glblCmpyCd#
        AND IPC.INV_PRT_CTRL_REC_CD &lt;&gt; #invPrtCtrlRecCd#
        AND IPC.EZCANCELFLAG        = '0'
        AND IPH.GLBL_CMPY_CD        = IPC.GLBL_CMPY_CD
        AND IPH.INV_PRT_CTRL_PK     = IPC.INV_PRT_CTRL_PK
        AND IPH.EZCANCELFLAG        = '0'
        AND DI.GLBL_CMPY_CD         = IPC.GLBL_CMPY_CD
        AND DI.EZCANCELFLAG         = '0'
        AND DI.INV_NUM              = IPC.INV_NUM
        AND DI.INV_NUM              = #invNum#
    </statement>

</sqlMap>
