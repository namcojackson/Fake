<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSZC001001">
    <statement id="findConversionInProcess" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            SMM.SVC_MACH_MSTR_PK
        FROM
            SVC_MACH_MSTR SMM
        WHERE
                SMM.GLBL_CMPY_CD          = #glblCmpyCd#
            AND SMM.SVC_MACH_MSTR_PK      = #svcMachMstrPk#
            AND SMM.CONV_INPROC_FLG       = 'Y'
            AND SMM.SVC_MACH_MSTR_STS_CD &lt;&gt; #svcMachMstrStsCd#
            AND SMM.EZCANCELFLAG          = '0'
            AND ROWNUM                    = 1
    </statement>

    <statement id="findNextCmptSqNum" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            NVL(MAX(SMM.SVC_MACH_SQ_NUM), 0) + 1
        FROM
            SVC_MACH_MSTR               SMM
        WHERE
                SMM.GLBL_CMPY_CD            =   #glblCmpyCd#
            AND SMM.EZCANCELFLAG            =   '0'
            AND SMM.SVC_CONFIG_MSTR_PK      =   #svcConfigMstrPk#
    </statement>

    <statement id="findDsModelMeter" parameterClass="Map" resultClass="Map">
<!-- START 2016/08/25 T.Tomita [QC#11772, MOD] -->
        SELECT
             DMM.DS_MDL_MTR_PK          AS DS_MDL_MTR_PK
            ,DMM.MTR_GRP_PK             AS MTR_GRP_PK
            ,MG.MTR_GRP_NM              AS MTR_GRP_NM
            ,MG.MTR_GRP_DESC_TXT        AS MTR_GRP_DESC_TXT
            ,DMM.MDL_MTR_ID             AS MDL_MTR_ID
            ,DMM.MTR_CLS_TP_CD          AS MTR_CLS_TP_CD
            ,DMM.SVC_MTR_AVAL_FLG       AS SVC_MTR_AVAL_FLG
            ,DMM.BLLG_MTR_AVAL_FLG      AS BLLG_MTR_AVAL_FLG
            ,DMM.MAX_MTR_CNT            AS MAX_MTR_CNT
            ,DMM.AVG_MLY_COPY_VOL_CNT   AS AVG_MLY_COPY_VOL_CNT
            ,DMM.MAX_MLY_COPY_VOL_CNT   AS MAX_MLY_COPY_VOL_CNT
            ,DMM.MDL_MTR_LB_CD          AS MDL_MTR_LB_CD
            ,DMM.MDL_MTR_LB_NOTE_TXT    AS MDL_MTR_LB_NOTE_TXT
            ,DMM.BLLG_MTR_ID            AS BLLG_MTR_ID
            ,DMM.BLLG_MTR_LB_CD         AS BLLG_MTR_LB_CD
            ,DMM.MTR_ENTRY_MND_FLG      AS MTR_ENTRY_MND_FLG
            ,DMM.MTR_MULT_RATE          AS MTR_MULT_RATE
            ,ML.FLEET_MTR_LB_CD         AS FLEET_MDL_MTR_LB_CD
            ,ML.AGGR_MTR_LB_CD          AS AGGR_MDL_MTR_LB_CD
            ,DMM.ACTV_FLG               AS ACTV_FLG
            ,DMM.CNTR_DIGIT_NUM         AS CNTR_DIGIT_NUM
        FROM
             DS_MDL          DM
            ,DS_MDL_MTR      DMM
            ,MTR_GRP         MG
            ,MTR_LB          ML
        WHERE
                DM.GLBL_CMPY_CD           = #glblCmpyCd#
            AND DM.MDL_ID                 = #mdlId#
            AND DM.EZCANCELFLAG           = '0'
            AND DM.GLBL_CMPY_CD           = DMM.GLBL_CMPY_CD
            AND DM.MTR_GRP_PK             = DMM.MTR_GRP_PK
            AND DMM.EZCANCELFLAG          = '0'
            AND DMM.ACTV_FLG              = 'Y'
            AND DM.GLBL_CMPY_CD           = MG.GLBL_CMPY_CD
            AND DM.MTR_GRP_PK             = MG.MTR_GRP_PK
            AND MG.EZCANCELFLAG           = '0'
            AND DMM.GLBL_CMPY_CD          = ML.GLBL_CMPY_CD (+)
            AND DMM.MDL_MTR_LB_CD         = ML.MTR_LB_CD    (+)
            AND ML.EZCANCELFLAG (+)       = '0'
<!-- END 2016/08/25 T.Tomita [QC#11772, MOD] -->
    </statement>

    <statement id="findSvcMachMstrByShip" parameterClass="Map" resultClass="Map">
        SELECT
             SCMD.SVC_MACH_MSTR_PK      AS SVC_MACH_MSTR_PK
            ,SCMD.SER_NUM               AS SER_NUM
            ,SCMD.MDSE_CD               AS MDSE_CD
            ,SCMD.ISTL_DT               AS ISTL_DT
            ,SCMD.SVC_MACH_RMV_DT       AS SVC_MACH_RMV_DT
            ,SCMD.OWNR_ACCT_NUM         AS OWNR_ACCT_NUM
            ,SCMD.OWNR_LOC_NUM          AS OWNR_LOC_NUM
            ,SCMD.BILL_TO_ACCT_NUM      AS BILL_TO_ACCT_NUM
            ,SCMD.BILL_TO_LOC_NUM       AS BILL_TO_LOC_NUM
            ,SCMD.CUR_LOC_ACCT_NUM      AS CUR_LOC_ACCT_NUM
            ,SCMD.CUR_LOC_NUM           AS CUR_LOC_NUM
            ,SCMD.ISTL_LOC_OVRD_FLG     AS ISTL_LOC_OVRD_FLG
            ,SCMD.LOC_NM                AS LOC_NM
            ,SCMD.ADDL_LOC_NM           AS ADDL_LOC_NM
            ,SCMD.FIRST_LINE_ADDR       AS FIRST_LINE_ADDR
            ,SCMD.SCD_LINE_ADDR         AS SCD_LINE_ADDR
            ,SCMD.THIRD_LINE_ADDR       AS THIRD_LINE_ADDR
            ,SCMD.FRTH_LINE_ADDR        AS FRTH_LINE_ADDR
            ,SCMD.CTY_ADDR              AS CTY_ADDR
            ,SCMD.ST_CD                 AS ST_CD
            ,SCMD.POST_CD               AS POST_CD
            ,SCMD.RGTN_CONFIG_DT        AS RGTN_CONFIG_DT
            ,SMM.SVC_MACH_TP_CD         AS SVC_MACH_TP_CD
        FROM
             SVC_MACH_MSTR              SMM
            ,SVC_CONFIG_MSTR_DTL        SCMD
        WHERE
                SMM.GLBL_CMPY_CD          = #glblCmpyCd#
            AND SMM.SVC_CONFIG_MSTR_PK    = #svcConfigMstrPk#
            AND SMM.EZCANCELFLAG          = '0'
            AND SMM.GLBL_CMPY_CD          = SCMD.GLBL_CMPY_CD
            AND SMM.SVC_MACH_MSTR_PK      = SCMD.SVC_MACH_MSTR_PK
            AND SCMD.SVC_MACH_RMV_DT      IS NULL
            AND SCMD.EZCANCELFLAG         = '0'
        ORDER BY
             SVC_MACH_TP_CD
            ,SVC_MACH_MSTR_PK
    </statement>

    <statement id="findSvcConfigMstrForUpdTrmn" parameterClass="Map" resultClass="BigDecimal">
        <!-- START 2018/02/27 M.Naito [QC#24047, MOD] -->
        SELECT
             COUNT(SCMD.SVC_CONFIG_MSTR_PK)
        FROM
             SVC_CONFIG_MSTR_DTL SCMD
        WHERE
                SCMD.GLBL_CMPY_CD        = #glblCmpyCd#
            AND SCMD.SVC_CONFIG_MSTR_PK  = #svcConfigMstrPk#
            AND SCMD.SVC_MACH_MSTR_PK    &lt;&gt; #svcMachMstrPk#
            AND SCMD.SVC_MACH_RMV_DT    IS NULL
            AND SCMD.EZCANCELFLAG       = '0'
        <!-- END 2018/02/27 M.Naito [QC#24047, MOD] -->
    </statement>
    
    <statement id="findSvcMachMstrForCheckExstWH" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            SMM.SVC_MACH_MSTR_PK
        FROM
            SVC_MACH_MSTR           SMM
        WHERE
                SMM.GLBL_CMPY_CD        =   #glblCmpyCd#
            AND SMM.EZCANCELFLAG        =   '0'
            AND SMM.SER_NUM             =   #serNum#
            <iterate property="svcMachMstrStsList" var="svcMachMstrStsList[]" open="AND SMM.SVC_MACH_MSTR_STS_CD IN (" close=")" conjunction=",">
                #svcMachMstrStsList[]#
            </iterate>
    </statement>

    <statement id="findSvcMachMstrForItemChngForCheckDummySerNum" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            SMM.SVC_MACH_MSTR_PK
        FROM
            SVC_MACH_MSTR           SMM
        WHERE
                SMM.GLBL_CMPY_CD        =   #glblCmpyCd#
            AND SMM.EZCANCELFLAG        =   '0'
            AND SMM.SER_NUM             =   #serNum#
            <iterate property="svcMachMstrStsList" var="svcMachMstrStsList[]" open="AND SMM.SVC_MACH_MSTR_STS_CD NOT IN (" close=")" conjunction=",">
                #svcMachMstrStsList[]#
            </iterate>
    </statement>

    <statement id="findSvcExchngOrd" parameterClass="Map" resultClass="Map">
<!-- START 2018/06/07 T.Tomita [QC#26482, MOD] -->
        SELECT
             SMM2.SVC_MACH_MSTR_PK      AS SVC_MACH_MSTR_PK
            ,SCMD2.SVC_CONFIG_MSTR_PK   AS SVC_CONFIG_MSTR_PK
            ,CASE 
                WHEN DCRD.BASE_CMPT_FLG = 'Y' THEN #svcMachTpCdIsMach#
                ELSE #svcMachTpCdIsAcc#
             END SVC_MACH_TP_CD
        FROM
             SVC_MACH_MSTR          SMM
            ,SVC_CONFIG_MSTR_DTL    SCMD
            ,SVC_CONFIG_MSTR_DTL    SCMD2
            ,SVC_MACH_MSTR          SMM2
            ,DS_CPO_RTRN_DTL        DCRD
            ,CPO                    C
            ,DS_ORD_TP              DOT
            ,ORD_CATG_BIZ_CTX       OCBC
        WHERE
                SMM.GLBL_CMPY_CD           =   #glblCmpyCd#
            AND SMM.SVC_MACH_MSTR_PK       =   #svcMachMstrPk#
            AND SMM.EZCANCELFLAG           =   '0'
            AND SMM.GLBL_CMPY_CD           =   SCMD.GLBL_CMPY_CD
            AND SMM.SVC_MACH_MSTR_PK       =   SCMD.SVC_MACH_MSTR_PK
            AND SCMD.EZCANCELFLAG          =   '0'
            AND SCMD.SVC_MACH_RMV_DT       IS  NULL
            AND SCMD.GLBL_CMPY_CD          =   SCMD2.GLBL_CMPY_CD
            AND SCMD.SVC_CONFIG_MSTR_PK    =   SCMD2.SVC_CONFIG_MSTR_PK
            AND SCMD2.EZCANCELFLAG         =   '0'
            AND SCMD2.GLBL_CMPY_CD         =   SMM2.GLBL_CMPY_CD
            AND SCMD2.SVC_MACH_MSTR_PK     =   SMM2.SVC_MACH_MSTR_PK
            AND SMM2.EZCANCELFLAG          =   '0'
            AND SMM2.GLBL_CMPY_CD          =   DCRD.GLBL_CMPY_CD
<!-- START 2018/06/28 T.Tomita [QC#26838, MOD] -->
            AND SMM2.SVC_MACH_MSTR_PK      =   DCRD.SVC_MACH_MSTR_PK
<!-- END 2018/06/28 T.Tomita [QC#26838, MOD] -->
            AND DCRD.EZCANCELFLAG          =   '0'
            AND DCRD.GLBL_CMPY_CD          =   C.GLBL_CMPY_CD
            AND DCRD.CPO_ORD_NUM           =   C.CPO_ORD_NUM
            AND C.EZCANCELFLAG             =   '0'
            AND C.ORD_HDR_STS_CD           =   #ordHdrStsCd#
            AND C.GLBL_CMPY_CD             =   DOT.GLBL_CMPY_CD
            AND C.DS_ORD_TP_CD             =   DOT.DS_ORD_TP_CD
            AND DOT.EZCANCELFLAG           =   '0'
            AND DOT.GLBL_CMPY_CD           =   OCBC.GLBL_CMPY_CD
            AND DOT.DS_ORD_CATG_CD         =   OCBC.DS_ORD_CATG_CD
<!-- START 2019/06/17 W.Honda [QC#50842, ADD] -->
            AND (DOT.DS_ORD_TP_CD          =   OCBC.DS_ORD_TP_CD
                OR  OCBC.DS_ORD_TP_CD      IS NULL)
<!-- START 2019/06/17 W.Honda [QC#50842, ADD] -->
            AND OCBC.ORD_CATG_CTX_TP_CD    =   #orgCatgCtxTpCd#
            AND OCBC.EZCANCELFLAG          =   '0'
            AND NOT EXISTS (
                SELECT
                    *
                FROM
                     DS_CONTR_DTL   DCD
                    ,DS_CONTR_INTFC DCI
                WHERE
                        DCD.GLBL_CMPY_CD            =  SMM2.GLBL_CMPY_CD
                    AND DCD.SVC_MACH_MSTR_PK        =  SMM2.SVC_MACH_MSTR_PK
                    AND DCD.DS_CONTR_DTL_STS_CD NOT IN (#canceled#, #expired#)
                    AND DCD.EZCANCELFLAG            =  '0'
                    AND DCD.GLBL_CMPY_CD            =  DCI.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK         =  DCI.OLD_DS_CONTR_DTL_PK
                    AND DCD.SVC_MACH_MSTR_PK        =  DCI.OLD_SVC_MACH_MSTR_PK
                    AND DCI.EZCANCELFLAG            =  '0'
                    AND DCI.EZCANCELFLAG            =  '0'
                    AND DCI.CONTR_INTFC_SRC_TP_CD   =  #contrIntfcSrcTpCd#
                    AND DCI.DS_CONTR_INTFC_ACT_CD   =  #dsContrIntfcActCd#
                    AND DCI.DS_CONTR_INTFC_STS_CD   &lt;&gt; #success#
                )
<!-- END 2018/06/07 T.Tomita [QC#26482, MOD] -->
    </statement>
<!-- START 2016/04/14 M.Gotou [QC#4903, ADD] -->
    <statement id="findSvcConfigMstrDtlForUpd" parameterClass="Map" resultClass="Map">
        SELECT
             SCMD.SVC_CONFIG_MSTR_DTL_PK     AS SVC_CONFIG_MSTR_DTL_PK
            ,SCM.MDL_ID                      AS MDL_ID
        FROM
             SVC_CONFIG_MSTR_DTL    SCMD
            ,SVC_CONFIG_MSTR        SCM
        WHERE
                SCMD.GLBL_CMPY_CD       = #glblCmpyCd#
            AND SCMD.EZCANCELFLAG       = '0'
            AND SCMD.SVC_CONFIG_MSTR_PK = #svcConfigMstrPk#
            AND SCMD.SVC_MACH_MSTR_PK   = #svcMachMstrPk#
            AND SCMD.SVC_MACH_RMV_DT    IS NULL
            AND SCM.GLBL_CMPY_CD        = SCMD.GLBL_CMPY_CD
            AND SCM.EZCANCELFLAG        = '0'
            AND SCM.SVC_CONFIG_MSTR_PK  = SCMD.SVC_CONFIG_MSTR_PK
    </statement>
<!-- END 2016/04/14 M.Gotou [QC#4903, ADD] -->
    <statement id="findSvcByLineBizTpCd" parameterClass="Map" resultClass="Map">
        SELECT
             X.CPO_ORD_NUM      AS CPO_ORD_NUM
            ,X.DS_CPO_CONFIG_PK AS DS_CPO_CONFIG_PK
            ,X.ISTL_DIV_CD      AS ISTL_DIV_CD
        FROM
            DS_CPO_ISTL_INFO X
        WHERE
            EXISTS (
                SELECT
                    *
                FROM
                    CPO_DTL Z
                WHERE
                        Z.GLBL_CMPY_CD         = #glblCmpyCd#
                    AND Z.EZCANCELFLAG         = '0'
                    AND Z.CPO_ORD_NUM          = #cpoOrdNum#
                    AND Z.CPO_DTL_LINE_NUM     = #cpoDtlLineNum#
                    AND Z.CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
                    AND Z.GLBL_CMPY_CD         = X.GLBL_CMPY_CD
                    AND Z.CPO_ORD_NUM          = X.CPO_ORD_NUM
                    AND Z.DS_CPO_CONFIG_PK     = X.DS_CPO_CONFIG_PK
            )
        UNION ALL
        SELECT
             Y.CPO_ORD_NUM      AS CPO_ORD_NUM
            ,Y.DS_CPO_CONFIG_PK AS DS_CPO_CONFIG_PK
            ,Y.ISTL_DIV_CD      AS ISTL_DIV_CD
        FROM
            DS_CPO_ISTL_INFO Y
        WHERE
                Y.GLBL_CMPY_CD     =  #glblCmpyCd#
            AND Y.EZCANCELFLAG     =  '0'
            AND Y.CPO_ORD_NUM      =  #cpoOrdNum#
            AND Y.DS_CPO_CONFIG_PK IS NULL
        ORDER BY
            DS_CPO_CONFIG_PK ASC
    </statement>
<!-- START 2017/11/20 K.Ochiai [QC#21700, MOD] -->
    <statement id="getContractBranchForCpo" parameterClass="Map" resultClass="Map">
        SELECT
             SCCBM.SVC_CONTR_BR_CD  AS SVC_CONTR_BR_CD
            ,SCCBM.CONTR_ADMIN_PSN_CD
        FROM
            CPO                  DC
           ,S21_ORG              S21O
           ,SVC_CONTR_COA_BR_MAP SCCBM
        WHERE
            DC.GLBL_CMPY_CD              = #glblCmpyCd#
        AND DC.CPO_ORD_NUM               = #cpoOrdNum#
        AND DC.EZCANCELFLAG              = '0'
        AND DC.GLBL_CMPY_CD              = S21O.GLBL_CMPY_CD    (+)
        AND DC.SLS_REP_TOC_CD            = S21O.TOC_CD          (+)
        AND S21O.EZCANCELFLAG        (+) = '0'
        AND S21O.GLBL_CMPY_CD            = SCCBM.GLBL_CMPY_CD   (+)
        AND S21O.COA_BR_CD               = SCCBM.COA_BR_CD      (+)
        <!-- START 2018/01/09 M.Kidokoro [QC#20635,ADD] -->
        AND SCCBM.SVC_LINE_BIZ_CD    (+) = #svcLineBizCd#
        <!-- END 2018/01/09 M.Kidokoro [QC#20635,ADD] -->
        AND SCCBM.EZCANCELFLAG       (+) = '0'
    </statement>
    <statement id="getEmsdContractBranch" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM
            (
            SELECT
                 OCBC.SCD_BIZ_CTX_ATTRB_TXT   AS SVC_CONTR_BR_CD
                ,OCBC.THIRD_BIZ_CTX_ATTRB_TXT AS CONTR_ADMIN_PSN_CD
            FROM
                CPO                  CPO
               ,ORD_CATG_BIZ_CTX     OCBC
            WHERE
                    CPO.GLBL_CMPY_CD              = #glblCmpyCd#
                AND CPO.CPO_ORD_NUM               = #cpoOrdNum#
                AND CPO.EZCANCELFLAG              = '0'
                AND CPO.GLBL_CMPY_CD              = OCBC.GLBL_CMPY_CD
                AND CPO.DS_ORD_CATG_CD            = OCBC.DS_ORD_CATG_CD
                AND (
                        OCBC.DS_ORD_TP_CD IS NULL
                        OR (
                                OCBC.DS_ORD_TP_CD IS NOT NULL
                            AND CPO.DS_ORD_TP_CD  = OCBC.DS_ORD_TP_CD
                        )
                    )
                AND (
                        OCBC.DS_ORD_RSN_CD IS NULL
                        OR (
                                OCBC.DS_ORD_RSN_CD IS NOT NULL
                            AND CPO.DS_ORD_RSN_CD = OCBC.DS_ORD_RSN_CD
                        )
                    )
    
                AND OCBC.ORD_CATG_CTX_TP_CD(+)    = #emsdContrBrRep#
                AND OCBC.EZCANCELFLAG(+)          = '0'
             ORDER BY OCBC.DS_ORD_CATG_CD,OCBC.DS_ORD_TP_CD,OCBC.DS_ORD_RSN_CD
             )
         WHERE
            ROWNUM = 1
    </statement>
<!-- END 2017/11/20 K.Ochiai [QC#21700, MOD] -->
    <statement id="getContractBranch" parameterClass="Map" resultClass="Map">
        SELECT
             NVL(SOTM.SVC_CONTR_BR_CD, SCCBM.SVC_CONTR_BR_CD)   AS SVC_CONTR_BR_CD
            ,SCCBM.CONTR_ADMIN_PSN_CD
        FROM
            SPCL_ORD_TP_MAP      SOTM
           ,SVC_CONTR_COA_BR_MAP SCCBM
        WHERE
            SOTM.GLBL_CMPY_CD            = #glblCmpyCd#
        AND SOTM.DS_ORD_CATG_CD          = #dsOrdCatgCd#
        AND SOTM.EZCANCELFLAG            = '0'
        AND SOTM.GLBL_CMPY_CD            = SCCBM.GLBL_CMPY_CD   (+)
        AND SOTM.SVC_CONTR_BR_CD         = SCCBM.SVC_CONTR_BR_CD(+)
        <!-- START 2018/01/09 M.Kidokoro [QC#20635,ADD] -->
        AND SCCBM.SVC_LINE_BIZ_CD    (+) = #svcLineBizCd#
        <!-- END 2018/01/09 M.Kidokoro [QC#20635,ADD] -->
        AND SCCBM.EZCANCELFLAG       (+) = '0'
        ORDER BY
            SCCBM.COA_BR_CD
    </statement>
    <statement id="getContractSalesRepForCpo" parameterClass="Map" resultClass="String">
        SELECT
            <!-- START 2018/03/20 U.Kim [QC#21804, MOD] -->
            <!-- NVL(DC.SLS_REP_TOC_CD, SCBM.TOC_CD)     AS TOC_CD -->
            NVL(SCBM.TOC_CD, DC.SLS_REP_TOC_CD)     AS TOC_CD
            <!-- END 2018/03/20 U.Kim [QC#21804, MOD] -->
        FROM
            CPO                 DC
           ,S21_ORG             S21O
           ,SUB_CONTR_BR_MAP    SCBM
        WHERE
            DC.GLBL_CMPY_CD              = #glblCmpyCd#
        AND DC.CPO_ORD_NUM               = #cpoOrdNum#
        AND DC.EZCANCELFLAG              = '0'
        AND DC.GLBL_CMPY_CD              = S21O.GLBL_CMPY_CD    (+)
        AND DC.SLS_REP_TOC_CD            = S21O.TOC_CD          (+)
        AND S21O.EZCANCELFLAG        (+) = '0'
        AND S21O.GLBL_CMPY_CD            = SCBM.GLBL_CMPY_CD    (+)
        AND S21O.COA_BR_CD               = SCBM.SVC_CONTR_BR_CD (+)
        <!-- START 2018/01/09 M.Kidokoro [QC#20635,ADD] -->
        AND SCBM.SVC_LINE_BIZ_CD     (+) = #svcLineBizCd#
        <!-- END 2018/01/09 M.Kidokoro [QC#20635,ADD] -->
        AND SCBM.ENBL_FLG            (+) = 'Y'
        AND SCBM.EZCANCELFLAG        (+) = '0'
    </statement>
<!-- START 2017/11/20 K.Ochiai [QC#21698, ADD] -->
    <statement id="getEmsdslsRep" parameterClass="Map" resultClass="String">
        SELECT
            *
        FROM
            (
            SELECT
                DCSC.SLS_REP_TOC_CD
            FROM
                DS_CPO_SLS_CR       DCSC
               ,CPO                 CPO
               ,ORD_CATG_BIZ_CTX    OCBC
            WHERE
                    DCSC.GLBL_CMPY_CD            = #glblCmpyCd#
                AND DCSC.CPO_ORD_NUM             = #cpoOrdNum#
                AND OCBC.FIRST_BIZ_CTX_ATTRB_TXT = DCSC.SLS_REP_ROLE_TP_CD
                AND DCSC.DS_CPO_CONFIG_PK        IS NULL
                AND DCSC.SLS_CR_QUOT_FLG         = 'N'
                AND DCSC.EZCANCELFLAG            = '0'
                AND DCSC.GLBL_CMPY_CD            = CPO.GLBL_CMPY_CD
                AND DCSC.CPO_ORD_NUM             = CPO.CPO_ORD_NUM
                AND DCSC.GLBL_CMPY_CD            = OCBC.GLBL_CMPY_CD
                AND DCSC.SLS_REP_ROLE_TP_CD      = OCBC.FIRST_BIZ_CTX_ATTRB_TXT
                AND OCBC.DS_ORD_CATG_CD          = CPO.DS_ORD_CATG_CD
                AND (
                        OCBC.DS_ORD_TP_CD IS NULL
                        OR (
                                OCBC.DS_ORD_TP_CD IS NOT NULL
                            AND OCBC.DS_ORD_TP_CD = CPO.DS_ORD_TP_CD
                        )
                    )
                AND (
                        OCBC.DS_ORD_RSN_CD IS NULL
                        OR (
                                OCBC.DS_ORD_RSN_CD IS NOT NULL
                            AND OCBC.DS_ORD_RSN_CD = CPO.DS_ORD_RSN_CD
                        )
                    )
                AND OCBC.ORD_CATG_CTX_TP_CD       = #emsdContrBrRep#
                AND OCBC.EZCANCELFLAG             = '0'
             ORDER BY OCBC.DS_ORD_CATG_CD,OCBC.DS_ORD_TP_CD,OCBC.DS_ORD_RSN_CD
             )
         WHERE
            ROWNUM = 1
    </statement>
<!-- END 2017/11/20 K.Ochiai [QC#21698, ADD] -->
    <statement id="getContractSalesRep" parameterClass="Map" resultClass="String">
        SELECT
            SCBM.TOC_CD         AS TOC_CD
        FROM
            SUB_CONTR_BR_MAP    SCBM
        WHERE
            SCBM.GLBL_CMPY_CD     = #glblCmpyCd#
        AND SCBM.SVC_CONTR_BR_CD  = #svcContrBrCd#
        <!-- START 2018/01/09 M.Kidokoro [QC#20635,ADD] -->
        AND SCBM.SVC_LINE_BIZ_CD  = #svcLineBizCd#
        <!-- END 2018/01/09 M.Kidokoro [QC#20635,ADD] -->
        AND SCBM.ENBL_FLG        = 'Y'
        AND SCBM.EZCANCELFLAG    = '0'
    </statement>
    <statement id="getFirstBizCtxNmForCpo" parameterClass="Map" resultClass="String">
        SELECT
            OCBC.FIRST_BIZ_CTX_ATTRB_TXT    AS FIRST_BIZ_CTX_ATTRB_TXT
        FROM
            CPO              DC
           ,ORD_CATG_BIZ_CTX OCBC
        WHERE
            DC.GLBL_CMPY_CD              = #glblCmpyCd#
        AND DC.CPO_ORD_NUM               = #cpoOrdNum#
        AND DC.EZCANCELFLAG              = '0'
        AND DC.GLBL_CMPY_CD              = OCBC.GLBL_CMPY_CD
        AND OCBC.ORD_CATG_CTX_TP_CD      = #svcContrCatg#
        AND DC.DS_ORD_CATG_CD            = OCBC.DS_ORD_CATG_CD
        AND (
                (DC.DS_ORD_TP_CD  =  OCBC.DS_ORD_TP_CD AND OCBC.DS_ORD_TP_CD IS NOT NULL)
            OR  OCBC.DS_ORD_TP_CD IS NULL
            )
        AND OCBC.EZCANCELFLAG            = '0'
    </statement>
    <statement id="getFirstBizCtxNm" parameterClass="Map" resultClass="String">
        SELECT
            OCBC.FIRST_BIZ_CTX_ATTRB_TXT    AS FIRST_BIZ_CTX_ATTRB_TXT
        FROM
            ORD_CATG_BIZ_CTX OCBC
        WHERE
            OCBC.GLBL_CMPY_CD            = #glblCmpyCd#
        AND OCBC.ORD_CATG_CTX_TP_CD      = #svcContrCatg#
        AND OCBC.DS_ORD_CATG_CD          = #dsOrdCatgCd#
        AND OCBC.EZCANCELFLAG            = '0'
    </statement>
    <statement id="getLineBizTpCdForCpo" parameterClass="Map" resultClass="String">
        SELECT
            DOTPD.LINE_BIZ_TP_CD AS LINE_BIZ_TP_CD
        FROM
             CPO                  DC
            ,DS_ORD_TP_PROC_DFN   DOTPD
            ,LINE_BIZ_TP          LBT
            ,AVAL_LINE_BIZ_TP_SRC ALB
        WHERE
            DC.GLBL_CMPY_CD             = #glblCmpyCd#
        AND DC.CPO_ORD_NUM              = #cpoOrdNum#
        AND DC.GLBL_CMPY_CD             = DOTPD.GLBL_CMPY_CD
        AND DC.DS_ORD_TP_CD             = DOTPD.DS_ORD_TP_CD
        AND DOTPD.EZCANCELFLAG          = '0'
        AND DOTPD.GLBL_CMPY_CD          = LBT.GLBL_CMPY_CD
        AND DOTPD.LINE_BIZ_TP_CD        = LBT.LINE_BIZ_TP_CD
        AND LBT.EZCANCELFLAG            = '0'
        AND LBT.GLBL_CMPY_CD            = ALB.GLBL_CMPY_CD
        AND LBT.LINE_BIZ_TP_CD          = ALB.LINE_BIZ_TP_CD
        AND ALB.SYS_SRC_CD              = #sysSrcCd#
        AND ALB.EZCANCELFLAG            = '0'
    </statement>
    <statement id="getLineBizTpCd" parameterClass="Map" resultClass="String">
        SELECT
            DOTPD.LINE_BIZ_TP_CD AS LINE_BIZ_TP_CD
        FROM
             DS_ORD_TP_PROC_DFN   DOTPD
            ,LINE_BIZ_TP          LBT
            ,AVAL_LINE_BIZ_TP_SRC ALB
        WHERE
            DOTPD.GLBL_CMPY_CD          = #glblCmpyCd#
        AND DOTPD.DS_ORD_TP_CD          = #dsOrdCatgCd#
        AND DOTPD.EZCANCELFLAG          = '0'
        AND DOTPD.GLBL_CMPY_CD          = LBT.GLBL_CMPY_CD
        AND DOTPD.LINE_BIZ_TP_CD        = LBT.LINE_BIZ_TP_CD
        AND LBT.EZCANCELFLAG            = '0'
        AND LBT.GLBL_CMPY_CD            = ALB.GLBL_CMPY_CD
        AND LBT.LINE_BIZ_TP_CD          = ALB.LINE_BIZ_TP_CD
        AND ALB.SYS_SRC_CD              = #sysSrcCd#
        AND ALB.EZCANCELFLAG            = '0'
    </statement>
    <statement id="getCtacPsnPkForCpo" parameterClass="Map" resultClass="BigDecimal">
    <!-- START 2018/04/04 U.Kim [QC#23559(Sol358), MOD] -->
    <!-- SELECT -->
    <!--     A.CTAC_PSN_PK -->
    <!-- FROM ( -->
    <!--     SELECT -->
    <!--         DCCP.CTAC_PSN_PK -->
    <!--     FROM -->
    <!--         DS_CPO_CTAC_PSN DCCP -->
    <!--     WHERE -->
    <!--         DCCP.GLBL_CMPY_CD         = #glblCmpyCd# -->
    <!--     AND DCCP.CPO_ORD_NUM          = #cpoOrdNum# -->
    <!--     AND DCCP.CTAC_PSN_TP_CD       = #billToContact# -->
    <!--     AND DCCP.EZCANCELFLAG         = '0' -->
    <!--     ORDER BY -->
    <!--         DCCP.CTAC_PSN_PK -->
    <!--     ) A -->
    <!-- WHERE -->
    <!--     ROWNUM = 1 -->
        SELECT
             PSN.CTAC_PSN_PK
        FROM
            (
                SELECT
                     DCCP.CTAC_PSN_PK
                    ,CASE WHEN DCPR.CTAC_TP_CD = #billToContactContr# THEN '1' ELSE '2' END AS SORT_NUM
                FROM
                     DS_CPO_CTAC_PSN  DCCP
                    ,DS_CTAC_PSN_RELN DCPR
                    ,BILL_TO_CUST     BTC
                WHERE
                        DCCP.GLBL_CMPY_CD         = #glblCmpyCd#
                    AND DCCP.CPO_ORD_NUM          = #cpoOrdNum#
                    <iterate property="ctacTpList" var="ctacTpList[]" open="AND DCCP.CTAC_PSN_TP_CD IN(" close=")" conjunction=",">
                        #ctacTpList[]#
                    </iterate>
                    AND DCCP.EZCANCELFLAG         = '0'
                    AND DCCP.GLBL_CMPY_CD         = DCPR.GLBL_CMPY_CD
                    AND DCCP.CTAC_PSN_PK          = DCPR.CTAC_PSN_PK
                    <iterate property="ctacTpList" var="ctacTpList[]" open="AND DCPR.CTAC_TP_CD IN(" close=")" conjunction=",">
                        #ctacTpList[]#
                    </iterate>
                    AND DCPR.EZCANCELFLAG         = '0'
                    AND DCPR.GLBL_CMPY_CD         = BTC.GLBL_CMPY_CD
                    AND DCPR.LOC_NUM              = BTC.LOC_NUM
                    AND BTC.BILL_TO_CUST_CD       = #billToCustCd#
                    AND BTC.EZCANCELFLAG = '0'
                ORDER BY
                     SORT_NUM
                    ,DCCP.DS_CPO_CTAC_PSN_PK
            ) PSN
            WHERE
                ROWNUM = 1
    <!-- END 2018/04/04 U.Kim [QC#23559(Sol358), MOD] -->
    </statement>
    <statement id="getCtacPsnPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            Z.CTAC_PSN_PK
        FROM (
            SELECT
                C.CTAC_PSN_PK
                <!-- START 2018/04/04 U.Kim [QC#23559(Sol358), ADD] -->
                ,CASE WHEN B.CTAC_TP_CD = #billToContactContr# THEN '1' ELSE '2' END AS SORT_NUM
                <!-- END 2018/04/04 U.Kim [QC#23559(Sol358), ADD] -->
            FROM
                 SVC_MACH_MSTR    A
                ,DS_CTAC_PSN_RELN B
                ,CTAC_PSN         C
            WHERE
                A.GLBL_CMPY_CD = #glblCmpyCd#
            AND A.SVC_MACH_MSTR_PK = #svcMachMstrPk#
            AND A.EZCANCELFLAG = '0'
            AND A.GLBL_CMPY_CD = B.GLBL_CMPY_CD
            AND A.BILL_TO_ACCT_NUM = B.DS_ACCT_NUM
            AND B.EFF_FROM_DT                  &lt;= #slsDt#
            AND NVL(B.EFF_THRU_DT, #maxDt#) &gt;= #slsDt#
            AND B.EZCANCELFLAG = '0'
            AND B.GLBL_CMPY_CD = C.GLBL_CMPY_CD
            AND B.CTAC_PSN_PK = C.CTAC_PSN_PK
            <!-- START 2018/04/04 U.Kim [QC#23559(Sol358), MOD] -->
            <!-- AND B.CTAC_TP_CD   = #billToContact# -->
            <iterate property="ctacTpList" var="ctacTpList[]" open="AND B.CTAC_TP_CD IN(" close=")" conjunction=",">
                #ctacTpList[]#
            </iterate>
            <!-- END 2018/04/04 U.Kim [QC#23559(Sol358), MOD] -->
            AND C.EZCANCELFLAG = '0'
            ORDER BY
                 <!-- START 2018/04/04 U.Kim [QC#23559(Sol358), ADD] -->
                 SORT_NUM
                 <!-- END 2018/04/04 U.Kim [QC#23559(Sol358), ADD] -->
                ,B.DS_CTAC_PSN_RELN_PK
            ) Z
        WHERE
            ROWNUM = 1
    </statement>
<!-- START 2016/08/03 T.Tomita [QC#12230, DEL] -->
<!--<statement id="countContrVld" parameterClass="Map" resultClass="BigDecimal"> -->
<!--    SELECT -->
<!--        COUNT(*) -->
<!--    FROM -->
<!--        DS_CONTR_VLD_RSLT_WRK A -->
<!--    WHERE -->
<!--        A.GLBL_CMPY_CD = #glblCmpyCd# -->
<!--    AND A.DS_CONTR_PK  = #dsContrPk# -->
<!--    AND A.DS_CONTR_VLD_RSLT_MSG_TXT IS NOT NULL -->
<!--</statement> -->
<!-- END 2016/08/03 T.Tomita [QC#12230, DEL] -->
    <!-- START 2017/06/14 N.Arai [QC#18930, MOD] -->
    <statement id="findTerminateWtyContr" parameterClass="Map" resultClass="Map">
        SELECT
             Z.GLBL_CMPY_CD       AS GLBL_CMPY_CD
            ,#slsDt#              AS SLS_DT
            ,Z.SVC_MACH_MSTR_PK   AS SVC_MACH_MSTR_PK
            ,Z.SVC_MACH_TP_CD     AS SVC_MACH_TP_CD
            ,Z.SVC_MACH_SQ_NUM    AS SVC_MACH_SQ_NUM
            ,B.DS_CONTR_PK        AS DS_CONTR_PK
            ,B.DS_CONTR_NUM       AS DS_CONTR_NUM
            ,A.DS_CONTR_DTL_PK    AS DS_CONTR_DTL_PK
            ,Z.EZUPUSERID         AS EZUPUSERID
        FROM
             (
                SELECT
                     Y.GLBL_CMPY_CD      AS GLBL_CMPY_CD
                    ,Y.EZUPUSERID        AS EZUPUSERID
                    ,Y.SVC_MACH_MSTR_PK  AS SVC_MACH_MSTR_PK
                    ,Y.SVC_MACH_TP_CD    AS SVC_MACH_TP_CD
                    ,Y.SVC_MACH_SQ_NUM   AS SVC_MACH_SQ_NUM
                FROM
                    SVC_MACH_MSTR Y
                WHERE
                    Y.GLBL_CMPY_CD       =  #glblCmpyCd#
                AND Y.EZCANCELFLAG       =  '0'
                <isEqual property="svcMachTpCd" compareValue="1">
                AND EXISTS (
                    SELECT
                        *
                    FROM
                        SVC_MACH_MSTR X
                    WHERE
                        X.GLBL_CMPY_CD       =  Y.GLBL_CMPY_CD
                    AND X.EZCANCELFLAG       =  '0'
                    AND X.SVC_MACH_MSTR_PK   =  #svcMachMstrPk#
                    AND X.SVC_CONFIG_MSTR_PK =  Y.SVC_CONFIG_MSTR_PK
                    )
                </isEqual>
                <isEqual property="svcMachTpCd" compareValue="2">
                AND Y.SVC_MACH_MSTR_PK   =  #svcMachMstrPk#
                </isEqual>
                <!-- START 2017/10/24 M.Naito [QC#21813, ADD] -->
                <isNull property="svcMachTpCd">
                AND Y.SVC_MACH_MSTR_PK   =  #svcMachMstrPk#
                </isNull>
                <!-- END 2017/10/24 M.Naito [QC#21813, ADD] -->
             ) Z
            ,DS_CONTR_DTL       A
            ,DS_CONTR           B
            <!-- ,DS_CONTR_DTL_STS_V C  -->
        WHERE
            Z.GLBL_CMPY_CD                           =   A.GLBL_CMPY_CD
        AND Z.SVC_MACH_MSTR_PK                       =   A.SVC_MACH_MSTR_PK
        AND NVL(A.CONTR_CLO_DT, A.CONTR_EFF_THRU_DT) >=  #slsDt#
        <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCdList[]" open="AND A.DS_CONTR_DTL_STS_CD NOT IN (" close=")" conjunction=",">
            #dsContrCtrlStsCdList[]#
        </iterate>
        AND A.EZCANCELFLAG                           =   '0'
        AND A.GLBL_CMPY_CD                           =   B.GLBL_CMPY_CD
        AND A.DS_CONTR_PK                            =   B.DS_CONTR_PK
        AND B.DS_CONTR_CATG_CD                       =   #dsContrCatgCd#
        AND B.EZCANCELFLAG                           =   '0'
        <!-- 
        AND A.GLBL_CMPY_CD                           =   C.GLBL_CMPY_CD
        AND A.DS_CONTR_DTL_PK                        =   C.DS_CONTR_DTL_PK
        <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCdList[]" open="AND C.DS_CONTR_CTRL_STS_CD NOT IN (" close=")" conjunction=",">
            #dsContrCtrlStsCdList[]#
        </iterate>
        AND C.EZCANCELFLAG                           =   '0'
        -->
        ORDER BY
             Z.SVC_MACH_TP_CD
            ,Z.SVC_MACH_SQ_NUM
    </statement>
    <!-- END 2017/06/14 N.Arai [QC#18930, MOD] -->
<!-- START 2016/08/03 T.Tomita [QC#12230, ADD] -->
    <statement id="countMdse" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             MDSE         DMI
            ,SVC_WTY_TP   SWT
        WHERE
                DMI.GLBL_CMPY_CD  = #glblCmpyCd#
            AND DMI.MDSE_CD       = #mdseCd#
            AND DMI.EZCANCELFLAG  = '0'
            AND DMI.GLBL_CMPY_CD  = SWT.GLBL_CMPY_CD
            AND DMI.SVC_WTY_TP_CD = SWT.SVC_WTY_TP_CD
            AND SWT.STD_WTY_FLG   = 'Y'
            AND SWT.EZCANCELFLAG  = '0'
    </statement>
    <!-- START 2017/06/14 N.Arai [QC#18930, MOD] -->
    <statement id="getDsContrWty" parameterClass="Map" resultClass="Map">
        SELECT
             DCH.DS_CONTR_NUM
            ,DCH.SVC_CONTR_REF_CMNT_TXT
        FROM
             SVC_CONFIG_MSTR    SCM
            ,DS_CONTR_DTL       DCD
            ,DS_CONTR           DCH
            <!-- ,DS_CONTR_DTL_STS_V DSV    -->
        WHERE
                SCM.GLBL_CMPY_CD                                 = #glblCmpyCd#
            AND SCM.SVC_CONFIG_MSTR_PK                           = #svcConfigMstrPk#
            AND SCM.EZCANCELFLAG                                 = '0'
            AND SCM.GLBL_CMPY_CD                                 = DCD.GLBL_CMPY_CD
            AND SCM.SVC_MACH_MSTR_PK                             = DCD.SVC_MACH_MSTR_PK
            AND NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT) &gt;= #slsDt#
            <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCdList[]" open="AND DCD.DS_CONTR_DTL_STS_CD NOT IN (" close=")" conjunction=",">
                #dsContrCtrlStsCdList[]#
            </iterate>
            AND DCD.EZCANCELFLAG                                 = '0'
            AND DCD.GLBL_CMPY_CD                                 = DCH.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK                                  = DCH.DS_CONTR_PK
            AND DCH.DS_CONTR_CATG_CD                             = #dsContrCatgCd#
            AND DCH.EZCANCELFLAG                                 = '0'
            <!-- 
            AND DCD.GLBL_CMPY_CD                                 = DSV.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK                              = DSV.DS_CONTR_DTL_PK
            <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCdList[]" open="AND DSV.DS_CONTR_CTRL_STS_CD NOT IN (" close=")" conjunction=",">
                #dsContrCtrlStsCdList[]#
            </iterate>
            AND DSV.EZCANCELFLAG                                 = '0'
            -->
    </statement>
    <!-- END 2017/06/14 N.Arai [QC#18930, MOD] -->
    <statement id="getDsContrIntfc" parameterClass="Map" resultClass="Map">
        SELECT
             DCI.DS_CONTR_INTFC_BAT_NUM
            ,DCI.DS_CONTR_SRC_REF_NUM
        FROM
             SVC_CONFIG_MSTR SCM
            ,DS_CONTR_INTFC  DCI
        WHERE
                SCM.GLBL_CMPY_CD                = #glblCmpyCd#
            AND SCM.SVC_CONFIG_MSTR_PK          = #svcConfigMstrPk#
            AND SCM.EZCANCELFLAG                = '0'
            AND SCM.GLBL_CMPY_CD                = DCI.GLBL_CMPY_CD
            AND SCM.SVC_MACH_MSTR_PK            = DCI.SVC_MACH_MSTR_PK
            AND DCI.DS_CONTR_CATG_CD            = #dsContrCatgCd#
            AND DCI.DS_CONTR_PROC_STS_CD &lt;&gt; #dsContrProcStsCd#
            AND DCI.EZCANCELFLAG                = '0'
    </statement>
    <statement id="getMaxPlusOneSequence" parameterClass="Map" resultClass="Integer">
        SELECT
            NVL(MAX(DCI.DS_CONTR_INTFC_BAT_SQ), 0)
        FROM
            DS_CONTR_INTFC   DCI
        WHERE
                DCI.GLBL_CMPY_CD      = #glblCmpyCd#
            AND DCI.DS_CONTR_INTFC_DT = #slsDt#
            AND DCI.EZCANCELFLAG      = '0'
    </statement>
    <statement id="getMdlInfo" parameterClass="Map" resultClass="Map">
        SELECT
             SCM.MDL_ID
            ,MNM.T_MDL_NM
        FROM
             SVC_CONFIG_MSTR SCM
            ,MDL_NM          MNM
        WHERE
                SCM.GLBL_CMPY_CD       = #glblCmpyCd#
            AND SCM.SVC_CONFIG_MSTR_PK = #svcConfigMstrPk#
            AND SCM.EZCANCELFLAG       = '0'
            AND SCM.GLBL_CMPY_CD       = MNM.T_GLBL_CMPY_CD
            AND SCM.MDL_ID             = MNM.T_MDL_ID
            AND MNM.EZCANCELFLAG       = '0'
    </statement>
<!-- END 2016/08/03 T.Tomita [QC#12230, ADD] -->
    <!-- START 2017/06/14 N.Arai [QC#18930, MOD] -->
    <statement id="getContrInfo" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.DS_CONTR_DTL_PK
        FROM
            DS_CONTR_DTL A
            <!-- ,DS_CONTR_DTL_STS_V B  -->
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.SVC_MACH_MSTR_PK      = #svcMachMstrPk#
            AND A.DS_CONTR_DTL_STS_CD NOT IN (#canceled#,#terminated#,#expired#)
            AND A.EZCANCELFLAG          = '0'
            <!--
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK       = B.DS_CONTR_DTL_PK
            AND B.DS_CONTR_CTRL_STS_CD NOT IN (#canceled#,#terminated#,#expired#)
            AND B.EZCANCELFLAG          = '0'
            -->
        ORDER BY 
            A.DS_CONTR_PK
            ,A.DS_CONTR_DTL_PK
    </statement>
    <!-- END 2017/06/14 N.Arai [QC#18930, MOD] -->
    <statement id="getCrCardPoInfo" parameterClass="Map" resultClass="Map">
        SELECT
            A.CR_CARD_CUST_REF_NUM
            ,A.CR_CARD_EXPR_YR_MTH
            ,A.CUST_PO_NUM
            ,A.PO_DT
        FROM
            DS_CONTR_CR_CARD_PO A
        WHERE
            A.GLBL_CMPY_CD = #glblCmpyCd#
        AND A.DS_CONTR_PK = #dsContrPk#
        AND A.DS_CONTR_DTL_PK = #dsContrDtlPk#
        <isNotNull property="dsContrBllgMtrPk">
        AND A.DS_CONTR_BLLG_MTR_PK = #dsContrBllgMtrPk#
        </isNotNull>
        <isNull property="dsContrBllgMtrPk">
        AND A.DS_CONTR_BLLG_MTR_PK IS NULL
        </isNull>
        AND A.DS_CONTR_MACH_LVL_NUM = #baseUsgLv#
        AND A.EZCANCELFLAG          = '0'
    </statement>
    <statement id="getContrRnwEsclInfo" parameterClass="Map" resultClass="Map">
        SELECT
            A.CONTR_AUTO_RNW_TP_CD
            ,A.RNW_PRC_METH_CD
            ,A.BEF_END_RNW_DAYS_AOT
            ,A.BASE_PRC_UP_RATIO
            ,A.MTR_PRC_UP_RATIO
            ,A.CONTR_UPLFT_TP_CD
            ,A.UPLFT_PRC_METH_CD
            ,A.UPLFT_BASE_PRC_UP_RATIO
            ,A.UPLFT_MTR_PRC_UP_RATIO
        FROM
            DS_CONTR_RNW_ESCL A
        WHERE
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        AND A.DS_CONTR_PK           = #dsContrPk#
        AND A.DS_CONTR_DTL_PK       = #dsContrDtlPk#
        AND A.DS_CONTR_MACH_LVL_NUM = #baseUsgLv#
        AND A.DS_CONTR_BASE_USG_NM  = #dsContrBaseUsgNm#
        AND A.EZCANCELFLAG          = '0'
    </statement>
    <statement id="getAddlChrgInfo" parameterClass="Map" resultClass="Map">
        SELECT
            A.ADDL_CHRG_TP_CD
            ,A.ADDL_CHRG_FLAT_DEAL_PRC_AMT
            ,A.ADDL_CHRG_APLC_PCT
            ,A.ADDL_CHRG_INV_TP_CD
            ,A.SVC_BILL_BY_TP_CD
            ,A.PRINT_DTL_FLG
            ,A.EFF_FROM_DT
            ,A.EFF_THRU_DT
            ,A.BLLG_CYCLE_CD
        FROM
            DS_CONTR_ADDL_CHRG A
        WHERE
            A.GLBL_CMPY_CD              = #glblCmpyCd#
        AND A.DS_CONTR_PK               = #dsContrPk#
        AND A.DS_CONTR_DTL_PK           = #dsContrDtlPk#
        AND A.EFF_FROM_DT               &lt;= #slsDt#
        AND NVL(A.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
        AND A.EZCANCELFLAG              = '0'
    </statement>
    <statement id="getXsCopyInfo" parameterClass="Map" resultClass="Map">
        SELECT
            A.XS_MTR_COPY_QTY
            ,A.XS_MTR_AMT_RATE
        FROM
            CONTR_XS_COPY A
        WHERE
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        AND A.DS_CONTR_BLLG_MTR_PK  = #dsContrBllgMtrPk#
        AND A.XS_MTR_FIRST_FLG      = #xsMtrFirstFlg#
        AND A.EZCANCELFLAG          = '0'
        ORDER BY
            A.XS_MTR_COPY_QTY
    </statement>
    <statement id="getPhysMtrInfo" parameterClass="Map" resultClass="Map">
        SELECT 
            B.MDL_MTR_LB_CD
            ,A.BLLG_MTR_LB_CD
            ,A.BLLBL_FLG
            ,A.CONTR_MTR_MULT_RATE
            ,D.INTG_MDSE_CD
        FROM 
            CONTR_PHYS_BLLG_MTR_RELN A
            ,SVC_PHYS_MTR B
            ,MTR_LB C
            ,DS_CONTR_BLLG_MTR D
        WHERE
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        <!-- START 2018/08/23 [QC#27126, ADD] -->
        AND A.DS_CONTR_DTL_PK       = #dsContrDtlPk#
        <!-- END 2018/08/23 [QC#27126, ADD] -->
        AND A.MACH_MSTR_PK          = #svcMachMstrPk#
        AND A.BLLG_MTR_LB_CD        IS NOT NULL
        AND A.EZCANCELFLAG          = '0'
        AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
        AND A.SVC_PHYS_MTR_PK       = B.SVC_PHYS_MTR_PK
        AND B.EZCANCELFLAG          = '0'
        AND EXISTS (
            SELECT
                1
            FROM
                SVC_PHYS_MTR D
            WHERE
                D.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND D.SVC_MACH_MSTR_PK  = #newSvcMachMstrPk#
            AND D.MDL_MTR_LB_CD     = B.MDL_MTR_LB_CD
            AND D.EZCANCELFLAG      = '0'
        )
        AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
        AND B.MDL_MTR_LB_CD         = C.MTR_LB_CD
        AND C.EZCANCELFLAG          = '0'
        AND A.GLBL_CMPY_CD          = D.GLBL_CMPY_CD(+)
        AND A.DS_CONTR_BLLG_MTR_PK  = D.DS_CONTR_BLLG_MTR_PK(+)
        AND D.EZCANCELFLAG(+)       = '0'
    </statement>

    <!-- START 2016/12/22 K.Kojima [QC#16600,ADD] -->
    <statement id="getPrntSvcMachMstrPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            SCM.SVC_MACH_MSTR_PK
        FROM
             SVC_CONFIG_MSTR_DTL SCMD
            ,SVC_CONFIG_MSTR     SCM
        WHERE
                SCMD.GLBL_CMPY_CD           = #glblCmpyCd#
            AND SCMD.SVC_CONFIG_MSTR_DTL_PK = #svcConfigMstrDtlPk#
            AND SCMD.GLBL_CMPY_CD           = SCM.GLBL_CMPY_CD
            AND SCMD.SVC_CONFIG_MSTR_PK     = SCM.SVC_CONFIG_MSTR_PK
            AND SCMD.EZCANCELFLAG           = '0'
            AND SCM.EZCANCELFLAG            = '0'
    </statement>
    <!-- END 2016/12/22 K.Kojima [QC#16600,ADD] -->

<!-- START 2017/01/05 K.Kitachi [QC#16848, ADD] -->
    <statement id="convLineBizTpToSvcLineBiz" parameterClass="Map" resultClass="String">
        SELECT
            RELN.SVC_LINE_BIZ_CD
        FROM
            SVC_LINE_BIZ_RELN RELN
        WHERE
                RELN.GLBL_CMPY_CD   = #glblCmpyCd#
            AND RELN.EZCANCELFLAG   = '0'
            AND RELN.LINE_BIZ_TP_CD = NVL(#lineBizTpCd#, #nullString#)
    </statement>
<!-- END 2017/01/05 K.Kitachi [QC#16848, ADD] -->

<!-- START 2017/10/23 K.Kitachi [QC#21796, ADD] -->
    <statement id="getSvcMachMstrPkBySvcConfigMstrPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            B.SVC_MACH_MSTR_PK
        FROM
             SVC_CONFIG_MSTR_DTL A
            ,SVC_MACH_MSTR       B
        WHERE
                A.GLBL_CMPY_CD        = #glblCmpyCd#
            AND A.EZCANCELFLAG        = '0'
            AND A.SVC_CONFIG_MSTR_PK  = #svcConfigMstrPk#
            <!-- START 2018/08/10 T.Tomita [QC#27156, ADD] -->
            AND A.SVC_MACH_RMV_DT     IS NULL
            <!-- START 2018/08/10 T.Tomita [QC#27156, ADD] -->
            AND A.GLBL_CMPY_CD        = B.GLBL_CMPY_CD
            AND A.SVC_MACH_MSTR_PK    = B.SVC_MACH_MSTR_PK
            <iterate property="svcMachMstrStsCdList" var="svcMachMstrStsCd[]" open="AND B.SVC_MACH_MSTR_STS_CD IN (" close=")" conjunction=",">
                #svcMachMstrStsCd[]#
            </iterate>
            AND B.SVC_MACH_USG_STS_CD = #svcMachUsgStsCd#
            AND B.EZCANCELFLAG        = '0'
        ORDER BY
             B.SVC_MACH_TP_CD
            ,B.SVC_MACH_SQ_NUM
            ,B.SVC_MACH_MSTR_PK
    </statement>
<!-- END 2017/10/23 K.Kitachi [QC#21796, ADD] -->

<!-- START 2018/03/14 T.Tomita [QC#23427, ADD] -->
    <statement id="countTrmdIntfc" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS TRMD_CNT
        FROM
            DS_CONTR_INTFC A
        WHERE
            A.GLBL_CMPY_CD           = #glblCmpyCd#
        AND A.EZCANCELFLAG           = '0'
        AND A.DS_CONTR_NUM           = #dsContrNum#
        AND A.SVC_MACH_MSTR_PK       = #svcMachMstrPk#
        AND A.DS_CONTR_INTFC_ACT_CD  = #dsContrIntfcActCd#
        AND A.CONTR_INTFC_SRC_TP_CD  = #contrIntfcSrcTpCd#
    </statement>
<!-- END 2018/03/14 T.Tomita [QC#23427, ADD] -->

<!-- START 2018/06/19 T.Tomita [QC#26618, ADD] -->
    <statement id="getContrCoaBrMap" parameterClass="Map" resultClass="Map">
        SELECT
             A.SVC_CONTR_BR_CD     AS SVC_CONTR_BR_CD
            ,A.CONTR_ADMIN_PSN_CD  AS CONTR_ADMIN_PSN_CD
        FROM
            SVC_CONTR_COA_BR_MAP A
        WHERE
            A.GLBL_CMPY_CD    = #glblCmpyCd#
        AND A.EZCANCELFLAG    = '0'
        AND A.COA_BR_CD       = #coaBrCd#
        AND A.SVC_LINE_BIZ_CD = #svcLineBizCd#
    </statement>
<!-- END 2018/06/19 T.Tomita [QC#26618, ADD] -->
<!-- START 2018/08/05 T.Tomita [QC#27144, ADD] -->
    <statement id="getExistsTrmdIntfc" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_INTFC_BAT_NUM
            ,A.DS_CONTR_INTFC_BAT_SQ
        FROM
            DS_CONTR_INTFC A
        WHERE
            A.GLBL_CMPY_CD          =  #glblCmpyCd#
        AND A.EZCANCELFLAG          =  '0'
        AND A.CONTR_INTFC_SRC_TP_CD =  #contrIntfcSrcTpCd#
        AND A.DS_CONTR_INTFC_ACT_CD =  #dsContrIntfcActCd#
        AND A.DS_CONTR_INTFC_STS_CD &lt;&gt; #dsContrIntfcStsCd#
        AND EXISTS (
            SELECT
                *
            FROM
                 DS_CPO_RTRN_DTL B
                ,DS_CPO_RTRN_DTL C
            WHERE
                B.GLBL_CMPY_CD              = A.GLBL_CMPY_CD
            AND B.EZCANCELFLAG              = '0'
            AND B.CPO_ORD_NUM               = #cpoOrdNum#
            AND B.DS_CPO_RTRN_LINE_NUM      = #dsCpoRtrnLineNum#
            AND B.DS_CPO_RTRN_LINE_SUB_NUM  = #dsCpoRtrnLineSubNum#
            AND B.GLBL_CMPY_CD              = C.GLBL_CMPY_CD
            AND B.CPO_ORD_NUM               = C.CPO_ORD_NUM
            AND B.DS_CPO_CONFIG_PK          = C.DS_CPO_CONFIG_PK
            AND C.EZCANCELFLAG              = '0'
            AND C.SVC_MACH_MSTR_PK          = A.SVC_MACH_MSTR_PK
            )
        ORDER BY
             A.DS_CONTR_INTFC_BAT_NUM
            ,A.DS_CONTR_SRC_REF_NUM
    </statement>
<!-- END 2018/08/05 T.Tomita [QC#27144, ADD] -->

<!-- START 2022/07/08 N.Takatsu [QC#60023, ADD] -->
    <statement id="findPsnCd" parameterClass="Map" resultClass="String">
       SELECT
            (
            SELECT SP.PSN_NUM
                FROM
                     ORG_FUNC_ASG OFA
                    ,S21_PSN SP
                WHERE
                    OFA.GLBL_CMPY_CD            = TOC.GLBL_CMPY_CD
                    AND OFA.TOC_CD              = TOC.TOC_CD
                    AND OFA.EZCANCELFLAG        = '0'
                    AND OFA.GLBL_CMPY_CD        = SP.GLBL_CMPY_CD
                    AND OFA.PSN_CD              = SP.PSN_CD
                    AND SP.EZCANCELFLAG         = '0'
                    AND ROWNUM                  = 1
                    )
                AS PSN_CD
            FROM
                 CPO CPO 
                ,TOC TOC 
                ,COA_BR CB 
                ,COA_EXTN CE
            WHERE
                    CPO.GLBL_CMPY_CD            = #glblCmpyCd#
                AND CPO.EZCANCELFLAG            = '0'
                AND CPO.GLBL_CMPY_CD            = TOC.GLBL_CMPY_CD
                AND TOC.EZCANCELFLAG            = '0'
                AND TOC.GLBL_CMPY_CD            = CB.GLBL_CMPY_CD
                AND CB.EZCANCELFLAG             = '0'
                AND CB.GLBL_CMPY_CD             = CE.GLBL_CMPY_CD
                AND CE.EZCANCELFLAG             = '0'
                AND CPO.CPO_ORD_NUM             = #cpoOrdNum#
                AND CPO.SLS_REP_TOC_CD          = TOC.TOC_CD
                AND TOC.COA_BR_CD               = CB.COA_BR_CD
                AND TOC.COA_EXTN_CD             = CE.COA_EXTN_CD
 
	</statement>

    <statement id="getTargetOrg" parameterClass="Map" resultClass="Map">
    WITH RELN AS
        (
            SELECT
                DISTINCT ORG.ORG_CD
            FROM
                DS_ORG_RESRC_RELN RELN
               ,DS_ORG_UNIT ORG
               ,S21_PSN PSN
               ,ORG_STRU_TP STRU
            WHERE
                    RELN.GLBL_CMPY_CD                           = #glblCmpyCd#
                AND RELN.EZCANCELFLAG                           = '0'
                AND RELN.GLBL_CMPY_CD                           = PSN.GLBL_CMPY_CD
                AND RELN.EZCANCELFLAG                           = PSN.EZCANCELFLAG
                AND RELN.GLBL_CMPY_CD                           = ORG.GLBL_CMPY_CD
                AND RELN.EZCANCELFLAG                           = ORG.EZCANCELFLAG
                AND ORG.EFF_FROM_DT                         &lt;= #slsDt#
                AND NVL(ORG.EFF_THRU_DT, #maxEffDt#)        &gt;= #slsDt#
                AND RELN.GLBL_CMPY_CD                           = STRU.GLBL_CMPY_CD
                AND RELN.EZCANCELFLAG                           = STRU.EZCANCELFLAG
                AND RELN.ORG_CD                                 = ORG.ORG_CD
                AND RELN.ORG_STRU_TP_CD                         = STRU.ORG_STRU_TP_CD
                AND RELN.EFF_FROM_DT                        &lt;= #slsDt#
                AND NVL(RELN.EFF_THRU_DT, #maxEffDt#)       &gt;= #slsDt#
                AND STRU.TRTY_STRU_FLG                          = #trtyStruFlg#
                AND RELN.PSN_CD                                 = PSN.PSN_CD
                AND PSN.EFF_FROM_DT                         &lt;= #slsDt#
                AND NVL(PSN.EFF_THRU_DT, #maxEffDt#)        &gt;= #slsDt#
                AND PSN.PSN_CD                                  = #psnCd#
                )
        SELECT
            ORG.ORG_CD
           ,ORG.ORG_NM
           ,ORG.ORG_TIER_CD
        FROM
            DS_ORG_UNIT ORG
           ,ORG_STRU_TP STRU
        WHERE
                ORG.GLBL_CMPY_CD                                = #glblCmpyCd#
            AND ORG.EZCANCELFLAG                                = '0'
            AND ORG.EFF_FROM_DT                             &lt;= #slsDt#
            AND NVL(ORG.EFF_THRU_DT, #maxEffDt#)            &gt;= #slsDt#
            AND ORG.ORG_STRU_TP_CD                              = STRU.ORG_STRU_TP_CD
            AND STRU.TRTY_STRU_FLG                              = #trtyStruFlg#
            AND ORG.FIRST_ORG_CD                                = '6'
            AND EXISTS (SELECT 1 FROM RELN WHERE RELN.ORG_CD    = ORG.ORG_CD)
        ORDER BY
            TO_NUMBER(ORG.ORG_TIER_CD)
           ,ORG.ORG_NM
    </statement>

    <statement id="getTrtyRuleCount" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)
        FROM
            TRTY_RULE   A
        WHERE
                A.GLBL_CMPY_CD              = #glblCmpyCd#
            AND A.EZCANCELFLAG              = '0'
            AND A.ORG_STRU_TP_CD            = #orgStruTpCd#
            AND A.TRTY_RULE_FROM_VAL_TXT    = #trtyRuleFromValTxt#
            AND A.TRTY_RULE_TP_CD           = #trtyRuleTpCd#
            AND A.TRTY_RULE_OPRD_TP_CD      = #trtyRuleOprdTpCd#
            AND A.TRTY_RULE_LOGIC_TP_CD     = #trtyRuleLogicTpCd#
            AND EXISTS
                (
                SELECT
                    *
                FROM
                    DS_ORG_UNIT B
                   ,TRTY_GRP_TP C
                WHERE
                        B.GLBL_CMPY_CD      = A.GLBL_CMPY_CD
                    AND B.EZCANCELFLAG      = '0'
                    AND B.GLBL_CMPY_CD      = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG      = '0'
                    AND B.ORG_CD            = A.ORG_CD
                    AND B.TRTY_GRP_TP_CD    = C.TRTY_GRP_TP_CD
                    AND C.LINE_BIZ_TP_CD    = #sldByLineBizTcCd#
                )
    </statement>

<!-- END 2022/07/08 N.Takatsu [QC#60023, ADD] -->
    <!-- START 2023/08/23 R.Jin [QC#61808, ADD] -->
    <statement id="svcMachMstrPkListForPrntNum" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.SVC_MACH_MSTR_PK
        FROM
            SVC_MACH_MSTR A
        WHERE
            A.SVC_CONFIG_MSTR_PK                 = #svcConfigMstrPk#
            AND A.GLBL_CMPY_CD                   = #glblCmpyCd#
            AND A.EZCANCELFLAG                   = '0'
            AND A.SVC_MACH_TP_CD                 = #svcMachineTpAccsory#
    </statement>
    <!-- END 2023/08/23 R.Jin [QC#61808, ADD] -->
    <!-- START 2022/10/06 K.Watanabe [QC#54186, ADD] -->
    <statement id="findDsCpoIstlInfo" parameterClass="Map" resultClass="Map">
        SELECT
            ISTL_BY_SVC_PRVD_PTY_CD
           ,SVC_BY_SVC_PRVD_PTY_CD
        FROM
            DS_CPO_ISTL_INFO DCII
        WHERE
                DCII.GLBL_CMPY_CD     = #glblCmpyCd#
            AND DCII.DS_CPO_CONFIG_PK = #dsCpoConfigPk#
            AND DCII.EZCANCELFLAG     = '0'
    </statement>
    <statement id="findLineBizReln" parameterClass="Map" resultClass="String">
        SELECT
            SVC_LINE_BIZ_CD
        FROM
            MDSE              MDSE
           ,SVC_LINE_BIZ_RELN SLBR
        WHERE
                MDSE.GLBL_CMPY_CD    = #glblCmpyCd#
            AND MDSE.EZCANCELFLAG    = '0'
            AND MDSE.MDSE_CD         = #mdseCd#
            AND MDSE.GLBL_CMPY_CD    = SLBR.GLBL_CMPY_CD
            AND MDSE.LINE_BIZ_TP_CD  = SLBR.LINE_BIZ_TP_CD
            AND SLBR.EZCANCELFLAG    = '0'
    </statement>
    <statement id="getSvcLineBizCdforDICheck" parameterClass="Map" resultClass="Map">
        SELECT
            MDSE.MDSE_ITEM_TP_CD
           ,DCC.SVC_CONFIG_MSTR_PK
           ,SLBR.SVC_LINE_BIZ_CD
        FROM
            CPO_DTL            CPOD
           ,DS_CPO_CONFIG      DCC
           ,MDSE               MDSE
           ,SVC_LINE_BIZ_RELN  SLBR
        WHERE
            CPOD.GLBL_CMPY_CD      = #glblCmpyCd#
        AND CPOD.EZCANCELFLAG      = '0'
        AND CPOD.DS_CPO_CONFIG_PK  = #dsCpoConfigPk#
        AND CPOD.MDSE_CD           = #mdseCd#
        AND CPOD.GLBL_CMPY_CD      = DCC.GLBL_CMPY_CD
        AND CPOD.DS_CPO_CONFIG_PK  = DCC.DS_CPO_CONFIG_PK
        AND DCC.EZCANCELFLAG       = '0'
        <iterate property="configTpCdList" var="configTpCd[]" open="AND DCC.CONFIG_TP_CD IN (" close=")" conjunction=",">
            #configTpCd[]#
        </iterate>
        AND CPOD.GLBL_CMPY_CD      = MDSE.GLBL_CMPY_CD
        AND MDSE.EZCANCELFLAG      = '0'
        AND MDSE.GLBL_CMPY_CD      = SLBR.GLBL_CMPY_CD
        AND MDSE.LINE_BIZ_TP_CD    = SLBR.LINE_BIZ_TP_CD
        AND SLBR.EZCANCELFLAG      = '0'
        AND (
            EXISTS (
                SELECT
                    MDSE.MDSE_CD
                FROM
                    ORD_TAKE_MDSE OTM
                WHERE
                        CPOD.GLBL_CMPY_CD  = OTM.GLBL_CMPY_CD
                    AND CPOD.MDSE_CD       = OTM.ORD_TAKE_MDSE_CD
                    AND OTM.EZCANCELFLAG   = '0'
                    AND OTM.MDSE_CD        = MDSE.MDSE_CD
            )
            OR EXISTS (
                SELECT
                    MDSE1.MDSE_CD
                FROM
                    MDSE MDSE1
                WHERE
                        CPOD.GLBL_CMPY_CD  = MDSE1.GLBL_CMPY_CD
                    AND CPOD.MDSE_CD       = MDSE1.MDSE_CD
                    AND MDSE.EZCANCELFLAG  = '0'
                    AND MDSE1.MDSE_CD      = MDSE.MDSE_CD
            )
        )
        AND ((
            NOT EXISTS (
                SELECT
                    MDSE.MDSE_CD
                FROM
                    CPO_DTL       CPOD
                   ,MDSE          MDSE
                   ,ORD_TAKE_MDSE OTM
                WHERE
                        CPOD.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND CPOD.EZCANCELFLAG      = '0'
                    AND CPOD.DS_CPO_CONFIG_PK  = #dsCpoConfigPk#
                    AND CPOD.GLBL_CMPY_CD      = MDSE.GLBL_CMPY_CD
                    AND MDSE.EZCANCELFLAG      = '0'
                    AND CPOD.GLBL_CMPY_CD      = OTM.GLBL_CMPY_CD
                    AND CPOD.MDSE_CD           = OTM.ORD_TAKE_MDSE_CD
                    AND OTM.EZCANCELFLAG       = '0'
                    AND OTM.MDSE_CD            = MDSE.MDSE_CD
                    AND MDSE.MDSE_ITEM_TP_CD  != #mdseItemTpCdAccessory#
            )
            AND NOT EXISTS (
                SELECT
                    MDSE.MDSE_CD
                FROM
                    CPO_DTL   CPOD
                   ,MDSE      MDSE
                WHERE
                        CPOD.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND CPOD.EZCANCELFLAG      = '0'
                    AND CPOD.DS_CPO_CONFIG_PK  = #dsCpoConfigPk#
                    AND CPOD.GLBL_CMPY_CD      = MDSE.GLBL_CMPY_CD
                    AND CPOD.MDSE_CD           = MDSE.MDSE_CD
                    AND MDSE.EZCANCELFLAG      = '0'
                    AND MDSE.MDSE_ITEM_TP_CD  != #mdseItemTpCdAccessory#
            )
        ) OR (
            NOT EXISTS (
                SELECT
                    MDSE.MDSE_CD
                FROM
                    CPO_DTL       CPOD
                   ,MDSE          MDSE
                   ,ORD_TAKE_MDSE OTM
                WHERE
                        CPOD.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND CPOD.EZCANCELFLAG      = '0'
                    AND CPOD.DS_CPO_CONFIG_PK  = #dsCpoConfigPk#
                    AND CPOD.GLBL_CMPY_CD      = MDSE.GLBL_CMPY_CD
                    AND MDSE.EZCANCELFLAG      = '0'
                    AND CPOD.GLBL_CMPY_CD      = OTM.GLBL_CMPY_CD
                    AND CPOD.MDSE_CD           = OTM.ORD_TAKE_MDSE_CD
                    AND OTM.EZCANCELFLAG       = '0'
                    AND OTM.MDSE_CD            = MDSE.MDSE_CD
                    AND MDSE.MDSE_ITEM_TP_CD  != #mdseItemTpCdSoftware#
            )
            AND NOT EXISTS (
                SELECT
                    MDSE.MDSE_CD
                FROM
                    CPO_DTL   CPOD
                   ,MDSE MDSE
                WHERE
                        CPOD.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND CPOD.EZCANCELFLAG      = '0'
                    AND CPOD.DS_CPO_CONFIG_PK  = #dsCpoConfigPk#
                    AND CPOD.GLBL_CMPY_CD      = MDSE.GLBL_CMPY_CD
                    AND CPOD.MDSE_CD           = MDSE.MDSE_CD
                    AND MDSE.EZCANCELFLAG      = '0'
                    AND MDSE.MDSE_ITEM_TP_CD  != #mdseItemTpCdSoftware#
            )
        ))
    </statement>
    <!-- END 2022/10/06 K.Watanabe [QC#54186, ADD] -->
    <!-- START 2024/04/04 t.aizawa [QC#54186, ADD] -->
    <statement id="getSvcLineBizCdByMdseCd" parameterClass="Map" resultClass="String">
        SELECT
            SLBR.SVC_LINE_BIZ_CD
        FROM
             MDSE              MDSE
            ,SVC_LINE_BIZ_RELN SLBR
        WHERE
                MDSE.GLBL_CMPY_CD   = #glblCmpyCd#
            AND MDSE.EZCANCELFLAG   = '0'
            AND MDSE.GLBL_CMPY_CD   = SLBR.GLBL_CMPY_CD
            AND MDSE.LINE_BIZ_TP_CD = SLBR.LINE_BIZ_TP_CD 
            AND SLBR.EZCANCELFLAG   = '0'
            AND (
                    EXISTS (
                        SELECT
                            1
                        FROM
                            ORD_TAKE_MDSE OTM
                        WHERE
                                MDSE.GLBL_CMPY_CD    = OTM.GLBL_CMPY_CD
                            AND MDSE.MDSE_CD         = OTM.MDSE_CD
                            AND OTM.EZCANCELFLAG     = '0'
                            AND OTM.ORD_TAKE_MDSE_CD = #mdseCd#
                    )
                OR  EXISTS (
                        SELECT
                            1
                        FROM
                            MDSE MDSE1
                        WHERE
                                MDSE.GLBL_CMPY_CD  = MDSE1.GLBL_CMPY_CD
                            AND MDSE.MDSE_CD       = MDSE1.MDSE_CD
                            AND MDSE1.EZCANCELFLAG = '0'
                            AND MDSE1.MDSE_CD      = #mdseCd#
                    )
            )
    </statement>
    <!-- END   2024/04/04 t.aizawa [QC#54186, ADD] -->
</sqlMap>
