<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSAL1230Query">

    <statement id="findContractSegmentAllocationList" parameterClass="Map" resultClass="Map">
        SELECT
             DCS.EZINTIME
             ,DCS.EZINUSERID
             ,DCS.EZUPTIME
             ,DCS.EZUPUSERID
             ,DCS.EZTABLEID
             ,DCS.GLBL_CMPY_CD
             ,DCS.DS_CONTR_SEG_ALLOC_PK
             ,DCS.DS_CONTR_PK
             ,DCS.DS_CONTR_DTL_PK
             ,DCS.SVC_INV_CHRG_TP_CD
             ,DCS.COA_CMPY_CD
             ,DCS.COA_AFFL_CD
             ,DCS.COA_BR_CD
             ,DCS.COA_CH_CD
             ,DCS.COA_CC_CD
             ,DCS.COA_ACCT_CD
             ,DCS.COA_PROD_CD
             ,DCS.COA_PROJ_CD
             ,DCS.COA_EXTN_CD
             ,DCS.PRC_ALLOC_RATE
             ,DCS.PRC_ALLOC_AMT
             ,SAD.SVC_ACCT_DIST_CATG_NM
        FROM
             DS_CONTR_SEG_ALLOC    DCS
             ,SVC_ACCT_DIST_CATG   SAD
        WHERE
            DCS.GLBL_CMPY_CD        = #glblCmpyCd#
        AND DCS.DS_CONTR_PK         = #dsContrPk#
        <isNotNull property="dsContrDtlPk">
            AND DCS.DS_CONTR_DTL_PK     = #dsContrDtlPk#
        </isNotNull>
        <isNull property="dsContrDtlPk">
            AND DCS.DS_CONTR_DTL_PK     IS NULL
        </isNull>
        <isNotNull property="svcInvChrgTpCd">
            AND DCS.SVC_INV_CHRG_TP_CD  = #svcInvChrgTpCd#
        </isNotNull>
        <isNull property="svcInvChrgTpCd">
            AND DCS.SVC_INV_CHRG_TP_CD  IS NULL
        </isNull>
        AND DCS.GLBL_CMPY_CD        = SAD.GLBL_CMPY_CD(+)
        AND DCS.COA_ACCT_CD         = SAD.COA_ACCT_CD(+)
        AND DCS.EZCANCELFLAG        = '0'
        AND SAD.EZCANCELFLAG(+)     = '0'
        ORDER BY
            DCS.COA_CMPY_CD ASC 
            ,DCS.COA_EXTN_CD ASC 
            ,DCS.COA_BR_CD ASC 
            ,DCS.COA_CC_CD ASC 
            ,DCS.COA_ACCT_CD ASC 
            ,DCS.COA_PROJ_CD ASC 
            ,DCS.COA_PROD_CD ASC 
            ,DCS.COA_AFFL_CD ASC 
            ,DCS.COA_CH_CD ASC
    </statement>

    <statement id="getSvcAcctDistCatgNm" parameterClass="Map" resultMap="String">
        SELECT
            SVC_ACCT_DIST_CATG_NM 
        FROM 
            SVC_ACCT_DIST_CATG
        WHERE 
            GLBL_CMPY_CD = #glblCmpyCd#
        AND COA_ACCT_CD  = #coaAcctCd#
        AND EZCANCELFLAG = '0'
    </statement>

</sqlMap>
