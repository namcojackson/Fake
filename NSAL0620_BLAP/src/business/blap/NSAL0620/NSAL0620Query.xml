<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSAL0620Query">
    <typeAlias alias="NSAL0620_ASMsg"  type="business.blap.NSAL0620.NSAL0620_ASMsg"/>
    <typeAlias alias="NSAL0620_FSMsg"  type="business.blap.NSAL0620.NSAL0620_FSMsg"/>
    <statement id="getSavedSearchOptionList" parameterClass="Map" resultClass="Map">
        SELECT
                  SSO.SRCH_OPT_PK
                , SSO.SRCH_OPT_NM
            FROM
                SAVE_SRCH_OPT SSO 
            WHERE
                SSO.GLBL_CMPY_CD        = #glblCmpyCd#
                AND SSO.SRCH_OPT_APL_ID = #srchOptAplId#
                AND SSO.SRCH_OPT_USR_ID = #srchOptUsrId#
                AND SSO.EZCANCELFLAG    = '0'
            ORDER BY
                  SSO.SRCH_OPT_PK
    </statement>
    <statement id="getSearchData" parameterClass="Map" resultMap="result.getSearchData">
    WITH SVC_RG_TMP AS (
        SELECT
             D.GLBL_CMPY_CD
            ,D.SVC_LINE_BIZ_CD
            ,D.SVC_CONTR_BR_CD
            ,D.SVC_RG_NM
        FROM (
            SELECT
                 B.GLBL_CMPY_CD
                ,C.SVC_LINE_BIZ_CD
                ,B.SVC_CONTR_BR_CD
                ,C.SVC_RG_NM
                ,ROW_NUMBER() OVER(PARTITION BY C.SVC_LINE_BIZ_CD, B.SVC_CONTR_BR_CD ORDER BY B.SVC_RG_PK) AS RANK
            FROM
                 SVC_RG_BR_RELN B
                ,SVC_RG         C
            WHERE
                    B.GLBL_CMPY_CD = #glblCmpyCd#
                <iterate property="svcContrBrCdList" var="svcContrBrCd[]" open="AND B.SVC_CONTR_BR_CD IN (" close=")" conjunction=",">
                #svcContrBrCd[]#
                </iterate>
                AND B.EZCANCELFLAG = '0'
                AND B.GLBL_CMPY_CD = C.GLBL_CMPY_CD
                AND B.SVC_RG_PK    = C.SVC_RG_PK
                <iterate property="svcRgNmList" var="svcRgNm[]" open="AND C.SVC_RG_NM IN (" close=")" conjunction=",">
                #svcRgNm[]#
                </iterate>
                AND C.EZCANCELFLAG = '0'
            ) D
        WHERE
            RANK = 1
    )
    <!-- START 2024/02/07 K.Watanabe [QC#63464, MOD] -->
<!-- ,TARGET_CONTR AS ( -->
    ,TARGET_CONTR_WRK AS (
    <!-- END 2024/02/07 K.Watanabe [QC#63464, MOD] -->
        SELECT
             MAIN.DS_CONTR_NUM                AS DS_CONTR_NUM
<!-- START 2018/11/05 K.Fujimoto [QC#28627,ADD] -->
            ,MAIN.CONTR_LINK_NUM              AS CONTR_LINK_NUM
<!-- END 2018/11/05 K.Fujimoto [QC#28627,ADD] -->
            ,MAIN.DS_CONTR_CATG_CD            AS DS_CONTR_CATG_CD
            ,MAIN.DS_CONTR_CATG_DESC_TXT      AS DS_CONTR_CATG_DESC_TXT
            ,MAIN.CONTR_VRSN_EFF_FROM_DT      AS CONTR_VRSN_EFF_FROM_DT
            ,MAIN.CONTR_VRSN_EFF_THRU_DT      AS CONTR_VRSN_EFF_THRU_DT
            ,MAIN.DS_CONTR_STS_CD             AS DS_CONTR_STS_CD
<!-- START 2018/09/05 K.Kojima [QC#28061,DEL] -->
<!--        ,MAIN.DS_CONTR_CTRL_STS_NM        AS DS_CONTR_CTRL_STS_NM -->
<!-- END 2018/09/05 K.Kojima [QC#28061,DEL] -->
            ,MAIN.SVC_CONTR_BR_CD             AS SVC_CONTR_BR_CD
            ,MAIN.DS_CONTR_SQ_NUM             AS DS_CONTR_SQ_NUM
            ,MAIN.DS_CONTR_NM                 AS DS_CONTR_NM
            ,MAIN.PMT_TERM_CASH_DISC_CD       AS PMT_TERM_CASH_DISC_CD
            ,MAIN.SVC_CONTR_REF_CMNT_TXT      AS SVC_CONTR_REF_CMNT_TXT
            ,MAIN.BLLG_APVL_REQ_FLG           AS BLLG_APVL_REQ_FLG
            ,MAIN.CCY_CD                      AS CCY_CD
            ,MAIN.PRE_INV_REQ_FLG             AS PRE_INV_REQ_FLG
            ,MAIN.RNW_CPLT_FLG                AS RNW_CPLT_FLG
            ,MAIN.INV_SEPT_BASE_USG_FLG       AS INV_SEPT_BASE_USG_FLG
            ,MAIN.DS_CONTR_CRAT_DT            AS DS_CONTR_CRAT_DT
            ,MAIN.DS_CONTR_CRAT_PSN_CD        AS DS_CONTR_CRAT_PSN_CD
            ,MAIN.DS_CONTR_LAST_UPD_DT        AS DS_CONTR_LAST_UPD_DT
            ,MAIN.DS_CONTR_LAST_UPD_PSN_CD    AS DS_CONTR_LAST_UPD_PSN_CD
            ,MAIN.LEASE_CMPY_CD               AS LEASE_CMPY_CD
            ,MAIN.DS_ACCT_NUM                 AS DS_ACCT_NUM
            ,MAIN.TOC_CD                      AS TOC_CD
            ,MAIN.BASE_CHRG_TO_LEASE_CMPY_FLG AS BASE_CHRG_TO_LEASE_CMPY_FLG
            ,MAIN.USG_CHRG_TO_LEASE_CMPY_FLG  AS USG_CHRG_TO_LEASE_CMPY_FLG
            ,MAIN.MTR_EST_TP_CD               AS MTR_EST_TP_CD
            ,MAIN.PRC_ALLOC_BY_MACH_QTY_FLG   AS PRC_ALLOC_BY_MACH_QTY_FLG
            ,MAIN.DS_CONTR_CLS_CD             AS DS_CONTR_CLS_CD
            ,MAIN.CONTR_INV_CMNT_TXT          AS CONTR_INV_CMNT_TXT
            ,MAIN.CRAT_DRAFT_PSN_CD           AS CRAT_DRAFT_PSN_CD
            ,MAIN.SVC_LINE_BIZ_CD             AS SVC_LINE_BIZ_CD
            ,MAIN.DS_CONTR_PK                 AS DS_CONTR_PK
            ,MAIN.CONTR_EFF_FROM_DT           AS CONTR_EFF_FROM_DT
            ,MAIN.CONTR_EFF_THRU_DT           AS CONTR_EFF_THRU_DT
            ,MAIN.DS_CONTR_DTL_PK             AS DS_CONTR_DTL_PK
            ,MAIN.SVC_RG_NM                   AS SVC_RG_NM
            ,MAIN.DS_ACCT_NM                  AS DS_ACCT_NM
            ,MAIN.BILL_TO_CUST_CD             AS BILL_TO_CUST_CD
            ,MAIN.SER_NUM                     AS SER_NUM
            ,MAIN.SVC_MACH_MSTR_STS_CD        AS SVC_MACH_MSTR_STS_CD
            ,MAIN.SVC_MACH_MSTR_STS_NM        AS SVC_MACH_MSTR_STS_NM
            ,MAIN.SVC_MACH_MSTR_PK            AS SVC_MACH_MSTR_PK
            ,MAIN.T_MDL_ID                    AS T_MDL_ID
            ,MAIN.T_MDL_NM                    AS T_MDL_NM
            ,MAIN.PHYS_MTR_EXST_FLG           AS PHYS_MTR_EXST_FLG
            ,MAIN.SORT_SER_NUM
            ,MAIN.SORT_DS_CONTR_DTL_TP
            ,MAIN.GLBL_CMPY_CD                AS GLBL_CMPY_CD
            ,MAIN.BILL_TO_LOC_NM              AS BILL_TO_LOC_NM
            ,MAIN.DS_CONTR_CLS_DESC_TXT       AS DS_CONTR_CLS_DESC_TXT
            ,MAIN.BR_PSN_NM                   AS BR_PSN_NM
            ,MAIN.TOC_NM                      AS TOC_NM
            ,MAIN.DS_CONTR_RPT_GRP_DESC_TXT   AS DS_CONTR_RPT_GRP_DESC_TXT
            ,MAIN.DS_BILL_TGTR_FLG            AS DS_BILL_TGTR_FLG
            ,MAIN.MTR_EST_TP_DESC_TXT         AS MTR_EST_TP_DESC_TXT
            ,MAIN.DS_ACCT_NM_LS               AS DS_ACCT_NM_LS
            ,MAIN.CFS_LEASE_NUM_CMNT_TXT      AS CFS_LEASE_NUM_CMNT_TXT
            ,MAIN.PMT_TERM_CASH_DISC_DESC_TXT AS PMT_TERM_CASH_DISC_DESC_TXT
            ,MAIN.SVC_MACH_TP_DESC_TXT        AS SVC_MACH_TP_DESC_TXT
            ,MAIN.SVC_CONFIG_MSTR_PK          AS SVC_CONFIG_MSTR_PK
            ,MAIN.MDSE_CD                     AS MDSE_CD
            ,MAIN.MDSE_DESC_SHORT_TXT         AS MDSE_DESC_SHORT_TXT
            ,MAIN.SHIP_TO_CUST_CD             AS SHIP_TO_CUST_CD
            ,MAIN.SHIP_TO_LOC_NM              AS SHIP_TO_LOC_NM
            ,MAIN.SHIP_TO_CUST_LOC_ADDR       AS SHIP_TO_CUST_LOC_ADDR
            ,MAIN.MDSE_DESC_SHORT_TXT_SA      AS MDSE_DESC_SHORT_TXT_SA
            ,MAIN.MTR_READ_METH_DESC_TXT      AS MTR_READ_METH_DESC_TXT
            ,MAIN.CONTR_CLO_DT                AS CONTR_CLO_DT
            ,MAIN.RNW_EFF_FROM_DT             AS RNW_EFF_FROM_DT
            ,MAIN.CONTR_RNW_TOT_CNT           AS CONTR_RNW_TOT_CNT
            ,MAIN.BLLG_MTR_BILL_TO_CUST_CD    AS BLLG_MTR_BILL_TO_CUST_CD
            ,MAIN.BILL_TO_LOC_NM_BS           AS BILL_TO_LOC_NM_BS
            ,MAIN.BILL_TO_CUST_LOC_ADDR       AS BILL_TO_CUST_LOC_ADDR
            ,MAIN.BS_PSN_NM                   AS BS_PSN_NM
            ,MAIN.BASE_BLLG_TMG_CD            AS BASE_BLLG_TMG_CD
            ,MAIN.CONTR_BLLG_DAY              AS CONTR_BLLG_DAY
            ,MAIN.CONTR_CLO_DAY               AS CONTR_CLO_DAY
            ,MAIN.BASE_PRC_TERM_DEAL_AMT_RATE AS BASE_PRC_TERM_DEAL_AMT_RATE
            ,MAIN.BASE_PRC_DEAL_AMT           AS BASE_PRC_DEAL_AMT
            ,MAIN.SVC_BY_LINE_BIZ_TP_CD       AS SVC_BY_LINE_BIZ_TP_CD
            ,MAIN.FLD_SVC_BR_CD               AS FLD_SVC_BR_CD
<!-- START 2018/09/05 K.Kojima [QC#28061,DEL] -->
<!--        ,MAIN.DS_CONTR_CTRL_STS_NM_H        AS DS_CONTR_CTRL_STS_NM_H -->
<!-- END 2018/09/05 K.Kojima [QC#28061,DEL] -->
            ,MAIN.BLLG_TMG_TP_DESC_TXT          AS BLLG_TMG_TP_DESC_TXT
            ,MAIN.BLLG_CYCLE_DESC_TXT           AS BLLG_CYCLE_DESC_TXT
            ,MAIN.DS_CONTR_DTL_TP_CD            AS DS_CONTR_DTL_TP_CD
            ,MAIN.DS_CONTR_DTL_PK_FAL           AS DS_CONTR_DTL_PK_FAL
            ,MAIN.BLLG_CYCLE_DESC_TXT_FA        AS BLLG_CYCLE_DESC_TXT_FA
            ,MAIN.BASE_PRC_DEAL_AMT_FA              AS BASE_PRC_DEAL_AMT_FA
            ,MAIN.BASE_PRC_TERM_DEAL_AMT_RATE_FA    AS BASE_PRC_TERM_DEAL_AMT_RATE_FA
            ,MAIN.BLLG_TMG_TP_DESC_TXT_FA           AS BLLG_TMG_TP_DESC_TXT_FA
            ,MAIN.CONTR_CLO_DAY_FA              AS CONTR_CLO_DAY_FA
            ,MAIN.CONTR_BLLG_DAY_FA             AS CONTR_BLLG_DAY_FA
            ,MAIN.SVC_BR_CD_DESC_TXT       AS SVC_BR_CD_DESC_TXT
            <!-- START 2023/05/15 M.Okamura [QC#60169, MOD] -->
            ,CASE WHEN MAIN.CONTR_CLO_DT IS NOT NULL
                THEN MAIN.SVC_MEMO_RSN_DESC_TXT
                ELSE NULL
            END AS SVC_MEMO_RSN_DESC_TXT
            <!-- END 2023/05/15 M.Okamura [QC#60169, MOD] -->
            <!-- START 2022/02/04 K.Kitachi [QC#59684, ADD] -->
            ,MAIN.MAN_TRMN_TP_CD              AS MAN_TRMN_TP_CD
            <!-- END 2022/02/04 K.Kitachi [QC#59684, ADD] -->
            <!-- START 2022/03/22 [QC#59683, ADD] -->
            ,MAIN.DS_INV_TGTR_TP_DESC_TXT     AS DS_INV_TGTR_TP_DESC_TXT
            <!-- END   2022/03/22 [QC#59683, ADD] -->
        FROM
            (SELECT
                 DC.GLBL_CMPY_CD                AS GLBL_CMPY_CD
                ,DC.DS_CONTR_NUM                AS DS_CONTR_NUM
<!-- START 2018/11/05 K.Fujimoto [QC#28627,ADD] -->
                ,DC.CONTR_LINK_NUM              AS CONTR_LINK_NUM
<!-- END 2018/11/05 K.Fujimoto [QC#28627,ADD] -->
                ,DC.DS_CONTR_CATG_CD            AS DS_CONTR_CATG_CD
<!-- START 2018/06/05 T.Ogura [QC#21159,MOD] -->
<!--            ,DCC.DS_CONTR_CATG_NM           AS DS_CONTR_CATG_NM -->
                ,DCC.DS_CONTR_CATG_DESC_TXT     AS DS_CONTR_CATG_DESC_TXT
<!-- END   2018/06/05 T.Ogura [QC#21159,MOD] -->
                ,DC.CONTR_VRSN_EFF_FROM_DT      AS CONTR_VRSN_EFF_FROM_DT
                ,DC.CONTR_VRSN_EFF_THRU_DT      AS CONTR_VRSN_EFF_THRU_DT
                ,DC.DS_CONTR_STS_CD             AS DS_CONTR_STS_CD
<!-- START 2018/09/05 K.Kojima [QC#28061,DEL] -->
<!--             ,CASE                                                                                     -->
<!--                  WHEN     DCDS.DS_CONTR_CTRL_STS_CD = #entered#                                       -->
<!--                      AND  SMM.SVC_MACH_MSTR_STS_CD  = #w4i#                                           -->
<!--                  THEN #pendingInstallation#                                                           -->
<!--                  WHEN     DCDS.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdActive#                        -->
<!--                      AND  DC.DS_CONTR_CATG_CD &lt;&gt; #dsContrCatgCdFleet#                           -->
<!--                      AND (                                                                            -->
<!--                           SELECT                                                                      -->
<!--                               COUNT(*)                                                                -->
<!--                           FROM                                                                        -->
<!--                                DS_CONTR_PRC_EFF       DCPE                                            -->
<!--                                    START 2018/04/11 K.Kojima [QC#22722-4,DEL]                         -->
<!--                                    ,DS_CONTR_PRC_EFF_STS_V DCPESV                                     -->
<!--                                    END 2018/04/11 K.Kojima [QC#22722-4,DEL]                           -->
<!--                           WHERE                                                                       -->
<!--                                 DCPE.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD                        -->
<!--                             AND DCPE.DS_CONTR_DTL_PK        = DCD.DS_CONTR_DTL_PK                     -->
<!--                             AND DCPE.EZCANCELFLAG           = '0'                                     -->
<!--                                  START 2018/04/11 K.Kojima [QC#22722-4,MOD]                           -->
<!--                                  AND DCPE.GLBL_CMPY_CD           = DCPESV.GLBL_CMPY_CD                -->
<!--                                  AND DCPE.DS_CONTR_PRC_EFF_PK    = DCPESV.DS_CONTR_PRC_EFF_PK         -->
<!--                                  AND DCPESV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdRenewalHoldForPO# -->
<!--                                  AND DCPESV.EZCANCELFLAG         = '0'                                -->
<!--                             AND DCPE.DS_CONTR_PRC_EFF_STS_CD = #dsContrCtrlStsCdRenewalHoldForPO#     -->
<!--                                  END 2018/04/11 K.Kojima [QC#22722-4,MOD]                             -->
<!--                          ) &gt; 0                                                                     -->
<!--                  THEN #activePendingPO#                                                               -->
<!--                  WHEN     DCDS.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdActive#                        -->
<!--                      AND  DC.DS_CONTR_CATG_CD       = #dsContrCatgCdFleet#                            -->
<!--                      AND (                                                                            -->
<!--                           SELECT                                                                      -->
<!--                               COUNT(*)                                                                -->
<!--                           FROM                                                                        -->
<!--                                DS_CONTR_DTL           DCDF                                            -->
<!--                               ,DS_CONTR_PRC_EFF       DCPE                                            -->
<!--                                    START 2018/04/11 K.Kojima [QC#22722-4,DEL]                         -->
<!--                                    ,DS_CONTR_PRC_EFF_STS_V DCPESV                                     -->
<!--                                    END 2018/04/11 K.Kojima [QC#22722-4,DEL]                           -->
<!--                           WHERE                                                                       -->
<!--                                 DCDF.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD                        -->
<!--                             AND DCDF.DS_CONTR_PK            = DCD.DS_CONTR_PK                         -->
<!--                             AND DCDF.DS_CONTR_DTL_TP_CD     = #dsContrDtlTpCdFleet#                   -->
<!--                             AND DCDF.EZCANCELFLAG           = '0'                                     -->
<!--                             AND DCDF.GLBL_CMPY_CD           = DCPE.GLBL_CMPY_CD                       -->
<!--                             AND DCDF.DS_CONTR_DTL_PK        = DCPE.DS_CONTR_DTL_PK                    -->
<!--                             AND DCPE.EZCANCELFLAG           = '0'                                     -->
<!--                                  START 2018/04/11 K.Kojima [QC#22722-4,MOD]                           -->
<!--                                  AND DCPE.GLBL_CMPY_CD           = DCPESV.GLBL_CMPY_CD                -->
<!--                                  AND DCPE.DS_CONTR_PRC_EFF_PK    = DCPESV.DS_CONTR_PRC_EFF_PK         -->
<!--                                  AND DCPESV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdRenewalHoldForPO# -->
<!--                                  AND DCPESV.EZCANCELFLAG         = '0'                                -->
<!--                             AND DCPE.DS_CONTR_PRC_EFF_STS_CD = #dsContrCtrlStsCdRenewalHoldForPO#     -->
<!--                                  END 2018/04/11 K.Kojima [QC#22722-4,MOD]                             -->
<!--                          ) &gt; 0                                                                     -->
<!--                  THEN #activePendingPO#                                                               -->
<!--                  WHEN     DCDS.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdActive#                        -->
<!--                      AND  DC.DS_CONTR_CATG_CD &lt;&gt; #dsContrCatgCdFleet#                           -->
<!--                      AND (                                                                            -->
<!--                           SELECT                                                                      -->
<!--                               COUNT(*)                                                                -->
<!--                           FROM                                                                        -->
<!--                                DS_CONTR_PRC_EFF       DCPE                                            -->
<!--                                    START 2018/04/11 K.Kojima [QC#22722-4,DEL]                         -->
<!--                                    ,DS_CONTR_PRC_EFF_STS_V DCPESV                                     -->
<!--                                    END 2018/04/11 K.Kojima [QC#22722-4,DEL]                           -->
<!--                           WHERE                                                                       -->
<!--                                 DCPE.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD                        -->
<!--                             AND DCPE.DS_CONTR_DTL_PK        = DCD.DS_CONTR_DTL_PK                     -->
<!--                             AND DCPE.EZCANCELFLAG           = '0'                                     -->
<!--                                  START 2018/04/11 K.Kojima [QC#22722-4,MOD]                           -->
<!--                                  AND DCPE.GLBL_CMPY_CD           = DCPESV.GLBL_CMPY_CD                -->
<!--                                  AND DCPE.DS_CONTR_PRC_EFF_PK    = DCPESV.DS_CONTR_PRC_EFF_PK         -->
<!--                                  AND DCPESV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdRenewalHold#      -->
<!--                                  AND DCPESV.EZCANCELFLAG         = '0'                                -->
<!--                             AND DCPE.DS_CONTR_PRC_EFF_STS_CD = #dsContrCtrlStsCdRenewalHold#          -->
<!--                                  END 2018/04/11 K.Kojima [QC#22722-4,MOD]                             -->
<!--                          ) &gt; 0                                                                     -->
<!--                  THEN #activeRenewalHold#                                                             -->
<!--                  WHEN     DCDS.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdActive#                        -->
<!--                      AND  DC.DS_CONTR_CATG_CD       = #dsContrCatgCdFleet#                            -->
<!--                      AND (                                                                            -->
<!--                           SELECT                                                                      -->
<!--                               COUNT(*)                                                                -->
<!--                           FROM                                                                        -->
<!--                                DS_CONTR_DTL           DCDF                                            -->
<!--                               ,DS_CONTR_PRC_EFF       DCPE                                            -->
<!--                                    START 2018/04/11 K.Kojima [QC#22722-4,DEL]                         -->
<!--                                    ,DS_CONTR_PRC_EFF_STS_V DCPESV                                     -->
<!--                                    END 2018/04/11 K.Kojima [QC#22722-4,DEL]                           -->
<!--                           WHERE                                                                       -->
<!--                                 DCDF.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD                        -->
<!--                             AND DCDF.DS_CONTR_PK            = DCD.DS_CONTR_PK                         -->
<!--                             AND DCDF.DS_CONTR_DTL_TP_CD     = #dsContrDtlTpCdFleet#                   -->
<!--                             AND DCDF.EZCANCELFLAG           = '0'                                     -->
<!--                             AND DCDF.GLBL_CMPY_CD           = DCPE.GLBL_CMPY_CD                       -->
<!--                             AND DCDF.DS_CONTR_DTL_PK        = DCPE.DS_CONTR_DTL_PK                    -->
<!--                             AND DCPE.EZCANCELFLAG           = '0'                                     -->
<!--                                  START 2018/04/11 K.Kojima [QC#22722-4,MOD]                           -->
<!--                                  AND DCPE.GLBL_CMPY_CD           = DCPESV.GLBL_CMPY_CD                -->
<!--                                  AND DCPE.DS_CONTR_PRC_EFF_PK    = DCPESV.DS_CONTR_PRC_EFF_PK         -->
<!--                                  AND DCPESV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdRenewalHold#      -->
<!--                                  AND DCPESV.EZCANCELFLAG         = '0'                                -->
<!--                             AND DCPE.DS_CONTR_PRC_EFF_STS_CD = #dsContrCtrlStsCdRenewalHold#          -->
<!--                                  END 2018/04/11 K.Kojima [QC#22722-4,MOD]                             -->
<!--                          ) &gt; 0                                                                     -->
<!--                  THEN #activeRenewalHold#                                                             -->
<!--                  ELSE DCDS.DS_CONTR_CTRL_STS_NM                                                       -->
<!--              END                            AS DS_CONTR_CTRL_STS_NM                                   -->
<!-- END 2018/09/05 K.Kojima [QC#28061,DEL] -->
                ,DC.SVC_CONTR_BR_CD             AS SVC_CONTR_BR_CD
                ,DC.DS_CONTR_SQ_NUM             AS DS_CONTR_SQ_NUM
                ,DC.DS_CONTR_NM                 AS DS_CONTR_NM
                ,DC.PMT_TERM_CASH_DISC_CD       AS PMT_TERM_CASH_DISC_CD
                ,DC.SVC_CONTR_REF_CMNT_TXT      AS SVC_CONTR_REF_CMNT_TXT
                ,DC.BLLG_APVL_REQ_FLG           AS BLLG_APVL_REQ_FLG
                ,DC.CCY_CD                      AS CCY_CD
                ,DC.PRE_INV_REQ_FLG             AS PRE_INV_REQ_FLG
                ,DC.RNW_CPLT_FLG                AS RNW_CPLT_FLG
                ,DC.INV_SEPT_BASE_USG_FLG       AS INV_SEPT_BASE_USG_FLG
                ,DC.DS_CONTR_CRAT_DT            AS DS_CONTR_CRAT_DT
                ,DC.DS_CONTR_CRAT_PSN_CD        AS DS_CONTR_CRAT_PSN_CD
                ,DC.DS_CONTR_LAST_UPD_DT        AS DS_CONTR_LAST_UPD_DT
                ,DC.DS_CONTR_LAST_UPD_PSN_CD    AS DS_CONTR_LAST_UPD_PSN_CD
                ,DC.LEASE_CMPY_CD               AS LEASE_CMPY_CD
                ,DC.DS_ACCT_NUM                 AS DS_ACCT_NUM
                ,DC.TOC_CD                      AS TOC_CD
                ,DC.BASE_CHRG_TO_LEASE_CMPY_FLG AS BASE_CHRG_TO_LEASE_CMPY_FLG
                ,DC.USG_CHRG_TO_LEASE_CMPY_FLG  AS USG_CHRG_TO_LEASE_CMPY_FLG
                ,DC.MTR_EST_TP_CD               AS MTR_EST_TP_CD
                ,DC.PRC_ALLOC_BY_MACH_QTY_FLG   AS PRC_ALLOC_BY_MACH_QTY_FLG
                ,DC.DS_CONTR_CLS_CD             AS DS_CONTR_CLS_CD
                ,DC.CONTR_INV_CMNT_TXT          AS CONTR_INV_CMNT_TXT
                ,DC.CRAT_DRAFT_PSN_CD           AS CRAT_DRAFT_PSN_CD
                ,DC.SVC_LINE_BIZ_CD             AS SVC_LINE_BIZ_CD
                ,DC.DS_CONTR_PK                 AS DS_CONTR_PK
                ,DCD.CONTR_EFF_FROM_DT          AS CONTR_EFF_FROM_DT
                ,DCD.CONTR_EFF_THRU_DT          AS CONTR_EFF_THRU_DT
                ,DCD.DS_CONTR_DTL_PK            AS DS_CONTR_DTL_PK
                ,SR.SVC_RG_NM                   AS SVC_RG_NM
                ,DAC.DS_ACCT_NM                 AS DS_ACCT_NM
                ,DC.ALT_PAYER_CUST_CD           AS BILL_TO_CUST_CD
                ,SMM.SER_NUM                    AS SER_NUM
                ,SMM.SVC_MACH_MSTR_STS_CD       AS SVC_MACH_MSTR_STS_CD
                ,SMMS.SVC_MACH_MSTR_STS_NM      AS SVC_MACH_MSTR_STS_NM
                ,SMM.SVC_MACH_MSTR_PK           AS SVC_MACH_MSTR_PK
                ,MN.T_MDL_ID                    AS T_MDL_ID
                ,MN.T_MDL_NM                    AS T_MDL_NM
                ,CASE
                    WHEN
                        (
                            SELECT
                                COUNT(*)
                            FROM
                                SVC_PHYS_MTR SPM
                            WHERE
                                    SPM.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
                                AND SPM.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                                AND SPM.EZCANCELFLAG     = '0'
                                AND ROWNUM               = 1
                        ) > 0
                    THEN
                        'Y'
                    ELSE
                        'N'
                 END                            AS PHYS_MTR_EXST_FLG
                ,NVL(PSMM.SER_NUM, SMM.SER_NUM) AS SORT_SER_NUM
                ,DT.DS_CONTR_DTL_TP_SORT_NUM    AS SORT_DS_CONTR_DTL_TP
                ,DCCD.DS_CONTR_CLS_DESC_TXT     AS DS_CONTR_CLS_DESC_TXT
                ,DAC.DS_BILL_TGTR_FLG           AS DS_BILL_TGTR_FLG
                ,DC.CFS_LEASE_NUM_CMNT_TXT      AS CFS_LEASE_NUM_CMNT_TXT
                ,SMM.SVC_CONFIG_MSTR_PK         AS SVC_CONFIG_MSTR_PK
                ,MDS.MDSE_CD                    AS MDSE_CD
                ,MDS.MDSE_DESC_SHORT_TXT        AS MDSE_DESC_SHORT_TXT
                ,STC.SHIP_TO_CUST_CD            AS SHIP_TO_CUST_CD
                ,DCD.CONTR_CLO_DT               AS CONTR_CLO_DT
                ,DCD.RNW_EFF_FROM_DT            AS RNW_EFF_FROM_DT
                ,DCD.CONTR_RNW_TOT_CNT          AS CONTR_RNW_TOT_CNT
                ,RTRIM(BPN.PSN_FIRST_NM || ' ' || BPN.PSN_LAST_NM) 
                                                AS BR_PSN_NM
                ,ORG.TOC_NM                     AS TOC_NM
                ,MET.MTR_EST_TP_DESC_TXT        AS MTR_EST_TP_DESC_TXT
                ,BTC.LOC_NM                     AS BILL_TO_LOC_NM
                ,SMT.SVC_MACH_TP_DESC_TXT       AS SVC_MACH_TP_DESC_TXT
                ,MRM.MTR_READ_METH_DESC_TXT     AS MTR_READ_METH_DESC_TXT
                ,SMD.MDSE_DESC_SHORT_TXT        AS MDSE_DESC_SHORT_TXT_SA
                ,CRG.DS_CONTR_RPT_GRP_DESC_TXT  AS DS_CONTR_RPT_GRP_DESC_TXT
                ,BTC2.DS_ACCT_NM                AS DS_ACCT_NM_LS
                ,SHIP.LOC_NM                    AS SHIP_TO_LOC_NM
                ,SHIP.FIRST_LINE_ADDR
                    || DECODE(SHIP.SCD_LINE_ADDR,    null, '', ' ' || SHIP.SCD_LINE_ADDR)
                    || DECODE(SHIP.THIRD_LINE_ADDR,  null, '', ' ' || SHIP.THIRD_LINE_ADDR)
                    || DECODE(SHIP.FRTH_LINE_ADDR,   null, '', ' ' || SHIP.FRTH_LINE_ADDR)
                    || DECODE(SHIP.CTY_ADDR,         null, '', ' ' || SHIP.CTY_ADDR)
                    || DECODE(SHIP.ST_CD,            null, '', ' ' || SHIP.ST_CD)
                    || DECODE(SHIP.POST_CD,          null, '', ' ' || SHIP.POST_CD) AS SHIP_TO_CUST_LOC_ADDR

                ,DCD.BASE_BILL_TO_CUST_CD       AS BLLG_MTR_BILL_TO_CUST_CD
                ,BTB.LOC_NM                     AS BILL_TO_LOC_NM_BS
                ,BTB.FIRST_LINE_ADDR
                    || DECODE(BTB.SCD_LINE_ADDR,    null, '', ' ' || BTB.SCD_LINE_ADDR)
                    || DECODE(BTB.THIRD_LINE_ADDR,  null, '', ' ' || BTB.THIRD_LINE_ADDR)
                    || DECODE(BTB.FRTH_LINE_ADDR,   null, '', ' ' || BTB.FRTH_LINE_ADDR)
                    || DECODE(BTB.CTY_ADDR,         null, '', ' ' || BTB.CTY_ADDR)
                    || DECODE(BTB.ST_CD,            null, '', ' ' || BTB.ST_CD)
                    || DECODE(BTB.POST_CD,          null, '', ' ' || BTB.POST_CD) AS BILL_TO_CUST_LOC_ADDR
                ,PMT.PMT_TERM_CASH_DISC_DESC_TXT  AS PMT_TERM_CASH_DISC_DESC_TXT
                ,RTRIM(BSN.CTAC_PSN_FIRST_NM || ' ' || BSN.CTAC_PSN_LAST_NM)
                                                  AS BS_PSN_NM
                ,DCD.BASE_BLLG_TMG_CD             AS BASE_BLLG_TMG_CD
                ,DCD.CONTR_BLLG_DAY               AS CONTR_BLLG_DAY
                ,DCD.CONTR_CLO_DAY                AS CONTR_CLO_DAY
                ,DCD.BASE_PRC_TERM_DEAL_AMT_RATE  AS BASE_PRC_TERM_DEAL_AMT_RATE
                ,DCD.BASE_PRC_DEAL_AMT            AS BASE_PRC_DEAL_AMT
                ,SMM.SVC_BY_LINE_BIZ_TP_CD        AS SVC_BY_LINE_BIZ_TP_CD
                ,SMM.FLD_SVC_BR_CD                AS FLD_SVC_BR_CD
<!-- START 2018/09/05 K.Kojima [QC#28061,DEL] -->
<!--            ,DCSV.DS_CONTR_CTRL_STS_NM        AS DS_CONTR_CTRL_STS_NM_H -->
<!-- END 2018/09/05 K.Kojima [QC#28061,DEL] -->
                ,TMG.BLLG_TMG_TP_DESC_TXT         AS BLLG_TMG_TP_DESC_TXT
                ,CYCLE.BLLG_CYCLE_DESC_TXT        AS BLLG_CYCLE_DESC_TXT
                ,DCD.DS_CONTR_DTL_TP_CD           AS DS_CONTR_DTL_TP_CD
                ,FLT_AGG_L.DS_CONTR_DTL_PK        AS DS_CONTR_DTL_PK_FAL
                ,CYCLE_FA.BLLG_CYCLE_DESC_TXT     AS BLLG_CYCLE_DESC_TXT_FA
                ,FLT_AGG_L.BASE_PRC_DEAL_AMT      AS BASE_PRC_DEAL_AMT_FA
                ,FLT_AGG_L.BASE_PRC_TERM_DEAL_AMT_RATE AS BASE_PRC_TERM_DEAL_AMT_RATE_FA
                ,TMG_FA.BLLG_TMG_TP_DESC_TXT      AS BLLG_TMG_TP_DESC_TXT_FA
                ,FLT_AGG_L.CONTR_CLO_DAY          AS CONTR_CLO_DAY_FA
                ,FLT_AGG_L.CONTR_BLLG_DAY         AS CONTR_BLLG_DAY_FA
                ,(
                    SELECT
                        A.SVC_BR_CD_DESC_TXT
                    FROM (
                            SELECT DISTINCT
                                SBPX.SVC_BR_CD_DESC_TXT
                            FROM
                                SVC_BR_POST_XREF SBPX
                            WHERE
                                 SBPX.GLBL_CMPY_CD   = SMM.GLBL_CMPY_CD
                            AND SBPX.EZCANCELFLAG    = SMM.EZCANCELFLAG
                            AND SBPX.SVC_LINE_BIZ_CD = SMM.SVC_BY_LINE_BIZ_TP_CD
                            AND SBPX.SVC_BR_CD       = SMM.FLD_SVC_BR_CD
                            AND (SBPX.POST_CD        = SHIP.POST_CD 
                                     OR SBPX.POST_CD = SUBSTR(SHIP.POST_CD, 1, 5))
                            AND SBPX.EZCANCELFLAG    = '0'
                         ) A
                    WHERE
                        ROWNUM = 1
                )                             AS SVC_BR_CD_DESC_TXT
                ,(
                    SELECT 
                        X.SVC_MEMO_RSN_DESC_TXT 
                    FROM (
                            SELECT
                                SMR.SVC_MEMO_RSN_DESC_TXT
                            FROM
                                SVC_MEMO MEMO
                                ,SVC_MEMO_RSN SMR
                            WHERE
                                MEMO.GLBL_CMPY_CD    = DCD.GLBL_CMPY_CD
                            AND MEMO.DS_CONTR_PK     = DCD.DS_CONTR_PK
                            AND MEMO.DS_CONTR_DTL_PK = DCD.DS_CONTR_DTL_PK
                            AND MEMO.EZCANCELFLAG    = '0'
                            AND MEMO.GLBL_CMPY_CD    = SMR.GLBL_CMPY_CD
                            AND MEMO.SVC_MEMO_RSN_CD = SMR.SVC_MEMO_RSN_CD
                            AND SMR.EZCANCELFLAG     = 0
                            AND MEMO.SVC_MEMO_TP_CD  = #terminationNote#
                            ORDER BY
                                SVC_MEMO_PK DESC
                          ) X
                    WHERE ROWNUM = 1
                )                             AS SVC_MEMO_RSN_DESC_TXT
                <!-- START 2022/02/04 K.Kitachi [QC#59684, ADD] -->
                ,DCD.MAN_TRMN_TP_CD               AS MAN_TRMN_TP_CD
                <!-- END 2022/02/04 K.Kitachi [QC#59684, ADD] -->
                <!-- START 2022/03/22 [QC#59683, ADD] -->
                ,DITT.DS_INV_TGTR_TP_DESC_TXT     AS DS_INV_TGTR_TP_DESC_TXT
                <!-- END   2022/03/22 [QC#59683, ADD] -->
            FROM
                 DS_CONTR           DC
<!-- START 2018/09/05 K.Kojima [QC#28061,DEL] -->
<!--            ,DS_CONTR_DTL_STS_V DCDS -->
<!-- END 2018/09/05 K.Kojima [QC#28061,DEL] -->
                ,DS_CONTR_CATG      DCC
                ,DS_CONTR_DTL       DCD
                ,SVC_RG_TMP         SR
                ,SELL_TO_CUST       DAC
<!-- START 2019/01/26 [QC#30078,ADD] -->
            <isNotNull property="curLocNum">
                ,SELL_TO_CUST       DAC1
            </isNotNull>
<!-- END   2019/01/26 [QC#30078,ADD] -->
                ,SVC_MACH_MSTR      SMM
                ,SVC_MACH_MSTR_STS  SMMS
                ,SVC_CONFIG_MSTR    SCM
                ,MDL_NM             MN
                ,SHIP_TO_CUST       STC
                ,DS_CONTR_DTL       PDCD
                ,SVC_MACH_MSTR      PSMM
                ,DS_CONTR_DTL_TP    DT
                ,MDSE               DMI
                ,MDSE               MDS
                ,S21_PSN            BPN
                ,S21_ORG            ORG
                ,MTR_EST_TP         MET
                ,BILL_TO_CUST       BTC
                ,SVC_MACH_TP        SMT
                ,MTR_READ_METH      MRM
                ,MDSE               SMD
                ,DS_CONTR_RPT_GRP   CRG
                ,BILL_TO_CUST       BTC2
                ,SHIP_TO_CUST       SHIP
                ,BILL_TO_CUST       BTB
                ,PMT_TERM_CASH_DISC PMT
                ,CTAC_PSN           BSN
                ,DS_CONTR_CLS       DCCD
<!-- START 2018/09/05 K.Kojima [QC#28061,DEL] -->
<!--            ,DS_CONTR_STS_V     DCSV -->
<!-- END 2018/09/05 K.Kojima [QC#28061,DEL] -->
                ,BLLG_TMG_TP        TMG
                ,BLLG_CYCLE         CYCLE
                ,DS_CONTR_DTL       FLT_AGG_L
                ,BLLG_CYCLE         CYCLE_FA
                ,BLLG_TMG_TP        TMG_FA
                <!-- START 2022/03/22 [QC#59683, ADD] -->
                ,DS_INV_TGTR_TP     DITT
                <!-- END   2022/03/22 [QC#59683, ADD] -->
                <!-- START 2023/10/02 S.Moriai [QC#61056,ADD] -->
                <isEqual property="createdBetweenFlg" compareValue="true">
                ,DS_CONTR_CRAT_DT_MV        DS_CNTR_MV
                </isEqual>
                <!-- END 2023/10/02 S.Moria [QC#61056,ADD] -->
            WHERE
                    DC.GLBL_CMPY_CD             = #glblCmpyCd#
                AND DC.DS_CONTR_STS_CD   &lt;&gt; #dsContrStsCdOrdr#
                <!-- START 2018/04/11 K.Kojima [QC#22722-4,MOD] -->
                <!-- <isNotNull property="dsContrNum"> -->
                <!-- $dsContrNum$ -->
                <!-- </isNotNull> -->
                <isNotNull property="dsContrNumEqual">
                AND DC.DS_CONTR_NUM             = #dsContrNumEqual#
                $dsContrNum$
                </isNotNull>
                <isNotNull property="dsContrNumLike">
                AND DC.DS_CONTR_NUM             LIKE #dsContrNumLike#
                </isNotNull>
                <isNotNull property="dsContrNumLikeOr">
                $dsContrNumLikeOr$
                </isNotNull>
                <!-- START 2018/11/05 K.Fujimoto [QC#28627,MOD] -->
                <isNotNull property="contrLinkNumEqual">
                AND DC.CONTR_LINK_NUM           = #contrLinkNumEqual#
                </isNotNull>
                <isNotNull property="contrLinkNumLike">
                AND DC.CONTR_LINK_NUM             LIKE #contrLinkNumLike#
                </isNotNull>
                <isNotNull property="contrLinkNumLikeOr">
                $contrLinkNumLikeOr$
                </isNotNull>
                <!-- END   2018/11/05 K.Fujimoto [QC#28627,MOD] -->
                <!-- END 2018/04/11 K.Kojima [QC#22722-4,MOD] -->
<!-- START 2023/10/02 S.Moriai [QC#61056,DEL] -->
<!--            <isNotNull property="dsContrCratDtFrom"> -->
<!--            AND DC.DS_CONTR_CRAT_DT         &gt;= #dsContrCratDtFrom# -->
<!--            </isNotNull> -->
<!--            <isNotNull property="dsContrCratDtTo"> -->
<!--            AND DC.DS_CONTR_CRAT_DT         &lt;= #dsContrCratDtTo# -->
<!--            </isNotNull> -->
<!-- END 2023/10/02 S.Moriai [QC#61056,DEL] -->
                <!-- START 2023/10/02 S.Moriai [QC#61056,ADD] -->
                <isEqual property="createdBetweenFlg" compareValue="true">
                AND DC.DS_CONTR_PK              = DS_CNTR_MV.DS_CONTR_PK(+)
                <isNotNull property="dsContrCratDtFrom">
                AND DS_CNTR_MV.DS_CONTR_CRAT_DT &gt;= #dsContrCratDtFrom#
                </isNotNull>
                <isNotNull property="dsContrCratDtTo">
                AND DS_CNTR_MV.DS_CONTR_CRAT_DT &lt;= #dsContrCratDtTo#
                </isNotNull>
                </isEqual>
                <!-- END 2023/10/02 S.Moria [QC#61056,ADD] -->
<!-- START 2022/10/13 M.Komatsu [QC#60078,MOD] -->
<!--            <isNotNull property="dsContrCatgCd"> -->
<!--            AND DC.DS_CONTR_CATG_CD         = #dsContrCatgCd -->
                <isNotNull property="dsContrCatgCdList">
                <iterate property="dsContrCatgCdList" var="dsContrCatgCdList[]" open="AND DC.DS_CONTR_CATG_CD IN (" close=")" conjunction=",">
                #dsContrCatgCdList[]#
                </iterate>
                </isNotNull> 
<!-- END 2022/10/13 M.Komatsu [QC#60078,MOD] -->
                <isEqual property="invSeptBaseUsgFlg" compareValue="Y">
                AND DC.INV_SEPT_BASE_USG_FLG    = 'N'
                </isEqual>
                <isNotNull property="dsContrRptGrpNum">
                AND DC.DS_CONTR_RPT_GRP_NUM     LIKE #dsContrRptGrpNum#
                </isNotNull>
                <isNotNull property="svcContrRefCmntTxt">
                AND DC.SVC_CONTR_REF_CMNT_TXT   LIKE #svcContrRefCmntTxt#
                </isNotNull>
<!-- START 2022/10/13 M.Komatsu [QC#60078,MOD] -->
<!--            <isNotNull property="dsContrClsCd"> -->
<!--            AND DC.DS_CONTR_CLS_CD          = #dsContrClsCd# -->
                <isNotNull property="dsContrClsCdList">
                <iterate property="dsContrClsCdList" var="dsContrClsCdList[]" open="AND DC.DS_CONTR_CLS_CD IN (" close=")" conjunction=",">
                #dsContrClsCdList[]#
                </iterate>
                </isNotNull>
<!-- END 2022/10/13 M.Komatsu [QC#60078,MOD] -->
                <iterate property="dsAcctList" var="dsAcctList[]" open="AND DC.DS_ACCT_NUM IN (" close=")" conjunction=",">
                #dsAcctList[]#
                </iterate>
                <isEqual property="dateType" compareValue="5">
                <isNotNull property="xxFromDt">
                AND DC.CONTR_VRSN_EFF_FROM_DT         &gt;= #xxFromDt#
                </isNotNull>
                <isNotNull property="xxThruDt">
                <!-- START 2024/02/02 K.Watanabe [QC#63462, MOD] -->
<!--            AND DC.CONTR_VRSN_EFF_THRU_DT         &lt;= #xxThruDt# -->
                AND DC.CONTR_VRSN_EFF_FROM_DT         &lt;= #xxThruDt#
                <!-- END 2024/02/02 K.Watanabe [QC#63462, MOD] -->
                </isNotNull>
                </isEqual>
                AND DC.GLBL_CMPY_CD             = DMI.GLBL_CMPY_CD(+)
                AND DC.SVC_PGM_MDSE_CD          = DMI.MDSE_CD(+)
                AND DMI.EZCANCELFLAG(+)         = '0'
                <isNotNull property="mdseDescShortTxt">
                AND DMI.MDSE_DESC_SHORT_TXT     LIKE #mdseDescShortTxt#
                </isNotNull>
                <isEqual property="selectType" compareValue="3">
                AND EXISTS(
                        SELECT
                            1
                        FROM
                             DS_CONTR_DTL    DCD2
                            ,DS_CONTR_DTL_TP DCDT2
                        WHERE
                                DCD2.GLBL_CMPY_CD       = DC.GLBL_CMPY_CD
                            AND DCD2.DS_CONTR_DTL_STS_CD &lt;&gt; #dsContrDtlStsCdOrdr#
                            AND DCD2.DS_CONTR_PK        = DC.DS_CONTR_PK
                            AND (
                                    DCD2.CONTR_RNW_TOT_CNT  &gt;= 2
                                OR  (
                                        DCD2.CONTR_RNW_TOT_CNT  = 1
                                    AND DCD2.RNW_EFF_FROM_DT   &lt;= #slsDt#
                                    )
                                )
                            AND DCD2.EZCANCELFLAG       = '0'
                            AND DCD2.GLBL_CMPY_CD       = DCDT2.GLBL_CMPY_CD
                            AND DCD2.DS_CONTR_DTL_TP_CD = DCDT2.DS_CONTR_DTL_TP_CD
                            AND DCDT2.SVC_PRC_FLG       = #flgOffN#
                            AND DCDT2.EZCANCELFLAG      = '0'
                       )
                </isEqual>
                AND DC.EZCANCELFLAG              = '0'
<!-- START 2018/09/05 K.Kojima [QC#28061,DEL] -->
<!--            AND DCD.GLBL_CMPY_CD             = DCDS.GLBL_CMPY_CD (+) -->
<!--            AND DCD.DS_CONTR_PK              = DCDS.DS_CONTR_PK (+) -->
<!--            AND DCD.DS_CONTR_DTL_PK          = DCDS.DS_CONTR_DTL_PK (+) -->
<!--            <isNotNull property="dsContrCtrlStsCd"> -->
<!--            AND DCDS.DS_CONTR_CTRL_STS_CD    = #dsContrCtrlStsCd# -->
<!--            </isNotNull> -->
<!--            <isNotNull property="dsContrCtrlStsCdList"> -->
<!--            <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCdList[]" open="AND DCDS.DS_CONTR_CTRL_STS_CD IN (" close=")" conjunction=","> -->
<!--            #dsContrCtrlStsCdList[]# -->
<!--            </iterate> -->
<!--            </isNotNull> -->
<!--            AND DCDS.EZCANCELFLAG (+)       = '0' -->
<!-- END 2018/09/05 K.Kojima [QC#28061,DEL] -->
<!-- START 2019/02/21 [QC#30242,ADD] -->
<!-- START 2022/10/13 M.Komatsu [QC#60078,MOD] -->
                <isEqual property="dsContrDtlStsCond" compareValue="Y">
                AND (
                </isEqual>

                    <isNotNull property="dsContrDtlStsCdSbmt">
<!--                AND DCD.DS_CONTR_DTL_STS_CD     = #dsContrDtlStsCdSbmt# -->
                    (
                            DCD.DS_CONTR_DTL_STS_CD     = #dsContrDtlStsCdSbmt#
                        AND DCD.QLTY_ASRN_HLD_FLG       = 'N'
                        AND DCD.MTR_HLD_FLG             = 'N'
                        AND DCD.CONTR_HLD_FLG           = 'N'
                        AND DCD.BLLG_HLD_FLG            = 'N'
                        AND SMM.SVC_MACH_MSTR_STS_CD    &lt;&gt; #w4i#
                    )
                    <isNotNull property="dsContrDtlStsOr1">
                    OR
                    </isNotNull>
                    </isNotNull>

                    <isNotNull property="dsContrDtlStsCdPdil">
                    (
                            DCD.DS_CONTR_DTL_STS_CD     = #dsContrDtlStsCdPdil#
                        AND DCD.QLTY_ASRN_HLD_FLG       = 'N'
                        AND DCD.MTR_HLD_FLG             = 'N'
                        AND DCD.CONTR_HLD_FLG           = 'N'
                        AND DCD.BLLG_HLD_FLG            = 'N'
                        AND SMM.SVC_MACH_MSTR_STS_CD    = #w4i#
                    )
                    <isNotNull property="dsContrDtlStsOr2">
                    OR
                    </isNotNull>
                    </isNotNull>

<!-- END 2019/02/21 [QC#30242,ADD] -->
<!-- START 2019/05/31 [QC#50350,ADD] -->

                    <isNotNull property="dsContrDtlStsCdActv">
<!--                AND DCD.DS_CONTR_DTL_STS_CD     = #dsContrDtlStsCdActv# -->
                    (
                            DCD.DS_CONTR_DTL_STS_CD     = #dsContrDtlStsCdActv#
                        AND DCD.QLTY_ASRN_HLD_FLG       = 'N'
                        AND DCD.MTR_HLD_FLG             = 'N'
                        AND DCD.CONTR_HLD_FLG           = 'N'
                        AND DCD.BLLG_HLD_FLG            = 'N'
                    )
                    <isNotNull property="dsContrDtlStsOr3">
                    OR
                    </isNotNull>
                    </isNotNull>

<!-- END 2019/05/31 [QC#50350,ADD] -->
<!-- START 2018/09/05 K.Kojima [QC#28061,ADD] -->

                    <isNotNull property="dsContrDtlStsCdAppo" compareValue="Y">
                    (
                            EXISTS (
                                SELECT
                                    1
                                FROM
                                    DS_CONTR_DTL_STS_V DCDS
                                WHERE
                                        DCD.GLBL_CMPY_CD          = DCDS.GLBL_CMPY_CD
                                    AND DCD.DS_CONTR_PK           = DCDS.DS_CONTR_PK
                                    AND DCD.DS_CONTR_DTL_PK       = DCDS.DS_CONTR_DTL_PK
                                    AND DCDS.DS_CONTR_CTRL_STS_CD = #dsContrDtlStsCdAppo#
                                    AND DCDS.EZCANCELFLAG         = '0'
                            )
                        AND (
                                (
                                        DC.DS_CONTR_CATG_CD &lt;&gt; #dsContrCatgCdFleet#
                                    AND EXISTS (
                                            SELECT
                                                1
                                            FROM
                                                 DS_CONTR_PRC_EFF       DCPE
                                                ,DS_CONTR_PRC_EFF_STS_V DCPESV
                                            WHERE
                                                    DCPE.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
                                                AND DCPE.DS_CONTR_DTL_PK        = DCD.DS_CONTR_DTL_PK
                                                AND DCPE.EZCANCELFLAG           = '0'
                                                AND DCPE.GLBL_CMPY_CD           = DCPESV.GLBL_CMPY_CD
                                                AND DCPE.DS_CONTR_PRC_EFF_PK    = DCPESV.DS_CONTR_PRC_EFF_PK
                                                AND DCPESV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdRenewalHoldForPO#
                                                AND DCPESV.EZCANCELFLAG         = '0'
                                    )
                                ) OR (
                                        DC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet#
                                    AND EXISTS (
                                            SELECT
                                                1
                                            FROM
                                                 DS_CONTR_DTL           DCDF
                                                ,DS_CONTR_PRC_EFF       DCPE
                                                ,DS_CONTR_PRC_EFF_STS_V DCPESV
                                            WHERE
                                                    DCDF.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
                                                AND DCDF.DS_CONTR_PK            = DCD.DS_CONTR_PK
                                                AND DCDF.DS_CONTR_DTL_TP_CD     = #dsContrDtlTpCdFleet#
                                                AND DCDF.EZCANCELFLAG           = '0'
                                                AND DCDF.GLBL_CMPY_CD           = DCPE.GLBL_CMPY_CD
                                                AND DCDF.DS_CONTR_DTL_PK        = DCPE.DS_CONTR_DTL_PK
                                                AND DCPE.EZCANCELFLAG           = '0'
                                                AND DCPE.GLBL_CMPY_CD           = DCPESV.GLBL_CMPY_CD
                                                AND DCPE.DS_CONTR_PRC_EFF_PK    = DCPESV.DS_CONTR_PRC_EFF_PK
                                                AND DCPESV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdRenewalHoldForPO#
                                                AND DCPESV.EZCANCELFLAG         = '0'
                                    )
                                )
                            )
                    )
                    <isNotNull property="dsContrDtlStsOr4">
                    OR
                    </isNotNull>
                    </isNotNull>
                    
                    <isNotNull property="dsContrDtlStsCdArhd" compareValue="Y">
                    (
                            EXISTS (
                                SELECT
                                    1
                                FROM
                                    DS_CONTR_DTL_STS_V DCDS
                                WHERE
                                        DCD.GLBL_CMPY_CD          = DCDS.GLBL_CMPY_CD
                                    AND DCD.DS_CONTR_PK           = DCDS.DS_CONTR_PK
                                    AND DCD.DS_CONTR_DTL_PK       = DCDS.DS_CONTR_DTL_PK
                                    AND DCDS.DS_CONTR_CTRL_STS_CD = #dsContrDtlStsCdArhd#
                                    AND DCDS.EZCANCELFLAG         = '0'
                            )
                        AND (
                                (
                                        DC.DS_CONTR_CATG_CD &lt;&gt; #dsContrCatgCdFleet#
                                    AND EXISTS (
                                            SELECT
                                                1
                                            FROM
                                                 DS_CONTR_PRC_EFF       DCPE
                                                ,DS_CONTR_PRC_EFF_STS_V DCPESV
                                            WHERE
                                                    DCPE.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
                                                AND DCPE.DS_CONTR_DTL_PK        = DCD.DS_CONTR_DTL_PK
                                                AND DCPE.EZCANCELFLAG           = '0'
                                                AND DCPE.GLBL_CMPY_CD           = DCPESV.GLBL_CMPY_CD
                                                AND DCPE.DS_CONTR_PRC_EFF_PK    = DCPESV.DS_CONTR_PRC_EFF_PK
                                                AND DCPESV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdRenewalHold#
                                                AND DCPESV.EZCANCELFLAG         = '0'
                                    )
                                ) OR (
                                        DC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet#
                                    AND EXISTS (
                                            SELECT
                                                1
                                            FROM
                                                 DS_CONTR_DTL           DCDF
                                                ,DS_CONTR_PRC_EFF       DCPE
                                                ,DS_CONTR_PRC_EFF_STS_V DCPESV
                                            WHERE
                                                    DCDF.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
                                                AND DCDF.DS_CONTR_PK            = DCD.DS_CONTR_PK
                                                AND DCDF.DS_CONTR_DTL_TP_CD     = #dsContrDtlTpCdFleet#
                                                AND DCDF.EZCANCELFLAG           = '0'
                                                AND DCDF.GLBL_CMPY_CD           = DCPE.GLBL_CMPY_CD
                                                AND DCDF.DS_CONTR_DTL_PK        = DCPE.DS_CONTR_DTL_PK
                                                AND DCPE.EZCANCELFLAG           = '0'
                                                AND DCPE.GLBL_CMPY_CD           = DCPESV.GLBL_CMPY_CD
                                                AND DCPE.DS_CONTR_PRC_EFF_PK    = DCPESV.DS_CONTR_PRC_EFF_PK
                                                AND DCPESV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdRenewalHold#
                                                AND DCPESV.EZCANCELFLAG         = '0'
                                    )
                                )
                            )
                    )
                    <isNotNull property="dsContrDtlStsOr5">
                    OR
                    </isNotNull>
                    </isNotNull>

                    <isNotNull property="dsContrDtlStsEtcCond">
<!--                    <isNotNull property="dsContrCtrlStsCd"> -->
<!--            AND EXISTS ( -->
                    (
                        EXISTS (
                            SELECT
                                1
                            FROM
                                DS_CONTR_DTL_STS_V DCDS
                            WHERE
                                    DCD.GLBL_CMPY_CD          = DCDS.GLBL_CMPY_CD
                                AND DCD.DS_CONTR_PK           = DCDS.DS_CONTR_PK
                                AND DCD.DS_CONTR_DTL_PK       = DCDS.DS_CONTR_DTL_PK
<!--                            AND DCDS.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCd# -->
                                AND (
                                        <isNotNull property="dsContrCtrlStsCdList">
                                        <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCdList[]" open="DCDS.DS_CONTR_CTRL_STS_CD IN (" close=")" conjunction=",">
                                        #dsContrCtrlStsCdList[]#
                                        </iterate>
                                        </isNotNull>

                                        <isNotNull property="dsContrDtlStsOr6">
                                        OR
                                        </isNotNull>

                                        <isNotNull property="dsContrCtrlStsNmList">
                                        <iterate property="dsContrCtrlStsNmList" var="dsContrCtrlStsNmList[]" open="DCDS.DS_CONTR_CTRL_STS_NM IN (" close=")" conjunction=",">
                                        #dsContrCtrlStsNmList[]#
                                        </iterate>
                                        </isNotNull>
                                    )
                                AND DCDS.EZCANCELFLAG         = '0'
                            )
                    )
                    </isNotNull>
<!--            <isNotNull property="dsContrCtrlStsCdList"> -->
<!--            AND EXISTS ( -->
<!--                SELECT -->
<!--                    1 -->
<!--                FROM -->
<!--                    DS_CONTR_DTL_STS_V DCDS -->
<!--                WHERE -->
<!--                        DCD.GLBL_CMPY_CD          = DCDS.GLBL_CMPY_CD -->
<!--                    AND DCD.DS_CONTR_PK           = DCDS.DS_CONTR_PK -->
<!--                    AND DCD.DS_CONTR_DTL_PK       = DCDS.DS_CONTR_DTL_PK -->
<!--                    <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCdList[]" open="AND DCDS.DS_CONTR_CTRL_STS_CD IN (" close=")" conjunction=","> -->
<!--                    #dsContrCtrlStsCdList[]# -->
<!--                    </iterate> -->
<!--                    AND DCDS.EZCANCELFLAG         = '0' -->
<!--            ) -->
<!--            </isNotNull> -->

                <isEqual property="dsContrDtlStsCond" compareValue="Y">
                )
                </isEqual>
<!-- END 2022/10/13 M.Komatsu [QC#60078,MOD] -->
<!-- END 2018/09/05 K.Kojima [QC#28061,ADD] -->
                AND DC.GLBL_CMPY_CD             = DCC.GLBL_CMPY_CD
                AND DC.DS_CONTR_CATG_CD         = DCC.DS_CONTR_CATG_CD
                AND DCC.EZCANCELFLAG            = '0'
                AND DC.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD (+)
                AND DC.DS_CONTR_PK              = DCD.DS_CONTR_PK (+)
                <!-- START 2018/02/19 K.Kojima [QC#22722-2,MOD] -->
                AND DCD.DS_CONTR_DTL_STS_CD (+) &lt;&gt; #dsContrDtlStsCdOrdr#
                <!-- END 2018/02/19 K.Kojima [QC#22722-2,MOD] -->
                <isEqual property="schdFlgNextBllgDt" compareValue="Y">
                AND EXISTS (
                        SELECT
                            1
                        FROM (
                            SELECT
                                 NDCBS.DS_CONTR_BLLG_SCHD_PK
                                <!-- START 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                                <!-- ,NDCD.DS_CONTR_PK -->
                                <!-- END 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                                <!-- START 2018/02/19 K.Kojima [QC#22722-2,MOD] -->
                                <!-- ,NDCD.DS_CONTR_DTL_PK -->
                                ,NDCBS.DS_CONTR_DTL_PK
                                <!-- END 2018/02/19 K.Kojima [QC#22722-2,MOD] -->
                                ,NDCBS.BLLG_SCHD_THRU_DT
                                <!-- START 2018/02/19 K.Kojima [QC#22722-2,MOD] -->
                                <!-- ,ROW_NUMBER() OVER(PARTITION BY NDCD.DS_CONTR_DTL_PK ORDER BY NDCBS.USG_CHRG_FLG DESC, NDCBS.BLLG_SCHD_THRU_DT) AS ROW_NUM -->
                                ,ROW_NUMBER() OVER(PARTITION BY NDCBS.DS_CONTR_DTL_PK ORDER BY NDCBS.USG_CHRG_FLG DESC, NDCBS.BLLG_SCHD_THRU_DT) AS ROW_NUM
                                <!-- END 2018/02/19 K.Kojima [QC#22722-2,MOD] -->
                            FROM
                                <!-- START 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                                <!--  DS_CONTR_DTL       NDCD -->
                                <!-- ,DS_CONTR_DTL_TP    NDCDT -->
                                <!-- ,DS_CONTR_BLLG_SCHD NDCBS -->
                                <!-- START 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                                <!-- START 2018/02/19 K.Kojima [QC#22722-2,ADD] -->
                                DS_CONTR_BLLG_SCHD NDCBS
                                <!-- START 2018/02/19 K.Kojima [QC#22722-2,ADD] -->
                            WHERE
                                <!-- START 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                                <!--     NDCD.GLBL_CMPY_CD               = DCD.GLBL_CMPY_CD -->
                                <!-- AND NDCD.DS_CONTR_DTL_PK            = DCD.DS_CONTR_DTL_PK -->
                                <!-- AND NDCD.DS_CONTR_DTL_STS_CD &lt;&gt; #dsContrDtlStsCdOrdr# -->
                                <!-- AND NDCD.EZCANCELFLAG               = '0' -->
                                <!-- AND NDCD.GLBL_CMPY_CD               = NDCDT.GLBL_CMPY_CD -->
                                <!-- AND NDCD.DS_CONTR_DTL_TP_CD         = NDCDT.DS_CONTR_DTL_TP_CD -->
                                <!-- AND NDCDT.SVC_PRC_FLG               = #flgOffN# -->
                                <!-- AND NDCDT.EZCANCELFLAG              = '0' -->
                                <!-- AND NDCD.GLBL_CMPY_CD               = NDCBS.GLBL_CMPY_CD -->
                                <!-- AND NDCD.DS_CONTR_DTL_PK            = NDCBS.DS_CONTR_DTL_PK -->
                                <!-- END 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                                <!-- START 2018/02/19 K.Kojima [QC#22722-2,ADD] -->
                                    DCD.GLBL_CMPY_CD               = NDCBS.GLBL_CMPY_CD
                                AND DCD.DS_CONTR_DTL_PK            = NDCBS.DS_CONTR_DTL_PK
                                <!-- END 2018/02/19 K.Kojima [QC#22722-2,ADD] -->
                                AND NDCBS.EZCANCELFLAG             = '0'
                                AND NDCBS.INV_FLG                  = 'N'
                                AND NDCBS.INV_TP_CD                = #invTpCd#
                                AND (NDCBS.BASE_CHRG_FLG = 'Y' AND NDCBS.DS_BLLG_SCHD_STS_CD = #dsBllgSchdStsOpen#
                                 OR (NDCBS.USG_CHRG_FLG  = 'Y' AND NDCBS.MTR_ENTRY_CPLT_FLG = 'N'))
                            )
                        WHERE
                                ROW_NUM = 1
                            <isNotNull property="xxFromDt">
                            AND BLLG_SCHD_THRU_DT &gt;= #xxFromDt#
                            </isNotNull>
                            <isNotNull property="xxThruDt">
                            AND BLLG_SCHD_THRU_DT &lt;= #xxThruDt#
                            </isNotNull>
                )
                <!-- START 2022/03/24 K.Kitachi [QC#59684, ADD] -->
                AND (DCD.MAN_TRMN_TP_CD IS NULL OR DCD.MAN_TRMN_TP_CD &lt;&gt; #manTrmnTpCd#)
                <!-- END 2022/03/24 K.Kitachi [QC#59684, ADD] -->
                </isEqual>
                <isEqual property="dateType" compareValue="3">
                <isNotNull property="xxFromDt">
                AND DCD.CONTR_EFF_FROM_DT       &gt;= #xxFromDt#
                AND NVL(DCD.CONTR_EFF_THRU_DT, #thruDtLimit#)       &gt;= #xxFromDt#
                </isNotNull>
                <isNotNull property="xxThruDt">
                AND DCD.CONTR_EFF_FROM_DT       &lt;= #xxThruDt#
                AND NVL(DCD.CONTR_EFF_THRU_DT, #thruDtLimit#)       &lt;= #xxThruDt#
                </isNotNull>
                </isEqual>
                <!-- START 2024/02/02 K.Watanabe [QC#63462, ADD] -->
                <isEqual property="dateType" compareValue="6">
                <isNotNull property="xxFromDt">
                AND NVL(DCD.CONTR_CLO_DT, NVL(DCD.CONTR_EFF_THRU_DT, #thruDtLimit#)) &gt;= #xxFromDt#
                </isNotNull>
                <isNotNull property="xxThruDt">
                AND NVL(DCD.CONTR_CLO_DT, NVL(DCD.CONTR_EFF_THRU_DT, #thruDtLimit#)) &lt;= #xxThruDt#
                </isNotNull>
                </isEqual>
                <!-- END 2024/02/02 K.Watanabe [QC#63462, ADD] -->
<!-- START 2022/10/13 M.Komatsu [QC#60078,MOD] -->
<!--            <isNotNull property="baseBllgCycleCd"> -->
<!--            AND DCD.BASE_BLLG_CYCLE_CD      = #baseBllgCycleCd# -->
                <isNotNull property="baseBllgCycleCdList">
                <iterate property="baseBllgCycleCdList" var="baseBllgCycleCdList[]" open="AND DCD.BASE_BLLG_CYCLE_CD IN (" close=")" conjunction=",">
                #baseBllgCycleCdList[]#
                </iterate>
                </isNotNull>
<!-- END 2022/10/13 M.Komatsu [QC#60078,MOD] -->
<!-- START 2022/10/13 M.Komatsu [QC#60078,MOD] -->
<!--            <isNotNull property="mtrBllgCycleCd"> -->
                <isNotNull property="mtrBllgCycleCdList">
<!-- END 2022/10/13 M.Komatsu [QC#60078,MOD] -->
                AND (
                    EXISTS (
                        SELECT
                            1
                        FROM 
                            DS_CONTR_BLLG_MTR DCBM
                        WHERE
                                DCD.GLBL_CMPY_CD                = DCBM.GLBL_CMPY_CD
                            AND DCD.DS_CONTR_DTL_PK             = DCBM.DS_CONTR_DTL_PK
<!-- START 2022/10/13 M.Komatsu [QC#60078,MOD] -->
<!--                        AND DCBM.BLLG_MTR_BLLG_CYCLE_CD     = #mtrBllgCycleCd# -->
                            <iterate property="mtrBllgCycleCdList" var="mtrBllgCycleCdList[]" open="AND DCBM.BLLG_MTR_BLLG_CYCLE_CD IN (" close=")" conjunction=",">
                            #mtrBllgCycleCdList[]#
                            </iterate>
<!-- END 2022/10/13 M.Komatsu [QC#60078,MOD] -->
                            AND DCBM.EZCANCELFLAG               = '0'
                    )
                )
                </isNotNull>
                AND (
                    DCD.DS_CONTR_DTL_TP_CD(+) IS NULL OR
                    <iterate property="dsContrDtlTpCdList" var="dsContrDtlTpCd[]" open="DCD.DS_CONTR_DTL_TP_CD(+) NOT IN (" close=")" conjunction=",">
                    #dsContrDtlTpCd[]#
                    </iterate>
                )
                AND DCD.EZCANCELFLAG (+)        = '0'
                <isEqual property="subContrFlg" compareValue="Y">
                AND EXISTS(
                        SELECT
                            1
                        FROM
                            DS_SUB_CONTR DSC
                        WHERE
                                DSC.GLBL_CMPY_CD    = DCD.GLBL_CMPY_CD
                            AND DSC.DS_CONTR_DTL_PK = DCD.DS_CONTR_DTL_PK
                            AND DSC.EZCANCELFLAG    = '0'
                       )
                </isEqual>
                <isEqual property="selectType" compareValue="5">
                <!-- mod start 2018/07/05 QC#21545 -->
                <!-- AND EXISTS( -->
                <!--        SELECT -->
                <!--            1 -->
                <!--        FROM -->
                <!--             DS_CONTR_DTL_STS_V DCDS -->
                <!--            ,DS_CONTR_PRC_EFF   DCPE -->
                <!--        WHERE -->
                <!--                DCDS.GLBL_CMPY_CD         = DCD.GLBL_CMPY_CD -->
                <!--            AND DCDS.DS_CONTR_DTL_PK      = DCD.DS_CONTR_DTL_PK -->
                <!--            <iterate property="dsContrDtlStsCdList" var="dsContrDtlStsCd[]" open="AND DCDS.DS_CONTR_CTRL_STS_CD IN (" close=")" conjunction=","> -->
                <!--            #dsContrDtlStsCd[]# -->
                <!--            </iterate> -->
                <!--            AND DCDS.EZCANCELFLAG         = '0' -->
                <!--            AND DCDS.GLBL_CMPY_CD         = DCPE.GLBL_CMPY_CD -->
                <!--            AND DCDS.DS_CONTR_DTL_PK      = DCPE.DS_CONTR_DTL_PK -->
                <!--            AND DCPE.CONTR_RNW_ERR_RSN_CD IS NOT NULL -->
                <!--            AND DCPE.EZCANCELFLAG         = '0' -->
                <!--       ) -->
                <!-- mod end 2018/07/05 QC#21545 -->
                <iterate property="contrDtlStsCdListForRnwHld" var="contrDtlStsCdForRnwHld[]" open="AND DCD.DS_CONTR_DTL_STS_CD IN (" close=")" conjunction=",">
                #contrDtlStsCdForRnwHld[]#
                </iterate>
                AND (
                    (
                            DC.DS_CONTR_CATG_CD &lt;&gt; #dsContrCatgCdFleet#
                        AND EXISTS (
                                SELECT
                                    1
                                FROM
                                     DS_CONTR_PRC_EFF       DCPE
                                    ,DS_CONTR_PRC_EFF_STS_V DCPESV
                                WHERE
                                        DCPE.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
                                    AND DCPE.DS_CONTR_DTL_PK        = DCD.DS_CONTR_DTL_PK
                                    AND DCPE.EZCANCELFLAG           = '0'
                                    AND DCPE.GLBL_CMPY_CD           = DCPESV.GLBL_CMPY_CD
                                    AND DCPE.DS_CONTR_PRC_EFF_PK    = DCPESV.DS_CONTR_PRC_EFF_PK
                                    AND DCPESV.DS_CONTR_CTRL_STS_CD IN (#dsContrCtrlStsCdRenewalHoldForPO#, #dsContrCtrlStsCdRenewalHold#)
                                    AND DCPESV.EZCANCELFLAG         = '0'
                            )
                    ) OR (
                            DC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet#
                        AND EXISTS (
                                SELECT
                                    1
                                FROM
                                     DS_CONTR_DTL           DCDF
                                    ,DS_CONTR_PRC_EFF       DCPE
                                    ,DS_CONTR_PRC_EFF_STS_V DCPESV
                                WHERE
                                        DCDF.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
                                    AND DCDF.DS_CONTR_PK            = DCD.DS_CONTR_PK
                                    AND DCDF.DS_CONTR_DTL_TP_CD     = #dsContrDtlTpCdFleet#
                                    AND DCDF.EZCANCELFLAG           = '0'
                                    AND DCDF.GLBL_CMPY_CD           = DCPE.GLBL_CMPY_CD
                                    AND DCDF.DS_CONTR_DTL_PK        = DCPE.DS_CONTR_DTL_PK
                                    AND DCPE.EZCANCELFLAG           = '0'
                                    AND DCPE.GLBL_CMPY_CD           = DCPESV.GLBL_CMPY_CD
                                    AND DCPE.DS_CONTR_PRC_EFF_PK    = DCPESV.DS_CONTR_PRC_EFF_PK
                                    AND DCPESV.DS_CONTR_CTRL_STS_CD IN (#dsContrCtrlStsCdRenewalHoldForPO#, #dsContrCtrlStsCdRenewalHold#)
                                    AND DCPESV.EZCANCELFLAG         = '0'
                            )
                    )
                )
                </isEqual>
                <isEqual property="onlyMyTaskFlg" compareValue="Y">
                AND DC.DS_CONTR_CRAT_PSN_CD    = #userId#
                <!-- START 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                <!-- AND EXISTS( -->
                <!--         SELECT -->
                <!--             1 -->
                <!--         FROM -->
                <!--              DS_CONTR_DTL_STS_V DCDS -->
                <!--             ,DS_CONTR_PRC_EFF   DCPE -->
                <!--         WHERE -->
                <!--                 DCDS.GLBL_CMPY_CD         = DCD.GLBL_CMPY_CD -->
                <!--             AND DCDS.DS_CONTR_DTL_PK      = DCD.DS_CONTR_DTL_PK -->
                <!--             <iterate property="dsContrDtlStsCdList" var="dsContrDtlStsCd[]" open="AND DCDS.DS_CONTR_CTRL_STS_CD IN (" close=")" conjunction=","> -->
                <!--             #dsContrDtlStsCd[]# -->
                <!--             </iterate> -->
                <!--             AND DCDS.EZCANCELFLAG         = '0' -->
                <!--             AND DCDS.GLBL_CMPY_CD         = DCPE.GLBL_CMPY_CD -->
                <!--             AND DCDS.DS_CONTR_DTL_PK      = DCPE.DS_CONTR_DTL_PK -->
                <!--             AND DCPE.CONTR_RNW_ERR_RSN_CD IS NOT NULL -->
                <!--             AND DCPE.EZCANCELFLAG         = '0' -->
                <!--        ) -->
                <!-- END 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                </isEqual>
<!-- START 2018/02/06 M.Kidokoro [QC#23375,ADD] -->
                <isEqual property="myTeamFlg" compareValue="Y">
                AND DC.SVC_CONTR_BR_CD IN (
                    SELECT
                        SBRR.SVC_CONTR_BR_CD
                    FROM
                        SVC_BR_RESRC_RELN SBRR
                    WHERE
                            SBRR.GLBL_CMPY_CD             = DC.GLBL_CMPY_CD
                        AND SBRR.PSN_CD                   = #userId#
                        AND SBRR.EZCANCELFLAG             = '0'
                )
                </isEqual>
<!-- END 2018/02/06 M.Kidokoro [QC#23375,ADD] -->
                AND DC.GLBL_CMPY_CD             = SR.GLBL_CMPY_CD
                AND DC.SVC_LINE_BIZ_CD          = SR.SVC_LINE_BIZ_CD
                AND DC.SVC_CONTR_BR_CD          = SR.SVC_CONTR_BR_CD
                AND DC.GLBL_CMPY_CD             = DAC.GLBL_CMPY_CD
                AND DC.DS_ACCT_NUM              = DAC.SELL_TO_CUST_CD
                <isNotNull property="dsAcctNum">
                AND DAC.SELL_TO_CUST_CD             LIKE #dsAcctNum#
                </isNotNull>
                <isNotNull property="dsAcctNm">
                AND DAC.DS_ACCT_NM              LIKE #dsAcctNm#
                </isNotNull>
                AND DAC.EZCANCELFLAG            = '0'
                <isNotNull property="billToCustCd">
                AND (
                        DC.ALT_PAYER_CUST_CD        LIKE #billToCustCd#
                    OR  DCD.BASE_BILL_TO_CUST_CD    LIKE #billToCustCd#
                    OR  EXISTS (
                        SELECT
                            1
                        FROM 
                            DS_CONTR_BLLG_MTR DCBM
                        WHERE
                                DCD.GLBL_CMPY_CD                = DCBM.GLBL_CMPY_CD
                            AND DCD.DS_CONTR_DTL_PK             = DCBM.DS_CONTR_DTL_PK
                            AND DCBM.BLLG_MTR_BILL_TO_CUST_CD   LIKE #billToCustCd#
                            AND DCBM.EZCANCELFLAG               = '0'
                    )
                )
                </isNotNull>
                <isNotNull property="billToLocNm">
                AND (
                    EXISTS (
                        SELECT
                            1
                        FROM
                            BILL_TO_CUST BC
                        WHERE
                                DC.GLBL_CMPY_CD         = BC.GLBL_CMPY_CD
                            AND DC.ALT_PAYER_CUST_CD    = BC.BILL_TO_CUST_CD
                            AND BC.EZCANCELFLAG         = '0'
                            AND (
                                DECODE(BC.FIRST_LINE_ADDR, null, '', BC.FIRST_LINE_ADDR)
                             || DECODE(BC.SCD_LINE_ADDR,   null, '', ' ' || BC.SCD_LINE_ADDR)
                             || DECODE(BC.THIRD_LINE_ADDR, null, '', ' ' || BC.THIRD_LINE_ADDR)
                             || DECODE(BC.FRTH_LINE_ADDR,  null, '', ' ' || BC.FRTH_LINE_ADDR)
                             || DECODE(BC.CTY_ADDR,        null, '', ' ' || BC.CTY_ADDR)
                             || DECODE(BC.ST_CD,           null, '', ' ' || BC.ST_CD)
                             || DECODE(BC.POST_CD,         null, '', ' ' || BC.POST_CD)
                            ) LIKE #billToLocNm#
                    )
                    OR EXISTS (
                        SELECT
                            1
                        FROM
                            BILL_TO_CUST BC
                        WHERE
                                DCD.GLBL_CMPY_CD            = BC.GLBL_CMPY_CD
                            AND DCD.BASE_BILL_TO_CUST_CD    = BC.BILL_TO_CUST_CD
                            AND BC.EZCANCELFLAG             = '0'
                            AND (
                                DECODE(BC.FIRST_LINE_ADDR, null, '', BC.FIRST_LINE_ADDR)
                             || DECODE(BC.SCD_LINE_ADDR,   null, '', ' ' || BC.SCD_LINE_ADDR)
                             || DECODE(BC.THIRD_LINE_ADDR, null, '', ' ' || BC.THIRD_LINE_ADDR)
                             || DECODE(BC.FRTH_LINE_ADDR,  null, '', ' ' || BC.FRTH_LINE_ADDR)
                             || DECODE(BC.CTY_ADDR,        null, '', ' ' || BC.CTY_ADDR)
                             || DECODE(BC.ST_CD,           null, '', ' ' || BC.ST_CD)
                             || DECODE(BC.POST_CD,         null, '', ' ' || BC.POST_CD)
                            ) LIKE #billToLocNm#
                    )
                    OR EXISTS (
                        SELECT
                            1
                        FROM
                             DS_CONTR_BLLG_MTR DCBM
                            ,BILL_TO_CUST BC
                        WHERE
                                DCD.GLBL_CMPY_CD                = DCBM.GLBL_CMPY_CD
                            AND DCD.DS_CONTR_DTL_PK             = DCBM.DS_CONTR_DTL_PK
                            AND DCBM.EZCANCELFLAG               = '0'
                            AND DCBM.GLBL_CMPY_CD               = BC.GLBL_CMPY_CD
                            AND DCBM.BLLG_MTR_BILL_TO_CUST_CD   = BC.BILL_TO_CUST_CD
                            AND BC.EZCANCELFLAG                 = '0'
                            AND (
                                DECODE(BC.FIRST_LINE_ADDR, null, '', BC.FIRST_LINE_ADDR)
                             || DECODE(BC.SCD_LINE_ADDR,   null, '', ' ' || BC.SCD_LINE_ADDR)
                             || DECODE(BC.THIRD_LINE_ADDR, null, '', ' ' || BC.THIRD_LINE_ADDR)
                             || DECODE(BC.FRTH_LINE_ADDR,  null, '', ' ' || BC.FRTH_LINE_ADDR)
                             || DECODE(BC.CTY_ADDR,        null, '', ' ' || BC.CTY_ADDR)
                             || DECODE(BC.ST_CD,           null, '', ' ' || BC.ST_CD)
                             || DECODE(BC.POST_CD,         null, '', ' ' || BC.POST_CD)
                            ) LIKE #billToLocNm#
                    )
                )
                </isNotNull>
                AND DCD.GLBL_CMPY_CD            = SMM.GLBL_CMPY_CD (+)
                AND DCD.SVC_MACH_MSTR_PK        = SMM.SVC_MACH_MSTR_PK (+)
                <isNotNull property="svcConfigMstrPk">
                AND DCD.SVC_CONFIG_MSTR_PK      = #svcConfigMstrPk#
                </isNotNull>
                <isNotNull property="serNum">
<!-- START 2024/02/28 K.Watanabe [QC#63541,MOD] -->
<!--            AND SMM.SER_NUM                 LIKE #serNum# -->
                AND (
                        SMM.SER_NUM             LIKE #serNum#
                    OR  SMM.CUST_MACH_CTRL_NUM  LIKE #serNum#
                )
<!-- END 2024/02/28 K.Watanabe [QC#63541,MOD] -->
                </isNotNull>
<!-- START 2022/10/13 M.Komatsu [QC#60078,MOD] -->
<!--            <isNotNull property="svcMachMstrStsCd"> -->
<!--            AND SMM.SVC_MACH_MSTR_STS_CD    = #svcMachMstrStsCd# -->
                <isNotNull property="svcMachMstrStsCdList">
                <iterate property="svcMachMstrStsCdList" var="svcMachMstrStsCdList[]" open="AND SMM.SVC_MACH_MSTR_STS_CD IN (" close=")" conjunction=",">
                #svcMachMstrStsCdList[]#
                </iterate>
                </isNotNull>
<!-- END 2022/10/13 M.Komatsu [QC#60078,MOD] -->
                <isEqual property="selectType" compareValue="2">
                AND SMM.SVC_MACH_MSTR_STS_CD    = #svcMachMstrStsCdIsRMV#
                </isEqual>
                <isNotNull property="curLocNum">
                <!-- START 2019/01/26 [QC#30078,MOD] -->
                AND SMM.GLBL_CMPY_CD            = DAC1.GLBL_CMPY_CD
                AND SMM.CUR_LOC_ACCT_NUM        = DAC1.SELL_TO_CUST_CD
                AND DAC1.DS_ACCT_NM              LIKE #curLocNum#
                AND DAC1.EZCANCELFLAG           = '0'
                <!-- END   2019/01/26 [QC#30078,MOD] -->
                </isNotNull>
                <isEqual property="dateType" compareValue="4">
                <isNotNull property="xxFromDt">
                AND SMM.SVC_MACH_RMV_DT         &gt;= #xxFromDt#
                </isNotNull>
                <isNotNull property="xxThruDt">
                AND SMM.SVC_MACH_RMV_DT         &lt;= #xxThruDt#
                </isNotNull>
                </isEqual>
                AND SMM.EZCANCELFLAG (+)        = '0'
                AND SMM.GLBL_CMPY_CD            = SMMS.GLBL_CMPY_CD (+)
                AND SMM.SVC_MACH_MSTR_STS_CD    = SMMS.SVC_MACH_MSTR_STS_CD (+)
                AND SMMS.EZCANCELFLAG (+)       = '0'
                AND SMM.GLBL_CMPY_CD            = SCM.GLBL_CMPY_CD (+)
                AND SMM.SVC_CONFIG_MSTR_PK      = SCM.SVC_CONFIG_MSTR_PK (+)
                AND SCM.EZCANCELFLAG (+)        = '0'
                <!-- START 2018/06/15 K.Kim [QC#26255,DEL] -->
                <!-- <isEqual property="selectType" compareValue="4"> -->
                <!-- AND SMM.SVC_CONFIG_MSTR_PK      IS NULL -->
                <!-- </isEqual> -->
                <!-- END 2018/06/15 K.Kim [QC#26255,DEL] -->
                AND SCM.GLBL_CMPY_CD            = MN.T_GLBL_CMPY_CD (+)
                AND SCM.MDL_ID                  = MN.T_MDL_ID (+)
<!-- START 2022/10/13 M.Komatsu [QC#60537,ADD] -->
                <isNotNull property="mdseCd">
                AND SMM.MDSE_CD                 LIKE #mdseCd#
                </isNotNull>
<!-- END 2022/10/13 M.Komatsu [QC#60537,ADD] -->
                <isNotNull property="tMdlNm">
                AND MN.T_MDL_NM                 LIKE #tMdlNm#
                </isNotNull>
                AND MN.EZCANCELFLAG (+)         = '0'
                AND SMM.GLBL_CMPY_CD            = STC.GLBL_CMPY_CD (+)
                AND SMM.CUR_LOC_NUM             = STC.SHIP_TO_CUST_CD (+)
                <isNotNull property="locNum">
                <!-- START 2018/11/15 S.Kitamura [QC#29215,MOD] -->
                <!-- AND STC.LOC_NUM                 LIKE #locNum# -->
                AND STC.SHIP_TO_CUST_CD          LIKE #locNum#
                <!-- END 2018/11/15 S.Kitamura [QC#29215,MOD] -->
                </isNotNull>
                <isNotNull property="locNm">
                AND 
                (DECODE(STC.FIRST_LINE_ADDR,   null, '', STC.FIRST_LINE_ADDR)
                || DECODE(STC.SCD_LINE_ADDR,   null, '', ' ' || STC.SCD_LINE_ADDR)
                || DECODE(STC.THIRD_LINE_ADDR, null, '', ' ' || STC.THIRD_LINE_ADDR)
                || DECODE(STC.FRTH_LINE_ADDR,  null, '', ' ' || STC.FRTH_LINE_ADDR)
                || DECODE(STC.CTY_ADDR,        null, '', ' ' || STC.CTY_ADDR)
                || DECODE(STC.ST_CD,           null, '', ' ' || STC.ST_CD)
                || DECODE(STC.POST_CD,         null, '', ' ' || STC.POST_CD)
                ) LIKE #locNm#
                </isNotNull>
                AND STC.EZCANCELFLAG (+)        = '0'
                <isEqual property="selectType" compareValue="1">
                <!-- START 2018/02/19 K.Kojima [QC#22722-2,ADD] -->
                AND EXISTS(
                        SELECT
                            1
                        FROM
                             SVC_PHYS_MTR  SPM
                        WHERE
                                SPM.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
                            AND SPM.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                            AND SPM.EZCANCELFLAG     = '0'
                       )
                <!-- END 2018/02/19 K.Kojima [QC#22722-2,ADD] -->
                AND NOT EXISTS(
                        SELECT
                            1
                        FROM
                             SVC_PHYS_MTR_READ  SPMR
                        WHERE
                                SPMR.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
                            AND SPMR.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                            AND SPMR.DS_CONTR_DTL_PK  = DCD.DS_CONTR_DTL_PK
                            AND SPMR.EZCANCELFLAG     = '0'
                       )
                <!-- START 2019/07/31 S.Kitamura [QC#52131,ADD] -->
                AND DT.USG_CHRG_FLG = 'Y'
                <!-- END 2019/07/31 S.Kitamura [QC#52131,ADD] -->
                </isEqual>
                <iterate property="mtrReadMethCdList" var="mtrReadMethCd[]" open="AND DCD.MTR_READ_METH_CD IN (" close=")" conjunction=",">
                #mtrReadMethCd[]#
                </iterate>
                <isEqual property="mtrLbFlg" compareValue="Y">
                AND EXISTS(
                        SELECT
                            1
                        FROM
                             DS_CONTR_BLLG_MTR  DCBM
                        WHERE
                                DCBM.GLBL_CMPY_CD     = DCD.GLBL_CMPY_CD
                            AND DCBM.DS_CONTR_DTL_PK  = DCD.DS_CONTR_DTL_PK
                            <iterate property="mtrLbCdList" var="mtrLbCd[]" open="AND DCBM.BLLG_MTR_LB_CD IN (" close=")" conjunction=",">
                            #mtrLbCd[]#
                            </iterate>
                            AND DCBM.EZCANCELFLAG     = '0'
                       )
                </isEqual>
                <isEqual property="schdFlg" compareValue="Y">
                AND EXISTS(
                        SELECT
                            1
                        <!-- START 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                        <!-- FROM ( -->
                        <!--     SELECT -->
                        <!--          DCBS2.NEXT_BLLG_DT -->
                        <!--         ,ROW_NUMBER() OVER(ORDER BY DCBS2.NEXT_BLLG_DT) AS ROW_NUM -->
                        <!-- END 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                            FROM
                                DS_CONTR_BLLG_SCHD DCBS2
                            WHERE
                                    DCD.GLBL_CMPY_CD            = DCBS2.GLBL_CMPY_CD
                                AND DCD.DS_CONTR_DTL_PK         = DCBS2.DS_CONTR_DTL_PK
                                AND DCBS2.EZCANCELFLAG          = '0'
                                <!-- START 2018/02/19 K.Kojima [QC#22722-2,ADD] -->
                                <isEqual property="baseChrgToLeaseCmpyFlg_H" compareValue="Y">
                                AND DCBS2.NEXT_BLLG_DT           &lt;= #slsDt#
                                </isEqual>
                                <isEqual property="usgChrgToLeaseCmpyFlg_H" compareValue="Y">
                                AND DCBS2.NEXT_BLLG_DT           &lt;= #slsDt#
                                </isEqual>
                                <!-- END 2018/02/19 K.Kojima [QC#22722-2,ADD] -->
                                <isEqual property="dateType" compareValue="2">
                                <isNotNull property="xxFromDt">
                                AND DCBS2.NEXT_BLLG_DT           &gt;= #xxFromDt#
                                </isNotNull>
                                <isNotNull property="xxThruDt">
                                AND DCBS2.NEXT_BLLG_DT           &lt;= #xxThruDt#
                                </isNotNull>
                                </isEqual>
                                <isEqual property="baseChrgToLeaseCmpyFlg_H" compareValue="Y">
                                <isEqual property="usgChrgToLeaseCmpyFlg_H" compareValue="Y">
                                AND (
                                        (
                                             DCBS2.BASE_CHRG_FLG          = 'Y'
                                         AND DCBS2.INV_FLG                = 'N'
                                        )
                                        OR
                                       (
                                             DCBS2.USG_CHRG_FLG           = 'Y'
                                         AND DCBS2.INV_FLG                = 'N'
                                       )
                                     )
                                </isEqual>
                                </isEqual>
                                <isEqual property="baseChrgToLeaseCmpyFlg_H" compareValue="Y">
                                <isNotEqual property="usgChrgToLeaseCmpyFlg_H" compareValue="Y">
                                AND DCBS2.BASE_CHRG_FLG          = 'Y'
                                AND DCBS2.INV_FLG                = 'N'
                                </isNotEqual>
                                </isEqual>
                                <isNotEqual property="baseChrgToLeaseCmpyFlg_H" compareValue="Y">
                                <isEqual property="usgChrgToLeaseCmpyFlg_H" compareValue="Y">
                                AND DCBS2.USG_CHRG_FLG           = 'Y'
                                AND DCBS2.INV_FLG                = 'N'
                                </isEqual>
                                </isNotEqual>
                        <!-- START 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                        <!--     ) A -->
                        <!-- WHERE -->
                        <!--         ROW_NUM = 1 -->
                        <!--     <isEqual property="baseChrgToLeaseCmpyFlg_H" compareValue="Y"> -->
                        <!--     AND A.NEXT_BLLG_DT           &lt;= #slsDt# -->
                        <!--     </isEqual> -->
                        <!--     <isEqual property="usgChrgToLeaseCmpyFlg_H" compareValue="Y"> -->
                        <!--     AND A.NEXT_BLLG_DT           &lt;= #slsDt# -->
                        <!--     </isEqual> -->
                        <!-- END 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                    )
                </isEqual>
                <!-- START 2022/03/24 K.Kitachi [QC#59684, ADD] -->
                <isEqual property="usgChrgToLeaseCmpyFlg_H" compareValue="Y">
                AND (DCD.MAN_TRMN_TP_CD IS NULL OR DCD.MAN_TRMN_TP_CD &lt;&gt; #manTrmnTpCd#)
                </isEqual>
                <!-- END 2022/03/24 K.Kitachi [QC#59684, ADD] -->
                AND DCD.GLBL_CMPY_CD            = PDCD.GLBL_CMPY_CD (+)
                AND DCD.PRNT_DS_CONTR_DTL_PK    = PDCD.DS_CONTR_DTL_PK (+)
                <!-- START 2018/02/19 K.Kojima [QC#22722-2,MOD] -->
                AND PDCD.DS_CONTR_DTL_STS_CD (+) &lt;&gt; #dsContrDtlStsCdOrdr# 
                <!-- END 2018/02/19 K.Kojima [QC#22722-2,MOD] -->
                AND PDCD.EZCANCELFLAG (+)       = '0'
                AND PDCD.GLBL_CMPY_CD           = PSMM.GLBL_CMPY_CD (+)
                AND PDCD.SVC_MACH_MSTR_PK       = PSMM.SVC_MACH_MSTR_PK (+)
                AND PSMM.EZCANCELFLAG (+)       = '0'
                AND DCD.GLBL_CMPY_CD            = DT.GLBL_CMPY_CD (+)
                AND DCD.DS_CONTR_DTL_TP_CD      = DT.DS_CONTR_DTL_TP_CD (+)
                AND DT.EZCANCELFLAG (+)         = '0'
<!-- START 2022/10/13 M.Komatsu [QC#60078,DEL] -->
<!--            <isNotNull property="pdilFlg"> -->
<!--            <isEqual property="pdilFlg" compareValue="Y"> -->
<!--            AND SMM.SVC_MACH_MSTR_STS_CD    = #w4i# -->
<!--            </isEqual> -->
<!--            <isEqual property="pdilFlg" compareValue="N"> -->
<!--            AND SMM.SVC_MACH_MSTR_STS_CD    &lt;&gt; #w4i# -->
<!--            </isEqual> -->
<!--            <isEqual property="activePendingPOSearchFlg" compareValue="Y"> -->
<!--            AND ( -->
<!--                ( -->
<!--                        DC.DS_CONTR_CATG_CD &lt;&gt; #dsContrCatgCdFleet# -->
<!--                    AND EXISTS ( -->
<!--                            SELECT -->
<!--                                1 -->
<!--                            FROM -->
<!--                                 DS_CONTR_PRC_EFF       DCPE -->
<!--                                ,DS_CONTR_PRC_EFF_STS_V DCPESV -->
<!--                            WHERE -->
<!--                                    DCPE.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD -->
<!--                                AND DCPE.DS_CONTR_DTL_PK        = DCD.DS_CONTR_DTL_PK -->
<!--                                AND DCPE.EZCANCELFLAG           = '0' -->
<!--                                AND DCPE.GLBL_CMPY_CD           = DCPESV.GLBL_CMPY_CD -->
<!--                                AND DCPE.DS_CONTR_PRC_EFF_PK    = DCPESV.DS_CONTR_PRC_EFF_PK -->
<!--                                AND DCPESV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdRenewalHoldForPO# -->
<!--                                AND DCPESV.EZCANCELFLAG         = '0' -->
<!--                        ) -->
<!--                ) OR ( -->
<!--                        DC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# -->
<!--                    AND EXISTS ( -->
<!--                            SELECT -->
<!--                                1 -->
<!--                            FROM -->
<!--                                 DS_CONTR_DTL           DCDF -->
<!--                                ,DS_CONTR_PRC_EFF       DCPE -->
<!--                                ,DS_CONTR_PRC_EFF_STS_V DCPESV -->
<!--                            WHERE -->
<!--                                    DCDF.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD -->
<!--                                AND DCDF.DS_CONTR_PK            = DCD.DS_CONTR_PK -->
<!--                                AND DCDF.DS_CONTR_DTL_TP_CD     = #dsContrDtlTpCdFleet# -->
<!--                                AND DCDF.EZCANCELFLAG           = '0' -->
<!--                                AND DCDF.GLBL_CMPY_CD           = DCPE.GLBL_CMPY_CD -->
<!--                                AND DCDF.DS_CONTR_DTL_PK        = DCPE.DS_CONTR_DTL_PK -->
<!--                                AND DCPE.EZCANCELFLAG           = '0' -->
<!--                                AND DCPE.GLBL_CMPY_CD           = DCPESV.GLBL_CMPY_CD -->
<!--                                AND DCPE.DS_CONTR_PRC_EFF_PK    = DCPESV.DS_CONTR_PRC_EFF_PK -->
<!--                                AND DCPESV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdRenewalHoldForPO# -->
<!--                                AND DCPESV.EZCANCELFLAG         = '0' -->
<!--                        ) -->
<!--                ) -->
<!--            ) -->
<!--            </isEqual> -->
<!--            <isEqual property="activeRenewalHoldSearchFlg" compareValue="Y"> -->
<!--            AND ( -->
<!--                ( -->
<!--                        DC.DS_CONTR_CATG_CD &lt;&gt; #dsContrCatgCdFleet# -->
<!--                    AND EXISTS ( -->
<!--                            SELECT -->
<!--                                1 -->
<!--                            FROM -->
<!--                                 DS_CONTR_PRC_EFF       DCPE -->
<!--                                ,DS_CONTR_PRC_EFF_STS_V DCPESV -->
<!--                            WHERE -->
<!--                                    DCPE.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD -->
<!--                                AND DCPE.DS_CONTR_DTL_PK        = DCD.DS_CONTR_DTL_PK -->
<!--                                AND DCPE.EZCANCELFLAG           = '0' -->
<!--                                AND DCPE.GLBL_CMPY_CD           = DCPESV.GLBL_CMPY_CD -->
<!--                                AND DCPE.DS_CONTR_PRC_EFF_PK    = DCPESV.DS_CONTR_PRC_EFF_PK -->
<!--                                AND DCPESV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdRenewalHold# -->
<!--                                AND DCPESV.EZCANCELFLAG         = '0' -->
<!--                        ) -->
<!--                ) OR ( -->
<!--                        DC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# -->
<!--                    AND EXISTS ( -->
<!--                            SELECT -->
<!--                                1 -->
<!--                            FROM -->
<!--                                 DS_CONTR_DTL           DCDF -->
<!--                                ,DS_CONTR_PRC_EFF       DCPE -->
<!--                                ,DS_CONTR_PRC_EFF_STS_V DCPESV -->
<!--                            WHERE -->
<!--                                    DCDF.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD -->
<!--                                AND DCDF.DS_CONTR_PK            = DCD.DS_CONTR_PK -->
<!--                                AND DCDF.DS_CONTR_DTL_TP_CD     = #dsContrDtlTpCdFleet# -->
<!--                                AND DCDF.EZCANCELFLAG           = '0' -->
<!--                                AND DCDF.GLBL_CMPY_CD           = DCPE.GLBL_CMPY_CD -->
<!--                                AND DCDF.DS_CONTR_DTL_PK        = DCPE.DS_CONTR_DTL_PK -->
<!--                                AND DCPE.EZCANCELFLAG           = '0' -->
<!--                                AND DCPE.GLBL_CMPY_CD           = DCPESV.GLBL_CMPY_CD -->
<!--                                AND DCPE.DS_CONTR_PRC_EFF_PK    = DCPESV.DS_CONTR_PRC_EFF_PK -->
<!--                                AND DCPESV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdRenewalHold# -->
<!--                                AND DCPESV.EZCANCELFLAG         = '0' -->
<!--                        ) -->
<!--                ) -->
<!--            ) -->
<!--            </isEqual> -->
<!-- END 2022/10/13 M.Komatsu [QC#60078,DEL] -->
                AND DC.GLBL_CMPY_CD             = DCCD.GLBL_CMPY_CD (+)
                AND DC.DS_CONTR_CLS_CD          = DCCD.DS_CONTR_CLS_CD (+)
                AND DCCD.EZCANCELFLAG (+)       = '0'
                AND SMM.GLBL_CMPY_CD            = MDS.GLBL_CMPY_CD (+)
                AND SMM.MDSE_CD                 = MDS.MDSE_CD (+)
                AND MDS.EZCANCELFLAG (+)        = '0'
                AND DC.GLBL_CMPY_CD             = BPN.GLBL_CMPY_CD (+)
                AND DC.CONTR_ADMIN_PSN_CD       = BPN.PSN_CD (+)
                AND BPN.EZCANCELFLAG (+)        = '0'
                AND DC.GLBL_CMPY_CD             = ORG.GLBL_CMPY_CD (+)
                AND DC.TOC_CD                   = ORG.TOC_CD (+)
                AND ORG.EZCANCELFLAG (+)        = '0'
                AND DC.GLBL_CMPY_CD             = MET.GLBL_CMPY_CD (+)
                AND DC.MTR_EST_TP_CD            = MET.MTR_EST_TP_CD (+)
                AND MET.EZCANCELFLAG (+)        = '0'
                AND DC.GLBL_CMPY_CD             = BTC.GLBL_CMPY_CD (+)
                AND DC.ALT_PAYER_CUST_CD        = BTC.BILL_TO_CUST_CD (+)
                AND BTC.EZCANCELFLAG (+)        = '0'
                AND SMM.GLBL_CMPY_CD            = SMT.GLBL_CMPY_CD (+)
                AND SMM.SVC_MACH_TP_CD          = SMT.SVC_MACH_TP_CD (+)
                AND SMT.EZCANCELFLAG (+)        = '0'
                AND DCD.GLBL_CMPY_CD            = MRM.GLBL_CMPY_CD (+)
                AND DCD.MTR_READ_METH_CD        = MRM.MTR_READ_METH_CD (+)
                AND MRM.EZCANCELFLAG (+)        = '0'
                AND DCD.GLBL_CMPY_CD            = SMD.GLBL_CMPY_CD (+)
                AND DCD.SVC_PGM_MDSE_CD         = SMD.MDSE_CD (+)
                AND SMD.EZCANCELFLAG (+)        = '0'
                AND DC.GLBL_CMPY_CD             = CRG.GLBL_CMPY_CD (+)
                AND DC.DS_CONTR_RPT_GRP_NUM     = CRG.DS_CONTR_RPT_GRP_NUM (+)
                AND CRG.EZCANCELFLAG (+)        = '0'
                AND DC.GLBL_CMPY_CD             = BTC2.GLBL_CMPY_CD (+)
                AND DC.LEASE_CMPY_CD            = BTC2.BILL_TO_CUST_CD (+)
                AND BTC2.EZCANCELFLAG (+)       = '0'
                AND SMM.GLBL_CMPY_CD            = SHIP.GLBL_CMPY_CD (+)
                AND SMM.CUR_LOC_NUM             = SHIP.SHIP_TO_CUST_CD (+)
                AND SHIP.EZCANCELFLAG (+)       = '0'
                AND DCD.GLBL_CMPY_CD              = BTB.GLBL_CMPY_CD(+)
                AND DCD.BASE_BILL_TO_CUST_CD      = BTB.BILL_TO_CUST_CD(+)
                AND BTB.EZCANCELFLAG (+)          = '0'
                AND DC.GLBL_CMPY_CD               = PMT.GLBL_CMPY_CD (+)
                AND DC.PMT_TERM_CASH_DISC_CD      = PMT.PMT_TERM_CASH_DISC_CD (+)
                AND PMT.EZCANCELFLAG (+)          = '0'
                AND DCD.GLBL_CMPY_CD              = BSN.GLBL_CMPY_CD (+)
                AND DCD.CTAC_PSN_PK               = BSN.CTAC_PSN_PK (+)
                AND BSN.EZCANCELFLAG (+)          = '0'
<!-- START 2018/09/05 K.Kojima [QC#28061,DEL] -->
<!--            AND DC.GLBL_CMPY_CD               = DCSV.GLBL_CMPY_CD -->
<!--            AND DC.DS_CONTR_PK                = DCSV.DS_CONTR_PK -->
<!--            AND DCSV.EZCANCELFLAG             = '0' -->
<!-- END 2018/09/05 K.Kojima [QC#28061,DEL] -->
                AND DCD.GLBL_CMPY_CD              = TMG.GLBL_CMPY_CD(+)
                AND DCD.BASE_BLLG_TMG_CD          = TMG.BLLG_TMG_TP_CD(+)
                AND TMG.EZCANCELFLAG(+)           = '0'
                AND DCD.GLBL_CMPY_CD              = CYCLE.GLBL_CMPY_CD(+)
                AND DCD.BASE_BLLG_CYCLE_CD        = CYCLE.BLLG_CYCLE_CD(+)
                AND CYCLE.EZCANCELFLAG(+)         = '0'
                AND DC.GLBL_CMPY_CD               = FLT_AGG_L.GLBL_CMPY_CD(+)
                AND DC.DS_CONTR_PK                = FLT_AGG_L.DS_CONTR_PK(+)
                <iterate property="dsContrDtlTpCdList" var="dsContrDtlTpCd[]" open="AND FLT_AGG_L.DS_CONTR_DTL_TP_CD(+) IN (" close=")" conjunction=",">
                #dsContrDtlTpCd[]#
                </iterate>
                AND FLT_AGG_L.EZCANCELFLAG(+)     = '0'
                AND FLT_AGG_L.GLBL_CMPY_CD        = CYCLE_FA.GLBL_CMPY_CD(+) 
                AND FLT_AGG_L.BASE_BLLG_CYCLE_CD  = CYCLE_FA.BLLG_CYCLE_CD(+) 
                AND CYCLE_FA.EZCANCELFLAG(+)      = '0'
                AND FLT_AGG_L.GLBL_CMPY_CD        = TMG_FA.GLBL_CMPY_CD(+) 
                AND FLT_AGG_L.BASE_BLLG_TMG_CD    = TMG_FA.BLLG_TMG_TP_CD(+) 
                AND TMG_FA.EZCANCELFLAG(+)        = '0'
                <!-- START 2022/03/22 [QC#59683, ADD] -->
                AND DC.GLBL_CMPY_CD               = DITT.GLBL_CMPY_CD(+) 
                AND DC.DS_INV_TGTR_TP_CD          = DITT.DS_INV_TGTR_TP_CD(+) 
                AND DITT.EZCANCELFLAG(+)          = '0'
                <!-- END   2022/03/22 [QC#59683, ADD] -->
            ORDER BY
                 DC.DS_CONTR_NUM
                ,SORT_SER_NUM
                ,SORT_DS_CONTR_DTL_TP
            ) MAIN
    <!-- START 2024/02/07 K.Watanabe [QC#63464, MOD] -->
<!--    WHERE -->
<!--        ROWNUM &lt;= #limitRownum# -->
     )
    , TARGET_CONTR AS (
        SELECT
            TCW.*
        FROM
            TARGET_CONTR_WRK TCW
        WHERE
            ROWNUM &lt;= #limitRownum#
    )
    , TARGET_CONTR_CNT AS (
        SELECT
            COUNT(*) AS ROW_CNT
        FROM
            TARGET_CONTR_WRK TCW
    )
    <!-- END 2024/02/07 K.Watanabe [QC#63464, MOD] -->
    , NEXT_BLLG_DT AS (
        SELECT
            A.DS_CONTR_BLLG_SCHD_PK
           <!-- START 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
           <!-- ,A.DS_CONTR_PK -->
           <!-- END 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
           ,A.DS_CONTR_DTL_PK
           <!-- START 2019/06/04 K.Kitachi [QC#50350, ADD] -->
           ,A.DS_CONTR_PK
           <!-- END 2019/06/04 K.Kitachi [QC#50350, ADD] -->
           ,A.BLLG_SCHD_THRU_DT AS NEXT_BLLG_DT
        FROM (
            SELECT
                <!-- START 2022/03/24 K.Kitachi [QC#59684, MOD] -->
                <!-- DCBS.DS_CONTR_BLLG_SCHD_PK -->
                 DECODE(TC.MAN_TRMN_TP_CD, #manTrmnTpCd#, NULL, DCBS.DS_CONTR_BLLG_SCHD_PK) AS DS_CONTR_BLLG_SCHD_PK
                <!-- END 2022/03/24 K.Kitachi [QC#59684, MOD] -->
                <!-- START 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                <!-- ,DCD.DS_CONTR_PK -->
                <!-- END 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                <!-- START 2019/06/04 K.Kitachi [QC#50350, MOD] -->
                <!-- START 2018/02/19 K.Kojima [QC#22722-2,MOD] -->
                <!-- ,DCD.DS_CONTR_DTL_PK -->
                ,TC.DS_CONTR_DTL_PK
                <!-- END 2018/02/19 K.Kojima [QC#22722-2,MOD] -->
                ,TC.DS_CONTR_PK
                <!-- START 2022/03/24 K.Kitachi [QC#59684, MOD] -->
                <!-- ,DCBS.BLLG_SCHD_THRU_DT -->
                ,DECODE(TC.MAN_TRMN_TP_CD, #manTrmnTpCd#, NULL, DCBS.BLLG_SCHD_THRU_DT) AS BLLG_SCHD_THRU_DT
                <!-- END 2022/03/24 K.Kitachi [QC#59684, MOD] -->
                <!-- START 2018/02/19 K.Kojima [QC#22722-2,MOD] -->
                <!-- ,ROW_NUMBER() OVER(PARTITION BY DCD.DS_CONTR_DTL_PK ORDER BY DCBS.USG_CHRG_FLG DESC, DCBS.BLLG_SCHD_THRU_DT) AS ROW_NUM -->
                ,ROW_NUMBER() OVER(PARTITION BY TC.DS_CONTR_PK, TC.DS_CONTR_DTL_PK ORDER BY DCBS.USG_CHRG_FLG DESC, DCBS.BLLG_SCHD_THRU_DT) AS ROW_NUM
                <!-- END 2018/02/19 K.Kojima [QC#22722-2,MOD] -->
                <!-- END 2019/06/04 K.Kitachi [QC#50350, MOD] -->
            FROM
                <!-- START 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                <!--  DS_CONTR_DTL       DCD -->
                <!-- ,DS_CONTR_DTL_TP    DCDT -->
                <!-- ,DS_CONTR_BLLG_SCHD DCBS -->
                <!-- END 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                <!-- START 2018/02/19 K.Kojima [QC#22722-2,ADD] -->
                DS_CONTR_BLLG_SCHD DCBS
                <!-- END 2018/02/19 K.Kojima [QC#22722-2,ADD] -->
                <!-- START 2018/04/11 K.Kojima [QC#22722-4,ADD] -->
                ,TARGET_CONTR TC
                <!-- END 2018/04/11 K.Kojima [QC#22722-4,ADD] -->
            WHERE
                <!-- START 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                <!--     DCD.GLBL_CMPY_CD            = #glblCmpyCd# -->
                <!-- AND DCD.DS_CONTR_DTL_STS_CD &lt;&gt; #dsContrDtlStsCdOrdr# -->
                <!-- AND DCD .EZCANCELFLAG           = '0' -->
                <!-- AND DCD.GLBL_CMPY_CD            = DCDT.GLBL_CMPY_CD -->
                <!-- AND DCD.DS_CONTR_DTL_TP_CD      = DCDT.DS_CONTR_DTL_TP_CD -->
                <!-- AND DCDT.SVC_PRC_FLG            = #flgOffN# -->
                <!-- AND DCDT.EZCANCELFLAG           = '0' -->
                <!-- AND DCD.GLBL_CMPY_CD            = DCBS.GLBL_CMPY_CD -->
                <!-- AND DCD.DS_CONTR_DTL_PK         = DCBS.DS_CONTR_DTL_PK -->
                <!-- END 2018/02/19 K.Kojima [QC#22722-2,DEL] -->
                <!-- START 2019/06/04 K.Kitachi [QC#50350, MOD] -->
                <!-- START 2018/02/19 K.Kojima [QC#22722-2,ADD] -->
                    DCBS.GLBL_CMPY_CD(+)           = #glblCmpyCd#
                <!-- END 2018/02/19 K.Kojima [QC#22722-2,ADD] -->
                AND DCBS.EZCANCELFLAG(+)           = '0'
                AND DCBS.INV_FLG(+)                = 'N'
                AND DCBS.INV_TP_CD(+)              = #invTpCd#
                AND (DCBS.BASE_CHRG_FLG(+) = 'Y' AND DCBS.DS_BLLG_SCHD_STS_CD(+) = #dsBllgSchdStsOpen#
                 OR (DCBS.USG_CHRG_FLG(+)  = 'Y' AND DCBS.MTR_ENTRY_CPLT_FLG(+) = 'N'))
                <!-- START 2018/04/11 K.Kojima [QC#22722-4,ADD] -->
                AND TC.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK(+)
                <!-- END 2018/04/11 K.Kojima [QC#22722-4,ADD] -->
                <!-- END 2019/06/04 K.Kitachi [QC#50350, MOD] -->
                <!-- START 2018/04/11 K.Kojima [QC#22722-4,DEL] -->
                <!-- AND EXISTS( -->
                <!--         SELECT -->
                <!--             1 -->
                <!--         FROM -->
                <!--             TARGET_CONTR TC -->
                <!--         WHERE -->
                            <!-- START 2018/02/19 K.Kojima [QC#22722-2,MOD] -->
                            <!-- TC.DS_CONTR_DTL_PK = DCD.DS_CONTR_DTL_PK -->
                <!--             TC.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK -->
                            <!-- END 2018/02/19 K.Kojima [QC#22722-2,MOD] -->
                <!--     ) -->
                <!-- END 2018/04/11 K.Kojima [QC#22722-4,DEL] -->
            ) A
        WHERE
                ROW_NUM = 1
    )
    <!-- START 2019/01/19 T.Tomita [QC#26928,MOD] -->
    ,PO_NUM AS (
        SELECT
            TC.DS_CONTR_PK
            ,TC.DS_CONTR_DTL_PK
            ,CASE WHEN TC.DS_CONTR_CATG_CD = 'FLT' 
                THEN COALESCE(CP_FLB.DS_CONTR_BLLG_MTR_PK, CP_FL.DS_CONTR_BLLG_MTR_PK, CP_H.DS_CONTR_BLLG_MTR_PK)
                ELSE COALESCE(CP_B.DS_CONTR_BLLG_MTR_PK, CP_D.DS_CONTR_BLLG_MTR_PK, CP_H.DS_CONTR_BLLG_MTR_PK)
            END AS DS_CONTR_BLLG_MTR_PK
            ,CASE WHEN TC.DS_CONTR_CATG_CD = 'FLT' 
                THEN COALESCE(CP_FLB.CUST_PO_NUM, CP_FL.CUST_PO_NUM, CP_H.CUST_PO_NUM)
                ELSE COALESCE(CP_B.CUST_PO_NUM, CP_D.CUST_PO_NUM, CP_H.CUST_PO_NUM)
            END CUST_PO_NUM
            ,CASE WHEN TC.DS_CONTR_CATG_CD = 'FLT' 
                THEN COALESCE(CP_FLB.PO_DT, CP_FL.PO_DT, CP_H.PO_DT) 
                ELSE COALESCE(CP_B.PO_DT, CP_D.PO_DT, CP_H.PO_DT)
            END AS PO_DT
        FROM
            DS_CONTR_CR_CARD_PO CP_H
            ,DS_CONTR_CR_CARD_PO CP_D
            ,DS_CONTR_CR_CARD_PO CP_B
            ,DS_CONTR_CR_CARD_PO CP_FL
            ,DS_CONTR_CR_CARD_PO CP_FLB
            ,TARGET_CONTR TC
        WHERE
            TC.GLBL_CMPY_CD                 = CP_H.GLBL_CMPY_CD(+)
        AND TC.DS_CONTR_PK                  = CP_H.DS_CONTR_PK(+)
        AND CP_H.DS_CONTR_MACH_LVL_NUM(+)   = #dsContrMachLvlNum1#
        AND CP_H.CR_CARD_FLG(+)             = 'N'
        AND CP_H.PO_FROM_DT(+)             &lt;= #slsDt#
        AND CP_H.PO_DT(+)                  &gt;= #slsDt#
        AND CP_H.EZCANCELFLAG(+)            = '0'
        AND TC.GLBL_CMPY_CD                 = CP_D.GLBL_CMPY_CD(+)
        AND TC.DS_CONTR_PK                  = CP_D.DS_CONTR_PK(+)
        AND TC.DS_CONTR_DTL_PK              = CP_D.DS_CONTR_DTL_PK(+)
        AND CP_D.DS_CONTR_MACH_LVL_NUM(+)   = #dsContrMachLvlNum2#
        AND CP_D.CR_CARD_FLG(+)             = 'N'
        AND CP_D.PO_FROM_DT(+)             &lt;= #slsDt#
        AND CP_D.PO_DT(+)                  &gt;= #slsDt#
        AND CP_D.EZCANCELFLAG(+)            = '0'
        AND TC.GLBL_CMPY_CD                 = CP_B.GLBL_CMPY_CD(+)
        AND TC.DS_CONTR_PK                  = CP_B.DS_CONTR_PK(+)
        AND TC.DS_CONTR_DTL_PK              = CP_B.DS_CONTR_DTL_PK(+)
        AND CP_B.DS_CONTR_MACH_LVL_NUM(+)   = #dsContrMachLvlNum3#
        AND CP_B.CR_CARD_FLG(+)             = 'N'
        AND CP_B.PO_FROM_DT(+)             &lt;= #slsDt#
        AND CP_B.PO_DT(+)                  &gt;= #slsDt#
        AND CP_B.DS_CONTR_BLLG_MTR_PK(+)    IS NULL
        AND CP_B.EZCANCELFLAG(+)            = '0'
        AND TC.GLBL_CMPY_CD                 = CP_FL.GLBL_CMPY_CD(+)
        AND TC.DS_CONTR_PK                  = CP_FL.DS_CONTR_PK(+)
        AND TC.DS_CONTR_DTL_PK_FAL          = CP_FL.DS_CONTR_DTL_PK(+)
        AND CP_FL.DS_CONTR_MACH_LVL_NUM(+)  = #dsContrMachLvlNum2#
        AND CP_FL.CR_CARD_FLG(+)            = 'N'
        AND CP_FL.PO_FROM_DT(+)            &lt;= #slsDt#
        AND CP_FL.PO_DT(+)                 &gt;= #slsDt#
        AND CP_FL.EZCANCELFLAG(+)           = '0'
        AND TC.GLBL_CMPY_CD                 = CP_FLB.GLBL_CMPY_CD(+)
        AND TC.DS_CONTR_PK                  = CP_FLB.DS_CONTR_PK(+)
        AND TC.DS_CONTR_DTL_PK_FAL          = CP_FLB.DS_CONTR_DTL_PK(+)
        AND CP_FLB.DS_CONTR_MACH_LVL_NUM(+) = #dsContrMachLvlNum3#
        AND CP_FLB.CR_CARD_FLG(+)           = 'N'
        AND CP_FLB.PO_FROM_DT(+)           &lt;= #slsDt#
        AND CP_FLB.PO_DT(+)                &gt;= #slsDt#
        AND CP_FLB.DS_CONTR_BLLG_MTR_PK(+)  IS NULL
        AND CP_FLB.EZCANCELFLAG(+)          = '0'
    )
    ,CR_CARD AS (
        SELECT
            TC.DS_CONTR_PK
            ,TC.DS_CONTR_DTL_PK
            ,CASE WHEN TC.DS_CONTR_CATG_CD = 'FLT' 
                THEN COALESCE(CP_FLB.DS_CONTR_BLLG_MTR_PK, CP_FL.DS_CONTR_BLLG_MTR_PK, CP_H.DS_CONTR_BLLG_MTR_PK)
                ELSE COALESCE(CP_B.DS_CONTR_BLLG_MTR_PK, CP_D.DS_CONTR_BLLG_MTR_PK, CP_H.DS_CONTR_BLLG_MTR_PK)
            END AS DS_CONTR_BLLG_MTR_PK
            ,CASE WHEN TC.DS_CONTR_CATG_CD = 'FLT' 
                THEN COALESCE(CP_FLB.CR_CARD_CUST_REF_NUM, CP_FL.CR_CARD_CUST_REF_NUM, CP_H.CR_CARD_CUST_REF_NUM) 
                ELSE COALESCE(CP_B.CR_CARD_CUST_REF_NUM, CP_D.CR_CARD_CUST_REF_NUM, CP_H.CR_CARD_CUST_REF_NUM)
            END CR_CARD_CUST_REF_NUM
            ,CASE WHEN TC.DS_CONTR_CATG_CD = 'FLT' 
                THEN COALESCE(CP_FLB.CR_CARD_EXPR_YR_MTH, CP_FL.CR_CARD_EXPR_YR_MTH, CP_H.CR_CARD_EXPR_YR_MTH) 
                ELSE COALESCE(CP_B.CR_CARD_EXPR_YR_MTH, CP_D.CR_CARD_EXPR_YR_MTH, CP_H.CR_CARD_EXPR_YR_MTH)
            END CR_CARD_EXPR_YR_MTH
        FROM
            DS_CONTR_CR_CARD_PO CP_H
            ,DS_CONTR_CR_CARD_PO CP_D
            ,DS_CONTR_CR_CARD_PO CP_B
            ,DS_CONTR_CR_CARD_PO CP_FL
            ,DS_CONTR_CR_CARD_PO CP_FLB
            ,TARGET_CONTR TC
        WHERE
            TC.GLBL_CMPY_CD                 = CP_H.GLBL_CMPY_CD(+)
        AND TC.DS_CONTR_PK                  = CP_H.DS_CONTR_PK(+)
        AND CP_H.DS_CONTR_MACH_LVL_NUM(+)   = #dsContrMachLvlNum1#
        AND CP_H.CR_CARD_FLG(+)             = 'Y'
        AND CP_H.EZCANCELFLAG(+)            = '0'
        AND TC.GLBL_CMPY_CD                 = CP_D.GLBL_CMPY_CD(+)
        AND TC.DS_CONTR_PK                  = CP_D.DS_CONTR_PK(+)
        AND TC.DS_CONTR_DTL_PK              = CP_D.DS_CONTR_DTL_PK(+)
        AND CP_D.DS_CONTR_MACH_LVL_NUM(+)   = #dsContrMachLvlNum2#
        AND CP_D.CR_CARD_FLG(+)             = 'Y'
        AND CP_D.EZCANCELFLAG(+)            = '0'
        AND TC.GLBL_CMPY_CD                 = CP_B.GLBL_CMPY_CD(+)
        AND TC.DS_CONTR_PK                  = CP_B.DS_CONTR_PK(+)
        AND TC.DS_CONTR_DTL_PK              = CP_B.DS_CONTR_DTL_PK(+)
        AND CP_B.DS_CONTR_MACH_LVL_NUM(+)   = #dsContrMachLvlNum3#
        AND CP_B.CR_CARD_FLG(+)             = 'Y'
        AND CP_B.DS_CONTR_BLLG_MTR_PK(+)    IS NULL
        AND CP_B.EZCANCELFLAG(+)            = '0'
        AND TC.GLBL_CMPY_CD                 = CP_FL.GLBL_CMPY_CD(+)
        AND TC.DS_CONTR_PK                  = CP_FL.DS_CONTR_PK(+)
        AND TC.DS_CONTR_DTL_PK_FAL          = CP_FL.DS_CONTR_DTL_PK(+)
        AND CP_FL.DS_CONTR_MACH_LVL_NUM(+)  = #dsContrMachLvlNum2#
        AND CP_FL.CR_CARD_FLG(+)            = 'Y'
        AND CP_FL.EZCANCELFLAG(+)           = '0'
        AND TC.GLBL_CMPY_CD                 = CP_FLB.GLBL_CMPY_CD(+)
        AND TC.DS_CONTR_PK                  = CP_FLB.DS_CONTR_PK(+)
        AND TC.DS_CONTR_DTL_PK_FAL          = CP_FLB.DS_CONTR_DTL_PK(+)
        AND CP_FLB.DS_CONTR_MACH_LVL_NUM(+) = #dsContrMachLvlNum3#
        AND CP_FLB.CR_CARD_FLG(+)           = 'Y'
        AND CP_FLB.DS_CONTR_BLLG_MTR_PK(+)  IS NULL
        AND CP_FLB.EZCANCELFLAG(+)          = '0'
    )
    <!-- END 2019/01/19 T.Tomita [QC#26928,MOD] -->
    ,RNW_ESCL_INF AS (
        SELECT
             DCRE.DS_CONTR_PK
            ,DCRE.DS_CONTR_DTL_PK
            ,DCRE.DS_CONTR_MACH_LVL_NUM
            ,DCRE.DS_CONTR_BASE_USG_NM
            ,DCRE.CONTR_AUTO_RNW_TP_CD
            ,DCRE.RNW_PRC_METH_CD
            ,DCRE.BEF_END_RNW_DAYS_AOT
            ,DCRE.BASE_PRC_UP_RATIO
            ,DCRE.MTR_PRC_UP_RATIO
            ,CART.RNW_BASE_FLG
            ,CART.RNW_USG_FLG
            ,CART.CONTR_AUTO_RNW_TP_DESC_TXT
            ,RPM.RNW_PRC_METH_DESC_TXT
            ,DCRE.CONTR_UPLFT_TP_CD
            ,DCRE.UPLFT_PRC_METH_CD
            ,DCRE.UPLFT_BEF_END_RNW_DAYS_AOT
            ,DCRE.UPLFT_BASE_PRC_UP_RATIO
            ,DCRE.UPLFT_MTR_PRC_UP_RATIO
            ,CUT.UPLFT_BASE_FLG
            ,CUT.UPLFT_USG_FLG
            ,CUT.CONTR_UPLFT_TP_DESC_TXT
            ,UPM.UPLFT_PRC_METH_DESC_TXT
        FROM
             DS_CONTR_RNW_ESCL DCRE
            ,CONTR_AUTO_RNW_TP CART
            ,RNW_PRC_METH      RPM
            ,CONTR_UPLFT_TP    CUT
            ,UPLFT_PRC_METH    UPM
        WHERE
            DCRE.GLBL_CMPY_CD         = #glblCmpyCd#
        AND DCRE.EZCANCELFLAG         = '0'
        AND DCRE.GLBL_CMPY_CD         = CART.GLBL_CMPY_CD(+)
        AND DCRE.CONTR_AUTO_RNW_TP_CD = CART.CONTR_AUTO_RNW_TP_CD(+)
        AND CART.EZCANCELFLAG(+)      = '0'
        AND DCRE.GLBL_CMPY_CD         = RPM.GLBL_CMPY_CD(+)
        AND DCRE.RNW_PRC_METH_CD      = RPM.RNW_PRC_METH_CD(+)
        AND RPM.EZCANCELFLAG(+)       = '0'
        AND DCRE.GLBL_CMPY_CD         = CUT.GLBL_CMPY_CD(+)
        AND DCRE.CONTR_UPLFT_TP_CD    = CUT.CONTR_UPLFT_TP_CD(+)
        AND CUT.EZCANCELFLAG(+)       = '0'
        AND DCRE.GLBL_CMPY_CD         = UPM.GLBL_CMPY_CD(+)
        AND DCRE.UPLFT_PRC_METH_CD    = UPM.UPLFT_PRC_METH_CD(+)
        AND UPM.EZCANCELFLAG(+)       = '0'
        AND EXISTS(SELECT 1 FROM TARGET_CONTR TC WHERE TC.DS_CONTR_PK = DCRE.DS_CONTR_PK )
    )

    ,RNW_ESCL AS (
        SELECT
              TC.GLBL_CMPY_CD
             ,TC.DS_CONTR_PK
             ,TC.DS_CONTR_DTL_PK
             --Renewal
             <!-- START 2018/10/08 K.Kojima [QC#28687, MOD] -->
             <!-- ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet#  -->
             <!--            THEN COALESCE(DCREPB.CONTR_AUTO_RNW_TP_DESC_TXT, DCREP.CONTR_AUTO_RNW_TP_DESC_TXT,  DCRE1.CONTR_AUTO_RNW_TP_DESC_TXT) -->
             <!--            ELSE COALESCE(DCREB.CONTR_AUTO_RNW_TP_DESC_TXT, DCRE2.CONTR_AUTO_RNW_TP_DESC_TXT,  DCRE1.CONTR_AUTO_RNW_TP_DESC_TXT) -->
             <!--       END AS CONTR_AUTO_RNW_TP_DESC_TXT -->
             <!-- ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# -->
             <!--            THEN COALESCE(DCREPB.RNW_PRC_METH_DESC_TXT, DCREP.RNW_PRC_METH_DESC_TXT,  DCRE1.RNW_PRC_METH_DESC_TXT) -->
             <!--            ELSE COALESCE(DCREB.RNW_PRC_METH_DESC_TXT,  DCRE2.RNW_PRC_METH_DESC_TXT,  DCRE1.RNW_PRC_METH_DESC_TXT) -->
             <!--       END AS RNW_PRC_METH_DESC_TXT -->
             <!-- ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# -->
             <!--            THEN COALESCE(DCREPB.BEF_END_RNW_DAYS_AOT, DCREP.BEF_END_RNW_DAYS_AOT,  DCRE1.BEF_END_RNW_DAYS_AOT) -->
             <!--            ELSE COALESCE(DCREB.BEF_END_RNW_DAYS_AOT,  DCRE2.BEF_END_RNW_DAYS_AOT,  DCRE1.BEF_END_RNW_DAYS_AOT) -->
             <!--       END AS BEF_END_RNW_DAYS_AOT -->
             <!-- ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# -->
             <!--            THEN CASE WHEN DCREPB.RNW_BASE_FLG = 'Y'  THEN DCREPB.BASE_PRC_UP_RATIO  WHEN DCREP.RNW_BASE_FLG = 'Y'  THEN DCREP.BASE_PRC_UP_RATIO  WHEN DCRE1.RNW_BASE_FLG = 'Y' THEN DCRE1.BASE_PRC_UP_RATIO END -->
             <!--            ELSE CASE WHEN DCREB.RNW_BASE_FLG = 'Y'   THEN DCREB.BASE_PRC_UP_RATIO   WHEN DCRE2.RNW_BASE_FLG = 'Y'  THEN DCRE2.BASE_PRC_UP_RATIO  WHEN DCRE1.RNW_BASE_FLG = 'Y' THEN DCRE1.BASE_PRC_UP_RATIO END -->
             <!--       END AS BASE_PRC_UP_RATIO -->
             <!-- ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdReg# -->
             <!--            THEN CASE WHEN DCREU.RNW_USG_FLG = 'Y'   THEN DCREU.MTR_PRC_UP_RATIO   WHEN DCRE2.RNW_USG_FLG = 'Y'  THEN DCRE2.MTR_PRC_UP_RATIO  WHEN DCRE1.RNW_USG_FLG = 'Y' THEN DCRE1.MTR_PRC_UP_RATIO END -->
             <!--       WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# -->
             <!--            THEN CASE WHEN DCREPU.RNW_USG_FLG = 'Y'  THEN DCREPU.MTR_PRC_UP_RATIO  WHEN DCREP.RNW_USG_FLG = 'Y'  THEN DCREP.MTR_PRC_UP_RATIO  WHEN DCRE1.RNW_USG_FLG = 'Y' THEN DCRE1.MTR_PRC_UP_RATIO END -->
             <!--       WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdAgg# -->
             <!--            THEN CASE WHEN DCREU.RNW_USG_FLG = 'Y'   THEN DCREU.MTR_PRC_UP_RATIO   WHEN DCREP.RNW_USG_FLG = 'Y'  THEN DCREP.MTR_PRC_UP_RATIO  WHEN DCRE1.RNW_USG_FLG = 'Y' THEN DCRE1.MTR_PRC_UP_RATIO END -->
             <!--       END AS MTR_PRC_UP_RATIO -->
             ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# 
                        THEN CASE WHEN DCREPB.CONTR_AUTO_RNW_TP_CD IS NOT NULL THEN DCREPB.CONTR_AUTO_RNW_TP_DESC_TXT
                                  WHEN DCREP.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN DCREP.CONTR_AUTO_RNW_TP_DESC_TXT
                                  WHEN DCRE1.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN DCRE1.CONTR_AUTO_RNW_TP_DESC_TXT END
                        ELSE CASE WHEN DCREB.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN DCREB.CONTR_AUTO_RNW_TP_DESC_TXT
                                  WHEN DCRE2.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN DCRE2.CONTR_AUTO_RNW_TP_DESC_TXT
                                  WHEN DCRE1.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN DCRE1.CONTR_AUTO_RNW_TP_DESC_TXT END
                   END AS CONTR_AUTO_RNW_TP_DESC_TXT
             ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# 
                        THEN CASE WHEN DCREPB.CONTR_AUTO_RNW_TP_CD IS NOT NULL THEN DCREPB.RNW_PRC_METH_DESC_TXT
                                  WHEN DCREP.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN DCREP.RNW_PRC_METH_DESC_TXT
                                  WHEN DCRE1.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN DCRE1.RNW_PRC_METH_DESC_TXT END
                        ELSE CASE WHEN DCREB.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN DCREB.RNW_PRC_METH_DESC_TXT
                                  WHEN DCRE2.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN DCRE2.RNW_PRC_METH_DESC_TXT
                                  WHEN DCRE1.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN DCRE1.RNW_PRC_METH_DESC_TXT END
                   END AS RNW_PRC_METH_DESC_TXT
             ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# 
                        THEN CASE WHEN DCREPB.CONTR_AUTO_RNW_TP_CD IS NOT NULL THEN DCREPB.BEF_END_RNW_DAYS_AOT
                                  WHEN DCREP.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN DCREP.BEF_END_RNW_DAYS_AOT
                                  WHEN DCRE1.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN DCRE1.BEF_END_RNW_DAYS_AOT END
                        ELSE CASE WHEN DCREB.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN DCREB.BEF_END_RNW_DAYS_AOT
                                  WHEN DCRE2.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN DCRE2.BEF_END_RNW_DAYS_AOT
                                  WHEN DCRE1.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN DCRE1.BEF_END_RNW_DAYS_AOT END
                   END AS BEF_END_RNW_DAYS_AOT
             ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet#
                        THEN CASE WHEN DCREPB.CONTR_AUTO_RNW_TP_CD IS NOT NULL THEN CASE WHEN DCREPB.RNW_BASE_FLG = 'Y' THEN DCREPB.BASE_PRC_UP_RATIO ELSE NULL END
                                  WHEN DCREP.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN CASE WHEN DCREP.RNW_BASE_FLG  = 'Y' THEN DCREP.BASE_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCRE1.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN CASE WHEN DCRE1.RNW_BASE_FLG  = 'Y' THEN DCRE1.BASE_PRC_UP_RATIO  ELSE NULL END END
                        ELSE CASE WHEN DCREB.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN CASE WHEN DCREB.RNW_BASE_FLG  = 'Y' THEN DCREB.BASE_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCRE2.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN CASE WHEN DCRE2.RNW_BASE_FLG  = 'Y' THEN DCRE2.BASE_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCRE1.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN CASE WHEN DCRE1.RNW_BASE_FLG  = 'Y' THEN DCRE1.BASE_PRC_UP_RATIO  ELSE NULL END END
                   END AS BASE_PRC_UP_RATIO
             ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdReg#
                        THEN CASE WHEN DCREU.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN CASE WHEN DCREU.RNW_USG_FLG  = 'Y' THEN DCREU.MTR_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCRE2.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN CASE WHEN DCRE2.RNW_USG_FLG  = 'Y' THEN DCRE2.MTR_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCRE1.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN CASE WHEN DCRE1.RNW_USG_FLG  = 'Y' THEN DCRE1.MTR_PRC_UP_RATIO  ELSE NULL END END
                   WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet#
                        THEN CASE WHEN DCREPU.CONTR_AUTO_RNW_TP_CD IS NOT NULL THEN CASE WHEN DCREPU.RNW_USG_FLG = 'Y' THEN DCREPU.MTR_PRC_UP_RATIO ELSE NULL END
                                  WHEN DCREP.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN CASE WHEN DCREP.RNW_USG_FLG  = 'Y' THEN DCREP.MTR_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCRE1.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN CASE WHEN DCRE1.RNW_USG_FLG  = 'Y' THEN DCRE1.MTR_PRC_UP_RATIO  ELSE NULL END END
                   WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdAgg#
                        THEN CASE WHEN DCREU.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN CASE WHEN DCREU.RNW_USG_FLG  = 'Y' THEN DCREU.MTR_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCREP.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN CASE WHEN DCREP.RNW_USG_FLG  = 'Y' THEN DCREP.MTR_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCRE1.CONTR_AUTO_RNW_TP_CD  IS NOT NULL THEN CASE WHEN DCRE1.RNW_USG_FLG  = 'Y' THEN DCRE1.MTR_PRC_UP_RATIO  ELSE NULL END END
                   END AS MTR_PRC_UP_RATIO
             <!-- END 2018/10/08 K.Kojima [QC#28687, MOD] -->
             --Uplift
             <!-- START 2018/10/08 K.Kojima [QC#28687, MOD] -->
             <!-- ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet#  -->
             <!--            THEN COALESCE(DCREPB.CONTR_UPLFT_TP_DESC_TXT, DCREP.CONTR_UPLFT_TP_DESC_TXT,  DCRE1.CONTR_UPLFT_TP_DESC_TXT) -->
             <!--            ELSE COALESCE(DCREB.CONTR_UPLFT_TP_DESC_TXT, DCRE2.CONTR_UPLFT_TP_DESC_TXT,  DCRE1.CONTR_UPLFT_TP_DESC_TXT) -->
             <!--       END AS CONTR_UPLFT_TP_DESC_TXT -->
             <!-- ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# -->
             <!--            THEN COALESCE(DCREPB.UPLFT_PRC_METH_DESC_TXT, DCREP.UPLFT_PRC_METH_DESC_TXT,  DCRE1.UPLFT_PRC_METH_DESC_TXT) -->
             <!--            ELSE COALESCE(DCREB.UPLFT_PRC_METH_DESC_TXT,  DCRE2.UPLFT_PRC_METH_DESC_TXT,  DCRE1.UPLFT_PRC_METH_DESC_TXT) -->
             <!--       END AS UPLFT_PRC_METH_DESC_TXT -->
             <!-- ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# -->
             <!--            THEN COALESCE(DCREPB.UPLFT_BEF_END_RNW_DAYS_AOT, DCREP.UPLFT_BEF_END_RNW_DAYS_AOT,  DCRE1.UPLFT_BEF_END_RNW_DAYS_AOT) -->
             <!--            ELSE COALESCE(DCREB.UPLFT_BEF_END_RNW_DAYS_AOT,  DCRE2.UPLFT_BEF_END_RNW_DAYS_AOT,  DCRE1.UPLFT_BEF_END_RNW_DAYS_AOT) -->
             <!--       END AS UPLFT_BEF_END_RNW_DAYS_AOT -->
             <!-- ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# -->
             <!--            THEN CASE WHEN DCREPB.UPLFT_BASE_FLG = 'Y'  THEN DCREPB.UPLFT_BASE_PRC_UP_RATIO  WHEN DCREP.UPLFT_BASE_FLG = 'Y'  THEN DCREP.UPLFT_BASE_PRC_UP_RATIO  WHEN DCRE1.UPLFT_BASE_FLG = 'Y' THEN DCRE1.UPLFT_BASE_PRC_UP_RATIO END -->
             <!--            ELSE CASE WHEN DCREB.UPLFT_BASE_FLG = 'Y'   THEN DCREB.UPLFT_BASE_PRC_UP_RATIO   WHEN DCRE2.UPLFT_BASE_FLG = 'Y'  THEN DCRE2.UPLFT_BASE_PRC_UP_RATIO  WHEN DCRE1.UPLFT_BASE_FLG = 'Y' THEN DCRE1.UPLFT_BASE_PRC_UP_RATIO END -->
             <!--       END AS UPLFT_BASE_PRC_UP_RATIO -->
             <!-- ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdReg# -->
             <!--            THEN CASE WHEN DCREU.UPLFT_USG_FLG = 'Y'   THEN DCREU.UPLFT_MTR_PRC_UP_RATIO   WHEN DCRE2.UPLFT_USG_FLG = 'Y'  THEN DCRE2.UPLFT_MTR_PRC_UP_RATIO  WHEN DCRE1.UPLFT_USG_FLG = 'Y' THEN DCRE1.UPLFT_MTR_PRC_UP_RATIO END -->
             <!--       WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# -->
             <!--            THEN CASE WHEN DCREPU.UPLFT_USG_FLG = 'Y'  THEN DCREPU.UPLFT_MTR_PRC_UP_RATIO  WHEN DCREP.UPLFT_USG_FLG = 'Y'  THEN DCREP.UPLFT_MTR_PRC_UP_RATIO  WHEN DCRE1.UPLFT_USG_FLG = 'Y' THEN DCRE1.UPLFT_MTR_PRC_UP_RATIO END -->
             <!--       WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdAgg# -->
             <!--            THEN CASE WHEN DCREU.UPLFT_USG_FLG = 'Y'   THEN DCREU.UPLFT_MTR_PRC_UP_RATIO   WHEN DCREP.UPLFT_USG_FLG = 'Y'  THEN DCREP.UPLFT_MTR_PRC_UP_RATIO  WHEN DCRE1.UPLFT_USG_FLG = 'Y' THEN DCRE1.UPLFT_MTR_PRC_UP_RATIO END -->
             <!--       END AS UPLFT_MTR_PRC_UP_RATIO -->
             ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# 
                        THEN CASE WHEN DCREPB.CONTR_UPLFT_TP_CD IS NOT NULL THEN DCREPB.CONTR_UPLFT_TP_DESC_TXT
                                  WHEN DCREP.CONTR_UPLFT_TP_CD  IS NOT NULL THEN DCREP.CONTR_UPLFT_TP_DESC_TXT
                                  WHEN DCRE1.CONTR_UPLFT_TP_CD  IS NOT NULL THEN DCRE1.CONTR_UPLFT_TP_DESC_TXT END
                        ELSE CASE WHEN DCREB.CONTR_UPLFT_TP_CD  IS NOT NULL THEN DCREB.CONTR_UPLFT_TP_DESC_TXT
                                  WHEN DCRE2.CONTR_UPLFT_TP_CD  IS NOT NULL THEN DCRE2.CONTR_UPLFT_TP_DESC_TXT
                                  WHEN DCRE1.CONTR_UPLFT_TP_CD  IS NOT NULL THEN DCRE1.CONTR_UPLFT_TP_DESC_TXT END
                   END AS CONTR_UPLFT_TP_DESC_TXT
             ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# 
                        THEN CASE WHEN DCREPB.CONTR_UPLFT_TP_CD IS NOT NULL THEN DCREPB.UPLFT_PRC_METH_DESC_TXT
                                  WHEN DCREP.CONTR_UPLFT_TP_CD  IS NOT NULL THEN DCREP.UPLFT_PRC_METH_DESC_TXT
                                  WHEN DCRE1.CONTR_UPLFT_TP_CD  IS NOT NULL THEN DCRE1.UPLFT_PRC_METH_DESC_TXT END
                        ELSE CASE WHEN DCREB.CONTR_UPLFT_TP_CD  IS NOT NULL THEN DCREB.UPLFT_PRC_METH_DESC_TXT
                                  WHEN DCRE2.CONTR_UPLFT_TP_CD  IS NOT NULL THEN DCRE2.UPLFT_PRC_METH_DESC_TXT
                                  WHEN DCRE1.CONTR_UPLFT_TP_CD  IS NOT NULL THEN DCRE1.UPLFT_PRC_METH_DESC_TXT END
                   END AS UPLFT_PRC_METH_DESC_TXT
             ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# 
                        THEN CASE WHEN DCREPB.CONTR_UPLFT_TP_CD IS NOT NULL THEN DCREPB.UPLFT_BEF_END_RNW_DAYS_AOT
                                  WHEN DCREP.CONTR_UPLFT_TP_CD  IS NOT NULL THEN DCREP.UPLFT_BEF_END_RNW_DAYS_AOT
                                  WHEN DCRE1.CONTR_UPLFT_TP_CD  IS NOT NULL THEN DCRE1.UPLFT_BEF_END_RNW_DAYS_AOT END
                        ELSE CASE WHEN DCREB.CONTR_UPLFT_TP_CD  IS NOT NULL THEN DCREB.UPLFT_BEF_END_RNW_DAYS_AOT
                                  WHEN DCRE2.CONTR_UPLFT_TP_CD  IS NOT NULL THEN DCRE2.UPLFT_BEF_END_RNW_DAYS_AOT
                                  WHEN DCRE1.CONTR_UPLFT_TP_CD  IS NOT NULL THEN DCRE1.UPLFT_BEF_END_RNW_DAYS_AOT END
                   END AS UPLFT_BEF_END_RNW_DAYS_AOT
             ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet#
                        THEN CASE WHEN DCREPB.CONTR_UPLFT_TP_CD IS NOT NULL THEN CASE WHEN DCREPB.UPLFT_BASE_FLG = 'Y' THEN DCREPB.UPLFT_BASE_PRC_UP_RATIO ELSE NULL END
                                  WHEN DCREP.CONTR_UPLFT_TP_CD  IS NOT NULL THEN CASE WHEN DCREP.UPLFT_BASE_FLG  = 'Y' THEN DCREP.UPLFT_BASE_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCRE1.CONTR_UPLFT_TP_CD  IS NOT NULL THEN CASE WHEN DCRE1.UPLFT_BASE_FLG  = 'Y' THEN DCRE1.UPLFT_BASE_PRC_UP_RATIO  ELSE NULL END END
                        ELSE CASE WHEN DCREB.CONTR_UPLFT_TP_CD  IS NOT NULL THEN CASE WHEN DCREB.UPLFT_BASE_FLG  = 'Y' THEN DCREB.UPLFT_BASE_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCRE2.CONTR_UPLFT_TP_CD  IS NOT NULL THEN CASE WHEN DCRE2.UPLFT_BASE_FLG  = 'Y' THEN DCRE2.UPLFT_BASE_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCRE1.CONTR_UPLFT_TP_CD  IS NOT NULL THEN CASE WHEN DCRE1.UPLFT_BASE_FLG  = 'Y' THEN DCRE1.UPLFT_BASE_PRC_UP_RATIO  ELSE NULL END END
                   END AS UPLFT_BASE_PRC_UP_RATIO
             ,CASE WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdReg#
                        THEN CASE WHEN DCREU.CONTR_UPLFT_TP_CD  IS NOT NULL THEN CASE WHEN DCREU.UPLFT_USG_FLG  = 'Y' THEN DCREU.UPLFT_MTR_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCRE2.CONTR_UPLFT_TP_CD  IS NOT NULL THEN CASE WHEN DCRE2.UPLFT_USG_FLG  = 'Y' THEN DCRE2.UPLFT_MTR_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCRE1.CONTR_UPLFT_TP_CD  IS NOT NULL THEN CASE WHEN DCRE1.UPLFT_USG_FLG  = 'Y' THEN DCRE1.UPLFT_MTR_PRC_UP_RATIO  ELSE NULL END END
                   WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdFleet#
                        THEN CASE WHEN DCREPU.CONTR_UPLFT_TP_CD IS NOT NULL THEN CASE WHEN DCREPU.UPLFT_USG_FLG = 'Y' THEN DCREPU.UPLFT_MTR_PRC_UP_RATIO ELSE NULL END
                                  WHEN DCREP.CONTR_UPLFT_TP_CD  IS NOT NULL THEN CASE WHEN DCREP.UPLFT_USG_FLG  = 'Y' THEN DCREP.UPLFT_MTR_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCRE1.CONTR_UPLFT_TP_CD  IS NOT NULL THEN CASE WHEN DCRE1.UPLFT_USG_FLG  = 'Y' THEN DCRE1.UPLFT_MTR_PRC_UP_RATIO  ELSE NULL END END
                   WHEN TC.DS_CONTR_CATG_CD = #dsContrCatgCdAgg#
                        THEN CASE WHEN DCREU.CONTR_UPLFT_TP_CD  IS NOT NULL THEN CASE WHEN DCREU.UPLFT_USG_FLG  = 'Y' THEN DCREU.UPLFT_MTR_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCREP.CONTR_UPLFT_TP_CD  IS NOT NULL THEN CASE WHEN DCREP.UPLFT_USG_FLG  = 'Y' THEN DCREP.UPLFT_MTR_PRC_UP_RATIO  ELSE NULL END
                                  WHEN DCRE1.CONTR_UPLFT_TP_CD  IS NOT NULL THEN CASE WHEN DCRE1.UPLFT_USG_FLG  = 'Y' THEN DCRE1.UPLFT_MTR_PRC_UP_RATIO  ELSE NULL END END
                   END AS UPLFT_MTR_PRC_UP_RATIO
             <!-- END 2018/10/08 K.Kojima [QC#28687, MOD] -->
        FROM
             TARGET_CONTR      TC
            ,RNW_ESCL_INF DCRE1 --header
            ,RNW_ESCL_INF DCRE2 --machine
            ,RNW_ESCL_INF DCREB --base
            ,RNW_ESCL_INF DCREU --usage
            ,RNW_ESCL_INF DCREP --fleet/agg line
            ,RNW_ESCL_INF DCREPB --fleet/agg base
            ,RNW_ESCL_INF DCREPU --fleet/agg usage
        WHERE
            <!-- START 2019/06/04 K.Kitachi [QC#50350, MOD] -->
                TC.DS_CONTR_PK = DCRE1.DS_CONTR_PK(+)   AND DCRE1.CONTR_AUTO_RNW_TP_CD(+) IS NOT NULL AND DCRE1.DS_CONTR_MACH_LVL_NUM(+)  = #dsContrMachLvlNum1#
            AND TC.DS_CONTR_PK = DCRE2.DS_CONTR_PK(+)   AND TC.DS_CONTR_DTL_PK = DCRE2.DS_CONTR_DTL_PK(+) AND DCRE1.CONTR_AUTO_RNW_TP_CD(+) IS NOT NULL AND DCRE2.DS_CONTR_MACH_LVL_NUM(+) = #dsContrMachLvlNum2#
            AND TC.DS_CONTR_PK = DCREB.DS_CONTR_PK(+)   AND TC.DS_CONTR_DTL_PK = DCREB.DS_CONTR_DTL_PK(+) AND DCRE1.CONTR_AUTO_RNW_TP_CD(+) IS NOT NULL AND DCREB.DS_CONTR_MACH_LVL_NUM(+) = #dsContrMachLvlNum3# AND DCREB.DS_CONTR_BASE_USG_NM(+) = #dsContrBaseUsgNmB#
            AND TC.DS_CONTR_PK = DCREU.DS_CONTR_PK(+)   AND TC.DS_CONTR_DTL_PK = DCREU.DS_CONTR_DTL_PK(+) AND DCRE1.CONTR_AUTO_RNW_TP_CD(+) IS NOT NULL AND DCREU.DS_CONTR_MACH_LVL_NUM(+) = #dsContrMachLvlNum3# AND DCREU.DS_CONTR_BASE_USG_NM(+) = #dsContrBaseUsgNmU#
            AND TC.DS_CONTR_PK = DCREP.DS_CONTR_PK(+)   AND TC.DS_CONTR_DTL_PK_FAL = DCREP.DS_CONTR_DTL_PK(+) AND DCRE1.CONTR_AUTO_RNW_TP_CD(+) IS NOT NULL AND DCREP.DS_CONTR_MACH_LVL_NUM(+) = #dsContrMachLvlNum2#
            AND TC.DS_CONTR_PK = DCREPB.DS_CONTR_PK(+)  AND TC.DS_CONTR_DTL_PK_FAL = DCREPB.DS_CONTR_DTL_PK(+) AND DCRE1.CONTR_AUTO_RNW_TP_CD(+) IS NOT NULL AND DCREPB.DS_CONTR_MACH_LVL_NUM(+) = #dsContrMachLvlNum3# AND DCREPB.DS_CONTR_BASE_USG_NM(+) = #dsContrBaseUsgNmB#
            AND TC.DS_CONTR_PK = DCREPU.DS_CONTR_PK(+)  AND TC.DS_CONTR_DTL_PK_FAL = DCREPU.DS_CONTR_DTL_PK(+) AND DCRE1.CONTR_AUTO_RNW_TP_CD(+) IS NOT NULL AND DCREPU.DS_CONTR_MACH_LVL_NUM(+) = #dsContrMachLvlNum3# AND DCREPU.DS_CONTR_BASE_USG_NM(+) = #dsContrBaseUsgNmU#
            <!-- END 2019/06/04 K.Kitachi [QC#50350, MOD] -->
    )
    SELECT
         ROWNUM                           AS ROW_NUM
        ,MAIN.DS_CONTR_NUM                AS DS_CONTR_NUM
<!-- START 2018/11/05 K.Fujimoto [QC#28627,ADD] -->
        ,MAIN.CONTR_LINK_NUM              AS CONTR_LINK_NUM
<!-- END 2018/11/05 K.Fujimoto [QC#28627,ADD] -->
        ,MAIN.DS_CONTR_CATG_CD            AS DS_CONTR_CATG_CD
        ,MAIN.DS_CONTR_CATG_DESC_TXT      AS DS_CONTR_CATG_DESC_TXT
        ,MAIN.CONTR_VRSN_EFF_FROM_DT      AS CONTR_VRSN_EFF_FROM_DT
        ,MAIN.CONTR_VRSN_EFF_THRU_DT      AS CONTR_VRSN_EFF_THRU_DT
        ,MAIN.DS_CONTR_STS_CD             AS DS_CONTR_STS_CD
        ,MAIN.DS_CONTR_CTRL_STS_NM        AS DS_CONTR_CTRL_STS_NM
        ,MAIN.SVC_CONTR_BR_CD             AS SVC_CONTR_BR_CD
        ,MAIN.DS_CONTR_SQ_NUM             AS DS_CONTR_SQ_NUM
        ,MAIN.DS_CONTR_NM                 AS DS_CONTR_NM
        ,MAIN.PMT_TERM_CASH_DISC_CD       AS PMT_TERM_CASH_DISC_CD
        ,MAIN.SVC_CONTR_REF_CMNT_TXT      AS SVC_CONTR_REF_CMNT_TXT
        ,MAIN.BLLG_APVL_REQ_FLG           AS BLLG_APVL_REQ_FLG
        ,MAIN.CCY_CD                      AS CCY_CD
        ,MAIN.PRE_INV_REQ_FLG             AS PRE_INV_REQ_FLG
        ,MAIN.RNW_CPLT_FLG                AS RNW_CPLT_FLG
        ,MAIN.INV_SEPT_BASE_USG_FLG       AS INV_SEPT_BASE_USG_FLG
        ,MAIN.DS_CONTR_CRAT_DT            AS DS_CONTR_CRAT_DT
        ,MAIN.DS_CONTR_CRAT_PSN_CD        AS DS_CONTR_CRAT_PSN_CD
        ,MAIN.DS_CONTR_LAST_UPD_DT        AS DS_CONTR_LAST_UPD_DT
        ,MAIN.DS_CONTR_LAST_UPD_PSN_CD    AS DS_CONTR_LAST_UPD_PSN_CD
        ,MAIN.LEASE_CMPY_CD               AS LEASE_CMPY_CD
        ,MAIN.DS_ACCT_NUM                 AS DS_ACCT_NUM
        ,MAIN.TOC_CD                      AS TOC_CD
        ,MAIN.BASE_CHRG_TO_LEASE_CMPY_FLG AS BASE_CHRG_TO_LEASE_CMPY_FLG
        ,MAIN.USG_CHRG_TO_LEASE_CMPY_FLG  AS USG_CHRG_TO_LEASE_CMPY_FLG
        ,MAIN.MTR_EST_TP_CD               AS MTR_EST_TP_CD
        ,MAIN.PRC_ALLOC_BY_MACH_QTY_FLG   AS PRC_ALLOC_BY_MACH_QTY_FLG
        ,MAIN.DS_CONTR_CLS_CD             AS DS_CONTR_CLS_CD
        ,MAIN.CONTR_INV_CMNT_TXT          AS CONTR_INV_CMNT_TXT
        ,MAIN.CRAT_DRAFT_PSN_CD           AS CRAT_DRAFT_PSN_CD
        ,MAIN.SVC_LINE_BIZ_CD             AS SVC_LINE_BIZ_CD
        ,MAIN.DS_CONTR_PK                 AS DS_CONTR_PK
        ,MAIN.CONTR_EFF_FROM_DT           AS CONTR_EFF_FROM_DT
        ,MAIN.CONTR_EFF_THRU_DT           AS CONTR_EFF_THRU_DT
        ,MAIN.DS_CONTR_DTL_PK             AS DS_CONTR_DTL_PK
        ,MAIN.SVC_RG_NM                   AS SVC_RG_NM
        ,MAIN.DS_ACCT_NM                  AS DS_ACCT_NM
        ,MAIN.BILL_TO_CUST_CD             AS BILL_TO_CUST_CD
        ,MAIN.SER_NUM                     AS SER_NUM
        ,MAIN.SVC_MACH_MSTR_STS_CD        AS SVC_MACH_MSTR_STS_CD
        ,MAIN.SVC_MACH_MSTR_STS_NM        AS SVC_MACH_MSTR_STS_NM
        ,MAIN.SVC_MACH_MSTR_PK            AS SVC_MACH_MSTR_PK
        ,MAIN.T_MDL_ID                    AS T_MDL_ID
        ,MAIN.T_MDL_NM                    AS T_MDL_NM
        ,MAIN.PHYS_MTR_EXST_FLG           AS PHYS_MTR_EXST_FLG
        ,MAIN.NEXT_BLLG_DT                AS NEXT_BLLG_DT
        ,MAIN.BILL_TO_LOC_NM              AS BILL_TO_LOC_NM
        ,MAIN.DS_CONTR_CLS_DESC_TXT       AS DS_CONTR_CLS_DESC_TXT
        ,MAIN.BR_PSN_NM                   AS BR_PSN_NM
        ,MAIN.TOC_NM                      AS TOC_NM
        ,MAIN.DS_CONTR_RPT_GRP_DESC_TXT   AS DS_CONTR_RPT_GRP_DESC_TXT
        ,MAIN.DS_BILL_TGTR_FLG            AS DS_BILL_TGTR_FLG
        ,MAIN.MTR_EST_TP_DESC_TXT         AS MTR_EST_TP_DESC_TXT
        ,MAIN.DS_ACCT_NM_LS               AS DS_ACCT_NM_LS
        ,MAIN.CFS_LEASE_NUM_CMNT_TXT      AS CFS_LEASE_NUM_CMNT_TXT
        ,MAIN.PMT_TERM_CASH_DISC_DESC_TXT AS PMT_TERM_CASH_DISC_DESC_TXT
        ,MAIN.SVC_MACH_TP_DESC_TXT        AS SVC_MACH_TP_DESC_TXT
        ,MAIN.SVC_CONFIG_MSTR_PK          AS SVC_CONFIG_MSTR_PK
        ,MAIN.MDSE_CD                     AS MDSE_CD
        ,MAIN.MDSE_DESC_SHORT_TXT         AS MDSE_DESC_SHORT_TXT
        ,MAIN.SHIP_TO_CUST_CD             AS SHIP_TO_CUST_CD
        ,MAIN.SHIP_TO_LOC_NM              AS SHIP_TO_LOC_NM
        ,MAIN.SHIP_TO_CUST_LOC_ADDR       AS SHIP_TO_CUST_LOC_ADDR
        ,MAIN.MDSE_DESC_SHORT_TXT_SA      AS MDSE_DESC_SHORT_TXT_SA
        ,MAIN.MTR_READ_METH_DESC_TXT      AS MTR_READ_METH_DESC_TXT
        ,MAIN.CONTR_CLO_DT                AS CONTR_CLO_DT
        ,MAIN.RNW_EFF_FROM_DT             AS RNW_EFF_FROM_DT
        ,MAIN.CONTR_RNW_TOT_CNT           AS CONTR_RNW_TOT_CNT
        ,MAIN.BLLG_MTR_BILL_TO_CUST_CD    AS BLLG_MTR_BILL_TO_CUST_CD
        ,MAIN.BILL_TO_LOC_NM_BS           AS BILL_TO_LOC_NM_BS
        ,MAIN.BILL_TO_CUST_LOC_ADDR       AS BILL_TO_CUST_LOC_ADDR
        ,MAIN.BS_PSN_NM                   AS BS_PSN_NM
        ,MAIN.CUST_PO_NUM                 AS CUST_PO_NUM
        ,MAIN.PO_DT                       AS PO_DT
        ,MAIN.CR_CARD_CUST_REF_NUM        AS CR_CARD_CUST_REF_NUM
        ,MAIN.CR_CARD_EXPR_YR_MTH         AS CR_CARD_EXPR_YR_MTH
        ,MAIN.BASE_PRC_UP_RATIO           AS BASE_PRC_UP_RATIO
        ,MAIN.MTR_PRC_UP_RATIO            AS MTR_PRC_UP_RATIO
        ,MAIN.BEF_END_RNW_DAYS_AOT        AS BEF_END_RNW_DAYS_AOT
        ,MAIN.UPLFT_BASE_PRC_UP_RATIO     AS UPLFT_BASE_PRC_UP_RATIO
        ,MAIN.UPLFT_MTR_PRC_UP_RATIO      AS UPLFT_MTR_PRC_UP_RATIO
        ,MAIN.UPLFT_BEF_END_RNW_DAYS_AOT  AS UPLFT_BEF_END_RNW_DAYS_AOT
        ,MAIN.CONTR_AUTO_RNW_TP_DESC_TXT  AS CONTR_AUTO_RNW_TP_DESC_TXT
        ,MAIN.RNW_PRC_METH_DESC_TXT       AS RNW_PRC_METH_DESC_TXT
        ,MAIN.CONTR_UPLFT_TP_DESC_TXT     AS CONTR_UPLFT_TP_DESC_TXT
        ,MAIN.UPLFT_PRC_METH_DESC_TXT     AS UPLFT_PRC_METH_DESC_TXT

        ,CASE WHEN MAIN.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# THEN MAIN.BLLG_CYCLE_DESC_TXT_FA 
              ELSE MAIN.BLLG_CYCLE_DESC_TXT 
        END                               AS BLLG_CYCLE_DESC_TXT
        ,CASE WHEN MAIN.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# THEN MAIN.BASE_PRC_DEAL_AMT_FA 
              ELSE MAIN.BASE_PRC_DEAL_AMT 
        END                               AS BASE_PRC_DEAL_AMT
        ,CASE WHEN MAIN.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# THEN MAIN.BASE_PRC_TERM_DEAL_AMT_RATE_FA 
              ELSE MAIN.BASE_PRC_TERM_DEAL_AMT_RATE
        END                               AS BASE_PRC_TERM_DEAL_AMT_RATE
        ,CASE WHEN MAIN.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# THEN MAIN.BLLG_TMG_TP_DESC_TXT_FA 
              ELSE MAIN.BLLG_TMG_TP_DESC_TXT 
        END                               AS BLLG_TMG_TP_DESC_TXT
        ,CASE WHEN MAIN.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# THEN MAIN.CONTR_CLO_DAY_FA 
              ELSE MAIN.CONTR_CLO_DAY
        END                               AS CONTR_CLO_DAY
        ,CASE WHEN MAIN.DS_CONTR_CATG_CD = #dsContrCatgCdFleet# THEN MAIN.CONTR_BLLG_DAY_FA 
              ELSE MAIN.CONTR_BLLG_DAY 
        END                               AS CONTR_BLLG_DAY

        ,MAIN.DS_CONTR_CTRL_STS_NM_H      AS DS_CONTR_CTRL_STS_NM_H
        ,MAIN.SVC_BR_CD_DESC_TXT          AS SVC_BR_CD_DESC_TXT
        ,MAIN.SVC_MEMO_RSN_DESC_TXT       AS SVC_MEMO_RSN_DESC_TXT
        <!-- START 2022/03/22 [QC#59683, ADD] -->
        ,MAIN.DS_INV_TGTR_TP_DESC_TXT     AS DS_INV_TGTR_TP_DESC_TXT
        <!-- END   2022/03/22 [QC#59683, ADD] -->
        <!-- START 2024/02/07 K.Watanabe [QC#63464, ADD] -->
        ,TCC.ROW_CNT                      AS ROW_CNT
        <!-- END 2024/02/07 K.Watanabe [QC#63464, ADD] -->
    FROM
        (
            SELECT
                 TC.*
                ,NBD.NEXT_BLLG_DT
                <!-- START 2019/01/19 T.Tomita [QC#26928,MOD] -->
                ,PO_NUM.CUST_PO_NUM                  AS CUST_PO_NUM
                ,PO_NUM.PO_DT                        AS PO_DT
                ,CR_CARD.CR_CARD_CUST_REF_NUM        AS CR_CARD_CUST_REF_NUM
                ,CR_CARD.CR_CARD_EXPR_YR_MTH         AS CR_CARD_EXPR_YR_MTH
                <!-- END 2019/01/19 T.Tomita [QC#26928,MOD] -->
                ,RNW_ESCL.BASE_PRC_UP_RATIO          AS BASE_PRC_UP_RATIO
                ,RNW_ESCL.MTR_PRC_UP_RATIO           AS MTR_PRC_UP_RATIO
                ,RNW_ESCL.BEF_END_RNW_DAYS_AOT       AS BEF_END_RNW_DAYS_AOT
                ,RNW_ESCL.UPLFT_BASE_PRC_UP_RATIO    AS UPLFT_BASE_PRC_UP_RATIO
                ,RNW_ESCL.UPLFT_MTR_PRC_UP_RATIO     AS UPLFT_MTR_PRC_UP_RATIO
                ,RNW_ESCL.UPLFT_BEF_END_RNW_DAYS_AOT AS UPLFT_BEF_END_RNW_DAYS_AOT
                ,RNW_ESCL.CONTR_AUTO_RNW_TP_DESC_TXT AS CONTR_AUTO_RNW_TP_DESC_TXT
                ,RNW_ESCL.RNW_PRC_METH_DESC_TXT      AS RNW_PRC_METH_DESC_TXT
                ,RNW_ESCL.CONTR_UPLFT_TP_DESC_TXT    AS CONTR_UPLFT_TP_DESC_TXT
                ,RNW_ESCL.UPLFT_PRC_METH_DESC_TXT    AS UPLFT_PRC_METH_DESC_TXT
<!-- START 2018/09/05 K.Kojima [QC#28061,ADD] -->
                ,DCSV.DS_CONTR_CTRL_STS_NM           AS DS_CONTR_CTRL_STS_NM_H
                ,CASE
                     WHEN     DCDS.DS_CONTR_CTRL_STS_CD = #entered#
                         AND  TC.SVC_MACH_MSTR_STS_CD   = #w4i#
                     THEN #pendingInstallation#
                     WHEN     DCDS.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdActive#
                         AND  TC.DS_CONTR_CATG_CD &lt;&gt; #dsContrCatgCdFleet#
                         AND (
                              SELECT
                                  COUNT(*)
                              FROM
                                   DS_CONTR_PRC_EFF       DCPE
                              WHERE
                                    DCPE.GLBL_CMPY_CD           = TC.GLBL_CMPY_CD
                                AND DCPE.DS_CONTR_DTL_PK        = TC.DS_CONTR_DTL_PK
                                AND DCPE.EZCANCELFLAG           = '0'
                                AND DCPE.DS_CONTR_PRC_EFF_STS_CD = #dsContrCtrlStsCdRenewalHoldForPO#
                             ) &gt; 0
                     THEN #activePendingPO#
                     WHEN     DCDS.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdActive#
                         AND  TC.DS_CONTR_CATG_CD       = #dsContrCatgCdFleet#
                         AND (
                              SELECT
                                  COUNT(*)
                              FROM
                                   DS_CONTR_DTL           DCDF
                                  ,DS_CONTR_PRC_EFF       DCPE
                              WHERE
                                    DCDF.GLBL_CMPY_CD           = TC.GLBL_CMPY_CD
                                AND DCDF.DS_CONTR_PK            = TC.DS_CONTR_PK
                                AND DCDF.DS_CONTR_DTL_TP_CD     = #dsContrDtlTpCdFleet#
                                AND DCDF.EZCANCELFLAG           = '0'
                                AND DCDF.GLBL_CMPY_CD           = DCPE.GLBL_CMPY_CD
                                AND DCDF.DS_CONTR_DTL_PK        = DCPE.DS_CONTR_DTL_PK
                                AND DCPE.EZCANCELFLAG           = '0'
                                AND DCPE.DS_CONTR_PRC_EFF_STS_CD = #dsContrCtrlStsCdRenewalHoldForPO#
                             ) &gt; 0
                     THEN #activePendingPO#
                     WHEN     DCDS.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdActive#
                         AND  TC.DS_CONTR_CATG_CD &lt;&gt; #dsContrCatgCdFleet#
                         AND (
                              SELECT
                                  COUNT(*)
                              FROM
                                   DS_CONTR_PRC_EFF       DCPE
                              WHERE
                                    DCPE.GLBL_CMPY_CD           = TC.GLBL_CMPY_CD
                                AND DCPE.DS_CONTR_DTL_PK        = TC.DS_CONTR_DTL_PK
                                AND DCPE.EZCANCELFLAG           = '0'
                                AND DCPE.DS_CONTR_PRC_EFF_STS_CD = #dsContrCtrlStsCdRenewalHold#
                             ) &gt; 0
                     THEN #activeRenewalHold#
                     WHEN     DCDS.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCdActive#
                         AND  TC.DS_CONTR_CATG_CD       = #dsContrCatgCdFleet#
                         AND (
                              SELECT
                                  COUNT(*)
                              FROM
                                   DS_CONTR_DTL           DCDF
                                  ,DS_CONTR_PRC_EFF       DCPE
                              WHERE
                                    DCDF.GLBL_CMPY_CD           = TC.GLBL_CMPY_CD
                                AND DCDF.DS_CONTR_PK            = TC.DS_CONTR_PK
                                AND DCDF.DS_CONTR_DTL_TP_CD     = #dsContrDtlTpCdFleet#
                                AND DCDF.EZCANCELFLAG           = '0'
                                AND DCDF.GLBL_CMPY_CD           = DCPE.GLBL_CMPY_CD
                                AND DCDF.DS_CONTR_DTL_PK        = DCPE.DS_CONTR_DTL_PK
                                AND DCPE.EZCANCELFLAG           = '0'
                                AND DCPE.DS_CONTR_PRC_EFF_STS_CD = #dsContrCtrlStsCdRenewalHold#
                             ) &gt; 0
                     THEN #activeRenewalHold#
                     <!-- START 2022/02/04 K.Kitachi [QC#59684, ADD] -->
                     WHEN     DCDS.QLTY_ASRN_HLD_FLG    = 'N'
                         AND  TC.MAN_TRMN_TP_CD         = #manTrmnTpCd#
                     THEN #allPeriodTermination#
                     <!-- END 2022/02/04 K.Kitachi [QC#59684, ADD] -->
                     ELSE DCDS.DS_CONTR_CTRL_STS_NM
                 END                            AS DS_CONTR_CTRL_STS_NM 
<!-- END 2018/09/05 K.Kojima [QC#28061,ADD] -->
            FROM
                 TARGET_CONTR TC
                ,NEXT_BLLG_DT NBD
                <!-- START 2019/01/19 T.Tomita [QC#26928,MOD] -->
                ,PO_NUM       PO_NUM
                ,CR_CARD      CR_CARD
                <!-- END 2019/01/19 T.Tomita [QC#26928,MOD] -->
                ,RNW_ESCL     RNW_ESCL
<!-- START 2018/09/05 K.Kojima [QC#28061,ADD] -->
                ,DS_CONTR_STS_V     DCSV
                ,DS_CONTR_DTL_STS_V DCDS
<!-- END 2018/09/05 K.Kojima [QC#28061,ADD] -->
            WHERE
            <!-- START 2019/06/04 K.Kitachi [QC#50350, MOD] -->
                TC.DS_CONTR_PK              = NBD.DS_CONTR_PK
            AND NVL(TC.DS_CONTR_DTL_PK, -1) = NVL(NBD.DS_CONTR_DTL_PK, -1)
            <!-- START 2019/01/19 T.Tomita [QC#26928,MOD] -->
            AND TC.DS_CONTR_PK              = PO_NUM.DS_CONTR_PK
            AND NVL(TC.DS_CONTR_DTL_PK, -1) = NVL(PO_NUM.DS_CONTR_DTL_PK, -1)
            AND TC.DS_CONTR_PK              = CR_CARD.DS_CONTR_PK
            AND NVL(TC.DS_CONTR_DTL_PK, -1) = NVL(CR_CARD.DS_CONTR_DTL_PK, -1)
            <!-- END 2019/01/19 T.Tomita [QC#26928,MOD] -->
            AND TC.DS_CONTR_PK              = RNW_ESCL.DS_CONTR_PK
            AND NVL(TC.DS_CONTR_DTL_PK, -1) = NVL(RNW_ESCL.DS_CONTR_DTL_PK, -1)
            <!-- END 2019/06/04 K.Kitachi [QC#50350, MOD] -->
<!-- START 2018/09/05 K.Kojima [QC#28061,ADD] -->
            AND TC.GLBL_CMPY_CD         = DCSV.GLBL_CMPY_CD
            AND TC.DS_CONTR_PK          = DCSV.DS_CONTR_PK
            AND DCSV.EZCANCELFLAG       = '0'
            AND TC.GLBL_CMPY_CD         = DCDS.GLBL_CMPY_CD (+)
            AND TC.DS_CONTR_PK          = DCDS.DS_CONTR_PK (+)
            AND TC.DS_CONTR_DTL_PK      = DCDS.DS_CONTR_DTL_PK (+)
            AND DCDS.EZCANCELFLAG (+)   = '0'
<!-- END 2018/09/05 K.Kojima [QC#28061,ADD] -->
            ORDER BY
                 TC.DS_CONTR_NUM
                ,TC.SORT_SER_NUM
                ,TC.SORT_DS_CONTR_DTL_TP
                ,TC.DS_CONTR_DTL_PK
        ) MAIN
        ,TARGET_CONTR_CNT TCC
    </statement>

    <resultMap id="result.getSearchData"        class="NSAL0620_ASMsg">
        <result property="xxRowNum_A"           column="ROW_NUM"                javaType="EZDSBigDecimalItem"/>
        <result property="dsContrPk_A"          column="DS_CONTR_PK"            javaType="EZDSBigDecimalItem"/>
        <result property="dsContrDtlPk_A"       column="DS_CONTR_DTL_PK"        javaType="EZDSBigDecimalItem"/>
        <result property="svcMachMstrPk_A"      column="SVC_MACH_MSTR_PK"       javaType="EZDSBigDecimalItem"/>
        <result property="dsContrNum_A"         column="DS_CONTR_NUM"           javaType="EZDSStringItem"/>
        <result property="dsContrCatgCd_A"      column="DS_CONTR_CATG_CD"       javaType="EZDSStringItem"/>
<!-- START 2018/06/05 T.Ogura [QC#21159,MOD] -->
<!--    <result property="dsContrCatgNm_A"      column="DS_CONTR_CATG_NM"       javaType="EZDSStringItem"/> -->
        <result property="dsContrCatgDescTxt_A" column="DS_CONTR_CATG_DESC_TXT" javaType="EZDSStringItem"/>
<!-- END   2018/06/05 T.Ogura [QC#21159,MOD]-->
<!-- START 2018/06/05 T.Wada [QC#26424,MOD] -->
        <result property="dsAcctNum_A"          column="DS_ACCT_NUM"            javaType="EZDSStringItem"/>
<!-- END 2018/06/05 T.Wada [QC#26424,MOD] -->
        <result property="dsAcctNm_A"           column="DS_ACCT_NM"             javaType="EZDSStringItem"/>
<!-- START 2018/06/05 T.Wada [QC#26424,MOD] -->
        <result property="altPayerCustCd_A"     column="BILL_TO_CUST_CD"        javaType="EZDSStringItem"/>
        <result property="billToLocNm_A"        column="BILL_TO_LOC_NM"         javaType="EZDSStringItem"/>
<!-- END 2018/06/05 T.Wada [QC#26424,MOD] -->
        <result property="contrVrsnEffFromDt_A" column="CONTR_VRSN_EFF_FROM_DT" javaType="EZDSDateItem"/>
        <result property="contrVrsnEffThruDt_A" column="CONTR_VRSN_EFF_THRU_DT" javaType="EZDSDateItem"/>
        <result property="dsContrCtrlStsNm_A"   column="DS_CONTR_CTRL_STS_NM"   javaType="EZDSStringItem"/>
        <result property="svcRgNm_A"            column="SVC_RG_NM"              javaType="EZDSStringItem"/>
        <result property="svcContrBrCd_A"       column="SVC_CONTR_BR_CD"        javaType="EZDSStringItem"/>

<!-- START 2018/06/05 T.Wada [QC#26424,MOD] -->
        <result property="dsContrStsDescTxt_A"           column="DS_CONTR_CTRL_STS_NM_H"           javaType="EZDSStringItem"/>
        <result property="dsContrClsDescTxt_A"           column="DS_CONTR_CLS_DESC_TXT"            javaType="EZDSStringItem"/>
        <result property="xxPsnNm_BR"                    column="BR_PSN_NM"                        javaType="EZDSStringItem"/>
        <result property="tocNm_A"                       column="TOC_NM"                           javaType="EZDSStringItem"/>
        <result property="svcContrRefCmntTxt_A"          column="SVC_CONTR_REF_CMNT_TXT"           javaType="EZDSStringItem"/>
        <result property="dsContrRptGrpDescTxt_A"        column="DS_CONTR_RPT_GRP_DESC_TXT"        javaType="EZDSStringItem"/>
        <result property="dsContrNm_A"                   column="DS_CONTR_NM"                      javaType="EZDSStringItem"/>
        <result property="contrInvCmntTxt_A"             column="CONTR_INV_CMNT_TXT"               javaType="EZDSStringItem"/>
        <!-- START 2022/03/22 [QC#59683, MOD] -->
        <!-- <result property="dsBillTgtrFlg_A"               column="DS_BILL_TGTR_FLG"                 javaType="EZDSStringItem"/> -->
        <result property="dsInvTgtrTpDescTxt_A"          column="DS_INV_TGTR_TP_DESC_TXT"          javaType="EZDSStringItem"/>
        <!-- END   2022/03/22 [QC#59683, MOD] -->
        <result property="prcAllocByMachQtyFlg_A"        column="PRC_ALLOC_BY_MACH_QTY_FLG"        javaType="EZDSStringItem"/>
        <result property="mtrEstTpDescTxt_A"             column="MTR_EST_TP_DESC_TXT"              javaType="EZDSStringItem"/>
        <result property="dsAcctNm_LS"                   column="DS_ACCT_NM_LS"                    javaType="EZDSStringItem"/>
        <result property="baseChrgToLeaseCmpyFlg_A"      column="BASE_CHRG_TO_LEASE_CMPY_FLG"      javaType="EZDSStringItem"/>
        <result property="usgChrgToLeaseCmpyFlg_A"       column="USG_CHRG_TO_LEASE_CMPY_FLG"       javaType="EZDSStringItem"/>
        <result property="cfsLeaseNumCmntTxt_A"          column="CFS_LEASE_NUM_CMNT_TXT"           javaType="EZDSStringItem"/>
        <result property="custPoNum_A"                   column="CUST_PO_NUM"                      javaType="EZDSStringItem"/>
        <result property="poDt_A"                        column="PO_DT"                            javaType="EZDSDateItem"/>
        <result property="crCardCustRefNum_A"            column="CR_CARD_CUST_REF_NUM"             javaType="EZDSStringItem"/>
        <result property="crCardExprYrMth_A"             column="CR_CARD_EXPR_YR_MTH"              javaType="EZDSDateItem"/>
        <result property="pmtTermCashDiscDescTxt_A"      column="PMT_TERM_CASH_DISC_DESC_TXT"      javaType="EZDSStringItem"/>
        <result property="contrAutoRnwTpDescTxt_A"       column="CONTR_AUTO_RNW_TP_DESC_TXT"       javaType="EZDSStringItem"/>
        <result property="rnwPrcMethDescTxt_A"           column="RNW_PRC_METH_DESC_TXT"            javaType="EZDSStringItem"/>
        <result property="basePrcUpRatio_A"              column="BASE_PRC_UP_RATIO"                javaType="EZDSBigDecimalItem"/>
        <result property="mtrPrcUpRatio_A"               column="MTR_PRC_UP_RATIO"                 javaType="EZDSBigDecimalItem"/>
        <result property="befEndRnwDaysAot_A"            column="BEF_END_RNW_DAYS_AOT"             javaType="EZDSBigDecimalItem"/>
        <result property="contrUplftTpDescTxt_A"         column="CONTR_UPLFT_TP_DESC_TXT"          javaType="EZDSStringItem"/>
        <result property="uplftPrcMethDescTxt_A"         column="UPLFT_PRC_METH_DESC_TXT"          javaType="EZDSStringItem"/>
        <result property="uplftBasePrcUpRatio_A"         column="UPLFT_BASE_PRC_UP_RATIO"          javaType="EZDSBigDecimalItem"/>
        <result property="uplftMtrPrcUpRatio_A"          column="UPLFT_MTR_PRC_UP_RATIO"           javaType="EZDSBigDecimalItem"/>
        <result property="uplftBefEndRnwDaysAot_A"       column="UPLFT_BEF_END_RNW_DAYS_AOT"       javaType="EZDSBigDecimalItem"/>
<!-- START 2018/11/05 K.Fujimoto [QC#28627,ADD] -->
        <result property="contrLinkNum_A"       column="CONTR_LINK_NUM"         javaType="EZDSStringItem"/>
<!-- END 2018/11/05 K.Fujimoto [QC#28627,ADD] -->
<!-- END 2018/06/05 T.Wada [QC#26424,MOD] -->
        <result property="serNum_A"             column="SER_NUM"                javaType="EZDSStringItem"/>
        <result property="t_MdlNm_A"            column="T_MDL_NM"               javaType="EZDSStringItem"/>
<!-- START 2017/02/28 K.Kitachi [QC#17749, ADD] -->
        <result property="xxExstFlg_PM"         column="PHYS_MTR_EXST_FLG"      javaType="EZDSStringItem"/>
<!-- END 2017/02/28 K.Kitachi [QC#17749, ADD] -->
        <result property="contrEffFromDt_A"     column="CONTR_EFF_FROM_DT"      javaType="EZDSDateItem"/>
        <result property="contrEffThruDt_A"     column="CONTR_EFF_THRU_DT"      javaType="EZDSDateItem"/>
        <result property="svcMachMstrStsCd_A"   column="SVC_MACH_MSTR_STS_CD"   javaType="EZDSStringItem"/>
        <result property="svcMachMstrStsNm_A"   column="SVC_MACH_MSTR_STS_NM"   javaType="EZDSStringItem"/>
        <result property="nextBllgDt_A"         column="NEXT_BLLG_DT"           javaType="EZDSDateItem"/>
<!-- START 2018/06/05 T.Wada [QC#26424,MOD] -->
        <result property="svcMachTpDescTxt_A"     column="SVC_MACH_TP_DESC_TXT"          javaType="EZDSStringItem"/>
        <result property="svcMachMstrPk_IB"       column="SVC_MACH_MSTR_PK"              javaType="EZDSBigDecimalItem"/>
        <result property="svcConfigMstrPk_A"      column="SVC_CONFIG_MSTR_PK"            javaType="EZDSBigDecimalItem"/>
        <result property="mdseCd_A"               column="MDSE_CD"                       javaType="EZDSStringItem"/>
        <result property="mdseDescShortTxt_A"     column="MDSE_DESC_SHORT_TXT"           javaType="EZDSStringItem"/>
        <result property="shipToCustCd_A"         column="SHIP_TO_CUST_CD"               javaType="EZDSStringItem"/>
        <result property="shipToLocNm_A"          column="SHIP_TO_LOC_NM"                javaType="EZDSStringItem"/>
        <result property="shipToCustLocAddr_A"    column="SHIP_TO_CUST_LOC_ADDR"         javaType="EZDSStringItem"/>
        <result property="svcBrCdDescTxt_A"       column="SVC_BR_CD_DESC_TXT"            javaType="EZDSStringItem"/>
        <result property="mdseDescShortTxt_SA"    column="MDSE_DESC_SHORT_TXT_SA"        javaType="EZDSStringItem"/>
        <result property="mtrReadMethDescTxt_A"   column="MTR_READ_METH_DESC_TXT"        javaType="EZDSStringItem"/>
        <result property="contrCloDt_A"           column="CONTR_CLO_DT"                  javaType="EZDSDateItem"/>
        <result property="svcMemoRsnDescTxt_A"    column="SVC_MEMO_RSN_DESC_TXT"         javaType="EZDSStringItem"/>
        <result property="rnwEffFromDt_A"         column="RNW_EFF_FROM_DT"               javaType="EZDSDateItem"/>
        <result property="contrRnwTotCnt_A"       column="CONTR_RNW_TOT_CNT"             javaType="EZDSBigDecimalItem"/>
        <result property="bllgMtrBillToCustCd_A"  column="BLLG_MTR_BILL_TO_CUST_CD"      javaType="EZDSStringItem"/>
        <result property="billToLocNm_BS"         column="BILL_TO_LOC_NM_BS"             javaType="EZDSStringItem"/>
        <result property="billToCustLocAddr_A"    column="BILL_TO_CUST_LOC_ADDR"         javaType="EZDSStringItem"/>
        <result property="xxPsnNm_BS"             column="BS_PSN_NM"                     javaType="EZDSStringItem"/>
        <result property="bllgCycleDescTxt_A"     column="BLLG_CYCLE_DESC_TXT"           javaType="EZDSStringItem"/>
        <result property="basePrcDealAmt_A"       column="BASE_PRC_DEAL_AMT"             javaType="EZDSBigDecimalItem"/>
        <result property="basePrcTermDealAmtRate_A" column="BASE_PRC_TERM_DEAL_AMT_RATE" javaType="EZDSBigDecimalItem"/>
        <result property="bllgTmgTpDescTxt_A"     column="BLLG_TMG_TP_DESC_TXT"          javaType="EZDSStringItem"/>
        <result property="xxCntnrTxt_CD"          column="CONTR_CLO_DAY"                 javaType="EZDSStringItem"/>
        <result property="xxCntnrTxt_BD"          column="CONTR_BLLG_DAY"                javaType="EZDSStringItem"/>
        <!-- START 2024/02/07 K.Watanabe [QC#63464, ADD] -->
        <result property="xxSrchCnt_A"            column="ROW_CNT"                       javaType="EZDSBigDecimalItem"/>
        <!-- END 2024/02/07 K.Watanabe [QC#63464, ADD] -->
<!-- END 2018/06/05 T.Wada [QC#26424,MOD] -->
    </resultMap>

<!-- START 2018/07/23 K.Kim [QC#26831, MOD] -->
<!-- add start 2016/07/28 CSA Defect#6923 -->
    <statement id="getContrForManualRenew" parameterClass="Map" resultClass="Map">
        SELECT
            DISTINCT RE.DS_CONTR_PK
                    ,DC.CONTR_RNW_AVAL_FLG
        FROM
             DS_CONTR_RNW_ESCL   RE
            ,CONTR_AUTO_RNW_TP   TP
            ,DS_CONTR_STS_V      DC
        WHERE
                 RE.GLBL_CMPY_CD         = #glblCmpyCd#
             AND RE.EZCANCELFLAG         = '0'
             <iterate property="dsContrPkList" var="dsContrPk[]" open="AND RE.DS_CONTR_PK IN (" close=")" conjunction=",">
                 #dsContrPk[]#
             </iterate>
             AND RE.GLBL_CMPY_CD         = TP.GLBL_CMPY_CD
             AND RE.CONTR_AUTO_RNW_TP_CD = TP.CONTR_AUTO_RNW_TP_CD
             AND TP.EZCANCELFLAG         = '0'
<!-- START 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
<!-- AND TP.AUTO_RNW_FLG         = 'N' -->
<!-- END 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
             AND (    TP.RNW_BASE_FLG    = 'Y'
                  OR  TP.RNW_USG_FLG     = 'Y')
             AND RE.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD
             AND RE.DS_CONTR_PK          = DC.DS_CONTR_PK
             AND DC.EZCANCELFLAG         = '0'
    </statement>
<!-- add end 2016/07/28 CSA Defect#6923 -->
<!-- END 2018/07/23 K.Kim [QC#26831, MOD] -->
<!-- add start 2016/08/09 CSA Defect#6322 -->
    <statement id="getParentAcct" parameterClass="Map" resultClass="Map">
        WITH ACCT_INFO(DS_ACCT_NUM, RELN_DS_ACCT_NUM, LV) AS (
            SELECT
                A.SELL_TO_CUST_CD AS DS_ACCT_NUM
                ,B.RELN_DS_ACCT_NUM
                ,1 AS LV
            FROM
                SELL_TO_CUST A
                ,DS_ACCT_RELN B
            WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.DS_ACCT_NM            = #dsAcctNm#
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD(+)
            AND A.SELL_TO_CUST_CD       = B.DS_ACCT_NUM(+)
            AND B.DS_ACCT_RELN_TP_CD(+) = #parentAcct#
            AND B.RGTN_STS_CD(+)        = #p20#
            AND B.EZCANCELFLAG(+)       = '0'
            UNION ALL
            SELECT
                B.DS_ACCT_NUM
                ,B.RELN_DS_ACCT_NUM
                ,A.LV + 1 AS LV
            FROM
                DS_ACCT_RELN B
                ,ACCT_INFO A
            WHERE
                B.GLBL_CMPY_CD          = #glblCmpyCd#
            AND B.DS_ACCT_NUM           = A.RELN_DS_ACCT_NUM
            AND B.DS_ACCT_RELN_TP_CD    = #parentAcct#
            AND B.RGTN_STS_CD           = #p20#
            AND B.EZCANCELFLAG          = '0'
            AND A.LV + 1 &lt;= 5
        )
        SELECT
            DS_ACCT_NUM
            ,RELN_DS_ACCT_NUM
            ,LV
        FROM
            ACCT_INFO C
    </statement>
    <statement id="getChildAcct" parameterClass="Map" resultClass="Map">
        WITH ACCT_INFO(DS_ACCT_NUM, RELN_DS_ACCT_NUM, LV) AS (
            SELECT
                B.DS_ACCT_NUM
                ,B.RELN_DS_ACCT_NUM
                ,1 AS LV
            FROM
                SELL_TO_CUST A
                ,DS_ACCT_RELN B
            WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.DS_ACCT_NM            = #dsAcctNm#
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD(+)
            AND A.SELL_TO_CUST_CD       = B.RELN_DS_ACCT_NUM(+)
            AND B.DS_ACCT_RELN_TP_CD(+) = #parentAcct#
            AND B.RGTN_STS_CD(+)        = #p20#
            AND B.EZCANCELFLAG(+)       = '0'
            UNION ALL
            SELECT
                B.DS_ACCT_NUM
                ,B.RELN_DS_ACCT_NUM
                ,A.LV + 1 AS LV
            FROM
                DS_ACCT_RELN B
                ,ACCT_INFO A
            WHERE
                B.GLBL_CMPY_CD          = #glblCmpyCd#
            AND B.RELN_DS_ACCT_NUM      = A.DS_ACCT_NUM
            AND B.DS_ACCT_RELN_TP_CD    = #parentAcct#
            AND B.RGTN_STS_CD           = #p20#
            AND B.EZCANCELFLAG          = '0'
            AND A.LV + 1 &lt;= 5
        )
        SELECT
            DS_ACCT_NUM
            ,RELN_DS_ACCT_NUM
            ,LV
        FROM
            ACCT_INFO C
    </statement>
<!-- add end 2016/08/09 CSA Defect#6322 -->
<!-- START 2017/08/21 E.Kameishi [QC#8661,ADD] -->
    <statement id="getContrDtlList" parameterClass="Map" resultClass="Map">
        SELECT
                DCD.DS_CONTR_PK
               ,DCD.DS_CONTR_DTL_PK
               ,DC.DS_CONTR_CATG_CD
        FROM
                DS_CONTR_DTL DCD
               ,DS_CONTR DC
        WHERE
                DCD.GLBL_CMPY_CD         = #glblCmpyCd#
        <iterate property="dsContrDtlPkList" var="dsContrDtlPk[]" open="AND DCD.DS_CONTR_DTL_PK IN (" close=")" conjunction=",">
                #dsContrDtlPk[]#
        </iterate>
        AND     DCD.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD
        AND     DCD.DS_CONTR_PK          = DC.DS_CONTR_PK
        AND     DCD.EZCANCELFLAG         = '0'
        AND     DC.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getWrkDataForRegAndAgg" parameterClass="Map" resultClass="Map">
        WITH BLLG_MTR AS (
                SELECT
                     CPE.GLBL_CMPY_CD
                    ,CPE.DS_CONTR_DTL_PK
                    ,CPE.DS_CONTR_BLLG_MTR_PK
                    ,CPE.DS_CONTR_PRC_EFF_SQ_NUM
                    ,CPE.BLLG_CYCLE_CD
                    ,CBM.BLLG_MTR_LB_CD
<!-- START 2021/07/15 L.Mandanas [QC#58314-1, MOD] -->
<!--                     ,CBM.SVC_PHYS_MTR_PK -->
<!-- START 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
<!--                     ,CPB.SVC_PHYS_MTR_PK -->
<!-- END 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
<!-- END 2021/07/15 L.Mandanas [QC#58314-1, MOD] -->
                    ,ML.MTR_LB_SORT_NUM
                    ,ML.MTR_LB_DESC_TXT
                    ,CPE.CONTR_PRC_EFF_THRU_DT
                    ,PEM.CONTR_XS_COPY_PK
                    ,PEM.XS_MTR_COPY_QTY
                    ,PEM.XS_MTR_AMT_RATE
                    ,PEM.XS_MTR_FIRST_FLG   
                    ,(
                    SELECT 
                        NVL(MIN (NEXT.XS_MTR_COPY_QTY), 0)
                    FROM
                        (
                        SELECT
                            PEM_NEXT.XS_MTR_COPY_QTY
                        FROM
                            DS_CONTR_PRC_EFF_MTR    PEM_NEXT
                        WHERE
                                PEM_NEXT.GLBL_CMPY_CD      = #glblCmpyCd#
                            AND PEM_NEXT.EZCANCELFLAG      = '0'
                            AND PEM_NEXT.DS_CONTR_PRC_EFF_PK  = PEM.DS_CONTR_PRC_EFF_PK
                            AND PEM_NEXT.XS_MTR_COPY_QTY &gt; PEM.XS_MTR_COPY_QTY 
                        )    NEXT
                    ) AS XS_MTR_COPY_THRU_QTY_TXT
<!-- START 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
                    ,CBM.CUM_COPY_CNT
                    ,CBM.CUM_COPY_FREQ_MTH_AOT
                    ,CBM.CUM_COPY_END_DT
<!-- END 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
                FROM
                     DS_CONTR_PRC_EFF           CPE
                    ,DS_CONTR_PRC_EFF_MTR       PEM
<!-- START 2021/07/15 L.Mandanas [QC#58314-1, MOD] -->
<!--                ,CONTR_PHYS_BLLG_MTR_RELN   CBM -->
<!-- START 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
<!--                     ,CONTR_PHYS_BLLG_MTR_RELN   CPB  -->
<!-- END 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
                    ,DS_CONTR_BLLG_MTR          CBM
<!-- END 2021/07/15 L.Mandanas [QC#58314-1, MOD] -->
                    ,MTR_LB                     ML
                WHERE
                        CPE.GLBL_CMPY_CD                = #glblCmpyCd#
                    AND CPE.USG_CHRG_FLG                = 'Y'
                    AND CPE.EZCANCELFLAG                = '0'
                    AND CPE.DS_CONTR_PRC_EFF_PK         = PEM.DS_CONTR_PRC_EFF_PK
                    AND CPE.GLBL_CMPY_CD                = PEM.GLBL_CMPY_CD
                    AND PEM.EZCANCELFLAG                = '0'
                    AND CPE.DS_CONTR_BLLG_MTR_PK        = CBM.DS_CONTR_BLLG_MTR_PK
                    AND CPE.GLBL_CMPY_CD                = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG                = '0'
                    AND CBM.GLBL_CMPY_CD                = ML.GLBL_CMPY_CD
                    AND CBM.BLLG_MTR_LB_CD              = ML.MTR_LB_CD
                    AND ML.EZCANCELFLAG                 = '0'
<!-- START 2021/07/15 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
<!--                     AND CPE.DS_CONTR_BLLG_MTR_PK        = CPB.DS_CONTR_BLLG_MTR_PK -->
<!--                    AND CPE.GLBL_CMPY_CD                = CPB.GLBL_CMPY_CD -->
<!--                    AND CPB.EZCANCELFLAG                = '0' -->
<!--                    AND CPB.GLBL_CMPY_CD                = ML.GLBL_CMPY_CD -->
<!--                    AND CPB.BLLG_MTR_LB_CD              = ML.MTR_LB_CD   -->
<!-- END 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
<!-- END 2021/07/15 L.Mandanas [QC#58314-1, ADD] -->
                ORDER BY CPE.DS_CONTR_DTL_PK,PEM.DS_CONTR_PRC_EFF_PK, PEM.XS_MTR_COPY_QTY

        )
        ,BASE AS (
                SELECT
                     CPE.GLBL_CMPY_CD
                    ,CPE.DS_CONTR_DTL_PK
                    ,CPE.BASE_PRC_DEAL_AMT
                    ,CPE.DS_CONTR_PRC_EFF_SQ_NUM
                    ,CPE.CONTR_PRC_EFF_THRU_DT
                    ,CPE.BLLG_CYCLE_CD
                FROM
                     DS_CONTR_PRC_EFF           CPE
                WHERE
                        CPE.GLBL_CMPY_CD                = #glblCmpyCd#
                    AND CPE.BASE_CHRG_FLG               = 'Y'
                    AND CPE.EZCANCELFLAG                = '0'
        )
        SELECT
             '1'                        AS LINE_LV
            ,DCD.DS_CONTR_PK
            ,DCD.DS_CONTR_DTL_PK
            ,DC.DS_CONTR_CATG_CD
<!-- START 2021/01/29 Y.Penequito [QC#58312,ADD] -->
            ,DCD.SVC_INV_MERGE_TP_CD
            ,DCD.PRNT_DS_CONTR_DTL_PK
<!-- END 2021/01/29 Y.Penequito [QC#58312,ADD] -->
            ,0                          AS DS_CONTR_BLLG_MTR_PK
<!-- START 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
<!--             ,0                          AS SVC_PHYS_MTR_PK  -->
<!-- END 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
            ,0                          AS MTR_LB_SORT_NUM
            ,TOC.TOC_NM
            ,BT.BILL_TO_CUST_CD
            ,BT.LOC_NUM                 AS BILL_TO_LOC_NM
            ,BT.FIRST_LINE_ADDR         AS BILL_TO_FIRST_LINE_ADDR
            ,BT.SCD_LINE_ADDR           AS BILL_TO_SCD_LINE_ADDR
            ,BT.THIRD_LINE_ADDR         AS BILL_TO_THIRD_LINE_ADDR
            ,BT.FRTH_LINE_ADDR          AS BILL_TO_FRTH_LINE_ADDR
            ,BT.CTY_ADDR                AS BILL_TO_CTY_ADDR
            ,BT.ST_CD                   AS BILL_TO_ST_CD
            ,BT.POST_CD                 AS BILL_TO_POST_CD
            ,CTRY_B.CTRY_NM             AS BILL_TO_CTRY_NM
            ,ST.SHIP_TO_CUST_CD
            ,ST.LOC_NUM                 AS SHIP_TO_LOC_NM
            ,ST.FIRST_LINE_ADDR         AS SHIP_TO_FIRST_LINE_ADDR
            ,ST.SCD_LINE_ADDR           AS SHIP_TO_SCD_LINE_ADDR
            ,ST.THIRD_LINE_ADDR         AS SHIP_TO_THIRD_LINE_ADDR
            ,ST.FRTH_LINE_ADDR          AS SHIP_TO_FRTH_LINE_ADDR
            ,ST.CTY_ADDR                AS SHIP_TO_CTY_ADDR
            ,ST.ST_CD                   AS SHIP_TO_ST_CD
            ,ST.POST_CD                 AS SHIP_TO_POST_CD
            ,CTRY_S.CTRY_NM             AS SHIP_TO_CTRY_NM
            ,DC.DS_CONTR_NUM
            ,''                         AS BASE_BLLG_CYCLE_DESC_TXT
            ,0                          AS BASE_BLLG_CYCLE_MTH_AOT
            ,''                         AS USG_BLLG_CYCLE_DESC_TXT
<!-- START 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
            ,''                         AS CUM_COPY_CNT
            ,''                         AS CUM_BLLG_CYCLE_NM
            ,''                         AS CUM_COPY_END_DT
<!-- END 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2021/07/15 L.Mandanas [QC#58314-1, ADD] -->
            ,0                          AS CUM_COPY_FREQ_MTH_AOT
<!-- END 2021/07/15 L.Mandanas [QC#58314-1, ADD] -->
            ,0                          AS USG_BLLG_CYCLE_MTH_AOT
            ,DC.CONTR_VRSN_EFF_FROM_DT  AS CONTR_EFF_FROM_DT_TXT
            ,DC.CONTR_VRSN_EFF_THRU_DT  AS CONTR_EFF_THRU_DT_TXT
            ,MN.T_MDL_NM                AS MDL_NM
            ,SMM.SER_NUM
            ,''                         AS START_READ_MTR_CNT_QTY_TXT
            ,''                         AS XS_MTR_COV_COPY_QTY_TXT
            ,''                         AS XS_MTR_COPY_FROM_QTY_TXT
            ,''                         AS XS_MTR_COPY_THRU_QTY_TXT
            ,''                         AS XS_MTR_AMT_TXT
            ,''                         AS BASE_PRC_DEAL_AMT_TXT
            ,SMM.SER_NUM                AS SORT_SER_NUM
            ,DDT.DS_CONTR_DTL_TP_SORT_NUM
            ,0                          AS CONTR_XS_COPY_PK
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,STC1.SELL_TO_CUST_CD       AS BILL_TO_CUST_ACCT_CD
            ,STC1.DS_ACCT_NM            AS BILL_TO_CUST_ACCT_NM
            ,STC2.SELL_TO_CUST_CD       AS SHIP_TO_CUST_ACCT_CD
            ,STC2.DS_ACCT_NM            AS SHIP_TO_CUST_ACCT_NM
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
        FROM
             DS_CONTR_DTL       DCD
            ,DS_CONTR_DTL_TP    DDT
            ,DS_CONTR           DC
            ,TOC                TOC
            ,BILL_TO_CUST       BT
            ,CTRY               CTRY_B
            ,SVC_MACH_MSTR      SMM
            ,SHIP_TO_CUST       ST
            ,CTRY               CTRY_S
            ,SVC_CONFIG_MSTR    SCM
            ,MDL_NM             MN
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            ,DS_CONTR_DTL_STS_V DCDS
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,SELL_TO_CUST       STC1
            ,SELL_TO_CUST       STC2
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->

        WHERE
                DCD.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DCD.EZCANCELFLAG         = '0'
            <iterate property="dsContrPkList" var="dsContrPk[]" open="AND DCD.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND DCD.GLBL_CMPY_CD         = DDT.GLBL_CMPY_CD
            AND DDT.EZCANCELFLAG         = '0'
            AND DCD.DS_CONTR_DTL_TP_CD   = DDT.DS_CONTR_DTL_TP_CD
            AND BT.GLBL_CMPY_CD          = CTRY_B.GLBL_CMPY_CD
            AND BT.CTRY_CD               = CTRY_B.CTRY_CD
            AND CTRY_B.EZCANCELFLAG      = '0'
            AND DCD.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK          = DC.DS_CONTR_PK
            AND DC.EZCANCELFLAG          = '0'
            AND DC.GLBL_CMPY_CD          = BT.GLBL_CMPY_CD
            AND DC.ALT_PAYER_CUST_CD     = BT.BILL_TO_CUST_CD
            AND BT.EZCANCELFLAG          = '0'
            AND DC.GLBL_CMPY_CD          = TOC.GLBL_CMPY_CD
            AND DC.TOC_CD                = TOC.TOC_CD
            AND TOC.EZCANCELFLAG         = '0'
            AND DCD.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD
            AND DCD.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK
            AND SMM.EZCANCELFLAG         = '0'
            AND SMM.SVC_MACH_TP_CD       = #svcMachTpCdMach#
            AND SMM.GLBL_CMPY_CD         = ST.GLBL_CMPY_CD
            AND SMM.CUR_LOC_NUM          = ST.SHIP_TO_CUST_CD
            AND ST.EZCANCELFLAG          = '0'
            AND ST.GLBL_CMPY_CD          = CTRY_S.GLBL_CMPY_CD
            AND ST.CTRY_CD               = CTRY_S.CTRY_CD
            AND CTRY_S.EZCANCELFLAG      = '0'
            AND SMM.GLBL_CMPY_CD         = SCM.GLBL_CMPY_CD
            AND SMM.SVC_CONFIG_MSTR_PK   = SCM.SVC_CONFIG_MSTR_PK
            AND SCM.EZCANCELFLAG         = '0'
            AND SCM.GLBL_CMPY_CD         = MN.T_GLBL_CMPY_CD
            AND SCM.MDL_ID               = MN.T_MDL_ID
            AND MN.EZCANCELFLAG          = '0'
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            AND DCD.GLBL_CMPY_CD         = DCDS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK      = DCDS.DS_CONTR_DTL_PK
            AND DCDS.AGMT_LTR_AVAL_FLG   = 'Y'
            AND DCDS.EZCANCELFLAG        = '0'
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            AND BT.GLBL_CMPY_CD          = STC1.GLBL_CMPY_CD
            AND BT.SELL_TO_CUST_CD       = STC1.SELL_TO_CUST_CD
            AND STC1.EZCANCELFLAG        = '0'
            AND ST.GLBL_CMPY_CD          = STC2.GLBL_CMPY_CD
            AND ST.SELL_TO_CUST_CD       = STC2.SELL_TO_CUST_CD
            AND STC2.EZCANCELFLAG        = '0'
<!-- END 2018/05/14 T.Wada [QC#25904, ADD] -->
        UNION ALL
        SELECT
             '2'                        AS LINE_LV
            ,DCD.DS_CONTR_PK
            ,DCD.DS_CONTR_DTL_PK
            ,DC.DS_CONTR_CATG_CD
<!-- START 2021/01/29 Y.Penequito [QC#58312,ADD] -->
            ,DCD.SVC_INV_MERGE_TP_CD
            ,DCD.PRNT_DS_CONTR_DTL_PK
<!-- END 2021/01/29 Y.Penequito [QC#58312,ADD] -->
            ,0                          AS DS_CONTR_BLLG_MTR_PK
<!-- START 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
<!--             ,0                          AS SVC_PHYS_MTR_PK  -->
<!-- END 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
            ,0                          AS MTR_LB_SORT_NUM
            ,TOC.TOC_NM
            ,BT.BILL_TO_CUST_CD
            ,BT.LOC_NUM                 AS BILL_TO_LOC_NM
            ,BT.FIRST_LINE_ADDR         AS BILL_TO_FIRST_LINE_ADDR
            ,BT.SCD_LINE_ADDR           AS BILL_TO_SCD_LINE_ADDR
            ,BT.THIRD_LINE_ADDR         AS BILL_TO_THIRD_LINE_ADDR
            ,BT.FRTH_LINE_ADDR          AS BILL_TO_FRTH_LINE_ADDR
            ,BT.CTY_ADDR                AS BILL_TO_CTY_ADDR
            ,BT.ST_CD                   AS BILL_TO_ST_CD
            ,BT.POST_CD                 AS BILL_TO_POST_CD
            ,CTRY_B.CTRY_NM             AS BILL_TO_CTRY_NM
            ,ST.SHIP_TO_CUST_CD
            ,ST.LOC_NUM                 AS SHIP_TO_LOC_NM
            ,ST.FIRST_LINE_ADDR         AS SHIP_TO_FIRST_LINE_ADDR
            ,ST.SCD_LINE_ADDR           AS SHIP_TO_SCD_LINE_ADDR
            ,ST.THIRD_LINE_ADDR         AS SHIP_TO_THIRD_LINE_ADDR
            ,ST.FRTH_LINE_ADDR          AS SHIP_TO_FRTH_LINE_ADDR
            ,ST.CTY_ADDR                AS SHIP_TO_CTY_ADDR
            ,ST.ST_CD                   AS SHIP_TO_ST_CD
            ,ST.POST_CD                 AS SHIP_TO_POST_CD
            ,CTRY_S.CTRY_NM             AS SHIP_TO_CTRY_NM
            ,DC.DS_CONTR_NUM
            ,BC_B.BLLG_CYCLE_NM         AS BASE_BLLG_CYCLE_DESC_TXT
            ,BC_B.BLLG_CYCLE_MTH_AOT    AS BASE_BLLG_CYCLE_MTH_AOT
            ,''                         AS USG_BLLG_CYCLE_DESC_TXT
<!-- START 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2021/07/15 L.Mandanas [QC#58314-1, MOD] -->
            <!-- ,TO_CHAR(NVL(BM1.CUM_COPY_CNT ,''))            AS CUM_COPY_CNT  -->
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,(
            SELECT
                TO_CHAR(NVL(SUM(BM1.CUM_COPY_CNT), ''))
            FROM
                BLLG_MTR           BM1
            WHERE
                    BM1.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
                AND BM1.DS_CONTR_DTL_PK = DCD.DS_CONTR_DTL_PK
                AND BM1.CONTR_PRC_EFF_THRU_DT &gt;= DCD.CONTR_EFF_THRU_DT
            )                           AS CUM_COPY_CNT
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
            <isEqual property="hasMtrFlg" compareValue="N">
            ,''                         AS CUM_COPY_CNT
            </isEqual>
<!-- END 2021/07/15 L.Mandanas [QC#58314-1, MOD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,TO_CHAR(NVL(BC_U_CUM.BLLG_CYCLE_NM,''))       AS CUM_BLLG_CYCLE_NM
            ,TO_CHAR(NVL(BM1.CUM_COPY_END_DT, '') )        AS CUM_COPY_END_DT
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
            <isEqual property="hasMtrFlg" compareValue="N">
            ,''                                            AS CUM_BLLG_CYCLE_NM
            ,''                                            AS CUM_COPY_END_DT
            </isEqual>
<!-- END 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2021/07/15 L.Mandanas [QC#58314-1, ADD] -->
            ,0                                             AS CUM_COPY_FREQ_MTH_AOT
<!-- END 2021/07/15 L.Mandanas [QC#58314-1, ADD] -->
            ,0                          AS USG_BLLG_CYCLE_MTH_AOT
            ,DC.CONTR_VRSN_EFF_FROM_DT  AS CONTR_EFF_FROM_DT_TXT
            ,DC.CONTR_VRSN_EFF_THRU_DT  AS CONTR_EFF_THRU_DT_TXT
            ,MDS.MDSE_DESC_SHORT_TXT    AS MDL_NM
            ,''                         AS SER_NUM
            ,''                         AS START_READ_MTR_CNT_QTY_TXT
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,(
            SELECT
                TO_CHAR(NVL(SUM(BM1.XS_MTR_COPY_QTY), ''))
            FROM
                BLLG_MTR           BM1
            WHERE
                    BM1.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
                AND BM1.DS_CONTR_DTL_PK = DCD.DS_CONTR_DTL_PK
                AND BM1.CONTR_PRC_EFF_THRU_DT &gt;= DCD.CONTR_EFF_THRU_DT
            )                           AS XS_MTR_COV_COPY_QTY_TXT
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
            <isEqual property="hasMtrFlg" compareValue="N">
            ,''                         AS XS_MTR_COV_COPY_QTY_TXT
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,''                         AS XS_MTR_COPY_FROM_QTY_TXT
            ,''                         AS XS_MTR_COPY_THRU_QTY_TXT
            ,''                         AS XS_MTR_AMT_TXT
            ,TO_CHAR(NVL(BASE.BASE_PRC_DEAL_AMT, '')) AS BASE_PRC_DEAL_AMT_TXT
            ,SMM.SER_NUM                AS SORT_SER_NUM
            ,DDT.DS_CONTR_DTL_TP_SORT_NUM
            ,0                          AS CONTR_XS_COPY_PK
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,STC1.SELL_TO_CUST_CD       AS BILL_TO_CUST_ACCT_CD
            ,STC1.DS_ACCT_NM            AS BILL_TO_CUST_ACCT_NM
            ,STC2.SELL_TO_CUST_CD       AS SHIP_TO_CUST_ACCT_CD
            ,STC2.DS_ACCT_NM            AS SHIP_TO_CUST_ACCT_NM
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
        FROM
             DS_CONTR_DTL       DCD
            ,DS_CONTR_DTL_TP    DDT
            ,DS_CONTR           DC
            ,TOC                TOC
            ,BILL_TO_CUST       BT
            ,CTRY               CTRY_B
            ,SVC_MACH_MSTR      SMM
            ,SHIP_TO_CUST       ST
            ,CTRY               CTRY_S
            ,MDSE               MDS
            ,BLLG_CYCLE         BC_B
            ,BASE               BASE
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            ,DS_CONTR_DTL_STS_V DCDS
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,SELL_TO_CUST       STC1
            ,SELL_TO_CUST       STC2
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
<!-- START 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,BLLG_MTR           BM1
            ,BLLG_CYCLE         BC_U_CUM
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
<!-- END 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
        WHERE
                DCD.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DCD.EZCANCELFLAG         = '0'
            <iterate property="dsContrPkList" var="dsContrPk[]" open="AND DCD.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND DCD.GLBL_CMPY_CD         = DDT.GLBL_CMPY_CD
            AND DDT.EZCANCELFLAG         = '0'
            AND DCD.DS_CONTR_DTL_TP_CD   = DDT.DS_CONTR_DTL_TP_CD
            AND BT.GLBL_CMPY_CD          = CTRY_B.GLBL_CMPY_CD
            AND BT.CTRY_CD               = CTRY_B.CTRY_CD
            AND CTRY_B.EZCANCELFLAG      = '0'
            AND DCD.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK          = DC.DS_CONTR_PK
            AND DC.EZCANCELFLAG          = '0'
            AND DC.GLBL_CMPY_CD          = BT.GLBL_CMPY_CD
            AND DC.ALT_PAYER_CUST_CD     = BT.BILL_TO_CUST_CD
            AND BT.EZCANCELFLAG          = '0'
            AND DC.GLBL_CMPY_CD          = TOC.GLBL_CMPY_CD
            AND DC.TOC_CD                = TOC.TOC_CD
            AND DCD.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD
            AND DCD.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK
            AND SMM.EZCANCELFLAG         = '0'
            AND SMM.SVC_MACH_TP_CD       = #svcMachTpCdMach#
            AND SMM.GLBL_CMPY_CD         = ST.GLBL_CMPY_CD
            AND SMM.CUR_LOC_NUM          = ST.SHIP_TO_CUST_CD
            AND ST.EZCANCELFLAG          = '0'
            AND ST.GLBL_CMPY_CD          = CTRY_S.GLBL_CMPY_CD
            AND ST.CTRY_CD               = CTRY_S.CTRY_CD
            AND CTRY_S.EZCANCELFLAG      = '0'
            AND DCD.GLBL_CMPY_CD         = MDS.GLBL_CMPY_CD(+)
            AND DCD.SVC_PGM_MDSE_CD      = MDS.MDSE_CD(+)
            AND MDS.EZCANCELFLAG(+)      = '0'
            AND BASE.GLBL_CMPY_CD        = BC_B.GLBL_CMPY_CD(+)
            AND BASE.BLLG_CYCLE_CD       = BC_B.BLLG_CYCLE_CD(+)
            AND BC_B.EZCANCELFLAG(+)     = '0'
            AND DCD.GLBL_CMPY_CD         = BASE.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK      = BASE.DS_CONTR_DTL_PK
<!-- START 2018/05/14 T.Wada [QC#25904, MOD] -->
<!--        AND DCD.CONTR_EFF_THRU_DT    &lt;= BASE.CONTR_PRC_EFF_THRU_DT -->
            AND NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT)    &lt;= BASE.CONTR_PRC_EFF_THRU_DT
<!-- END 2018/05/14 T.Wada [QC#25904, MOD] -->
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            AND DCD.GLBL_CMPY_CD         = DCDS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK      = DCDS.DS_CONTR_DTL_PK
            AND DCDS.AGMT_LTR_AVAL_FLG   = 'Y'
            AND DCDS.EZCANCELFLAG        = '0'
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            AND BT.GLBL_CMPY_CD          = STC1.GLBL_CMPY_CD
            AND BT.SELL_TO_CUST_CD       = STC1.SELL_TO_CUST_CD
            AND STC1.EZCANCELFLAG        = '0'
            AND ST.GLBL_CMPY_CD          = STC2.GLBL_CMPY_CD
            AND ST.SELL_TO_CUST_CD       = STC2.SELL_TO_CUST_CD
            AND STC2.EZCANCELFLAG        = '0'
<!-- END 2018/05/14 T.Wada [QC#25904, ADD] -->
<!-- START 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
            AND BM1.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
            AND BM1.DS_CONTR_DTL_PK = DCD.DS_CONTR_DTL_PK
            AND BM1.CONTR_PRC_EFF_THRU_DT &gt;= DCD.CONTR_EFF_THRU_DT
            AND BM1.GLBL_CMPY_CD             = BC_U_CUM.GLBL_CMPY_CD(+)
            AND BM1.CUM_COPY_FREQ_MTH_AOT    = BC_U_CUM.BLLG_CYCLE_MTH_AOT(+)
            AND BC_U_CUM.BLLG_CYCLE_START_MTH(+) IS NULL
            AND BC_U_CUM.EZCANCELFLAG(+)         = '0'
            </isEqual>
<!-- END 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
        UNION ALL
        SELECT
             '3'                        AS LINE_LV
            ,DCD.DS_CONTR_PK
            ,DCD.DS_CONTR_DTL_PK
            ,DC.DS_CONTR_CATG_CD
<!-- START 2021/01/29 Y.Penequito [QC#58312,ADD] -->
            ,DCD.SVC_INV_MERGE_TP_CD
            ,DCD.PRNT_DS_CONTR_DTL_PK
<!-- END 2021/01/29 Y.Penequito [QC#58312,ADD] -->
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,BM1.DS_CONTR_BLLG_MTR_PK
<!-- START 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
<!--             ,BM1.SVC_PHYS_MTR_PK  -->
<!-- END 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
            ,BM1.MTR_LB_SORT_NUM
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
            <isEqual property="hasMtrFlg" compareValue="N">
            ,0                          AS DS_CONTR_BLLG_MTR_PK
<!-- START 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
<!--             ,0                          AS SVC_PHYS_MTR_PK  -->
<!-- END 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
            ,0                          AS MTR_LB_SORT_NUM
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,TOC.TOC_NM
            ,BT.BILL_TO_CUST_CD
            ,BT.LOC_NUM                 AS BILL_TO_LOC_NM
            ,BT.FIRST_LINE_ADDR         AS BILL_TO_FIRST_LINE_ADDR
            ,BT.SCD_LINE_ADDR           AS BILL_TO_SCD_LINE_ADDR
            ,BT.THIRD_LINE_ADDR         AS BILL_TO_THIRD_LINE_ADDR
            ,BT.FRTH_LINE_ADDR          AS BILL_TO_FRTH_LINE_ADDR
            ,BT.CTY_ADDR                AS BILL_TO_CTY_ADDR
            ,BT.ST_CD                   AS BILL_TO_ST_CD
            ,BT.POST_CD                 AS BILL_TO_POST_CD
            ,CTRY_B.CTRY_NM             AS BILL_TO_CTRY_NM
            ,ST.SHIP_TO_CUST_CD
            ,ST.LOC_NUM                 AS SHIP_TO_LOC_NM
            ,ST.FIRST_LINE_ADDR         AS SHIP_TO_FIRST_LINE_ADDR
            ,ST.SCD_LINE_ADDR           AS SHIP_TO_SCD_LINE_ADDR
            ,ST.THIRD_LINE_ADDR         AS SHIP_TO_THIRD_LINE_ADDR
            ,ST.FRTH_LINE_ADDR          AS SHIP_TO_FRTH_LINE_ADDR
            ,ST.CTY_ADDR                AS SHIP_TO_CTY_ADDR
            ,ST.ST_CD                   AS SHIP_TO_ST_CD
            ,ST.POST_CD                 AS SHIP_TO_POST_CD
            ,CTRY_S.CTRY_NM             AS SHIP_TO_CTRY_NM
            ,DC.DS_CONTR_NUM
            ,''                         AS BASE_BLLG_CYCLE_DESC_TXT
            ,0                          AS BASE_BLLG_CYCLE_MTH_AOT
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,BC_U.BLLG_CYCLE_NM         AS USG_BLLG_CYCLE_DESC_TXT
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
            <isEqual property="hasMtrFlg" compareValue="N">
            ,''                         AS USG_BLLG_CYCLE_DESC_TXT
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
            ,''                         AS CUM_COPY_CNT
<!-- START 2021/07/15 L.Mandanas [QC#58314-1, MOD] -->
<!--        ,''                         AS CUM_BLLG_CYCLE_NM
            ,''                         AS CUM_COPY_END_DT -->
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,TO_CHAR(NVL(BC_U_CUM.BLLG_CYCLE_NM,''))       AS CUM_BLLG_CYCLE_NM
            ,TO_CHAR(NVL(BM1.CUM_COPY_END_DT, '') )        AS CUM_COPY_END_DT
            ,NVL(BM1.CUM_COPY_FREQ_MTH_AOT, 0)             AS CUM_COPY_FREQ_MTH_AOT
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
            <isEqual property="hasMtrFlg" compareValue="N">
            ,''                                            AS CUM_BLLG_CYCLE_NM
            ,''                                            AS CUM_COPY_END_DT
            ,0                                             AS CUM_COPY_FREQ_MTH_AOT
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
<!-- END 2021/07/15 L.Mandanas [QC#58314-1, MOD] -->
<!-- END 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,BC_U.BLLG_CYCLE_MTH_AOT    AS USG_BLLG_CYCLE_MTH_AOT
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
            <isEqual property="hasMtrFlg" compareValue="N">
            ,0                          AS USG_BLLG_CYCLE_MTH_AOT
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,DC.CONTR_VRSN_EFF_FROM_DT  AS CONTR_EFF_FROM_DT_TXT
            ,DC.CONTR_VRSN_EFF_THRU_DT  AS CONTR_EFF_THRU_DT_TXT
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,BM1.MTR_LB_DESC_TXT        AS MDL_NM
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
            <isEqual property="hasMtrFlg" compareValue="N">
            ,''                         AS MDL_NM
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,''                         AS SER_NUM
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,(SELECT
                  TO_CHAR(NVL(SUM(START_READ.READ_MTR_CNT), ''))
              FROM 
                  (SELECT
                            SPMR.READ_MTR_CNT
                           ,RELN.BLLG_MTR_LB_CD
                  FROM
                            DS_CONTR_BLLG_MTR          BMTR
                           ,CONTR_PHYS_BLLG_MTR_RELN   RELN
                           ,SVC_PHYS_MTR_READ          SPMR
                  WHERE
                            DCD.GLBL_CMPY_CD            = BMTR.GLBL_CMPY_CD
                        AND DCD.DS_CONTR_DTL_PK         = BMTR.DS_CONTR_DTL_PK
                        AND DCD.EZCANCELFLAG            = '0'
                        AND BMTR.EZCANCELFLAG           = '0'
                        AND DCD.DS_CONTR_DTL_PK         = RELN.DS_CONTR_DTL_PK
                        AND BMTR.GLBL_CMPY_CD           = RELN.GLBL_CMPY_CD
                        AND BMTR.BLLG_MTR_LB_CD         = RELN.BLLG_MTR_LB_CD
                        AND RELN.EZCANCELFLAG           = '0'
                        AND RELN.GLBL_CMPY_CD           = SPMR.GLBL_CMPY_CD
<!-- START 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
<!--                         AND RELN.SVC_PHYS_MTR_PK        = SPMR.SVC_PHYS_MTR_PK  -->
<!-- END 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
<!-- START 2022/02/28 L.Mandanas [QC#58314-5, ADD] -->
                        AND RELN.SVC_PHYS_MTR_PK        = SPMR.SVC_PHYS_MTR_PK
<!-- END 2022/02/28 L.Mandanas [QC#58314-5, DEL] -->
                        AND RELN.DS_CONTR_DTL_PK        = SPMR.DS_CONTR_DTL_PK
                        AND SPMR.EZCANCELFLAG           = '0'
                  ) START_READ
              WHERE
                  START_READ.BLLG_MTR_LB_CD = BM1.BLLG_MTR_LB_CD
            )                           AS START_READ_MTR_CNT_QTY_TXT
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
            <isEqual property="hasMtrFlg" compareValue="N">
            ,''                         AS START_READ_MTR_CNT_QTY_TXT
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,''                         AS XS_MTR_COV_COPY_QTY_TXT
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,TO_CHAR(NVL(BM1.XS_MTR_COPY_QTY + 1, ''))      AS XS_MTR_COPY_FROM_QTY_TXT
            ,TO_CHAR(NVL(BM1.XS_MTR_COPY_THRU_QTY_TXT, '')) AS XS_MTR_COPY_THRU_QTY_TXT
            ,TO_CHAR(NVL(BM1.XS_MTR_AMT_RATE, ''))          AS XS_MTR_AMT_TXT
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
            <isEqual property="hasMtrFlg" compareValue="N">
            ,''                                             AS XS_MTR_COPY_FROM_QTY_TXT
            ,''                                             AS XS_MTR_COPY_THRU_QTY_TXT
            ,''                                             AS XS_MTR_AMT_TXT
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,''                         AS BASE_PRC_DEAL_AMT_TXT
            ,SMM.SER_NUM                AS SORT_SER_NUM
            ,DDT.DS_CONTR_DTL_TP_SORT_NUM
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,BM1.CONTR_XS_COPY_PK       AS CONTR_XS_COPY_PK
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
            <isEqual property="hasMtrFlg" compareValue="N">
            ,0                          AS CONTR_XS_COPY_PK
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,STC1.SELL_TO_CUST_CD       AS BILL_TO_CUST_ACCT_CD
            ,STC1.DS_ACCT_NM            AS BILL_TO_CUST_ACCT_NM
            ,STC2.SELL_TO_CUST_CD       AS SHIP_TO_CUST_ACCT_CD
            ,STC2.DS_ACCT_NM            AS SHIP_TO_CUST_ACCT_NM
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
        FROM
             DS_CONTR_DTL       DCD
            ,DS_CONTR_DTL_TP    DDT
            ,DS_CONTR           DC
            ,TOC                TOC
            ,SVC_MACH_MSTR      SMM
            ,SHIP_TO_CUST       ST
            ,CTRY               CTRY_S
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,BLLG_CYCLE         BC_U
            ,BLLG_MTR           BM1
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,BILL_TO_CUST       BT
            ,CTRY               CTRY_B
<!-- START 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,BLLG_CYCLE         BC_U_CUM
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
<!-- END 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            ,DS_CONTR_DTL_STS_V DCDS
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,SELL_TO_CUST       STC1
            ,SELL_TO_CUST       STC2
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
        WHERE
                DCD.GLBL_CMPY_CD                = #glblCmpyCd#
            AND DCD.EZCANCELFLAG                = '0'
            <iterate property="dsContrPkList" var="dsContrPk[]" open="AND DCD.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND DCD.GLBL_CMPY_CD                = DDT.GLBL_CMPY_CD
            AND DDT.EZCANCELFLAG                = '0'
            AND DCD.DS_CONTR_DTL_TP_CD          = DDT.DS_CONTR_DTL_TP_CD
            AND DCD.GLBL_CMPY_CD                = DC.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK                 = DC.DS_CONTR_PK
            AND DC.EZCANCELFLAG                 = '0'
            AND DC.GLBL_CMPY_CD                 = BT.GLBL_CMPY_CD
            AND DC.ALT_PAYER_CUST_CD            = BT.BILL_TO_CUST_CD
            AND BT.EZCANCELFLAG                 = '0'
            AND DC.GLBL_CMPY_CD                 = TOC.GLBL_CMPY_CD
            AND DC.TOC_CD                       = TOC.TOC_CD
            AND TOC.EZCANCELFLAG                = '0'
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            AND DCD.GLBL_CMPY_CD                = BM1.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK             = BM1.DS_CONTR_DTL_PK
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, MOD] -->
<!--        AND DCD.CONTR_EFF_THRU_DT           &lt;= BM1.CONTR_PRC_EFF_THRU_DT -->
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            AND NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT)    &lt;= BM1.CONTR_PRC_EFF_THRU_DT
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
<!-- END 2018/05/14 T.Wada [QC#25904, MOD] -->
            AND DCD.GLBL_CMPY_CD                = SMM.GLBL_CMPY_CD
            AND DCD.SVC_MACH_MSTR_PK            = SMM.SVC_MACH_MSTR_PK
            AND SMM.EZCANCELFLAG                = '0'
            AND SMM.SVC_MACH_TP_CD              = #svcMachTpCdMach#
            AND SMM.GLBL_CMPY_CD                = ST.GLBL_CMPY_CD
            AND SMM.CUR_LOC_NUM                 = ST.SHIP_TO_CUST_CD
            AND ST.EZCANCELFLAG                 = '0'
            AND ST.GLBL_CMPY_CD                 = CTRY_S.GLBL_CMPY_CD
            AND ST.CTRY_CD                      = CTRY_S.CTRY_CD
            AND CTRY_S.EZCANCELFLAG             = '0'
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            AND BM1.GLBL_CMPY_CD                = BC_U.GLBL_CMPY_CD(+)
            AND BM1.BLLG_CYCLE_CD               = BC_U.BLLG_CYCLE_CD(+)
            AND BC_U.EZCANCELFLAG(+)            = '0'
<!-- START 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
            AND BM1.GLBL_CMPY_CD                = BC_U_CUM.GLBL_CMPY_CD(+)
            AND BM1.CUM_COPY_FREQ_MTH_AOT       = BC_U_CUM.BLLG_CYCLE_MTH_AOT(+)
            AND BC_U_CUM.BLLG_CYCLE_START_MTH(+)    IS NULL
            AND BC_U_CUM.EZCANCELFLAG(+)        = '0'
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
<!-- END 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
            AND BT.GLBL_CMPY_CD                 = CTRY_B.GLBL_CMPY_CD
            AND BT.CTRY_CD                      = CTRY_B.CTRY_CD
            AND CTRY_B.EZCANCELFLAG             = '0'
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            AND DCD.GLBL_CMPY_CD         = DCDS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK      = DCDS.DS_CONTR_DTL_PK
            AND DCDS.AGMT_LTR_AVAL_FLG   = 'Y'
            AND DCDS.EZCANCELFLAG        = '0'
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            AND BT.GLBL_CMPY_CD          = STC1.GLBL_CMPY_CD
            AND BT.SELL_TO_CUST_CD       = STC1.SELL_TO_CUST_CD
            AND STC1.EZCANCELFLAG        = '0'
            AND ST.GLBL_CMPY_CD          = STC2.GLBL_CMPY_CD
            AND ST.SELL_TO_CUST_CD       = STC2.SELL_TO_CUST_CD
            AND STC2.EZCANCELFLAG        = '0'
<!-- END 2018/05/14 T.Wada [QC#25904, ADD] -->
        UNION ALL
        SELECT
             '4'                        AS LINE_LV
            ,DCD.DS_CONTR_PK
            ,DCD.DS_CONTR_DTL_PK
            ,DC.DS_CONTR_CATG_CD
<!-- START 2021/01/29 Y.Penequito [QC#58312,ADD] -->
            ,DCD.SVC_INV_MERGE_TP_CD
            ,DCD.PRNT_DS_CONTR_DTL_PK
<!-- END 2021/01/29 Y.Penequito [QC#58312,ADD] -->
            ,0                          AS DS_CONTR_BLLG_MTR_PK
<!-- START 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
<!--             ,0                          AS SVC_PHYS_MTR_PK  -->
<!-- END 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
            ,0                          AS MTR_LB_SORT_NUM
            ,TOC.TOC_NM
            ,BT.BILL_TO_CUST_CD
            ,BT.LOC_NUM                 AS BILL_TO_LOC_NM
            ,BT.FIRST_LINE_ADDR         AS BILL_TO_FIRST_LINE_ADDR
            ,BT.SCD_LINE_ADDR           AS BILL_TO_SCD_LINE_ADDR
            ,BT.THIRD_LINE_ADDR         AS BILL_TO_THIRD_LINE_ADDR
            ,BT.FRTH_LINE_ADDR          AS BILL_TO_FRTH_LINE_ADDR
            ,BT.CTY_ADDR                AS BILL_TO_CTY_ADDR
            ,BT.ST_CD                   AS BILL_TO_ST_CD
            ,BT.POST_CD                 AS BILL_TO_POST_CD
            ,CTRY_B.CTRY_NM             AS BILL_TO_CTRY_NM
            ,ST.SHIP_TO_CUST_CD
            ,ST.LOC_NUM                 AS SHIP_TO_LOC_NM
            ,ST.FIRST_LINE_ADDR         AS SHIP_TO_FIRST_LINE_ADDR
            ,ST.SCD_LINE_ADDR           AS SHIP_TO_SCD_LINE_ADDR
            ,ST.THIRD_LINE_ADDR         AS SHIP_TO_THIRD_LINE_ADDR
            ,ST.FRTH_LINE_ADDR          AS SHIP_TO_FRTH_LINE_ADDR
            ,ST.CTY_ADDR                AS SHIP_TO_CTY_ADDR
            ,ST.ST_CD                   AS SHIP_TO_ST_CD
            ,ST.POST_CD                 AS SHIP_TO_POST_CD
            ,CTRY_S.CTRY_NM             AS SHIP_TO_CTRY_NM
            ,DC.DS_CONTR_NUM
            ,''                         AS BASE_BLLG_CYCLE_DESC_TXT
            ,0                          AS BASE_BLLG_CYCLE_MTH_AOT
            ,''                         AS USG_BLLG_CYCLE_DESC_TXT
<!-- START 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
            ,''                         AS CUM_COPY_CNT
            ,''                         AS CUM_BLLG_CYCLE_NM
            ,''                         AS CUM_COPY_END_DT
<!-- END 2021/03/17 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2021/07/15 L.Mandanas [QC#58314-1, ADD] -->
            ,0                          AS CUM_COPY_FREQ_MTH_AOT
<!-- END 2021/07/15 L.Mandanas [QC#58314-1, ADD] -->
            ,0                          AS USG_BLLG_CYCLE_MTH_AOT
            ,DC.CONTR_VRSN_EFF_FROM_DT  AS CONTR_EFF_FROM_DT_TXT
            ,DC.CONTR_VRSN_EFF_THRU_DT  AS CONTR_EFF_THRU_DT_TXT
            ,MDS.MDSE_DESC_SHORT_TXT    AS MDL_NM
            ,SMM.SER_NUM                AS SER_NUM
            ,''                         AS START_READ_MTR_CNT_QTY_TXT
            ,''                         AS XS_MTR_COV_COPY_QTY_TXT
            ,''                         AS XS_MTR_COPY_FROM_QTY_TXT
            ,''                         AS XS_MTR_COPY_THRU_QTY_TXT
            ,''                         AS XS_MTR_AMT_TXT
            ,TO_CHAR(BASE.BASE_PRC_DEAL_AMT)    AS BASE_PRC_DEAL_AMT_TXT
            ,NVL(SMMP.SER_NUM,SMM.SER_NUM)      AS SORT_SER_NUM
            ,DDT.DS_CONTR_DTL_TP_SORT_NUM
            ,0                          AS CONTR_XS_COPY_PK
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,STC1.SELL_TO_CUST_CD       AS BILL_TO_CUST_ACCT_CD
            ,STC1.DS_ACCT_NM            AS BILL_TO_CUST_ACCT_NM
            ,STC2.SELL_TO_CUST_CD       AS SHIP_TO_CUST_ACCT_CD
            ,STC2.DS_ACCT_NM            AS SHIP_TO_CUST_ACCT_NM
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
        FROM
             DS_CONTR_DTL       DCD
            ,DS_CONTR_DTL_TP    DDT
            ,DS_CONTR           DC
            ,TOC                TOC
            ,BILL_TO_CUST       BT
            ,CTRY               CTRY_B
            ,SVC_MACH_MSTR      SMM
            ,DS_CONTR_DTL       DCDP
            ,SVC_MACH_MSTR      SMMP
            ,SHIP_TO_CUST       ST
            ,CTRY               CTRY_S
            ,MDSE               MDS
            ,BASE               BASE
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            ,DS_CONTR_DTL_STS_V DCDS
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,SELL_TO_CUST       STC1
            ,SELL_TO_CUST       STC2
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
        WHERE
                DCD.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DCD.EZCANCELFLAG         = '0'
            AND DCD.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD
            <iterate property="dsContrPkList" var="dsContrPk[]" open="AND DCD.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND DCD.GLBL_CMPY_CD         = DDT.GLBL_CMPY_CD
            AND DDT.EZCANCELFLAG         = '0'
            AND DCD.DS_CONTR_DTL_TP_CD   = DDT.DS_CONTR_DTL_TP_CD
            AND DCD.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK          = DC.DS_CONTR_PK
            AND DC.EZCANCELFLAG          = '0'
            AND DC.GLBL_CMPY_CD          = BT.GLBL_CMPY_CD
            AND DC.ALT_PAYER_CUST_CD     = BT.BILL_TO_CUST_CD
            AND BT.EZCANCELFLAG          = '0'
            AND DC.GLBL_CMPY_CD          = TOC.GLBL_CMPY_CD
            AND DC.TOC_CD                = TOC.TOC_CD
            AND TOC.EZCANCELFLAG         = '0'
            AND DC.GLBL_CMPY_CD          = BT.GLBL_CMPY_CD
            AND DC.ALT_PAYER_CUST_CD     = BT.BILL_TO_CUST_CD
            AND BT.EZCANCELFLAG          = '0'
            AND BT.GLBL_CMPY_CD          = CTRY_B.GLBL_CMPY_CD
            AND BT.CTRY_CD               = CTRY_B.CTRY_CD
            AND CTRY_B.EZCANCELFLAG      = '0'
            AND DCD.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD
            AND DCD.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK
            AND SMM.EZCANCELFLAG         = '0'
            AND SMM.SVC_MACH_TP_CD       = #svcMachTpCdAcc#
            AND SMM.GLBL_CMPY_CD         = ST.GLBL_CMPY_CD
            AND SMM.CUR_LOC_NUM          = ST.SHIP_TO_CUST_CD
            AND ST.EZCANCELFLAG          = '0'
            AND ST.GLBL_CMPY_CD          = CTRY_S.GLBL_CMPY_CD
            AND ST.CTRY_CD               = CTRY_S.CTRY_CD
            AND CTRY_S.EZCANCELFLAG      = '0'
            AND DCD.PRNT_DS_CONTR_DTL_PK = DCDP.DS_CONTR_DTL_PK(+)
            AND DCD.GLBL_CMPY_CD         = DCDP.GLBL_CMPY_CD(+)
            AND DCDP.EZCANCELFLAG(+)     = '0'
            AND DCDP.GLBL_CMPY_CD        = SMMP.GLBL_CMPY_CD(+)
            AND DCDP.SVC_MACH_MSTR_PK    = SMMP.SVC_MACH_MSTR_PK(+)
            AND SMMP.EZCANCELFLAG(+)     = '0'
            AND DCD.GLBL_CMPY_CD         = MDS.GLBL_CMPY_CD(+)
            AND DCD.SVC_PGM_MDSE_CD      = MDS.MDSE_CD(+)
            AND MDS.EZCANCELFLAG(+)      = '0'
            AND DCD.GLBL_CMPY_CD         = BASE.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK      = BASE.DS_CONTR_DTL_PK
<!-- START 2018/05/14 T.Wada [QC#25904, MOD] -->
<!--        AND DCD.CONTR_EFF_THRU_DT    &lt;= BASE.CONTR_PRC_EFF_THRU_DT -->
            AND NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT)    &lt;= BASE.CONTR_PRC_EFF_THRU_DT
<!-- END 2018/05/14 T.Wada [QC#25904, MOD] -->
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            AND DCD.GLBL_CMPY_CD         = DCDS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK      = DCDS.DS_CONTR_DTL_PK
            AND DCDS.AGMT_LTR_AVAL_FLG   = 'Y'
            AND DCDS.EZCANCELFLAG        = '0'
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            AND BT.GLBL_CMPY_CD          = STC1.GLBL_CMPY_CD
            AND BT.SELL_TO_CUST_CD       = STC1.SELL_TO_CUST_CD
            AND STC1.EZCANCELFLAG        = '0'
            AND ST.GLBL_CMPY_CD          = STC2.GLBL_CMPY_CD
            AND ST.SELL_TO_CUST_CD       = STC2.SELL_TO_CUST_CD
            AND STC2.EZCANCELFLAG        = '0'
<!-- END 2018/05/14 T.Wada [QC#25904, ADD] -->
<!-- START 2021/04/19 L.Mandanas [QC#58314-1, ADD] -->
        UNION ALL
        --AGG line
        SELECT
             '5'                        AS LINE_LV
            ,DCD.DS_CONTR_PK
            ,DCD.DS_CONTR_DTL_PK
            ,DC.DS_CONTR_CATG_CD
            ,DCD.SVC_INV_MERGE_TP_CD
            ,DCD.PRNT_DS_CONTR_DTL_PK
            ,0                          AS DS_CONTR_BLLG_MTR_PK
<!-- START 2021/07/15 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
<!--             ,0                          AS SVC_PHYS_MTR_PK  -->
<!-- END 2022/01/19 L.Mandanas [QC#58314-4, DEL] -->
<!-- END 2021/07/15 L.Mandanas [QC#58314-1, ADD] -->
            ,0                          AS MTR_LB_SORT_NUM
            ,''      AS TOC_NM
            ,''      AS BILL_TO_CUST_CD
            ,''      AS BILL_TO_LOC_NM
            ,''      AS BILL_TO_FIRST_LINE_ADDR
            ,''      AS BILL_TO_SCD_LINE_ADDR
            ,''      AS BILL_TO_THIRD_LINE_ADDR
            ,''      AS BILL_TO_FRTH_LINE_ADDR
            ,''      AS BILL_TO_CTY_ADDR
            ,''      AS BILL_TO_ST_CD
            ,''      AS BILL_TO_POST_CD
            ,''      AS BILL_TO_CTRY_NM
            ,''      AS SHIP_TO_CUST_CD
            ,''      AS SHIP_TO_LOC_NM
            ,''      AS SHIP_TO_FIRST_LINE_ADDR
            ,''      AS SHIP_TO_SCD_LINE_ADDR
            ,''      AS SHIP_TO_THIRD_LINE_ADDR
            ,''      AS SHIP_TO_FRTH_LINE_ADDR
            ,''      AS SHIP_TO_CTY_ADDR
            ,''      AS SHIP_TO_ST_CD
            ,''      AS SHIP_TO_POST_CD
            ,''      AS SHIP_TO_CTRY_NM
            ,DC.DS_CONTR_NUM
            ,''      AS BASE_BLLG_CYCLE_DESC_TXT
            ,0                          AS BASE_BLLG_CYCLE_MTH_AOT
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,BC_U.BLLG_CYCLE_NM         AS USG_BLLG_CYCLE_DESC_TXT
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
            <isEqual property="hasMtrFlg" compareValue="N">
            ,''                         AS USG_BLLG_CYCLE_DESC_TXT
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2021/07/15 L.Mandanas [QC#58314-1, MOD] -->
            <!-- ,TO_CHAR(NVL(BM1.CUM_COPY_CNT ,''))            AS CUM_COPY_CNT  -->
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,(
            SELECT
                TO_CHAR(NVL(SUM(BM1.CUM_COPY_CNT), ''))
            FROM
                BLLG_MTR           BM1
            WHERE
                    BM1.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
                AND BM1.DS_CONTR_DTL_PK = DCD.DS_CONTR_DTL_PK
                AND BM1.CONTR_PRC_EFF_THRU_DT &gt;= DCD.CONTR_EFF_THRU_DT
            )                           AS CUM_COPY_CNT
<!-- END 2021/07/15 L.Mandanas [QC#58314-1, MOD] -->
            ,NVL(BC_U_CUM.BLLG_CYCLE_NM,'')                    AS CUM_BLLG_CYCLE_NM
            ,NVL(BM_NEW1.CUM_COPY_END_DT, '')                  AS CUM_COPY_END_DT
<!-- START 2021/07/15 L.Mandanas [QC#58314-1, ADD] -->
            ,NVL(BM_NEW1.CUM_COPY_FREQ_MTH_AOT, 0)             AS CUM_COPY_FREQ_MTH_AOT
<!-- END 2021/07/15 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
            <isEqual property="hasMtrFlg" compareValue="N">
            ,''                                                AS CUM_COPY_CNT
            ,''                                                AS CUM_BLLG_CYCLE_NM
            ,''                                                AS CUM_COPY_END_DT
            ,0                                                 AS CUM_COPY_FREQ_MTH_AOT
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,0                          AS USG_BLLG_CYCLE_MTH_AOT
            ,''      AS CONTR_EFF_FROM_DT_TXT
            ,''      AS CONTR_EFF_THRU_DT_TXT
            ,''      AS MDL_NM
            ,''      AS SER_NUM
            ,''      AS START_READ_MTR_CNT_QTY_TXT
            ,''      AS XS_MTR_COV_COPY_QTY_TXT
            ,''      AS XS_MTR_COPY_FROM_QTY_TXT
            ,''      AS XS_MTR_COPY_THRU_QTY_TXT
            ,''      AS XS_MTR_AMT_TXT
            ,''      AS BASE_PRC_DEAL_AMT_TXT
            ,''      AS SORT_SER_NUM 
            ,DDT.DS_CONTR_DTL_TP_SORT_NUM
            ,0                          AS CONTR_XS_COPY_PK
            ,''      AS BILL_TO_CUST_ACCT_CD
            ,''      AS BILL_TO_CUST_ACCT_NM
            ,''      AS SHIP_TO_CUST_ACCT_CD
            ,''      AS SHIP_TO_CUST_ACCT_NM
        FROM
             DS_CONTR_DTL       DCD
            ,DS_CONTR_DTL_TP    DDT
            ,DS_CONTR           DC
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            ,BLLG_CYCLE         BC_U
            ,BLLG_MTR           BM_NEW1
            ,BLLG_MTR           BM_OLD
            ,BLLG_CYCLE         BC_U_CUM
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
        WHERE
                DCD.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DCD.EZCANCELFLAG        = '0'
            <iterate property="dsContrPkList" var="dsContrPk[]" open="AND DCD.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND DCD.GLBL_CMPY_CD        = DDT.GLBL_CMPY_CD
            AND DDT.EZCANCELFLAG        = '0'
            AND DCD.DS_CONTR_DTL_TP_CD  = DDT.DS_CONTR_DTL_TP_CD
            AND DCD.GLBL_CMPY_CD        = DC.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK         = DC.DS_CONTR_PK
            AND DC.EZCANCELFLAG         = '0'
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            AND DCD.GLBL_CMPY_CD        = BM_NEW1.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK     = BM_NEW1.DS_CONTR_DTL_PK
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, MOD] -->
            <!-- AND DC.DS_CONTR_CATG_CD     = 'AGG'  -->
            AND DC.DS_CONTR_CATG_CD     = #dsContrCatgCdAgg#
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, MOD] -->
            AND DCD.PRNT_DS_CONTR_DTL_PK IS NULL
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            <isEqual property="hasMtrFlg" compareValue="Y">
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            AND BM_NEW1.GLBL_CMPY_CD               = BM_OLD.GLBL_CMPY_CD(+)
            AND BM_NEW1.DS_CONTR_DTL_PK            = BM_OLD.DS_CONTR_DTL_PK(+)
            AND BM_NEW1.CONTR_XS_COPY_PK           = BM_OLD.CONTR_XS_COPY_PK(+)
            AND BM_NEW1.DS_CONTR_PRC_EFF_SQ_NUM -1 = BM_OLD.DS_CONTR_PRC_EFF_SQ_NUM(+)
            AND BM_NEW1.GLBL_CMPY_CD            = BC_U.GLBL_CMPY_CD(+)
            AND BM_NEW1.BLLG_CYCLE_CD           = BC_U.BLLG_CYCLE_CD(+)
            AND BC_U.EZCANCELFLAG(+)            = '0'
            AND BM_NEW1.GLBL_CMPY_CD             = BC_U_CUM.GLBL_CMPY_CD(+)
            AND BM_NEW1.CUM_COPY_FREQ_MTH_AOT    = BC_U_CUM.BLLG_CYCLE_MTH_AOT(+)
            AND BC_U_CUM.BLLG_CYCLE_START_MTH(+) IS NULL
            AND BC_U_CUM.EZCANCELFLAG(+)         = '0'
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
            </isEqual>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
<!-- END 2021/04/19 L.Mandanas [QC#58314-1, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, MOD] -->
<!--ORDER BY SORT_SER_NUM NULLS FIRST,DS_CONTR_DTL_TP_SORT_NUM,LINE_LV,MTR_LB_SORT_NUM,CONTR_XS_COPY_PK -->
    ORDER BY DS_CONTR_PK,SORT_SER_NUM NULLS FIRST,DS_CONTR_DTL_TP_SORT_NUM,LINE_LV,MTR_LB_SORT_NUM,CONTR_XS_COPY_PK
<!-- END 2018/05/14 T.Wada [QC#25904, MOD] -->
    </statement>

    <statement id="getWrkDataForFlt" parameterClass="Map" resultClass="Map">
            WITH BLLG_MTR AS (
                SELECT
                     CPE.GLBL_CMPY_CD
                    ,CPE.DS_CONTR_DTL_PK
                    ,CPE.DS_CONTR_BLLG_MTR_PK
                    ,CPE.DS_CONTR_PRC_EFF_SQ_NUM
                    ,CPE.BLLG_CYCLE_CD
                    ,CBM.BLLG_MTR_LB_CD
                    ,CBM.SVC_PHYS_MTR_PK
                    ,ML.MTR_LB_SORT_NUM
                    ,ML.MTR_LB_DESC_TXT
                    ,CPE.CONTR_PRC_EFF_THRU_DT
                    ,PEM.CONTR_XS_COPY_PK
                    ,PEM.XS_MTR_COPY_QTY
                    ,PEM.XS_MTR_AMT_RATE
                    ,PEM.XS_MTR_FIRST_FLG
                    ,(
                    SELECT 
                        NVL(MIN (NEXT.XS_MTR_COPY_QTY), 0)
                    FROM
                        (
                        SELECT
                            PEM_NEXT.XS_MTR_COPY_QTY
                        FROM
                            DS_CONTR_PRC_EFF_MTR    PEM_NEXT
                        WHERE
                                PEM_NEXT.GLBL_CMPY_CD      = #glblCmpyCd#
                            AND PEM_NEXT.EZCANCELFLAG      = '0'
                            AND PEM_NEXT.DS_CONTR_PRC_EFF_PK  = PEM.DS_CONTR_PRC_EFF_PK
                            AND PEM_NEXT.XS_MTR_COPY_QTY &gt; PEM.XS_MTR_COPY_QTY 
                        )    NEXT
                    ) AS XS_MTR_COPY_THRU_QTY_TXT
                   
                FROM
                     DS_CONTR_PRC_EFF           CPE
                    ,DS_CONTR_PRC_EFF_MTR       PEM
                    ,CONTR_PHYS_BLLG_MTR_RELN   CBM
                    ,MTR_LB                     ML
                WHERE
                        CPE.GLBL_CMPY_CD                = #glblCmpyCd#
                    AND CPE.USG_CHRG_FLG                = 'Y'
                    AND CPE.EZCANCELFLAG                = '0'
                    AND CPE.DS_CONTR_PRC_EFF_PK         = PEM.DS_CONTR_PRC_EFF_PK
                    AND CPE.GLBL_CMPY_CD                = PEM.GLBL_CMPY_CD
                    AND PEM.EZCANCELFLAG                = '0'
                    AND CPE.DS_CONTR_BLLG_MTR_PK        = CBM.DS_CONTR_BLLG_MTR_PK
                    AND CPE.GLBL_CMPY_CD                = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG                = '0'
                    AND CBM.GLBL_CMPY_CD                = ML.GLBL_CMPY_CD
                    AND CBM.BLLG_MTR_LB_CD              = ML.MTR_LB_CD
                    AND ML.EZCANCELFLAG                 = '0'
                ORDER BY CPE.DS_CONTR_DTL_PK,PEM.DS_CONTR_PRC_EFF_PK, PEM.XS_MTR_COPY_QTY
        )
        ,BASE AS (
                SELECT
                     CPE.GLBL_CMPY_CD
                    ,CPE.DS_CONTR_DTL_PK
                    ,CPE.BASE_PRC_DEAL_AMT
                    ,CPE.DS_CONTR_PRC_EFF_SQ_NUM
                    ,CPE.CONTR_PRC_EFF_FROM_DT
                    ,CPE.CONTR_PRC_EFF_THRU_DT
                    ,CPE.BLLG_CYCLE_CD
                FROM
                     DS_CONTR_PRC_EFF           CPE
                WHERE
                        CPE.GLBL_CMPY_CD                = #glblCmpyCd#
                    AND CPE.BASE_CHRG_FLG               = 'Y'
                    AND CPE.EZCANCELFLAG                = '0'
        )
        ,START_READ AS (
                SELECT
                    DCD.DS_CONTR_PK
                   ,DCD.DS_CONTR_DTL_PK
                   ,RELN.DS_CONTR_BLLG_MTR_PK
                   ,SPMR.SVC_PHYS_MTR_PK
                   ,DCBM.INTG_MDSE_CD
                   ,RELN.BLLG_MTR_LB_CD
                   ,SPMR.READ_MTR_CNT
                FROM
                    DS_CONTR_DTL              DCD
                   ,DS_CONTR_BLLG_MTR         DCBM
                   ,CONTR_PHYS_BLLG_MTR_RELN  RELN
                   ,SVC_PHYS_MTR_READ         SPMR
                WHERE
                    DCD.GLBL_CMPY_CD          = #glblCmpyCd#
                    <iterate property="dsContrPkList" var="dsContrPk[]" open="AND DCD.DS_CONTR_PK IN (" close=")" conjunction=",">
                    #dsContrPk[]#
                    </iterate>
                AND DCD.GLBL_CMPY_CD          = DCBM.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_PK       = DCBM.DS_CONTR_DTL_PK
                AND DCBM.EZCANCELFLAG         = '0'
                AND DCBM.GLBL_CMPY_CD         = RELN.GLBL_CMPY_CD
                AND DCBM.DS_CONTR_BLLG_MTR_PK = RELN.DS_CONTR_BLLG_MTR_PK
                AND RELN.EZCANCELFLAG         = '0'
                AND RELN.GLBL_CMPY_CD         = SPMR.GLBL_CMPY_CD
                AND RELN.SVC_PHYS_MTR_PK      = SPMR.SVC_PHYS_MTR_PK
                AND DCD.DS_CONTR_DTL_PK       = SPMR.DS_CONTR_DTL_PK
                AND SPMR.EZCANCELFLAG         = '0'
        )
        ,FLT_LINE AS (
                SELECT
                     '1'                        AS LINE_LV
                     ,DCD.DS_CONTR_PK
                     ,DCD.DS_CONTR_DTL_PK
                     ,DC.DS_CONTR_CATG_CD
<!-- START 2021/01/29 Y.Penequito [QC#58312,ADD] -->
                     ,DCD.SVC_INV_MERGE_TP_CD
                     ,DCD.PRNT_DS_CONTR_DTL_PK
<!-- END 2021/01/29 Y.Penequito [QC#58312,ADD] -->
                     ,0                          AS DS_CONTR_BLLG_MTR_PK
                     ,0                          AS SVC_PHYS_MTR_PK
                     ,0                          AS MTR_LB_SORT_NUM
                     ,TOC.TOC_NM
                     ,BT.BILL_TO_CUST_CD
                     ,BT.LOC_NUM                 AS BILL_TO_LOC_NM
                     ,BT.FIRST_LINE_ADDR         AS BILL_TO_FIRST_LINE_ADDR
                     ,BT.SCD_LINE_ADDR           AS BILL_TO_SCD_LINE_ADDR
                     ,BT.THIRD_LINE_ADDR         AS BILL_TO_THIRD_LINE_ADDR
                     ,BT.FRTH_LINE_ADDR          AS BILL_TO_FRTH_LINE_ADDR
                     ,BT.CTY_ADDR                AS BILL_TO_CTY_ADDR
                     ,BT.ST_CD                   AS BILL_TO_ST_CD
                     ,BT.POST_CD                 AS BILL_TO_POST_CD
                     ,CTRY_B.CTRY_NM             AS BILL_TO_CTRY_NM
                     ,ST.SHIP_TO_CUST_CD
                     ,ST.LOC_NUM                 AS SHIP_TO_LOC_NM
                     ,ST.FIRST_LINE_ADDR         AS SHIP_TO_FIRST_LINE_ADDR
                     ,ST.SCD_LINE_ADDR           AS SHIP_TO_SCD_LINE_ADDR
                     ,ST.THIRD_LINE_ADDR         AS SHIP_TO_THIRD_LINE_ADDR
                     ,ST.FRTH_LINE_ADDR          AS SHIP_TO_FRTH_LINE_ADDR
                     ,ST.CTY_ADDR                AS SHIP_TO_CTY_ADDR
                     ,ST.ST_CD                   AS SHIP_TO_ST_CD
                     ,ST.POST_CD                 AS SHIP_TO_POST_CD
                     ,CTRY_S.CTRY_NM             AS SHIP_TO_CTRY_NM
                     ,DC.DS_CONTR_NUM
                     ,BC_B.BLLG_CYCLE_NM         AS BASE_BLLG_CYCLE_DESC_TXT
                     ,0                          AS BASE_BLLG_CYCLE_MTH_AOT
                     ,''                         AS USG_BLLG_CYCLE_DESC_TXT
                     ,0                          AS USG_BLLG_CYCLE_MTH_AOT
                     ,DC.CONTR_VRSN_EFF_FROM_DT  AS CONTR_EFF_FROM_DT_TXT
                     ,DC.CONTR_VRSN_EFF_THRU_DT  AS CONTR_EFF_THRU_DT_TXT
                     ,'Fleet Contract'           AS MDL_NM
                     ,''                         AS SER_NUM
                     ,''                         AS START_READ_MTR_CNT_QTY_TXT
                     ,''                         AS XS_MTR_COV_COPY_QTY_TXT
                     ,''                         AS XS_MTR_COPY_FROM_QTY_TXT
                     ,''                         AS XS_MTR_COPY_THRU_QTY_TXT
                     ,''                         AS XS_MTR_AMT_TXT
                     ,''                         AS BASE_PRC_DEAL_AMT_TXT
                     ,''                         AS SORT_SER_NUM
                     ,DDT.DS_CONTR_DTL_TP_SORT_NUM
                     ,0                          AS CONTR_XS_COPY_PK
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
                    ,STC1.SELL_TO_CUST_CD       AS BILL_TO_CUST_ACCT_CD
                    ,STC1.DS_ACCT_NM            AS BILL_TO_CUST_ACCT_NM
                    ,STC2.SELL_TO_CUST_CD       AS SHIP_TO_CUST_ACCT_CD
                    ,STC2.DS_ACCT_NM            AS SHIP_TO_CUST_ACCT_NM
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
                 FROM
                      DS_CONTR_DTL       DCD
                     ,DS_CONTR_DTL_TP    DDT
                     ,DS_CONTR           DC
                     ,TOC                TOC
                     ,BILL_TO_CUST       BT
                     ,SHIP_TO_CUST       ST
                     ,CTRY               CTRY_B
                     ,CTRY               CTRY_S
                     ,BLLG_CYCLE         BC_B
                     ,BASE               BASE
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
                     ,DS_CONTR_DTL_STS_V DCDS
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
                    ,SELL_TO_CUST       STC1
                    ,SELL_TO_CUST       STC2
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
                 WHERE
                         DCD.GLBL_CMPY_CD        = #glblCmpyCd#
                     AND DCD.EZCANCELFLAG        = '0'
                     <iterate property="dsContrPkList" var="dsContrPk[]" open="AND DCD.DS_CONTR_PK IN (" close=")" conjunction=",">
                         #dsContrPk[]#
                     </iterate>
                     AND DCD.DS_CONTR_DTL_TP_CD  = #dsContrDtlTpCdFlt#
                     AND DCD.GLBL_CMPY_CD        = DDT.GLBL_CMPY_CD
                     AND DDT.EZCANCELFLAG        = '0'
                     AND DCD.DS_CONTR_DTL_TP_CD  = DDT.DS_CONTR_DTL_TP_CD
                     AND DCD.GLBL_CMPY_CD        = DC.GLBL_CMPY_CD
                     AND DCD.DS_CONTR_PK         = DC.DS_CONTR_PK
                     AND DC.EZCANCELFLAG         = '0'
                     AND DC.GLBL_CMPY_CD          = BT.GLBL_CMPY_CD
                     AND DC.ALT_PAYER_CUST_CD     = BT.BILL_TO_CUST_CD
                     AND BT.EZCANCELFLAG          = '0'
                     AND BT.GLBL_CMPY_CD         = CTRY_B.GLBL_CMPY_CD
                     AND BT.CTRY_CD              = CTRY_B.CTRY_CD
                     AND CTRY_B.EZCANCELFLAG     = '0'
                     AND DC.GLBL_CMPY_CD         = TOC.GLBL_CMPY_CD
                     AND DC.TOC_CD               = TOC.TOC_CD
                     AND TOC.EZCANCELFLAG        = '0'
                     AND DCD.GLBL_CMPY_CD        = ST.GLBL_CMPY_CD
                     AND DCD.SHIP_TO_CUST_CD     = ST.SHIP_TO_CUST_CD
                     AND ST.EZCANCELFLAG         = '0'
                     AND ST.GLBL_CMPY_CD          = CTRY_S.GLBL_CMPY_CD
                     AND ST.CTRY_CD               = CTRY_S.CTRY_CD
                     AND CTRY_S.EZCANCELFLAG          = '0'
                     AND DCD.GLBL_CMPY_CD         = BASE.GLBL_CMPY_CD
                     AND DCD.DS_CONTR_DTL_PK      = BASE.DS_CONTR_DTL_PK
<!-- START 2018/05/14 T.Wada [QC#25904, MOD] -->
<!--                 AND DCD.CONTR_EFF_THRU_DT    &lt;= BASE.CONTR_PRC_EFF_THRU_DT -->
                     AND NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT)    &lt;= BASE.CONTR_PRC_EFF_THRU_DT
<!-- END 2018/05/14 T.Wada [QC#25904, MOD] -->
                     AND BASE.GLBL_CMPY_CD        = BC_B.GLBL_CMPY_CD(+)
                     AND BASE.BLLG_CYCLE_CD       = BC_B.BLLG_CYCLE_CD(+)
                     AND BC_B.EZCANCELFLAG(+)     = '0'
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
                     AND DCD.GLBL_CMPY_CD         = DCDS.GLBL_CMPY_CD
                     AND DCD.DS_CONTR_DTL_PK      = DCDS.DS_CONTR_DTL_PK
                     AND DCDS.AGMT_LTR_AVAL_FLG   = 'Y'
                     AND DCDS.EZCANCELFLAG        = '0'
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
                    AND BT.GLBL_CMPY_CD          = STC1.GLBL_CMPY_CD
                    AND BT.SELL_TO_CUST_CD       = STC1.SELL_TO_CUST_CD
                    AND STC1.EZCANCELFLAG        = '0'
                    AND ST.GLBL_CMPY_CD          = STC2.GLBL_CMPY_CD
                    AND ST.SELL_TO_CUST_CD       = STC2.SELL_TO_CUST_CD
                    AND STC2.EZCANCELFLAG        = '0'
<!-- END 2018/05/14 T.Wada [QC#25904, ADD] -->
            )
       SELECT
             FL.LINE_LV
            ,FL.DS_CONTR_PK
            ,FL.DS_CONTR_DTL_PK
            ,FL.DS_CONTR_CATG_CD
            ,FL.DS_CONTR_BLLG_MTR_PK
            ,FL.SVC_PHYS_MTR_PK
            ,FL.MTR_LB_SORT_NUM
            ,FL.TOC_NM
            ,FL.BILL_TO_CUST_CD
            ,FL.BILL_TO_LOC_NM
            ,FL.BILL_TO_FIRST_LINE_ADDR
            ,FL.BILL_TO_SCD_LINE_ADDR
            ,FL.BILL_TO_THIRD_LINE_ADDR
            ,FL.BILL_TO_FRTH_LINE_ADDR
            ,FL.BILL_TO_CTY_ADDR
            ,FL.BILL_TO_ST_CD
            ,FL.BILL_TO_POST_CD
            ,FL.BILL_TO_CTRY_NM
            ,FL.SHIP_TO_CUST_CD
            ,FL.SHIP_TO_LOC_NM
            ,FL.SHIP_TO_FIRST_LINE_ADDR
            ,FL.SHIP_TO_SCD_LINE_ADDR
            ,FL.SHIP_TO_THIRD_LINE_ADDR
            ,FL.SHIP_TO_FRTH_LINE_ADDR
            ,FL.SHIP_TO_CTY_ADDR
            ,FL.SHIP_TO_ST_CD
            ,FL.SHIP_TO_POST_CD
            ,FL.SHIP_TO_CTRY_NM
            ,FL.DS_CONTR_NUM
            ,FL.BASE_BLLG_CYCLE_DESC_TXT
            ,FL.BASE_BLLG_CYCLE_MTH_AOT
            ,FL.USG_BLLG_CYCLE_DESC_TXT
            ,FL.USG_BLLG_CYCLE_MTH_AOT
            ,FL.CONTR_EFF_FROM_DT_TXT
            ,FL.CONTR_EFF_THRU_DT_TXT
            ,FL.MDL_NM
            ,FL.SER_NUM
            ,FL.START_READ_MTR_CNT_QTY_TXT
            ,FL.XS_MTR_COV_COPY_QTY_TXT
            ,FL.XS_MTR_COPY_FROM_QTY_TXT
            ,FL.XS_MTR_COPY_THRU_QTY_TXT
            ,FL.XS_MTR_AMT_TXT
            ,FL.BASE_PRC_DEAL_AMT_TXT
            ,FL.SORT_SER_NUM
            ,FL.DS_CONTR_DTL_TP_SORT_NUM
            ,FL.CONTR_XS_COPY_PK
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,FL.BILL_TO_CUST_ACCT_CD
            ,FL.BILL_TO_CUST_ACCT_NM
            ,FL.SHIP_TO_CUST_ACCT_CD
            ,FL.SHIP_TO_CUST_ACCT_NM
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
        FROM
           FLT_LINE FL
        UNION ALL
        SELECT
             '2'                        AS LINE_LV
            ,DCD.DS_CONTR_PK            AS DS_CONTR_PK
            ,DCD.DS_CONTR_DTL_PK        AS DS_CONTR_DTL_PK
            ,DC.DS_CONTR_CATG_CD
<!-- START 2021/01/29 Y.Penequito [QC#58312,ADD] -->
            ,DCD.SVC_INV_MERGE_TP_CD
            ,DCD.PRNT_DS_CONTR_DTL_PK
<!-- END 2021/01/29 Y.Penequito [QC#58312,ADD] -->
            ,0                          AS DS_CONTR_BLLG_MTR_PK
            ,0                          AS SVC_PHYS_MTR_PK
            ,0                          AS MTR_LB_SORT_NUM
            ,TOC.TOC_NM
            ,BT.BILL_TO_CUST_CD
            ,BT.LOC_NUM                 AS BILL_TO_LOC_NM
            ,BT.FIRST_LINE_ADDR         AS BILL_TO_FIRST_LINE_ADDR
            ,BT.SCD_LINE_ADDR           AS BILL_TO_SCD_LINE_ADDR
            ,BT.THIRD_LINE_ADDR         AS BILL_TO_THIRD_LINE_ADDR
            ,BT.FRTH_LINE_ADDR          AS BILL_TO_FRTH_LINE_ADDR
            ,BT.CTY_ADDR                AS BILL_TO_CTY_ADDR
            ,BT.ST_CD                   AS BILL_TO_ST_CD
            ,BT.POST_CD                 AS BILL_TO_POST_CD
            ,CTRY_B.CTRY_NM             AS BILL_TO_CTRY_NM
            ,FL.SHIP_TO_CUST_CD         AS SHIP_TO_CUST_CD
            ,FL.SHIP_TO_LOC_NM          AS SHIP_TO_LOC_NM
            ,FL.SHIP_TO_FIRST_LINE_ADDR AS SHIP_TO_FIRST_LINE_ADDR
            ,FL.SHIP_TO_SCD_LINE_ADDR   AS SHIP_TO_SCD_LINE_ADDR
            ,FL.SHIP_TO_THIRD_LINE_ADDR AS SHIP_TO_THIRD_LINE_ADDR
            ,FL.SHIP_TO_FRTH_LINE_ADDR  AS SHIP_TO_FRTH_LINE_ADDR
            ,FL.SHIP_TO_CTY_ADDR        AS SHIP_TO_CTY_ADDR
            ,FL.SHIP_TO_ST_CD           AS SHIP_TO_ST_CD
            ,FL.SHIP_TO_POST_CD         AS SHIP_TO_POST_CD
            ,FL.SHIP_TO_CTRY_NM         AS SHIP_TO_CTRY_NM
            ,DC.DS_CONTR_NUM
            ,BC_B.BLLG_CYCLE_NM         AS BASE_BLLG_CYCLE_DESC_TXT
            ,BC_B.BLLG_CYCLE_MTH_AOT    AS BASE_BLLG_CYCLE_MTH_AOT
            ,''                         AS USG_BLLG_CYCLE_DESC_TXT
            ,0                          AS USG_BLLG_CYCLE_MTH_AOT
            ,DC.CONTR_VRSN_EFF_FROM_DT  AS CONTR_EFF_FROM_DT_TXT
            ,DC.CONTR_VRSN_EFF_THRU_DT  AS CONTR_EFF_THRU_DT_TXT
            ,MDS.MDSE_DESC_SHORT_TXT    AS MDL_NM
            ,''                         AS SER_NUM
            ,''                         AS START_READ_MTR_CNT_QTY_TXT
            ,(
            SELECT
                TO_CHAR(NVL(SUM(BM1.XS_MTR_COPY_QTY), ''))
            FROM
                BLLG_MTR           BM1
            WHERE
                    BM1.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
                AND BM1.DS_CONTR_DTL_PK = DCD.DS_CONTR_DTL_PK
                AND BM1.CONTR_PRC_EFF_THRU_DT &gt;= DCD.CONTR_EFF_THRU_DT
            )                           AS XS_MTR_COV_COPY_QTY_TXT
            ,''                         AS XS_MTR_COPY_FROM_QTY_TXT
            ,''                         AS XS_MTR_COPY_THRU_QTY_TXT
            ,''                         AS XS_MTR_AMT_TXT
            ,TO_CHAR(NVL(BASE.BASE_PRC_DEAL_AMT, '')) AS BASE_PRC_DEAL_AMT_TXT
            ,''                         AS SORT_SER_NUM
            ,DDT.DS_CONTR_DTL_TP_SORT_NUM
            ,0                          AS CONTR_XS_COPY_PK
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,STC1.SELL_TO_CUST_CD       AS BILL_TO_CUST_ACCT_CD
            ,STC1.DS_ACCT_NM            AS BILL_TO_CUST_ACCT_NM
            ,FL.SHIP_TO_CUST_ACCT_CD    AS SHIP_TO_CUST_ACCT_CD
            ,FL.SHIP_TO_CUST_ACCT_NM    AS SHIP_TO_CUST_ACCT_NM
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->

        FROM
             DS_CONTR_DTL       DCD
            ,DS_CONTR_DTL_TP    DDT
            ,DS_CONTR           DC
            ,TOC                TOC
            ,BILL_TO_CUST       BT
            ,CTRY               CTRY_B
            ,MDSE               MDS
            ,BLLG_CYCLE         BC_B
            ,BASE               BASE
            ,FLT_LINE           FL
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            ,DS_CONTR_DTL_STS_V DCDS
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,SELL_TO_CUST       STC1
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
        WHERE
                DCD.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DCD.EZCANCELFLAG         = '0'
            <iterate property="dsContrPkList" var="dsContrPk[]" open="AND DCD.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND DCD.DS_CONTR_DTL_TP_CD   = #dsContrDtlTpCdFlt#
            AND DCD.GLBL_CMPY_CD         = DDT.GLBL_CMPY_CD
            AND DDT.EZCANCELFLAG         = '0'
            AND DCD.DS_CONTR_DTL_TP_CD   = DDT.DS_CONTR_DTL_TP_CD
            AND DCD.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK          = DC.DS_CONTR_PK
            AND DC.EZCANCELFLAG          = '0'
            AND DC.GLBL_CMPY_CD          = BT.GLBL_CMPY_CD
            AND DC.ALT_PAYER_CUST_CD     = BT.BILL_TO_CUST_CD
            AND BT.EZCANCELFLAG          = '0'
            AND BT.GLBL_CMPY_CD          = CTRY_B.GLBL_CMPY_CD
            AND BT.CTRY_CD               = CTRY_B.CTRY_CD
            AND CTRY_B.EZCANCELFLAG      = '0'
            AND DC.GLBL_CMPY_CD          = TOC.GLBL_CMPY_CD
            AND DC.TOC_CD                = TOC.TOC_CD
            AND TOC.EZCANCELFLAG         = '0'
            AND DCD.GLBL_CMPY_CD         = MDS.GLBL_CMPY_CD(+)
            AND DCD.SVC_PGM_MDSE_CD      = MDS.MDSE_CD(+)
            AND MDS.EZCANCELFLAG(+)      = '0'
            AND DCD.GLBL_CMPY_CD         = BASE.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK      = BASE.DS_CONTR_DTL_PK
<!-- START 2018/05/14 T.Wada [QC#25904, MOD] -->
<!--        AND DCD.CONTR_EFF_THRU_DT    &lt;= BASE.CONTR_PRC_EFF_THRU_DT -->
            AND NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT)    &lt;= BASE.CONTR_PRC_EFF_THRU_DT
<!-- END 2018/05/14 T.Wada [QC#25904, MOD] -->
            AND BASE.GLBL_CMPY_CD        = BC_B.GLBL_CMPY_CD(+)
            AND BASE.BLLG_CYCLE_CD       = BC_B.BLLG_CYCLE_CD(+)
            AND BC_B.EZCANCELFLAG(+)     = '0'
            AND DCD.DS_CONTR_PK          = FL.DS_CONTR_PK
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            AND DCD.GLBL_CMPY_CD         = DCDS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK      = DCDS.DS_CONTR_DTL_PK
            AND DCDS.AGMT_LTR_AVAL_FLG   = 'Y'
            AND DCDS.EZCANCELFLAG        = '0'
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            AND BT.GLBL_CMPY_CD          = STC1.GLBL_CMPY_CD
            AND BT.SELL_TO_CUST_CD       = STC1.SELL_TO_CUST_CD
            AND STC1.EZCANCELFLAG        = '0'
<!-- END 2018/05/14 T.Wada [QC#25904, ADD] -->
        UNION ALL
        SELECT
             '3'                        AS LINE_LV
            ,DCD.DS_CONTR_PK            AS DS_CONTR_PK
            ,DCD.DS_CONTR_DTL_PK        AS DS_CONTR_DTL_PK
            ,DC.DS_CONTR_CATG_CD
<!-- START 2021/01/29 Y.Penequito [QC#58312,ADD] -->
            ,DCD.SVC_INV_MERGE_TP_CD
            ,DCD.PRNT_DS_CONTR_DTL_PK
<!-- END 2021/01/29 Y.Penequito [QC#58312,ADD] -->
            ,BM1.DS_CONTR_BLLG_MTR_PK   AS DS_CONTR_BLLG_MTR_PK
            ,BM1.SVC_PHYS_MTR_PK        AS SVC_PHYS_MTR_PK
            ,BM1.MTR_LB_SORT_NUM        AS MTR_LB_SORT_NUM
            ,TOC.TOC_NM
            ,BT.BILL_TO_CUST_CD
            ,BT.LOC_NUM                 AS BILL_TO_LOC_NM
            ,BT.FIRST_LINE_ADDR         AS BILL_TO_FIRST_LINE_ADDR
            ,BT.SCD_LINE_ADDR           AS BILL_TO_SCD_LINE_ADDR
            ,BT.THIRD_LINE_ADDR         AS BILL_TO_THIRD_LINE_ADDR
            ,BT.FRTH_LINE_ADDR          AS BILL_TO_FRTH_LINE_ADDR
            ,BT.CTY_ADDR                AS BILL_TO_CTY_ADDR
            ,BT.ST_CD                   AS BILL_TO_ST_CD
            ,BT.POST_CD                 AS BILL_TO_POST_CD
            ,CTRY_B.CTRY_NM             AS BILL_TO_CTRY_NM
            ,FL.SHIP_TO_CUST_CD         AS SHIP_TO_CUST_CD
            ,FL.SHIP_TO_LOC_NM          AS SHIP_TO_LOC_NM
            ,FL.SHIP_TO_FIRST_LINE_ADDR AS SHIP_TO_FIRST_LINE_ADDR
            ,FL.SHIP_TO_SCD_LINE_ADDR   AS SHIP_TO_SCD_LINE_ADDR
            ,FL.SHIP_TO_THIRD_LINE_ADDR AS SHIP_TO_THIRD_LINE_ADDR
            ,FL.SHIP_TO_FRTH_LINE_ADDR  AS SHIP_TO_FRTH_LINE_ADDR
            ,FL.SHIP_TO_CTY_ADDR        AS SHIP_TO_CTY_ADDR
            ,FL.SHIP_TO_ST_CD           AS SHIP_TO_ST_CD
            ,FL.SHIP_TO_POST_CD         AS SHIP_TO_POST_CD
            ,FL.SHIP_TO_CTRY_NM         AS SHIP_TO_CTRY_NM
            ,DC.DS_CONTR_NUM
            ,''                         AS BASE_BLLG_CYCLE_DESC_TXT
            ,0                          AS BASE_BLLG_CYCLE_MTH_AOT
            ,BC_U.BLLG_CYCLE_NM         AS USG_BLLG_CYCLE_DESC_TXT
            ,BC_U.BLLG_CYCLE_MTH_AOT    AS USG_BLLG_CYCLE_MTH_AOT
            ,DC.CONTR_VRSN_EFF_FROM_DT  AS CONTR_EFF_FROM_DT_TXT
            ,DC.CONTR_VRSN_EFF_THRU_DT  AS CONTR_EFF_THRU_DT_TXT
            ,BM1.MTR_LB_DESC_TXT        AS MDL_NM
            ,''                         AS SER_NUM
            ,(SELECT
                  TO_CHAR(NVL(SUM(SR2.READ_MTR_CNT), ''))
              FROM 
                  (SELECT
                            SR.READ_MTR_CNT
                           ,SR.BLLG_MTR_LB_CD
                  FROM
                           START_READ SR
                  WHERE
                           SR.BLLG_MTR_LB_CD = BM1.BLLG_MTR_LB_CD
                       AND SR.DS_CONTR_PK    = DCD.DS_CONTR_PK
                  ) SR2
            )                           AS START_READ_MTR_CNT_QTY_TXT
            ,''                         AS XS_MTR_COV_COPY_QTY_TXT
            ,TO_CHAR(NVL(BM1.XS_MTR_COPY_QTY + 1, ''))       AS XS_MTR_COPY_FROM_QTY_TXT
            ,TO_CHAR(NVL(BM1.XS_MTR_COPY_THRU_QTY_TXT, ''))  AS XS_MTR_COPY_THRU_QTY_TXT
            ,TO_CHAR(NVL(BM1.XS_MTR_AMT_RATE, ''))           AS XS_MTR_AMT_TXT
            ,''                         AS BASE_PRC_DEAL_AMT_TXT
            ,''                         AS SORT_SER_NUM   
            ,DDT.DS_CONTR_DTL_TP_SORT_NUM
            ,BM1.CONTR_XS_COPY_PK       AS CONTR_XS_COPY_PK
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,STC1.SELL_TO_CUST_CD       AS BILL_TO_CUST_ACCT_CD
            ,STC1.DS_ACCT_NM            AS BILL_TO_CUST_ACCT_NM
            ,FL.SHIP_TO_CUST_ACCT_CD    AS SHIP_TO_CUST_ACCT_CD
            ,FL.SHIP_TO_CUST_ACCT_NM    AS SHIP_TO_CUST_ACCT_NM
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
        FROM
             DS_CONTR_DTL       DCD
            ,DS_CONTR_DTL_TP    DDT
            ,DS_CONTR           DC
            ,TOC                TOC
            ,BLLG_CYCLE         BC_U
            ,BLLG_MTR           BM1
            ,BILL_TO_CUST       BT
            ,CTRY               CTRY_B
            ,FLT_LINE           FL
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            ,DS_CONTR_DTL_STS_V DCDS
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,SELL_TO_CUST       STC1
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
        WHERE
                DCD.GLBL_CMPY_CD                = #glblCmpyCd#
            AND DCD.EZCANCELFLAG                = '0'
            <iterate property="dsContrPkList" var="dsContrPk[]" open="AND DCD.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND DCD.DS_CONTR_DTL_TP_CD          = #dsContrDtlTpCdFlt#
            AND DCD.GLBL_CMPY_CD                = DDT.GLBL_CMPY_CD
            AND DDT.EZCANCELFLAG                = '0'
            AND DCD.DS_CONTR_DTL_TP_CD          = DDT.DS_CONTR_DTL_TP_CD
            AND DCD.GLBL_CMPY_CD                = DC.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK                 = DC.DS_CONTR_PK
            AND DC.EZCANCELFLAG                 = '0'
            AND DC.GLBL_CMPY_CD                 = BT.GLBL_CMPY_CD
            AND DC.ALT_PAYER_CUST_CD            = BT.BILL_TO_CUST_CD
            AND BT.EZCANCELFLAG                 = '0'
            AND DC.GLBL_CMPY_CD                 = TOC.GLBL_CMPY_CD
            AND DC.TOC_CD                       = TOC.TOC_CD
            AND TOC.EZCANCELFLAG                = '0'
            AND DCD.GLBL_CMPY_CD                = BM1.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK             = BM1.DS_CONTR_DTL_PK
<!-- START 2018/05/14 T.Wada [QC#25904, MOD] -->
<!--        AND DCD.CONTR_EFF_THRU_DT           &lt;= BM1.CONTR_PRC_EFF_THRU_DT -->
            AND NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT)    &lt;= BM1.CONTR_PRC_EFF_THRU_DT
<!-- END 2018/05/14 T.Wada [QC#25904, MOD] -->
            AND BM1.GLBL_CMPY_CD                = BC_U.GLBL_CMPY_CD(+)
            AND BM1.BLLG_CYCLE_CD               = BC_U.BLLG_CYCLE_CD(+)
            AND BC_U.EZCANCELFLAG(+)            = '0'
            AND BT.GLBL_CMPY_CD                 = CTRY_B.GLBL_CMPY_CD
            AND BT.CTRY_CD                      = CTRY_B.CTRY_CD
            AND CTRY_B.EZCANCELFLAG             = '0'
            AND DCD.DS_CONTR_PK                 = FL.DS_CONTR_PK
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            AND DCD.GLBL_CMPY_CD         = DCDS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK      = DCDS.DS_CONTR_DTL_PK
            AND DCDS.AGMT_LTR_AVAL_FLG   = 'Y'
            AND DCDS.EZCANCELFLAG        = '0'
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            AND BT.GLBL_CMPY_CD          = STC1.GLBL_CMPY_CD
            AND BT.SELL_TO_CUST_CD       = STC1.SELL_TO_CUST_CD
            AND STC1.EZCANCELFLAG        = '0'
<!-- END 2018/05/14 T.Wada [QC#25904, ADD] -->
        UNION ALL
        SELECT
             '4'                        AS LINE_LV
            ,DCD.DS_CONTR_PK
            ,DCD.DS_CONTR_DTL_PK
            ,DC.DS_CONTR_CATG_CD
<!-- START 2021/01/29 Y.Penequito [QC#58312,ADD] -->
            ,DCD.SVC_INV_MERGE_TP_CD
            ,DCD.PRNT_DS_CONTR_DTL_PK
<!-- END 2021/01/29 Y.Penequito [QC#58312,ADD] -->
            ,0                          AS DS_CONTR_BLLG_MTR_PK
            ,0                          AS SVC_PHYS_MTR_PK
            ,0                          AS MTR_LB_SORT_NUM
            ,TOC.TOC_NM
            ,BT.BILL_TO_CUST_CD
            ,BT.LOC_NUM                 AS BILL_TO_LOC_NM
            ,BT.FIRST_LINE_ADDR         AS BILL_TO_FIRST_LINE_ADDR
            ,BT.SCD_LINE_ADDR           AS BILL_TO_SCD_LINE_ADDR
            ,BT.THIRD_LINE_ADDR         AS BILL_TO_THIRD_LINE_ADDR
            ,BT.FRTH_LINE_ADDR          AS BILL_TO_FRTH_LINE_ADDR
            ,BT.CTY_ADDR                AS BILL_TO_CTY_ADDR
            ,BT.ST_CD                   AS BILL_TO_ST_CD
            ,BT.POST_CD                 AS BILL_TO_POST_CD
            ,CTRY_B.CTRY_NM             AS BILL_TO_CTRY_NM
            ,FL.SHIP_TO_CUST_CD         AS SHIP_TO_CUST_CD
            ,FL.SHIP_TO_LOC_NM          AS SHIP_TO_LOC_NM
            ,FL.SHIP_TO_FIRST_LINE_ADDR AS SHIP_TO_FIRST_LINE_ADDR
            ,FL.SHIP_TO_SCD_LINE_ADDR   AS SHIP_TO_SCD_LINE_ADDR
            ,FL.SHIP_TO_THIRD_LINE_ADDR AS SHIP_TO_THIRD_LINE_ADDR
            ,FL.SHIP_TO_FRTH_LINE_ADDR  AS SHIP_TO_FRTH_LINE_ADDR
            ,FL.SHIP_TO_CTY_ADDR        AS SHIP_TO_CTY_ADDR
            ,FL.SHIP_TO_ST_CD           AS SHIP_TO_ST_CD
            ,FL.SHIP_TO_POST_CD         AS SHIP_TO_POST_CD
            ,FL.SHIP_TO_CTRY_NM         AS SHIP_TO_CTRY_NM
            ,DC.DS_CONTR_NUM
            ,''                         AS BASE_BLLG_CYCLE_DESC_TXT
            ,0                          AS BASE_BLLG_CYCLE_MTH_AOT
            ,''                         AS USG_BLLG_CYCLE_DESC_TXT
            ,0                          AS USG_BLLG_CYCLE_MTH_AOT
            ,DC.CONTR_VRSN_EFF_FROM_DT  AS CONTR_EFF_FROM_DT_TXT
            ,DC.CONTR_VRSN_EFF_THRU_DT  AS CONTR_EFF_THRU_DT_TXT
            ,MN.T_MDL_NM                AS MDL_NM
            ,SMM.SER_NUM
            ,''                         AS START_READ_MTR_CNT_QTY_TXT
            ,''                         AS XS_MTR_COV_COPY_QTY_TXT
            ,''                         AS XS_MTR_COPY_FROM_QTY_TXT
            ,''                         AS XS_MTR_COPY_THRU_QTY_TXT
            ,''                         AS XS_MTR_AMT_TXT
            ,''                         AS BASE_PRC_DEAL_AMT_TXT
            ,SMM.SER_NUM                AS SORT_SER_NUM
            ,DDT.DS_CONTR_DTL_TP_SORT_NUM
            ,0                          AS CONTR_XS_COPY_PK
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,STC1.SELL_TO_CUST_CD       AS BILL_TO_CUST_ACCT_CD
            ,STC1.DS_ACCT_NM            AS BILL_TO_CUST_ACCT_NM
            ,FL.SHIP_TO_CUST_ACCT_CD    AS SHIP_TO_CUST_ACCT_CD
            ,FL.SHIP_TO_CUST_ACCT_NM    AS SHIP_TO_CUST_ACCT_NM
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
        FROM
             DS_CONTR_DTL       DCD
            ,DS_CONTR_DTL_TP    DDT
            ,DS_CONTR           DC
            ,TOC                TOC
            ,SVC_MACH_MSTR      SMM
            ,SVC_CONFIG_MSTR    SCM
            ,MDL_NM             MN
            ,BILL_TO_CUST       BT
            ,CTRY               CTRY_B
            ,FLT_LINE           FL
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            ,DS_CONTR_DTL_STS_V DCDS
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,SELL_TO_CUST       STC1
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
        WHERE
                DCD.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DCD.EZCANCELFLAG        = '0'
            <iterate property="dsContrPkList" var="dsContrPk[]" open="AND DCD.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND DCD.DS_CONTR_DTL_TP_CD  &lt;&gt; #dsContrDtlTpCdFlt#
            AND DCD.GLBL_CMPY_CD        = DDT.GLBL_CMPY_CD
            AND DDT.EZCANCELFLAG        = '0'
            AND DCD.DS_CONTR_DTL_TP_CD  = DDT.DS_CONTR_DTL_TP_CD
            AND DCD.GLBL_CMPY_CD        = DC.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK         = DC.DS_CONTR_PK
            AND DC.EZCANCELFLAG         = '0'
            AND DC.GLBL_CMPY_CD         = TOC.GLBL_CMPY_CD
            AND DC.TOC_CD               = TOC.TOC_CD
            AND TOC.EZCANCELFLAG        = '0'
            AND DC.GLBL_CMPY_CD         = BT.GLBL_CMPY_CD
            AND DC.ALT_PAYER_CUST_CD    = BT.BILL_TO_CUST_CD
            AND BT.EZCANCELFLAG         = '0'
            AND BT.GLBL_CMPY_CD         = CTRY_B.GLBL_CMPY_CD
            AND BT.CTRY_CD              = CTRY_B.CTRY_CD
            AND CTRY_B.EZCANCELFLAG     = '0'
            AND DCD.GLBL_CMPY_CD        = SMM.GLBL_CMPY_CD
            AND DCD.SVC_MACH_MSTR_PK    = SMM.SVC_MACH_MSTR_PK
            AND SMM.EZCANCELFLAG        = '0'
            AND SMM.SVC_MACH_TP_CD      = #svcMachTpCdMach#
            AND SMM.GLBL_CMPY_CD        = SCM.GLBL_CMPY_CD
            AND SMM.SVC_CONFIG_MSTR_PK  = SCM.SVC_CONFIG_MSTR_PK
            AND SCM.EZCANCELFLAG        = '0'
            AND SCM.GLBL_CMPY_CD        = MN.T_GLBL_CMPY_CD
            AND SCM.MDL_ID              = MN.T_MDL_ID
            AND DCD.DS_CONTR_PK         = FL.DS_CONTR_PK
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            AND DCD.GLBL_CMPY_CD         = DCDS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK      = DCDS.DS_CONTR_DTL_PK
            AND DCDS.AGMT_LTR_AVAL_FLG   = 'Y'
            AND DCDS.EZCANCELFLAG        = '0'
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            AND BT.GLBL_CMPY_CD          = STC1.GLBL_CMPY_CD
            AND BT.SELL_TO_CUST_CD       = STC1.SELL_TO_CUST_CD
            AND STC1.EZCANCELFLAG        = '0'
<!-- END 2018/05/14 T.Wada [QC#25904, ADD] -->
        UNION ALL
        SELECT
             '5'                        AS LINE_LV
            ,DCD.DS_CONTR_PK            AS DS_CONTR_PK
            ,DCD.DS_CONTR_DTL_PK        AS DS_CONTR_DTL_PK
            ,DC.DS_CONTR_CATG_CD
<!-- START 2021/01/29 Y.Penequito [QC#58312,ADD] -->
            ,DCD.SVC_INV_MERGE_TP_CD
            ,DCD.PRNT_DS_CONTR_DTL_PK
<!-- END 2021/01/29 Y.Penequito [QC#58312,ADD] -->
            ,0                          AS DS_CONTR_BLLG_MTR_PK
            ,0                          AS SVC_PHYS_MTR_PK
            ,0                          AS MTR_LB_SORT_NUM
            ,TOC.TOC_NM
            ,BT.BILL_TO_CUST_CD
            ,BT.LOC_NUM                 AS BILL_TO_LOC_NM
            ,BT.FIRST_LINE_ADDR         AS BILL_TO_FIRST_LINE_ADDR
            ,BT.SCD_LINE_ADDR           AS BILL_TO_SCD_LINE_ADDR
            ,BT.THIRD_LINE_ADDR         AS BILL_TO_THIRD_LINE_ADDR
            ,BT.FRTH_LINE_ADDR          AS BILL_TO_FRTH_LINE_ADDR
            ,BT.CTY_ADDR                AS BILL_TO_CTY_ADDR
            ,BT.ST_CD                   AS BILL_TO_ST_CD
            ,BT.POST_CD                 AS BILL_TO_POST_CD
            ,CTRY_B.CTRY_NM             AS BILL_TO_CTRY_NM
            ,FL.SHIP_TO_CUST_CD         AS SHIP_TO_CUST_CD
            ,FL.SHIP_TO_LOC_NM          AS SHIP_TO_LOC_NM
            ,FL.SHIP_TO_FIRST_LINE_ADDR AS SHIP_TO_FIRST_LINE_ADDR
            ,FL.SHIP_TO_SCD_LINE_ADDR   AS SHIP_TO_SCD_LINE_ADDR
            ,FL.SHIP_TO_THIRD_LINE_ADDR AS SHIP_TO_THIRD_LINE_ADDR
            ,FL.SHIP_TO_FRTH_LINE_ADDR  AS SHIP_TO_FRTH_LINE_ADDR
            ,FL.SHIP_TO_CTY_ADDR        AS SHIP_TO_CTY_ADDR
            ,FL.SHIP_TO_ST_CD           AS SHIP_TO_ST_CD
            ,FL.SHIP_TO_POST_CD         AS SHIP_TO_POST_CD
            ,FL.SHIP_TO_CTRY_NM         AS SHIP_TO_CTRY_NM
            ,DC.DS_CONTR_NUM
            ,''                         AS BASE_BLLG_CYCLE_DESC_TXT
            ,0                          AS BASE_BLLG_CYCLE_MTH_AOT
            ,''                         AS USG_BLLG_CYCLE_DESC_TXT
            ,0                          AS USG_BLLG_CYCLE_MTH_AOT
            ,DC.CONTR_VRSN_EFF_FROM_DT  AS CONTR_EFF_FROM_DT_TXT
            ,DC.CONTR_VRSN_EFF_THRU_DT  AS CONTR_EFF_THRU_DT_TXT
            ,MDS.MDSE_DESC_SHORT_TXT    AS MDL_NM
            ,SMM.SER_NUM                AS SER_NUM
            ,''                         AS START_READ_MTR_CNT_QTY_TXT
            ,''                         AS XS_MTR_COV_COPY_QTY_TXT
            ,''                         AS XS_MTR_COPY_FROM_QTY_TXT
            ,''                         AS XS_MTR_COPY_THRU_QTY_TXT
            ,''                         AS XS_MTR_AMT_TXT
            ,''                         AS BASE_PRC_DEAL_AMT_TXT
            ,NVL(SMMP.SER_NUM,SMM.SER_NUM) AS SORT_SER_NUM
            ,DDT.DS_CONTR_DTL_TP_SORT_NUM
            ,0 AS CONTR_XS_COPY_PK
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,STC1.SELL_TO_CUST_CD       AS BILL_TO_CUST_ACCT_CD
            ,STC1.DS_ACCT_NM            AS BILL_TO_CUST_ACCT_NM
            ,FL.SHIP_TO_CUST_ACCT_CD    AS SHIP_TO_CUST_ACCT_CD
            ,FL.SHIP_TO_CUST_ACCT_NM    AS SHIP_TO_CUST_ACCT_NM
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
        FROM
             DS_CONTR_DTL       DCD
            ,DS_CONTR_DTL_TP    DDT
            ,DS_CONTR           DC
            ,TOC                TOC
            ,SVC_MACH_MSTR      SMM
            ,DS_CONTR_DTL       DCDP
            ,SVC_MACH_MSTR      SMMP
            ,MDSE               MDS
            ,BILL_TO_CUST       BT
            ,CTRY               CTRY_B
            ,FLT_LINE           FL
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            ,DS_CONTR_DTL_STS_V DCDS
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            ,SELL_TO_CUST       STC1
<!-- End 2018/05/14 T.Wada [QC#25904, ADD] -->
        WHERE
                DCD.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DCD.EZCANCELFLAG         = '0'
            AND DCD.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD
            <iterate property="dsContrPkList" var="dsContrPk[]" open="AND DCD.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND DCD.DS_CONTR_DTL_TP_CD   &lt;&gt; #dsContrDtlTpCdFlt#
            AND DCD.GLBL_CMPY_CD         = DDT.GLBL_CMPY_CD
            AND DDT.EZCANCELFLAG         = '0'
            AND DCD.DS_CONTR_DTL_TP_CD   = DDT.DS_CONTR_DTL_TP_CD
            AND DCD.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK          = DC.DS_CONTR_PK
            AND DC.EZCANCELFLAG          = '0'
            AND DC.GLBL_CMPY_CD          = BT.GLBL_CMPY_CD
            AND DC.ALT_PAYER_CUST_CD     = BT.BILL_TO_CUST_CD
            AND BT.EZCANCELFLAG          = '0'
            AND BT.GLBL_CMPY_CD          = CTRY_B.GLBL_CMPY_CD
            AND BT.CTRY_CD               = CTRY_B.CTRY_CD
            AND CTRY_B.EZCANCELFLAG      = '0'
            AND DC.GLBL_CMPY_CD          = TOC.GLBL_CMPY_CD
            AND DC.TOC_CD                = TOC.TOC_CD
            AND TOC.EZCANCELFLAG         = '0'
            AND DCD.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD
            AND DCD.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK
            AND SMM.EZCANCELFLAG         = '0'
            AND SMM.SVC_MACH_TP_CD       = #svcMachTpCdAcc#
            AND DCD.PRNT_DS_CONTR_DTL_PK = DCDP.DS_CONTR_DTL_PK(+)
            AND DCD.GLBL_CMPY_CD         = DCDP.GLBL_CMPY_CD(+)
            AND DCDP.EZCANCELFLAG(+)     = '0'
            AND DCDP.GLBL_CMPY_CD        = SMMP.GLBL_CMPY_CD(+)
            AND DCDP.SVC_MACH_MSTR_PK    = SMMP.SVC_MACH_MSTR_PK(+)
            AND SMMP.EZCANCELFLAG(+)     = '0'
            AND DCD.GLBL_CMPY_CD         = MDS.GLBL_CMPY_CD(+)
            AND DCD.SVC_PGM_MDSE_CD      = MDS.MDSE_CD(+)
            AND MDS.EZCANCELFLAG(+)      = '0'
            AND DCD.DS_CONTR_PK          = FL.DS_CONTR_PK
<!-- START 2017/10/05 E.Kameishi [QC#21603, ADD] -->
            AND DCD.GLBL_CMPY_CD         = DCDS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK      = DCDS.DS_CONTR_DTL_PK
            AND DCDS.AGMT_LTR_AVAL_FLG   = 'Y'
            AND DCDS.EZCANCELFLAG        = '0'
<!-- END 2017/10/05 E.Kameishi [QC#21603, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, ADD] -->
            AND BT.GLBL_CMPY_CD          = STC1.GLBL_CMPY_CD
            AND BT.SELL_TO_CUST_CD       = STC1.SELL_TO_CUST_CD
            AND STC1.EZCANCELFLAG        = '0'
<!-- END 2018/05/14 T.Wada [QC#25904, ADD] -->
<!-- START 2018/05/14 T.Wada [QC#25904, MOD] -->
<!--ORDER BY SORT_SER_NUM NULLS FIRST,DS_CONTR_DTL_TP_SORT_NUM,LINE_LV,MTR_LB_SORT_NUM,CONTR_XS_COPY_PK -->
    ORDER BY DS_CONTR_PK,SORT_SER_NUM NULLS FIRST,DS_CONTR_DTL_TP_SORT_NUM,LINE_LV,MTR_LB_SORT_NUM,CONTR_XS_COPY_PK
<!-- END 2018/05/14 T.Wada [QC#25904, MOD] -->
    </statement>
    <statement id="getWrkDataForTermAndCond" parameterClass="Map" resultClass="Map">
        SELECT
             DC.DS_CONTR_PK
            ,STCL.SPEC_SIDE_TP_CD
            ,STCL.SVC_TERM_COND_HDR_NUM
            ,STCL.SVC_TERM_COND_DTL_NUM
            ,STCL.ENG_TTL_VAL_TXT
            ,STCL.ENG_DESC_VAL_TXT
            ,STCL.TERM_COND_VRSN_TXT
        FROM
             DS_CONTR           DC
            ,SVC_TERM_COND_LTR  STCL
        WHERE
                DC.GLBL_CMPY_CD         = #glblCmpyCd#
            <iterate property="dsContrPkList" var="dsContrPk[]" open="AND DC.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND DC.EZCANCELFLAG         = '0'
            AND DC.GLBL_CMPY_CD         = STCL.GLBL_CMPY_CD
            AND STCL.EZCANCELFLAG       = '0'
            AND EXISTS (
                    SELECT
                        1
                    FROM
                         DS_CONTR_DTL       DCD
                        ,SVC_MACH_MSTR      SMM
                    WHERE
                            DCD.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD
                        AND DCD.DS_CONTR_PK          = DC.DS_CONTR_PK
                        AND DCD.DS_CONTR_DTL_TP_CD   NOT IN (#dsContrDtlTpCdFlt#, #dsContrDtlTpCdAgg#)
                        AND DCD.EZCANCELFLAG        = '0'
                        AND DCD.GLBL_CMPY_CD        = SMM.GLBL_CMPY_CD
                        AND DCD.SVC_MACH_MSTR_PK    = SMM.SVC_MACH_MSTR_PK
                        AND SMM.EZCANCELFLAG        = '0'
                        AND SMM.GLBL_CMPY_CD        = STCL.GLBL_CMPY_CD
                        AND NVL(SMM.CORP_ADVTG_STS_CD, 'N')  = STCL.CORP_ADV_PRC_FLG
                        AND STCL.EFF_FROM_DT                    &lt;= #slsDt#
                        AND NVL(STCL.EFF_THRU_DT, #maxThruDt#)  &gt;= #slsDt#
                )
        ORDER BY
             STCL.SPEC_SIDE_TP_CD NULLS FIRST
            ,TO_NUMBER(STCL.SVC_TERM_COND_HDR_NUM)
            ,TO_NUMBER(STCL.SVC_TERM_COND_DTL_NUM)
    </statement>
    <statement id="getPrintData" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
             SPRL.DS_CONTR_PK
            ,SPRL.SHIP_TO_CUST_CD
            ,SPRL.DS_CONTR_NUM
        FROM
             SVC_PRC_RNW_LTR_WRK     SPRL
        WHERE
                SPRL.GLBL_CMPY_CD         = #glblCmpyCd#
            <iterate property="dsContrPkList" var="dsContrPk[]" open="AND SPRL.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND SPRL.EZCANCELFLAG         = '0'
            AND SPRL.BIZ_APP_ID           = #bizAppId#
        ORDER BY SPRL.DS_CONTR_NUM
    </statement>
<!-- END 2017/08/21 E.Kameishi [QC#8661,ADD] -->
    <!-- START 2017/11/14 K.Kojima [QC#21886,ADD] -->
    <statement id="getContrCtrlStsCdPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
             DS_CONTR_CTRL_STS_CD
            ,DS_CONTR_CTRL_STS_NM
        FROM
            (
                SELECT
                     DCCS.DS_CONTR_CTRL_STS_CD
                    ,DCCS.DS_CONTR_CTRL_STS_NM
                    ,ROW_NUMBER() OVER(PARTITION BY DCCS.DS_CONTR_CTRL_STS_NM ORDER BY DCCS.DS_CONTR_CTRL_STS_CD DESC) AS ROW_NUM
                FROM
                    DS_CONTR_CTRL_STS DCCS
                WHERE
                        DCCS.GLBL_CMPY_CD                = #glblCmpyCd#
                    <!-- START 2019/1/8 S.Kitamura [QC#29646,MOD] -->
                    <!-- AND DCCS.DS_CONTR_CTRL_STS_CD &lt;&gt; #dsContrCtrlStsOrdr# -->
                    <iterate property="dsContrCtrlStsList" var="dsContrCtrlSts[]" open="AND DCCS.DS_CONTR_CTRL_STS_CD NOT IN (" close=")" conjunction=",">
                        #dsContrCtrlSts[]#
                    </iterate>
                    <!-- END 2019/1/8 S.Kitamura [QC#29646,MOD] -->
                    AND DCCS.EZCANCELFLAG                = '0'
            )
        WHERE
            ROW_NUM = 1
        ORDER BY
            DS_CONTR_CTRL_STS_CD ASC
    </statement>
    <statement id="getSameNameCtrlSts" parameterClass="Map" resultClass="String">
        SELECT
            B.DS_CONTR_CTRL_STS_CD
        FROM
             DS_CONTR_CTRL_STS A
            ,DS_CONTR_CTRL_STS B
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCd#
            AND A.EZCANCELFLAG         = '0'
            AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD
            AND A.DS_CONTR_CTRL_STS_NM = B.DS_CONTR_CTRL_STS_NM
            AND A.EZCANCELFLAG         = '0'
    </statement>
    <!-- END 2017/11/14 K.Kojima [QC#21886,ADD] -->

<!-- START 2018/06/26 T.Ogura [QC#26336,ADD] -->
    <statement id="getDownloadList" parameterClass="Map" resultMap="result.getDownloadList">
        SELECT
            *
        FROM (
                SELECT 
                    SMM.SER_NUM
                    ,SMM.MDSE_CD
                    ,MN.T_MDL_NM
                    ,ML.MTR_LB_DESC_TXT
                    ,MTG.DS_MTR_READ_TP_GRP_CD || '-' || MTG.DS_MTR_READ_TP_GRP_DESC_TXT XX_MTR_READ_TP_GRP_DESC_TXT
                    ,MRT.DS_MTR_READ_TP_DESC_TXT
                    ,DECODE(SMR.VLD_MTR_FLG, 'Y', 'X', NULL) VLD_MTR_FLG
                    ,DENSE_RANK() OVER(PARTITION BY SMM.SER_NUM, SMR.MTR_READ_DT ORDER BY SMR.SVC_PHYS_MTR_READ_GRP_SQ DESC) GRP_NUM
                    ,TO_CHAR(TO_DATE(SMR.MTR_READ_DT, 'YYYYMMDD'),'MM/DD/YYYY') XX_READ_DT
                    ,SMR.READ_MTR_CNT
                    ,SMR.TEST_MTR_CNT
                    ,SMR.MTR_ENTRY_CMNT_TXT
                    ,CASE
                        WHEN AP.FIRST_NM IS NOT NULL THEN
                            SMR.RGTN_USR_ID || ':'
                                || DECODE(AP.LAST_NM,  null, '', AP.LAST_NM)
                                || DECODE(AP.FIRST_NM,    null, '', ' ' || AP.FIRST_NM)
                                || DECODE(AP.MID_NM,    null, '', ' ' || AP.MID_NM)
                        WHEN INSTRB(SMR.EZINUSERID, 'CONV') &gt; 0 THEN 'CONVERSION'
                        ELSE 'SYSTEM'
                    END XX_CRAT_PSN_NM
                    ,TO_CHAR(TO_TIMESTAMP(SMR.EZINTIME, 'YYYYMMDDHH24MISSFF3'), 'MM/DD/YYYY HH24:MI:SS') XX_CRT_DT
                    ,MRS.MTR_READ_SRC_TP_DESC_TXT 
                    <!-- START 2023/06/28 T.Kimura [QC#58675, DEL] -->
                    <!-- ,SMR.SVC_INV_NUM  -->
                    <!-- ,TO_CHAR(TO_DATE(SMR.INV_DT, 'YYYYMMDD'),'MM/DD/YYYY') XX_INV_DT -->
                    <!-- END 2023/06/28 T.Kimura [QC#58675, DEL] -->
                    <!-- START 2023/06/28 T.Kimura [QC#58675, ADD] -->
                    ,SIN.SVC_INV_NUM 
                    ,TO_CHAR(TO_DATE(SIN.INV_DT, 'YYYYMMDD'),'MM/DD/YYYY') XX_INV_DT 
                    <!-- END 2023/06/28 T.Kimura [QC#58675, ADD] -->
                    ,SMR.SVC_TASK_NUM
                    ,TCC.DS_TEST_COPY_CLS_DESC_TXT
                    ,BSC.LOC_NM BILL_TO_CUST_NM
                    ,DECODE(BCC.FIRST_LINE_ADDR,  null, '', BCC.FIRST_LINE_ADDR)
                            || DECODE(BCC.SCD_LINE_ADDR,    null, '', ' ' || BCC.SCD_LINE_ADDR)
                            || DECODE(BCC.THIRD_LINE_ADDR,  null, '', ' ' || BCC.THIRD_LINE_ADDR)
                            || DECODE(BCC.FRTH_LINE_ADDR,   null, '', ' ' || BCC.FRTH_LINE_ADDR)
                            || DECODE(BCC.CTY_ADDR,         null, '', ',' || BCC.CTY_ADDR)
                            || DECODE(BCC.ST_CD,            null, '', ' ' || BCC.ST_CD)
                            || DECODE(BCC.POST_CD,          null, '', ' ' || BCC.POST_CD) BILL_TO_LOC_ADDR
                    ,CSC.LOC_NM CUR_LOC_ACCT_NM
                    ,DECODE(SCC.FIRST_LINE_ADDR,  null, '', SCC.FIRST_LINE_ADDR)
                            || DECODE(SCC.SCD_LINE_ADDR,    null, '', ' ' || SCC.SCD_LINE_ADDR)
                            || DECODE(SCC.THIRD_LINE_ADDR,  null, '', ' ' || SCC.THIRD_LINE_ADDR)
                            || DECODE(SCC.FRTH_LINE_ADDR,   null, '', ' ' || SCC.FRTH_LINE_ADDR)
                            || DECODE(SCC.CTY_ADDR,         null, '', ',' || SCC.CTY_ADDR)
                            || DECODE(SCC.ST_CD,            null, '', ' ' || SCC.ST_CD)
                            || DECODE(SCC.POST_CD,          null, '', ' ' || SCC.POST_CD) CUR_LOC_ADDR
                FROM 
                    SVC_MACH_MSTR SMM
                    ,SELL_TO_CUST BSC
                    ,SELL_TO_CUST CSC
                    ,BILL_TO_CUST BCC
                    ,SHIP_TO_CUST SCC
                    ,SVC_CONFIG_MSTR SCM
                    ,MDL_NM MN
                    ,SVC_PHYS_MTR_READ SMR
                    ,MTR_LB ML
                    ,DS_MTR_READ_TP_GRP MTG
                    ,DS_TEST_COPY_CLS TCC
                    ,AUTH_PSN AP
                    ,MTR_READ_SRC_TP MRS
                    ,DS_MTR_READ_TP MRT
                    <!-- START 2023/06/28 T.Kimura [QC#58675, ADD] -->
                    ,(
                        SELECT
                             CPBMR.SVC_PHYS_MTR_PK
                            ,DCBS.SVC_PHYS_MTR_READ_GRP_SQ
                            ,DCBS.SVC_INV_NUM
                            ,DCBS.INV_DT
                        FROM
                             CONTR_PHYS_BLLG_MTR_RELN CPBMR
                            ,DS_CONTR_BLLG_SCHD DCBS
                        WHERE
                                CPBMR.GLBL_CMPY_CD = #glblCmpyCd#
                            AND CPBMR.EZCANCELFLAG= '0'
                            AND CPBMR.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD(+)
                            AND DCBS.EZCANCELFLAG(+) = '0'
                            AND DCBS.INV_TP_CD(+) &lt;&gt; #invTpCd#
                            AND CPBMR.DS_CONTR_BLLG_MTR_PK = DCBS.DS_CONTR_BLLG_MTR_PK(+)
                     ) SIN
                    <!-- END 2023/06/28 T.Kimura [QC#58675, ADD] -->
                WHERE
                        SMM.GLBL_CMPY_CD        = #glblCmpyCd#
                    <iterate property="svcMachMstrPkList" var="elem[]" open="AND (" close=")" conjunction="OR">
                        SMM.SVC_MACH_MSTR_PK = #elem[]#
                    </iterate>
                    AND SMM.EZCANCELFLAG        = '0'
                    AND SMM.GLBL_CMPY_CD        = BSC.GLBL_CMPY_CD(+)
                    AND SMM.BILL_TO_ACCT_NUM    = BSC.SELL_TO_CUST_CD(+)
                    AND BSC.EZCANCELFLAG(+)     = '0'
                    AND SMM.GLBL_CMPY_CD        = CSC.GLBL_CMPY_CD(+)
                    AND SMM.CUR_LOC_ACCT_NUM    = CSC.SELL_TO_CUST_CD(+)
                    AND CSC.EZCANCELFLAG(+)     = '0'
                    AND SMM.GLBL_CMPY_CD        = BCC.GLBL_CMPY_CD(+)
                    AND SMM.BILL_TO_LOC_NUM     = BCC.BILL_TO_CUST_CD(+)
                    AND BCC.EZCANCELFLAG(+)     = '0'
                    AND SMM.GLBL_CMPY_CD        = SCC.GLBL_CMPY_CD(+)
                    AND SMM.CUR_LOC_NUM         = SCC.SHIP_TO_CUST_CD(+)
                    AND SCC.EZCANCELFLAG(+)     = '0'
                    AND SMM.GLBL_CMPY_CD        = SCM.GLBL_CMPY_CD(+)
                    AND SMM.SVC_CONFIG_MSTR_PK  = SCM.SVC_CONFIG_MSTR_PK(+)
                    AND SCM.EZCANCELFLAG(+)     = '0'
                    AND SCM.GLBL_CMPY_CD        = MN.T_GLBL_CMPY_CD(+)
                    AND SCM.MDL_ID              = MN.T_MDL_ID(+)
                    AND MN.EZCANCELFLAG(+)      = '0'
                    AND SMM.GLBL_CMPY_CD        = SMR.GLBL_CMPY_CD
                    AND SMM.SVC_MACH_MSTR_PK    = SMR.SVC_MACH_MSTR_PK
                    AND SMR.EZCANCELFLAG        = '0'
                    AND SMR.GLBL_CMPY_CD        = ML.GLBL_CMPY_CD(+)
                    AND SMR.MTR_LB_CD           = ML.MTR_LB_CD(+)
                    AND ML.EZCANCELFLAG(+)      = '0'        
                    AND SMR.GLBL_CMPY_CD        = MTG.GLBL_CMPY_CD(+)
                    AND SMR.DS_MTR_READ_TP_GRP_CD = MTG.DS_MTR_READ_TP_GRP_CD(+)
                    AND MTG.EZCANCELFLAG(+)     = '0'
                    AND SMR.GLBL_CMPY_CD        = TCC.GLBL_CMPY_CD(+)
                    AND SMR.DS_TEST_COPY_CLS_CD = TCC.DS_TEST_COPY_CLS_CD(+)
                    AND TCC.EZCANCELFLAG(+)     = '0'
                    AND SMR.GLBL_CMPY_CD        = AP.GLBL_CMPY_CD(+)
                    AND SMR.RGTN_USR_ID         = AP.USR_NM(+)
                    AND AP.EZCANCELFLAG(+)      = '0'
                    AND SMR.GLBL_CMPY_CD        = MRS.GLBL_CMPY_CD(+)
                    AND SMR.MTR_READ_SRC_TP_CD  = MRS.MTR_READ_SRC_TP_CD(+)
                    AND MRS.EZCANCELFLAG(+)     = '0'
                    AND SMR.GLBL_CMPY_CD        = MRT.GLBL_CMPY_CD(+)
                    AND SMR.DS_MTR_READ_TP_CD   = MRT.DS_MTR_READ_TP_CD(+)
                    AND MRT.EZCANCELFLAG(+)     = '0'
                    <!-- START 2023/06/28 T.Kimura [QC#58675, ADD] -->
                    AND SMR.SVC_PHYS_MTR_PK = SIN.SVC_PHYS_MTR_PK(+)
                    AND SMR.SVC_PHYS_MTR_READ_GRP_SQ = SIN.SVC_PHYS_MTR_READ_GRP_SQ(+)
                    <!-- END 2023/06/28 T.Kimura [QC#58675, ADD] -->
                ORDER BY
                    SMM.SER_NUM
                    ,SMR.MTR_READ_DT DESC
                    ,SMR.SVC_PHYS_MTR_READ_GRP_SQ DESC
                    ,ML.MTR_LB_SORT_NUM
        ) X
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <resultMap id="result.getDownloadList"  class="NSAL0620_FSMsg">
        <result property="serNum_F"                column="SER_NUM"                      javaType="EZDSStringItem"/>
        <result property="mdseCd_F"                column="MDSE_CD"                      javaType="EZDSStringItem"/>
        <result property="t_MdlNm_F"               column="T_MDL_NM"                     javaType="EZDSStringItem"/>
        <result property="mtrLbDescTxt_F"          column="MTR_LB_DESC_TXT"              javaType="EZDSStringItem"/>
        <result property="fill65Txt_F"             column="XX_MTR_READ_TP_GRP_DESC_TXT"  javaType="EZDSStringItem"/>
        <result property="dsMtrReadTpDescTxt_F"    column="DS_MTR_READ_TP_DESC_TXT"      javaType="EZDSStringItem"/>
        <result property="vldMtrFlg_F"             column="VLD_MTR_FLG"                  javaType="EZDSStringItem"/>
        <result property="fill5Txt_F"              column="GRP_NUM"                      javaType="EZDSStringItem"/>
        <result property="xxDtTxt_RE"              column="XX_READ_DT"                   javaType="EZDSStringItem"/>
        <result property="readMtrCnt_F"            column="READ_MTR_CNT"                 javaType="EZDSBigDecimalItem"/>
        <result property="testMtrCnt_F"            column="TEST_MTR_CNT"                 javaType="EZDSBigDecimalItem"/>
        <result property="mtrEntryCmntTxt_F"       column="MTR_ENTRY_CMNT_TXT"           javaType="EZDSStringItem"/>
        <result property="xxEmpNmTxt_F"            column="XX_CRAT_PSN_NM"               javaType="EZDSStringItem"/>
        <result property="xxDtTm_F"                column="XX_CRT_DT"                    javaType="EZDSStringItem"/>
        <result property="mtrReadSrcTpDescTxt_F"   column="MTR_READ_SRC_TP_DESC_TXT"     javaType="EZDSStringItem"/>
        <result property="svcInvNum_F"             column="SVC_INV_NUM"                  javaType="EZDSStringItem"/>
        <result property="xxDtTxt_IN"              column="XX_INV_DT"                    javaType="EZDSStringItem"/>
        <result property="svcTaskNum_F"            column="SVC_TASK_NUM"                 javaType="EZDSStringItem"/>
        <result property="dsTestCopyClsDescTxt_F"  column="DS_TEST_COPY_CLS_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="billToCustNm_F"          column="BILL_TO_CUST_NM"              javaType="EZDSStringItem"/>
        <result property="xxAllLineAddr_BI"        column="BILL_TO_LOC_ADDR"             javaType="EZDSStringItem"/>
        <result property="curLocAcctNm_F"          column="CUR_LOC_ACCT_NM"              javaType="EZDSStringItem"/>
        <result property="xxAllLineAddr_IN"        column="CUR_LOC_ADDR"                 javaType="EZDSStringItem"/>
    </resultMap>
<!-- END   2018/06/26 T.Ogura [QC#26336,ADD] -->
<!-- START 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
    <statement id="checkDsContrBllgMtr" parameterClass="Map" resultClass="Map">
        SELECT
            1
        FROM
            DS_CONTR_BLLG_MTR CBM
        WHERE
            CBM.GLBL_CMPY_CD        = #glblCmpyCd#
            AND CBM.EZCANCELFLAG    = '0'
            <iterate property="dsContrDtlPkList" var="dsContrDtlPk[]" open="AND CBM.DS_CONTR_DTL_PK IN (" close=")" conjunction=",">
                #dsContrDtlPk[]#
            </iterate>
    </statement>
<!-- END 2021/09/10 L.Mandanas [QC#58314-1, ADD] -->
</sqlMap>
