<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAB068001">

    <statement id="getTrgtDtRec" parameterClass="Map" resultClass="BigDecimal">
        SELECT COUNT(1)
        FROM
            FCT_DLY_SHELL_PRVTY      MAIN
        WHERE 
            MAIN.GLBL_CMPY_CD         = #glblCmpyCd#
        AND MAIN.DWH_TRGT_DT          = #trgtDt#
        AND MAIN.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getMainData" parameterClass="Map" resultClass="Map">
        -- Rep SHELL DATA
        SELECT
            MAIN.SVC_LINE_BIZ_CD                         AS SVC_LINE_BIZ_CD
           ,MAIN.SVC_RG_PK                               AS SVC_RG_PK
           ,MAIN.SVC_RG_DESC_TXT                         AS SVC_RG_DESC_TXT
           ,MAIN.SVC_CONTR_BR_CD                         AS SVC_CONTR_BR_CD
           ,MAIN.PSN_CD                                  AS PSN_CD
           ,MAIN.PSN_FIRST_NM                            AS PSN_FIRST_NM
           ,MAIN.PSN_MID_NM                              AS PSN_MID_NM
           ,MAIN.PSN_LAST_NM                             AS PSN_LAST_NM
           ,NVL(C_CRA.MTD_SHELL_CRAT_AMT, 0)             AS MTD_SHELL_CRAT_AMT
           ,NVL(C_ACT.MTD_SHELL_CLO_AMT, 0)              AS MTD_SHELL_CLO_AMT
           ,NVL(C_ACT.AGE_TO_ACTV_SHELL_AMT, 0)          AS AGE_TO_ACTV_SHELL_AMT
           ,NVL(A_SHL_PEN.AVG_AGE_SHELL_PEND_AMT, 0)     AS AVG_AGE_SHELL_PEND_AMT
           ,NVL(C_SHL_PEN.SHELL_PEND_TOT_AMT, 0)         AS SHELL_PEND_TOT_AMT
           ,NVL(C_SHL_PEN.PEND_UP_TO_DAYS_AMT_05, 0)     AS PEND_UP_TO_DAYS_AMT_05
           ,NVL(C_SHL_PEN.PEND_UP_TO_DAYS_AMT_10, 0)     AS PEND_UP_TO_DAYS_AMT_10
           ,NVL(C_SHL_PEN.PEND_UP_TO_DAYS_AMT_30, 0)     AS PEND_UP_TO_DAYS_AMT_30
           ,NVL(C_SHL_PEN.PEND_UP_TO_DAYS_AMT_60, 0)     AS PEND_UP_TO_DAYS_AMT_60
           ,NVL(C_SHL_PEN.PEND_OVER_DAYS_AMT_60, 0)      AS PEND_OVER_DAYS_AMT_60
           ,0                                            AS ACTV_CONTR_AMT
           ,0                                            AS ACTV_CONTR_MACH_AMT
           ,0                                            AS MTD_NEW_CONTR_AMT
           ,NVL(C_SHL_ACT.MTD_NEW_ACTV_SHELL_AMT, 0)     AS MTD_NEW_ACTV_SHELL_AMT
           ,NVL(C_SHL_ACT.AVG_DAYS_SHELL_ACTV_AMT, 0)    AS AVG_DAYS_SHELL_ACTV_AMT
           ,0                                            AS RNW_HLD_CONTR_AMT
           ,0                                            AS RNW_PLAN_CONTR_AMT
           ,0                                            AS MTD_RNW_PROC_AMT
           ,0                                            AS MTD_RNW_ACTV_AMT
           ,0                                            AS RNW_PEND_CONTR_AMT
           ,0                                            AS MTR_READ_PLN_AMT
           ,0                                            AS MTR_READ_CPTR_AMT
           ,0                                            AS MTR_READ_PAST_DUE_AOT
           ,0                                            AS MTR_DUE_NEXT_IN_DAYS_AOT
           ,0                                            AS MACH_DUE_BY_EOM_AOT
           ,0                                            AS MTD_MACH_READ_CNT
           ,0                                            AS MTD_MACH_PAST_DUE_AOT
           ,0                                            AS MTD_CONTR_MOD_AMT
           ,0                                            AS MTD_CONTR_TRMN_AMT
           ,0                                            AS MTD_CONTR_LINE_CRAT_AMT
           ,0                                            AS MTD_CR_DOL_PROC_AMT
           ,0                                            AS MTD_CR_DOL_PROC_CNT
           ,0                                            AS MTD_NET_MAN_DOL_AMT
           ,0                                            AS MTD_INCDT_CLO_AMT
           ,0                                            AS MTD_CR_CNT
           ,0                                            AS MTD_INV_CNT
           ,#shell#                                      AS RPT_SHELL_TP_CD
        FROM
        (
            SELECT DISTINCT
                SRG.SVC_LINE_BIZ_CD                      AS SVC_LINE_BIZ_CD
               ,SRG.SVC_RG_PK                            AS SVC_RG_PK
               ,SRG.SVC_RG_DESC_TXT                      AS SVC_RG_DESC_TXT
               ,SBR.SVC_CONTR_BR_CD                      AS SVC_CONTR_BR_CD
               ,SBR.PSN_CD                               AS PSN_CD
               ,PSN.PSN_FIRST_NM                         AS PSN_FIRST_NM
               ,PSN.PSN_MID_NM                           AS PSN_MID_NM
               ,PSN.PSN_LAST_NM                          AS PSN_LAST_NM
            FROM
                SVC_BR_RESRC_RELN                           SBR
               ,S21_PSN                                     PSN
               ,SVC_CONTR_BR                                SCB
               ,SVC_RG_BR_RELN                              SRB
               ,SVC_RG                                      SRG
            WHERE
                SBR.GLBL_CMPY_CD                          = #glblCmpyCd#
            AND SBR.SVC_BR_RESRC_ACTV_FLG                 = 'Y'
            AND SBR.GLBL_CMPY_CD                          = PSN.GLBL_CMPY_CD
            AND SBR.PSN_CD                                = PSN.PSN_CD
            AND PSN.EFF_FROM_DT                       &lt;= #trgtDt#
            AND (PSN.EFF_THRU_DT                      &gt;= #trgtDt#
            OR   PSN.EFF_THRU_DT IS NULL)
            AND PSN.DEL_FLG                               = 'N'
            AND SBR.GLBL_CMPY_CD                          = SCB.GLBL_CMPY_CD
            AND SBR.SVC_CONTR_BR_CD                       = SCB.SVC_CONTR_BR_CD
            AND SCB.SVC_CONTR_BR_ACTV_FLG                 = 'Y'
            AND SBR.GLBL_CMPY_CD                          = SRB.GLBL_CMPY_CD
            AND SBR.SVC_CONTR_BR_CD                       = SRB.SVC_CONTR_BR_CD
            AND SRB.GLBL_CMPY_CD                          = SRG.GLBL_CMPY_CD
            AND SRB.SVC_RG_PK                             = SRG.SVC_RG_PK
            AND SRG.SVC_RG_ACTV_FLG                       = 'Y'
            AND PSN.EZCANCELFLAG                          = '0'
            AND SBR.EZCANCELFLAG                          = '0'
            AND SCB.EZCANCELFLAG                          = '0'
            AND SRB.EZCANCELFLAG                          = '0'
            AND SRG.EZCANCELFLAG                          = '0'
        ) MAIN
        ,
        (
            SELECT
                DCI.SVC_CONTR_BR_CD
               ,DCI.CONTR_ADMIN_PSN_CD
               ,COUNT(DISTINCT DCI.DS_CONTR_INTFC_BAT_NUM) AS MTD_SHELL_CRAT_AMT
            FROM
                DS_CONTR_INTFC                    DCI
            WHERE
                DCI.GLBL_CMPY_CD                = #glblCmpyCd#
            AND SUBSTR(DCI.EZINTIME, 0, 6)      = SUBSTR(#trgtDt#, 0, 6)
            AND SUBSTR(DCI.EZINTIME, 0, 8)  &lt;= #trgtDt#
            AND DCI.CONTR_INTFC_SRC_TP_CD       = #cpo#
            AND DCI.EZCANCELFLAG                = '0'
            GROUP BY
                DCI.SVC_CONTR_BR_CD
               ,DCI.CONTR_ADMIN_PSN_CD
        ) C_CRA
        ,
        (
            WITH BAT_NUM_V AS (
                SELECT DISTINCT
                    DCI.SVC_CONTR_BR_CD
                   ,DCI.CONTR_ADMIN_PSN_CD
                   ,DCI.DS_CONTR_INTFC_BAT_NUM AS DS_CONTR_INTFC_BAT_NUM
                FROM
                    DS_CONTR_INTFC                    DCI
                WHERE
                    DCI.GLBL_CMPY_CD                = #glblCmpyCd#
                AND SUBSTR(DCI.EZINTIME, 0, 6)      = SUBSTR(#trgtDt#, 0, 6)
                AND SUBSTR(DCI.EZINTIME, 0, 8)  &lt;= #trgtDt#
                AND DCI.CONTR_INTFC_SRC_TP_CD       = #cpo#
                AND DCI.EZCANCELFLAG                = '0'
                AND EXISTS (
                    SELECT
                        1
                    FROM
                        DS_CONTR                                DC
                       ,DS_CONTR_TRK                            DCT
                    WHERE
                        DC.GLBL_CMPY_CD                       = DCI.GLBL_CMPY_CD
                    AND DC.DS_CONTR_NUM                       = DCI.DS_CONTR_NUM
                    AND DC.GLBL_CMPY_CD                       = DCT.GLBL_CMPY_CD
                    AND DC.DS_CONTR_PK                        = DCT.DS_CONTR_PK
                    AND (NVL(DCT.DS_CONTR_FROM_STS_CD, #none#), DCT.DS_CONTR_TO_STS_CD)
                        IN ((#none#, #sigd#), (#none#, #actv#), (#drft#, #sigd#), (#drft#, #actv#))
                    AND SUBSTR(DCT.STS_MEMO_UPD_TS, 0, 6)     = SUBSTR(#trgtDt#, 0, 6)
                    AND SUBSTR(DCT.STS_MEMO_UPD_TS, 0, 8) &lt;= #trgtDt#
                    AND DC.EZCANCELFLAG                       = '0'
                    AND DCT.EZCANCELFLAG                      = '0')
            )
            SELECT
                C_CLO.SVC_CONTR_BR_CD
               ,C_CLO.CONTR_ADMIN_PSN_CD
               ,C_CLO.MTD_SHELL_CLO_AMT
               ,A_ACT.AGE_TO_ACTV_SHELL_AMT
            FROM
            (
                SELECT
                    BAT.SVC_CONTR_BR_CD
                   ,BAT.CONTR_ADMIN_PSN_CD
                   ,COUNT(DISTINCT BAT.DS_CONTR_INTFC_BAT_NUM) AS MTD_SHELL_CLO_AMT
                FROM
                    BAT_NUM_V BAT
                GROUP BY
                    BAT.SVC_CONTR_BR_CD
                   ,BAT.CONTR_ADMIN_PSN_CD
            ) C_CLO
            ,
            (
                SELECT
                    SN_DT.SVC_CONTR_BR_CD
                   ,SN_DT.CONTR_ADMIN_PSN_CD
                   ,SUM(TO_DATE(SN_DT.SIGN_DT, 'YYYYMMDD') - TO_DATE(LT_DT.LT_DT, 'YYYYMMDD')) AS AGE_TO_ACTV_SHELL_AMT
                FROM
                (
                    SELECT
                        DCI.SVC_CONTR_BR_CD
                       ,DCI.CONTR_ADMIN_PSN_CD
                       ,DCI.DS_CONTR_INTFC_BAT_NUM
                       ,SUBSTR(MAX(DCT.STS_MEMO_UPD_TS), 0, 8) AS SIGN_DT
                    FROM
                        DS_CONTR_INTFC                          DCI
                       ,DS_CONTR                                DC
                       ,DS_CONTR_TRK                            DCT
                       ,BAT_NUM_V                               BAT
                    WHERE
                        DCI.GLBL_CMPY_CD                      = #glblCmpyCd#
                    AND DCI.DS_CONTR_INTFC_BAT_NUM            = BAT.DS_CONTR_INTFC_BAT_NUM
                    AND DCI.GLBL_CMPY_CD                      = DC.GLBL_CMPY_CD
                    AND DCI.DS_CONTR_NUM                      = DC.DS_CONTR_NUM
                    AND DCI.CONTR_INTFC_SRC_TP_CD             = #cpo#
                    AND DC.GLBL_CMPY_CD                       = DCT.GLBL_CMPY_CD
                    AND DC.DS_CONTR_PK                        = DCT.DS_CONTR_PK
                    AND (NVL(DCT.DS_CONTR_FROM_STS_CD, #none#), DCT.DS_CONTR_TO_STS_CD)
                        IN ((#none#, #sigd#), (#none#, #actv#), (#drft#, #sigd#),(#drft#, #actv#))
                    AND SUBSTR(DCT.STS_MEMO_UPD_TS, 0, 6)     = SUBSTR(#trgtDt#, 0, 6)
                    AND SUBSTR(DCT.STS_MEMO_UPD_TS, 0, 8) &lt;= #trgtDt#
                    AND DCI.EZCANCELFLAG                      = '0'
                    AND DC.EZCANCELFLAG                       = '0'
                    AND DCT.EZCANCELFLAG                      = '0'
                    GROUP BY
                        DCI.SVC_CONTR_BR_CD
                       ,DCI.CONTR_ADMIN_PSN_CD
                       ,DCI.DS_CONTR_INTFC_BAT_NUM
                ) SN_DT
                ,
                (
                    SELECT
                        DCI.SVC_CONTR_BR_CD
                       ,DCI.CONTR_ADMIN_PSN_CD
                       ,DCI.DS_CONTR_INTFC_BAT_NUM
                       ,SUBSTR(MIN(DCI.EZINTIME), 0, 8)      AS LT_DT
                    FROM
                        DS_CONTR_INTFC                          DCI
                       ,BAT_NUM_V                               BAT
                    WHERE
                        DCI.GLBL_CMPY_CD                      = #glblCmpyCd#
                    AND DCI.DS_CONTR_INTFC_BAT_NUM            = BAT.DS_CONTR_INTFC_BAT_NUM
                    AND DCI.CONTR_INTFC_SRC_TP_CD             = #cpo#
                    AND DCI.EZCANCELFLAG                      = '0'
                    GROUP BY
                        DCI.SVC_CONTR_BR_CD
                       ,DCI.CONTR_ADMIN_PSN_CD
                       ,DCI.DS_CONTR_INTFC_BAT_NUM
                ) LT_DT
                WHERE
                    SN_DT.SVC_CONTR_BR_CD                     = LT_DT.SVC_CONTR_BR_CD
                AND SN_DT.CONTR_ADMIN_PSN_CD                  = LT_DT.CONTR_ADMIN_PSN_CD
                AND SN_DT.DS_CONTR_INTFC_BAT_NUM              = LT_DT.DS_CONTR_INTFC_BAT_NUM
                GROUP BY
                    SN_DT.SVC_CONTR_BR_CD
                   ,SN_DT.CONTR_ADMIN_PSN_CD
            ) A_ACT
            WHERE
                C_CLO.SVC_CONTR_BR_CD                     = A_ACT.SVC_CONTR_BR_CD
            AND C_CLO.CONTR_ADMIN_PSN_CD                  = A_ACT.CONTR_ADMIN_PSN_CD
        ) C_ACT
        ,
        (
            SELECT
                DCI.SVC_CONTR_BR_CD
               ,DCI.CONTR_ADMIN_PSN_CD
               ,SUM(DCI.AVG_AGE_SHELL_PEND_AMT)             AS AVG_AGE_SHELL_PEND_AMT
            FROM
            (
                SELECT
                    DCI.SVC_CONTR_BR_CD
                   ,DCI.CONTR_ADMIN_PSN_CD
                   ,DCI.DS_CONTR_INTFC_BAT_NUM
                   ,TO_DATE(#trgtDt#, 'YYYYMMDD') - TO_DATE(SUBSTR(MIN(DCI.EZINTIME), 0, 8), 'YYYYMMDD') AS AVG_AGE_SHELL_PEND_AMT
                FROM
                    DS_CONTR_INTFC DCI
                   ,DS_CONTR DC
                WHERE
                    DCI.GLBL_CMPY_CD                      = #glblCmpyCd#
                AND DCI.GLBL_CMPY_CD                      = DC.GLBL_CMPY_CD(+)
                AND DCI.DS_CONTR_NUM                      = DC.DS_CONTR_NUM(+)
                AND DCI.CONTR_INTFC_SRC_TP_CD             = #cpo#
                AND (DC.DS_CONTR_STS_CD                   = #drftCd#
                OR   DC.DS_CONTR_STS_CD IS NULL)
                AND DCI.EZCANCELFLAG                      = '0'
                AND DC.EZCANCELFLAG(+)                    = '0'
                GROUP BY
                    DCI.SVC_CONTR_BR_CD
                   ,DCI.CONTR_ADMIN_PSN_CD
                   ,DCI.DS_CONTR_INTFC_BAT_NUM
            ) DCI
            GROUP BY
                DCI.SVC_CONTR_BR_CD
               ,DCI.CONTR_ADMIN_PSN_CD
        ) A_SHL_PEN
        ,
        (
            SELECT
                DCI.SVC_CONTR_BR_CD
               ,DCI.CONTR_ADMIN_PSN_CD
               ,COUNT(DISTINCT DCI.DS_CONTR_INTFC_BAT_NUM) AS SHELL_PEND_TOT_AMT
               ,COUNT(DISTINCT(CASE WHEN SUBSTR(DCI.EZINTIME, 0, 8) &gt;= TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 5) , 'YYYYMMDD') THEN DCI.DS_CONTR_INTFC_BAT_NUM ELSE NULL END))                                                                                   AS PEND_UP_TO_DAYS_AMT_05
               ,COUNT(DISTINCT(CASE WHEN SUBSTR(DCI.EZINTIME, 0, 8) &gt;= TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 10), 'YYYYMMDD') AND SUBSTR(DCI.EZINTIME, 0, 8) &lt; TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 5),  'YYYYMMDD') THEN DCI.DS_CONTR_INTFC_BAT_NUM ELSE NULL END)) AS PEND_UP_TO_DAYS_AMT_10
               ,COUNT(DISTINCT(CASE WHEN SUBSTR(DCI.EZINTIME, 0, 8) &gt;= TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 30), 'YYYYMMDD') AND SUBSTR(DCI.EZINTIME, 0, 8) &lt; TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 10), 'YYYYMMDD') THEN DCI.DS_CONTR_INTFC_BAT_NUM ELSE NULL END)) AS PEND_UP_TO_DAYS_AMT_30
               ,COUNT(DISTINCT(CASE WHEN SUBSTR(DCI.EZINTIME, 0, 8) &gt;= TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 60), 'YYYYMMDD') AND SUBSTR(DCI.EZINTIME, 0, 8) &lt; TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 30), 'YYYYMMDD') THEN DCI.DS_CONTR_INTFC_BAT_NUM ELSE NULL END)) AS PEND_UP_TO_DAYS_AMT_60
               ,COUNT(DISTINCT(CASE WHEN SUBSTR(DCI.EZINTIME, 0, 8) &lt;  TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 60), 'YYYYMMDD') THEN DCI.DS_CONTR_INTFC_BAT_NUM ELSE NULL END))                                                                                   AS PEND_OVER_DAYS_AMT_60
            FROM
                DS_CONTR_INTFC DCI
               ,DS_CONTR DC
            WHERE
                DCI.GLBL_CMPY_CD                      = #glblCmpyCd#
            AND DCI.GLBL_CMPY_CD                      = DC.GLBL_CMPY_CD(+)
            AND DCI.DS_CONTR_NUM                      = DC.DS_CONTR_NUM(+)
            AND DCI.CONTR_INTFC_SRC_TP_CD             = #cpo#
            AND (DC.DS_CONTR_STS_CD                   = #drftCd#
            OR   DC.DS_CONTR_STS_CD IS NULL)
            AND DCI.EZCANCELFLAG                      = '0'
            AND DC.EZCANCELFLAG(+)                    = '0'
            GROUP BY
                DCI.SVC_CONTR_BR_CD
               ,DCI.CONTR_ADMIN_PSN_CD
        ) C_SHL_PEN
        ,(
            WITH ACT_SHELL_BAT_NUM_V AS (
                SELECT DISTINCT
                    DCI.SVC_CONTR_BR_CD
                   ,DCI.CONTR_ADMIN_PSN_CD
                   ,DCI.DS_CONTR_INTFC_BAT_NUM
                FROM
                    DS_CONTR_INTFC                           DCI
                WHERE
                    DCI.GLBL_CMPY_CD                       = #glblCmpyCd#
                AND SUBSTR(DCI.EZUPTIME, 0, 8)             = #trgtDt#
                AND DCI.CONTR_INTFC_SRC_TP_CD              = #cpo#
                AND EXISTS (
                    SELECT
                        1
                    FROM
                        DS_CONTR                             DC
                       ,DS_CONTR_TRK                         DCT
                    WHERE
                        DC.GLBL_CMPY_CD                    = DCI.GLBL_CMPY_CD
                    AND DC.DS_CONTR_NUM                    = DCI.DS_CONTR_NUM
                    AND DC.GLBL_CMPY_CD                    = DCT.GLBL_CMPY_CD
                    AND DC.DS_CONTR_PK                     = DCT.DS_CONTR_PK
                    AND (NVL(DCT.DS_CONTR_FROM_STS_CD, #none#), DCT.DS_CONTR_TO_STS_CD)
                        IN ((#none#, #sigd#), (#none#, #actv#), (#drft#, #sigd#), (#drft#, #actv#))
                    AND SUBSTR(DCT.STS_MEMO_UPD_TS, 0, 8)  = #trgtDt#
                    AND DC.EZCANCELFLAG                    = '0'
                    AND DCT.EZCANCELFLAG                   = '0')
            )
            SELECT
                C_ACT.SVC_CONTR_BR_CD
               ,C_ACT.CONTR_ADMIN_PSN_CD
               ,C_ACT.MTD_NEW_ACTV_SHELL_AMT
               ,LT_DT.AVG_DAYS_SHELL_ACTV_AMT
            FROM
            (
                SELECT
                    ACT.SVC_CONTR_BR_CD
                   ,ACT.CONTR_ADMIN_PSN_CD
                   ,COUNT(ACT.DS_CONTR_INTFC_BAT_NUM) AS MTD_NEW_ACTV_SHELL_AMT
                FROM
                    ACT_SHELL_BAT_NUM_V ACT
                GROUP BY
                    ACT.SVC_CONTR_BR_CD
                   ,ACT.CONTR_ADMIN_PSN_CD
            ) C_ACT
            ,
            (
                SELECT
                    LT_WK.SVC_CONTR_BR_CD
                   ,LT_WK.CONTR_ADMIN_PSN_CD
                   ,SUM(TO_DATE(#trgtDt#, 'YYYYMMDD') - TO_DATE(LT_WK.LT_DT, 'YYYYMMDD')) AS AVG_DAYS_SHELL_ACTV_AMT
                FROM
                (
                    SELECT
                        DCI.SVC_CONTR_BR_CD
                       ,DCI.CONTR_ADMIN_PSN_CD
                       ,DCI.DS_CONTR_INTFC_BAT_NUM
                       ,SUBSTR(MIN(DCI.EZINTIME), 0, 8)      AS LT_DT
                    FROM
                        DS_CONTR_INTFC                          DCI
                       ,ACT_SHELL_BAT_NUM_V                     BAT
                    WHERE
                        DCI.GLBL_CMPY_CD                      = #glblCmpyCd#
                    AND DCI.DS_CONTR_INTFC_BAT_NUM            = BAT.DS_CONTR_INTFC_BAT_NUM
                    AND DCI.CONTR_INTFC_SRC_TP_CD             = #cpo#
                    AND DCI.EZCANCELFLAG                      = '0'
                    GROUP BY
                        DCI.SVC_CONTR_BR_CD
                       ,DCI.CONTR_ADMIN_PSN_CD
                       ,DCI.DS_CONTR_INTFC_BAT_NUM
                ) LT_WK
                GROUP BY
                    LT_WK.SVC_CONTR_BR_CD
                   ,LT_WK.CONTR_ADMIN_PSN_CD
            ) LT_DT
            WHERE
                C_ACT.SVC_CONTR_BR_CD                   = LT_DT.SVC_CONTR_BR_CD
            AND C_ACT.CONTR_ADMIN_PSN_CD                = LT_DT.CONTR_ADMIN_PSN_CD
        ) C_SHL_ACT
        WHERE
            MAIN.SVC_CONTR_BR_CD                      = C_CRA.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_CRA.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_ACT.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_ACT.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = A_SHL_PEN.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = A_SHL_PEN.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_SHL_PEN.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_SHL_PEN.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_SHL_ACT.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_SHL_ACT.CONTR_ADMIN_PSN_CD(+)
        UNION ALL
        -- Rep Not SHELL DATA
        SELECT
            MAIN.SVC_LINE_BIZ_CD                         AS SVC_LINE_BIZ_CD
           ,MAIN.SVC_RG_PK                               AS SVC_RG_PK
           ,MAIN.SVC_RG_DESC_TXT                         AS SVC_RG_DESC_TXT
           ,MAIN.SVC_CONTR_BR_CD                         AS SVC_CONTR_BR_CD
           ,MAIN.PSN_CD                                  AS PSN_CD
           ,MAIN.PSN_FIRST_NM                            AS PSN_FIRST_NM
           ,MAIN.PSN_MID_NM                              AS PSN_MID_NM
           ,MAIN.PSN_LAST_NM                             AS PSN_LAST_NM
           ,NVL(C_CRA.MTD_SHELL_CRAT_AMT, 0)             AS MTD_SHELL_CRAT_AMT
           ,NVL(C_ACT.MTD_SHELL_CLO_AMT, 0)              AS MTD_SHELL_CLO_AMT
           ,NVL(C_ACT.AGE_TO_ACTV_SHELL_AMT, 0)          AS AGE_TO_ACTV_SHELL_AMT
           ,NVL(A_SHL_PEN.AVG_AGE_SHELL_PEND_AMT, 0)     AS AVG_AGE_SHELL_PEND_AMT
           ,NVL(C_SHL_PEN.SHELL_PEND_TOT_AMT, 0)         AS SHELL_PEND_TOT_AMT
           ,NVL(C_SHL_PEN.PEND_UP_TO_DAYS_AMT_05, 0)     AS PEND_UP_TO_DAYS_AMT_05
           ,NVL(C_SHL_PEN.PEND_UP_TO_DAYS_AMT_10, 0)     AS PEND_UP_TO_DAYS_AMT_10
           ,NVL(C_SHL_PEN.PEND_UP_TO_DAYS_AMT_30, 0)     AS PEND_UP_TO_DAYS_AMT_30
           ,NVL(C_SHL_PEN.PEND_UP_TO_DAYS_AMT_60, 0)     AS PEND_UP_TO_DAYS_AMT_60
           ,NVL(C_SHL_PEN.PEND_OVER_DAYS_AMT_60, 0)      AS PEND_OVER_DAYS_AMT_60
           ,NVL(C_CON.ACTV_CONTR_AMT, 0)                 AS ACTV_CONTR_AMT
           ,NVL(C_MAC.ACTV_CONTR_MACH_AMT, 0)            AS ACTV_CONTR_MACH_AMT
           ,NVL(C_CON.MTD_NEW_CONTR_AMT, 0)              AS MTD_NEW_CONTR_AMT
           ,NVL(C_SHL_ACT.MTD_NEW_ACTV_SHELL_AMT, 0)     AS MTD_NEW_ACTV_SHELL_AMT
           ,NVL(C_SHL_ACT.AVG_DAYS_SHELL_ACTV_AMT, 0)    AS AVG_DAYS_SHELL_ACTV_AMT
           ,NVL(C_HLD.RNW_HLD_CONTR_AMT, 0)              AS RNW_HLD_CONTR_AMT
           ,NVL(C_CON.RNW_PLAN_CONTR_AMT, 0)             AS RNW_PLAN_CONTR_AMT
           ,NVL(C_RNW_PRO.MTD_RNW_PROC_AMT, 0)           AS MTD_RNW_PROC_AMT
           ,NVL(C_RNW_ACT.MTD_RNW_ACTV_AMT, 0)           AS MTD_RNW_ACTV_AMT
           ,NVL(C_RNW_PEN.RNW_PEND_CONTR_AMT, 0)         AS RNW_PEND_CONTR_AMT
           ,NVL(C_MTR.MTR_READ_PLN_AMT, 0)               AS MTR_READ_PLN_AMT
           ,NVL(C_MTR_CPT.MTR_READ_CPTR_AMT, 0)          AS MTR_READ_CPTR_AMT
           ,NVL(C_MTR.MTR_READ_PAST_DUE_AOT, 0)          AS MTR_READ_PAST_DUE_AOT
           ,NVL(C_MTR.MTR_DUE_NEXT_IN_DAYS_AOT, 0)       AS MTR_DUE_NEXT_IN_DAYS_AOT
           ,NVL(A_MAC_EOM.MACH_DUE_BY_EOM_AOT, 0)        AS MACH_DUE_BY_EOM_AOT
           ,NVL(C_MAC_REA.MTD_MACH_READ_CNT, 0)          AS MTD_MACH_READ_CNT
           ,NVL(A_MAC_PAS.MTD_MACH_PAST_DUE_AOT, 0)      AS MTD_MACH_PAST_DUE_AOT
           ,NVL(C_CON.MTD_CONTR_MOD_AMT, 0)              AS MTD_CONTR_MOD_AMT
           ,NVL(C_CON.MTD_CONTR_TRMN_AMT, 0)             AS MTD_CONTR_TRMN_AMT
           ,NVL(C_CON_DTL.MTD_CONTR_LINE_CRAT_AMT, 0)    AS MTD_CONTR_LINE_CRAT_AMT
           ,NVL(C_INV.MTD_CR_DOL_PROC_AMT, 0)            AS MTD_CR_DOL_PROC_AMT
           ,0                                            AS MTD_CR_DOL_PROC_CNT
           ,0                                            AS MTD_NET_MAN_DOL_AMT
           ,NVL(C_SCR.MTD_INCDT_CLO_AMT, 0)              AS MTD_INCDT_CLO_AMT
           ,NVL(C_INV.MTD_CR_CNT, 0)                     AS MTD_CR_CNT
           ,NVL(C_INV.MTD_INV_CNT, 0)                    AS MTD_INV_CNT
           ,NULL                                         AS RPT_SHELL_TP_CD
        FROM
        (
            SELECT DISTINCT
                SRG.SVC_LINE_BIZ_CD                      AS SVC_LINE_BIZ_CD
               ,SRG.SVC_RG_PK                            AS SVC_RG_PK
               ,SRG.SVC_RG_DESC_TXT                      AS SVC_RG_DESC_TXT
               ,SBR.SVC_CONTR_BR_CD                      AS SVC_CONTR_BR_CD
               ,SBR.PSN_CD                               AS PSN_CD
               ,PSN.PSN_FIRST_NM                         AS PSN_FIRST_NM
               ,PSN.PSN_MID_NM                           AS PSN_MID_NM
               ,PSN.PSN_LAST_NM                          AS PSN_LAST_NM
            FROM
                SVC_BR_RESRC_RELN                           SBR
               ,S21_PSN                                     PSN
               ,SVC_CONTR_BR                                SCB
               ,SVC_RG_BR_RELN                              SRB
               ,SVC_RG                                      SRG
            WHERE
                SBR.GLBL_CMPY_CD                          = #glblCmpyCd#
            AND SBR.SVC_BR_RESRC_ACTV_FLG                 = 'Y'
            AND SBR.GLBL_CMPY_CD                          = PSN.GLBL_CMPY_CD
            AND SBR.PSN_CD                                = PSN.PSN_CD
            AND PSN.EFF_FROM_DT                       &lt;= #trgtDt#
            AND (PSN.EFF_THRU_DT                      &gt;= #trgtDt#
            OR   PSN.EFF_THRU_DT IS NULL)
            AND PSN.DEL_FLG                               = 'N'
            AND SBR.GLBL_CMPY_CD                          = SCB.GLBL_CMPY_CD
            AND SBR.SVC_CONTR_BR_CD                       = SCB.SVC_CONTR_BR_CD
            AND SCB.SVC_CONTR_BR_ACTV_FLG                 = 'Y'
            AND SBR.GLBL_CMPY_CD                          = SRB.GLBL_CMPY_CD
            AND SBR.SVC_CONTR_BR_CD                       = SRB.SVC_CONTR_BR_CD
            AND SRB.GLBL_CMPY_CD                          = SRG.GLBL_CMPY_CD
            AND SRB.SVC_RG_PK                             = SRG.SVC_RG_PK
            AND SRG.SVC_RG_ACTV_FLG                       = 'Y'
            AND PSN.EZCANCELFLAG                          = '0'
            AND SBR.EZCANCELFLAG                          = '0'
            AND SCB.EZCANCELFLAG                          = '0'
            AND SRB.EZCANCELFLAG                          = '0'
            AND SRG.EZCANCELFLAG                          = '0'
        ) MAIN
        ,
        (
            SELECT
                DCI.SVC_CONTR_BR_CD
               ,DCI.CONTR_ADMIN_PSN_CD
               ,COUNT(DISTINCT DCI.DS_CONTR_INTFC_BAT_NUM) AS MTD_SHELL_CRAT_AMT
            FROM
                DS_CONTR_INTFC                    DCI
            WHERE
                DCI.GLBL_CMPY_CD                = #glblCmpyCd#
            AND SUBSTR(DCI.EZINTIME, 0, 6)      = SUBSTR(#trgtDt#, 0, 6)
            AND SUBSTR(DCI.EZINTIME, 0, 8)  &lt;= #trgtDt#
            AND DCI.CONTR_INTFC_SRC_TP_CD      != #cpo#
            AND DCI.EZCANCELFLAG                = '0'
            GROUP BY
                DCI.SVC_CONTR_BR_CD
               ,DCI.CONTR_ADMIN_PSN_CD
        ) C_CRA
        ,
        (
            WITH BAT_NUM_V AS (
                SELECT DISTINCT
                    DCI.SVC_CONTR_BR_CD
                   ,DCI.CONTR_ADMIN_PSN_CD
                   ,DCI.DS_CONTR_INTFC_BAT_NUM AS DS_CONTR_INTFC_BAT_NUM
                FROM
                    DS_CONTR_INTFC                    DCI
                WHERE
                    DCI.GLBL_CMPY_CD                = #glblCmpyCd#
                AND SUBSTR(DCI.EZINTIME, 0, 6)      = SUBSTR(#trgtDt#, 0, 6)
                AND SUBSTR(DCI.EZINTIME, 0, 8)  &lt;= #trgtDt#
                AND DCI.CONTR_INTFC_SRC_TP_CD      != #cpo#
                AND DCI.EZCANCELFLAG                = '0'
                AND EXISTS (
                    SELECT
                        1
                    FROM
                        DS_CONTR                                DC
                       ,DS_CONTR_TRK                            DCT
                    WHERE
                        DC.GLBL_CMPY_CD                       = DCI.GLBL_CMPY_CD
                    AND DC.DS_CONTR_NUM                       = DCI.DS_CONTR_NUM
                    AND DC.GLBL_CMPY_CD                       = DCT.GLBL_CMPY_CD
                    AND DC.DS_CONTR_PK                        = DCT.DS_CONTR_PK
                    AND (NVL(DCT.DS_CONTR_FROM_STS_CD, #none#), DCT.DS_CONTR_TO_STS_CD)
                        IN ((#none#, #sigd#), (#none#, #actv#), (#drft#, #sigd#), (#drft#, #actv#))
                    AND SUBSTR(DCT.STS_MEMO_UPD_TS, 0, 6)     = SUBSTR(#trgtDt#, 0, 6)
                    AND SUBSTR(DCT.STS_MEMO_UPD_TS, 0, 8) &lt;= #trgtDt#
                    AND DC.EZCANCELFLAG                       = '0'
                    AND DCT.EZCANCELFLAG                      = '0')
            )
            SELECT
                C_CLO.SVC_CONTR_BR_CD
               ,C_CLO.CONTR_ADMIN_PSN_CD
               ,C_CLO.MTD_SHELL_CLO_AMT
               ,A_ACT.AGE_TO_ACTV_SHELL_AMT
            FROM
            (
                SELECT
                    BAT.SVC_CONTR_BR_CD
                   ,BAT.CONTR_ADMIN_PSN_CD
                   ,COUNT(DISTINCT BAT.DS_CONTR_INTFC_BAT_NUM) AS MTD_SHELL_CLO_AMT
                FROM
                    BAT_NUM_V BAT
                GROUP BY
                    BAT.SVC_CONTR_BR_CD
                   ,BAT.CONTR_ADMIN_PSN_CD
            ) C_CLO
            ,
            (
                SELECT
                    SN_DT.SVC_CONTR_BR_CD
                   ,SN_DT.CONTR_ADMIN_PSN_CD
                   ,SUM(TO_DATE(SN_DT.SIGN_DT, 'YYYYMMDD') - TO_DATE(LT_DT.LT_DT, 'YYYYMMDD')) AS AGE_TO_ACTV_SHELL_AMT
                FROM
                (
                    SELECT
                        DCI.SVC_CONTR_BR_CD
                       ,DCI.CONTR_ADMIN_PSN_CD
                       ,DCI.DS_CONTR_INTFC_BAT_NUM
                       ,SUBSTR(MAX(DCT.STS_MEMO_UPD_TS), 0, 8) AS SIGN_DT
                    FROM
                        DS_CONTR_INTFC                          DCI
                       ,DS_CONTR                                DC
                       ,DS_CONTR_TRK                            DCT
                       ,BAT_NUM_V                               BAT
                    WHERE
                        DCI.GLBL_CMPY_CD                      = #glblCmpyCd#
                    AND DCI.DS_CONTR_INTFC_BAT_NUM            = BAT.DS_CONTR_INTFC_BAT_NUM
                    AND DCI.GLBL_CMPY_CD                      = DC.GLBL_CMPY_CD
                    AND DCI.DS_CONTR_NUM                      = DC.DS_CONTR_NUM
                    AND DCI.CONTR_INTFC_SRC_TP_CD            != #cpo#
                    AND DC.GLBL_CMPY_CD                       = DCT.GLBL_CMPY_CD
                    AND DC.DS_CONTR_PK                        = DCT.DS_CONTR_PK
                    AND (NVL(DCT.DS_CONTR_FROM_STS_CD, #none#), DCT.DS_CONTR_TO_STS_CD)
                        IN ((#none#, #sigd#), (#none#, #actv#), (#drft#, #sigd#),(#drft#, #actv#))
                    AND SUBSTR(DCT.STS_MEMO_UPD_TS, 0, 6)     = SUBSTR(#trgtDt#, 0, 6)
                    AND SUBSTR(DCT.STS_MEMO_UPD_TS, 0, 8) &lt;= #trgtDt#
                    AND DCI.EZCANCELFLAG                      = '0'
                    AND DC.EZCANCELFLAG                       = '0'
                    AND DCT.EZCANCELFLAG                      = '0'
                    GROUP BY
                        DCI.SVC_CONTR_BR_CD
                       ,DCI.CONTR_ADMIN_PSN_CD
                       ,DCI.DS_CONTR_INTFC_BAT_NUM
                ) SN_DT
                ,
                (
                    SELECT
                        DCI.SVC_CONTR_BR_CD
                       ,DCI.CONTR_ADMIN_PSN_CD
                       ,DCI.DS_CONTR_INTFC_BAT_NUM
                       ,SUBSTR(MIN(DCI.EZINTIME), 0, 8)      AS LT_DT
                    FROM
                        DS_CONTR_INTFC                          DCI
                       ,BAT_NUM_V                               BAT
                    WHERE
                        DCI.GLBL_CMPY_CD                      = #glblCmpyCd#
                    AND DCI.DS_CONTR_INTFC_BAT_NUM            = BAT.DS_CONTR_INTFC_BAT_NUM
                    AND DCI.CONTR_INTFC_SRC_TP_CD            != #cpo#
                    AND DCI.EZCANCELFLAG                      = '0'
                    GROUP BY
                        DCI.SVC_CONTR_BR_CD
                       ,DCI.CONTR_ADMIN_PSN_CD
                       ,DCI.DS_CONTR_INTFC_BAT_NUM
                ) LT_DT
                WHERE
                    SN_DT.SVC_CONTR_BR_CD                     = LT_DT.SVC_CONTR_BR_CD
                AND SN_DT.CONTR_ADMIN_PSN_CD                  = LT_DT.CONTR_ADMIN_PSN_CD
                AND SN_DT.DS_CONTR_INTFC_BAT_NUM              = LT_DT.DS_CONTR_INTFC_BAT_NUM
                GROUP BY
                    SN_DT.SVC_CONTR_BR_CD
                   ,SN_DT.CONTR_ADMIN_PSN_CD
            ) A_ACT
            WHERE
                C_CLO.SVC_CONTR_BR_CD                     = A_ACT.SVC_CONTR_BR_CD
            AND C_CLO.CONTR_ADMIN_PSN_CD                  = A_ACT.CONTR_ADMIN_PSN_CD
        ) C_ACT
        ,
        (
            SELECT
                DCI.SVC_CONTR_BR_CD
               ,DCI.CONTR_ADMIN_PSN_CD
               ,SUM(DCI.AVG_AGE_SHELL_PEND_AMT)             AS AVG_AGE_SHELL_PEND_AMT
            FROM
            (
                SELECT
                    DCI.SVC_CONTR_BR_CD
                   ,DCI.CONTR_ADMIN_PSN_CD
                   ,DCI.DS_CONTR_INTFC_BAT_NUM
                   ,TO_DATE(#trgtDt#, 'YYYYMMDD') - TO_DATE(SUBSTR(MIN(DCI.EZINTIME), 0, 8), 'YYYYMMDD') AS AVG_AGE_SHELL_PEND_AMT
                FROM
                    DS_CONTR_INTFC DCI
                   ,DS_CONTR DC
                WHERE
                    DCI.GLBL_CMPY_CD                      = #glblCmpyCd#
                AND DCI.GLBL_CMPY_CD                      = DC.GLBL_CMPY_CD(+)
                AND DCI.DS_CONTR_NUM                      = DC.DS_CONTR_NUM(+)
                AND DCI.CONTR_INTFC_SRC_TP_CD            != #cpo#
                AND (DC.DS_CONTR_STS_CD                   = #drftCd#
                OR   DC.DS_CONTR_STS_CD IS NULL)
                AND DCI.EZCANCELFLAG                      = '0'
                AND DC.EZCANCELFLAG(+)                    = '0'
                GROUP BY
                    DCI.SVC_CONTR_BR_CD
                   ,DCI.CONTR_ADMIN_PSN_CD
                   ,DCI.DS_CONTR_INTFC_BAT_NUM
            ) DCI
            GROUP BY
                DCI.SVC_CONTR_BR_CD
               ,DCI.CONTR_ADMIN_PSN_CD
        ) A_SHL_PEN
        ,
        (
            SELECT
                DCI.SVC_CONTR_BR_CD
               ,DCI.CONTR_ADMIN_PSN_CD
               ,COUNT(DISTINCT DCI.DS_CONTR_INTFC_BAT_NUM) AS SHELL_PEND_TOT_AMT
               ,COUNT(DISTINCT(CASE WHEN SUBSTR(DCI.EZINTIME, 0, 8) &gt;= TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 5) , 'YYYYMMDD') THEN DCI.DS_CONTR_INTFC_BAT_NUM ELSE NULL END))                                                                                   AS PEND_UP_TO_DAYS_AMT_05
               ,COUNT(DISTINCT(CASE WHEN SUBSTR(DCI.EZINTIME, 0, 8) &gt;= TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 10), 'YYYYMMDD') AND SUBSTR(DCI.EZINTIME, 0, 8) &lt; TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 5),  'YYYYMMDD') THEN DCI.DS_CONTR_INTFC_BAT_NUM ELSE NULL END)) AS PEND_UP_TO_DAYS_AMT_10
               ,COUNT(DISTINCT(CASE WHEN SUBSTR(DCI.EZINTIME, 0, 8) &gt;= TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 30), 'YYYYMMDD') AND SUBSTR(DCI.EZINTIME, 0, 8) &lt; TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 10), 'YYYYMMDD') THEN DCI.DS_CONTR_INTFC_BAT_NUM ELSE NULL END)) AS PEND_UP_TO_DAYS_AMT_30
               ,COUNT(DISTINCT(CASE WHEN SUBSTR(DCI.EZINTIME, 0, 8) &gt;= TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 60), 'YYYYMMDD') AND SUBSTR(DCI.EZINTIME, 0, 8) &lt; TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 30), 'YYYYMMDD') THEN DCI.DS_CONTR_INTFC_BAT_NUM ELSE NULL END)) AS PEND_UP_TO_DAYS_AMT_60
               ,COUNT(DISTINCT(CASE WHEN SUBSTR(DCI.EZINTIME, 0, 8) &lt;  TO_CHAR((TO_DATE(#trgtDt#, 'YYYYMMDD') - 60), 'YYYYMMDD') THEN DCI.DS_CONTR_INTFC_BAT_NUM ELSE NULL END))                                                                                   AS PEND_OVER_DAYS_AMT_60
            FROM
                DS_CONTR_INTFC DCI
               ,DS_CONTR DC
            WHERE
                DCI.GLBL_CMPY_CD                      = #glblCmpyCd#
            AND DCI.GLBL_CMPY_CD                      = DC.GLBL_CMPY_CD(+)
            AND DCI.DS_CONTR_NUM                      = DC.DS_CONTR_NUM(+)
            AND DCI.CONTR_INTFC_SRC_TP_CD            != #cpo#
            AND (DC.DS_CONTR_STS_CD                   = #drftCd#
            OR   DC.DS_CONTR_STS_CD IS NULL)
            AND DCI.EZCANCELFLAG                      = '0'
            AND DC.EZCANCELFLAG(+)                    = '0'
            GROUP BY
                DCI.SVC_CONTR_BR_CD
               ,DCI.CONTR_ADMIN_PSN_CD
        ) C_SHL_PEN
        ,
        (
            SELECT
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
               ,COUNT(CASE WHEN DC.DS_CONTR_STS_CD = #efective# THEN DC.DS_CONTR_PK ELSE NULL END) AS ACTV_CONTR_AMT
               ,COUNT(CASE WHEN SUBSTR(DC.DS_CONTR_CRAT_DT, 0, 6) = SUBSTR(#trgtDt#, 0, 6) AND DC.DS_CONTR_CRAT_DT &lt;= #trgtDt# THEN DC.DS_CONTR_PK ELSE NULL END) AS MTD_NEW_CONTR_AMT
               ,COUNT(CASE WHEN DC.DS_CONTR_STS_CD = #efective# AND (SUBSTR(DC.CONTR_VRSN_EFF_THRU_DT, 0, 6) = SUBSTR(#trgtDt#, 0, 6) OR SUBSTR(DC.CONTR_VRSN_EFF_THRU_DT, 0, 6) = TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(#trgtDt#, 0, 6), 'YYYYMM'), 1), 'YYYYMM')) THEN DC.DS_CONTR_PK ELSE NULL END) AS RNW_PLAN_CONTR_AMT
               ,COUNT(CASE WHEN DC.QLTY_ASRN_HLD_FLG = 'Y' AND DC.DS_CONTR_STS_CD NOT IN (#expired#, #cancelled#, #terminated#) THEN DC.DS_CONTR_PK ELSE NULL END) AS MTD_CONTR_MOD_AMT
               ,COUNT(CASE WHEN DC.DS_CONTR_STS_CD = #terminated# AND SUBSTR(DC.DS_CONTR_CRAT_DT, 0, 6) = SUBSTR(#trgtDt#, 0, 6) AND DC.DS_CONTR_CRAT_DT &lt;= #trgtDt# THEN DC.DS_CONTR_PK ELSE NULL END) AS MTD_CONTR_TRMN_AMT
            FROM
               DS_CONTR                                DC
            WHERE
                DC.GLBL_CMPY_CD                       = #glblCmpyCd#
            AND DC.EZCANCELFLAG                       = '0'
            GROUP BY
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
        ) C_CON
        ,
        (
            SELECT
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
               ,COUNT(DC.DS_CONTR_PK)                AS ACTV_CONTR_MACH_AMT
            FROM
                DS_CONTR                                DC
               ,DS_CONTR_DTL                            DCD
            WHERE
                DC.GLBL_CMPY_CD                       = #glblCmpyCd#
            AND DC.DS_CONTR_STS_CD                    = #efective#
            AND DC.GLBL_CMPY_CD                       = DCD.GLBL_CMPY_CD
            AND DC.DS_CONTR_PK                        = DCD.DS_CONTR_PK
            AND DCD.DS_CONTR_DTL_TP_CD              IN (#macb#,#macu#,#macbu#)
            AND DCD.DS_CONTR_DTL_STS_CD               = #actv#
            AND DC.EZCANCELFLAG                       = '0'
            AND DCD.EZCANCELFLAG                      = '0'
            GROUP BY
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
        ) C_MAC
        ,(
            WITH ACT_SHELL_BAT_NUM_V AS (
                SELECT DISTINCT
                    DCI.SVC_CONTR_BR_CD
                   ,DCI.CONTR_ADMIN_PSN_CD
                   ,DCI.DS_CONTR_INTFC_BAT_NUM
                FROM
                    DS_CONTR_INTFC                           DCI
                WHERE
                    DCI.GLBL_CMPY_CD                       = #glblCmpyCd#
                AND SUBSTR(DCI.EZUPTIME, 0, 8)             = #trgtDt#
                AND DCI.CONTR_INTFC_SRC_TP_CD             != #cpo#
                AND EXISTS (
                    SELECT
                        1
                    FROM
                        DS_CONTR                             DC
                       ,DS_CONTR_TRK                         DCT
                    WHERE
                        DC.GLBL_CMPY_CD                    = DCI.GLBL_CMPY_CD
                    AND DC.DS_CONTR_NUM                    = DCI.DS_CONTR_NUM
                    AND DC.GLBL_CMPY_CD                    = DCT.GLBL_CMPY_CD
                    AND DC.DS_CONTR_PK                     = DCT.DS_CONTR_PK
                    AND (NVL(DCT.DS_CONTR_FROM_STS_CD, #none#), DCT.DS_CONTR_TO_STS_CD)
                        IN ((#none#, #sigd#), (#none#, #actv#), (#drft#, #sigd#), (#drft#, #actv#))
                    AND SUBSTR(DCT.STS_MEMO_UPD_TS, 0, 8)  = #trgtDt#
                    AND DC.EZCANCELFLAG                    = '0'
                    AND DCT.EZCANCELFLAG                   = '0')
            )
            SELECT
                C_ACT.SVC_CONTR_BR_CD
               ,C_ACT.CONTR_ADMIN_PSN_CD
               ,C_ACT.MTD_NEW_ACTV_SHELL_AMT
               ,LT_DT.AVG_DAYS_SHELL_ACTV_AMT
            FROM
            (
                SELECT
                    ACT.SVC_CONTR_BR_CD
                   ,ACT.CONTR_ADMIN_PSN_CD
                   ,COUNT(ACT.DS_CONTR_INTFC_BAT_NUM) AS MTD_NEW_ACTV_SHELL_AMT
                FROM
                    ACT_SHELL_BAT_NUM_V ACT
                GROUP BY
                    ACT.SVC_CONTR_BR_CD
                   ,ACT.CONTR_ADMIN_PSN_CD
            ) C_ACT
            ,
            (
                SELECT
                    LT_WK.SVC_CONTR_BR_CD
                   ,LT_WK.CONTR_ADMIN_PSN_CD
                   ,SUM(TO_DATE(#trgtDt#, 'YYYYMMDD') - TO_DATE(LT_WK.LT_DT, 'YYYYMMDD')) AS AVG_DAYS_SHELL_ACTV_AMT
                FROM
                (
                    SELECT
                        DCI.SVC_CONTR_BR_CD
                       ,DCI.CONTR_ADMIN_PSN_CD
                       ,DCI.DS_CONTR_INTFC_BAT_NUM
                       ,SUBSTR(MIN(DCI.EZINTIME), 0, 8)      AS LT_DT
                    FROM
                        DS_CONTR_INTFC                          DCI
                       ,ACT_SHELL_BAT_NUM_V                     BAT
                    WHERE
                        DCI.GLBL_CMPY_CD                      = #glblCmpyCd#
                    AND DCI.DS_CONTR_INTFC_BAT_NUM            = BAT.DS_CONTR_INTFC_BAT_NUM
                    AND DCI.CONTR_INTFC_SRC_TP_CD            != #cpo#
                    AND DCI.EZCANCELFLAG                      = '0'
                    GROUP BY
                        DCI.SVC_CONTR_BR_CD
                       ,DCI.CONTR_ADMIN_PSN_CD
                       ,DCI.DS_CONTR_INTFC_BAT_NUM
                ) LT_WK
                GROUP BY
                    LT_WK.SVC_CONTR_BR_CD
                   ,LT_WK.CONTR_ADMIN_PSN_CD
            ) LT_DT
            WHERE
                C_ACT.SVC_CONTR_BR_CD                   = LT_DT.SVC_CONTR_BR_CD
            AND C_ACT.CONTR_ADMIN_PSN_CD                = LT_DT.CONTR_ADMIN_PSN_CD
        ) C_SHL_ACT
        ,
        (
            SELECT
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
               ,COUNT(DC.DS_CONTR_PK)                   AS RNW_HLD_CONTR_AMT
            FROM
                DS_CONTR                                DC
            WHERE
                DC.GLBL_CMPY_CD                       = #glblCmpyCd#
            AND DC.DS_CONTR_STS_CD                    = #efective#
            AND DC.EZCANCELFLAG                       = '0'
            AND EXISTS (
                SELECT 1
                FROM
                    DS_CONTR_PRC_EFF_STS_V              DCPES
                   ,DS_CONTR_DTL                        DCD
                WHERE
                    DCPES.GLBL_CMPY_CD                = DC.GLBL_CMPY_CD
                AND DCPES.GLBL_CMPY_CD                = DCD.GLBL_CMPY_CD
                AND DCPES.DS_CONTR_DTL_PK             = DCD.DS_CONTR_DTL_PK
                AND DCPES.DS_CONTR_CTRL_STS_CD      IN (#rnwh# ,#rnpo#)
                AND DCD.DS_CONTR_PK                   = DC.DS_CONTR_PK
                AND DCPES.EZCANCELFLAG                = '0'
                AND DCD.EZCANCELFLAG                  = '0')
            GROUP BY
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
        ) C_HLD
        ,
        (
            SELECT
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
               ,COUNT(DS_CONTR_PK)                   AS MTD_RNW_PROC_AMT
            FROM
                DS_CONTR                                DC
            WHERE
                DC.GLBL_CMPY_CD                       = #glblCmpyCd#
            AND DC.EZCANCELFLAG                       = '0'
            AND EXISTS (
                SELECT 1
                FROM
                    DS_CONTR_DTL                        DCD
                   ,DS_CONTR_RNW_ESCL                   DCRE
                WHERE
                    DCD.GLBL_CMPY_CD                  = DC.GLBL_CMPY_CD
                AND DCD.DS_CONTR_PK                   = DC.DS_CONTR_PK
                AND DCD.GLBL_CMPY_CD                  = DCRE.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_PK               = DCRE.DS_CONTR_DTL_PK
                AND TO_CHAR(TO_DATE(DCD.RNW_EFF_FROM_DT, 'YYYYMMDD') - DCRE.BEF_END_RNW_DAYS_AOT, 'YYYYMM') = SUBSTR(#trgtDt#, 0, 6)
                AND DCD.EZCANCELFLAG                  = '0'
                AND DCRE.EZCANCELFLAG                 = '0')
            GROUP BY
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
        ) C_RNW_PRO
        ,
        (
            SELECT
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
               ,COUNT(DS_CONTR_PK)                   AS MTD_RNW_ACTV_AMT
            FROM
                DS_CONTR                                DC
            WHERE
                DC.GLBL_CMPY_CD                       = #glblCmpyCd#
            AND DC.EZCANCELFLAG                       = '0'
            AND EXISTS (
                SELECT 1
                FROM
                    DS_CONTR_TRK                        DCT
                WHERE
                    DCT.GLBL_CMPY_CD                  = DC.GLBL_CMPY_CD
                AND DCT.DS_CONTR_PK                   = DC.DS_CONTR_PK
                AND (NVL(DCT.DS_CONTR_FROM_STS_CD, #none#), DCT.DS_CONTR_TO_STS_CD)
                    IN ((#rnwh#, #actv#), (#rnpo#, #actv#))
                AND SUBSTR(DCT.STS_MEMO_UPD_TS, 0, 6) = SUBSTR(#trgtDt#, 0, 6)
                AND DCT.EZCANCELFLAG                  = '0')
            GROUP BY
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
        ) C_RNW_ACT
        ,
        (
            SELECT
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
               ,COUNT(DS_CONTR_PK)                   AS RNW_PEND_CONTR_AMT
            FROM
                DS_CONTR                                DC
            WHERE
                DC.GLBL_CMPY_CD                       = #glblCmpyCd#
            AND DC.DS_CONTR_STS_CD              NOT IN (#entered#, #cancelled#, #drftCd#, #terminated#)
            AND DC.EZCANCELFLAG                       = '0'
            AND EXISTS (
                SELECT 1
                FROM
                    DS_CONTR_DTL                        DCD
                   ,DS_CONTR_RNW_ESCL                   DCRE
                WHERE
                    DCD.GLBL_CMPY_CD                  = DC.GLBL_CMPY_CD
                AND DCD.DS_CONTR_PK                   = DC.DS_CONTR_PK
                AND DCD.GLBL_CMPY_CD                  = DCRE.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_PK               = DCRE.DS_CONTR_DTL_PK
                AND DCD.CONTR_EFF_THRU_DT         &gt;= TO_CHAR(TO_DATE(#trgtDt#, 'YYYYMMDD') - 60, 'YYYYMMDD')
                AND DCD.CONTR_EFF_THRU_DT         &lt;= TO_CHAR(TO_DATE(#trgtDt#, 'YYYYMMDD') + 30, 'YYYYMMDD')
                AND DCD.CONTR_EFF_THRU_DT         &lt;= TO_CHAR(TO_DATE(#trgtDt#, 'YYYYMMDD') + DCRE.BEF_END_RNW_DAYS_AOT, 'YYYYMMDD')
                AND DCD.DS_CONTR_DTL_STS_CD     NOT IN (#sbmt#, #iact#, #trmd#, #canc#, #save#)
                AND DCD.EZCANCELFLAG                  = '0'
                AND DCRE.EZCANCELFLAG                 = '0')
            GROUP BY
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
        ) C_RNW_PEN
        ,
        (
            SELECT
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
               ,COUNT(CASE WHEN SUBSTR(DCBS.NEXT_BLLG_DT, 0, 6) = SUBSTR(#trgtDt#, 0, 6)                                                           THEN DC.DS_CONTR_PK ELSE NULL END) AS MTR_READ_PLN_AMT
               ,COUNT(CASE WHEN DCBS.NEXT_BLLG_DT &lt;= #trgtDt#                                                                                   THEN DC.DS_CONTR_PK ELSE NULL END) AS MTR_READ_PAST_DUE_AOT
               ,COUNT(CASE WHEN DCBS.NEXT_BLLG_DT &gt;= #trgtDt# AND DCBS.NEXT_BLLG_DT &lt; TO_CHAR(TO_DATE(#trgtDt#, 'YYYYMMDD') + 5, 'YYYYMMDD') THEN DC.DS_CONTR_PK ELSE NULL END) AS MTR_DUE_NEXT_IN_DAYS_AOT
            FROM
                DS_CONTR                                DC
               ,DS_CONTR_DTL                            DCD
               ,DS_CONTR_BLLG_SCHD                      DCBS
            WHERE
                DC.GLBL_CMPY_CD                       = #glblCmpyCd#
            AND DC.GLBL_CMPY_CD                       = DCD.GLBL_CMPY_CD
            AND DC.DS_CONTR_PK                        = DCD.DS_CONTR_PK
            AND DCD.DS_CONTR_DTL_TP_CD          NOT IN (#fleet# ,#agg#)
            AND DCD.GLBL_CMPY_CD                      = DCBS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK                   = DCBS.DS_CONTR_DTL_PK
            AND DCBS.USG_CHRG_FLG                     = 'Y'
            AND NOT EXISTS (
                SELECT 1
                FROM
                    SVC_CONTR_BLLG                      SCB
                WHERE
                    SCB.GLBL_CMPY_CD                  = DCBS.GLBL_CMPY_CD
                AND SCB.DS_CONTR_BLLG_SCHD_PK         = DCBS.DS_CONTR_BLLG_SCHD_PK
                AND SCB.EZCANCELFLAG                  = '0')
            AND DC.EZCANCELFLAG                       = '0'
            AND DCD.EZCANCELFLAG                      = '0'
            AND DCBS.EZCANCELFLAG                     = '0'
            GROUP BY
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
        ) C_MTR
        ,
        (
            SELECT
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
               ,COUNT(DC.DS_CONTR_PK)                   AS MTR_READ_CPTR_AMT
            FROM
                DS_CONTR                                DC
               ,DS_CONTR_DTL                            DCD
               ,DS_CONTR_BLLG_SCHD                      DCBS
               ,SVC_CONTR_BLLG                          SCB
            WHERE
                DC.GLBL_CMPY_CD                       = #glblCmpyCd#
            AND DC.GLBL_CMPY_CD                       = DCD.GLBL_CMPY_CD
            AND DC.DS_CONTR_PK                        = DCD.DS_CONTR_PK
            AND DCD.DS_CONTR_DTL_TP_CD          NOT IN (#fleet# ,#agg#)
            AND DCD.GLBL_CMPY_CD                      = DCBS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK                   = DCBS.DS_CONTR_DTL_PK
            AND DCBS.USG_CHRG_FLG                     = 'Y'
            AND SUBSTR(DCBS.NEXT_BLLG_DT, 0, 6)       = SUBSTR(#trgtDt#, 0, 6)
            AND DCBS.GLBL_CMPY_CD                     = SCB.GLBL_CMPY_CD
            AND DCBS.DS_CONTR_BLLG_SCHD_PK            = SCB.DS_CONTR_BLLG_SCHD_PK
            AND DC.EZCANCELFLAG                       = '0'
            AND DCD.EZCANCELFLAG                      = '0'
            AND DCBS.EZCANCELFLAG                     = '0'
            AND SCB.EZCANCELFLAG                      = '0'
            GROUP BY
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
        ) C_MTR_CPT
        ,
        (
            SELECT
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
               ,COUNT(DC.DS_CONTR_PK)                   AS MACH_DUE_BY_EOM_AOT
            FROM
                DS_CONTR                                DC
               ,DS_CONTR_DTL                            DCD
            WHERE
                DC.GLBL_CMPY_CD                       = #glblCmpyCd#
            AND DC.GLBL_CMPY_CD                       = DCD.GLBL_CMPY_CD
            AND DC.DS_CONTR_PK                        = DCD.DS_CONTR_PK
            AND DCD.DS_CONTR_DTL_TP_CD              IN (#macb#, #macu#, #macbu#)
            AND EXISTS (
                SELECT 1
                FROM
                    DS_CONTR_BLLG_SCHD                  DCBS
                WHERE
                    DCBS.GLBL_CMPY_CD                  = DCD.GLBL_CMPY_CD
                AND DCBS.DS_CONTR_DTL_PK               = DCD.DS_CONTR_DTL_PK
                AND DCBS.NEXT_BLLG_DT              &gt; #trgtDt#
                AND DCBS.NEXT_BLLG_DT              &lt;= TO_CHAR(LAST_DAY(TO_DATE(#trgtDt#, 'YYYYMMDD')), 'YYYYMMDD')
                AND DCBS.USG_CHRG_FLG                  = 'Y'
                AND NOT EXISTS (
                    SELECT 1
                    FROM
                        SVC_CONTR_BLLG                  SCB
                    WHERE
                        SCB.GLBL_CMPY_CD              = DCBS.GLBL_CMPY_CD
                    AND SCB.DS_CONTR_BLLG_SCHD_PK     = DCBS.DS_CONTR_BLLG_SCHD_PK
                    AND SCB.EZCANCELFLAG              = '0')
                AND DCBS.EZCANCELFLAG                 = '0')
            AND DC.EZCANCELFLAG                       = '0'
            AND DCD.EZCANCELFLAG                      = '0'
            GROUP BY
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
        ) A_MAC_EOM
        ,
        (
            SELECT
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
               ,COUNT(DC.DS_CONTR_PK)                   AS MTD_MACH_READ_CNT
            FROM
                DS_CONTR                                DC
               ,DS_CONTR_DTL                            DCD
               ,
               (SELECT DISTINCT
                    DS_CONTR_DTL_PK
                FROM
                   (SELECT
                        DCBS.DS_CONTR_DTL_PK
                    FROM
                        DS_CONTR_BLLG_SCHD DCBS
                       ,SVC_CONTR_BLLG     SCB
                    WHERE
                        DCBS.GLBL_CMPY_CD                = #glblCmpyCd#
                    AND DCBS.USG_CHRG_FLG                = 'Y'
                    AND SUBSTR(DCBS.NEXT_BLLG_DT, 0, 6)  = SUBSTR(#trgtDt#, 0, 6)
                    AND DCBS.GLBL_CMPY_CD                = SCB.GLBL_CMPY_CD
                    AND DCBS.DS_CONTR_BLLG_SCHD_PK       = SCB.DS_CONTR_BLLG_SCHD_PK
                    AND DCBS.EZCANCELFLAG                = '0'
                    AND SCB.EZCANCELFLAG                 = '0'
                    UNION ALL
                    SELECT DISTINCT
                        DCBS.DS_CONTR_DTL_PK
                    FROM
                        DS_CONTR_BLLG_SCHD DCBS
                    WHERE
                        DCBS.GLBL_CMPY_CD                = #glblCmpyCd#
                    AND DCBS.USG_CHRG_FLG                = 'Y'
                    AND SUBSTR(DCBS.NEXT_BLLG_DT, 0, 6)  = SUBSTR(#trgtDt#, 0, 6)
                    AND DCBS.INV_DT                      IS NOT NULL
                    AND DCBS.EZCANCELFLAG                = '0')
               ) DCBS
            WHERE
                DC.GLBL_CMPY_CD                       = #glblCmpyCd#
            AND DC.GLBL_CMPY_CD                       = DCD.GLBL_CMPY_CD
            AND DC.DS_CONTR_PK                        = DCD.DS_CONTR_PK
            AND DCD.DS_CONTR_DTL_TP_CD              IN (#macb#, #macu#, #macbu#)
            AND DCD.DS_CONTR_DTL_PK                   = DCBS.DS_CONTR_DTL_PK
            AND DC.EZCANCELFLAG                       = '0'
            AND DCD.EZCANCELFLAG                      = '0'
            GROUP BY
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
        ) C_MAC_REA
        ,
        (
            SELECT
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
               ,COUNT(DC.DS_CONTR_PK)                   AS MTD_MACH_PAST_DUE_AOT
            FROM
                DS_CONTR                                DC
               ,DS_CONTR_DTL                            DCD
            WHERE
                DC.GLBL_CMPY_CD                       = #glblCmpyCd#
            AND DC.GLBL_CMPY_CD                       = DCD.GLBL_CMPY_CD
            AND DC.DS_CONTR_PK                        = DCD.DS_CONTR_PK
            AND DCD.DS_CONTR_DTL_TP_CD              IN (#macb#, #macu#, #macbu#)
            AND EXISTS (
                SELECT 1
                FROM
                    DS_CONTR_BLLG_SCHD                  DCBS
                WHERE
                    DCBS.GLBL_CMPY_CD                  = DCD.GLBL_CMPY_CD
                AND DCBS.DS_CONTR_DTL_PK               = DCD.DS_CONTR_DTL_PK
                AND DCBS.NEXT_BLLG_DT              &lt;= #trgtDt#
                AND DCBS.USG_CHRG_FLG                  = 'Y'
                AND NOT EXISTS (
                    SELECT 1
                    FROM
                        SVC_CONTR_BLLG                  SCB
                    WHERE
                        SCB.GLBL_CMPY_CD              = DCBS.GLBL_CMPY_CD
                    AND SCB.DS_CONTR_BLLG_SCHD_PK     = DCBS.DS_CONTR_BLLG_SCHD_PK
                    AND SCB.EZCANCELFLAG              = '0')
                AND DCBS.EZCANCELFLAG                 = '0')
            AND DC.EZCANCELFLAG                       = '0'
            AND DCD.EZCANCELFLAG                      = '0'
            GROUP BY
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
        ) A_MAC_PAS
        ,
        (
            SELECT
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
               ,COUNT(DC.DS_CONTR_PK)                   AS MTD_CONTR_LINE_CRAT_AMT
            FROM
                DS_CONTR                                DC
               ,DS_CONTR_DTL                            DCD
            WHERE
                DC.GLBL_CMPY_CD                       = #glblCmpyCd#
            AND DC.GLBL_CMPY_CD                       = DCD.GLBL_CMPY_CD
            AND DC.DS_CONTR_PK                        = DCD.DS_CONTR_PK
            AND SUBSTR(DCD.EZINTIME, 0, 6)            = SUBSTR(#trgtDt#, 0, 6)
            AND SUBSTR(DCD.EZINTIME, 0, 8)         &lt;= #trgtDt#
            AND DC.EZCANCELFLAG                       = '0'
            AND DCD.EZCANCELFLAG                      = '0'
            GROUP BY
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
        ) C_CON_DTL
        ,
        (
            SELECT
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
               ,SUM  (CASE WHEN SI.INV_TP_CD = #creditMemo# AND SI.INV_TOT_DEAL_SLS_AMT != 0 AND SUBSTR(SI.INV_DT, 0, 6) = SUBSTR(#trgtDt#, 0, 6) AND SI.INV_DT &lt;= #trgtDt# THEN SI.INV_TOT_DEAL_SLS_AMT ELSE 0    END) AS MTD_CR_DOL_PROC_AMT
               ,COUNT(CASE WHEN SI.INV_TP_CD = #creditMemo# AND SI.INV_TOT_DEAL_SLS_AMT != 0 AND SUBSTR(SI.INV_DT, 0, 6) = SUBSTR(#trgtDt#, 0, 6) AND SI.INV_DT &lt;= #trgtDt# THEN DC.DS_CONTR_PK          ELSE NULL END) AS MTD_CR_CNT
               ,COUNT(CASE WHEN SI.INV_TP_CD = #invoice#    AND SI.INV_TOT_DEAL_SLS_AMT != 0 AND SUBSTR(SI.INV_DT, 0, 6) = SUBSTR(#trgtDt#, 0, 6) AND SI.INV_DT &lt;= #trgtDt# THEN DC.DS_CONTR_PK          ELSE NULL END) AS MTD_INV_CNT
            FROM
                DS_CONTR                                DC
               ,SVC_INV                                 SI
            WHERE
                DC.GLBL_CMPY_CD                       = #glblCmpyCd#
            AND DC.GLBL_CMPY_CD                       = SI.GLBL_CMPY_CD
            AND DC.DS_CONTR_PK                        = SI.DS_CONTR_PK
            AND DC.EZCANCELFLAG                       = '0'
            AND SI.EZCANCELFLAG                       = '0'
            GROUP BY
                DC.SVC_CONTR_BR_CD
               ,DC.CONTR_ADMIN_PSN_CD
        ) C_INV
        ,
        (
            SELECT
                SCR.SVC_CONTR_BR_CD
               ,SCR.CUST_INCDT_ASG_PSN_CD               AS CONTR_ADMIN_PSN_CD
               ,COUNT(SCR.SVC_CR_REBIL_PK)              AS MTD_INCDT_CLO_AMT
            FROM
                SVC_CR_REBIL                            SCR
            WHERE
                SCR.GLBL_CMPY_CD                       = #glblCmpyCd#
            AND SCR.SVC_CR_REBIL_STS_CD                = #processed#
            AND SUBSTR(SCR.EZUPTIME, 0, 6)             = SUBSTR(#trgtDt#, 0, 6)
            AND SUBSTR(SCR.EZUPTIME, 0, 8)         &lt;= #trgtDt#
            AND SCR.EZCANCELFLAG                       = '0'
            GROUP BY
                SCR.SVC_CONTR_BR_CD
               ,SCR.CUST_INCDT_ASG_PSN_CD
        ) C_SCR
        WHERE
            MAIN.SVC_CONTR_BR_CD                      = C_CRA.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_CRA.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_ACT.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_ACT.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = A_SHL_PEN.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = A_SHL_PEN.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_SHL_PEN.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_SHL_PEN.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_CON.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_CON.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_MAC.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_MAC.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_SHL_ACT.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_SHL_ACT.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_HLD.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_HLD.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_RNW_PRO.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_RNW_PRO.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_RNW_ACT.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_RNW_ACT.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_RNW_PEN.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_RNW_PEN.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_MTR.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_MTR.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_MTR_CPT.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_MTR_CPT.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = A_MAC_EOM.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = A_MAC_EOM.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_MAC_REA.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_MAC_REA.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = A_MAC_PAS.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = A_MAC_PAS.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_CON_DTL.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_CON_DTL.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_INV.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_INV.CONTR_ADMIN_PSN_CD(+)
        AND MAIN.SVC_CONTR_BR_CD                      = C_SCR.SVC_CONTR_BR_CD(+)
        AND MAIN.PSN_CD                               = C_SCR.CONTR_ADMIN_PSN_CD(+)
        UNION ALL
        -- Branch DATA
        SELECT
            MAIN.SVC_LINE_BIZ_CD                     AS SVC_LINE_BIZ_CD
           ,MAIN.SVC_RG_PK                           AS SVC_RG_PK
           ,MAIN.SVC_RG_DESC_TXT                     AS SVC_RG_DESC_TXT
           ,MAIN.SVC_CONTR_BR_CD                     AS SVC_CONTR_BR_CD
           ,NULL                                     AS PSN_CD
           ,NULL                                     AS PSN_FIRST_NM
           ,NULL                                     AS PSN_MID_NM
           ,NULL                                     AS PSN_LAST_NM
           ,0                                        AS MTD_SHELL_CRAT_AMT
           ,0                                        AS MTD_SHELL_CLO_AMT
           ,0                                        AS AGE_TO_ACTV_SHELL_AMT
           ,0                                        AS AVG_AGE_SHELL_PEND_AMT
           ,0                                        AS SHELL_PEND_TOT_AMT
           ,0                                        AS PEND_UP_TO_DAYS_AMT_05
           ,0                                        AS PEND_UP_TO_DAYS_AMT_10
           ,0                                        AS PEND_UP_TO_DAYS_AMT_30
           ,0                                        AS PEND_UP_TO_DAYS_AMT_60
           ,0                                        AS PEND_OVER_DAYS_AMT_60
           ,0                                        AS ACTV_CONTR_AMT
           ,0                                        AS ACTV_CONTR_MACH_AMT
           ,0                                        AS MTD_NEW_CONTR_AMT
           ,0                                        AS MTD_NEW_ACTV_SHELL_AMT
           ,0                                        AS AVG_DAYS_SHELL_ACTV_AMT
           ,0                                        AS RNW_HLD_CONTR_AMT
           ,0                                        AS RNW_PLAN_CONTR_AMT
           ,0                                        AS MTD_RNW_PROC_AMT
           ,0                                        AS MTD_RNW_ACTV_AMT
           ,0                                        AS RNW_PEND_CONTR_AMT
           ,0                                        AS MTR_READ_PLN_AMT
           ,0                                        AS MTR_READ_CPTR_AMT
           ,0                                        AS MTR_READ_PAST_DUE_AOT
           ,0                                        AS MTR_DUE_NEXT_IN_DAYS_AOT
           ,0                                        AS MACH_DUE_BY_EOM_AOT
           ,0                                        AS MTD_MACH_READ_CNT
           ,0                                        AS MTD_MACH_PAST_DUE_AOT
           ,0                                        AS MTD_CONTR_MOD_AMT
           ,0                                        AS MTD_CONTR_TRMN_AMT
           ,0                                        AS MTD_CONTR_LINE_CRAT_AMT
           ,0                                        AS MTD_CR_DOL_PROC_AMT
           ,NVL(C_INV.MTD_CR_DOL_PROC_CNT, 0)        AS MTD_CR_DOL_PROC_CNT
           ,NVL(C_INV.MTD_NET_MAN_DOL_AMT, 0)        AS MTD_NET_MAN_DOL_AMT
           ,0                                        AS MTD_INCDT_CLO_AMT
           ,0                                        AS MTD_CR_CNT
           ,0                                        AS MTD_INV_CNT
           ,NULL                                     AS RPT_SHELL_TP_CD
        FROM
        (
            SELECT DISTINCT
                SRG.SVC_LINE_BIZ_CD                  AS SVC_LINE_BIZ_CD
               ,SRG.SVC_RG_PK                        AS SVC_RG_PK
               ,SRG.SVC_RG_DESC_TXT                  AS SVC_RG_DESC_TXT
               ,SRB.SVC_CONTR_BR_CD                  AS SVC_CONTR_BR_CD
            FROM
                SVC_BR_RESRC_RELN                       SBR
               ,SVC_RG_BR_RELN                          SRB
               ,SVC_RG                                  SRG
            WHERE
                SBR.GLBL_CMPY_CD                      = #glblCmpyCd#
            AND SBR.SVC_BR_RESRC_ACTV_FLG             = 'Y'
            AND SBR.GLBL_CMPY_CD                      = SRB.GLBL_CMPY_CD
            AND SBR.SVC_CONTR_BR_CD                   = SRB.SVC_CONTR_BR_CD
            AND SRB.GLBL_CMPY_CD                      = SRG.GLBL_CMPY_CD
            AND SRB.SVC_RG_PK                         = SRG.SVC_RG_PK
            AND SRG.SVC_RG_ACTV_FLG                   = 'Y'
            AND SBR.EZCANCELFLAG                      = '0'
            AND SRB.EZCANCELFLAG                      = '0'
            AND SRG.EZCANCELFLAG                      = '0'
        ) MAIN
        ,
        (
            SELECT
                AIAD.AJE_COA_BR_CD                   AS SVC_CONTR_BR_CD
               ,COUNT(DISTINCT INV.INV_NUM)          AS MTD_CR_DOL_PROC_CNT
               ,SUM(AIAD.JRNL_DEAL_AMT)              AS MTD_NET_MAN_DOL_AMT
            FROM
                AJE_INV_ACCT_DIST                       AIAD
               ,INV                                     INV
               ,INV_LINE                                INVD
            WHERE
                AIAD.GLBL_CMPY_CD                     = #glblCmpyCd#
            AND AIAD.AJE_INV_ACCT_CLS_CD            IN (#revenue#, #unearndRevenue#)
            AND AIAD.GLBL_CMPY_CD                     = INV.GLBL_CMPY_CD
            AND AIAD.INV_NUM                          = INV.INV_NUM
            AND SUBSTR(INV.INV_DT, 0, 6)              = SUBSTR(#trgtDt#, 0, 6)
            AND INV.GLBL_CMPY_CD                      = INVD.GLBL_CMPY_CD
            AND INV.INV_NUM                           = INVD.INV_NUM
            AND AIAD.INV_BOL_LINE_NUM                 = INVD.INV_BOL_LINE_NUM
            AND AIAD.INV_LINE_NUM                     = INVD.INV_LINE_NUM
            AND AIAD.INV_LINE_SUB_NUM                 = INVD.INV_LINE_SUB_NUM
            AND AIAD.INV_LINE_SUB_TRX_NUM             = INVD.INV_LINE_SUB_TRX_NUM
            AND AIAD.EZCANCELFLAG                     = '0'
            AND INV.EZCANCELFLAG                      = '0'
            AND INVD.EZCANCELFLAG                     = '0'
            GROUP BY
                AIAD.AJE_COA_BR_CD
        ) C_INV
        WHERE
            MAIN.SVC_CONTR_BR_CD                      = C_INV.SVC_CONTR_BR_CD(+)
    </statement>

</sqlMap>
