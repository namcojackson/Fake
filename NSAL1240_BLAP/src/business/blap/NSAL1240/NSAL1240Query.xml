<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL1240Query">

    <typeAlias alias="NSAL1240_BSMsg"    type="business.blap.NSAL1240.NSAL1240_BSMsg"/>
    <statement id="getSearchData" parameterClass="Map" resultMap="result.getSearchData">
<!--START 2019/02/05 K.Fujimoto [QC#28404, ADD] -->
       WITH SVC_MACH_MSTR_TMP AS (
          SELECT 
              SMM.GLBL_CMPY_CD ,
              SMM.SVC_MACH_MSTR_PK ,
              SMM.SVC_CONFIG_MSTR_PK ,
              SMM.SER_NUM ,
              SMM.MDSE_CD ,
              SMM.SVC_MACH_MSTR_STS_CD ,
              SMM.OWNR_ACCT_NUM ,
              SMM.BILL_TO_ACCT_NUM ,
              SMM.BILL_TO_LOC_NUM ,
              SMM.CUR_LOC_ACCT_NUM ,
              SMM.CUR_LOC_NUM ,
              SMM.IND_BILL_TO_LOC_NUM ,
              SMM.IND_CUR_LOC_NUM ,
              SMM.ISTL_DT ,
              SMM.EZINTIME ,
              SMM.EZINUSERID ,
              SMM.EZUPTIME ,
              SMM.EZUPUSERID ,
              SMM.EZTABLEID ,
              SMM.SVC_MACH_SQ_NUM ,
              SMM.SVC_MACH_TP_CD ,
              SMM.STK_STS_CD ,
              SMM.SVC_MACH_USG_STS_CD ,
              SMM.OWNR_LOC_NUM ,
              SMM.SVC_MACH_MAINT_AVAL_FLG ,
              SMM.SHIP_DT SHIP_DT
            FROM
              SVC_MACH_MSTR SMM
           WHERE
                    SMM.GLBL_CMPY_CD         =       #bizMsg.glblCmpyCd#
                <isNotNull property="bizMsg.xxScrItem29Txt_H2">
                AND SMM.SVC_MACH_MSTR_PK     LIKE    #bizMsg.xxScrItem29Txt_H2#
                </isNotNull>
                <isNotNull property="bizMsg.xxScrItem29Txt_H1">
                AND SMM.SVC_CONFIG_MSTR_PK   LIKE    #bizMsg.xxScrItem29Txt_H1#
                </isNotNull>
                <isEqual property="bizMsg.xxModeCd_I1" compareValue="02">
                AND SMM.SVC_CONFIG_MSTR_PK   IS NOT NULL
                </isEqual>
                <isEqual property="bizMsg.xxModeCd_I1" compareValue="03">
                AND SMM.SVC_CONFIG_MSTR_PK   IS NULL
                </isEqual>
                <isNotNull property="bizMsg.serNum_H">
<!-- START 2024/02/28 K.Watanabe [QC#63541,MOD] -->
<!--            AND SMM.SER_NUM              LIKE    #bizMsg.serNum_H# -->
                AND (
                        SMM.SER_NUM             LIKE #bizMsg.serNum_H#
                    OR  SMM.CUST_MACH_CTRL_NUM  LIKE #bizMsg.serNum_H#
                )
<!-- END 2024/02/28 K.Watanabe [QC#63541,MOD] -->
                </isNotNull>
                <isNotNull property="bizMsg.mdseCd_H">
                AND SMM.MDSE_CD              LIKE    #bizMsg.mdseCd_H#
                </isNotNull>
                <isNotNull property="bizMsg.ownrAcctNum_H">
                AND SMM.OWNR_ACCT_NUM        LIKE    #bizMsg.ownrAcctNum_H#
                </isNotNull>
                <isNotNull property="bizMsg.billToAcctNum_H">
                AND SMM.BILL_TO_ACCT_NUM     LIKE    #bizMsg.billToAcctNum_H#
                </isNotNull>
                <isNotNull property="bizMsg.curLocAcctNum_H">
                AND SMM.CUR_LOC_ACCT_NUM     LIKE    #bizMsg.curLocAcctNum_H#
                </isNotNull>
                <isNotNull property="bizMsg.indBillToLocNum_H">
                AND SMM.IND_BILL_TO_LOC_NUM  LIKE    #bizMsg.indBillToLocNum_H#
                </isNotNull>
                <isNotNull property="bizMsg.indCurLocNum_H">
                AND SMM.IND_CUR_LOC_NUM      LIKE    #bizMsg.indCurLocNum_H#
                </isNotNull>
                <isNotNull property="bizMsg.shipDt_H1">
                AND SMM.SHIP_DT              &gt;=   #bizMsg.shipDt_H1#
                </isNotNull>
                <isNotNull property="bizMsg.shipDt_H2">
                AND SMM.SHIP_DT              &lt;=   #bizMsg.shipDt_H2#
                </isNotNull>
                <isNotNull property="svcMachUsgStsCd">
                AND SMM.SVC_MACH_USG_STS_CD  =       #svcMachUsgStsCd#
                </isNotNull>
                <iterate property="svcMachMstrStsCdList" var="svcMachMstrStsCd[]" open="AND SMM.SVC_MACH_MSTR_STS_CD IN (" close=")" conjunction=",">
                    #svcMachMstrStsCd[]#
                </iterate>
                <isNotNull property="svcMachMaintAvalFlg">
                AND SMM.SVC_MACH_MAINT_AVAL_FLG
                                             =       #svcMachMaintAvalFlg#
                </isNotNull>
                <isNotNull property="bizMsg.xxChkBox_HC">
                AND SMM.SVC_MACH_TP_CD       =       #svcMachTpMachine#
                </isNotNull>
                <isNotNull property="stkStsCd">
                 AND SMM.STK_STS_CD          =       #stkStsCd#
                </isNotNull>
                <isNotNull property="curLocNum_H1">
                AND SMM.CUR_LOC_NUM          LIKE    #curLocNum_H1#
                </isNotNull>
                <isNotNull property="curLocNum_H2">
                AND SMM.CUR_LOC_NUM          LIKE    #curLocNum_H2#
                </isNotNull>
                AND SMM.EZCANCELFLAG         =       '0'
       ),
       BILL_TO_CUST_TMP AS (
          SELECT 
              /*+ INDEX(BTC BILL_TO_CUST_I1) */
              BTC.BILL_TO_CUST_CD ,
              BTC.DS_ACCT_NM ,
              BTC.POST_CD ,
              BTC.ST_CD ,
              BTC.CTY_ADDR ,
              BTC.FIRST_LINE_ADDR ,
              BTC.SCD_LINE_ADDR ,
              BTC.THIRD_LINE_ADDR ,
              BTC.FRTH_LINE_ADDR
          FROM
              BILL_TO_CUST BTC
          WHERE
              BTC.GLBL_CMPY_CD          =      #bizMsg.glblCmpyCd#
          AND BTC.EZCANCELFLAG          =      '0'
          AND BTC.EFF_FROM_DT(+)       &lt;=   #bizMsg.slsDt#
          AND NVL(BTC.EFF_THRU_DT(+), #maxDate#)
                                       &gt;=   #bizMsg.slsDt#
          AND BTC.RGTN_STS_CD(+)        =      #rgtnStsCd#
          AND EXISTS(
                       SELECT
                           1
                       FROM
                           SVC_MACH_MSTR_TMP SMMT
                       WHERE
                           SMMT.OWNR_LOC_NUM = BTC.BILL_TO_CUST_CD
                     )
          UNION
          SELECT 
              /*+ INDEX(BTC BILL_TO_CUST_I1) */
              BTC.BILL_TO_CUST_CD ,
              BTC.DS_ACCT_NM ,
              BTC.POST_CD ,
              BTC.ST_CD ,
              BTC.CTY_ADDR ,
              BTC.FIRST_LINE_ADDR ,
              BTC.SCD_LINE_ADDR ,
              BTC.THIRD_LINE_ADDR ,
              BTC.FRTH_LINE_ADDR
          FROM
              BILL_TO_CUST BTC
          WHERE
              BTC.GLBL_CMPY_CD          =      #bizMsg.glblCmpyCd#
          AND BTC.EZCANCELFLAG          =      '0'
          AND BTC.EFF_FROM_DT(+)       &lt;=   #bizMsg.slsDt#
          AND NVL(BTC.EFF_THRU_DT(+), #maxDate#)
                                       &gt;=   #bizMsg.slsDt#
          AND BTC.RGTN_STS_CD(+)        =      #rgtnStsCd#
          AND EXISTS(
                       SELECT
                           1
                       FROM
                           SVC_MACH_MSTR_TMP SMMT
                       WHERE
                           SMMT.BILL_TO_LOC_NUM = BTC.BILL_TO_CUST_CD
                    )
       ),
       SELL_TO_CUST_TMP AS (
          SELECT
              /*+ INDEX(STC SELL_TO_CUST_I1) */
              STC.SELL_TO_CUST_CD ,
              STC.DS_ACCT_NM
          FROM
              SELL_TO_CUST STC
          WHERE 
              STC.GLBL_CMPY_CD            =     #bizMsg.glblCmpyCd#
          AND STC.EZCANCELFLAG            =     '0'
          AND STC.EFF_FROM_DT(+)      &lt;=    #bizMsg.slsDt#
          AND NVL(STC.EFF_THRU_DT(+), #maxDate#)
                                       &gt;=    #bizMsg.slsDt#
          AND STC.RGTN_STS_CD(+)         =     #rgtnStsCd#
          AND EXISTS(
                      SELECT
                          1
                      FROM
                          SVC_MACH_MSTR_TMP SMMT
                      WHERE
                          SMMT.OWNR_ACCT_NUM = STC.SELL_TO_CUST_CD
                   )

       UNION

          SELECT
              /*+ INDEX(STC SELL_TO_CUST_I1) */
              STC.SELL_TO_CUST_CD ,
              STC.DS_ACCT_NM
          FROM
              SELL_TO_CUST STC
          WHERE 
              STC.GLBL_CMPY_CD            =     #bizMsg.glblCmpyCd#
          AND STC.EZCANCELFLAG            =     '0'
          AND STC.EFF_FROM_DT(+)      &lt;=    #bizMsg.slsDt#
          AND NVL(STC.EFF_THRU_DT(+), #maxDate#)
                                       &gt;=    #bizMsg.slsDt#
          AND STC.RGTN_STS_CD(+)         =     #rgtnStsCd#
          AND EXISTS(
                      SELECT
                          1
                      FROM
                          SVC_MACH_MSTR_TMP SMMT
                      WHERE
                          SMMT.BILL_TO_ACCT_NUM = STC.SELL_TO_CUST_CD
                   )

       UNION

          SELECT
              /*+ INDEX(STC SELL_TO_CUST_I1) */
              STC.SELL_TO_CUST_CD ,
              STC.DS_ACCT_NM
          FROM
              SELL_TO_CUST STC
          WHERE 
              STC.GLBL_CMPY_CD            =     #bizMsg.glblCmpyCd#
          AND STC.EZCANCELFLAG            =     '0'
          AND STC.EFF_FROM_DT(+)      &lt;=    #bizMsg.slsDt#
          AND NVL(STC.EFF_THRU_DT(+), #maxDate#)
                                       &gt;=    #bizMsg.slsDt#
          AND STC.RGTN_STS_CD(+)         =     #rgtnStsCd#
          AND EXISTS(
                      SELECT
                          1
                      FROM
                          SVC_MACH_MSTR_TMP SMMT
                      WHERE
                          SMMT.CUR_LOC_ACCT_NUM = STC.SELL_TO_CUST_CD
                   )
       )
<!--END   2019/02/05 K.Fujimoto [QC#28404, ADD] -->
       SELECT
            SVC_CONFIG_MSTR_PK
           ,SER_NUM
           ,SVC_MACH_MSTR_PK
           ,MDSE_CD
           ,MDSE_DESC_SHORT_TXT
           ,T_MDL_NM
           ,SHIP_DT
           ,SVC_MACH_USG_STS_DESC_TXT
           ,SVC_MACH_MSTR_STS_DESC_TXT
           ,SVC_MACH_MAINT_AVAL_FLG
           ,STK_STS_DESC_TXT
           ,SVC_SLN_SQ
           ,SVC_SLN_NM
<!--       ,DS_CONTR_NUM -->
           ,MIN(DS_CONTR_NUM)               DS_CONTR_NUM   <!-- QC#15410 mod -->
           ,OWNR_ACCT_NUM
           ,DS_ACCT_NM_A1
           ,BILL_TO_ACCT_NUM
           ,DS_ACCT_NM_A2
           ,IND_BILL_TO_LOC_NUM
           ,XX_COMN_SCR_COL_VAL_TXT_A2
           ,CUR_LOC_ACCT_NUM
           ,DS_ACCT_NM
           ,IND_CUR_LOC_NUM
           ,CUR_LOC_NUM
           ,XX_COMN_SCR_COL_VAL_TXT_A3
           ,MDL_ID
<!--       ,DS_CONTR_PK -->
           ,MIN(DS_CONTR_PK)                DS_CONTR_PK    <!-- QC#15410 mod -->
           ,LOC_NM
           ,SVC_MACH_USG_STS_CD
           ,SVC_MACH_MSTR_STS_CD
           ,SVC_MACH_TP_CD
        FROM (
<!--START 2016/07/14 K.Yamada [QC#11368, DEL] -->
<!-- Delete all WITH statements  -->
<!--END 2016/07/14 K.Yamada [QC#11368, DEL] -->

            SELECT
                SCM.SVC_CONFIG_MSTR_PK          SVC_CONFIG_MSTR_PK
               ,SMM.SER_NUM                     SER_NUM
               ,SMM.SVC_MACH_MSTR_PK            SVC_MACH_MSTR_PK
               ,SMM.MDSE_CD                     MDSE_CD
               ,MDS.MDSE_DESC_SHORT_TXT         MDSE_DESC_SHORT_TXT
               ,MN.T_MDL_NM                     T_MDL_NM
               ,SMM.SHIP_DT                     SHIP_DT
               ,SMUS.SVC_MACH_USG_STS_DESC_TXT  SVC_MACH_USG_STS_DESC_TXT
               ,SMMS.SVC_MACH_MSTR_STS_DESC_TXT SVC_MACH_MSTR_STS_DESC_TXT
               ,SMM.SVC_MACH_MAINT_AVAL_FLG     SVC_MACH_MAINT_AVAL_FLG
               ,SS.STK_STS_DESC_TXT             STK_STS_DESC_TXT
               ,SCM.SVC_SLN_SQ                  SVC_SLN_SQ
               ,SCM.SVC_SLN_NM                  SVC_SLN_NM
               ,DC.DS_CONTR_NUM                 DS_CONTR_NUM
               ,SMM.OWNR_ACCT_NUM               OWNR_ACCT_NUM
               ,SEL1.DS_ACCT_NM                 DS_ACCT_NM_A1
               ,SMM.BILL_TO_ACCT_NUM            BILL_TO_ACCT_NUM
               ,SEL2.DS_ACCT_NM                 DS_ACCT_NM_A2
               ,SMM.IND_BILL_TO_LOC_NUM         IND_BILL_TO_LOC_NUM
               ,DECODE(BTC2.FIRST_LINE_ADDR,  null, '', BTC2.FIRST_LINE_ADDR)
                || DECODE(BTC2.SCD_LINE_ADDR,   null, '', ' ' || BTC2.SCD_LINE_ADDR)
                || DECODE(BTC2.THIRD_LINE_ADDR, null, '', ' ' || BTC2.THIRD_LINE_ADDR)
                || DECODE(BTC2.FRTH_LINE_ADDR,  null, '', ' ' || BTC2.FRTH_LINE_ADDR)
                || DECODE(BTC2.CTY_ADDR,        null, '', ' ' || BTC2.CTY_ADDR)
                || DECODE(BTC2.ST_CD,           null, '', ' ' || BTC2.ST_CD)
                || DECODE(BTC2.POST_CD,         null, '', ' ' || BTC2.POST_CD)
                                                XX_COMN_SCR_COL_VAL_TXT_A2
               ,SMM.CUR_LOC_ACCT_NUM            CUR_LOC_ACCT_NUM
               ,SEL3.DS_ACCT_NM                 DS_ACCT_NM
               ,SMM.IND_CUR_LOC_NUM             IND_CUR_LOC_NUM
               ,SMM.CUR_LOC_NUM                 CUR_LOC_NUM
               ,DECODE(STC.FIRST_LINE_ADDR,  null, '', STC.FIRST_LINE_ADDR)
                || DECODE(STC.SCD_LINE_ADDR,    null, '', ' ' || STC.SCD_LINE_ADDR)
                || DECODE(STC.THIRD_LINE_ADDR,  null, '', ' ' || STC.THIRD_LINE_ADDR)
                || DECODE(STC.FRTH_LINE_ADDR,   null, '', ' ' || STC.FRTH_LINE_ADDR)
                || DECODE(STC.CTY_ADDR,         null, '', ' ' || STC.CTY_ADDR)
                || DECODE(STC.ST_CD,            null, '', ' ' || STC.ST_CD)
                || DECODE(STC.POST_CD,          null, '', ' ' || STC.POST_CD)
                                                XX_COMN_SCR_COL_VAL_TXT_A3
               ,SCM.MDL_ID                      MDL_ID
               ,DCD.DS_CONTR_PK                 DS_CONTR_PK
               ,STC.LOC_NM                      LOC_NM
               ,SMM.SVC_MACH_USG_STS_CD         SVC_MACH_USG_STS_CD
               ,SMM.SVC_MACH_MSTR_STS_CD        SVC_MACH_MSTR_STS_CD
               ,SMM.SVC_MACH_TP_CD              SVC_MACH_TP_CD
<!-- START 2016/07/14 K.Yamada [QC#11368, MOD] -->
<!--                ,ROW_NUMBER() OVER(PARTITION BY SMM.SVC_MACH_MSTR_PK ORDER BY DCD.CONTR_EFF_THRU_DT DESC)
                                                ROW_NUM
-->
               ,RANK() OVER(
                   PARTITION BY DCD.SVC_MACH_MSTR_PK
                   ORDER BY 
                       NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT) DESC
                       ,DECODE(DC.DS_CONTR_CATG_CD, #warranty#, 2, 1)
                       ,DCD.DS_CONTR_PK DESC
               ) RANK
<!-- END 2016/07/14 K.Yamada [QC#11368, MOD] -->
            FROM
                SVC_MACH_MSTR_TMP       SMM
               ,SVC_CONFIG_MSTR         SCM
<!-- START 2016/07/14 K.Yamada [QC#11368, MOD] -->
<!--
               ,EFF_DS_CONTR_DTL        DCD
               ,EFF_DS_CONTR            DC
-->
               ,MDL_NM                  MN
<!--START   2019/02/05 K.Fujimoto [QC#28404, MOD] -->
<!--
               ,BILL_TO_CUST            BTC1
               ,BILL_TO_CUST            BTC2
-->
               ,BILL_TO_CUST_TMP        BTC1
               ,BILL_TO_CUST_TMP        BTC2
<!--END     2019/02/05 K.Fujimoto [QC#28404, MOD] -->
               ,SHIP_TO_CUST            STC
<!--START   2019/02/05 K.Fujimoto [QC#28404, MOD] -->
<!--
               ,SELL_TO_CUST            SEL1
               ,SELL_TO_CUST            SEL2
               ,SELL_TO_CUST            SEL3
-->
               ,SELL_TO_CUST_TMP        SEL1
               ,SELL_TO_CUST_TMP        SEL2
               ,SELL_TO_CUST_TMP        SEL3
<!--END   2019/02/05 K.Fujimoto [QC#28404, MOD] -->
               ,SVC_MACH_MSTR_STS       SMMS
               ,SVC_MACH_USG_STS        SMUS
               ,STK_STS                 SS
               ,MDSE                    MDS
               ,DS_CONTR_DTL            DCD
               ,DS_CONTR                DC
<!-- END 2016/07/14 K.Yamada [QC#11368, MOD] -->
            WHERE
                <!-- SVC_MACH_MSTR -->
<!--START   2019/02/05 K.Fujimoto [QC#28404, DEL] -->
                <!-- SMM.GLBL_CMPY_CD         =       #bizMsg.glblCmpyCd# -->
<!-- START 2016/03/29 M.Gotou [QC#4949, MOD] -->
<!--
                <isNotNull property="bizMsg.xxScrItem29Txt_H2">
                AND SMM.SVC_MACH_MSTR_PK     LIKE    #bizMsg.xxScrItem29Txt_H2#
                </isNotNull>
                <isNotNull property="bizMsg.xxScrItem29Txt_H1">
                AND SMM.SVC_CONFIG_MSTR_PK   LIKE    #bizMsg.xxScrItem29Txt_H1#
                </isNotNull>
-->
<!-- END 2016/03/29 M.Gotou [QC#4949, MOD] -->
<!--
                <isEqual property="bizMsg.xxModeCd_I1" compareValue="02">
                AND SMM.SVC_CONFIG_MSTR_PK   IS NOT NULL
                </isEqual>
                <isEqual property="bizMsg.xxModeCd_I1" compareValue="03">
                AND SMM.SVC_CONFIG_MSTR_PK   IS NULL
                </isEqual>
                <isNotNull property="bizMsg.serNum_H">
                AND SMM.SER_NUM              LIKE    #bizMsg.serNum_H#
                </isNotNull>
                <isNotNull property="bizMsg.mdseCd_H">
                AND SMM.MDSE_CD              LIKE    #bizMsg.mdseCd_H#
                </isNotNull>
                <isNotNull property="bizMsg.ownrAcctNum_H">
                AND SMM.OWNR_ACCT_NUM        LIKE    #bizMsg.ownrAcctNum_H#
                </isNotNull>
                <isNotNull property="bizMsg.billToAcctNum_H">
                AND SMM.BILL_TO_ACCT_NUM     LIKE    #bizMsg.billToAcctNum_H#
                </isNotNull>
                <isNotNull property="bizMsg.curLocAcctNum_H">
                AND SMM.CUR_LOC_ACCT_NUM     LIKE    #bizMsg.curLocAcctNum_H#
                </isNotNull>
                <isNotNull property="bizMsg.indBillToLocNum_H">
                AND SMM.IND_BILL_TO_LOC_NUM  LIKE    #bizMsg.indBillToLocNum_H#
                </isNotNull>
                <isNotNull property="bizMsg.indCurLocNum_H">
                AND SMM.IND_CUR_LOC_NUM      LIKE    #bizMsg.indCurLocNum_H#
                </isNotNull>
                <isNotNull property="bizMsg.shipDt_H1">
                AND SMM.SHIP_DT              &gt;=   #bizMsg.shipDt_H1#
                </isNotNull>
                <isNotNull property="bizMsg.shipDt_H2">
                AND SMM.SHIP_DT              &lt;=   #bizMsg.shipDt_H2#
                </isNotNull>
                <isNotNull property="svcMachUsgStsCd">
                AND SMM.SVC_MACH_USG_STS_CD  =       #svcMachUsgStsCd#
                </isNotNull>
                <iterate property="svcMachMstrStsCdList" var="svcMachMstrStsCd[]" open="AND SMM.SVC_MACH_MSTR_STS_CD IN (" close=")" conjunction=",">
                    #svcMachMstrStsCd[]#
                </iterate>
                <isNotNull property="svcMachMaintAvalFlg">
                AND SMM.SVC_MACH_MAINT_AVAL_FLG
                                             =       #svcMachMaintAvalFlg#
                </isNotNull>
                <isNotNull property="bizMsg.xxChkBox_HC">
                AND SMM.SVC_MACH_TP_CD       =       #svcMachTpMachine#
                </isNotNull>
                <isNotNull property="stkStsCd">
                 AND SMM.STK_STS_CD          =       #stkStsCd#
                </isNotNull>
                <isNotNull property="curLocNum_H1">
                AND SMM.CUR_LOC_NUM          LIKE    #curLocNum_H1#
                </isNotNull>
                <isNotNull property="curLocNum_H2">
                AND SMM.CUR_LOC_NUM          LIKE    #curLocNum_H2#
                </isNotNull>
                AND SMM.EZCANCELFLAG         =       '0'
-->
<!--END   2019/02/05 K.Fujimoto [QC#28404, DEL] -->

                <!-- SVC_CONFIG_MSTR -->
<!--START   2019/02/05 K.Fujimoto [QC#28404, MOD] -->
                <!-- AND SMM.GLBL_CMPY_CD         =       SCM.GLBL_CMPY_CD(+) -->
                    SMM.GLBL_CMPY_CD         =       SCM.GLBL_CMPY_CD(+)
<!--END     2019/02/05 K.Fujimoto [QC#28404, MOD] -->
                AND SMM.SVC_CONFIG_MSTR_PK   =       SCM.SVC_CONFIG_MSTR_PK(+)
<!-- START 2016/03/29 M.Gotou [QC#4949, MOD] -->
                <isNotNull property="bizMsg.xxScrItem29Txt_H3">
                AND SCM.SVC_SLN_SQ           LIKE    #bizMsg.xxScrItem29Txt_H3#
                </isNotNull>
<!-- END 2016/03/29 M.Gotou [QC#4949, MOD] -->
                <isNotNull property="bizMsg.svcSlnNm_H">
                AND SCM.SVC_SLN_NM           LIKE    #bizMsg.svcSlnNm_H#
                </isNotNull>
                AND SCM.EZCANCELFLAG(+)      =       '0'

<!-- START 2016/07/14 K.Yamada [QC#11368, MOD] -->
                AND SMM.GLBL_CMPY_CD         = DCD.GLBL_CMPY_CD(+)
                AND SMM.SVC_MACH_MSTR_PK     = DCD.SVC_MACH_MSTR_PK(+)
                AND DCD.CONTR_EFF_FROM_DT(+)   &lt;= #bizMsg.slsDt#
                AND NVL(DCD.CONTR_CLO_DT(+), DCD.CONTR_EFF_THRU_DT(+)) &gt;= #bizMsg.slsDt#
                AND DCD.DS_CONTR_DTL_STS_CD(+) NOT IN (#dsContrDtlStsCanc#)
                AND DCD.EZCANCELFLAG(+)      = '0'
                AND DCD.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD(+)
                AND DCD.DS_CONTR_PK          = DC.DS_CONTR_PK(+)
                AND DC.EZCANCELFLAG(+)       = '0'
                <isNotNull property="bizMsg.dsContrNum_H">
                AND DC.DS_CONTR_NUM         = #bizMsg.dsContrNum_H#
                </isNotNull>

                <!-- MDL_NM -->
                AND SCM.GLBL_CMPY_CD         =       MN.T_GLBL_CMPY_CD(+)
                AND SCM.MDL_ID               =       MN.T_MDL_ID(+)
<!-- START 2016/04/26 T.Tomita [QC#7531, MOD] -->
                <isNotNull property="bizMsg.t_MdlNm_H">
                AND MN.T_MDL_NM              LIKE    #bizMsg.t_MdlNm_H#
                </isNotNull>
<!-- END 2016/04/26 T.Tomita [QC#7531, MOD] -->
                AND MN.EZCANCELFLAG(+)       =       '0'

                <!-- BILL_TO_CUST(Owner) -->
<!--START   2019/02/05 K.Fujimoto [QC#28404, DEL] -->
<!--            AND SMM.GLBL_CMPY_CD         =       BTC1.GLBL_CMPY_CD(+) -->
<!--END     2019/02/05 K.Fujimoto [QC#28404, DEL] -->
                AND SMM.OWNR_LOC_NUM         =       BTC1.BILL_TO_CUST_CD(+)
<!--START   2019/02/05 K.Fujimoto [QC#28404, DEL] -->
<!--
                AND BTC1.EFF_FROM_DT(+)      &lt;=   #bizMsg.slsDt#
                AND NVL(BTC1.EFF_THRU_DT(+), #maxDate#)
                                             &gt;=   #bizMsg.slsDt#
                AND BTC1.RGTN_STS_CD(+)      =       #rgtnStsCd#
                AND BTC1.EZCANCELFLAG(+)     =       '0'
-->
<!--END     2019/02/05 K.Fujimoto [QC#28404, DEL] -->

                <!-- BILL_TO_CUST(Bill To) -->
<!--START   2019/02/05 K.Fujimoto [QC#28404, DEL] -->
<!--            AND SMM.GLBL_CMPY_CD         =       BTC2.GLBL_CMPY_CD(+) -->
<!--END     2019/02/05 K.Fujimoto [QC#28404, DEL] -->
                AND SMM.BILL_TO_LOC_NUM      =       BTC2.BILL_TO_CUST_CD(+)
<!--START   2019/02/05 K.Fujimoto [QC#28404, DEL] -->
<!--
                AND BTC2.EFF_FROM_DT(+)      &lt;=   #bizMsg.slsDt#
                AND NVL(BTC2.EFF_THRU_DT(+), #maxDate#)
                                             &gt;=   #bizMsg.slsDt#
                AND BTC2.RGTN_STS_CD(+)      =       #rgtnStsCd#
                AND BTC2.EZCANCELFLAG(+)     =       '0'
-->
<!--END     2019/02/05 K.Fujimoto [QC#28404, DEL] -->

                <!-- SHIP_TO_CUST(Current Location) -->
                AND SMM.GLBL_CMPY_CD         =       STC.GLBL_CMPY_CD(+)
                AND SMM.CUR_LOC_NUM          =       STC.SHIP_TO_CUST_CD(+)
                AND STC.EFF_FROM_DT(+)       &lt;=   #bizMsg.slsDt#
                AND NVL(STC.EFF_THRU_DT(+), #maxDate#)
                                             &gt;=   #bizMsg.slsDt#
                AND STC.RGTN_STS_CD(+)       =       #rgtnStsCd#
                AND STC.EZCANCELFLAG(+)      =       '0'

                <!-- SELL_TO_CUST(Owner) -->
<!--START   2019/02/05 K.Fujimoto [QC#28404, DEL] -->
<!--            AND SMM.GLBL_CMPY_CD         =       SEL1.GLBL_CMPY_CD(+) -->
<!--END     2019/02/05 K.Fujimoto [QC#28404, DEL] -->
                AND SMM.OWNR_ACCT_NUM        =       SEL1.SELL_TO_CUST_CD(+)
<!--START   2019/02/05 K.Fujimoto [QC#28404, DEL] -->
<!--
                AND SEL1.EFF_FROM_DT(+)      &lt;=   #bizMsg.slsDt#
                AND NVL(SEL1.EFF_THRU_DT(+), #maxDate#)
                                             &gt;=   #bizMsg.slsDt#
                AND SEL1.RGTN_STS_CD(+)      =       #rgtnStsCd#
                AND SEL1.EZCANCELFLAG(+)     =       '0'
-->
<!--END     2019/02/05 K.Fujimoto [QC#28404, DEL] -->

                <!-- SELL_TO_CUST(Bill To) -->
<!--START   2019/02/05 K.Fujimoto [QC#28404, DEL] -->
<!--            AND SMM.GLBL_CMPY_CD         =       SEL2.GLBL_CMPY_CD(+) -->
<!--END     2019/02/05 K.Fujimoto [QC#28404, DEL] -->
                AND SMM.BILL_TO_ACCT_NUM     =       SEL2.SELL_TO_CUST_CD(+)
<!--START   2019/02/05 K.Fujimoto [QC#28404, DEL] -->
<!--
                AND SEL2.EFF_FROM_DT(+)      &lt;=   #bizMsg.slsDt#
                AND NVL(SEL2.EFF_THRU_DT(+), #maxDate#)
                                             &gt;=   #bizMsg.slsDt#
                AND SEL2.RGTN_STS_CD(+)      =       #rgtnStsCd#
                AND SEL2.EZCANCELFLAG(+)     =       '0'
-->
<!--END     2019/02/05 K.Fujimoto [QC#28404, DEL] -->

                <!-- SELL_TO_CUST(Current Location) -->
<!--START   2019/02/05 K.Fujimoto [QC#28404, DEL] -->
<!--            AND SMM.GLBL_CMPY_CD         =       SEL3.GLBL_CMPY_CD(+) -->
<!--END     2019/02/05 K.Fujimoto [QC#28404, DEL] -->
                AND SMM.CUR_LOC_ACCT_NUM     =       SEL3.SELL_TO_CUST_CD(+)
<!--START   2019/02/05 K.Fujimoto [QC#28404, DEL] -->
<!--
                AND SEL3.EFF_FROM_DT(+)      &lt;=   #bizMsg.slsDt#
                AND NVL(SEL3.EFF_THRU_DT(+), #maxDate#)
                                             &gt;=   #bizMsg.slsDt#
                AND SEL3.RGTN_STS_CD(+)      =       #rgtnStsCd#
                AND SEL3.EZCANCELFLAG(+)     =       '0'
-->
<!--END     2019/02/05 K.Fujimoto [QC#28404, DEL] -->

                <!-- SVC_MACH_MSTR_STS -->
                AND SMM.GLBL_CMPY_CD         =       SMMS.GLBL_CMPY_CD(+)
                AND SMM.SVC_MACH_MSTR_STS_CD =       SMMS.SVC_MACH_MSTR_STS_CD(+)
                AND SMMS.EZCANCELFLAG(+)     =       '0'

                <!-- SVC_MACH_USG_STS -->
                AND SMM.GLBL_CMPY_CD         =       SMUS.GLBL_CMPY_CD(+)
                AND SMM.SVC_MACH_USG_STS_CD  =       SMUS.SVC_MACH_USG_STS_CD(+)
                AND SMUS.EZCANCELFLAG(+)     =       '0'

                <!-- STK_STS -->
                AND SMM.GLBL_CMPY_CD         =       SS.GLBL_CMPY_CD(+)
                AND SMM.STK_STS_CD           =       SS.STK_STS_CD(+)
                AND SS.EZCANCELFLAG(+)       =       '0'

                <!-- MDSE -->
                AND SMM.GLBL_CMPY_CD         =       MDS.GLBL_CMPY_CD(+)
                AND SMM.MDSE_CD              =       MDS.MDSE_CD(+)
                AND MDS.EZCANCELFLAG(+)      =       '0'

<!-- START 2017/07/26 S.Takami [QC#20004, ADD] Start-->
                <isNotNull property = "configIdList">
                    <iterate property="configIdList" var="configIdList[]" open="AND SMM.SVC_CONFIG_MSTR_PK NOT IN (" close=")" conjunction=",">
                        #configIdList[]#
                    </iterate>
                 </isNotNull>
<!-- START 2017/07/26 T.Takami [QC#20004, ADD] End-->

            ORDER BY
                SMM.SVC_CONFIG_MSTR_PK
               ,SMM.SVC_MACH_TP_CD
               ,SMM.SVC_MACH_SQ_NUM
               ,SMM.SER_NUM
               ,SMM.SVC_MACH_MSTR_PK
       ) A
       WHERE
               RANK                       =       1
           AND ROWNUM                        &lt;=   #rowNum#
<!-- QC#15410 add Start -->
        GROUP BY 
            SVC_CONFIG_MSTR_PK
           ,SER_NUM
           ,SVC_MACH_MSTR_PK
           ,MDSE_CD
           ,MDSE_DESC_SHORT_TXT
           ,T_MDL_NM
           ,SHIP_DT
           ,SVC_MACH_USG_STS_DESC_TXT
           ,SVC_MACH_MSTR_STS_DESC_TXT
           ,SVC_MACH_MAINT_AVAL_FLG
           ,STK_STS_DESC_TXT
           ,SVC_SLN_SQ
           ,SVC_SLN_NM
           ,OWNR_ACCT_NUM
           ,DS_ACCT_NM_A1
           ,BILL_TO_ACCT_NUM
           ,DS_ACCT_NM_A2
           ,IND_BILL_TO_LOC_NUM
           ,XX_COMN_SCR_COL_VAL_TXT_A2
           ,CUR_LOC_ACCT_NUM
           ,DS_ACCT_NM
           ,IND_CUR_LOC_NUM
           ,CUR_LOC_NUM
           ,XX_COMN_SCR_COL_VAL_TXT_A3
           ,MDL_ID
           ,LOC_NM
           ,SVC_MACH_USG_STS_CD
           ,SVC_MACH_MSTR_STS_CD
           ,SVC_MACH_TP_CD
        ORDER BY
            SVC_CONFIG_MSTR_PK
           ,SVC_MACH_TP_CD
           ,SER_NUM
           ,SVC_MACH_MSTR_PK
<!-- QC#15410 add End -->
    </statement>
    <resultMap id="result.getSearchData"      class="NSAL1240_BSMsg">
        <result property="svcConfigMstrPk_B"        column="SVC_CONFIG_MSTR_PK"          javaType="EZDSBigDecimalItem" />
        <result property="serNum_B"                 column="SER_NUM"                     javaType="EZDSStringItem" />
        <result property="svcMachMstrPk_B"          column="SVC_MACH_MSTR_PK"            javaType="EZDSBigDecimalItem" />
        <result property="mdseCd_B"                 column="MDSE_CD"                     javaType="EZDSStringItem" />
        <result property="mdseDescShortTxt_B"       column="MDSE_DESC_SHORT_TXT"         javaType="EZDSStringItem" />
        <result property="t_MdlNm_B"                column="T_MDL_NM"                    javaType="EZDSStringItem" />
        <result property="shipDt_B"                 column="SHIP_DT"                     javaType="EZDSStringItem" />
        <result property="svcMachUsgStsDescTxt_B"   column="SVC_MACH_USG_STS_DESC_TXT"   javaType="EZDSStringItem" />
        <result property="svcMachMstrStsDescTxt_B"  column="SVC_MACH_MSTR_STS_DESC_TXT"  javaType="EZDSStringItem" />
        <result property="svcMachMaintAvalFlg_B"    column="SVC_MACH_MAINT_AVAL_FLG"     javaType="EZDSStringItem" />
        <result property="stkStsDescTxt_B"          column="STK_STS_DESC_TXT"            javaType="EZDSStringItem" />
        <result property="svcSlnSq_B"               column="SVC_SLN_SQ"                  javaType="EZDSBigDecimalItem" />
        <result property="svcSlnNm_B"               column="SVC_SLN_NM"                  javaType="EZDSStringItem" />
        <result property="dsContrNum_B"             column="DS_CONTR_NUM"                javaType="EZDSStringItem" />
        <result property="ownrAcctNum_B"            column="OWNR_ACCT_NUM"               javaType="EZDSStringItem" />
        <result property="dsAcctNm_B1"              column="DS_ACCT_NM_A1"               javaType="EZDSStringItem" />
        <result property="billToAcctNum_B"          column="BILL_TO_ACCT_NUM"            javaType="EZDSStringItem" />
        <result property="dsAcctNm_B2"              column="DS_ACCT_NM_A2"               javaType="EZDSStringItem" />
        <result property="indBillToLocNum_B"        column="IND_BILL_TO_LOC_NUM"         javaType="EZDSStringItem" />
        <result property="xxComnScrColValTxt_B2"    column="XX_COMN_SCR_COL_VAL_TXT_A2"  javaType="EZDSStringItem" />
        <result property="curLocAcctNum_B"          column="CUR_LOC_ACCT_NUM"            javaType="EZDSStringItem" />
        <result property="dsAcctNm_B3"              column="DS_ACCT_NM"                  javaType="EZDSStringItem" />
        <result property="indCurLocNum_B"           column="IND_CUR_LOC_NUM"             javaType="EZDSStringItem" />
        <result property="curLocNum_B"              column="CUR_LOC_NUM"                 javaType="EZDSStringItem" />
        <result property="xxComnScrColValTxt_B3"    column="XX_COMN_SCR_COL_VAL_TXT_A3"  javaType="EZDSStringItem" />
        <result property="mdlId_B"                  column="MDL_ID"                      javaType="EZDSBigDecimalItem" />
        <result property="dsContrPk_B"              column="DS_CONTR_PK"                 javaType="EZDSBigDecimalItem" />
        <result property="locNm_B"                  column="LOC_NM"                      javaType="EZDSStringItem" />
        <result property="svcMachUsgStsCd_B"        column="SVC_MACH_USG_STS_CD"         javaType="EZDSStringItem" />
        <result property="svcMachMstrStsCd_B"       column="SVC_MACH_MSTR_STS_CD"        javaType="EZDSStringItem" />
        <result property="svcMachTpCd_B"            column="SVC_MACH_TP_CD"              javaType="EZDSStringItem" />
    </resultMap>
</sqlMap>
