<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NSAB057001">
    <statement id="getTargetDataList" parameterClass="Map" resultClass="Map">
        SELECT
             F.SVC_PHYS_MTR_READ_PK
            ,F.EST_FLG
            ,G.MTR_CNTR_ID
            ,G.ACTV_FLG
        FROM
             DS_CONTR           A
            ,DS_CONTR_STS_V     B
            ,DS_CONTR_DTL       C
            ,DS_CONTR_DTL_STS_V D
            ,SVC_MACH_MSTR      E
            ,SVC_PHYS_MTR_READ  F
            ,MTR_LB             G
        WHERE
            A.GLBL_CMPY_CD                = #glblCmpyCd#
        AND A.EZCANCELFLAG                = '0'
        AND A.DS_CONTR_EDI_CD             = #dsContrEdiCdCusa#
        AND A.CONTR_VRSN_EFF_FROM_DT  &lt;= #slsDt#
        AND A.CONTR_VRSN_EFF_THRU_DT  &gt;= #slsDt#
        AND A.GLBL_CMPY_CD                = B.GLBL_CMPY_CD
        AND A.DS_CONTR_PK                 = B.DS_CONTR_PK
        AND B.EZCANCELFLAG                = '0'
        <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCd[]" open="AND B.DS_CONTR_CTRL_STS_CD NOT IN (" close=")" conjunction=",">
            #dsContrCtrlStsCd[]#
        </iterate>
        AND A.GLBL_CMPY_CD                = C.GLBL_CMPY_CD
        AND A.DS_CONTR_PK                 = C.DS_CONTR_PK
        AND C.EZCANCELFLAG                = '0'
        AND C.CONTR_EFF_FROM_DT       &lt;= #slsDt#
        AND C.CONTR_EFF_THRU_DT       &gt;= #slsDt#
        AND C.GLBL_CMPY_CD                = D.GLBL_CMPY_CD
        AND C.DS_CONTR_DTL_PK             = D.DS_CONTR_DTL_PK
        AND D.EZCANCELFLAG                = '0'
        <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCd[]" open="AND D.DS_CONTR_CTRL_STS_CD NOT IN (" close=")" conjunction=",">
            #dsContrCtrlStsCd[]#
        </iterate>
        AND C.GLBL_CMPY_CD                = E.GLBL_CMPY_CD
        AND C.SVC_MACH_MSTR_PK            = E.SVC_MACH_MSTR_PK
        AND E.EZCANCELFLAG                = '0'
        AND E.EFF_FROM_DT             &lt;= #slsDt#
        AND E.SVC_MACH_MSTR_STS_CD &lt;&gt; #svcMachMstrStsCdTrmn#
        AND E.GLBL_CMPY_CD                = F.GLBL_CMPY_CD
        AND E.SVC_MACH_MSTR_PK            = F.SVC_MACH_MSTR_PK
        AND F.EZCANCELFLAG                = '0'
        AND F.ROSS_BAT_PROC_STS_CD        = #notProcessed#
        AND F.ROSS_SEND_TRGT_CD           = #notApplicableByTransactionStatus#
        AND F.VLD_MTR_FLG                 = 'Y'
        AND F.GLBL_CMPY_CD                = G.GLBL_CMPY_CD
        AND F.MTR_LB_CD                   = G.MTR_LB_CD
        AND G.EZCANCELFLAG                = '0'
        ORDER BY
             A.DS_CONTR_PK
            ,C.DS_CONTR_DTL_PK
            ,F.MTR_READ_DT
            ,F.SVC_PHYS_MTR_READ_GRP_SQ
            ,G.MTR_LB_SORT_NUM
    </statement>
</sqlMap>