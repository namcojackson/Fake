<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSBL0280Query">

    <typeAlias alias="NSBL0280_ASMsg"    type="business.blap.NSBL0280.NSBL0280_ASMsg"/>
    <typeAlias alias="NSBL0280_BSMsg"    type="business.blap.NSBL0280.NSBL0280_BSMsg"/>
    <statement id="getSearchResourceData"  parameterClass="Map"  resultMap="result.getSearchResourceData">
    SELECT
         SKILL.SVC_SKILL_TP_CD
       , SKILL.SVC_SKILL_TP_DESC_TXT
       , SKILL.SVC_SKILL_NUM
       , SKILL.SVC_SKILL_DESC_TXT
       , SKILL.SVC_SKILL_LVL_GRP_CD
       , SKILL.SVC_SKILL_LVL_PK
       , SKILL.EFF_FROM_DT
       , SKILL.EFF_THRU_DT
       , SKILL.TECH_TNG_HIST_PK
       , SKILL.EZUPTIME
       , SKILL.EZUPTIMEZONE
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
       , SKILL.XX_REC_HIST_CRAT_TS
       , SKILL.XX_REC_HIST_CRAT_BY_NM
       , SKILL.XX_REC_HIST_UPD_TS
       , SKILL.XX_REC_HIST_UPD_BY_NM
       , SKILL.XX_REC_HIST_TBL_NM
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
    FROM
    (
       SELECT
             SST.SVC_SKILL_TP_CD
           , SST.SVC_SKILL_TP_DESC_TXT
           , SS.SVC_SKILL_DESC_TXT
           , SSL.SVC_SKILL_LVL_GRP_CD
           , SSL.SVC_SKILL_LVL_PK
           , TTH.SVC_SKILL_NUM
           , TTH.EFF_FROM_DT
           , TTH.EFF_THRU_DT
           , TTH.TECH_TNG_HIST_PK
           , TTH.EZUPTIME
           , TTH.EZUPTIMEZONE
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
           , TTH.EZINTIME       AS XX_REC_HIST_CRAT_TS
           , TTH.EZINUSERID     AS XX_REC_HIST_CRAT_BY_NM
           , TTH.EZUPTIME       AS XX_REC_HIST_UPD_TS
           , TTH.EZUPUSERID     AS XX_REC_HIST_UPD_BY_NM
           , TTH.EZTABLEID      AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
       FROM
             TECH_TNG_HIST    TTH
             ,SVC_SKILL       SS
             ,SVC_SKILL_TP    SST
             ,SVC_SKILL_LVL   SSL
       WHERE
           TTH.GLBL_CMPY_CD                                  =   #glblCmpyCd#
           <isNotNull property="svcSkillResrcTpCd">
           AND TTH.SVC_SKILL_RESRC_TP_CD                     =   #svcSkillResrcTpCd#
           </isNotNull>
           AND TTH.TECH_CD                                   =   #techCd#
           AND TTH.EFF_FROM_DT                           &lt;=   #effDt#
           AND NVL(TTH.EFF_THRU_DT, #effDt#)             &gt;=   #effDt#
           AND TTH.EZCANCELFLAG                              =   '0'
           AND TTH.GLBL_CMPY_CD                              =   SS.GLBL_CMPY_CD
           AND TTH.SVC_SKILL_NUM                             =   SS.SVC_SKILL_NUM
           AND SS.EFF_FROM_DT                            &lt;=   #effDt#
           AND NVL(SS.EFF_THRU_DT, #effDt#)              &gt;=   #effDt#
           AND SS.EZCANCELFLAG                               =   '0'
           AND SS.GLBL_CMPY_CD                               =   SST.GLBL_CMPY_CD
           AND SS.SVC_SKILL_TP_CD                            =   SST.SVC_SKILL_TP_CD
           AND SST.EZCANCELFLAG                              =   '0'
           AND TTH.GLBL_CMPY_CD                              =   SSL.GLBL_CMPY_CD
           AND TTH.SVC_SKILL_LVL_PK                          =   SSL.SVC_SKILL_LVL_PK
           AND SSL.EFF_FROM_DT                           &lt;=  #effDt#
           AND NVL(SSL.EFF_THRU_DT, #effDt#)             &gt;=  #effDt#
           AND SSL.EZCANCELFLAG                              =   '0'
           ORDER BY
               SST.SVC_SKILL_TP_SORT_NUM ASC
             , SS.SVC_SKILL_DESC_TXT     ASC
       ) SKILL
    WHERE
      ROWNUM                            &lt;=   #limitCount#
    </statement>

    <resultMap id="result.getSearchResourceData"      class="NSBL0280_ASMsg">
        <result property="svcSkillTpDescTxt_A"   column="SVC_SKILL_TP_DESC_TXT"     javaType="EZDSStringItem"/>
        <result property="svcSkillTpCd_A"        column="SVC_SKILL_TP_CD"           javaType="EZDSStringItem"/>
        <result property="svcSkillNum_A"         column="SVC_SKILL_NUM"             javaType="EZDSStringItem"/>
        <result property="svcSkillDescTxt_A"     column="SVC_SKILL_DESC_TXT"        javaType="EZDSStringItem"/>
        <result property="svcSkillLvlPk_AS"      column="SVC_SKILL_LVL_PK"          javaType="EZDSBigDecimalItem"/>
        <result property="svcSkillLvlGrpCd_A"    column="SVC_SKILL_LVL_GRP_CD"      javaType="EZDSStringItem"/>
        <result property="effFromDt_A"           column="EFF_FROM_DT"               javaType="EZDSDateItem"/>
        <result property="effThruDt_A"           column="EFF_THRU_DT"               javaType="EZDSDateItem"/>
        <result property="techTngHistPk_A"       column="TECH_TNG_HIST_PK"          javaType="EZDSBigDecimalItem"/>
        <result property="ezUpTime_A"            column="EZUPTIME"                  javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_A"        column="EZUPTIMEZONE"              javaType="EZDSStringItem"/>
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_A"     column="XX_REC_HIST_CRAT_TS"       javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_A"   column="XX_REC_HIST_CRAT_BY_NM"    javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_A"      column="XX_REC_HIST_UPD_TS"        javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_A"    column="XX_REC_HIST_UPD_BY_NM"     javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_A"      column="XX_REC_HIST_TBL_NM"        javaType="EZDSStringItem"/>
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
    </resultMap>

    <statement id="getSearchSkillData" parameterClass="Map" resultMap="result.getSearchSkillData">
    SELECT
         SKILL.TECH_CD
       , SKILL.FULL_NM
       , SKILL.SVC_SKILL_RESRC_TP_CD
       , SKILL.SVC_SKILL_LVL_GRP_CD
       , SKILL.SVC_SKILL_LVL_PK
       , SKILL.EFF_FROM_DT
       , SKILL.EFF_THRU_DT
       , SKILL.TECH_TNG_HIST_PK
       , SKILL.EZUPTIME
       , SKILL.EZUPTIMEZONE
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
       , SKILL.XX_REC_HIST_CRAT_TS
       , SKILL.XX_REC_HIST_CRAT_BY_NM
       , SKILL.XX_REC_HIST_UPD_TS
       , SKILL.XX_REC_HIST_UPD_BY_NM
       , SKILL.XX_REC_HIST_TBL_NM
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
    FROM
    (
       SELECT
             TTH.TECH_CD
           , SP.PSN_LAST_NM||','||SP.PSN_FIRST_NM   AS FULL_NM
           , SSR.SVC_SKILL_RESRC_TP_CD
           , SSL.SVC_SKILL_LVL_GRP_CD
           , SSL.SVC_SKILL_LVL_PK
           , TTH.EFF_FROM_DT
           , TTH.EFF_THRU_DT
           , TTH.TECH_TNG_HIST_PK
           , TTH.EZUPTIME
           , TTH.EZUPTIMEZONE
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
           , TTH.EZINTIME       AS XX_REC_HIST_CRAT_TS
           , TTH.EZINUSERID     AS XX_REC_HIST_CRAT_BY_NM
           , TTH.EZUPTIME       AS XX_REC_HIST_UPD_TS
           , TTH.EZUPUSERID     AS XX_REC_HIST_UPD_BY_NM
           , TTH.EZTABLEID      AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
       FROM
              SVC_SKILL          SS
             ,SVC_SKILL_TP       SST
             ,TECH_TNG_HIST      TTH
             ,SVC_SKILL_LVL      SSL
             ,S21_PSN            SP
             ,SVC_SKILL_RESRC_TP SSR

       WHERE
           SS.GLBL_CMPY_CD                                     =  #glblCmpyCd#
           AND SS.SVC_SKILL_DESC_TXT                           =  #svcSkillDescTxt#
           AND SS.EFF_FROM_DT                              &lt;=  #effDt#
           AND NVL(SS.EFF_THRU_DT, #effDt#)                &gt;=  #effDt#
           AND SS.EZCANCELFLAG                                 =  '0'
           AND SS.GLBL_CMPY_CD                                 = SST.GLBL_CMPY_CD
           AND SS.SVC_SKILL_TP_CD                              = SST.SVC_SKILL_TP_CD
           <isNotNull property="svcSkillTpCd">
           AND SST.SVC_SKILL_TP_CD                             = #svcSkillTpCd#
           </isNotNull>
           AND SST.EZCANCELFLAG                                = '0'
           AND SS.GLBL_CMPY_CD                                 = TTH.GLBL_CMPY_CD
           AND SS.SVC_SKILL_NUM                                = TTH.SVC_SKILL_NUM
           AND TTH.EZCANCELFLAG                                = '0'
           AND TTH.GLBL_CMPY_CD                                = SSL.GLBL_CMPY_CD
           AND TTH.SVC_SKILL_LVL_PK                            = SSL.SVC_SKILL_LVL_PK
           AND SSL.EFF_FROM_DT                             &lt;=  #effDt#
           AND NVL(SSL.EFF_THRU_DT, #effDt#)               &gt;=  #effDt#
           AND SSL.EZCANCELFLAG                                = '0'
           AND TTH.GLBL_CMPY_CD                                = SP.GLBL_CMPY_CD
           AND TTH.TECH_CD                                     = SP.PSN_CD
           AND SP.EFF_FROM_DT                              &lt;= #effDt#
           AND NVL(SP.EFF_THRU_DT, #effDt#)                &gt;= #effDt#
           AND SP.DEL_FLG                                      = #delFlg#
           AND SP.EZCANCELFLAG                                 = '0'
           AND TTH.GLBL_CMPY_CD                                = SSR.GLBL_CMPY_CD
           AND TTH.SVC_SKILL_RESRC_TP_CD                       = SSR.SVC_SKILL_RESRC_TP_CD
           AND SSR.EZCANCELFLAG                                = '0'
           ORDER BY
               TTH.TECH_CD ASC

       ) SKILL
    WHERE
      ROWNUM                            &lt;=   #limitCount#
    </statement>

    <resultMap id="result.getSearchSkillData"      class="NSBL0280_BSMsg">
        <result property="techCd_B"             column="TECH_CD"                   javaType="EZDSStringItem"/>
        <result property="fullPsnNm_B"          column="FULL_NM"                   javaType="EZDSStringItem"/>
        <result property="svcSkillResrcTpCd_BS" column="SVC_SKILL_RESRC_TP_CD"     javaType="EZDSStringItem"/>
        <result property="svcSkillLvlPk_BS"     column="SVC_SKILL_LVL_PK"          javaType="EZDSBigDecimalItem"/>
        <result property="svcSkillLvlGrpCd_B"   column="SVC_SKILL_LVL_GRP_CD"      javaType="EZDSStringItem"/>
        <result property="effFromDt_B"          column="EFF_FROM_DT"               javaType="EZDSDateItem"/>
        <result property="effThruDt_B"          column="EFF_THRU_DT"               javaType="EZDSDateItem"/>
        <result property="techTngHistPk_B"      column="TECH_TNG_HIST_PK"          javaType="EZDSBigDecimalItem"/>
        <result property="ezUpTime_B"           column="EZUPTIME"                  javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_B"       column="EZUPTIMEZONE"              javaType="EZDSStringItem"/>
<!-- START 2016/12/05 N.Arai [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_B"     column="XX_REC_HIST_CRAT_TS"       javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_B"   column="XX_REC_HIST_CRAT_BY_NM"    javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_B"      column="XX_REC_HIST_UPD_TS"        javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_B"    column="XX_REC_HIST_UPD_BY_NM"     javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_B"      column="XX_REC_HIST_TBL_NM"        javaType="EZDSStringItem"/>
<!-- END 2016/12/05 N.Arai [QC#14204, ADD] -->
    </resultMap>

    <statement id="getSearchSvcSkill"  parameterClass="Map"  resultClass="Map">
    SELECT
         SS.GLBL_CMPY_CD
        , SS.EZCANCELFLAG
        , SS.SVC_SKILL_NUM
        , SS.SVC_SKILL_DESC_TXT
        , SST.SVC_SKILL_TP_DESC_TXT
        , SST.SVC_SKILL_LVL_GRP_CD
        , SST.SVC_SKILL_TP_CD

    FROM
          SVC_SKILL          SS
        , SVC_SKILL_TP       SST

    WHERE
           SS.GLBL_CMPY_CD                                 = #glblCmpyCd#
           AND SS.SVC_SKILL_DESC_TXT                       = #svcSkillTxt#
           AND SS.EFF_FROM_DT                          &lt;= #effDt#
           AND NVL(SS.EFF_THRU_DT, #effDt#)            &gt;= #effDt#
           AND SS.EZCANCELFLAG                             = '0'
           AND SS.GLBL_CMPY_CD                             = SST .GLBL_CMPY_CD
           AND SS.SVC_SKILL_TP_CD                          = SST.SVC_SKILL_TP_CD
           AND SST.EZCANCELFLAG                            = '0'
    </statement>
    

    <!-- START 2016/12/14 K.Kojima [QC#15653,ADD] -->
    <statement id="getTechMstr" parameterClass="Map" resultClass="String">
        SELECT
            TM.TECH_TOC_CD
        FROM
             TECH_MSTR TM
        WHERE
                TM.GLBL_CMPY_CD                   = #glblCmpyCd#
            AND TM.TECH_TOC_CD                    = #techTocCd#
            AND TM.EZCANCELFLAG                   = '0'
            AND EXISTS(
                SELECT
                    1
                FROM
                     ORG_FUNC_ASG     OFA
                    ,TOC              T
                    ,ORG_FUNC_ROLE_TP OFRT
                WHERE
                        OFA.GLBL_CMPY_CD                  = TM.GLBL_CMPY_CD
                    AND OFA.PSN_CD                        = TM.TECH_TOC_CD
                    AND OFA.EFF_FROM_DT               &lt;= #slsDt#
                    AND NVL(OFA.EFF_THRU_DT, #maxDt#) &gt;= #slsDt#
                    AND OFA.GLBL_CMPY_CD                  = T.GLBL_CMPY_CD
                    AND OFA.TOC_CD                        = T.TOC_CD
                    AND T.GLBL_CMPY_CD                    = OFRT.GLBL_CMPY_CD
                    AND T.ORG_FUNC_ROLE_TP_CD             = OFRT.ORG_FUNC_ROLE_TP_CD
                    AND OFRT.TECH_MSTR_REQ_FLG            = #flgY#
                    AND OFRT.ACTV_FLG                     = #flgY#
                    AND OFA.EZCANCELFLAG                  = '0'
                    AND T.EZCANCELFLAG                    = '0'
                    AND OFRT.EZCANCELFLAG                 = '0'
            )
    </statement>
    <!-- END 2016/12/14 K.Kojima [QC#15653,ADD] -->
</sqlMap>
