<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL0690Query">
    <typeAlias alias="NSAL0690_ACMsg" type="business.blap.NSAL0690.NSAL0690_ACMsg"/>
    <typeAlias alias="NSAL0690_BCMsg" type="business.blap.NSAL0690.NSAL0690_BCMsg"/>

    <statement id="getContrHdrInfo" parameterClass="Map" resultMap="result.getContrHdrInfo">
--Aggregate
        SELECT
             HDR.DS_CONTR_PK                    DS_CONTR_PK
            ,HDR.DS_CONTR_CATG_CD               DS_CONTR_CATG_CD
            ,HDR.DS_CONTR_NUM                   DS_CONTR_NUM
            <!-- START 2017/10/27 K.Kojima [QC#21742,MOD] -->
            <!-- ,STS.DS_CONTR_CTRL_STS_CD           DS_CONTR_CTRL_STS_CD -->
            ,STS.CONTR_RNW_AVAL_FLG             CONTR_RNW_AVAL_FLG
            <!-- END 2017/10/27 K.Kojima [QC#21742,MOD] -->
            ,TRIM(HDR.DS_CONTR_CATG_CD
                || '-' || HDR.DS_CONTR_NUM)  AS XX_SCR_ITEM_34_TXT
            ,HDR.CONTR_VRSN_EFF_FROM_DT         CONTR_VRSN_EFF_FROM_DT
            ,HDR.CONTR_VRSN_EFF_THRU_DT         CONTR_VRSN_EFF_THRU_DT
            ,STC.DS_ACCT_NM                     DS_ACCT_NM
            <!-- START 2018/05/22 K.Kitachi [QC#26070, MOD] -->
            ,SUM(PEF.BASE_PRC_DEAL_AMT)         BASE_PRC_DEAL_AMT
            ,SUM(PEF.BASE_PRC_DEAL_AMT)         NEW_PRC_DEAL_AMT
            <!-- END 2018/05/22 K.Kitachi [QC#26070, MOD] -->
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            ,NULL                            AS RNW_PRC_METH_CD_BASE
            ,MAX(
                CASE
                    WHEN
                        DTL.DS_CONTR_DTL_TP_CD = #dsContrDtlTpAgg#
                    THEN
                        CASE
                            WHEN ES4.RNW_PRC_METH_CD IS NOT NULL AND RTP4.RNW_USG_FLG = 'Y'
                                THEN ES4.RNW_PRC_METH_CD
                            WHEN ES2.RNW_PRC_METH_CD IS NOT NULL AND RTP2.RNW_USG_FLG = 'Y'
                                THEN ES2.RNW_PRC_METH_CD
                            WHEN ES1.RNW_PRC_METH_CD IS NOT NULL AND RTP1.RNW_USG_FLG = 'Y'
                                THEN ES1.RNW_PRC_METH_CD
                            ELSE
                                NULL
                            END
                    ELSE
                        NULL
                    END
             )                               AS RNW_PRC_METH_CD_USG
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
        FROM
             DS_CONTR               HDR
            ,SELL_TO_CUST           STC
            ,DS_CONTR_DTL           DTL
            ,DS_CONTR_STS_V         STS
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            ,DS_CONTR_RNW_ESCL      ES1
            ,DS_CONTR_RNW_ESCL      ES2
            ,DS_CONTR_RNW_ESCL      ES4
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
            <!-- START 2018/03/30 K.Kojima [QC#24925, ADD] -->
            ,CONTR_AUTO_RNW_TP      RTP1
            ,CONTR_AUTO_RNW_TP      RTP2
            ,CONTR_AUTO_RNW_TP      RTP4
            <!-- END 2018/03/30 K.Kojima [QC#24925, ADD] -->
            <!-- START 2018/05/22 K.Kitachi [QC#26070, ADD] -->
            ,(
                SELECT
                     A.DS_CONTR_DTL_PK
                    ,B.BASE_PRC_DEAL_AMT
                    ,ROW_NUMBER() OVER(PARTITION BY A.DS_CONTR_DTL_PK ORDER BY B.CONTR_PRC_EFF_THRU_DT DESC) RNUM
                FROM
                     DS_CONTR_DTL     A
                    ,DS_CONTR_PRC_EFF B
                WHERE
                        A.GLBL_CMPY_CD    = #glblCmpyCd#
                    <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND A.DS_CONTR_PK IN (" close=")" conjunction=",">
                        #dsContrPk[]#
                    </iterate>
                    AND A.EZCANCELFLAG    = '0'
                    AND A.GLBL_CMPY_CD    = B.GLBL_CMPY_CD
                    AND A.DS_CONTR_DTL_PK = B.DS_CONTR_DTL_PK
                    AND B.BASE_CHRG_FLG   = 'Y'
                    AND B.EZCANCELFLAG    = '0'
            ) PEF
            <!-- END 2018/05/22 K.Kitachi [QC#26070, ADD] -->
        WHERE
                HDR.GLBL_CMPY_CD        = #glblCmpyCd#
            <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND HDR.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND HDR.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = STC.GLBL_CMPY_CD
            AND HDR.DS_ACCT_NUM         = STC.SELL_TO_CUST_CD
            AND HDR.DS_CONTR_CATG_CD    = #dsContrCatgAgg#
            AND STC.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = DTL.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK         = DTL.DS_CONTR_PK
            AND DTL.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = STS.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK         = STS.DS_CONTR_PK
            AND STS.EZCANCELFLAG        = '0'
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            AND DTL.GLBL_CMPY_CD                = ES4.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES4.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK             = ES4.DS_CONTR_DTL_PK(+)
            AND ES4.DS_CONTR_BASE_USG_NM(+)     = #usgNm#
            AND ES4.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum3#
            AND ES4.EZCANCELFLAG(+)             = '0'
            AND DTL.GLBL_CMPY_CD                = ES2.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES2.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK             = ES2.DS_CONTR_DTL_PK(+)
            AND ES2.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum2#
            AND ES2.EZCANCELFLAG(+)             = '0'
            AND DTL.GLBL_CMPY_CD                = ES1.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES1.DS_CONTR_PK(+)
            AND ES1.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum1#
            AND ES1.EZCANCELFLAG(+)             = '0'
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
            <!-- START 2018/03/30 K.Kojima [QC#24925, ADD] -->
            AND ES1.GLBL_CMPY_CD                = RTP1.GLBL_CMPY_CD(+)
            AND ES1.CONTR_AUTO_RNW_TP_CD        = RTP1.CONTR_AUTO_RNW_TP_CD(+)
            AND ES1.EZCANCELFLAG(+)             = '0'
            AND ES2.GLBL_CMPY_CD                = RTP2.GLBL_CMPY_CD(+)
            AND ES2.CONTR_AUTO_RNW_TP_CD        = RTP2.CONTR_AUTO_RNW_TP_CD(+)
            AND ES2.EZCANCELFLAG(+)             = '0'
            AND ES4.GLBL_CMPY_CD                = RTP4.GLBL_CMPY_CD(+)
            AND ES4.CONTR_AUTO_RNW_TP_CD        = RTP4.CONTR_AUTO_RNW_TP_CD(+)
            AND ES4.EZCANCELFLAG(+)             = '0'
            <!-- END 2018/03/30 K.Kojima [QC#24925, ADD] -->
            <!-- START 2018/05/22 K.Kitachi [QC#26070, ADD] -->
            AND DTL.DS_CONTR_DTL_PK             = PEF.DS_CONTR_DTL_PK(+)
            AND PEF.RNUM(+)                     = 1
            <!-- END 2018/05/22 K.Kitachi [QC#26070, ADD] -->
        GROUP BY
             HDR.DS_CONTR_PK
            ,HDR.DS_CONTR_CATG_CD
            ,HDR.DS_CONTR_NUM
            <!-- START 2017/10/27 K.Kojima [QC#21742,MOD] -->
            <!-- ,STS.DS_CONTR_CTRL_STS_CD -->
            ,STS.CONTR_RNW_AVAL_FLG
            <!-- END 2017/10/27 K.Kojima [QC#21742,MOD] -->
            ,HDR.CONTR_VRSN_EFF_FROM_DT
            ,HDR.CONTR_VRSN_EFF_THRU_DT
            ,STC.DS_ACCT_NM
UNION ALL
--Fleet
        SELECT
             HDR.DS_CONTR_PK                    DS_CONTR_PK
            ,HDR.DS_CONTR_CATG_CD               DS_CONTR_CATG_CD
            ,HDR.DS_CONTR_NUM                   DS_CONTR_NUM
            <!-- START 2017/10/27 K.Kojima [QC#21742,MOD] -->
            <!-- ,STS.DS_CONTR_CTRL_STS_CD           DS_CONTR_CTRL_STS_CD -->
            ,STS.CONTR_RNW_AVAL_FLG             CONTR_RNW_AVAL_FLG
            <!-- END 2017/10/27 K.Kojima [QC#21742,MOD] -->
            ,TRIM(HDR.DS_CONTR_CATG_CD
                || '-' || HDR.DS_CONTR_NUM)  AS XX_SCR_ITEM_34_TXT
            ,HDR.CONTR_VRSN_EFF_FROM_DT         CONTR_VRSN_EFF_FROM_DT
            ,HDR.CONTR_VRSN_EFF_THRU_DT         CONTR_VRSN_EFF_THRU_DT
            ,STC.DS_ACCT_NM                     DS_ACCT_NM
            <!-- START 2018/05/22 K.Kitachi [QC#26070, MOD] -->
            ,PEF.BASE_PRC_DEAL_AMT              BASE_PRC_DEAL_AMT
            <!-- START 2017/09/28 K.Kojima [QC#18376, MOD] -->
            <!-- ,CASE -->
            <!--     WHEN ES3.BASE_PRC_UP_RATIO IS NOT NULL -->
            <!--         THEN NVL(DTL.BASE_PRC_DEAL_AMT, 0) + NVL(DTL.BASE_PRC_DEAL_AMT, 0) -->
            <!--                  * ES3.BASE_PRC_UP_RATIO / 100 -->
            <!--     WHEN ES2.BASE_PRC_UP_RATIO IS NOT NULL -->
            <!--         THEN NVL(DTL.BASE_PRC_DEAL_AMT, 0) + NVL(DTL.BASE_PRC_DEAL_AMT, 0) -->
            <!--                  * ES2.BASE_PRC_UP_RATIO / 100 -->
            <!--     ELSE -->
            <!--              NVL(DTL.BASE_PRC_DEAL_AMT, 0) + NVL(DTL.BASE_PRC_DEAL_AMT, 0) -->
            <!--                  * ES1.BASE_PRC_UP_RATIO / 100 -->
            <!--     END                          AS NEW_PRC_DEAL_AMT -->
            ,CASE
            
                WHEN ES3.RNW_PRC_METH_CD IS NOT NULL AND ES3.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES3.BASE_PRC_UP_RATIO IS NOT NULL AND RTP3.RNW_BASE_FLG = 'Y'
                    <!-- START 2018/06/20 U.Kim [QC#24903, MOD] -->
                    <!-- THEN NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES3.BASE_PRC_UP_RATIO / 100 -->
                    THEN ROUND(NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES3.BASE_PRC_UP_RATIO / 100, 2)
                    <!-- END 2018/06/20 U.Kim [QC#24903, MOD] -->
                WHEN ES2.RNW_PRC_METH_CD IS NOT NULL AND ES2.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES2.BASE_PRC_UP_RATIO IS NOT NULL AND RTP2.RNW_BASE_FLG = 'Y'
                    <!-- START 2018/06/20 U.Kim [QC#24903, MOD] -->
                    <!-- THEN NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES2.BASE_PRC_UP_RATIO / 100 -->
                    THEN ROUND(NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES2.BASE_PRC_UP_RATIO / 100, 2)
                    <!-- END 2018/06/20 U.Kim [QC#24903, MOD] -->
                WHEN ES1.RNW_PRC_METH_CD IS NOT NULL AND ES1.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES1.BASE_PRC_UP_RATIO IS NOT NULL AND RTP1.RNW_BASE_FLG = 'Y'
                    <!-- START 2018/06/20 U.Kim [QC#24903, MOD] -->
                    <!-- THEN NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES1.BASE_PRC_UP_RATIO / 100 -->
                    THEN ROUND(NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES1.BASE_PRC_UP_RATIO / 100, 2)
                    <!-- END 2018/06/20 U.Kim [QC#24903, MOD] -->
                ELSE
                    NULL
                END                          AS NEW_PRC_DEAL_AMT
            <!-- END 2017/09/28 K.Kojima [QC#18376, MOD] -->
            <!-- END 2018/05/22 K.Kitachi [QC#26070, MOD] -->
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            ,CASE
                WHEN ES3.RNW_PRC_METH_CD IS NOT NULL AND RTP3.RNW_BASE_FLG = 'Y'
                    THEN ES3.RNW_PRC_METH_CD
                WHEN ES2.RNW_PRC_METH_CD IS NOT NULL AND RTP2.RNW_BASE_FLG = 'Y'
                    THEN ES2.RNW_PRC_METH_CD
                WHEN ES1.RNW_PRC_METH_CD IS NOT NULL AND RTP1.RNW_BASE_FLG = 'Y'
                    THEN ES1.RNW_PRC_METH_CD
                ELSE
                    NULL
                END                          AS RNW_PRC_METH_CD_BASE
            ,CASE
                WHEN ES4.RNW_PRC_METH_CD IS NOT NULL AND RTP4.RNW_USG_FLG = 'Y'
                    THEN ES4.RNW_PRC_METH_CD
                WHEN ES2.RNW_PRC_METH_CD IS NOT NULL AND RTP2.RNW_USG_FLG = 'Y'
                    THEN ES2.RNW_PRC_METH_CD
                WHEN ES1.RNW_PRC_METH_CD IS NOT NULL AND RTP1.RNW_USG_FLG = 'Y'
                    THEN ES1.RNW_PRC_METH_CD
                ELSE
                    NULL
                END                          AS RNW_PRC_METH_CD_USG
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
        FROM
             DS_CONTR               HDR
            ,SELL_TO_CUST           STC
            ,DS_CONTR_DTL           DTL
            ,DS_CONTR_STS_V         STS
            ,DS_CONTR_RNW_ESCL      ES1
            ,DS_CONTR_RNW_ESCL      ES2
            ,DS_CONTR_RNW_ESCL      ES3
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            ,DS_CONTR_RNW_ESCL      ES4
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
            <!-- START 2018/03/30 K.Kojima [QC#24925, ADD] -->
            ,CONTR_AUTO_RNW_TP      RTP1
            ,CONTR_AUTO_RNW_TP      RTP2
            ,CONTR_AUTO_RNW_TP      RTP3
            ,CONTR_AUTO_RNW_TP      RTP4
            <!-- END 2018/03/30 K.Kojima [QC#24925, ADD] -->
            <!-- START 2018/05/22 K.Kitachi [QC#26070, ADD] -->
            ,(
                SELECT
                     A.DS_CONTR_DTL_PK
                    ,B.BASE_PRC_DEAL_AMT
                    ,ROW_NUMBER() OVER(PARTITION BY A.DS_CONTR_DTL_PK ORDER BY B.CONTR_PRC_EFF_THRU_DT DESC) RNUM
                FROM
                     DS_CONTR_DTL     A
                    ,DS_CONTR_PRC_EFF B
                WHERE
                        A.GLBL_CMPY_CD    = #glblCmpyCd#
                    <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND A.DS_CONTR_PK IN (" close=")" conjunction=",">
                        #dsContrPk[]#
                    </iterate>
                    AND A.EZCANCELFLAG    = '0'
                    AND A.GLBL_CMPY_CD    = B.GLBL_CMPY_CD
                    AND A.DS_CONTR_DTL_PK = B.DS_CONTR_DTL_PK
                    AND B.BASE_CHRG_FLG   = 'Y'
                    AND B.EZCANCELFLAG    = '0'
            ) PEF
            <!-- END 2018/05/22 K.Kitachi [QC#26070, ADD] -->
        WHERE
                HDR.GLBL_CMPY_CD        = #glblCmpyCd#
            <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND HDR.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND HDR.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = STC.GLBL_CMPY_CD
            AND HDR.DS_ACCT_NUM         = STC.SELL_TO_CUST_CD
            AND HDR.DS_CONTR_CATG_CD    = #dsContrCatgFlt#
            AND STC.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = DTL.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK         = DTL.DS_CONTR_PK
            AND DTL.DS_CONTR_DTL_TP_CD  = #dsContrDtlTpFleet#
            AND DTL.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = STS.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK         = STS.DS_CONTR_PK
            AND STS.EZCANCELFLAG        = '0'
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            AND DTL.GLBL_CMPY_CD                = ES4.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES4.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK             = ES4.DS_CONTR_DTL_PK(+)
            AND ES4.DS_CONTR_BASE_USG_NM(+)     = #usgNm#
            AND ES4.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum3#
            AND ES4.EZCANCELFLAG(+)             = '0'
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
            AND DTL.GLBL_CMPY_CD                = ES3.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES3.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK             = ES3.DS_CONTR_DTL_PK(+)
            AND ES3.DS_CONTR_BASE_USG_NM(+)     = #baseNm#
            AND ES3.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum3#
            AND ES3.EZCANCELFLAG(+)             = '0'
            AND DTL.GLBL_CMPY_CD                = ES2.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES2.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK             = ES2.DS_CONTR_DTL_PK(+)
            AND ES2.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum2#
            AND ES2.EZCANCELFLAG(+)             = '0'
            AND DTL.GLBL_CMPY_CD                = ES1.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES1.DS_CONTR_PK(+)
            AND ES1.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum1#
            AND ES1.EZCANCELFLAG(+)             = '0'
            <!-- START 2018/03/30 K.Kojima [QC#24925, ADD] -->
            AND ES1.GLBL_CMPY_CD                = RTP1.GLBL_CMPY_CD(+)
            AND ES1.CONTR_AUTO_RNW_TP_CD        = RTP1.CONTR_AUTO_RNW_TP_CD(+)
            AND ES1.EZCANCELFLAG(+)             = '0'
            AND ES2.GLBL_CMPY_CD                = RTP2.GLBL_CMPY_CD(+)
            AND ES2.CONTR_AUTO_RNW_TP_CD        = RTP2.CONTR_AUTO_RNW_TP_CD(+)
            AND ES2.EZCANCELFLAG(+)             = '0'
            AND ES3.GLBL_CMPY_CD                = RTP3.GLBL_CMPY_CD(+)
            AND ES3.CONTR_AUTO_RNW_TP_CD        = RTP3.CONTR_AUTO_RNW_TP_CD(+)
            AND ES3.EZCANCELFLAG(+)             = '0'
            AND ES4.GLBL_CMPY_CD                = RTP4.GLBL_CMPY_CD(+)
            AND ES4.CONTR_AUTO_RNW_TP_CD        = RTP4.CONTR_AUTO_RNW_TP_CD(+)
            AND ES4.EZCANCELFLAG(+)             = '0'
            <!-- END 2018/03/30 K.Kojima [QC#24925, ADD] -->
            <!-- START 2018/05/22 K.Kitachi [QC#26070, ADD] -->
            AND DTL.DS_CONTR_DTL_PK             = PEF.DS_CONTR_DTL_PK(+)
            AND PEF.RNUM(+)                     = 1
            <!-- END 2018/05/22 K.Kitachi [QC#26070, ADD] -->
UNION ALL
--Non-Fleet
        SELECT
             HDR.DS_CONTR_PK                    DS_CONTR_PK
            ,HDR.DS_CONTR_CATG_CD               DS_CONTR_CATG_CD
            ,HDR.DS_CONTR_NUM                   DS_CONTR_NUM
            <!-- START 2017/10/27 K.Kojima [QC#21742,MOD] -->
            <!-- ,STS.DS_CONTR_CTRL_STS_CD           DS_CONTR_CTRL_STS_CD -->
            ,STS.CONTR_RNW_AVAL_FLG             CONTR_RNW_AVAL_FLG
            <!-- END 2017/10/27 K.Kojima [QC#21742,MOD] -->
            ,TRIM(HDR.DS_CONTR_CATG_CD
                || '-' || HDR.DS_CONTR_NUM)  AS XX_SCR_ITEM_34_TXT
            ,HDR.CONTR_VRSN_EFF_FROM_DT         CONTR_VRSN_EFF_FROM_DT
            ,HDR.CONTR_VRSN_EFF_THRU_DT         CONTR_VRSN_EFF_THRU_DT
            ,STC.DS_ACCT_NM                     DS_ACCT_NM
            <!-- START 2018/05/22 K.Kitachi [QC#26070, MOD] -->
            ,SUM(PEF.BASE_PRC_DEAL_AMT)         BASE_PRC_DEAL_AMT
            ,SUM(PEF.BASE_PRC_DEAL_AMT)         NEW_PRC_DEAL_AMT
            <!-- END 2018/05/22 K.Kitachi [QC#26070, MOD] -->
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            ,NULL                            AS RNW_PRC_METH_CD_BASE
            ,NULL                            AS RNW_PRC_METH_CD_USG
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
        FROM
             DS_CONTR               HDR
            ,SELL_TO_CUST           STC
            ,DS_CONTR_DTL           DTL
            ,DS_CONTR_DTL_TP        CDT
            ,DS_CONTR_STS_V         STS
            <!-- START 2018/05/22 K.Kitachi [QC#26070, ADD] -->
            ,(
                SELECT
                     A.DS_CONTR_DTL_PK
                    ,B.BASE_PRC_DEAL_AMT
                    ,ROW_NUMBER() OVER(PARTITION BY A.DS_CONTR_DTL_PK ORDER BY B.CONTR_PRC_EFF_THRU_DT DESC) RNUM
                FROM
                     DS_CONTR_DTL     A
                    ,DS_CONTR_PRC_EFF B
                WHERE
                        A.GLBL_CMPY_CD    = #glblCmpyCd#
                    <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND A.DS_CONTR_PK IN (" close=")" conjunction=",">
                        #dsContrPk[]#
                    </iterate>
                    AND A.EZCANCELFLAG    = '0'
                    AND A.GLBL_CMPY_CD    = B.GLBL_CMPY_CD
                    AND A.DS_CONTR_DTL_PK = B.DS_CONTR_DTL_PK
                    AND B.BASE_CHRG_FLG   = 'Y'
                    AND B.EZCANCELFLAG    = '0'
            ) PEF
            <!-- END 2018/05/22 K.Kitachi [QC#26070, ADD] -->
        WHERE
                HDR.GLBL_CMPY_CD        = #glblCmpyCd#
            <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND HDR.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND HDR.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = STC.GLBL_CMPY_CD
            AND HDR.DS_ACCT_NUM         = STC.SELL_TO_CUST_CD
            AND HDR.DS_CONTR_CATG_CD    = #dsContrCatgReg#
            AND STC.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = DTL.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK         = DTL.DS_CONTR_PK
            AND DTL.EZCANCELFLAG        = '0'
            AND DTL.GLBL_CMPY_CD        = CDT.GLBL_CMPY_CD
            AND DTL.DS_CONTR_DTL_TP_CD  = CDT.DS_CONTR_DTL_TP_CD
            AND CDT.BASE_CHRG_FLG       = #baseChrgFlg#
            AND CDT.EZCANCELFLAG        = '0'
            AND HDR.GLBL_CMPY_CD        = STS.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK         = STS.DS_CONTR_PK
            AND STS.EZCANCELFLAG        = '0'
            <!-- START 2018/05/22 K.Kitachi [QC#26070, ADD] -->
            AND DTL.DS_CONTR_DTL_PK     = PEF.DS_CONTR_DTL_PK(+)
            AND PEF.RNUM(+)             = 1
            <!-- END 2018/05/22 K.Kitachi [QC#26070, ADD] -->
        GROUP BY
             HDR.DS_CONTR_PK
            ,HDR.DS_CONTR_CATG_CD
            ,HDR.DS_CONTR_NUM
            <!-- START 2017/10/27 K.Kojima [QC#21742,MOD] -->
            <!-- ,STS.DS_CONTR_CTRL_STS_CD -->
            ,STS.CONTR_RNW_AVAL_FLG
            <!-- END 2017/10/27 K.Kojima [QC#21742,MOD] -->
            ,HDR.CONTR_VRSN_EFF_FROM_DT
            ,HDR.CONTR_VRSN_EFF_THRU_DT
            ,STC.DS_ACCT_NM
        ORDER BY
             DS_CONTR_CATG_CD
            ,DS_CONTR_NUM
    </statement>
    <resultMap id="result.getContrHdrInfo" class="NSAL0690_ACMsg">
        <result property="dsContrPk_A1" column="DS_CONTR_PK"  javaType="EZDCBigDecimalItem" />
        <result property="dsContrCatgCd_A1" column="DS_CONTR_CATG_CD"  javaType="EZDCStringItem" />
        <result property="dsContrNum_A1" column="DS_CONTR_NUM"  javaType="EZDCStringItem" />
        <!-- START 2017/10/27 K.Kojima [QC#21742,MOD] -->
        <!-- <result property="dsContrCtrlStsCd_A1" column="DS_CONTR_CTRL_STS_CD"  javaType="EZDCStringItem" /> -->
        <result property="contrRnwAvalFlg_A1" column="CONTR_RNW_AVAL_FLG"  javaType="EZDCStringItem" />
        <!-- END 2017/10/27 K.Kojima [QC#21742,MOD] -->
        <result property="xxScrItem34Txt_A1" column="XX_SCR_ITEM_34_TXT"  javaType="EZDCStringItem" />
        <result property="contrVrsnEffFromDt_A1" column="CONTR_VRSN_EFF_FROM_DT"  javaType="EZDCDateItem" />
        <result property="contrVrsnEffThruDt_A1" column="CONTR_VRSN_EFF_THRU_DT"  javaType="EZDCDateItem" />
        <result property="dsAcctNm_A1" column="DS_ACCT_NM"  javaType="EZDCStringItem" />
        <result property="basePrcDealAmt_A1" column="BASE_PRC_DEAL_AMT"  javaType="EZDCBigDecimalItem" />
        <result property="newBaseDealAmt_A1" column="NEW_PRC_DEAL_AMT"  javaType="EZDCBigDecimalItem" />
        <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
        <result property="rnwPrcMethCd_AB" column="RNW_PRC_METH_CD_BASE"  javaType="EZDCStringItem" />
        <result property="rnwPrcMethCd_AU" column="RNW_PRC_METH_CD_USG"  javaType="EZDCStringItem" />
        <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
    </resultMap>

    <statement id="getContrDtlInfo" parameterClass="Map" resultMap="result.getContrDtlInfo">
--Aggregate
        SELECT
             HDR.DS_CONTR_PK                    DS_CONTR_PK
            ,DTL.DS_CONTR_DTL_PK                DS_CONTR_DTL_PK
            ,HDR.DS_CONTR_NUM                   DS_CONTR_NUM
            ,HDR.DS_CONTR_SRC_TP_CD             DS_CONTR_SRC_TP_CD
            ,HDR.DS_CONTR_CATG_CD               DS_CONTR_CATG_CD
            <!-- START 2017/10/27 K.Kojima [QC#21742,MOD] -->
            <!-- ,DHS.DS_CONTR_CTRL_STS_CD           HDR_STS_CD -->
            <!-- ,DDS.DS_CONTR_CTRL_STS_CD           DTL_STS_CD -->
            ,DHS.CONTR_RNW_AVAL_FLG             HDR_CONTR_RNW_AVAL_FLG
            ,DDS.CONTR_RNW_AVAL_FLG             DTL_CONTR_RNW_AVAL_FLG
            <!-- END 2017/10/27 K.Kojima [QC#21742,MOD] -->
            ,SMM.MDSE_CD                        MDSE_CD
            ,SMM.SVC_MACH_MSTR_PK               SVC_MACH_MSTR_PK
            ,SMM.SER_NUM                        SER_NUM
            ,MDL.T_MDL_NM                       T_MDL_NM
            ,#detailBaseNm#                     XX_SCR_ITEM_8_TXT
            ,DDS.DS_CONTR_CTRL_STS_NM           DS_CONTR_STS_NM
            ,DTL.CONTR_EFF_FROM_DT              CONTR_VRSN_EFF_FROM_DT
            <!-- START 2017/09/28 K.Kojima [QC#18376, MOD] -->
            <!-- ,CASE -->
            <!--     WHEN ES3.BASE_PRC_UP_RATIO IS NOT NULL -->
            <!--         THEN ES3.BASE_PRC_UP_RATIO -->
            <!--     WHEN ES2.BASE_PRC_UP_RATIO IS NOT NULL -->
            <!--         THEN ES2.BASE_PRC_UP_RATIO -->
            <!--     ELSE -->
            <!--              ES1.BASE_PRC_UP_RATIO -->
            <!--     END                          AS PRC_UP_RATIO -->
            ,CASE
                WHEN ES3.RNW_PRC_METH_CD IS NOT NULL
                    THEN
                        CASE
                            WHEN ES3.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES3.BASE_PRC_UP_RATIO IS NOT NULL AND RTP3.RNW_BASE_FLG = 'Y'
                                THEN ES3.BASE_PRC_UP_RATIO
                            WHEN ES3.RNW_PRC_METH_CD = #rnwPrcMethModel# AND RTP3.RNW_BASE_FLG = 'Y'
                                THEN DMER.UPLFT_BASE_PRC_UP_RATIO
                            END
                WHEN ES2.RNW_PRC_METH_CD IS NOT NULL
                    THEN
                        CASE
                            WHEN ES2.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES2.BASE_PRC_UP_RATIO IS NOT NULL AND RTP2.RNW_BASE_FLG = 'Y'
                                THEN ES2.BASE_PRC_UP_RATIO
                            WHEN ES2.RNW_PRC_METH_CD = #rnwPrcMethModel# AND RTP2.RNW_BASE_FLG = 'Y'
                                THEN DMER.UPLFT_BASE_PRC_UP_RATIO
                            END
                WHEN ES1.RNW_PRC_METH_CD IS NOT NULL
                    THEN
                        CASE
                            WHEN ES1.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES1.BASE_PRC_UP_RATIO IS NOT NULL AND RTP1.RNW_BASE_FLG = 'Y'
                                THEN ES1.BASE_PRC_UP_RATIO
                            WHEN ES1.RNW_PRC_METH_CD = #rnwPrcMethModel# AND RTP1.RNW_BASE_FLG = 'Y'
                                THEN DMER.UPLFT_BASE_PRC_UP_RATIO
                            END
                END                          AS PRC_UP_RATIO
            <!-- END 2017/09/28 K.Kojima [QC#18376, MOD] -->
            ,DTL.CONTR_EFF_THRU_DT              CONTR_VRSN_EFF_THRU_DT
            <!-- START 2018/05/22 K.Kitachi [QC#26070, MOD] -->
            ,PEF.BASE_PRC_DEAL_AMT              BASE_PRC_DEAL_AMT
            <!-- START 2017/09/28 K.Kojima [QC#18376, MOD] -->
            <!-- ,CASE -->
            <!--     WHEN ES3.BASE_PRC_UP_RATIO IS NOT NULL -->
            <!--         THEN NVL(DTL.BASE_PRC_DEAL_AMT, 0) + NVL(DTL.BASE_PRC_DEAL_AMT, 0) -->
            <!--                 * ES3.BASE_PRC_UP_RATIO / 100 -->
            <!--     WHEN ES2.BASE_PRC_UP_RATIO IS NOT NULL -->
            <!--         THEN NVL(DTL.BASE_PRC_DEAL_AMT, 0) + NVL(DTL.BASE_PRC_DEAL_AMT, 0) -->
            <!--                 * ES2.BASE_PRC_UP_RATIO / 100 -->
            <!--     ELSE -->
            <!--              NVL(DTL.BASE_PRC_DEAL_AMT, 0) + NVL(DTL.BASE_PRC_DEAL_AMT, 0) -->
            <!--                 * ES1.BASE_PRC_UP_RATIO / 100 -->
            <!--     END                          AS NEW_PRC_DEAL_AMT -->
            ,CASE
                WHEN ES3.RNW_PRC_METH_CD IS NOT NULL
                    THEN
                        CASE
                            WHEN ES3.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES3.BASE_PRC_UP_RATIO IS NOT NULL AND RTP3.RNW_BASE_FLG = 'Y'
                                <!-- START 2018/06/20 U.Kim [QC#24903, MOD] -->
                                <!-- THEN NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES3.BASE_PRC_UP_RATIO / 100 -->
                                THEN ROUND(NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES3.BASE_PRC_UP_RATIO / 100, 2)
                                <!-- END 2018/06/20 U.Kim [QC#24903, MOD] -->
                            WHEN ES3.RNW_PRC_METH_CD = #rnwPrcMethModel# AND RTP3.RNW_BASE_FLG = 'Y'
                                <!-- START 2018/06/20 U.Kim [QC#24903, MOD] -->
                                <!-- THEN NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * DMER.UPLFT_BASE_PRC_UP_RATIO / 100 -->
                                THEN ROUND(NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * DMER.UPLFT_BASE_PRC_UP_RATIO / 100, 2)
                                <!-- END 2018/06/20 U.Kim [QC#24903, MOD] -->
                            END
                WHEN ES2.RNW_PRC_METH_CD IS NOT NULL
                    THEN
                        CASE
                            WHEN ES2.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES2.BASE_PRC_UP_RATIO IS NOT NULL AND RTP2.RNW_BASE_FLG = 'Y'
                                <!-- START 2018/06/20 U.Kim [QC#24903, MOD] -->
                                <!-- THEN NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES2.BASE_PRC_UP_RATIO / 100 -->
                                THEN ROUND(NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES2.BASE_PRC_UP_RATIO / 100, 2)
                                <!-- END 2018/06/20 U.Kim [QC#24903, MOD] -->
                            WHEN ES2.RNW_PRC_METH_CD = #rnwPrcMethModel# AND RTP2.RNW_BASE_FLG = 'Y'
                                <!-- START 2018/06/20 U.Kim [QC#24903, MOD] -->
                                <!-- THEN NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * DMER.UPLFT_BASE_PRC_UP_RATIO / 100 -->
                                THEN ROUND(NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * DMER.UPLFT_BASE_PRC_UP_RATIO / 100, 2)
                                <!-- END 2018/06/20 U.Kim [QC#24903, MOD] -->
                            END
                WHEN ES1.RNW_PRC_METH_CD IS NOT NULL
                    THEN
                        CASE
                            WHEN ES1.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES1.BASE_PRC_UP_RATIO IS NOT NULL AND RTP1.RNW_BASE_FLG = 'Y'
                                <!-- START 2018/06/20 U.Kim [QC#24903, MOD] -->
                                <!-- THEN NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES1.BASE_PRC_UP_RATIO / 100 -->
                                THEN ROUND(NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES1.BASE_PRC_UP_RATIO / 100, 2)
                                <!-- END 2018/06/20 U.Kim [QC#24903, MOD] -->
                            WHEN ES1.RNW_PRC_METH_CD = #rnwPrcMethModel# AND RTP1.RNW_BASE_FLG = 'Y'
                                <!-- START 2018/06/20 U.Kim [QC#24903, MOD] -->
                                <!-- THEN NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * DMER.UPLFT_BASE_PRC_UP_RATIO / 100 -->
                                THEN ROUND(NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * DMER.UPLFT_BASE_PRC_UP_RATIO / 100, 2)
                                <!-- END 2018/06/20 U.Kim [QC#24903, MOD] -->
                            END
                END                          AS NEW_PRC_DEAL_AMT
            <!-- END 2017/09/28 K.Kojima [QC#18376, MOD] -->
            <!-- END 2018/05/22 K.Kitachi [QC#26070, MOD] -->
            ,1                                  SORT_NUM
            ,DTL.DS_CONTR_DTL_TP_CD             DS_CONTR_DTL_TP_CD
            ,HDR.EZUPTIME                       EZUPTIME_H
            ,HDR.EZUPTIMEZONE                   EZUPTIMEZONE_H
            ,DTL.EZUPTIME                       EZUPTIME_D
            ,DTL.EZUPTIMEZONE                   EZUPTIMEZONE_D
<!-- START 2016/12/08 N.Arai [QC#14204, ADD] -->
            ,DTL.EZINTIME                       XX_REC_HIST_CRAT_TS
            ,DTL.EZINUSERID                     XX_REC_HIST_CRAT_BY_NM
            ,DTL.EZUPTIME                       XX_REC_HIST_UPD_TS
            ,DTL.EZUPUSERID                     XX_REC_HIST_UPD_BY_NM
            ,DTL.EZTABLEID                      XX_REC_HIST_TBL_NM
<!-- END 2016/12/08 N.Arai [QC#14204, ADD] -->
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            ,NULL                            AS RNW_PRC_METH_CD_USG
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
            <!-- START 2018/05/18 K.Kojima [QC#26187, ADD] -->
            ,NVL(SMMP.SER_NUM, SMM.SER_NUM)      AS SORT_SER_NUM
            ,NVL(SMMP.MDSE_CD, SMM.MDSE_CD)      AS SORT_MDSE_CD
            ,CDT.DS_CONTR_DTL_TP_SORT_NUM
            <!-- END 2018/05/18 K.Kojima [QC#26187, ADD] -->
            <!-- add start 2019/05/14 QC#50331 -->
            ,SPT.SVC_PGM_TP_SORT_NUM
            ,NVL(DTL.DS_CONTR_CRAT_TP_CD, #dsContrCratTp#)       AS SORT_DS_CONTR_CRAT_TP_CD
            ,CASE WHEN SMMP.SVC_MACH_MSTR_PK IS NULL THEN DTL.DS_CONTR_DTL_PK
                  ELSE DTL.PRNT_DS_CONTR_DTL_PK
             END                                                 AS SORT_DS_CONTR_DTL_PK
            <!-- add end 2019/05/14 QC#50331 -->
        FROM
             DS_CONTR               HDR
            ,DS_CONTR_DTL           DTL
            ,SVC_MACH_MSTR          SMM
            ,SVC_CONFIG_MSTR        SCM
            ,MDL_NM                 MDL
            ,DS_CONTR_STS_V         DHS
            ,DS_CONTR_DTL_STS_V     DDS
            ,DS_CONTR_RNW_ESCL      ES1
            ,DS_CONTR_RNW_ESCL      ES2
            ,DS_CONTR_RNW_ESCL      ES3
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            ,DS_MDL_ESCL_RULE       DMER
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
            <!-- START 2018/03/29 K.Kojima [QC#24925, ADD] -->
            ,CONTR_AUTO_RNW_TP      RTP1
            ,CONTR_AUTO_RNW_TP      RTP2
            ,CONTR_AUTO_RNW_TP      RTP3
            <!-- END 2018/03/29 K.Kojima [QC#24925, ADD] -->
            <!-- START 2018/05/22 K.Kitachi [QC#26070, ADD] -->
            ,(
                SELECT
                     A.DS_CONTR_DTL_PK
                    ,B.BASE_PRC_DEAL_AMT
                    ,ROW_NUMBER() OVER(PARTITION BY A.DS_CONTR_DTL_PK ORDER BY B.CONTR_PRC_EFF_THRU_DT DESC) RNUM
                FROM
                     DS_CONTR_DTL     A
                    ,DS_CONTR_PRC_EFF B
                WHERE
                        A.GLBL_CMPY_CD    = #glblCmpyCd#
                    <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND A.DS_CONTR_PK IN (" close=")" conjunction=",">
                        #dsContrPk[]#
                    </iterate>
                    AND A.EZCANCELFLAG    = '0'
                    AND A.GLBL_CMPY_CD    = B.GLBL_CMPY_CD
                    AND A.DS_CONTR_DTL_PK = B.DS_CONTR_DTL_PK
                    AND B.BASE_CHRG_FLG   = 'Y'
                    AND B.EZCANCELFLAG    = '0'
            ) PEF
            <!-- END 2018/05/22 K.Kitachi [QC#26070, ADD] -->
            <!-- START 2018/05/18 K.Kojima [QC#26187, ADD] -->
            ,DS_CONTR_DTL           DTLP
            ,SVC_MACH_MSTR          SMMP
            ,DS_CONTR_DTL_TP        CDT
            <!-- END 2018/05/18 K.Kojima [QC#26187, ADD] -->
            <!-- add start 2019/05/14 QC#50331 -->
            ,MDSE                   MDSE
            ,SVC_PGM_TP             SPT
            <!-- add end 2019/05/14 QC#50331 -->
        WHERE
                HDR.GLBL_CMPY_CD                = #glblCmpyCd#
            <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND HDR.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND HDR.DS_CONTR_CATG_CD            = #dsContrCatgAgg#
            AND HDR.EZCANCELFLAG                = '0'
            AND HDR.GLBL_CMPY_CD                = DTL.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK                 = DTL.DS_CONTR_PK
            AND DTL.EZCANCELFLAG                = '0'
            AND DTL.GLBL_CMPY_CD                = SMM.GLBL_CMPY_CD
            AND DTL.SVC_MACH_MSTR_PK            = SMM.SVC_MACH_MSTR_PK
            <iterate property="dsContrDtlPkArray" var="dsContrDtlPk[]" open="AND DTL.DS_CONTR_DTL_PK IN (" close=")" conjunction=",">
                #dsContrDtlPk[]#
            </iterate>
            AND DTL.DS_CONTR_DTL_TP_CD         &lt;&gt; #dsContrDtlTpAgg#
            AND SMM.EZCANCELFLAG                = '0'
            AND SMM.GLBL_CMPY_CD                = SCM.GLBL_CMPY_CD(+)
            AND SMM.SVC_CONFIG_MSTR_PK          = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.EZCANCELFLAG(+)             = '0'
            AND SCM.GLBL_CMPY_CD                = MDL.T_GLBL_CMPY_CD(+)
            AND SCM.MDL_ID                      = MDL.T_MDL_ID(+)
            AND MDL.EZCANCELFLAG(+)             = '0'
            AND HDR.GLBL_CMPY_CD                = DHS.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK                 = DHS.DS_CONTR_PK
            AND DHS.EZCANCELFLAG                = '0'
            AND DTL.GLBL_CMPY_CD                = DDS.GLBL_CMPY_CD
            AND DTL.DS_CONTR_PK                 = DDS.DS_CONTR_PK
            AND DTL.DS_CONTR_DTL_PK             = DDS.DS_CONTR_DTL_PK
            AND DDS.EZCANCELFLAG                = '0'
            AND DTL.GLBL_CMPY_CD                = ES3.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES3.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK             = ES3.DS_CONTR_DTL_PK(+)
            AND ES3.DS_CONTR_BASE_USG_NM(+)     = #baseNm#
            AND ES3.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum3#
            AND ES3.EZCANCELFLAG(+)             = '0'
            AND DTL.GLBL_CMPY_CD                = ES2.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES2.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK             = ES2.DS_CONTR_DTL_PK(+)
            AND ES2.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum2#
            AND ES2.EZCANCELFLAG(+)             = '0'
            AND DTL.GLBL_CMPY_CD                = ES1.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES1.DS_CONTR_PK(+)
            AND ES1.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum1#
            AND ES1.EZCANCELFLAG(+)             = '0'
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            AND SCM.GLBL_CMPY_CD                = DMER.GLBL_CMPY_CD(+)
            AND SCM.MDL_ID                      = DMER.MDL_ID(+)
            AND DMER.EZCANCELFLAG(+)            = '0'
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
            <!-- START 2018/03/29 K.Kojima [QC#24925, ADD] -->
            AND ES1.GLBL_CMPY_CD                = RTP1.GLBL_CMPY_CD(+)
            AND ES1.CONTR_AUTO_RNW_TP_CD        = RTP1.CONTR_AUTO_RNW_TP_CD(+)
            AND ES1.EZCANCELFLAG(+)             = '0'
            AND ES2.GLBL_CMPY_CD                = RTP2.GLBL_CMPY_CD(+)
            AND ES2.CONTR_AUTO_RNW_TP_CD        = RTP2.CONTR_AUTO_RNW_TP_CD(+)
            AND ES2.EZCANCELFLAG(+)             = '0'
            AND ES3.GLBL_CMPY_CD                = RTP3.GLBL_CMPY_CD(+)
            AND ES3.CONTR_AUTO_RNW_TP_CD        = RTP3.CONTR_AUTO_RNW_TP_CD(+)
            AND ES3.EZCANCELFLAG(+)             = '0'
            <!-- END 2018/03/29 K.Kojima [QC#24925, ADD] -->
            <!-- START 2018/05/22 K.Kitachi [QC#26070, ADD] -->
            AND DTL.DS_CONTR_DTL_PK             = PEF.DS_CONTR_DTL_PK(+)
            AND PEF.RNUM(+)                     = 1
            <!-- END 2018/05/22 K.Kitachi [QC#26070, ADD] -->
            <!-- START 2018/05/18 K.Kojima [QC#26187, ADD] -->
            AND DTL.GLBL_CMPY_CD                = DTLP.GLBL_CMPY_CD(+)
            AND DTL.PRNT_DS_CONTR_DTL_PK        = DTLP.DS_CONTR_DTL_PK(+)
            AND DTL.EZCANCELFLAG(+)             = '0'
            AND DTLP.GLBL_CMPY_CD               = SMMP.GLBL_CMPY_CD(+)
            AND DTLP.SVC_MACH_MSTR_PK           = SMMP.SVC_MACH_MSTR_PK(+)
            AND SMMP.EZCANCELFLAG(+)            = '0'
            AND DTL.GLBL_CMPY_CD                = CDT.GLBL_CMPY_CD
            AND DTL.DS_CONTR_DTL_TP_CD          = CDT.DS_CONTR_DTL_TP_CD
            AND CDT.EZCANCELFLAG(+)             = '0'
            <!-- END 2018/05/18 K.Kojima [QC#26187, ADD] -->
            <!-- add start 2019/05/14 QC#50331 -->
            AND DTL.GLBL_CMPY_CD                = MDSE.GLBL_CMPY_CD(+)
            AND DTL.SVC_PGM_MDSE_CD             = MDSE.MDSE_CD(+)
            AND MDSE.EZCANCELFLAG(+)            = '0'
            AND MDSE.GLBL_CMPY_CD               = SPT.GLBL_CMPY_CD(+)
            AND MDSE.SVC_PGM_TP_CD              = SPT.SVC_PGM_TP_CD(+)
            AND SPT.EZCANCELFLAG(+)             = '0'
            <!-- add end 2019/05/14 QC#50331 -->
    UNION ALL
--Fleet
        SELECT
             HDR.DS_CONTR_PK                    DS_CONTR_PK
            ,DTL.DS_CONTR_DTL_PK                DS_CONTR_DTL_PK
            ,HDR.DS_CONTR_NUM                   DS_CONTR_NUM
            ,HDR.DS_CONTR_SRC_TP_CD             DS_CONTR_SRC_TP_CD
            ,HDR.DS_CONTR_CATG_CD               DS_CONTR_CATG_CD
            <!-- START 2017/10/27 K.Kojima [QC#21742,MOD] -->
            <!-- ,DHS.DS_CONTR_CTRL_STS_CD           HDR_STS_CD -->
            <!-- ,DDS.DS_CONTR_CTRL_STS_CD           DTL_STS_CD -->
            ,DHS.CONTR_RNW_AVAL_FLG             HDR_CONTR_RNW_AVAL_FLG
            ,DDS.CONTR_RNW_AVAL_FLG             DTL_CONTR_RNW_AVAL_FLG
            <!-- END 2017/10/27 K.Kojima [QC#21742,MOD] -->
            ,SMM.MDSE_CD                        MDSE_CD
            ,SMM.SVC_MACH_MSTR_PK               SVC_MACH_MSTR_PK
            ,SMM.SER_NUM                        SER_NUM
            ,MDL.T_MDL_NM                       T_MDL_NM
            ,#detailBaseNm#                     XX_SCR_ITEM_8_TXT
            ,DDS.DS_CONTR_CTRL_STS_NM           DS_CONTR_STS_NM
            ,DTL.CONTR_EFF_FROM_DT              CONTR_VRSN_EFF_FROM_DT
            <!-- START 2017/09/28 K.Kojima [QC#18376, MOD] -->
            <!-- ,CASE -->
            <!--     WHEN ES3.BASE_PRC_UP_RATIO IS NOT NULL -->
            <!--         THEN ES3.BASE_PRC_UP_RATIO -->
            <!--     WHEN ES2.BASE_PRC_UP_RATIO IS NOT NULL -->
            <!--         THEN ES2.BASE_PRC_UP_RATIO -->
            <!--     ELSE -->
            <!--              ES1.BASE_PRC_UP_RATIO -->
            <!--     END                          AS PRC_UP_RATIO -->
            ,CASE
                WHEN ES3.RNW_PRC_METH_CD IS NOT NULL
                    THEN
                        CASE
                            WHEN ES3.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES3.BASE_PRC_UP_RATIO IS NOT NULL AND RTP3.RNW_BASE_FLG = 'Y'
                                THEN ES3.BASE_PRC_UP_RATIO
                            WHEN ES3.RNW_PRC_METH_CD = #rnwPrcMethModel# AND RTP3.RNW_BASE_FLG = 'Y'
                                THEN DMER.UPLFT_BASE_PRC_UP_RATIO
                            END
                WHEN ES2.RNW_PRC_METH_CD IS NOT NULL
                    THEN
                        CASE
                            WHEN ES2.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES2.BASE_PRC_UP_RATIO IS NOT NULL AND RTP2.RNW_BASE_FLG = 'Y'
                                THEN ES2.BASE_PRC_UP_RATIO
                            WHEN ES2.RNW_PRC_METH_CD = #rnwPrcMethModel# AND RTP2.RNW_BASE_FLG = 'Y'
                                THEN DMER.UPLFT_BASE_PRC_UP_RATIO
                            END
                WHEN ES1.RNW_PRC_METH_CD IS NOT NULL
                    THEN
                        CASE
                            WHEN ES1.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES1.BASE_PRC_UP_RATIO IS NOT NULL AND RTP1.RNW_BASE_FLG = 'Y'
                                THEN ES1.BASE_PRC_UP_RATIO
                            WHEN ES1.RNW_PRC_METH_CD = #rnwPrcMethModel# AND RTP1.RNW_BASE_FLG = 'Y'
                                THEN DMER.UPLFT_BASE_PRC_UP_RATIO
                            END
                END                          AS PRC_UP_RATIO
            <!-- END 2017/09/28 K.Kojima [QC#18376, MOD] -->
            ,DTL.CONTR_EFF_THRU_DT              CONTR_VRSN_EFF_THRU_DT
            ,NULL                               BASE_PRC_DEAL_AMT
            ,NULL                               NEW_PRC_DEAL_AMT
            ,2                                  SORT_NUM
            ,DTL.DS_CONTR_DTL_TP_CD             DS_CONTR_DTL_TP_CD
            ,HDR.EZUPTIME                       EZUPTIME_H
            ,HDR.EZUPTIMEZONE                   EZUPTIMEZONE_H
            ,DTL.EZUPTIME                       EZUPTIME_D
            ,DTL.EZUPTIMEZONE                   EZUPTIMEZONE_D
<!-- START 2016/12/08 N.Arai [QC#14204, ADD] -->
            ,DTL.EZINTIME                       XX_REC_HIST_CRAT_TS
            ,DTL.EZINUSERID                     XX_REC_HIST_CRAT_BY_NM
            ,DTL.EZUPTIME                       XX_REC_HIST_UPD_TS
            ,DTL.EZUPUSERID                     XX_REC_HIST_UPD_BY_NM
            ,DTL.EZTABLEID                      XX_REC_HIST_TBL_NM
<!-- END 2016/12/08 N.Arai [QC#14204, ADD] -->
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            ,NULL                            AS RNW_PRC_METH_CD_USG
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
            <!-- START 2018/05/18 K.Kojima [QC#26187, ADD] -->
            ,NVL(SMMP.SER_NUM, SMM.SER_NUM)      AS SORT_SER_NUM
            ,NVL(SMMP.MDSE_CD, SMM.MDSE_CD)      AS SORT_MDSE_CD
            ,CDT.DS_CONTR_DTL_TP_SORT_NUM
            <!-- END 2018/05/18 K.Kojima [QC#26187, ADD] -->
            <!-- add start 2019/05/14 QC#50331 -->
            ,SPT.SVC_PGM_TP_SORT_NUM
            ,NVL(DTL.DS_CONTR_CRAT_TP_CD, #dsContrCratTp#)       AS SORT_DS_CONTR_CRAT_TP_CD
            ,CASE WHEN SMMP.SVC_MACH_MSTR_PK IS NULL THEN DTL.DS_CONTR_DTL_PK
                  ELSE DTL.PRNT_DS_CONTR_DTL_PK
             END                                                 AS SORT_DS_CONTR_DTL_PK
            <!-- add end 2019/05/14 QC#50331 -->
        FROM
             DS_CONTR               HDR
            ,DS_CONTR_DTL           DTL
            ,SVC_MACH_MSTR          SMM
            ,SVC_CONFIG_MSTR        SCM
            ,MDL_NM                 MDL
            ,DS_CONTR_STS_V         DHS
            ,DS_CONTR_DTL_STS_V     DDS
            ,DS_CONTR_DTL_TP        CDT
            ,DS_CONTR_RNW_ESCL      ES1
            ,DS_CONTR_RNW_ESCL      ES2
            ,DS_CONTR_RNW_ESCL      ES3
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            ,DS_MDL_ESCL_RULE       DMER
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
            <!-- START 2018/03/29 K.Kojima [QC#24925, ADD] -->
            ,CONTR_AUTO_RNW_TP      RTP1
            ,CONTR_AUTO_RNW_TP      RTP2
            ,CONTR_AUTO_RNW_TP      RTP3
            <!-- END 2018/03/29 K.Kojima [QC#24925, ADD] -->
            <!-- START 2018/05/18 K.Kojima [QC#26187, ADD] -->
            ,DS_CONTR_DTL           DTLP
            ,SVC_MACH_MSTR          SMMP
            <!-- END 2018/05/18 K.Kojima [QC#26187, ADD] -->
            <!-- add start 2019/05/14 QC#50331 -->
            ,MDSE                   MDSE
            ,SVC_PGM_TP             SPT
            <!-- add end 2019/05/14 QC#50331 -->
        WHERE
                HDR.GLBL_CMPY_CD                = #glblCmpyCd#
            <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND HDR.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND HDR.DS_CONTR_CATG_CD            = #dsContrCatgFlt#
            AND HDR.EZCANCELFLAG                = '0'
            AND HDR.GLBL_CMPY_CD                = DTL.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK                 = DTL.DS_CONTR_PK
            AND DTL.EZCANCELFLAG                = '0'
            AND DTL.GLBL_CMPY_CD                = SMM.GLBL_CMPY_CD
            AND DTL.SVC_MACH_MSTR_PK            = SMM.SVC_MACH_MSTR_PK
            <iterate property="dsContrDtlPkArray" var="dsContrDtlPk[]" open="AND DTL.DS_CONTR_DTL_PK IN (" close=")" conjunction=",">
                #dsContrDtlPk[]#
            </iterate>
            AND SMM.EZCANCELFLAG                = '0'
            AND SMM.GLBL_CMPY_CD                = SCM.GLBL_CMPY_CD(+)
            AND SMM.SVC_CONFIG_MSTR_PK          = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.EZCANCELFLAG(+)             = '0'
            AND SCM.GLBL_CMPY_CD                = MDL.T_GLBL_CMPY_CD(+)
            AND SCM.MDL_ID                      = MDL.T_MDL_ID(+)
            AND MDL.EZCANCELFLAG(+)             = '0'
            AND HDR.GLBL_CMPY_CD                = DHS.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK                 = DHS.DS_CONTR_PK
            AND DHS.EZCANCELFLAG                = '0'
            AND DTL.GLBL_CMPY_CD                = DDS.GLBL_CMPY_CD
            AND DTL.DS_CONTR_PK                 = DDS.DS_CONTR_PK
            AND DTL.DS_CONTR_DTL_PK             = DDS.DS_CONTR_DTL_PK
            AND DDS.EZCANCELFLAG                = '0'
            AND DTL.GLBL_CMPY_CD                = CDT.GLBL_CMPY_CD
            AND DTL.DS_CONTR_DTL_TP_CD          = CDT.DS_CONTR_DTL_TP_CD
            AND CDT.EZCANCELFLAG                = '0'
            AND CDT.FLEET_LINE_FLG              = #fltLineFlg#
            AND DTL.GLBL_CMPY_CD                = ES3.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES3.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK             = ES3.DS_CONTR_DTL_PK(+)
            AND ES3.DS_CONTR_BASE_USG_NM(+)     = #baseNm#
            AND ES3.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum3#
            AND ES3.EZCANCELFLAG(+)             = '0'
            AND DTL.GLBL_CMPY_CD                = ES2.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES2.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK             = ES2.DS_CONTR_DTL_PK(+)
            AND ES2.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum2#
            AND ES2.EZCANCELFLAG(+)             = '0'
            AND DTL.GLBL_CMPY_CD                = ES1.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES1.DS_CONTR_PK(+)
            AND ES1.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum1#
            AND ES1.EZCANCELFLAG(+)             = '0'
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            AND SCM.GLBL_CMPY_CD                = DMER.GLBL_CMPY_CD(+)
            AND SCM.MDL_ID                      = DMER.MDL_ID(+)
            AND DMER.EZCANCELFLAG(+)            = '0'
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
            <!-- START 2018/03/29 K.Kojima [QC#24925, ADD] -->
            AND ES1.GLBL_CMPY_CD                = RTP1.GLBL_CMPY_CD(+)
            AND ES1.CONTR_AUTO_RNW_TP_CD        = RTP1.CONTR_AUTO_RNW_TP_CD(+)
            AND ES1.EZCANCELFLAG(+)             = '0'
            AND ES2.GLBL_CMPY_CD                = RTP2.GLBL_CMPY_CD(+)
            AND ES2.CONTR_AUTO_RNW_TP_CD        = RTP2.CONTR_AUTO_RNW_TP_CD(+)
            AND ES2.EZCANCELFLAG(+)             = '0'
            AND ES3.GLBL_CMPY_CD                = RTP3.GLBL_CMPY_CD(+)
            AND ES3.CONTR_AUTO_RNW_TP_CD        = RTP3.CONTR_AUTO_RNW_TP_CD(+)
            AND ES3.EZCANCELFLAG(+)             = '0'
            <!-- END 2018/03/29 K.Kojima [QC#24925, ADD] -->
            <!-- START 2018/05/18 K.Kojima [QC#26187, ADD] -->
            AND DTL.GLBL_CMPY_CD                = DTLP.GLBL_CMPY_CD(+)
            AND DTL.PRNT_DS_CONTR_DTL_PK        = DTLP.DS_CONTR_DTL_PK(+)
            AND DTL.EZCANCELFLAG(+)             = '0'
            AND DTLP.GLBL_CMPY_CD               = SMMP.GLBL_CMPY_CD(+)
            AND DTLP.SVC_MACH_MSTR_PK           = SMMP.SVC_MACH_MSTR_PK(+)
            AND SMMP.EZCANCELFLAG(+)            = '0'
            <!-- END 2018/05/18 K.Kojima [QC#26187, ADD] -->
            <!-- add start 2019/05/14 QC#50331 -->
            AND DTL.GLBL_CMPY_CD                = MDSE.GLBL_CMPY_CD(+)
            AND DTL.SVC_PGM_MDSE_CD             = MDSE.MDSE_CD(+)
            AND MDSE.EZCANCELFLAG(+)            = '0'
            AND MDSE.GLBL_CMPY_CD               = SPT.GLBL_CMPY_CD(+)
            AND MDSE.SVC_PGM_TP_CD              = SPT.SVC_PGM_TP_CD(+)
            AND SPT.EZCANCELFLAG(+)             = '0'
            <!-- add end 2019/05/14 QC#50331 -->
    UNION ALL
--Regular - base
        SELECT
             HDR.DS_CONTR_PK                    DS_CONTR_PK
            ,DTL.DS_CONTR_DTL_PK                DS_CONTR_DTL_PK
            ,HDR.DS_CONTR_NUM                   DS_CONTR_NUM
            ,HDR.DS_CONTR_SRC_TP_CD             DS_CONTR_SRC_TP_CD
            ,HDR.DS_CONTR_CATG_CD               DS_CONTR_CATG_CD
            <!-- START 2017/10/27 K.Kojima [QC#21742,MOD] -->
            <!-- ,DHS.DS_CONTR_CTRL_STS_CD           HDR_STS_CD -->
            <!-- ,DDS.DS_CONTR_CTRL_STS_CD           DTL_STS_CD -->
            ,DHS.CONTR_RNW_AVAL_FLG             HDR_CONTR_RNW_AVAL_FLG
            ,DDS.CONTR_RNW_AVAL_FLG             DTL_CONTR_RNW_AVAL_FLG
            <!-- END 2017/10/27 K.Kojima [QC#21742,MOD] -->
            ,SMM.MDSE_CD                        MDSE_CD
            ,SMM.SVC_MACH_MSTR_PK               SVC_MACH_MSTR_PK
            ,SMM.SER_NUM                        SER_NUM
            ,MDL.T_MDL_NM                       T_MDL_NM
            ,#detailBaseNm#                     XX_SCR_ITEM_8_TXT
            ,DDS.DS_CONTR_CTRL_STS_NM           DS_CONTR_STS_NM
            ,DTL.CONTR_EFF_FROM_DT              CONTR_VRSN_EFF_FROM_DT
            <!-- START 2017/09/28 K.Kojima [QC#18376, MOD] -->
            <!-- ,CASE -->
            <!--     WHEN ES3.BASE_PRC_UP_RATIO IS NOT NULL -->
            <!--         THEN ES3.BASE_PRC_UP_RATIO -->
            <!--     WHEN ES2.BASE_PRC_UP_RATIO IS NOT NULL -->
            <!--         THEN ES2.BASE_PRC_UP_RATIO -->
            <!--     ELSE -->
            <!--              ES1.BASE_PRC_UP_RATIO -->
            <!--     END                          AS PRC_UP_RATIO -->
            ,CASE
                WHEN ES3.RNW_PRC_METH_CD IS NOT NULL
                    THEN
                        CASE
                            WHEN ES3.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES3.BASE_PRC_UP_RATIO IS NOT NULL AND RTP3.RNW_BASE_FLG = 'Y'
                                THEN ES3.BASE_PRC_UP_RATIO
                            WHEN ES3.RNW_PRC_METH_CD = #rnwPrcMethModel# AND RTP3.RNW_BASE_FLG = 'Y'
                                THEN DMER.UPLFT_BASE_PRC_UP_RATIO
                            END
                WHEN ES2.RNW_PRC_METH_CD IS NOT NULL
                    THEN
                        CASE
                            WHEN ES2.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES2.BASE_PRC_UP_RATIO IS NOT NULL AND RTP2.RNW_BASE_FLG = 'Y'
                                THEN ES2.BASE_PRC_UP_RATIO
                            WHEN ES2.RNW_PRC_METH_CD = #rnwPrcMethModel# AND RTP2.RNW_BASE_FLG = 'Y'
                                THEN DMER.UPLFT_BASE_PRC_UP_RATIO
                            END
                WHEN ES1.RNW_PRC_METH_CD IS NOT NULL
                    THEN
                        CASE
                            WHEN ES1.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES1.BASE_PRC_UP_RATIO IS NOT NULL AND RTP1.RNW_BASE_FLG = 'Y'
                                THEN ES1.BASE_PRC_UP_RATIO
                            WHEN ES1.RNW_PRC_METH_CD = #rnwPrcMethModel# AND RTP1.RNW_BASE_FLG = 'Y'
                                THEN DMER.UPLFT_BASE_PRC_UP_RATIO
                            END
                END                          AS PRC_UP_RATIO
            <!-- END 2017/09/28 K.Kojima [QC#18376, MOD] -->
            ,DTL.CONTR_EFF_THRU_DT              CONTR_VRSN_EFF_THRU_DT
            <!-- START 2018/05/22 K.Kitachi [QC#26070, MOD] -->
            ,PEF.BASE_PRC_DEAL_AMT              BASE_PRC_DEAL_AMT
            <!-- START 2017/09/28 K.Kojima [QC#18376, MOD] -->
            <!-- ,CASE -->
            <!--     WHEN ES3.BASE_PRC_UP_RATIO IS NOT NULL -->
            <!--         THEN NVL(DTL.BASE_PRC_DEAL_AMT, 0) + NVL(DTL.BASE_PRC_DEAL_AMT, 0) -->
            <!--                 * ES3.BASE_PRC_UP_RATIO / 100 -->
            <!--     WHEN ES2.BASE_PRC_UP_RATIO IS NOT NULL -->
            <!--         THEN NVL(DTL.BASE_PRC_DEAL_AMT, 0) + NVL(DTL.BASE_PRC_DEAL_AMT, 0) -->
            <!--                 * ES2.BASE_PRC_UP_RATIO / 100 -->
            <!--     ELSE -->
            <!--              NVL(DTL.BASE_PRC_DEAL_AMT, 0) + NVL(DTL.BASE_PRC_DEAL_AMT, 0) -->
            <!--                 * ES1.BASE_PRC_UP_RATIO / 100 -->
            <!--     END                          AS NEW_PRC_DEAL_AMT -->
            ,CASE
                WHEN ES3.RNW_PRC_METH_CD IS NOT NULL
                    THEN
                        CASE
                            WHEN ES3.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES3.BASE_PRC_UP_RATIO IS NOT NULL AND RTP3.RNW_BASE_FLG = 'Y'
                                <!-- START 2018/06/20 U.Kim [QC#24903, MOD] -->
                                <!-- THEN NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES3.BASE_PRC_UP_RATIO / 100 -->
                                THEN ROUND(NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES3.BASE_PRC_UP_RATIO / 100, 2)
                                <!-- END 2018/06/20 U.Kim [QC#24903, MOD] -->
                            WHEN ES3.RNW_PRC_METH_CD = #rnwPrcMethModel# AND RTP3.RNW_BASE_FLG = 'Y'
                                <!-- START 2018/06/20 U.Kim [QC#24903, MOD] -->
                                <!-- THEN NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * DMER.UPLFT_BASE_PRC_UP_RATIO / 100 -->
                                THEN ROUND(NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * DMER.UPLFT_BASE_PRC_UP_RATIO / 100, 2)
                                <!-- END 2018/06/20 U.Kim [QC#24903, MOD] -->
                            END
                WHEN ES2.RNW_PRC_METH_CD IS NOT NULL
                    THEN
                        CASE
                            WHEN ES2.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES2.BASE_PRC_UP_RATIO IS NOT NULL AND RTP2.RNW_BASE_FLG = 'Y'
                                <!-- START 2018/06/20 U.Kim [QC#24903, MOD] -->
                                <!-- THEN NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES2.BASE_PRC_UP_RATIO / 100 -->
                                THEN ROUND(NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES2.BASE_PRC_UP_RATIO / 100, 2)
                                <!-- END 2018/06/20 U.Kim [QC#24903, MOD] -->
                            WHEN ES2.RNW_PRC_METH_CD = #rnwPrcMethModel# AND RTP2.RNW_BASE_FLG = 'Y'
                                <!-- START 2018/06/20 U.Kim [QC#24903, MOD] -->
                                <!-- THEN NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * DMER.UPLFT_BASE_PRC_UP_RATIO / 100 -->
                                THEN ROUND(NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * DMER.UPLFT_BASE_PRC_UP_RATIO / 100, 2)
                                <!-- END 2018/06/20 U.Kim [QC#24903, MOD] -->
                            END
                WHEN ES1.RNW_PRC_METH_CD IS NOT NULL
                    THEN
                        CASE
                            WHEN ES1.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES1.BASE_PRC_UP_RATIO IS NOT NULL AND RTP1.RNW_BASE_FLG = 'Y'
                                <!-- START 2018/06/20 U.Kim [QC#24903, MOD] -->
                                <!-- THEN NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES1.BASE_PRC_UP_RATIO / 100 -->
                                THEN ROUND(NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * ES1.BASE_PRC_UP_RATIO / 100, 2)
                                <!-- END 2018/06/20 U.Kim [QC#24903, MOD] -->
                            WHEN ES1.RNW_PRC_METH_CD = #rnwPrcMethModel# AND RTP1.RNW_BASE_FLG = 'Y'
                                <!-- START 2018/06/20 U.Kim [QC#24903, MOD] -->
                                <!-- THEN NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * DMER.UPLFT_BASE_PRC_UP_RATIO / 100 -->
                                THEN ROUND(NVL(PEF.BASE_PRC_DEAL_AMT, 0) + NVL(PEF.BASE_PRC_DEAL_AMT, 0) * DMER.UPLFT_BASE_PRC_UP_RATIO / 100, 2)
                                <!-- END 2018/06/20 U.Kim [QC#24903, MOD] -->
                            END
                END                          AS NEW_PRC_DEAL_AMT
            <!-- END 2017/09/28 K.Kojima [QC#18376, MOD] -->
            <!-- END 2018/05/22 K.Kitachi [QC#26070, MOD] -->
            ,3                                  SORT_NUM
            ,DTL.DS_CONTR_DTL_TP_CD             DS_CONTR_DTL_TP_CD
            ,HDR.EZUPTIME                       EZUPTIME_H
            ,HDR.EZUPTIMEZONE                   EZUPTIMEZONE_H
            ,DTL.EZUPTIME                       EZUPTIME_D
            ,DTL.EZUPTIMEZONE                   EZUPTIMEZONE_D
<!-- START 2016/12/08 N.Arai [QC#14204, ADD] -->
            ,DTL.EZINTIME                       XX_REC_HIST_CRAT_TS
            ,DTL.EZINUSERID                     XX_REC_HIST_CRAT_BY_NM
            ,DTL.EZUPTIME                       XX_REC_HIST_UPD_TS
            ,DTL.EZUPUSERID                     XX_REC_HIST_UPD_BY_NM
            ,DTL.EZTABLEID                      XX_REC_HIST_TBL_NM
<!-- END 2016/12/08 N.Arai [QC#14204, ADD] -->
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            ,NULL                            AS RNW_PRC_METH_CD_USG
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
            <!-- START 2018/05/18 K.Kojima [QC#26187, ADD] -->
            ,NVL(SMMP.SER_NUM, SMM.SER_NUM)      AS SORT_SER_NUM
            ,NVL(SMMP.MDSE_CD, SMM.MDSE_CD)      AS SORT_MDSE_CD
            ,CDT.DS_CONTR_DTL_TP_SORT_NUM
            <!-- END 2018/05/18 K.Kojima [QC#26187, ADD] -->
            <!-- add start 2019/05/14 QC#50331 -->
            ,SPT.SVC_PGM_TP_SORT_NUM
            ,NVL(DTL.DS_CONTR_CRAT_TP_CD, #dsContrCratTp#)       AS SORT_DS_CONTR_CRAT_TP_CD
            ,CASE WHEN SMMP.SVC_MACH_MSTR_PK IS NULL THEN DTL.DS_CONTR_DTL_PK
                  ELSE DTL.PRNT_DS_CONTR_DTL_PK
             END                                                 AS SORT_DS_CONTR_DTL_PK
            <!-- add end 2019/05/14 QC#50331 -->
        FROM
             DS_CONTR               HDR
            ,DS_CONTR_DTL           DTL
            ,SVC_MACH_MSTR          SMM
            ,SVC_CONFIG_MSTR        SCM
            ,MDL_NM                 MDL
            ,DS_CONTR_STS_V         DHS
            ,DS_CONTR_DTL_STS_V     DDS
            ,DS_CONTR_DTL_TP        CDT
            ,DS_CONTR_RNW_ESCL      ES1
            ,DS_CONTR_RNW_ESCL      ES2
            ,DS_CONTR_RNW_ESCL      ES3
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            ,DS_MDL_ESCL_RULE       DMER
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
            <!-- START 2018/03/29 K.Kojima [QC#24925, ADD] -->
            ,CONTR_AUTO_RNW_TP      RTP1
            ,CONTR_AUTO_RNW_TP      RTP2
            ,CONTR_AUTO_RNW_TP      RTP3
            <!-- END 2018/03/29 K.Kojima [QC#24925, ADD] -->
            <!-- START 2018/05/22 K.Kitachi [QC#26070, ADD] -->
            ,(
                SELECT
                     A.DS_CONTR_DTL_PK
                    ,B.BASE_PRC_DEAL_AMT
                    ,ROW_NUMBER() OVER(PARTITION BY A.DS_CONTR_DTL_PK ORDER BY B.CONTR_PRC_EFF_THRU_DT DESC) RNUM
                FROM
                     DS_CONTR_DTL     A
                    ,DS_CONTR_PRC_EFF B
                WHERE
                        A.GLBL_CMPY_CD    = #glblCmpyCd#
                    <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND A.DS_CONTR_PK IN (" close=")" conjunction=",">
                        #dsContrPk[]#
                    </iterate>
                    AND A.EZCANCELFLAG    = '0'
                    AND A.GLBL_CMPY_CD    = B.GLBL_CMPY_CD
                    AND A.DS_CONTR_DTL_PK = B.DS_CONTR_DTL_PK
                    AND B.BASE_CHRG_FLG   = 'Y'
                    AND B.EZCANCELFLAG    = '0'
            ) PEF
            <!-- END 2018/05/22 K.Kitachi [QC#26070, ADD] -->
            <!-- START 2018/05/18 K.Kojima [QC#26187, ADD] -->
            ,DS_CONTR_DTL           DTLP
            ,SVC_MACH_MSTR          SMMP
            <!-- END 2018/05/18 K.Kojima [QC#26187, ADD] -->
            <!-- add start 2019/05/14 QC#50331 -->
            ,MDSE                   MDSE
            ,SVC_PGM_TP             SPT
            <!-- add end 2019/05/14 QC#50331 -->
        WHERE
                HDR.GLBL_CMPY_CD                = #glblCmpyCd#
            <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND HDR.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND HDR.DS_CONTR_CATG_CD            = #dsContrCatgReg#
            AND HDR.EZCANCELFLAG                = '0'
            AND HDR.GLBL_CMPY_CD                = DTL.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK                 = DTL.DS_CONTR_PK
            AND DTL.EZCANCELFLAG                = '0'
            AND DTL.GLBL_CMPY_CD                = SMM.GLBL_CMPY_CD
            AND DTL.SVC_MACH_MSTR_PK            = SMM.SVC_MACH_MSTR_PK
            <iterate property="dsContrDtlPkArray" var="dsContrDtlPk[]" open="AND DTL.DS_CONTR_DTL_PK IN (" close=")" conjunction=",">
                #dsContrDtlPk[]#
            </iterate>
            AND SMM.EZCANCELFLAG                = '0'
            AND SMM.GLBL_CMPY_CD                = SCM.GLBL_CMPY_CD(+)
            AND SMM.SVC_CONFIG_MSTR_PK          = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.EZCANCELFLAG(+)             = '0'
            AND SCM.GLBL_CMPY_CD                = MDL.T_GLBL_CMPY_CD(+)
            AND SCM.MDL_ID                      = MDL.T_MDL_ID(+)
            AND MDL.EZCANCELFLAG(+)             = '0'
            AND HDR.GLBL_CMPY_CD                = DHS.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK                 = DHS.DS_CONTR_PK
            AND DHS.EZCANCELFLAG                = '0'
            AND DTL.GLBL_CMPY_CD                = DDS.GLBL_CMPY_CD
            AND DTL.DS_CONTR_PK                 = DDS.DS_CONTR_PK
            AND DTL.DS_CONTR_DTL_PK             = DDS.DS_CONTR_DTL_PK
            AND DDS.EZCANCELFLAG                = '0'
            AND DTL.GLBL_CMPY_CD                = CDT.GLBL_CMPY_CD
            AND DTL.DS_CONTR_DTL_TP_CD          = CDT.DS_CONTR_DTL_TP_CD
            AND CDT.EZCANCELFLAG                = '0'
            <!-- START 2018/03/29 K.Kojima [QC#24925, DEL] -->
            <!-- AND CDT.MAIN_UNIT_LINE_FLG          = #mainUnitLineFlg# -->
            <!-- END 2018/03/29 K.Kojima [QC#24925, DEL] -->
            AND CDT.BASE_CHRG_FLG               = #baseChrgFlg#
            AND DTL.GLBL_CMPY_CD                = ES3.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES3.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK             = ES3.DS_CONTR_DTL_PK(+)
            AND ES3.DS_CONTR_BASE_USG_NM(+)     = #baseNm#
            AND ES3.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum3#
            AND ES3.EZCANCELFLAG(+)             = '0'
            AND DTL.GLBL_CMPY_CD                = ES2.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES2.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK             = ES2.DS_CONTR_DTL_PK(+)
            AND ES2.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum2#
            AND ES2.EZCANCELFLAG(+)             = '0'
            AND DTL.GLBL_CMPY_CD                = ES1.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES1.DS_CONTR_PK(+)
            AND ES1.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum1#
            AND ES1.EZCANCELFLAG(+)             = '0'
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            AND SCM.GLBL_CMPY_CD                = DMER.GLBL_CMPY_CD(+)
            AND SCM.MDL_ID                      = DMER.MDL_ID(+)
            AND DMER.EZCANCELFLAG(+)            = '0'
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
            <!-- START 2018/03/29 K.Kojima [QC#24925, ADD] -->
            AND ES1.GLBL_CMPY_CD                = RTP1.GLBL_CMPY_CD(+)
            AND ES1.CONTR_AUTO_RNW_TP_CD        = RTP1.CONTR_AUTO_RNW_TP_CD(+)
            AND ES1.EZCANCELFLAG(+)             = '0'
            AND ES2.GLBL_CMPY_CD                = RTP2.GLBL_CMPY_CD(+)
            AND ES2.CONTR_AUTO_RNW_TP_CD        = RTP2.CONTR_AUTO_RNW_TP_CD(+)
            AND ES2.EZCANCELFLAG(+)             = '0'
            AND ES3.GLBL_CMPY_CD                = RTP3.GLBL_CMPY_CD(+)
            AND ES3.CONTR_AUTO_RNW_TP_CD        = RTP3.CONTR_AUTO_RNW_TP_CD(+)
            AND ES3.EZCANCELFLAG(+)             = '0'
            <!-- END 2018/03/29 K.Kojima [QC#24925, ADD] -->
            <!-- START 2018/05/22 K.Kitachi [QC#26070, ADD] -->
            AND DTL.DS_CONTR_DTL_PK             = PEF.DS_CONTR_DTL_PK(+)
            AND PEF.RNUM(+)                     = 1
            <!-- END 2018/05/22 K.Kitachi [QC#26070, ADD] -->
            <!-- START 2018/05/18 K.Kojima [QC#26187, ADD] -->
            AND DTL.GLBL_CMPY_CD                = DTLP.GLBL_CMPY_CD(+)
            AND DTL.PRNT_DS_CONTR_DTL_PK        = DTLP.DS_CONTR_DTL_PK(+)
            AND DTL.EZCANCELFLAG(+)             = '0'
            AND DTLP.GLBL_CMPY_CD               = SMMP.GLBL_CMPY_CD(+)
            AND DTLP.SVC_MACH_MSTR_PK           = SMMP.SVC_MACH_MSTR_PK(+)
            AND SMMP.EZCANCELFLAG(+)            = '0'
            <!-- END 2018/05/18 K.Kojima [QC#26187, ADD] -->
            <!-- add start 2019/05/14 QC#50331 -->
            AND DTL.GLBL_CMPY_CD                = MDSE.GLBL_CMPY_CD(+)
            AND DTL.SVC_PGM_MDSE_CD             = MDSE.MDSE_CD(+)
            AND MDSE.EZCANCELFLAG(+)            = '0'
            AND MDSE.GLBL_CMPY_CD               = SPT.GLBL_CMPY_CD(+)
            AND MDSE.SVC_PGM_TP_CD              = SPT.SVC_PGM_TP_CD(+)
            AND SPT.EZCANCELFLAG(+)             = '0'
            <!-- add end 2019/05/14 QC#50331 -->
    UNION ALL
--Regular - overage
        SELECT
             HDR.DS_CONTR_PK                    DS_CONTR_PK
            ,DTL.DS_CONTR_DTL_PK                DS_CONTR_DTL_PK
            ,HDR.DS_CONTR_NUM                   DS_CONTR_NUM
            ,HDR.DS_CONTR_SRC_TP_CD             DS_CONTR_SRC_TP_CD
            ,HDR.DS_CONTR_CATG_CD               DS_CONTR_CATG_CD
            <!-- START 2017/10/27 K.Kojima [QC#21742,MOD] -->
            <!-- ,DHS.DS_CONTR_CTRL_STS_CD           HDR_STS_CD -->
            <!-- ,DDS.DS_CONTR_CTRL_STS_CD           DTL_STS_CD -->
            ,DHS.CONTR_RNW_AVAL_FLG             HDR_CONTR_RNW_AVAL_FLG
            ,DDS.CONTR_RNW_AVAL_FLG             DTL_CONTR_RNW_AVAL_FLG
            <!-- END 2017/10/27 K.Kojima [QC#21742,MOD] -->
            ,SMM.MDSE_CD                        MDSE_CD
            ,SMM.SVC_MACH_MSTR_PK               SVC_MACH_MSTR_PK
            ,SMM.SER_NUM                        SER_NUM
            ,MDL.T_MDL_NM                       T_MDL_NM
            ,#detailOverageNm#                  XX_SCR_ITEM_8_TXT
            ,DDS.DS_CONTR_CTRL_STS_NM           DS_CONTR_STS_NM
            ,DTL.CONTR_EFF_FROM_DT              CONTR_VRSN_EFF_FROM_DT
            <!-- START 2017/09/28 K.Kojima [QC#18376, MOD] -->
            <!-- ,CASE -->
            <!--     WHEN ES3.MTR_PRC_UP_RATIO IS NOT NULL -->
            <!--         THEN ES3.MTR_PRC_UP_RATIO -->
            <!--     WHEN ES2.MTR_PRC_UP_RATIO IS NOT NULL -->
            <!--         THEN ES2.MTR_PRC_UP_RATIO -->
            <!--     ELSE -->
            <!--              ES1.MTR_PRC_UP_RATIO -->
            <!--     END                          AS PRC_UP_RATIO -->
            ,CASE
                WHEN ES3.RNW_PRC_METH_CD IS NOT NULL AND ES3.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES3.MTR_PRC_UP_RATIO IS NOT NULL AND RTP3.RNW_USG_FLG = 'Y'
                    THEN ES3.MTR_PRC_UP_RATIO
                WHEN ES2.RNW_PRC_METH_CD IS NOT NULL AND ES2.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES2.MTR_PRC_UP_RATIO IS NOT NULL AND RTP2.RNW_USG_FLG = 'Y'
                    THEN ES2.MTR_PRC_UP_RATIO
                WHEN ES1.RNW_PRC_METH_CD IS NOT NULL AND ES1.RNW_PRC_METH_CD = #rnwPrcMethMarkup# AND ES1.MTR_PRC_UP_RATIO IS NOT NULL AND RTP1.RNW_USG_FLG = 'Y'
                    THEN ES1.MTR_PRC_UP_RATIO
                ELSE
                    NULL
                END                          AS PRC_UP_RATIO
            <!-- END 2017/09/28 K.Kojima [QC#18376, MOD] -->
            ,DTL.CONTR_EFF_THRU_DT              CONTR_VRSN_EFF_THRU_DT
            ,NULL                               BASE_PRC_DEAL_AMT
            ,NULL                               NEW_PRC_DEAL_AMT
            ,4                                  SORT_NUM
            ,DTL.DS_CONTR_DTL_TP_CD             DS_CONTR_DTL_TP_CD
            ,HDR.EZUPTIME                       EZUPTIME_H
            ,HDR.EZUPTIMEZONE                   EZUPTIMEZONE_H
            ,DTL.EZUPTIME                       EZUPTIME_D
            ,DTL.EZUPTIMEZONE                   EZUPTIMEZONE_D
<!-- START 2016/12/08 N.Arai [QC#14204, ADD] -->
            ,DTL.EZINTIME                       XX_REC_HIST_CRAT_TS
            ,DTL.EZINUSERID                     XX_REC_HIST_CRAT_BY_NM
            ,DTL.EZUPTIME                       XX_REC_HIST_UPD_TS
            ,DTL.EZUPUSERID                     XX_REC_HIST_UPD_BY_NM
            ,DTL.EZTABLEID                      XX_REC_HIST_TBL_NM
<!-- END 2016/12/08 N.Arai [QC#14204, ADD] -->
            <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
            ,CASE
                WHEN ES3.RNW_PRC_METH_CD IS NOT NULL AND RTP3.RNW_USG_FLG = 'Y'
                    THEN ES3.RNW_PRC_METH_CD
                WHEN ES2.RNW_PRC_METH_CD IS NOT NULL AND RTP2.RNW_USG_FLG = 'Y'
                    THEN ES2.RNW_PRC_METH_CD
                WHEN ES1.RNW_PRC_METH_CD IS NOT NULL AND RTP1.RNW_USG_FLG = 'Y'
                    THEN ES1.RNW_PRC_METH_CD
                ELSE
                    NULL
                END                          AS RNW_PRC_METH_CD_USG
            <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
            <!-- START 2018/05/18 K.Kojima [QC#26187, ADD] -->
            ,NVL(SMMP.SER_NUM, SMM.SER_NUM)      AS SORT_SER_NUM
            ,NVL(SMMP.MDSE_CD, SMM.MDSE_CD)      AS SORT_MDSE_CD
            ,CDT.DS_CONTR_DTL_TP_SORT_NUM
            <!-- END 2018/05/18 K.Kojima [QC#26187, ADD] -->
            <!-- add start 2019/05/14 QC#50331 -->
            ,SPT.SVC_PGM_TP_SORT_NUM
            ,NVL(DTL.DS_CONTR_CRAT_TP_CD, #dsContrCratTp#)       AS SORT_DS_CONTR_CRAT_TP_CD
            ,CASE WHEN SMMP.SVC_MACH_MSTR_PK IS NULL THEN DTL.DS_CONTR_DTL_PK
                  ELSE DTL.PRNT_DS_CONTR_DTL_PK
             END                                                 AS SORT_DS_CONTR_DTL_PK
            <!-- add end 2019/05/14 QC#50331 -->
        FROM
             DS_CONTR               HDR
            ,DS_CONTR_DTL           DTL
            ,SVC_MACH_MSTR          SMM
            ,SVC_CONFIG_MSTR        SCM
            ,MDL_NM                 MDL
            ,DS_CONTR_STS_V         DHS
            ,DS_CONTR_DTL_STS_V     DDS
            ,DS_CONTR_DTL_TP        CDT
            ,DS_CONTR_RNW_ESCL      ES1
            ,DS_CONTR_RNW_ESCL      ES2
            ,DS_CONTR_RNW_ESCL      ES3
            <!-- START 2018/03/29 K.Kojima [QC#24925, ADD] -->
            ,CONTR_AUTO_RNW_TP      RTP1
            ,CONTR_AUTO_RNW_TP      RTP2
            ,CONTR_AUTO_RNW_TP      RTP3
            <!-- END 2018/03/29 K.Kojima [QC#24925, ADD] -->
            <!-- START 2018/05/18 K.Kojima [QC#26187, ADD] -->
            ,DS_CONTR_DTL           DTLP
            ,SVC_MACH_MSTR          SMMP
            <!-- END 2018/05/18 K.Kojima [QC#26187, ADD] -->
            <!-- add start 2019/05/14 QC#50331 -->
            ,MDSE                   MDSE
            ,SVC_PGM_TP             SPT
            <!-- add end 2019/05/14 QC#50331 -->
        WHERE
                HDR.GLBL_CMPY_CD                = #glblCmpyCd#
            <iterate property="dsContrPkArray" var="dsContrPk[]" open="AND HDR.DS_CONTR_PK IN (" close=")" conjunction=",">
                #dsContrPk[]#
            </iterate>
            AND HDR.DS_CONTR_CATG_CD            = #dsContrCatgReg#
            AND HDR.EZCANCELFLAG                = '0'
            AND HDR.GLBL_CMPY_CD                = DTL.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK                 = DTL.DS_CONTR_PK
            AND DTL.EZCANCELFLAG                = '0'
            AND DTL.GLBL_CMPY_CD                = SMM.GLBL_CMPY_CD
            AND DTL.SVC_MACH_MSTR_PK            = SMM.SVC_MACH_MSTR_PK
            <iterate property="dsContrDtlPkArray" var="dsContrDtlPk[]" open="AND DTL.DS_CONTR_DTL_PK IN (" close=")" conjunction=",">
                #dsContrDtlPk[]#
            </iterate>
            AND SMM.EZCANCELFLAG                = '0'
            AND SMM.GLBL_CMPY_CD                = SCM.GLBL_CMPY_CD(+)
            AND SMM.SVC_CONFIG_MSTR_PK          = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.EZCANCELFLAG(+)             = '0'
            AND SCM.GLBL_CMPY_CD                = MDL.T_GLBL_CMPY_CD(+)
            AND SCM.MDL_ID                      = MDL.T_MDL_ID(+)
            AND MDL.EZCANCELFLAG(+)             = '0'
            AND HDR.GLBL_CMPY_CD                = DHS.GLBL_CMPY_CD
            AND HDR.DS_CONTR_PK                 = DHS.DS_CONTR_PK
            AND DHS.EZCANCELFLAG                = '0'
            AND DTL.GLBL_CMPY_CD                = DDS.GLBL_CMPY_CD
            AND DTL.DS_CONTR_PK                 = DDS.DS_CONTR_PK
            AND DTL.DS_CONTR_DTL_PK             = DDS.DS_CONTR_DTL_PK
            AND DDS.EZCANCELFLAG                = '0'
            AND DTL.GLBL_CMPY_CD                = CDT.GLBL_CMPY_CD
            AND DTL.DS_CONTR_DTL_TP_CD          = CDT.DS_CONTR_DTL_TP_CD
            AND CDT.EZCANCELFLAG                = '0'
            <!-- START 2018/03/29 K.Kojima [QC#24925, DEL] -->
            <!-- AND CDT.MAIN_UNIT_LINE_FLG          = #mainUnitLineFlg# -->
            <!-- END 2018/03/29 K.Kojima [QC#24925, DEL] -->
            AND CDT.USG_CHRG_FLG                = #usgChrgFlg#
            AND DTL.GLBL_CMPY_CD                = ES3.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES3.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK             = ES3.DS_CONTR_DTL_PK(+)
            AND ES3.DS_CONTR_BASE_USG_NM(+)     = #usgNm#
            AND ES3.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum3#
            AND ES3.EZCANCELFLAG(+)             = '0'
            AND DTL.GLBL_CMPY_CD                = ES2.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES2.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK             = ES2.DS_CONTR_DTL_PK(+)
            AND ES2.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum2#
            AND ES2.EZCANCELFLAG(+)             = '0'
            AND DTL.GLBL_CMPY_CD                = ES1.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES1.DS_CONTR_PK(+)
            AND ES1.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum1#
            AND ES1.EZCANCELFLAG(+)             = '0'
            <!-- START 2018/03/29 K.Kojima [QC#24925, ADD] -->
            AND ES1.GLBL_CMPY_CD                = RTP1.GLBL_CMPY_CD(+)
            AND ES1.CONTR_AUTO_RNW_TP_CD        = RTP1.CONTR_AUTO_RNW_TP_CD(+)
            AND ES1.EZCANCELFLAG(+)             = '0'
            AND ES2.GLBL_CMPY_CD                = RTP2.GLBL_CMPY_CD(+)
            AND ES2.CONTR_AUTO_RNW_TP_CD        = RTP2.CONTR_AUTO_RNW_TP_CD(+)
            AND ES2.EZCANCELFLAG(+)             = '0'
            AND ES3.GLBL_CMPY_CD                = RTP3.GLBL_CMPY_CD(+)
            AND ES3.CONTR_AUTO_RNW_TP_CD        = RTP3.CONTR_AUTO_RNW_TP_CD(+)
            AND ES3.EZCANCELFLAG(+)             = '0'
            <!-- END 2018/03/29 K.Kojima [QC#24925, ADD] -->
            <!-- START 2018/05/18 K.Kojima [QC#26187, ADD] -->
            AND DTL.GLBL_CMPY_CD                = DTLP.GLBL_CMPY_CD(+)
            AND DTL.PRNT_DS_CONTR_DTL_PK        = DTLP.DS_CONTR_DTL_PK(+)
            AND DTL.EZCANCELFLAG(+)             = '0'
            AND DTLP.GLBL_CMPY_CD               = SMMP.GLBL_CMPY_CD(+)
            AND DTLP.SVC_MACH_MSTR_PK           = SMMP.SVC_MACH_MSTR_PK(+)
            AND SMMP.EZCANCELFLAG(+)            = '0'
            <!-- END 2018/05/18 K.Kojima [QC#26187, ADD] -->
            <!-- add start 2019/05/14 QC#50331 -->
            AND DTL.GLBL_CMPY_CD                = MDSE.GLBL_CMPY_CD(+)
            AND DTL.SVC_PGM_MDSE_CD             = MDSE.MDSE_CD(+)
            AND MDSE.EZCANCELFLAG(+)            = '0'
            AND MDSE.GLBL_CMPY_CD               = SPT.GLBL_CMPY_CD(+)
            AND MDSE.SVC_PGM_TP_CD              = SPT.SVC_PGM_TP_CD(+)
            AND SPT.EZCANCELFLAG(+)             = '0'
            <!-- add end 2019/05/14 QC#50331 -->
        ORDER BY
             DS_CONTR_CATG_CD
            ,DS_CONTR_NUM
            <!-- START 2018/05/18 K.Kojima [QC#26187, ADD] -->
            <!-- ,SER_NUM -->
            ,SORT_SER_NUM
            ,SORT_MDSE_CD
            <!-- add start 2019/05/14 QC#50331 -->
            ,SVC_PGM_TP_SORT_NUM
            ,SORT_DS_CONTR_CRAT_TP_CD
            ,SORT_DS_CONTR_DTL_PK
            <!-- add end 2019/05/14 QC#50331 -->
            ,DS_CONTR_DTL_TP_SORT_NUM
            <!-- END 2018/05/18 K.Kojima [QC#26187, ADD] -->
            <!-- add start 2019/05/14 QC#50331 -->
            ,DS_CONTR_DTL_PK
            <!-- add start 2019/05/14 QC#50331 -->
            ,SORT_NUM
    </statement>
    <resultMap id="result.getContrDtlInfo" class="NSAL0690_BCMsg">
        <result property="dsContrPk_B1" column="DS_CONTR_PK"  javaType="EZDCBigDecimalItem" />
        <result property="dsContrDtlPk_B1" column="DS_CONTR_DTL_PK"  javaType="EZDCBigDecimalItem" />
        <result property="dsContrNum_B1" column="DS_CONTR_NUM"  javaType="EZDCStringItem" />
        <result property="dsContrSrcTpCd_B1" column="DS_CONTR_SRC_TP_CD"  javaType="EZDCStringItem" />
        <result property="dsContrCatgCd_B1" column="DS_CONTR_CATG_CD"  javaType="EZDCStringItem" />
        <!-- START 2017/10/27 K.Kojima [QC#21742,MOD] -->
        <!-- <result property="dsContrCtrlStsCd_BH" column="HDR_STS_CD"  javaType="EZDCStringItem" /> -->
        <!-- <result property="dsContrCtrlStsCd_BD" column="DTL_STS_CD"  javaType="EZDCStringItem" /> -->
        <result property="contrRnwAvalFlg_BH" column="HDR_CONTR_RNW_AVAL_FLG"  javaType="EZDCStringItem" />
        <result property="contrRnwAvalFlg_BD" column="DTL_CONTR_RNW_AVAL_FLG"  javaType="EZDCStringItem" />
        <!-- END 2017/10/27 K.Kojima [QC#21742,MOD] -->
        <result property="mdseCd_B1" column="MDSE_CD"  javaType="EZDCStringItem" />
        <result property="svcMachMstrPk_B1" column="SVC_MACH_MSTR_PK"  javaType="EZDCBigDecimalItem" />
        <result property="serNum_B1" column="SER_NUM"  javaType="EZDCStringItem" />
        <result property="t_MdlNm_B1" column="T_MDL_NM"  javaType="EZDCStringItem" />
        <result property="xxScrItem8Txt_B1" column="XX_SCR_ITEM_8_TXT"  javaType="EZDCStringItem" />
        <result property="dsContrCtrlStsNm_B1" column="DS_CONTR_STS_NM"  javaType="EZDCStringItem" />
        <result property="contrEffFromDt_B1" column="CONTR_VRSN_EFF_FROM_DT"  javaType="EZDCDateItem" />
        <result property="xxDiscRatio_B1" column="PRC_UP_RATIO"  javaType="EZDCBigDecimalItem" />
        <result property="contrEffThruDt_B1" column="CONTR_VRSN_EFF_THRU_DT"  javaType="EZDCDateItem" />
        <result property="basePrcDealAmt_B1" column="BASE_PRC_DEAL_AMT"  javaType="EZDCBigDecimalItem" />
        <result property="newBaseDealAmt_B1" column="NEW_PRC_DEAL_AMT"  javaType="EZDCBigDecimalItem" />
        <result property="dsContrDtlTpCd_B1" column="DS_CONTR_DTL_TP_CD"  javaType="EZDCStringItem" />
        <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
        <result property="rnwPrcMethCd_B1" column="RNW_PRC_METH_CD_USG"  javaType="EZDCStringItem" />
        <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
        <result property="ezUpTime_H" column="EZUPTIME_H"  javaType="EZDCStringItem" />
        <result property="ezUpTimeZone_H" column="EZUPTIMEZONE_H"  javaType="EZDCStringItem" />
        <result property="ezUpTime_D" column="EZUPTIME_D"  javaType="EZDCStringItem" />
        <result property="ezUpTimeZone_D" column="EZUPTIMEZONE_D"  javaType="EZDCStringItem" />
<!-- START 2016/12/08 N.Arai [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_B"   column="XX_REC_HIST_CRAT_TS"       javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_B" column="XX_REC_HIST_CRAT_BY_NM"    javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_B"    column="XX_REC_HIST_UPD_TS"        javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_B"  column="XX_REC_HIST_UPD_BY_NM"     javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_B"    column="XX_REC_HIST_TBL_NM"        javaType="EZDSStringItem"/>
<!-- END 2016/12/08 N.Arai [QC#14204, ADD] -->
    </resultMap>
    <statement id="getNewPeriodEnd" parameterClass="Map" resultClass="String">
        SELECT
            TO_CHAR(
                (TO_DATE(DTL.CONTR_EFF_THRU_DT, 'YYYY/MM/DD')
                 + TO_NUMBER(TO_DATE(PEF.CONTR_PRC_EFF_THRU_DT, 'YYYY/MM/DD')
                           - TO_DATE(PEF.CONTR_PRC_EFF_FROM_DT, 'YYYY/MM/DD')
                            )
                ), 'YYYYMMDD')                  NEW_PERIOD_END
        FROM
             DS_CONTR_DTL           DTL
            ,DS_CONTR_PRC_EFF       PEF
            ,DS_CONTR_PRC_EFF_STS_V PEV
        WHERE
                DTL.GLBL_CMPY_CD            = #glblCmpyCd#
            AND DTL.DS_CONTR_DTL_PK         = #dsContrDtlPk#
            AND DTL.EZCANCELFLAG            = '0'
            AND DTL.GLBL_CMPY_CD            = PEF.GLBL_CMPY_CD
            AND DTL.DS_CONTR_DTL_PK         = PEF.DS_CONTR_DTL_PK
            AND PEF.EZCANCELFLAG            = '0'
            AND PEF.GLBL_CMPY_CD            = PEV.GLBL_CMPY_CD
            AND PEF.DS_CONTR_PRC_EFF_PK     = PEV.DS_CONTR_PRC_EFF_PK
            AND PEV.DS_CONTR_CTRL_STS_CD    = #dsContrCtrlSts#
            AND PEV.EZCANCELFLAG            = '0'
    </statement>

    <!-- START 2015/11/26 T.Tsuchida [QC#1225,MOD] -->
    <statement id="getPrcUpRatio" parameterClass="Map" resultClass="Map">
        SELECT
             DTL.DS_CONTR_DTL_PK                DS_CONTR_DTL_PK
            ,CASE
                WHEN ES3.MTR_PRC_UP_RATIO IS NOT NULL
                    THEN ES3.MTR_PRC_UP_RATIO
                WHEN ES2.MTR_PRC_UP_RATIO IS NOT NULL
                    THEN ES2.MTR_PRC_UP_RATIO
                ELSE
                         ES1.MTR_PRC_UP_RATIO
                END                          AS MTR_PRC_UP_RATIO
            ,CASE
                WHEN ES3.BASE_PRC_UP_RATIO IS NOT NULL
                    THEN ES3.BASE_PRC_UP_RATIO
                WHEN ES2.BASE_PRC_UP_RATIO IS NOT NULL
                    THEN ES2.BASE_PRC_UP_RATIO
                ELSE
                         ES1.BASE_PRC_UP_RATIO
                END                          AS BASE_PRC_UP_RATIO
        FROM
             DS_CONTR_DTL           DTL
            ,DS_CONTR_RNW_ESCL      ES1
            ,DS_CONTR_RNW_ESCL      ES2
            ,DS_CONTR_RNW_ESCL      ES3
        WHERE
                DTL.GLBL_CMPY_CD                = #glblCmpyCd#
            AND DTL.DS_CONTR_PK                 = #dsContrPk#
        <isNotNull property="dsContrDtlTp">
            AND DTL.DS_CONTR_DTL_TP_CD          = #dsContrDtlTp#
        </isNotNull>
            AND DTL.EZCANCELFLAG                = '0'
            AND DTL.GLBL_CMPY_CD                = ES3.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES3.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK             = ES3.DS_CONTR_DTL_PK(+)
            AND ES3.DS_CONTR_BASE_USG_NM(+)     = #usgNm#
            AND ES3.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum3#
            AND ES3.EZCANCELFLAG(+)             = '0'
            AND DTL.GLBL_CMPY_CD                = ES2.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES2.DS_CONTR_PK(+)
            AND DTL.DS_CONTR_DTL_PK             = ES2.DS_CONTR_DTL_PK(+)
            AND ES2.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum2#
            AND ES2.EZCANCELFLAG(+)             = '0'
            AND DTL.GLBL_CMPY_CD                = ES1.GLBL_CMPY_CD(+)
            AND DTL.DS_CONTR_PK                 = ES1.DS_CONTR_PK(+)
            AND ES1.DS_CONTR_MACH_LVL_NUM(+)    = #MachLvlNum1#
            AND ES1.EZCANCELFLAG(+)             = '0'
    </statement>
    <!-- END 2015/11/26 T.Tsuchida [QC#1225,MOD] -->
<!-- START 2017/02/08 K.Kitachi [QC#17410, ADD] -->
    <statement id="countCfsDlr" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             BILL_TO_CUST    BTC
            ,SELL_TO_CUST    STC
        WHERE
                BTC.GLBL_CMPY_CD    = #glblCmpyCd#
            AND BTC.BILL_TO_CUST_CD = #billToCustCd#
            AND BTC.EZCANCELFLAG    = '0'
            AND BTC.GLBL_CMPY_CD    = STC.GLBL_CMPY_CD
            AND BTC.SELL_TO_CUST_CD = STC.SELL_TO_CUST_CD
            AND STC.DS_ACCT_DLR_CD  = #cfsDlrCd#
            AND STC.EZCANCELFLAG    = '0'
    </statement>
    <statement id="getRegAndAggBase" parameterClass="Map" resultClass="Map">
        SELECT
             X.UPLFT_EFF_FROM_DT
            ,X.SER_NUM
            ,X.MDL_ID
            ,X.MDL_NM
            ,X.PRC_UP_RATIO
            ,X.DS_CONTR_DTL_TP_CD
            ,X.SVC_MACH_MSTR_PK
        FROM
            (
                SELECT
                     DCD.RNW_EFF_FROM_DT       AS UPLFT_EFF_FROM_DT
                    ,SMM.SER_NUM               AS SER_NUM
                    ,MNM.T_MDL_ID              AS MDL_ID
                    ,MNM.T_MDL_NM              AS MDL_NM
                    ,CRE.BASE_PRC_UP_RATIO     AS PRC_UP_RATIO
                    ,DCD.DS_CONTR_DTL_TP_CD    AS DS_CONTR_DTL_TP_CD
                    ,SMM.SVC_MACH_MSTR_PK      AS SVC_MACH_MSTR_PK
                    ,CRE.DS_CONTR_MACH_LVL_NUM AS DS_CONTR_MACH_LVL_NUM
                FROM
                     DS_CONTR_DTL      DCD
                    ,DS_CONTR_RNW_ESCL CRE
                    ,CONTR_AUTO_RNW_TP RTP
                    ,SVC_MACH_MSTR     SMM
                    ,SVC_CONFIG_MSTR   SCM
                    ,MDL_NM            MNM
                WHERE
                        DCD.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND DCD.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                    AND DCD.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CRE.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_PK           = CRE.DS_CONTR_PK
                    AND CRE.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl1#
                    AND CRE.EZCANCELFLAG          = '0'
                    AND CRE.GLBL_CMPY_CD          = RTP.GLBL_CMPY_CD
                    AND CRE.CONTR_AUTO_RNW_TP_CD  = RTP.CONTR_AUTO_RNW_TP_CD
                    <!-- START 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    <!-- AND RTP.AUTO_RNW_FLG          = 'N'-->
                    <!-- END 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    AND RTP.RNW_BASE_FLG          = 'Y'
                    AND RTP.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = SMM.GLBL_CMPY_CD
                    AND DCD.SVC_MACH_MSTR_PK      = SMM.SVC_MACH_MSTR_PK
                    AND SMM.EZCANCELFLAG          = '0'
                    AND SMM.GLBL_CMPY_CD          = SCM.GLBL_CMPY_CD
                    AND SMM.SVC_CONFIG_MSTR_PK    = SCM.SVC_CONFIG_MSTR_PK
                    AND SCM.EZCANCELFLAG          = '0'
                    AND SCM.GLBL_CMPY_CD          = MNM.T_GLBL_CMPY_CD
                    AND SCM.MDL_ID                = MNM.T_MDL_ID
                    AND MNM.EZCANCELFLAG          = '0'
                UNION
                SELECT
                     DCD.RNW_EFF_FROM_DT       AS UPLFT_EFF_FROM_DT
                    ,SMM.SER_NUM               AS SER_NUM
                    ,MNM.T_MDL_ID              AS MDL_ID
                    ,MNM.T_MDL_NM              AS MDL_NM
                    ,CRE.BASE_PRC_UP_RATIO     AS PRC_UP_RATIO
                    ,DCD.DS_CONTR_DTL_TP_CD    AS DS_CONTR_DTL_TP_CD
                    ,SMM.SVC_MACH_MSTR_PK      AS SVC_MACH_MSTR_PK
                    ,CRE.DS_CONTR_MACH_LVL_NUM AS DS_CONTR_MACH_LVL_NUM
                FROM
                     DS_CONTR_DTL      DCD
                    ,DS_CONTR_RNW_ESCL CRE
                    ,CONTR_AUTO_RNW_TP RTP
                    ,SVC_MACH_MSTR     SMM
                    ,SVC_CONFIG_MSTR   SCM
                    ,MDL_NM            MNM
                WHERE
                        DCD.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND DCD.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                    AND DCD.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CRE.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK       = CRE.DS_CONTR_DTL_PK
                    AND CRE.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl2#
                    AND CRE.EZCANCELFLAG          = '0'
                    AND CRE.GLBL_CMPY_CD          = RTP.GLBL_CMPY_CD
                    AND CRE.CONTR_AUTO_RNW_TP_CD  = RTP.CONTR_AUTO_RNW_TP_CD
                    <!-- START 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    <!-- AND RTP.AUTO_RNW_FLG          = 'N'-->
                    <!-- END 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    AND RTP.RNW_BASE_FLG          = 'Y'
                    AND RTP.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = SMM.GLBL_CMPY_CD
                    AND DCD.SVC_MACH_MSTR_PK      = SMM.SVC_MACH_MSTR_PK
                    AND SMM.EZCANCELFLAG          = '0'
                    AND SMM.GLBL_CMPY_CD          = SCM.GLBL_CMPY_CD
                    AND SMM.SVC_CONFIG_MSTR_PK    = SCM.SVC_CONFIG_MSTR_PK
                    AND SCM.EZCANCELFLAG          = '0'
                    AND SCM.GLBL_CMPY_CD          = MNM.T_GLBL_CMPY_CD
                    AND SCM.MDL_ID                = MNM.T_MDL_ID
                    AND MNM.EZCANCELFLAG          = '0'
                UNION
                SELECT
                     DCD.RNW_EFF_FROM_DT       AS UPLFT_EFF_FROM_DT
                    ,SMM.SER_NUM               AS SER_NUM
                    ,MNM.T_MDL_ID              AS MDL_ID
                    ,MNM.T_MDL_NM              AS MDL_NM
                    ,CRE.BASE_PRC_UP_RATIO     AS PRC_UP_RATIO
                    ,DCD.DS_CONTR_DTL_TP_CD    AS DS_CONTR_DTL_TP_CD
                    ,SMM.SVC_MACH_MSTR_PK      AS SVC_MACH_MSTR_PK
                    ,CRE.DS_CONTR_MACH_LVL_NUM AS DS_CONTR_MACH_LVL_NUM
                FROM
                     DS_CONTR_DTL      DCD
                    ,DS_CONTR_RNW_ESCL CRE
                    ,CONTR_AUTO_RNW_TP RTP
                    ,SVC_MACH_MSTR     SMM
                    ,SVC_CONFIG_MSTR   SCM
                    ,MDL_NM            MNM
                WHERE
                        DCD.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND DCD.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                    AND DCD.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CRE.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK       = CRE.DS_CONTR_DTL_PK
                    AND CRE.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl3#
                    AND CRE.DS_CONTR_BASE_USG_NM  = #dsContrBaseUsgNm#
                    AND CRE.EZCANCELFLAG          = '0'
                    AND CRE.GLBL_CMPY_CD          = RTP.GLBL_CMPY_CD
                    AND CRE.CONTR_AUTO_RNW_TP_CD  = RTP.CONTR_AUTO_RNW_TP_CD
                    <!-- START 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    <!-- AND RTP.AUTO_RNW_FLG          = 'N'-->
                    <!-- END 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    AND RTP.RNW_BASE_FLG          = 'Y'
                    AND RTP.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = SMM.GLBL_CMPY_CD
                    AND DCD.SVC_MACH_MSTR_PK      = SMM.SVC_MACH_MSTR_PK
                    AND SMM.EZCANCELFLAG          = '0'
                    AND SMM.GLBL_CMPY_CD          = SCM.GLBL_CMPY_CD
                    AND SMM.SVC_CONFIG_MSTR_PK    = SCM.SVC_CONFIG_MSTR_PK
                    AND SCM.EZCANCELFLAG          = '0'
                    AND SCM.GLBL_CMPY_CD          = MNM.T_GLBL_CMPY_CD
                    AND SCM.MDL_ID                = MNM.T_MDL_ID
                    AND MNM.EZCANCELFLAG          = '0'
                ORDER BY
                    DS_CONTR_MACH_LVL_NUM DESC
            ) X
        WHERE
            ROWNUM = 1
    </statement>
    <statement id="getRegAndAggUsg" parameterClass="Map" resultClass="Map">
        SELECT
             X.UPLFT_EFF_FROM_DT
            ,X.SER_NUM
            ,X.MDL_ID
            ,X.MDL_NM
            ,X.PRC_UP_RATIO
            ,X.DS_CONTR_DTL_TP_CD
            ,X.SVC_MACH_MSTR_PK
            ,X.DS_CONTR_BLLG_MTR_PK
            ,X.MTR_LB_CD
        FROM
            (
                SELECT
                     DCD.RNW_EFF_FROM_DT       AS UPLFT_EFF_FROM_DT
                    ,SMM.SER_NUM               AS SER_NUM
                    ,MNM.T_MDL_ID              AS MDL_ID
                    ,MNM.T_MDL_NM              AS MDL_NM
                    ,CRE.MTR_PRC_UP_RATIO      AS PRC_UP_RATIO
                    ,DCD.DS_CONTR_DTL_TP_CD    AS DS_CONTR_DTL_TP_CD
                    ,SMM.SVC_MACH_MSTR_PK      AS SVC_MACH_MSTR_PK
                    ,CBM.DS_CONTR_BLLG_MTR_PK  AS DS_CONTR_BLLG_MTR_PK
                    ,CBM.BLLG_MTR_LB_CD        AS MTR_LB_CD
                    ,CRE.DS_CONTR_MACH_LVL_NUM AS DS_CONTR_MACH_LVL_NUM
                FROM
                     DS_CONTR_DTL      DCD
                    ,DS_CONTR_BLLG_MTR CBM
                    ,DS_CONTR_RNW_ESCL CRE
                    ,CONTR_AUTO_RNW_TP RTP
                    ,SVC_MACH_MSTR     SMM
                    ,SVC_CONFIG_MSTR   SCM
                    ,MDL_NM            MNM
                WHERE
                        DCD.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND DCD.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                    AND DCD.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CBM.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK       = CBM.DS_CONTR_DTL_PK
                    AND CBM.DS_CONTR_BLLG_MTR_PK  = #dsContrBllgMtrPk#
                    AND CBM.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CRE.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_PK           = CRE.DS_CONTR_PK
                    AND CRE.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl1#
                    AND CRE.EZCANCELFLAG          = '0'
                    AND CRE.GLBL_CMPY_CD          = RTP.GLBL_CMPY_CD
                    AND CRE.CONTR_AUTO_RNW_TP_CD  = RTP.CONTR_AUTO_RNW_TP_CD
                    <!-- START 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    <!-- AND RTP.AUTO_RNW_FLG          = 'N'-->
                    <!-- END 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    AND RTP.RNW_USG_FLG           = 'Y'
                    AND RTP.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = SMM.GLBL_CMPY_CD
                    AND DCD.SVC_MACH_MSTR_PK      = SMM.SVC_MACH_MSTR_PK
                    AND SMM.EZCANCELFLAG          = '0'
                    AND SMM.GLBL_CMPY_CD          = SCM.GLBL_CMPY_CD
                    AND SMM.SVC_CONFIG_MSTR_PK    = SCM.SVC_CONFIG_MSTR_PK
                    AND SCM.EZCANCELFLAG          = '0'
                    AND SCM.GLBL_CMPY_CD          = MNM.T_GLBL_CMPY_CD
                    AND SCM.MDL_ID                = MNM.T_MDL_ID
                    AND MNM.EZCANCELFLAG          = '0'
                UNION
                SELECT
                     DCD.RNW_EFF_FROM_DT       AS UPLFT_EFF_FROM_DT
                    ,SMM.SER_NUM               AS SER_NUM
                    ,MNM.T_MDL_ID              AS MDL_ID
                    ,MNM.T_MDL_NM              AS MDL_NM
                    ,CRE.MTR_PRC_UP_RATIO      AS PRC_UP_RATIO
                    ,DCD.DS_CONTR_DTL_TP_CD    AS DS_CONTR_DTL_TP_CD
                    ,SMM.SVC_MACH_MSTR_PK      AS SVC_MACH_MSTR_PK
                    ,CBM.DS_CONTR_BLLG_MTR_PK  AS DS_CONTR_BLLG_MTR_PK
                    ,CBM.BLLG_MTR_LB_CD        AS MTR_LB_CD
                    ,CRE.DS_CONTR_MACH_LVL_NUM AS DS_CONTR_MACH_LVL_NUM
                FROM
                     DS_CONTR_DTL      DCD
                    ,DS_CONTR_BLLG_MTR CBM
                    ,DS_CONTR_RNW_ESCL CRE
                    ,CONTR_AUTO_RNW_TP RTP
                    ,SVC_MACH_MSTR     SMM
                    ,SVC_CONFIG_MSTR   SCM
                    ,MDL_NM            MNM
                WHERE
                        DCD.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND DCD.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                    AND DCD.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CBM.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK       = CBM.DS_CONTR_DTL_PK
                    AND CBM.DS_CONTR_BLLG_MTR_PK  = #dsContrBllgMtrPk#
                    AND CBM.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CRE.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK       = CRE.DS_CONTR_DTL_PK
                    AND CRE.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl2#
                    AND CRE.EZCANCELFLAG          = '0'
                    AND CRE.GLBL_CMPY_CD          = RTP.GLBL_CMPY_CD
                    AND CRE.CONTR_AUTO_RNW_TP_CD  = RTP.CONTR_AUTO_RNW_TP_CD
                    <!-- START 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    <!-- AND RTP.AUTO_RNW_FLG          = 'N'-->
                    <!-- END 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    AND RTP.RNW_USG_FLG           = 'Y'
                    AND RTP.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = SMM.GLBL_CMPY_CD
                    AND DCD.SVC_MACH_MSTR_PK      = SMM.SVC_MACH_MSTR_PK
                    AND SMM.EZCANCELFLAG          = '0'
                    AND SMM.GLBL_CMPY_CD          = SCM.GLBL_CMPY_CD
                    AND SMM.SVC_CONFIG_MSTR_PK    = SCM.SVC_CONFIG_MSTR_PK
                    AND SCM.EZCANCELFLAG          = '0'
                    AND SCM.GLBL_CMPY_CD          = MNM.T_GLBL_CMPY_CD
                    AND SCM.MDL_ID                = MNM.T_MDL_ID
                    AND MNM.EZCANCELFLAG          = '0'
                UNION
                SELECT
                     DCD.RNW_EFF_FROM_DT       AS UPLFT_EFF_FROM_DT
                    ,SMM.SER_NUM               AS SER_NUM
                    ,MNM.T_MDL_ID              AS MDL_ID
                    ,MNM.T_MDL_NM              AS MDL_NM
                    ,CRE.MTR_PRC_UP_RATIO      AS PRC_UP_RATIO
                    ,DCD.DS_CONTR_DTL_TP_CD    AS DS_CONTR_DTL_TP_CD
                    ,SMM.SVC_MACH_MSTR_PK      AS SVC_MACH_MSTR_PK
                    ,CBM.DS_CONTR_BLLG_MTR_PK  AS DS_CONTR_BLLG_MTR_PK
                    ,CBM.BLLG_MTR_LB_CD        AS MTR_LB_CD
                    ,CRE.DS_CONTR_MACH_LVL_NUM AS DS_CONTR_MACH_LVL_NUM
                FROM
                     DS_CONTR_DTL      DCD
                    ,DS_CONTR_BLLG_MTR CBM
                    ,DS_CONTR_RNW_ESCL CRE
                    ,CONTR_AUTO_RNW_TP RTP
                    ,SVC_MACH_MSTR     SMM
                    ,SVC_CONFIG_MSTR   SCM
                    ,MDL_NM            MNM
                WHERE
                        DCD.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND DCD.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                    AND DCD.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CBM.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK       = CBM.DS_CONTR_DTL_PK
                    AND CBM.DS_CONTR_BLLG_MTR_PK  = #dsContrBllgMtrPk#
                    AND CBM.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CRE.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK       = CRE.DS_CONTR_DTL_PK
                    AND CRE.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl3#
                    AND CRE.DS_CONTR_BASE_USG_NM  = #dsContrBaseUsgNm#
                    AND CRE.EZCANCELFLAG          = '0'
                    AND CRE.GLBL_CMPY_CD          = RTP.GLBL_CMPY_CD
                    AND CRE.CONTR_AUTO_RNW_TP_CD  = RTP.CONTR_AUTO_RNW_TP_CD
                    <!-- START 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    <!-- AND RTP.AUTO_RNW_FLG          = 'N'-->
                    <!-- END 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    AND RTP.RNW_USG_FLG           = 'Y'
                    AND RTP.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = SMM.GLBL_CMPY_CD
                    AND DCD.SVC_MACH_MSTR_PK      = SMM.SVC_MACH_MSTR_PK
                    AND SMM.EZCANCELFLAG          = '0'
                    AND SMM.GLBL_CMPY_CD          = SCM.GLBL_CMPY_CD
                    AND SMM.SVC_CONFIG_MSTR_PK    = SCM.SVC_CONFIG_MSTR_PK
                    AND SCM.EZCANCELFLAG          = '0'
                    AND SCM.GLBL_CMPY_CD          = MNM.T_GLBL_CMPY_CD
                    AND SCM.MDL_ID                = MNM.T_MDL_ID
                    AND MNM.EZCANCELFLAG          = '0'
                ORDER BY
                    DS_CONTR_MACH_LVL_NUM DESC
            ) X
        WHERE
            ROWNUM = 1
    </statement>
    <statement id="getFltBase" parameterClass="Map" resultClass="Map">
        SELECT
             X.UPLFT_EFF_FROM_DT
            ,X.PRC_UP_RATIO
            ,X.DS_CONTR_DTL_TP_CD
        FROM
            (
                SELECT
                     DCD.RNW_EFF_FROM_DT       AS UPLFT_EFF_FROM_DT
                    ,CRE.BASE_PRC_UP_RATIO     AS PRC_UP_RATIO
                    ,DCD.DS_CONTR_DTL_TP_CD    AS DS_CONTR_DTL_TP_CD
                    ,CRE.DS_CONTR_MACH_LVL_NUM AS DS_CONTR_MACH_LVL_NUM
                FROM
                     DS_CONTR_DTL      DCD
                    ,DS_CONTR_RNW_ESCL CRE
                    ,CONTR_AUTO_RNW_TP RTP
                WHERE
                        DCD.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND DCD.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                    AND DCD.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CRE.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_PK           = CRE.DS_CONTR_PK
                    AND CRE.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl1#
                    AND CRE.EZCANCELFLAG          = '0'
                    AND CRE.GLBL_CMPY_CD          = RTP.GLBL_CMPY_CD
                    AND CRE.CONTR_AUTO_RNW_TP_CD  = RTP.CONTR_AUTO_RNW_TP_CD
                    <!-- START 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    <!-- AND RTP.AUTO_RNW_FLG          = 'N'-->
                    <!-- END 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    AND RTP.RNW_BASE_FLG          = 'Y'
                    AND RTP.EZCANCELFLAG          = '0'
                UNION
                SELECT
                     DCD.RNW_EFF_FROM_DT       AS UPLFT_EFF_FROM_DT
                    ,CRE.BASE_PRC_UP_RATIO     AS PRC_UP_RATIO
                    ,DCD.DS_CONTR_DTL_TP_CD    AS DS_CONTR_DTL_TP_CD
                    ,CRE.DS_CONTR_MACH_LVL_NUM AS DS_CONTR_MACH_LVL_NUM
                FROM
                     DS_CONTR_DTL      DCD
                    ,DS_CONTR_RNW_ESCL CRE
                    ,CONTR_AUTO_RNW_TP RTP
                WHERE
                        DCD.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND DCD.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                    AND DCD.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CRE.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK       = CRE.DS_CONTR_DTL_PK
                    AND CRE.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl2#
                    AND CRE.EZCANCELFLAG          = '0'
                    AND CRE.GLBL_CMPY_CD          = RTP.GLBL_CMPY_CD
                    AND CRE.CONTR_AUTO_RNW_TP_CD  = RTP.CONTR_AUTO_RNW_TP_CD
                    <!-- START 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    <!-- AND RTP.AUTO_RNW_FLG          = 'N'-->
                    <!-- END 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    AND RTP.RNW_BASE_FLG          = 'Y'
                    AND RTP.EZCANCELFLAG          = '0'
                UNION
                SELECT
                     DCD.RNW_EFF_FROM_DT       AS UPLFT_EFF_FROM_DT
                    ,CRE.BASE_PRC_UP_RATIO     AS PRC_UP_RATIO
                    ,DCD.DS_CONTR_DTL_TP_CD    AS DS_CONTR_DTL_TP_CD
                    ,CRE.DS_CONTR_MACH_LVL_NUM AS DS_CONTR_MACH_LVL_NUM
                FROM
                     DS_CONTR_DTL      DCD
                    ,DS_CONTR_RNW_ESCL CRE
                    ,CONTR_AUTO_RNW_TP RTP
                WHERE
                        DCD.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND DCD.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                    AND DCD.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CRE.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK       = CRE.DS_CONTR_DTL_PK
                    AND CRE.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl3#
                    AND CRE.DS_CONTR_BASE_USG_NM  = #dsContrBaseUsgNm#
                    AND CRE.EZCANCELFLAG          = '0'
                    AND CRE.GLBL_CMPY_CD          = RTP.GLBL_CMPY_CD
                    AND CRE.CONTR_AUTO_RNW_TP_CD  = RTP.CONTR_AUTO_RNW_TP_CD
                    <!-- START 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    <!-- AND RTP.AUTO_RNW_FLG          = 'N'-->
                    <!-- END 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    AND RTP.RNW_BASE_FLG          = 'Y'
                    AND RTP.EZCANCELFLAG          = '0'
                ORDER BY
                    DS_CONTR_MACH_LVL_NUM DESC
            ) X
        WHERE
            ROWNUM = 1
    </statement>
    <statement id="getFltUsg" parameterClass="Map" resultClass="Map">
        SELECT
             X.UPLFT_EFF_FROM_DT
            ,X.PRC_UP_RATIO
            ,X.DS_CONTR_DTL_TP_CD
            ,X.DS_CONTR_BLLG_MTR_PK
            ,X.MTR_LB_CD
        FROM
            (
                SELECT
                     DCD.RNW_EFF_FROM_DT       AS UPLFT_EFF_FROM_DT
                    ,CRE.MTR_PRC_UP_RATIO      AS PRC_UP_RATIO
                    ,DCD.DS_CONTR_DTL_TP_CD    AS DS_CONTR_DTL_TP_CD
                    ,CBM.DS_CONTR_BLLG_MTR_PK  AS DS_CONTR_BLLG_MTR_PK
                    ,CBM.BLLG_MTR_LB_CD        AS MTR_LB_CD
                    ,CRE.DS_CONTR_MACH_LVL_NUM AS DS_CONTR_MACH_LVL_NUM
                FROM
                     DS_CONTR_DTL      DCD
                    ,DS_CONTR_BLLG_MTR CBM
                    ,DS_CONTR_RNW_ESCL CRE
                    ,CONTR_AUTO_RNW_TP RTP
                WHERE
                        DCD.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND DCD.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                    AND DCD.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CBM.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK       = CBM.DS_CONTR_DTL_PK
                    AND CBM.DS_CONTR_BLLG_MTR_PK  = #dsContrBllgMtrPk#
                    AND CBM.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CRE.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_PK           = CRE.DS_CONTR_PK
                    AND CRE.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl1#
                    AND CRE.EZCANCELFLAG          = '0'
                    AND CRE.GLBL_CMPY_CD          = RTP.GLBL_CMPY_CD
                    AND CRE.CONTR_AUTO_RNW_TP_CD  = RTP.CONTR_AUTO_RNW_TP_CD
                    <!-- START 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    <!-- AND RTP.AUTO_RNW_FLG          = 'N'-->
                    <!-- END 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    AND RTP.RNW_USG_FLG           = 'Y'
                    AND RTP.EZCANCELFLAG          = '0'
                UNION
                SELECT
                     DCD.RNW_EFF_FROM_DT       AS UPLFT_EFF_FROM_DT
                    ,CRE.MTR_PRC_UP_RATIO      AS PRC_UP_RATIO
                    ,DCD.DS_CONTR_DTL_TP_CD    AS DS_CONTR_DTL_TP_CD
                    ,CBM.DS_CONTR_BLLG_MTR_PK  AS DS_CONTR_BLLG_MTR_PK
                    ,CBM.BLLG_MTR_LB_CD        AS MTR_LB_CD
                    ,CRE.DS_CONTR_MACH_LVL_NUM AS DS_CONTR_MACH_LVL_NUM
                FROM
                     DS_CONTR_DTL      DCD
                    ,DS_CONTR_BLLG_MTR CBM
                    ,DS_CONTR_RNW_ESCL CRE
                    ,CONTR_AUTO_RNW_TP RTP
                WHERE
                        DCD.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND DCD.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                    AND DCD.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CBM.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK       = CBM.DS_CONTR_DTL_PK
                    AND CBM.DS_CONTR_BLLG_MTR_PK  = #dsContrBllgMtrPk#
                    AND CBM.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CRE.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK       = CRE.DS_CONTR_DTL_PK
                    AND CRE.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl2#
                    AND CRE.EZCANCELFLAG          = '0'
                    AND CRE.GLBL_CMPY_CD          = RTP.GLBL_CMPY_CD
                    AND CRE.CONTR_AUTO_RNW_TP_CD  = RTP.CONTR_AUTO_RNW_TP_CD
                    <!-- START 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    <!-- AND RTP.AUTO_RNW_FLG          = 'N'-->
                    <!-- END 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    AND RTP.RNW_USG_FLG           = 'Y'
                    AND RTP.EZCANCELFLAG          = '0'
                UNION
                SELECT
                     DCD.RNW_EFF_FROM_DT       AS UPLFT_EFF_FROM_DT
                    ,CRE.MTR_PRC_UP_RATIO      AS PRC_UP_RATIO
                    ,DCD.DS_CONTR_DTL_TP_CD    AS DS_CONTR_DTL_TP_CD
                    ,CBM.DS_CONTR_BLLG_MTR_PK  AS DS_CONTR_BLLG_MTR_PK
                    ,CBM.BLLG_MTR_LB_CD        AS MTR_LB_CD
                    ,CRE.DS_CONTR_MACH_LVL_NUM AS DS_CONTR_MACH_LVL_NUM
                FROM
                     DS_CONTR_DTL      DCD
                    ,DS_CONTR_BLLG_MTR CBM
                    ,DS_CONTR_RNW_ESCL CRE
                    ,CONTR_AUTO_RNW_TP RTP
                WHERE
                        DCD.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND DCD.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                    AND DCD.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CBM.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK       = CBM.DS_CONTR_DTL_PK
                    AND CBM.DS_CONTR_BLLG_MTR_PK  = #dsContrBllgMtrPk#
                    AND CBM.EZCANCELFLAG          = '0'
                    AND DCD.GLBL_CMPY_CD          = CRE.GLBL_CMPY_CD
                    AND DCD.DS_CONTR_DTL_PK       = CRE.DS_CONTR_DTL_PK
                    AND CRE.DS_CONTR_MACH_LVL_NUM = #dsContrMachLvl3#
                    AND CRE.DS_CONTR_BASE_USG_NM  = #dsContrBaseUsgNm#
                    AND CRE.EZCANCELFLAG          = '0'
                    AND CRE.GLBL_CMPY_CD          = RTP.GLBL_CMPY_CD
                    AND CRE.CONTR_AUTO_RNW_TP_CD  = RTP.CONTR_AUTO_RNW_TP_CD
                    <!-- START 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    <!-- AND RTP.AUTO_RNW_FLG          = 'N'-->
                    <!-- END 2024/02/26 K.Ogasawara [QC#63550,DEL] -->
                    AND RTP.RNW_USG_FLG           = 'Y'
                    AND RTP.EZCANCELFLAG          = '0'
                ORDER BY
                    DS_CONTR_MACH_LVL_NUM DESC
            ) X
        WHERE
            ROWNUM = 1
    </statement>
<!-- END 2017/02/08 K.Kitachi [QC#17410, ADD] -->
    <!-- START 2017/09/28 K.Kojima [QC#18376, ADD] -->
    <statement id="getFleetLineNewAmount" parameterClass="Map" resultClass="BigDecimal">
        WITH IV_DTL AS (
            SELECT
                 GLBL_CMPY_CD
                ,DS_CONTR_DTL_PK
                ,SVC_CONFIG_MSTR_PK
            FROM
                (
                    SELECT
                         DTL.GLBL_CMPY_CD
                        ,DTL.DS_CONTR_DTL_PK
                        ,DTL.SVC_CONFIG_MSTR_PK
                        ,ROW_NUMBER() OVER (PARTITION BY DTL.DS_CONTR_PK ORDER BY DTL.DS_CONTR_DTL_PK ASC) AS ROW_NUM 
                    FROM
                        DS_CONTR_DTL           DTL
                    WHERE
                            DTL.GLBL_CMPY_CD        = #glblCmpyCd#
                        AND DTL.DS_CONTR_PK         = #dsContrPk#
                        AND DTL.EZCANCELFLAG        = '0'
                        AND DTL.SVC_MACH_MSTR_PK    IS NOT NULL
                )
            WHERE
                ROW_NUM = 1
            )
        SELECT
            NVL(#basePrcDealAmt#, 0) + NVL(#basePrcDealAmt#, 0) * MUR.UPLFT_BASE_PRC_UP_RATIO / 100 AS NEW_AMOUNT
        FROM
             IV_DTL           DTL
            ,SVC_CONFIG_MSTR  SCM
            ,DS_MDL_ESCL_RULE MUR
        WHERE
                DTL.SVC_CONFIG_MSTR_PK          = SCM.SVC_CONFIG_MSTR_PK
            AND DTL.GLBL_CMPY_CD                = SCM.GLBL_CMPY_CD
            AND SCM.EZCANCELFLAG                = '0'
            AND SCM.MDL_ID                      = MUR.MDL_ID
            AND SCM.GLBL_CMPY_CD                = MUR.GLBL_CMPY_CD
            AND MUR.EFF_FROM_DT               &lt;= #slsDt#
            AND NVL(MUR.EFF_THRU_DT,#slsDt#)  &gt;= #slsDt#
            AND MUR.EZCANCELFLAG                = '0'
    </statement>
    <statement id="getUplftMtrPrcUpRatio" parameterClass="Map" resultMap="BigDecimal">
        SELECT
            DMEBM.UPLFT_MTR_PRC_UP_RATIO
        FROM
             DS_CONTR_DTL         DCD
            ,SVC_CONFIG_MSTR      SCM
            ,DS_MDL_ESCL_RULE     DMER
            ,DS_MDL_ESCL_BLLG_MTR DMEBM
        WHERE
                DCD.GLBL_CMPY_CD                = #glblCmpyCd#
            AND DCD.DS_CONTR_DTL_PK             = #dsContrDtlPk#
            AND DCD.EZCANCELFLAG                = '0'
            AND DCD.GLBL_CMPY_CD                = SCM.GLBL_CMPY_CD
            AND DCD.SVC_CONFIG_MSTR_PK          = SCM.SVC_CONFIG_MSTR_PK
            AND SCM.EZCANCELFLAG                = '0'
            AND SCM.GLBL_CMPY_CD                = DMER.GLBL_CMPY_CD
            AND SCM.MDL_ID                      = DMER.MDL_ID
            AND DMER.EFF_FROM_DT               &lt;= #slsDt#
            AND NVL(DMER.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
            AND SCM.EZCANCELFLAG                = '0'
            AND DMER.GLBL_CMPY_CD               = DMEBM.GLBL_CMPY_CD
            AND DMER.DS_MDL_ESCL_RULE_PK        = DMEBM.DS_MDL_ESCL_RULE_PK
            AND DMEBM.BLLG_MTR_LB_CD            = #bllgMtrLbCd#
            AND DMEBM.EZCANCELFLAG              = '0'
    </statement>
    <statement id="getUplftMtrPrcUpRatioForLine" parameterClass="Map" resultMap="BigDecimal">
        SELECT
            DMEBM.UPLFT_MTR_PRC_UP_RATIO
        FROM
             DS_CONTR_DTL         DCD
            ,DS_CONTR_DTL         DCDM
            ,SVC_CONFIG_MSTR      SCM
            ,DS_MDL_ESCL_RULE     DMER
            ,DS_MDL_ESCL_BLLG_MTR DMEBM
        WHERE
                DCD.GLBL_CMPY_CD                = #glblCmpyCd#
            AND DCD.DS_CONTR_DTL_PK             = #dsContrDtlPk#
            AND DCD.EZCANCELFLAG                = '0'
            AND DCD.GLBL_CMPY_CD                = DCDM.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK                 = DCDM.DS_CONTR_PK
            AND DCDM.SVC_MACH_MSTR_PK           IS NOT NULL
            AND DCDM.EZCANCELFLAG               = '0'
            AND DCDM.GLBL_CMPY_CD               = SCM.GLBL_CMPY_CD
            AND DCDM.SVC_CONFIG_MSTR_PK         = SCM.SVC_CONFIG_MSTR_PK
            AND SCM.EZCANCELFLAG                = '0'
            AND SCM.GLBL_CMPY_CD                = DMER.GLBL_CMPY_CD
            AND SCM.MDL_ID                      = DMER.MDL_ID
            AND DMER.EFF_FROM_DT               &lt;= #slsDt#
            AND NVL(DMER.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
            AND SCM.EZCANCELFLAG                = '0'
            AND DMER.GLBL_CMPY_CD               = DMEBM.GLBL_CMPY_CD
            AND DMER.DS_MDL_ESCL_RULE_PK        = DMEBM.DS_MDL_ESCL_RULE_PK
            AND DMEBM.BLLG_MTR_LB_CD            = #bllgMtrLbCd#
            AND DMEBM.EZCANCELFLAG              = '0'
        ORDER BY
            DCDM.DS_CONTR_DTL_PK ASC
    </statement>
    <!-- END 2017/09/28 K.Kojima [QC#18376, ADD] -->
    <!-- START 2017/10/02 M.Kidokoro [QC#18290, ADD] -->
    <!-- START 2018/06/15 K.Kojima [QC#26702,DEL] -->
    <!-- <statement id="getPoDtListForBase" parameterClass="Map" resultClass="String"> -->
    <!--     SELECT -->
    <!--         NVL(NVL(DCCCPB.PO_DT, DCCCPD.PO_DT), DCCCPH.PO_DT) AS PO_DT -->
    <!--     FROM -->
    <!--          DS_CONTR_DTL        DCD -->
    <!--         ,DS_CONTR_CR_CARD_PO DCCCPH -->
    <!--         ,DS_CONTR_CR_CARD_PO DCCCPD -->
    <!--         ,DS_CONTR_CR_CARD_PO DCCCPB -->
    <!--     WHERE -->
    <!--             DCD.GLBL_CMPY_CD                = #glblCmpyCd# -->
    <!--         AND DCD.DS_CONTR_PK                 = #dsContrPk# -->
    <!--         AND DCD.DS_CONTR_DTL_PK             = #dsContrDtlPk# -->
    <!--         AND DCD.EZCANCELFLAG                = '0' -->
    <!--         AND DCD.GLBL_CMPY_CD                = DCCCPH.GLBL_CMPY_CD(+) -->
    <!--         AND DCD.DS_CONTR_PK                 = DCCCPH.DS_CONTR_PK(+) -->
    <!--         AND DCCCPH.DS_CONTR_MACH_LVL_NUM(+) = #dsContrMachLvlNum1# -->
    <!--         AND DCCCPH.EZCANCELFLAG(+)          = '0' -->
    <!--         AND DCD.GLBL_CMPY_CD                = DCCCPD.GLBL_CMPY_CD(+) -->
    <!--         AND DCD.DS_CONTR_DTL_PK             = DCCCPD.DS_CONTR_DTL_PK(+) -->
    <!--         AND DCCCPD.DS_CONTR_MACH_LVL_NUM(+) = #dsContrMachLvlNum2# -->
    <!--         AND DCCCPD.EZCANCELFLAG(+)          = '0' -->
    <!--         AND DCD.GLBL_CMPY_CD                = DCCCPB.GLBL_CMPY_CD(+) -->
    <!--         AND DCD.DS_CONTR_DTL_PK             = DCCCPB.DS_CONTR_DTL_PK(+) -->
    <!--         AND DCCCPB.DS_CONTR_MACH_LVL_NUM(+) = #dsContrMachLvlNum3# -->
    <!--         AND DCCCPB.DS_CONTR_BLLG_MTR_PK IS NULL -->
    <!--         AND DCCCPB.EZCANCELFLAG(+)          = '0' -->
    <!-- </statement> -->
    <!-- <statement id="getPoDtListForUsg" parameterClass="Map" resultClass="String"> -->
    <!--     SELECT -->
    <!--         NVL(NVL(DCCCPU.PO_DT, DCCCPD.PO_DT), DCCCPH.PO_DT) AS PO_DT -->
    <!--     FROM -->
    <!--          DS_CONTR_DTL        DCD -->
    <!--         ,DS_CONTR_BLLG_MTR   DCBM -->
    <!--         ,DS_CONTR_CR_CARD_PO DCCCPH -->
    <!--         ,DS_CONTR_CR_CARD_PO DCCCPD -->
    <!--         ,DS_CONTR_CR_CARD_PO DCCCPU -->
    <!--     WHERE -->
    <!--             DCD.GLBL_CMPY_CD                = #glblCmpyCd# -->
    <!--         AND DCD.DS_CONTR_PK                 = #dsContrPk# -->
    <!--         AND DCD.DS_CONTR_DTL_PK             = #dsContrDtlPk# -->
    <!--         AND DCD.EZCANCELFLAG                = '0' -->
    <!--         AND DCD.GLBL_CMPY_CD                = DCBM.GLBL_CMPY_CD -->
    <!--         AND DCD.DS_CONTR_DTL_PK             = DCBM.DS_CONTR_DTL_PK -->
    <!--         AND DCBM.EZCANCELFLAG               = '0' -->
    <!--         AND DCBM.DS_CONTR_BLLG_MTR_PK       = #dsContrBllgMtrPk# -->
    <!--         AND DCD.GLBL_CMPY_CD                = DCCCPH.GLBL_CMPY_CD(+) -->
    <!--         AND DCD.DS_CONTR_PK                 = DCCCPH.DS_CONTR_PK(+) -->
    <!--         AND DCCCPH.DS_CONTR_MACH_LVL_NUM(+) = #dsContrMachLvlNum1# -->
    <!--         AND DCCCPH.EZCANCELFLAG(+)          = '0' -->
    <!--         AND DCD.GLBL_CMPY_CD                = DCCCPD.GLBL_CMPY_CD(+) -->
    <!--         AND DCD.DS_CONTR_DTL_PK             = DCCCPD.DS_CONTR_DTL_PK(+) -->
    <!--         AND DCCCPD.DS_CONTR_MACH_LVL_NUM(+) = #dsContrMachLvlNum2# -->
    <!--         AND DCCCPD.EZCANCELFLAG(+)          = '0' -->
    <!--         AND DCBM.GLBL_CMPY_CD               = DCCCPU.GLBL_CMPY_CD(+) -->
    <!--         AND DCBM.DS_CONTR_DTL_PK            = DCCCPU.DS_CONTR_DTL_PK(+) -->
    <!--         AND DCBM.DS_CONTR_BLLG_MTR_PK       = DCCCPU.DS_CONTR_BLLG_MTR_PK(+) -->
    <!--         AND DCCCPU.DS_CONTR_MACH_LVL_NUM(+) = #dsContrMachLvlNum3# -->
    <!--         AND DCCCPU.EZCANCELFLAG(+)          = '0' -->
    <!-- </statement> -->
    <!-- END 2018/06/15 K.Kojima [QC#26702,DEL] -->
    <!-- END 2017/10/02 M.Kidokoro [QC#18290, ADD] -->
    <!-- START 2018/05/22 K.Kitachi [QC#26070, ADD] -->
    <!-- START 2022/12/01 R.Jin [QC#60880, MOD] -->
    <statement id="getDsContrPrcEffMtrPkList" parameterClass="Map" resultClass="Map">
        SELECT
            DS_CONTR_PRC_EFF_MTR_PK
            ,ROW_NUMBER() OVER( ORDER BY XS_MTR_COPY_QTY ASC) TIRNUM
            <!-- END 2022/12/01 R.Jin [QC#60880, MOD] -->
        FROM
            (
                SELECT
                     B.DS_CONTR_PRC_EFF_MTR_PK
                     <!-- START 2022/12/01 R.Jin [QC#60880, ADD] -->
                     ,B.XS_MTR_COPY_QTY
                     <!-- END 2022/12/01 R.Jin [QC#60880, ADD] -->
                    ,ROW_NUMBER() OVER(PARTITION BY B.CONTR_XS_COPY_PK ORDER BY A.CONTR_PRC_EFF_THRU_DT DESC) RNUM
                FROM
                     DS_CONTR_PRC_EFF     A
                    ,DS_CONTR_PRC_EFF_MTR B
<!-- START 2021/11/12 L.Mandanas [QC#59339, ADD] -->
                    ,CONTR_XS_COPY C
<!-- END 2021/11/12 L.Mandanas [QC#59339, ADD] -->
                WHERE
                        A.GLBL_CMPY_CD         = #glblCmpyCd#
                    AND A.DS_CONTR_BLLG_MTR_PK = #dsContrBllgMtrPk#
                    AND A.USG_CHRG_FLG         = 'Y'
                    AND A.EZCANCELFLAG         = '0'
                    AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD
                    AND A.DS_CONTR_PRC_EFF_PK  = B.DS_CONTR_PRC_EFF_PK
                    AND B.EZCANCELFLAG         = '0'
<!-- START 2021/11/12 L.Mandanas [QC#59339, ADD] -->
                    AND B.GLBL_CMPY_CD         = C.GLBL_CMPY_CD
                    AND B.CONTR_XS_COPY_PK     = C.CONTR_XS_COPY_PK
                    AND C.EZCANCELFLAG         = '0'
<!-- END 2021/11/12 L.Mandanas [QC#59339, ADD] -->
            )
        WHERE
            RNUM = 1
        ORDER BY
            DS_CONTR_PRC_EFF_MTR_PK
    </statement>
    <!-- END 2018/05/22 K.Kitachi [QC#26070, ADD] -->
    <!-- START 2018/05/31 K.Kitachi [QC#26210, ADD] -->
    <!-- START 2018/06/15 K.Kojima [QC#26702,DEL] -->
    <!-- <statement id="getRnwHoldPoTrgt" parameterClass="Map" resultClass="BigDecimal"> -->
    <!--     SELECT -->
    <!--         DS_CONTR_PRC_EFF_PK -->
    <!--     FROM -->
    <!--         (SELECT -->
    <!--             EFF.DS_CONTR_PRC_EFF_PK -->
    <!--             ,ROW_NUMBER() OVER (PARTITION BY EFF.DS_CONTR_DTL_PK,DS_CONTR_BLLG_MTR_PK ORDER BY DS_CONTR_PRC_EFF_SQ_NUM DESC) AS ROW_NUM  -->
    <!--         FROM -->
    <!--             DS_CONTR_PRC_EFF    EFF -->
    <!--         WHERE -->
    <!--             EFF.GLBL_CMPY_CD            = #glblCmpyCd# -->
    <!--             AND EFF.EZCANCELFLAG        = '0' -->
    <!--             AND EXISTS(SELECT * FROM -->
    <!--                         DS_CONTR_DTL_STS_V DSV -->
    <!--                     WHERE -->
    <!--                         DSV.GLBL_CMPY_CD            = EFF.GLBL_CMPY_CD -->
    <!--                         AND DSV.DS_CONTR_PK         = #dsContrPk# -->
    <!--                         AND DSV.DS_CONTR_DTL_STS_CD = #dsContrDtlStsCd# -->
    <!--                         AND DSV.DS_CONTR_DTL_PK     = EFF.DS_CONTR_DTL_PK -->
    <!--                         AND DSV.EZCANCELFLAG        = '0') -->
    <!--         ) -->
    <!--     WHERE -->
    <!--         ROW_NUM = 1 -->
    <!--     ORDER BY DS_CONTR_PRC_EFF_PK -->
    <!-- </statement> -->
    <!-- END 2018/06/15 K.Kojima [QC#26702,DEL] -->
    <!-- END 2018/05/31 K.Kitachi [QC#26210, ADD] -->

    <!-- START 2018/08/17 K.Kojima [QC#27295, ADD] -->
    <statement id="getRnwLtrCtrlInfo" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             COUNT(*)
        FROM
             DS_CONTR              DC
            ,SVC_RG_BR_RELN        SRBR
            ,RNW_ESCL_LTR_CTRL     RELC
        WHERE
                DC.GLBL_CMPY_CD       = #glblCmpyCd#
            AND DC.DS_CONTR_PK        = #dsContrPk#
            AND DC.GLBL_CMPY_CD       = SRBR.GLBL_CMPY_CD
            AND DC.SVC_CONTR_BR_CD    = SRBR.SVC_CONTR_BR_CD
            AND DC.GLBL_CMPY_CD       = RELC.GLBL_CMPY_CD
            AND DC.SVC_LINE_BIZ_CD    = RELC.SVC_LINE_BIZ_CD
            AND DC.SVC_CONTR_BR_CD    = RELC.SVC_CONTR_BR_CD
            AND SRBR.SVC_RG_PK        = RELC.SVC_RG_PK
            AND RELC.RNW_LTR_FLG      = 'Y'
            AND DC.EZCANCELFLAG       = '0'
            AND SRBR.EZCANCELFLAG     = '0'
            AND RELC.EZCANCELFLAG     = '0'
    </statement>

    <!-- START 2018/12/19 W.Honda [QC#29636, ADD] -->
    <statement id="getMaxPrcUpRatioFromRnwEscl" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             NVL(RESLV3.RNW_MAX_PRC_UP_RATIO, NVL(RESLV2.RNW_MAX_PRC_UP_RATIO, RESLV1.RNW_MAX_PRC_UP_RATIO)) AS RNW_MAX_PRC_UP_RATIO
        FROM
             DS_CONTR_DTL          DC
            ,DS_CONTR_RNW_ESCL     RESLV1
            ,DS_CONTR_RNW_ESCL     RESLV2
            ,DS_CONTR_RNW_ESCL     RESLV3
        WHERE
                DC.GLBL_CMPY_CD                 =  #glblCmpyCd#
            AND DC.DS_CONTR_PK                  =  #dsContrPk#
            <isNotNull property="dsContrDtlPk">
            AND DC.DS_CONTR_DTL_PK              =  #dsContrDtlPk#
            </isNotNull>
            <isNull property="dsContrDtlPk">
            AND DC.DS_CONTR_DTL_TP_CD           =  #dsContrDtlTpCdAgg#
            </isNull>
            AND DC.EZCANCELFLAG                 =  '0'
            AND DC.GLBL_CMPY_CD                 =  RESLV1.GLBL_CMPY_CD(+)
            AND DC.DS_CONTR_PK                  =  RESLV1.DS_CONTR_PK(+)
            AND RESLV1.DS_CONTR_DTL_PK(+)       IS NULL
            AND RESLV1.DS_CONTR_MACH_LVL_NUM(+) =  #machLvlNumLv1#
            AND RESLV1.DS_CONTR_BASE_USG_NM(+)  IS NULL
            AND RESLV1.EZCANCELFLAG(+)          =  '0'
            AND DC.GLBL_CMPY_CD                 =  RESLV2.GLBL_CMPY_CD(+)
            AND DC.DS_CONTR_PK                  =  RESLV2.DS_CONTR_PK(+)
            AND DC.DS_CONTR_DTL_PK              =  RESLV2.DS_CONTR_DTL_PK(+)
            AND RESLV2.DS_CONTR_MACH_LVL_NUM(+) =  #machLvlNumLv2#
            AND RESLV2.DS_CONTR_BASE_USG_NM(+)  IS NULL
            AND RESLV2.EZCANCELFLAG(+)          =  '0'
            <isNotNull property="baseFlg">
            AND DC.GLBL_CMPY_CD                 =  RESLV3.GLBL_CMPY_CD(+)
            AND DC.DS_CONTR_PK                  =  RESLV3.DS_CONTR_PK(+)
            AND DC.DS_CONTR_DTL_PK              =  RESLV3.DS_CONTR_DTL_PK(+)
            AND RESLV3.DS_CONTR_MACH_LVL_NUM(+) =  #machLvlNumLv3#
            AND RESLV3.DS_CONTR_BASE_USG_NM(+)  =  #baseUsgNumBase#
            AND RESLV3.EZCANCELFLAG(+)          =  '0'
            </isNotNull>
            <isNotNull property="usageFlg">
            AND DC.GLBL_CMPY_CD                 =  RESLV3.GLBL_CMPY_CD(+)
            AND DC.DS_CONTR_PK                  =  RESLV3.DS_CONTR_PK(+)
            AND DC.DS_CONTR_DTL_PK              =  RESLV3.DS_CONTR_DTL_PK(+)
            AND RESLV3.DS_CONTR_MACH_LVL_NUM(+) =  #machLvlNumLv3#
            AND RESLV3.DS_CONTR_BASE_USG_NM(+)  =  #baseUsgNumUsg#
            AND RESLV3.EZCANCELFLAG(+)          =  '0'
            </isNotNull>
    </statement>
    <!-- END 2018/12/19 W.Honda [QC#29636, ADD] -->

    <!-- START 2024/04/02 T.Nagae [QC#63552, ADD] -->
    <statement id="getRenewalLetterList" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
             DCD.DS_CONTR_PK
            ,DCD.DS_CONTR_DTL_PK
            ,DC.DS_CONTR_NUM
            ,DC.DS_ACCT_NUM
            ,DC.ALT_PAYER_CUST_CD
            ,RELC.PRINT_OLD_PRC_FLG 
        FROM
             DS_CONTR_PRC_CHNG_REC DCPCR
            ,DS_CONTR_DTL          DCD
            ,DS_CONTR              DC
            ,SVC_RG_BR_RELN        SRBR
            ,RNW_ESCL_LTR_CTRL     RELC
        WHERE
                DCPCR.GLBL_CMPY_CD    = #glblCmpyCd#
            AND DCPCR.RNW_EFF_FROM_DT &gt;= #slsDt#
            AND DCPCR.EIP_RPT_RQST_DT IS NULL
            AND DCPCR.GLBL_CMPY_CD    = DCD.GLBL_CMPY_CD
            AND DCPCR.DS_CONTR_DTL_PK = DCD.DS_CONTR_DTL_PK
            <iterate property="dsContrDtlPkList" var="dsContrDtlPk[]" open="AND DCD.DS_CONTR_DTL_PK IN (" close=")" conjunction=",">
                #dsContrDtlPk[]#
            </iterate>
            AND DCD.GLBL_CMPY_CD      = DC.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK       = DC.DS_CONTR_PK
            AND DC.GLBL_CMPY_CD       = SRBR.GLBL_CMPY_CD
            AND DC.SVC_CONTR_BR_CD    = SRBR.SVC_CONTR_BR_CD
            AND DC.GLBL_CMPY_CD       = RELC.GLBL_CMPY_CD
            AND DC.SVC_LINE_BIZ_CD    = RELC.SVC_LINE_BIZ_CD
            AND DC.SVC_CONTR_BR_CD    = RELC.SVC_CONTR_BR_CD
            AND SRBR.SVC_RG_PK        = RELC.SVC_RG_PK
            AND RELC.RNW_LTR_FLG      = 'Y'
            AND DCPCR.EZCANCELFLAG    = '0'
            AND DCD.EZCANCELFLAG      = '0'
            AND DC.EZCANCELFLAG       = '0'
            AND SRBR.EZCANCELFLAG     = '0'
            AND RELC.EZCANCELFLAG     = '0'
        ORDER BY
             DCD.DS_CONTR_PK
            ,DCD.DS_CONTR_DTL_PK
        </statement>
    <!-- END 2024/04/02 T.Nagae [QC#63552, ADD] -->
</sqlMap>
