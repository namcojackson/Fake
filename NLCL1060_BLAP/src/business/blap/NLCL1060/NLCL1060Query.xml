<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NLCL1060Query">
  
    <statement id="getOnhandInventoryInquiry" parameterClass="Map" resultClass="Map">
    SELECT
    *
    FROM(
    <!-- CUSA Warehouse -->
    <isEqual property="xxChkBox" compareValue="Y">
		SELECT DISTINCT
		     CPIV.P_PARTS_NUM AS MDSE_CD
		    ,MD.MDSE_DESC_SHORT_TXT
		    ,PV.VND_CD
		    ,PV.DPLY_VND_NM
		    ,CPWV.P_NAME_WH AS RTL_WH_NM
		    ,CPWV.P_CODE_WH AS RTL_WH_CD
		    ,1 AS INVTY_QTY
		    ,'' AS LOC_STS_DESC_TXT
		    ,SS.STK_STS_CD || ':' || SS.STK_STS_DESC_TXT AS STK_STS_DESC_TXT
		    ,'' AS LOC_TP_DESC_TXT
		FROM
		     CSA_PRT_WH_V    CPWV
		    ,CSA_PRT_INVTY_V CPIV
		    ,CSA_PRT_POYO_V  CPV
		    ,PO_VND_V        PV
		    ,MDSE            MD
		    ,STK_STS         SS
		WHERE
	    <!-- START 2023/07/14 S.Dong [QC#61686, MOD] -->
		<!-- CPWV.P_CODE_WH        = CPIV.P_CODE_WH (+) -->
		    CPWV.P_CODE_WH            = CPIV.P_CODE_WH
		<!-- END 2023/07/14 S.Dong [QC#61686, MOD] -->
		<isNotNull property="mdseCd">
		    AND CPIV.P_PARTS_NUM      LIKE #mdseCd#
	    </isNotNull>
		    AND CPIV.P_CODE_WH        = CPV.P_CODE_WH (+)
		    AND CPIV.P_PARTS_NUM      = CPV.P_PARTS_NUM (+)
        <isNotNull property="avalLocCdArray">
            AND   CPWV.P_CODE_WH    
            IN (<iterate property="avalLocCdArray" var="locCd[]" open="" close="" conjunction=",">
               #locCd[]#
               </iterate>)
        </isNotNull>
        <!-- START 2023/07/14 S.Dong [QC#61686, ADD] -->
            AND CPIV.P_QTY_ALLOCBL    &gt; 0
        <!-- END 2023/07/14 S.Dong [QC#61686, ADD] -->
		    AND PV.GLBL_CMPY_CD       = #glblCmpyCd#
            AND PV.VND_CD             = #cusaPrtVndCd#
		<isNotNull property="vndCd">
		    AND PV.VND_CD             = #vndCd#
        </isNotNull>
		    AND PV.EZCANCELFLAG       = '0'
		    AND MD.GLBL_CMPY_CD       = #glblCmpyCd#
		    AND CPIV.P_PARTS_NUM      = MD.MDSE_CD
		    AND MD.EZCANCELFLAG       = '0'
		    AND SS.GLBL_CMPY_CD       = #glblCmpyCd#
		    AND SS.STK_STS_CD         = #stkStsCd#
		    AND SS.EZCANCELFLAG       = '0'
		UNION ALL
		</isEqual>
		<!-- 3rd Party Inventory -->
		SELECT
		     MD.MDSE_CD
		    ,MD.MDSE_DESC_SHORT_TXT
		    ,IVT.VND_CD
		    ,PVV.DPLY_VND_NM
		    ,RW.RTL_WH_NM
		    ,IVT.INVTY_LOC_CD AS RTL_WH_CD
		    ,IVT.INVTY_QTY
		    ,'' AS LOC_STS_DESC_TXT
		    ,SS.STK_STS_CD || ':' || SS.STK_STS_DESC_TXT AS STK_STS_DESC_TXT
		    ,'' AS LOC_TP_DESC_TXT
		FROM
		     THIRD_PTY_INVTY IVT
		    ,PO_VND_V        PVV
		    ,STK_STS         SS
		    ,MDSE            MD
		    ,RTL_WH          RW
		WHERE
		        IVT.GLBL_CMPY_CD                  = #glblCmpyCd#
		    AND IVT.EZCANCELFLAG                  = '0'
        <isNotNull property="mdseCd">
            AND IVT.MDSE_CD                       LIKE #mdseCd#
        </isNotNull>
        <isNotNull property="vndCd">
            AND IVT.VND_CD                        = #vndCd#
        </isNotNull>
		    AND IVT.INVTY_QTY                     &gt; 0
		    AND IVT.GLBL_CMPY_CD                  = PVV.GLBL_CMPY_CD
		    AND IVT.VND_CD                        = PVV.VND_CD
		    AND PVV.EZCANCELFLAG                  = '0'
		    AND IVT.GLBL_CMPY_CD                  = SS.GLBL_CMPY_CD
		    AND IVT.STK_STS_CD                    = SS.STK_STS_CD
		    AND SS.EZCANCELFLAG                   = '0'
		    AND IVT.GLBL_CMPY_CD                  = MD.GLBL_CMPY_CD
		    AND IVT.MDSE_CD                       = MD.MDSE_CD
		    AND MD.EZCANCELFLAG                   = '0'
		    AND IVT.GLBL_CMPY_CD                  = RW.GLBL_CMPY_CD(+)
		    AND IVT.INVTY_LOC_CD                  = RW.RTL_WH_CD(+)
		    AND RW.EZCANCELFLAG(+)                = '0'
		ORDER BY
		     MDSE_CD
		    ,VND_CD
		    ,RTL_WH_CD)
		WHERE ROWNUM                              &lt;= #rowNum#
    </statement>
</sqlMap>
