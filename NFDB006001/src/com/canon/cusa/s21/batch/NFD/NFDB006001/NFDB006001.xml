<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NFDB006001">

    <statement id="getWorkItemTran" parameterClass="Map" resultClass="Map">
         SELECT
             CST.CLT_STRGY_TRX_PK
            ,CST.BILL_TO_CUST_CD
            ,CSWIT.CLT_STRGY_WRK_ITEM_TRX_PK
            ,BTC.BILL_TO_CUST_PK
            ,CP_BILL.AR_ADJ_TP_CD AS AR_ADJ_TP_CD_BILL
            ,CP_BILL.CLT_PTFO_PK  AS CLT_PTFO_PK_BILL
            ,CP_ACCT.CLT_PTFO_PK  AS CLT_PTFO_PK_ACCT
            ,CP_ACCT.AR_ADJ_TP_CD AS AR_ADJ_TP_CD_ACCT
            ,CP_BILL.CLT_PSN_CD   AS CLT_PSN_CD_BILL
            ,CP_ACCT.CLT_PSN_CD   AS CLT_PSN_CD_ACCT
            ,CST.CLT_ACCT_CD
         FROM
             CLT_STRGY_TRX CST
            ,CLT_STRGY_WRK_ITEM_TRX CSWIT
            ,BILL_TO_CUST           BTC
            ,CLT_PTFO               CP_BILL
            <!-- start add 2016/01/13 -->
            ,SELL_TO_CUST           STC
            ,CLT_PTFO               CP_ACCT
            <!-- end 2016/01/13 -->
         WHERE
                  CST.GLBL_CMPY_CD                 = #glblCmpyCd#
           AND    CST.CLT_STRGY_STS_CD             = #cltStrgyStsCd#
           <!-- start add 2016/01/13 -->
           AND    CST.CLT_STRGY_CUR_FLG            = #flgY#
           <!-- end 2016/01/13 -->
           AND    CSWIT.CLT_WRK_ITEM_RWSD_DT   &lt;= #batProcDt#
           AND    CSWIT.CLT_WRK_ITEM_CD            = #cltWrkItemCd#
           AND    CSWIT.CLT_WRK_ITEM_STS_CD        IN (#cltWrkItemStsCd#, #wrkItmStsOpen#)
           AND    CST.GLBL_CMPY_CD                 = CSWIT.GLBL_CMPY_CD
           AND    CST.CLT_STRGY_TRX_PK             = CSWIT.CLT_STRGY_TRX_PK
           AND    CST.GLBL_CMPY_CD                 = BTC.GLBL_CMPY_CD
           AND    CST.BILL_TO_CUST_CD              = BTC.BILL_TO_CUST_CD
           AND    BTC.GLBL_CMPY_CD                 = CP_BILL.GLBL_CMPY_CD(+)
           AND    BTC.CLT_PTFO_PK                  = CP_BILL.CLT_PTFO_PK(+)
           AND    CST.GLBL_CMPY_CD                 = STC.GLBL_CMPY_CD
           AND    CST.CLT_ACCT_CD                  = STC.SELL_TO_CUST_CD
           AND    STC.GLBL_CMPY_CD                 = CP_ACCT.GLBL_CMPY_CD
           AND    STC.CLT_PTFO_PK                  = CP_ACCT.CLT_PTFO_PK
           AND    CST.EZCANCELFLAG                 = '0'
           AND    CSWIT.EZCANCELFLAG               = '0'
           AND    BTC.EZCANCELFLAG                 = '0'
           AND    CP_BILL.EZCANCELFLAG(+)          = '0'
           AND    STC.EZCANCELFLAG                 = '0'
           AND    CP_ACCT.EZCANCELFLAG             = '0'
           <!-- QC#18754 ADD start -->
           AND    NOT EXISTS (
                              SELECT
                                   CSWIT2.CLT_STRGY_WRK_ITEM_TRX_PK
                              FROM
                                   CLT_STRGY_WRK_ITEM_TRX CSWIT2
                              WHERE
                                   CSWIT2.GLBL_CMPY_CD          = CST.GLBL_CMPY_CD
                              AND  CSWIT2.EZCANCELFLAG          = '0'
                              AND  CSWIT2.CLT_STRGY_TRX_PK      = CST.CLT_STRGY_TRX_PK
                              AND  CSWIT2.CLT_WRK_ITEM_RWSD_DT  &lt; CSWIT.CLT_WRK_ITEM_RWSD_DT
                              AND  CSWIT2.CLT_WRK_ITEM_STS_CD   IN(#cltWrkItemStsCd#, #wrkItmStsOpen#)
                              AND  CSWIT2.CLT_WRK_TP_CD         = #wrkTpCd#
                              )
           <!-- QC#18754 ADD end -->
         ORDER BY
                  CSWIT.CLT_STRGY_TRX_PK
                 ,CSWIT.CLT_STRGY_WRK_ITEM_TRX_PK
    </statement>

    <statement id="getArTrxBalList" parameterClass="Map" resultClass="Map">
        SELECT
             ART.AR_TRX_BAL_PK
            ,ART.EZUPTIME
            ,ART.EZUPTIMEZONE
            <!-- start add 2016/01/14 -->
            ,ART.AR_TRX_NUM
            ,ART.BILL_TO_CUST_CD
            ,ART.BILL_TO_CUST_ACCT_CD
            ,ART.DEAL_CCY_CD
            ,ART.DEAL_ORIG_GRS_AMT
            ,ART.FUNC_ORIG_GRS_AMT
            ,ART.DEAL_RMNG_BAL_GRS_AMT
            ,ART.FUNC_RMNG_BAL_GRS_AMT
            ,ART.AR_TRX_DT
            ,ART.INV_DUE_DT
            ,SI.DS_CONTR_NUM
            ,SIL.BLLG_PER_FROM_DT
            ,SIL.BLLG_PER_TO_DT
            ,TO_DATE(#batProcDt#, 'YYYYMMDD') - TO_DATE(ART.INV_DUE_DT, 'YYYYMMDD') AS DAYS_PAST_DUE_AOT
            ,ART.CPO_ORD_NUM
            ,ART.AR_TRX_TP_CD
            <!-- end 2016/01/14 -->
         FROM
             AR_TRX_BAL ART
            ,SVC_INV    SI
            , ( SELECT
                    SIL.SVC_INV_NUM
                  , MIN(SIL.BLLG_PER_FROM_DT) AS BLLG_PER_FROM_DT
                  , MAX(BLLG_PER_THRU_DT)     AS BLLG_PER_TO_DT
                FROM SVC_INV_LINE SIL
                    WHERE
                      SIL.GLBL_CMPY_CD        = #glblCmpyCd#
                  AND SIL.EZCANCELFLAG        = '0' 
                GROUP BY SIL.SVC_INV_NUM
              ) SIL
        WHERE
                  ART.GLBL_CMPY_CD                 = #glblCmpyCd#
           AND    ART.BILL_TO_CUST_CD              = #billToCustCd#
           <iterate property="arTrxTpCdList" var="arTrxTpCdList[]" open="AND ART.AR_TRX_TP_CD IN (" close=")" conjunction=",">
                 #arTrxTpCdList[]#
           </iterate>
           <iterate property="arCashApplyStsCdList" var="arCashApplyStsCdList[]" open="AND ART.AR_CASH_APPLY_STS_CD IN (" close=")" conjunction=",">
                 #arCashApplyStsCdList[]#
           </iterate>
           AND    ART.GLBL_CMPY_CD                 = SI.GLBL_CMPY_CD(+)
           AND    ART.AR_TRX_NUM                   = SI.SVC_INV_NUM(+)
           AND    ART.EZCANCELFLAG                 = '0'
           AND    SI.EZCANCELFLAG(+)               = '0'
           AND    ART.AR_TRX_NUM                   = SIL.SVC_INV_NUM(+)
        ORDER BY
                  ART.AR_TRX_BAL_PK
    </statement>

</sqlMap>
