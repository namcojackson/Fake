<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NFCL3010Query">

    <!-- *********************************************************** -->
    <!-- ********** Bean Definition ******************************** -->
    <!-- *********************************************************** -->
    <typeAlias alias="NFCL3010CMsg"     type="business.blap.NFCL3010.NFCL3010CMsg"/>
    <typeAlias alias="NFCL3010SMsg"     type="business.blap.NFCL3010.NFCL3010SMsg"/>
    <typeAlias alias="NFCL3010_ASMsg"   type="business.blap.NFCL3010.NFCL3010_ASMsg"/>
    <typeAlias alias="NFCL3010_BSMsg"   type="business.blap.NFCL3010.NFCL3010_BSMsg"/>
    <typeAlias alias="CLT_PTFOTMsg"     type="business.db.CLT_PTFOTMsg"/>

    <resultMap id="result.getBatRcptList" class="NFCL3010_ASMsg">
        <result property="arBatRcptNm_A"      column="AR_BAT_RCPT_NM_A"       javaType="EZDSStringItem" />
        <result property="rcptNum_A"          column="RCPT_NUM_A"             javaType="EZDSStringItem" />
        <result property="arRcptSrcNm_A"      column="AR_RCPT_SRC_NM_A"       javaType="EZDSStringItem" />
        <result property="arBatRcptDt_A"      column="AR_BAT_RCPT_DT_A"       javaType="EZDSStringItem" />
        <result property="arBatRcptStsNm_A"   column="AR_BAT_RCPT_STS_NM_A"   javaType="EZDSStringItem" />
        <result property="arBatRcptCnt_A"     column="AR_BAT_RCPT_CNT_A"      javaType="EZDSBigDecimalItem" />
        <result property="arBatRcptAmt_A"     column="AR_BAT_RCPT_AMT_A"      javaType="EZDSBigDecimalItem" />
        <result property="arLockBoxFileNm_A"  column="AR_LOCK_BOX_FILE_NM_A"  javaType="EZDSStringItem" />
        <result property="arLockBoxNm_A"      column="AR_LOCK_BOX_NM_A"       javaType="EZDSStringItem" />
        <result property="arLockBoxBatNum_A"  column="AR_LOCK_BOX_BAT_NUM_A"  javaType="EZDSStringItem" />
        
        <!-- START 2017/03/16 [QC#14205,ADD] -->
        <result property="xxRecHistCratTs_A"     column="XX_REC_HIST_CRAT_TS"        javaType="EZDCStringItem"/>
        <result property="xxRecHistCratByNm_A"   column="XX_REC_HIST_CRAT_BY_NM"     javaType="EZDCStringItem"/>
        <result property="xxRecHistUpdTs_A"      column="XX_REC_HIST_UPD_TS"         javaType="EZDCStringItem"/>
        <result property="xxRecHistUpdByNm_A"    column="XX_REC_HIST_UPD_BY_NM"      javaType="EZDCStringItem"/>
        <result property="xxRecHistTblNm_A"      column="XX_REC_HIST_TBL_NM"         javaType="EZDCStringItem"/>
        <!-- END   2017/03/16 [QC#14205,ADD] -->
    </resultMap>

    <resultMap id="result.getRcptList"        class="NFCL3010_BSMsg">
        <result property="arBatRcptNm_B"      column="AR_BAT_RCPT_NM_B"       javaType="EZDSStringItem" />
        <result property="rcptNum_B"          column="RCPT_NUM_B"             javaType="EZDSStringItem" />
        <result property="arRcptTrxTpNm_B"    column="AR_RCPT_TRX_TP_NM_B"    javaType="EZDSStringItem" />
        <result property="rcptDt_B"           column="RCPT_DT_B"              javaType="EZDSStringItem" />
        <result property="funcRcptAmt_B"      column="FUNC_RCPT_AMT_B"        javaType="EZDSStringItem" />
        <result property="arRcptStsNm_B"      column="AR_RCPT_STS_NM_B"       javaType="EZDSStringItem" />
        <result property="arTrxNum_B"         column="AR_TRX_NUM_B"           javaType="EZDSStringItem" />
        <result property="arTrxTpNm_B"        column="AR_TRX_TP_NM_B"         javaType="EZDSStringItem" />
        <result property="funcApplyAmt_B"     column="FUNC_APPLY_AMT_B"       javaType="EZDSBigDecimalItem" />
        <result property="payerCustCd_B"      column="PAYER_CUST_CD_B"        javaType="EZDSStringItem" />
        <result property="dsAcctNm_B"         column="DS_ACCT_NM_B"           javaType="EZDSStringItem" />

        <result property="arCashApplyStsCd_B" column="AR_CASH_APPLY_STS_CD_B" javaType="EZDSStringItem" />
        <result property="arBatRcptStsCd_B"   column="AR_BAT_RCPT_STS_CD_B"   javaType="EZDSStringItem" />

        <result property="rcptChkNum_B"       column="RCPT_CHK_NUM_B"         javaType="EZDSStringItem" />
        
        <!-- START 2017/03/16 [QC#14205,ADD] -->
        <result property="xxRecHistCratTs_B"     column="XX_REC_HIST_CRAT_TS"        javaType="EZDCStringItem"/>
        <result property="xxRecHistCratByNm_B"   column="XX_REC_HIST_CRAT_BY_NM"     javaType="EZDCStringItem"/>
        <result property="xxRecHistUpdTs_B"      column="XX_REC_HIST_UPD_TS"         javaType="EZDCStringItem"/>
        <result property="xxRecHistUpdByNm_B"    column="XX_REC_HIST_UPD_BY_NM"      javaType="EZDCStringItem"/>
        <result property="xxRecHistTblNm_B"      column="XX_REC_HIST_TBL_NM"         javaType="EZDCStringItem"/>
        <!-- END   2017/03/16 [QC#14205,ADD] -->
    </resultMap>

    <statement id="getBankPullDownList" parameterClass="Map" resultClass="Map">
        SELECT
                 BANK.DS_BANK_CD
                ,BANK.DS_BANK_NM
        FROM
                DS_BANK BANK
        WHERE
                BANK.GLBL_CMPY_CD            =   #glblCmpyCd#
            AND BANK.EZCANCELFLAG            =  '0'
            ORDER BY
                DS_BANK_SORT_NUM
    </statement>

    <statement id="getBankBrPullDownList" parameterClass="Map" resultClass="Map">
        SELECT
                 BR.BANK_RTE_NUM
                ,BR.DS_BANK_BR_NM
        FROM
                DS_BANK_BR BR
        WHERE
                BR.GLBL_CMPY_CD              =   #glblCmpyCd#
            AND BR.EZCANCELFLAG              =  '0'
            AND BR.DS_BANK_CD                =   #dsBankCd#
        ORDER BY
                BANK_RTE_NUM
    </statement>

    <statement id="getBankAccountPullDownList" parameterClass="Map" resultClass="Map">
        SELECT
                 ACCT.DS_BANK_ACCT_PK
                ,ACCT.DS_BANK_ACCT_NUM
                ,ACCT.DS_BANK_ACCT_NM
        FROM
                DS_BANK_ACCT ACCT
        WHERE
                ACCT.GLBL_CMPY_CD            =   #glblCmpyCd#
            AND ACCT.EZCANCELFLAG            =  '0'
            AND ACCT.DS_BANK_CD              =   #dsBankCd#
            AND ACCT.BANK_RTE_NUM            =   #bankRteNum#
            AND ACCT.DS_BANK_ACCT_TP_CD      =   #dsBankAcctTpCd#
        ORDER BY
                DS_BANK_ACCT_NUM
    </statement>

    <statement id="getCltPsnNm" parameterClass="CLT_PTFOTMsg" resultMap="result.CLT_PTFOTMsg">
        SELECT
                 PTFO.CLT_PSN_NM
        FROM
                CLT_PTFO    PTFO
        WHERE
                PTFO.GLBL_CMPY_CD            =   #glblCmpyCd#
            AND PTFO.EZCANCELFLAG            =  '0'
            AND PTFO.CLT_PSN_CD              =   #cltPsnCd#
        GROUP BY
                 PTFO.CLT_PSN_NM
    </statement>
    <resultMap id="result.CLT_PTFOTMsg" class="CLT_PTFOTMsg">
        <result property="cltPsnNm"                column="CLT_PSN_NM"               javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="getRcptDataList" parameterClass="Map" resultMap="result.getRcptDataList">
        WITH
            RCPT_D AS (
                       SELECT
                            RC.AR_BAT_RCPT_NM         AR_BAT_RCPT_NM_B
                           ,RC.RCPT_NUM               RCPT_NUM_B
                           ,TP.AR_RCPT_TRX_TP_NM      AR_RCPT_TRX_TP_NM_B
                           <!-- QC#26750 Mod Start-->
                           ,NVL(RC.RCPT_CHK_DT, RC.RCPT_DT) RCPT_DT_B
                           <!-- QC#26750 Mod End-->
                           ,CASE WHEN RC.AR_CASH_APPLY_STS_CD = #unidentified# THEN NVL(RC.FUNC_NET_RCPT_AMT, 0) 
                                 ELSE NVL(RC.FUNC_RCPT_AMT, 0)
                            END                       FUNC_RCPT_AMT_B
                           ,RC.FUNC_APPLY_ADJ_AMT     FUNC_APPLY_ADJ_AMT_B <!-- Adjustment -->
                           <!-- QC#29480 Add Start -->
                           ,(
                              SELECT
                                     <!-- QC#54619 MOD START -->
                                     NVL(SUM(ATB.DEAL_RMNG_BAL_GRS_AMT)*-1,0)
                                     <!-- QC#54619 MOD END -->
                                FROM AR_CASH_APP APP
                                    ,AR_ADJ      ADJ
                                    ,AR_TRX_BAL  ATB
                               WHERE
                                     APP.GLBL_CMPY_CD         = RC.GLBL_CMPY_CD
                                 AND APP.RCPT_NUM             = RC.RCPT_NUM
                                 AND APP.EZCANCELFLAG         = '0'
                                 AND APP.AR_APPLY_TP_CD       = #arApplyTp_Adjustment#
                                 AND APP.AR_SCR_CANC_FLG      = 'N'
                                 AND ADJ.GLBL_CMPY_CD         = APP.GLBL_CMPY_CD
                                 AND ADJ.EZCANCELFLAG         = '0'
                                 AND ADJ.AR_ADJ_NUM           = APP.AR_ADJ_NUM
                                 AND ADJ.AR_ADJ_TRX_TP_CD     = #arAdjTrxTp_OnAccount#
                                 AND ADJ.EZCANCELFLAG         = '0'
                                 AND ADJ.GLBL_CMPY_CD         = ATB.GLBL_CMPY_CD
                                 AND ADJ.AR_ADJ_NUM           = ATB.ATT_ADJ_NUM
                                 AND ATB.AR_CASH_APPLY_STS_CD IN (#arCashApplyStsCd_U#,#arCashApplyStsCd_P#)
                                 AND ATB.AR_TRX_TP_CD         = #arAdjTrxTp_OnAccount#
                            )                         FUNC_APPLY_ACC_AMT_B <!-- on Account -->
                           <!-- QC#29480 Add End -->
                           ,RC.FUNC_APPLY_AMT         FUNC_APPLY_AMT_B
                           ,RC.PAYER_CUST_CD          PAYER_CUST_CD_B
                           ,AC.DS_ACCT_NM             DS_ACCT_NM_B
                           ,RC.AR_CASH_APPLY_STS_CD   AR_CASH_APPLY_STS_CD_B
                           ,BR.AR_BAT_RCPT_STS_CD     AR_BAT_RCPT_STS_CD_B
                           ,RC.RCPT_CHK_NUM           RCPT_CHK_NUM_B
                           ,RC.FUNC_RCPT_RMNG_BAL_AMT FUNC_RCPT_RMNG_BAL_AMT_B
                       FROM
                           AR_RCPT        RC
                          ,AR_RCPT_TRX_TP TP
                          ,SELL_TO_CUST   AC
                          ,(SELECT
                                A.DS_BANK_ACCT_PK
                               ,A.DS_BANK_ACCT_NUM
                               ,A.DS_BANK_ACCT_NM
                               ,A.DS_BANK_ACCT_TP_CD
                               ,B.BANK_RTE_NUM
                               ,B.DS_BANK_BR_NM
                            FROM
                                DS_BANK_ACCT   A
                               ,DS_BANK_BR     B
                            WHERE
                                A.GLBL_CMPY_CD  = #glblCmpyCd#
                            AND
                                A.GLBL_CMPY_CD  = B.GLBL_CMPY_CD
                            AND
                                A.DS_BANK_BR_PK = B.DS_BANK_BR_PK
                            AND
                                A.EZCANCELFLAG  = '0'
                            AND
                                B.EZCANCELFLAG  = '0'
                           ) ACCT
                          ,AR_BAT_RCPT   BR
                       WHERE
                           RC.GLBL_CMPY_CD         = #glblCmpyCd#
                       AND
                           RC.EZCANCELFLAG         = '0'
                       AND
                           RC.GLBL_CMPY_CD         = TP.GLBL_CMPY_CD(+)
                       AND
                           RC.AR_RCPT_TRX_TP_CD    = TP.AR_RCPT_TRX_TP_CD(+)
                       AND
                           TP.EZCANCELFLAG(+)      = '0'
                       AND
                           RC.GLBL_CMPY_CD         = AC.GLBL_CMPY_CD(+)
                       AND
                           RC.PAYER_CUST_CD        = AC.SELL_TO_CUST_CD(+)
                       <isNotNull property="sMsg.dsAcctNm_H">
                           AND AC.DS_ACCT_NM LIKE #sMsg.dsAcctNm_H#
                       </isNotNull>
                       AND
                           AC.EZCANCELFLAG(+)     = '0'
                       AND
                           RC.REM_DS_BANK_ACCT_PK = ACCT.DS_BANK_ACCT_PK(+)
                       <isNotNull property="sMsg.dsBankCd_H">
                           AND ACCT.DS_BANK_CD = #sMsg.dsBankCd_H#
                       </isNotNull>
                       <isNotNull property="sMsg.bankRteNum_H">
                           AND ACCT.BANK_RTE_NUM = #sMsg.bankRteNum_H#
                       </isNotNull>
                       <isNotNull property="dsBankAcctNm_H">
                           AND UPPER(ACCT.DS_BANK_ACCT_NM) LIKE #dsBankAcctNm_H#
                       </isNotNull>
                       <isNotNull property="sMsg.dsBankAcctNum_H">
                           AND ACCT.DS_BANK_ACCT_NUM LIKE #sMsg.dsBankAcctNum_H#
                       </isNotNull>
                       <isNotNull property="dsBankBrNm_H">
                           AND UPPER(ACCT.DS_BANK_BR_NM) LIKE #dsBankBrNm_H#
                       </isNotNull>
                       <isNotNull property="sMsg.remDsBankAcctPk_H">
                           AND RC.REM_DS_BANK_ACCT_PK = #sMsg.remDsBankAcctPk_H#
                       </isNotNull>
                       <isNotNull property="sMsg.dsAcctNum_H">
                           AND RC.PAYER_CUST_CD LIKE #sMsg.dsAcctNum_H#
                       </isNotNull>
                       <isEqual property="rcptDocSearchFlg" compareValue="Y">
                           AND RC.RCPT_NUM LIKE #sMsg.rcptNum_H1#
                       </isEqual>
                       <isEqual property="rcptDocSearchFlg" compareValue="N">
                           <isNotNull property="sMsg.rcptNum_H1">
                               AND RC.RCPT_NUM &gt;= #sMsg.rcptNum_H1#
                           </isNotNull>
                           <isNotNull property="sMsg.rcptNum_H2">
                               AND RC.RCPT_NUM &lt;= #sMsg.rcptNum_H2#
                           </isNotNull>
                       </isEqual>
                       <isEqual property="rcptSearchFlg" compareValue="Y">
                           AND RC.RCPT_CHK_NUM LIKE #sMsg.rcptChkNum_H1#
                       </isEqual>
                       <isEqual property="rcptSearchFlg" compareValue="N">
                           <isNotNull property="sMsg.rcptChkNum_H1">
                               AND RC.RCPT_CHK_NUM &gt;= #sMsg.rcptChkNum_H1#
                           </isNotNull>
                           <isNotNull property="sMsg.rcptChkNum_H2">
                               AND RC.RCPT_CHK_NUM &lt;= #sMsg.rcptChkNum_H2#
                           </isNotNull>
                       </isEqual>
                       <!-- QC#26750 Mod Start-->
                       <isNotNull property="sMsg.rcptDt_H1">
                            AND NVL(RC.RCPT_CHK_DT, RC.RCPT_DT) &gt;= #sMsg.rcptDt_H1#
                       </isNotNull>
                       <isNotNull property="sMsg.rcptDt_H2">
                           AND NVL(RC.RCPT_CHK_DT, RC.RCPT_DT) &lt;= #sMsg.rcptDt_H2#
                       </isNotNull>
                       <!-- QC#26750 Mod End-->
                       <isNotNull property="sMsg.funcRcptAmt_H1">
                           AND DECODE(RC.FUNC_RCPT_AMT, 0, RC.FUNC_NET_RCPT_AMT, RC.FUNC_RCPT_AMT) &gt;= #sMsg.funcRcptAmt_H1#
                       </isNotNull>
                       <isNotNull property="sMsg.funcRcptAmt_H2">
                           AND DECODE(RC.FUNC_RCPT_AMT, 0, RC.FUNC_NET_RCPT_AMT, RC.FUNC_RCPT_AMT) &lt;= #sMsg.funcRcptAmt_H2#
                       </isNotNull>
                       <isNotNull property="sMsg.cratDt_H1">
                           AND CASE WHEN RC.AR_BAT_RCPT_NM IS NOT NULL THEN NVL(RC.AR_RCPT_REM_DT, RC.RCPT_DT)
                                    ELSE RC.RCPT_DT
                               END &gt;= #sMsg.cratDt_H1#
                       </isNotNull>
                       <isNotNull property="sMsg.cratDt_H2">
                           AND CASE WHEN RC.AR_BAT_RCPT_NM IS NOT NULL THEN NVL(RC.AR_RCPT_REM_DT, RC.RCPT_DT)
                                    ELSE RC.RCPT_DT
                               END &lt;= #sMsg.cratDt_H2#
                       </isNotNull>
                       <isNotNull property="sMsg.arRcptStsCd_H">
                           AND RC.AR_RCPT_STS_CD = #sMsg.arRcptStsCd_H#
                       </isNotNull>
                       <isNotNull property="sMsg.arCashApplyStsCd_H">
                           AND RC.AR_CASH_APPLY_STS_CD = #sMsg.arCashApplyStsCd_H#
                       </isNotNull>
                       <isNotNull property="sMsg.psnCd_H">
                           AND EXISTS
                                     (SELECT
                                          *
                                      FROM
                                          CLT_PTFO       A
                                         ,SELL_TO_CUST   B
                                      WHERE
                                          A.GLBL_CMPY_CD      = RC.GLBL_CMPY_CD
                                      AND
                                          A.EZCANCELFLAG      = '0'
                                      AND
                                          A.CLT_PSN_CD        = #sMsg.psnCd_H#
                                      AND
                                          B.GLBL_CMPY_CD      = A.GLBL_CMPY_CD
                                      AND
                                          B.EZCANCELFLAG      = '0'
                                      AND
                                          B.CLT_PTFO_PK       = A.CLT_PTFO_PK
                                      AND
                                          B.SELL_TO_CUST_CD   = RC.PAYER_CUST_CD
                                     )
                       </isNotNull>
                       AND RC.GLBL_CMPY_CD         = BR.GLBL_CMPY_CD(+)
                       AND BR.EZCANCELFLAG(+)      = '0' 
                       AND RC.AR_BAT_RCPT_NM       = BR.AR_BAT_RCPT_NM(+)
                       <isNotNull property="sMsg.arRcptSrcCd_H">
                       <!-- START 2018/11/08 [QC#29097,MOD] -->
                           <!--  AND BR.AR_RCPT_SRC_CD    = #sMsg.arRcptSrcCd_H# -->
                           AND RC.AR_RCPT_SRC_CD    = #sMsg.arRcptSrcCd_H#
                       <!-- END 2018/11/08 [QC#29097,MOD] -->
                       </isNotNull>
                       <isNotNull property="sMsg.arBatRcptStsCd_H">
                           AND BR.AR_BAT_RCPT_STS_CD    = #sMsg.arBatRcptStsCd_H#
                       </isNotNull>
                       <isNotNull property="sMsg.arLockBoxFileNm_H">
                           AND BR.AR_LOCK_BOX_FILE_NM LIKE #sMsg.arLockBoxFileNm_H#
                       </isNotNull>
                       <isNotNull property="sMsg.arLockBoxCd_H">
                           AND BR.AR_LOCK_BOX_CD = #sMsg.arLockBoxCd_H#
                       </isNotNull>
                       <isNotNull property="sMsg.arLockBoxBatNum_H">
                           AND BR.AR_LOCK_BOX_BAT_NUM = #sMsg.arLockBoxBatNum_H#
                       </isNotNull>
                       <isNotNull property="sMsg.arBatRcptNm_H">
                       <!-- START 2021/10/01 S.Go [QC#57903, MOD] -->
                           <!-- AND BR.AR_BAT_RCPT_NM LIKE #sMsg.arBatRcptNm_H# -->
                           AND UPPER(BR.AR_BAT_RCPT_NM) LIKE #sMsg.arBatRcptNm_H#
                       <!-- END 2021/10/01 S.Go [QC#57903, MOD] --> 
                       </isNotNull>
                       <!-- START 2018/12/06 [QC#29528,ADD] -->
                       AND NOT (
                               RC.AR_RCPT_TP_CD = #arRcptTp_Offset#
                           AND
                               EXISTS (
                                   SELECT
                                        1
                                   FROM
                                        AR_CASH_APP ACA
                                   WHERE
                                        ACA.RCPT_NUM        = RC.RCPT_NUM
                                    AND ACA.GLBL_CMPY_CD    = RC.GLBL_CMPY_CD
                                    AND ACA.EZCANCELFLAG    = '0'
                                    AND ACA.AR_SCR_CANC_FLG = 'N'
                                    AND EXISTS (
                                         SELECT
                                             1
                                         FROM
                                              AR_CASH_APP ACA2
                                         WHERE
                                              ACA2.AR_CASH_APP_PK   = ACA.AR_CASH_APP_PK
                                          AND ACA2.GLBL_CMPY_CD     = ACA.GLBL_CMPY_CD
                                          AND ACA2.EZCANCELFLAG     = '0'
                                          AND ACA2.AR_SCR_CANC_FLG  = 'N'
                                          AND ACA2.AR_APPLY_TP_CD   = #arApplyTp_Adjustment#
                                          AND ACA2.RCPT_NUM         IS NULL
                                    )
                               )
                       )
                       <!-- END 2018/12/06 [QC#29528,ADD] -->
            )
            <isNotEqual property="existBatRcptCondition" compareValue="Y">
            SELECT
                A.AR_BAT_RCPT_NM_A                 AR_BAT_RCPT_NM_A
               ,A.RCPT_NUM_A                       RCPT_NUM_A
               ,A.AR_RCPT_SRC_NM_A                 AR_RCPT_SRC_NM_A
               ,A.AR_BAT_RCPT_DT_A                 AR_BAT_RCPT_DT_A
               ,A.AR_BAT_RCPT_STS_NM_A             AR_BAT_RCPT_STS_NM_A
               ,A.AR_BAT_RCPT_CNT_A                AR_BAT_RCPT_CNT_A
               ,A.AR_BAT_RCPT_AMT_A                AR_BAT_RCPT_AMT_A
               ,A.AR_LOCK_BOX_FILE_NM_A            AR_LOCK_BOX_FILE_NM_A
               ,A.AR_LOCK_BOX_NM_A                 AR_LOCK_BOX_NM_A
               ,A.AR_LOCK_BOX_BAT_NUM_A            AR_LOCK_BOX_BAT_NUM_A
               ,A.SORT                             SORT
               <!-- QC#29480 Mod Start -->
               ,NVL(B.FUNC_APPLY_ACC_AMT_B, 0)     XX_TOT_AMT_A
               <!-- QC#29480 Mod End -->
               ,B.AR_RCPT_TRX_TP_NM_B              AR_RCPT_TRX_TP_NM_A
               ,B.RCPT_DT_B                        RCPT_DT_A
               ,NVL(B.FUNC_RCPT_AMT_B ,0)          FUNC_RCPT_AMT_A
               <!-- QC#29480 Mod Start -->
               ,NVL(B.FUNC_APPLY_AMT_B, 0) + NVL(B.FUNC_APPLY_ADJ_AMT_B, 0) - NVL(B.FUNC_APPLY_ACC_AMT_B, 0) FUNC_APPLY_AMT_A
               <!-- QC#29480 Mod End -->
               ,B.PAYER_CUST_CD_B                  PAYER_CUST_CD_A
               ,B.DS_ACCT_NM_B                     DS_ACCT_NM_A
               ,B.AR_CASH_APPLY_STS_CD_B           AR_CASH_APPLY_STS_CD_A
               ,B.AR_BAT_RCPT_STS_CD_B             AR_BAT_RCPT_STS_CD_A
               ,B.RCPT_CHK_NUM_B                   RCPT_CHK_NUM_A
               ,NVL(B.FUNC_RCPT_RMNG_BAL_AMT_B, 0) FUNC_RCPT_RMNG_BAL_AMT_A
               ,A.XX_REC_HIST_CRAT_TS              XX_REC_HIST_CRAT_TS
               ,A.XX_REC_HIST_CRAT_BY_NM           XX_REC_HIST_CRAT_BY_NM
               ,A.XX_REC_HIST_UPD_TS               XX_REC_HIST_UPD_TS
               ,A.XX_REC_HIST_UPD_BY_NM            XX_REC_HIST_UPD_BY_NM
               ,A.XX_REC_HIST_TBL_NM               XX_REC_HIST_TBL_NM
            FROM
                RCPT_D  B
               ,(SELECT 
                     NULL                     AR_BAT_RCPT_NM_A
                    ,RC.RCPT_NUM              RCPT_NUM_A
                    ,NULL                     AR_RCPT_SRC_NM_A
                    ,NULL                     AR_BAT_RCPT_DT_A
                    ,NULL                     AR_BAT_RCPT_STS_NM_A
                    ,NULL                     AR_BAT_RCPT_CNT_A
                    ,NULL                     AR_BAT_RCPT_AMT_A
                    ,NULL                     AR_LOCK_BOX_FILE_NM_A
                    ,NULL                     AR_LOCK_BOX_NM_A
                    ,NULL                     AR_LOCK_BOX_BAT_NUM_A
                    <!-- QC#26750 Mod Start-->
                    ,NVL(RC.RCPT_CHK_DT, RC.RCPT_DT) SORT
                    <!-- QC#26750 Mod End-->
                    ,RC.EZINTIME              XX_REC_HIST_CRAT_TS
	                ,RC.EZUPTIME              XX_REC_HIST_UPD_TS
                    ,CASE WHEN IN_AP.MID_NM IS NULL AND IN_AP.FIRST_NM IS NULL THEN RC.EZINUSERID
                          WHEN IN_AP.MID_NM IS NULL THEN RC.EZINUSERID || ' : ' || IN_AP.FIRST_NM || ' ' || IN_AP.LAST_NM
                          WHEN IN_AP.MID_NM IS NOT NULL THEN RC.EZINUSERID || ' : ' || IN_AP.FIRST_NM || IN_AP.MID_NM || ' ' || IN_AP.LAST_NM
                          ELSE RC.EZINUSERID
                     END AS XX_REC_HIST_CRAT_BY_NM
                    ,CASE WHEN UP_AP.MID_NM IS NULL AND UP_AP.FIRST_NM IS NULL THEN RC.EZUPUSERID
                          WHEN UP_AP.MID_NM IS NULL THEN RC.EZUPUSERID || ' : ' || UP_AP.FIRST_NM || ' ' || UP_AP.LAST_NM
                          WHEN UP_AP.MID_NM IS NOT NULL THEN RC.EZUPUSERID || ' : ' || UP_AP.FIRST_NM || UP_AP.MID_NM || ' ' || UP_AP.LAST_NM
                          ELSE RC.EZUPUSERID
                     END AS XX_REC_HIST_UPD_BY_NM
	                ,RC.EZTABLEID             XX_REC_HIST_TBL_NM
                   FROM
                    AR_RCPT RC
                   ,SELL_TO_CUST   AC
                   ,(SELECT
                         A.DS_BANK_ACCT_PK
                        ,A.DS_BANK_ACCT_NUM
                        ,A.DS_BANK_ACCT_NM
                        ,A.DS_BANK_ACCT_TP_CD
                        ,B.BANK_RTE_NUM
                        ,B.DS_BANK_BR_NM
                     FROM
                         DS_BANK_ACCT   A
                        ,DS_BANK_BR     B
                     WHERE
                            A.GLBL_CMPY_CD  = #glblCmpyCd#
                        AND A.GLBL_CMPY_CD  = B.GLBL_CMPY_CD
                        AND A.DS_BANK_BR_PK = B.DS_BANK_BR_PK
                        AND A.EZCANCELFLAG  = '0'
                        AND B.EZCANCELFLAG  = '0'
                    ) ACCT
                    ,AUTH_PSN    IN_AP
                    ,AUTH_PSN    UP_AP
                 WHERE  RC.GLBL_CMPY_CD   = #glblCmpyCd#
                 AND    RC.AR_BAT_RCPT_NM IS NULL
                 <isNotNull property="sMsg.dsAcctNum_H">
                 AND RC.PAYER_CUST_CD LIKE #sMsg.dsAcctNum_H#
                 </isNotNull>
                 <isEqual property="rcptDocSearchFlg" compareValue="Y">
                 AND RC.RCPT_NUM LIKE #sMsg.rcptNum_H1#
                 </isEqual>
                 <isEqual property="rcptDocSearchFlg" compareValue="N">
                     <isNotNull property="sMsg.rcptNum_H1">
                     AND RC.RCPT_NUM &gt;= #sMsg.rcptNum_H1#
                     </isNotNull>
                     <isNotNull property="sMsg.rcptNum_H2">
                     AND RC.RCPT_NUM &lt;= #sMsg.rcptNum_H2#
                     </isNotNull>
                 </isEqual>
                 <isEqual property="rcptSearchFlg" compareValue="Y">
                 AND RC.RCPT_CHK_NUM LIKE #sMsg.rcptChkNum_H1#
                 </isEqual>
                 <isEqual property="rcptSearchFlg" compareValue="N">
                     <isNotNull property="sMsg.rcptChkNum_H1">
                     AND RC.RCPT_CHK_NUM &gt;= #sMsg.rcptChkNum_H1#
                     </isNotNull>
                     <isNotNull property="sMsg.rcptChkNum_H2">
                     AND RC.RCPT_CHK_NUM &lt;= #sMsg.rcptChkNum_H2#
                     </isNotNull>
                 </isEqual>
                 <!-- QC#26750 Mod Start-->
                 <isNotNull property="sMsg.rcptDt_H1">
                 AND NVL(RC.RCPT_CHK_DT, RC.RCPT_DT) &gt;= #sMsg.rcptDt_H1#
                 </isNotNull>
                 <isNotNull property="sMsg.rcptDt_H2">
                 AND NVL(RC.RCPT_CHK_DT, RC.RCPT_DT) &lt;= #sMsg.rcptDt_H2#
                 </isNotNull>
                 <!-- QC#26750 Mod End-->
                 <isNotNull property="sMsg.funcRcptAmt_H1">
                 AND NVL(RC.FUNC_RCPT_AMT, RC.FUNC_NET_RCPT_AMT) &gt;= #sMsg.funcRcptAmt_H1#
                 </isNotNull>
                 <isNotNull property="sMsg.funcRcptAmt_H2">
                 AND NVL(RC.FUNC_RCPT_AMT, RC.FUNC_NET_RCPT_AMT) &lt;= #sMsg.funcRcptAmt_H2#
                 </isNotNull>
                 <isNotNull property="sMsg.arRcptStsCd_H">
                 AND RC.AR_RCPT_STS_CD = #sMsg.arRcptStsCd_H#
                 </isNotNull>
                 <isNotNull property="sMsg.arCashApplyStsCd_H">
                 AND RC.AR_CASH_APPLY_STS_CD = #sMsg.arCashApplyStsCd_H#
                 </isNotNull>
                 <isNotNull property="sMsg.psnCd_H">
                 AND     RC.GLBL_CMPY_CD         = AC.GLBL_CMPY_CD(+)
                 AND EXISTS
                           (SELECT
                                *
                            FROM 
                               CLT_PTFO       A
                              ,SELL_TO_CUST   B
                            WHERE 
                               A.GLBL_CMPY_CD      = RC.GLBL_CMPY_CD
                            AND A.EZCANCELFLAG      = '0'
                            AND A.CLT_PSN_CD        = #sMsg.psnCd_H#
                            AND B.GLBL_CMPY_CD      = A.GLBL_CMPY_CD
                            AND B.EZCANCELFLAG      = '0'
                            AND B.CLT_PTFO_PK       = A.CLT_PTFO_PK
                            AND B.SELL_TO_CUST_CD   = RC.PAYER_CUST_CD
                           )
                 </isNotNull>
                 AND     RC.PAYER_CUST_CD        = AC.SELL_TO_CUST_CD(+)
                 <isNotNull property="sMsg.dsAcctNm_H">
                 AND AC.DS_ACCT_NM LIKE #sMsg.dsAcctNm_H#
                 </isNotNull>
                 AND     AC.EZCANCELFLAG(+)      = '0'
                 AND     RC.EZCANCELFLAG         = '0'
                 AND RC.REM_DS_BANK_ACCT_PK = ACCT.DS_BANK_ACCT_PK(+)
                 <isNotNull property="sMsg.bankRteNum_H">
                 AND ACCT.BANK_RTE_NUM = #sMsg.bankRteNum_H#
                 </isNotNull>
                 <isNotNull property="dsBankAcctNm_H">
                 AND UPPER(ACCT.DS_BANK_ACCT_NM) LIKE #dsBankAcctNm_H#
                 </isNotNull>
                 <isNotNull property="sMsg.dsBankAcctNum_H">
                 AND ACCT.DS_BANK_ACCT_NUM LIKE #sMsg.dsBankAcctNum_H#
                 </isNotNull>
                 <isNotNull property="dsBankBrNm_H">
                 AND UPPER(ACCT.DS_BANK_BR_NM) LIKE #dsBankBrNm_H#
                 </isNotNull>
                 <isNotNull property="sMsg.cratDt_H1">
                 AND RC.RCPT_DT &gt;= #sMsg.cratDt_H1#
                 </isNotNull>
                 <isNotNull property="sMsg.cratDt_H2">
                 AND RC.RCPT_DT &lt;= #sMsg.cratDt_H2#
                 </isNotNull>
                 <!-- START 2018/11/08 [QC#29097,ADD] -->
                 <isNotNull property="sMsg.arRcptSrcCd_H">
                 AND RC.AR_RCPT_SRC_CD = #sMsg.arRcptSrcCd_H#
                 </isNotNull>
                 <!-- END 2018/11/08 [QC#29097,ADD] -->
                 AND RC.GLBL_CMPY_CD          = IN_AP.GLBL_CMPY_CD(+)
                 AND UPPER(RC.EZINUSERID)     = UPPER(IN_AP.USR_NM(+))
                 AND IN_AP.EZCANCELFLAG(+)    = '0'
                 AND RC.GLBL_CMPY_CD          = UP_AP.GLBL_CMPY_CD(+)
                 AND UPPER(RC.EZUPUSERID)     = UPPER(UP_AP.USR_NM(+))
                 AND UP_AP.EZCANCELFLAG(+)    = '0'
                 ) A
            WHERE
               A.RCPT_NUM_A = B.RCPT_NUM_B
            UNION
            </isNotEqual>
            SELECT
                A.AR_BAT_RCPT_NM_A                 AR_BAT_RCPT_NM_A
               ,B.RCPT_NUM_B                       RCPT_NUM_A
               ,A.AR_RCPT_SRC_NM_A                 AR_RCPT_SRC_NM_A
               ,A.AR_BAT_RCPT_DT_A                 AR_BAT_RCPT_DT_A
               ,A.AR_BAT_RCPT_STS_NM_A             AR_BAT_RCPT_STS_NM_A
               ,A.AR_BAT_RCPT_CNT_A                AR_BAT_RCPT_CNT_A
               ,A.AR_BAT_RCPT_AMT_A                AR_BAT_RCPT_AMT_A
               ,A.AR_LOCK_BOX_FILE_NM_A            AR_LOCK_BOX_FILE_NM_A
               ,A.AR_LOCK_BOX_NM_A                 AR_LOCK_BOX_NM_A
               ,A.AR_LOCK_BOX_BAT_NUM_A            AR_LOCK_BOX_BAT_NUM_A
               ,A.SORT                             SORT
               <!-- QC#29480 Mod Start -->
               ,NVL(B.FUNC_APPLY_ACC_AMT_B, 0)     XX_TOT_AMT_A
               <!-- QC#29480 Mod End -->
               ,B.AR_RCPT_TRX_TP_NM_B              AR_RCPT_TRX_TP_NM_A
               ,B.RCPT_DT_B                        RCPT_DT_A
               ,NVL(B.FUNC_RCPT_AMT_B ,0)          FUNC_RCPT_AMT_A
               <!-- QC#29480 Mod Start -->
               ,NVL(B.FUNC_APPLY_AMT_B, 0) + NVL(B.FUNC_APPLY_ADJ_AMT_B, 0) - NVL(B.FUNC_APPLY_ACC_AMT_B, 0) FUNC_APPLY_AMT_A
               <!-- QC#29480 Mod End -->
               ,B.PAYER_CUST_CD_B                  PAYER_CUST_CD_A
               ,B.DS_ACCT_NM_B                     DS_ACCT_NM_A
               ,B.AR_CASH_APPLY_STS_CD_B           AR_CASH_APPLY_STS_CD_A
               ,B.AR_BAT_RCPT_STS_CD_B             AR_BAT_RCPT_STS_CD_A
               ,B.RCPT_CHK_NUM_B                   RCPT_CHK_NUM_A
               ,NVL(B.FUNC_RCPT_RMNG_BAL_AMT_B, 0) FUNC_RCPT_RMNG_BAL_AMT_A
               ,A.XX_REC_HIST_CRAT_TS              XX_REC_HIST_CRAT_TS
               ,A.XX_REC_HIST_CRAT_BY_NM           XX_REC_HIST_CRAT_BY_NM
               ,A.XX_REC_HIST_UPD_TS               XX_REC_HIST_UPD_TS
               ,A.XX_REC_HIST_UPD_BY_NM            XX_REC_HIST_UPD_BY_NM
               ,A.XX_REC_HIST_TBL_NM               XX_REC_HIST_TBL_NM
            FROM
                RCPT_D  B
               ,(SELECT
                     BR.AR_BAT_RCPT_NM        AR_BAT_RCPT_NM_A
                    ,NULL                     RCPT_NUM_A
                    ,SRC.AR_RCPT_SRC_NM       AR_RCPT_SRC_NM_A
                    ,BR.AR_BAT_RCPT_DT        AR_BAT_RCPT_DT_A
                    ,STS.AR_BAT_RCPT_STS_NM   AR_BAT_RCPT_STS_NM_A
                    ,BR.AR_BAT_RCPT_CNT       AR_BAT_RCPT_CNT_A
                    ,BR.AR_BAT_RCPT_AMT       AR_BAT_RCPT_AMT_A
                    ,BR.AR_LOCK_BOX_FILE_NM   AR_LOCK_BOX_FILE_NM_A
                    ,LB.AR_LOCK_BOX_DESC_TXT  AR_LOCK_BOX_NM_A
                    ,BR.AR_LOCK_BOX_BAT_NUM   AR_LOCK_BOX_BAT_NUM_A
                    ,BR.AR_BAT_RCPT_DT        SORT
                    ,BR.EZINTIME              XX_REC_HIST_CRAT_TS
                    ,BR.EZUPTIME              XX_REC_HIST_UPD_TS
                    ,BR.EZTABLEID             XX_REC_HIST_TBL_NM
                    ,CASE WHEN IN_AP.MID_NM IS NULL AND IN_AP.FIRST_NM IS NULL THEN BR.EZINUSERID
                          WHEN IN_AP.MID_NM IS NULL THEN BR.EZINUSERID || ' : ' || IN_AP.FIRST_NM || ' ' || IN_AP.LAST_NM
                          WHEN IN_AP.MID_NM IS NOT NULL THEN BR.EZINUSERID || ' : ' || IN_AP.FIRST_NM || IN_AP.MID_NM || ' ' || IN_AP.LAST_NM
                          ELSE BR.EZINUSERID
                     END AS XX_REC_HIST_CRAT_BY_NM
                    ,CASE WHEN UP_AP.MID_NM IS NULL AND UP_AP.FIRST_NM IS NULL THEN BR.EZUPUSERID
                          WHEN UP_AP.MID_NM IS NULL THEN BR.EZUPUSERID || ' : ' || UP_AP.FIRST_NM || ' ' || UP_AP.LAST_NM
                          WHEN UP_AP.MID_NM IS NOT NULL THEN BR.EZUPUSERID || ' : ' || UP_AP.FIRST_NM || UP_AP.MID_NM || ' ' || UP_AP.LAST_NM
                          ELSE BR.EZUPUSERID
                     END AS XX_REC_HIST_UPD_BY_NM
                 FROM
                     AR_BAT_RCPT      BR
                    ,AR_RCPT_SRC      SRC
                    ,AR_BAT_RCPT_STS  STS
                    ,AR_LOCK_BOX      LB
                    ,(SELECT
                          A.DS_BANK_ACCT_PK
                         ,A.DS_BANK_ACCT_NUM
                         ,A.DS_BANK_ACCT_NM
                         ,A.DS_BANK_ACCT_TP_CD
                         ,B.BANK_RTE_NUM
                         ,B.DS_BANK_BR_NM
                      FROM
                          DS_BANK_ACCT   A
                         ,DS_BANK_BR     B
                      WHERE
                          A.GLBL_CMPY_CD  = #glblCmpyCd#
                      AND A.GLBL_CMPY_CD  = B.GLBL_CMPY_CD
                      AND A.DS_BANK_BR_PK = B.DS_BANK_BR_PK
                      AND A.EZCANCELFLAG  = '0'
                      AND B.EZCANCELFLAG  = '0'
                     )ACCT
                     ,AUTH_PSN    IN_AP
                     ,AUTH_PSN    UP_AP
                 WHERE BR.GLBL_CMPY_CD        = #glblCmpyCd#
                 AND   BR.EZCANCELFLAG        = '0'
                 AND   BR.GLBL_CMPY_CD        = SRC.GLBL_CMPY_CD(+)
                 AND   BR.AR_RCPT_SRC_CD      = SRC.AR_RCPT_SRC_CD(+)
                 AND   SRC.EZCANCELFLAG(+)    = '0'
                 AND   BR.GLBL_CMPY_CD        = STS.GLBL_CMPY_CD(+)
                 AND   BR.AR_BAT_RCPT_STS_CD  = STS.AR_BAT_RCPT_STS_CD(+)
                 AND   STS.EZCANCELFLAG(+)    = '0'
                 AND   BR.GLBL_CMPY_CD        = LB.GLBL_CMPY_CD(+)
                 AND   BR.AR_LOCK_BOX_CD      = LB.AR_LOCK_BOX_CD(+)
                 AND   LB.EZCANCELFLAG(+)     = '0'
                 AND   BR.REM_DS_BANK_ACCT_PK = ACCT.DS_BANK_ACCT_PK(+)
                 <isNotNull property="sMsg.bankRteNum_H">
                 AND ACCT.BANK_RTE_NUM = #sMsg.bankRteNum_H#
                 </isNotNull>
                 <isNotNull property="dsBankAcctNm_H">
                 AND UPPER(ACCT.DS_BANK_ACCT_NM) LIKE #dsBankAcctNm_H#
                 </isNotNull>
                 <isNotNull property="sMsg.dsBankAcctNum_H">
                     AND ACCT.DS_BANK_ACCT_NUM LIKE #sMsg.dsBankAcctNum_H#
                 </isNotNull>
                 <isNotNull property="dsBankBrNm_H">
                     AND UPPER(ACCT.DS_BANK_BR_NM) LIKE #dsBankBrNm_H#
                 </isNotNull>
                 <isNotNull property="sMsg.arRcptSrcCd_H">
                     AND BR.AR_RCPT_SRC_CD = #sMsg.arRcptSrcCd_H#
                 </isNotNull>
                 <isNotNull property="sMsg.arBatRcptNm_H">
                 <!-- START 2021/10/01 S.Go [QC#57903, MOD] -->
                     <!-- AND BR.AR_BAT_RCPT_NM LIKE #sMsg.arBatRcptNm_H# -->
                     AND UPPER(BR.AR_BAT_RCPT_NM) LIKE #sMsg.arBatRcptNm_H#
                 <!-- END 2021/10/01 S.Go [QC#57903, MOD] -->    
                 </isNotNull>
                 <isNotNull property="sMsg.arBatRcptStsCd_H">
                     AND BR.AR_BAT_RCPT_STS_CD = #sMsg.arBatRcptStsCd_H#
                 </isNotNull>
                 <isNotNull property="sMsg.arLockBoxFileNm_H">
                     AND BR.AR_LOCK_BOX_FILE_NM LIKE #sMsg.arLockBoxFileNm_H#
                 </isNotNull>
                 <isNotNull property="sMsg.arLockBoxCd_H">
                     AND BR.AR_LOCK_BOX_CD = #sMsg.arLockBoxCd_H#
                 </isNotNull>
                 <isNotNull property="sMsg.arLockBoxBatNum_H">
                     AND BR.AR_LOCK_BOX_BAT_NUM = #sMsg.arLockBoxBatNum_H#
                 </isNotNull>
                 <isNotNull property="sMsg.cratDt_H1">
                     AND BR.AR_BAT_RCPT_DT &gt;= #sMsg.cratDt_H1#
                 </isNotNull>
                 <isNotNull property="sMsg.cratDt_H2">
                     AND BR.AR_BAT_RCPT_DT &lt;= #sMsg.cratDt_H2#
                 </isNotNull>
                 <isEqual property="existRcptCondition" compareValue="Y">
                     AND EXISTS
                               (SELECT 1
                                FROM   AR_RCPT RC
                                      ,SELL_TO_CUST   AC
                                WHERE  RC.GLBL_CMPY_CD   = BR.GLBL_CMPY_CD
                                AND    RC.AR_BAT_RCPT_NM = BR.AR_BAT_RCPT_NM
                                <isNotNull property="sMsg.dsAcctNum_H">
                                AND RC.PAYER_CUST_CD LIKE #sMsg.dsAcctNum_H#
                                </isNotNull>
                                <isEqual property="rcptDocSearchFlg" compareValue="Y">
                                AND RC.RCPT_NUM LIKE #sMsg.rcptNum_H1#
                                </isEqual>
                                <isEqual property="rcptDocSearchFlg" compareValue="N">
                                    <isNotNull property="sMsg.rcptNum_H1">
                                    AND RC.RCPT_NUM &gt;= #sMsg.rcptNum_H1#
                                    </isNotNull>
                                    <isNotNull property="sMsg.rcptNum_H2">
                                    AND RC.RCPT_NUM &lt;= #sMsg.rcptNum_H2#
                                    </isNotNull>
                                </isEqual>
                                <isEqual property="rcptSearchFlg" compareValue="Y">
                                AND RC.RCPT_CHK_NUM LIKE #sMsg.rcptChkNum_H1#
                                </isEqual>
                                <isEqual property="rcptSearchFlg" compareValue="N">
                                    <isNotNull property="sMsg.rcptChkNum_H1">
                                    AND RC.RCPT_CHK_NUM &gt;= #sMsg.rcptChkNum_H1#
                                    </isNotNull>
                                    <isNotNull property="sMsg.rcptChkNum_H2">
                                    AND RC.RCPT_CHK_NUM &lt;= #sMsg.rcptChkNum_H2#
                                    </isNotNull>
                                </isEqual>
                                <!-- QC#26750 Mod Start-->
                                <isNotNull property="sMsg.rcptDt_H1">
                                AND NVL(RC.RCPT_CHK_DT, RC.RCPT_DT) &gt;= #sMsg.rcptDt_H1#
                                </isNotNull>
                                <isNotNull property="sMsg.rcptDt_H2">
                                AND NVL(RC.RCPT_CHK_DT, RC.RCPT_DT) &lt;= #sMsg.rcptDt_H2#
                                </isNotNull>
                                <!-- QC#26750 Mod End-->
                                <isNotNull property="sMsg.funcRcptAmt_H1">
                                AND DECODE(RC.FUNC_RCPT_AMT, 0, RC.FUNC_NET_RCPT_AMT, RC.FUNC_RCPT_AMT) &gt;= #sMsg.funcRcptAmt_H1#
                                </isNotNull>
                                <isNotNull property="sMsg.funcRcptAmt_H2">
                                AND DECODE(RC.FUNC_RCPT_AMT, 0, RC.FUNC_NET_RCPT_AMT, RC.FUNC_RCPT_AMT) &lt;= #sMsg.funcRcptAmt_H2#
                                </isNotNull>
                                <isNotNull property="sMsg.arRcptStsCd_H">
                                AND RC.AR_RCPT_STS_CD = #sMsg.arRcptStsCd_H#
                                </isNotNull>
                                <isNotNull property="sMsg.arCashApplyStsCd_H">
                                AND RC.AR_CASH_APPLY_STS_CD = #sMsg.arCashApplyStsCd_H#
                                </isNotNull>
                                <!-- START 2018/11/08 [QC#29097,ADD] -->
                                <isNotNull property="sMsg.arRcptSrcCd_H">
                                AND RC.AR_RCPT_SRC_CD = #sMsg.arRcptSrcCd_H#
                                </isNotNull>
                                <!-- END 2018/11/08 [QC#29097,ADD] -->
                                <isNotNull property="sMsg.psnCd_H">
                                AND     RC.GLBL_CMPY_CD         = AC.GLBL_CMPY_CD(+)
                                AND EXISTS
                                          (SELECT
                                               *
                                           FROM 
                                               CLT_PTFO       A
                                              ,SELL_TO_CUST   B
                                           WHERE 
                                               A.GLBL_CMPY_CD      = RC.GLBL_CMPY_CD
                                               AND A.EZCANCELFLAG      = '0'
                                               AND A.CLT_PSN_CD        = #sMsg.psnCd_H#
                                               AND B.GLBL_CMPY_CD      = A.GLBL_CMPY_CD
                                               AND B.EZCANCELFLAG      = '0'
                                               AND B.CLT_PTFO_PK       = A.CLT_PTFO_PK
                                               AND B.SELL_TO_CUST_CD   = RC.PAYER_CUST_CD
                                           )
                                </isNotNull>
                                AND     RC.PAYER_CUST_CD        = AC.SELL_TO_CUST_CD(+)
                                <isNotNull property="sMsg.dsAcctNm_H">
                                AND AC.DS_ACCT_NM LIKE #sMsg.dsAcctNm_H#
                                </isNotNull>
                                AND     AC.EZCANCELFLAG(+)      = '0'
                                AND     RC.EZCANCELFLAG         = '0'
                               )
                 </isEqual>
                 AND BR.GLBL_CMPY_CD          = IN_AP.GLBL_CMPY_CD(+)
                 AND UPPER(BR.EZINUSERID)     = UPPER(IN_AP.USR_NM(+))
                 AND IN_AP.EZCANCELFLAG(+)    = '0'
                 AND BR.GLBL_CMPY_CD          = UP_AP.GLBL_CMPY_CD(+)
                 AND UPPER(BR.EZUPUSERID)     = UPPER(UP_AP.USR_NM(+))
                 AND UP_AP.EZCANCELFLAG(+)    = '0'
                ) A
            WHERE
               A.AR_BAT_RCPT_NM_A = B.AR_BAT_RCPT_NM_B(+)
            ORDER BY
               RCPT_NUM_A, SORT
    </statement>
    <resultMap id="result.getRcptDataList" class="NFCL3010_ASMsg">
        <result property="arBatRcptNm_A"        column="AR_BAT_RCPT_NM_A"         javaType="EZDSStringItem" />
        <result property="rcptNum_A"            column="RCPT_NUM_A"               javaType="EZDSStringItem" />
        <result property="arRcptSrcNm_A"        column="AR_RCPT_SRC_NM_A"         javaType="EZDSStringItem" />
        <result property="arBatRcptDt_A"        column="AR_BAT_RCPT_DT_A"         javaType="EZDSStringItem" />
        <result property="arBatRcptStsNm_A"     column="AR_BAT_RCPT_STS_NM_A"     javaType="EZDSStringItem" />
        <result property="arBatRcptCnt_A"       column="AR_BAT_RCPT_CNT_A"        javaType="EZDSBigDecimalItem" />
        <result property="arBatRcptAmt_A"       column="AR_BAT_RCPT_AMT_A"        javaType="EZDSBigDecimalItem" />
        <result property="arLockBoxFileNm_A"    column="AR_LOCK_BOX_FILE_NM_A"    javaType="EZDSStringItem" />
        <result property="arLockBoxNm_A"        column="AR_LOCK_BOX_NM_A"         javaType="EZDSStringItem" />
        <result property="arLockBoxBatNum_A"    column="AR_LOCK_BOX_BAT_NUM_A"    javaType="EZDSStringItem" />

        <result property="arRcptTrxTpNm_A"      column="AR_RCPT_TRX_TP_NM_A"      javaType="EZDSStringItem" />
        <result property="rcptDt_A"             column="RCPT_DT_A"                javaType="EZDSStringItem" />
        <result property="funcRcptAmt_A"        column="FUNC_RCPT_AMT_A"          javaType="EZDSStringItem" />
        <result property="funcApplyAmt_A"       column="FUNC_APPLY_AMT_A"         javaType="EZDSBigDecimalItem" />
        <result property="payerCustCd_A"        column="PAYER_CUST_CD_A"          javaType="EZDSStringItem" />
        <result property="dsAcctNm_A"           column="DS_ACCT_NM_A"             javaType="EZDSStringItem" />
        <result property="arCashApplyStsCd_A"   column="AR_CASH_APPLY_STS_CD_A"   javaType="EZDSStringItem" />
        <result property="arBatRcptStsCd_A"     column="AR_BAT_RCPT_STS_CD_A"     javaType="EZDSStringItem" />
        <result property="rcptChkNum_A"         column="RCPT_CHK_NUM_A"           javaType="EZDSStringItem" />
        <result property="xxTotAmt_A"           column="XX_TOT_AMT_A"             javaType="EZDSBigDecimalItem" />
        <result property="funcRcptRmngBalAmt_A" column="FUNC_RCPT_RMNG_BAL_AMT_A" javaType="EZDSBigDecimalItem" />

        <result property="xxRecHistCratTs_A"    column="XX_REC_HIST_CRAT_TS"      javaType="EZDCStringItem"/>
        <result property="xxRecHistCratByNm_A"  column="XX_REC_HIST_CRAT_BY_NM"   javaType="EZDCStringItem"/>
        <result property="xxRecHistUpdTs_A"     column="XX_REC_HIST_UPD_TS"       javaType="EZDCStringItem"/>
        <result property="xxRecHistUpdByNm_A"   column="XX_REC_HIST_UPD_BY_NM"    javaType="EZDCStringItem"/>
        <result property="xxRecHistTblNm_A"     column="XX_REC_HIST_TBL_NM"       javaType="EZDCStringItem"/>

    </resultMap>

    <!-- START 2018/06/08 E.Kameishi [QC#25735,ADD] -->
    <statement id="getRcptDataDLList" parameterClass="Map" resultClass="Map">
        WITH
            RCPT_D AS (
                       SELECT
                            RC.AR_BAT_RCPT_NM         AR_BAT_RCPT_NM_B
                           ,RC.RCPT_NUM               RCPT_NUM_B
                           ,TP.AR_RCPT_TRX_TP_NM      AR_RCPT_TRX_TP_NM_B
                           <!-- QC#26750 Mod Start-->
                           ,NVL(RC.RCPT_CHK_DT, RC.RCPT_DT)  RCPT_DT_B
                           <!-- QC#26750 Mod End-->
                           ,CASE WHEN RC.AR_CASH_APPLY_STS_CD = #unidentified# THEN NVL(RC.FUNC_NET_RCPT_AMT, 0) 
                                 ELSE NVL(RC.FUNC_RCPT_AMT, 0)
                            END                       FUNC_RCPT_AMT_B
                           ,RC.FUNC_APPLY_ADJ_AMT     FUNC_APPLY_ADJ_AMT_B <!-- Adjustment -->
                           <!-- QC#29480 Add Start -->
                           ,(
                              SELECT
                                     <!-- QC#54619 MOD START -->
                                     NVL(SUM(ATB.DEAL_RMNG_BAL_GRS_AMT)*-1,0)
                                     <!-- QC#54619 MOD END -->
                                FROM AR_CASH_APP APP
                                    ,AR_ADJ      ADJ
                                    ,AR_TRX_BAL  ATB
                               WHERE
                                     APP.GLBL_CMPY_CD         = RC.GLBL_CMPY_CD
                                 AND APP.RCPT_NUM             = RC.RCPT_NUM
                                 AND APP.EZCANCELFLAG         = '0'
                                 AND APP.AR_APPLY_TP_CD       = #arApplyTp_Adjustment#
                                 AND APP.AR_SCR_CANC_FLG      = 'N'
                                 AND ADJ.GLBL_CMPY_CD         = APP.GLBL_CMPY_CD
                                 AND ADJ.EZCANCELFLAG         = '0'
                                 AND ADJ.AR_ADJ_NUM           = APP.AR_ADJ_NUM
                                 AND ADJ.AR_ADJ_TRX_TP_CD     = #arAdjTrxTp_OnAccount#
                                 AND ADJ.EZCANCELFLAG         = '0'
                                 AND ADJ.GLBL_CMPY_CD         = ATB.GLBL_CMPY_CD
                                 AND ADJ.AR_ADJ_NUM           = ATB.ATT_ADJ_NUM
                                 AND ATB.AR_CASH_APPLY_STS_CD IN (#arCashApplyStsCd_U#,#arCashApplyStsCd_P#)
                                 AND ATB.AR_TRX_TP_CD         = #arAdjTrxTp_OnAccount#
                            )                         FUNC_APPLY_ACC_AMT_B <!-- on Account -->
                           <!-- QC#29480 Add End -->
                           ,RC.FUNC_APPLY_AMT         FUNC_APPLY_AMT_B
                           ,RC.PAYER_CUST_CD          PAYER_CUST_CD_B
                           ,AC.DS_ACCT_NM             DS_ACCT_NM_B
                           ,RC.AR_CASH_APPLY_STS_CD   AR_CASH_APPLY_STS_CD_B
                           ,BR.AR_BAT_RCPT_STS_CD     AR_BAT_RCPT_STS_CD_B
                           ,RC.RCPT_CHK_NUM           RCPT_CHK_NUM_B
                           ,RC.FUNC_RCPT_RMNG_BAL_AMT FUNC_RCPT_RMNG_BAL_AMT_B
                       FROM
                           AR_RCPT        RC
                          ,AR_RCPT_TRX_TP TP
                          ,SELL_TO_CUST   AC
                          ,(SELECT
                                A.DS_BANK_ACCT_PK
                               ,A.DS_BANK_ACCT_NUM
                               ,A.DS_BANK_ACCT_NM
                               ,A.DS_BANK_ACCT_TP_CD
                               ,B.BANK_RTE_NUM
                               ,B.DS_BANK_BR_NM
                            FROM
                                DS_BANK_ACCT   A
                               ,DS_BANK_BR     B
                            WHERE
                                A.GLBL_CMPY_CD  = #glblCmpyCd#
                            AND
                                A.GLBL_CMPY_CD  = B.GLBL_CMPY_CD
                            AND
                                A.DS_BANK_BR_PK = B.DS_BANK_BR_PK
                            AND
                                A.EZCANCELFLAG  = '0'
                            AND
                                B.EZCANCELFLAG  = '0'
                           ) ACCT
                          ,AR_BAT_RCPT   BR
                       WHERE
                           RC.GLBL_CMPY_CD         = #glblCmpyCd#
                       AND
                           RC.EZCANCELFLAG         = '0'
                       AND
                           RC.GLBL_CMPY_CD         = TP.GLBL_CMPY_CD(+)
                       AND
                           RC.AR_RCPT_TRX_TP_CD    = TP.AR_RCPT_TRX_TP_CD(+)
                       AND
                           TP.EZCANCELFLAG(+)      = '0'
                       AND
                           RC.GLBL_CMPY_CD         = AC.GLBL_CMPY_CD(+)
                       AND
                           RC.PAYER_CUST_CD        = AC.SELL_TO_CUST_CD(+)
                       <isNotNull property="sMsg.dsAcctNm_H">
                           AND AC.DS_ACCT_NM LIKE #sMsg.dsAcctNm_H#
                       </isNotNull>
                       AND
                           AC.EZCANCELFLAG(+)     = '0'
                       AND
                           RC.REM_DS_BANK_ACCT_PK = ACCT.DS_BANK_ACCT_PK(+)
                       <isNotNull property="sMsg.dsBankCd_H">
                           AND ACCT.DS_BANK_CD = #sMsg.dsBankCd_H#
                       </isNotNull>
                       <isNotNull property="sMsg.bankRteNum_H">
                           AND ACCT.BANK_RTE_NUM = #sMsg.bankRteNum_H#
                       </isNotNull>
                       <isNotNull property="dsBankAcctNm_H">
                           AND UPPER(ACCT.DS_BANK_ACCT_NM) LIKE #dsBankAcctNm_H#
                       </isNotNull>
                       <isNotNull property="sMsg.dsBankAcctNum_H">
                           AND ACCT.DS_BANK_ACCT_NUM LIKE #sMsg.dsBankAcctNum_H#
                       </isNotNull>
                       <isNotNull property="dsBankBrNm_H">
                           AND UPPER(ACCT.DS_BANK_BR_NM) LIKE #dsBankBrNm_H#
                       </isNotNull>
                       <isNotNull property="sMsg.remDsBankAcctPk_H">
                           AND RC.REM_DS_BANK_ACCT_PK = #sMsg.remDsBankAcctPk_H#
                       </isNotNull>
                       <isNotNull property="sMsg.dsAcctNum_H">
                           AND RC.PAYER_CUST_CD LIKE #sMsg.dsAcctNum_H#
                       </isNotNull>
                       <isEqual property="rcptDocSearchFlg" compareValue="Y">
                           AND RC.RCPT_NUM LIKE #sMsg.rcptNum_H1#
                       </isEqual>
                       <isEqual property="rcptDocSearchFlg" compareValue="N">
                           <isNotNull property="sMsg.rcptNum_H1">
                               AND RC.RCPT_NUM &gt;= #sMsg.rcptNum_H1#
                           </isNotNull>
                           <isNotNull property="sMsg.rcptNum_H2">
                               AND RC.RCPT_NUM &lt;= #sMsg.rcptNum_H2#
                           </isNotNull>
                       </isEqual>
                       <isEqual property="rcptSearchFlg" compareValue="Y">
                           AND RC.RCPT_CHK_NUM LIKE #sMsg.rcptChkNum_H1#
                       </isEqual>
                       <isEqual property="rcptSearchFlg" compareValue="N">
                           <isNotNull property="sMsg.rcptChkNum_H1">
                               AND RC.RCPT_CHK_NUM &gt;= #sMsg.rcptChkNum_H1#
                           </isNotNull>
                           <isNotNull property="sMsg.rcptChkNum_H2">
                               AND RC.RCPT_CHK_NUM &lt;= #sMsg.rcptChkNum_H2#
                           </isNotNull>
                       </isEqual>
                       <!-- QC#26750 Mod Start-->
                       <isNotNull property="sMsg.rcptDt_H1">
                            AND NVL(RC.RCPT_CHK_DT, RC.RCPT_DT) &gt;= #sMsg.rcptDt_H1#
                       </isNotNull>
                       <isNotNull property="sMsg.rcptDt_H2">
                           AND NVL(RC.RCPT_CHK_DT, RC.RCPT_DT) &lt;= #sMsg.rcptDt_H2#
                       </isNotNull>
                       <!-- QC#26750 Mod End-->
                       <isNotNull property="sMsg.funcRcptAmt_H1">
                           AND DECODE(RC.FUNC_RCPT_AMT, 0, RC.FUNC_NET_RCPT_AMT, RC.FUNC_RCPT_AMT) &gt;= #sMsg.funcRcptAmt_H1#
                       </isNotNull>
                       <isNotNull property="sMsg.funcRcptAmt_H2">
                           AND DECODE(RC.FUNC_RCPT_AMT, 0, RC.FUNC_NET_RCPT_AMT, RC.FUNC_RCPT_AMT) &lt;= #sMsg.funcRcptAmt_H2#
                       </isNotNull>
                       <isNotNull property="sMsg.cratDt_H1">
                           AND CASE WHEN RC.AR_BAT_RCPT_NM IS NOT NULL THEN NVL(RC.AR_RCPT_REM_DT, RC.RCPT_DT)
                                    ELSE RC.RCPT_DT
                               END &gt;= #sMsg.cratDt_H1#
                       </isNotNull>
                       <isNotNull property="sMsg.cratDt_H2">
                           AND CASE WHEN RC.AR_BAT_RCPT_NM IS NOT NULL THEN NVL(RC.AR_RCPT_REM_DT, RC.RCPT_DT)
                                    ELSE RC.RCPT_DT
                               END &lt;= #sMsg.cratDt_H2#
                       </isNotNull>
                       <isNotNull property="sMsg.arRcptStsCd_H">
                           AND RC.AR_RCPT_STS_CD = #sMsg.arRcptStsCd_H#
                       </isNotNull>
                       <isNotNull property="sMsg.arCashApplyStsCd_H">
                           AND RC.AR_CASH_APPLY_STS_CD = #sMsg.arCashApplyStsCd_H#
                       </isNotNull>
                       <isNotNull property="sMsg.psnCd_H">
                           AND EXISTS
                                     (SELECT
                                          *
                                      FROM
                                          CLT_PTFO       A
                                         ,SELL_TO_CUST   B
                                      WHERE
                                          A.GLBL_CMPY_CD      = RC.GLBL_CMPY_CD
                                      AND
                                          A.EZCANCELFLAG      = '0'
                                      AND
                                          A.CLT_PSN_CD        = #sMsg.psnCd_H#
                                      AND
                                          B.GLBL_CMPY_CD      = A.GLBL_CMPY_CD
                                      AND
                                          B.EZCANCELFLAG      = '0'
                                      AND
                                          B.CLT_PTFO_PK       = A.CLT_PTFO_PK
                                      AND
                                          B.SELL_TO_CUST_CD   = RC.PAYER_CUST_CD
                                     )
                       </isNotNull>
                       AND RC.GLBL_CMPY_CD         = BR.GLBL_CMPY_CD(+)
                       AND BR.EZCANCELFLAG(+)      = '0' 
                       AND RC.AR_BAT_RCPT_NM       = BR.AR_BAT_RCPT_NM(+)
                       <isNotNull property="sMsg.arRcptSrcCd_H">
                       <!-- START 2018/11/13 [QC#29097,MOD] -->
                           <!-- AND BR.AR_RCPT_SRC_CD    = #sMsg.arRcptSrcCd_H# -->
                           AND RC.AR_RCPT_SRC_CD    = #sMsg.arRcptSrcCd_H#
                       <!-- END 2018/11/13 [QC#29097,MOD] -->
                       </isNotNull>
                       <isNotNull property="sMsg.arBatRcptStsCd_H">
                           AND BR.AR_BAT_RCPT_STS_CD    = #sMsg.arBatRcptStsCd_H#
                       </isNotNull>
                       <isNotNull property="sMsg.arLockBoxFileNm_H">
                           AND BR.AR_LOCK_BOX_FILE_NM LIKE #sMsg.arLockBoxFileNm_H#
                       </isNotNull>
                       <isNotNull property="sMsg.arLockBoxCd_H">
                           AND BR.AR_LOCK_BOX_CD = #sMsg.arLockBoxCd_H#
                       </isNotNull>
                       <isNotNull property="sMsg.arLockBoxBatNum_H">
                           AND BR.AR_LOCK_BOX_BAT_NUM = #sMsg.arLockBoxBatNum_H#
                       </isNotNull>
                       <isNotNull property="sMsg.arBatRcptNm_H">
                       <!-- START 2021/10/01 S.Go [QC#57903, MOD] -->
                           <!-- AND BR.AR_BAT_RCPT_NM LIKE #sMsg.arBatRcptNm_H# -->
                           AND UPPER(BR.AR_BAT_RCPT_NM) LIKE #sMsg.arBatRcptNm_H#
                       <!-- END 2021/10/01 S.Go [QC#57903, MOD] -->
                       </isNotNull>
                       <!-- START 2018/12/06 [QC#29528,ADD] -->
                       AND NOT (
                               RC.AR_RCPT_TP_CD = #arRcptTp_Offset#
                           AND
                               EXISTS (
                                   SELECT
                                        1
                                   FROM
                                        AR_CASH_APP ACA
                                   WHERE
                                        ACA.RCPT_NUM        = RC.RCPT_NUM
                                    AND ACA.GLBL_CMPY_CD    = RC.GLBL_CMPY_CD
                                    AND ACA.EZCANCELFLAG    = '0'
                                    AND ACA.AR_SCR_CANC_FLG = 'N'
                                    AND EXISTS (
                                         SELECT
                                             1
                                         FROM
                                              AR_CASH_APP ACA2
                                         WHERE
                                              ACA2.AR_CASH_APP_PK   = ACA.AR_CASH_APP_PK
                                          AND ACA2.GLBL_CMPY_CD     = ACA.GLBL_CMPY_CD
                                          AND ACA2.EZCANCELFLAG     = '0'
                                          AND ACA2.AR_SCR_CANC_FLG  = 'N'
                                          AND ACA2.AR_APPLY_TP_CD   = #arApplyTp_Adjustment#
                                          AND ACA2.RCPT_NUM         IS NULL
                                    )
                               )
                       )
                       <!-- END 2018/12/06 [QC#29528,ADD] -->
            )
            <isNotEqual property="existBatRcptCondition" compareValue="Y">
            SELECT
                A.AR_BAT_RCPT_NM_A                 AR_BAT_RCPT_NM_A
               ,A.RCPT_NUM_A                       RCPT_NUM_A
               ,A.AR_RCPT_SRC_NM_A                 AR_RCPT_SRC_NM_A
               ,A.AR_BAT_RCPT_DT_A                 AR_BAT_RCPT_DT_A
               ,A.AR_BAT_RCPT_STS_NM_A             AR_BAT_RCPT_STS_NM_A
               ,A.AR_BAT_RCPT_CNT_A                AR_BAT_RCPT_CNT_A
               ,A.AR_BAT_RCPT_AMT_A                AR_BAT_RCPT_AMT_A
               ,A.AR_LOCK_BOX_FILE_NM_A            AR_LOCK_BOX_FILE_NM_A
               ,A.AR_LOCK_BOX_NM_A                 AR_LOCK_BOX_NM_A
               ,A.AR_LOCK_BOX_BAT_NUM_A            AR_LOCK_BOX_BAT_NUM_A
               ,A.SORT                             SORT
               <!-- QC#29480 Mod Start -->
               ,NVL(B.FUNC_APPLY_ACC_AMT_B, 0)     XX_TOT_AMT_A
               <!-- QC#29480 Mod End -->
               ,B.AR_RCPT_TRX_TP_NM_B              AR_RCPT_TRX_TP_NM_A
               ,B.RCPT_DT_B                        RCPT_DT_A
               ,NVL(B.FUNC_RCPT_AMT_B ,0)          FUNC_RCPT_AMT_A
               <!-- QC#29480 Mod Start -->
               ,NVL(B.FUNC_APPLY_AMT_B, 0) + NVL(B.FUNC_APPLY_ADJ_AMT_B, 0) - NVL(B.FUNC_APPLY_ACC_AMT_B, 0) FUNC_APPLY_AMT_A
               <!-- QC#29480 Mod End -->
               ,B.PAYER_CUST_CD_B                  PAYER_CUST_CD_A
               ,B.DS_ACCT_NM_B                     DS_ACCT_NM_A
               ,B.AR_CASH_APPLY_STS_CD_B           AR_CASH_APPLY_STS_CD_A
               ,B.AR_BAT_RCPT_STS_CD_B             AR_BAT_RCPT_STS_CD_A
               ,B.RCPT_CHK_NUM_B                   RCPT_CHK_NUM_A
               ,NVL(B.FUNC_RCPT_RMNG_BAL_AMT_B, 0) FUNC_RCPT_RMNG_BAL_AMT_A
               ,A.XX_REC_HIST_CRAT_TS              XX_REC_HIST_CRAT_TS
               ,A.XX_REC_HIST_CRAT_BY_NM           XX_REC_HIST_CRAT_BY_NM
               ,A.XX_REC_HIST_UPD_TS               XX_REC_HIST_UPD_TS
               ,A.XX_REC_HIST_UPD_BY_NM            XX_REC_HIST_UPD_BY_NM
               ,A.XX_REC_HIST_TBL_NM               XX_REC_HIST_TBL_NM
            FROM
                RCPT_D  B
               ,(SELECT 
                     NULL                     AR_BAT_RCPT_NM_A
                    ,RC.RCPT_NUM              RCPT_NUM_A
                    ,NULL                     AR_RCPT_SRC_NM_A
                    ,NULL                     AR_BAT_RCPT_DT_A
                    ,NULL                     AR_BAT_RCPT_STS_NM_A
                    ,NULL                     AR_BAT_RCPT_CNT_A
                    ,NULL                     AR_BAT_RCPT_AMT_A
                    ,NULL                     AR_LOCK_BOX_FILE_NM_A
                    ,NULL                     AR_LOCK_BOX_NM_A
                    ,NULL                     AR_LOCK_BOX_BAT_NUM_A
                     <!-- QC#26750 Mod Start-->
                    ,NVL(RC.RCPT_CHK_DT, RC.RCPT_DT) SORT
                     <!-- QC#26750 Mod End-->
                    ,RC.EZINTIME              XX_REC_HIST_CRAT_TS
	                ,RC.EZINUSERID            XX_REC_HIST_CRAT_BY_NM
	                ,RC.EZUPTIME              XX_REC_HIST_UPD_TS
	                ,RC.EZUPUSERID            XX_REC_HIST_UPD_BY_NM
	                ,RC.EZTABLEID             XX_REC_HIST_TBL_NM
                 FROM
                    AR_RCPT RC
                   ,SELL_TO_CUST   AC
                   ,(SELECT
                         A.DS_BANK_ACCT_PK
                        ,A.DS_BANK_ACCT_NUM
                        ,A.DS_BANK_ACCT_NM
                        ,A.DS_BANK_ACCT_TP_CD
                        ,B.BANK_RTE_NUM
                        ,B.DS_BANK_BR_NM
                     FROM
                         DS_BANK_ACCT   A
                        ,DS_BANK_BR     B
                     WHERE
                            A.GLBL_CMPY_CD  = #glblCmpyCd#
                        AND A.GLBL_CMPY_CD  = B.GLBL_CMPY_CD
                        AND A.DS_BANK_BR_PK = B.DS_BANK_BR_PK
                        AND A.EZCANCELFLAG  = '0'
                        AND B.EZCANCELFLAG  = '0'
                    ) ACCT
                 WHERE  RC.GLBL_CMPY_CD   = #glblCmpyCd#
                 AND    RC.AR_BAT_RCPT_NM IS NULL
                 <isNotNull property="sMsg.dsAcctNum_H">
                 AND RC.PAYER_CUST_CD LIKE #sMsg.dsAcctNum_H#
                 </isNotNull>
                 <isEqual property="rcptDocSearchFlg" compareValue="Y">
                 AND RC.RCPT_NUM LIKE #sMsg.rcptNum_H1#
                 </isEqual>
                 <isEqual property="rcptDocSearchFlg" compareValue="N">
                     <isNotNull property="sMsg.rcptNum_H1">
                     AND RC.RCPT_NUM &gt;= #sMsg.rcptNum_H1#
                     </isNotNull>
                     <isNotNull property="sMsg.rcptNum_H2">
                     AND RC.RCPT_NUM &lt;= #sMsg.rcptNum_H2#
                     </isNotNull>
                 </isEqual>
                 <isEqual property="rcptSearchFlg" compareValue="Y">
                 AND RC.RCPT_CHK_NUM LIKE #sMsg.rcptChkNum_H1#
                 </isEqual>
                 <isEqual property="rcptSearchFlg" compareValue="N">
                     <isNotNull property="sMsg.rcptChkNum_H1">
                     AND RC.RCPT_CHK_NUM &gt;= #sMsg.rcptChkNum_H1#
                     </isNotNull>
                     <isNotNull property="sMsg.rcptChkNum_H2">
                     AND RC.RCPT_CHK_NUM &lt;= #sMsg.rcptChkNum_H2#
                     </isNotNull>
                 </isEqual>
                 <!-- QC#26750 Mod Start-->
                 <isNotNull property="sMsg.rcptDt_H1">
                 AND NVL(RC.RCPT_CHK_DT, RC.RCPT_DT) &gt;= #sMsg.rcptDt_H1#
                 </isNotNull>
                 <isNotNull property="sMsg.rcptDt_H2">
                 AND NVL(RC.RCPT_CHK_DT, RC.RCPT_DT) &lt;= #sMsg.rcptDt_H2#
                 </isNotNull>
                 <!-- QC#26750 Mod End-->
                 <isNotNull property="sMsg.funcRcptAmt_H1">
                 AND NVL(RC.FUNC_RCPT_AMT, RC.FUNC_NET_RCPT_AMT) &gt;= #sMsg.funcRcptAmt_H1#
                 </isNotNull>
                 <isNotNull property="sMsg.funcRcptAmt_H2">
                 AND NVL(RC.FUNC_RCPT_AMT, RC.FUNC_NET_RCPT_AMT) &lt;= #sMsg.funcRcptAmt_H2#
                 </isNotNull>
                 <isNotNull property="sMsg.arRcptStsCd_H">
                 AND RC.AR_RCPT_STS_CD = #sMsg.arRcptStsCd_H#
                 </isNotNull>
                 <isNotNull property="sMsg.arCashApplyStsCd_H">
                 AND RC.AR_CASH_APPLY_STS_CD = #sMsg.arCashApplyStsCd_H#
                 </isNotNull>
                 <isNotNull property="sMsg.psnCd_H">
                 AND     RC.GLBL_CMPY_CD         = AC.GLBL_CMPY_CD(+)
                 AND EXISTS
                           (SELECT
                                *
                            FROM 
                               CLT_PTFO       A
                              ,SELL_TO_CUST   B
                            WHERE 
                               A.GLBL_CMPY_CD      = RC.GLBL_CMPY_CD
                            AND A.EZCANCELFLAG      = '0'
                            AND A.CLT_PSN_CD        = #sMsg.psnCd_H#
                            AND B.GLBL_CMPY_CD      = A.GLBL_CMPY_CD
                            AND B.EZCANCELFLAG      = '0'
                            AND B.CLT_PTFO_PK       = A.CLT_PTFO_PK
                            AND B.SELL_TO_CUST_CD   = RC.PAYER_CUST_CD
                           )
                 </isNotNull>
                 AND     RC.PAYER_CUST_CD        = AC.SELL_TO_CUST_CD(+)
                 <isNotNull property="sMsg.dsAcctNm_H">
                 AND AC.DS_ACCT_NM LIKE #sMsg.dsAcctNm_H#
                 </isNotNull>
                 AND     AC.EZCANCELFLAG(+)      = '0'
                 AND     RC.EZCANCELFLAG         = '0'
                 AND RC.REM_DS_BANK_ACCT_PK = ACCT.DS_BANK_ACCT_PK(+)
                 <isNotNull property="sMsg.bankRteNum_H">
                 AND ACCT.BANK_RTE_NUM = #sMsg.bankRteNum_H#
                 </isNotNull>
                 <isNotNull property="dsBankAcctNm_H">
                 AND UPPER(ACCT.DS_BANK_ACCT_NM) LIKE #dsBankAcctNm_H#
                 </isNotNull>
                 <isNotNull property="sMsg.dsBankAcctNum_H">
                 AND ACCT.DS_BANK_ACCT_NUM LIKE #sMsg.dsBankAcctNum_H#
                 </isNotNull>
                 <isNotNull property="dsBankBrNm_H">
                 AND UPPER(ACCT.DS_BANK_BR_NM) LIKE #dsBankBrNm_H#
                 </isNotNull>
                 <isNotNull property="sMsg.cratDt_H1">
                 AND RC.RCPT_DT &gt;= #sMsg.cratDt_H1#
                 </isNotNull>
                 <isNotNull property="sMsg.cratDt_H2">
                 AND RC.RCPT_DT &lt;= #sMsg.cratDt_H2#
                 </isNotNull>
                 <!-- START 2018/11/13 [QC#29097,ADD] -->
                 <isNotNull property="sMsg.arRcptSrcCd_H">
                 AND RC.AR_RCPT_SRC_CD = #sMsg.arRcptSrcCd_H#
                 </isNotNull>
                 <!-- END 2018/11/13 [QC#29097,ADD] -->
                 ) A
            WHERE
               A.RCPT_NUM_A = B.RCPT_NUM_B
            UNION
            </isNotEqual>
            SELECT
                A.AR_BAT_RCPT_NM_A                 AR_BAT_RCPT_NM_A
               ,B.RCPT_NUM_B                       RCPT_NUM_A
               ,A.AR_RCPT_SRC_NM_A                 AR_RCPT_SRC_NM_A
               ,A.AR_BAT_RCPT_DT_A                 AR_BAT_RCPT_DT_A
               ,A.AR_BAT_RCPT_STS_NM_A             AR_BAT_RCPT_STS_NM_A
               ,A.AR_BAT_RCPT_CNT_A                AR_BAT_RCPT_CNT_A
               ,A.AR_BAT_RCPT_AMT_A                AR_BAT_RCPT_AMT_A
               ,A.AR_LOCK_BOX_FILE_NM_A            AR_LOCK_BOX_FILE_NM_A
               ,A.AR_LOCK_BOX_NM_A                 AR_LOCK_BOX_NM_A
               ,A.AR_LOCK_BOX_BAT_NUM_A            AR_LOCK_BOX_BAT_NUM_A
               ,A.SORT                             SORT
               <!-- QC#29480 Mod Start -->
               ,NVL(B.FUNC_APPLY_ACC_AMT_B, 0)     XX_TOT_AMT_A
               <!-- QC#29480 Mod End -->
               ,B.AR_RCPT_TRX_TP_NM_B              AR_RCPT_TRX_TP_NM_A
               ,B.RCPT_DT_B                        RCPT_DT_A
               ,NVL(B.FUNC_RCPT_AMT_B ,0)          FUNC_RCPT_AMT_A
               <!-- QC#29480 Mod Start -->
               ,NVL(B.FUNC_APPLY_AMT_B, 0) + NVL(B.FUNC_APPLY_ADJ_AMT_B, 0) - NVL(B.FUNC_APPLY_ACC_AMT_B, 0) FUNC_APPLY_AMT_A
               <!-- QC#29480 Mod End -->
               ,B.PAYER_CUST_CD_B                  PAYER_CUST_CD_A
               ,B.DS_ACCT_NM_B                     DS_ACCT_NM_A
               ,B.AR_CASH_APPLY_STS_CD_B           AR_CASH_APPLY_STS_CD_A
               ,B.AR_BAT_RCPT_STS_CD_B             AR_BAT_RCPT_STS_CD_A
               ,B.RCPT_CHK_NUM_B                   RCPT_CHK_NUM_A
               ,NVL(B.FUNC_RCPT_RMNG_BAL_AMT_B, 0) FUNC_RCPT_RMNG_BAL_AMT_A
               ,A.XX_REC_HIST_CRAT_TS              XX_REC_HIST_CRAT_TS
               ,A.XX_REC_HIST_CRAT_BY_NM           XX_REC_HIST_CRAT_BY_NM
               ,A.XX_REC_HIST_UPD_TS               XX_REC_HIST_UPD_TS
               ,A.XX_REC_HIST_UPD_BY_NM            XX_REC_HIST_UPD_BY_NM
               ,A.XX_REC_HIST_TBL_NM               XX_REC_HIST_TBL_NM
            FROM
                RCPT_D  B
               ,(SELECT
                     BR.AR_BAT_RCPT_NM        AR_BAT_RCPT_NM_A
                    ,NULL                     RCPT_NUM_A
                    ,SRC.AR_RCPT_SRC_NM       AR_RCPT_SRC_NM_A
                    ,BR.AR_BAT_RCPT_DT        AR_BAT_RCPT_DT_A
                    ,STS.AR_BAT_RCPT_STS_NM   AR_BAT_RCPT_STS_NM_A
                    ,BR.AR_BAT_RCPT_CNT       AR_BAT_RCPT_CNT_A
                    ,BR.AR_BAT_RCPT_AMT       AR_BAT_RCPT_AMT_A
                    ,BR.AR_LOCK_BOX_FILE_NM   AR_LOCK_BOX_FILE_NM_A
                    ,LB.AR_LOCK_BOX_DESC_TXT  AR_LOCK_BOX_NM_A
                    ,BR.AR_LOCK_BOX_BAT_NUM   AR_LOCK_BOX_BAT_NUM_A
                    ,BR.AR_BAT_RCPT_DT        SORT
                    ,BR.EZINTIME              XX_REC_HIST_CRAT_TS
                    ,BR.EZINUSERID            XX_REC_HIST_CRAT_BY_NM
                    ,BR.EZUPTIME              XX_REC_HIST_UPD_TS
                    ,BR.EZUPUSERID            XX_REC_HIST_UPD_BY_NM
                    ,BR.EZTABLEID             XX_REC_HIST_TBL_NM
                 FROM
                     AR_BAT_RCPT      BR
                    ,AR_RCPT_SRC      SRC
                    ,AR_BAT_RCPT_STS  STS
                    ,AR_LOCK_BOX      LB
                    ,(SELECT
                          A.DS_BANK_ACCT_PK
                         ,A.DS_BANK_ACCT_NUM
                         ,A.DS_BANK_ACCT_NM
                         ,A.DS_BANK_ACCT_TP_CD
                         ,B.BANK_RTE_NUM
                         ,B.DS_BANK_BR_NM
                      FROM
                          DS_BANK_ACCT   A
                         ,DS_BANK_BR     B
                      WHERE
                          A.GLBL_CMPY_CD  = #glblCmpyCd#
                      AND A.GLBL_CMPY_CD  = B.GLBL_CMPY_CD
                      AND A.DS_BANK_BR_PK = B.DS_BANK_BR_PK
                      AND A.EZCANCELFLAG  = '0'
                      AND B.EZCANCELFLAG  = '0'
                     )ACCT
                 WHERE BR.GLBL_CMPY_CD        = #glblCmpyCd#
                 AND   BR.EZCANCELFLAG        = '0'
                 AND   BR.GLBL_CMPY_CD        = SRC.GLBL_CMPY_CD(+)
                 AND   BR.AR_RCPT_SRC_CD      = SRC.AR_RCPT_SRC_CD(+)
                 AND   SRC.EZCANCELFLAG(+)    = '0'
                 AND   BR.GLBL_CMPY_CD        = STS.GLBL_CMPY_CD(+)
                 AND   BR.AR_BAT_RCPT_STS_CD  = STS.AR_BAT_RCPT_STS_CD(+)
                 AND   STS.EZCANCELFLAG(+)    = '0'
                 AND   BR.GLBL_CMPY_CD        = LB.GLBL_CMPY_CD(+)
                 AND   BR.AR_LOCK_BOX_CD      = LB.AR_LOCK_BOX_CD(+)
                 AND   LB.EZCANCELFLAG(+)     = '0'
                 AND   BR.REM_DS_BANK_ACCT_PK = ACCT.DS_BANK_ACCT_PK(+)
                 <isNotNull property="sMsg.bankRteNum_H">
                 AND ACCT.BANK_RTE_NUM = #sMsg.bankRteNum_H#
                 </isNotNull>
                 <isNotNull property="dsBankAcctNm_H">
                 AND UPPER(ACCT.DS_BANK_ACCT_NM) LIKE #dsBankAcctNm_H#
                 </isNotNull>
                 <isNotNull property="sMsg.dsBankAcctNum_H">
                     AND ACCT.DS_BANK_ACCT_NUM LIKE #sMsg.dsBankAcctNum_H#
                 </isNotNull>
                 <isNotNull property="dsBankBrNm_H">
                     AND UPPER(ACCT.DS_BANK_BR_NM) LIKE #dsBankBrNm_H#
                 </isNotNull>
                 <isNotNull property="sMsg.arRcptSrcCd_H">
                     AND BR.AR_RCPT_SRC_CD = #sMsg.arRcptSrcCd_H#
                 </isNotNull>
                 <isNotNull property="sMsg.arBatRcptNm_H">
                 <!-- START 2021/10/01 S.Go [QC#57903, MOD] -->
                     <!-- AND BR.AR_BAT_RCPT_NM LIKE #sMsg.arBatRcptNm_H# -->
                     AND UPPER(BR.AR_BAT_RCPT_NM) LIKE #sMsg.arBatRcptNm_H#
                 <!-- END 2021/10/01 S.Go [QC#57903, MOD] -->
                 </isNotNull>
                 <isNotNull property="sMsg.arBatRcptStsCd_H">
                     AND BR.AR_BAT_RCPT_STS_CD = #sMsg.arBatRcptStsCd_H#
                 </isNotNull>
                 <isNotNull property="sMsg.arLockBoxFileNm_H">
                     AND BR.AR_LOCK_BOX_FILE_NM LIKE #sMsg.arLockBoxFileNm_H#
                 </isNotNull>
                 <isNotNull property="sMsg.arLockBoxCd_H">
                     AND BR.AR_LOCK_BOX_CD = #sMsg.arLockBoxCd_H#
                 </isNotNull>
                 <isNotNull property="sMsg.arLockBoxBatNum_H">
                     AND BR.AR_LOCK_BOX_BAT_NUM = #sMsg.arLockBoxBatNum_H#
                 </isNotNull>
                 <isNotNull property="sMsg.cratDt_H1">
                     AND BR.AR_BAT_RCPT_DT &gt;= #sMsg.cratDt_H1#
                 </isNotNull>
                 <isNotNull property="sMsg.cratDt_H2">
                     AND BR.AR_BAT_RCPT_DT &lt;= #sMsg.cratDt_H2#
                 </isNotNull>
                 <isEqual property="existRcptCondition" compareValue="Y">
                     AND EXISTS
                               (SELECT 1
                                FROM   AR_RCPT RC
                                      ,SELL_TO_CUST   AC
                                WHERE  RC.GLBL_CMPY_CD   = BR.GLBL_CMPY_CD
                                AND    RC.AR_BAT_RCPT_NM = BR.AR_BAT_RCPT_NM
                                <isNotNull property="sMsg.dsAcctNum_H">
                                AND RC.PAYER_CUST_CD LIKE #sMsg.dsAcctNum_H#
                                </isNotNull>
                                <isEqual property="rcptDocSearchFlg" compareValue="Y">
                                AND RC.RCPT_NUM LIKE #sMsg.rcptNum_H1#
                                </isEqual>
                                <isEqual property="rcptDocSearchFlg" compareValue="N">
                                    <isNotNull property="sMsg.rcptNum_H1">
                                    AND RC.RCPT_NUM &gt;= #sMsg.rcptNum_H1#
                                    </isNotNull>
                                    <isNotNull property="sMsg.rcptNum_H2">
                                    AND RC.RCPT_NUM &lt;= #sMsg.rcptNum_H2#
                                    </isNotNull>
                                </isEqual>
                                <isEqual property="rcptSearchFlg" compareValue="Y">
                                AND RC.RCPT_CHK_NUM LIKE #sMsg.rcptChkNum_H1#
                                </isEqual>
                                <isEqual property="rcptSearchFlg" compareValue="N">
                                    <isNotNull property="sMsg.rcptChkNum_H1">
                                    AND RC.RCPT_CHK_NUM &gt;= #sMsg.rcptChkNum_H1#
                                    </isNotNull>
                                    <isNotNull property="sMsg.rcptChkNum_H2">
                                    AND RC.RCPT_CHK_NUM &lt;= #sMsg.rcptChkNum_H2#
                                    </isNotNull>
                                </isEqual>
                                <!-- QC#26750 Mod Start-->
                                <isNotNull property="sMsg.rcptDt_H1">
                                AND NVL(RC.RCPT_CHK_DT, RC.RCPT_DT) &gt;= #sMsg.rcptDt_H1#
                                </isNotNull>
                                <isNotNull property="sMsg.rcptDt_H2">
                                AND NVL(RC.RCPT_CHK_DT, RC.RCPT_DT) &lt;= #sMsg.rcptDt_H2#
                                </isNotNull>
                                <!-- QC#26750 Mod End-->
                                <isNotNull property="sMsg.funcRcptAmt_H1">
                                AND DECODE(RC.FUNC_RCPT_AMT, 0, RC.FUNC_NET_RCPT_AMT, RC.FUNC_RCPT_AMT) &gt;= #sMsg.funcRcptAmt_H1#
                                </isNotNull>
                                <isNotNull property="sMsg.funcRcptAmt_H2">
                                AND DECODE(RC.FUNC_RCPT_AMT, 0, RC.FUNC_NET_RCPT_AMT, RC.FUNC_RCPT_AMT) &lt;= #sMsg.funcRcptAmt_H2#
                                </isNotNull>
                                <isNotNull property="sMsg.arRcptStsCd_H">
                                AND RC.AR_RCPT_STS_CD = #sMsg.arRcptStsCd_H#
                                </isNotNull>
                                <isNotNull property="sMsg.arCashApplyStsCd_H">
                                AND RC.AR_CASH_APPLY_STS_CD = #sMsg.arCashApplyStsCd_H#
                                </isNotNull>
                                <!-- START 2018/11/13 [QC#29097,ADD] -->
                                <isNotNull property="sMsg.arRcptSrcCd_H">
                                AND RC.AR_RCPT_SRC_CD = #sMsg.arRcptSrcCd_H#
                                </isNotNull>
                                <!-- END 2018/11/13 [QC#29097,ADD] -->
                                <isNotNull property="sMsg.psnCd_H">
                                AND     RC.GLBL_CMPY_CD         = AC.GLBL_CMPY_CD(+)
                                AND EXISTS
                                          (SELECT
                                               *
                                           FROM 
                                               CLT_PTFO       A
                                              ,SELL_TO_CUST   B
                                           WHERE 
                                               A.GLBL_CMPY_CD      = RC.GLBL_CMPY_CD
                                               AND A.EZCANCELFLAG      = '0'
                                               AND A.CLT_PSN_CD        = #sMsg.psnCd_H#
                                               AND B.GLBL_CMPY_CD      = A.GLBL_CMPY_CD
                                               AND B.EZCANCELFLAG      = '0'
                                               AND B.CLT_PTFO_PK       = A.CLT_PTFO_PK
                                               AND B.SELL_TO_CUST_CD   = RC.PAYER_CUST_CD
                                           )
                                </isNotNull>
                                AND     RC.PAYER_CUST_CD        = AC.SELL_TO_CUST_CD(+)
                                <isNotNull property="sMsg.dsAcctNm_H">
                                AND AC.DS_ACCT_NM LIKE #sMsg.dsAcctNm_H#
                                </isNotNull>
                                AND     AC.EZCANCELFLAG(+)      = '0'
                                AND     RC.EZCANCELFLAG         = '0'
                               )
                 </isEqual>
                ) A
            WHERE
               A.AR_BAT_RCPT_NM_A = B.AR_BAT_RCPT_NM_B(+)
            ORDER BY
               RCPT_NUM_A, SORT
    </statement>
    <!-- END 2018/06/08 E.Kameishi [QC#25735,ADD] -->
</sqlMap>
