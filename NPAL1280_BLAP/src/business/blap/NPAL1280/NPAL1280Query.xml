<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPAL1280Query">

    <typeAlias alias="NPAL1280_ASMsg" type="business.blap.NPAL1280.NPAL1280_ASMsg"/>

    <statement id="getRequisitionList" parameterClass="Map" resultClass="Map">
        SELECT
            PRT.PRCH_REQ_TP_CD
            , PRT.PRCH_REQ_TP_DESC_TXT
        FROM
            PRCH_REQ_TP PRT
        WHERE
                PRT.GLBL_CMPY_CD      = #glblCmpyCd#
            <isNotNull property="scrEntAvalFlg">
            AND PRT.SCR_ENT_AVAL_FLG = #scrEntAvalFlg#
            </isNotNull>
            AND PRT.PRCH_REQ_REC_TP_CD   = #poRequisition#
            AND PRT.EZCANCELFLAG = '0'
        ORDER BY
            PRT.PRCH_REQ_TP_SORT_NUM ASC
    </statement>

    <statement id="getBusinessUnitList" parameterClass="Map" resultClass="Map">
        SELECT
            PG.PRCH_GRP_CD
            , PG.PRCH_GRP_DESC_TXT
        FROM
            PRCH_GRP PG
        WHERE
                PG.GLBL_CMPY_CD      = #glblCmpyCd#
            AND PG.EZCANCELFLAG = '0'
        ORDER BY
            PG.PRCH_GRP_CD ASC
    </statement>

    <statement id="getPrLineTypeList" parameterClass="Map" resultClass="Map">
        SELECT
            PRLT.PRCH_REQ_LINE_TP_CD
            , PRLT.PRCH_REQ_LINE_TP_DESC_TXT
        FROM
            PRCH_REQ_LINE_TP PRLT
        WHERE
                PRLT.GLBL_CMPY_CD      = #glblCmpyCd#
            AND PRLT.PRCH_REQ_REC_TP_CD = #prchReqRecTpCd# 
            AND PRLT.SCR_ENT_AVAL_FLG = #scrEntAvalFlg#
            AND PRLT.EZCANCELFLAG = '0'
            
        ORDER BY
            PRLT.PRCH_REQ_LINE_TP_SORT_NUM ASC
    </statement>

<!-- QC#14858 -->
    <statement id="getDefAccInfo" parameterClass="Map" resultClass="Map">
        SELECT
              RW.COA_BR_CD        COA_BR_CD
            , LBT.COA_CC_CD       COA_CC_CD
            , STC.COA_AFFL_CD     COA_AFFL_CD
        FROM
            RTL_WH        RW
            ,LINE_BIZ_TP  LBT
            ,SHIP_TO_CUST STC
         WHERE
               RW.GLBL_CMPY_CD      = #glblCmpyCd#
           AND RW.RTL_WH_CD         = #rtlWhCd#
           AND RW.EZCANCELFLAG      = '0'
           AND LBT.GLBL_CMPY_CD     = RW.GLBL_CMPY_CD
           AND LBT.LINE_BIZ_TP_CD   = #lineBizTpCd#
           AND LBT.EZCANCELFLAG     = '0'
           AND STC.GLBL_CMPY_CD(+)  = RW.GLBL_CMPY_CD
           AND STC.SHIP_TO_CUST_CD(+) = #shipToCustCd#
           AND STC.EZCANCELFLAG(+)  = '0'
    </statement>

    <statement id="getDefAccInfoExp" parameterClass="Map" resultClass="Map">
        SELECT
              RW.COA_BR_CD        COA_BR_CD
            , LBT.COA_CC_CD       COA_CC_CD
            , M.COGS_COA_ACCT_CD  COA_ACCT_CD
            , M.COA_PROD_CD       COA_PROD_CD
            , M.COA_MDSE_TP_CD    COA_MDSE_TP_CD
        FROM
            RTL_WH        RW
            ,LINE_BIZ_TP  LBT
            ,MDSE         M
         WHERE
               RW.GLBL_CMPY_CD      = #glblCmpyCd#
           AND RW.RTL_WH_CD         = #destRtlWhCd#
           AND RW.EZCANCELFLAG      = '0'
           AND LBT.GLBL_CMPY_CD     = RW.GLBL_CMPY_CD
           AND LBT.LINE_BIZ_TP_CD   = #lineBizTpCd#
           AND LBT.EZCANCELFLAG     = '0'
           AND M.GLBL_CMPY_CD       = LBT.GLBL_CMPY_CD
           AND M.MDSE_CD            = #mdseCd#
           AND M.EZCANCELFLAG       = '0'
    </statement>
<!-- 
    <statement id="getDefAccInfo" parameterClass="Map" resultClass="Map">
        SELECT
            DDCI.COA_CMPY_CD
            , DDCI.COA_AFFL_CD
            , DDCI.COA_CC_CD
            , DDCI.COA_PROD_CD
            , DDCI.COA_CH_CD
            , DDCI.COA_PROJ_CD
            , DDCI.COA_EXTN_CD
        FROM
            DEF_DPLY_COA_INFO DDCI
        WHERE
                DDCI.GLBL_CMPY_CD = #glblCmpyCd#
            AND DDCI.EZCANCELFLAG = '0'
            AND DDCI.APP_FUNC_ID = #appFuncId#
    </statement>
-->
<!-- QC#14858 --> 

    <statement id="getPoMsg" parameterClass="Map" resultClass="Map">
        SELECT
             PM.PO_MSG_PK
            ,PM.PO_MSG_TP_CD
            ,PM.PO_MSG_SEG_ID
            ,PM.PO_MSG_SUBMT_PSN_CD
            ,PM.PO_MSG_TXT 
            ,PM.PRCH_REQ_NUM
        FROM
            PO_MSG PM
        WHERE
              PM.GLBL_CMPY_CD = #glblCmpyCd#
        AND   PM.PRCH_REQ_NUM = #prchReqNum#
        AND   PM.PO_MSG_TP_CD = #poMsgTpCd#
        AND   PM.EZCANCELFLAG = '0'
        ORDER BY PO_MSG_SEG_ID
    </statement>

    <statement id="getReturnToAddress" parameterClass="Map" resultClass="Map">
        SELECT
            A.RTRN_SHIP_TO_RTL_WH_CD
        FROM
            (
            SELECT
                RTRN_SHIP_TO_RTL_WH_CD
            FROM
                RTRN_SHIP_TO_RTL_WH_XREF RSTRWX
            WHERE
                RSTRWX.GLBL_CMPY_CD = #glblCmpyCd#
            AND RSTRWX.SHIP_TO_ST_CD = #shipToStCd#
            AND RSTRWX.FROM_SHIP_TO_POST_CD &lt;= #fromShipToPostCd#
            AND RSTRWX.TO_SHIP_TO_POST_CD &gt;= #toShipToPostCd#
            AND RSTRWX.EZCANCELFLAG = '0'
            ORDER BY
                RSTRWX.FROM_SHIP_TO_POST_CD ASC
                , RSTRWX.TO_SHIP_TO_POST_CD ASC
            ) A
        WHERE ROWNUM = 1
    </statement>

    <statement id="getDefaultReturnToAddress" parameterClass="Map" resultClass="Map">
        SELECT
            RTRN_SHIP_TO_RTL_WH_CD
        FROM
            RTRN_SHIP_TO_RTL_WH_XREF RSTRWX
        WHERE
            RSTRWX.GLBL_CMPY_CD = #glblCmpyCd#
        AND RSTRWX.SHIP_TO_ST_CD = #shipToStCd#
        AND RSTRWX.FROM_SHIP_TO_POST_CD = #fromShipToPostCd#
        AND RSTRWX.TO_SHIP_TO_POST_CD = #toShipToPostCd#
        AND RSTRWX.EZCANCELFLAG = '0'
    </statement>

    <statement id="getDefaultReturnToWh" parameterClass="Map" resultClass="Map">
        SELECT
            RW.RTL_WH_NM
            , RW.FIRST_LINE_ADDR || ' ' || RW.SCD_LINE_ADDR || ' ' ||  RW.THIRD_LINE_ADDR || ' ' ||  RW.FRTH_LINE_ADDR AS XX_ALL_LINE_ADDR
            , RW.POST_CD
            , RW.CTY_ADDR
            , RW.ST_CD
        FROM
            RTL_WH RW
        WHERE
            RW.GLBL_CMPY_CD = #glblCmpyCd#
        AND RW.RTL_WH_CD = #rtlWhCd#
        AND RW.EZCANCELFLAG = '0'
    </statement>

    <statement id="getBillToLocation" parameterClass="Map" resultClass="Map">
        SELECT
            BTC.LOC_NM
            , BTC.ADDL_LOC_NM
            , BTC.FIRST_LINE_ADDR || ' ' ||  BTC.SCD_LINE_ADDR || ' ' ||  BTC.THIRD_LINE_ADDR || ' ' ||  BTC.FRTH_LINE_ADDR AS XX_ALL_LINE_ADDR
            , BTC.POST_CD
            , BTC.CTY_ADDR
            , CN.CNTY_NM
            , BTC.ST_CD
            , BTC.PROV_NM
            , CT.CTRY_NM
        FROM
            BILL_TO_CUST BTC
            , CNTY CN
            , CTRY CT
        WHERE
        -- JOIN TO BILL_TO_CUST
            BTC.GLBL_CMPY_CD = #glblCmpyCd#
        AND BTC.BILL_TO_CUST_CD = #billToCustCd#
        AND BTC.EZCANCELFLAG = '0'
        -- LEFT JOIN TO CNTY
        AND BTC.GLBL_CMPY_CD = CN.GLBL_CMPY_CD(+)
        AND BTC.CNTY_PK = CN.CNTY_PK(+)
        AND CN.EZCANCELFLAG(+) = '0'
        -- LEFT JOIN TO CTRY
        AND BTC.GLBL_CMPY_CD = CT.GLBL_CMPY_CD(+)
        AND BTC.CTRY_CD = CT.CTRY_CD(+)
        AND CT.EZCANCELFLAG(+) = '0'
    </statement>

    <statement id="chkPrntVndCd" parameterClass="Map" resultClass="Map">
        SELECT
            PV.PRNT_VND_CD
        FROM
            PRNT_VND PV
        WHERE
            PV.GLBL_CMPY_CD = #glblCmpyCd#
        <isNotNull property="prntVndCd">
        AND PV.PRNT_VND_CD  = #prntVndCd#
        </isNotNull>
        AND PV.PRNT_VND_NM  = #prntVndNm#
        AND PV.EZCANCELFLAG = '0'
        AND ROWNUM      &lt;= 2
    </statement>

    <statement id="chkVndCd" parameterClass="Map" resultClass="Map">
        SELECT
            V.VND_PK
            , V.VND_CD
        FROM
            VND V
        WHERE
            V.GLBL_CMPY_CD  = #glblCmpyCd#
        <isNotNull property="vndCd">
        AND V.VND_CD        = #vndCd#
        </isNotNull>
        AND V.LOC_NM        = #locNm#
        AND V.EZCANCELFLAG  = '0'
        AND ROWNUM      &lt;= 2
    </statement>

    <statement id="chkPoVnd" parameterClass="Map" resultClass="Map">
        SELECT
            PVV.VND_CD
        FROM
            PO_VND_V PVV
        WHERE
            PVV.GLBL_CMPY_CD = #glblCmpyCd#
        AND PVV.PRNT_VND_CD = #prntVndCd#
        AND PVV.VND_CD = #vndCd#
        AND PVV.EZCANCELFLAG = '0'
        AND ROWNUM = 1
    </statement>

    <statement id="chkPrchAvalFlg" parameterClass="Map" resultClass="Map">
        WITH PAT AS (
            SELECT
                PAT.COA_PROJ_ACCT_TP_CD
            FROM
                PO_ACCT_TP PAT
            WHERE
                PAT.GLBL_CMPY_CD = #glblCmpyCd#
            AND PAT.PO_ACCT_TP_CD = #poAcctTpCd#
        )
        SELECT
              AMV.PRNT_CMPY_SET_MDSE_FLG
            , AMV.COA_MDSE_TP_CD
            , AMV.COA_PROD_CD
            , MIS.PRCH_AVAL_FLG
            , OTM.MDSE_CD
            , CPA.COA_ACCT_CD
            , RW.COA_BR_CD
        FROM
              ALL_MDSE_V AMV
            , MDSE_ITEM_STS MIS
            , ORD_TAKE_MDSE OTM
            , COA_PROJ_ACCT CPA
            , RTL_WH RW
            , PAT PAT
        WHERE
            AMV.GLBL_CMPY_CD = #glblCmpyCd#
        AND AMV.MDSE_CD      = #mdseCd#
        AND AMV.EZCANCELFLAG = '0'
        AND MIS.GLBL_CMPY_CD = AMV.GLBL_CMPY_CD
        AND MIS.MDSE_ITEM_STS_CD = AMV.MDSE_ITEM_STS_CD
        AND MIS.EZCANCELFLAG = '0'
        AND OTM.GLBL_CMPY_CD (+) = AMV.GLBL_CMPY_CD
        AND OTM.ORD_TAKE_MDSE_CD (+) = AMV.MDSE_CD
        AND OTM.EZCANCELFLAG (+) = '0'
        AND CPA.GLBL_CMPY_CD (+) = AMV.GLBL_CMPY_CD
        AND CPA.COA_PROJ_CD (+) = AMV.COA_MDSE_TP_CD
        AND CPA.COA_PROJ_ACCT_TP_CD (+) = PAT.COA_PROJ_ACCT_TP_CD
        AND CPA.EZCANCELFLAG (+) = '0'
        <isNotNull  property="destWhCd">
        AND RW.GLBL_CMPY_CD (+) = AMV.GLBL_CMPY_CD
        AND RW.RTL_WH_CD (+) = #destWhCd#
        AND RW.EZCANCELFLAG (+)  = '0'
        </isNotNull>
        AND ROWNUM = #rowNum#
    </statement>

    <statement id="getComponent" parameterClass="Map" resultClass="Map">
        SELECT
              AMV.MDSE_CD
            , AMV.MDSE_DESC_SHORT_TXT
            , AMV.COA_MDSE_TP_CD
            , AMV.COA_PROD_CD
            , CMP.CHILD_MDSE_QTY
            , OTM.MDSE_CD AS MDSE_10_CD
            , CPA.COA_ACCT_CD
        FROM
              CMPSN CMP
            , ALL_MDSE_V AMV
            , ORD_TAKE_MDSE OTM
            , PRCH_REQ_LINE_TP PRLT
            , PO_LINE_TP PLT
            , COA_PROJ_ACCT CPA
        WHERE
        -- JOIN TO CMPSN
            CMP.GLBL_CMPY_CD = #glblCmpyCd#
        AND CMP.PRNT_MDSE_CD = #mdseCd#
        AND CMP.EFF_FROM_DT &lt;= #salesDate#
        AND NVL(CMP.EFF_THRU_DT, '99991231') &gt;= #salesDate#
        AND CMP.EZCANCELFLAG = '0'
        -- JOIN TO ALL_MDSE_V
        AND CMP.GLBL_CMPY_CD = AMV.GLBL_CMPY_CD
        AND (CMP.CHILD_MDSE_CD = AMV.MDSE_CD OR CMP.CHILD_ORD_TAKE_MDSE_CD = AMV.MDSE_CD)
        AND AMV.RGTN_STS_CD = #rgtnStsCd#
        AND AMV.EZCANCELFLAG = '0'
        -- JOIN TO ORD_TAKE_MDSE
        AND OTM.GLBL_CMPY_CD (+) = AMV.GLBL_CMPY_CD
        AND OTM.ORD_TAKE_MDSE_CD (+) = AMV.MDSE_CD
        AND OTM.EZCANCELFLAG (+) = '0'
        -- JOIN TO PRCH_REQ_LINE_TP
        AND PRLT.GLBL_CMPY_CD (+) = CMP.GLBL_CMPY_CD
        AND PRLT.PRCH_REQ_LINE_TP_CD (+) = #prchReqLineTpCd#
        AND PRLT.EZCANCELFLAG (+) = '0'
        -- JOIN TO PO_LINE_TP
        AND PLT.GLBL_CMPY_CD (+) = PRLT.GLBL_CMPY_CD
        AND PLT.PO_LINE_TP_CD (+) = PRLT.PRCH_REQ_LINE_TP_CD
        AND PLT.EZCANCELFLAG (+) = '0'
        -- JOIN TO COA_PROJ_ACCT
        AND CPA.GLBL_CMPY_CD (+) = AMV.GLBL_CMPY_CD
        AND CPA.COA_PROJ_CD (+) = AMV.COA_MDSE_TP_CD
        AND CPA.COA_PROJ_ACCT_TP_CD (+) = PLT.ACRL_CM_DEF_ACCT_CD
        AND CPA.EZCANCELFLAG (+) = '0'
        <!-- QC#30058 ADD -->
        ORDER BY CMP.CMPSN_PK
    </statement>

    <statement id="findAslDtl" parameterClass="Map" resultClass="Map">
        SELECT
            AD.ASL_DTL_PK
            , AD.VND_UOM_CD
            , NVL(AD.SPLY_ITEM_NUM, MDSE_CD) AS SPLY_ITEM_NUM
            , AD.UNIT_PRC_AMT
            , AD.VND_LT_DAYS_NUM
    <!-- START 2023/02/07 T.Kuroda QC#60966 ADD -->
            , AD.VND_SHIP_LT_DAYS_NUM
    <!-- END   2023/02/07 T.Kuroda QC#60966 ADD -->
        FROM
            ASL_DTL AD
        WHERE
            AD.GLBL_CMPY_CD = #glblCmpyCd#
        AND AD.VND_CD = #vndCd#
        AND AD.MDSE_CD = #mdseCd#
        AND AD.EFF_FROM_DT &lt;= #salesDate#
        AND NVL(AD.EFF_THRU_DT, 99991231) &gt;= #salesDate#
        AND AD.EZCANCELFLAG = '0'
    </statement>

    <statement id="getPreferedCarrier" parameterClass="Map" resultClass="Map">
        SELECT
            RW.PRF_CARR_CD
            , OCV.CARR_NM
        FROM
            RTL_WH RW
            , OTBD_CARR_V OCV
        WHERE
            RW.GLBL_CMPY_CD = #glblCmpyCd#
        AND RW.RTL_WH_CD = #rtlWhCd#
        AND RW.EZCANCELFLAG = '0'
        AND RW.GLBL_CMPY_CD = OCV.GLBL_CMPY_CD
        AND RW.PRF_CARR_CD = OCV.CARR_CD
        AND OCV.EZCANCELFLAG = '0'
    </statement>

    <statement id="getMaxPrLineNum" parameterClass="Map" resultClass="Map">
        SELECT
            MAX(PRD.PRCH_REQ_LINE_NUM) AS MAX_LINE_NUM
        FROM
            PRCH_REQ_DTL PRD
        WHERE
            PRD.GLBL_CMPY_CD = #glblCmpyCd#
        AND PRD.PRCH_REQ_NUM = #prchReqNum#
    </statement>

    <statement id="getContactPerson" parameterClass="Map" resultClass="Map">
        SELECT
            DCCP.CTAC_PSN_FIRST_NM || ' ' || DCCP.CTAC_PSN_MID_NM  || ' ' || DCCP.CTAC_PSN_LAST_NM AS CTAC_PERSON
        FROM
            DS_CPO_CTAC_PSN DCCP
        WHERE
            DCCP.GLBL_CMPY_CD = #glblCmpyCd#
        AND DCCP.CPO_ORD_NUM = #cpoOrdNum#
        AND DCCP.DS_CPO_CONFIG_PK = #dsCpoConfigPk#
        AND DCCP.EZCANCELFLAG = '0'
    </statement>

    <statement id="chkFrtCondSvcLvlReln" parameterClass="Map" resultClass="Map">
        SELECT
            FCSLR.FRT_COND_CD
        FROM
            FRT_COND_SVC_LVL_RELN FCSLR
        WHERE
            FCSLR.GLBL_CMPY_CD = #glblCmpyCd#
        AND FCSLR.LINE_BIZ_TP_CD = #lineBizTpCd#
        AND FCSLR.FRT_COND_CD = #frtCondCd#
        <isNotNull property="shpgSvcLvlCd">
        AND FCSLR.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
        </isNotNull>
        <isNotNull property="carrSvcLvlCd">
        AND FCSLR.CARR_SVC_LVL_CD = #carrSvcLvlCd#
        </isNotNull>
        AND FCSLR.EZCANCELFLAG = '0'
        AND ROWNUM = 1
    </statement>

    <statement id="getVendorName" parameterClass="Map" resultClass="Map">
        SELECT
            PVV.PRNT_VND_CD
            , PVV.PRNT_VND_NM
            , PVV.VND_CD
            , PVV.VND_NM
        FROM
            PO_VND_V PVV
        WHERE
            PVV.GLBL_CMPY_CD = #glblCmpyCd#
        <isNotNull property="prntVndCd">
        AND PVV.PRNT_VND_CD = #prntVndCd#
        </isNotNull>
        <isNotNull property="prntVndNm">
        AND PVV.PRNT_VND_NM = #prntVndNm#
        </isNotNull>
        <isNotNull property="vndCd">
        AND PVV.VND_CD = #vndCd#
        </isNotNull>
        <isNotNull property="vndNm">
        AND PVV.VND_NM = #vndNm#
        </isNotNull>
        AND PVV.EZCANCELFLAG = '0'
    </statement>

    <statement id="findCpoNumberList" parameterClass="Map" resultClass="Map">
    SELECT
        ROW_NUMBER() OVER(PARTITION BY 
             MAIN.CPO_ORD_NUM
            ,MAIN.SHIP_TO_LOC_NM_HS
            ,MAIN.SHIP_TO_ADDL_LOC_NM_HS
            ,MAIN.XX_ALL_LINE_ADDR_HS
            ,MAIN.CTRY_CD
            ,MAIN.SHIP_TO_POST_CD_HS
            ,MAIN.SHIP_TO_CTY_ADDR_HS
            ,MAIN.SHIP_TO_CNTY_NM_HS
            ,MAIN.SHIP_TO_ST_CD_HS
            ,MAIN.SHIP_TO_PROV_ADDR_HS
            ,MAIN.CTRY_NM_HS
         ORDER BY MAIN.CPO_ORD_NUM, MAIN.CPO_DTL_LINE_NUM
         ) AS CPO_ROW_NUMBER
         , MAIN.*
    FROM (
        SELECT
            -- Header
            SP.RDD_DT
            , C.CPO_ORD_NUM
            , AMV.PRCH_GRP_CD
            , CD.RTL_WH_CD
            , RW.RTL_WH_NM
            , CD.RTL_SWH_CD
            , RS.RTL_SWH_NM
            , SP.SHIP_TO_CUST_CD
            -- Detail Table
            , NVL(OTM.MDSE_CD, SP.MDSE_CD) MDSE_CD
            , SP.ORD_QTY
            , #coaCmpyCd# || '.' || RW.COA_BR_CD || '.' || #coaCcCd# || '.' || CPA.COA_ACCT_CD || '.' || #coaProdCd# || '.' || #coaChCd# || '.' || #coaAfflCd# || '.' || #coaProjCd# || '.' || #coaExtnCd# AS XX_CHG_ACCOUNT
            , NVL2(
                CD.DS_ORD_POSN_NUM
                , (CD.DS_ORD_POSN_NUM || '.' || CD.DS_CPO_LINE_NUM || NVL2(
                    CD.DS_CPO_LINE_SUB_NUM
                    , ('.' || CD.DS_CPO_LINE_SUB_NUM)
                    , ''
                ))
                , NULL
            ) DPLY_LINE_NUM
            , AMV.COA_MDSE_TP_CD
            , AMV.COA_PROD_CD
            -- Additional Header
            , SP.SHIP_TO_LOC_NM AS SHIP_TO_LOC_NM_HS
            , SP.SHIP_TO_ADDL_LOC_NM AS SHIP_TO_ADDL_LOC_NM_HS
            , SP.SHIP_TO_FIRST_LINE_ADDR || ' ' ||  SP.SHIP_TO_SCD_LINE_ADDR || ' ' ||  SP.SHIP_TO_THIRD_LINE_ADDR || ' ' ||  SP.SHIP_TO_FRTH_LINE_ADDR AS XX_ALL_LINE_ADDR_HS
            , SP.SHIP_TO_POST_CD AS SHIP_TO_POST_CD_HS
            , SP.SHIP_TO_CTY_ADDR AS SHIP_TO_CTY_ADDR_HS
            , SP.SHIP_TO_CNTY_NM AS SHIP_TO_CNTY_NM_HS
            , SP.SHIP_TO_ST_CD AS SHIP_TO_ST_CD_HS
            , SP.SHIP_TO_PROV_ADDR AS SHIP_TO_PROV_ADDR_HS
            , SP.SHIP_TO_CTRY_CD AS CTRY_CD
            , CTRY.CTRY_NM AS CTRY_NM_HS
            -- Other
            , CD.CPO_DTL_LINE_NUM
            , CD.CPO_DTL_LINE_SUB_NUM
            , DMI2.PRNT_CMPY_SET_MDSE_FLG
            <!-- QC#60605 MOD -->
            <!-- QC#60605 ADD -->
            <!-- , DECODE(DMI2.INVTY_CTRL_FLG,
                     #InvtyCtrlFlg#, #lineTpExpense#,
                     #lineTpGoods#) AS RS_LINE_TP -->
            <!-- QC#60605 ADD -->
            , CASE WHEN DMI2.INVTY_CTRL_FLG = #InvtyCtrlFlg#
                    AND DMI2.PRNT_CMPY_SET_MDSE_FLG != #prntCmpySetMdseFlgY#
                   THEN #lineTpExpense#
                   ELSE #lineTpGoods#
              END AS RS_LINE_TP
            <!-- QC#60605 MOD -->
            , CD.DS_CPO_CONFIG_PK
            , SP.BILL_TO_CUST_CD
            , SP.SHIP_TO_FIRST_LINE_ADDR
            , SP.SHIP_TO_SCD_LINE_ADDR
            , SP.SHIP_TO_THIRD_LINE_ADDR
            , SP.SHIP_TO_FRTH_LINE_ADDR
            , C.DS_ORD_CATG_CD
            , AMV.MDSE_DESC_SHORT_TXT
            , DCC.DS_ORD_POSN_NUM
            <!-- QC#28941 ADD Freight information -->
            , C.FRT_COND_CD
            , SP.REQ_SHPG_SVC_LVL_CD
            , SP.RQST_CARR_CD
            , SP.CARR_ACCT_NUM
            , RW.RTL_WH_CATG_CD
            
        FROM
              CPO C
            , CPO_DTL CD
            , DS_CPO_CONFIG DCC
            , SHPG_PLN SP
            , ALL_MDSE_V AMV
            , MDSE DMI2
            , RTL_WH RW
            , RTL_SWH RS
            , COA_PROJ_ACCT CPA
            , CTRY CTRY
            , ORD_TAKE_MDSE OTM
        WHERE
        -- JOIN TO CPO
            C.GLBL_CMPY_CD = #glblCmpyCd#
        AND C.CPO_ORD_NUM = #cpoOrdNum#
        AND C.EZCANCELFLAG = '0'
        -- JOIN TO CPO_DTL
        AND C.GLBL_CMPY_CD = CD.GLBL_CMPY_CD
        AND C.CPO_ORD_NUM = CD.CPO_ORD_NUM
        AND CD.EZCANCELFLAG = '0'
        -- JOIN TO DS_CPO_CONFIG
        AND CD.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM = DCC.CPO_ORD_NUM
        AND CD.DS_CPO_CONFIG_PK = DCC.DS_CPO_CONFIG_PK
        <isNotNull  property="dsOrdPosnNum">
        AND DCC.DS_ORD_POSN_NUM = #dsOrdPosnNum#
        </isNotNull>
        AND DCC.EZCANCELFLAG = '0'
        -- JOIN TO SHPG_PLN
        AND CD.GLBL_CMPY_CD = SP.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM = SP.TRX_HDR_NUM
        AND CD.CPO_DTL_LINE_NUM = SP.TRX_LINE_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM = SP.TRX_LINE_SUB_NUM
        AND SP.EZCANCELFLAG = '0'
        -- JOIN TO ALL_MDSE_V
        AND SP.GLBL_CMPY_CD = AMV.GLBL_CMPY_CD
        AND SP.MDSE_CD = AMV.MDSE_CD
        AND AMV.PRNT_CMPY_SET_MDSE_FLG = #prntCmpySetMdseFlg#
        <!-- QC#60605 ADD -->
        AND AMV.COA_MDSE_TP_CD != #coaMdseTpCd#
        <!-- QC#60605 ADD -->
        AND AMV.EZCANCELFLAG = '0'
        -- LEFT JOIN TO DS_MDSE_INFO_2
        AND SP.GLBL_CMPY_CD = DMI2.GLBL_CMPY_CD(+)
        AND SP.SET_MDSE_CD = DMI2.MDSE_CD(+)
        AND DMI2.EZCANCELFLAG(+) = '0'
        -- LEFT JOIN TO RTL_WH
        AND CD.GLBL_CMPY_CD = RW.GLBL_CMPY_CD(+)
        AND CD.RTL_WH_CD = RW.RTL_WH_CD(+)
        AND RW.EZCANCELFLAG(+) = '0'
        -- LEFT JOIN TO RTL_SWH
        AND CD.GLBL_CMPY_CD = RS.GLBL_CMPY_CD(+)
        AND CD.RTL_WH_CD = RS.RTL_WH_CD(+)
        AND CD.RTL_SWH_CD = RS.RTL_SWH_CD(+)
        AND RS.EZCANCELFLAG(+) = '0'
        -- LEFT JOIN TO COA_PROJ_ACCT
        AND AMV.GLBL_CMPY_CD = CPA.GLBL_CMPY_CD(+)
        AND AMV.COA_MDSE_TP_CD = CPA.COA_PROJ_CD(+)
        AND CPA.COA_PROJ_ACCT_TP_CD(+) = #coaProjAcctTpCd#
        AND CPA.EZCANCELFLAG(+) = '0'
        -- LEFT JOIN TO CTRY
        AND SP.GLBL_CMPY_CD         = CTRY.GLBL_CMPY_CD(+)
        AND SP.SHIP_TO_CTRY_CD      = CTRY.CTRY_CD(+)
        AND CTRY.EZCANCELFLAG(+)    = '0'
        -- LEFT JOIN TO ORD_TAKE_MDSE
        AND SP.GLBL_CMPY_CD         = OTM.GLBL_CMPY_CD(+)
        AND SP.MDSE_CD              = OTM.ORD_TAKE_MDSE_CD(+)
        AND OTM.EZCANCELFLAG(+)     = '0'
        ORDER BY DCC.DS_ORD_POSN_NUM ASC
    ) MAIN
    ORDER BY MAIN.CPO_ORD_NUM, MAIN.DS_ORD_POSN_NUM ASC
    </statement>

    <statement id="findSetItemList" parameterClass="Map" resultClass="Map">
        SELECT
            -- Detail Table
            NVL(OTM.MDSE_CD, SP.MDSE_CD) MDSE_CD
            , SP.ORD_QTY
            , #coaCmpyCd# || '.' || RW.COA_BR_CD || '.' || #coaCcCd# || '.' || CPA.COA_ACCT_CD || '.' || #coaProdCd# || '.' || #coaChCd# || '.' || #coaAfflCd# || '.' || #coaProjCd# || '.' || #coaExtnCd# AS XX_CHG_ACCOUNT
            , NVL2(
                CD.DS_ORD_POSN_NUM
                , (CD.DS_ORD_POSN_NUM || '.' || CD.DS_CPO_LINE_NUM || NVL2(
                    CD.DS_CPO_LINE_SUB_NUM
                    , ('.' || CD.DS_CPO_LINE_SUB_NUM)
                    , ''
                ))
                , NULL
            ) DPLY_LINE_NUM
            , AMV.COA_MDSE_TP_CD
            , AMV.COA_PROD_CD
            -- Other
            , C.CPO_ORD_NUM
            , CD.CPO_DTL_LINE_NUM
            , CD.CPO_DTL_LINE_SUB_NUM
            , 'Y' AS PRNT_CMPY_SET_MDSE_FLG
            , CD.DS_CPO_CONFIG_PK
            , CD.RTL_WH_CD
            , RW.RTL_WH_NM
            , CD.RTL_SWH_CD
            , RS.RTL_SWH_NM
            , SP.SHIP_TO_CUST_CD
            , C.DS_ORD_CATG_CD
            , RW.RTL_WH_CATG_CD
            , SP.ORD_QTY
            , SP.SHIP_TO_LOC_NM AS SHIP_TO_LOC_NM_HS
            , SP.SHIP_TO_ADDL_LOC_NM AS SHIP_TO_ADDL_LOC_NM_HS
            , SP.SHIP_TO_FIRST_LINE_ADDR || ' ' ||  SP.SHIP_TO_SCD_LINE_ADDR || ' ' ||  SP.SHIP_TO_THIRD_LINE_ADDR || ' ' ||  SP.SHIP_TO_FRTH_LINE_ADDR AS XX_ALL_LINE_ADDR_HS
            , SP.SHIP_TO_POST_CD AS SHIP_TO_POST_CD_HS
            , SP.SHIP_TO_CTY_ADDR AS SHIP_TO_CTY_ADDR_HS
            , SP.SHIP_TO_CNTY_NM AS SHIP_TO_CNTY_NM_HS
            , SP.SHIP_TO_ST_CD AS SHIP_TO_ST_CD_HS
            , SP.SHIP_TO_PROV_ADDR AS SHIP_TO_PROV_ADDR_HS
            , SP.SHIP_TO_CTRY_CD AS CTRY_CD
            , SP.BILL_TO_CUST_CD
            , SP.SHIP_TO_FIRST_LINE_ADDR
            , SP.SHIP_TO_SCD_LINE_ADDR
            , SP.SHIP_TO_THIRD_LINE_ADDR
            , SP.SHIP_TO_FRTH_LINE_ADDR
            , SP.REQ_SHPG_SVC_LVL_CD
            , SP.RQST_CARR_CD
            , SP.CARR_ACCT_NUM
            , #CPO_ROW_NUMBER# AS CPO_ROW_NUMBER
        FROM
            CPO C
            , CPO_DTL CD
            , SHPG_PLN SP
            , ALL_MDSE_V AMV
            , RTL_WH RW
            , RTL_SWH RS
            , COA_PROJ_ACCT CPA
            , ORD_TAKE_MDSE OTM
        WHERE
        -- JOIN TO CPO
            C.GLBL_CMPY_CD = #glblCmpyCd#
        AND C.CPO_ORD_NUM = #cpoOrdNum#
        AND C.EZCANCELFLAG = '0'
        -- JOIN TO CPO_DTL
        AND C.GLBL_CMPY_CD = CD.GLBL_CMPY_CD
        AND C.CPO_ORD_NUM = CD.CPO_ORD_NUM
        AND CD.CPO_DTL_LINE_NUM = #cpoDtlLineNum#
        AND CD.CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
        AND CD.EZCANCELFLAG = '0'
        -- JOIN TO SHPG_PLN
        AND CD.GLBL_CMPY_CD = SP.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM = SP.TRX_HDR_NUM
        AND CD.CPO_DTL_LINE_NUM = SP.TRX_LINE_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM = SP.TRX_LINE_SUB_NUM
        AND SP.EZCANCELFLAG = '0'
        -- JOIN TO ALL_MDSE_V
        AND SP.GLBL_CMPY_CD = AMV.GLBL_CMPY_CD
        AND SP.MDSE_CD = AMV.MDSE_CD
        AND AMV.EZCANCELFLAG = '0'
        -- LEFT JOIN TO RTL_WH
        AND CD.GLBL_CMPY_CD = RW.GLBL_CMPY_CD(+)
        AND CD.RTL_WH_CD = RW.RTL_WH_CD(+)
        AND RW.EZCANCELFLAG(+) = '0'
        -- LEFT JOIN TO RTL_SWH
        AND CD.GLBL_CMPY_CD = RS.GLBL_CMPY_CD(+)
        AND CD.RTL_WH_CD = RS.RTL_WH_CD(+)
        AND CD.RTL_SWH_CD = RS.RTL_SWH_CD(+)
        AND RS.EZCANCELFLAG(+) = '0'
        -- LEFT JOIN TO COA_PROJ_ACCT
        AND AMV.GLBL_CMPY_CD = CPA.GLBL_CMPY_CD(+)
        AND AMV.COA_MDSE_TP_CD = CPA.COA_PROJ_CD(+)
        AND CPA.COA_PROJ_ACCT_TP_CD(+) = #coaProjAcctTpCd#
        AND CPA.EZCANCELFLAG(+) = '0'
        -- LEFT JOIN TO ORD_TAKE_MDSE
        AND SP.GLBL_CMPY_CD         = OTM.GLBL_CMPY_CD(+)
        AND SP.MDSE_CD              = OTM.ORD_TAKE_MDSE_CD(+)
        AND OTM.EZCANCELFLAG(+)     = '0'
    </statement>

    <statement id="getPoReqList" parameterClass="Map" resultClass="Map">
        SELECT
            -- Header Info
            -- 08/07/2017 CITS H.Naoi Add MRP_PLN_NM Sol 097 QC18398
            EZUPTIME_AH
            , EZUPTIMEZONE_AH
            , PRCH_REQ_NUM
            , PRCH_REQ_TP_CD
            , PRCH_REQ_TP_NM
            , PRCH_REQ_STS_CD
            , PRCH_REQ_STS_NM
            , PRCH_REQ_APVL_STS_CD
            , PRCH_REQ_APVL_STS_NM
            , RQST_RCV_DT
            , RQST_RCV_TM
        <!-- START 2023/02/07 T.Kuroda QC#60966 ADD -->
            , RQST_SHIP_DT
        <!-- END   2023/02/07 T.Kuroda QC#60966 ADD -->
            , PRCH_REQ_SRC_TP_NM
            , TRX_REF_NUM
            , PO_QLFY_CD
            , MRP_PLN_NM
            , PRCH_REQ_CRAT_BY_NM
            , PRCH_REQ_RQST_BY_PSN_CD
            , NVL2(FULL_PSN_NM2,FULL_PSN_NM2,FULL_PSN_NM) AS FULL_PSN_NM
            , PRCH_GRP_CD
            , PRCH_REQ_CMNT_TXT
            , PRNT_VND_CD
            , PRNT_VND_NM
            , VND_CD
            , LOC_NM
            , DEST_RTL_WH_CD
            , RTL_WH_NM
            , DEST_RTL_SWH_CD
            , RTL_SWH_NM
            , XX_LOC_NM
            , PRCH_REQ_CRAT_DT
            -- Detail Header Info
            , CCY_CD
            -- Detail Table Info
            , EZUPTIME_AD
            , EZUPTIMEZONE_AD
            , XX_LINE_NUM
            , PRCH_REQ_LINE_TP_NM
            , PRCH_REQ_LINE_TP_CD
            , MDSE_CD
            , ASL_MDSE_CD
            , MDSE_DESC_SHORT_TXT
            , PRCH_REQ_DISP_QTY
            , PRCH_REQ_DSPL_UOM_CD
            , PRNT_VND_NM_A1
            , LOC_NM_A1
            , PRCH_REQ_LINE_STS_NM
            , ENT_DEAL_NET_UNIT_PRC_AMT
            , XX_EXT_PRICE
            , DTL_RQST_RCV_DT
        <!-- START 2023/02/07 T.Kuroda QC#60966 ADD -->
            , DTL_RQST_SHIP_DT
        <!-- END   2023/02/07 T.Kuroda QC#60966 ADD -->
            , XX_CHG_ACCOUNT
            , COA_MDSE_TP_CD
            , COA_PROD_CD
            , PRCH_REQ_LINE_CMNT_TXT
            , DPLY_LINE_NUM
            , REL_RQST_TO_PO_ORD_NUM
            , PO_SCHD_REL_DT
            , PO_ORD_NUM
            , PO_ORD_DTL_LINE_NUM
            , PRCH_REQ_REL_DT_TM_TS
            , PRCH_REQ_REL_ERR_MSG_TXT
            , PRCH_REQ_LINE_NUM
            , PRCH_REQ_LINE_SUB_NUM
            , PO_MDSE_CMPSN_TP_CD
            , PRNT_VND_CD_A1
            , VND_CD_A1
            , COA_CMPY_CD_A1
            , COA_AFFL_CD_A1
            , COA_BR_CD_A1
            , COA_CH_CD_A1
            , COA_CC_CD_A1
            , COA_ACCT_CD_A1
            , COA_PROJ_CD_A1
            , COA_EXTN_CD_A1
            , COA_PROD_CD_A1
            , PO_SUBMT_TS
            , SPCL_INSTN_CMNT_TXT
            , TRX_REF_LINE_NUM
            , TRX_REF_LINE_SUB_NUM
            -- Additional Header Ship To Location
            , SHIP_TO_LOC_NM_HS
            , SHIP_TO_ADDL_LOC_NM_HS
            <!-- QC#26990 Add SQL -->
            , SHIP_TO_FIRST_LINE_ADDR
            , SHIP_TO_SCD_LINE_ADDR
            , SHIP_TO_THIRD_LINE_ADDR
            , SHIP_TO_FRTH_LINE_ADDR
            , CTRY_CD
            , SHIP_TO_CUST_CD
            <!-- QC#26990 Add SQL -->
            , XX_ALL_LINE_ADDR_HS
            , SHIP_TO_POST_CD_HS
            , SHIP_TO_CTY_ADDR_HS
            , SHIP_TO_CNTY_NM_HS
            , SHIP_TO_ST_CD_HS
            , SHIP_TO_PROV_NM_HS
            , CTRY_CD_HS
            , CTRY_NM_HS
            , CTAC_PSN_NM_HS
            -- Additional Header Freight Information
            , FRT_COND_CD_HF
            , SHPG_SVC_LVL_CD_HF
            , CARR_CD_HF
            , VND_CD_HF
            , LOC_NM_HF
            , CARR_ACCT_NUM_HF
            -- Additional Header PO Release
            , PRCH_REQ_REL_ERR_MSG_TXT_HP
            , PRCH_REQ_REL_DT_TM_TS_HP
            -- Other
            , SELL_TO_CUST_CD
            , BILL_TO_CUST_CD
            , PRCH_REQ_SAVED_FLG
            , OPEN_STS_FLG_PR
            , PRCH_REQ_LINE_STS_CD
            , OPEN_STS_FLG_PRD
            , PRNT_CMPY_SET_MDSE_FLG
            -- WHO
            , XX_REC_HIST_CRAT_TS
            , XX_REC_HIST_CRAT_BY_NM
            , XX_REC_HIST_UPD_TS
            , XX_REC_HIST_UPD_BY_NM
            , XX_REC_HIST_TBL_NM
            , XX_REC_HIST_CRAT_TS_A1
            , XX_REC_HIST_CRAT_BY_NM_A1
            , XX_REC_HIST_UPD_TS_A1
            , XX_REC_HIST_UPD_BY_NM_A1
            , XX_REC_HIST_TBL_NM_A1
        FROM (
            SELECT
                -- Header Info
                -- 08/07/2017 CITS H.Naoi Add PR.MRP_PLN_NM Sol 097 QC18398
                PR.EZUPTIME AS EZUPTIME_AH
                , PR.EZUPTIMEZONE AS EZUPTIMEZONE_AH
                , PR.PRCH_REQ_NUM
                , PR.PRCH_REQ_TP_CD
                , PRT.PRCH_REQ_TP_NM
                , PR.PRCH_REQ_STS_CD
                , PRS.PRCH_REQ_STS_NM
                , PR.PRCH_REQ_APVL_STS_CD
                , PRAS.PRCH_REQ_APVL_STS_NM
                , PRD.RQST_RCV_DT
                , PRD.RQST_RCV_TM
        <!-- START 2023/02/07 T.Kuroda QC#60966 ADD -->
                , PR.RQST_SHIP_DT
        <!-- END   2023/02/07 T.Kuroda QC#60966 ADD -->
                , PRST.PRCH_REQ_SRC_TP_NM
                , PR.TRX_REF_NUM
                , PR.PO_QLFY_CD
                , PR.MRP_PLN_NM
                , PR.PRCH_REQ_CRAT_BY_NM
                , PR.PRCH_REQ_RQST_BY_PSN_CD
                , AP.FIRST_NM || (NVL2(AP.MID_NM, ' '||AP.MID_NM||' ', ' ')) || AP.LAST_NM    FULL_PSN_NM
                , SSUL.FULL_PSN_NM AS FULL_PSN_NM2
                , PR.PRCH_GRP_CD
                , PR.PRCH_REQ_CMNT_TXT
                , PRD.PRNT_VND_CD
                , PV.PRNT_VND_NM
                , PRD.VND_CD
                , V2.LOC_NM
                , PRD.DEST_RTL_WH_CD
                , RW.RTL_WH_NM
                , PRD.DEST_RTL_SWH_CD
                , RS.RTL_SWH_NM
                , CASE WHEN PR.SHIP_TO_LOC_NM IS NULL THEN STC.LOC_NM ELSE PR.SHIP_TO_LOC_NM END AS XX_LOC_NM
                , PR.PRCH_REQ_CRAT_DT
                -- Detail Header Info
                , PRD.CCY_CD
                -- Detail Table Info
                , PRD.EZUPTIME AS EZUPTIME_AD
                , PRD.EZUPTIMEZONE AS EZUPTIMEZONE_AD
                , CASE WHEN PRD.PRCH_REQ_LINE_SUB_NUM = 0 THEN PRD.PRCH_REQ_LINE_NUM ELSE PRD.PRCH_REQ_LINE_NUM || '.' || PRCH_REQ_LINE_SUB_NUM END AS XX_LINE_NUM
                , PRLT.PRCH_REQ_LINE_TP_NM
                , PRD.PRCH_REQ_LINE_TP_CD
                <!-- QC#28939 Update mdse -->
                , CASE AMV.MDSE_ITEM_TP_CD
                    WHEN #mdseItemTpTextItem# THEN NULL
                    ELSE PRD.MDSE_CD
                  END AS MDSE_CD
                , PRD.ASL_MDSE_CD
                <!-- QC#28939 Update mdse description -->
                <!-- QC#53271 Update -->
                <!-- , CASE AMV.MDSE_ITEM_TP_CD
                    WHEN #mdseItemTpTextItem# THEN PRD.MDSE_DESC_SHORT_TXT
                    ELSE AMV.MDSE_DESC_SHORT_TXT
                  END AS MDSE_DESC_SHORT_TXT -->
                , CASE WHEN PRD.PRCH_REQ_LINE_TP_CD IN(#prchReqLineTpCdExpenseW#, #prchReqLineTpCdAssets#) THEN NVL(PRD.MDSE_DESC_SHORT_TXT, AMV.MDSE_DESC_SHORT_TXT)
                       ELSE AMV.MDSE_DESC_SHORT_TXT
                  END AS MDSE_DESC_SHORT_TXT
                , PRD.PRCH_REQ_DISP_QTY
                , PRD.PRCH_REQ_DSPL_UOM_CD
                , PV.PRNT_VND_NM AS PRNT_VND_NM_A1
                , V2.LOC_NM AS LOC_NM_A1
                , PRLS.PRCH_REQ_LINE_STS_NM
                , PRD.ENT_DEAL_NET_UNIT_PRC_AMT
                , (PRD.ENT_DEAL_NET_UNIT_PRC_AMT * PRD.PRCH_REQ_DISP_QTY) AS XX_EXT_PRICE
                , PRD.RQST_RCV_DT AS DTL_RQST_RCV_DT
        <!-- START 2023/02/07 T.Kuroda QC#60966 ADD -->
                , PRD.RQST_SHIP_DT AS DTL_RQST_SHIP_DT
        <!-- END   2023/02/07 T.Kuroda QC#60966 ADD -->
                , CASE
                    WHEN PRD.COA_CMPY_CD IS NULL THEN 
                        NULL
                    ELSE
                        PRD.COA_CMPY_CD || '.' || PRD.COA_BR_CD || '.' || PRD.COA_CC_CD || '.' || PRD.COA_ACCT_CD || '.' || PRD.COA_PROD_CD || '.' || PRD.COA_CH_CD || '.' || PRD.COA_AFFL_CD || '.' || PRD.COA_PROJ_CD || '.' || PRD.COA_EXTN_CD
                  END AS XX_CHG_ACCOUNT
                , AMV.COA_MDSE_TP_CD
                , AMV.COA_PROD_CD
                , PRD.PRCH_REQ_LINE_CMNT_TXT
                , NVL2(
                    CD.CPO_ORD_NUM
                    , NVL2(
                        CD.DS_ORD_POSN_NUM
                        , (CD.DS_ORD_POSN_NUM || '.' || CD.DS_CPO_LINE_NUM || NVL2(
                            CD.DS_CPO_LINE_SUB_NUM
                            , ('.' || CD.DS_CPO_LINE_SUB_NUM)
                            , ''
                        ))
                        , NULL
                    )
                    , PRD.TRX_REF_LINE_NUM
                ) DPLY_LINE_NUM
                , PRD.REL_RQST_TO_PO_ORD_NUM
                , PRD.PO_SCHD_REL_DT
                , PRD.PO_ORD_NUM
                , PRD.PO_ORD_DTL_LINE_NUM
                , PRD.PRCH_REQ_REL_DT_TM_TS
                , PRD.PRCH_REQ_REL_ERR_MSG_TXT
                , PRD.PRCH_REQ_LINE_NUM
                , PRD.PRCH_REQ_LINE_SUB_NUM
                , PRD.PO_MDSE_CMPSN_TP_CD
                , PRD.PRNT_VND_CD AS PRNT_VND_CD_A1
                , PRD.VND_CD AS VND_CD_A1
                , PRD.COA_CMPY_CD AS COA_CMPY_CD_A1
                , PRD.COA_AFFL_CD AS COA_AFFL_CD_A1
                , PRD.COA_BR_CD AS COA_BR_CD_A1
                , PRD.COA_CH_CD AS COA_CH_CD_A1
                , PRD.COA_CC_CD AS COA_CC_CD_A1
                , PRD.COA_ACCT_CD AS COA_ACCT_CD_A1
                , PRD.COA_PROJ_CD AS COA_PROJ_CD_A1
                , PRD.COA_EXTN_CD AS COA_EXTN_CD_A1
                , PRD.COA_PROD_CD AS COA_PROD_CD_A1
                , PO.PO_SUBMT_TS
                , PRD.SPCL_INSTN_CMNT_TXT
                , PR.SHIP_TO_CUST_CD
                , PR.SHIP_TO_CTRY_CD AS CTRY_CD
                , PR.SHIP_TO_FIRST_LINE_ADDR
                , PR.SHIP_TO_SCD_LINE_ADDR
                , PR.SHIP_TO_THIRD_LINE_ADDR
                , PR.SHIP_TO_FRTH_LINE_ADDR
                , PRD.TRX_REF_LINE_NUM
                , PRD.TRX_REF_LINE_SUB_NUM
                -- Additional Header Ship To Location
                , CASE WHEN PR.SHIP_TO_CUST_CD IS NULL THEN STC.LOC_NM ELSE PR.SHIP_TO_LOC_NM END AS SHIP_TO_LOC_NM_HS
                , CASE WHEN PR.SHIP_TO_CUST_CD IS NULL THEN STC.ADDL_LOC_NM ELSE PR.SHIP_TO_ADDL_LOC_NM END AS SHIP_TO_ADDL_LOC_NM_HS
                , CASE WHEN PR.SHIP_TO_CUST_CD IS NULL THEN 
                    STC.FIRST_LINE_ADDR || ' ' ||  STC.SCD_LINE_ADDR || ' ' ||  STC.THIRD_LINE_ADDR || ' ' ||  STC.FRTH_LINE_ADDR 
                  ELSE 
                    PR.SHIP_TO_FIRST_LINE_ADDR || ' ' ||  PR.SHIP_TO_SCD_LINE_ADDR || ' ' ||  PR.SHIP_TO_THIRD_LINE_ADDR || ' ' ||  PR.SHIP_TO_FRTH_LINE_ADDR
                  END AS XX_ALL_LINE_ADDR_HS
                , CASE WHEN PR.SHIP_TO_CUST_CD IS NULL THEN STC.POST_CD ELSE PR.SHIP_TO_POST_CD END AS SHIP_TO_POST_CD_HS
                , CASE WHEN PR.SHIP_TO_CUST_CD IS NULL THEN STC.CTY_ADDR ELSE PR.SHIP_TO_CTY_ADDR END AS SHIP_TO_CTY_ADDR_HS
                , CASE WHEN PR.SHIP_TO_CUST_CD IS NULL THEN (SELECT CNTY_NM FROM CNTY C WHERE C.CNTY_PK = STC.CNTY_PK AND ROWNUM = 1 ) ELSE PR.SHIP_TO_CNTY_NM END AS SHIP_TO_CNTY_NM_HS
                , CASE WHEN PR.SHIP_TO_CUST_CD IS NULL THEN STC.ST_CD ELSE PR.SHIP_TO_ST_CD END AS SHIP_TO_ST_CD_HS
                , CASE WHEN PR.SHIP_TO_CUST_CD IS NULL THEN STC.PROV_NM ELSE PR.SHIP_TO_PROV_NM END AS SHIP_TO_PROV_NM_HS
                , CASE WHEN C1.CTRY_CD IS NULL THEN C2.CTRY_CD ELSE C1.CTRY_CD END AS CTRY_CD_HS
                , CASE WHEN C1.CTRY_NM IS NULL THEN C2.CTRY_NM ELSE C1.CTRY_NM END AS CTRY_NM_HS
                , PR.CTAC_PSN_NM AS CTAC_PSN_NM_HS
                -- Additional Header Freight Information
                , FC.FRT_COND_CD AS FRT_COND_CD_HF
                , SSL.SHPG_SVC_LVL_CD AS SHPG_SVC_LVL_CD_HF
                , PRD.CARR_CD AS CARR_CD_HF
                , V1.VND_CD AS VND_CD_HF
                , V1.LOC_NM AS LOC_NM_HF
                , PRD.CARR_ACCT_NUM AS CARR_ACCT_NUM_HF
                -- Additional Header PO Release
                , PRD.PRCH_REQ_REL_ERR_MSG_TXT AS PRCH_REQ_REL_ERR_MSG_TXT_HP
                , PRD.PRCH_REQ_REL_DT_TM_TS AS PRCH_REQ_REL_DT_TM_TS_HP
                -- Other
                , STC.SELL_TO_CUST_CD
                , PR.BILL_TO_CUST_CD
                , PRAS.PRCH_REQ_SAVED_FLG
                , PRS.OPEN_STS_FLG AS OPEN_STS_FLG_PR
                , PRLS.PRCH_REQ_LINE_STS_CD
                , PRLS.OPEN_STS_FLG AS OPEN_STS_FLG_PRD
                , AMV.PRNT_CMPY_SET_MDSE_FLG
                -- WHO
                ,PR.EZINTIME       AS XX_REC_HIST_CRAT_TS
                ,PR.EZINUSERID     AS XX_REC_HIST_CRAT_BY_NM
                ,PR.EZUPTIME       AS XX_REC_HIST_UPD_TS
                ,PR.EZUPUSERID     AS XX_REC_HIST_UPD_BY_NM
                ,PR.EZTABLEID      AS XX_REC_HIST_TBL_NM
                ,PRD.EZINTIME      AS XX_REC_HIST_CRAT_TS_A1
               -- ,PRD.EZINUSERID    AS XX_REC_HIST_CRAT_BY_NM_A1
                ,NVL(
                 (SELECT 
                      CASE WHEN IN_AP.MID_NM IS NULL AND IN_AP.FIRST_NM IS NULL THEN PRD.EZINUSERID
                           WHEN IN_AP.MID_NM IS NULL THEN PRD.EZINUSERID || ' : ' || IN_AP.FIRST_NM || ' ' || IN_AP.LAST_NM
                           WHEN IN_AP.MID_NM IS NOT NULL THEN PRD.EZINUSERID || ' : ' || IN_AP.FIRST_NM || IN_AP.MID_NM || ' ' || IN_AP.LAST_NM
                           ELSE PRD.EZINUSERID
                      END
                  FROM 
                      AUTH_PSN IN_AP
                  WHERE 1=1
                  AND PRD.GLBL_CMPY_CD          = IN_AP.GLBL_CMPY_CD(+)
	              AND UPPER(PRD.EZINUSERID)     = UPPER(IN_AP.USR_NM(+))
	              AND IN_AP.EZCANCELFLAG(+)     = '0') , PRD.EZINUSERID)  AS XX_REC_HIST_CRAT_BY_NM_A1
                ,PRD.EZUPTIME      AS XX_REC_HIST_UPD_TS_A1
              --  ,PRD.EZUPUSERID    AS XX_REC_HIST_UPD_BY_NM_A1
                ,NVL(
                 (SELECT 
                      CASE WHEN UP_AP.MID_NM IS NULL AND UP_AP.FIRST_NM IS NULL THEN PRD.EZUPUSERID
                           WHEN UP_AP.MID_NM IS NULL THEN PRD.EZUPUSERID || ' : ' || UP_AP.FIRST_NM || ' ' || UP_AP.LAST_NM
                           WHEN UP_AP.MID_NM IS NOT NULL THEN PRD.EZUPUSERID || ' : ' || UP_AP.FIRST_NM || UP_AP.MID_NM || ' ' || UP_AP.LAST_NM
                           ELSE PRD.EZUPUSERID
                      END
                   FROM 
                       AUTH_PSN UP_AP
                   WHERE 1=1 
                   AND PRD.GLBL_CMPY_CD          = UP_AP.GLBL_CMPY_CD(+)
	               AND UPPER(PRD.EZUPUSERID)     = UPPER(UP_AP.USR_NM(+))
	               AND UP_AP.EZCANCELFLAG(+)     = '0') , PRD.EZUPUSERID)  AS XX_REC_HIST_UPD_BY_NM_A1
                ,PRD.EZTABLEID     AS XX_REC_HIST_TBL_NM_A1
            FROM
                  PRCH_REQ PR
                , PRCH_REQ_DTL PRD
                , SHIP_TO_CUST STC
                , ALL_MDSE_V AMV
                , PRCH_REQ_TP PRT
                , PRCH_REQ_LINE_TP PRLT
                , PRCH_REQ_STS PRS
                , PRCH_REQ_LINE_STS PRLS
                , PRCH_REQ_APVL_STS PRAS
                , PRCH_REQ_SRC_TP PRST
                , AUTH_PSN AP
                , SCE_SYS_USR_LIST SSUL
                , SHPG_SVC_LVL SSL
                , VND V1
                , PRNT_VND PV
                , VND V2
                , RTL_WH RW
                , RTL_SWH RS
                , CTRY C1
                , CTRY C2
                , COA_PROJ_ACCT CPA
                , FRT_COND FC
                ,(SELECT PAT.COA_PROJ_ACCT_TP_CD
                    FROM PO_ACCT_TP PAT
                    WHERE
                        PAT.GLBL_CMPY_CD = #glblCmpyCd#
                    AND PAT.PO_ACCT_TP_CD = #poAcctTpCd#
                 ) PAT
                 , PO       PO
                 , CPO_DTL  CD
            WHERE
                  -- JOIN TO PRCH_REQ
                  PR.GLBL_CMPY_CD = #glblCmpyCd#
              AND PR.PRCH_REQ_NUM = #prchReqNum#
              AND PR.PRCH_REQ_REC_TP_CD = #poRequisition#
              AND PR.EZCANCELFLAG = '0'
              -- JOIN TO PRCH_REQ_DTL
              AND PR.GLBL_CMPY_CD = PRD.GLBL_CMPY_CD
              AND PR.PRCH_REQ_NUM = PRD.PRCH_REQ_NUM
              AND PRD.EZCANCELFLAG = '0'
              -- JOIN TO SHIP_TO_CUST
              AND PRD.GLBL_CMPY_CD = STC.GLBL_CMPY_CD
              AND PRD.DEST_RTL_WH_CD = STC.SHIP_TO_CUST_CD
              AND STC.EZCANCELFLAG = '0'
              -- JOIN TO ALL_MDSE_V
              AND PRD.GLBL_CMPY_CD = AMV.GLBL_CMPY_CD
              AND PRD.MDSE_CD = AMV.MDSE_CD
              AND AMV.EZCANCELFLAG = '0'
              -- LEFT JOIN TO PRCH_REQ_TP
              AND PR.GLBL_CMPY_CD = PRT.GLBL_CMPY_CD(+)
              AND PR.PRCH_REQ_TP_CD = PRT.PRCH_REQ_TP_CD(+)
              AND PRT.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO PRCH_REQ_LINE_TP
              AND PRD.GLBL_CMPY_CD = PRLT.GLBL_CMPY_CD(+)
              AND PRD.PRCH_REQ_LINE_TP_CD = PRLT.PRCH_REQ_LINE_TP_CD(+)
              AND PRLT.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO PRCH_REQ_STS
              AND PR.GLBL_CMPY_CD = PRS.GLBL_CMPY_CD(+)
              AND PR.PRCH_REQ_STS_CD = PRS.PRCH_REQ_STS_CD(+)
              AND PRS.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO PRCH_REQ_LINE_STS
              AND PRD.GLBL_CMPY_CD = PRLS.GLBL_CMPY_CD(+)
              AND PRD.PRCH_REQ_LINE_STS_CD = PRLS.PRCH_REQ_LINE_STS_CD(+)
              AND PRLS.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO PRCH_REQ_APVL_STS
              AND PR.GLBL_CMPY_CD = PRAS.GLBL_CMPY_CD(+)
              AND PR.PRCH_REQ_APVL_STS_CD = PRAS.PRCH_REQ_APVL_STS_CD(+)
              AND PRAS.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO PRCH_REQ_SRC_TP
              AND PR.GLBL_CMPY_CD = PRST.GLBL_CMPY_CD(+)
              AND PR.PRCH_REQ_SRC_TP_CD = PRST.PRCH_REQ_SRC_TP_CD(+)
              AND PRST.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO AUTH_PSN
              AND PR.GLBL_CMPY_CD = AP.GLBL_CMPY_CD(+)
              AND PR.PRCH_REQ_RQST_BY_PSN_CD = AP.USR_NM(+)
              AND AP.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO SCE_SYS_USR_LIST
              AND PR.GLBL_CMPY_CD = SSUL.GLBL_CMPY_CD(+)
              AND PR.PRCH_REQ_RQST_BY_PSN_CD = SSUL.FULL_PSN_NM(+)
              AND SSUL.EZCANCELFLAG(+) = '0'              
              -- LEFT JOIN TO SHPG_SVC_LVL
              AND PRD.GLBL_CMPY_CD = SSL.GLBL_CMPY_CD(+)
              AND PRD.SHPG_SVC_LVL_CD = SSL.SHPG_SVC_LVL_CD(+)
              AND SSL.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO VND_1
              AND PRD.GLBL_CMPY_CD = V1.GLBL_CMPY_CD(+)
              AND PRD.CARR_CD = V1.VND_CD(+)
              AND V1.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO PRNT_VND
              AND PRD.GLBL_CMPY_CD = PV.GLBL_CMPY_CD(+)
              AND PRD.PRNT_VND_CD = PV.PRNT_VND_CD(+)
              AND PV.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO VND_2
              AND PRD.GLBL_CMPY_CD = V2.GLBL_CMPY_CD(+)
              AND PRD.VND_CD = V2.VND_CD(+)
              AND V2.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO RTL_WH
              AND PRD.GLBL_CMPY_CD = RW.GLBL_CMPY_CD(+)
              AND PRD.DEST_RTL_WH_CD = RW.RTL_WH_CD(+)
              AND RW.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO RTL_SWH
              AND PRD.GLBL_CMPY_CD = RS.GLBL_CMPY_CD(+)
              AND PRD.DEST_RTL_WH_CD = RS.RTL_WH_CD(+)
              AND PRD.DEST_RTL_SWH_CD = RS.RTL_SWH_CD(+)
              AND RS.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO CTRY_1
              AND PR.GLBL_CMPY_CD = C1.GLBL_CMPY_CD(+)
              AND PR.SHIP_TO_CTRY_CD = C1.CTRY_CD(+)
              AND C1.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO CTRY_2
              AND RW.GLBL_CMPY_CD = C2.GLBL_CMPY_CD(+)
              AND RW.CTRY_CD = C2.CTRY_CD(+)
              AND C2.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO COA_PROJ_ACCT
              AND AMV.GLBL_CMPY_CD = CPA.GLBL_CMPY_CD(+)
              AND AMV.COA_MDSE_TP_CD = CPA.COA_PROJ_CD(+)
              AND CPA.COA_PROJ_ACCT_TP_CD (+) = PAT.COA_PROJ_ACCT_TP_CD
              AND CPA.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO FRT_COND
              AND PRD.GLBL_CMPY_CD = FC.GLBL_CMPY_CD(+)
              AND PRD.FRT_COND_CD = FC.FRT_COND_CD(+)
              AND FC.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO PO
              AND PRD.GLBL_CMPY_CD = PO.GLBL_CMPY_CD(+)
              AND PRD.PO_ORD_NUM   = PO.PO_ORD_NUM(+)
              AND PO.EZCANCELFLAG(+) = '0'
              -- LEFT JOIN TO CPO_DTL
              AND PRD.GLBL_CMPY_CD = CD.GLBL_CMPY_CD(+)
              AND PRD.TRX_REF_NUM  = CD.CPO_ORD_NUM(+)
              AND PRD.TRX_REF_LINE_NUM = CD.CPO_DTL_LINE_NUM(+)
              AND PRD.TRX_REF_LINE_SUB_NUM = CD.CPO_DTL_LINE_SUB_NUM(+)
              AND CD.EZCANCELFLAG(+) = '0'
             ORDER BY
                PR.PRCH_REQ_NUM ASC
                , TO_NUMBER(PRD.PRCH_REQ_LINE_NUM) ASC
                , PRD.PRCH_REQ_LINE_SUB_NUM ASC
        )
        WHERE ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="chkTechnicianWh" parameterClass="Map" resultClass="String">
        SELECT
            1
        FROM
            RTL_WH WH
        WHERE
            WH.GLBL_CMPY_CD = #glblCmpyCd#
        AND WH.RTL_WH_CD = #rtlWhCd#
        AND WH.LOC_TP_CD = #locTpCd#
        AND WH.EZCANCELFLAG = '0'
    </statement>

    <statement id="checkPrApvlStatus" parameterClass="Map" resultClass="String">
        SELECT
            PR.PRCH_REQ_NUM
        FROM
            PRCH_REQ PR
           ,PRCH_REQ_APVL_STS PRAS
        WHERE
            PR.GLBL_CMPY_CD = #glblCmpyCd#
        AND PR.PRCH_REQ_NUM = #prchReqNum#
        AND PR.GLBL_CMPY_CD = PRAS.GLBL_CMPY_CD
        AND PR.PRCH_REQ_APVL_STS_CD = PRAS.PRCH_REQ_APVL_STS_CD
        AND PRAS.PRCH_REQ_APVL_FLG = #prchRedApvlFlg#
        AND PR.EZCANCELFLAG = '0'
        AND PRAS.EZCANCELFLAG = '0'
    </statement>

    <statement id="countRtlWhInWhOwnr" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)
        FROM
            RTL_WH RW
        WHERE
            RW.GLBL_CMPY_CD = #glblCmpyCd#
        AND RW.RTL_WH_CD    = #rtlWhCd#
        <iterate property="whOwnrCdList" var="whOwnrCd[]" open="AND RW.WH_OWNR_CD IN (" close=")" conjunction=",">
            #whOwnrCd[]#
        </iterate>
        AND RW.EZCANCELFLAG = '0'
    </statement>

    <statement id="getMdseFromSupplierItem" parameterClass="Map" resultClass="Map">
        SELECT
            DISTINCT
                AD.MDSE_CD
               ,AD.VND_CD
        FROM
            ASL_HDR AH
           ,ASL_DTL AD
           ,(
             SELECT DISTINCT
                 AD.SPLY_ITEM_NUM
                ,AD.MDSE_CD
             FROM
                 ASL_DTL AD
             WHERE
                 AD.GLBL_CMPY_CD = #glblCmpyCd#
             AND AD.MDSE_CD      = #mdseCd#
             AND AD.VND_CD       = #vndCd#
             AND AD.EZCANCELFLAG = '0'
            ) SPLM
        WHERE
            AH.GLBL_CMPY_CD                     = #glblCmpyCd#
        AND AH.GLBL_CMPY_CD                     = AD.GLBL_CMPY_CD
        AND AH.ASL_HDR_PK                       = AD.ASL_HDR_PK
        AND AD.VND_CD                           = #vndCd#
        AND AD.SPLY_ITEM_NUM                    = SPLM.SPLY_ITEM_NUM
        AND AD.EFF_FROM_DT                  &lt;= #salesDate#
        AND NVL(AD.EFF_THRU_DT,'99999999')  &gt;= #salesDate#
        AND AH.ASL_START_DT                 &lt;= #salesDate#
        AND NVL(AH.ASL_END_DT,'99999999')   &gt;= #salesDate#
        AND AD.MDSE_CD                         != #mdseCd#
        AND AH.EZCANCELFLAG                     = '0'
        AND AD.EZCANCELFLAG                     = '0'
    </statement>
    <statement id="getDefPrchReqTpDaysNum" parameterClass="Map" resultClass="Map">
        SELECT
             PRT.DEF_PRCH_REQ_TP_DAYS_NUM
        FROM
            PRCH_REQ_TP PRT
        WHERE
                PRT.GLBL_CMPY_CD         = #glblCmpyCd#
            AND PRT.PRCH_REQ_TP_CD       = #prchReqTpCd#
            AND PRT.PRCH_REQ_REC_TP_CD   = #prchReqRecTpCd#
            AND PRT.EZCANCELFLAG = '0'
        ORDER BY
            PRT.PRCH_REQ_TP_SORT_NUM ASC
    </statement>
    
    <!-- QC#23726 Add SQL -->
    <statement id="getCarrSvcLvlCd" parameterClass="Map" resultClass="String">
        SELECT
            SCR.CARR_SVC_LVL_CD
        FROM
            SHPG_SVC_LVL_CARR_RELN SCR
        WHERE
            SCR.GLBL_CMPY_CD    = #glblCmpyCd#
        AND SCR.CARR_CD         = #carrCd#
        AND SCR.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
        AND SCR.EZCANCELFLAG    = '0'
        ORDER BY SCR.CARR_SVC_LVL_CD
    </statement>

    <!-- QC#23726 Add SQL -->
    <statement id="getDsAcctNum" parameterClass="Map" resultClass="String">
        SELECT
            STC.SELL_TO_CUST_CD AS DS_ACCT_NUM
        FROM
             PRCH_REQ PR
            , SHIP_TO_CUST STC
        where
            PR.GLBL_CMPY_CD     = #glblCmpyCd#
        AND PR.PRCH_REQ_NUM     = #prchReqNum#
        AND PR.EZCANCELFLAG     = '0'
        AND STC.GLBL_CMPY_CD    = PR.GLBL_CMPY_CD
        AND STC.SHIP_TO_CUST_CD = PR.SHIP_TO_CUST_CD
        AND STC.EZCANCELFLAG    = '0'
    </statement>

    <!-- QC#26990 Add SQL -->
    <statement id="getShipToAddressFromShipToCustomer" parameterClass="Map" resultClass="Map">
        SELECT
               STC.LOC_NM
              ,STC.ADDL_LOC_NM
              ,STC.FIRST_LINE_ADDR
              ,STC.SCD_LINE_ADDR
              ,STC.THIRD_LINE_ADDR
              ,STC.FRTH_LINE_ADDR
              ,STC.FIRST_LINE_ADDR
               || STC.SCD_LINE_ADDR
               || STC.THIRD_LINE_ADDR
               || STC.FRTH_LINE_ADDR AS ALL_SHIP_TO_LINE_ADDR
              ,STC.FIRST_LINE_ADDR || ' ' || STC.SCD_LINE_ADDR || ' ' || STC.THIRD_LINE_ADDR || ' ' || STC.FRTH_LINE_ADDR AS ALL_SHIP_TO_LINE_ADDR
              ,STC.CTRY_CD
              ,STC.POST_CD
              ,STC.CTY_ADDR
              ,STC.ST_CD
              ,STC.PROV_NM
              ,DAC.DS_ACCT_NM
              ,CTRY.CTRY_NM
              ,CNTY.CNTY_NM
        FROM
               SHIP_TO_CUST  STC
              ,SELL_TO_CUST  DAC
              ,CTRY          CTRY
              ,CNTY          CNTY
        WHERE
               STC.GLBL_CMPY_CD        = #glblCmpyCd#
           AND STC.SHIP_TO_CUST_CD     = #shipToCustCd#
           AND STC.GLBL_CMPY_CD        = CTRY.GLBL_CMPY_CD(+)
           AND STC.CTRY_CD             = CTRY.CTRY_CD(+)
           AND STC.GLBL_CMPY_CD        = CNTY.GLBL_CMPY_CD(+)
           AND STC.CNTY_PK             = CNTY.CNTY_PK(+)
           AND STC.GLBL_CMPY_CD        = DAC.GLBL_CMPY_CD
           AND STC.SELL_TO_CUST_CD     = DAC.SELL_TO_CUST_CD
           AND CTRY.EZCANCELFLAG(+)    = '0'
           AND STC.EZCANCELFLAG        = '0'
           AND CNTY.EZCANCELFLAG(+)    = '0'
           AND DAC.EZCANCELFLAG        = '0'
    </statement>
    <statement id="getRtlWhNm" parameterClass="Map" resultClass="Map">
        SELECT
            RW.RTL_WH_CD
           ,RW.RTL_WH_NM
           ,RSW.RTL_SWH_CD
           ,RSW.RTL_SWH_NM
           ,RW.ST_CD
           ,RW.POST_CD
           ,RW.RTL_WH_CATG_CD
        FROM
            RTL_WH  RW
           ,RTL_SWH RSW
        WHERE
            RW.GLBL_CMPY_CD                        = #glblCmpyCd#
        AND RW.RTL_WH_CD                           = #rtlWhCd#
        AND RW.EFF_FROM_DT                     &lt;= #salesDate#
        AND NVL(RW.EFF_THRU_DT, '99991231')    &gt;= #salesDate#
        AND RW.GLBL_CMPY_CD                        = RSW.GLBL_CMPY_CD(+)
        AND RW.RTL_WH_CD                           = RSW.RTL_WH_CD(+)
        AND RSW.PRTY_LOC_FLG(+)                    = #prtyLocFlg#
        AND RW.EZCANCELFLAG                        = '0'
        AND RSW.EZCANCELFLAG(+)                    = '0'
    </statement>
    
    <!-- QC#28941 Add SQL -->
    <statement id="getCarrierCd" parameterClass="Map" resultClass="Map">
        SELECT
            OCV.CARR_CD
        FROM
            OTBD_CARR_V OCV
        WHERE
            OCV.GLBL_CMPY_CD = #glblCmpyCd#
        AND OCV.CARR_NM  = #carrNm01#
        AND OCV.EZCANCELFLAG = '0'
    </statement>

     <statement id="gettShipToAddressFromS21Wh" parameterClass="Map" resultClass="Map">
        SELECT
            S.LOC_NM
            ,S.ADDL_LOC_NM
            ,S.FIRST_LINE_ADDR
            ,S.SCD_LINE_ADDR
            ,S.THIRD_LINE_ADDR
            ,S.FRTH_LINE_ADDR
            ,S.FIRST_REF_CMNT_TXT
            ,S.SCD_REF_CMNT_TXT
            ,S.CTY_ADDR
            ,S.ST_CD
            ,S.PROV_NM
            ,C.CNTY_NM
            ,S.POST_CD
            ,S.CTRY_CD
            ,CTRY.CTRY_NM
        FROM
             SHIP_TO_CUST S
            ,CNTY C
            ,CTRY CTRY
        WHERE
            S.GLBL_CMPY_CD           = #glblCmpyCd#
            AND S.SHIP_TO_CUST_CD    = #shipToCustCd#
            AND S.RGTN_STS_CD        = #rgtnStsCd#
            AND S.EZCANCELFLAG       = '0'
            AND S.GLBL_CMPY_CD       = C.GLBL_CMPY_CD(+)
            AND S.CNTY_PK            = C.CNTY_PK(+)
            AND C.EZCANCELFLAG(+)    = '0'
            AND CTRY.EZCANCELFLAG(+) = '0'
            AND S.GLBL_CMPY_CD       = CTRY.GLBL_CMPY_CD(+)
            AND S.CTRY_CD            = CTRY.CTRY_CD(+)
    </statement>

    <!-- QC#28939 Add SQL -->
    <statement id="getTextItemList" parameterClass="Map" resultClass="String">
        SELECT
            M.MDSE_CD
        FROM
             MDSE M
        WHERE
                M.GLBL_CMPY_CD       = #glblCmpyCd#
            AND M.MDSE_ITEM_TP_CD    = #mdseItemTpTextItem#
            AND M.EZCANCELFLAG       = '0'
        ORDER BY MDSE_CD ASC
   </statement>

   <!-- 2018/12/17 QC#29397 Add Start -->
    <statement id="checkPrntCmpySetMdse" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(1)
        FROM
            CMPSN         CMP
           ,ALL_MDSE_V    MDSE
        WHERE
            CMP.GLBL_CMPY_CD                     = #glblCmpyCd#
        AND CMP.PRNT_MDSE_CD                     = #mdseCd#
        <iterate property="mdseCmpsnTpCd_setMdse" var="mdseCmpsnTpCd_setMdse[]" open="AND CMP.MDSE_CMPSN_TP_CD IN (" close=") " conjunction=",">
            #mdseCmpsnTpCd_setMdse[]#
        </iterate>
        AND CMP.EFF_FROM_DT                      &lt;= #salesDate#
        AND NVL(CMP.EFF_THRU_DT, #effThruMaxDt#) &gt;= #salesDate#
        AND CMP.GLBL_CMPY_CD                     = MDSE.GLBL_CMPY_CD
        AND CMP.PRNT_MDSE_CD                     = MDSE.MDSE_CD
        AND MDSE.PRNT_CMPY_SET_MDSE_FLG          = 'N'
        AND CMP.EZCANCELFLAG                     = '0'
        AND MDSE.EZCANCELFLAG                    = '0'
    </statement>
    <!-- 2018/12/17 QC#29397 Add End -->

    <!-- 2019/01/11 QC#28709 Add Start -->
    <statement id="getAddrByPost" parameterClass="Map" resultClass="Map">
    SELECT DISTINCT
           P.CTY_ADDR
          ,P.ST_CD
          ,P.POST_CD
          ,C.CNTY_NM
      FROM 
           POST P
          ,CNTY_POST_RELN R
          ,CNTY C
     WHERE 
           P.GLBL_CMPY_CD    = #glblCmpyCd#
       AND P.POST_CD         = #postCd#
       AND P.GLBL_CMPY_CD    = R.GLBL_CMPY_CD(+)
       AND P.POST_PK         = R.POST_PK(+)
       AND R.GLBL_CMPY_CD    = C.GLBL_CMPY_CD(+)
       AND R.CNTY_PK         = C.CNTY_PK(+)
       AND P.EZCANCELFLAG    = '0'
       AND R.EZCANCELFLAG(+) = '0'
       AND C.EZCANCELFLAG(+) = '0'
     ORDER BY
           P.CTY_ADDR
          ,P.ST_CD
          ,P.POST_CD
          ,C.CNTY_NM
    </statement>
    <!-- 2019/01/11 QC#28709 Add End -->
    <!-- 2019/10/04 QC#53300 Add Start -->
    <statement id="getPrtVndNm" parameterClass="Map" resultClass="String">
        SELECT
            PV.PRNT_VND_NM
        FROM
            PRNT_VND PV
        WHERE
            PV.GLBL_CMPY_CD =  #glblCmpyCd#
        AND PV.PRNT_VND_CD  =  #prntVndCd#
        AND (PV.INAC_DT IS NULL 
              OR PV.INAC_DT > #salesDate#)
        AND PV.EZCANCELFLAG = '0'
    </statement>
    <statement id="getVendorInfo" parameterClass="Map" resultClass="Map">
        SELECT
             VND.VND_CD
            ,VND.LOC_NM
            ,VND.DEAL_CCY_CD
            ,VND.VND_PMT_TERM_DESC_TXT
            ,PV.PRNT_VND_CD
            ,PV.PRNT_VND_NM
        FROM
             VND      VND
            ,PRNT_VND PV
        WHERE
                VND.GLBL_CMPY_CD = #glblCmpyCd#
            AND VND.VND_CD       = #vndCd#
            AND VND.RGTN_STS_CD  = #rgtnStsCd#
            AND VND.GLBL_CMPY_CD  = PV.GLBL_CMPY_CD
            AND VND.PRNT_VND_PK   = PV.PRNT_VND_PK
            AND VND.EZCANCELFLAG = '0'
            AND PV.EZCANCELFLAG  = '0'
    </statement>
    <statement id="getShipToAddress" parameterClass="Map" resultClass="Map">
        SELECT
               STC.LOC_NM
              ,STC.ADDL_LOC_NM
              ,STC.FIRST_LINE_ADDR
              ,STC.SCD_LINE_ADDR
              ,STC.THIRD_LINE_ADDR
              ,STC.FRTH_LINE_ADDR
              --,STC.FIRST_LINE_ADDR
              -- || STC.SCD_LINE_ADDR
              -- || STC.THIRD_LINE_ADDR
              -- || STC.FRTH_LINE_ADDR AS ALL_SHIP_TO_LINE_ADDR
              ,STC.FIRST_LINE_ADDR || ' ' || STC.SCD_LINE_ADDR || ' ' || STC.THIRD_LINE_ADDR || ' ' || STC.FRTH_LINE_ADDR AS ALL_SHIP_TO_LINE_ADDR
              ,STC.CTRY_CD
              ,STC.POST_CD
              ,STC.CTY_ADDR
              ,STC.ST_CD
              ,STC.PROV_NM
              ,CTRY.CTRY_NM
              ,CNTY.CNTY_NM
        FROM
               SHIP_TO_CUST  STC
              ,CTRY          CTRY
              ,CNTY          CNTY
        WHERE
               STC.GLBL_CMPY_CD        = #glblCmpyCd#
           AND STC.SHIP_TO_CUST_CD     = #shipToCustCd#
           AND STC.GLBL_CMPY_CD        = CTRY.GLBL_CMPY_CD(+)
           AND STC.CTRY_CD             = CTRY.CTRY_CD(+)
           AND STC.GLBL_CMPY_CD        = CNTY.GLBL_CMPY_CD(+)
           AND STC.CNTY_PK             = CNTY.CNTY_PK(+)
           AND CTRY.EZCANCELFLAG(+)    = '0'
           AND STC.EZCANCELFLAG        = '0'
           AND CNTY.EZCANCELFLAG(+)    = '0'
    </statement>
    <statement id="countShipToCustAddr" parameterClass="Map" resultClass="BigDecimal">
        SELECT
               COUNT(*)
        FROM
               CSA_TRD_PTNR_LOC_X_REF_V  LOC_V
        WHERE
               LOC_V.GLBL_CMPY_CD      = #glblCmpyCd#
           AND LOC_V.TRD_PTNR_LOC_CD   = #shipToCustCd#
           AND LOC_V.EZCANCELFLAG      = '0'
    </statement>
    <!-- 2019/10/04 QC#53300 Add End -->

    <!-- 2022/10/31 QC#60604 Add Start -->
    <statement id="getCsaWhCount" parameterClass="Map" resultClass="BigDecimal">
        SELECT
               COUNT(*)
        FROM
            S21_CSA_APPS.RTL_WH RW
        WHERE 
            RW.GLBL_CMPY_CD     = #glblCmpyCd#
        AND RW.EZCANCELFLAG     = '0'
        AND RW.RTL_WH_CD        = #shipToCustCd#
        AND RW.WH_OWNR_CD       = #whOwnr#
    </statement>
    <!-- 2022/10/31 QC#60604 Add End -->

    <!-- START 2022/12/15 F.Fadriquela [QC#60917, ADD] -->
    <statement id="getHeaderFrghtInfo" parameterClass="Map" resultClass="Map">
        SELECT
            PRD.FRT_COND_CD AS FRT_COND_CD_HF
           ,PRD.SHPG_SVC_LVL_CD AS SHPG_SVC_LVL_CD_HF
           ,PRD.CARR_CD AS CARR_CD_HF
           ,PRD.CARR_ACCT_NUM AS CARR_ACCT_NUM_HF
           ,VND.LOC_NM AS LOC_NM_HF
        FROM
            PRCH_REQ_DTL PRD
           ,FRT_COND FC
           ,SHPG_SVC_LVL SSL
           ,VND VND
        WHERE
            PRD.GLBL_CMPY_CD          = #glblCmpyCd#
        AND PRD.PRCH_REQ_NUM          = #prchReqNum#
        <isNotNull property="prchReqLineStsCd">
            AND PRD.PRCH_REQ_LINE_STS_CD != #prchReqLineStsCd#
        </isNotNull>
        AND PRD.EZCANCELFLAG          = '0'
        -- LEFT JOIN TO FRT_COND
        AND PRD.GLBL_CMPY_CD          = FC.GLBL_CMPY_CD(+)
        AND PRD.FRT_COND_CD           = FC.FRT_COND_CD(+)
        AND FC.EZCANCELFLAG(+)        = '0'
        -- LEFT JOIN TO SHPG_SVC_LVL
        AND PRD.GLBL_CMPY_CD          = SSL.GLBL_CMPY_CD(+)
        AND PRD.SHPG_SVC_LVL_CD       = SSL.SHPG_SVC_LVL_CD(+)
        AND SSL.EZCANCELFLAG(+)       = '0'
        -- LEFT JOIN TO VND
        AND PRD.GLBL_CMPY_CD          = VND.GLBL_CMPY_CD(+)
        AND PRD.CARR_CD               = VND.VND_CD(+)
        AND VND.EZCANCELFLAG(+)        = '0'
        ORDER BY 
            PRD.EZUPTIME DESC
    </statement>
    <!-- END 2022/12/15 F.Fadriquela [QC#60917, ADD] -->

    <!-- 2024/3/4 QC#62443 Add Start -->
    <statement id="getCoaCcCd" parameterClass="Map" resultClass="String">
        SELECT
            LBT.COA_CC_CD
        FROM
            MDSE M
            ,LINE_BIZ_TP LBT
        WHERE
            M.GLBL_CMPY_CD      = #glblCmpyCd#
        AND M.MDSE_CD           = #mdseCd#
        AND M.GLBL_CMPY_CD      = LBT.GLBL_CMPY_CD
        AND M.LINE_BIZ_TP_CD    = LBT.LINE_BIZ_TP_CD
        AND M.EZCANCELFLAG      = '0'
        AND LBT.EZCANCELFLAG    = '0'
    </statement>
    <!-- 2024/3/4 QC#62443 Add End -->

</sqlMap>
