<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL0580Query">

    <statement id="getDSContractInfo" parameterClass="Map" resultClass="Map">
       SELECT
             
             DCS.DS_CONTR_NUM                              AS DS_CONTR_NUM
             ,DCS.DS_CONTR_CTRL_STS_CD                     AS DS_CONTR_CTRL_STS_CD
             ,DCS.DS_CONTR_CTRL_STS_NM                     AS DS_CONTR_CTRL_STS_NM
             ,DC.DS_CONTR_NM                               AS DS_CONTR_NM
             ,DC.DS_CONTR_STS_CD                           AS DS_CONTR_STS_CD
             ,DC.DS_CONTR_PK                               AS DS_CONTR_PK
             ,DC.EZUPTIME                                  AS DC_EZUPTIME
             ,DC.EZUPTIMEZONE                              AS DC_EZUPTIMEZONE
       FROM
              DS_CONTR_STS_V    DCS
             ,DS_CONTR          DC
       WHERE

             DCS.GLBL_CMPY_CD                              = #glblCmpyCd#
             AND DCS.DS_CONTR_PK                           = #dsContrPk#
             AND DCS.EZCANCELFLAG                          = '0'
             AND DC.GLBL_CMPY_CD                           = DCS.GLBL_CMPY_CD
             AND DC.DS_CONTR_PK                            = DCS.DS_CONTR_PK
             AND DC.EZCANCELFLAG                           = '0'
    </statement>

    <typeAlias alias="DS_CONTR_CTRL_STSTMsg" type="business.db.DS_CONTR_CTRL_STSTMsg"/>
    <statement id="getDSContractControlStatus" parameterClass="Map" resultMap="result.DS_CONTR_CTRL_STSTMsg">
       SELECT
               DCCS.DS_CONTR_STS_CD                        AS DS_CONTR_STS_CD
              ,DCCS.DS_CONTR_DTL_STS_CD                    AS DS_CONTR_DTL_STS_CD
              ,DCCS.QLTY_ASRN_HLD_FLG                      AS QLTY_ASRN_HLD_FLG
              ,DCCS.MTR_HLD_FLG                            AS MTR_HLD_FLG
              ,DCCS.CONTR_HLD_FLG                          AS CONTR_HLD_FLG
              ,DCCS.BLLG_HLD_FLG                           AS BLLG_HLD_FLG

       FROM
              DS_CONTR_CTRL_STS DCCS
       WHERE
             DCCS.GLBL_CMPY_CD                              = #glblCmpyCd#
             AND DCCS.DS_CONTR_CTRL_STS_CD                  = #dsContrCtrlStsCd#
             AND DCCS.EZCANCELFLAG                          = '0'
    </statement>

    <resultMap id="result.DS_CONTR_CTRL_STSTMsg"  class="DS_CONTR_CTRL_STSTMsg">
           <result property="dsContrStsCd"        column="DS_CONTR_STS_CD"         javaType="EZDTStringItem"/>
           <result property="dsContrDtlStsCd"     column="DS_CONTR_DTL_STS_CD"     javaType="EZDTStringItem"/>
           <result property="qltyAsrnHldFlg"      column="QLTY_ASRN_HLD_FLG"       javaType="EZDTStringItem"/>
           <result property="mtrHldFlg"           column="MTR_HLD_FLG"             javaType="EZDTStringItem"/>
           <result property="contrHldFlg"         column="CONTR_HLD_FLG"           javaType="EZDTStringItem"/>
           <result property="bllgHldFlg"          column="BLLG_HLD_FLG"            javaType="EZDTStringItem"/>
    </resultMap>

    <statement id="getDSContractDetail" parameterClass="Map" resultClass="Map">
       SELECT
               DC.DS_CONTR_PK                               AS DS_CONTR_PK
              ,DCD.DS_CONTR_DTL_PK                          AS DS_CONTR_DTL_PK	
              ,DCBM.DS_CONTR_BLLG_MTR_PK                    AS DS_CONTR_BLLG_MTR_PK
              ,DCPE.DS_CONTR_PRC_EFF_PK                     AS DS_CONTR_PRC_EFF_PK
              ,DC.EZUPTIME                                  AS DC_EZUPTIME
              ,DC.EZUPTIMEZONE                              AS DC_EZUPTIMEZONE
              ,DCD.EZUPTIME                                 AS DCD_EZUPTIME
              ,DCD.EZUPTIMEZONE                             AS DCD_EZUPTIMEZONE

       FROM
              DS_CONTR DC
              ,DS_CONTR_DTL DCD
              ,DS_CONTR_BLLG_MTR DCBM
              ,DS_CONTR_PRC_EFF DCPE
       WHERE

             DC.GLBL_CMPY_CD                               = #glblCmpyCd#
             AND DC.DS_CONTR_PK                            = #dsContrPk#
             AND DC.EZCANCELFLAG                           = '0'
             AND DCD.GLBL_CMPY_CD                          = DC.GLBL_CMPY_CD
             AND DCD.DS_CONTR_PK                           = DC.DS_CONTR_PK
             AND DCD.EZCANCELFLAG                          = '0'
             AND DCBM.GLBL_CMPY_CD                         = DCD.GLBL_CMPY_CD
             AND DCBM.DS_CONTR_DTL_PK                      = DCD.DS_CONTR_DTL_PK
             AND DCBM.EZCANCELFLAG                         = '0'
             AND DCPE.GLBL_CMPY_CD                         = DCD.GLBL_CMPY_CD
             AND DCPE.DS_CONTR_DTL_PK                      = DCD.DS_CONTR_DTL_PK
             AND DCPE.EZCANCELFLAG                         = '0'
    </statement>

    <statement id="getSvcMemo" parameterClass="Map" resultClass="Map">
       SELECT
             GLBL_CMPY_CD
             ,SVC_MEMO_PK
       FROM
              SVC_MEMO
       WHERE

             GLBL_CMPY_CD                                  = #glblCmpyCd#
             AND DS_CONTR_PK                               = #dsContractPk#
             AND DS_CONTR_DTL_PK                           IS NULL
             AND SVC_MEMO_CATG_CD                          = #ContractMemo#
             AND SVC_MEMO_TP_CD                            = #StatusChange#
             AND EZCANCELFLAG                              = '0'
    </statement>

    <statement id="getContrDtlList" parameterClass="Map" resultClass="Map">
       SELECT
            DS_CONTR_DTL_PK
           ,DS_CONTR_CTRL_STS_CD
           ,DS_CONTR_STS_CD

       FROM
            DS_CONTR_DTL_STS_V  A
       WHERE
                 A.GLBL_CMPY_CD                            = #glblCmpyCd#
             AND A.DS_CONTR_PK                             = #dsContrPk#
             AND A.EZCANCELFLAG                            = '0'
    </statement>
    <statement id="getBllgMtrList" parameterClass="Map" resultClass="Map">
       SELECT
            DS_CONTR_BLLG_MTR_PK
           ,DS_CONTR_CTRL_STS_CD
           ,DS_CONTR_STS_CD

       FROM
            DS_CONTR_BLLG_MTR_STS_V  A
       WHERE
                 A.GLBL_CMPY_CD                            = #glblCmpyCd#
             AND A.DS_CONTR_DTL_PK                         = #dsContrDtlPk#
             AND A.EZCANCELFLAG                            = '0'
    </statement>
    <statement id="getPrcEffList" parameterClass="Map" resultClass="Map">
       SELECT
            DS_CONTR_PRC_EFF_PK
           ,DS_CONTR_CTRL_STS_CD
           ,DS_CONTR_STS_CD

       FROM
            DS_CONTR_PRC_EFF_STS_V  A
       WHERE
                 A.GLBL_CMPY_CD                            = #glblCmpyCd#
             AND A.DS_CONTR_DTL_PK                         = #dsContrDtlPk#
             AND A.EZCANCELFLAG                            = '0'
    </statement>
    <!-- START 2018/08/26 [QC#22987,ADD] -->
    <statement id="getUnapprovedUsgChrg" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.SVC_CONTR_BLLG_PK
        FROM
            SVC_CONTR_BLLG A
        WHERE
                A.EZCANCELFLAG       = '0'
            AND A.GLBL_CMPY_CD       = #glblCmpyCd#
            AND A.DS_CONTR_PK        = #dsContrPk#
            AND A.BLLG_CPLT_STS_CD   = #bllgCpltStsCd#
            AND A.BLLG_APVL_REQ_FLG  = 'Y'
            AND A.BLLG_APVL_CPLT_FLG = 'N'
            AND A.USG_CHRG_FLG       = 'Y'
    </statement>
    <statement id="getUnapprovedCrRebil" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.SVC_CR_REBIL_PK
        FROM
             SVC_CR_REBIL             A
            ,SVC_CR_REBIL_DTL         B
        WHERE
                A.GLBL_CMPY_CD       = #glblCmpyCd#
            <iterate property="svcCrRebilStsCdList" var="svcCrRebilStsCd[]" open="AND A.SVC_CR_REBIL_STS_CD NOT IN (" conjunction= ", " close=")">
            #svcCrRebilStsCd[]#
            </iterate>
            AND A.EZCANCELFLAG       = '0'
            AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD
            AND A.SVC_CR_REBIL_PK    = B.SVC_CR_REBIL_PK
            AND B.DS_CONTR_PK        = #dsContrPk#
            AND B.EZCANCELFLAG       = '0'
        GROUP BY
            A.SVC_CR_REBIL_PK
    </statement>
    <!-- END 2018/08/26 [QC#22987,ADD] -->

    <!-- add start 2019/07/18 QC#51706 -->
    <statement id="getSvcMemoForManBllgHld" parameterClass="Map" resultClass="BigDecimal">
       SELECT
           A.SVC_MEMO_PK
       FROM
           SVC_MEMO A
       WHERE
               A.GLBL_CMPY_CD       = #glblCmpyCd#
           AND A.DS_CONTR_PK        = #dsContrPk#
           AND A.SVC_MEMO_CATG_CD   = #svcMemoCatgCd#
           AND A.SVC_MEMO_TP_CD     = #svcMemoTpCd#
           AND A.SVC_MEMO_RSN_CD    = #svcMemoRsnCd#
           AND A.EZCANCELFLAG       = '0'
    </statement>
    <!-- add end 2019/07/18 QC#51706 -->
</sqlMap>
