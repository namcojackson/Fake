<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<sqlMap namespace="NSZC064001">

    <statement id="getMachineSupplyOrderCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                  count(*) AS CNT
        FROM
                 CPO C
        WHERE
             C.GLBL_CMPY_CD                      = #glblCmpyCd#
             AND C.CPO_ORD_NUM            &lt;&gt; #cpoOrdNum#
             AND C.ORD_HDR_STS_CD                = #cpoHdrStsCd#
             AND C.EZCANCELFLAG                  = '0'
             AND EXISTS
             ( SELECT * FROM CPO_DTL CD
               WHERE
               CD.GLBL_CMPY_CD                   = C.GLBL_CMPY_CD
               AND CD.CPO_ORD_NUM                = C.CPO_ORD_NUM
               AND CD.SVC_MACH_MSTR_PK           = #svcMachMstrPk#
<!-- add start 2019/01/15 QC#29917 -->
               AND CD.MDSE_CD                    = #mdseCd#
<!-- add end 2019/01/15 QC#29917 -->
               AND CD.EZCANCELFLAG               = '0'
             )
             AND EXISTS
             ( SELECT * FROM SVC_SPLY_ORD_TP_RELN SSOTR
               WHERE
               SSOTR.GLBL_CMPY_CD                = C.GLBL_CMPY_CD
               AND SSOTR.DS_ORD_TP_CD            = C.DS_ORD_TP_CD
               AND SSOTR.EZCANCELFLAG            = '0'
             )
 
     </statement>
<!-- START 2016/09/28 A.Kohinata [QC#12898, ADD] -->
    <statement id="getFleetSupplyOrderCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             CPO    C
        WHERE
                C.GLBL_CMPY_CD          = #glblCmpyCd#
            AND C.CPO_ORD_NUM    &lt;&gt; #cpoOrdNum#
            AND C.ORD_HDR_STS_CD        = #cpoHdrStsCd#
            AND C.EZCANCELFLAG          = '0'
            AND EXISTS (
                SELECT
                    1
                FROM
                    CPO_DTL CD
                WHERE
                        CD.GLBL_CMPY_CD    = C.GLBL_CMPY_CD
                    AND CD.CPO_ORD_NUM     = C.CPO_ORD_NUM
                    AND CD.DS_CONTR_NUM    = #dsContrNum#
<!-- add start 2019/01/15 QC#29917 -->
                    AND CD.MDSE_CD         = #mdseCd#
<!-- add end 2019/01/15 QC#29917 -->
                    AND CD.EZCANCELFLAG    = '0'
            )
            AND EXISTS (
                SELECT
                    1
                FROM
                    SVC_SPLY_ORD_TP_RELN SSOTR
                WHERE
                        SSOTR.GLBL_CMPY_CD = C.GLBL_CMPY_CD
                    AND SSOTR.DS_ORD_TP_CD = C.DS_ORD_TP_CD
                    AND SSOTR.EZCANCELFLAG = '0'
            )
    </statement>
<!-- END 2016/09/28 A.Kohinata [QC#12898, ADD] -->

</sqlMap>
