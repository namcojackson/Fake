<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLCB112001">

    <statement id="getTrgtYrMth" parameterClass="Map" resultClass="String">
        SELECT
            CAL.DWH_TRGT_YR_MTH
        FROM
            DMN_RPT_CAL            CAL
        WHERE
            CAL.GLBL_CMPY_CD       = #glblCmpyCd#
        AND CAL.DWH_TRGT_DT        = #trgtDt#
        AND CAL.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getTrgtYrMthRec" parameterClass="Map" resultClass="BigDecimal">
        SELECT COUNT(1)
        FROM
            FCT_PRT_KPI              FPK
        WHERE
            FPK.GLBL_CMPY_CD         = #glblCmpyCd#
        AND FPK.DWH_TRGT_YR_MTH      = #trgtYrMth#
        AND FPK.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getCalTpCd" parameterClass="Map" resultClass="Map">
        SELECT
            RCC.RPT_COND_CONST_VAL_TXT_04 AS CAL_TP_CD
           ,RCC.RPT_COND_CONST_CD         AS CARR_CD
        FROM
            RPT_COND_CONST                RCC
        WHERE
            RCC.GLBL_CMPY_CD              = #glblCmpyCd#
        AND RCC.RPT_COND_CONST_GRP_ID     = #rptCndCnstGrpId#
        AND RCC.EZCANCELFLAG              = '0'
    </statement>

    <statement id="getNonOperationDays" parameterClass="Map" resultClass="BigDecimal">
        SELECT COUNT(1)
        FROM
            CAL                      CAL
        WHERE
            CAL.GLBL_CMPY_CD         = #glblCmpyCd#
        AND CAL.CAL_TP_CD            = #calTpCd#
        AND CAL.CAL_DT               &gt; #calDtFrom#
        AND CAL.CAL_DT               &lt; #calDtTo#
        AND CAL.DT_ATTRB_VAL_CD      = '0'
        AND CAL.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getTrgtDt" parameterClass="Map" resultClass="Map">
        SELECT
            RCC.RPT_COND_CONST_VAL_NUM_01 AS TRGT_DT
           ,RCC.RPT_COND_CONST_CD         AS SVC_LVL
        FROM
            RPT_COND_CONST                RCC
        WHERE
            RCC.GLBL_CMPY_CD              = #glblCmpyCd#
        AND RCC.RPT_COND_CONST_GRP_ID     = #rptCndCnstGrpId#
        AND RCC.EZCANCELFLAG              = '0'
    </statement>

    <statement id="getMainData" parameterClass="Map" resultClass="Map">
        SELECT
            PR.PRCH_REQ_NUM
           ,PRD1.PRCH_REQ_LINE_NUM
           ,PRD1.PRCH_REQ_LINE_SUB_NUM
           ,PRD1.SO_NUM
           ,SOCD.MDSE_CD
           ,PRD1.PRCH_REQ_LINE_TP_CD
           ,PR.PRCH_REQ_TP_CD
           ,RS1.RTL_WH_CATG_CD
           ,PR.RQST_TECH_TOC_CD                                            AS TECH_TOC_CD
           ,RS1.RTL_WH_CD                                                  AS SHIP_TO_RTL_WH_CD
           ,RS2.RTL_WH_CD                                                  AS SHIP_FROM_RTL_WH_CD
           ,PRD2.SRC_RTL_WH_CD
           ,PRD2.DEST_RTL_WH_CD
           ,SOCD.VND_CD                                                    AS CARR_CD
           ,SP.ACTL_SHPG_SVC_LVL_CD                                        AS SHPG_SVC_LVL_CD
           ,NVL(SOCD.TOT_FRT_AMT, 0)                                       AS SHIP_FRT_AMT
           ,PRD1.PRCH_REQ_CRAT_DT                                          AS CRAT_DT
           ,PRD1.PRCH_REQ_CRAT_TM                                          AS CRAT_TM
           ,SUBSTR(AHI.APVL_HIST_INFO_TS, 0, #substrDtLngth#)              AS PRCH_REQ_APVL_DT
           ,SUBSTR(AHI.APVL_HIST_INFO_TS, #substrTmFrom#, #substrTmLngth#) AS PRCH_REQ_APVL_TM
           ,SUBSTR(SO.SO_CRAT_TS, 0, #substrDtLngth#)                      AS WMS_INTFC_DT
           ,SUBSTR(SO.SO_CRAT_TS, #substrTmFrom#, #substrTmLngth#)         AS WMS_INTFC_TM
           ,SUBSTR(PKT.PKT_STS_TS, 0, #substrDtLngth#)                     AS WH_PICK_DT
           ,SUBSTR(PKT.PKT_STS_TS, #substrTmFrom#, #substrTmLngth#)        AS WH_PICK_TM
           ,SUBSTR(PRD1.SHIP_DT_TM_TS, 0, #substrDtLngth#)                 AS SHIP_DT
           ,SUBSTR(PRD1.SHIP_DT_TM_TS, #substrTmFrom#, #substrTmLngth#)    AS SHIP_TM
           ,POD1.POD_STS_DT                                                AS CARR_PICK_UP_DT
           ,POD1.POD_STS_TM                                                AS CARR_PICK_UP_TM
           ,POD2.POD_STS_DT                                                AS CARR_AT_DEST_DT
           ,POD2.POD_STS_TM                                                AS CARR_AT_DEST_TM
           ,POD3.POD_STS_DT                                                AS DELY_DT
           ,POD3.POD_STS_TM                                                AS DELY_TM
           ,SUBSTR(RPA.RWS_STK_DT_TM_TS, 0, #substrDtLngth#)               AS RCV_DT
           ,SUBSTR(RPA.RWS_STK_DT_TM_TS, #substrTmFrom#, #substrTmLngth#)  AS RCV_TM
           ,PR.FSR_NUM
           ,PR.SVC_TASK_NUM
        FROM
            PRCH_REQ          PR
           ,PRCH_REQ_DTL      PRD1
           ,PRCH_REQ_DTL      PRD2
           ,RWS_DTL           RD
           ,RWS_PUT_AWAY      RPA
           ,SHPG_ORD          SO
           ,SHPG_ORD_DTL      SOD
           ,SHPG_ORD_CONF_DTL SOCD
           ,SHPG_PLN          SP
           ,PKT               PKT
           ,POD               POD1
           ,POD               POD2
           ,POD               POD3
           ,APVL_HIST_INFO    AHI
           ,RTL_SWH           RS1
           ,RTL_SWH           RS2
           ,RPT_COND_CONST    RCC
        WHERE
            PR.GLBL_CMPY_CD                    = #glblCmpyCd#
        AND PR.GLBL_CMPY_CD                    = PRD1.GLBL_CMPY_CD
        AND PR.PRCH_REQ_NUM                    = PRD1.PRCH_REQ_NUM
        AND PRD1.PRCH_REQ_LINE_SUB_NUM         != '0'
        AND PR.PRCH_REQ_TP_CD in (#prchRqLnSbNm1#,#prchRqLnSbNm2#,#prchRqLnSbNm3#,#prchRqLnSbNm4#,#prchRqLnSbNm5# )
        AND PRD1.GLBL_CMPY_CD                  = PRD2.GLBL_CMPY_CD
        AND PRD1.PRCH_REQ_NUM                  = PRD2.PRCH_REQ_NUM
        AND PRD1.PRCH_REQ_LINE_NUM             = PRD2.PRCH_REQ_LINE_NUM
        AND PRD2.PRCH_REQ_LINE_SUB_NUM         = '0'
        AND RD.GLBL_CMPY_CD                    = PRD1.GLBL_CMPY_CD
        AND RD.PRCH_REQ_NUM                    = PRD1.PRCH_REQ_NUM
        AND RD.PRCH_REQ_LINE_NUM               = PRD1.PRCH_REQ_LINE_NUM 
        AND RD.PRCH_REQ_LINE_SUB_NUM           = PRD1.PRCH_REQ_LINE_SUB_NUM
        AND RPA.GLBL_CMPY_CD                   = RD.GLBL_CMPY_CD
        AND RPA.RWS_NUM                        = RD.RWS_NUM
        AND RPA.RWS_DTL_LINE_NUM               = RD.RWS_DTL_LINE_NUM
        AND SUBSTR(RPA.RWS_STK_DT_TM_TS, 0, #substrTrgtYrMthLngth#) = #trgtYrMth#
        AND PRD1.GLBL_CMPY_CD                  = SO.GLBL_CMPY_CD
        AND PRD1.SO_NUM                        = SO.SO_NUM
        AND SO.GLBL_CMPY_CD                    = SOD.GLBL_CMPY_CD
        AND SO.SO_NUM                          = SOD.SO_NUM
        AND SOCD.GLBL_CMPY_CD                  = SOD.GLBL_CMPY_CD
        AND SOCD.SO_NUM                        = SOD.SO_NUM
        AND SOCD.SO_SLP_NUM                    = SOD.SO_SLP_NUM
        AND SP.GLBL_CMPY_CD                    = SOD.GLBL_CMPY_CD
        AND SP.SO_NUM                          = SOD.SO_NUM
        AND SP.SO_SLP_NUM                      = SOD.SO_SLP_NUM
        AND PKT.GLBL_CMPY_CD(+)                = SOCD.GLBL_CMPY_CD
        AND PKT.SO_NUM(+)                      = SOCD.SO_NUM
        AND PKT.SO_SLP_NUM(+)                  = SOCD.SO_SLP_NUM
        AND RCC.RPT_COND_CONST_GRP_ID          = #rptCondConstGrpId#
        AND RCC.RPT_COND_CONST_CD              = SOCD.VND_CD
        AND POD1.GLBL_CMPY_CD(+)               = SOCD.GLBL_CMPY_CD
        AND POD1.CARR_CD(+)                    = SOCD.VND_CD
        AND POD1.PRO_NUM(+)                    = SOCD.PRO_NUM
        AND POD1.POD_STS_CD(+)                 = RCC.RPT_COND_CONST_VAL_TXT_01
        AND POD2.GLBL_CMPY_CD(+)               = SOCD.GLBL_CMPY_CD
        AND POD2.CARR_CD(+)                    = SOCD.VND_CD
        AND POD2.PRO_NUM(+)                    = SOCD.PRO_NUM
        AND POD2.POD_STS_CD(+)                 = RCC.RPT_COND_CONST_VAL_TXT_02
        AND POD3.GLBL_CMPY_CD(+)               = SOCD.GLBL_CMPY_CD
        AND POD3.CARR_CD(+)                    = SOCD.VND_CD
        AND POD3.PRO_NUM(+)                    = SOCD.PRO_NUM
        AND POD3.POD_STS_CD(+)                 = RCC.RPT_COND_CONST_VAL_TXT_03
        AND AHI.GLBL_CMPY_CD(+)                = PR.GLBL_CMPY_CD
        AND AHI.TRX_REF_NUM(+)                 = PR.PRCH_REQ_NUM
        AND AHI.APVL_HIST_ACT_TP_CD(+)         = #apvlHistActTpCd#
        AND RS1.GLBL_CMPY_CD                   = SOD.GLBL_CMPY_CD
        AND RS1.INVTY_LOC_CD                   = SOD.TO_INVTY_LOC_CD
        AND RS2.GLBL_CMPY_CD                   = SOD.GLBL_CMPY_CD
        AND RS2.INVTY_LOC_CD                   = SOD.INVTY_LOC_CD
        AND PR.EZCANCELFLAG                    = '0'
        AND PRD1.EZCANCELFLAG                  = '0'
        AND PRD2.EZCANCELFLAG                  = '0'
        AND RD.EZCANCELFLAG                    = '0'
        AND RPA.EZCANCELFLAG                   = '0'
        AND SO.EZCANCELFLAG                    = '0'
        AND SOD.EZCANCELFLAG                   = '0'
        AND SOCD.EZCANCELFLAG                  = '0'
        AND SP.EZCANCELFLAG                    = '0'
        AND PKT.EZCANCELFLAG(+)                = '0'
        AND POD1.EZCANCELFLAG(+)               = '0'
        AND POD2.EZCANCELFLAG(+)               = '0'
        AND POD3.EZCANCELFLAG(+)               = '0'
        AND AHI.EZCANCELFLAG(+)                = '0'
        AND RS1.EZCANCELFLAG                   = '0'
        AND RS2.EZCANCELFLAG                   = '0'
        AND RCC.EZCANCELFLAG                   = '0'
    </statement>

</sqlMap>
