<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL2720Query">

    <typeAlias alias="NMAL2720CMsg"    type="business.blap.NMAL2720.NMAL2720CMsg"/>
    <typeAlias alias="NMAL2720_ACMsg"  type="business.blap.NMAL2720.NMAL2720_ACMsg"/>

    <statement id="getBizArea" parameterClass="Map" resultClass="Map">
        SELECT BAO.BIZ_AREA_ORG_CD
             , BAO.BIZ_AREA_ORG_DESC_TXT
          FROM BIZ_AREA_ORG BAO
             , ORG_STRU_TP  OST
         WHERE BAO.GLBL_CMPY_CD = #glblCmpyCd#
           AND BAO.EZCANCELFLAG = '0'
           AND BAO.GLBL_CMPY_CD = OST.GLBL_CMPY_CD
           AND BAO.EZCANCELFLAG = OST.EZCANCELFLAG
           AND BAO.ORG_STRU_TP_CD = OST.ORG_STRU_TP_CD
           AND OST.TRTY_STRU_FLG = #flgN#
         ORDER BY BAO.BIZ_AREA_ORG_SORT_NUM
    </statement>

    <statement id="getPsnNum" parameterClass="Map" resultClass="Map">
        SELECT PSN.PSN_NUM
          FROM S21_PSN    PSN
         WHERE PSN.GLBL_CMPY_CD             = #glblCmpyCd#
           AND PSN.EZCANCELFLAG             = '0'
           AND (UPPER(PSN.PSN_LAST_NM)  = UPPER(#psnNm#)
                OR UPPER(PSN.PSN_FIRST_NM) = UPPER(#psnNm#)
                OR UPPER(PSN.PSN_FIRST_NM) || ' ' || UPPER(PSN.PSN_LAST_NM) = UPPER(#psnNm#)
               )
        </statement>

    <statement id="search" parameterClass="Map" resultMap="result.NMAL2720_ACMsg">
        SELECT DOU.ORG_CD
             , DOU.ORG_NM
             , DOU.ORG_DESC_TXT
             , BAO.BIZ_AREA_ORG_CD
             , BAO.BIZ_AREA_ORG_DESC_TXT
             , OFRT.ORG_FUNC_ROLE_TP_DESC_TXT
             , OFA.EFF_FROM_DT
             , OFA.EFF_THRU_DT
             , PSN.PSN_NUM
             , PSN.PSN_FIRST_NM || ' ' || PSN.PSN_LAST_NM  PSN_NM
             , PSN.LINE_BIZ_TP_CD
             , LBT.LINE_BIZ_TP_DESC_TXT
             , OTCR.TOC_CD
          FROM DS_ORG_UNIT       DOU
             , ORG_STRU_TP       OST
             , BIZ_AREA_ORG      BAO
             , TOC_ORG_STRU_RELN TOSR
             , ORG_TOC_CHNG_RQST OTCR
             , ORG_FUNC_ROLE_TP  OFRT
             , ORG_FUNC_ASG      OFA
             , S21_PSN           PSN
             , LINE_BIZ_TP       LBT
         WHERE DOU.GLBL_CMPY_CD = #glblCmpyCd#
           AND DOU.EZCANCELFLAG = '0'
           <isNotNull property="orgNm">
           AND DOU.ORG_NM LIKE #orgNm#
           </isNotNull>
           AND DOU.GLBL_CMPY_CD = OST.GLBL_CMPY_CD
           AND DOU.EZCANCELFLAG = OST.EZCANCELFLAG
           AND DOU.ORG_STRU_TP_CD = OST.ORG_STRU_TP_CD
           AND OST.TRTY_STRU_FLG = #flgN#
           AND DOU.GLBL_CMPY_CD = BAO.GLBL_CMPY_CD
           AND DOU.EZCANCELFLAG = BAO.EZCANCELFLAG
           AND DOU.ORG_STRU_TP_CD = BAO.ORG_STRU_TP_CD
           AND DOU.FIRST_ORG_CD = BAO.BIZ_AREA_ORG_CD
           <isNotNull property="bizAreaOrgCd">
           AND BAO.BIZ_AREA_ORG_CD = #bizAreaOrgCd#
           </isNotNull>
           AND DOU.GLBL_CMPY_CD = TOSR.GLBL_CMPY_CD
           AND DOU.EZCANCELFLAG = TOSR.EZCANCELFLAG
           AND DOU.ORG_STRU_TP_CD = TOSR.ORG_STRU_TP_CD
           AND DOU.ORG_CD         = TOSR.ORG_CD
           AND TOSR.GLBL_CMPY_CD = OTCR.GLBL_CMPY_CD
           AND TOSR.EZCANCELFLAG = OTCR.EZCANCELFLAG
           AND TOSR.TOC_CD       = OTCR.TOC_CD
           AND TOSR.ORG_CD       = OTCR.ORG_CD
           AND OTCR.GLBL_CMPY_CD = OFRT.GLBL_CMPY_CD
           AND OTCR.EZCANCELFLAG = OFRT.EZCANCELFLAG
           AND OTCR.ORG_FUNC_ROLE_TP_CD = OFRT.ORG_FUNC_ROLE_TP_CD
           AND OFRT.ACTV_FLG     = #flgY#
           AND OTCR.GLBL_CMPY_CD = OFA.GLBL_CMPY_CD
           AND OTCR.EZCANCELFLAG = OFA.EZCANCELFLAG
           AND OTCR.TOC_CD       = OFA.TOC_CD
           AND OFA.GNRN_TP_CD   IN (#gnrnTpCdCur#, #gnrnTpCdFut#)
           AND OFA.GLBL_CMPY_CD  = PSN.GLBL_CMPY_CD
           AND OFA.EZCANCELFLAG  = PSN.EZCANCELFLAG
           AND OFA.PSN_CD        = PSN.PSN_CD
           <isNotNull property="psnCd">
           AND PSN.PSN_CD     LIKE #psnCd#
           </isNotNull>
           <isNotNull property="psnNum">
           AND PSN.PSN_NUM    LIKE #psnNum#
           </isNotNull>
           <isNotNull property="psnNm">
           AND UPPER(PSN.PSN_FIRST_NM) || ' ' || UPPER(PSN.PSN_LAST_NM) LIKE UPPER(#psnNm#)
           </isNotNull>
           AND PSN.GLBL_CMPY_CD   = LBT.GLBL_CMPY_CD(+)
           AND PSN.EZCANCELFLAG   = LBT.EZCANCELFLAG(+)
           AND PSN.LINE_BIZ_TP_CD = LBT.LINE_BIZ_TP_CD(+)
           AND ROWNUM &lt;= #rowNum#
         ORDER BY PSN.PSN_FIRST_NM
                , PSN.PSN_LAST_NM
                , OFRT.ORG_FUNC_ROLE_TP_DESC_TXT
                , DOU.ORG_NM
    </statement>

    <resultMap id="result.NMAL2720_ACMsg" class="NMAL2720_ACMsg">
        <result property="orgCd_A1"                column="ORG_CD"                     javaType="EZDCStringItem"/>
        <result property="orgNm_A1"                column="ORG_NM"                     javaType="EZDCStringItem"/>
        <result property="orgDescTxt_A1"           column="ORG_DESC_TXT"               javaType="EZDCStringItem"/>
        <result property="bizAreaOrgCd_A1"         column="BIZ_AREA_ORG_CD"            javaType="EZDCStringItem"/>
        <result property="bizAreaOrgDescTxt_A1"    column="BIZ_AREA_ORG_DESC_TXT"      javaType="EZDCStringItem"/>
        <result property="lineBizTpDescTxt_A1"     column="LINE_BIZ_TP_DESC_TXT"       javaType="EZDCStringItem"/>
        <result property="xxPsnNm_A1"              column="PSN_NM"                     javaType="EZDCStringItem"/>
        <result property="psnNum_A1"               column="PSN_NUM"                    javaType="EZDCStringItem"/>
        <result property="orgFuncRoleTpDescTxt_A1" column="ORG_FUNC_ROLE_TP_DESC_TXT"  javaType="EZDCStringItem"/>
        <result property="effFromDt_A1"            column="EFF_FROM_DT"                javaType="EZDCDateItem"/>
        <result property="effThruDt_A1"            column="EFF_THRU_DT"                javaType="EZDCDateItem"/>
        <result property="tocCd_A1"                column="TOC_CD"                     javaType="EZDCStringItem"/>
    </resultMap>

    <statement id="getDownloadRecord" parameterClass="Map" resultClass="Map">
        SELECT DOU.ORG_NM
             , DOU.ORG_DESC_TXT
             , BAO.BIZ_AREA_ORG_DESC_TXT
             , OFRT.ORG_FUNC_ROLE_TP_DESC_TXT
             , OFA.EFF_FROM_DT
             , OFA.EFF_THRU_DT
             , PSN.PSN_NUM
             , PSN.PSN_FIRST_NM || ' ' || PSN.PSN_LAST_NM  PSN_NM
             , PSN.LINE_BIZ_TP_CD
             , LBT.LINE_BIZ_TP_DESC_TXT
          FROM DS_ORG_UNIT       DOU
             , ORG_STRU_TP       OST
             , BIZ_AREA_ORG      BAO
             , TOC_ORG_STRU_RELN TOSR
             , ORG_TOC_CHNG_RQST OTCR
             , ORG_FUNC_ROLE_TP  OFRT
             , ORG_FUNC_ASG      OFA
             , S21_PSN           PSN
             , LINE_BIZ_TP       LBT
         WHERE DOU.GLBL_CMPY_CD = #glblCmpyCd#
           AND DOU.EZCANCELFLAG = '0'
           <isNotNull property="orgNm">
           AND DOU.ORG_NM LIKE #orgNm#
           </isNotNull>
           AND DOU.GLBL_CMPY_CD = OST.GLBL_CMPY_CD
           AND DOU.EZCANCELFLAG = OST.EZCANCELFLAG
           AND DOU.ORG_STRU_TP_CD = OST.ORG_STRU_TP_CD
           AND OST.TRTY_STRU_FLG = #flgN#
           AND DOU.GLBL_CMPY_CD = BAO.GLBL_CMPY_CD
           AND DOU.EZCANCELFLAG = BAO.EZCANCELFLAG
           AND DOU.ORG_STRU_TP_CD = BAO.ORG_STRU_TP_CD
           AND DOU.FIRST_ORG_CD = BAO.BIZ_AREA_ORG_CD
           <isNotNull property="bizAreaOrgCd">
           AND BAO.BIZ_AREA_ORG_CD = #bizAreaOrgCd#
           </isNotNull>
           AND DOU.GLBL_CMPY_CD = TOSR.GLBL_CMPY_CD
           AND DOU.EZCANCELFLAG = TOSR.EZCANCELFLAG
           AND DOU.ORG_STRU_TP_CD = TOSR.ORG_STRU_TP_CD
           AND DOU.ORG_CD         = TOSR.ORG_CD
           AND TOSR.GLBL_CMPY_CD = OTCR.GLBL_CMPY_CD
           AND TOSR.EZCANCELFLAG = OTCR.EZCANCELFLAG
           AND TOSR.TOC_CD       = OTCR.TOC_CD
           AND TOSR.ORG_CD       = OTCR.ORG_CD
           AND OTCR.GLBL_CMPY_CD = OFRT.GLBL_CMPY_CD
           AND OTCR.EZCANCELFLAG = OFRT.EZCANCELFLAG
           AND OTCR.ORG_FUNC_ROLE_TP_CD = OFRT.ORG_FUNC_ROLE_TP_CD
           AND OFRT.ACTV_FLG     = #flgY#
           AND OTCR.GLBL_CMPY_CD = OFA.GLBL_CMPY_CD
           AND OTCR.EZCANCELFLAG = OFA.EZCANCELFLAG
           AND OTCR.TOC_CD       = OFA.TOC_CD
           AND OFA.GNRN_TP_CD   IN (#gnrnTpCdCur#, #gnrnTpCdFut#)
           AND OFA.GLBL_CMPY_CD  = PSN.GLBL_CMPY_CD
           AND OFA.EZCANCELFLAG  = PSN.EZCANCELFLAG
           AND OFA.PSN_CD        = PSN.PSN_CD
           <isNotNull property="psnCd">
           AND PSN.PSN_CD     LIKE #psnCd#
           </isNotNull>
           <isNotNull property="psnNum">
           AND PSN.PSN_NUM    LIKE #psnNum#
           </isNotNull>
           <isNotNull property="psnNm">
           AND UPPER(PSN.PSN_FIRST_NM) || ' ' || UPPER(PSN.PSN_LAST_NM) LIKE UPPER(#psnNm#)
           </isNotNull>
           AND PSN.GLBL_CMPY_CD   = LBT.GLBL_CMPY_CD(+)
           AND PSN.EZCANCELFLAG   = LBT.EZCANCELFLAG(+)
           AND PSN.LINE_BIZ_TP_CD = LBT.LINE_BIZ_TP_CD(+)
         ORDER BY PSN.PSN_FIRST_NM
                , PSN.PSN_LAST_NM
                , OFRT.ORG_FUNC_ROLE_TP_DESC_TXT
                , DOU.ORG_NM

    </statement>

    <statement id="getResrcInfo" parameterClass="Map" resultClass="Map">
        SELECT PSN.CTRY_CD
             , PSN.POST_CD
             , PSN.ST_CD
             , PSN.CTY_ADDR
             , PSN.LINE_BIZ_TP_CD
             , PSN.PSN_NUM
             , DORR.EFF_FROM_DT
             , DORR.EFF_THRU_DT
          FROM S21_PSN PSN
             , DS_ORG_RESRC_REV DORR
             , REV_ACCT_TP RAT
         WHERE PSN.GLBL_CMPY_CD = #glblCmpyCd#
           AND PSN.EZCANCELFLAG = '0'
           AND UPPER(PSN.PSN_FIRST_NM) || ' '  || UPPER(PSN.PSN_LAST_NM) = UPPER(#psnNm#)
           AND PSN.GLBL_CMPY_CD = DORR.GLBL_CMPY_CD(+)
           AND PSN.EZCANCELFLAG = DORR.EZCANCELFLAG(+)
           AND PSN.PSN_CD       = DORR.PSN_CD(+)
           <!--
           AND DORR.EFF_FROM_DT(+)  &lt;= #slsDt#
           AND (DORR.EFF_THRU_DT(+) &gt;= #slsDt# OR DORR.EFF_THRU_DT(+) IS NULL)
           -->
           AND DORR.GLBL_CMPY_CD(+) = RAT.GLBL_CMPY_CD
           AND DORR.EZCANCELFLAG(+) = RAT.EZCANCELFLAG
           AND DORR.REV_ACCT_TP_CD(+) = RAT.REV_ACCT_TP_CD 
           AND RAT.REV_COA_FLG = #flgY#
    </statement>

    <!-- Add Start 2016/10/28 M.Ohno S21_NA#15310 -->
    <statement id="countBizAreaOrg" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)
        FROM
            S21_PSN PSN
           ,ORG_FUNC_ASG ASG
           ,ORG_TOC_CHNG_RQST RQST
           ,TOC_ORG_STRU_RELN RELN
           ,DS_ORG_UNIT ORG
           ,ORG_STRU_TP STRU
           ,BIZ_AREA_ORG BIZ
        WHERE
            PSN.GLBL_CMPY_CD = #glblCmpyCd#
        AND PSN.EZCANCELFLAG = '0'
        AND UPPER(PSN.PSN_FIRST_NM) || ' '  || UPPER(PSN.PSN_LAST_NM) = UPPER(#psnNm#)
    
        AND PSN.GLBL_CMPY_CD = ASG.GLBL_CMPY_CD
        AND PSN.EZCANCELFLAG = ASG.EZCANCELFLAG
        AND PSN.PSN_CD       = ASG.PSN_CD
    
        AND ASG.GLBL_CMPY_CD = RQST.GLBL_CMPY_CD
        AND ASG.EZCANCELFLAG = RQST.EZCANCELFLAG
        AND ASG.TOC_CD       = RQST.TOC_CD
    
        AND RQST.GLBL_CMPY_CD = RELN.GLBL_CMPY_CD
        AND RQST.EZCANCELFLAG = RELN.EZCANCELFLAG
        AND RQST.TOC_CD       = RELN.TOC_CD
        AND RQST.ORG_CD       = RELN.ORG_CD
    
        AND RELN.GLBL_CMPY_CD = ORG.GLBL_CMPY_CD
        AND RELN.EZCANCELFLAG = ORG.EZCANCELFLAG
        AND RELN.ORG_CD       = ORG.ORG_CD
    
        AND ORG.GLBL_CMPY_CD   = STRU.GLBL_CMPY_CD
        AND ORG.EZCANCELFLAG   = STRU.EZCANCELFLAG
        AND ORG.ORG_STRU_TP_CD = STRU.ORG_STRU_TP_CD
        AND STRU.TRTY_STRU_FLG = 'N'
    
        AND ORG.GLBL_CMPY_CD   = BIZ.GLBL_CMPY_CD
        AND ORG.EZCANCELFLAG   = BIZ.EZCANCELFLAG
        AND ORG.FIRST_ORG_CD   = BIZ.BIZ_AREA_ORG_CD
        AND ORG.ORG_STRU_TP_CD = BIZ.ORG_STRU_TP_CD
        AND BIZ.BIZ_AREA_ORG_CD IN (#cdSales# , #cdService# , #cdSales2#)
    </statement>
    <!-- Add End   2016/10/28 M.Ohno S21_NA#15310 -->

    <statement id="getMovableResrc" parameterClass="Map" resultClass="Map">
        SELECT TOSR.EFF_FROM_DT EFF_FROM_DT_TOSR
             , DOU.EFF_FROM_DT  EFF_FROM_DT_DOU
             , NVL(DOU.EFF_THRU_DT, #highDt#)  EFF_THRU_DT_DOU
             , OTCR.ORG_FUNC_ROLE_TP_CD
          FROM DS_ORG_UNIT       DOU
             , ORG_STRU_TP       OST
             , BIZ_AREA_ORG      BAO
             , TOC_ORG_STRU_RELN TOSR
             , ORG_TOC_CHNG_RQST OTCR
             , ORG_FUNC_ROLE_TP  OFRT
             , ORG_FUNC_ASG      OFA
             , S21_PSN           PSN
         WHERE DOU.GLBL_CMPY_CD = #glblCmpyCd#
           AND DOU.EZCANCELFLAG = '0'
           AND DOU.ORG_NM = #orgNm#
           AND DOU.GLBL_CMPY_CD = OST.GLBL_CMPY_CD
           AND DOU.EZCANCELFLAG = OST.EZCANCELFLAG
           AND DOU.ORG_STRU_TP_CD = OST.ORG_STRU_TP_CD
           AND OST.TRTY_STRU_FLG = #flgN#
           AND DOU.GLBL_CMPY_CD = BAO.GLBL_CMPY_CD
           AND DOU.EZCANCELFLAG = BAO.EZCANCELFLAG
           AND DOU.ORG_STRU_TP_CD = BAO.ORG_STRU_TP_CD
           AND DOU.FIRST_ORG_CD = BAO.BIZ_AREA_ORG_CD
           AND BAO.BIZ_AREA_ORG_CD = #bizAreaOrgCd#
           AND DOU.GLBL_CMPY_CD = TOSR.GLBL_CMPY_CD
           AND DOU.EZCANCELFLAG = TOSR.EZCANCELFLAG
           AND DOU.ORG_STRU_TP_CD = TOSR.ORG_STRU_TP_CD
           AND DOU.ORG_CD         = TOSR.ORG_CD
           AND TOSR.GLBL_CMPY_CD = OTCR.GLBL_CMPY_CD
           AND TOSR.EZCANCELFLAG = OTCR.EZCANCELFLAG
           AND TOSR.TOC_CD       = OTCR.TOC_CD
           AND TOSR.ORG_CD       = OTCR.ORG_CD
           AND OTCR.TOC_CD = #tocCd#
           AND OTCR.GLBL_CMPY_CD = OFRT.GLBL_CMPY_CD
           AND OTCR.EZCANCELFLAG = OFRT.EZCANCELFLAG
           AND OTCR.ORG_FUNC_ROLE_TP_CD = OFRT.ORG_FUNC_ROLE_TP_CD
           AND OFRT.ACTV_FLG     = #flgY#
           AND OTCR.GLBL_CMPY_CD = OFA.GLBL_CMPY_CD
           AND OTCR.EZCANCELFLAG = OFA.EZCANCELFLAG
           AND OTCR.TOC_CD       = OFA.TOC_CD
           AND OFA.GNRN_TP_CD   IN (#gnrnTpCdCur#, #gnrnTpCdFut#)
           AND OFA.GLBL_CMPY_CD  = PSN.GLBL_CMPY_CD
           AND OFA.EZCANCELFLAG  = PSN.EZCANCELFLAG
           AND OFA.PSN_CD        = PSN.PSN_CD
           AND PSN.PSN_NUM       = #psnNum#
    </statement>

    <statement id="getMoveBizArea" parameterClass="Map" resultClass="Map">
        SELECT BAO.BIZ_AREA_ORG_CD
             , PSN.LINE_BIZ_TP_CD
          FROM DS_ORG_UNIT       DOU
             , ORG_STRU_TP       OST
             , BIZ_AREA_ORG      BAO
             , TOC_ORG_STRU_RELN TOSR
             , ORG_TOC_CHNG_RQST OTCR
             , ORG_FUNC_ROLE_TP  OFRT
             , ORG_FUNC_ASG      OFA
             , S21_PSN           PSN
         WHERE DOU.GLBL_CMPY_CD = #glblCmpyCd#
           AND DOU.EZCANCELFLAG = '0'
           AND DOU.ORG_NM = #orgNm#
           AND DOU.GLBL_CMPY_CD = OST.GLBL_CMPY_CD
           AND DOU.EZCANCELFLAG = OST.EZCANCELFLAG
           AND DOU.ORG_STRU_TP_CD = OST.ORG_STRU_TP_CD
           AND OST.TRTY_STRU_FLG = #flgN#
           AND DOU.GLBL_CMPY_CD = BAO.GLBL_CMPY_CD
           AND DOU.EZCANCELFLAG = BAO.EZCANCELFLAG
           AND DOU.FIRST_ORG_CD = BAO.BIZ_AREA_ORG_CD
           AND DOU.ORG_STRU_TP_CD = BAO.ORG_STRU_TP_CD
           AND BAO.BIZ_AREA_ORG_CD = #bizAreaOrgCd#
           AND DOU.GLBL_CMPY_CD = TOSR.GLBL_CMPY_CD
           AND DOU.EZCANCELFLAG = TOSR.EZCANCELFLAG
           AND DOU.ORG_STRU_TP_CD = TOSR.ORG_STRU_TP_CD
           AND DOU.ORG_CD        = TOSR.ORG_CD
           AND TOSR.GLBL_CMPY_CD = OTCR.GLBL_CMPY_CD
           AND TOSR.EZCANCELFLAG = OTCR.EZCANCELFLAG
           AND TOSR.TOC_CD       = OTCR.TOC_CD
           AND TOSR.ORG_CD       = OTCR.ORG_CD
           AND OTCR.GLBL_CMPY_CD = OFRT.GLBL_CMPY_CD
           AND OTCR.EZCANCELFLAG = OFRT.EZCANCELFLAG
           AND OTCR.ORG_FUNC_ROLE_TP_CD = OFRT.ORG_FUNC_ROLE_TP_CD
           AND OFRT.ACTV_FLG = #flgY#
           AND OTCR.GLBL_CMPY_CD = OFA.GLBL_CMPY_CD
           AND OTCR.EZCANCELFLAG = OFA.EZCANCELFLAG
           AND OTCR.TOC_CD       = OFA.TOC_CD
           AND OFA.EFF_FROM_DT  &lt;= #effFromDt#
           AND (OFA.EFF_THRU_DT &gt;= #effThruDt# OR OFA.EFF_THRU_DT IS NULL)
           AND OFA.GNRN_TP_CD    IN (#gnrnTpCdCur#, #gnrnTpCdFut#)
           AND OFA.GLBL_CMPY_CD = PSN.GLBL_CMPY_CD
           AND OFA.EZCANCELFLAG = PSN.EZCANCELFLAG
           AND OFA.PSN_CD       = PSN.PSN_CD
           AND UPPER(PSN.PSN_FIRST_NM) || ' ' || UPPER(PSN.PSN_LAST_NM) = UPPER(#psnNm#)
    </statement>

    <statement id="getSameResrc" parameterClass="Map" resultClass="Map">
        SELECT '1'
          FROM DS_ORG_UNIT       DOU
             , ORG_STRU_TP       OST
             , BIZ_AREA_ORG      BAO
             , TOC_ORG_STRU_RELN TOSR
             , ORG_TOC_CHNG_RQST OTCR
             , ORG_FUNC_ROLE_TP  OFRT
             , ORG_FUNC_ASG      OFA
             , S21_PSN           PSN
         WHERE DOU.GLBL_CMPY_CD = #glblCmpyCd#
           AND DOU.EZCANCELFLAG = '0'
           AND DOU.ORG_NM = #orgNm#
           AND DOU.GLBL_CMPY_CD = OST.GLBL_CMPY_CD
           AND DOU.EZCANCELFLAG = OST.EZCANCELFLAG
           AND DOU.ORG_STRU_TP_CD = OST.ORG_STRU_TP_CD
           AND OST.TRTY_STRU_FLG = #flgN#
           AND DOU.GLBL_CMPY_CD = BAO.GLBL_CMPY_CD
           AND DOU.EZCANCELFLAG = BAO.EZCANCELFLAG
           AND DOU.FIRST_ORG_CD = BAO.BIZ_AREA_ORG_CD
           AND DOU.ORG_STRU_TP_CD = BAO.ORG_STRU_TP_CD
           AND BAO.BIZ_AREA_ORG_CD = #bizAreaOrgCd#
           AND DOU.GLBL_CMPY_CD = TOSR.GLBL_CMPY_CD
           AND DOU.EZCANCELFLAG = TOSR.EZCANCELFLAG
           AND DOU.ORG_STRU_TP_CD = TOSR.ORG_STRU_TP_CD
           AND DOU.ORG_CD        = TOSR.ORG_CD
           AND TOSR.GLBL_CMPY_CD = OTCR.GLBL_CMPY_CD
           AND TOSR.EZCANCELFLAG = OTCR.EZCANCELFLAG
           AND TOSR.TOC_CD       = OTCR.TOC_CD
           AND TOSR.ORG_CD       = OTCR.ORG_CD
           AND OTCR.GLBL_CMPY_CD = OFRT.GLBL_CMPY_CD
           AND OTCR.EZCANCELFLAG = OFRT.EZCANCELFLAG
           AND OTCR.ORG_FUNC_ROLE_TP_CD = OFRT.ORG_FUNC_ROLE_TP_CD
           AND OTCR.ORG_FUNC_ROLE_TP_CD = #orgFuncRoleTpCd#
           AND OTCR.TOC_CD &lt;&gt; #tocCd#
           AND OFRT.ACTV_FLG = #flgY#
           AND OTCR.GLBL_CMPY_CD = OFA.GLBL_CMPY_CD
           AND OTCR.EZCANCELFLAG = OFA.EZCANCELFLAG
           AND OTCR.TOC_CD       = OFA.TOC_CD
           AND OFA.EFF_FROM_DT  &lt;= #effFromDt#
           AND (OFA.EFF_THRU_DT &gt;= #effThruDt# OR OFA.EFF_THRU_DT IS NULL)
           AND OFA.GNRN_TP_CD    IN (#gnrnTpCdCur#, #gnrnTpCdFut#)
           AND OFA.GLBL_CMPY_CD = PSN.GLBL_CMPY_CD
           AND OFA.EZCANCELFLAG = PSN.EZCANCELFLAG
           AND OFA.PSN_CD       = PSN.PSN_CD
           AND UPPER(PSN.PSN_FIRST_NM) || ' ' || UPPER(PSN.PSN_LAST_NM) = UPPER(#psnNm#)
    </statement>
</sqlMap>
