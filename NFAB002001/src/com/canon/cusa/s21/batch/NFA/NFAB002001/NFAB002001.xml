<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NFAB002001">

<!-- #################### Type Alias #################### -->

<!-- #################### Statement #################### -->
	
	<statement id="getIntfcTrxPtrn" parameterClass="Map" resultClass="Map">    
		SELECT 
			AII.SYS_SRC_CD AS SYS_SRC_CD,
			AII.TRX_CD     AS TRX_CD,
			AII.TRX_RSN_CD AS TRX_RSN_CD
		FROM 
			AJE_INVTY_INTFC AII
		WHERE 
			AII.EZCANCELFLAG = '0'
		AND	AII.GLBL_CMPY_CD = #glblCmpyCd#
		AND	NOT EXISTS 
		(
			SELECT '*'
			FROM AJE_INTFC_CTRL      AIC
           WHERE AIC.EZCANCELFLAG    = '0'
             AND AIC.GLBL_CMPY_CD    = #glblCmpyCd#
             AND AIC.AJE_INTFC_TP_CD = #ajeIntfcTpCd#
             AND AIC.JRNL_CPLT_FLG   = #jrnlCpltFlg#
	 		 AND AIC.GLBL_CMPY_CD    = AII.GLBL_CMPY_CD
			 AND AIC.AJE_INTFC_PK    = AII.AJE_INVTY_INTFC_PK
		)
		GROUP BY 
			AII.SYS_SRC_CD,
			AII.TRX_CD,
			AII.TRX_RSN_CD
		ORDER BY 
			AII.TRX_CD,
			AII.TRX_RSN_CD,
			AII.SYS_SRC_CD
    </statement>

	<statement id="getAjeInvtyIntfcNotJrnlized" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
                  AII.GLBL_CMPY_CD
                 ,AII.AJE_INVTY_INTFC_PK
                 ,AII.GL_DT
                 ,AII.INVTY_TRX_PK
                 ,AII.SYS_SRC_CD
                 ,AII.TRX_CD
                 ,AII.TRX_RSN_CD
                 ,AII.INV_INVTY_IND_TP_CD
                 ,AII.BILL_TO_CUST_CD
                 ,AII.SELL_TO_CUST_CD
                 ,AII.SHIP_TO_CUST_CD
                 ,AII.CPO_ORD_NUM
                 ,AII.SO_NUM
                 ,AII.MDSE_CD
                 ,AII.MDSE_OR_PRT_CD
                 ,AII.INVTY_LOC_CD
                 ,AII.TOC_CD
                 ,AII.VND_CD
                 ,AII.CCY_CD
                 ,AII.INVTY_TRX_QTY
                 ,NVL(AII.UNIT_COST_AMT, 0) AS UNIT_COST_AMT
                 ,NVL(AII.SHIP_COST_AMT, 0) AS SHIP_COST_AMT
                 ,AII.DEPC_AMT
                 ,AII.COA_ACCT_CD
                 ,AII.COA_PROD_CD
                 ,AII.EXP_PROJ_CD
                 ,AII.COA_BR_CD
                 ,AII.COA_CC_CD
                 ,AII.COA_CH_CD
                 ,AII.AJE_INTFC_CMNT_TXT
                 ,AII.INV_NUM
                 ,MDSE.MDSE_NM
                 ,SS.SYS_SRC_NM
                 ,TRX.TRX_NM
                 ,TR.TRX_RSN_NM
                 ,CCY.ACCT_ARTH_TP_CD
                 ,CCY.ORCL_CCY_CD
                 <!-- start 2018/02/08 add QC#23191-->
                 ,DCS.SLS_REP_TOC_CD                  AS SLS_REP_TOC_CD
                 <!-- end   2018/02/08 add QC#23191-->
                 
                 -- CSA new
                 ,AII.DS_ACCT_NUM
                 ,AII.RTL_WH_CD
                 ,AII.ORIG_RTL_WH_CD
                 ,AII.SER_NUM
                 ,AII.SVC_MACH_MSTR_PK
                 ,NVL(AII.PRCH_PRC_AMT, 0)            AS PRCH_PRC_AMT
                 ,NVL(AII.SHIP_FROM_AMT, 0)           AS SHIP_FROM_AMT
                 ,NVL(AII.RMNF_WIP_AMT, 0)            AS RMNF_WIP_AMT
                 ,TO_CHAR(NVL(AII.SLS_REP_CR_PCT, 100))   AS SLS_REP_CR_PCT
                 ,AII.PO_ORD_NUM                      AS PO_ORD_NUM
                 ,AII.PO_ORD_DTL_LINE_NUM             AS PO_ORD_DTL_LINE_NUM
                 ,AII.INVTY_TRX_SLP_NUM               AS INVTY_TRX_SLP_NUM
                 
                 -- at ITEM
                 ,MDSE.COA_PROD_CD         AS "ITEM_PROD_CD"
                 ,MDSE.REV_COA_ACCT_CD     AS "ITEM-REV_ACCT_CD"
                 ,MDSE.COGS_COA_ACCT_CD    AS "ITEM-COS_ACCT_CD"
                 ,MDSE.EXP_COA_ACCT_CD     AS "ITEM-EXP_ACCT_CD"
                 ,MDSE.COA_MDSE_TP_CD      AS "ITEM_PROJ_CD"
                 ,MDSE.COA_CC_CD           AS "ITEM_CC_CD"
                 ,MDSE.INVTY_COA_ACCT_CD   AS "ITEM-INV_ACCT_CD"
                 ,MDSE.ACRL_COA_ACCT_CD    AS "ITEM-ACRL_ACCT_CD"
                 
                 -- at MACH
                 ,MACH.COA_PROD_CD         AS "MACH_PROD_CD"
                 ,MACH.REV_COA_ACCT_CD     AS "MACH-REV_ACCT_CD"
                 ,MACH.COGS_COA_ACCT_CD    AS "MACH-COS_ACCT_CD"
                 ,MACH.EXP_COA_ACCT_CD     AS "MACH-EXP_ACCT_CD"
                 ,MACH.COA_MDSE_TP_CD      AS "MACH_PROJ_CD"
                 ,MACH.COA_CC_CD           AS "MACH_CC_CD"
                 ,MACH.INVTY_COA_ACCT_CD   AS "MACH-INV_ACCT_CD"
                 ,MACH.ACRL_COA_ACCT_CD    AS "MACH-ACRL_ACCT_CD"
                 <!-- 2016/03/28 add this is needed for AJE_PTRN_IND_TP -->
                 ,DECODE(MACH.FIRST_PROD_CTRL_CD, #pps#, 'PPS', 'OTH')  AS AJE_LINE_BIZ_TP_CD
                 <!-- end -->
                 
                 -- at TOC
                 ,ORG.COA_BR_CD            AS "TOC_BR_CD"
                 ,ORG.COA_CC_CD            AS "TOC_CC_CD"
                 ,ORG.COA_CH_CD            AS "TOC_CH_CD"
                 ,ORG.COA_EXTN_CD          AS "TOC_EXTN_CD"
                 
                 -- at SELL-ACCT
                 ,SC.COA_CMPY_CD           AS "SELL-CUST_CMPY_CD"
                 ,SC.COA_BR_CD             AS "SELL-CUST_BR_CD"
                 ,SC.COA_CC_CD             AS "SELL-CUST_CC_CD"
                 ,SC.COA_ACCT_CD           AS "SELL-CUST_ACCT_CD"
                 ,SC.COA_CH_CD             AS "SELL-CUST_CH_CD"
                 ,SC.COA_PROD_CD           AS "SELL-CUST_PROD_CD"
                 ,SC.COA_AFFL_CD           AS "SELL-CUST_AFFL_CD"
                 ,SC.COA_PROJ_CD           AS "SELL-CUST_PROJ_CD"
                 ,SC.COA_EXTN_CD           AS "SELL-CUST_EXTN_CD"
                 
                 <!-- START 2019/12/26  [QC#55123, ADD] -->
                 -- at SELL-CUST-MAP
                 ,NVL(ACAM.AJE_COA_AFFL_MAP_TO_CD, SC.COA_AFFL_CD)  AS "SELL-CUST-MAP_AFFL_CD"
                 <!-- END   2019/12/26  [QC#55123, ADD] -->
                 
                 -- at CUST-ACCT
                 ,SC_ACCT.COA_CMPY_CD      AS "CUST-ACCT_CMPY_CD"
                 ,SC_ACCT.COA_BR_CD        AS "CUST-ACCT_BR_CD"
                 ,SC_ACCT.COA_CC_CD        AS "CUST-ACCT_CC_CD"
                 ,SC_ACCT.COA_ACCT_CD      AS "CUST-ACCT_ACCT_CD"
                 ,SC_ACCT.COA_CH_CD        AS "CUST-ACCT_CH_CD"
                 ,SC_ACCT.COA_PROD_CD      AS "CUST-ACCT_PROD_CD"
                 ,SC_ACCT.COA_AFFL_CD      AS "CUST-ACCT_AFFL_CD"
                 ,SC_ACCT.COA_PROJ_CD      AS "CUST-ACCT_PROJ_CD"
                 ,SC_ACCT.COA_EXTN_CD      AS "CUST-ACCT_EXTN_CD"
                 
                 -- at LOC
                 ,BTC_ACCT.COA_CMPY_CD     AS "LOC_CMPY_CD"
                 ,BTC_ACCT.COA_BR_CD       AS "LOC_BR_CD"
                 ,BTC_ACCT.COA_CC_CD       AS "LOC_CC_CD"
                 ,BTC_ACCT.COA_ACCT_CD     AS "LOC_ACCT_CD"
                 ,BTC_ACCT.COA_CH_CD       AS "LOC_CH_CD"
                 ,BTC_ACCT.COA_PROD_CD     AS "LOC_PROD_CD"
                 ,BTC_ACCT.COA_AFFL_CD     AS "LOC_AFFL_CD"
                 ,BTC_ACCT.COA_PROJ_CD     AS "LOC_PROJ_CD"
                 ,BTC_ACCT.COA_EXTN_CD     AS "LOC_EXTN_CD"

                 <!-- start 2016/09/12 add QC#13561 -->
                 ,NVL(BTC.COA_CH_CD, SC.COA_CH_CD)      AS "SELL-SITE_CH_CD"
                 ,NVL(BTC.COA_AFFL_CD, SC.COA_AFFL_CD)  AS "SELL-SITE_AFFL_CD"
                 ,NVL(BTC_ACCT.COA_CH_CD, SC_ACCT.COA_CH_CD)      AS "CUST-SITE_CH_CD"
                 ,NVL(BTC_ACCT.COA_AFFL_CD, SC_ACCT.COA_AFFL_CD)  AS "CUST-SITE_AFFL_CD"
                 <!-- end 2016/09/12 add QC#13561 -->
                 -- at MACH-MAP
                 ,NVL(CPM.AJE_COA_PROD_MAP_TO_CD, MACH.COA_PROD_CD) AS "MACH-MAP_PROD_CD"
                 
                 -- at VND
                 ,VND.COA_AFFL_CD          AS "VND_AFFL_CD"
                 ,VND.SPLY_COA_CMPY_CD     AS "VND-SPLY_CMPY_CD"
                 ,VND.SPLY_COA_BR_CD       AS "VND-SPLY_BR_CD"
                 ,VND.SPLY_COA_CC_CD       AS "VND-SPLY_CC_CD"
                 ,VND.SPLY_COA_ACCT_CD     AS "VND-SPLY_ACCT_CD"
                 ,VND.SPLY_COA_PROD_CD     AS "VND-SPLY_PROD_CD"
                 ,VND.SPLY_COA_CH_CD       AS "VND-SPLY_CH_CD"
                 ,VND.SPLY_COA_AFFL_CD     AS "VND-SPLY_AFFL_CD"
                 ,VND.SPLY_COA_PROJ_CD     AS "VND-SPLY_PROJ_CD"
                 ,VND.SPLY_COA_EXTN_CD     AS "VND-SPLY_EXTN_CD"
                 ,VND.PRE_PMT_COA_CMPY_CD  AS "VND-PRE-PMT_CMPY_CD"
                 ,VND.PRE_PMT_COA_BR_CD    AS "VND-PRE-PMT_BR_CD"
                 ,VND.PRE_PMT_COA_CC_CD    AS "VND-PRE-PMT_CC_CD"
                 ,VND.PRE_PMT_COA_ACCT_CD  AS "VND-PRE-PMT_ACCT_CD"
                 ,VND.PRE_PMT_COA_PROD_CD  AS "VND-PRE-PMT_PROD_CD"
                 ,VND.PRE_PMT_COA_CH_CD    AS "VND-PRE-PMT_CH_CD"
                 ,VND.PRE_PMT_COA_AFFL_CD  AS "VND-PRE-PMT_AFFL_CD"
                 ,VND.PRE_PMT_COA_PROJ_CD  AS "VND-PRE-PMT_PROJ_CD"
                 ,VND.PRE_PMT_COA_EXTN_CD  AS "VND-PRE-PMT_EXTN_CD" 
                 ,VND.VND_RTRN_COA_CMPY_CD AS "VND-VND-RTRN_CMPY_CD"
                 ,VND.VND_RTRN_COA_BR_CD   AS "VND-VND-RTRN_BR_CD"
                 ,VND.VND_RTRN_COA_CC_CD   AS "VND-VND-RTRN_CC_CD"
                 <!-- start 2016/11/28  mod QC#16133-->
                 ,NVL(VND.VND_RTRN_COA_ACCT_CD, CPA.COA_ACCT_CD) AS "VND-VND-RTRN_ACCT_CD"
                 <!-- start 2016/11/28  mod QC#16133-->
                 ,VND.VND_RTRN_COA_PROD_CD AS "VND-VND-RTRN_PROD_CD"
                 ,VND.VND_RTRN_COA_CH_CD   AS "VND-VND-RTRN_CH_CD"
                 ,VND.VND_RTRN_COA_AFFL_CD AS "VND-VND-RTRN_AFFL_CD"
                 ,VND.VND_RTRN_COA_PROJ_CD AS "VND-VND-RTRN_PROJ_CD"
                 ,VND.VND_RTRN_COA_EXTN_CD AS "VND-VND-RTRN_EXTN_CD"
                 
                 -- at INVTY_ORD
                 ,AII.DR_INVTY_ORD_CMPY_CD AS "DR_INVTY_ORD_CMPY_CD"
                 ,AII.DR_INVTY_ORD_BR_CD   AS "DR_INVTY_ORD_BR_CD"
                 ,AII.DR_INVTY_ORD_CC_CD   AS "DR_INVTY_ORD_CC_CD"
                 ,AII.DR_INVTY_ORD_ACCT_CD AS "DR_INVTY_ORD_ACCT_CD" 
                 ,AII.DR_INVTY_ORD_PROD_CD AS "DR_INVTY_ORD_PROD_CD"
                 ,AII.DR_INVTY_ORD_CH_CD   AS "DR_INVTY_ORD_CH_CD"
                 ,AII.DR_INVTY_ORD_AFFL_CD AS "DR_INVTY_ORD_AFFL_CD"
                 ,AII.DR_INVTY_ORD_PROJ_CD AS "DR_INVTY_ORD_PROJ_CD"
                 ,AII.DR_INVTY_ORD_EXTN_CD AS "DR_INVTY_ORD_EXTN_CD"
                 ,AII.CR_INVTY_ORD_CMPY_CD AS "CR_INVTY_ORD_CMPY_CD"
                 ,AII.CR_INVTY_ORD_BR_CD   AS "CR_INVTY_ORD_BR_CD"
                 ,AII.CR_INVTY_ORD_CC_CD   AS "CR_INVTY_ORD_CC_CD"
                 ,AII.CR_INVTY_ORD_ACCT_CD AS "CR_INVTY_ORD_ACCT_CD"
                 ,AII.CR_INVTY_ORD_PROD_CD AS "CR_INVTY_ORD_PROD_CD"
                 ,AII.CR_INVTY_ORD_CH_CD   AS "CR_INVTY_ORD_CH_CD"
                 ,AII.CR_INVTY_ORD_AFFL_CD AS "CR_INVTY_ORD_AFFL_CD"
                 ,AII.CR_INVTY_ORD_PROJ_CD AS "CR_INVTY_ORD_PROJ_CD"
                 ,AII.CR_INVTY_ORD_EXTN_CD AS "CR_INVTY_ORD_EXTN_CD"
                 
                 -- at PO
                 ,PA.COA_CMPY_CD           AS "PO_CMPY_CD"
                 ,PA.COA_BR_CD             AS "PO_BR_CD"
                 ,PA.COA_CC_CD             AS "PO_CC_CD"
                 ,PA.COA_ACCT_CD           AS "PO_ACCT_CD"
                 ,PA.COA_PROD_CD           AS "PO_PROD_CD"
                 ,PA.COA_CH_CD             AS "PO_CH_CD"
                 ,PA.COA_AFFL_CD           AS "PO_AFFL_CD"
                 ,PA.COA_PROJ_CD           AS "PO_PROJ_CD"
                 ,PA.COA_EXTN_CD           AS "PO_EXTN_CD"
                 
                 -- at WH
                 ,RW.COA_BR_CD             AS "WH_BR_CD"
                 ,ORW.COA_BR_CD            AS "ORIG-WH_BR_CD"
                 
                 -- at IB
                 ,AII.FIN_BR_CD            AS "IB_BR_CD"
                 
                 <!-- add 2016/03/28 -->
                 -- at newcore
                 ,(CASE WHEN CB.COA_BR_TP_CD = #newcore# THEN ORG.COA_BR_CD
                     ELSE #defBrNewcore# END) AS "NEWCORE_BR_CD"
                 <!-- start mod 2019/05/09 QC#50129 -->
                 ,(CASE WHEN CB.COA_BR_TP_CD = #newcore# THEN ORG.COA_CC_CD
                     ELSE NVL(LBT3.ASSET_COA_CC_CD, NVL(LBT_SLD.ASSET_COA_CC_CD, LBT1.ASSET_COA_CC_CD)) END) AS "NEWCORE_CC_CD"
                 <!-- end mod 2019/05/09 QC#50129 -->
                 <!-- end -->
                 
                 <!-- add 2016/04/18 at AT-->
                 -- at AT
                 ,ABC.ASSET_COA_ACCT_CD       AS "AT-ASSET_ACCT_CD"
                 ,ABC.DEPC_COA_ACCT_CD        AS "AT-DEPR_EXP_ACCT_CD"
                 ,ABC.ACCUM_DEPC_COA_ACCT_CD  AS "AT-ACCUM_DEPR_ACCT_CD"
                 ,ABC.DEPC_ADJ_COA_ACCT_CD    AS "AT-ADJ_ACCT_CD"
                 ,ABC.SLS_PRCD_COA_ACCT_CD    AS "AT-SLS_PRCD_ACCT_CD"
                 ,ABC.RMV_COST_COA_ACCT_CD    AS "AT-RMV_COST_ACCT_CD"
                 ,ABC.GAIN_LOSS_COA_ACCT_CD   AS "AT-GAIN_LOSS_ACCT_CD"
                 ,ABC.CLING_COA_ACCT_CD       AS "AT-CLING_ACCT_CD"
                 ,ABC.ADJ_COA_ACCT_CD         AS "AT-ADJ_ACCT_CD"
                 <!-- end -->
                 
                 <!-- add 2016/07/07 at link-->
                 -- at LINK
                 ,AII.COA_BR_CD               AS "LINK_BR_CD"
                 ,AII.COA_CC_CD               AS "LINK_CC_CD"
                 ,AII.COA_ACCT_CD             AS "LINK_ACCT_CD"
                 ,AII.COA_PROD_CD             AS "LINK_PROD_CD"
                 ,AII.COA_CH_CD               AS "LINK_CH_CD"
                 ,AII.EXP_PROJ_CD             AS "LINK_PROJ_CD"
                 <!-- start 2018/02/22 add QC#22657-->
                 ,AII.COA_AFFL_CD             AS "LINK_AFFL_CD"
                 ,AII.COA_EXTN_CD             AS "LINK_EXTN_CD"
                 <!-- end   2018/02/22 add QC#22657-->
                 <!-- -->
                 <!-- start 2016/09/05 add QC#13744 -->
                 ,CD.COA_CMPY_CD              AS "CPO_CMPY_CD"
                 ,CD.COA_AFFL_CD              AS "CPO_AFFL_CD"
                 ,CD.COA_EXTN_CD              AS "CPO_EXTN_CD"
                 <!-- end 2016/09/05 -->
                 <!-- start 2016/12/05 add QC#16148 -->
                 <!-- start 2018/01/16 add QC#23191-->
                 <!-- start 2017/10/11 upd QC#20771 -->
                 ,DECODE(DC.DS_CONTR_CLS_CD, #bsd#, #fmIndTp#, DECODE(STC.DS_ACCT_CLS_CD, #fmAccts#, #fmIndTp#, #nonFm#))   AS "FM_IND_TP_CD"
                 ,NVL(TOC1.COA_BR_CD, TOC2.COA_BR_CD)     AS "TOC-HDR_BR_CD"
                 ,NVL(TOC1.COA_CC_CD, TOC2.COA_CC_CD)     AS "TOC-HDR_CC_CD"
                 ,NVL(TOC1.COA_EXTN_CD, TOC2.COA_EXTN_CD) AS "TOC-HDR_EXTN_CD"
                 <!-- end 2017/10/11 upd QC#20771 -->
                 <!-- end 2018/01/16 add QC#23191-->
                 <!-- START 2019/09/05 S.Takami [QC#53266,MOD] -->
                 <!-- ,DECODE(FSR.SVC_CALL_SRC_TP_CD, #crossSvc#, #cs#, #nonCs#) AS "CRS_SVC_TP_CD" -->
                 <!-- START 2019/10/31 H.Umeda [QC#54479,MOD] -->
                 <!-- ,CASE WHEN FSR.SVC_CALL_SRC_TP_CD = #crossSvc# THEN #cs# -->
                 ,CASE
                 <!-- END   2019/10/31 H.Umeda [QC#54479,MOD] -->
                    WHEN SMM.SLD_BY_LINE_BIZ_TP_CD = #lineBizEss# AND SMM.SVC_BY_LINE_BIZ_TP_CD IN (#lineBizLfs#, #lineBizPps#) THEN #cs#
                    ELSE #nonCs# END AS CRS_SVC_TP_CD
                 <!-- END 2019/09/05 S.Takami [QC#53266,MOD] -->
                 <!-- end 2016/12/05 add QC#16148 -->
                 <!-- start 2017/09/22 add QC#17116-->
                 ,CASE WHEN DC.DS_CONTR_CATG_CD = #flt# THEN LBT2.SVC_COA_CC_CD
                     ELSE LBT1.SVC_COA_CC_CD END AS "LOB-SVC_CC_CD"
                 ,CASE WHEN DC.DS_CONTR_CATG_CD = #flt# THEN LBT2.SPLY_COA_CC_CD
                     ELSE LBT1.SPLY_COA_CC_CD END AS "LOB-SPLY_CC_CD"
                 <!-- end 2017/09/22 add QC#17116-->
                 <!-- start add 2018/07/05 QC#26320 -->
                 ,CASE WHEN DC.DS_CONTR_CATG_CD = #flt# THEN LBT2.SVC_COA_CC_CD
                     ELSE NVL(LBT_SLD.SVC_COA_CC_CD, LBT1.SVC_COA_CC_CD) END AS "LOB-SVC-SLD_CC_CD"
                 ,CASE WHEN DC.DS_CONTR_CATG_CD = #flt# THEN LBT2.SPLY_COA_CC_CD
                     ELSE NVL(LBT_SLD.SPLY_COA_CC_CD, LBT1.SPLY_COA_CC_CD) END AS "LOB-SPLY-SLD_CC_CD"
                 <!-- end add 2018/07/05 QC#26320 -->
                 ,DECODE(AII.MACH_MDSE_CD, NULL, #none#, #configInd#)  AS  "CONFIG_IND_TP_CD"
                 ,CASE
                      WHEN EXISTS (
                           SELECT
                             1
                           FROM
                              CPO               CP
                             ,ORD_CATG_BIZ_CTX  OCB
                           WHERE
                            CP.GLBL_CMPY_CD              = AII.GLBL_CMPY_CD
                            AND CP.CPO_ORD_NUM           = AII.CPO_ORD_NUM
                            AND CP.EZCANCELFLAG          = '0'
                            AND OCB.GLBL_CMPY_CD         = CP.GLBL_CMPY_CD
                            AND OCB.ORD_CATG_CTX_TP_CD   = #ordCatgCtxTpCd#
                            AND (    OCB.DS_ORD_CATG_CD    IS NULL
                                 OR  OCB.DS_ORD_CATG_CD  = CP.DS_ORD_CATG_CD
                            )
                            AND (    OCB.DS_ORD_TP_CD      IS NULL
                                 OR  OCB.DS_ORD_TP_CD    = CP.DS_ORD_TP_CD
                            )
                            AND (    OCB.DS_ORD_RSN_CD     IS NULL
                                 OR  OCB.DS_ORD_RSN_CD   = CP.DS_ORD_RSN_CD
                            )
                            AND OCB.EZCANCELFLAG         ='0'
                      ) THEN #exch# ELSE #nonExch# END AS "ASSET_INBD_OTBD_TP_CD"
                 <!-- start 2019/01/09 add QC#29734-->
                ,(CASE
                    WHEN
                         <iterate property="sldPrtMdseTp" var="sldPrtMdseTp[]" open="MDSE.COA_MDSE_TP_CD IN (" close=")" conjunction=",">
                         #sldPrtMdseTp[]#
                         </iterate>
                         <!-- start 2019/02/19 add QC#30262-->
                         AND FU.SVC_PRT_CHRG_FLG = #flgY#
                         <!-- end 2019/02/19 add QC#30262-->
                         THEN #sldPrt#
                    ELSE #nonSldPrt#
                 END) AS "SLD_PRT_IND_TP_CD"
                 <!-- end 2019/01/09 add QC#29734-->
                 <!-- START 2019/08/10 S.Takami [QC#51897,ADD] -->
                 ,SMM.SVC_CONFIG_MSTR_PK
                 <!-- END 2019/08/10 S.Takami [QC#51897,ADD] -->


               FROM AJE_INVTY_INTFC      AII
                   ,MDSE_DLY_SNAP_SHOT   MDSE   -- at ITEM
                   ,MDSE_DLY_SNAP_SHOT   MACH   -- at MACH
                   ,TOC_DLY_SNAP_SHOT    ORG    -- at TOC
                   ,SELL_TO_CUST         SC     -- at SELL-CUST
                   ,SELL_TO_CUST         SC_ACCT -- at CUST-ACCT
                   ,VND_DLY_SNAP_SHOT    VND    -- at VND
                   ,BILL_TO_CUST         BTC
                   ,BILL_TO_CUST         BTC_ACCT
                   ,AJE_COA_PROD_MAP     CPM     -- at MACH-MAP
                   ,PO_ACCT              PA      -- at PO
                   ,RTL_WH               RW      -- at WH
                   ,RTL_WH               ORW     -- at ORIG-WH
                   ,SYS_SRC              SS
                   ,TRX                  TRX
                   ,TRX_RSN              TR
                   ,CCY                  CCY
                   ,COA_BR               CB
                   <!-- start 2016/04/18 add QC#7208 -->
                   ,ASSET_BOOK_CTRL      ABC
                   <!-- end 2016/04/18 -->
                   <!-- start 2016/09/05 add QC#13744 -->
                   ,CPO                  C
                   ,CPO_DTL              CD
                   <!-- end 2016/09/05 -->
                   <!-- start 2016/11/28 add QC#16133-->
                   ,COA_PROJ_ACCT        CPA
                   <!-- end 2016/11/28 add QC#16133-->
                   <!-- start 2016/12/05 add QC#16148-->
                   ,DS_CONTR             DC
                   ,FSR                  FSR
                   <!-- start 2016/12/05 add QC#16148-->
                   <!-- start 2017/09/22 add QC#17116-->
                   ,SVC_MACH_MSTR        SMM
                   ,LINE_BIZ_TP          LBT1
                   ,LINE_BIZ_TP          LBT2
                   <!-- end 2017/09/22 add QC#17116-->
                   <!-- start 2018/01/16 add QC#23191-->
                   ,SELL_TO_CUST         STC
                   ,INVTY_TRX            IT
                   ,DS_CPO_SLS_CR        DCS
                   ,TOC                  TOC1
                   ,TOC                  TOC2
                   ,DS_ORD_TP_PROC_DFN   OTP
                   ,LINE_BIZ_TP          LBT3
                   <!-- end   2018/01/16 add QC#23191-->
                   ,LINE_BIZ_TP          LBT_SLD
                   <!-- start 2019/01/09 add QC#29734-->
                   ,FSR_USG              FU
                   <!-- start 2019/01/09 add QC#29734-->
                   <!-- START 2019/12/26  [QC#55123, ADD] -->
                   ,AJE_COA_AFFL_MAP     ACAM
                   <!-- END   2019/12/26  [QC#55123, ADD] -->
              WHERE AII.EZCANCELFLAG            = '0'
                AND AII.GLBL_CMPY_CD            = #glblCmpyCd#
                AND AII.EZCANCELFLAG            = MDSE.EZCANCELFLAG(+)
                AND AII.GLBL_CMPY_CD            = MDSE.GLBL_CMPY_CD(+)
                AND AII.MDSE_CD                 = MDSE.MDSE_CD(+)
                AND #flgY#                      = MDSE.LTST_REC_FLG(+)
                AND AII.EZCANCELFLAG            = MACH.EZCANCELFLAG(+)
                AND AII.GLBL_CMPY_CD            = MACH.GLBL_CMPY_CD(+)
                AND AII.MACH_MDSE_CD            = MACH.MDSE_CD(+)
                AND #flgY#                      = MACH.LTST_REC_FLG(+)
                AND AII.EZCANCELFLAG            = ORG.EZCANCELFLAG(+)
                AND AII.GLBL_CMPY_CD            = ORG.GLBL_CMPY_CD(+)
                AND AII.TOC_CD                  = ORG.TOC_CD(+)
                AND AII.EZCANCELFLAG            = SC.EZCANCELFLAG(+)
                AND AII.GLBL_CMPY_CD            = SC.GLBL_CMPY_CD(+)
                AND AII.DS_ACCT_NUM             = SC.SELL_TO_CUST_CD(+)
                AND AII.EZCANCELFLAG            = C.EZCANCELFLAG(+)
                AND AII.GLBL_CMPY_CD            = C.GLBL_CMPY_CD(+)
                AND AII.CPO_ORD_NUM             = C.CPO_ORD_NUM(+)
                AND C.EZCANCELFLAG              = SC_ACCT.EZCANCELFLAG(+)
                AND C.GLBL_CMPY_CD              = SC_ACCT.GLBL_CMPY_CD(+)
                AND C.BILL_TO_CUST_ACCT_CD      = SC_ACCT.SELL_TO_CUST_CD(+)
                AND C.EZCANCELFLAG              = BTC.EZCANCELFLAG(+)
                AND C.GLBL_CMPY_CD              = BTC.GLBL_CMPY_CD(+)
                AND C.SOLD_TO_CUST_LOC_CD       = BTC.BILL_TO_CUST_CD(+)
                AND AII.EZCANCELFLAG            = VND.EZCANCELFLAG(+)
                AND AII.GLBL_CMPY_CD            = VND.GLBL_CMPY_CD(+)
                AND AII.VND_CD                  = VND.VND_CD(+)
                AND AII.EZCANCELFLAG            = BTC_ACCT.EZCANCELFLAG(+)
                AND AII.GLBL_CMPY_CD            = BTC_ACCT.GLBL_CMPY_CD(+)
                AND AII.BILL_TO_CUST_CD         = BTC_ACCT.BILL_TO_CUST_CD(+)
                AND MACH.EZCANCELFLAG           = CPM.EZCANCELFLAG(+)
                AND MACH.GLBL_CMPY_CD           = CPM.GLBL_CMPY_CD(+)
                AND MACH.COA_PROD_CD            = CPM.AJE_COA_PROD_MAP_CD(+)
                AND AII.EZCANCELFLAG            = PA.EZCANCELFLAG(+)
                AND AII.GLBL_CMPY_CD            = PA.GLBL_CMPY_CD(+)
                AND AII.PO_ORD_NUM              = PA.PO_ORD_NUM(+)
                AND AII.PO_ORD_DTL_LINE_NUM     = PA.PO_ORD_DTL_LINE_NUM(+)
                AND #poAcctTpAcrl#              = PA.PO_ACCT_TP_CD(+)
                AND AII.EZCANCELFLAG            = RW.EZCANCELFLAG(+)
                AND AII.GLBL_CMPY_CD            = RW.GLBL_CMPY_CD(+)
                AND AII.RTL_WH_CD               = RW.RTL_WH_CD(+)
                AND AII.EZCANCELFLAG            = ORW.EZCANCELFLAG(+)
                AND AII.GLBL_CMPY_CD            = ORW.GLBL_CMPY_CD(+)
                AND AII.ORIG_RTL_WH_CD          = ORW.RTL_WH_CD(+) 
                
                AND AII.EZCANCELFLAG            = SS.EZCANCELFLAG(+)
                AND AII.GLBL_CMPY_CD            = SS.GLBL_CMPY_CD(+)
                AND AII.SYS_SRC_CD              = SS.SYS_SRC_CD(+)
                AND AII.EZCANCELFLAG            = TRX.EZCANCELFLAG(+)
                AND AII.GLBL_CMPY_CD            = TRX.GLBL_CMPY_CD(+)
                AND AII.TRX_CD                  = TRX.TRX_CD(+)
                AND AII.EZCANCELFLAG            = TR.EZCANCELFLAG(+)
                AND AII.GLBL_CMPY_CD            = TR.GLBL_CMPY_CD(+)
                AND AII.TRX_CD                  = TR.TRX_CD(+)
                AND AII.TRX_RSN_CD              = TR.TRX_RSN_CD(+)
                AND AII.EZCANCELFLAG            = CCY.EZCANCELFLAG(+)
                AND AII.GLBL_CMPY_CD            = CCY.GLBL_CMPY_CD(+)
                AND AII.CCY_CD                  = CCY.CCY_CD(+)
                
                AND ORG.EZCANCELFLAG            = CB.EZCANCELFLAG(+)
                AND ORG.GLBL_CMPY_CD            = CB.GLBL_CMPY_CD(+)
                AND ORG.COA_BR_CD               = CB.COA_BR_CD(+)
                
                AND AII.GLBL_CMPY_CD            = ABC.GLBL_CMPY_CD(+)
                AND AII.EZCANCELFLAG            = ABC.EZCANCELFLAG(+)
                AND DECODE(AII.TRX_CD, #rentalShip#, #rental#, #fm#) = ABC.ASSET_TP_CD(+)
                AND (#batchProcDt#              &gt;= ABC.EFF_FROM_DT(+)
                AND  #batchProcDt#              &lt;= NVL(ABC.EFF_THRU_DT(+), '99991231'))
                
                <!-- start add QC#9122 2016/05/26 Not to select amount $0-->
                AND NOT ( AII.SHIP_COST_AMT             = 0
                AND AII.TRX_CD = #adjustment#
                )
                <!-- end 2016/05/26 -->
                <!-- start 2016/09/05 add QC#13744 -->
                AND AII.GLBL_CMPY_CD            = CD.GLBL_CMPY_CD(+)
                AND AII.CPO_ORD_NUM             = CD.CPO_ORD_NUM(+)
                AND AII.CPO_DTL_LINE_NUM        = CD.CPO_DTL_LINE_NUM(+)
                AND AII.CPO_DTL_LINE_SUB_NUM    = CD.CPO_DTL_LINE_SUB_NUM(+)
                AND AII.EZCANCELFLAG            = CD.EZCANCELFLAG(+)
                <!-- end 2016/09/05 -->
                <!-- start 2016/11/28 add QC#16133-->
                AND MDSE.GLBL_CMPY_CD           = CPA.GLBL_CMPY_CD(+)
                AND CPA.COA_PROJ_ACCT_TP_CD(+)  = #accrual#
                AND MDSE.COA_MDSE_TP_CD         = CPA.COA_PROJ_CD(+)
                AND CPA.EZCANCELFLAG(+)         = '0'
                <!-- end 2016/11/28 add QC#16133-->
                <!-- start 2016/12/05 add QC#16148-->
                AND CD.GLBL_CMPY_CD            = DC.GLBL_CMPY_CD(+)
                AND CD.DS_CONTR_NUM            = DC.DS_CONTR_NUM(+)
                AND DC.EZCANCELFLAG(+)          = '0'
                AND AII.GLBL_CMPY_CD            = FSR.GLBL_CMPY_CD(+)
                AND AII.INVTY_TRX_SLP_NUM       = FSR.FSR_NUM(+)
                AND FSR.EZCANCELFLAG(+)         = '0'
                <!-- end 2016/12/05 add QC#16148-->
                <!-- start 2017/09/22 add QC#17116-->
                AND AII.GLBL_CMPY_CD            = SMM.GLBL_CMPY_CD(+)
                AND AII.SVC_MACH_MSTR_PK        = SMM.SVC_MACH_MSTR_PK(+)
                AND SMM.EZCANCELFLAG(+)         = '0'
                AND SMM.GLBL_CMPY_CD            = LBT1.GLBL_CMPY_CD(+)
                AND SMM.SVC_BY_LINE_BIZ_TP_CD   = LBT1.LINE_BIZ_TP_CD(+)
                AND LBT1.EZCANCELFLAG(+)        ='0'
                
                AND DC.GLBL_CMPY_CD             = LBT2.GLBL_CMPY_CD(+)
                AND DC.SVC_LINE_BIZ_CD          = LBT2.LINE_BIZ_TP_CD(+)
                AND LBT2.EZCANCELFLAG(+)        ='0'
                <!-- end 2017/09/22 add QC#17116-->
                <!-- start 2018/01/16 add QC#23191-->
                AND C.GLBL_CMPY_CD              = STC.GLBL_CMPY_CD(+)
                AND C.SHIP_TO_CUST_ACCT_CD      = STC.SELL_TO_CUST_CD(+)
                AND STC.EZCANCELFLAG(+)         ='0'
                AND CD.GLBL_CMPY_CD             = DCS.GLBL_CMPY_CD(+)
                AND CD.DS_CPO_CONFIG_PK         = DCS.DS_CPO_CONFIG_PK(+)
                AND DCS.SLS_REP_ROLE_TP_CD(+)   = #emsd#
                AND DCS.EZCANCELFLAG(+)         = '0'
                AND DCS.GLBL_CMPY_CD            = TOC1.GLBL_CMPY_CD(+)
                AND DCS.SLS_REP_TOC_CD          = TOC1.TOC_CD(+)
                AND TOC1.EZCANCELFLAG(+)        = '0'
                AND AII.GLBL_CMPY_CD            = IT.GLBL_CMPY_CD(+)
                AND AII.INVTY_TRX_PK            = IT.INVTY_TRX_PK(+)
                AND IT.EZCANCELFLAG(+)          = '0'
                AND IT.GLBL_CMPY_CD             = TOC2.GLBL_CMPY_CD(+)
                AND IT.TOC_CD                   = TOC2.TOC_CD(+)
                AND TOC2.EZCANCELFLAG(+)        = '0'
                <!-- end   2018/01/16 add QC#23191-->
                <!-- start 2019/01/09 add QC#29734-->
                AND IT.GLBL_CMPY_CD             = FU.GLBL_CMPY_CD(+)
                AND IT.BOL_NUM                  = FU.SVC_TASK_NUM(+)
                AND IT.MDSE_CD                  = FU.MDSE_CD(+)
                AND FU.EZCANCELFLAG(+)          = '0'
                <!-- end   2019/01/09 add QC#29734-->
                AND C.GLBL_CMPY_CD              = OTP.GLBL_CMPY_CD(+)
                AND C.DS_ORD_TP_CD              = OTP.DS_ORD_TP_CD(+)
                AND OTP.EZCANCELFLAG(+)         = '0'
                AND OTP.GLBL_CMPY_CD            = LBT3.GLBL_CMPY_CD(+)
                AND OTP.LINE_BIZ_TP_CD          = LBT3.LINE_BIZ_TP_CD(+)
                AND LBT3.EZCANCELFLAG(+)        = '0'
                AND SMM.EZCANCELFLAG(+)         = '0'
                AND SMM.GLBL_CMPY_CD            = LBT_SLD.GLBL_CMPY_CD(+)
                AND SMM.SLD_BY_LINE_BIZ_TP_CD   = LBT_SLD.LINE_BIZ_TP_CD(+)
                AND LBT_SLD.EZCANCELFLAG(+)     = '0'
                <!-- START 2019/12/26  [QC#55123, ADD] -->
                AND SC.GLBL_CMPY_CD             = ACAM.GLBL_CMPY_CD(+)
                AND SC.COA_AFFL_CD              = ACAM.AJE_COA_AFFL_MAP_CD(+)
                AND ACAM.EZCANCELFLAG(+)        = '0'
                <!-- END   2019/12/26  [QC#55123, ADD] -->
                AND NOT EXISTS 
               (
                 SELECT '*'
                   FROM AJE_INTFC_CTRL      AIC
                  WHERE AIC.EZCANCELFLAG    = '0'
                    AND AIC.GLBL_CMPY_CD    = #glblCmpyCd#
                    AND AIC.AJE_INTFC_TP_CD = #ajeIntfcTpCd#
                    AND AIC.JRNL_CPLT_FLG   = #jrnlCpltFlg#
                    AND AIC.AJE_INTFC_PK    = AII.AJE_INVTY_INTFC_PK
               )
            ORDER BY AII.AJE_INVTY_INTFC_PK
	</statement>

</sqlMap>	
