<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NWCB011001">

    <!-- For Printing Out -->
    <statement id="selectInvPrtCtrl" parameterClass="Map" resultClass="Map">
        SELECT
            'B'                   AS TYPE
           ,IPC.CONSL_BILL_NUM    AS NUM
           ,IPC.INV_PRT_CTRL_PK
           <isNull property="reprintMode">
           ,NULL REPR_RPT_BR_NUM
           </isNull>
           <isNotNull property="reprintMode">
           ,IPC.REPR_RPT_BR_NUM
           </isNotNull>
           ,'Y' CONSL_BILL_FLG
           ,IPC.BILL_TO_CUST_CD
           ,IPC.INV_PRT_BAT_TP_CD
           ,IPC.INV_PRT_BR_CD
           ,IPH.BILL_TO_POST_CD
           ,IPC.INV_FTP_RQST_NUM
           ,IPBT.INV_PRT_BAT_TP_NM
           ,IPB.INV_PRT_BR_NM
           ,IPBT.INV_RPT_BR_PRINT_NUM INV_RPT_BR_PRINT_NUM_BAT
           ,IPB.INV_RPT_BR_PRINT_NUM INV_RPT_BR_PRINT_NUM_BR
        FROM INV_PRT_CTRL IPC
            ,INV_PRT_HDR IPH
            ,INV_PRT_BAT_TP IPBT
            ,INV_PRT_BR IPB
        WHERE
                IPC.GLBL_CMPY_CD = #glblCmpyCd#
            AND IPC.EZCANCELFLAG = '0'
            AND IPC.INV_PRT_CTRL_REC_CD = #invPrtCtrlRecCd#
            AND IPC.INV_PRT_PROC_STS_CD =  #invPrtProcStsCd#
            AND IPC.INV_OTPT_REQ_FLG = #invOtptReqFlg#
            AND IPH.GLBL_CMPY_CD = #glblCmpyCd#
            AND IPH.EZCANCELFLAG = '0'
            AND IPC.INV_PRT_CTRL_PK = IPH.INV_PRT_CTRL_PK
            AND IPC.EZCANCELFLAG = IPBT.EZCANCELFLAG(+)
            AND IPC.GLBL_CMPY_CD = IPBT.GLBL_CMPY_CD(+)
            AND IPC.INV_PRT_BAT_TP_CD = IPBT.INV_PRT_BAT_TP_CD(+)
            AND IPC.EZCANCELFLAG = IPB.EZCANCELFLAG(+)
            AND IPC.GLBL_CMPY_CD = IPB.GLBL_CMPY_CD(+)
            AND IPC.INV_PRT_BR_CD = IPB.INV_PRT_BR_CD(+)
           <isNull property="reprintMode">
            AND IPC.REPR_RPT_BR_NUM IS NULL
           </isNull>
           <isNotNull property="reprintMode">
            AND IPC.REPR_RPT_BR_NUM IS NOT NULL
           </isNotNull>
        UNION ALL
        SELECT
            'I'                   AS TYPE
           ,IPC.INV_NUM           AS NUM
           ,IPC.INV_PRT_CTRL_PK
           <isNull property="reprintMode">
           ,NULL REPR_RPT_BR_NUM
           </isNull>
           <isNotNull property="reprintMode">
           ,IPC.REPR_RPT_BR_NUM
           </isNotNull>
           ,'N' CONSL_BILL_FLG
           ,IPC.BILL_TO_CUST_CD
           ,IPC.INV_PRT_BAT_TP_CD
           ,IPC.INV_PRT_BR_CD
           ,IPH.BILL_TO_POST_CD
           ,IPC.INV_FTP_RQST_NUM
           ,IPBT.INV_PRT_BAT_TP_NM
           ,IPB.INV_PRT_BR_NM
           ,IPBT.INV_RPT_BR_PRINT_NUM INV_RPT_BR_PRINT_NUM_BAT
           ,IPB.INV_RPT_BR_PRINT_NUM INV_RPT_BR_PRINT_NUM_BR
        FROM INV_PRT_CTRL IPC
            ,INV_PRT_HDR IPH
            ,INV_PRT_BAT_TP IPBT
            ,INV_PRT_BR IPB
        WHERE
                IPC.GLBL_CMPY_CD = #glblCmpyCd#
            AND IPC.EZCANCELFLAG = '0'
            AND IPC.INV_PRT_CTRL_REC_CD &lt;&gt; #invPrtCtrlRecCd#
            AND IPC.INV_PRT_PROC_STS_CD =  #invPrtProcStsCd#
            AND IPC.INV_OTPT_REQ_FLG = #invOtptReqFlg#
            AND IPC.CONSL_BILL_NUM IS NULL
            AND IPH.GLBL_CMPY_CD = #glblCmpyCd#
            AND IPH.EZCANCELFLAG = '0'
            AND IPC.INV_PRT_CTRL_PK = IPH.INV_PRT_CTRL_PK
            AND IPC.EZCANCELFLAG = IPBT.EZCANCELFLAG(+)
            AND IPC.GLBL_CMPY_CD = IPBT.GLBL_CMPY_CD(+)
            AND IPC.INV_PRT_BAT_TP_CD = IPBT.INV_PRT_BAT_TP_CD(+)
            AND IPC.EZCANCELFLAG = IPB.EZCANCELFLAG(+)
            AND IPC.GLBL_CMPY_CD = IPB.GLBL_CMPY_CD(+)
            AND IPC.INV_PRT_BR_CD = IPB.INV_PRT_BR_CD(+)
           <isNull property="reprintMode">
            AND IPC.REPR_RPT_BR_NUM IS NULL
           </isNull>
           <isNotNull property="reprintMode">
            AND IPC.REPR_RPT_BR_NUM IS NOT NULL
           </isNotNull>
        ORDER BY 4, 7, 8, 9, 6, 2
    </statement>

    <!-- Get Audit Trail Report -->
    <statement id="getAuditTrailReport" parameterClass="Map" resultClass="Map">
        SELECT
            IPC.CONSL_BILL_NUM      AS NUM
           ,IPC.BILL_TO_CUST_CD     AS CUST_CD
           ,TO_CHAR(SYSDATE, 'MM/DD/YYYY HH:MI:SS AM') AS AUD_TRAIL_RPT_TS_PRINT_TXT
           ,#dollarMark#||TO_CHAR(IPC.CONSL_BILL_TOT_AMT, 'FM999G999G999G999G990D00')  AS AMT
           ,INITCAP(TO_CHAR(TO_DATE(IPC.CONSL_BILL_INV_DT, 'YYYY/MM/DD'), 'MONTHDD, YYYY'))   AS INV_DT
           ,IPH.BILL_TO_POST_CD
           <!-- 2019/02/25 S21_NA#30461 Add Start -->
           ,'Y' AS CONSL_FLG
           ,NULL AS ORD_CLS_NM
           <!-- 2019/02/25 S21_NA#30461 Add End -->
        FROM INV_PRT_CTRL IPC
            ,INV_PRT_HDR IPH
        WHERE
            IPC.GLBL_CMPY_CD = #glblCmpyCd#
        AND IPC.EZCANCELFLAG = '0'
        AND IPC.INV_PRT_CTRL_REC_CD = #invPrtCtrlRecCd#
        AND IPC.INV_PRT_PROC_STS_CD = #invPrtProcStsCd#
        AND IPC.INV_OTPT_REQ_FLG = #invOtptReqFlg#
        <isNotNull property="invPrtBatTpCd">
        AND IPC.INV_PRT_BAT_TP_CD = #invPrtBatTpCd#
        </isNotNull>
        <isNotNull property="invPrtBrCd">
        AND IPC.INV_PRT_BR_CD = #invPrtBrCd#
        </isNotNull>
        <isNotNull property="invPrtBrBatTpNull">
        AND IPC.INV_PRT_BAT_TP_CD IS NULL
        AND IPC.INV_PRT_BR_CD IS NULL
        </isNotNull>
        AND IPH.GLBL_CMPY_CD = #glblCmpyCd#
        AND IPH.EZCANCELFLAG = '0'
        AND IPC.INV_PRT_CTRL_PK = IPH.INV_PRT_CTRL_PK
        <isNotNull property="reprintMode">
        AND IPC.REPR_RPT_BR_NUM = #reprRptBrNum#
        </isNotNull>
        UNION ALL
        SELECT
           DISTINCT <!-- 2019/02/25 S21_NA#30461 Add -->
            IPC.INV_NUM             AS NUM
           ,IPC.BILL_TO_CUST_CD     AS CUST_CD
           ,TO_CHAR(SYSDATE, 'MM/DD/YYYY HH:MI:SS AM') AS AUD_TRAIL_RPT_TS_PRINT_TXT
           ,#dollarMark#||TO_CHAR(I.INV_TOT_DEAL_NET_AMT, 'FM999G999G999G999G990D00')  AS AMT
           ,INITCAP(TO_CHAR(TO_DATE(I.INV_DT, 'YYYY/MM/DD'), 'MONTHDD, YYYY'))  AS INV_DT
           ,IPH.BILL_TO_POST_CD
           <!-- 2019/02/25 S21_NA#30461 Add Start -->
           ,'N' AS CONSL_FLG
           ,IPS.ORD_CLS_NM AS ORD_CLS_NM
           <!-- 2019/02/25 S21_NA#30461 Add End -->
        FROM INV_PRT_CTRL IPC
            ,INV I
            ,INV_PRT_HDR IPH
            ,INV_PRT_SMRY IPS <!-- 2019/02/25 S21_NA#30461 Add -->
        WHERE
            IPC.GLBL_CMPY_CD = #glblCmpyCd#
        AND IPC.EZCANCELFLAG = '0'
        AND IPC.INV_PRT_CTRL_REC_CD &lt;&gt; #invPrtCtrlRecCd#
        AND IPC.INV_PRT_PROC_STS_CD = #invPrtProcStsCd#
        AND IPC.INV_OTPT_REQ_FLG = #invOtptReqFlg#
        AND IPC.CONSL_BILL_NUM IS NULL
        AND IPC.GLBL_CMPY_CD = I.GLBL_CMPY_CD
        AND IPC.EZCANCELFLAG = I.EZCANCELFLAG
        AND IPC.INV_NUM = I.INV_NUM
        <!-- 2019/02/25 S21_NA#30461 Add Start -->
        AND IPC.GLBL_CMPY_CD = IPS.GLBL_CMPY_CD
        AND IPC.INV_NUM = IPS.INV_BILL_NUM
        AND IPS.ORD_CLS_NM IS NOT NULL
        AND IPS.EZCANCELFLAG = '0'
        <!-- 2019/02/25 S21_NA#30461 Add End -->
        <isNotNull property="invPrtBatTpCd">
        AND IPC.INV_PRT_BAT_TP_CD = #invPrtBatTpCd#
        </isNotNull>
        <isNotNull property="invPrtBrCd">
        AND IPC.INV_PRT_BR_CD = #invPrtBrCd#
        </isNotNull>
        <isNotNull property="invPrtBrBatTpNull">
        AND IPC.INV_PRT_BAT_TP_CD IS NULL
        AND IPC.INV_PRT_BR_CD IS NULL
        </isNotNull>
        AND IPH.GLBL_CMPY_CD = #glblCmpyCd#
        AND IPH.EZCANCELFLAG = '0'
        AND IPC.INV_PRT_CTRL_PK = IPH.INV_PRT_CTRL_PK
        <isNotNull property="reprintMode">
        AND IPC.REPR_RPT_BR_NUM = #reprRptBrNum#
        </isNotNull>
        ORDER BY 6, 2, 1
    </statement>

    <!-- For Creating PDF -->
    <statement id="selectInvPrtCtrlForPDF" parameterClass="Map" resultClass="Map">
        SELECT
            'B'                   AS TYPE
           ,IPC.CONSL_BILL_NUM    AS NUM
           ,INV_PRT_CTRL_PK
           ,'Y' CONSL_BILL_FLG
        FROM INV_PRT_CTRL IPC
        WHERE
                IPC.GLBL_CMPY_CD = #glblCmpyCd#
            AND IPC.EZCANCELFLAG = '0'
            AND IPC.INV_PRT_CTRL_REC_CD = #invPrtCtrlRecCd#
            AND IPC.INV_FTP_PROC_STS_CD =  #invFtpProcStsCd#
        UNION ALL
        SELECT
            'I'                   AS TYPE
           ,IPC.INV_NUM           AS NUM
           ,INV_PRT_CTRL_PK
           ,'N' CONSL_BILL_FLG
        FROM INV_PRT_CTRL IPC
        WHERE
                IPC.GLBL_CMPY_CD = #glblCmpyCd#
            AND IPC.EZCANCELFLAG = '0'
            AND IPC.INV_PRT_CTRL_REC_CD &lt;&gt; #invPrtCtrlRecCd#
            AND IPC.INV_FTP_PROC_STS_CD =  #invFtpProcStsCd#
        ORDER BY 1, 2
    </statement>
    
    <statement id="getDeleteAudTrailRptWrk" parameterClass="Map" resultClass="Map">
        SELECT
            AUD.AUD_TRAIL_RPT_WRK_PK
        FROM
            AUD_TRAIL_RPT_WRK AUD
        WHERE
            AUD.EZCANCELFLAG = '0'
        AND AUD.GLBL_CMPY_CD = #glblCmpyCd#
        AND SUBSTR(AUD.AUD_TRAIL_PROC_TS, 1, 8) &lt;= #clensDt#
    </statement>

    <statement id="getEIPResult" parameterClass="Map" resultClass="Map">
        SELECT
            ER.RPT_RQST_STS_TXT
        FROM
            EIP_RPT_RQST ER
        WHERE
            ER.EZCANCELFLAG = '0'
        AND ER.GLBL_CMPY_CD = #glblCmpyCd#
        AND ER.EIP_RPT_RQST_PK = #requestPk#
    </statement>
    <statement id="getEIPResultChk" parameterClass="Map" resultClass="Map">
        SELECT
            ER.EIP_RPT_RQST_PK
           ,ER.RPT_TTL_NM
           ,ER.RPT_RQST_STS_TXT
        FROM
            EIP_RPT_RQST ER
        WHERE
            ER.EZCANCELFLAG = '0'
        AND ER.GLBL_CMPY_CD = #glblCmpyCd#
        AND (ER.RPT_RQST_STS_TXT &lt;&gt; 'SUCCESS'
        OR ER.RPT_RQST_STS_TXT IS NULL)
        <!-- AND ER.RPT_RQST_STS_TXT = 'SUCCESS' -->
        AND ER.EIP_RPT_PROC_LOG_PK = #eipRptProcLogPk#
    </statement>
</sqlMap>
