<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPZC131001">
    <statement id="searchPo" parameterClass="Map" resultClass="Map">
        SELECT
             PO.VND_CD
            ,PO.PO_STS_CD
            ,PO.INVTY_LOC_CD
            ,PO.PO_SUBMT_PSN_CD
            ,PO.PO_SUBMT_TS
            ,PO.PO_APVL_PSN_CD
            ,PO.PO_APVL_DT
            ,PO.PO_APVL_TS
            ,PO.PO_ORD_SRC_CD
            ,PO.VND_CD
            ,PO.VND_NM
            ,PO.VND_DROP_SHIP_FLG
            ,PO.PO_ORD_CMNT_TXT
            ,PO.PO_SEND_FLG
            ,PO.PO_PRINT_FLG
            ,PO.VND_ISS_ORD_NUM
            ,PO.DS_PO_TP_CD
            ,PO.DS_PO_TP_NM
            ,PO.PO_QLFY_CD
            ,PO.PO_APVL_STS_CD
            ,PO.DEST_RTL_WH_CD
            ,PO.SRC_RTL_WH_CD
            ,PO.PRNT_VND_CD
            ,PO.PRNT_VND_NM
            ,PO.PRCH_GRP_CD
            ,PO.VND_PMT_TERM_CD
            ,PO.VND_PMT_TERM_DESC_TXT
            ,PO.RQST_TECH_TOC_CD
            ,PO.RQST_RCV_DT
            ,PO.RQST_RCV_TM
            ,PO.RTRN_SHIP_TO_RTL_WH_CD
            ,PO.SHIP_FROM_SO_NUM_LIST_TXT
            ,PO.CARR_ACCT_NUM
            ,PO.LINE_BIZ_TP_CD
            ,PO.TRSMT_METH_TP_CD
            ,PO.SEND_PO_FAX_NUM
            ,PO.SEND_PO_EML_ADDR
            ,PO.PO_SEND_TS
            ,PO_STS.OPEN_PO_FLG
        FROM
             PO
            ,VAR_CHAR_CONST
            ,PO_STS
        WHERE
                PO.GLBL_CMPY_CD                  = #GLBL_CMPY_CD#
            AND PO.PO_ORD_NUM                    = #PO_ORD_NUM#
            AND PO.EZCANCELFLAG                  = '0'
            AND PO.GLBL_CMPY_CD                  = VAR_CHAR_CONST.GLBL_CMPY_CD
            AND VAR_CHAR_CONST.VAR_CHAR_CONST_NM = #VAR_CHAR_CONST_NM#
            AND VAR_CHAR_CONST.EZCANCELFLAG      = '0'
            AND NVL(PO.PO_QLFY_CD,' ')        = NVL(VAR_CHAR_CONST.VAR_CHAR_CONST_VAL,' ')
            AND PO.GLBL_CMPY_CD                  = PO_STS.GLBL_CMPY_CD
            AND PO.PO_STS_CD                     = PO_STS.PO_STS_CD
            AND PO_STS.EZCANCELFLAG              = '0'
    </statement>

    <statement id="searchPoDetail" parameterClass="Map" resultClass="Map">
        SELECT
             PO_DTL.PRCH_REQ_NUM
            ,PO_DTL.PRCH_REQ_LINE_NUM
            ,PO_DTL.PRCH_REQ_LINE_SUB_NUM
            ,PO_DTL.INVTY_LOC_CD
            ,PO_DTL.CUST_ISS_PO_NUM
            ,PO_DTL.PO_BAL_QTY
            ,PO_DTL.SHPG_PLN_NUM
            ,DS_INVTY_LOC_V.RTL_WH_CD
        FROM
             PO_DTL
            ,PO_STS
            ,DS_INVTY_LOC_V
        WHERE
                PO_DTL.GLBL_CMPY_CD                = #GLBL_CMPY_CD#
            AND PO_DTL.ORIG_PO_ORD_NUM             = #ORIG_PO_ORD_NUM#
            AND PO_DTL.ORIG_PO_ORD_DTL_LINE_NUM    = #ORIG_PO_ORD_DTL_LINE_NUM#
            AND PO_DTL.EZCANCELFLAG                = '0'
            AND PO_STS.GLBL_CMPY_CD                = PO_DTL.GLBL_CMPY_CD
            AND PO_STS.PO_STS_CD                   = PO_DTL.PO_STS_CD
            AND PO_STS.OPEN_PO_FLG                 = #OPEN_PO_FLG#
            AND PO_STS.EZCANCELFLAG                = '0'
            AND DS_INVTY_LOC_V.GLBL_CMPY_CD        = PO_DTL.GLBL_CMPY_CD
            AND DS_INVTY_LOC_V.INVTY_LOC_CD        = PO_DTL.INVTY_LOC_CD
            AND DS_INVTY_LOC_V.EZCANCELFLAG        = '0'
    </statement>

    <statement id="getPoDetail" parameterClass="Map" resultClass="Map">
        SELECT
             PO_DTL.PO_ORD_NUM
            ,PO_DTL.PO_ORD_DTL_LINE_NUM
            ,PO_DTL.MDSE_CD
            ,PO_DTL.PO_BAL_QTY
            ,PO_DTL.PO_QTY
            ,PO_DTL.PO_CANC_QTY
            ,PO_DTL.PO_RCV_QTY
            ,PO_DTL.SHPG_PLN_NUM
            ,PO_DTL.SHIP_TO_CUST_CD
            ,PO_DTL.SHIP_TO_LOC_NM
            ,PO_DTL.ADMIN_PSN_CD
            ,PO_DTL.SHIP_TO_ADDL_LOC_NM
            ,PO_DTL.SHIP_TO_FIRST_LINE_ADDR
            ,PO_DTL.SHIP_TO_SCD_LINE_ADDR
            ,PO_DTL.SHIP_TO_THIRD_LINE_ADDR
            ,PO_DTL.SHIP_TO_FRTH_LINE_ADDR
            ,PO_DTL.SHIP_TO_FIRST_REF_CMNT_TXT
            ,PO_DTL.SHIP_TO_SCD_REF_CMNT_TXT
            ,PO_DTL.SHIP_TO_CTY_ADDR
            ,PO_DTL.SHIP_TO_ST_CD
            ,PO_DTL.SHIP_TO_PROV_NM
            ,PO_DTL.SHIP_TO_CNTY_NM
            ,PO_DTL.SHIP_TO_POST_CD
            ,PO_DTL.SHIP_TO_CTRY_CD
            ,PO_DTL.CARR_CD
            ,PO_DTL.SHPG_SVC_LVL_CD
            ,PO_DTL.FRT_CHRG_TO_CD
            ,PO_DTL.FRT_CHRG_METH_CD
            ,PO_DTL.THIS_MTH_FOB_COST_AMT
            ,PO_DTL.CUST_UOM_CD
            ,PO_DTL.ORD_QTY
            ,PO_DTL.CPO_ORD_NUM
            ,PO_DTL.CPO_DTL_LINE_NUM
            ,PO_DTL.CPO_DTL_LINE_SUB_NUM
            ,PO_DTL.CUST_ISS_PO_NUM
            ,PO_DTL.CUST_ISS_PO_DT
            ,PO_DTL.CPO_ORD_TP_CD
            ,PO_DTL.BILL_TO_CUST_CD
            ,PO_DTL.SELL_TO_CUST_CD
            ,PO_DTL.PO_ORD_DTL_CMNT_TXT
            ,PO_DTL.CCY_CD
            ,PO_DTL.CTAC_PSN_NM
            ,PO_DTL.SHIP_TO_ACCT_NM
            ,PO_DTL.DISP_PO_DTL_LINE_NUM
            ,PO_DTL.PO_LINE_TP_CD
            ,PO_DTL.PO_MDSE_CMPSN_TP_CD
            ,PO_DTL.SET_PO_ORD_DTL_LINE_NUM
            ,PO_DTL.MDSE_DESC_SHORT_TXT
            ,PO_DTL.PO_DISP_QTY
            ,PO_DTL.PO_INV_QTY
            ,PO_DTL.PO_DISP_UOM_CD
            ,PO_DTL.ENT_DEAL_NET_UNIT_PRC_AMT
            ,PO_DTL.ENT_PO_DTL_DEAL_NET_AMT
            ,PO_DTL.ENT_FUNC_NET_UNIT_PRC_AMT
            ,PO_DTL.ENT_PO_DTL_FUNC_NET_AMT
            ,PO_DTL.EXCH_RATE
            ,PO_DTL.DEST_RTL_SWH_CD
            ,PO_DTL.SRC_RTL_SWH_CD
            ,PO_DTL.INVTY_LOC_CD
            ,PO_DTL.RQST_RCV_DT
            ,PO_DTL.RQST_RCV_TM
            ,PO_DTL.FRT_COND_CD
            ,PO_DTL.ORIG_MDSE_CD
            ,PO_DTL.FROM_STK_STS_CD
            ,PO_DTL.TO_STK_STS_CD
            ,PO_DTL.PO_MATCH_TP_CD
            ,PO_DTL.PRCH_REQ_NUM
            ,PO_DTL.PRCH_REQ_LINE_NUM
            ,PO_DTL.PRCH_REQ_LINE_SUB_NUM
            ,PO_DTL.TRX_REF_NUM
            ,PO_DTL.TRX_REF_LINE_NUM
            ,PO_DTL.TRX_REF_LINE_SUB_NUM
            ,PO_DTL.ASL_DTL_PK
            ,PO_DTL.ASL_MDSE_CD
            ,PO_DTL.ASL_UNIT_PRC_AMT
            ,PO_DTL.SHIP_FROM_SO_NUM_LIST_TXT
            ,PO_DTL.VND_INVTY_LOC_CD
            ,PO_DTL.VND_ISS_PO_ORD_NUM
            ,PO_DTL.PRO_NUM
            ,PO_DTL.VND_PO_ACK_STS_CD
            ,PO_DTL.ORIG_DISP_PO_DTL_LINE_NUM
            ,PO_DTL.SVC_CONFIG_MSTR_PK
            ,PO_DTL.PO_SEND_TS
            ,SHPG_PLN.BOL_NUM
            ,SHPG_PLN.CARR_NM
            ,SHPG_PLN.PRO_NUM
            ,SHPG_PLN.TRX_HDR_NUM
            ,SHPG_PLN.TRX_LINE_NUM
            ,SHPG_PLN.TRX_LINE_SUB_NUM
            ,SHPG_PLN.SLS_REP_TOC_CD
            ,TRX_SRC_TP.CPO_EXST_FLG
        FROM
             PO_DTL
            ,PO_STS
            ,SHPG_PLN
            ,TRX_SRC_TP
        WHERE
                PO_DTL.GLBL_CMPY_CD                = #GLBL_CMPY_CD#
            AND PO_DTL.ORIG_PO_ORD_NUM             = #ORIG_PO_ORD_NUM#
            AND PO_DTL.ORIG_PO_ORD_DTL_LINE_NUM    = #ORIG_PO_ORD_DTL_LINE_NUM#
            AND PO_STS.GLBL_CMPY_CD                = PO_DTL.GLBL_CMPY_CD
            AND PO_STS.PO_STS_CD                   = PO_DTL.PO_STS_CD
            AND PO_STS.OPEN_PO_FLG                 = #OPEN_PO_FLG#
            AND SHPG_PLN.GLBL_CMPY_CD              = PO_DTL.GLBL_CMPY_CD
            AND SHPG_PLN.SHPG_PLN_NUM              = PO_DTL.SHPG_PLN_NUM
            AND TRX_SRC_TP.GLBL_CMPY_CD            = PO_DTL.GLBL_CMPY_CD
            AND TRX_SRC_TP.TRX_SRC_TP_CD           = SHPG_PLN.TRX_SRC_TP_CD
            AND PO_DTL.EZCANCELFLAG                = '0'
            AND PO_STS.EZCANCELFLAG                = '0'
            AND SHPG_PLN.EZCANCELFLAG              = '0'
            AND TRX_SRC_TP.EZCANCELFLAG            = '0'
            AND NOT EXISTS 
                    (SELECT 
                            1
                     FROM 
                         SHPG_ORD_DTL SOD
                     WHERE 1 = 1
                     AND SHPG_PLN.GLBL_CMPY_CD = SOD.GLBL_CMPY_CD
                     AND SHPG_PLN.SHPG_PLN_NUM = SOD.SHPG_PLN_NUM
                     AND SHPG_PLN.EZCANCELFLAG = '0')
            ORDER BY
                PO_DTL.PO_ORD_DTL_LINE_NUM
    </statement>

    <statement id="getCarrNm" parameterClass="Map" resultClass="String">
        SELECT
             CARR_NM
        FROM
             OTBD_CARR_V
        WHERE
                GLBL_CMPY_CD       = #GLBL_CMPY_CD#
            AND CARR_CD            = #CARR_CD#
            AND EZCANCELFLAG       = '0'
    </statement>

    <statement id="getShpgPlnNum" parameterClass="Map" resultClass="String">
        SELECT
             S.SHPG_PLN_NUM
        FROM
             PO_DTL       P
            ,SHPG_PLN     S
        WHERE
                P.GLBL_CMPY_CD          = #GLBL_CMPY_CD#
            AND P.PO_ORD_NUM            = #PO_ORD_NUM#
            AND P.PO_ORD_DTL_LINE_NUM   = #PO_ORD_DTL_LINE_NUM#
            AND P.EZCANCELFLAG          = '0'
            AND P.GLBL_CMPY_CD          = S.GLBL_CMPY_CD
            AND P.CPO_ORD_NUM           = S.TRX_HDR_NUM
            AND P.CPO_DTL_LINE_NUM      = S.TRX_LINE_NUM
            AND P.CPO_DTL_LINE_SUB_NUM  = S.TRX_LINE_SUB_NUM
            AND S.SHPG_STS_CD           = #SHPG_STS_CD#
            AND S.RTE_STS_CD            = #RTE_STS_CD#
            AND S.SO_CLOSE_FLG          = #SO_CLOSE_FLG#
            AND S.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getMaxNextPoOrdDtlLineNum" parameterClass="Map" resultClass="String">
        SELECT
             TO_CHAR(MAX(PO_ORD_DTL_LINE_NUM)+1,'FM000') PO_ORD_DTL_LINE_NUM
        FROM
             PO_DTL
        WHERE
                GLBL_CMPY_CD       = #GLBL_CMPY_CD#
            AND PO_ORD_NUM         = #PO_ORD_NUM#
            AND EZCANCELFLAG       = '0'
    </statement>

    <statement id="getRwsRefNum" parameterClass="Map" resultClass="String">
            SELECT
                RWS_REF_NUM
            FROM
                RWS_HDR           R
            WHERE 1=1
            AND GLBL_CMPY_CD      = #glblCmpyCd#
             <isNotNull property="whCd">
            AND WH_CD             = #whCd#
            </isNotNull>
            AND RWS_REF_NUM       = #rwsRefNum#
            AND EZCANCELFLAG      = '0'
    </statement>

    <statement id="getMaxRwsRefNum" parameterClass="Map" resultClass="String">
            SELECT
                MAX(R.RWS_REF_NUM)    R_RWS_REF_NUM
            FROM
                RWS_HDR               R
            WHERE 1=1
            AND R.GLBL_CMPY_CD        = #glblCmpyCd#
            AND R.WH_CD               = #whCd#
            AND REGEXP_LIKE(R.RWS_REF_NUM, #rwsRefNum#)
            AND R.EZCANCELFLAG        = '0'
            GROUP BY
                R.WH_CD
    </statement>

    <statement id="getPoRcvInfo" parameterClass="Map" resultClass="Map">
        SELECT
             PO_RCV_HDR.PO_RCV_NUM
            ,PO_RCV_HDR.DOM_INV_NUM
            ,PO_RCV_DTL.PO_RCV_LINE_NUM
            ,PO_RCV_DTL.MDSE_CD
            ,PO_RCV_DTL.PO_RCV_QTY
            ,PO_RCV_DTL.PO_RCV_LINE_NUM DS_PO_RCV_LINE_NUM
            ,PO_RCV_DTL.ASN_SO_NUM
            ,PO_RCV_DTL.BOL_NUM
            ,PO_RCV_DTL.PRO_NUM
            ,PO.VND_CD
            ,PO.VND_NM
            ,PO_DTL.PO_ORD_NUM
            ,PO_DTL.PO_ORD_DTL_LINE_NUM
            ,PO_DTL.MDSE_CD PO_DTL_MDSE_CD
            ,PO_DTL.SHIP_TO_CUST_CD
            ,PO_DTL.SHIP_TO_LOC_NM
            ,PO_DTL.CPO_ORD_NUM
            ,PO_DTL.CPO_DTL_LINE_NUM
            ,PO_DTL.CPO_DTL_LINE_SUB_NUM
            ,PO_RCV_DTL.STK_STS_CD
            ,PO_DTL.ORIG_PO_ORD_DTL_LINE_NUM
            ,SHPG_PLN.SHPG_PLN_NUM
            ,SHPG_PLN.SET_MDSE_CD
            ,DS_INVTY_LOC_V.INVTY_LOC_NM
            ,DS_INVTY_LOC_V.INVTY_LOC_CD
        FROM
             PO_RCV_HDR
            ,PO_RCV_DTL
            ,PO
            ,PO_DTL
            ,SHPG_PLN
            ,DS_INVTY_LOC_V
        WHERE
                PO_RCV_HDR.GLBL_CMPY_CD          = #GLBL_CMPY_CD#
            AND PO_RCV_HDR.PO_RCV_NUM            = #PO_RCV_NUM#
            AND PO_RCV_HDR.EZCANCELFLAG          = '0'
            AND PO_RCV_HDR.GLBL_CMPY_CD          = PO_RCV_DTL.GLBL_CMPY_CD
            AND PO_RCV_HDR.PO_RCV_NUM            = PO_RCV_DTL.PO_RCV_NUM
            AND PO_RCV_DTL.EZCANCELFLAG          = '0'
            AND PO_RCV_HDR.GLBL_CMPY_CD          = PO.GLBL_CMPY_CD
            AND PO_RCV_HDR.PO_RCV_TRX_HDR_NUM    = PO.PO_ORD_NUM
            AND PO.EZCANCELFLAG                  = '0'
            AND PO_RCV_HDR.GLBL_CMPY_CD          = PO_DTL.GLBL_CMPY_CD
            AND PO_RCV_HDR.PO_RCV_TRX_HDR_NUM    = PO_DTL.PO_ORD_NUM
            AND PO_RCV_DTL.PO_RCV_TRX_LINE_NUM   = PO_DTL.PO_ORD_DTL_LINE_NUM
            AND PO_DTL.EZCANCELFLAG              = '0'
            AND PO_DTL.GLBL_CMPY_CD              = SHPG_PLN.GLBL_CMPY_CD
            AND PO_DTL.SHPG_PLN_NUM              = SHPG_PLN.SHPG_PLN_NUM
            AND SHPG_PLN.EZCANCELFLAG            = '0'
            AND PO_DTL.GLBL_CMPY_CD              = DS_INVTY_LOC_V.GLBL_CMPY_CD
            AND PO_DTL.INVTY_LOC_CD              = DS_INVTY_LOC_V.INVTY_LOC_CD
            AND DS_INVTY_LOC_V.EZCANCELFLAG      = '0'
        ORDER BY
            PO_DTL.PO_ORD_NUM
           ,PO_DTL.PO_ORD_DTL_LINE_NUM
    </statement>

    <statement id="findIBTrac" parameterClass="Map" resultClass="String">
        SELECT
             DMI.MDSE_CD
        FROM
             MDSE DMI
        WHERE
                DMI.GLBL_CMPY_CD        = #GLBL_CMPY_CD#
            AND DMI.MDSE_CD             = #MDSE_CD#
            AND DMI.INSTL_BASE_CTRL_FLG = 'Y'
            AND DMI.EZCANCELFLAG        = '0'
    </statement>

    <statement id="getDivideShpgPlnNum" parameterClass="Map" resultClass="String">
    SELECT
        SHPG_PLN_NUM
    FROM
    (   SELECT 
            SP.SHPG_PLN_NUM
        FROM 
            PO_DTL   PD
           ,SHPG_PLN SP
        WHERE 1 = 1
        AND PD.GLBL_CMPY_CD          = #glblCmpyCd#
        AND PD.PO_ORD_NUM            = #poOrdNum#
        AND PD.PO_ORD_DTL_LINE_NUM   = #poOrdDtlLineNum#
        AND PD.EZCANCELFLAG          = '0'
        AND PD.CPO_ORD_NUM           = SP.TRX_HDR_NUM
        AND PD.CPO_DTL_LINE_NUM      = SP.TRX_LINE_NUM
        AND PD.CPO_DTL_LINE_SUB_NUM  = SP.TRX_LINE_SUB_NUM
        AND SP.SHPG_STS_CD           = #shpgStsCd#
        AND SP.PO_REQ_FLG            = 'Y'
        AND SP.SO_CLOSE_FLG          = 'Y'
        AND SP.EZCANCELFLAG          = '0'
        AND NOT EXISTS 
                    (SELECT 
                            1
                     FROM 
                         SHPG_ORD_DTL SOD
                     WHERE 1 = 1
                     AND SP.GLBL_CMPY_CD = SOD.GLBL_CMPY_CD
                     AND SP.SHPG_PLN_NUM = SOD.SHPG_PLN_NUM
                     AND SP.EZCANCELFLAG = '0')
        ORDER BY
            SP.ACTL_SHIP_DT DESC
           ,SP.SHPG_PLN_NUM DESC
       )
    WHERE ROWNUM = 1
    </statement>

    <statement id="getCmpsnChildQty" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            CMP.CHILD_MDSE_QTY
        FROM
            CMPSN CMP
        WHERE
            1=1
        AND CMP.GLBL_CMPY_CD           = #glblCmpyCd#
        AND CMP.PRNT_MDSE_CD           = #prntMdseCd#
        AND CMP.CHILD_MDSE_CD          = #childMdseCd#
        AND CMP.EZCANCELFLAG           = '0'
        UNION SELECT
            CMP.CHILD_MDSE_QTY
        FROM
             CMPSN CMP
            ,ORD_TAKE_MDSE OTM
        WHERE
            1=1
        AND CMP.GLBL_CMPY_CD           = #glblCmpyCd#
        AND CMP.PRNT_MDSE_CD           = #prntMdseCd#
        AND CMP.CHILD_ORD_TAKE_MDSE_CD = OTM.ORD_TAKE_MDSE_CD
        AND OTM.MDSE_CD                = #childMdseCd#
        AND CMP.EZCANCELFLAG           = '0'
        AND OTM.EZCANCELFLAG           = '0'
    </statement>

</sqlMap>
