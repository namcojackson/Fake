<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NPAL1230Query">

    <typeAlias alias="NPAL1230CMsg"     type="business.blap.NPAL1230.NPAL1230CMsg" />
    <typeAlias alias="NPAL1230SMsg"     type="business.blap.NPAL1230.NPAL1230SMsg" />
    <typeAlias alias="NPAL1230_ASMsg"   type="business.blap.NPAL1230.NPAL1230_ASMsg" />
    <typeAlias alias="NPAL1230_QSMsg"   type="business.blap.NPAL1230.NPAL1230_QSMsg" />
    <typeAlias alias="ASL_DTLTMsg"      type="business.db.ASL_DTLTMsg" />

    <statement id="getMerchandiseTypePulldownList" parameterClass="Map" resultClass="Map">
        SELECT
            CP.COA_PROJ_CD
           ,CP.COA_PROJ_DESC_TXT
        FROM
            COA_PROJ CP
        WHERE
                CP.GLBL_CMPY_CD     = #glblCmpyCd#
            AND CP.EZCANCELFLAG     = '0'
        ORDER BY
            CP.COA_PROJ_SORT_NUM ASC
    </statement>

    <statement id="getUomTypePulldownList" parameterClass="Map" resultClass="Map">
        SELECT
            VU.VND_UOM_CD
           ,VU.VND_UOM_DESC_TXT
        FROM
            VND_UOM VU
        WHERE
                VU.GLBL_CMPY_CD     = #glblCmpyCd#
            AND VU.EZCANCELFLAG     = '0'
        ORDER BY
            VU.VND_UOM_SORT_NUM ASC
    </statement>

    <statement id="getItemDescription" parameterClass="Map" resultClass="String">
        SELECT
            DMI.MDSE_DESC_SHORT_TXT
        FROM
            MDSE    DMI
        WHERE
                DMI.GLBL_CMPY_CD    = #glblCmpyCd#
            AND DMI.MDSE_CD         = #mdseCd#
            AND DMI.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getCoaMdseTp" parameterClass="Map" resultClass="String">
        SELECT
            CP.COA_PROJ_CD || ':' || CP.COA_PROJ_DESC_TXT AS XX_COMN_SCR_FIRST_VAL_TXT
        FROM
            COA_PROJ        CP
        WHERE
                CP.GLBL_CMPY_CD         = #glblCmpyCd#
            AND CP.COA_PROJ_CD          = #coaMdseTpCd#
            AND CP.EZCANCELFLAG         = '0'
    </statement>
    
        <statement id="getItemInfo" parameterClass="Map" resultClass="Map">
        SELECT
             DMI.MDSE_DESC_SHORT_TXT
            ,DMI.COA_MDSE_TP_CD || ':' || CP.COA_PROJ_DESC_TXT AS XX_COMN_SCR_FIRST_VAL_TXT
            
        FROM
             MDSE                DMI
            ,COA_PROJ            CP
        WHERE 1=1
            AND DMI.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DMI.MDSE_CD             = #mdseCd#
            AND DMI.EZCANCELFLAG        = '0'
            AND DMI.GLBL_CMPY_CD        = CP.GLBL_CMPY_CD
            AND DMI.COA_MDSE_TP_CD      = CP.COA_PROJ_CD
            AND CP.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getSupplierName" parameterClass="Map" resultClass="String">
        SELECT
              PV.PRNT_VND_NM
        FROM
              PRNT_VND PV
        WHERE
                PV.GLBL_CMPY_CD     = #glblCmpyCd#
            AND PV.PRNT_VND_CD      = #prntVndCd#
            AND PV.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getAslHdr" parameterClass="Map" resultMap="result.NPAL1230SMsg">
        SELECT
             AH.ASL_NM
            ,AH.ASL_START_DT
            ,AH.ASL_END_DT
            ,AH.PRNT_VND_CD
            ,AH.ASL_DESC_TXT
            ,AH.EZUPTIME
            ,AH.EZUPTIMEZONE
            ,PV.PRNT_VND_NM
        FROM
             ASL_HDR    AH
            ,PRNT_VND   PV
        WHERE
                AH.GLBL_CMPY_CD     = #glblCmpyCd#
            AND AH.ASL_HDR_PK       = #cMsg.aslHdrPk#
            AND AH.GLBL_CMPY_CD     = PV.GLBL_CMPY_CD
            AND AH.PRNT_VND_CD      = PV.PRNT_VND_CD
            AND AH.EZCANCELFLAG     = '0'
            AND PV.EZCANCELFLAG     = '0'
    </statement>

    <resultMap id="result.NPAL1230SMsg" class="NPAL1230SMsg">
        <result property="aslNm"                 column="ASL_NM"                 javaType="EZDSStringItem"/>
        <result property="aslStartDt"            column="ASL_START_DT"           javaType="EZDSStringItem"/>
        <result property="aslEndDt"              column="ASL_END_DT"             javaType="EZDSStringItem"/>
        <result property="prntVndCd"             column="PRNT_VND_CD"            javaType="EZDSStringItem"/>
        <result property="aslDescTxt"            column="ASL_DESC_TXT"           javaType="EZDSStringItem"/>
        <result property="ezUpTime"              column="EZUPTIME"               javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone"          column="EZUPTIMEZONE"           javaType="EZDSStringItem"/>
        <result property="prntVndNm"             column="PRNT_VND_NM"            javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="getAslQlfyReln" parameterClass="Map" resultMap="result.NPAL1230_QSMsg">
        SELECT
             AQR.ASL_QLFY_RELN_PK
            ,AQR.ASL_QLFY_TP_CD
            ,AQR.ASL_QLFY_REF_CD
        FROM
             ASL_HDR        AH
            ,ASL_QLFY_RELN  AQR
        WHERE
                AH.GLBL_CMPY_CD     = #glblCmpyCd#
            AND AH.ASL_HDR_PK       = #cMsg.aslHdrPk#
            AND AH.GLBL_CMPY_CD     = AQR.GLBL_CMPY_CD
            AND AH.ASL_HDR_PK       = AQR.ASL_HDR_PK
            AND AH.EZCANCELFLAG     = '0'
            AND AQR.EZCANCELFLAG    = '0'
        ORDER BY
            AQR.ASL_QLFY_REF_CD ASC
    </statement>

    <resultMap id="result.NPAL1230_QSMsg" class="NPAL1230_QSMsg">
        <result property="aslQlfyRelnPk_Q"       column="ASL_QLFY_RELN_PK"       javaType="EZDCBigDecimalItem"/>
        <result property="aslQlfyTpCd_Q"         column="ASL_QLFY_TP_CD"           javaType="EZDSStringItem"/>
        <result property="aslQlfyRefCd_Q"        column="ASL_QLFY_REF_CD"             javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="getAslDtl" parameterClass="Map" resultMap="result.NPAL1230_ASMsg">
        SELECT
            ADI.ASL_DTL_PK
           ,ADI.MDSE_CD
           ,ADI.MDSE_DESC_SHORT_TXT
           ,ADI.PRIM_SPLY_FLG
           ,ADI.COA_MDSE_TP_CD
           ,ADI.XX_COMN_SCR_FIRST_VAL_TXT
           ,ADI.VND_UOM_CD
           ,ADI.SPLY_ITEM_NUM
           ,ADI.VND_CD
           ,ADI.UNIT_PRC_AMT
           ,ADI.EFF_FROM_DT
           ,ADI.EFF_THRU_DT
           ,ADI.ASL_ITEM_CMNT_TXT
           ,ADI.VND_UOM_QTY
           ,ADI.BASE_ORD_QTY
           ,ADI.VND_MIN_ORD_QTY
           ,ADI.VND_INCR_ORD_QTY
           <!-- START 2018/01/12 S.Katsuma [QC#12226,ADD] -->
           ,ADI.LOC_NM
           <!-- END 2018/01/12 S.Katsuma [QC#12226,ADD] -->
           <!-- START 2018/04/11 K.Fukumura [QC#21170,ADD] -->
           ,ADI.VND_LT_DAYS_NUM
           <!-- END   2018/04/11 K.Fukumura [QC#21170,ADD] -->
           <!-- START 2023/01/25 S.Dong [QC#60966, ADD] -->
           ,ADI.VND_SHIP_LT_DAYS_NUM
           <!-- END 2023/01/25 S.Dong [QC#60966, ADD] -->
        FROM(
            SELECT
                AD.ASL_DTL_PK
               ,AD.MDSE_CD
               ,DMI.MDSE_DESC_SHORT_TXT
               ,AD.PRIM_SPLY_FLG
               ,AD.COA_MDSE_TP_CD
               ,AD.COA_MDSE_TP_CD || ':' || CP.COA_PROJ_DESC_TXT AS XX_COMN_SCR_FIRST_VAL_TXT
               ,AD.VND_UOM_CD
               ,AD.SPLY_ITEM_NUM
               ,AD.VND_CD
               ,AD.UNIT_PRC_AMT
               ,AD.EFF_FROM_DT
               ,AD.EFF_THRU_DT
               ,AD.ASL_ITEM_CMNT_TXT
               ,AD.VND_UOM_QTY
               ,AD.BASE_ORD_QTY
               ,AD.VND_MIN_ORD_QTY
               ,AD.VND_INCR_ORD_QTY
               <!-- START 2018/01/12 S.Katsuma [QC#12226,ADD] -->
               ,V.LOC_NM
               <!-- END 2018/01/12 S.Katsuma [QC#12226,ADD] -->
               <!-- START 2018/04/11 K.Fukumura [QC#21170,ADD] -->
               ,AD.VND_LT_DAYS_NUM
               <!-- END   2018/04/11 K.Fukumura [QC#21170,ADD] -->
               <!-- START 2023/01/25 S.Dong [QC#60966, ADD] -->
               ,AD.VND_SHIP_LT_DAYS_NUM
               <!-- END 2023/01/25 S.Dong [QC#60966, ADD] -->
            FROM
                ASL_DTL         AD
               ,COA_PROJ        CP
               ,MDSE            DMI
               <!-- START 2018/01/12 S.Katsuma [QC#12226,ADD] -->
               ,VND                V
               <!-- END 2018/01/12 S.Katsuma [QC#12226,ADD] -->
            WHERE
                    AD.GLBL_CMPY_CD         = #glblCmpyCd#
                AND AD.ASL_HDR_PK           = #cMsg.aslHdrPk#
            <isNotNull property="cMsg.mdseCd">
            <!-- START 2018/01/12 S.Katsuma [QC#12226,MOD] -->
                AND AD.MDSE_CD           LIKE #cMsg.mdseCd#
            <!-- END 2018/01/12 S.Katsuma [QC#12226,MOD] -->
            </isNotNull>
            <isNotNull property="cMsg.splyItemNum">
                AND AD.SPLY_ITEM_NUM        LIKE #cMsg.splyItemNum#
            </isNotNull>
            <isEqual property="cMsg.actvFlg" compareValue="Y">
                AND AD.EFF_FROM_DT          &lt;= #salesDate#
                AND NVL(AD.EFF_THRU_DT,'99991231') &gt;= #salesDate#
            </isEqual>
            <isNotNull property="cMsg.coaMdseTpCd_SL">
                AND AD.COA_MDSE_TP_CD       = #cMsg.coaMdseTpCd_SL#
            </isNotNull>
                AND AD.GLBL_CMPY_CD         = CP.GLBL_CMPY_CD(+)
                AND AD.COA_MDSE_TP_CD       = CP.COA_PROJ_CD(+)
                AND AD.GLBL_CMPY_CD         = DMI.GLBL_CMPY_CD(+)
                AND AD.MDSE_CD              = DMI.MDSE_CD(+)
                <!-- START 2018/01/12 S.Katsuma [QC#12226,ADD] -->
                AND AD.GLBL_CMPY_CD         = V.GLBL_CMPY_CD(+)
                AND AD.VND_CD               = V.VND_CD(+)
                <!-- END 2018/01/12 S.Katsuma [QC#12226,ADD] -->
                AND AD.EZCANCELFLAG         = '0'
                AND CP.EZCANCELFLAG(+)      = '0'
                AND DMI.EZCANCELFLAG(+)     = '0'
                <!-- START 2018/01/12 S.Katsuma [QC#12226,ADD] -->
                AND V.EZCANCELFLAG(+)     = '0'
                <!-- END 2018/01/12 S.Katsuma [QC#12226,ADD] -->
            ORDER BY
                AD.MDSE_CD      ASC
               ,AD.VND_CD       ASC
               ,AD.EFF_FROM_DT  ASC
            ) ADI
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <resultMap id="result.NPAL1230_ASMsg" class="NPAL1230_ASMsg">
        <result property="aslDtlPk_A"                column="ASL_DTL_PK"                javaType="EZDSBigDecimalItem"/>
        <result property="mdseCd_A"                  column="MDSE_CD"                   javaType="EZDSStringItem"/>
        <result property="mdseDescShortTxt_A"        column="MDSE_DESC_SHORT_TXT"       javaType="EZDSStringItem"/>
        <result property="primSplyFlg_A"             column="PRIM_SPLY_FLG"             javaType="EZDSStringItem"/>
        <result property="xxComnScrFirstValTxt_A"    column="XX_COMN_SCR_FIRST_VAL_TXT" javaType="EZDSStringItem"/>
        <result property="vndUomCd_A"                column="VND_UOM_CD"                javaType="EZDSStringItem"/>
        <result property="splyItemNum_A"             column="SPLY_ITEM_NUM"             javaType="EZDSStringItem"/>
        <result property="vndCd_A"                   column="VND_CD"                    javaType="EZDSStringItem"/>
        <result property="unitPrcAmt_A"              column="UNIT_PRC_AMT"              javaType="EZDSBigDecimalItem"/>
        <result property="effFromDt_A"               column="EFF_FROM_DT"               javaType="EZDSStringItem"/>
        <result property="effThruDt_A"               column="EFF_THRU_DT"               javaType="EZDSStringItem"/>
        <result property="aslItemCmntTxt_A"          column="ASL_ITEM_CMNT_TXT"         javaType="EZDSStringItem"/>
        <result property="vndUomQty_A"               column="VND_UOM_QTY"               javaType="EZDSBigDecimalItem"/>
        <result property="baseOrdQty_A"              column="BASE_ORD_QTY"              javaType="EZDSBigDecimalItem"/>
        <result property="vndIncrOrdQty_A"           column="VND_INCR_ORD_QTY"          javaType="EZDSBigDecimalItem"/>
        <result property="vndMinOrdQty_A"            column="VND_MIN_ORD_QTY"           javaType="EZDSBigDecimalItem"/>
        <!-- START 2018/01/12 S.Katsuma [QC#12226,ADD] -->
        <result property="locNm_A"                   column="LOC_NM"                    javaType="EZDSStringItem"/>
        <!-- END 2018/01/12 S.Katsuma [QC#12226,ADD] -->
        <!-- START 2018/04/11 K.Fukumura [QC#21170,ADD] -->
        <result property="vndLtDaysNum_A"            column="VND_LT_DAYS_NUM"           javaType="EZDSBigDecimalItem"/>
        <!-- START 2018/04/11 K.Fukumura [QC#21170,ADD] -->
        <!-- START 2023/01/25 S.Dong [QC#60966,ADD] -->
        <result property="vndShipLtDaysNum_A"        column="VND_SHIP_LT_DAYS_NUM"      javaType="EZDSBigDecimalItem"/>
        <!-- END 2023/01/25 S.Dong [QC#60966,ADD] -->
    </resultMap>

    <statement id="chkMdseCd" parameterClass="Map" resultClass="Integer">
        SELECT
                COUNT(M.MDSE_CD)
        FROM
                MDSE M
        WHERE
                M.GLBL_CMPY_CD      = #glblCmpyCd#
            AND M.MDSE_CD           = #mdseCd#
        <iterate property="rgtnStsCdList" var="rgtnStsCd[]" open="AND M.RGTN_STS_CD IN (" close=")" conjunction=",">
            #rgtnStsCd[]#
        </iterate>
            AND M.EZCANCELFLAG      = '0'
    </statement>

    <statement id="chkSupplier" parameterClass="Map" resultClass="Integer">
        SELECT
                COUNT(PV.PRNT_VND_PK)
        FROM
                PRNT_VND PV
        WHERE
                PV.GLBL_CMPY_CD     = #glblCmpyCd#
            AND PV.PRNT_VND_CD      = #prntVndCd#
            AND NVL(PV.INAC_DT,'99991231') &gt; #salesDate#
            AND PV.EZCANCELFLAG     = '0'
    </statement>

    <statement id="chkAslDtl" parameterClass="Map" resultClass="Integer">
        SELECT
                COUNT(AD.ASL_DTL_PK)
        FROM
                ASL_HDR            AH
               ,ASL_DTL            AD
        WHERE
                AH.GLBL_CMPY_CD         = #glblCmpyCd#
            AND AH.PRNT_VND_CD          = #prntVndCd#
            AND AH.GLBL_CMPY_CD         = AD.GLBL_CMPY_CD
            AND AH.ASL_HDR_PK           = AD.ASL_HDR_PK
        <isNotNull property="PKs">
                AND AD.ASL_DTL_PK NOT IN ($PKs$)
        </isNotNull>
            AND AD.VND_CD               = #vndCd#
            AND AD.MDSE_CD              = #mdseCd#
            AND (
                    #effFromDt# BETWEEN AD.EFF_FROM_DT AND NVL(AD.EFF_THRU_DT, '99991231')
                OR  #effThruDt# BETWEEN AD.EFF_FROM_DT AND NVL(AD.EFF_THRU_DT, '99991231')
            )
        <isEqual property="isAslQlfyRefFlg" compareValue="Y">
            AND EXISTS (
                    SELECT
                        1
                    FROM
                        ASL_QLFY_RELN       AQR
                    WHERE
                        AQR.GLBL_CMPY_CD    = AH.GLBL_CMPY_CD
                    AND AQR.ASL_HDR_PK      = AH.ASL_HDR_PK
                    AND AQR.ASL_QLFY_TP_CD  = #aslQlfyTpCd#
                    <iterate property="aslQlfyRefCdList" var="aslQlfyRefCd[]" open="AND AQR.ASL_QLFY_REF_CD IN (" close=")" conjunction=",">
                        #aslQlfyRefCd[]#
                    </iterate>
                    AND AQR.EZCANCELFLAG    = '0'
            )
            </isEqual>
            AND AH.EZCANCELFLAG         = '0'
            AND AD.EZCANCELFLAG         = '0'
    </statement>

    <statement id="chkSupplierSite" parameterClass="Map" resultClass="Integer">
        SELECT
                COUNT(PV.PRNT_VND_PK)
        FROM
                PRNT_VND PV
               ,VND      V
        WHERE
                PV.GLBL_CMPY_CD     = #glblCmpyCd#
            AND PV.PRNT_VND_CD      = #prntVndCd#
            AND PV.GLBL_CMPY_CD     = V.GLBL_CMPY_CD
            AND PV.PRNT_VND_PK      = V.PRNT_VND_PK
            AND V.VND_CD            = #vndCd#
        <iterate property="rgtnStsCdList" var="rgtnStsCd[]" open="AND V.RGTN_STS_CD IN (" close=")" conjunction=",">
            #rgtnStsCd[]#
        </iterate>
            AND PV.EZCANCELFLAG     = '0'
            AND V.EZCANCELFLAG      = '0'
    </statement>

    <statement id="getPrimSplyFlg" parameterClass="Map" resultMap="result.ASL_DTLTMsg">
        SELECT
             AD.GLBL_CMPY_CD
            ,AD.ASL_DTL_PK
            ,AD.MDSE_CD
            ,AD.PRIM_SPLY_FLG
            ,AD.EFF_FROM_DT
            ,AD.EFF_THRU_DT
        FROM
             ASL_DTL            AD
        WHERE
                AD.GLBL_CMPY_CD         = #glblCmpyCd#
            AND AD.MDSE_CD              = #mdseCd#
        <isNotNull property="PKs">
                AND AD.ASL_DTL_PK NOT IN ($PKs$)
        </isNotNull>
            AND AD.EZCANCELFLAG         = '0'
        ORDER BY
            AD.EFF_FROM_DT
    </statement>
    <resultMap id="result.ASL_DTLTMsg" class="ASL_DTLTMsg">
        <result property="glblCmpyCd"                column="GLBL_CMPY_CD"              javaType="EZDSStringItem"/>
        <result property="aslDtlPk"                  column="ASL_DTL_PK"                javaType="EZDSBigDecimalItem"/>
        <result property="mdseCd"                    column="MDSE_CD"                   javaType="EZDSStringItem"/>
        <result property="primSplyFlg"               column="PRIM_SPLY_FLG"             javaType="EZDSStringItem"/>
        <result property="effFromDt"                 column="EFF_FROM_DT"               javaType="EZDSStringItem"/>
        <result property="effThruDt"                 column="EFF_THRU_DT"               javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="chkAslNm" parameterClass="Map" resultMap="Integer">
        SELECT
             COUNT(AH.ASL_HDR_PK)
        FROM
             ASL_HDR    AH
        WHERE
                AH.GLBL_CMPY_CD     = #glblCmpyCd#
            AND UPPER(AH.ASL_NM)    = UPPER(#aslNm#)
            <!-- START 2018/07/02 S.Katsuma [QC#26849,ADD] -->
            <isNotNull property="prntVndCd">
            AND AH.PRNT_VND_CD      = #prntVndCd#
            <!-- END 2018/07/02 S.Katsuma [QC#26849,ADD] -->
            </isNotNull>
            AND AH.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getAslDtlPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             AD.ASL_DTL_PK
        FROM
             ASL_DTL            AD
        WHERE
                AD.GLBL_CMPY_CD         = #glblCmpyCd#
            AND AD.MDSE_CD              = #mdseCd#
            AND AD.VND_CD               = #vndCd#
            AND AD.EFF_FROM_DT          = #effFromDt#
            AND AD.EZCANCELFLAG         = '0'
    </statement>

    <!-- START 2018/01/12 S.Katsuma [QC#12226,ADD] -->
    <statement id="getSupplierSiteName" parameterClass="Map"
        resultClass="String">
        SELECT
              V.LOC_NM
        FROM
              VND V
        WHERE
                V.GLBL_CMPY_CD     = #glblCmpyCd#
            AND V.VND_CD           = #vndCd#
            AND V.EZCANCELFLAG     = '0'
    </statement>
    <!-- END 2018/01/12 S.Katsuma [QC#12226,ADD] -->

    <!--  START 2021/01/15 J.Evangelista [QC#58165,ADD] -->
    <statement id="getSupplierItemCodeMaxLength" parameterClass="Map" resultMap="String">
        SELECT
             DCC.DS_COND_CONST_VAL_TXT_02 AS MAX_LENGTH
        FROM
             DS_COND_CONST  DCC
        WHERE
                DCC.GLBL_CMPY_CD                = #glblCmpyCd#
            AND DCC.DS_COND_CONST_GRP_ID        = #srchOptAplId#
            AND DCC.DS_COND_CONST_VAL_TXT_01    = #vndCd#
            AND DCC.EZCANCELFLAG                = '0'
    </statement>
    <!--  END 2021/01/15 J.Evangelista [QC#58165,ADD] -->
</sqlMap>