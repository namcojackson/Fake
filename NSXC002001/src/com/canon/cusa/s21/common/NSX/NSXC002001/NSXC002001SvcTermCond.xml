<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sqlMap namespace="NSXC002001SvcTermCond">
    <typeAlias alias="DefSvcTermCondInfoBean" type="com.canon.cusa.s21.common.NSX.NSXC002001.DefSvcTermCondInfoBean"/>
    <statement id="getDefTermCond" parameterClass="Map" resultMap="result.DefSvcTermCondInfoBean">
        SELECT
             ATB.SVC_TERM_COND_ATTRB_PK
            ,DEF.SVC_TERM_ATTRB_DEF_VAL_TXT
            ,DEF.ATTRB_UPD_AVAL_FLG
        FROM
             SVC_TERM_COND_ATTRB     ATB
            ,SVC_TERM_COND_CATG      CAT
            ,(
                SELECT
                     DCT.SVC_TERM_COND_ATTRB_PK
                    ,DCT.SVC_TERM_ATTRB_DEF_VAL_TXT
                    ,DCT.ATTRB_UPD_AVAL_FLG
                FROM
                     MDSE                    MDS
                    ,DEF_COV_TERM_COND       DCT
                WHERE
                        MDS.GLBL_CMPY_CD                     = #glblCmpyCd#
                    AND MDS.MDSE_CD                          = #svcPgmMdseCd#
                    AND MDS.EZCANCELFLAG                     = '0'
                    AND MDS.GLBL_CMPY_CD                     = DCT.GLBL_CMPY_CD
                    AND MDS.SVC_COV_TMPL_TP_CD               = DCT.SVC_COV_TMPL_TP_CD
                <isEqual property="contrFlg" compareValue="Y">
                    AND DCT.ASG_CONTR_LVL_FLG                = 'Y'
                </isEqual>
                <isEqual property="machFlg" compareValue="Y">
                    AND DCT.ASG_MACH_LVL_FLG                 = 'Y'
                </isEqual>
                    AND DCT.COV_TERM_COND_ACTV_FLG           = 'Y'
                    AND DCT.EFF_FROM_DT                      &lt;= #slsDt#
                    AND NVL(DCT.EFF_THRU_DT, #defEffThruDt#) &gt;= #slsDt#
                    AND DCT.EZCANCELFLAG                     = '0'
            ) DEF
        WHERE
                ATB.GLBL_CMPY_CD                             = #glblCmpyCd#
        <isEqual property="contrFlg" compareValue="Y">
            AND ATB.SVC_TERM_ATTRB_CONTR_FLG                 = 'Y'
        </isEqual>
        <isEqual property="machFlg" compareValue="Y">
            AND ATB.SVC_TERM_ATTRB_MACH_FLG                  = 'Y'
        </isEqual>
            AND ATB.SVC_TERM_ATTRB_ACTV_FLG                  = 'Y'
            AND ATB.EFF_FROM_DT                              &lt;= #slsDt#
            AND NVL(ATB.EFF_THRU_DT, #defEffThruDt#)         &gt;= #slsDt#
            AND ATB.EZCANCELFLAG                             = '0'
            AND ATB.GLBL_CMPY_CD                             = CAT.GLBL_CMPY_CD
            AND ATB.SVC_TERM_COND_CATG_PK                    = CAT.SVC_TERM_COND_CATG_PK
            AND CAT.SVC_TERM_COND_CATG_ACTV_FLG              = 'Y'
            AND CAT.EFF_FROM_DT                              &lt;= #slsDt#
            AND NVL(CAT.EFF_THRU_DT, #defEffThruDt#)         &gt;= #slsDt#
            AND CAT.EZCANCELFLAG                             = '0'
            AND ATB.SVC_TERM_COND_ATTRB_PK                   = DEF.SVC_TERM_COND_ATTRB_PK(+)
        ORDER BY
             CAT.SVC_TERM_COND_CATG_SORT_NUM
            ,ATB.SVC_TERM_ATTRB_SORT_NUM
    </statement>

    <statement id="isExistTermCondForContrLvl" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            STC.SVC_TERM_COND_PK
        FROM
            SVC_TERM_COND          STC
        WHERE
                STC.GLBL_CMPY_CD = #glblCmpyCd#
            AND STC.DS_CONTR_PK  = #dsContrPk#
            AND STC.EZCANCELFLAG = '0'
            AND ROWNUM = 1
    </statement>

    <statement id="isExistTermCondForMachLvl" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            STC.SVC_TERM_COND_PK
        FROM
            SVC_TERM_COND          STC
        WHERE
                STC.GLBL_CMPY_CD     = #glblCmpyCd#
            AND STC.DS_CONTR_PK      = #dsContrPk#
            AND STC.DS_CONTR_DTL_PK  = #dsContrDtlPk#
            AND STC.EZCANCELFLAG     = '0'
            AND ROWNUM = 1
    </statement>

    <resultMap id="result.DefSvcTermCondInfoBean" class="DefSvcTermCondInfoBean">
        <result property="svcTermCondAttrbPk"       column="SVC_TERM_COND_ATTRB_PK"        javaType="BigDecimal"/>
        <result property="svcTermAttrbMapValCd"     column="SVC_TERM_ATTRB_DEF_VAL_TXT"    javaType="String"/>
        <result property="attrbUpdAvalFlg"          column="ATTRB_UPD_AVAL_FLG"            javaType="String"/>
    </resultMap>
</sqlMap>
