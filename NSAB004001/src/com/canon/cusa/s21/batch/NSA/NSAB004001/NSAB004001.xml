<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NSAB004001">
    <statement id="getDsContrPK4Active" parameterClass="Map" resultClass="Map">
        WITH
            IV_DS_CONTR AS(
                SELECT
                     C.GLBL_CMPY_CD AS GLBL_CMPY_CD
                    ,C.DS_CONTR_PK  AS DS_CONTR_PK
                FROM
                     DS_CONTR       C
<!-- START 2022/06/21 R.jin [QC#60216, MOD] -->
<!--                 ,DS_CONTR_STS_V V  -->                   
                WHERE
                         C.GLBL_CMPY_CD           =     #glblCmpyCd#
                     AND C.CONTR_VRSN_EFF_FROM_DT &lt;= #slsDt#
<!--                 AND C.GLBL_CMPY_CD           =     V.GLBL_CMPY_CD  -->
<!--                 AND C.DS_CONTR_PK            =     V.DS_CONTR_PK -->
<!--                 AND V.DS_CONTR_CTRL_STS_CD   =     #dsContrCtrlStsCd# -->
                     AND C.DS_CONTR_STS_CD        =     #dsContrStsCd#
                     AND C.EZCANCELFLAG           =     '0'
<!--                 AND V.EZCANCELFLAG           =     '0'  -->
            )
            ,IV_DS_CONTR_DTL AS (
                SELECT
                    DISTINCT
                     D.GLBL_CMPY_CD  AS GLBL_CMPY_CD
                    ,D.DS_CONTR_PK   AS DS_CONTR_PK
                FROM
                     DS_CONTR_DTL        D
<!--                 ,DS_CONTR_DTL_STS_V  V  -->
                WHERE
                        D.GLBL_CMPY_CD         =     #glblCmpyCd#
                    AND D.CONTR_EFF_FROM_DT    &lt;= #slsDt#
<!--                AND D.GLBL_CMPY_CD         =     V.GLBL_CMPY_CD  -->
<!--                AND D.DS_CONTR_DTL_PK      =     V.DS_CONTR_DTL_PK -->
<!--                AND V.DS_CONTR_CTRL_STS_CD =     #dsContrCtrlStsCd# -->
                    AND D.DS_CONTR_DTL_STS_CD  =     #dsContrCtrlStsCd#
                    AND D.EZCANCELFLAG         =     '0'
<!--                AND V.EZCANCELFLAG         =     '0' -->
            )
            ,IV_DS_CONTR_BLLG_MTR AS (
                SELECT
                    DISTINCT
                     D.GLBL_CMPY_CD  AS GLBL_CMPY_CD
                    ,D.DS_CONTR_PK   AS DS_CONTR_PK
                FROM
                     DS_CONTR_DTL             D
                    ,DS_CONTR_BLLG_MTR        M
<!--                ,DS_CONTR_BLLG_MTR_STS_V  V  -->
                WHERE
                        D.GLBL_CMPY_CD         =     #glblCmpyCd#
                    AND D.CONTR_EFF_FROM_DT    &lt;= #slsDt#
                    AND D.GLBL_CMPY_CD         =     M.GLBL_CMPY_CD
                    AND D.DS_CONTR_DTL_PK      =     M.DS_CONTR_DTL_PK
<!--                AND M.GLBL_CMPY_CD         =     V.GLBL_CMPY_CD  -->
<!--                AND M.DS_CONTR_BLLG_MTR_PK =     V.DS_CONTR_BLLG_MTR_PK  -->
<!--                AND V.DS_CONTR_CTRL_STS_CD =     #dsContrCtrlStsCd#  -->
<!--                AND D.DS_CONTR_DTL_STS_CD  =     #dsContrCtrlStsCd# -->
                    AND M.DS_CONTR_BLLG_MTR_STS_CD = #dsContrCtrlStsCd#
                    AND D.EZCANCELFLAG         =     '0'
                    AND M.EZCANCELFLAG         =     '0'
<!--                AND V.EZCANCELFLAG         =     '0' -->
<!-- END 2022/06/21 R.jin [QC#60216, MOD] -->
            )
            ,IV_DS_CONTR_PRC_EFF AS (
                SELECT
<!-- START 2017/02/22 N.Arai [QC#17621, MOD] -->
<!--                DISTINCT    -->
<!-- END 2017/02/22 N.Arai [QC#17621, MOD] -->
                     D.GLBL_CMPY_CD  AS GLBL_CMPY_CD
                    ,D.DS_CONTR_PK   AS DS_CONTR_PK
                FROM
                     DS_CONTR_PRC_EFF         P
<!-- START 2022/06/21 R.jin [QC#60216, MOD] -->                     
<!--                ,DS_CONTR_PRC_EFF_STS_V   V  -->
                    ,DS_CONTR_DTL             D
                WHERE
                        P.GLBL_CMPY_CD          =     #glblCmpyCd#
                    AND P.CONTR_PRC_EFF_FROM_DT &lt;= #slsDt#
<!--                AND P.GLBL_CMPY_CD          =     V.GLBL_CMPY_CD -->
<!--                AND P.DS_CONTR_PRC_EFF_PK   =     V.DS_CONTR_PRC_EFF_PK -->
<!--                AND V.DS_CONTR_CTRL_STS_CD  =     #dsContrCtrlStsCd# -->
                    AND P.DS_CONTR_PRC_EFF_STS_CD =   #dsContrCtrlStsCd#
                    AND P.GLBL_CMPY_CD          =     D.GLBL_CMPY_CD
                    AND P.DS_CONTR_DTL_PK       =     D.DS_CONTR_DTL_PK
                    AND P.EZCANCELFLAG          =    '0'
<!--                AND V.EZCANCELFLAG          =    '0'  --> 
                    AND D.EZCANCELFLAG          =    '0'
 <isEqual property="cfsUplft" compareValue="Y">
<!-- END 2022/06/21 R.jin [QC#60216, MOD] -->  
<!-- START 2017/02/22 N.Arai [QC#17621, MOD] -->
                    AND NOT EXISTS(
                        SELECT
                            1
                        FROM
                            CFS_CONTR_PRC_UPLFT U
                        WHERE
                                D.GLBL_CMPY_CD          =     U.GLBL_CMPY_CD
                            AND D.DS_CONTR_DTL_PK       =     U.DS_CONTR_DTL_PK
                            AND P.CONTR_PRC_EFF_FROM_DT =     U.UPLFT_EFF_FROM_DT
                            AND U.EZCANCELFLAG          =    '0'
                        )
                UNION
                SELECT
                     D.GLBL_CMPY_CD  AS GLBL_CMPY_CD
                    ,D.DS_CONTR_PK   AS DS_CONTR_PK
                FROM
                     DS_CONTR_PRC_EFF         P
<!-- START 2022/06/21 R.jin [QC#60216, MOD] -->                        
<!--                ,DS_CONTR_PRC_EFF_STS_V   V -->
                    ,DS_CONTR_DTL             D
                    ,CFS_CONTR_PRC_UPLFT      U
                    ,CFS_PROC_STS             S
                WHERE
                        P.GLBL_CMPY_CD          =     #glblCmpyCd#
                    AND P.CONTR_PRC_EFF_FROM_DT &lt;= #slsDt#
<!--                AND P.GLBL_CMPY_CD          =     V.GLBL_CMPY_CD -->
<!--                AND P.DS_CONTR_PRC_EFF_PK   =     V.DS_CONTR_PRC_EFF_PK -->
<!--                AND V.DS_CONTR_CTRL_STS_CD  =     #dsContrCtrlStsCd# -->
                    AND P.DS_CONTR_PRC_EFF_STS_CD =   #dsContrCtrlStsCd#
                    AND P.GLBL_CMPY_CD          =     D.GLBL_CMPY_CD
                    AND P.DS_CONTR_DTL_PK       =     D.DS_CONTR_DTL_PK
                    AND P.EZCANCELFLAG          =    '0'
<!--                AND V.EZCANCELFLAG          =    '0' -->
                    AND D.EZCANCELFLAG          =    '0'
                    AND D.GLBL_CMPY_CD          =     U.GLBL_CMPY_CD
                    AND D.DS_CONTR_DTL_PK       =     U.DS_CONTR_DTL_PK
                    AND P.CONTR_PRC_EFF_FROM_DT =     U.UPLFT_EFF_FROM_DT
                    AND U.BASE_CHRG_FLG         =    'Y'
                    AND U.EZCANCELFLAG          =    '0'
                    AND U.GLBL_CMPY_CD          =     S.GLBL_CMPY_CD
                    AND U.CFS_PROC_STS_CD       =     S.CFS_PROC_STS_CD
                    AND S.CFS_CONTR_ACTV_FLG    =    'Y'
                    AND S.EZCANCELFLAG          =    '0'
                UNION
                SELECT
                     D.GLBL_CMPY_CD  AS GLBL_CMPY_CD
                    ,D.DS_CONTR_PK   AS DS_CONTR_PK
                FROM
                     DS_CONTR_PRC_EFF         P
<!--                ,DS_CONTR_PRC_EFF_STS_V   V -->
                    ,DS_CONTR_DTL             D
                    ,DS_CONTR_BLLG_MTR        M
                    ,CFS_CONTR_PRC_UPLFT      U
                    ,CFS_PROC_STS             S
                WHERE
                        P.GLBL_CMPY_CD          =     #glblCmpyCd#
                    AND P.CONTR_PRC_EFF_FROM_DT &lt;= #slsDt#
<!--                AND P.GLBL_CMPY_CD          =     V.GLBL_CMPY_CD -->
<!--                AND P.DS_CONTR_PRC_EFF_PK   =     V.DS_CONTR_PRC_EFF_PK -->
<!--                AND V.DS_CONTR_CTRL_STS_CD  =     #dsContrCtrlStsCd# -->
                    AND P.DS_CONTR_PRC_EFF_STS_CD =   #dsContrCtrlStsCd#
                    AND P.GLBL_CMPY_CD          =     D.GLBL_CMPY_CD
                    AND P.DS_CONTR_DTL_PK       =     D.DS_CONTR_DTL_PK
                    AND P.EZCANCELFLAG          =    '0'
<!--                AND V.EZCANCELFLAG          =    '0' -->
<!-- END 2022/06/21 R.jin [QC#60216, MOD] -->  
                    AND D.EZCANCELFLAG          =    '0'
                    AND D.GLBL_CMPY_CD          =     M.GLBL_CMPY_CD
                    AND D.DS_CONTR_DTL_PK       =     M.DS_CONTR_DTL_PK
                    AND M.EZCANCELFLAG          =    '0'
                    AND M.GLBL_CMPY_CD          =     U.GLBL_CMPY_CD
                    AND M.DS_CONTR_BLLG_MTR_PK  =     U.DS_CONTR_BLLG_MTR_PK
                    AND P.CONTR_PRC_EFF_FROM_DT =     U.UPLFT_EFF_FROM_DT
                    AND U.USG_CHRG_FLG          =    'Y'
                    AND U.EZCANCELFLAG          =    '0'
                    AND U.GLBL_CMPY_CD          =     S.GLBL_CMPY_CD
                    AND U.CFS_PROC_STS_CD       =     S.CFS_PROC_STS_CD
                    AND S.CFS_CONTR_ACTV_FLG    =    'Y'
                    AND S.EZCANCELFLAG          =    '0'
<!-- END 2017/02/22 N.Arai [QC#17621, MOD] -->
<!-- START 2022/06/21 R.jin [QC#60216, MOD] -->  
</isEqual>
<!-- END 2022/06/21 R.jin [QC#60216, MOD] -->  
            )
        SELECT
             CPK.GLBL_CMPY_CD            AS GLBL_CMPY_CD
            ,CPK.DS_CONTR_PK             AS DS_CONTR_PK
            ,CASE WHEN IV_DC1.GLBL_CMPY_CD IS NULL
                  THEN 'N'
                  ELSE 'Y'
                  END                    AS DS_CONTR_EXIST_FLG
            ,CASE WHEN IV_DCD1.GLBL_CMPY_CD IS NULL
                  THEN 'N'
                  ELSE 'Y'
                  END                    AS DS_CONTR_DTL_EXIST_FLG
            ,CASE WHEN IV_DCBM1.GLBL_CMPY_CD IS NULL
                  THEN 'N'
                  ELSE 'Y'
                  END                    AS DS_CONTR_BLLG_MTR_EXIST_FLG
            ,CASE WHEN IV_DCPE1.GLBL_CMPY_CD IS NULL
                  THEN 'N'
                  ELSE 'Y'
                  END                    AS DS_CONTR_PRC_EFF_EXIST_FLG
        FROM
            (
                SELECT * FROM IV_DS_CONTR
                UNION
                SELECT * FROM IV_DS_CONTR_DTL
                UNION
                SELECT * FROM IV_DS_CONTR_BLLG_MTR
                UNION
                SELECT * FROM IV_DS_CONTR_PRC_EFF
            ) CPK
            ,IV_DS_CONTR          IV_DC1
            ,IV_DS_CONTR_DTL      IV_DCD1
            ,IV_DS_CONTR_BLLG_MTR IV_DCBM1
            ,IV_DS_CONTR_PRC_EFF  IV_DCPE1
        WHERE
                CPK.GLBL_CMPY_CD = IV_DC1.GLBL_CMPY_CD(+)
            AND CPK.DS_CONTR_PK  = IV_DC1.DS_CONTR_PK(+)
            AND CPK.GLBL_CMPY_CD = IV_DCD1.GLBL_CMPY_CD(+)
            AND CPK.DS_CONTR_PK  = IV_DCD1.DS_CONTR_PK(+)
            AND CPK.GLBL_CMPY_CD = IV_DCBM1.GLBL_CMPY_CD(+)
            AND CPK.DS_CONTR_PK  = IV_DCBM1.DS_CONTR_PK(+)
            AND CPK.GLBL_CMPY_CD = IV_DCPE1.GLBL_CMPY_CD(+)
            AND CPK.DS_CONTR_PK  = IV_DCPE1.DS_CONTR_PK(+)
        ORDER BY
             DS_CONTR_EXIST_FLG          DESC
            ,DS_CONTR_DTL_EXIST_FLG      DESC
            ,DS_CONTR_BLLG_MTR_EXIST_FLG DESC
            ,DS_CONTR_PRC_EFF_EXIST_FLG  DESC
            ,DS_CONTR_PK                 ASC
    </statement>
    <statement id="getDsContrDtl4Active" parameterClass="Map" resultClass="Map">
        SELECT
             D.GLBL_CMPY_CD      AS GLBL_CMPY_CD
            ,D.DS_CONTR_PK       AS DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK   AS DS_CONTR_DTL_PK
        FROM
             DS_CONTR_DTL        D
<!-- START 2022/06/27 R.jin [QC#60216, MOD] -->
            <!-- ,DS_CONTR_DTL_STS_V  V -->
        WHERE
                D.GLBL_CMPY_CD         =     #glblCmpyCd#
            AND D.DS_CONTR_PK          =     #dsContrPk#
            AND D.CONTR_EFF_FROM_DT    &lt;= #slsDt#
            <!-- AND D.GLBL_CMPY_CD         =     V.GLBL_CMPY_CD -->
            <!-- AND D.DS_CONTR_DTL_PK      =     V.DS_CONTR_DTL_PK -->
            <!-- AND V.DS_CONTR_CTRL_STS_CD =     #dsContrCtrlStsCd# -->
            AND D.DS_CONTR_DTL_STS_CD  =     #dsContrCtrlStsCd#
            AND D.EZCANCELFLAG         =     '0'
            <!-- AND V.EZCANCELFLAG         =     '0' -->
<!-- END 2022/06/27 R.jin [QC#60216, MOD] -->
        ORDER BY
             D.DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK
    </statement>
    <statement id="getDsContrBllgMtr4Active" parameterClass="Map" resultClass="Map">
        SELECT
             D.GLBL_CMPY_CD          AS GLBL_CMPY_CD
            ,D.DS_CONTR_PK           AS DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK       AS DS_CONTR_DTL_PK
            ,M.DS_CONTR_BLLG_MTR_PK  AS DS_CONTR_BLLG_MTR_PK
        FROM
             DS_CONTR_DTL             D
            ,DS_CONTR_BLLG_MTR        M
<!-- START 2022/06/27 R.jin [QC#60216, MOD] -->
            <!-- ,DS_CONTR_BLLG_MTR_STS_V  V -->
        WHERE
                D.GLBL_CMPY_CD         =     #glblCmpyCd#
            AND D.DS_CONTR_PK          =     #dsContrPk#
            AND D.CONTR_EFF_FROM_DT    &lt;= #slsDt#
            AND D.GLBL_CMPY_CD         =     M.GLBL_CMPY_CD
            AND D.DS_CONTR_DTL_PK      =     M.DS_CONTR_DTL_PK
            <!-- AND M.GLBL_CMPY_CD         =     V.GLBL_CMPY_CD -->
            <!-- AND M.DS_CONTR_BLLG_MTR_PK =     V.DS_CONTR_BLLG_MTR_PK -->
            <!-- AND V.DS_CONTR_CTRL_STS_CD =     #dsContrCtrlStsCd# -->
            AND M.DS_CONTR_BLLG_MTR_STS_CD  =     #dsContrCtrlStsCd#
            AND D.EZCANCELFLAG         =     '0'
            AND M.EZCANCELFLAG         =     '0'
            <!-- AND V.EZCANCELFLAG         =     '0' -->
<!-- END 2022/06/27 R.jin [QC#60216, MOD] -->
        ORDER BY
             D.DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK
            ,M.DS_CONTR_BLLG_MTR_PK
    </statement>
    <statement id="getDsContrPrcEff4Active" parameterClass="Map" resultClass="Map">
        SELECT
             D.GLBL_CMPY_CD        AS GLBL_CMPY_CD
            ,D.DS_CONTR_PK         AS DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK     AS DS_CONTR_DTL_PK
            ,P.DS_CONTR_PRC_EFF_PK AS DS_CONTR_PRC_EFF_PK
        FROM
             DS_CONTR_PRC_EFF         P
<!-- START 2022/06/27 R.jin [QC#60216, MOD] -->             
            <!-- ,DS_CONTR_PRC_EFF_STS_V   V -->
            ,DS_CONTR_DTL             D
        WHERE
                P.GLBL_CMPY_CD          =     #glblCmpyCd#
            AND P.CONTR_PRC_EFF_FROM_DT &lt;= #slsDt#
            <!-- AND P.GLBL_CMPY_CD          =     V.GLBL_CMPY_CD -->
            <!-- AND P.DS_CONTR_PRC_EFF_PK   =     V.DS_CONTR_PRC_EFF_PK -->
            <!-- AND V.DS_CONTR_CTRL_STS_CD  =     #dsContrCtrlStsCd# -->
            AND P.DS_CONTR_PRC_EFF_STS_CD  =  #dsContrCtrlStsCd#
            AND P.GLBL_CMPY_CD          =     D.GLBL_CMPY_CD
            AND P.DS_CONTR_DTL_PK       =     D.DS_CONTR_DTL_PK
            AND D.DS_CONTR_PK           =     #dsContrPk#
            AND P.EZCANCELFLAG          =    '0'
            <!-- AND V.EZCANCELFLAG          =    '0' -->
            AND D.EZCANCELFLAG          =    '0'
<isEqual property="cfsUplft" compareValue="Y">
<!-- END 2022/06/27 R.jin [QC#60216, MOD] -->
<!-- START 2017/02/22 N.Arai [QC#17621, MOD] -->
            AND NOT EXISTS(
                SELECT
                    1
                FROM
                    CFS_CONTR_PRC_UPLFT U
                WHERE
                        D.GLBL_CMPY_CD          =     U.GLBL_CMPY_CD
                    AND D.DS_CONTR_DTL_PK       =     U.DS_CONTR_DTL_PK
                    AND P.CONTR_PRC_EFF_FROM_DT =     U.UPLFT_EFF_FROM_DT
                    AND U.EZCANCELFLAG          =    '0'
                )
        UNION ALL
        SELECT
             D.GLBL_CMPY_CD        AS GLBL_CMPY_CD
            ,D.DS_CONTR_PK         AS DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK     AS DS_CONTR_DTL_PK
            ,P.DS_CONTR_PRC_EFF_PK AS DS_CONTR_PRC_EFF_PK
        FROM
             DS_CONTR_PRC_EFF         P
<!-- START 2022/06/27 R.jin [QC#60216, MOD] -->
            <!-- ,DS_CONTR_PRC_EFF_STS_V   V -->
            ,DS_CONTR_DTL             D
            ,CFS_CONTR_PRC_UPLFT      U
            ,CFS_PROC_STS             S
        WHERE
                P.GLBL_CMPY_CD          =     #glblCmpyCd#
            AND P.CONTR_PRC_EFF_FROM_DT &lt;= #slsDt#
            <!-- AND P.GLBL_CMPY_CD          =     V.GLBL_CMPY_CD -->
            <!-- AND P.DS_CONTR_PRC_EFF_PK   =     V.DS_CONTR_PRC_EFF_PK -->
            <!-- AND V.DS_CONTR_CTRL_STS_CD  =     #dsContrCtrlStsCd# -->
            AND P.DS_CONTR_PRC_EFF_STS_CD  =     #dsContrCtrlStsCd#
            AND P.GLBL_CMPY_CD          =     D.GLBL_CMPY_CD
            AND P.DS_CONTR_DTL_PK       =     D.DS_CONTR_DTL_PK
            AND D.DS_CONTR_PK           =     #dsContrPk#
            AND P.EZCANCELFLAG          =    '0'
            <!-- AND V.EZCANCELFLAG          =    '0' -->
            AND D.EZCANCELFLAG          =    '0'
            AND D.GLBL_CMPY_CD          =     U.GLBL_CMPY_CD
            AND D.DS_CONTR_DTL_PK       =     U.DS_CONTR_DTL_PK
            AND P.CONTR_PRC_EFF_FROM_DT =     U.UPLFT_EFF_FROM_DT
            AND U.BASE_CHRG_FLG         =    'Y'
            AND U.EZCANCELFLAG          =    '0'
            AND U.GLBL_CMPY_CD          =     S.GLBL_CMPY_CD
            AND U.CFS_PROC_STS_CD       =     S.CFS_PROC_STS_CD
            AND S.CFS_CONTR_ACTV_FLG    =    'Y'
            AND S.EZCANCELFLAG          =    '0'
        UNION ALL
        SELECT
             D.GLBL_CMPY_CD        AS GLBL_CMPY_CD
            ,D.DS_CONTR_PK         AS DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK     AS DS_CONTR_DTL_PK
            ,P.DS_CONTR_PRC_EFF_PK AS DS_CONTR_PRC_EFF_PK
        FROM
             DS_CONTR_PRC_EFF         P
            <!-- ,DS_CONTR_PRC_EFF_STS_V   V -->
            ,DS_CONTR_DTL             D
            ,DS_CONTR_BLLG_MTR        M
            ,CFS_CONTR_PRC_UPLFT      U
            ,CFS_PROC_STS             S
        WHERE
                P.GLBL_CMPY_CD          =     #glblCmpyCd#
            AND P.CONTR_PRC_EFF_FROM_DT &lt;= #slsDt#
            <!-- AND P.GLBL_CMPY_CD          =     V.GLBL_CMPY_CD -->
            <!-- AND P.DS_CONTR_PRC_EFF_PK   =     V.DS_CONTR_PRC_EFF_PK -->
            <!-- AND V.DS_CONTR_CTRL_STS_CD  =     #dsContrCtrlStsCd# -->
            AND P.DS_CONTR_PRC_EFF_STS_CD  =     #dsContrCtrlStsCd#
            AND P.GLBL_CMPY_CD          =     D.GLBL_CMPY_CD
            AND P.DS_CONTR_DTL_PK       =     D.DS_CONTR_DTL_PK
            AND D.DS_CONTR_PK           =     #dsContrPk#
            AND P.EZCANCELFLAG          =    '0'
            <!-- AND V.EZCANCELFLAG          =    '0' -->
<!-- END 2022/06/27 R.jin [QC#60216, MOD] -->
            AND D.EZCANCELFLAG          =    '0'
            AND D.GLBL_CMPY_CD          =     M.GLBL_CMPY_CD
            AND D.DS_CONTR_DTL_PK       =     M.DS_CONTR_DTL_PK
            AND M.EZCANCELFLAG          =    '0'
            AND M.GLBL_CMPY_CD          =     U.GLBL_CMPY_CD
            AND M.DS_CONTR_BLLG_MTR_PK  =     U.DS_CONTR_BLLG_MTR_PK
            AND P.CONTR_PRC_EFF_FROM_DT =     U.UPLFT_EFF_FROM_DT
            AND U.USG_CHRG_FLG          =    'Y'
            AND U.EZCANCELFLAG          =    '0'
            AND U.GLBL_CMPY_CD          =     S.GLBL_CMPY_CD
            AND U.CFS_PROC_STS_CD       =     S.CFS_PROC_STS_CD
            AND S.CFS_CONTR_ACTV_FLG    =    'Y'
            AND S.EZCANCELFLAG          =    '0'
<!-- START 2022/06/27 R.jin [QC#60216, MOD] -->
</isEqual>
<!-- END 2022/06/27 R.jin [QC#60216, MOD] -->
        ORDER BY
             DS_CONTR_PK
            ,DS_CONTR_DTL_PK
            ,DS_CONTR_PRC_EFF_PK
<!-- END 2017/02/22 N.Arai [QC#17621, MOD] -->

    </statement>
    <statement id="getDsContrPK4Expired" parameterClass="Map" resultClass="Map">
        WITH
            IV_DS_CONTR AS(
                SELECT
                     C.GLBL_CMPY_CD AS GLBL_CMPY_CD
                    ,C.DS_CONTR_PK  AS DS_CONTR_PK
                FROM
                     DS_CONTR       C
                WHERE
                         C.GLBL_CMPY_CD           =     #glblCmpyCd#
                     AND C.CONTR_VRSN_EFF_THRU_DT &lt;  #slsDt#
                     AND C.DS_CONTR_STS_CD        =     #dsContrStsCd#
                     AND C.EZCANCELFLAG           =     '0'
            )
            ,IV_DS_CONTR_DTL AS (
                SELECT
                    DISTINCT
                     D.GLBL_CMPY_CD  AS GLBL_CMPY_CD
                    ,D.DS_CONTR_PK   AS DS_CONTR_PK
                FROM
                     DS_CONTR_DTL D
                WHERE
                        D.GLBL_CMPY_CD         =     #glblCmpyCd#
                    AND D.CONTR_EFF_THRU_DT    &lt;  #slsDt#
                    AND D.DS_CONTR_DTL_STS_CD  =     #dsContrCtrlStsCd#
                    AND D.EZCANCELFLAG         =     '0'
            )
            ,IV_DS_CONTR_BLLG_MTR AS (
                SELECT
                    DISTINCT
                     D.GLBL_CMPY_CD  AS GLBL_CMPY_CD
                    ,D.DS_CONTR_PK   AS DS_CONTR_PK
                FROM
                     DS_CONTR_DTL             D
                    ,DS_CONTR_BLLG_MTR        M
                WHERE
                        D.GLBL_CMPY_CD              =     #glblCmpyCd#
                    AND D.CONTR_EFF_THRU_DT         &lt;  #slsDt#
                    AND D.GLBL_CMPY_CD              =     M.GLBL_CMPY_CD
                    AND D.DS_CONTR_DTL_PK           =     M.DS_CONTR_DTL_PK
                    AND M.DS_CONTR_BLLG_MTR_STS_CD  =     #dsContrCtrlStsCd#
                    AND D.EZCANCELFLAG              =     '0'
                    AND M.EZCANCELFLAG              =     '0'
            )
            ,IV_DS_CONTR_PRC_EFF AS (
                SELECT
                    DISTINCT
                     D.GLBL_CMPY_CD  AS GLBL_CMPY_CD
                    ,D.DS_CONTR_PK   AS DS_CONTR_PK
                FROM
                     DS_CONTR_PRC_EFF         P
                    ,DS_CONTR_DTL             D
                WHERE
                        P.GLBL_CMPY_CD            =     #glblCmpyCd#
                    AND P.CONTR_PRC_EFF_THRU_DT   &lt;  #slsDt#
                    AND P.DS_CONTR_PRC_EFF_STS_CD =     #dsContrCtrlStsCd#
                    AND P.GLBL_CMPY_CD            =     D.GLBL_CMPY_CD
                    AND P.DS_CONTR_DTL_PK         =     D.DS_CONTR_DTL_PK
                    AND P.EZCANCELFLAG            =     '0'
                    AND D.EZCANCELFLAG            =     '0'
            )
        SELECT
             CPK.GLBL_CMPY_CD            AS GLBL_CMPY_CD
            ,CPK.DS_CONTR_PK             AS DS_CONTR_PK
            ,CASE WHEN IV_DC1.GLBL_CMPY_CD IS NULL
                  THEN 'N'
                  ELSE 'Y'
                  END                    AS DS_CONTR_EXIST_FLG
            ,CASE WHEN IV_DCD1.GLBL_CMPY_CD IS NULL
                  THEN 'N'
                  ELSE 'Y'
                  END                    AS DS_CONTR_DTL_EXIST_FLG
            ,CASE WHEN IV_DCBM1.GLBL_CMPY_CD IS NULL
                  THEN 'N'
                  ELSE 'Y'
                  END                    AS DS_CONTR_BLLG_MTR_EXIST_FLG
            ,CASE WHEN IV_DCPE1.GLBL_CMPY_CD IS NULL
                  THEN 'N'
                  ELSE 'Y'
                  END                    AS DS_CONTR_PRC_EFF_EXIST_FLG
        FROM
            (
                SELECT * FROM IV_DS_CONTR
                UNION
                SELECT * FROM IV_DS_CONTR_DTL
                UNION
                SELECT * FROM IV_DS_CONTR_BLLG_MTR
                UNION
                SELECT * FROM IV_DS_CONTR_PRC_EFF
            ) CPK
            ,IV_DS_CONTR          IV_DC1
            ,IV_DS_CONTR_DTL      IV_DCD1
            ,IV_DS_CONTR_BLLG_MTR IV_DCBM1
            ,IV_DS_CONTR_PRC_EFF  IV_DCPE1
        WHERE
                CPK.GLBL_CMPY_CD = IV_DC1.GLBL_CMPY_CD(+)
            AND CPK.DS_CONTR_PK  = IV_DC1.DS_CONTR_PK(+)
            AND CPK.GLBL_CMPY_CD = IV_DCD1.GLBL_CMPY_CD(+)
            AND CPK.DS_CONTR_PK  = IV_DCD1.DS_CONTR_PK(+)
            AND CPK.GLBL_CMPY_CD = IV_DCBM1.GLBL_CMPY_CD(+)
            AND CPK.DS_CONTR_PK  = IV_DCBM1.DS_CONTR_PK(+)
            AND CPK.GLBL_CMPY_CD = IV_DCPE1.GLBL_CMPY_CD(+)
            AND CPK.DS_CONTR_PK  = IV_DCPE1.DS_CONTR_PK(+)
        ORDER BY
             DS_CONTR_EXIST_FLG          DESC
            ,DS_CONTR_DTL_EXIST_FLG      DESC
            ,DS_CONTR_BLLG_MTR_EXIST_FLG DESC
            ,DS_CONTR_PRC_EFF_EXIST_FLG  DESC
            ,DS_CONTR_PK                 ASC
    </statement>
    <statement id="getDsContrDtl4Expired" parameterClass="Map" resultClass="Map">
        SELECT
             D.GLBL_CMPY_CD      AS GLBL_CMPY_CD
            ,D.DS_CONTR_PK       AS DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK   AS DS_CONTR_DTL_PK
        FROM
             DS_CONTR_DTL        D
        WHERE
                D.GLBL_CMPY_CD         =     #glblCmpyCd#
            AND D.DS_CONTR_PK          =     #dsContrPk#
            AND D.CONTR_EFF_THRU_DT    &lt;  #slsDt#
            AND D.DS_CONTR_DTL_STS_CD  =     #dsContrCtrlStsCd#
            AND D.EZCANCELFLAG         =     '0'
        ORDER BY
             D.DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK
    </statement>
    <statement id="getDsContrBllgMtr4Expired" parameterClass="Map" resultClass="Map">
        SELECT
             D.GLBL_CMPY_CD          AS GLBL_CMPY_CD
            ,D.DS_CONTR_PK           AS DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK       AS DS_CONTR_DTL_PK
            ,M.DS_CONTR_BLLG_MTR_PK  AS DS_CONTR_BLLG_MTR_PK
        FROM
             DS_CONTR_DTL             D
            ,DS_CONTR_BLLG_MTR        M
        WHERE
                D.GLBL_CMPY_CD             =     #glblCmpyCd#
            AND D.DS_CONTR_PK              =     #dsContrPk#
            AND D.CONTR_EFF_THRU_DT        &lt;  #slsDt#
            AND D.GLBL_CMPY_CD             =     M.GLBL_CMPY_CD
            AND D.DS_CONTR_DTL_PK          =     M.DS_CONTR_DTL_PK
            AND M.DS_CONTR_BLLG_MTR_STS_CD =     #dsContrCtrlStsCd#
            AND D.EZCANCELFLAG             =     '0'
            AND M.EZCANCELFLAG             =     '0'
        ORDER BY
             D.DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK
            ,M.DS_CONTR_BLLG_MTR_PK
    </statement>
    <statement id="getDsContrPrcEff4Expired" parameterClass="Map" resultClass="Map">
        SELECT
             D.GLBL_CMPY_CD        AS GLBL_CMPY_CD
            ,D.DS_CONTR_PK         AS DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK     AS DS_CONTR_DTL_PK
            ,P.DS_CONTR_PRC_EFF_PK AS DS_CONTR_PRC_EFF_PK
        FROM
             DS_CONTR_PRC_EFF         P
            ,DS_CONTR_DTL             D
        WHERE
                D.GLBL_CMPY_CD            =     #glblCmpyCd#
            AND D.DS_CONTR_PK             =     #dsContrPk#
            AND D.GLBL_CMPY_CD            =     P.GLBL_CMPY_CD
            AND D.DS_CONTR_DTL_PK         =     P.DS_CONTR_DTL_PK
            AND P.CONTR_PRC_EFF_THRU_DT   &lt;  #slsDt#
            AND P.DS_CONTR_PRC_EFF_STS_CD =     #dsContrCtrlStsCd#
            AND D.EZCANCELFLAG            =    '0'
            AND P.EZCANCELFLAG            =    '0'
        ORDER BY
             D.DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK
            ,P.DS_CONTR_PRC_EFF_PK
    </statement>
    <statement id="getDsContrPK4Terminated" parameterClass="Map" resultClass="Map">
        WITH
             IV_DS_CONTR_DTL AS (
                SELECT
                    DISTINCT
                     D.GLBL_CMPY_CD  AS GLBL_CMPY_CD
                    ,D.DS_CONTR_PK   AS DS_CONTR_PK
                FROM
                     DS_CONTR_DTL D
                WHERE
                        D.GLBL_CMPY_CD             =     #glblCmpyCd#
                    AND D.CONTR_CLO_DT             &lt;  #slsDt#
                    AND (
                            D.DS_CONTR_DTL_STS_CD  =     #dsContrCtrlStsCd1#
                         OR D.DS_CONTR_DTL_STS_CD  =     #dsContrCtrlStsCd2#
                        )
                    AND D.EZCANCELFLAG             =     '0'
            )
            ,IV_DS_CONTR_BLLG_MTR AS (
                SELECT
                    DISTINCT
                     D.GLBL_CMPY_CD  AS GLBL_CMPY_CD
                    ,D.DS_CONTR_PK   AS DS_CONTR_PK
                FROM
                     DS_CONTR_DTL             D
                    ,DS_CONTR_BLLG_MTR        M
                WHERE
                        D.GLBL_CMPY_CD              =     #glblCmpyCd#
                    AND D.CONTR_CLO_DT              &lt;  #slsDt#
                    AND D.GLBL_CMPY_CD              =     M.GLBL_CMPY_CD
                    AND D.DS_CONTR_DTL_PK           =     M.DS_CONTR_DTL_PK
                    AND (
                            M.DS_CONTR_BLLG_MTR_STS_CD  =     #dsContrCtrlStsCd1#
                         OR M.DS_CONTR_BLLG_MTR_STS_CD  =     #dsContrCtrlStsCd2#
                        )
                    AND D.EZCANCELFLAG              =     '0'
                    AND M.EZCANCELFLAG              =     '0'
            )
            ,IV_DS_CONTR_PRC_EFF AS (
                SELECT
                    DISTINCT
                     D.GLBL_CMPY_CD  AS GLBL_CMPY_CD
                    ,D.DS_CONTR_PK   AS DS_CONTR_PK
                FROM
                     DS_CONTR_PRC_EFF         P
                    ,DS_CONTR_DTL             D
                WHERE
                        D.GLBL_CMPY_CD            =     #glblCmpyCd#
                    AND D.CONTR_CLO_DT            &lt;  #slsDt#
                    AND D.GLBL_CMPY_CD            =     P.GLBL_CMPY_CD
                    AND D.DS_CONTR_DTL_PK         =     P.DS_CONTR_DTL_PK
                    AND (
                            P.DS_CONTR_PRC_EFF_STS_CD =     #dsContrCtrlStsCd1#
                         OR P.DS_CONTR_PRC_EFF_STS_CD =     #dsContrCtrlStsCd2#
                        )
                    AND P.EZCANCELFLAG            =     '0'
                    AND D.EZCANCELFLAG            =     '0'
            )
        SELECT
             CPK.GLBL_CMPY_CD            AS GLBL_CMPY_CD
            ,CPK.DS_CONTR_PK             AS DS_CONTR_PK
            ,'N'                         AS DS_CONTR_EXIST_FLG
            ,CASE WHEN IV_DCD1.GLBL_CMPY_CD IS NULL
                  THEN 'N'
                  ELSE 'Y'
                  END                    AS DS_CONTR_DTL_EXIST_FLG
            ,CASE WHEN IV_DCBM1.GLBL_CMPY_CD IS NULL
                  THEN 'N'
                  ELSE 'Y'
                  END                    AS DS_CONTR_BLLG_MTR_EXIST_FLG
            ,CASE WHEN IV_DCPE1.GLBL_CMPY_CD IS NULL
                  THEN 'N'
                  ELSE 'Y'
                  END                    AS DS_CONTR_PRC_EFF_EXIST_FLG
        FROM
            (
                SELECT * FROM IV_DS_CONTR_DTL
                UNION
                SELECT * FROM IV_DS_CONTR_BLLG_MTR
                UNION
                SELECT * FROM IV_DS_CONTR_PRC_EFF
            ) CPK
            ,IV_DS_CONTR_DTL      IV_DCD1
            ,IV_DS_CONTR_BLLG_MTR IV_DCBM1
            ,IV_DS_CONTR_PRC_EFF  IV_DCPE1
        WHERE
                CPK.GLBL_CMPY_CD = IV_DCD1.GLBL_CMPY_CD(+)
            AND CPK.DS_CONTR_PK  = IV_DCD1.DS_CONTR_PK(+)
            AND CPK.GLBL_CMPY_CD = IV_DCBM1.GLBL_CMPY_CD(+)
            AND CPK.DS_CONTR_PK  = IV_DCBM1.DS_CONTR_PK(+)
            AND CPK.GLBL_CMPY_CD = IV_DCPE1.GLBL_CMPY_CD(+)
            AND CPK.DS_CONTR_PK  = IV_DCPE1.DS_CONTR_PK(+)
        ORDER BY
             DS_CONTR_EXIST_FLG          DESC
            ,DS_CONTR_DTL_EXIST_FLG      DESC
            ,DS_CONTR_BLLG_MTR_EXIST_FLG DESC
            ,DS_CONTR_PRC_EFF_EXIST_FLG  DESC
            ,DS_CONTR_PK                 ASC
    </statement>
    <statement id="getDsContrDtl4Terminated" parameterClass="Map" resultClass="Map">
        SELECT
             D.GLBL_CMPY_CD      AS GLBL_CMPY_CD
            ,D.DS_CONTR_PK       AS DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK   AS DS_CONTR_DTL_PK
        FROM
             DS_CONTR_DTL        D
        WHERE
                D.GLBL_CMPY_CD         =     #glblCmpyCd#
            AND D.DS_CONTR_PK          =     #dsContrPk#
            AND D.CONTR_CLO_DT         &lt;  #slsDt#
            AND (
                    D.DS_CONTR_DTL_STS_CD  = #dsContrCtrlStsCd1#
                 OR D.DS_CONTR_DTL_STS_CD  = #dsContrCtrlStsCd2#
                )
            AND D.EZCANCELFLAG         =     '0'
        ORDER BY
             D.DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK
    </statement>
    <statement id="getDsContrBllgMtr4Terminated" parameterClass="Map" resultClass="Map">
        SELECT
             D.GLBL_CMPY_CD          AS GLBL_CMPY_CD
            ,D.DS_CONTR_PK           AS DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK       AS DS_CONTR_DTL_PK
            ,M.DS_CONTR_BLLG_MTR_PK  AS DS_CONTR_BLLG_MTR_PK
        FROM
             DS_CONTR_DTL             D
            ,DS_CONTR_BLLG_MTR        M
        WHERE
                D.GLBL_CMPY_CD             =     #glblCmpyCd#
            AND D.DS_CONTR_PK              =     #dsContrPk#
            AND D.CONTR_CLO_DT             &lt;  #slsDt#
            AND D.GLBL_CMPY_CD             =     M.GLBL_CMPY_CD
            AND D.DS_CONTR_DTL_PK          =     M.DS_CONTR_DTL_PK
            AND (
                    M.DS_CONTR_BLLG_MTR_STS_CD  = #dsContrCtrlStsCd1#
                 OR M.DS_CONTR_BLLG_MTR_STS_CD  = #dsContrCtrlStsCd2#
                )
            AND D.EZCANCELFLAG             =     '0'
            AND M.EZCANCELFLAG             =     '0'
        ORDER BY
             D.DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK
            ,M.DS_CONTR_BLLG_MTR_PK
    </statement>
    <statement id="getDsContrPrcEff4Terminated" parameterClass="Map" resultClass="Map">
        SELECT
             D.GLBL_CMPY_CD        AS GLBL_CMPY_CD
            ,D.DS_CONTR_PK         AS DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK     AS DS_CONTR_DTL_PK
            ,P.DS_CONTR_PRC_EFF_PK AS DS_CONTR_PRC_EFF_PK
        FROM
             DS_CONTR_PRC_EFF         P
            ,DS_CONTR_DTL             D
        WHERE
                D.GLBL_CMPY_CD            =     #glblCmpyCd#
            AND D.DS_CONTR_PK             =     #dsContrPk#
            AND D.GLBL_CMPY_CD            =     P.GLBL_CMPY_CD
            AND D.DS_CONTR_DTL_PK         =     P.DS_CONTR_DTL_PK
            AND D.CONTR_CLO_DT            &lt;  #slsDt#
            AND (
                    P.DS_CONTR_PRC_EFF_STS_CD = #dsContrCtrlStsCd1#
                 OR P.DS_CONTR_PRC_EFF_STS_CD = #dsContrCtrlStsCd2#
                )
            AND D.EZCANCELFLAG            =    '0'
            AND P.EZCANCELFLAG            =    '0'
        ORDER BY
             D.DS_CONTR_PK
            ,D.DS_CONTR_DTL_PK
            ,P.DS_CONTR_PRC_EFF_PK
    </statement>
    <statement id="getEffectiveDsContrDtl" parameterClass="Map" resultClass="java.math.BigDecimal">
        SELECT
            A.DS_CONTR_DTL_PK
        FROM
            DS_CONTR_DTL A
 <!-- START 2022/07/04 R.jin [QC#60276, MOD] -->
            <!-- ,DS_CONTR_DTL_STS_V B -->
        WHERE
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        AND A.EZCANCELFLAG          = '0'
        AND A.DS_CONTR_PK           = #dsContrPk#
        <!-- AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD -->
        <!-- AND B.EZCANCELFLAG          = '0' -->
        <!-- AND A.DS_CONTR_DTL_PK       = B.DS_CONTR_DTL_PK -->
        <!-- START 2019/05/15 K.Fujimoto [QC#50279, MOD] -->
        <!-- AND B.DS_CONTR_CTRL_STS_CD  NOT IN (#cancelled#,#terminated#,#expired#) -->
        <!-- AND B.DS_CONTR_CTRL_STS_CD  NOT IN (#cancelled#,#terminated#,#expired#,#terminatedHold#) -->
        AND A.DS_CONTR_DTL_STS_CD  NOT IN (#cancelled#,#terminated#,#expired#)
 <!-- END 2022/07/04 R.jin [QC#60276, MOD] -->
        <!-- END   2019/05/15 K.Fujimoto [QC#50279, MOD] -->
        <!-- START 2023/02/13 R.Jin [QC#61172, ADD] -->
        AND A.DS_CONTR_DTL_TP_CD &lt;&gt; #shell#
        <!-- END 2023/02/13 R.Jin [QC#61172, ADD] -->
    </statement>
    <!-- START 2017/10/03 K.Kojima [QC#18417,ADD] -->
    <statement id="getDsContrDtlPKForRenewalHold" parameterClass="Map" resultClass="Map">
        SELECT
             DCD.DS_CONTR_PK
            ,DCD.DS_CONTR_DTL_PK
            ,DCD.DS_CONTR_DTL_TP_CD
        FROM
             DS_CONTR_DTL DCD
            ,DS_CONTR     DC
        WHERE
                DCD.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DCD.DS_CONTR_DTL_STS_CD = #dsContrDtlStsCdActive#
            AND DCD.EZCANCELFLAG        = '0'
            AND DCD.GLBL_CMPY_CD        = DC.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK         = DC.DS_CONTR_PK
            AND DC.DS_CONTR_STS_CD      = #dsContrStsCdActive#
            AND DC.EZCANCELFLAG         = '0'
            AND EXISTS(
                SELECT
                    1
                FROM
                     DS_CONTR_PRC_EFF       DCPE
                    ,DS_CONTR_PRC_EFF_STS_V DCPES
                WHERE
                        DCPE.GLBL_CMPY_CD              = DCD.GLBL_CMPY_CD
                    AND DCPE.DS_CONTR_DTL_PK           = DCD.DS_CONTR_DTL_PK
                    AND DCPE.CONTR_PRC_EFF_FROM_DT &lt;= #slsDt#
                    AND DCPE.EZCANCELFLAG              = '0'
                    AND DCPE.GLBL_CMPY_CD              = DCPES.GLBL_CMPY_CD
                    AND DCPE.DS_CONTR_PRC_EFF_PK       = DCPES.DS_CONTR_PRC_EFF_PK
                    AND DCPES.DS_CONTR_CTRL_STS_CD     = #targetSts#
                    AND DCPES.EZCANCELFLAG             = '0'
            )
        UNION
        SELECT
             DCD.DS_CONTR_PK
            ,DCD.DS_CONTR_DTL_PK
            ,DCD.DS_CONTR_DTL_TP_CD
        FROM
             DS_CONTR_DTL DCD
            ,DS_CONTR     DC
        WHERE
                DCD.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DCD.DS_CONTR_DTL_STS_CD = #dsContrDtlStsCdActive#
            AND DCD.EZCANCELFLAG        = '0'
            AND DCD.GLBL_CMPY_CD        = DC.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK         = DC.DS_CONTR_PK
            AND DC.DS_CONTR_STS_CD      = #dsContrStsCdActive#
            AND DC.EZCANCELFLAG         = '0'
            AND EXISTS(
                SELECT
                    1
                FROM
                     DS_CONTR_DTL           DCDF
                    ,DS_CONTR_PRC_EFF       DCPE
                    ,DS_CONTR_PRC_EFF_STS_V DCPES
                WHERE
                        DCDF.GLBL_CMPY_CD              = DCD.GLBL_CMPY_CD
                    AND DCDF.DS_CONTR_PK               = DCD.DS_CONTR_PK
                    AND DCDF.DS_CONTR_DTL_TP_CD        = #dsContrDtlTpCdFleet#
                    AND DCDF.EZCANCELFLAG              = '0'
                    AND DCDF.GLBL_CMPY_CD              = DCPE.GLBL_CMPY_CD
                    AND DCDF.DS_CONTR_DTL_PK           = DCPE.DS_CONTR_DTL_PK
                    AND DCPE.CONTR_PRC_EFF_FROM_DT &lt;= #slsDt#
                    AND DCPE.EZCANCELFLAG              = '0'
                    AND DCPE.GLBL_CMPY_CD              = DCPES.GLBL_CMPY_CD
                    AND DCPE.DS_CONTR_PRC_EFF_PK       = DCPES.DS_CONTR_PRC_EFF_PK
                    AND DCPES.DS_CONTR_CTRL_STS_CD     = #targetSts#
                    AND DCPES.EZCANCELFLAG             = '0'
            )
        ORDER BY
             DS_CONTR_PK
            ,DS_CONTR_DTL_PK
    </statement>
    <!-- END 2017/10/03 K.Kojima [QC#18417,ADD] -->
    <!-- START  2018/04/23 K.Kishimoto [QC#23378,ADD] -->
    <statement id="getdsContrPrcAllocSum" parameterClass="Map" resultClass="Map">
        SELECT
             COUNT(*)           AS REC_CNT
            ,SUM(PRC_ALLOC_AMT) AS PRC_ALLOC_AMT
        FROM
             DS_CONTR_PRC_ALLOC         A
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.DS_CONTR_PK           = #dsContrPk#
            AND A.DS_CONTR_DTL_PK       = #dsContrDtlPk#
            AND A.SVC_INV_CHRG_TP_CD    = #svcInvChrgTpCd#
    </statement>
    <!-- END    2018/04/23 K.Kishimoto [QC#23378,ADD] -->

    <!-- START 2019/05/22 [QC#50212,DEL] -->
    <!-- START 2018/05/15 M.Naito [QC#21679,ADD] -->
    <!-- <statement id="getDsSubContrList" parameterClass="Map" resultClass="Map"> -->
    <!--    SELECT -->
    <!--         B.DS_SUB_CONTR_PK -->
    <!--    FROM -->
    <!--         DS_CONTR_DTL      A -->
    <!--        ,DS_SUB_CONTR      B -->
    <!--    WHERE -->
    <!--        A.GLBL_CMPY_CD     = #glblCmpyCd# -->
    <!--    AND A.DS_CONTR_PK      = #dsContrPk# -->
    <!--    AND A.EZCANCELFLAG     = '0' -->
    <!--    AND A.GLBL_CMPY_CD     = B.GLBL_CMPY_CD -->
    <!--    AND A.DS_CONTR_DTL_PK  = B.DS_CONTR_DTL_PK -->
    <!--    AND B.EZCANCELFLAG     = '0' -->
    <!-- </statement> -->

    <!-- <statement id="getDsSubContrInfo" parameterClass="Map" resultClass="Map"> -->
    <!--    SELECT -->
    <!--         C.DS_CONTR_NUM -->
    <!--        ,D.SER_NUM -->
    <!--    FROM -->
    <!--         DS_SUB_CONTR      A -->
    <!--        ,DS_CONTR_DTL      B -->
    <!--        ,DS_CONTR          C -->
    <!--        ,SVC_MACH_MSTR     D -->
    <!--    WHERE -->
    <!--        A.GLBL_CMPY_CD     = #glblCmpyCd# -->
    <!--    AND A.DS_SUB_CONTR_PK  = #dsSubContrPk# -->
    <!--    AND A.EZCANCELFLAG     = '0' -->
    <!--    AND A.GLBL_CMPY_CD     = B.GLBL_CMPY_CD -->
    <!--    AND A.DS_CONTR_DTL_PK  = B.DS_CONTR_DTL_PK -->
    <!--    AND B.EZCANCELFLAG     = '0' -->
    <!--    AND B.GLBL_CMPY_CD     = C.GLBL_CMPY_CD -->
    <!--    AND B.DS_CONTR_PK      = C.DS_CONTR_PK -->
    <!--    AND C.EZCANCELFLAG     = '0' -->
    <!--    AND B.GLBL_CMPY_CD     = D.GLBL_CMPY_CD -->
    <!--    AND B.SVC_MACH_MSTR_PK = D.SVC_MACH_MSTR_PK -->
    <!--    AND D.EZCANCELFLAG     = '0' -->
    <!-- </statement> -->
    <!-- END 2018/05/15 M.Naito [QC#21679,ADD] -->
    <!-- END 2019/05/22 [QC#50212,DEL] -->
    <!-- START 2022/06/21 R.jin [QC#60216, MOD] -->  
    <statement id="getUpdateBasePrcDealAmtTarget" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_PK              AS DS_CONTR_PK
            ,A.DS_CONTR_DTL_PK          AS DS_CONTR_DTL_PK
            ,B.DS_CONTR_PRC_EFF_PK      AS DS_CONTR_PRC_EFF_PK
            ,A.DS_CONTR_DTL_TP_CD       AS DS_CONTR_DTL_TP_CD
            ,A.DS_CONTR_DTL_STS_CD      AS DS_CONTR_DTL_STS_CD
            ,A.BASE_PRC_DEAL_AMT        AS DTL_BASE_PRC_DEAL_AMT
            ,B.CONTR_PRC_EFF_FROM_DT    AS CONTR_PRC_EFF_FROM_DT
            ,B.CONTR_PRC_EFF_THRU_DT    AS CONTR_PRC_EFF_THRU_DT
            ,B.BASE_PRC_DEAL_AMT        AS EFF_BASE_PRC_DEAL_AMT
        FROM
             DS_CONTR_DTL       A
            ,DS_CONTR_PRC_EFF   B
        WHERE
                A.GLBL_CMPY_CD         =     #glblCmpyCd#
            AND A.DS_CONTR_DTL_PK      =     B.DS_CONTR_DTL_PK
            AND B.BASE_CHRG_FLG        =     'Y'
            AND #slsDt# BETWEEN B.CONTR_PRC_EFF_FROM_DT AND B.CONTR_PRC_EFF_THRU_DT
            AND A.BASE_PRC_DEAL_AMT &lt;&gt; B.BASE_PRC_DEAL_AMT
            AND A.EZCANCELFLAG         =     '0'
            AND B.EZCANCELFLAG         =     '0'
            AND A.DS_CONTR_DTL_STS_CD  = #dsContrDtlStsCd#
            AND A.QLTY_ASRN_HLD_FLG    =     'N'
        ORDER BY
             A.DS_CONTR_PK
            ,A.DS_CONTR_DTL_PK
    </statement>
    <statement id="getUpdateXsMtrAmtRateTarget" parameterClass="Map" resultClass="Map">
        SELECT 
            A.DS_CONTR_PK                AS DS_CONTR_PK
            ,B.DS_CONTR_DTL_PK           AS DS_CONTR_DTL_PK
            ,A.DS_CONTR_BLLG_MTR_PK      AS DS_CONTR_BLLG_MTR_PK
            ,A.DS_CONTR_PRC_EFF_PK       AS DS_CONTR_PRC_EFF_PK
            ,A.DS_CONTR_PRC_EFF_MTR_PK   AS DS_CONTR_PRC_EFF_MTR_PK
            ,A.DS_CONTR_DTL_TP_CD        AS DS_CONTR_DTL_TP_CD
            ,A.DS_CONTR_DTL_STS_CD       AS DS_CONTR_DTL_STS_CD
            ,A.DS_CONTR_PRC_EFF_STS_CD   AS DS_CONTR_PRC_EFF_STS_CD
            ,A.XS_MTR_FIRST_FLG          AS XS_MTR_FIRST_FLG_FOR_EFF_MTR
            ,B.XS_MTR_FIRST_FLG          AS XS_MTR_FIRST_FLG_FOR_XS_COPY
            ,A.XS_MTR_COPY_QTY           AS XS_MTR_COPY_QTY_FOR_EFF_MTR
            ,A.CONTR_XS_COPY_PK          AS CONTR_XS_COPY_PK_FOR_EFF_MTR
            ,A.XS_MTR_AMT_RATE           AS XS_MTR_AMT_RATE_FOR_EFF_MTR
            ,A.PRC_EFF_MTR_RANK          AS PRC_EFF_MTR_RANK
            ,B.XS_MTR_COPY_QTY           AS XS_MTR_COPY_QTY_FOR_XS_COPY
            ,B.CONTR_XS_COPY_PK          AS CONTR_XS_COPY_PK_FOR_XS_COPY
            ,B.XS_MTR_AMT_RATE           AS XS_MTR_AMT_RATE_FOR_XS_COPY
            ,B.XS_COPY_RANK              AS XS_COPY_RANK
        FROM (SELECT 
                E.DS_CONTR_PK
                ,E.DS_CONTR_DTL_PK
                ,E.DS_CONTR_DTL_TP_CD
                ,E.DS_CONTR_DTL_STS_CD
                ,D.DS_CONTR_PRC_EFF_STS_CD
                ,C.XS_MTR_FIRST_FLG
                ,C.DS_CONTR_PRC_EFF_MTR_PK
                ,C.DS_CONTR_PRC_EFF_PK
                ,C.DS_CONTR_BLLG_MTR_PK
                ,C.XS_MTR_COPY_QTY
                ,C.CONTR_XS_COPY_PK
                ,C.XS_MTR_AMT_RATE
                ,C.GLBL_CMPY_CD
                ,C.EZCANCELFLAG
                ,ROW_NUMBER() OVER(PARTITION BY C.DS_CONTR_BLLG_MTR_PK ORDER BY C.XS_MTR_COPY_QTY) PRC_EFF_MTR_RANK
            FROM 
                DS_CONTR_PRC_EFF_MTR   C
                ,DS_CONTR_PRC_EFF      D
                ,DS_CONTR_DTL          E
            WHERE 
                C.GLBL_CMPY_CD                    = #glblCmpyCd#
                AND C.GLBL_CMPY_CD                = D.GLBL_CMPY_CD
                AND C.DS_CONTR_PRC_EFF_PK         = D.DS_CONTR_PRC_EFF_PK
                AND C.DS_CONTR_BLLG_MTR_PK        = D.DS_CONTR_BLLG_MTR_PK
                AND #slsDt# BETWEEN D.CONTR_PRC_EFF_FROM_DT AND D.CONTR_PRC_EFF_THRU_DT 
                AND E.GLBL_CMPY_CD                = D.GLBL_CMPY_CD 
                AND E.DS_CONTR_DTL_PK             = D.DS_CONTR_DTL_PK 
                AND E.DS_CONTR_DTL_STS_CD         =  #dsContrDtlStsCd# 
                AND E.EZCANCELFLAG                = '0' 
                AND D.EZCANCELFLAG                = '0' 
                AND C.EZCANCELFLAG                = '0' 
                AND E.QLTY_ASRN_HLD_FLG           = 'N'
            ORDER BY 
                E.DS_CONTR_PK ASC
                , E.DS_CONTR_DTL_PK ASC
                , C.DS_CONTR_BLLG_MTR_PK ASC
            ) A 
            ,(SELECT 
                H.DS_CONTR_PK
                ,H.DS_CONTR_DTL_PK
                ,F.GLBL_CMPY_CD
                ,F.EZCANCELFLAG
                ,F.XS_MTR_FIRST_FLG
                ,F.DS_CONTR_BLLG_MTR_PK
                ,F.XS_MTR_COPY_QTY
                ,F.CONTR_XS_COPY_PK
                ,F.XS_MTR_AMT_RATE
                ,ROW_NUMBER() OVER(PARTITION BY F.DS_CONTR_BLLG_MTR_PK ORDER BY F.XS_MTR_COPY_QTY) XS_COPY_RANK
            FROM 
                CONTR_XS_COPY       F 
                ,DS_CONTR_PRC_EFF   G 
                ,DS_CONTR_DTL       H
            WHERE 
                F.GLBL_CMPY_CD                   = #glblCmpyCd#
                AND F.GLBL_CMPY_CD               = G.GLBL_CMPY_CD
                AND F.DS_CONTR_BLLG_MTR_PK       = G.DS_CONTR_BLLG_MTR_PK
                AND #slsDt# BETWEEN G.CONTR_PRC_EFF_FROM_DT AND G.CONTR_PRC_EFF_THRU_DT 
                AND H.GLBL_CMPY_CD               = G.GLBL_CMPY_CD 
                AND H.DS_CONTR_DTL_PK            = G.DS_CONTR_DTL_PK 
                AND H.DS_CONTR_DTL_STS_CD        =  #dsContrDtlStsCd# 
                AND H.EZCANCELFLAG               = '0' 
                AND G.EZCANCELFLAG               = '0' 
                AND F.EZCANCELFLAG               = '0' 
                AND H.QLTY_ASRN_HLD_FLG          = 'N'
            ORDER BY 
                H.DS_CONTR_PK ASC
                ,H.DS_CONTR_DTL_PK ASC
                ,F.DS_CONTR_BLLG_MTR_PK ASC
            ) B
        WHERE 
            A.DS_CONTR_DTL_PK                   = B.DS_CONTR_DTL_PK
            AND A.GLBL_CMPY_CD                  = B.GLBL_CMPY_CD
            AND A.DS_CONTR_BLLG_MTR_PK          = B.DS_CONTR_BLLG_MTR_PK
            AND A.PRC_EFF_MTR_RANK              = B.XS_COPY_RANK
            AND (A.XS_MTR_COPY_QTY              &lt;&gt; B.XS_MTR_COPY_QTY
                OR NVL(A.CONTR_XS_COPY_PK, - 1) &lt;&gt; B.CONTR_XS_COPY_PK
                OR A.XS_MTR_AMT_RATE            &lt;&gt; B.XS_MTR_AMT_RATE)
        ORDER BY 
            A.DS_CONTR_PK
            ,A.DS_CONTR_DTL_PK ASC 
            ,A.DS_CONTR_BLLG_MTR_PK ASC 
            ,A.PRC_EFF_MTR_RANK ASC
    </statement>
    <!-- END 2022/06/21 R.jin [QC#60216, MOD] -->  

    <!-- START  2024/01/11 S.Moriai [QC#62117,ADD] -->
    <statement id="getBillingRead" parameterClass="Map" resultClass="Map">
    WITH
    SOURCE_PHYS_MTR_READ as 
        (
            SELECT *
            FROM 
                (
                    SELECT
                        SPMR.SVC_MACH_MSTR_PK
                        ,SPMR.SVC_PHYS_MTR_READ_GRP_SQ
                    FROM
                        SVC_PHYS_MTR_READ SPMR
                    WHERE
                        SPMR.GLBL_CMPY_CD = #glblCmpyCd#
                        AND SPMR.EZCANCELFLAG = '0'
                        AND SPMR.VLD_MTR_FLG = 'Y'
                        AND SPMR.DS_MTR_READ_TP_GRP_CD = #dsMtrReadTpGrpCd#
                        AND SPMR.SVC_MACH_MSTR_PK = #svcMachMstrPk#
                        AND MTR_READ_DT &gt;= #mtrReadDt#
                        AND MTR_READ_DT &lt; #slsDt# 
                    ORDER BY
                        MTR_READ_DT DESC
                        ,SVC_PHYS_MTR_READ_GRP_SQ DESC
                )
            WHERE 
                ROWNUM = 1
        )
    ,CONTR_MTR_DATA AS
        (
            SELECT
                DC.DS_CONTR_PK
                ,DCD.DS_CONTR_DTL_PK
                ,DCD.SVC_MACH_MSTR_PK
                ,SPM.MDL_MTR_LB_CD
                ,CPBM.BLLG_MTR_LB_CD
                ,CPBM.BLLBL_FLG
            FROM
                DS_CONTR        DC
                ,DS_CONTR_DTL   DCD
                ,CONTR_PHYS_BLLG_MTR_RELN CPBM
                ,SVC_PHYS_MTR SPM
            WHERE
                DC.GLBL_CMPY_CD = #glblCmpyCd#
                AND DC.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
                AND DCD.GLBL_CMPY_CD = CPBM.GLBL_CMPY_CD
                AND CPBM.GLBL_CMPY_CD = SPM.GLBL_CMPY_CD
                AND DC.EZCANCELFLAG = '0'
                AND DCD.EZCANCELFLAG = '0'
                AND CPBM.EZCANCELFLAG = '0'
                AND SPM.EZCANCELFLAG = '0'
                AND DC.DS_CONTR_PK = DCD.DS_CONTR_PK
                AND DCD.DS_CONTR_DTL_PK = CPBM.DS_CONTR_DTL_PK
                AND SPM.SVC_PHYS_MTR_PK = CPBM.SVC_PHYS_MTR_PK
                AND DC.DS_CONTR_PK = #dsContrPk# 
        )
    SELECT DISTINCT
        CMD.DS_CONTR_PK
        ,CMD.DS_CONTR_DTL_PK
        ,CMD.SVC_MACH_MSTR_PK
        ,CMD.MDL_MTR_LB_CD
        ,CMD.BLLG_MTR_LB_CD
        ,CMD.BLLBL_FLG
        ,SPMR.SVC_PHYS_MTR_PK
        ,SPMR.MTR_READ_DT
        ,SPMR.DS_MTR_READ_TP_GRP_CD
        ,SPMR.READ_MTR_CNT
        ,SPMR.CARRY_OVER_TP_CD
        ,CASE
            WHEN CMD.BLLG_MTR_LB_CD IS NOT NULL AND SPMR.CARRY_OVER_TP_CD = 1 THEN 'Y'
            ELSE 'N'
         END AS "NG_ROW"
    FROM
        SVC_PHYS_MTR_READ SPMR
        ,CONTR_PHYS_BLLG_MTR_RELN CPBMR
        ,SOURCE_PHYS_MTR_READ SSPMR
        ,CONTR_MTR_DATA CMD
    WHERE
        SPMR.GLBL_CMPY_CD = #glblCmpyCd#
        AND SPMR.GLBL_CMPY_CD = CPBMR.GLBL_CMPY_CD
        AND SPMR.EZCANCELFLAG = '0'
        AND CPBMR.EZCANCELFLAG = '0'
        AND SSPMR.SVC_PHYS_MTR_READ_GRP_SQ = SPMR.SVC_PHYS_MTR_READ_GRP_SQ
        AND SSPMR.SVC_MACH_MSTR_PK = SPMR.SVC_MACH_MSTR_PK
        AND SPMR.SVC_PHYS_MTR_PK = CPBMR.SVC_PHYS_MTR_PK
        AND SPMR.SVC_MACH_MSTR_PK = CMD.SVC_MACH_MSTR_PK
        AND SPMR.MTR_LB_CD = CMD.MDL_MTR_LB_CD
    </statement>
    <!-- END  2024/01/11 S.Moriai [QC#62117,ADD] -->
</sqlMap>
