<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NPAL1420Query">
    <!--Search-->
    <statement id="searchNew" parameterClass="Map" resultClass="Map">
        SELECT
            RO.RMNF_ORD_NUM
            ,RO.RMNF_MAIN_UNIT_SER_NUM
            ,RO.RMNF_USG_RTL_WH_CD
            ,RO.RMNF_USG_RTL_SWH_CD
            ,RO.RMNF_ORD_STS_CD
            ,RW.RTL_WH_NM
            ,RS.INVTY_LOC_CD
            ,TM.TECH_NM
            ,ROS.RMNF_ORD_STS_DESC_TXT
            ,ROS.OPEN_STS_FLG
            ,RCPH.RMNF_COST_PER_HOUR_AMT
            ,GC.STD_CCY_CD
        FROM
            RMNF_ORD             RO
            ,RTL_WH              RW
            ,RTL_SWH             RS
            ,TECH_MSTR           TM
            ,RMNF_ORD_STS        ROS
            ,RMNF_COST_PER_HOUR  RCPH
            ,GLBL_CMPY           GC
        WHERE
                RO.GLBL_CMPY_CD            = #glblCmpyCd#
            AND RO.RMNF_ORD_NUM            = #rmnfOrdNum#
            AND RO.GLBL_CMPY_CD            = RW.GLBL_CMPY_CD
            AND RO.RMNF_RTL_WH_CD          = RW.RTL_WH_CD
            AND RO.GLBL_CMPY_CD            = RS.GLBL_CMPY_CD
            AND RO.RMNF_USG_RTL_WH_CD      = RS.RTL_WH_CD
            AND RO.RMNF_USG_RTL_SWH_CD     = RS.RTL_SWH_CD
            AND RO.GLBL_CMPY_CD            = TM.GLBL_CMPY_CD
            AND RO.OWNR_TECH_TOC_CD        = TM.TECH_TOC_CD
            AND RO.GLBL_CMPY_CD            = ROS.GLBL_CMPY_CD (+)
            AND RO.RMNF_ORD_STS_CD         = ROS.RMNF_ORD_STS_CD (+)
            AND RO.GLBL_CMPY_CD            = RCPH.GLBL_CMPY_CD
            AND RO.GLBL_CMPY_CD            = GC.GLBL_CMPY_CD
            AND RO.EZCANCELFLAG            = '0'
            AND RW.EZCANCELFLAG            = '0'
            AND RS.EZCANCELFLAG            = '0'
            AND TM.EZCANCELFLAG            = '0'
            AND ROS.EZCANCELFLAG (+)       = '0'
            AND RCPH.EZCANCELFLAG          = '0'
            AND GC.EZCANCELFLAG            = '0'
    </statement>

    <!--Search-->
    <statement id="searchEdit" parameterClass="Map" resultClass="Map">
        SELECT
            T.RMNF_ORD_NUM
            ,T.RMNF_MAIN_UNIT_SER_NUM
            ,T.RMNF_USG_RTL_WH_CD
            ,T.RMNF_USG_RTL_SWH_CD
            ,T.RMNF_ORD_STS_CD
            ,T.OWNR_TECH_TOC_CD
            ,T.RTL_WH_NM
            ,T.INVTY_LOC_CD
            ,T.TECH_NM1
            ,T.TECH_NM2
            ,T.RMNF_ORD_STS_DESC_TXT
            ,T.OPEN_STS_FLG
            ,T.RMNF_TASK_NUM
            ,T.RMNF_TASK_DESC_TXT
            ,T.RMNF_TASK_START_DT
            ,T.RMNF_TASK_END_DT
            ,T.SPCL_INSTN_CMNT_TXT
            ,T.RMNF_TASK_STS_CD
            ,T.RMNF_LBOR_AOT
            ,T.RMNF_LBOR_CMNT_TXT
            ,T.TECH_TOC_CD
            ,T.RMNF_COST_PER_HOUR_AMT
            ,T.RMNF_LBOR_COST_AMT
            ,T.STD_CCY_CD
            ,T.MDSE_CD
            ,T.PRT_UNIT_COST_AMT
            ,T.RMNF_PRT_QTY
            ,T.MDSE_DESC_SHORT_TXT
            ,T.RTRN_REQ_PRT_FLG
            ,T.INVTY_AVAL_QTY
            ,T.RMNF_TASK_PK
            ,T.EZUPTIME
            ,T.EZUPTIMEZONE
            ,T.RMNF_PRT_USG_COMIT_FLG
            ,T.RMNF_PRT_REL_QTY
        FROM
        (
            SELECT
                RO.RMNF_ORD_NUM
                ,RO.RMNF_MAIN_UNIT_SER_NUM
                ,RO.RMNF_USG_RTL_WH_CD
                ,RO.RMNF_USG_RTL_SWH_CD
                ,RO.RMNF_ORD_STS_CD
                ,RO.OWNR_TECH_TOC_CD
                ,RW.RTL_WH_NM
                ,RS.INVTY_LOC_CD
                ,TM1.TECH_NM AS TECH_NM1
                ,TM2.TECH_NM AS TECH_NM2
                ,ROS.RMNF_ORD_STS_DESC_TXT
                ,ROS.OPEN_STS_FLG
                ,RT.RMNF_TASK_NUM
                ,RT.RMNF_TASK_DESC_TXT
                ,RT.RMNF_TASK_START_DT
                ,RT.RMNF_TASK_END_DT
                ,RT.SPCL_INSTN_CMNT_TXT
                ,RT.RMNF_TASK_STS_CD
                ,RT.RMNF_LBOR_AOT
                ,RT.RMNF_LBOR_CMNT_TXT
                ,RT.TECH_TOC_CD
                ,DECODE(
                    RT.RMNF_TASK_STS_CD, #rmnfTaskStsCd#, RCPH.RMNF_COST_PER_HOUR_AMT, RT.RMNF_COST_PER_HOUR_AMT
                ) AS RMNF_COST_PER_HOUR_AMT
                ,RT.RMNF_LBOR_COST_AMT
                ,GC.STD_CCY_CD
                ,RU.MDSE_CD
                ,DECODE(
                    RT.RMNF_TASK_STS_CD, #rmnfTaskStsCd#, AMV.THIS_MTH_TOT_STD_COST_AMT, RU.PRT_UNIT_COST_AMT
                ) AS PRT_UNIT_COST_AMT
                ,RU.RMNF_PRT_QTY
                ,AMV.MDSE_DESC_SHORT_TXT
                ,AMV.RTRN_REQ_PRT_FLG
                ,NVL(RPR.SHIP_QTY,0) - NVL (RU2.RMNF_PRT_QTY_TOTAL, 0) -  NVL (RU4.RMNF_PRT_REL_QTY_TOTAL, 0) AS INVTY_AVAL_QTY
                ,RT.RMNF_TASK_PK
                ,RT.EZUPTIME
                ,RT.EZUPTIMEZONE
                ,RU.RMNF_PRT_USG_COMIT_FLG
                ,RU.RMNF_PRT_REL_QTY
            FROM
                RMNF_ORD             RO
                ,RTL_WH              RW
                ,RTL_SWH             RS
                ,TECH_MSTR           TM1
                ,TECH_MSTR           TM2
                ,RMNF_ORD_STS        ROS
                ,RMNF_TASK           RT
                ,GLBL_CMPY           GC
                ,RMNF_USG            RU
                ,ALL_MDSE_V          AMV
                ,RMNF_COST_PER_HOUR  RCPH
                ,(
                    SELECT 
                         B.MDSE_CD
                        ,SUM (B.SHIP_QTY) SHIP_QTY
                    FROM
                         SHPG_ORD_DTL    B
                        ,SHPG_STS        S
                    WHERE 
                        B.GLBL_CMPY_CD = #glblCmpyCd#
                    AND EXISTS (
                            SELECT 
                                A.SO_NUM 
                            FROM 
                                RMNF_PRT_REQ A 
                            WHERE 
                                A.GLBL_CMPY_CD  = B.GLBL_CMPY_CD 
                            AND A.SO_NUM        = B.SO_NUM 
                            AND A.RMNF_ORD_NUM  = #rmnfOrdNum#
                            AND A.EZCANCELFLAG  = '0'
                    )
                    AND B.GLBL_CMPY_CD = S.GLBL_CMPY_CD
                    AND B.SHPG_STS_CD  = S.SHPG_STS_CD
                    AND S.SHIP_FLG     = 'Y'
                    AND B.EZCANCELFLAG = '0'
                    AND S.EZCANCELFLAG = '0'
                    GROUP BY
                        B.MDSE_CD
                ) RPR
                ,(
                    SELECT 
                         GLBL_CMPY_CD
                        ,SUM (RMNF_PRT_QTY) RMNF_PRT_QTY_TOTAL
                        ,RMNF_ORD_NUM
                        ,MDSE_CD
                    FROM
                        RMNF_USG
                    WHERE GLBL_CMPY_CD   = #glblCmpyCd#
                    AND   RMNF_ORD_NUM   = #rmnfOrdNum#
                    AND   RMNF_PRT_USG_COMIT_FLG = 'Y'
                    AND   EZCANCELFLAG   = '0'
                    GROUP BY 
                        GLBL_CMPY_CD
                       ,RMNF_ORD_NUM
                       ,MDSE_CD
                ) RU2
                ,(
                    SELECT 
                         GLBL_CMPY_CD
                        ,SUM (RMNF_PRT_REL_QTY) RMNF_PRT_REL_QTY_TOTAL
                        ,RMNF_ORD_NUM
                        ,MDSE_CD
                    FROM
                        RMNF_USG
                    WHERE GLBL_CMPY_CD   = #glblCmpyCd#
                    AND   RMNF_ORD_NUM   = #rmnfOrdNum#
                    AND   RMNF_PRT_USG_COMIT_FLG = 'Y'
                    AND   EZCANCELFLAG   = '0'
                    GROUP BY 
                        GLBL_CMPY_CD
                       ,RMNF_ORD_NUM
                       ,MDSE_CD
                ) RU4
            WHERE
                    RO.GLBL_CMPY_CD            = #glblCmpyCd#
                AND RO.RMNF_ORD_NUM            = #rmnfOrdNum#
                AND RO.GLBL_CMPY_CD            = RW.GLBL_CMPY_CD
                AND RO.RMNF_RTL_WH_CD          = RW.RTL_WH_CD
                AND RO.GLBL_CMPY_CD            = RS.GLBL_CMPY_CD
                AND RO.RMNF_USG_RTL_WH_CD      = RS.RTL_WH_CD
                AND RO.RMNF_USG_RTL_SWH_CD     = RS.RTL_SWH_CD
                AND RO.GLBL_CMPY_CD            = TM1.GLBL_CMPY_CD
                AND RO.OWNR_TECH_TOC_CD        = TM1.TECH_TOC_CD
                AND RO.GLBL_CMPY_CD            = ROS.GLBL_CMPY_CD (+)
                AND RO.RMNF_ORD_STS_CD         = ROS.RMNF_ORD_STS_CD (+)
                AND RO.GLBL_CMPY_CD            = RT.GLBL_CMPY_CD
                AND RO.RMNF_ORD_NUM            = RT.RMNF_ORD_NUM
                AND RT.RMNF_TASK_NUM           = #rmnfTaskNum#
                AND RT.GLBL_CMPY_CD            = TM2.GLBL_CMPY_CD
                AND RT.TECH_TOC_CD             = TM2.TECH_TOC_CD
                AND RO.GLBL_CMPY_CD            = GC.GLBL_CMPY_CD
                AND RT.GLBL_CMPY_CD            = RU.GLBL_CMPY_CD (+)
                AND RT.RMNF_TASK_PK            = RU.RMNF_TASK_PK (+)
                AND RU.GLBL_CMPY_CD            = AMV.GLBL_CMPY_CD (+)
                AND RU.MDSE_CD                 = AMV.MDSE_CD (+)

                AND RU.MDSE_CD                 = RPR.MDSE_CD (+)
                AND RPR.MDSE_CD                = RU2.MDSE_CD(+)
                AND RPR.MDSE_CD                = RU4.MDSE_CD(+)

                AND (RU.RMNF_PRT_QTY(+) &gt; 0 OR RU.RMNF_PRT_REL_QTY(+) &gt; 0)

                AND RT.GLBL_CMPY_CD            = RCPH.GLBL_CMPY_CD
                AND RO.EZCANCELFLAG            = '0'
                AND RW.EZCANCELFLAG            = '0'
                AND RS.EZCANCELFLAG            = '0'
                AND TM1.EZCANCELFLAG           = '0'
                AND TM2.EZCANCELFLAG           = '0'
                AND ROS.EZCANCELFLAG (+)       = '0'
                AND RT.EZCANCELFLAG            = '0'
                AND GC.EZCANCELFLAG            = '0'
                AND RU.EZCANCELFLAG (+)        = '0'
                AND AMV.EZCANCELFLAG (+)       = '0'
                AND RCPH.EZCANCELFLAG          = '0'
            ORDER BY
                 RU.EZINTIME
                ,RU.RMNF_USG_PK
        ) T
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getTechnician" parameterClass="Map" resultClass="Map">
        SELECT
            TM.TECH_TOC_CD
            ,SP.PSN_FIRST_NM
            ,SP.PSN_LAST_NM
        FROM
            TECH_MSTR      TM
            ,S21_PSN       SP
        WHERE
                TM.GLBL_CMPY_CD            = #glblCmpyCd#
            AND TM.TECH_TOC_CD             = #techTocCd#
            AND TM.GLBL_CMPY_CD            = SP.GLBL_CMPY_CD
            AND TM.TECH_TOC_CD             = SP.PSN_CD
            AND SP.EFF_FROM_DT                  &lt;= #effFromDt#
            AND NVL(SP.EFF_THRU_DT, '99991231') &gt;= #effThruDt#
            <isNotNull property="delFlg">
                AND SP.DEL_FLG                 = #delFlg#
            </isNotNull>
            AND TM.EZCANCELFLAG            = '0'
            AND SP.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getInvAvalQty1" parameterClass="Map" resultClass="Map">
        SELECT
            M.RTRN_REQ_PRT_FLG
            ,M.THIS_MTH_TOT_STD_COST_AMT
            ,NVL(RPR.SHIP_QTY,0) - NVL (RU2.RMNF_PRT_QTY_TOTAL, 0)  - NVL (RU4.RMNF_PRT_REL_QTY_TOTAL, 0) AS INVTY_AVAL_QTY
        FROM
            ALL_MDSE_V    M
            ,(
                SELECT 
                     B.MDSE_CD
                    ,SUM (B.SHIP_QTY) SHIP_QTY
                FROM
                    SHPG_ORD_DTL     B
                    ,SHPG_STS        S
                WHERE 
                    B.GLBL_CMPY_CD = #glblCmpyCd#
                AND EXISTS (
                            SELECT 
                                A.SO_NUM 
                            FROM 
                                RMNF_PRT_REQ A 
                            WHERE 
                                A.GLBL_CMPY_CD   = B.GLBL_CMPY_CD 
                            AND A.SO_NUM         = B.SO_NUM 
                            AND A.RMNF_ORD_NUM   = #rmnfOrdNum#
                            AND A.EZCANCELFLAG   = '0'
                    )
                AND B.GLBL_CMPY_CD = S.GLBL_CMPY_CD
                AND B.SHPG_STS_CD  = S.SHPG_STS_CD
                AND S.SHIP_FLG     = 'Y'
                AND B.EZCANCELFLAG = '0'
                AND S.EZCANCELFLAG = '0'
                GROUP BY
                    B.MDSE_CD
             ) RPR
            ,(
                SELECT 
                    GLBL_CMPY_CD
                    ,SUM (RMNF_PRT_QTY) RMNF_PRT_QTY_TOTAL
                    ,RMNF_ORD_NUM
                    ,MDSE_CD
                FROM
                    RMNF_USG
                WHERE
                    GLBL_CMPY_CD = #glblCmpyCd#
                AND RMNF_ORD_NUM = #rmnfOrdNum#
                AND RMNF_PRT_USG_COMIT_FLG = 'Y'
                AND EZCANCELFLAG = '0'
                GROUP BY 
                     GLBL_CMPY_CD
                     ,RMNF_ORD_NUM
                     ,MDSE_CD
            ) RU2
            ,(
                SELECT 
                    GLBL_CMPY_CD
                    ,SUM (RMNF_PRT_REL_QTY) RMNF_PRT_REL_QTY_TOTAL
                    ,RMNF_ORD_NUM
                    ,MDSE_CD
                FROM
                    RMNF_USG
                WHERE
                    GLBL_CMPY_CD = #glblCmpyCd#
                AND RMNF_ORD_NUM = #rmnfOrdNum#
                AND RMNF_PRT_USG_COMIT_FLG = 'Y'
                AND EZCANCELFLAG = '0'
                GROUP BY 
                     GLBL_CMPY_CD
                     ,RMNF_ORD_NUM
                     ,MDSE_CD
            ) RU4
        WHERE
                M.GLBL_CMPY_CD            = #glblCmpyCd#
            AND M.MDSE_CD                 = #mdseCd#
            AND M.MDSE_CD                 = RPR.MDSE_CD (+)
            AND RPR.MDSE_CD               = RU2.MDSE_CD(+)
            AND RPR.MDSE_CD               = RU4.MDSE_CD(+)
            AND M.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getInvAvalQty2" parameterClass="Map" resultClass="Map">
        SELECT
             M.MDSE_DESC_SHORT_TXT
            ,M.RTRN_REQ_PRT_FLG
            ,M.THIS_MTH_TOT_STD_COST_AMT
            ,NVL(RPR.SHIP_QTY,0) - NVL (RU2.RMNF_PRT_QTY_TOTAL, 0)  - NVL (RU4.RMNF_PRT_REL_QTY_TOTAL, 0) AS INVTY_AVAL_QTY
        FROM
            ALL_MDSE_V     M
            ,MDSE_ITEM_STS MIS
            ,(
                SELECT
                    B.MDSE_CD
                    ,SUM (B.SHIP_QTY) SHIP_QTY
                FROM
                    SHPG_ORD_DTL     B
                   ,SHPG_STS        S
                WHERE 
                    B.GLBL_CMPY_CD = #glblCmpyCd#
                AND EXISTS (
                        SELECT 
                            A.SO_NUM 
                        FROM 
                            RMNF_PRT_REQ A 
                        WHERE 
                            A.GLBL_CMPY_CD  = B.GLBL_CMPY_CD 
                        AND A.SO_NUM        = B.SO_NUM 
                        AND A.RMNF_ORD_NUM  = #rmnfOrdNum#
                        AND A.EZCANCELFLAG  = '0'
                    )
                AND B.GLBL_CMPY_CD = S.GLBL_CMPY_CD
                AND B.SHPG_STS_CD  = S.SHPG_STS_CD
                AND S.SHIP_FLG     = 'Y'
                AND B.EZCANCELFLAG = '0'
                AND S.EZCANCELFLAG = '0'
                GROUP BY
                    B.MDSE_CD
             ) RPR
            ,(
                 SELECT 
                     GLBL_CMPY_CD
                     ,SUM (RMNF_PRT_QTY) RMNF_PRT_QTY_TOTAL
                     ,RMNF_ORD_NUM
                     ,MDSE_CD
                 FROM
                     RMNF_USG
                 WHERE 
                         GLBL_CMPY_CD = #glblCmpyCd#
                     AND RMNF_ORD_NUM = #rmnfOrdNum#
                     AND RMNF_PRT_USG_COMIT_FLG = 'Y'
                     AND EZCANCELFLAG = '0'
                 GROUP BY 
                     GLBL_CMPY_CD
                     ,RMNF_ORD_NUM
                     ,MDSE_CD
                ) RU2
            ,(
                SELECT 
                    GLBL_CMPY_CD
                    ,SUM (RMNF_PRT_REL_QTY) RMNF_PRT_REL_QTY_TOTAL
                    ,RMNF_ORD_NUM
                    ,MDSE_CD
                FROM
                    RMNF_USG
                WHERE
                    GLBL_CMPY_CD = #glblCmpyCd#
                AND RMNF_ORD_NUM = #rmnfOrdNum#
                 AND RMNF_PRT_USG_COMIT_FLG = 'Y'
                 AND EZCANCELFLAG = '0'
                 GROUP BY 
                     GLBL_CMPY_CD
                     ,RMNF_ORD_NUM
                     ,MDSE_CD
            ) RU4
            WHERE
                M.GLBL_CMPY_CD            = #glblCmpyCd#
            AND M.MDSE_CD                 = #mdseCd#
            AND M.GLBL_CMPY_CD            = MIS.GLBL_CMPY_CD
            AND M.MDSE_ITEM_STS_CD        = MIS.MDSE_ITEM_STS_CD
            AND MIS.PRCH_AVAL_FLG         = #prchAvalFlg#
            AND M.MDSE_CD                 = RPR.MDSE_CD (+)
            AND RPR.MDSE_CD               = RU2.MDSE_CD(+)
            AND RPR.MDSE_CD               = RU4.MDSE_CD(+)
            AND M.EZCANCELFLAG            = '0'
            AND MIS.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getPartsUsage" parameterClass="Map" resultClass="Map">
        SELECT
            U.RMNF_USG_PK
           ,U.RMNF_TASK_PK
           ,U.RMNF_ORD_NUM
           ,U.RMNF_TASK_NUM
           ,U.RMNF_USG_LINE_NUM
           ,U.RMNF_INVTY_LOC_CD  AS RMNF_USG_INVTY_LOC_CD
           ,U.RMNF_USG_RTRN_INVTY_LOC_CD
           ,U.RTRN_REQ_PRT_FLG
           ,U.MDSE_CD
           ,U.RMNF_PRT_QTY
           ,U.PRT_UNIT_COST_AMT
           ,U.RMNF_PRT_USG_COST_AMT
           ,U.ASSET_RECOV_COST_AMT
           ,M.RTRN_REQ_PRT_FLG
           ,M.RTRN_DSPL_TP_CD
           ,S.INVTY_LOC_CD
        FROM
            RMNF_USG     U
           ,MDSE         M
           ,RTL_SWH      S
        WHERE
            U.GLBL_CMPY_CD     = #glblCmpyCd#
        AND U.RMNF_ORD_NUM     = #rmnfOrdNum#
        AND U.RMNF_TASK_NUM    = #rmnfTaskNum#
        AND U.GLBL_CMPY_CD     = M.GLBL_CMPY_CD
        AND U.MDSE_CD          = M.MDSE_CD
        AND U.RMNF_PRT_QTY      &gt; 0
        AND U.RMNF_PRT_USG_COMIT_FLG = 'N'
        AND M.GLBL_CMPY_CD     = S.GLBL_CMPY_CD (+)
        AND M.RTRN_DSPL_TP_CD  = S.RTL_SWH_CD (+)
        AND S.RTL_WH_CD (+)    = #rtlWhCd#
        AND U.EZCANCELFLAG     = '0'
        AND M.EZCANCELFLAG     = '0'
        AND S.EZCANCELFLAG (+) = '0'
    </statement>


    <statement id="getShippingPlanForSubmit" parameterClass="Map" resultClass="Map">
        SELECT
            S.SHPG_PLN_NUM
            ,S.TRX_LINE_NUM
            ,S.TRX_LINE_SUB_NUM
        FROM
            SHPG_PLN        S
        WHERE
                S.GLBL_CMPY_CD           = #glblCmpyCd#
            AND S.TRX_SRC_TP_CD          = #trxSrcTpCd#
            AND S.TRX_HDR_NUM            = #trxHdrNum#
            AND S.TRX_LINE_NUM           = #trxLineNum#
            AND S.TRX_LINE_SUB_NUM       = #trxLineSubNum#
            AND S.EZCANCELFLAG           = '0'
    </statement>
    <statement id="getShippingOrderForSubmit" parameterClass="Map" resultClass="Map">
        SELECT
            S.SO_NUM
           ,S.SO_SLP_NUM
           ,S.MDSE_CD
           ,S.FROM_STK_STS_CD
           ,S.SHPG_QTY
           ,S.INVTY_LOC_CD
        FROM
            SHPG_ORD_DTL     S
        WHERE
            S.GLBL_CMPY_CD = #glblCmpyCd#
        AND S.SO_NUM       = #soNum#
        AND S.EZCANCELFLAG = '0'
        ORDER BY
            S.SO_SLP_NUM
    </statement>

    <statement id="getUnusedParts" parameterClass="Map" resultClass="Map">
        SELECT
            U.RMNF_USG_PK
           ,U.RMNF_TASK_PK
           ,U.RMNF_ORD_NUM
           ,U.RMNF_TASK_NUM
           ,U.RMNF_USG_LINE_NUM
           ,U.RMNF_INVTY_LOC_CD  AS RMNF_USG_INVTY_LOC_CD
           ,U.RMNF_USG_RTRN_INVTY_LOC_CD
           ,U.RTRN_REQ_PRT_FLG
           ,U.MDSE_CD
           ,U.RMNF_PRT_QTY
           ,U.RMNF_PRT_REL_QTY
           ,U.PRT_UNIT_COST_AMT
           ,U.RMNF_PRT_USG_COST_AMT
           ,U.ASSET_RECOV_COST_AMT
           ,M.RTRN_REQ_PRT_FLG
           ,M.RTRN_DSPL_TP_CD
           ,S.INVTY_LOC_CD
        FROM
            RMNF_USG     U
           ,MDSE         M
           ,RTL_SWH      S
        WHERE
            U.GLBL_CMPY_CD     = #glblCmpyCd#
        AND U.RMNF_ORD_NUM     = #rmnfOrdNum#
        AND U.RMNF_TASK_NUM    = #rmnfTaskNum#
        AND U.GLBL_CMPY_CD     = M.GLBL_CMPY_CD
        AND U.MDSE_CD          = M.MDSE_CD
        AND U.RMNF_PRT_REL_QTY &gt; 0
        AND U.RMNF_PRT_USG_COMIT_FLG = 'N'
        AND M.GLBL_CMPY_CD     = S.GLBL_CMPY_CD (+)
        AND M.RTRN_DSPL_TP_CD  = S.RTL_SWH_CD (+)
        AND S.RTL_WH_CD (+)    = #rtlWhCd#
        AND U.EZCANCELFLAG     = '0'
        AND M.EZCANCELFLAG     = '0'
        AND S.EZCANCELFLAG (+) = '0'
    </statement>
    <!-- 
    <statement id="getUnusedParts" parameterClass="Map" resultClass="Map">
        SELECT
            UNUSED_QTY
           ,MDSE_CD
           ,INVTY_LOC_CD
        FROM
            (
                SELECT
                    SUM(R.PRT_RQST_QTY) -
                        (
                            SELECT
                                NVL( SUM(RU.RMNF_PRT_QTY), 0)
                            FROM
                                RMNF_USG RU
                            WHERE
                                    RU.GLBL_CMPY_CD = #glblCmpyCd#
                                AND RU.RMNF_ORD_NUM = #rmnfOrdNum#
                                AND RU.MDSE_CD      = R.MDSE_CD
                                AND RU.EZCANCELFLAG = '0'
                        ) AS UNUSED_QTY
                   ,R.MDSE_CD
                   ,RS.INVTY_LOC_CD
                FROM
                    RMNF_PRT_REQ R
                   ,RMNF_ORD     RO
                   ,RTL_SWH      RS
                WHERE
                    R.GLBL_CMPY_CD         = #glblCmpyCd#
                AND R.RMNF_ORD_NUM         = #rmnfOrdNum#
                AND R.SO_NUM               IS NOT NULL
                AND R.RMNF_PRT_RQST_PROC_CD= #completed#
                AND R.EZCANCELFLAG         = '0'
                AND R.GLBL_CMPY_CD         = RO.GLBL_CMPY_CD
                AND R.RMNF_ORD_NUM         = RO.RMNF_ORD_NUM
                AND RO.EZCANCELFLAG        = '0'
                AND RO.GLBL_CMPY_CD        = RS.GLBL_CMPY_CD
                AND RO.RMNF_USG_RTL_WH_CD  = RS.RTL_WH_CD
                AND RO.RMNF_USG_RTL_SWH_CD = RS.RTL_SWH_CD
                AND RS.EZCANCELFLAG        = '0'
                GROUP BY
                    R.MDSE_CD
                   ,RS.INVTY_LOC_CD
            )
        WHERE
            UNUSED_QTY &gt; 0
    </statement>
 -->
    <statement id="getShippingPlanForParts" parameterClass="Map" resultClass="Map">
        SELECT
            S.SHPG_PLN_NUM
           ,R.RMNF_PRT_REQ_LINE_NUM
        FROM
            RMNF_PRT_REQ R
           ,SHPG_PLN     S
        WHERE
            R.GLBL_CMPY_CD          = #glblCmpyCd#
        AND R.RMNF_ORD_NUM          = #rmnfOrdNum#
        <isEqual property="createFlg" compareValue="Y">
        AND (   R.RMNF_PRT_RQST_PROC_CD = #rmnfPrtRqstProcCdInComp#
             OR (    R.RMNF_PRT_RQST_PROC_CD = #rmnfPrtRqstProcCdComp#
                 AND R.SO_NUM IS NULL
                )
            )
        </isEqual>
        <isNotEqual property="createFlg" compareValue="Y">
        AND R.RMNF_PRT_RQST_PROC_CD = #rmnfPrtRqstProcCdComp#
        </isNotEqual>
        AND R.GLBL_CMPY_CD          = S.GLBL_CMPY_CD
        AND R.RMNF_ORD_NUM          = S.TRX_HDR_NUM
        AND R.RMNF_PRT_REQ_LINE_NUM = S.TRX_LINE_NUM
        AND S.TRX_SRC_TP_CD         = #trxSrcTpCd#
        AND S.SHPG_STS_CD           != #shpgStsCd#
        AND R.EZCANCELFLAG          = '0'
        AND S.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getRmnfPrtUsgCostAmt" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            NVL (SUM( R.RMNF_PRT_QTY * M.THIS_MTH_TOT_STD_COST_AMT) , 0 ) AS CAL_RMNF_PRT_USG_COST_AMT
        FROM
            RMNF_USG R
           ,MDSE     M
        WHERE 1 = 1
        AND R.EZCANCELFLAG  = '0'
        AND R.GLBL_CMPY_CD  = #glblCmpyCd#
        AND R.MDSE_CD       = M.MDSE_CD
        AND R.RMNF_ORD_NUM  = #rmnfOrdNum#
         <isNotNull property="rmnfTaskNum" >
        AND R.RMNF_TASK_NUM = #rmnfTaskNum#
         </isNotNull>
        AND R.GLBL_CMPY_CD  = M.GLBL_CMPY_CD
        AND M.EZCANCELFLAG  = '0'
    </statement>

    <statement id="getRmnfToCmptMdseCd" parameterClass="Map" resultClass="String">
        SELECT 
            RD.RMNF_TO_CMPT_MDSE_CD
        FROM 
            RMNF_ORD     RO
           ,RMNF_ORD_DTL RD
        WHERE 1 = 1
        AND RO.GLBL_CMPY_CD           = #glblCmpyCd#
        AND RO.RMNF_ORD_NUM           = #rmnfOrdNum#
        AND RO.EZCANCELFLAG           = '0'
        AND RO.RMNF_ORD_NUM           = RD.RMNF_ORD_NUM
        AND RO.RMNF_MAIN_UNIT_MDSE_CD = RD.CMPT_MDSE_CD
        AND RO.GLBL_CMPY_CD           = RD.GLBL_CMPY_CD
        AND RD.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getRmnTotLborCostAmtBeforeComp" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             (
             SELECT 
                NVL (SUM(RT.RMNF_LBOR_AOT), 0)
             FROM 
                RMNF_TASK RT
             WHERE 1 = 1
             AND RT.GLBL_CMPY_CD  =  #glblCmpyCd#
             AND RT.EZCANCELFLAG  = '0'
             AND RT.RMNF_ORD_NUM  =  #rmnfOrdNum#
              <isNotNull property="rmnfTaskNum" >
             AND RT.RMNF_TASK_NUM = #rmnfTaskNum#
             </isNotNull>
             AND RT.RMNF_TASK_STS_CD != #cancel#
             ) 
             * 
             (
             SELECT 
                 NVL (RCPH.RMNF_COST_PER_HOUR_AMT , 0)
             FROM
                 RMNF_COST_PER_HOUR RCPH
             WHERE 1=1
             AND ROWNUM = 1
             ) AS CAL_RMNF_LBOR_AOT
        FROM
            DUAL
    </statement>

    <statement id="getRmnTotLborCostAmt" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            NVL (SUM(RT.RMNF_COST_PER_HOUR_AMT * RT.RMNF_LBOR_AOT) , 0 ) AS CAL_RMNF_TOT_LBOR_COST_AMT
        FROM 
            RMNF_TASK RT
        WHERE 1=1
        AND RT.RMNF_ORD_NUM      = #rmnfOrdNum#
        AND RT.GLBL_CMPY_CD      = #glblCmpyCd#
         <isNotNull property="rmnfTaskNum" >
        AND RT.RMNF_TASK_NUM     = #rmnfTaskNum#
         </isNotNull>
        AND RT.RMNF_TASK_STS_CD != #cancel#
        AND RT.EZCANCELFLAG      = '0'
    </statement>

    <statement id="getShippingPlan" parameterClass="Map" resultClass="Map">
        SELECT
            S.SHPG_PLN_NUM
            ,S.TRX_LINE_NUM
        FROM
            SHPG_PLN        S
        WHERE
                S.GLBL_CMPY_CD           = #glblCmpyCd#
            AND S.TRX_SRC_TP_CD          = #trxSrcTpCd#
            AND S.TRX_HDR_NUM            = #trxHdrNum#
            AND S.SHPG_STS_CD            != #shpgStsCd#
            AND S.SO_NUM                 IS NULL
            AND S.EZCANCELFLAG           = '0'
    </statement>

    <!-- QC#26640 Update SQL. 06/14/2018 -->
    <statement id="getWmsAdjInfo" parameterClass="Map" resultClass="Map">
        SELECT
             WH.WMS_WH_CD                   AS WMS_WH_CD
            ,WH.WH_OWNR_CD || WH.RTL_SWH_CD AS PACK_CD_TXT
            ,WH.WMS_ADJ_DNLD_INTFC_ID       AS WMS_ADJ_DNLD_INTFC_ID
        FROM
            DS_RTL_WH_V     WH
        WHERE
            WH.GLBL_CMPY_CD            = #glblCmpyCd#
        AND WH.INVTY_LOC_CD            = #invtyLocCd#
        AND WH.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getMaxRwsRefNum" parameterClass="Map" resultClass="String">
        SELECT 
            MAX(RWS.RWS_REF_NUM) 
        FROM 
            RWS_HDR RWS
        WHERE 
            RWS.GLBL_CMPY_CD       = #glblCmpyCd#
        AND RWS.PO_RCV_TRX_HDR_NUM = #poRcvTrxHdrNum# 
        AND RWS.SCE_ORD_TP_CD      = #sceOrdTpCd#
        AND RWS.EZCANCELFLAG       = '0'
    </statement>
    <statement id="getUsgPartsForStsUpd" parameterClass="Map" resultClass="Map">
        SELECT
            U.RMNF_USG_PK
        FROM
            RMNF_USG     U
        WHERE
            U.GLBL_CMPY_CD     = #glblCmpyCd#
        AND U.RMNF_ORD_NUM     = #rmnfOrdNum#
        AND U.RMNF_TASK_NUM    = #rmnfTaskNum#
        AND U.RMNF_PRT_USG_COMIT_FLG = 'N'
        AND U.EZCANCELFLAG     = '0'
    </statement>
</sqlMap>
