<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLBL3140Query">

    <typeAlias alias="NLBL3140SMsg"   type="business.blap.NLBL3140.NLBL3140SMsg" />
    <typeAlias alias="NLBL3140_ASMsg" type="business.blap.NLBL3140.NLBL3140_ASMsg" />

    <statement id="searchResultList" parameterClass="Map" resultMap="result.searchResultList">
        SELECT
             *
        FROM
            (
            SELECT
                  MWC.MDSE_WH_COND_PK
                , MWC.LINE_BIZ_TP_CD
                , MWC.RTL_WH_CD
                , RW.RTL_WH_NM
                , MWC.RTL_SWH_CD
                , RS.RTL_SWH_NM
                , MWC.DS_ORD_CATG_CD
                , DOC.DS_ORD_CATG_NM
                , MWC.INVTY_HARD_ALLOC_TP_CD
                , MWC.TM_FENCE_DAYS_AOT
                , MWC.EZUPTIME
                , MWC.EZUPTIMEZONE
                <!-- START 2023/7/6 G.Quan [QC#61543, ADD] -->
                , MWC.COA_PROD_CD
                , CP.COA_PROD_NM
                <!-- END 2023/7/6 G.Quan [QC#61543, ADD] -->
            FROM
	              MDSE_WH_COND MWC
	            , RTL_WH RW
	            , RTL_SWH RS
	            , DS_ORD_CATG DOC
	            <!-- START 2023/7/6 G.Quan [QC#61543, ADD] -->
	            , COA_PROD CP
	            <!-- END 2023/7/6 G.Quan [QC#61543, ADD] -->
    
            WHERE
                    MWC.GLBL_CMPY_CD   = #glblCmpyCd#
                AND MWC.EZCANCELFLAG = '0'
            <isNotNull property="lineBizTpCd">
                AND MWC.LINE_BIZ_TP_CD = #lineBizTpCd#
            </isNotNull>
                AND MWC.MDSE_WH_COND_TP_CD = #condTpCd#
            <isNotNull property="rtlWhCd">
                AND MWC.RTL_WH_CD LIKE #rtlWhCd#
            </isNotNull>
            <isNotNull property="rtlSwhCd">
                AND MWC.RTL_SWH_CD LIKE #rtlSwhCd#
            </isNotNull>
            <isNotNull property="dsOrdCatgCd">
                AND MWC.DS_ORD_CATG_CD = #dsOrdCatgCd#
            </isNotNull>
            <isNotNull property="hardAllocTpCd">
                AND MWC.INVTY_HARD_ALLOC_TP_CD = #hardAllocTpCd#
            </isNotNull>
            <isNotNull property="dsOrdCatgDescTxt">
            	AND MWC.DS_ORD_CATG_CD IN (
            	    SELECT 
            	        DS_ORD_CATG_CD 
            	    FROM 
            	        DS_ORD_CATG 
            	    WHERE 
            	        DS_ORD_CATG_DESC_TXT LIKE #dsOrdCatgDescTxt#
            	   )
            </isNotNull>
            <!-- START 2023/7/6 G.Quan [QC#61543, ADD] -->
            <isNotNull property="coaProdCd">
                AND MWC.COA_PROD_CD LIKE #coaProdCd#
            </isNotNull>
            <!-- END 2023/7/6 G.Quan [QC#61543, ADD] -->
    
                AND MWC.GLBL_CMPY_CD = RW.GLBL_CMPY_CD(+)
                AND MWC.RTL_WH_CD = RW.RTL_WH_CD(+)
                AND RW.EZCANCELFLAG(+) = '0'

                AND MWC.GLBL_CMPY_CD = RS.GLBL_CMPY_CD(+)
                AND MWC.RTL_WH_CD =  RS.RTL_WH_CD(+)
                AND MWC.RTL_SWH_CD = RS.RTL_SWH_CD(+)
                AND RS.EZCANCELFLAG(+) = '0'

                AND MWC.GLBL_CMPY_CD = DOC.GLBL_CMPY_CD(+)
                AND MWC.DS_ORD_CATG_CD = DOC.DS_ORD_CATG_CD(+)
                AND DOC.EZCANCELFLAG(+) = '0'

                <!-- START 2023/7/6 G.Quan [QC#61543, ADD] -->
                AND MWC.GLBL_CMPY_CD = CP.GLBL_CMPY_CD(+)
                AND MWC.COA_PROD_CD = CP.COA_PROD_CD(+)
                AND CP.EZCANCELFLAG(+) = '0'
                <!-- END 2023/7/6 G.Quan [QC#61543, ADD] -->
            )
         WHERE
             ROWNUM <![CDATA[<=]]> #rowNum# 
<!-- 2017/08/14 QC#20555 ADD BEGIN -->
         ORDER BY
               LINE_BIZ_TP_CD
             , RTL_WH_CD
             , RTL_SWH_CD
             , DS_ORD_CATG_NM
<!-- 2017/08/14 QC#20555 ADD END -->

    </statement>
         
    <resultMap id="result.searchResultList" class="NLBL3140_ASMsg">
        <result property="lineBizTpCd_A"      column="LINE_BIZ_TP_CD"         javaType="EZDSStringItem" />
        <result property="rtlWhCd_A"          column="RTL_WH_CD"              javaType="EZDSStringItem" />
        <result property="rtlWhNm_A"          column="RTL_WH_NM"              javaType="EZDSStringItem" />
        <result property="rtlSwhCd_A"         column="RTL_SWH_CD"             javaType="EZDSStringItem" />
        <result property="rtlSwhNm_A"         column="RTL_SWH_NM"             javaType="EZDSStringItem" />
        <result property="dsOrdCatgCd_A"      column="DS_ORD_CATG_CD"         javaType="EZDSStringItem" />
        <result property="dsOrdCatgDescTxt_A" column="DS_ORD_CATG_NM"         javaType="EZDSStringItem" />
        <result property="hardAllocTpCd_A"    column="INVTY_HARD_ALLOC_TP_CD" javaType="EZDSStringItem" />
        <result property="tmFenceDaysAot_A"   column="TM_FENCE_DAYS_AOT"      javaType="EZDCBigDecimalItem" />
        <result property="ezUpTime_A"         column="EZUPTIME"               javaType="EZDSStringItem" />
        <result property="ezUpTimeZone_A"     column="EZUPTIMEZONE"           javaType="EZDSStringItem" />
        <result property="mdseWhCondPk_A"     column="MDSE_WH_COND_PK"        javaType="EZDCBigDecimalItem" />
        <!-- START 2023/7/6 G.Quan [QC#61543, ADD] -->
        <result property="coaProdCd_A"     column="COA_PROD_CD"               javaType="EZDSStringItem" />
        <result property="coaProdNm_A"     column="COA_PROD_NM"               javaType="EZDSStringItem" />
        <!-- END 2023/7/6 G.Quan [QC#61543, ADD] -->
    </resultMap>

    <statement id="checkRegisteredRule" parameterClass="Map" resultClass="Map">
        SELECT
            COUNT(MDSE_WH_COND_PK) CN
        FROM
            MDSE_WH_COND MWC
        WHERE
                MWC.GLBL_CMPY_CD           = #glblCmpyCd#
<!-- 2017/08/14 QC#20555 MOD BEGIN -->
            <isNotNull property="mdseWhCondPk">
                AND MWC.MDSE_WH_COND_PK &lt;&gt; #mdseWhCondPk#
            </isNotNull>
            AND MWC.MDSE_CD                = #mdseCd#
            AND MWC.RTL_WH_CD              = #rtlWhCd#
<!--            AND MWC.RTL_SWH_CD             = #rtlSwhCd#-->
            AND MWC.RTL_SWH_CD            IN (#rtlSwhCd#, #asterisk#)
            AND MWC.LINE_BIZ_TP_CD         = #lineBizTpCd#
<!--            AND MWC.DS_ORD_CATG_CD         = #dsOrdCatgCd#-->
            AND MWC.DS_ORD_CATG_CD        IN (#dsOrdCatgCd#, #asterisk#)
            AND MWC.INVTY_HARD_ALLOC_TP_CD = #invtyHardAllocTpCd# <!-- 2017/08/24 QC#20555 -->
<!-- 2017/08/14 QC#20555 MOD END -->
<!-- START 2023/7/10 G.Quan [QC#61543, ADD] -->
            AND MWC.COA_PROD_CD           IN (#coaProdCd#, #asterisk#)
<!-- END 2023/7/10 G.Quan [QC#61543, ADD] -->
            AND MWC.MDSE_WH_COND_TP_CD     = #mdseWhCondTpCd#
            AND MWC.EZCANCELFLAG           = '0'
    </statement>
    
    <statement id="checkOrdCatg" parameterClass="Map" resultClass="Map">
        SELECT
           DOC.DS_ORD_CATG_CD    
        FROM    
	        DS_ORD_CATG DOC 
        WHERE    
<!-- 2017/08/14 QC#20555 DEL BEGIN -->
<!--	        DOC.DS_ORD_CATG_CD IN (-->
<!--		        SELECT            -->
<!--			        DOT.DS_ORD_CATG_CD AS DS_ORD_CATG_CD        -->
<!--		        FROM            -->
<!--			          AVAL_DS_ORD_TP_APP_ID AD           -->
<!--			        , DS_ORD_TP             DOT        -->
<!--		        WHERE            -->
<!--			            AD.GLBL_CMPY_CD      = #glblCmpyCd#            -->
<!--			        AND AD.BIZ_APP_ID    = 'NLBL3140'             -->
<!--			        AND AD.EZCANCELFLAG  = '0'            -->
<!--			        AND AD.GLBL_CMPY_CD  = DOT.GLBL_CMPY_CD            -->
<!--			        AND AD.DS_ORD_TP_CD  = DOT.DS_ORD_TP_CD            -->
<!--			        AND DOT.EZCANCELFLAG = '0'        -->
<!--		        )    -->
<!--	    AND DOC.GLBL_CMPY_CD   = #glblCmpyCd#   -->
	    DOC.GLBL_CMPY_CD   = #glblCmpyCd#   
<!-- 2017/08/14 QC#20555 DEL END -->
	    AND DOC.EZCANCELFLAG   = '0'
<!-- 2017/08/14 QC#20555 DEL BEGIN -->
<!--	    <isNotNull property="dsOrdCatgCd">-->
<!--        AND DOC.DS_ORD_CATG_CD = #dsOrdCatgCd#-->
<!--        </isNotNull>-->
<!-- 2017/08/14 QC#20555 DEL END -->
        AND DOC.DS_ORD_CATG_DESC_TXT = #dsOrdCatgDescTxt#
    </statement>

<!-- START 2023/7/10 G.Quan [QC#61543, ADD] -->
    <statement id="countProductCode" parameterClass="Map" resultClass="Integer">
        SELECT
                 count(*)    
        FROM    
                 COA_PROD  CPR
        WHERE 
                 CPR.GLBL_CMPY_CD                         =  #glblCmpyCd#  
        AND CPR.EZCANCELFLAG                              =  '0'
        AND (
               CPR.COA_PROD_CD                            =  #coaProdCd#
               OR (
                            LENGTH(#coaProdCd#)           =  1 
                  AND COA_PROD_CD                        LIKE    REPLACE(#coaProdCd#,'*','%')
                  )
               OR (
                            LENGTH(#coaProdCd#)           =  2 
                   AND SUBSTR(#coaProdCd#,1,1)           !=  '*'
                   AND SUBSTR(#coaProdCd#,2,1)            =  '*'
                   AND COA_PROD_CD                       LIKE    REPLACE(#coaProdCd#,'*','%')
               )
        )
    </statement>
<!-- END 2023/7/10 G.Quan [QC#61543, ADD] -->
</sqlMap>
