<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NWCL0150Query">

    <statement id="findCfsLeasePkgPo" parameterClass="Map" resultClass="Map">
        SELECT
            MAIN.CFS_LEASE_PKG_PO_HDR_PK
            ,MAIN.CFS_PO_NUM
            ,MAIN.CPO_ORD_NUM
            ,MAIN.DS_ACCT_NUM
            ,MAIN.DS_ACCT_NM
            ,MAIN.CFS_PO_AMT
            ,MAIN.INV_CPLT_AMT_RATE
            ,MAIN.CR_REBIL_HLD_FLG
            ,MAIN.CFS_MAN_HLD_ACT_TP_CD
            ,MAIN.CFS_LEASE_PKG_HLD_FLG
            ,MAIN.LEASE_PKG_CRAT_FLG
            ,MAIN.PO_INFO_PROC_FLG
            ,MAIN.EZUPTIME
            ,MAIN.EZUPTIMEZONE
        FROM (
            SELECT
                CLPPH.CFS_LEASE_PKG_PO_HDR_PK
                ,CLPPH.CFS_PO_NUM
                ,CLPPH.CPO_ORD_NUM
                ,CLPPH.DS_ACCT_NUM
                ,CLPPH.DS_ACCT_NM
                ,CLPPH.CFS_PO_AMT
                ,CLPPH.INV_CPLT_AMT_RATE
                ,CLPPH.CR_REBIL_HLD_FLG
                ,CLPPH.CFS_MAN_HLD_ACT_TP_CD
                ,CLPPH.CFS_LEASE_PKG_HLD_FLG
                ,CLPPH.LEASE_PKG_CRAT_FLG
                ,CLPI.PO_INFO_PROC_FLG
                ,CLPPH.EZUPTIME
                ,CLPPH.EZUPTIMEZONE
            FROM
                CFS_LEASE_PKG_PO_HDR CLPPH
                ,CFS_LEASE_PO_INFO   CLPI
            WHERE
                1 = 1
            AND CLPPH.GLBL_CMPY_CD             = #glblCmpyCd#
            <isNotNull property="cpoOrdNum">
            AND CLPPH.CPO_ORD_NUM           LIKE #cpoOrdNum#
            </isNotNull>
            <isNotNull property="cfsLeasePkgHldFlg">
            AND CLPPH.CFS_LEASE_PKG_HLD_FLG    = #cfsLeasePkgHldFlg#
            </isNotNull>
            <isNotNull property="leasePkgCratFlg">
            AND CLPPH.LEASE_PKG_CRAT_FLG       = #leasePkgCratFlg#
            </isNotNull>
            AND EXISTS(
                SELECT
                    1
                FROM
                    CFS_LEASE_PKG_PO_DTL CLPPD
                WHERE 
                    1 = 1
                AND CLPPH.GLBL_CMPY_CD             = CLPPD.GLBL_CMPY_CD
                AND CLPPH.CFS_LEASE_PKG_PO_HDR_PK  = CLPPD.CFS_LEASE_PKG_PO_HDR_PK
                <isNotNull property="invNum">
                AND CLPPD.INV_NUM               LIKE #invNum#
                </isNotNull>
                AND CLPPD.EZCANCELFLAG             = '0'
            )
            -- EZCANCELFLAG
            AND CLPPH.EZCANCELFLAG             = '0'
            AND CLPPH.GLBL_CMPY_CD             = CLPI.GLBL_CMPY_CD(+)
            AND CLPPH.CFS_LEASE_PO_INFO_PK     = CLPI.CFS_LEASE_PO_INFO_PK(+)
            AND CLPI.EZCANCELFLAG(+)           = '0'
            ORDER BY
                CLPPH.CPO_ORD_NUM ASC
                ,CLPPH.CFS_LEASE_PKG_PO_HDR_PK ASC
            ) MAIN
        WHERE ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="findCfsLeaseAttrb" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            CLA.ATTRB_VAL_NUM
        FROM
            CFS_LEASE_ATTRB CLA
        WHERE 
            1 = 1
        AND CLA.GLBL_CMPY_CD     = #glblCmpyCd#
        AND CLA.ATTRB_KEY_NM     = #attrbKeyNm#
        AND CLA.EZCANCELFLAG     = '0'
    </statement>

</sqlMap>