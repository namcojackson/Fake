<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL0560Query">
    <typeAlias alias="NSAL0560CMsg" type="business.blap.NSAL0560.NSAL0560CMsg"/>
    <typeAlias alias="NSAL0560_ACMsg" type="business.blap.NSAL0560.NSAL0560_ACMsg"/>
    <typeAlias alias="NSAL0560_CCMsg" type="business.blap.NSAL0560.NSAL0560_CCMsg"/>

    <statement id="getContrDtl" parameterClass="Map" resultMap="result.getContrDtl">
                SELECT
                      DCH.DS_CONTR_PK                     DS_CONTR_PK
                     ,DCH.DS_CONTR_NUM                    DS_CONTR_NUM
                     ,DCH.CCY_CD
                     ,SMM.SER_NUM                         SER_NUM
                     ,MDL.T_MDL_NM                        T_MDL_NM
                     ,MDS.MDSE_DESC_SHORT_TXT             MDSE_DESC_SHORT_TXT
                     ,TRIM(BTC.FIRST_LINE_ADDR 
                         || ' ' || BTC.CTY_ADDR
                         || ' ' || BTC.ST_CD
                         || ' ' || BTC.POST_CD)        AS BILL_TO_ADDR
                     ,DCD.CONTR_EFF_FROM_DT               CONTR_EFF_FROM_DT
                     ,DCD.CONTR_EFF_THRU_DT               CONTR_EFF_THRU_DT
                     ,DCD.BASE_BLLG_LAST_BLLG_DT          BASE_BLLG_LAST_BLLG_DT
                     ,DCD.DS_CONTR_DTL_TP_CD              DS_CONTR_DTL_TP_CD
                     ,DCD.BASE_BLLG_CYCLE_CD
                     ,DCD.BASE_BLLG_TMG_CD
                     ,DCD.CONTR_CLO_DAY
                     ,DCD.EZUPTIME                        EZUPTIME
                     ,DCD.EZUPTIMEZONE                    EZUPTIMEZONE
<!-- START 2018/05/11 K.Kim [QC#25897, ADD] -->
                     ,DCH.DS_CONTR_CATG_CD                DS_CONTR_CATG_CD
<!-- END 2018/05/11 K.Kim [QC#25897, ADD] -->
                 FROM
                      DS_CONTR_DTL       DCD
                     ,DS_CONTR           DCH
                     ,SVC_MACH_MSTR      SMM
                     ,MDSE               MDS
                     ,BILL_TO_CUST       BTC
                     ,SVC_CONFIG_MSTR    SCM
                     ,MDL_NM             MDL
                 WHERE
                      DCD.GLBL_CMPY_CD           = #glblCmpyCd#
                  AND DCD.DS_CONTR_DTL_PK        = #dsContrDtlPk#
                  AND DCD.EZCANCELFLAG           = '0'
                  AND DCD.GLBL_CMPY_CD           = DCH.GLBL_CMPY_CD
                  AND DCD.DS_CONTR_PK            = DCH.DS_CONTR_PK
                  AND DCH.EZCANCELFLAG           = '0'
                  AND DCD.GLBL_CMPY_CD           = SMM.GLBL_CMPY_CD(+)
                  AND DCD.SVC_MACH_MSTR_PK       = SMM.SVC_MACH_MSTR_PK(+)
                  AND SMM.EZCANCELFLAG(+)        = '0'
                  AND DCD.GLBL_CMPY_CD           = MDS.GLBL_CMPY_CD(+)
                  AND DCD.SVC_PGM_MDSE_CD        = MDS.MDSE_CD(+)
                  AND MDS.EZCANCELFLAG(+)        = '0'
                  AND DCD.GLBL_CMPY_CD           = BTC.GLBL_CMPY_CD
                  AND DCD.BASE_BILL_TO_CUST_CD   = BTC.BILL_TO_CUST_CD
                  AND BTC.EZCANCELFLAG           = '0'
                  AND SMM.GLBL_CMPY_CD           = SCM.GLBL_CMPY_CD(+)
                  AND SMM.SVC_CONFIG_MSTR_PK     = SCM.SVC_CONFIG_MSTR_PK(+)
                  AND SCM.EZCANCELFLAG(+)        = '0'
                  AND SCM.GLBL_CMPY_CD           = MDL.T_GLBL_CMPY_CD(+)
                  AND SCM.MDL_ID                 = MDL.T_MDL_ID(+)
                  AND MDL.EZCANCELFLAG(+)        = '0'
    </statement>
    <resultMap id="result.getContrDtl" class="NSAL0560CMsg">
        <result property="dsContrNum_H1" column="DS_CONTR_NUM"  javaType="EZDCStringItem" />
        <result property="serNum_H1" column="SER_NUM"  javaType="EZDCStringItem" />
        <result property="t_MdlNm_H1" column="T_MDL_NM"  javaType="EZDCStringItem" />
        <result property="mdseDescShortTxt_H1" column="MDSE_DESC_SHORT_TXT"  javaType="EZDCStringItem" />
        <result property="ccyCd_H1" column="CCY_CD"  javaType="EZDCStringItem" />
        <result property="contrCloDay_H1" column="CONTR_CLO_DAY"  javaType="EZDCStringItem" />
        <result property="baseBllgTmgCd_H1" column="BASE_BLLG_TMG_CD"  javaType="EZDCStringItem" />
        <result property="baseBllgCycleCd_H1" column="BASE_BLLG_CYCLE_CD"  javaType="EZDCStringItem" />
        <result property="xxFirstScdCtyStAddr_H1" column="BILL_TO_ADDR"  javaType="EZDCStringItem" />
        <result property="contrEffFromDt_H1" column="CONTR_EFF_FROM_DT"  javaType="EZDCDateItem" />
        <result property="contrEffThruDt_H1" column="CONTR_EFF_THRU_DT"  javaType="EZDCDateItem" />
        <result property="baseBllgLastBllgDt_H1" column="BASE_BLLG_LAST_BLLG_DT"  javaType="EZDCDateItem" />
        <result property="dsContrDtlTpCd_A" column="DS_CONTR_DTL_TP_CD"  javaType="EZDCStringItem" />
        <result property="ezUpTime_H1" column="EZUPTIME"  javaType="EZDCStringItem" />
        <result property="ezUpTimeZone_H1" column="EZUPTIMEZONE"  javaType="EZDCStringItem" />
<!-- START 2018/05/11 K.Kim [QC#25897, ADD] -->
        <result property="dsContrCatgCd_A" column="DS_CONTR_CATG_CD"  javaType="EZDCStringItem" />
<!-- END 2018/05/11 K.Kim [QC#25897, ADD] -->
    </resultMap>

    <statement id="getContrPrcEff" parameterClass="Map" resultMap="result.getContrPrcEff">
            SELECT
                 DS_CONTR_PRC_EFF_PK
                ,DS_CONTR_PRC_EFF_SQ_NUM
                ,CONTR_PRC_EFF_FROM_DT
                ,CONTR_PRC_EFF_THRU_DT
                ,BLLG_CYCLE_CD
                ,BASE_PRC_DEAL_AMT
                ,BASE_PRC_TERM_DEAL_AMT_RATE
                ,DS_CONTR_CTRL_STS_CD
                ,DS_CONTR_CTRL_STS_NM
                ,CRAT_DT
                ,EZUPTIME
                ,DS_CONTR_PRC_EFF_STS_CD
                ,QLTY_ASRN_HLD_FLG
                ,MTR_HLD_FLG
                ,CONTR_HLD_FLG
                ,BLLG_HLD_FLG
<!-- START 2016/12/07 K.Ochiai [QC#14204, ADD] -->
                ,XX_REC_HIST_CRAT_TS
                ,XX_REC_HIST_CRAT_BY_NM
                ,XX_REC_HIST_UPD_TS
                ,XX_REC_HIST_UPD_BY_NM
                ,XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 K.Ochiai [QC#14204, ADD] -->
            FROM (
                SELECT
                      CPE.DS_CONTR_PRC_EFF_PK             DS_CONTR_PRC_EFF_PK
                     ,CPE.DS_CONTR_PRC_EFF_SQ_NUM         DS_CONTR_PRC_EFF_SQ_NUM
                     ,CPE.CONTR_PRC_EFF_FROM_DT           CONTR_PRC_EFF_FROM_DT
                     ,CPE.CONTR_PRC_EFF_THRU_DT           CONTR_PRC_EFF_THRU_DT
                     ,CPE.BLLG_CYCLE_CD                   BLLG_CYCLE_CD
                     ,CPE.BASE_PRC_DEAL_AMT               BASE_PRC_DEAL_AMT
                     ,CPE.BASE_PRC_TERM_DEAL_AMT_RATE     BASE_PRC_TERM_DEAL_AMT_RATE
                     ,PEV.DS_CONTR_CTRL_STS_CD            DS_CONTR_CTRL_STS_CD

<!-- START 2018/07/27 T.Wada [QC#26938, MOD] -->
<!--                 ,PEV.DS_CONTR_CTRL_STS_NM            DS_CONTR_CTRL_STS_NM -->
                     ,CASE
                          WHEN DCDV.DS_CONTR_CTRL_STS_CD = #entered#
                          AND (
                                SELECT
                                  COUNT(*)
                                FROM
                                  DS_CONTR_DTL DCD
                                  ,SVC_MACH_MSTR SMM
                                WHERE
                                  DCD.GLBL_CMPY_CD             = CPE.GLBL_CMPY_CD
                                AND DCD.DS_CONTR_DTL_PK        = CPE.DS_CONTR_DTL_PK
                                AND DCD.EZCANCELFLAG           = '0'
                                AND DCD.GLBL_CMPY_CD           = SMM.GLBL_CMPY_CD
                                AND DCD.SVC_MACH_MSTR_PK       = SMM.SVC_MACH_MSTR_PK
                                AND SMM.EZCANCELFLAG           = '0'
                                AND SMM.SVC_MACH_MSTR_STS_CD   = #w4i#
                              ) &gt; 0
                          THEN #pendingInstallation#
                          ELSE PEV.DS_CONTR_CTRL_STS_NM
                     END                            AS DS_CONTR_CTRL_STS_NM
<!-- END 2018/07/27 T.Wada [QC#26938, MOD] -->

                     ,SUBSTR(CPE.EZINTIME, 1, 8)          CRAT_DT
                     ,CPE.EZUPTIME                        EZUPTIME
                     ,CPE.EZUPTIMEZONE                    EZUPTIMEZONE
                     ,CPE.DS_CONTR_PRC_EFF_STS_CD         DS_CONTR_PRC_EFF_STS_CD
                     ,CPE.QLTY_ASRN_HLD_FLG               QLTY_ASRN_HLD_FLG
                     ,CPE.MTR_HLD_FLG                     MTR_HLD_FLG
                     ,CPE.CONTR_HLD_FLG                   CONTR_HLD_FLG
                     ,CPE.BLLG_HLD_FLG                    BLLG_HLD_FLG
<!-- START 2016/12/07 K.Ochiai [QC#14204, ADD] -->
                     ,CPE.EZINTIME                        XX_REC_HIST_CRAT_TS
                     ,CPE.EZINUSERID                      XX_REC_HIST_CRAT_BY_NM
                     ,CPE.EZUPTIME                        XX_REC_HIST_UPD_TS
                     ,CPE.EZUPUSERID                      XX_REC_HIST_UPD_BY_NM
                     ,CPE.EZTABLEID                       XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 K.Ochiai [QC#14204, ADD] -->
                 FROM
                      DS_CONTR_PRC_EFF          CPE
                     ,DS_CONTR_PRC_EFF_STS_V    PEV
<!-- START 2018/07/27 T.Wada [QC#26938, MOD] -->
                     ,DS_CONTR_DTL_STS_V        DCDV
<!-- END 2018/07/27 T.Wada [QC#26938, MOD] -->
                 WHERE
                      CPE.GLBL_CMPY_CD            =        #glblCmpyCd#
                  AND CPE.DS_CONTR_DTL_PK         =        #dsContrDtlPk#
                  AND CPE.BASE_CHRG_FLG           =        #baseChrgFlg#
                  AND CPE.DS_CONTR_PRC_EFF_STS_CD &lt;&gt; #cancelSts#
                  AND CPE.EZCANCELFLAG            =        '0'
                  AND CPE.GLBL_CMPY_CD            =        PEV.GLBL_CMPY_CD
                  AND CPE.DS_CONTR_PRC_EFF_PK     =        PEV.DS_CONTR_PRC_EFF_PK
                  AND PEV.EZCANCELFLAG            =        '0'
<!-- START 2018/07/27 T.Wada [QC#26938, MOD] -->
                  AND CPE.GLBL_CMPY_CD            =       DCDV.GLBL_CMPY_CD
                  AND CPE.DS_CONTR_DTL_PK         =       DCDV.DS_CONTR_DTL_PK
                  AND DCDV.EZCANCELFLAG           =       '0'
<!-- END 2018/07/27 T.Wada [QC#26938, MOD] -->
            ) WHERE
                ROWNUM        &lt;= #rowNum#
            ORDER BY DS_CONTR_PRC_EFF_SQ_NUM ASC
    </statement>
    <resultMap id="result.getContrPrcEff" class="NSAL0560_ACMsg">
        <result property="dsContrPrcEffPk_A1" column="DS_CONTR_PRC_EFF_PK"  javaType="EZDCBigDecimalItem" />
        <result property="dsContrPrcEffSqNum_A1" column="DS_CONTR_PRC_EFF_SQ_NUM"  javaType="EZDCBigDecimalItem" />
        <result property="contrPrcEffFromDt_A1" column="CONTR_PRC_EFF_FROM_DT"  javaType="EZDCDateItem" />
        <result property="contrPrcEffThruDt_A1" column="CONTR_PRC_EFF_THRU_DT"  javaType="EZDCDateItem" />
        <result property="bllgCycleCd_A3" column="BLLG_CYCLE_CD"  javaType="EZDCStringItem" />
        <result property="basePrcDealAmt_A1" column="BASE_PRC_DEAL_AMT"  javaType="EZDCBigDecimalItem" />
        <result property="basePrcTermDealAmtRate_A1" column="BASE_PRC_TERM_DEAL_AMT_RATE"  javaType="EZDCBigDecimalItem" />
        <result property="dsContrDtlStsCd_A1" column="DS_CONTR_CTRL_STS_CD"  javaType="EZDCStringItem" />
        <result property="dsContrDtlStsNm_A1" column="DS_CONTR_CTRL_STS_NM"  javaType="EZDCStringItem" />
        <result property="cratDt_A1" column="CRAT_DT"  javaType="EZDCDateItem" />
        <result property="ezUpTime_A1" column="EZUPTIME"  javaType="EZDCStringItem" />
        <result property="ezUpTimeZone_A1" column="EZUPTIMEZONE"  javaType="EZDCStringItem" />
        <result property="dsContrPrcEffStsCd_A2" column="DS_CONTR_PRC_EFF_STS_CD"  javaType="EZDCStringItem" />
        <result property="qltyAsrnHldFlg_A2" column="QLTY_ASRN_HLD_FLG"  javaType="EZDCStringItem" />
        <result property="mtrHldFlg_A2" column="MTR_HLD_FLG"  javaType="EZDCStringItem" />
        <result property="contrHldFlg_A2" column="CONTR_HLD_FLG"  javaType="EZDCStringItem" />
        <result property="bllgHldFlg_A2" column="BLLG_HLD_FLG"  javaType="EZDCStringItem" />
<!-- START 2016/12/07 K.Ochiai [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_A1"    column="XX_REC_HIST_CRAT_TS"      javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_A1"  column="XX_REC_HIST_CRAT_BY_NM"   javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_A1"     column="XX_REC_HIST_UPD_TS"       javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_A1"   column="XX_REC_HIST_UPD_BY_NM"    javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_A1"     column="XX_REC_HIST_TBL_NM"       javaType="EZDSStringItem"/>
<!-- END 2016/12/07 K.Ochiai [QC#14204, ADD] -->
    </resultMap>

    <statement id="cntDsContrBllgSchd" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)
        FROM
            DS_CONTR_BLLG_SCHD DCBS
        WHERE
            DCBS.GLBL_CMPY_CD        = #glblCmpyCd#
        AND DCBS.EZCANCELFLAG        = '0'
        AND DCBS.DS_CONTR_PRC_EFF_PK = #dsContrPrcEffPk#
        AND DCBS.INV_FLG             = #invFlg#
    </statement>
    <statement id="cntDsContrDtlAggMach" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)
        FROM
            DS_CONTR_DTL DCD
        WHERE
            DCD.GLBL_CMPY_CD       = #glblCmpyCd#
        AND DCD.EZCANCELFLAG       = '0'
        AND DCD.DS_CONTR_DTL_PK    = #dsContrDtlPk#
        AND DCD.DS_CONTR_DTL_PK    = DCD.PRNT_DS_CONTR_DTL_PK
        AND DCD.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd#
    </statement>
    <statement id="cntDsContrDtlAggLine" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)
        FROM
            DS_CONTR_DTL DCD
        WHERE
            DCD.GLBL_CMPY_CD       = #glblCmpyCd#
        AND DCD.EZCANCELFLAG       = '0'
        AND DCD.DS_CONTR_DTL_PK    = #dsContrDtlPk#
        AND DCD.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd#
    </statement>
    <statement id="getMinBllgSchdFromDt" parameterClass="Map" resultClass="String">
        SELECT
            MIN(DCBS.BLLG_SCHD_FROM_DT) AS BLLG_SCHD_FROM_DT
        FROM
            DS_CONTR_BLLG_SCHD DCBS
        WHERE
            DCBS.GLBL_CMPY_CD        = #glblCmpyCd#
        AND DCBS.EZCANCELFLAG        = '0'
        AND DCBS.DS_CONTR_PRC_EFF_PK = #dsContrPrcEffPk#
        AND DCBS.BASE_CHRG_FLG       = #baseChrgFlg#
        AND DCBS.INV_FLG             = #invFlg#
        AND DCBS.INV_TP_CD           = #invTpCd#
    </statement>
    <statement id="getDsContrCtrlSts" parameterClass="Map" resultClass="Map">
        SELECT
             V.DS_CONTR_CTRL_STS_CD
            ,V.DS_CONTR_CTRL_STS_NM
            ,D.DS_CONTR_DTL_STS_CD
            ,D.QLTY_ASRN_HLD_FLG
            ,D.MTR_HLD_FLG
            ,D.CONTR_HLD_FLG
            ,D.BLLG_HLD_FLG
        FROM
            DS_CONTR_DTL_STS_V V
            ,DS_CONTR_DTL D
        WHERE
            D.GLBL_CMPY_CD    = #glblCmpyCd#
        AND D.EZCANCELFLAG    = '0'
        AND D.DS_CONTR_DTL_PK = #dsContrDtlPk#
        AND D.GLBL_CMPY_CD    = V.GLBL_CMPY_CD
        AND D.EZCANCELFLAG    = '0'
        AND D.DS_CONTR_DTL_PK = V.DS_CONTR_DTL_PK
    </statement>
    <statement id="getMaxBllgSchdThruDt" parameterClass="Map" resultClass="String">
        SELECT
            MAX(DCBS.BLLG_SCHD_THRU_DT) AS BLLG_SCHD_THRU_DT
        FROM
            DS_CONTR_BLLG_SCHD DCBS
        WHERE
            DCBS.GLBL_CMPY_CD        = #glblCmpyCd#
        AND DCBS.EZCANCELFLAG        = '0'
        AND DCBS.DS_CONTR_PRC_EFF_PK = #dsContrPrcEffPk#
        AND DCBS.BASE_CHRG_FLG       = #baseChrgFlg#
        AND DCBS.INV_FLG             = #invFlg#
        AND DCBS.INV_TP_CD           = #invTpCd#
    </statement>
    <statement id="getDsContrPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            DCD.DS_CONTR_PK
        FROM
            DS_CONTR_DTL DCD
        WHERE
            DCD.GLBL_CMPY_CD    = #glblCmpyCd#
        AND DCD.EZCANCELFLAG    = '0'
        AND DCD.DS_CONTR_DTL_PK = #dsContrDtlPk#
        AND ROWNUM              = #rowNum#
    </statement>

    <statement id="getMachDsContrPrcEff" parameterClass="Map" resultMap="result.getMachDsContrPrcEff">
            SELECT
                  CPE.DS_CONTR_PRC_EFF_PK             DS_CONTR_PRC_EFF_PK
                 ,DCD.DS_CONTR_DTL_PK                 DS_CONTR_DTL_PK
                 ,DCD.SVC_MACH_MSTR_PK                SVC_MACH_MSTR_PK
                 ,DCD.CONTR_CLO_DAY                   CONTR_CLO_DAY
                 ,DCD.BASE_BLLG_TMG_CD                BASE_BLLG_TMG_CD
                 ,DCD.CONTR_BLLG_DAY                  CONTR_BLLG_DAY
                 ,DCD.CONTR_EFF_FROM_DT               CONTR_EFF_FROM_DT
                 ,DCD.CONTR_EFF_THRU_DT               CONTR_EFF_THRU_DT
                 ,CPE.DS_CONTR_PRC_EFF_SQ_NUM         DS_CONTR_PRC_EFF_SQ_NUM
                 ,CPE.CONTR_PRC_EFF_FROM_DT           CONTR_PRC_EFF_FROM_DT
                 ,CPE.CONTR_PRC_EFF_THRU_DT           CONTR_PRC_EFF_THRU_DT
                 ,CPE.BLLG_CYCLE_CD                   BLLG_CYCLE_CD
                 ,CPE.BASE_PRC_DEAL_AMT               BASE_PRC_DEAL_AMT
                 ,CPE.DS_CONTR_PRC_EFF_STS_CD         DS_CONTR_PRC_EFF_STS_CD
                 ,CPE.QLTY_ASRN_HLD_FLG               QLTY_ASRN_HLD_FLG
                 ,CPE.MTR_HLD_FLG                     MTR_HLD_FLG
                 ,CPE.CONTR_HLD_FLG                   CONTR_HLD_FLG
                 ,CPE.BLLG_HLD_FLG                    BLLG_HLD_FLG
             FROM
                  DS_CONTR_DTL              DCD
                 ,DS_CONTR_PRC_EFF          CPE
             WHERE
                  DCD.GLBL_CMPY_CD               =  #glblCmpyCd#
              AND DCD.PRNT_DS_CONTR_DTL_PK       =  #prntDsContrDtlPk#
              AND DCD.EZCANCELFLAG               =  '0'
              AND DCD.GLBL_CMPY_CD               =  CPE.GLBL_CMPY_CD
              AND DCD.DS_CONTR_DTL_PK            =  CPE.DS_CONTR_DTL_PK
              AND CPE.BASE_CHRG_FLG              =  #baseChrgFlg#
              AND CPE.CONTR_PRC_EFF_FROM_DT  &lt;=  #fromDt#
              AND CPE.CONTR_PRC_EFF_THRU_DT  &gt;=  #thruDt#
              AND DCD.EZCANCELFLAG               =  '0'
             ORDER BY
                  DCD.DS_CONTR_DTL_PK
                 ,CPE.DS_CONTR_PRC_EFF_SQ_NUM
              
    </statement>
    <resultMap id="result.getMachDsContrPrcEff" class="NSAL0560_CCMsg">
        <result property="dsContrPrcEffPk_C" column="DS_CONTR_PRC_EFF_PK"  javaType="EZDCBigDecimalItem" />
        <result property="dsContrDtlPk_C" column="DS_CONTR_DTL_PK"  javaType="EZDCBigDecimalItem" />
        <result property="svcMachMstrPk_C" column="SVC_MACH_MSTR_PK"  javaType="EZDCBigDecimalItem" />
        <result property="contrCloDay_C" column="CONTR_CLO_DAY"  javaType="EZDCStringItem" />
        <result property="baseBllgTmgCd_C" column="BASE_BLLG_TMG_CD"  javaType="EZDCStringItem" />
        <result property="contrBllgDay_C" column="CONTR_BLLG_DAY"  javaType="EZDCStringItem" />
        <result property="contrEffFromDt_C" column="CONTR_EFF_FROM_DT"  javaType="EZDCDateItem" />
        <result property="contrEffThruDt_C" column="CONTR_EFF_THRU_DT"  javaType="EZDCDateItem" />
        <result property="dsContrPrcEffSqNum_C" column="DS_CONTR_PRC_EFF_SQ_NUM"  javaType="EZDCBigDecimalItem" />
        <result property="contrPrcEffFromDt_C" column="CONTR_PRC_EFF_FROM_DT"  javaType="EZDCDateItem" />
        <result property="contrPrcEffThruDt_C" column="CONTR_PRC_EFF_THRU_DT"  javaType="EZDCDateItem" />
        <result property="bllgCycleCd_C" column="BLLG_CYCLE_CD"  javaType="EZDCStringItem" />
        <result property="basePrcDealAmt_C" column="BASE_PRC_DEAL_AMT"  javaType="EZDCBigDecimalItem" />
        <result property="dsContrPrcEffStsCd_C" column="DS_CONTR_PRC_EFF_STS_CD"  javaType="EZDCStringItem" />
        <result property="qltyAsrnHldFlg_C" column="QLTY_ASRN_HLD_FLG"  javaType="EZDCStringItem" />
        <result property="mtrHldFlg_C" column="MTR_HLD_FLG"  javaType="EZDCStringItem" />
        <result property="contrHldFlg_C" column="CONTR_HLD_FLG"  javaType="EZDCStringItem" />
        <result property="bllgHldFlg_C" column="BLLG_HLD_FLG"  javaType="EZDCStringItem" />
    </resultMap>

    <statement id="getContrEffThruDt" parameterClass="Map" resultMap="String">
        SELECT
            CASE
                WHEN Z.CONTR_CLO_DT IS NULL            THEN Z.CONTR_EFF_THRU_DT
                WHEN Z.INV_THRU_DT  IS NULL            THEN Z.CONTR_CLO_DT
                WHEN Z.CONTR_CLO_DT &lt; Z.INV_THRU_DT THEN Z.INV_THRU_DT
                ELSE Z.CONTR_CLO_DT
            END AS CONTR_EFF_THRU_DT
        FROM
            (
            SELECT
                 A.DS_CONTR_DTL_PK      AS DS_CONTR_DTL_PK
                ,A.CONTR_EFF_THRU_DT    AS CONTR_EFF_THRU_DT
                ,A.CONTR_CLO_DT         AS CONTR_CLO_DT
                ,MAX(BLLG_SCHD_THRU_DT) AS INV_THRU_DT
            FROM
                 DS_CONTR_DTL       A
                ,DS_CONTR_BLLG_SCHD B
            WHERE
                A.GLBL_CMPY_CD            =  #glblCmpyCd#
            AND A.EZCANCELFLAG            =  '0'
            AND A.DS_CONTR_DTL_PK         =  #dsContrDtlPk#
            AND A.GLBL_CMPY_CD            =  B.GLBL_CMPY_CD      (+)
            AND A.DS_CONTR_DTL_PK         =  B.DS_CONTR_DTL_PK   (+)
            AND B.EZCANCELFLAG        (+) =  '0'
            AND B.DS_CONTR_PRC_EFF_PK (+) IS NOT NULL
            AND B.INV_DT              (+) IS NOT NULL
            AND B.BASE_CHRG_FLG       (+) =  'Y'
            GROUP BY
                 A.DS_CONTR_DTL_PK
                ,A.CONTR_EFF_THRU_DT
                ,A.CONTR_CLO_DT
            ) Z
    </statement>
<!-- START 2018/05/11 K.Kim [QC#25897, ADD] -->
    <statement id="getAggLinePk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.DS_CONTR_DTL_PK
        FROM
             DS_CONTR_DTL A
        WHERE
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        AND A.EZCANCELFLAG          = '0'
        AND A.DS_CONTR_PK           = #dsContrPk#
        AND A.DS_CONTR_DTL_TP_CD    = #aggregate#
     </statement>
<!-- END 2018/05/11 K.Kim [QC#25897, ADD] -->
<!-- START 2019/11/25 K.Kitachi [QC#54703, ADD] -->
    <statement id="countUnbilledRebill" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            DS_CONTR_BLLG_SCHD A
        WHERE
                A.GLBL_CMPY_CD       = #glblCmpyCd#
            AND A.DS_CONTR_DTL_PK    = #dsContrDtlPk#
            AND A.BASE_CHRG_FLG      = 'Y'
            AND A.DS_BLLG_SCHD_TP_CD = #dsBllgSchdTpCd#
            AND A.INV_FLG            = 'N'
            AND A.EZCANCELFLAG       = '0'
    </statement>
<!-- END 2019/11/25 K.Kitachi [QC#54703, ADD] -->
</sqlMap>
