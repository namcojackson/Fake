<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSBL0240Query">

    <statement id="searchData" parameterClass="Map" resultClass="Map">
    SELECT
             T.MDL_GRP_NM
            ,T.MDL_GRP_DESC_TXT
            ,T.SVC_LINE_BIZ_CD
            ,T.LINE_BIZ_TP_DESC_TXT
            ,T.INTG_MDSE_CD
            ,T.MDSE_DESC_SHORT_TXT
            ,T.SVC_TRVL_UNIT_AMT
            ,T.SVC_TRVL_CHRG_TP_CD
            ,T.SVC_TRVL_CHRG_PK
            ,T.MDL_GRP_ID
            ,T.SVC_ZN_CD
            ,T.EZUPTIME
            ,T.EZUPTIMEZONE
<!-- START 2016/12/02 N.Arai [QC#14204, ADD] -->
            ,T.XX_REC_HIST_CRAT_TS
            ,T.XX_REC_HIST_CRAT_BY_NM
            ,T.XX_REC_HIST_UPD_TS
            ,T.XX_REC_HIST_UPD_BY_NM
            ,T.XX_REC_HIST_TBL_NM
<!-- END 2016/12/02 N.Arai [QC#14204, ADD] -->
        FROM
        (SELECT
             MGRP.MDL_GRP_NM
            ,MGRP.MDL_GRP_DESC_TXT
            ,TRVL.SVC_LINE_BIZ_CD
            ,LBIZ.LINE_BIZ_TP_DESC_TXT
            ,TRVL.INTG_MDSE_CD
            ,MDSE.MDSE_DESC_SHORT_TXT
            ,TRVL.SVC_TRVL_UNIT_AMT
            ,TRVL.SVC_TRVL_CHRG_TP_CD
            ,TRVL.SVC_TRVL_CHRG_PK
            ,TRVL.MDL_GRP_ID
            ,TRVL.SVC_ZN_CD
            ,TRVL.EZUPTIME
            ,TRVL.EZUPTIMEZONE
<!-- START 2016/12/02 N.Arai [QC#14204, ADD] -->
            ,TRVL.EZINTIME         AS XX_REC_HIST_CRAT_TS
            ,TRVL.EZINUSERID       AS XX_REC_HIST_CRAT_BY_NM
            ,TRVL.EZUPTIME         AS XX_REC_HIST_UPD_TS
            ,TRVL.EZUPUSERID       AS XX_REC_HIST_UPD_BY_NM
            ,TRVL.EZTABLEID        AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/02 N.Arai [QC#14204, ADD] -->
            FROM
                 SVC_TRVL_CHRG  TRVL
                ,DS_MDL_GRP     MGRP
                ,LINE_BIZ_TP    LBIZ
                ,AVAL_LINE_BIZ_TP_SRC ALB
                ,MDSE           MDSE
            WHERE
                TRVL.GLBL_CMPY_CD       = #glblCmpyCd#
            <isNotNull property="svcLineBizCd">
            AND TRVL.SVC_LINE_BIZ_CD    = #svcLineBizCd#
            </isNotNull>
            <isNotNull property="mdlGrpNm">
            AND MGRP.MDL_GRP_NM         = #mdlGrpNm#
            </isNotNull>
            AND TRVL.GLBL_CMPY_CD       = MGRP.GLBL_CMPY_CD(+)
            AND TRVL.MDL_GRP_ID         = MGRP.MDL_GRP_ID(+)
            AND TRVL.GLBL_CMPY_CD       = LBIZ.GLBL_CMPY_CD(+)
            AND TRVL.SVC_LINE_BIZ_CD    = LBIZ.LINE_BIZ_TP_CD(+)
            AND LBIZ.GLBL_CMPY_CD       = ALB.GLBL_CMPY_CD(+)
            AND LBIZ.LINE_BIZ_TP_CD     = ALB.LINE_BIZ_TP_CD(+)
            AND ALB.SYS_SRC_CD(+)       = #sysSrcCd#
            AND TRVL.GLBL_CMPY_CD       = MDSE.GLBL_CMPY_CD(+)
            AND TRVL.INTG_MDSE_CD       = MDSE.MDSE_CD(+)
            AND TRVL.EZCANCELFLAG       = '0'
            AND MGRP.EZCANCELFLAG(+)    = '0'
            AND LBIZ.EZCANCELFLAG(+)    = '0'
            AND ALB.EZCANCELFLAG(+)     = '0'
            AND MDSE.EZCANCELFLAG(+)    = '0'
            AND EXISTS (
                SELECT 1 
                    FROM SVC_MBL_INTFC_XREF XREF 
                    WHERE
                        XREF.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND XREF.SVC_MBL_INTFC_KEY_TXT = #svcMblIntfcKeyTxt#
                    AND XREF.SVC_MBL_S21_VAL_TXT   = TRVL.SVC_ZN_CD
                    AND XREF.EZCANCELFLAG = '0')
            ORDER BY
                 MGRP.MDL_GRP_NM ASC
                ,TRVL.SVC_LINE_BIZ_CD ASC
                ,TRVL.MDL_GRP_ID ASC
                ,SVC_ZN_CD ASC
            ) T
            WHERE
                ROWNUM &lt;= #limitNum#
    </statement>

    <statement id="getSvcLineBizList" parameterClass="Map" resultClass="Map">
        SELECT
             A.LINE_BIZ_TP_CD       LINE_BIZ_TP_CD
            ,A.LINE_BIZ_TP_DESC_TXT LINE_BIZ_TP_DESC_TXT
        FROM
             LINE_BIZ_TP          A
            ,AVAL_LINE_BIZ_TP_SRC B
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.LINE_BIZ_TP_CD    = B.LINE_BIZ_TP_CD
            AND B.SYS_SRC_CD        = #sysSrcCd#
            AND B.EZCANCELFLAG      = '0'
        ORDER BY
            A.LINE_BIZ_TP_SORT_NUM
    </statement>
</sqlMap>
