<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NLBL0090Query">
    <typeAlias alias="NLBL0090CMsg"     type="business.blap.NLBL0090.NLBL0090CMsg"/>
    <typeAlias alias="NLBL0090SMsg"     type="business.blap.NLBL0090.NLBL0090SMsg"/>
    <typeAlias alias="NLBL0090_ASMsg"   type="business.blap.NLBL0090.NLBL0090_ASMsg"/>
    <typeAlias alias="NLBL0090_BSMsg"   type="business.blap.NLBL0090.NLBL0090_BSMsg"/>
    <typeAlias alias="NLBL0090_FMsg"    type="business.file.NLBL0090F00FMsg"/>

    <statement id="getWH" parameterClass="Map" resultClass="Map">
        SELECT
            RW.RTL_WH_CD
        FROM
            RTL_WH RW
        WHERE
                RW.GLBL_CMPY_CD  = #glblCmpyCd#
            AND RW.RTL_WH_CD     = #rtlWhCd#
            AND RW.EZCANCELFLAG  = '0'                                                                                                                                                                                                                                                                                                        
    </statement>

    <statement id="getPODStatusTypePullDownList" parameterClass="NLBL0090CMsg" resultClass="Map">
        SELECT
            POD_STS_TP_FOR_SCR_CD
            , POD_STS_TP_FOR_SCR_NM
        FROM
            POD_STS_TP_FOR_SCR
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd_Z1#
            AND EZCANCELFLAG = '0'
        ORDER BY
            POD_STS_TP_FOR_SCR_SORT_NUM
    </statement>

    <statement id="getPODStatusPullDownList" parameterClass="NLBL0090CMsg" resultClass="Map">
        SELECT
            POD_STS_CD
            , POD_STS_NM
            , POD_STS_TP_FOR_SCR_CD
        FROM
            POD_STS
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd_Z1#
            AND EZCANCELFLAG = '0'
        ORDER BY
            POD_STS_SORT_NUM
    </statement>

    <statement id="getPODStatusListByPODStatusTypeCd" parameterClass="Map" resultClass="Map">
        SELECT
            POD_STS_CD
            , POD_STS_NM
            , POD_STS_TP_FOR_SCR_CD
        FROM
            POD_STS
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            <isNotNull property="podStsTpForScrCd">
                AND POD_STS_TP_FOR_SCR_CD = #podStsTpForScrCd#
            </isNotNull>
            AND EZCANCELFLAG = '0'
        ORDER BY
            POD_STS_SORT_NUM
    </statement>

    <statement id="getCarrierName" parameterClass="Map" resultMap="result.NLBL0090CMsg">
        SELECT
            V.LOC_NM AS CARRIER_NAME
        FROM
            VND V, VND_TP_RELN VTR
        WHERE
            V.GLBL_CMPY_CD      = #cMsg.glblCmpyCd_Z1#
        AND V.VND_CD            = #cMsg.carrCd_H2#
        AND VTR.VND_TP_CD       = #OUTBOUND_CARRIER#
        AND V.GLBL_CMPY_CD      = VTR.GLBL_CMPY_CD
        AND V.VND_CD            = VTR.VND_CD
        AND V.EZCANCELFLAG      = '0'
        AND VTR.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getSellToName" parameterClass="Map" resultMap="result.NLBL0090CMsg">
        SELECT
            DS_ACCT_NM AS SELL_TO_NAME
        FROM
            SELL_TO_CUST
        WHERE
                GLBL_CMPY_CD    = #cMsg.glblCmpyCd_Z1#
            AND SELL_TO_CUST_CD = #cMsg.sellToCustCd_H2#
            AND EZCANCELFLAG    = '0'
    </statement>

    <statement id="getShipToName" parameterClass="Map" resultMap="result.NLBL0090CMsg">
        SELECT
            DAC.DS_ACCT_NM AS SHIP_TO_NAME
        FROM
            SHIP_TO_CUST   STC
            ,SELL_TO_CUST  DAC
        WHERE
                STC.GLBL_CMPY_CD    = #cMsg.glblCmpyCd_Z1#
            AND STC.SHIP_TO_CUST_CD = #cMsg.shipToCustCd_H2#
            AND STC.RGTN_STS_CD     = #rgtnStsCd#
            AND STC.GLBL_CMPY_CD    = DAC.GLBL_CMPY_CD
            AND STC.SELL_TO_CUST_CD = DAC.SELL_TO_CUST_CD
            AND STC.EZCANCELFLAG    = '0'
            AND DAC.EZCANCELFLAG    = '0'
    </statement>

    <resultMap id="result.NLBL0090CMsg" class="NLBL0090CMsg">
        <result property="dsAcctNm_H2"             column="SELL_TO_NAME"        javaType="EZDCStringItem"/>
        <result property="dsAcctNm_H3"             column="SHIP_TO_NAME"        javaType="EZDCStringItem"/>
        <result property="carrNm_H1"               column="CARRIER_NAME"        javaType="EZDCStringItem"/>
    </resultMap>











    <statement id="countBOLTrackingList" parameterClass="Map" resultClass="Integer">

        SELECT
            COUNT(*)
        FROM
            BOL_RELN                BLR
            , SHPG_ORD_CONF_DTL     SOCD
            , SHPG_ORD_CONF         SOC
            , SHPG_ORD              SO
            , SHPG_ORD_DTL          SOD
            , VND                   V
            , CARR_URL              CRU
            , POD_STS               PODS
            , POD_STS_RSN           PODSR
            , ( SELECT
                    GLBL_CMPY_CD
                    ,POD_STS_DT
                    ,POD_STS_CD
                    ,POD_STS_RSN_CD
                    ,POD_LTST_REC_FLG
                    ,CARR_CD
                    ,PRO_NUM
                    ,EZCANCELFLAG
                FROM
                    POD
                WHERE
                    POD.POD_LTST_REC_FLG        =        'Y'
                    AND POD.EZCANCELFLAG          =        '0'
                    <isEqual property="POD_STS_DATE_FLG" compareValue="Y">
                        <isNotNull property="sMsg.podStsDt_H1">
                            AND POD.POD_STS_DT            &gt;=    #sMsg.podStsDt_H1#
                        </isNotNull>
                        <isNotNull property="sMsg.podStsDt_H2">
                            AND POD.POD_STS_DT            &lt;=    #sMsg.podStsDt_H2#
                        </isNotNull>
                    </isEqual>
                    <iterate property="POD_STS_CD_LIST" var="elem[]" open="AND (" close=")" conjunction="OR">
                            POD.POD_STS_CD            = #elem[]#
                    </iterate>
                ) POD

        WHERE
            BLR.GLBL_CMPY_CD            =        #sMsg.glblCmpyCd_Z1#
            
            <isNotNull property="sMsg.bolNum_H1">
                AND BLR.BOL_NUM            LIKE    #sMsg.bolNum_H1#
            </isNotNull>
            
            <isNotNull property="sMsg.proNum_H1">
                AND BLR.PRO_NUM            LIKE    #sMsg.proNum_H1#
            </isNotNull>
            
            <isNotNull property="sMsg.carrCd_H2">
                AND BLR.CARR_CD            =        #sMsg.carrCd_H2#
            </isNotNull>
            
            AND BLR.WH_CD = #sMsg.whCd_H1#
            AND BLR.EZCANCELFLAG        =        '0'
            AND BLR.GLBL_CMPY_CD        =        SOCD.GLBL_CMPY_CD
            AND BLR.BOL_NUM             =        SOCD.BOL_NUM
            AND NVL(BLR.CARR_CD,'*')    =        SOCD.VND_CD
            AND NVL(BLR.PRO_NUM,'*')    =        SOCD.PRO_NUM
            AND SOCD.GLBL_CMPY_CD       =        SOC.GLBL_CMPY_CD
            AND SOCD.SO_NUM             =        SOC.SO_NUM
            AND SOCD.GLBL_CMPY_CD       =        SO.GLBL_CMPY_CD
            AND SOCD.SO_NUM             =        SO.SO_NUM
            AND BLR.WH_CD               =        SO.WH_CD
            AND SOCD.GLBL_CMPY_CD       =        SOD.GLBL_CMPY_CD
            AND SOCD.SO_NUM             =        SOD.SO_NUM
            AND SOCD.SO_SLP_NUM         =        SOD.SO_SLP_NUM
            AND SOCD.EZCANCELFLAG       =        '0'
            AND SOC.EZCANCELFLAG        =        '0'
            AND SO.EZCANCELFLAG         =        '0'
            AND SOD.EZCANCELFLAG        =        '0'

            <isNotEqual property="POD_INNER_JOIN" compareValue="Y">
                AND BLR.GLBL_CMPY_CD           =        POD.GLBL_CMPY_CD(+)
                AND BLR.CARR_CD                =        POD.CARR_CD(+)
                AND BLR.PRO_NUM                =        POD.PRO_NUM(+)
            </isNotEqual>
            <isEqual property="POD_INNER_JOIN" compareValue="Y">
                AND BLR.GLBL_CMPY_CD           =        POD.GLBL_CMPY_CD
                AND BLR.CARR_CD                =        POD.CARR_CD
                AND BLR.PRO_NUM                =        POD.PRO_NUM
            </isEqual>

            AND POD.GLBL_CMPY_CD          =        PODS.GLBL_CMPY_CD(+)
            AND POD.POD_STS_CD            =        PODS.POD_STS_CD(+)

            AND POD.GLBL_CMPY_CD          =        PODSR.GLBL_CMPY_CD (+)
            AND POD.POD_STS_RSN_CD        =        PODSR.POD_STS_RSN_CD(+)

            AND PODS.EZCANCELFLAG (+)    =        '0'
            AND PODSR.EZCANCELFLAG(+)    =        '0'

            AND BLR.GLBL_CMPY_CD           =        V.GLBL_CMPY_CD(+)
            AND BLR.CARR_CD                =        V.VND_CD(+)
            AND V.EZCANCELFLAG     (+)     =        '0'

            AND BLR.GLBL_CMPY_CD           =        CRU.GLBL_CMPY_CD(+)
            AND BLR.CARR_CD                =        CRU.VND_CD(+)
            AND CRU.EZCANCELFLAG (+)       =        '0'
            
            <isNotNull property="sMsg.sellToCustCd_H2">
                AND SO.SELL_TO_CUST_CD    =        #sMsg.sellToCustCd_H2#
            </isNotNull>
            
            <isNotNull property="sMsg.shipToCustCd_H2">
                AND SO.SHIP_TO_CUST_CD    =        #sMsg.shipToCustCd_H2#
            </isNotNull>
            
            <isNotNull property="sMsg.soNum_H1">
                AND SO.SO_NUM            LIKE    #sMsg.soNum_H1#
            </isNotNull>
            
            <isNotNull property="sMsg.trxHdrNum_H1">
                AND SOD.TRX_HDR_NUM        LIKE    #sMsg.trxHdrNum_H1#
            </isNotNull>
            
            <isEqual property="SHIPPED_DATE_FLG" compareValue="Y">
                <isNotNull property="sMsg.podStsDt_H1">
                    AND SOC.SHIP_DT_TM_TS        &gt;=    #sMsg.podStsDt_H1# || #hhmmssMin# 
                </isNotNull>
                <isNotNull property="sMsg.podStsDt_H2">
                    AND SOC.SHIP_DT_TM_TS        &lt;=    #sMsg.podStsDt_H2# || #hhmmssMax#
                </isNotNull>            
            </isEqual>

    </statement>

    <statement id="getBOLTrackingList" parameterClass="Map" resultMap="result.NLBL0090_ASMsg">
        SELECT
              WH_CD
            , BOL_NUM
            , CARR_CD
            , LOC_NM
            , CARR_TRK_URL
            , PRO_NUM
            , SELL_TO_CUST_CD
            , SHIP_TO_CUST_CD
            , TRX_HDR_NUM
            , SO_NUM
            , POD_STS_DT
            , POD_STS_CD
            , POD_STS_RSN_CD
            , POD_STS_NM
            , POD_STS_TP_FOR_SCR_CD
            , POD_STS_RSN_NM
        FROM(
          SELECT DISTINCT
              BLR.WH_CD                     AS WH_CD
            , BLR.BOL_NUM                   AS BOL_NUM
            , BLR.CARR_CD                   AS CARR_CD
            , VND.LOC_NM                    AS LOC_NM
            , CRU.CARR_TRK_URL              AS CARR_TRK_URL
            , BLR.PRO_NUM                   AS PRO_NUM
            , SO.SELL_TO_CUST_CD            AS SELL_TO_CUST_CD
            , SO.SHIP_TO_CUST_CD            AS SHIP_TO_CUST_CD
            , SOD.TRX_HDR_NUM               AS TRX_HDR_NUM
            , SO.SO_NUM                     AS SO_NUM
            , POD.POD_STS_DT                AS POD_STS_DT
            , POD.POD_STS_CD                AS POD_STS_CD
            , POD.POD_STS_RSN_CD            AS POD_STS_RSN_CD
            , PODS.POD_STS_NM               AS POD_STS_NM
            , PODS.POD_STS_TP_FOR_SCR_CD    AS POD_STS_TP_FOR_SCR_CD
            , PODSR.POD_STS_RSN_NM          AS POD_STS_RSN_NM
          FROM
              BOL_RELN              BLR
            , SHPG_ORD_CONF_DTL     SOCD
            , SHPG_ORD_CONF         SOC
            , SHPG_ORD              SO
            , SHPG_ORD_DTL          SOD
            , VND                   VND
            , CARR_URL              CRU
            , POD_STS               PODS
            , POD_STS_RSN           PODSR
            , POD                   POD
          WHERE
              BLR.GLBL_CMPY_CD            =        #sMsg.glblCmpyCd_Z1#
          <isNotNull property="sMsg.bolNum_H1">
                AND BLR.BOL_NUM            LIKE    #sMsg.bolNum_H1#
            </isNotNull>
            
            <isNotNull property="sMsg.proNum_H1">
                AND BLR.PRO_NUM            LIKE    #sMsg.proNum_H1#
            </isNotNull>
            
            <isNotNull property="sMsg.carrCd_H2">
                AND BLR.CARR_CD            =        #sMsg.carrCd_H2#
            </isNotNull>
            
            AND BLR.WH_CD               =        #sMsg.whCd_H1#
            AND BLR.EZCANCELFLAG        =        '0'
            AND BLR.GLBL_CMPY_CD        =        SOCD.GLBL_CMPY_CD
            AND BLR.BOL_NUM             =        SOCD.BOL_NUM
            AND NVL(BLR.CARR_CD,'*')    =        SOCD.VND_CD
            AND NVL(BLR.PRO_NUM,'*')    =        SOCD.PRO_NUM
            AND SOCD.GLBL_CMPY_CD       =        SOC.GLBL_CMPY_CD
            AND SOCD.SO_NUM             =        SOC.SO_NUM
            AND SOCD.GLBL_CMPY_CD       =        SO.GLBL_CMPY_CD
            AND SOCD.SO_NUM             =        SO.SO_NUM
            AND BLR.WH_CD               =        SO.WH_CD
            AND SOCD.GLBL_CMPY_CD       =        SOD.GLBL_CMPY_CD
            AND SOCD.SO_NUM             =        SOD.SO_NUM
            AND SOCD.SO_SLP_NUM         =        SOD.SO_SLP_NUM
            AND SOCD.EZCANCELFLAG       =        '0'
            AND SOC.EZCANCELFLAG        =        '0'
            AND SO.EZCANCELFLAG         =        '0'
            AND SOD.EZCANCELFLAG        =        '0'



            AND POD.GLBL_CMPY_CD        =        PODS.GLBL_CMPY_CD(+)
            AND POD.POD_STS_CD          =        PODS.POD_STS_CD(+)
            AND POD.GLBL_CMPY_CD        =        PODSR.GLBL_CMPY_CD (+)
            AND POD.POD_STS_RSN_CD      =        PODSR.POD_STS_RSN_CD(+)
            AND PODS.EZCANCELFLAG (+)   =        '0'
            AND PODSR.EZCANCELFLAG(+)   =        '0'
            AND BLR.GLBL_CMPY_CD        =        VND.GLBL_CMPY_CD(+)
            AND BLR.CARR_CD             =        VND.VND_CD(+)
            AND VND.EZCANCELFLAG(+)     =        '0'
            AND BLR.GLBL_CMPY_CD        =        CRU.GLBL_CMPY_CD(+)
            AND BLR.CARR_CD             =        CRU.VND_CD(+)
            AND CRU.EZCANCELFLAG(+)     =        '0'

            <isNotNull property="sMsg.sellToCustCd_H2">
                AND SO.SELL_TO_CUST_CD    =        #sMsg.sellToCustCd_H2#
            </isNotNull>
            
            <isNotNull property="sMsg.shipToCustCd_H2">
                AND SO.SHIP_TO_CUST_CD    =        #sMsg.shipToCustCd_H2#
            </isNotNull>
            
            <isNotNull property="sMsg.soNum_H1">
                AND SO.SO_NUM            LIKE    #sMsg.soNum_H1#
            </isNotNull>
            
            <isNotNull property="sMsg.trxHdrNum_H1">
                AND SOD.TRX_HDR_NUM      LIKE    #sMsg.trxHdrNum_H1#
            </isNotNull>

            <isEqual property="SHIPPED_DATE_FLG" compareValue="Y">
                <isNotNull property="sMsg.podStsDt_H1">
                    AND SOC.SHIP_DT_TM_TS        &gt;=    #sMsg.podStsDt_H1# || #hhmmssMin#
                </isNotNull>
                <isNotNull property="sMsg.podStsDt_H2">
                    AND SOC.SHIP_DT_TM_TS        &lt;=    #sMsg.podStsDt_H2# || #hhmmssMax#
                </isNotNull>
            </isEqual>

            <isNotEqual property="POD_INNER_JOIN" compareValue="Y">
                AND BLR.GLBL_CMPY_CD        =        POD.GLBL_CMPY_CD(+)
                AND BLR.CARR_CD             =        POD.CARR_CD(+)
                AND BLR.PRO_NUM             =        POD.PRO_NUM(+)
                AND POD.POD_LTST_REC_FLG(+)      =        'Y'
                AND POD.EZCANCELFLAG(+)          =        '0'
                <isEqual property="POD_STS_DATE_FLG" compareValue="Y">
                    <isNotNull property="sMsg.podStsDt_H1">
                        AND POD.POD_STS_DT(+)            &gt;=    #sMsg.podStsDt_H1#
                    </isNotNull>
                    <isNotNull property="sMsg.podStsDt_H2">
                        AND POD.POD_STS_DT(+)            &lt;=    #sMsg.podStsDt_H2#
                    </isNotNull>
                </isEqual>
                <iterate property="POD_STS_CD_LIST" var="elem[]" open="AND POD.POD_STS_CD(+) IN(" close=")" conjunction=",">
                    #elem[]#
                </iterate>
            </isNotEqual>
            <isEqual property="POD_INNER_JOIN" compareValue="Y">
                AND BLR.GLBL_CMPY_CD        =        POD.GLBL_CMPY_CD
                AND BLR.CARR_CD             =        POD.CARR_CD
                AND BLR.PRO_NUM             =        POD.PRO_NUM
                AND POD.POD_LTST_REC_FLG      =        'Y'
                AND POD.EZCANCELFLAG          =        '0'
                <isEqual property="POD_STS_DATE_FLG" compareValue="Y">
                    <isNotNull property="sMsg.podStsDt_H1">
                        AND POD.POD_STS_DT            &gt;=    #sMsg.podStsDt_H1#
                    </isNotNull>
                    <isNotNull property="sMsg.podStsDt_H2">
                        AND POD.POD_STS_DT            &lt;=    #sMsg.podStsDt_H2#
                    </isNotNull>
                </isEqual>
                <iterate property="POD_STS_CD_LIST" var="elem[]" open="AND POD.POD_STS_CD IN(" close=")" conjunction=",">
                    #elem[]#
                </iterate>
            </isEqual>

        ORDER BY
              BLR.WH_CD
            , BLR.BOL_NUM
            , VND.LOC_NM
            , BLR.PRO_NUM
            , SOD.TRX_HDR_NUM
            , SO.SO_NUM
        )
        WHERE
            ROWNUM &lt;= #rownum#
    </statement>

    <resultMap id="result.NLBL0090_ASMsg" class="NLBL0090_ASMsg">
        <result property="whCd_A1"            column="WH_CD"                javaType="EZDSStringItem"/>
        <result property="bolNum_A1"          column="BOL_NUM"              javaType="EZDSStringItem"/>
        <result property="carrCd_A1"          column="CARR_CD"              javaType="EZDSStringItem"/>
        <result property="locNm_A1"           column="LOC_NM"               javaType="EZDSStringItem"/>
        <result property="carrTrkUrl_A1"      column="CARR_TRK_URL"         javaType="EZDSStringItem"/>
        <result property="proNum_A1"          column="PRO_NUM"              javaType="EZDSStringItem"/>
        <result property="sellToCustCd_A1"    column="SELL_TO_CUST_CD"      javaType="EZDSStringItem"/>
        <result property="shipToCustCd_A1"    column="SHIP_TO_CUST_CD"      javaType="EZDSStringItem"/>
        <result property="trxHdrNum_A1"       column="TRX_HDR_NUM"          javaType="EZDSStringItem"/>
        <result property="soNum_A1"           column="SO_NUM"                javaType="EZDSStringItem"/>
        <result property="podStsDt_A1"        column="POD_STS_DT"            javaType="EZDSStringItem"/>
        <result property="podStsCd_A2"        column="POD_STS_CD"            javaType="EZDSStringItem"/>
        <result property="podStsNm_A1"        column="POD_STS_NM"            javaType="EZDSStringItem"/>
        <result property="podStsTpForScrCd_A1"        column="POD_STS_TP_FOR_SCR_CD"            javaType="EZDSStringItem"/>
        <result property="podStsRsnCd_A2"     column="POD_STS_RSN_CD"        javaType="EZDSStringItem"/>
        <result property="podStsRsnNm_A1"     column="POD_STS_RSN_NM"        javaType="EZDSStringItem"/>
    </resultMap>



    <statement id="getBOLTrackingDetailList" parameterClass="Map" resultMap="result.NLBL0090_BSMsg">
       SELECT
            SOCD.SO_NUM                    AS SO_NUM
            , SOD.SO_SLP_NUM               AS SO_SLP_NUM
            , SOCD.MDSE_CD                 AS MDSE_CD
            , M.MDSE_DESC_SHORT_TXT        AS MDSE_DESC_SHORT_TXT
            , SUM(SOCD.SHIP_QTY)           AS ORD_QTY
            , SOD.FROM_STK_STS_CD          AS FROM_STK_STS_CD
            , SOD.TRX_HDR_NUM              AS TRX_HDR_NUM
            , SO.SCE_ORD_TP_CD             AS SCE_ORD_TP_CD
            , SCOT.SCE_ORD_TP_NM           AS SCE_ORD_TP_NM
        FROM
            BOL_RELN              BLR
            , SHPG_ORD_CONF_DTL   SOCD
            , SHPG_ORD            SO
            , SHPG_ORD_DTL        SOD
            , SCE_ORD_TP          SCOT
            , MDSE                M
        WHERE
            BLR.GLBL_CMPY_CD               =        #sMsg.glblCmpyCd_Z1#
            AND BLR.BOL_NUM                =        #bolNum_A1#
            
            <isNotNull property="proNum_A1">
                AND BLR.PRO_NUM            =        #proNum_A1#
            </isNotNull>
            <isNull property="proNum_A1">
                AND BLR.PRO_NUM            IS        NULL
            </isNull>
            
            <isNotNull property="carrCd_A1">
                AND BLR.CARR_CD            =        #carrCd_A1#
            </isNotNull>
            <isNull property="carrCd_A1">
                AND BLR.CARR_CD            IS        NULL
            </isNull>
            
            AND BLR.WH_CD                =        #whCd_A1#
            AND BLR.GLBL_CMPY_CD         =        SOCD.GLBL_CMPY_CD
            AND BLR.WH_CD                =        SO.WH_CD
            AND BLR.BOL_NUM              =        SOCD.BOL_NUM
            AND NVL(BLR.CARR_CD,'*')     =        SOCD.VND_CD
            AND NVL(BLR.PRO_NUM,'*')     =        SOCD.PRO_NUM

            AND SOCD.GLBL_CMPY_CD        =        SO.GLBL_CMPY_CD
            AND SOCD.SO_NUM              =        SO.SO_NUM

            AND SOCD.GLBL_CMPY_CD        =        SOD.GLBL_CMPY_CD
            AND SOCD.SO_NUM              =        SOD.SO_NUM
            AND SOCD.SO_SLP_NUM          =        SOD.SO_SLP_NUM

            AND SO.GLBL_CMPY_CD          =        SCOT.GLBL_CMPY_CD (+)
            AND SO.SCE_ORD_TP_CD         =        SCOT.SCE_ORD_TP_CD (+)

            AND SOCD.GLBL_CMPY_CD        =        M.GLBL_CMPY_CD (+)
            AND SOCD.MDSE_CD             =        M.MDSE_CD (+)

            AND BLR.EZCANCELFLAG         =        '0'
            AND SOCD.EZCANCELFLAG        =        '0'
            AND SO.EZCANCELFLAG          =        '0'
            AND SOD.EZCANCELFLAG         =        '0'
            AND SCOT.EZCANCELFLAG (+)    =        '0'
            AND SCOT.INBD_OTBD_CD (+)    =        #OTBD#
            AND M.EZCANCELFLAG (+)       =        '0'
        GROUP BY
            SOCD.SO_NUM
            , SOD.SO_SLP_NUM
            , SOCD.MDSE_CD
            , M.MDSE_DESC_SHORT_TXT
            , SOD.FROM_STK_STS_CD
            , SOD.TRX_HDR_NUM
            , SO.SCE_ORD_TP_CD
            , SCOT.SCE_ORD_TP_NM
        ORDER BY
            SOCD.SO_NUM
            , SOD.SO_SLP_NUM
    </statement>

    <resultMap id="result.NLBL0090_BSMsg" class="NLBL0090_BSMsg">
        <result property="soNum_B1" column="SO_NUM" javaType="EZDSStringItem"/>
        <result property="soSlpNum_B1" column="SO_SLP_NUM" javaType="EZDSStringItem"/>
        <result property="mdseCd_B1" column="MDSE_CD" javaType="EZDSStringItem"/>
        <result property="mdseDescShortTxt_B1" column="MDSE_DESC_SHORT_TXT" javaType="EZDSStringItem"/>
        <result property="fromStkStsCd_B1" column="FROM_STK_STS_CD" javaType="EZDSStringItem"/>
        <result property="shpgQty_B1" column="ORD_QTY" javaType="EZDSBigDecimalItem"/>
        <result property="trxHdrNum_B1" column="TRX_HDR_NUM" javaType="EZDSStringItem"/>
        <result property="sceOrdTpCd_B1" column="SCE_ORD_TP_CD" javaType="EZDSStringItem"/>
        <result property="sceOrdTpNm_B1" column="SCE_ORD_TP_NM" javaType="EZDSStringItem"/>
    </resultMap>



    <statement id="getBOLTrackingListForCsv" parameterClass="Map">
        SELECT 
              TRAKING.BOL_NUM            AS    BOL_NUM
            , TRAKING.LOC_NM             AS    LOC_NM
            , DETAIL .MDSE_CD            AS    MDSE_CD
            , DETAIL .MDSE_DESC_SHORT_TXT            AS    MDSE_DESC_SHORT_TXT
            , DETAIL .ORD_QTY            AS    ORD_QTY
            , TRAKING.POD_STS_CD         AS    POD_STS_CD
            , TRAKING.POD_STS_DT         AS    POD_STS_DT
            , TRAKING.POD_STS_NM         AS    POD_STS_NM
            , TRAKING.POD_STS_RSN_CD     AS    POD_STS_RSN_CD
            , TRAKING.POD_STS_RSN_NM     AS    POD_STS_RSN_NM
            , TRAKING.PRO_NUM            AS    PRO_NUM
            , DETAIL .SCE_ORD_TP_CD      AS    SCE_ORD_TP_CD
            , DETAIL .SCE_ORD_TP_NM      AS    SCE_ORD_TP_NM
            , TRAKING.SELL_TO_CUST_CD    AS    SELL_TO_CUST_CD
            , TRAKING.SHIP_TO_CUST_CD    AS    SHIP_TO_CUST_CD
            , TRAKING.SO_NUM             AS    SO_NUM
            , TRAKING.SO_SLP_NUM         AS    SO_SLP_NUM
            , DETAIL .FROM_STK_STS_CD    AS    FROM_STK_STS_CD
            , TRAKING.TRX_HDR_NUM        AS    TRX_HDR_NUM
            , TRAKING.WH_CD              AS    WH_CD
        FROM 
            (
                SELECT    DISTINCT
                      BLR.WH_CD                AS WH_CD
                    , BLR.BOL_NUM              AS BOL_NUM
                    , BLR.CARR_CD              AS CARR_CD
                    , V.LOC_NM                 AS LOC_NM
                    , BLR.PRO_NUM              AS PRO_NUM
                    , SO.SELL_TO_CUST_CD       AS SELL_TO_CUST_CD
                    , SO.SHIP_TO_CUST_CD       AS SHIP_TO_CUST_CD
                    , SOD.TRX_HDR_NUM          AS TRX_HDR_NUM
                    , SO.SO_NUM                AS SO_NUM
                    , SOD.SO_SLP_NUM           AS SO_SLP_NUM
                    , POD.POD_STS_DT           AS POD_STS_DT
                    , POD.POD_STS_CD           AS POD_STS_CD
                    , POD.POD_STS_RSN_CD       AS POD_STS_RSN_CD
                    , PODS.POD_STS_NM          AS POD_STS_NM
                    , PODSR.POD_STS_RSN_NM     AS POD_STS_RSN_NM
                FROM
                      BOL_RELN                 BLR
                    , SHPG_ORD_CONF_DTL        SOCD
                    , SHPG_ORD_CONF            SOC
                    , SHPG_ORD                 SO
                    , SHPG_ORD_DTL             SOD
                    , VND                      V
                    , POD_STS                  PODS
                    , POD_STS_RSN              PODSR
                    , ( SELECT
                            GLBL_CMPY_CD
                            ,POD_STS_DT
                            ,POD_STS_CD
                            ,POD_STS_RSN_CD
                            ,POD_LTST_REC_FLG
                            ,CARR_CD
                            ,PRO_NUM
                            ,EZCANCELFLAG
                        FROM
                            POD
                        WHERE
                            POD.POD_LTST_REC_FLG        =        'Y'
                            AND POD.EZCANCELFLAG          =        '0'
                        <isEqual property="POD_STS_DATE_FLG" compareValue="Y">
                            <isNotNull property="sMsg.podStsDt_H1">
                                AND POD.POD_STS_DT            &gt;=    #sMsg.podStsDt_H1#
                            </isNotNull>
                            <isNotNull property="sMsg.podStsDt_H2">
                                AND POD.POD_STS_DT            &lt;=    #sMsg.podStsDt_H2#
                            </isNotNull>
                        </isEqual>
                        <iterate property="POD_STS_CD_LIST" var="elem[]" open="AND (" close=")" conjunction="OR">
                                POD.POD_STS_CD            = #elem[]#
                        </iterate>
                        ) POD
                WHERE
                    BLR.GLBL_CMPY_CD        =        #sMsg.glblCmpyCd_Z1#
                    
                    <isNotNull property="sMsg.bolNum_H1">
                        AND BLR.BOL_NUM            LIKE    #sMsg.bolNum_H1#
                    </isNotNull>
                    
                    <isNotNull property="sMsg.proNum_H1">
                        AND BLR.PRO_NUM            LIKE    #sMsg.proNum_H1#
                    </isNotNull>
                    
                    <isNotNull property="sMsg.carrCd_H2">
                        AND BLR.CARR_CD            =        #sMsg.carrCd_H2#
                    </isNotNull>
                    
                    AND BLR.WH_CD               =       #sMsg.whCd_H1#
                    AND BLR.EZCANCELFLAG        =        '0'

                    AND BLR.GLBL_CMPY_CD        =        SOCD.GLBL_CMPY_CD
                    AND BLR.WH_CD               =        SO.WH_CD
                    AND BLR.BOL_NUM             =        SOCD.BOL_NUM
                    AND NVL(BLR.CARR_CD,'*')    =        SOCD.VND_CD
                    AND NVL(BLR.PRO_NUM,'*')    =        SOCD.PRO_NUM

                    AND SOCD.GLBL_CMPY_CD       =        SOC.GLBL_CMPY_CD
                    AND SOCD.SO_NUM             =        SOC.SO_NUM
                    
                    AND SOCD.GLBL_CMPY_CD       =        SO.GLBL_CMPY_CD
                    AND SOCD.SO_NUM             =        SO.SO_NUM

                    AND SOCD.GLBL_CMPY_CD       =        SOD.GLBL_CMPY_CD
                    AND SOCD.SO_NUM             =        SOD.SO_NUM
                    AND SOCD.SO_SLP_NUM         =        SOD.SO_SLP_NUM
                    
                    AND SOCD.EZCANCELFLAG       =        '0'
                    AND SOC.EZCANCELFLAG        =        '0'
                    AND SO.EZCANCELFLAG         =        '0'
                    AND SOD.EZCANCELFLAG        =        '0'

                <isNotEqual property="POD_INNER_JOIN" compareValue="Y">
                    AND BLR.GLBL_CMPY_CD        =        POD.GLBL_CMPY_CD(+)
                    AND BLR.CARR_CD             =        POD.CARR_CD(+)
                    AND BLR.PRO_NUM             =        POD.PRO_NUM(+)
                </isNotEqual>
                <isEqual property="POD_INNER_JOIN" compareValue="Y">
                    AND BLR.GLBL_CMPY_CD        =        POD.GLBL_CMPY_CD
                    AND BLR.CARR_CD             =        POD.CARR_CD
                    AND BLR.PRO_NUM             =        POD.PRO_NUM
                </isEqual>

                    AND POD.GLBL_CMPY_CD        =        PODS.GLBL_CMPY_CD(+)
                    AND POD.POD_STS_CD          =        PODS.POD_STS_CD(+)

                    AND POD.GLBL_CMPY_CD        =        PODSR.GLBL_CMPY_CD (+)
                    AND POD.POD_STS_RSN_CD      =        PODSR.POD_STS_RSN_CD(+)
                
                    AND PODS.EZCANCELFLAG(+)    =        '0'
                    AND PODSR.EZCANCELFLAG(+)   =        '0'

                    AND BLR.GLBL_CMPY_CD        =        V.GLBL_CMPY_CD(+)
                    AND BLR.CARR_CD             =        V.VND_CD(+)
                    AND V.EZCANCELFLAG(+)       =        '0'
        
                    <isNotNull property="sMsg.sellToCustCd_H2">
                        AND SO.SELL_TO_CUST_CD    =        #sMsg.sellToCustCd_H2#
                    </isNotNull>
                    
                    <isNotNull property="sMsg.shipToCustCd_H2">
                        AND SO.SHIP_TO_CUST_CD    =        #sMsg.shipToCustCd_H2#
                    </isNotNull>
                    
                    <isNotNull property="sMsg.soNum_H1">
                        AND SO.SO_NUM            LIKE    #sMsg.soNum_H1#
                    </isNotNull>
                    
                    <isNotNull property="sMsg.trxHdrNum_H1">
                        AND SOD.TRX_HDR_NUM        LIKE    #sMsg.trxHdrNum_H1#
                    </isNotNull>
                    
                    <isEqual property="SHIPPED_DATE_FLG" compareValue="Y">
                        <isNotNull property="sMsg.podStsDt_H1">
                            AND SOC.SHIP_DT_TM_TS        &gt;=    #sMsg.podStsDt_H1# || #hhmmssMin# 
                        </isNotNull>
                        <isNotNull property="sMsg.podStsDt_H2">
                            AND SOC.SHIP_DT_TM_TS        &lt;=    #sMsg.podStsDt_H2# || #hhmmssMax#
                        </isNotNull>            
                    </isEqual>
            ) TRAKING
          , (
                SELECT
                      BLR.WH_CD              AS WH_CD
                    , BLR.BOL_NUM            AS BOL_NUM
                    , BLR.CARR_CD            AS CARR_CD
                    , BLR.PRO_NUM            AS PRO_NUM
                    , SOCD.SO_NUM            AS SO_NUM
                    , SOD.SO_SLP_NUM         AS SO_SLP_NUM
                    , SOCD.MDSE_CD           AS MDSE_CD
                    , M.MDSE_DESC_SHORT_TXT  AS MDSE_DESC_SHORT_TXT
                    , SOD.FROM_STK_STS_CD    AS FROM_STK_STS_CD
                    , SUM(SOCD.SHIP_QTY)     AS ORD_QTY
                    , SOD.TRX_HDR_NUM        AS TRX_HDR_NUM
                    , SO.SCE_ORD_TP_CD       AS SCE_ORD_TP_CD
                    , SCOT.SCE_ORD_TP_NM     AS SCE_ORD_TP_NM
                FROM
                      BOL_RELN             BLR
                    , SHPG_ORD_CONF_DTL    SOCD
                    , SHPG_ORD             SO
                    , SHPG_ORD_DTL         SOD
                    , SCE_ORD_TP           SCOT
                    , MDSE                 M
                WHERE
                    BLR.GLBL_CMPY_CD            =        #sMsg.glblCmpyCd_Z1#
                    
                    <isNotNull property="sMsg.bolNum_H1">
                        AND BLR.BOL_NUM            LIKE    #sMsg.bolNum_H1#
                    </isNotNull>
                    
                    <isNotNull property="sMsg.proNum_H1">
                        AND BLR.PRO_NUM            LIKE    #sMsg.proNum_H1#
                    </isNotNull>
                    
                    <isNotNull property="sMsg.carrCd_H2">
                        AND BLR.CARR_CD            =        #sMsg.carrCd_H2#
                    </isNotNull>
                    
                    AND BLR.WH_CD               =       #sMsg.whCd_H1#

                    AND BLR.EZCANCELFLAG        =        '0'

                    AND BLR.GLBL_CMPY_CD        =        SOCD.GLBL_CMPY_CD
                    AND BLR.WH_CD               =        SO.WH_CD
                    AND BLR.BOL_NUM             =        SOCD.BOL_NUM
                    AND NVL(BLR.CARR_CD,'*')    =        SOCD.VND_CD
                    AND NVL(BLR.PRO_NUM,'*')    =        SOCD.PRO_NUM
                    
                    AND SOCD.GLBL_CMPY_CD       =        SO.GLBL_CMPY_CD
                    AND SOCD.SO_NUM             =        SO.SO_NUM
                    
                    AND SOCD.GLBL_CMPY_CD       =        SOD.GLBL_CMPY_CD
                    AND SOCD.SO_NUM             =        SOD.SO_NUM
                    AND SOCD.SO_SLP_NUM         =        SOD.SO_SLP_NUM
                    
                    AND SO.GLBL_CMPY_CD         =        SCOT.GLBL_CMPY_CD (+)
                    AND SO.SCE_ORD_TP_CD        =        SCOT.SCE_ORD_TP_CD (+)
                    
                    AND SOCD.GLBL_CMPY_CD       =        M.GLBL_CMPY_CD (+)
                    AND SOCD.MDSE_CD            =        M.MDSE_CD (+)
                    
                    AND SOCD.EZCANCELFLAG       =        '0'
                    AND SO.EZCANCELFLAG         =        '0'
                    AND SOD.EZCANCELFLAG        =        '0'
                    AND SCOT.EZCANCELFLAG (+)   =        '0'
                    AND SCOT.INBD_OTBD_CD (+)   =        #OTBD#
                    AND M.EZCANCELFLAG (+)      =        '0'
                GROUP BY
                      BLR.WH_CD
                    , BLR.BOL_NUM
                    , BLR.CARR_CD
                    , BLR.PRO_NUM
                    , SOCD.SO_NUM
                    , SOD.SO_SLP_NUM
                    , SOCD.MDSE_CD
                    , M.MDSE_DESC_SHORT_TXT
                    , SOD.FROM_STK_STS_CD
                    , SOD.TRX_HDR_NUM
                    , SO.SCE_ORD_TP_CD
                    , SCOT.SCE_ORD_TP_NM
            ) DETAIL
        WHERE 
                TRAKING.WH_CD        = DETAIL.WH_CD
            AND    TRAKING.BOL_NUM        = DETAIL.BOL_NUM
            AND NVL(TRAKING.CARR_CD,' ')    =        NVL(DETAIL.CARR_CD,' ')
            AND NVL(TRAKING.PRO_NUM,' ')    =        NVL(DETAIL.PRO_NUM,' ')
            AND    TRAKING.SO_NUM        = DETAIL.SO_NUM
            AND    TRAKING.SO_SLP_NUM    = DETAIL.SO_SLP_NUM
        ORDER BY
              TRAKING.WH_CD    
            , TRAKING.BOL_NUM
            , TRAKING.LOC_NM
            , TRAKING.PRO_NUM
            , TRAKING.TRX_HDR_NUM
            , TRAKING.SO_NUM
            , TRAKING.SO_SLP_NUM
    </statement>

</sqlMap>