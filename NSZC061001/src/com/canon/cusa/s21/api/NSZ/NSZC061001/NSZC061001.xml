<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<sqlMap namespace="NSZC061001">

    <statement id="getSvcTermAttrbMapValCd" parameterClass="Map" resultClass="Map">
        SELECT 
             NVL(DTL_COND.SVC_TERM_ATTRB_MAP_VAL_CD, CONTR_COND.SVC_TERM_ATTRB_MAP_VAL_CD)
                                                AS  SVC_TERM_ATTRB_MAP_VAL_CD
        FROM
             SVC_TERM_COND_ATTRB          TCA
            ,(SELECT
                   TCN.SVC_TERM_COND_ATTRB_PK
                  ,TCN.SVC_TERM_ATTRB_MAP_VAL_CD
              FROM
                   SVC_TERM_COND          TCN
              WHERE
                      TCN.GLBL_CMPY_CD          = #glblCmpyCd#
                  AND TCN.DS_CONTR_PK           = #dsContrPk#
                  AND TCN.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                  AND TCN.EZCANCELFLAG          = '0'
             ) DTL_COND
            ,(SELECT
                   TCN.SVC_TERM_COND_ATTRB_PK
                  ,TCN.SVC_TERM_ATTRB_MAP_VAL_CD
              FROM
                   SVC_TERM_COND          TCN
              WHERE
                      TCN.GLBL_CMPY_CD          = #glblCmpyCd#
                  AND TCN.DS_CONTR_PK           = #dsContrPk#
                  AND TCN.DS_CONTR_DTL_PK       IS NULL
                  AND TCN.EZCANCELFLAG          = '0'
             ) CONTR_COND
        WHERE
                TCA.GLBL_CMPY_CD                = #glblCmpyCd#
            AND TCA.SVC_TERM_COND_ATTRB_NM      = #svcTermCondAttrbNm#
            AND TCA.EZCANCELFLAG                = '0'
            AND TCA.SVC_TERM_COND_ATTRB_PK      = DTL_COND.SVC_TERM_COND_ATTRB_PK(+)
            AND TCA.SVC_TERM_COND_ATTRB_PK      = CONTR_COND.SVC_TERM_COND_ATTRB_PK(+)
    </statement>
    <statement id="getSvcLborChrg" parameterClass="Map" resultClass="Map">
        SELECT
             SLC.SVC_MIN_CHRG_HRS_AOT     AS SVC_MIN_CHRG_HRS_AOT
            ,SLC.SVC_LBOR_UNIT_AMT        AS SVC_LBOR_UNIT_AMT
            ,SLC.SVC_PRC_TRVL_CHRG_FLG    AS SVC_PRC_TRVL_CHRG_FLG
            ,SLC.SVC_CHRG_CCY_CD          AS SVC_CHRG_CCY_CD
            ,SLC.INTG_MDSE_CD             AS INTG_MDSE_CD
        FROM
            SVC_LBOR_CHRG      SLC
        WHERE
                SLC.GLBL_CMPY_CD            = #glblCmpyCd#
            AND SLC.SVC_PRC_SHIFT_NUM       = #svcPrcShiftNum#
            AND SLC.SVC_LINE_BIZ_CD         = #svcLineBizCd#
            AND SLC.MDL_GRP_ID              = #mdlGrpId#
            AND SLC.EZCANCELFLAG            = '0'
    </statement>
    <statement id="getSvcTrvlChrg" parameterClass="Map" resultClass="Map">
        SELECT
             STC.SVC_MIN_CHRG_HRS_AOT    AS SVC_MIN_CHRG_HRS_AOT
            ,STC.SVC_TRVL_UNIT_AMT       AS SVC_TRVL_UNIT_AMT
            ,STC.SVC_TRVL_CHRG_TP_CD     AS SVC_TRVL_CHRG_TP_CD
            ,STC.SVC_CHRG_CCY_CD         AS SVC_CHRG_CCY_CD
            ,STC.INTG_MDSE_CD            AS INTG_MDSE_CD
        FROM
             SVC_TRVL_CHRG      STC
        WHERE
                STC.GLBL_CMPY_CD            = #glblCmpyCd#
            <isNotNull property="svcZnCd">
            AND STC.SVC_ZN_CD               = #svcZnCd#
            </isNotNull>
            AND STC.SVC_LINE_BIZ_CD         = #svcLineBizCd#
            AND STC.MDL_GRP_ID              = #mdlGrpId#
            AND STC.EZCANCELFLAG            = '0'
    <!-- START 2019/05/15 W.Honda [QC#50297,ADD] -->
        ORDER BY
            STC.SVC_TRVL_UNIT_AMT DESC
    <!-- END 2019/05/15 W.Honda [QC#50297,ADD] -->
    </statement>
    <statement id="getMdlList" parameterClass="Map" resultClass="Map">
            SELECT
                1 AS SORT_KEY
                ,DM.MDL_ID
                ,DM.MDL_GRP_ID
            FROM
                 SVC_CONFIG_MSTR    SCM
                ,DS_MDL             DM
            WHERE
                SCM.GLBL_CMPY_CD            = #glblCmpyCd#
            AND SCM.SVC_MACH_MSTR_PK        = #svcMachMstrPk#
            AND SCM.GLBL_CMPY_CD            = DM.GLBL_CMPY_CD
            AND SCM.MDL_ID                  = DM.MDL_ID
            AND SCM.EZCANCELFLAG            = '0'
            AND DM.EZCANCELFLAG             = '0'
            UNION ALL
            SELECT
                3 AS SORT_KEY
                ,DM.MDL_ID
                ,DM.MDL_GRP_ID
            FROM
                 SVC_MACH_MSTR      MAC
                ,CPO_DTL            CD
                ,DS_CPO_CONFIG      DCC
                ,DS_MDL             DM
            WHERE
                MAC.GLBL_CMPY_CD          = #glblCmpyCd#
            AND MAC.SVC_MACH_MSTR_PK      = #svcMachMstrPk#
            AND MAC.GLBL_CMPY_CD          = CD.GLBL_CMPY_CD
            AND MAC.TRX_HDR_NUM           = CD.CPO_ORD_NUM
            AND MAC.TRX_LINE_NUM          = CD.CPO_DTL_LINE_NUM
            AND MAC.TRX_LINE_SUB_NUM      = CD.CPO_DTL_LINE_SUB_NUM
            AND CD.GLBL_CMPY_CD           = DCC.GLBL_CMPY_CD
            AND CD.DS_CPO_CONFIG_PK       = DCC.DS_CPO_CONFIG_PK
            AND DCC.GLBL_CMPY_CD          = DM.GLBL_CMPY_CD
            AND DCC.MDL_ID                = DM.MDL_ID
            AND MAC.EZCANCELFLAG          = '0'
            AND CD.EZCANCELFLAG           = '0'
            AND DCC.EZCANCELFLAG          = '0'
            AND DM.EZCANCELFLAG           = '0'
        <isNotNull property="svcTaskNum">
            UNION ALL
            SELECT
                2 AS SORT_KEY
                ,DM.MDL_ID
                ,DM.MDL_GRP_ID
            FROM
                 SVC_TASK           TSK
                ,MDL_NM             MDL
                ,DS_MDL             DM
            WHERE
                TSK.GLBL_CMPY_CD            = #glblCmpyCd#
            AND TSK.SVC_TASK_NUM            = #svcTaskNum#
            AND TSK.GLBL_CMPY_CD            = MDL.T_GLBL_CMPY_CD
            AND TSK.MDL_NM                  = MDL.T_MDL_NM
            AND MDL.T_GLBL_CMPY_CD          = DM.GLBL_CMPY_CD
            AND MDL.T_MDL_ID                = DM.MDL_ID
            AND TSK.EZCANCELFLAG            = '0'
            AND MDL.EZCANCELFLAG            = '0'
            AND DM.EZCANCELFLAG             = '0'
        </isNotNull>
            ORDER BY SORT_KEY
    </statement>

    <statement id="getCovBySvcTask" parameterClass="Map" resultClass="Map">
        SELECT
             SBT.SVC_BILL_TP_CD     AS SVC_BILL_TP_CD
            ,SBT.LBOR_CHRG_FLG      AS LBOR_CHRG_FLG
            ,SBT.PRT_CHRG_FLG       AS PRT_CHRG_FLG
            ,SBT.EXP_CHRG_FLG       AS EXP_CHRG_FLG
            ,SBT.DRUM_CHRG_FLG      AS SVC_LBOR_CHRG_FLG
        FROM
             SVC_TASK       ST
            ,SVC_BILL_TP    SBT
        WHERE
                ST.GLBL_CMPY_CD             = #glblCmpyCd#
            AND ST.SVC_TASK_NUM             = #svcTaskNum#
            AND ST.EZCANCELFLAG             = '0'
            AND ST.GLBL_CMPY_CD             = SBT.GLBL_CMPY_CD
            AND ST.SVC_BILL_TP_CD           = SBT.SVC_BILL_TP_CD
            AND SBT.EZCANCELFLAG            = '0'    
    </statement>
    <statement id="getStdCcyDigit" parameterClass="Map" resultClass="Integer">
        SELECT
            B.AFT_DECL_PNT_DIGIT_NUM
        FROM
            GLBL_CMPY A,
            CCY B
        WHERE
            A.GLBL_CMPY_CD = #glblCmpyCd#
            AND A.EZCANCELFLAG = '0'
            AND B.GLBL_CMPY_CD = A.GLBL_CMPY_CD
            AND B.CCY_CD = A.STD_CCY_CD
            AND B.EZCANCELFLAG = '0'
    </statement>
    <statement id="getExchRateData" parameterClass="Map" resultClass="Map">
        SELECT
            A.ACCT_ARTH_TP_CD,
            B.ACTL_EXCH_RATE
        FROM
            CCY A,
            ACCT_DLY_ACTL_EXCH_RATES B
        WHERE
            A.GLBL_CMPY_CD = #glblCmpyCd#
            AND A.CCY_CD = #ccyCd#
            AND A.EZCANCELFLAG = '0'
            AND B.GLBL_CMPY_CD = A.GLBL_CMPY_CD
            AND B.CCY_CD = A.CCY_CD
            AND B.ACTL_EXCH_RATE_ENT_DT <![CDATA[ <= ]]> #trxDt#
            AND B.ACTL_EXCH_RATE IS NOT NULL
            AND B.EZCANCELFLAG = '0'
        ORDER BY
            B.ACTL_EXCH_RATE_ENT_DT DESC
    </statement>
    <!-- START 2017/01/04 K.Kojima [QC#16513,ADD] -->
    <statement id="getSvcBillTpCd" parameterClass="Map" resultClass="String">
        SELECT
            SVC_BILL_TP_CD
        FROM
            (
                SELECT
                     SBT.SVC_BILL_TP_CD
                    ,RANK() OVER(ORDER BY
                         CASE WHEN SBT.LBOR_CHRG_FLG = SUB.LBOR_CHRG_FLG THEN 0 ELSE 1 END
                        <!-- START 2018/12/05 K.Kim [QC#28633,ADD] -->
                        ,CASE WHEN SBT.TRVL_CHRG_FLG = SUB.TRVL_CHRG_FLG THEN 0 ELSE 1 END
                        <!-- END 2018/12/05 K.Kim [QC#28633,ADD] -->
                        ,CASE WHEN SBT.PRT_CHRG_FLG  = SUB.PRT_CHRG_FLG  THEN 0 ELSE 1 END
                        ,CASE WHEN SBT.DRUM_CHRG_FLG = SUB.DRUM_CHRG_FLG THEN 0 ELSE 1 END
                        ,CASE WHEN SBT.EXP_CHRG_FLG  = SUB.EXP_CHRG_FLG  THEN 0 ELSE 1 END
                        ,CASE WHEN SBT.FREE_HRS_NUM  = SUB.FREE_HRS_NUM  THEN 0 ELSE 1 END
                        ,SBT.SVC_BILL_TP_SORT_NUM) AS CAL_RANK
                FROM
                     SVC_BILL_TP SBT
                    ,(
                        SELECT
                             A.GLBL_CMPY_CD
                            ,MIN(A.LBOR_CHRG_FLG) AS LBOR_CHRG_FLG
                            <!-- START 2018/12/05 K.Kim [QC#28633,ADD] -->
                            ,MIN(A.TRVL_CHRG_FLG) AS TRVL_CHRG_FLG
                            <!-- END 2018/12/05 K.Kim [QC#28633,ADD] -->
                            ,MIN(A.PRT_CHRG_FLG)  AS PRT_CHRG_FLG
                            ,MIN(A.DRUM_CHRG_FLG) AS DRUM_CHRG_FLG
                            ,MIN(A.EXP_CHRG_FLG)  AS EXP_CHRG_FLG
                            ,MAX(A.FREE_HRS_NUM)  AS FREE_HRS_NUM
                        FROM
                            SVC_BILL_TP A
                        WHERE
                                A.GLBL_CMPY_CD = #glblCmpyCd#
                            <iterate property="svcBillTpCDList" var="svcBillTpCD[]" open="AND A.SVC_BILL_TP_CD IN (" close=")" conjunction=",">
                            #svcBillTpCD[]#
                            </iterate>
                            AND A.EZCANCELFLAG = '0'
                        GROUP BY
                            A.GLBL_CMPY_CD
                     ) SUB
                WHERE
                        SBT.GLBL_CMPY_CD = SUB.GLBL_CMPY_CD
                    AND SBT.EZCANCELFLAG = '0'
                )
        WHERE
            CAL_RANK = 1
    </statement>
    <!-- START 2017/06/05 K.Kojima [QC#18295,MOD] -->
    <!-- <statement id="getDsContrPk" parameterClass="Map" resultClass="BigDecimal"> -->
    <!--     SELECT -->
    <!--         DS_CONTR_PK -->
    <!--     FROM -->
    <!--         ( -->
    <!--             SELECT -->
    <!--                  DCD.DS_CONTR_PK -->
    <!--                 ,RANK() OVER(ORDER BY -->
    <!--                      CASE WHEN SBT.LBOR_CHRG_FLG   = #flgN#          THEN 0 ELSE 1 END -->
    <!--                     ,CASE WHEN DC.DS_CONTR_CATG_CD = #dsContrCatgCd# THEN 0 ELSE 1 END -->
    <!--                     ,NVL(DCD.CONTR_CLO_DT,DCD.CONTR_EFF_THRU_DT) DESC -->
    <!--                     ,DC.DS_CONTR_NUM) AS CAL_RANK -->
    <!--             FROM -->
    <!--                  DS_CONTR_DTL     DCD -->
    <!--                 ,DS_CONTR         DC -->
    <!--                 ,MDSE             MDS -->
    <!--                 ,SVC_COV_TMPL_DTL SCTD -->
    <!--                 ,SVC_BILL_TP      SBT -->
    <!--             WHERE -->
    <!--                     DCD.GLBL_CMPY_CD         = #glblCmpyCd# -->
    <!--                 <iterate property="dsContrDtkPkList" var="dsContrDtkPk[]" open="AND DCD.DS_CONTR_DTL_PK IN (" close=")" conjunction=","> -->
    <!--                 #dsContrDtkPk[]# -->
    <!--                 </iterate> -->
    <!--                 AND DCD.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD -->
    <!--                 AND DCD.DS_CONTR_PK          = DC.DS_CONTR_PK -->
    <!--                 AND DCD.GLBL_CMPY_CD         = MDS.GLBL_CMPY_CD -->
    <!--                 AND DCD.SVC_PGM_MDSE_CD      = MDS.MDSE_CD -->
    <!--                 AND MDS.GLBL_CMPY_CD         = SCTD.GLBL_CMPY_CD -->
    <!--                 AND MDS.SVC_COV_TMPL_TP_CD   = SCTD.SVC_COV_TMPL_TP_CD -->
    <!--                 AND SCTD.SVC_COV_FEAT_CD     = #svcCovFeatCd# -->
    <!--                 AND SCTD.GLBL_CMPY_CD        = SBT.GLBL_CMPY_CD -->
    <!--                 AND SCTD.SVC_COV_DTL_VAL_TXT = SBT.SVC_BILL_TP_CD -->
    <!--                 AND DCD.EZCANCELFLAG         = '0' -->
    <!--                 AND DC.EZCANCELFLAG          = '0' -->
    <!--                 AND MDS.EZCANCELFLAG         = '0' -->
    <!--                 AND SCTD.EZCANCELFLAG        = '0' -->
    <!--                 AND SBT.EZCANCELFLAG         = '0' -->
    <!--         ) -->
    <!--     WHERE -->
    <!--         CAL_RANK = 1 -->
    <!-- </statement> -->
    <statement id="getDsContrPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            DS_CONTR_PK
        FROM
            (
                SELECT
                     DCD.DS_CONTR_PK
                    ,RANK() OVER(ORDER BY
                         CASE WHEN SBT.LBOR_CHRG_FLG    = #flgN#          THEN 0 ELSE 1 END
                        ,CASE WHEN DCD.DS_CONTR_CATG_CD = #dsContrCatgCd# THEN 0 ELSE 1 END
                        ,NVL(DCD.CONTR_CLO_DT,DCD.CONTR_EFF_THRU_DT) DESC
                        ,DCD.DS_CONTR_NUM) AS CAL_RANK
                FROM
                    (
                        SELECT
                             DC.GLBL_CMPY_CD
                            ,DC.DS_CONTR_PK
                            ,DC.DS_CONTR_CATG_CD
                            ,DC.DS_CONTR_NUM
                            ,DTL.CONTR_EFF_THRU_DT
                            ,DTL.CONTR_CLO_DT
                            ,NVL(FLT.SVC_PGM_MDSE_CD, DTL.SVC_PGM_MDSE_CD) AS SVC_PGM_MDSE_CD
                        FROM
                             DS_CONTR_DTL     DTL
                            ,DS_CONTR         DC
                            ,DS_CONTR_DTL     FLT
                        WHERE
                                DTL.GLBL_CMPY_CD          = #glblCmpyCd#
                            <iterate property="dsContrDtkPkList" var="dsContrDtkPk[]" open="AND DTL.DS_CONTR_DTL_PK IN (" close=")" conjunction=",">
                            #dsContrDtkPk[]#
                            </iterate>
                            AND DTL.GLBL_CMPY_CD          = DC.GLBL_CMPY_CD
                            AND DTL.DS_CONTR_PK           = DC.DS_CONTR_PK
                            AND DC.GLBL_CMPY_CD           = FLT.GLBL_CMPY_CD(+)
                            AND DC.DS_CONTR_PK            = FLT.DS_CONTR_PK(+)
                            AND FLT.DS_CONTR_DTL_TP_CD(+) = #dsContrDtlTpCdFleet#
                            AND DTL.EZCANCELFLAG          = '0'
                            AND DC.EZCANCELFLAG           = '0'
                            AND FLT.EZCANCELFLAG(+)       = '0'
                    ) DCD
                    ,MDSE             MDS
                    ,SVC_COV_TMPL_DTL SCTD
                    ,SVC_BILL_TP      SBT
                WHERE
                        DCD.GLBL_CMPY_CD         = MDS.GLBL_CMPY_CD
                    AND DCD.SVC_PGM_MDSE_CD      = MDS.MDSE_CD
                    AND MDS.GLBL_CMPY_CD         = SCTD.GLBL_CMPY_CD
                    AND MDS.SVC_COV_TMPL_TP_CD   = SCTD.SVC_COV_TMPL_TP_CD
                    AND SCTD.SVC_COV_FEAT_CD     = #svcCovFeatCd#
                    AND SCTD.GLBL_CMPY_CD        = SBT.GLBL_CMPY_CD
                    AND SCTD.SVC_COV_DTL_VAL_TXT = SBT.SVC_BILL_TP_CD
                    AND MDS.EZCANCELFLAG         = '0'
                    AND SCTD.EZCANCELFLAG        = '0'
                    AND SBT.EZCANCELFLAG         = '0'
            )
        WHERE
            CAL_RANK = 1
    </statement>
    <!-- END 2017/06/05 K.Kojima [QC#18295,MOD] -->
    <!-- END 2017/01/04 K.Kojima [QC#16513,ADD] -->

    <!-- START 2017/06/05 K.Kojima [QC#18295,ADD] -->
    <statement id="getSvcPgmMdseCd" parameterClass="Map" resultClass="String">
    SELECT
        NVL(FLT.SVC_PGM_MDSE_CD, DTL.SVC_PGM_MDSE_CD) AS SVC_PGM_MDSE_CD
    FROM
         DS_CONTR_DTL     DTL
        ,DS_CONTR         DC
        ,DS_CONTR_DTL     FLT
    WHERE
            DTL.GLBL_CMPY_CD          = #glblCmpyCd#
        AND DTL.DS_CONTR_DTL_PK       = #dsContrDtlPk#
        AND DTL.GLBL_CMPY_CD          = DC.GLBL_CMPY_CD
        AND DTL.DS_CONTR_PK           = DC.DS_CONTR_PK
        AND DC.GLBL_CMPY_CD           = FLT.GLBL_CMPY_CD(+)
        AND DC.DS_CONTR_PK            = FLT.DS_CONTR_PK(+)
        AND FLT.DS_CONTR_DTL_TP_CD(+) = #dsContrDtlTpCdFleet#
        AND DTL.EZCANCELFLAG          = '0'
        AND DC.EZCANCELFLAG           = '0'
        AND FLT.EZCANCELFLAG(+)       = '0'
    </statement>
    <!-- END 2017/06/05 K.Kojima [QC#18295,ADD] -->
    <!-- START 2017/10/06 K.Kim [QC#20078,ADD] -->
    <statement id="getAfterHourAllwFlg" parameterClass="Map" resultClass="String">
    SELECT
        DM.AFTER_HOUR_ALLW_FLG
    FROM
         SVC_MACH_MSTR    SMM
        ,SVC_CONFIG_MSTR  SCM
        ,DS_MDL           DM
    WHERE
            SMM.GLBL_CMPY_CD          = #glblCmpyCd#
        AND SMM.SVC_MACH_MSTR_PK      = #svcMachMstrPk#
        AND SMM.GLBL_CMPY_CD          = SCM.GLBL_CMPY_CD
        AND SMM.SVC_CONFIG_MSTR_PK    = SCM.SVC_CONFIG_MSTR_PK
        AND SCM.GLBL_CMPY_CD          = DM.GLBL_CMPY_CD
        AND SCM.MDL_ID                = DM.MDL_ID
        AND SMM.EZCANCELFLAG          = '0'
        AND SCM.EZCANCELFLAG          = '0'
        AND DM.EZCANCELFLAG           = '0'
    </statement>
    <!-- END 2017/10/06 K.Kim [QC#20078,ADD] -->

    <!-- START 2018/07/18 M.Naito [QC#13309,ADD] -->
    <statement id="getSvcLborDiscInfo" parameterClass="Map" resultClass="Map">
        SELECT
             SPCL_PRC_AMT        AS SPCL_PRC_AMT
            ,SVC_LBOR_DISC_PCT   AS SVC_LBOR_DISC_PCT
        FROM
        (
            SELECT
                 SLDD.SPCL_PRC_AMT        AS SPCL_PRC_AMT
                ,SLDD.SVC_LBOR_DISC_PCT   AS SVC_LBOR_DISC_PCT
            FROM
                 SVC_LBOR_DISC_DTL SLDD
                ,SVC_LBOR_DISC     SLD
            WHERE
                    SLDD.GLBL_CMPY_CD               = #glblCmpyCd#
                AND SLDD.SVC_MACH_MSTR_PK           = #svcMachMstrPk#
                AND SLDD.EZCANCELFLAG               = '0'
                AND SLDD.GLBL_CMPY_CD               = SLD.GLBL_CMPY_CD
                AND SLDD.SVC_LBOR_DISC_PK           = SLD.SVC_LBOR_DISC_PK
                AND SLD.EFF_FROM_DT                 &lt;= #startDt#
                AND NVL(SLD.EFF_THRU_DT, #startDt#) &gt;= #startDt#
                AND (
                        SLDD.SPCL_PRC_AMT      IS NOT NULL
                    OR
                        SLDD.SVC_LBOR_DISC_PCT IS NOT NULL
                    )
                AND SLD.EZCANCELFLAG                = '0'
            ORDER BY
                 SPCL_PRC_AMT
                ,SVC_LBOR_DISC_PCT DESC
        )
        WHERE
            ROWNUM = 1
    </statement>

    <statement id="getTempEttlInfo" parameterClass="Map" resultClass="Map">
        SELECT
             TE.TEMP_ETTL_NUM   AS TEMP_ETTL_NUM
            ,TED.LBOR_FEE_AMT   AS LBOR_FEE_AMT
        FROM
             TEMP_ETTL_DTL           TED
            ,TEMP_ETTL               TE
            ,TEMP_ETTL_SVC_PRC_SHIFT TES
            ,SVC_PRC_SHIFT           SPS
        WHERE
                TED.GLBL_CMPY_CD               = #glblCmpyCd#
            AND TED.SVC_MACH_MSTR_PK           = #svcMachMstrPk#
            AND TED.EZCANCELFLAG               = '0'
            AND TED.GLBL_CMPY_CD               = TE.GLBL_CMPY_CD
            AND TED.TEMP_ETTL_NUM              = TE.TEMP_ETTL_NUM
            AND TE.EFF_FROM_DT                 &lt;= #startDt#
            AND NVL(TE.EFF_THRU_DT, #startDt#) &gt;= #startDt#
            AND TED.LBOR_FEE_AMT               IS NOT NULL
            AND TE.EZCANCELFLAG                = '0'
            AND TE.GLBL_CMPY_CD                = TES.GLBL_CMPY_CD
            AND TE.TEMP_ETTL_NUM               = TES.TEMP_ETTL_NUM
            AND TES.EZCANCELFLAG               = '0'
            AND TES.GLBL_CMPY_CD               = SPS.GLBL_CMPY_CD
            AND TES.SVC_PRC_SHIFT_PK           = SPS.SVC_PRC_SHIFT_PK
            <isEqual property="dayOfTheWeek" compareValue="1">
            AND SPS.SVC_PRC_SUN_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_SUN_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            <isEqual property="dayOfTheWeek" compareValue="2">
            AND SPS.SVC_PRC_MON_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_MON_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            <isEqual property="dayOfTheWeek" compareValue="3">
            AND SPS.SVC_PRC_TUE_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_TUE_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            <isEqual property="dayOfTheWeek" compareValue="4">
            AND SPS.SVC_PRC_WED_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_WED_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            <isEqual property="dayOfTheWeek" compareValue="5">
            AND SPS.SVC_PRC_THU_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_THU_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            <isEqual property="dayOfTheWeek" compareValue="6">
            AND SPS.SVC_PRC_FRI_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_FRI_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            <isEqual property="dayOfTheWeek" compareValue="7">
            AND SPS.SVC_PRC_SAT_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_SAT_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            <isEqual property="dayOfTheWeek" compareValue="0">
            AND SPS.SVC_PRC_HOL_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_HOL_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            AND SPS.EZCANCELFLAG               = '0'
    </statement>
    <statement id="getTempEttlLborFee" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             TED.LBOR_FEE_AMT   AS LBOR_FEE_AMT
        FROM
             TEMP_ETTL               TE
            ,TEMP_ETTL_DTL           TED
        WHERE
                TE.GLBL_CMPY_CD      = #glblCmpyCd#
            AND TE.TEMP_ETTL_NUM     = #tempEttlNum#
            AND TE.EZCANCELFLAG      = '0'
            AND TE.GLBL_CMPY_CD      = TED.GLBL_CMPY_CD
            AND TE.TEMP_ETTL_NUM     = TED.TEMP_ETTL_NUM
            AND TED.SVC_MACH_MSTR_PK = #svcMachMstrPk#
            AND TED.EZCANCELFLAG     = '0'
    </statement>
    <!-- END 2018/07/18 M.Naito [QC#13309,ADD] -->

    <!-- START 2018/12/04 K.Kitachi [QC#28635, ADD] -->
    <statement id="isExistSvcExclPrt" parameterClass="Map" resultClass="Map">
        <!-- START 2019/02/22 T.Tomita [QC#30413, MOD] -->
        SELECT
             A.SVC_EXCL_PRT_PK
            ,A.SVC_PRT_DISC_RATE
            ,A.SVC_PRT_DISC_AMT
        FROM
            SVC_EXCL_PRT A
        WHERE
                A.GLBL_CMPY_CD     = #glblCmpyCd#
            AND A.MDSE_CD          = #mdseCd#
            AND A.EZCANCELFLAG     = '0'
            AND A.EFF_FROM_DT               &lt;= #slsDt#
            AND NVL(A.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
            <!-- Item Level -->
            <isEqual property="checkLevel" compareValue="item">
            AND A.SVC_PGM_MDSE_CD  IS NULL
            AND A.MDL_GRP_ID       IS NULL
            AND A.MDL_ID           IS NULL
            AND A.SELL_TO_CUST_CD  IS NULL
            AND A.DS_CONTR_NUM     IS NULL
            AND A.SVC_MACH_MSTR_PK IS NULL
            </isEqual>
            <!-- Serial Level -->
            <isEqual property="checkLevel" compareValue="serial">
            AND A.SVC_MACH_MSTR_PK = #svcMachMstrPk#
            </isEqual>
            <!-- Contract Level -->
            <isEqual property="checkLevel" compareValue="contract">
            AND EXISTS (
                SELECT
                    1
                FROM
                    DS_CONTR X
                WHERE
                        A.GLBL_CMPY_CD     = X.GLBL_CMPY_CD
                    AND A.DS_CONTR_NUM     = X.DS_CONTR_NUM
                    AND X.DS_CONTR_PK      = #dsContrPk#
                    AND X.EZCANCELFLAG     = '0'
            )
            </isEqual>
            <!-- Customer Level -->
            <isEqual property="checkLevel" compareValue="customer">
            AND A.SELL_TO_CUST_CD  = #sellToCustCd#
            </isEqual>
            <!-- Model Level -->
            <isEqual property="checkLevel" compareValue="model">
            AND EXISTS (
                SELECT
                    1
                FROM
                    SVC_CONFIG_MSTR  X
                WHERE
                        A.GLBL_CMPY_CD     = X.GLBL_CMPY_CD
                    AND A.MDL_ID           = X.MDL_ID
                    AND X.SVC_MACH_MSTR_PK = #svcMachMstrPk#
                    AND X.EZCANCELFLAG     = '0'
            )
            </isEqual>
            <!-- Model Group Level -->
            <isEqual property="checkLevel" compareValue="modelGroup">
            AND EXISTS (
                SELECT
                    1
                FROM
                     DS_MDL          X
                    ,SVC_CONFIG_MSTR Y
                WHERE
                        A.GLBL_CMPY_CD     = X.GLBL_CMPY_CD
                    AND A.MDL_GRP_ID       = X.MDL_GRP_ID
                    AND X.EZCANCELFLAG     = '0'
                    AND X.GLBL_CMPY_CD     = Y.GLBL_CMPY_CD
                    AND X.MDL_ID           = Y.MDL_ID
                    AND Y.SVC_MACH_MSTR_PK = #svcMachMstrPk#
                    AND Y.EZCANCELFLAG     = '0'
            )
            </isEqual>
            <!-- Service Program Level -->
            <isEqual property="checkLevel" compareValue="serviceProgram">
            AND A.SVC_PGM_MDSE_CD  = #svcPgmMdseCd#
            </isEqual>
        ORDER BY
             A.EFF_FROM_DT
            ,A.SVC_PRT_DISC_RATE
            ,A.SVC_PRT_DISC_AMT
            ,A.SVC_EXCL_PRT_PK
        <!-- END   2019/02/22 T.Tomita [QC#30413, MOD] -->
    </statement>
    <!-- END 2018/12/04 K.Kitachi [QC#28635, ADD] -->
    <!-- START 2023/07/14 K.Watanabe [QC#61310, ADD] -->
    <statement id="getShowRoomMachineCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             SVC_MACH_MSTR SMM
            ,RTL_SWH       RS
        WHERE
                SMM.EZCANCELFLAG                = '0'
            AND SMM.GLBL_CMPY_CD                = #glblCmpyCd#
            AND SMM.SVC_MACH_TP_CD              = #svcMachTpCd#
            AND SMM.SVC_CONFIG_MSTR_PK          IS NOT NULL
            <iterate property="svcMachMstrStsCdList" var="svcMachMstrStsCd[]" open="AND SMM.SVC_MACH_MSTR_STS_CD IN (" close=")" conjunction=",">
                #svcMachMstrStsCd[]#
            </iterate>
            AND SMM.GLBL_CMPY_CD                = RS.GLBL_CMPY_CD
            AND SMM.SVC_MACH_MSTR_PK            = #svcMachMstrPk#
            AND SMM.CUR_LOC_NUM                 = RS.INVTY_LOC_CD
            AND RS.EZCANCELFLAG                 = '0'
            AND RS.RTL_WH_CATG_CD               = #rtlWhCatgCd#
            AND RS.EFF_FROM_DT                  &lt;= #startDt#
            AND NVL(RS.EFF_THRU_DT, #startDt#)  &gt;= #startDt#
    </statement>
    <!-- END 2023/07/14 K.Watanabe [QC#61310, ADD] -->
</sqlMap>
