<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NFAL0270Query">

    <typeAlias alias="NFAL0270CMsg"      type="business.blap.NFAL0270.NFAL0270CMsg"/>
    <typeAlias alias="NFAL0270_ASMsg"    type="business.blap.NFAL0270.NFAL0270_ASMsg"/>

    <statement id="getSvcInvChrgTpCdList" parameterClass="Map" resultClass="Map">
        SELECT
            SICT.SVC_INV_CHRG_TP_CD
            ,SICT.SVC_INV_CHRG_TP_DESC_TXT
        FROM
            SVC_INV_CHRG_TP SICT
        WHERE
            SICT.GLBL_CMPY_CD = #glblCmpyCd#
        AND SICT.SVC_INV_CHRG_TP_CD IN (#svcInvChrgTpCdBc#, #svcInvChrgTpCdMc#)
        AND SICT.EZCANCELFLAG = '0'
        ORDER BY SICT.SVC_INV_CHRG_TP_SORT_NUM
    </statement>
    <statement id="getAllocation" parameterClass="Map" resultClass="Map">
        SELECT
             MDL_GRP_ID
             ,MDL_GRP_NM
             ,SVC_INV_CHRG_TP_CD
             ,SVC_INV_CHRG_TP_DESC_TXT
             ,SVC_ALLOC_TP_CD
             ,SVC_ALLOC_TP_DESC_TXT
             ,EQUIP_ALLOC_PCT
             ,SVC_ALLOC_PCT
             ,SPLY_ALLOC_PCT
             ,EZUPTIME
             ,EZUPTIMEZONE
        FROM
             (
              SELECT
                  AIMGA.MDL_GRP_ID
                 ,DMG.MDL_GRP_NM
                 ,SICT.SVC_INV_CHRG_TP_CD
                 ,SICT.SVC_INV_CHRG_TP_DESC_TXT
                 ,SAT.SVC_ALLOC_TP_CD
                 ,SAT.SVC_ALLOC_TP_DESC_TXT
                 ,NVL(AIMGA.EQUIP_ALLOC_PCT, 0) AS EQUIP_ALLOC_PCT
                 ,NVL(AIMGA.SVC_ALLOC_PCT, 0) AS SVC_ALLOC_PCT
                 ,NVL(AIMGA.SPLY_ALLOC_PCT, 0) AS SPLY_ALLOC_PCT
                 ,AIMGA.EZUPTIME
                 ,AIMGA.EZUPTIMEZONE
              FROM
                 AJE_INV_MDL_GRP_ALLOC  AIMGA
                 ,DS_MDL_GRP             DMG
                 ,SVC_INV_CHRG_TP        SICT
                 ,SVC_ALLOC_TP           SAT
              WHERE
                 AIMGA.GLBL_CMPY_CD       = #glblCmpyCd#
              AND AIMGA.EZCANCELFLAG       = '0'
              <isNotNull property="mdlGrpId">
              AND AIMGA.MDL_GRP_ID         = #mdlGrpId#
              </isNotNull>
              AND AIMGA.GLBL_CMPY_CD       = DMG.GLBL_CMPY_CD
              AND AIMGA.MDL_GRP_ID         = DMG.MDL_GRP_ID
              <isNotNull property="mdlGrpNm">
              AND DMG.MDL_GRP_NM           LIKE #mdlGrpNm#
              </isNotNull>
              AND DMG.EZCANCELFLAG         = '0'
              AND AIMGA.GLBL_CMPY_CD       = SICT.GLBL_CMPY_CD
              AND AIMGA.SVC_INV_CHRG_TP_CD = SICT.SVC_INV_CHRG_TP_CD
              <isNotNull property="svcInvChrgTpCd">
              AND AIMGA.SVC_INV_CHRG_TP_CD = #svcInvChrgTpCd#
              </isNotNull>
              AND SICT.EZCANCELFLAG        = '0'
              AND AIMGA.GLBL_CMPY_CD       = SAT.GLBL_CMPY_CD
              AND AIMGA.SVC_ALLOC_TP_CD    = SAT.SVC_ALLOC_TP_CD
              <isNotNull property="svcAllocTpCd">
              AND AIMGA.SVC_ALLOC_TP_CD = #svcAllocTpCd#
              </isNotNull>
              AND SAT.EZCANCELFLAG         = '0'
              ORDER BY
                 AIMGA.MDL_GRP_ID
                 ,SICT.SVC_INV_CHRG_TP_SORT_NUM
                 ,SAT.SVC_ALLOC_TP_SORT_NUM
              )
        WHERE ROWNUM &lt;= #rowNum#
    </statement>
</sqlMap>
