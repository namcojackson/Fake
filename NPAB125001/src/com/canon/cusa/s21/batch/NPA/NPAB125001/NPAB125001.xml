<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NPAB125001">

    <!-- ==== Type Aliases ==== -->
    <typeAlias alias="ShpgSvcInfo"      type="com.canon.cusa.s21.batch.NPA.NPAB125001.ShpgSvcInfo"/>

    <!-- ==== Result Mapping ==== -->
    <resultMap id="result.ShpgSvcLeadTm"    class="ShpgSvcInfo">
        <result property="delyLeadAot" column="DELY_LEAD_AOT"  javaType="BigDecimal"/>
        <result property="shpgSvcTpCd" column="SHPG_SVC_TP_CD" javaType="String"/>
    </resultMap>

    <statement id="getLastUpdateTs" parameterClass="Map" resultClass="Map">
        SELECT
            DS_BIZ_PROC_LOG_PK
           ,DS_BIZ_LAST_UPD_TS
        FROM
            DS_BIZ_PROC_LOG DBPL
        WHERE 1=1
            AND GLBL_CMPY_CD       = #glblCmpyCd#
            AND DBPL.PROC_PGM_ID   = #procPgmId#
            AND DBPL.EZCANCELFLAG  = '0'
        ORDER BY 
            DS_BIZ_PROC_TRX_NUM
           ,DS_BIZ_PROC_TRX_DTL_NUM
           ,DS_BIZ_PROC_TRX_SUB_DTL_NUM
    </statement>

    <statement id="getBillToSellTo" parameterClass="Map" resultClass="Map">
        SELECT
            CSEV.BILL_TO_CUST_CD
           ,CSEV.SELL_TO_CUST_CD
        FROM
            CSA_TRD_PTNR_LOC_X_REF_V CXV
           ,CSA_SHIP_TO_CUST_V       CSHV
           ,CSA_SELL_TO_CUST_V       CSEV
        WHERE 1=1
        AND CXV.GLBL_CMPY_CD            = #cusaGlblCmpyCd#
            <iterate property="ediTrdPtnrCdList" var="ediTrdPtnrCd[]" open="AND CXV.EDI_TRD_PTNR_CD IN ( " close=")" conjunction=",">
                #ediTrdPtnrCd[]#
            </iterate>
        AND CXV.EDI_CUST_TP_CD          = #ediCustTpCd#
        AND CXV.EZCANCELFLAG            = '0'
        AND CXV.GLBL_CMPY_CD            = CSHV.GLBL_CMPY_CD
        AND CXV.SELL_TO_SHIP_TO_CUST_CD = CSHV.SHIP_TO_CUST_CD
        AND CSHV.EZCANCELFLAG           = '0'
        AND CSHV.GLBL_CMPY_CD           = CSEV.GLBL_CMPY_CD
        AND CSHV.SELL_TO_CUST_CD        = CSEV.SELL_TO_CUST_CD
        AND CSEV.EZCANCELFLAG           = '0'
    </statement>

    <statement id="searchSendAsnInfo" parameterClass="Map" resultClass="Map">
    SELECT
        *
    FROM (
            SELECT --+ driving_site(c)
                 C.GLBL_CMPY_CD
                ,C.REV_RECOG_METH_CD
                ,C.CUST_ISS_PO_NUM
                ,C.CPO_ORD_NUM
                ,C.CUST_ISS_PO_DT
                ,C.CPO_ORD_TP_CD
                ,CD.EDI_NUM
                ,CD.EDI_SUB_NUM
                ,CD.CPO_DTL_LINE_NUM
                ,CD.CPO_DTL_LINE_SUB_NUM
                ,SP.SHPG_STS_CD
                ,SP.ACTL_ARV_DT
                ,SP.SHPG_PLN_NUM
                ,SP.TRX_HDR_NUM
                ,SP.TRX_LINE_NUM
                ,SP.TRX_LINE_SUB_NUM
                ,SP.THIRD_PTY_INV_NUM
                ,SP.PO_REQ_FLG
                ,SP.SO_CLOSE_FLG
                ,SP.SET_MDSE_CD
                ,SP.SET_ITEM_SHIP_CPLT_FLG
                ,SP.SHIP_CPLT_CD
                ,SO.BILL_TO_CUST_CD
                ,SO.SELL_TO_CUST_CD
                ,SO.SHIP_TO_CUST_CD
                ,SO.SHPG_MODE_CD
                ,SO.SHPG_SVC_LVL_CD
                ,SO.FRT_CHRG_METH_CD
                ,SO.FRT_CHRG_TO_CD
                ,SO.EZUPTIME
                ,SC.SO_NUM
                ,SC.WH_CD
                ,SC.SHIP_DT_TM_TS
                <!-- START 2019/05/27 M.Naito [QC#50282,MOD] -->
                <!-- ,SC.TOT_FRT_AMT -->
                ,SCD.TOT_FRT_AMT
                <!-- END 2019/05/27 M.Naito [QC#50282,MOD] -->
                ,SC.TOT_SHIP_WT
                ,SCD.BOL_NUM
                ,SCD.FROM_STK_STS_CD
                ,SCD.MDSE_CD
                ,SCD.PRO_NUM
                ,SCD.SHIP_QTY
                ,SCD.SO_SLP_NUM
                ,SCD.TOT_FRT_AMT         AS TOT_FRT_AMT_DTL
                ,SCD.TOT_SHIP_WT         AS TOT_SHIP_WT_DTL
                ,SCD.VND_CD
                ,SCD.WH_CD               AS INVTY_LOC_CD
            FROM
                 CSA_CPO_V               C
                ,CSA_CPO_DTL_V           CD
                ,CSA_SHPG_PLN_V          SP
                ,CSA_SHPG_ORD_V          SO
                ,CSA_SHPG_ORD_CONF_V     SC
                ,CSA_SHPG_ORD_CONF_DTL_V SCD
            WHERE 1=1
            AND C.GLBL_CMPY_CD                  = #cusaGlblCmpyCd#
            <isNotNull property="modeDaily">
            AND C.OPEN_FLG                      = 'Y'
            </isNotNull>
                <iterate property="billToCustCdList" var="billToCustCd[]" open="AND C.BILL_TO_CUST_CD IN (" close=")" conjunction=",">
                        #billToCustCd[]#
                </iterate>
                <iterate property="sellToCustCdList" var="sellToCustCd[]" open="AND C.SELL_TO_CUST_CD IN (" close=")" conjunction=",">
                        #sellToCustCd[]#
                </iterate>
                
                <iterate property="shpgStsCdList" var="shpgStsCdList[]"   open="AND SP.SHPG_STS_CD IN (" close=")" conjunction=",">
                        #shpgStsCdList[]#
                </iterate>
            AND C.EZCANCELFLAG                  = '0'
            AND C.GLBL_CMPY_CD                  = CD.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM                   = CD.CPO_ORD_NUM
            AND CD.EZCANCELFLAG                 = '0'
            AND CD.GLBL_CMPY_CD                 = SP.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM                   = SP.TRX_HDR_NUM
            AND CD.CPO_DTL_LINE_NUM             = SP.TRX_LINE_NUM
            AND CD.CPO_DTL_LINE_SUB_NUM         = SP.TRX_LINE_SUB_NUM
            AND SP.TRX_LINE_SUB_NUM            != #trxLineSubNum#
            AND SP.TRX_SRC_TP_CD                = #trxSrcTpCd#
            AND SP.PO_REQ_FLG                   = #poReqFlg#
            AND SP.SO_CLOSE_FLG                 = #soCloseFlg#
            AND SP.EZCANCELFLAG                 = '0'
            AND SP.TRX_HDR_NUM                  = SO.TRX_HDR_NUM
            AND SP.SO_NUM                       = SO.SO_NUM
            AND SP.GLBL_CMPY_CD                 = SO.GLBL_CMPY_CD
            AND SO.ASN_REQ_FLG                  = #asnReqFlg#
            AND SO.TRX_SRC_TP_CD                = #trxSrcTpCd#
                <iterate property="billToCustCdList" var="billToCustCd[]" open="AND SO.BILL_TO_CUST_CD IN (" close=")" conjunction=",">
                        #billToCustCd[]#
                </iterate>
                <iterate property="sellToCustCdList" var="sellToCustCd[]" open="AND SO.SELL_TO_CUST_CD IN (" close=")" conjunction=",">
                        #sellToCustCd[]#
                </iterate>
            AND SO.EZCANCELFLAG                 = '0'
            AND SO.GLBL_CMPY_CD                 = SC.GLBL_CMPY_CD
            AND SO.SO_NUM                       = SC.SO_NUM
            AND SC.SO_PROC_STS_CD               = #soProcStsCd#
            AND SC.EZCANCELFLAG                 = '0'
            AND SC.GLBL_CMPY_CD                 = SCD.GLBL_CMPY_CD
            AND SC.SO_NUM                       = SCD.SO_NUM
            AND (SC.SHIP_DT_TM_TS             &gt;=  RPAD(#shipDtTmTs# ,14 ,0) OR SUBSTR(SC.EZUPTIME ,0 ,14) &gt;= RPAD(#shipDtTmTs# ,14 ,0))
            AND SCD.GLBL_CMPY_CD                = SP.GLBL_CMPY_CD
            AND SCD.SO_NUM                      = SP.SO_NUM
            AND SCD.SO_SLP_NUM                  = SP.SO_SLP_NUM
            AND SCD.WH_CD                       = SP.INVTY_LOC_CD
            AND SCD.MDSE_CD                     = SP.MDSE_CD
            AND SCD.EZCANCELFLAG                = '0'
            AND NOT EXISTS (
                           SELECT
                               'X'
                           FROM
                               EDI_ASN_HDR_WRK EAHW
                           WHERE 1=1
                           AND EAHW.GLBL_CMPY_CD      = #glblCmpyCd#
                           AND EAHW.ASN_SO_NUM        = SC.SO_NUM
                           AND EAHW.EZCANCELFLAG      = '0'
                         )
        )
        ORDER BY
            SO_NUM
           ,SO_SLP_NUM
    </statement>

    <statement id="getOrderInfoForVendor" parameterClass="Map">
    SELECT * FROM
        (
        SELECT --+ driving_site(c)
            C.GLBL_CMPY_CD             AS GLBL_CMPY_CD
          , C.REV_RECOG_METH_CD        AS REV_RECOG_METH_CD
          , C.CUST_ISS_PO_NUM          AS CUST_ISS_PO_NUM
          , C.CPO_ORD_NUM              AS CPO_ORD_NUM
          , C.CPO_ORD_TP_CD            AS CPO_ORD_TP_CD
          , C.CUST_ISS_PO_DT           AS CUST_ISS_PO_DT
          , C.BILL_TO_CUST_CD          AS BILL_TO_CUST_CD
          , C.SELL_TO_CUST_CD          AS SELL_TO_CUST_CD
          , CD.EDI_NUM                 AS EDI_NUM
          , CD.EDI_SUB_NUM             AS EDI_SUB_NUM
          , CD.CPO_DTL_LINE_NUM        AS CPO_DTL_LINE_NUM
          , CD.CPO_DTL_LINE_SUB_NUM    AS CPO_DTL_LINE_SUB_NUM
          , CD.SHPG_SVC_LVL_CD         AS SHPG_SVC_LVL_CD
          , CD.FRT_CHRG_TO_CD          AS FRT_CHRG_TO_CD
          , CD.FRT_CHRG_METH_CD        AS FRT_CHRG_METH_CD
          , CD.MDSE_CD                 AS MDSE_CD
          , SP.THIRD_PTY_INV_NUM       AS THIRD_PTY_INV_NUM
          , SP.ORD_QTY                 AS ORD_QTY
          , SP.ACTL_SHIP_DT            AS ACTL_SHIP_DT
          , SP.TRX_HDR_NUM             AS TRX_HDR_NUM
          , SP.TRX_LINE_NUM            AS TRX_LINE_NUM
          , SP.TRX_LINE_SUB_NUM        AS TRX_LINE_SUB_NUM
          , SP.PO_ORD_NUM              AS PO_ORD_NUM
          , SP.SHPG_PLN_NUM            AS SHPG_PLN_NUM
          , SP.PRO_NUM                 AS PRO_NUM
          , SP.CARR_CD                 AS VND_CD
          , SP.BOL_NUM                 AS BOL_NUM
          , SP.SET_ITEM_SHIP_CPLT_FLG  AS SET_ITEM_SHIP_CPLT_FLG
          , SP.SET_MDSE_CD             AS SET_MDSE_CD
          , SP.SHIP_TO_CUST_CD         AS SHIP_TO_CUST_CD
          , SP.SHPG_STS_CD             AS SHPG_STS_CD
          , SP.ACTL_ARV_DT             AS ACTL_ARV_DT
          , SP.STK_STS_CD              AS FROM_STK_STS_CD
          , IM.INVTY_CTRL_FLG          AS INVTY_CTRL_FLG
        FROM
            CSA_CPO_V       C
           ,CSA_CPO_DTL_V   CD
           ,CSA_SHPG_PLN_V  SP
           ,CSA_MDSE_ITEM_V IM
        WHERE 1=1
        AND C.GLBL_CMPY_CD          = #cusaGlblCmpyCd#
        AND C.OPEN_FLG                      = 'Y'
             <iterate property="billToCustCdList" var="billToCustCd[]" open="AND C.BILL_TO_CUST_CD IN (" close=")" conjunction=",">
                    #billToCustCd[]#
             </iterate>
             <iterate property="sellToCustCdList" var="sellToCustCd[]" open="AND C.SELL_TO_CUST_CD IN (" close=")" conjunction=",">
                    #sellToCustCd[]#
             </iterate>
        AND C.EZCANCELFLAG          = '0'
        AND C.GLBL_CMPY_CD          = CD.GLBL_CMPY_CD
        AND C.CPO_ORD_NUM           = CD.CPO_ORD_NUM
        AND CD.EZCANCELFLAG         = '0'
        AND CD.GLBL_CMPY_CD         = SP.GLBL_CMPY_CD
        AND C.CPO_ORD_NUM           = SP.TRX_HDR_NUM
        AND CD.CPO_DTL_LINE_NUM     = SP.TRX_LINE_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM = SP.TRX_LINE_SUB_NUM
        AND SP.TRX_SRC_TP_CD        = #trxSrcTpCd#
        AND SP.TRX_LINE_SUB_NUM    != #trxLineSubNum#
        AND SP.PO_REQ_FLG           = 'Y'
        AND SP.SO_CLOSE_FLG         = 'Y'
        <!-- START 2019/02/26 M.Naito [QC#30480,MOD] -->
        <!-- AND SP.ACTL_SHIP_DT         &gt;= #salesDate# -->
        AND SP.ACTL_SHIP_DT         &gt;= TO_CHAR(TO_DATE(#salesDate#, 'YYYYMMDD') - 7, 'YYYYMMDD')
        <!-- END 2019/02/26 M.Naito [QC#30480,MOD] -->
        AND SP.MDSE_CD              = IM.MDSE_CD
        AND SP.GLBL_CMPY_CD         = IM.GLBL_CMPY_CD
        AND IM.EZCANCELFLAG         = '0'
        <iterate property="shpgStsCdList" var="shpgStsCdList[]" open="AND SP.SHPG_STS_CD IN (" close=")" conjunction=",">
        #shpgStsCdList[]#
        </iterate>
        AND NOT EXISTS (
                           SELECT
                               'X'
                           FROM
                               EDI_ASN_HDR_WRK EAHW
                              ,EDI_ASN_DTL_WRK EADW
                           WHERE 1=1
                           AND EADW.GLBL_CMPY_CD      = #glblCmpyCd#
                           AND EADW.GLBL_CMPY_CD      = EAHW.GLBL_CMPY_CD
                           AND EADW.TRX_HDR_NUM       = SP.TRX_HDR_NUM
                           AND EADW.TRX_LINE_NUM      = SP.TRX_LINE_NUM
                           AND EADW.TRX_LINE_SUB_NUM  = SP.TRX_LINE_SUB_NUM
                           AND EADW.SHPG_PLN_NUM      = SP.SHPG_PLN_NUM
                           AND EADW.EZCANCELFLAG      = '0'
                           AND EAHW.ASN_SO_NUM        = EADW.ASN_SO_NUM
                           AND EAHW.TRX_HDR_NUM       = EADW.TRX_HDR_NUM
                           AND EAHW.EZCANCELFLAG      = '0'
                         )
        AND SP.EZCANCELFLAG         = '0'
    <isNotNull property="modeNight">
    UNION
        SELECT  --+ driving_site(c)
            C.GLBL_CMPY_CD             AS GLBL_CMPY_CD
          , C.REV_RECOG_METH_CD        AS REV_RECOG_METH_CD
          , C.CUST_ISS_PO_NUM          AS CUST_ISS_PO_NUM
          , C.CPO_ORD_NUM              AS CPO_ORD_NUM
          , C.CPO_ORD_TP_CD            AS CPO_ORD_TP_CD
          , C.CUST_ISS_PO_DT           AS CUST_ISS_PO_DT
          , C.BILL_TO_CUST_CD          AS BILL_TO_CUST_CD
          , C.SELL_TO_CUST_CD          AS SELL_TO_CUST_CD
          , CD.EDI_NUM                 AS EDI_NUM
          , CD.EDI_SUB_NUM             AS EDI_SUB_NUM
          , CD.CPO_DTL_LINE_NUM        AS CPO_DTL_LINE_NUM
          , CD.CPO_DTL_LINE_SUB_NUM    AS CPO_DTL_LINE_SUB_NUM
          , CD.SHPG_SVC_LVL_CD         AS SHPG_SVC_LVL_CD
          , CD.FRT_CHRG_TO_CD          AS FRT_CHRG_TO_CD
          , CD.FRT_CHRG_METH_CD        AS FRT_CHRG_METH_CD
          , CD.MDSE_CD                 AS MDSE_CD
          , SP.THIRD_PTY_INV_NUM       AS THIRD_PTY_INV_NUM
          , SP.ORD_QTY                 AS ORD_QTY
          , SP.ACTL_SHIP_DT            AS ACTL_SHIP_DT
          , SP.TRX_HDR_NUM             AS TRX_HDR_NUM
          , SP.TRX_LINE_NUM            AS TRX_LINE_NUM
          , SP.TRX_LINE_SUB_NUM        AS TRX_LINE_SUB_NUM
          , SP.PO_ORD_NUM              AS PO_ORD_NUM
          , SP.SHPG_PLN_NUM            AS SHPG_PLN_NUM
          , SP.PRO_NUM                 AS PRO_NUM
          , SP.CARR_CD                 AS VND_CD
          , SP.BOL_NUM                 AS BOL_NUM
          , SP.SET_ITEM_SHIP_CPLT_FLG  AS SET_ITEM_SHIP_CPLT_FLG
          , SP.SET_MDSE_CD             AS SET_MDSE_CD
          , SP.SHIP_TO_CUST_CD         AS SHIP_TO_CUST_CD
          , SP.SHPG_STS_CD             AS SHPG_STS_CD
          , SP.ACTL_ARV_DT             AS ACTL_ARV_DT
          , SP.STK_STS_CD              AS FROM_STK_STS_CD
          , IM.INVTY_CTRL_FLG          AS INVTY_CTRL_FLG
    FROM
        CSA_INV_V      I
       ,CSA_INV_LINE_V IL
       ,CSA_SHPG_PLN_V SP
       ,CSA_CPO_DTL_V  CD
       ,CSA_CPO_V      C
       ,CSA_MDSE_ITEM_V IM
    WHERE 1=1
        AND I.GLBL_CMPY_CD          = #cusaGlblCmpyCd#
             <iterate property="billToCustCdList" var="billToCustCd[]" open="AND I.BILL_TO_CUST_CD IN (" close=")" conjunction=",">
                    #billToCustCd[]#
             </iterate>
             <iterate property="sellToCustCdList" var="sellToCustCd[]" open="AND I.SELL_TO_CUST_CD IN (" close=")" conjunction=",">
                    #sellToCustCd[]#
             </iterate>
        AND I.INV_NUM               = IL.INV_NUM
        AND I.GLBL_CMPY_CD          = IL.GLBL_CMPY_CD
        AND I.INV_DT               &gt;= #salesDate#
        AND IL.SHPG_PLN_NUM         = SP.SHPG_PLN_NUM
        AND IL.GLBL_CMPY_CD         = SP.GLBL_CMPY_CD
        AND SP.TRX_SRC_TP_CD        = #trxSrcTpCd#
        AND SP.TRX_LINE_SUB_NUM    != #trxLineSubNum#
        AND SP.PO_REQ_FLG           = 'Y'
        AND SP.SO_CLOSE_FLG         = 'Y'
        AND SP.TRX_HDR_NUM          = CD.CPO_ORD_NUM
        AND SP.TRX_LINE_NUM         = CD.CPO_DTL_LINE_NUM
        AND SP.TRX_LINE_SUB_NUM     = CD.CPO_DTL_LINE_SUB_NUM
        AND SP.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM          = C.CPO_ORD_NUM
        AND I.EZCANCELFLAG          = '0'
        AND IL.EZCANCELFLAG         = '0'
        AND SP.EZCANCELFLAG         = '0'
        AND CD.EZCANCELFLAG         = '0'
        AND C.EZCANCELFLAG          = '0'
        AND SP.MDSE_CD              = IM.MDSE_CD
        AND SP.GLBL_CMPY_CD         = IM.GLBL_CMPY_CD
        AND IM.EZCANCELFLAG         = '0'
        AND NOT EXISTS (
                           SELECT
                               'X'
                           FROM
                               EDI_ASN_HDR_WRK EAHW
                              ,EDI_ASN_DTL_WRK EADW
                           WHERE 1=1
                           AND EADW.GLBL_CMPY_CD      = #glblCmpyCd#
                           AND EADW.GLBL_CMPY_CD      = EAHW.GLBL_CMPY_CD
                           AND EADW.TRX_HDR_NUM       = SP.TRX_HDR_NUM
                           AND EADW.TRX_LINE_NUM      = SP.TRX_LINE_NUM
                           AND EADW.TRX_LINE_SUB_NUM  = SP.TRX_LINE_SUB_NUM
                           AND EADW.SHPG_PLN_NUM      = SP.SHPG_PLN_NUM
                           AND EADW.EZCANCELFLAG      = '0'
                           AND EAHW.ASN_SO_NUM        = EADW.ASN_SO_NUM
                           AND EAHW.TRX_HDR_NUM       = EADW.TRX_HDR_NUM
                           AND EAHW.EZCANCELFLAG      = '0'
                         )
        AND SP.EZCANCELFLAG         = '0'
    </isNotNull>
        )
        ORDER BY
            TRX_HDR_NUM
           ,TRX_LINE_NUM
           ,TRX_LINE_SUB_NUM
    </statement>

    <statement id="getSetShipCpltDetail" parameterClass="Map" resultClass="Map">
        SELECT --+ driving_site(ccv)
            CCV.CPO_ORD_NUM
           ,CCV.CPO_HLD_FLG
           ,CCDV.CPO_DTL_LINE_NUM
           ,CCDV.CPO_DTL_LINE_SUB_NUM
           ,CCDV.CPO_DTL_HLD_FLG
           ,CSPV.SO_CLOSE_FLG
           ,CSPV.SHPG_STS_CD
           ,CSPV.PO_REQ_FLG
           ,CSPV.SHIP_PLN_HLD_FLG
           ,CSPV.SET_MDSE_CD
           ,CMIV.INVTY_CTRL_FLG
           ,CMIV.AUTO_LIC_ALLOC_FLG
           ,CMIV.MDSE_CD
        FROM
            CSA_CPO_V           CCV
           ,CSA_CPO_DTL_V       CCDV
           ,CSA_SHPG_PLN_V      CSPV
           ,CSA_ORD_TAKE_MDSE_V COTMV
           ,CSA_MDSE_ITEM_V     CMIV
        WHERE 1=1
        AND CCV.GLBL_CMPY_CD                 = #cusaGlblCmpyCd#
        AND CCV.CPO_ORD_NUM                  = #cpoOrdNum#
        AND CCV.GLBL_CMPY_CD                 = CCDV.GLBL_CMPY_CD
        AND CCV.CPO_ORD_NUM                  = CCDV.CPO_ORD_NUM
        AND CCV.EZCANCELFLAG                 = '0'
        AND CCDV.CPO_DTL_LINE_NUM            = #cpoDtlLineNum#
        AND CCDV.CPO_DTL_LINE_SUB_NUM       != #cpoDtlLineSubNum#
        AND CCDV.EZCANCELFLAG                = '0'
        AND CCDV.GLBL_CMPY_CD                = CSPV.GLBL_CMPY_CD
        AND CCDV.CPO_ORD_NUM                 = CSPV.TRX_HDR_NUM
        AND CCDV.CPO_DTL_LINE_NUM            = CSPV.TRX_LINE_NUM
        AND CCDV.CPO_DTL_LINE_SUB_NUM        = CSPV.TRX_LINE_SUB_NUM
        AND CSPV.SHPG_PLN_NUM               != #shpgPlnNum#
        AND CSPV.SET_SHPG_PLN_NUM           IN  
                (
                    SELECT
                        DECODE(TRX_LINE_SUB_NUM, #trxLineSubNum# , SHPG_PLN_NUM , SET_SHPG_PLN_NUM)
                    FROM
                        CSA_SHPG_PLN_V
                    WHERE 1=1
                    AND GLBL_CMPY_CD         = #cusaGlblCmpyCd#
                    AND SHPG_PLN_NUM         = #shpgPlnNum#
                    AND EZCANCELFLAG         = '0'
                    AND ROWNUM = 1
                 )
        AND CSPV.EZCANCELFLAG                    = '0'
        AND CSPV.GLBL_CMPY_CD                    = CMIV.GLBL_CMPY_CD
        AND NVL(COTMV.MDSE_CD, CSPV.MDSE_CD)     = CMIV.MDSE_CD
        AND CMIV.EZCANCELFLAG                    = '0'
        AND CSPV.GLBL_CMPY_CD                    = COTMV.GLBL_CMPY_CD(+)
        AND CSPV.MDSE_CD                         = COTMV.ORD_TAKE_MDSE_CD(+)
        AND COTMV.EZCANCELFLAG(+)                = '0'
    </statement>

     <statement id="getLakAssignedNum" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)
        FROM
            CSA_CPO_V      C
          , CSA_LAK_RPST_V LR
        WHERE 1=1
        AND C.GLBL_CMPY_CD  = #cusaGlblCmpyCd#
        AND C.CPO_ORD_NUM   = #cpoOrdNum#
        <isNotNull property="cpoOrdTpList">
            AND C.CPO_ORD_TP_CD NOT IN
              <iterate property="cpoOrdTpList" var="cpoOrdTp[]" open="(" close=" )" conjunction=",">
                  #cpoOrdTp[]#
              </iterate>
        </isNotNull>
        AND C.EZCANCELFLAG          = '0'
        AND C.CPO_ORD_NUM           = LR.CPO_ORD_NUM
        AND C.GLBL_CMPY_CD          = LR.GLBL_CMPY_CD
        AND LR.CPO_DTL_LINE_NUM     = #cpoDtlLineNum#
        AND LR.CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
        AND LR.MDSE_CD              = #mdseCd#
        AND LR.LAK_STS_CD           = #lakStsCd#
        AND LR.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getShippingOrderInfoForVendor" parameterClass="Map">
      SELECT
          SO.BILL_TO_CUST_CD
        , SO.SELL_TO_CUST_CD
        , SO.SHIP_TO_CUST_CD
        , SO.SHPG_MODE_CD
        , SC.SO_NUM
        , SO.EZUPTIME
        , SC.WH_CD
        , SC.SHIP_DT_TM_TS
        , SC.TOT_SHIP_WT
        <!-- START 2019/05/27 M.Naito [QC#50282,MOD] -->
        <!-- , SC.TOT_FRT_AMT -->
        , SCD.TOT_FRT_AMT
        <!-- END 2019/05/27 M.Naito [QC#50282,MOD] -->
        , SCD.SO_NUM
        , SCD.SO_SLP_NUM
        , SCD.WH_CD            AS INVTY_LOC_CD
        , SCD.PRO_NUM          AS CONF_DTL_PRO_NUM
        , SCD.VND_CD           AS CONF_DTL_VND_CD
        , SCD.BOL_NUM          AS CONF_DTL_BOL_NUM
        , SCD.MDSE_CD
        , SCD.SHIP_QTY
        , SCD.TOT_FRT_AMT      AS TOT_FRT_AMT_DTL
        , SCD.FROM_STK_STS_CD
        , SCD.TOT_SHIP_WT      AS TOT_SHIP_WT_DTL
        , SP.SET_MDSE_CD       AS SET_MDSE_CD
      FROM
          CSA_SHPG_ORD_V          SO
        , CSA_SHPG_ORD_DTL_V      SOD
        , CSA_SHPG_ORD_CONF_V     SC
        , CSA_SHPG_ORD_CONF_DTL_V SCD
        , CSA_SHPG_PLN_V          SP
      WHERE 1=1
        AND SO.GLBL_CMPY_CD      = #cusaGlblCmpyCd#
        AND SO.TRX_HDR_NUM       = #trxHdrNum#
        AND SO.ASN_REQ_FLG       = #asnReqFlg#
        AND SO.TRX_SRC_TP_CD     = #trxSrcTpCd#
            <iterate property="billToCustCdList" var="billToCustCd[]" open="AND SO.BILL_TO_CUST_CD IN (" close=")" conjunction=",">
                    #billToCustCd[]#
            </iterate>
            <iterate property="sellToCustCdList" var="sellToCustCd[]" open="AND SO.SELL_TO_CUST_CD IN (" close=")" conjunction=",">
                    #sellToCustCd[]#
            </iterate>
        AND SO.EZCANCELFLAG      = '0'
        AND SO.GLBL_CMPY_CD      = SOD.GLBL_CMPY_CD
        AND SO.SO_NUM            = SOD.SO_NUM
        AND SOD.TRX_HDR_NUM      = #trxHdrNum#
        AND SOD.TRX_LINE_NUM     = #trxLineNum#
        AND SOD.TRX_LINE_SUB_NUM = #trxLineSubNum#
        AND SCD.MDSE_CD          = #mdseCd#
        AND SOD.SHIP_QTY         = #shipQty#
        AND SOD.EZCANCELFLAG     = '0'
        AND SO.GLBL_CMPY_CD      = SC.GLBL_CMPY_CD
        AND SO.SO_NUM            = SC.SO_NUM
        AND SC.SO_PROC_STS_CD    = #soProcSts#
        AND NOT EXISTS
                    ( 
                       SELECT
                           'X' 
                       FROM
                           EDI_ASN_HDR_WRK
                       WHERE 1=1
                       AND EZCANCELFLAG = '0'
                       AND GLBL_CMPY_CD = #glblCmpyCd#
                       AND ASN_SO_NUM   = SC.SO_NUM
                       AND EZCANCELFLAG = '0'
                     )
        AND SC.EZCANCELFLAG       = '0'
        AND SC.GLBL_CMPY_CD       = SCD.GLBL_CMPY_CD
        AND SC.SO_NUM             = SCD.SO_NUM
        AND SCD.EZCANCELFLAG      = '0'
        AND SOD.SO_NUM            = SCD.SO_NUM
        AND SOD.SO_SLP_NUM        = SCD.SO_SLP_NUM
        AND SOD.TRX_HDR_NUM       = SP.TRX_HDR_NUM
        AND SOD.TRX_LINE_NUM      = SP.TRX_LINE_NUM
        AND SOD.TRX_LINE_SUB_NUM  = SP.TRX_LINE_SUB_NUM
        AND SOD.GLBL_CMPY_CD      = SP.GLBL_CMPY_CD
        AND SP.EZCANCELFLAG       = '0'
        ORDER BY
            SCD.EZINTIME
          , SCD.SO_NUM
          , SCD.SO_SLP_NUM
    </statement>

    <statement id="getRevenueRecognitionMethodCode" parameterClass="Map" resultClass="Map">
      SELECT
          SHPG_STS_CD 
      FROM
          CSA_REV_RECOG_SHPG_STS_V
      WHERE 1=1
      AND GLBL_CMPY_CD      = #cusaGlblCmpyCd#
      AND REV_RECOG_METH_CD = #revRecogMethCd#
      AND EZCANCELFLAG      = '0'
      ORDER BY
          REV_RECOG_METH_SORT_NUM
    </statement>

    <statement id="getSerialInformation" parameterClass="Map" resultClass="Map">
      SELECT
         GLBL_CMPY_CD
        ,MDSE_CD
        ,SO_NUM
        ,SO_SER_ID
        ,WH_CD
        ,SER_NUM
        ,SER_TAKE_DT_TM_TS
        ,SO_SLP_NUM
      FROM
          CSA_SHIP_SER_NUM_V
      WHERE 1=1
      AND GLBL_CMPY_CD = #cusaGlblCmpyCd#
      AND SO_NUM       = #soNum#
      AND SO_SLP_NUM   = #soSlpNum#
      AND EZCANCELFLAG = '0'
      ORDER BY SER_NUM
    </statement>

    <statement id="getLatestWarehouseEstimatedTimeOfArrivalDate" parameterClass="Map" resultClass="String">
          SELECT
              RH.LTST_WH_IN_ETA_DT
          FROM
              CSA_RWS_HDR_V   RH
             ,CSA_INVTY_TRX_V IT
          WHERE 1=1
          AND RH.GLBL_CMPY_CD    = #cusaGlblCmpyCd#
           <isNotNull property="rwsRefNum">
          AND RH.RWS_REF_NUM     = #rwsRefNum#
           </isNotNull>
          AND RH.FROM_LOC_CD     = #fromLocCd#
          AND RH.EZCANCELFLAG    = '0'
          AND RH.GLBL_CMPY_CD    = IT.GLBL_CMPY_CD
          AND RH.RWS_NUM         = IT.RWS_NUM
          AND RH.RWS_REF_NUM     = IT.RWS_REF_NUM
          AND IT.TRX_CD          = #trxCd#
          AND IT.TRX_RSN_CD      = #trxRsnCd#
          AND IT.INVTY_TRX_DT    = #invtyTrxDt#
          AND IT.MDSE_CD         = #mdseCd#
          AND IT.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getSerialInformationForVendor" parameterClass="Map" resultClass="Map">
       SELECT
          PSN.GLBL_CMPY_CD
         ,PSN.MDSE_CD
         ,PSN.SER_NUM
         ,SUBSTR(PSN.SER_EVENT_TS , 0 , 14 ) AS SER_EVENT_TS
         ,PSN.FROM_LOC_CD
         ,ROW_ID                             AS ROW_ID
         ,PSN.PO_SER_NUM_PK
       FROM (
              SELECT
                  ROWNUM AS ROW_ID,
                  T.*
              FROM
                 (
                     SELECT
                          P.GLBL_CMPY_CD
                         ,P.MDSE_CD
                         ,P.SER_NUM
                         ,P.SER_EVENT_TS
                         ,P.FROM_LOC_CD
                         ,P.PO_SER_NUM_PK
                         ,P.KEY_INFO_CD_01
                         ,P.KEY_INFO_CD_02
                         ,P.KEY_INFO_CD_03
                      FROM
                      CSA_PO_SER_NUM_V  P
                      WHERE 1=1
                      AND P.GLBL_CMPY_CD   = #cusaGlblCmpyCd#
                      <isNotNull property="poOrdNum">
                      AND P.KEY_INFO_CD_04 = #poOrdNum#
                      </isNotNull>
                      AND P.KEY_INFO_CD_01 = #trxHdrNum#
                      AND P.KEY_INFO_CD_02 = #trxLineNum#
                      AND P.KEY_INFO_CD_03 = #trxLineSubNum#
                      AND P.EZCANCELFLAG   = '0'
                      ORDER BY
                          P.EZINTIME,
                          P.KEY_INFO_CD_08
                  ) T
           ) PSN
       WHERE 1=1
       AND NOT EXISTS (
                          SELECT 
                              *
                          FROM 
                              EDI_ASN_SER_NUM_WRK
                          WHERE 1=1
                          AND GLBL_CMPY_CD      = #glblCmpyCd#
                          AND MDSE_CD           = PSN.MDSE_CD
                          AND SER_NUM           = PSN.SER_NUM
                          AND TRX_HDR_NUM       = PSN.KEY_INFO_CD_01
                          AND TRX_LINE_NUM      = PSN.KEY_INFO_CD_02
                          AND TRX_LINE_SUB_NUM  = PSN.KEY_INFO_CD_03
                          AND EZCANCELFLAG      = '0'
                      )
       ORDER BY
           PSN.SER_NUM
    </statement>

    <statement id="getMinShpgModeCd" parameterClass="Map" resultClass="String">
        SELECT
            SHPG_MODE_CD
        FROM
            CSA_SHPG_SVC_V
        WHERE 1=1
        AND GLBL_CMPY_CD     = #cusaGlblCmpyCd#
        AND SHPG_SVC_LVL_CD  = #shpgSvcLvlCd#
        AND FRT_CHRG_TO_CD   = #frtChrgToCd#
        AND FRT_CHRG_METH_CD = #frtChrgMethCd#
        AND EZCANCELFLAG     = '0'
        AND ROWNUM = 1
    </statement>

    <statement id="getShpgModeCdListFromShpgWt" parameterClass="Map" resultClass="Map">
        SELECT
            SHPG_MODE_CD
        FROM
            CSA_SHPG_WT_V
        WHERE 1=1
        AND GLBL_CMPY_CD     = #cusaGlblCmpyCd#
        AND FRT_CHRG_TO_CD   = #frtChrgToCd#
        AND FRT_CHRG_METH_CD = #frtChrgMethCd#
        AND TO_DATE(NVL(EFF_FROM_DT , '19000101'), 'YYYY/MM/DD')  &lt; = TO_DATE(#slsDate# , 'YYYY/MM/DD' )
        AND TO_DATE(NVL(EFF_THRU_DT , '99991231'), 'YYYY/MM/DD')  &gt; = TO_DATE(#slsDate# , 'YYYY/MM/DD' )
        AND EZCANCELFLAG     = '0'
    </statement>

    <statement id="getShpgSvcLeadTm" parameterClass="Map" resultMap="result.ShpgSvcLeadTm">
        SELECT
           SLT.DELY_LEAD_AOT
          ,SSL.SHPG_SVC_TP_CD
        FROM
           CSA_SHPG_SVC_LEAD_TM_V SLT
          ,CSA_SHPG_SVC_LVL_V     SSL
        WHERE 1=1
        AND SLT.GLBL_CMPY_CD    = #cusaGlblCmpyCd#
        AND SLT.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
        AND SLT.EZCANCELFLAG    = '0'
        AND SLT.GLBL_CMPY_CD    = SSL.GLBL_CMPY_CD
        AND SLT.SHPG_SVC_LVL_CD = SSL.SHPG_SVC_LVL_CD
        AND SSL.EZCANCELFLAG    = '0'
    </statement>

   <statement id="getTrnspLt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            TL.TRNSP_LT_AOT
        FROM
            CSA_TRNSP_LT_V TL
        WHERE 1=1
        AND TL.GLBL_CMPY_CD     = #cusaGlblCmpyCd#
        AND TL.WH_CD            = #whCd#
        AND TL.ST_CD            = #shipToStCd#
        AND TL.SHPG_MODE_CD     = #shpgModeCd#
        AND TL.FROM_ZIP_CD  &lt;= #shipToPostCd#
        AND TL.TO_ZIP_CD    &gt;= #shipToPostCd#
        AND TO_DATE(NVL(TL.EFF_FROM_DT , '19000101'), 'YYYY/MM/DD')  &lt; = TO_DATE(#slsDate# , 'YYYY/MM/DD' )
        AND TO_DATE(NVL(TL.EFF_THRU_DT , '99991231'), 'YYYY/MM/DD')  &gt; = TO_DATE(#slsDate# , 'YYYY/MM/DD' )
        AND TL.EZCANCELFLAG     ='0'
    </statement>

    <statement id="getAreaLeadTm" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            ALT.DELY_LEAD_AOT
        FROM
            CSA_AREA_LEAD_TM_V ALT
        WHERE 1=1
        AND ALT.GLBL_CMPY_CD     = #cusaGlblCmpyCd#
        AND ALT.WH_CD            = #whCd#
        AND ALT.ST_CD            = #shipToStCd#
        AND ALT.SHPG_MODE_CD     = #shpgModeCd#
        AND TO_DATE(NVL(ALT.EFF_FROM_DT , '19000101'), 'YYYY/MM/DD')  &lt; = TO_DATE(#slsDate# , 'YYYY/MM/DD' )
        AND TO_DATE(NVL(ALT.EFF_THRU_DT , '99991231'), 'YYYY/MM/DD')  &gt; = TO_DATE(#slsDate# , 'YYYY/MM/DD' )
        AND ALT.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getSellToCustCd" parameterClass="Map" resultClass="Map">
        SELECT
            P_CODE_CUST_SOLD_TO
        FROM
            CSA_PRT_EDI_TRD_PTNR_V
        WHERE 1=1
        <iterate property="trdPtnrCdList" var="trdPtnrCd[]" open="AND P_CODE_TP IN (" close=")" conjunction=",">
            #trdPtnrCd[]#
        </iterate>
        AND EZCANCELFLAG             = '0'
    </statement>

    <statement id="searchSendAsnInfoForPartsHdr" parameterClass="Map" resultClass="Map">
        SELECT
            H.P_NUM_SO
        FROM
            CSA_PRT_SO_HDR_V H
        WHERE 1=1
        AND H.P_CODE_STAT_SO      IN(#pCodeStatSo#, #pCodeStatInv#)
        <iterate property="pCodeCustSoldToList" var="pCodeCustSoldTo[]" open="AND H.P_CODE_CUST_SOLD_TO IN (" close=")" conjunction=",">
            #pCodeCustSoldTo[]#
        </iterate>
        AND H.P_CODE_TRANSACT     = #pCodeTransact#
        AND NOT EXISTS
            (
                SELECT
                    'X'
                FROM
                    EDI_ASN_HDR_WRK
                WHERE 1=1
                AND EZCANCELFLAG = '0'
                AND GLBL_CMPY_CD = #glblCmpyCd#
                AND H.P_NUM_SO   = ASN_SO_NUM 
            )
        AND H.EZUPTIME         &gt; #ezUptime#
        AND H.EZCANCELFLAG        = '0'
        ORDER BY
            P_NUM_SO
    </statement>

    <statement id="searchSendAsnInfoForParts" parameterClass="Map" resultClass="Map">
        SELECT
            H.P_AMT_INVO_FRT
           ,H.P_CODE_CUST_SHIP_TO
           ,H.P_CODE_CUST_SOLD_TO
           ,H.P_CODE_STAT_SO
           ,H.P_CODE_WH_SHIP
           ,H.P_DATE_SHIP_PRSS
           ,H.P_NUM_FEDX_CONTROL
           ,H.P_NUM_INVOICE
           ,H.P_NUM_SO
           ,H.P_NUM_TRUCKER
           ,H.P_WEIGHT_POUNDS
           ,H.P_WEIGHT_OUNCES
           ,H.P_WEIGHT_HALF_OUNCES
           ,H.P_WEIGHT_POUNDS +  ROUND ((P_WEIGHT_OUNCES + CASE P_WEIGHT_HALF_OUNCES  WHEN 1 THEN 0.5 ELSE 0 END ) / 16 , 3 )  AS TOT_SHIP_WT
           ,H.EZUPTIME
           ,H.P_CODE_CUST_CHRG_TO
           ,D.P_NUM_CUST_PO
<!-- START 2019/08/28 T.Ogura [QC#52892,MOD] -->
<!--       ,D.P_PARTS_NUM -->
           ,TRIM(D.P_PARTS_NUM) AS P_PARTS_NUM
<!-- END   2019/08/28 T.Ogura [QC#52892,MOD] -->
           ,D.P_QTY_SHIP
           ,CP.P_PARTS_NUM
           ,CP.P_CUST_PART_NUM
         --,CASE WHEN CP.P_PARTS_NUM = CP.P_CUST_PART_NUM THEN 'N' ELSE 'Y' END AS P_MDSE_CD_UPD_FLG
           ,CASE WHEN (
                        SELECT 
                              PD.ASL_MDSE_CD
                        FROM 
                              PO_DTL PD
                        WHERE 1=1
                        AND   PD.PO_ORD_NUM          = D.P_NUM_CUST_PO
                        AND   PD.PO_ORD_DTL_LINE_NUM = CP.P_NUM_LINE
                        AND   PD.EZCANCELFLAG        = '0'
                        AND   PD.GLBL_CMPY_CD        = #glblCmpyCd#
                       ) =   CP.P_PARTS_NUM THEN 'N' ELSE 'Y' END AS P_MDSE_CD_UPD_FLG
           <!-- START 2019/02/21 M.Naito [QC#30311,ADD] -->
           ,CP.P_NUM_LINE
           <!-- END 2019/02/21 M.Naito [QC#30311,ADD] -->
           <!-- START 2021/04/16 QC#58256 -->
           ,H.P_CODE_SHIP_VIA
           <!-- END 2021/04/16 QC#58256 -->
        FROM
            CSA_PRT_SO_HDR_V       H
           ,CSA_PRT_SO_DTL_V       D
           ,CSA_PRT_CUST_CPO_DTL_V CP
           ,CSA_PRT_CPO_DTL_V      CD
        WHERE 1=1
        AND H.P_CODE_STAT_SO      IN(#pCodeStatSo#, #pCodeStatInv#)
        <iterate property="pCodeCustSoldToList" var="pCodeCustSoldTo[]" open="AND H.P_CODE_CUST_SOLD_TO IN (" close=")" conjunction=",">
            #pCodeCustSoldTo[]#
        </iterate>
        AND H.P_CODE_TRANSACT     = #pCodeTransact#
        AND H.P_NUM_SO            = #pNumSo#
        AND NOT EXISTS
            (
                SELECT
                    'X'
                FROM
                    EDI_ASN_HDR_WRK
                WHERE 1=1
                AND EZCANCELFLAG = '0'
                AND GLBL_CMPY_CD = #glblCmpyCd#
                AND H.P_NUM_SO   = ASN_SO_NUM 
            ) 
         AND H.EZUPTIME         &gt; #ezUptime#
        AND H.EZCANCELFLAG         = '0'
        AND H.P_NUM_SO             = D.P_NUM_SO
        AND D.P_QTY_SHIP       &gt; #pQtyShip#
        AND D.EZCANCELFLAG         = '0'
        AND D.P_NUM_ORDR           = CD.P_NUM_ORDR
        AND D.P_PARTS_NUM          = CD.P_PARTS_NUM
        AND CD.EZCANCELFLAG        = '0'
        AND CP.P_NUM_CUST_PO       = D.P_NUM_CUST_PO 
        AND CP.P_CODE_CUST_SHIP_TO = D.P_CODE_CUST_SHIP_TO
        AND (CP.P_PARTS_NUM         = D.P_PARTS_NUM OR CP.P_PARTS_NUM = CD.P_PARTS_NUM_ORIG)
        AND CP.EZCANCELFLAG        = '0'
        ORDER BY
            P_NUM_SO
            <!-- START 2019/05/27 M.Naito [QC#50282,MOD] -->
            ,P_NUM_LINE
            <!-- END 2019/05/27 M.Naito [QC#50282,MOD] -->
    </statement>
    
    <statement id="checkVendorDropShip" parameterClass="Map" resultClass="String">
        SELECT
            P_DUMMY_WH
        FROM
            CSA_PRT_WH_V
        WHERE 1=1
        AND P_CODE_WH      = #pCodeWh#
        AND EZCANCELFLAG   = '0'
        AND ROWNUM         = 1
    </statement>

    <statement id="getVendorInvoice" parameterClass="Map" resultClass="String">
        SELECT
            D.P_NUM_INVO_VENDR
        FROM
            CSA_PRT_VND_XREF_V    H
           ,CSA_PRT_VND_INV_DTL_V D
        WHERE 1=1
        AND H.P_NUM_CUST_PO       = #pNumCustPo#
        AND H.P_CODE_CUST_SHIP_TO = #pCodeCustShipTo#
        AND H.EZCANCELFLAG        = '0'
        AND H.P_NUM_PO_PARTS      = D.P_NUM_PO_PARTS
        <!-- START 2019/08/30 [QC#52892,MOD] -->
        <!-- AND D.P_PARTS_NUM         = #pPartsNum# -->
        AND TRIM(D.P_PARTS_NUM)   = #pPartsNum#
        <!-- END 2019/08/30 [QC#52892,MOD] -->
        AND D.EZCANCELFLAG        = '0'
        AND ROWNUM = 1
    </statement>

    <statement id="getVendorInvoiceExists" parameterClass="Map" resultClass="String">
        SELECT
            D.P_NUM_INVO_VENDR
        FROM
            CSA_PRT_VND_XREF_V    H
           ,CSA_PRT_VND_INV_DTL_V D
        WHERE 1=1
        AND H.P_NUM_CUST_PO       = #pNumCustPo#
        AND H.P_CODE_CUST_SHIP_TO = #pCodeCustShipTo#
        AND H.EZCANCELFLAG        = '0'
        AND H.P_NUM_PO_PARTS      = D.P_NUM_PO_PARTS
        <!-- START 2019/08/30 [QC#52892,MOD] -->
        <!-- AND D.P_PARTS_NUM         = #pPartsNum# -->
        AND TRIM(D.P_PARTS_NUM)   = #pPartsNum#
        <!-- END 2019/08/30 [QC#52892,MOD] -->
        AND D.P_QTY_STOCK_IN      = #pQtyShip#
        AND D.EZCANCELFLAG        = '0'
        AND NOT EXISTS(
            SELECT
                1
            FROM
                EDI_ASN_HDR_WRK EAHW
               ,EDI_ASN_DTL_WRK EADW
            WHERE
                EAHW.EZCANCELFLAG  = '0'
            AND EADW.EZCANCELFLAG  = '0'
            AND EAHW.GLBL_CMPY_CD  = #glblCmpyCd#
            AND D.P_NUM_INVO_VENDR = EAHW.SHIP_FROM_SO_NUM
            AND H.P_NUM_CUST_PO    = EAHW.EDI_PO_ORD_NUM
            AND EAHW.GLBL_CMPY_CD  = EADW.GLBL_CMPY_CD
            AND EAHW.ASN_SO_NUM    = EADW.ASN_SO_NUM
            <!-- START 2019/08/30 [QC#52892,MOD] -->
            <!-- AND D.P_PARTS_NUM      = EADW.ASN_MDSE_CD -->
            AND TRIM(D.P_PARTS_NUM) = EADW.ASN_MDSE_CD
            <!-- END 2019/08/30 [QC#52892,MOD] -->
            AND D.P_QTY_STOCK_IN   = EADW.ASN_QTY
        )
        ORDER BY
            D.P_NUM_INVO_VENDR
    </statement>

    <statement id="searchCsaCpoDtl" parameterClass="Map" resultClass="String">
        SELECT
            EDI_NUM
        FROM
            CSA_CPO_DTL_V
        WHERE 1=1
        AND GLBL_CMPY_CD         = #cusaGlblCmpyCd#
        AND CPO_ORD_NUM          = #cpoOrdNum#
        AND CPO_DTL_LINE_NUM     = #cpoDtlLineNum#
        AND CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
        AND EZCANCELFLAG         = '0'
        AND ROWNUM = 1
    </statement>

    <statement id="searchPoOrdDtlLineNum" parameterClass="Map" resultClass="String">
        SELECT
            PO_ORD_DTL_LINE_NUM
           --,ASL_MDSE_CD
        FROM
            PO_DTL
        WHERE 1=1
        AND GLBL_CMPY_CD         = #glblCmpyCd#
        AND PO_ORD_NUM           = #poOrdNum#
         <isNotNull property="poOrdDtlLineNum">
        AND PO_ORD_DTL_LINE_NUM  = #poOrdDtlLineNum#
        </isNotNull>
         <isNull property="poOrdDtlLineNum">
        AND PO_ORD_DTL_LINE_NUM  IS NULL
        </isNull>
        AND EZCANCELFLAG         = '0'
        AND ROWNUM = 1
    </statement>

    <statement id="searchAslMdseCd" parameterClass="Map" resultClass="Map">
        SELECT
            ASL_MDSE_CD
           ,PO_ORD_DTL_LINE_NUM
        FROM
            PO_DTL
        WHERE 1=1
        AND GLBL_CMPY_CD             = #glblCmpyCd#
        AND PO_ORD_NUM               = #poOrdNum#
        AND SET_PO_ORD_DTL_LINE_NUM  = #setPoOrdDtlLineNum#
        AND EZCANCELFLAG             = '0'
    </statement>

    <statement id="searcOrdTakeMdse" parameterClass="Map" resultClass="String">
        SELECT
            ORD_TAKE_MDSE_CD
        FROM
            CSA_ORD_TAKE_MDSE_V
        WHERE 1=1
        AND GLBL_CMPY_CD             = #cusaGlblCmpyCd#
        AND ORD_TAKE_MDSE_CD         = #ordTakeMdseCd#
        AND EZCANCELFLAG             = '0'
        AND ROWNUM = 1
    </statement>

    <statement id="itemChangeCheck" parameterClass="Map" resultClass="String">
    SELECT
        ASL_MDSE_CD
    FROM
        PO_DTL DPD
    WHERE 1=1
    AND DPD.GLBL_CMPY_CD        = #glblCmpyCd#
    AND DPD.PO_ORD_NUM          = #poOrdNum#
    <isNotNull property="poOrdDtlLineNum">
    AND DPD.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
    </isNotNull>
    <isNull property="poOrdDtlLineNum">
    AND DPD.PO_ORD_DTL_LINE_NUM is NULL
    </isNull>
    AND DPD.EZCANCELFLAG        = '0'
    AND ROWNUM                  = 1
    </statement>

    <statement id="searchCsaCalRelnV" parameterClass="Map" resultClass="Map">
        SELECT
            GLBL_CMPY_CD
           ,CAL_SUB_TP_CD
           ,CAL_MULT_CD
           ,CAL_MULT_DESC_TXT
           ,CAL_TP_CD
        FROM
            CSA_CAL_RELN_V
        WHERE 1=1
        AND GLBL_CMPY_CD    = #cusaGlblCmpyCd#
        AND CAL_SUB_TP_CD   = #calSubTpCd#
        AND CAL_MULT_CD     = #calMultCd#
        AND EZCANCELFLAG    = '0'
        AND ROWNUM = 1
    </statement>

    <statement id="searchCsaShpgOrdCustDtlV" parameterClass="Map" resultClass="Map">
        SELECT
             GLBL_CMPY_CD
            ,SO_NUM
            ,SO_CUST_DATA_TP_CD
            ,SO_CUST_LINE_LOC_NM_01
            ,SO_CUST_LINE_LOC_NM_02
            ,SO_CUST_LINE_ADDR_01
            ,SO_CUST_LINE_ADDR_02
            ,SO_CUST_LINE_ADDR_03
            ,SO_CUST_LINE_ADDR_04
            ,CTAC_PTNR_PSN_NM
            ,CTRY_CD
            ,ST_CD
            ,CTY_ADDR
            ,CTAC_PTNR_PSN_TEL_NUM
            ,POST_CD
        FROM
            CSA_SHPG_ORD_CUST_DTL_V
        WHERE 1=1
        AND GLBL_CMPY_CD        = #cusaGlblCmpyCd#
        AND SO_NUM              = #soNum#
        AND SO_CUST_DATA_TP_CD  = #soCustDataTpCd#
        AND EZCANCELFLAG        = '0'
        AND ROWNUM = 1
    </statement>

    <statement id="searchCsaMdseItemV" parameterClass="Map" resultClass="Map">
        SELECT
            ETA_DAYS_AOT
        FROM
            CSA_MDSE_ITEM_V
        WHERE 1=1
        AND GLBL_CMPY_CD  = #cusaGlblCmpyCd#
        AND MDSE_CD       = #mdseCd#
        AND EZCANCELFLAG  = '0'
        AND ROWNUM        = 1
    </statement>

    <statement id="getIntangibleAsnRecordListForWh" parameterClass="Map" resultClass="Map">
        SELECT --+ driving_site(c)
            C.GLBL_CMPY_CD            AS GLBL_CMPY_CD
           ,C.CUST_ISS_PO_NUM         AS CUST_ISS_PO_NUM
           ,C.CPO_ORD_NUM             AS CPO_ORD_NUM
           ,C.CUST_ISS_PO_DT          AS CUST_ISS_PO_DT
           ,C.CPO_ORD_TP_CD           AS CPO_ORD_TP_CD
           ,C.REV_RECOG_METH_CD       AS REV_RECOG_METH_CD
           ,CD.EDI_NUM                AS EDI_NUM
           ,CD.EDI_SUB_NUM            AS EDI_SUB_NUM
           ,CD.CPO_DTL_LINE_NUM       AS CPO_DTL_LINE_NUM
           ,CD.CPO_DTL_LINE_SUB_NUM   AS CPO_DTL_LINE_SUB_NUM
           ,CD.MDSE_CD                AS MDSE_CD
           ,SP.SHPG_STS_CD            AS SHPG_STS_CD
           ,SP.ACTL_ARV_DT            AS ACTL_ARV_DT
           ,SP.SHPG_PLN_NUM           AS SHPG_PLN_NUM
           ,SP.TRX_HDR_NUM            AS TRX_HDR_NUM
           ,SP.TRX_LINE_NUM           AS TRX_LINE_NUM
           ,SP.TRX_LINE_SUB_NUM       AS TRX_LINE_SUB_NUM
           ,SP.THIRD_PTY_INV_NUM      AS THIRD_PTY_INV_NUM
           ,SP.PO_REQ_FLG             AS PO_REQ_FLG
           ,SP.SO_CLOSE_FLG           AS SO_CLOSE_FLG
           ,SP.ORD_QTY                AS ORD_QTY
           ,SP.SHIP_CPLT_CD           AS SHIP_CPLT_CD
           ,SP.SET_MDSE_CD            AS SET_MDSE_CD
           ,SP.SET_ITEM_SHIP_CPLT_FLG AS SET_ITEM_SHIP_CPLT_FLG
           ,null                      AS BILL_TO_CUST_CD
           ,null                      AS SELL_TO_CUST_CD
           ,null                      AS SHIP_TO_CUST_CD
           ,null                      AS SHPG_MODE_CD
           ,null                      AS SHPG_SVC_LVL_CD
           ,null                      AS FRT_CHRG_METH_CD
           ,null                      AS FRT_CHRG_TO_CD
           ,null                      AS EZUPTIME
           ,null                      AS WH_CD
           ,#shipDtTmTs#              AS SHIP_DT_TM_TS
           ,'0'                       AS TOT_SHIP_WT
           ,'0'                       AS TOT_FRT_AMT
           ,#soNum#                   AS SO_NUM
           ,#soSlpNum#                AS SO_SLP_NUM
           ,null                      AS PRO_NUM
           ,null                      AS VND_CD
           ,null                      AS BOL_NUM
           ,NVL(SP.ORD_QTY,0)         AS SHIP_QTY
           ,'1'                       AS FROM_STK_STS_CD
           ,IM.AUTO_LIC_ALLOC_FLG     AS AUTO_LIC_ALLOC_FLG
           ,null                      AS TOT_FRT_AMT_DTL
           ,null                      AS TOT_SHIP_WT_DTL
           ,null                      AS INVTY_LOC_CD
        FROM
            CSA_CPO_V       C
           ,CSA_CPO_DTL_V   CD
           ,CSA_SHPG_PLN_V  SP
           ,CSA_MDSE_ITEM_V IM
           ,MDSE            MD
        WHERE 1 = 1
        AND C.GLBL_CMPY_CD          = #cusaGlblCmpyCd#
        AND C.CPO_ORD_NUM           = #cpoOrdNum#
        AND C.CPO_HLD_FLG           = 'N'
        AND C.EZCANCELFLAG          = '0'
        AND C.GLBL_CMPY_CD          = CD.GLBL_CMPY_CD
        AND C.CPO_ORD_NUM           = CD.CPO_ORD_NUM
        AND CD.EZCANCELFLAG         = '0'
        AND CD.CPO_DTL_HLD_FLG      = 'N'
        AND CD.GLBL_CMPY_CD         = SP.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM          = SP.TRX_HDR_NUM
        AND CD.CPO_DTL_LINE_NUM     = SP.TRX_LINE_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM = SP.TRX_LINE_SUB_NUM
        AND SP.TRX_SRC_TP_CD        = #trxSrcTpCd#
        AND SP.SET_MDSE_CD          IS NULL
        <iterate property="shpgStsCdList" var="shpgStsCdList[]"   open="AND SP.SHPG_STS_CD IN (" close=")" conjunction=",">
                #shpgStsCdList[]#
        </iterate>
        <isNotNull property="shipCpltCd">
        AND SP.SHIP_CPLT_CD         = #shipCpltCd#
        </isNotNull>
        <isNull property="shipCpltCd">
        AND SP.SHIP_CPLT_CD         IS NULL
        </isNull>
        AND SP.SHIP_PLN_CANC_FLG    = 'N'
        AND SP.PO_REQ_FLG           = 'N'
        AND SP.EZCANCELFLAG         = '0'
        AND SP.SHIP_PLN_HLD_FLG     = 'N'
        <!-- START 2022/05/30 R.Azucena [QC#60119, MOD] -->
        <!-- AND SP.MDSE_CD              = MD.MDSE_CD -->
        AND CD.CUST_MDSE_CD         = MD.MDSE_CD
        <!-- END 2022/05/30 R.Azucena [QC#60119, MOD] -->
        AND MD.GLBL_CMPY_CD         = #glblCmpyCd#
        AND MD.INVTY_CTRL_FLG       = 'Y'
        AND MD.EZCANCELFLAG         = '0'
        AND CD.MDSE_CD              = IM.MDSE_CD
        AND IM.INVTY_CTRL_FLG       = 'N'
        <!-- START 2022/05/30 R.Azucena [QC#60119, ADD] -->
        AND IM.GLBL_CMPY_CD         = #glblCmpyCd#
        AND IM.EZCANCELFLAG         = '0'
        <!-- END 2022/05/30 R.Azucena [QC#60119, ADD] -->
        AND NOT EXISTS(
                        SELECT
                            *
                        FROM
                            EDI_ASN_HDR_WRK EAHW
                           ,EDI_ASN_DTL_WRK EADW
                        WHERE 1 = 1
                        AND EADW.GLBL_CMPY_CD      = #glblCmpyCd#
                        AND EADW.TRX_HDR_NUM       = SP.TRX_HDR_NUM
                        AND EADW.TRX_LINE_NUM      = SP.TRX_LINE_NUM
                        AND EADW.TRX_LINE_SUB_NUM  = SP.TRX_LINE_SUB_NUM
                        AND EADW.SHPG_PLN_NUM      = SP.SHPG_PLN_NUM
                        AND EADW.EZCANCELFLAG      = '0'
                        AND EADW.GLBL_CMPY_CD      = EAHW.GLBL_CMPY_CD
                        AND EADW.ASN_SO_NUM        = EAHW.ASN_SO_NUM
                        AND EADW.TRX_HDR_NUM       = EAHW.TRX_HDR_NUM
                        AND EAHW.EZCANCELFLAG      = '0'
                       )
        ORDER BY
            SP.SO_NUM
           ,SP.SO_SLP_NUM
    </statement>

    <statement id="checkLakAssingn" parameterClass="Map" resultClass="String">
    SELECT
         COUNT(*) AS LAK_QTY
    FROM
         CSA_CPO_V       CPO
        ,CSA_LAK_RPST_V  LAK
    WHERE 1 = 1
    AND CPO.GLBL_CMPY_CD          = #cusaGlblCmpyCd#
    AND CPO.CPO_ORD_NUM           = #cpoOrdNum#
    AND CPO.EZCANCELFLAG          = '0'
    <iterate property="cpoOrdTpCdList" var="cpoOrdTpCdList[]"   open="AND CPO.CPO_ORD_TP_CD NOT IN (" close=")" conjunction=",">
          #cpoOrdTpCdList[]#
    </iterate>
    AND CPO.GLBL_CMPY_CD          = LAK.GLBL_CMPY_CD
    AND CPO.CPO_ORD_NUM           = LAK.CPO_ORD_NUM
    AND LAK.CPO_DTL_LINE_NUM      = #cpoDtlLineNum#
    AND LAK.CPO_DTL_LINE_SUB_NUM  = #cpoDtlLineSubNum#
    AND LAK.MDSE_CD               = #mdseCd#
    AND LAK.LAK_STS_CD            = #lakStsCd#
    AND LAK.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getIntangibleAsnRecordSetCompListForWh" parameterClass="Map" resultClass="Map">
        SELECT --+ driving_site(c)
            C.GLBL_CMPY_CD            AS GLBL_CMPY_CD
           ,C.CUST_ISS_PO_NUM         AS CUST_ISS_PO_NUM
           ,C.CPO_ORD_NUM             AS CPO_ORD_NUM
           ,C.CUST_ISS_PO_DT          AS CUST_ISS_PO_DT
           ,C.CPO_ORD_TP_CD           AS CPO_ORD_TP_CD
           ,C.REV_RECOG_METH_CD       AS REV_RECOG_METH_CD
           ,CD.EDI_NUM                AS EDI_NUM
           ,CD.EDI_SUB_NUM            AS EDI_SUB_NUM
           ,CD.CPO_DTL_LINE_NUM       AS CPO_DTL_LINE_NUM
           ,CD.CPO_DTL_LINE_SUB_NUM   AS CPO_DTL_LINE_SUB_NUM
           ,CD.MDSE_CD                AS MDSE_CD
           ,SP.SHPG_STS_CD            AS SHPG_STS_CD
           ,SP.ACTL_ARV_DT            AS ACTL_ARV_DT
           ,SP.SHPG_PLN_NUM           AS SHPG_PLN_NUM
           ,SP.TRX_HDR_NUM            AS TRX_HDR_NUM
           ,SP.TRX_LINE_NUM           AS TRX_LINE_NUM
           ,SP.TRX_LINE_SUB_NUM       AS TRX_LINE_SUB_NUM
           ,SP.THIRD_PTY_INV_NUM      AS THIRD_PTY_INV_NUM
           ,SP.PO_REQ_FLG             AS PO_REQ_FLG
           ,SP.SO_CLOSE_FLG           AS SO_CLOSE_FLG
           ,SP.ORD_QTY                AS ORD_QTY
           ,SP.SHIP_CPLT_CD           AS SHIP_CPLT_CD
           ,SP.SET_MDSE_CD            AS SET_MDSE_CD
           ,SP.SET_ITEM_SHIP_CPLT_FLG AS SET_ITEM_SHIP_CPLT_FLG
           ,null                      AS BILL_TO_CUST_CD
           ,null                      AS SELL_TO_CUST_CD
           ,null                      AS SHIP_TO_CUST_CD
           ,null                      AS SHPG_MODE_CD
           ,null                      AS SHPG_SVC_LVL_CD
           ,null                      AS FRT_CHRG_METH_CD
           ,null                      AS FRT_CHRG_TO_CD
           ,null                      AS EZUPTIME
           ,null                      AS WH_CD
           ,#shipDtTmTs#              AS SHIP_DT_TM_TS
           ,'0'                       AS TOT_SHIP_WT
           ,'0'                       AS TOT_FRT_AMT
           ,#soNum#                   AS SO_NUM
           ,#soSlpNum#                AS SO_SLP_NUM
           ,null                      AS PRO_NUM
           ,null                      AS VND_CD
           ,null                      AS BOL_NUM
           ,NVL(SP.ORD_QTY,0)         AS SHIP_QTY
           ,'1'                       AS FROM_STK_STS_CD
           ,M.AUTO_LIC_ALLOC_FLG      AS AUTO_LIC_ALLOC_FLG
           ,null                      AS TOT_FRT_AMT_DTL
           ,null                      AS TOT_SHIP_WT_DTL
           ,null                      AS INVTY_LOC_CD
        FROM
            CSA_CPO_V           C
           ,CSA_CPO_DTL_V       CD
           ,CSA_SHPG_PLN_V      SP
           ,CSA_ORD_TAKE_MDSE_V OTM
           ,CSA_MDSE_ITEM_V     M
           ,MDSE                MD
        WHERE 1=1
        AND C.GLBL_CMPY_CD              = #cusaGlblCmpyCd#
        AND C.CPO_ORD_NUM               = #cpoOrdNum#
        AND C.CPO_HLD_FLG               = 'N'
        AND C.EZCANCELFLAG              = '0'
        AND C.GLBL_CMPY_CD              = CD.GLBL_CMPY_CD
        AND C.CPO_ORD_NUM               = CD.CPO_ORD_NUM
        AND CD.CPO_DTL_LINE_NUM         = #cpoDtlLineNum#
        AND CD.CPO_DTL_LINE_SUB_NUM    != #cpoDtlLineSubNum#
        AND CD.CPO_DTL_HLD_FLG          = 'N'
        AND CD.EZCANCELFLAG             = '0'
        AND CD.GLBL_CMPY_CD             = SP.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM              = SP.TRX_HDR_NUM
        AND CD.CPO_DTL_LINE_NUM         = SP.TRX_LINE_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM     = SP.TRX_LINE_SUB_NUM
        AND SP.SHPG_PLN_NUM            != #shpgPlnNum#
        AND SP.SHIP_PLN_HLD_FLG         = 'N'
        AND SP.SET_SHPG_PLN_NUM IN 
            (
                SELECT
                    DECODE(SP2.TRX_LINE_SUB_NUM,'000',SP2.SHPG_PLN_NUM,SP2.SET_SHPG_PLN_NUM)
                FROM
                    CSA_SHPG_PLN_V SP2
                WHERE 1 = 1
                AND SP2.GLBL_CMPY_CD           = #cusaGlblCmpyCd#
                AND SP2.SHPG_PLN_NUM           = #shpgPlnNum#
                AND SP2.EZCANCELFLAG           = '0'
            )
        AND NOT EXISTS(
                        SELECT
                            *
                        FROM
                            EDI_ASN_HDR_WRK EAHW
                           ,EDI_ASN_DTL_WRK EADW
                        WHERE 1 = 1
                        AND EADW.GLBL_CMPY_CD      = #glblCmpyCd#
                        AND EADW.TRX_HDR_NUM       = SP.TRX_HDR_NUM
                        AND EADW.TRX_LINE_NUM      = SP.TRX_LINE_NUM
                        AND EADW.TRX_LINE_SUB_NUM  = SP.TRX_LINE_SUB_NUM
                        AND EADW.SHPG_PLN_NUM      = SP.SHPG_PLN_NUM
                        AND EADW.EZCANCELFLAG      = '0'
                        AND EADW.GLBL_CMPY_CD      = EAHW.GLBL_CMPY_CD
                        AND EADW.ASN_SO_NUM        = EAHW.ASN_SO_NUM
                        AND EADW.TRX_HDR_NUM       = EAHW.TRX_HDR_NUM
                        AND EAHW.EZCANCELFLAG      = '0'
                       )
        AND SP.EZCANCELFLAG             = '0'
        AND SP.GLBL_CMPY_CD             = OTM.GLBL_CMPY_CD(+)
        AND SP.MDSE_CD                  = OTM.ORD_TAKE_MDSE_CD(+)
        <iterate property="shpgStsCdList" var="shpgStsCdList[]"   open="AND SP.SHPG_STS_CD IN (" close=")" conjunction=",">
                #shpgStsCdList[]#
        </iterate>
        AND OTM.EZCANCELFLAG(+)         = '0'
        AND SP.GLBL_CMPY_CD             = M.GLBL_CMPY_CD
        AND NVL(OTM.MDSE_CD,SP.MDSE_CD) = M.MDSE_CD
        AND M.INVTY_CTRL_FLG            = 'N'
        AND M.EZCANCELFLAG              = '0'
        <!-- START 2022/05/30 R.Azucena [QC#60119, MOD] -->
        <!-- AND SP.MDSE_CD                  = MD.MDSE_CD -->
        AND CD.CUST_MDSE_CD             = MD.MDSE_CD
        <!-- END 2022/05/30 R.Azucena [QC#60119, MOD] -->
        AND MD.GLBL_CMPY_CD             = #glblCmpyCd#
        AND MD.EZCANCELFLAG             = '0'
        AND MD.INVTY_CTRL_FLG           = 'Y'
    </statement>

    <statement id="getIntangibleOnlyAsnRecordList" parameterClass="Map" resultClass="Map">
    SELECT
         MAIN.*
        ,MIN(MAIN.LAK_QTY) OVER(PARTITION BY MAIN.CPO_ORD_NUM) MIN_LAK_QTY
    FROM
      (
          SELECT --+ driving_site(c)
            C.GLBL_CMPY_CD            AS GLBL_CMPY_CD
           ,C.CUST_ISS_PO_NUM         AS CUST_ISS_PO_NUM
           ,C.CPO_ORD_NUM             AS CPO_ORD_NUM
           ,C.CUST_ISS_PO_DT          AS CUST_ISS_PO_DT
           ,C.CPO_ORD_TP_CD           AS CPO_ORD_TP_CD
           ,C.REV_RECOG_METH_CD       AS REV_RECOG_METH_CD
           ,CD.EDI_NUM                AS EDI_NUM
           ,CD.EDI_SUB_NUM            AS EDI_SUB_NUM
           ,CD.CPO_DTL_LINE_NUM       AS CPO_DTL_LINE_NUM
           ,CD.CPO_DTL_LINE_SUB_NUM   AS CPO_DTL_LINE_SUB_NUM
           ,CD.MDSE_CD                AS MDSE_CD
           <!-- QC#52580 Add Start -->
           ,CASE WHEN CD.SET_MDSE_CD IS NULL THEN 'N' ELSE 'Y' END AS SET_FLG
           <!-- QC#52580 Add End -->
           ,SP.SHPG_STS_CD            AS SHPG_STS_CD
           ,SP.ACTL_ARV_DT            AS ACTL_ARV_DT
           ,SP.SHPG_PLN_NUM           AS SHPG_PLN_NUM
           ,SP.TRX_HDR_NUM            AS TRX_HDR_NUM
           ,SP.TRX_LINE_NUM           AS TRX_LINE_NUM
           ,SP.TRX_LINE_SUB_NUM       AS TRX_LINE_SUB_NUM
           ,SP.THIRD_PTY_INV_NUM      AS THIRD_PTY_INV_NUM
           ,SP.PO_REQ_FLG             AS PO_REQ_FLG
           ,SP.SO_CLOSE_FLG           AS SO_CLOSE_FLG
           ,SP.ORD_QTY                AS ORD_QTY
           ,SP.SHIP_CPLT_CD           AS SHIP_CPLT_CD
           ,SP.SET_MDSE_CD            AS SET_MDSE_CD
           ,SP.SET_ITEM_SHIP_CPLT_FLG AS SET_ITEM_SHIP_CPLT_FLG
           ,SP.SET_SHPG_PLN_NUM       AS SET_SHPG_PLN_NUM
           ,null                      AS BILL_TO_CUST_CD
           ,null                      AS SELL_TO_CUST_CD
           ,null                      AS SHIP_TO_CUST_CD
           ,null                      AS SHPG_MODE_CD
           ,null                      AS SHPG_SVC_LVL_CD
           ,null                      AS FRT_CHRG_METH_CD
           ,null                      AS FRT_CHRG_TO_CD
           ,null                      AS EZUPTIME
           ,null                      AS WH_CD
           ,RPAD(#salesDate#,14,0)    AS SHIP_DT_TM_TS
           ,'0'                       AS TOT_SHIP_WT
           ,'0'                       AS TOT_FRT_AMT
           ,null                      AS SO_NUM
           ,null                      AS SO_SLP_NUM
           ,null                      AS PRO_NUM
           ,null                      AS VND_CD
           ,null                      AS BOL_NUM
           ,NVL(SP.ORD_QTY,0)         AS SHIP_QTY
           ,'1'                       AS FROM_STK_STS_CD
           ,IM.AUTO_LIC_ALLOC_FLG     AS AUTO_LIC_ALLOC_FLG
           ,null                      AS TOT_FRT_AMT_DTL
           ,null                      AS TOT_SHIP_WT_DTL
           ,null                      AS INVTY_LOC_CD
           ,CASE WHEN IM.AUTO_LIC_ALLOC_FLG = 'N' THEN 1
                 ELSE ( SELECT
                          COUNT(GLBL_CMPY_CD)
                      FROM
                          CSA_LAK_RPST_V LAK
                      WHERE
                          <iterate property="cpoOrdTpCdList" var="cpoOrdTpCdList[]"   open="C.CPO_ORD_TP_CD NOT IN (" close=")" conjunction=",">
                          #cpoOrdTpCdList[]#
                          </iterate>
                      AND LAK.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
                      AND C.CPO_ORD_NUM           = LAK.CPO_ORD_NUM
                      AND CD.CPO_DTL_LINE_NUM     = LAK.CPO_DTL_LINE_NUM
                      AND CD.CPO_DTL_LINE_SUB_NUM = LAK.CPO_DTL_LINE_SUB_NUM
                      AND CD.MDSE_CD              = LAK.MDSE_CD
                      AND LAK.LAK_STS_CD          = 'U'
                      AND LAK.EZCANCELFLAG        = '0'
                    )
            END                       AS LAK_QTY
           ,CASE WHEN SP.SET_SHPG_PLN_NUM IS NULL THEN #shpgStsCdShip#
                 ELSE ( 
                      SELECT
                           NVL(MIN(SP2.SHPG_STS_CD), #shpgStsCdShip#)
                      FROM
                           CSA_SHPG_PLN_V SP2
                          ,CSA_MDSE_ITEM_V IM2
                      WHERE
                          SP2.GLBL_CMPY_CD        = SP.GLBL_CMPY_CD
                      AND SP2.SET_SHPG_PLN_NUM    = SP.SET_SHPG_PLN_NUM
                      AND SP2.EZCANCELFLAG        = '0'
                      AND SP2.MDSE_CD             = IM2.MDSE_CD
                      AND SP2.GLBL_CMPY_CD        = IM2.GLBL_CMPY_CD
                      AND IM2.EZCANCELFLAG        = '0'
                      AND IM2.INVTY_CTRL_FLG      = 'Y'
                    )
            END                       AS SET_SHIP_STS_CD
       FROM
           CSA_CPO_V       C
          ,CSA_CPO_DTL_V   CD
          ,CSA_SHPG_PLN_V  SP
          ,CSA_MDSE_ITEM_V IM
          ,MDSE            MD
       WHERE 1 = 1
        AND C.GLBL_CMPY_CD              = #cusaGlblCmpyCd#
        AND C.EZCANCELFLAG              = '0'
        AND C.CPO_HLD_FLG               = 'N'
        AND C.OPEN_FLG                  = 'Y'
        AND C.CPO_ORD_NUM               = CD.CPO_ORD_NUM
        AND C.GLBL_CMPY_CD              = CD.GLBL_CMPY_CD
        AND CD.EZCANCELFLAG             = '0'
        AND CD.GLBL_CMPY_CD             = SP.GLBL_CMPY_CD
        AND C.CPO_ORD_NUM               = SP.TRX_HDR_NUM
        AND CD.CPO_DTL_LINE_NUM         = SP.TRX_LINE_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM     = SP.TRX_LINE_SUB_NUM
        AND CD.CPO_DTL_HLD_FLG          = 'N'
        AND SP.TRX_SRC_TP_CD            = #trxSrcTpCd#
        AND SP.TRX_LINE_SUB_NUM        != #trxLineSubNum#
        AND SP.INVTY_LOC_CD              IS NULL
        AND SP.PO_REQ_FLG               = 'N'
        AND SP.SHIP_PLN_CANC_FLG        = 'N'
        AND SP.SHIP_PLN_HLD_FLG         = 'N'
        AND SP.EZCANCELFLAG             = '0'

        <iterate property="billToCustCdList" var="billToCustCd[]" open="AND C.BILL_TO_CUST_CD IN (" close=")" conjunction=",">
                #billToCustCd[]#
        </iterate>

        <iterate property="sellToCustCdList" var="sellToCustCd[]" open="AND C.SELL_TO_CUST_CD IN (" close=")" conjunction=",">
                #sellToCustCd[]#
        </iterate>

        <iterate property="shpgStsCdList" var="shpgStsCdList[]"   open="AND SP.SHPG_STS_CD IN (" close=")" conjunction=",">
                #shpgStsCdList[]#
        </iterate>

        AND SP.MDSE_CD                  = IM.MDSE_CD
        AND SP.GLBL_CMPY_CD             = IM.GLBL_CMPY_CD
        AND IM.EZCANCELFLAG             = '0'
        AND IM.INVTY_CTRL_FLG           = 'N'
        <!-- START 2022/05/30 R.Azucena [QC#60119, MOD] -->
        <!-- AND SP.MDSE_CD                  = MD.MDSE_CD -->
        AND CD.CUST_MDSE_CD             = MD.MDSE_CD
        <!-- END 2022/05/30 R.Azucena [QC#60119, MOD] -->
        AND MD.GLBL_CMPY_CD             = #glblCmpyCd#
        AND MD.EZCANCELFLAG             = '0'
        AND MD.INVTY_CTRL_FLG           = 'Y'
        AND NOT EXISTS(
                        SELECT
                            *
                        FROM
                            EDI_ASN_HDR_WRK EAHW
                           ,EDI_ASN_DTL_WRK EADW
                        WHERE 1 = 1
                        AND EADW.GLBL_CMPY_CD      = #glblCmpyCd#
                        AND EADW.TRX_HDR_NUM       = SP.TRX_HDR_NUM
                        AND EADW.TRX_LINE_NUM      = SP.TRX_LINE_NUM
                        AND EADW.TRX_LINE_SUB_NUM  = SP.TRX_LINE_SUB_NUM
                        AND EADW.SHPG_PLN_NUM      = SP.SHPG_PLN_NUM
                        AND EADW.EZCANCELFLAG      = '0'
                        AND EADW.GLBL_CMPY_CD      = EAHW.GLBL_CMPY_CD
                        AND EADW.ASN_SO_NUM        = EAHW.ASN_SO_NUM
                        AND EADW.TRX_HDR_NUM       = EAHW.TRX_HDR_NUM
                        AND EAHW.EZCANCELFLAG      = '0'
                       )
       AND NOT EXISTS(
                        SELECT
                            *
                        FROM
                            CSA_SHPG_PLN_V  SP2
                           ,CSA_MDSE_ITEM_V IM2
                        WHERE 1 = 1
                        AND C.GLBL_CMPY_CD        = SP2.GLBL_CMPY_CD
                        AND C.CPO_ORD_NUM         = SP2.TRX_HDR_NUM
                        AND SP2.EZCANCELFLAG      = '0'
                        AND SP2.SHIP_PLN_CANC_FLG = 'N'
                        AND SP2.SO_CLOSE_FLG      = 'N'
                        AND SP2.GLBL_CMPY_CD      = IM2.GLBL_CMPY_CD
                        AND SP2.MDSE_CD           = IM2.MDSE_CD
                        AND IM2.EZCANCELFLAG      = '0'
                        AND IM2.INVTY_CTRL_FLG    = 'Y'
                        <!-- QC#52580 Mod Start -->
                        <!-- AND SP2.SHIP_CPLT_CD      = SP.SHIP_CPLT_CD -->
                        AND NVL(SP2.SHIP_CPLT_CD, 'NULL') = NVL(SP.SHIP_CPLT_CD, 'NULL')
                        <!-- QC#52580 Mod End -->
                      )
    <isNotNull property="modeNight">
    UNION
       SELECT --+ driving_site(c)
            C.GLBL_CMPY_CD            AS GLBL_CMPY_CD
           ,C.CUST_ISS_PO_NUM         AS CUST_ISS_PO_NUM
           ,C.CPO_ORD_NUM             AS CPO_ORD_NUM
           ,C.CUST_ISS_PO_DT          AS CUST_ISS_PO_DT
           ,C.CPO_ORD_TP_CD           AS CPO_ORD_TP_CD
           ,C.REV_RECOG_METH_CD       AS REV_RECOG_METH_CD
           ,CD.EDI_NUM                AS EDI_NUM
           ,CD.EDI_SUB_NUM            AS EDI_SUB_NUM
           ,CD.CPO_DTL_LINE_NUM       AS CPO_DTL_LINE_NUM
           ,CD.CPO_DTL_LINE_SUB_NUM   AS CPO_DTL_LINE_SUB_NUM
           ,CD.MDSE_CD                AS MDSE_CD
           <!-- QC#52580 Add Start -->
           ,CASE WHEN CD.SET_MDSE_CD IS NULL THEN 'N' ELSE 'Y' END AS SET_FLG
           <!-- QC#52580 Add End -->
           ,SP.SHPG_STS_CD            AS SHPG_STS_CD
           ,SP.ACTL_ARV_DT            AS ACTL_ARV_DT
           ,SP.SHPG_PLN_NUM           AS SHPG_PLN_NUM
           ,SP.TRX_HDR_NUM            AS TRX_HDR_NUM
           ,SP.TRX_LINE_NUM           AS TRX_LINE_NUM
           ,SP.TRX_LINE_SUB_NUM       AS TRX_LINE_SUB_NUM
           ,SP.THIRD_PTY_INV_NUM      AS THIRD_PTY_INV_NUM
           ,SP.PO_REQ_FLG             AS PO_REQ_FLG
           ,SP.SO_CLOSE_FLG           AS SO_CLOSE_FLG
           ,SP.ORD_QTY                AS ORD_QTY
           ,SP.SHIP_CPLT_CD           AS SHIP_CPLT_CD
           ,SP.SET_MDSE_CD            AS SET_MDSE_CD
           ,SP.SET_ITEM_SHIP_CPLT_FLG AS SET_ITEM_SHIP_CPLT_FLG
           ,SP.SET_SHPG_PLN_NUM       AS SET_SHPG_PLN_NUM
           ,null                      AS BILL_TO_CUST_CD
           ,null                      AS SELL_TO_CUST_CD
           ,null                      AS SHIP_TO_CUST_CD
           ,null                      AS SHPG_MODE_CD
           ,null                      AS SHPG_SVC_LVL_CD
           ,null                      AS FRT_CHRG_METH_CD
           ,null                      AS FRT_CHRG_TO_CD
           ,null                      AS EZUPTIME
           ,null                      AS WH_CD
           ,RPAD(#salesDate#,14,0)    AS SHIP_DT_TM_TS
           ,'0'                       AS TOT_SHIP_WT
           ,'0'                       AS TOT_FRT_AMT
           ,null                      AS SO_NUM
           ,null                      AS SO_SLP_NUM
           ,null                      AS PRO_NUM
           ,null                      AS VND_CD
           ,null                      AS BOL_NUM
           ,NVL(SP.ORD_QTY,0)         AS SHIP_QTY
           ,'1'                       AS FROM_STK_STS_CD
           ,IM.AUTO_LIC_ALLOC_FLG     AS AUTO_LIC_ALLOC_FLG
           ,null                      AS TOT_FRT_AMT_DTL
           ,null                      AS TOT_SHIP_WT_DTL
           ,null                      AS INVTY_LOC_CD
           ,CASE WHEN IM.AUTO_LIC_ALLOC_FLG = 'N' THEN 1
                 ELSE ( SELECT
                          COUNT(GLBL_CMPY_CD)
                      FROM
                          CSA_LAK_RPST_V LAK
                      WHERE
                          <iterate property="cpoOrdTpCdList" var="cpoOrdTpCdList[]"   open="C.CPO_ORD_TP_CD NOT IN (" close=")" conjunction=",">
                          #cpoOrdTpCdList[]#
                          </iterate>
                      AND LAK.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
                      AND C.CPO_ORD_NUM           = LAK.CPO_ORD_NUM
                      AND CD.CPO_DTL_LINE_NUM     = LAK.CPO_DTL_LINE_NUM
                      AND CD.CPO_DTL_LINE_SUB_NUM = LAK.CPO_DTL_LINE_SUB_NUM
                      AND CD.MDSE_CD              = LAK.MDSE_CD
                      AND LAK.LAK_STS_CD          = 'U'
                      AND LAK.EZCANCELFLAG        = '0'
                    )
            END                       AS LAK_QTY
            ,CASE WHEN SP.SET_SHPG_PLN_NUM IS NULL THEN #shpgStsCdShip#
                 ELSE ( 
                      SELECT
                           NVL(MIN(SP2.SHPG_STS_CD), #shpgStsCdShip#)
                      FROM
                           CSA_SHPG_PLN_V SP2
                          ,CSA_MDSE_ITEM_V IM2
                      WHERE
                          SP2.GLBL_CMPY_CD        = SP.GLBL_CMPY_CD
                      AND SP2.SET_SHPG_PLN_NUM    = SP.SET_SHPG_PLN_NUM
                      AND SP2.EZCANCELFLAG        = '0'
                      AND SP2.MDSE_CD             = IM2.MDSE_CD
                      AND SP2.GLBL_CMPY_CD        = IM2.GLBL_CMPY_CD
                      AND IM2.EZCANCELFLAG        = '0'
                      AND IM2.INVTY_CTRL_FLG      = 'Y'
                    )
            END                       AS SET_SHIP_STS_CD
        FROM
            CSA_CPO_V       C
           ,CSA_CPO_DTL_V   CD
           ,CSA_SHPG_PLN_V  SP
           ,CSA_INV_V       I
           ,CSA_INV_LINE_V  IL
           ,CSA_MDSE_ITEM_V IM
           ,MDSE            MD
        WHERE 1=1
            AND C.GLBL_CMPY_CD              = #cusaGlblCmpyCd#
            AND C.EZCANCELFLAG              = '0'
            AND C.CPO_HLD_FLG               = 'N'
            AND C.CPO_ORD_NUM               = CD.CPO_ORD_NUM
            AND C.GLBL_CMPY_CD              = CD.GLBL_CMPY_CD
            AND CD.EZCANCELFLAG             = '0'
            AND CD.GLBL_CMPY_CD             = SP.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM               = SP.TRX_HDR_NUM
            AND CD.CPO_DTL_LINE_NUM         = SP.TRX_LINE_NUM
            AND CD.CPO_DTL_LINE_SUB_NUM     = SP.TRX_LINE_SUB_NUM
            AND CD.CPO_DTL_HLD_FLG          = 'N'
            AND SP.TRX_SRC_TP_CD            = #trxSrcTpCd#
            AND SP.TRX_LINE_SUB_NUM        != #trxLineSubNum#
            AND SP.INVTY_LOC_CD              IS NULL
            AND SP.PO_REQ_FLG               = 'N'
            AND SP.SHIP_PLN_CANC_FLG        = 'N'
            AND SP.SHIP_PLN_HLD_FLG         = 'N'
            AND SP.EZCANCELFLAG             = '0'

        <iterate property="billToCustCdList" var="billToCustCd[]" open="AND C.BILL_TO_CUST_CD IN (" close=")" conjunction=",">
                #billToCustCd[]#
        </iterate>

        <iterate property="sellToCustCdList" var="sellToCustCd[]" open="AND C.SELL_TO_CUST_CD IN (" close=")" conjunction=",">
                #sellToCustCd[]#
        </iterate>

            AND SP.MDSE_CD                  = IM.MDSE_CD
            AND SP.GLBL_CMPY_CD             = IM.GLBL_CMPY_CD
            AND IM.EZCANCELFLAG             = '0'
            AND IM.INVTY_CTRL_FLG           = 'N'
            <!-- START 2022/05/30 R.Azucena [QC#60119, MOD] -->
            <!-- AND SP.MDSE_CD                  = MD.MDSE_CD -->
            AND CD.CUST_MDSE_CD             = MD.MDSE_CD
            <!-- END 2022/05/30 R.Azucena [QC#60119, MOD] -->
            AND MD.GLBL_CMPY_CD             = #glblCmpyCd#
            AND MD.EZCANCELFLAG             = '0'
            AND MD.INVTY_CTRL_FLG           = 'Y'
            AND NOT EXISTS(
                        SELECT
                            *
                        FROM
                            EDI_ASN_HDR_WRK EAHW
                           ,EDI_ASN_DTL_WRK EADW
                        WHERE 1 = 1
                        AND EADW.GLBL_CMPY_CD      = #glblCmpyCd#
                        AND EADW.TRX_HDR_NUM       = SP.TRX_HDR_NUM
                        AND EADW.TRX_LINE_NUM      = SP.TRX_LINE_NUM
                        AND EADW.TRX_LINE_SUB_NUM  = SP.TRX_LINE_SUB_NUM
                        AND EADW.SHPG_PLN_NUM      = SP.SHPG_PLN_NUM
                        AND EADW.EZCANCELFLAG      = '0'
                        AND EADW.GLBL_CMPY_CD      = EAHW.GLBL_CMPY_CD
                        AND EADW.ASN_SO_NUM        = EAHW.ASN_SO_NUM
                        AND EADW.TRX_HDR_NUM       = EAHW.TRX_HDR_NUM
                        AND EAHW.EZCANCELFLAG      = '0'
                       )
             AND NOT EXISTS(
                        SELECT
                            *
                        FROM
                            CSA_SHPG_PLN_V  SP2
                           ,CSA_MDSE_ITEM_V IM2
                        WHERE 1 = 1
                        AND C.GLBL_CMPY_CD        = SP2.GLBL_CMPY_CD
                        AND C.CPO_ORD_NUM         = SP2.TRX_HDR_NUM
                        AND SP2.EZCANCELFLAG      = '0'
                        AND SP2.SHIP_PLN_CANC_FLG = 'N'
                        AND SP2.SO_CLOSE_FLG      = 'N'
                        AND SP2.GLBL_CMPY_CD      = IM2.GLBL_CMPY_CD
                        AND SP2.MDSE_CD           = IM2.MDSE_CD
                        AND IM2.EZCANCELFLAG      = '0'
                        AND IM2.INVTY_CTRL_FLG    = 'Y'
                        <!-- QC#52580 Mod Start -->
                        <!-- AND SP2.SHIP_CPLT_CD      = SP.SHIP_CPLT_CD -->
                        AND NVL(SP2.SHIP_CPLT_CD, 'NULL') = NVL(SP.SHIP_CPLT_CD, 'NULL')
                        <!-- QC#52580 Mod End -->
                      )
             AND I.INV_NUM                   = IL.INV_NUM
             AND I.INV_DT                &gt;= #salesDate#
             AND I.GLBL_CMPY_CD              = IL.GLBL_CMPY_CD
             AND IL.SHPG_PLN_NUM             = SP.SHPG_PLN_NUM
             AND IL.GLBL_CMPY_CD             = SP.GLBL_CMPY_CD
             AND I.EZCANCELFLAG              = '0'
             AND IL.EZCANCELFLAG             = '0'
    </isNotNull>
        ) MAIN
        ORDER BY
            CPO_ORD_NUM
    </statement>

    <statement id="getMaxSoSlpNum" parameterClass="Map" resultClass="String">
    SELECT
        LPAD(MAX(SOD.SO_SLP_NUM) + 1, 3, 0) AS MAX_SO_SLP_NUM
    FROM
        CSA_SHPG_ORD_V     SO
       ,CSA_SHPG_ORD_DTL_V SOD
    WHERE 1=1
     AND SO.GLBL_CMPY_CD  = #cusaGlblCmpyCd#
     AND SO.GLBL_CMPY_CD  = SOD.GLBL_CMPY_CD
     AND SO.SO_NUM        = SOD.SO_NUM
     AND SO.SO_NUM        = #soNum#
     AND SO.EZCANCELFLAG  = '0'
     AND SOD.EZCANCELFLAG = '0'
    </statement>

    <statement id="getDummySoNumAndSoSlpNum" parameterClass="Map" resultClass="Map">
    SELECT
        #dummySoNum# || DECODE(COUNT(*), 0 , '' , '-' || LPAD(COUNT(*), 3, 0)) AS DUMMY_SO_NUM
    FROM 
        (
            SELECT 
                EADW.ASN_SO_NUM
               ,COUNT(EADW.ASN_SO_NUM)
        FROM 
            EDI_ASN_DTL_WRK EADW
        WHERE 1 = 1
         AND EADW.GLBL_CMPY_CD  = #glblCmpyCd#
         AND EADW.EZCANCELFLAG  = '0'
         AND EADW.ASN_SO_NUM    LIKE #asnSoNum#
         GROUP BY 
            ASN_SO_NUM
        )
    </statement>

    <statement id="getCmpsn" parameterClass="Map" resultClass="Map">
    SELECT
        CCV.CHILD_MDSE_CD
       ,CCV.CHILD_MDSE_QTY
       ,CMIV.INVTY_CTRL_FLG
       ,NVL(
         (  
          SELECT
               SCD.SHIP_QTY/CCM.CHILD_MDSE_QTY AS COUNT
           FROM 
               CSA_SHPG_ORD_DTL_V       SOD
              ,CSA_SHPG_ORD_CONF_DTL_V  SCD
              ,CSA_CMPSN_V              CCM
           WHERE 1 = 1
           AND SOD.GLBL_CMPY_CD      = #cusaGlblCmpyCd#
           AND SOD.TRX_HDR_NUM       = #trxHdrNum#
           AND SOD.TRX_LINE_NUM      = #trxLineNum#
           AND SOD.TRX_LINE_SUB_NUM != '000'
           AND SCD.EZCANCELFLAG      = '0'
           AND SOD.GLBL_CMPY_CD      = SCD.GLBL_CMPY_CD
           AND SOD.SO_NUM            = SCD.SO_NUM
           AND SOD.SO_SLP_NUM        = SCD.SO_SLP_NUM
           AND SOD.SO_NUM            = #soNum#
           AND SOD.SO_SLP_NUM        = #soSlpNum#
           AND SOD.EZCANCELFLAG      = '0'
           AND (
                   SOD.MDSE_CD           = CCM.CHILD_MDSE_CD OR SUBSTR(SOD.MDSE_CD, 1, 8) = CCM.CHILD_ORD_TAKE_MDSE_CD
               )
           AND SOD.GLBL_CMPY_CD      = CCM.GLBL_CMPY_CD
           AND CCM.EZCANCELFLAG      = '0'
           AND ROWNUM = 1
         ) * CCV.CHILD_MDSE_QTY , 0)    AS COUNT
    FROM
        CSA_CMPSN_V     CCV
       ,CSA_MDSE_ITEM_V CMIV
    WHERE 1=1
    AND CCV.GLBL_CMPY_CD          = #cusaGlblCmpyCd#
    AND CCV.PRNT_MDSE_CD          = #prntMdseCd#
    AND CCV.CHILD_MDSE_CD         = #childMdseCd#
    AND CCV.EZCANCELFLAG          = '0'
    AND CCV.CHILD_MDSE_CD         = CMIV.MDSE_CD
    AND CCV.GLBL_CMPY_CD          = CMIV.GLBL_CMPY_CD
    AND CMIV.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getAsnDelyDt" parameterClass="Map" resultClass="String">
    SELECT
        EAD.ASN_PLN_DELY_DT
    FROM
        EDI_ASN_DTL_WRK  EAD
    WHERE 1 = 1
    AND EAD.GLBL_CMPY_CD          = #glblCmpyCd#
    AND EAD.ASN_SO_NUM            = #asnSoNum#
    AND EAD.ASN_PLN_DELY_DT       IS NOT NULL
    AND EAD.VND_INVTY_LOC_CD      IS NOT NULL
    AND EAD.EZCANCELFLAG          = '0'
    AND ROWNUM = 1
    </statement>

    <statement id="getIntangibleItem" parameterClass="Map" resultClass="Map">
    SELECT
        EAD.ASN_SO_NUM
       ,EAD.ASN_LINE_NUM
    FROM
        EDI_ASN_DTL_WRK  EAD
    WHERE 1 = 1
    AND EAD.GLBL_CMPY_CD     = #glblCmpyCd#
    AND EAD.ASN_SO_NUM       = #asnSoNum#
    AND EAD.VND_INVTY_LOC_CD IS NULL
    AND EAD.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getPddDt" parameterClass="Map" resultClass="String">
    SELECT
        PDD_DT
    FROM
        CSA_SHPG_PLN_V CSPV
    WHERE 1=1
    AND CSPV.GLBL_CMPY_CD     = #cusaGlblCmpyCd#
    AND CSPV.SHPG_PLN_NUM     = #shpgPlnNum#
    AND CSPV.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getLakNumber" parameterClass="Map" resultClass="Map">
      SELECT
          CLPV.GLBL_CMPY_CD            AS GLBL_CMPY_CD
         ,CLPV.MDSE_CD                 AS MDSE_CD
         ,#soNum#                      AS SO_NUM
         ,ROWNUM                       AS SO_SER_ID
         ,null                         AS WH_CD
         ,CLPV.LIC_ACCS_NUM            AS LIC_ACCS_NUM
         ,CLPV.ILMS_LIC_ACCS_NUM       AS ILMS_LIC_ACCS_NUM
         ,CLPV.LAK_INS_TS              AS SER_TAKE_DT_TM_TS
         ,#soSlpNum#                   AS SO_SLP_NUM
         ,NVL(MDSE.ILMS_LIC_FLG , 'N') AS ILMS_LIC_FLG
      FROM 
          CSA_LAK_RPST_V  CLPV
         ,CSA_MDSE_INFO_V MDSE 
      WHERE 1 = 1
      AND CLPV.GLBL_CMPY_CD         = #cusaGlblCmpyCd#
      AND CLPV.CPO_ORD_NUM          = #cpoOrdNum#
      AND CLPV.CPO_DTL_LINE_NUM     = #cpoDtlLineNum#
      AND CLPV.CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
      AND CLPV.EZCANCELFLAG         = '0'
      AND CLPV.MDSE_CD              = MDSE.MDSE_CD(+)
      AND CLPV.GLBL_CMPY_CD         = MDSE.GLBL_CMPY_CD(+)
      AND MDSE.EZCANCELFLAG(+)      = '0'
      AND NOT EXISTS(
          SELECT
              *
          FROM
              EDI_ASN_SER_NUM_WRK SER
          WHERE 1=1
          AND SER.GLBL_CMPY_CD          = #glblCmpyCd#
          AND CLPV.CPO_ORD_NUM          = SER.TRX_HDR_NUM
          AND CLPV.CPO_DTL_LINE_NUM     = SER.TRX_LINE_NUM
          AND CLPV.CPO_DTL_LINE_SUB_NUM = SER.TRX_LINE_SUB_NUM
          AND CLPV.ILMS_LIC_ACCS_NUM    = SER.SER_NUM
          AND SER.EZCANCELFLAG          = '0'
      )
      AND ROWNUM &lt;= #rownum#
    </statement>

    <statement id="getSetShpgPlnNUm" parameterClass="Map" resultClass="String">
      SELECT
          SP.SET_SHPG_PLN_NUM
      FROM 
          CSA_SHPG_PLN_V   SP
         ,EDI_ASN_DTL_WRK  EADW
      WHERE 1 = 1
      AND SP.GLBL_CMPY_CD           = #cusaGlblCmpyCd#
      AND EADW.GLBL_CMPY_CD         = #glblCmpyCd#
      AND SP.SET_SHPG_PLN_NUM       = #setShpgPlnNum#
      AND SP.SHPG_PLN_NUM           = EADW.SHPG_PLN_NUM
      AND SP.EZCANCELFLAG           = '0'
      AND EADW.EZCANCELFLAG         = '0'
      AND ROWNUM = 1
    </statement>

</sqlMap>

