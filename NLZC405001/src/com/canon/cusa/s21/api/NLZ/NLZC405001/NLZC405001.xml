<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLZC405001">

    <statement id="getSoDtlLst" parameterClass="Map" resultClass="Map">
    SELECT
        SCD.SO_NUM                                  AS SO_NUM
       ,SCD.SO_SLP_NUM                              AS SO_SLP_NUM
       ,DECODE(SCD.PRO_NUM, '*', NULL, SCD.PRO_NUM) AS PRO_NUM
       ,DECODE(SCD.VND_CD,  '*', NULL, SCD.VND_CD)  AS CARR_CD
       ,RW.RTL_WH_CD                                AS RTL_WH_CD
       ,RW.RTL_WH_NM                                AS RTL_WH_NM
       ,RW.FIRST_LINE_ADDR                          AS RTL_WH_FIRST_LINE_ADDR
       ,RW.CTY_ADDR                                 AS RTL_WH_CTY_ADDR
       ,RW.ST_CD                                    AS RTL_WH_ST_CD
       ,RW.POST_CD                                  AS RTL_WH_POST_CD
       <!-- START 2018/01/25 S.Katsuma [QC#23579,MOD] -->
       ,NVL(STC1.DS_ACCT_NM, STC2.DS_ACCT_NM)       AS SHIP_TO_ACCT_NM
       <!-- END 2018/01/25 S.Katsuma [QC#23579,MOD] -->
       ,SOCD.SO_CUST_LINE_ADDR_01                   AS SHIP_TO_FIRST_LINE_ADDR
       ,SOCD.CTY_ADDR                               AS SHIP_TO_CTY_ADDR
       ,SOCD.ST_CD                                  AS SHIP_TO_ST_CD
       ,SOCD.POST_CD                                AS SHIP_TO_POST_CD
    FROM
        SHPG_ORD_CONF_DTL SCD
       ,SHPG_ORD_DTL      SOD
       ,SHPG_PLN          SP
       ,SHPG_STS          SS
       ,SHPG_ORD          SO
       ,RTL_WH            RW
       ,SHPG_ORD_CUST_DTL SOCD
       <!-- START 2018/01/25 S.Katsuma [QC#23579,MOD] -->
       ,SELL_TO_CUST      STC1
       ,SELL_TO_CUST      STC2
       <!-- END 2018/01/25 S.Katsuma [QC#23579,MOD] -->
    WHERE
        SCD.GLBL_CMPY_CD         = #glblCmpyCd#
    <isNotNull property="soNum">
    AND SCD.SO_NUM               = #soNum#
    </isNotNull>
    <isNotNull property="soSlpNum">
    AND SCD.SO_SLP_NUM           = #soSlpNum#
    </isNotNull>
    <isNotNull property="proNum">
    AND SCD.PRO_NUM              = #proNum#
    </isNotNull>
    AND SCD.EZCANCELFLAG         = '0'
    AND SCD.GLBL_CMPY_CD         = SOD.GLBL_CMPY_CD
    AND SCD.SO_NUM               = SOD.SO_NUM
    AND SCD.SO_SLP_NUM           = SOD.SO_SLP_NUM
    <isNotNull property="cpoOrdNum">
    AND SOD.TRX_HDR_NUM          = #cpoOrdNum#
    </isNotNull>
    <isNotNull property="cpoDtlLineNum">
    AND SOD.TRX_LINE_NUM         = #cpoDtlLineNum#
    </isNotNull>
    <isNotNull property="cpoDtlLineSubNum">
    AND SOD.TRX_LINE_SUB_NUM     = #cpoDtlLineSubNum#
    </isNotNull>
    AND SOD.EZCANCELFLAG         = '0'
    AND SOD.GLBL_CMPY_CD         = SP.GLBL_CMPY_CD
    AND SOD.SHPG_PLN_NUM         = SP.SHPG_PLN_NUM
    AND SP.EZCANCELFLAG          = '0'
    AND SP.GLBL_CMPY_CD          = SS.GLBL_CMPY_CD
    AND SP.SHPG_STS_CD           = SS.SHPG_STS_CD
    AND SS.SHIP_FLG              = #shipFlg#
    AND SS.EZCANCELFLAG          = '0'
    AND SOD.GLBL_CMPY_CD         = SO.GLBL_CMPY_CD
    AND SOD.SO_NUM               = SO.SO_NUM
    AND SO.EZCANCELFLAG          = '0'
    AND SO.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
    AND SO.WH_CD                 = RW.RTL_WH_CD
    AND RW.EZCANCELFLAG          = '0'
    AND SO.GLBL_CMPY_CD          = SOCD.GLBL_CMPY_CD
    AND SO.SO_NUM                = SOCD.SO_NUM
    AND SOCD.SO_CUST_DATA_TP_CD  = #soCustDataTpCd#
    AND SOCD.EZCANCELFLAG        = '0'
    <!-- START 2018/01/25 S.Katsuma [QC#23579,MOD] -->
    AND SO.GLBL_CMPY_CD          = STC1.GLBL_CMPY_CD(+)
    AND SO.SHIP_TO_CUST_ACCT_CD  = STC1.SELL_TO_CUST_CD(+)
    AND STC1.EZCANCELFLAG(+)     = '0'
    AND SO.GLBL_CMPY_CD          = STC2.GLBL_CMPY_CD(+)
    AND SO.SELL_TO_CUST_CD       = STC2.SELL_TO_CUST_CD(+)
    AND STC2.EZCANCELFLAG(+)     = '0'
    <!-- END 2018/01/25 S.Katsuma [QC#23579,MOD] -->
    ORDER BY
        SOD.SO_NUM
       ,SOD.SO_SLP_NUM
    </statement>

    <statement id="getRwsDtlLst" parameterClass="Map" resultClass="Map">
    SELECT
        RH.RWS_NUM
       ,RD.RWS_DTL_LINE_NUM
       ,RH.WH_CD AS RTL_WH_CD
       ,RH.FROM_LOC_POST_CD
       ,DC.DS_ORD_CATG_CD
       ,DC.DS_ORD_TP_CD
       ,DCRD.RTRN_RSN_CD
       ,RD.MDSE_CD
    FROM
        RWS_HDR         RH
       ,RWS_DTL         RD
       ,RWS_STS         RS
       ,DS_CPO_RTRN_DTL DCRD
       ,CPO             DC
    WHERE
        RH.GLBL_CMPY_CD     = #glblCmpyCd#
    <isNotNull property="rwsNum">
    AND RH.RWS_NUM          = #rwsNum#
    </isNotNull>
    <isNotNull property="cpoOrdNum">
    AND RH.TRX_ORD_NUM      = #cpoOrdNum#
    </isNotNull>
    AND RH.EZCANCELFLAG     = '0'
    AND RH.GLBL_CMPY_CD     = RD.GLBL_CMPY_CD
    AND RH.RWS_NUM          = RD.RWS_NUM
    <isNotNull property="rwsDtlLineNum">
    AND RD.RWS_DTL_LINE_NUM = #rwsDtlLineNum#
    </isNotNull>
    <isNotNull property="cpoDtlLineNum">
    AND RD.TRX_LINE_NUM     = #cpoDtlLineNum#
    </isNotNull>
    <isNotNull property="cpoDtlLineSubNum">
    AND RD.TRX_LINE_SUB_NUM = #cpoDtlLineSubNum#
    </isNotNull>
    AND RD.EZCANCELFLAG     = '0'
    AND RD.GLBL_CMPY_CD     = RS.GLBL_CMPY_CD
    AND RD.RWS_STS_CD       = RS.RWS_STS_CD
    AND RS.RWS_OPEN_FLG     = #rwsOpenFlg#
    AND RS.EZCANCELFLAG     = '0'
    AND RH.GLBL_CMPY_CD     = DCRD.GLBL_CMPY_CD
    AND RH.TRX_ORD_NUM      = DCRD.CPO_ORD_NUM
    AND RD.TRX_LINE_NUM     = DCRD.DS_CPO_RTRN_LINE_NUM
    AND RD.TRX_LINE_SUB_NUM = DCRD.DS_CPO_RTRN_LINE_SUB_NUM
    AND DCRD.EZCANCELFLAG   = '0'
    AND DCRD.GLBL_CMPY_CD   = DC.GLBL_CMPY_CD
    AND DCRD.CPO_ORD_NUM    = DC.CPO_ORD_NUM
    AND DC.EZCANCELFLAG     = '0'
    ORDER BY
        RH.RWS_NUM
       ,RD.RWS_DTL_LINE_NUM
    </statement>

</sqlMap>