<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NFBB221001">

    <typeAlias alias="NFBI0430_03TMsg"           type="business.db.NFBI0430_03TMsg"/>


   <statement id="getTargetInvByTranId" parameterClass="Map" resultClass="Map">
        SELECT
             I01.INTERFACE_ID                  INTERFACE_ID
            ,I01.TRANSACTION_ID                TRANSACTION_ID
<!-- START 2018/12/21 M.Naito [QC#29722,ADD] -->
            ,I01.SEGMENT_ID                    SEGMENT_ID
<!-- END 2018/12/21 M.Naito [QC#29722,ADD] -->
            ,I01.UNIT_ID                       UNIT_ID
            ,I01.INBD_INV_NUM                  INBD_INV_NUM
            ,I01.INV_DT                        INV_DT
            ,I01.CUST_PO_NUM                   CUST_PO_NUM
            ,I01.CUST_ACCT_NUM                 CUST_ACCT_NUM
        FROM 
             NFBI0430_01 I01
        WHERE
                I01.INTERFACE_ID = #interfaceId#
            
            AND I01.TRANSACTION_ID = #trxId#
            AND I01.EZCANCELFLAG = '0'
    </statement>
   
    <statement id="countTargetByInv" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             count(*)
        FROM 
             NFBI0430_01 I01
           
        WHERE
                I01.INTERFACE_ID        = #interfaceId#
            AND I01.TRANSACTION_ID      = #trxId#
            AND I01.INBD_INV_NUM        = #invNum#
            AND I01.EZCANCELFLAG        = '0'
    </statement>

    <statement id="getInvAmt" parameterClass="Map" resultClass="Map">
        SELECT  
             I04.TOT_INV_AMT
            ,I04.INV_FRT_AMT
            <!-- START 2023/01/05 S.Nakatani [QC#60248,ADD] -->
            ,I04.INV_HAND_AMT
            <!-- END 2023/01/05 S.Nakatani [QC#60248,ADD] -->
            ,I04.INV_SAL_TAX_AMT
        FROM 
             NFBI0430_04 I04
        WHERE
                I04.INTERFACE_ID                = #interfaceId#
            AND I04.TRANSACTION_ID              = #trxId#
<!-- START 2018/12/21 M.Naito [QC#29722,ADD] -->
            AND I04.SEGMENT_ID                  = #segmentId#
<!-- END 2018/12/21 M.Naito [QC#29722,ADD] -->
            AND I04.UNIT_ID                     = #unitId#
            AND I04.EZCANCELFLAG                = '0'

    </statement>
    
    <statement id="getVndCd" parameterClass="Map" resultClass="String">
        SELECT
            RAV.RCV_ASN_VND_CD
        FROM
            RCV_ASN_VND RAV
        WHERE
            RAV.GLBL_CMPY_CD  = #glblCmpyCd#
        AND RAV.VND_SYS_TP_CD = #vndSysTpCd#
        AND RAV.EZCANCELFLAG  = '0'
    </statement>
    
    <statement id="getPrntVndTerm" parameterClass="Map" resultClass="Map">
        SELECT
            PV.VND_PMT_TERM_CD
           ,PV.VND_PMT_TERM_DESC_TXT
        FROM
            PRNT_VND PV
           ,VND      V
        WHERE
            PV.GLBL_CMPY_CD  = #glblCmpyCd#
        AND V.VND_CD         = #vndCd#
        AND PV.PRNT_VND_PK   = V.PRNT_VND_PK
        AND PV.EZCANCELFLAG  = '0'
    </statement>
    
    <resultMap id="result.getTargetNfbi0430_03" class="NFBI0430_03TMsg">
        <result property="invLineNum"       column="INV_LINE_NUM"      javaType="EZDTStringItem"/>
        <result property="invQty"        column="INV_QTY"       javaType="EZDTStringItem"/>
        <result property="uomCd"    column="UOM_CD"  javaType="EZDTStringItem"/>
        <result property="unitPrcAmt"       column="UNIT_PRC_AMT"      javaType="EZDTStringItem"/>
        <result property="trdPtnrSkuCd"   column="TRD_PTNR_SKU_CD" javaType="EZDTStringItem"/>
        <result property="cusaMdseCd"    column="CUSA_MDSE_CD"  javaType="EZDTStringItem"/>
        <result property="ediPoLineNum"    column="EDI_PO_LINE_NUM"  javaType="EZDTStringItem"/>
        <result property="lineTotGrsAmt"    column="LINE_TOT_GRS_AMT"  javaType="EZDTStringItem"/>
    </resultMap>
    
    <statement id="getTargetNfbi0430_03" parameterClass="Map" resultMap="result.getTargetNfbi0430_03">
          
        SELECT
             I.INV_LINE_NUM
            ,I.INV_QTY
            ,I.UOM_CD
            ,I.UNIT_PRC_AMT
            ,I.TRD_PTNR_SKU_CD
            ,I.EDI_PO_LINE_NUM
            ,I.CUSA_MDSE_CD
            ,I.LINE_TOT_GRS_AMT
        FROM
            NFBI0430_03 I
        WHERE
                I.INTERFACE_ID              = #interfaceId#
            AND I.TRANSACTION_ID            = #trxId#
<!-- START 2018/12/21 M.Naito [QC#29722,ADD] -->
            AND I.SEGMENT_ID                = #segmentId#
<!-- END 2018/12/21 M.Naito [QC#29722,ADD] -->
            AND I.UNIT_ID                   = #unitId#
            AND I.EZCANCELFLAG = '0'
    </statement>

<!-- START 2018/11/12 M.Naito [QC#29050,ADD] -->
    <statement id="getVndUom" parameterClass="Map" resultClass="String">
SELECT
            TPU.PKG_UOM_CD
        FROM
            TRD_PTNR_UOM_XREF TPU
           ,PKG_UOM           PU
           ,PKG_UOM           PU2
        WHERE
            TPU.GLBL_CMPY_CD    = #glblCmpyCd#
        AND TPU.VND_CD          = #vndCd#
        AND TPU.TRD_PTNR_UOM_CD = #trdPtnrUomCd#
        AND TPU.EZCANCELFLAG    = '0'
        AND TPU.GLBL_CMPY_CD    = PU.GLBL_CMPY_CD
        AND TPU.PKG_UOM_CD      = PU.PKG_UOM_CD
        AND PU.EZCANCELFLAG     = '0'
        AND PU.GLBL_CMPY_CD     = PU2.GLBL_CMPY_CD
        AND PU.PKG_UOM_CLS_CD   = PU2.PKG_UOM_CLS_CD
        AND PU2.PKG_UOM_CD      = #pkgUomCd#
        AND PU2.EZCANCELFLAG    = '0'
        AND ROWNUM              = 1
    </statement>

    <statement id="getMdseStorePkg" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            MDSE_STORE_PKG MSP
        WHERE
            MSP.GLBL_CMPY_CD    = #glblCmpyCd#
        AND MSP.MDSE_CD         = #mdseCd#
        AND MSP.BASE_PKG_UOM_CD = #basePkgUomCd#
        AND MSP.PKG_UOM_CD      = #pkgUomCd#
        AND MSP.EZCANCELFLAG    = '0'
    </statement>
<!-- END 2018/11/12 M.Naito [QC#29050,ADD] -->

<!-- START 2018/11/19 M.Naito [QC#29047,ADD] -->
    <statement id="getSplyItemNumFromAsl" parameterClass="Map" resultClass="String">
        SELECT
            AD.SPLY_ITEM_NUM
        FROM
             ASL_HDR AH
            ,ASL_DTL AD
        WHERE
            AH.GLBL_CMPY_CD                 = #glblCmpyCd#
        AND AH.ASL_START_DT                 &lt;= #batDt#
        AND NVL(AH.ASL_END_DT, '99991231')  &gt;= #batDt#
        AND AH.EZCANCELFLAG                 = '0'
        AND AH.GLBL_CMPY_CD                 = AD.GLBL_CMPY_CD
        AND AH.ASL_HDR_PK                   = AD.ASL_HDR_PK
        AND AD.VND_CD                       = #vndCd#
        AND AD.MDSE_CD                      = #mdseCd#
        AND AD.EFF_FROM_DT                  &lt;= #batDt#
        AND NVL(AD.EFF_THRU_DT, '99991231') &gt;= #batDt#
        AND AD.EZCANCELFLAG                 = '0'
    </statement>
<!-- END 2018/11/19 M.Naito [QC#29047,ADD] -->
</sqlMap>