<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NMAL0160Query">

    <statement id ="getCostTypeList" parameterClass="Map"  resultClass="Map">
        SELECT 
            T.MDSE_CST_UPD_TP_CD 
           ,T.MDSE_CST_UPD_TP_NM
        FROM 
            MDSE_CST_UPD_TP T
        WHERE 
            T.EZCANCELFLAG = '0'
        AND T.GLBL_CMPY_CD = #glblCmpyCd#
        AND T.APVL_REQ_FLG = 'Y'
        ORDER BY MDSE_CST_UPD_TP_SORT_NUM
    </statement>

    <statement id ="getCostStatusList" parameterClass="Map"  resultClass="Map">
        SELECT 
            S.MDSE_CST_UPD_STS_CD 
           ,S.MDSE_CST_UPD_STS_NM
        FROM 
            MDSE_CST_UPD_STS S
        WHERE 
            S.EZCANCELFLAG = '0'
        AND S.GLBL_CMPY_CD = #glblCmpyCd#
        AND S.MDSE_CST_UPD_STS_CD IN
        <iterate property="mdseCstUpdStsCdList" var="mdseCstUpdStsCd[]" open="(" close=")" conjunction=",">
           #mdseCstUpdStsCd[]#
        </iterate>
        ORDER BY S.MDSE_CST_UPD_STS_SORT_NUM
    </statement>
    
    <!-- Search -->
    <typeAlias alias="NMAL0160_ASMsg"    type="business.blap.NMAL0160.NMAL0160_ASMsg"/>
    <resultMap id="result.NMAL0160_ASMsg"          class="NMAL0160_ASMsg">
        <result property="mdseCstUpdHistHdrPk_A1"  column="MDSE_CST_UPD_HIST_HDR_PK"      javaType="EZDCBigDecimalItem"  />
        <result property="mdseCd_A1"               column="MDSE_CD"                       javaType="EZDCStringItem"      />
        <result property="mdseDescShortTxt_A1"     column="MDSE_DESC_SHORT_TXT"           javaType="EZDCStringItem"      />
        <result property="mdseCstUpdTpCd_A1"       column="MDSE_CST_UPD_TP_CD"            javaType="EZDCStringItem"      />
        <result property="mdseCstUpdTpNm_A1"       column="MDSE_CST_UPD_TP_NM"            javaType="EZDCStringItem"      />
        <result property="mdseCstUpdGrpTxt_A1"     column="MDSE_CST_UPD_GRP_TXT"          javaType="EZDCStringItem"      />
        <result property="coaMdseTpCd_A1"          column="COA_MDSE_TP_CD"                javaType="EZDCStringItem"      />
        <result property="coaProdCd_A1"            column="COA_PROD_CD"                   javaType="EZDCStringItem"      />
        <result property="thisMthTotStdCostAmt_A1" column="THIS_MTH_TOT_STD_COST_AMT"     javaType="EZDCBigDecimalItem"  />
        <result property="rqstTotStdCostAmt_A1"    column="RQST_TOT_STD_COST_AMT"         javaType="EZDCBigDecimalItem"  />
        <result property="invtyQty_A1"             column="INVTY_QTY"                     javaType="EZDCBigDecimalItem"  />
        <result property="xxEstScTotCostAmt_A1"    column="XX_EST_SC_TOT_COST_AMT"        javaType="EZDCBigDecimalItem"  />
        <result property="mdseCstUpdStsCd_A1"      column="MDSE_CST_UPD_STS_CD"           javaType="EZDCStringItem"      />
        <result property="mdseCstUpdEffFromDt_A1"  column="MDSE_CST_UPD_EFF_FROM_DT"      javaType="EZDCDateItem"        />
        <result property="mdseCstUpdCratDt_A1"     column="MDSE_CST_UPD_CRAT_DT"          javaType="EZDCDateItem"        />
        <result property="ezUpTime_A1"             column="EZUPTIME"                      javaType="EZDCStringItem"      />
        <result property="ezUpTimeZone_A1"         column="EZUPTIMEZONE"                  javaType="EZDCStringItem"      />
        <result property="ezUpTime_M1"             column="EZUPTIME_M1"                   javaType="EZDCStringItem"      />
        <result property="ezUpTimeZone_M1"         column="EZUPTIMEZONE_M1"               javaType="EZDCStringItem"      />
        <result property="ezUpTime_D1"             column="EZUPTIME_D1"                   javaType="EZDCStringItem"      />
        <result property="ezUpTimeZone_D1"         column="EZUPTIMEZONE_D1"               javaType="EZDCStringItem"      />
        <!-- QC#2872 -->
        <result property="xxRecHistCratTs_A1"      column="XX_REC_HIST_CRAT_TS_D"         javaType="EZDCStringItem"      />
        <result property="xxRecHistUpdTs_A1"       column="XX_REC_HIST_UPD_TS_D"          javaType="EZDCStringItem"      />
        <result property="xxRecHistTblNm_A1"       column="XX_REC_HIST_TBL_NM_D"          javaType="EZDCStringItem"      />
        <result property="xxRecHistCratByNm_B1"    column="XX_REC_HIST_CRAT_BY_NM_D"      javaType="EZDCStringItem"      />
        <result property="xxRecHistUpdByNm_B1"     column="XX_REC_HIST_UPD_BY_NM_D"       javaType="EZDCStringItem"      />
        <result property="xxRecHistCratTs_H1"      column="XX_REC_HIST_CRAT_TS_H"         javaType="EZDCStringItem"      />
        <result property="xxRecHistCratByNm_H1"    column="XX_REC_HIST_CRAT_BY_NM_H"      javaType="EZDCStringItem"      />
        <result property="xxRecHistUpdTs_H1"       column="XX_REC_HIST_UPD_TS_H"          javaType="EZDCStringItem"      />
        <result property="xxRecHistUpdByNm_H1"     column="XX_REC_HIST_UPD_BY_NM_H"       javaType="EZDCStringItem"      />
        <result property="xxRecHistTblNm_H1"       column="XX_REC_HIST_TBL_NM_H"          javaType="EZDCStringItem"      />
    </resultMap>
    <statement id ="search" parameterClass="Map" resultMap="result.NMAL0160_ASMsg">
        <!-- 2020/01/18 S21_NA#55487 Add Start -->
        SELECT
            *
        FROM
            (
        <!-- 2020/01/18 S21_NA#55487 Add End -->
            SELECT
                TMP.MDSE_CST_UPD_HIST_HDR_PK
               ,TMP.MDSE_CD
               ,TMP.MDSE_DESC_SHORT_TXT
               ,TMP.MDSE_CST_UPD_TP_CD
               ,TMP.MDSE_CST_UPD_TP_NM
               ,TMP.MDSE_CST_UPD_GRP_TXT
               ,TMP.COA_MDSE_TP_CD
               ,TMP.COA_PROD_CD
               ,TMP.THIS_MTH_TOT_STD_COST_AMT
               ,TMP.RQST_TOT_STD_COST_AMT
               ,SUM(TMP.INVTY_QTY)                  AS  INVTY_QTY
               ,SUM(TMP.XX_EST_SC_TOT_COST_AMT)     AS XX_EST_SC_TOT_COST_AMT
               ,TMP.MDSE_CST_UPD_STS_CD
               ,TMP.MDSE_CST_UPD_EFF_FROM_DT
               ,TMP.MDSE_CST_UPD_CRAT_DT
               ,TMP.EZUPTIME
               ,TMP.EZUPTIMEZONE
               ,TMP.EZUPTIME_M1
               ,TMP.EZUPTIMEZONE_M1
               ,TMP.EZUPTIME_D1
               ,TMP.EZUPTIMEZONE_D1
               ,TMP.XX_REC_HIST_CRAT_TS_H
               ,TMP.XX_REC_HIST_CRAT_BY_NM_H
               ,TMP.XX_REC_HIST_UPD_TS_H
               ,TMP.XX_REC_HIST_UPD_BY_NM_H
               ,TMP.XX_REC_HIST_TBL_NM_H
               ,TMP.XX_REC_HIST_CRAT_TS_D
               ,TMP.XX_REC_HIST_CRAT_BY_NM_D
               ,TMP.XX_REC_HIST_UPD_TS_D
               ,TMP.XX_REC_HIST_UPD_BY_NM_D
               ,TMP.XX_REC_HIST_TBL_NM_D
            FROM (
            SELECT
                D.MDSE_CST_UPD_HIST_HDR_PK
               ,D.MDSE_CD
               ,M.MDSE_DESC_SHORT_TXT
               ,H.MDSE_CST_UPD_TP_CD
               ,MCUT.MDSE_CST_UPD_TP_NM
               ,H.MDSE_CST_UPD_GRP_TXT
               ,M.COA_MDSE_TP_CD
               ,M.COA_PROD_CD
               ,CASE WHEN MCUT.STD_COST_RELN_FLG = 'Y' THEN NVL(M.THIS_MTH_TOT_STD_COST_AMT, 0) ELSE NVL(M.ASSET_RECOV_COST_AMT, 0) END THIS_MTH_TOT_STD_COST_AMT
               ,D.RQST_TOT_STD_COST_AMT
               ,NVL(ISS.INVTY_QTY, 0) INVTY_QTY
               ,CASE WHEN MCUT.STD_COST_RELN_FLG = 'Y' THEN ((D.RQST_TOT_STD_COST_AMT - M.THIS_MTH_TOT_STD_COST_AMT) * NVL(ISS.INVTY_QTY, 0) * NVL(ISS.STANDARD_COST_PCT,    100) / 100 )
                                                       ELSE ((D.RQST_TOT_STD_COST_AMT - M.ASSET_RECOV_COST_AMT)      * NVL(ISS.INVTY_QTY, 0) * NVL(ISS.ASSET_RECOV_COST_PCT, 100) / 100 ) END AS  XX_EST_SC_TOT_COST_AMT
               ,D.MDSE_CST_UPD_STS_CD
               ,D.MDSE_CST_UPD_EFF_FROM_DT
               ,H.MDSE_CST_UPD_CRAT_DT
               ,D.EZUPTIME
               ,D.EZUPTIMEZONE
               ,M.EZUPTIME EZUPTIME_M1
               ,M.EZUPTIMEZONE EZUPTIMEZONE_M1
               ,M.EZUPTIME EZUPTIME_D1
               ,M.EZUPTIMEZONE EZUPTIMEZONE_D1
               <!-- QC#2872 -->
               ,H.EZINTIME    AS XX_REC_HIST_CRAT_TS_H
               ,H.EZINUSERID  AS XX_REC_HIST_CRAT_BY_NM_H
               ,H.EZUPTIME    AS XX_REC_HIST_UPD_TS_H
               ,H.EZUPUSERID  AS XX_REC_HIST_UPD_BY_NM_H
               ,H.EZTABLEID   AS XX_REC_HIST_TBL_NM_H
               ,D.EZINTIME    AS XX_REC_HIST_CRAT_TS_D
               ,D.EZINUSERID  AS XX_REC_HIST_CRAT_BY_NM_D
               ,D.EZUPTIME    AS XX_REC_HIST_UPD_TS_D
               ,D.EZUPUSERID  AS XX_REC_HIST_UPD_BY_NM_D
               ,D.EZTABLEID   AS XX_REC_HIST_TBL_NM_D
            FROM
                MDSE_CST_UPD_HIST_HDR H
               ,MDSE_CST_UPD_HIST_DTL D
               ,MDSE_CST_UPD_TP MCUT
               ,MDSE M
               ,MDSE_CST_UPD_STS MCUS
               ,(
                 SELECT    ISS.MDSE_CD
                         , SUM(ISS.INVTY_QTY)           AS INVTY_QTY
                         , SWH1.MDSE_INVTY_COST_PCT     AS STANDARD_COST_PCT
                         , SWH2.MDSE_INVTY_COST_PCT     AS ASSET_RECOV_COST_PCT
                         <!-- 2020/01/16 QC#55445 Add Start -->
                         , H.MDSE_CST_UPD_HIST_HDR_PK
                         <!-- 2020/01/16 QC#55445 Add End -->
                 FROM
                           INVTY_SNAP_SHOT_V   ISS
                         , RTL_SWH             RS1
                         , SWH                 SWH1
                         , RTL_SWH             RS2
                         , SWH                 SWH2
                         <!-- 2020/10/13 MOD QC#57843 Start -->
                         <!-- 
                         , (
                            SELECT
                                  V.MDSE_CD, MAX(V.INVTY_SNAP_SHOT_DT) AS SNAP_SHOT_DT FROM INVTY_SNAP_SHOT_V V
                            WHERE
                                  V.GLBL_CMPY_CD = #glblCmpyCd# AND V.EZCANCELFLAG = '0'
                            GROUP BY
                                  V.MDSE_CD
                         ) M
                          -->
                         <!-- 2020/10/13 MOD QC#57843 End -->
                         <!-- 2020/01/16 QC#55445 Add Start -->
                         ,MDSE_CST_UPD_HIST_DTL D
                         ,MDSE_CST_UPD_HIST_HDR H
                         ,MDSE_CST_UPD_TP    UT
                         <!-- 2020/01/16 QC#55445 Add End -->
                    WHERE
                           ISS.EZCANCELFLAG             = '0'
                       AND ISS.GLBL_CMPY_CD             = #glblCmpyCd#
                       <!-- 2020/10/13 MOD QC#57843 Start -->
                       AND ISS.INVTY_SNAP_SHOT_DT       = #invtySnapShotDt#
                       <!--
                       AND ISS.MDSE_CD                  = M.MDSE_CD
                       AND ISS.INVTY_SNAP_SHOT_DT       = M.SNAP_SHOT_DT
                        -->
                       <!-- 2020/10/13 MOD QC#57843 End -->
                       AND ISS.GLBL_CMPY_CD             = RS1.GLBL_CMPY_CD(+)
                       AND ISS.EZCANCELFLAG             = RS1.EZCANCELFLAG(+)
                       AND ISS.INVTY_LOC_CD             = RS1.INVTY_LOC_CD(+)
                       AND RS1.GLBL_CMPY_CD             = SWH1.GLBL_CMPY_CD(+)
                       AND RS1.EZCANCELFLAG             = SWH1.EZCANCELFLAG(+)
                       AND RS1.RTL_SWH_CD               = SWH1.RTL_SWH_CD(+)
                       AND SWH1.MDSE_COST_TP_CD(+)      = #stdCostTp#
                       AND ISS.GLBL_CMPY_CD             = RS2.GLBL_CMPY_CD(+)
                       AND ISS.EZCANCELFLAG             = RS2.EZCANCELFLAG(+)
                       AND ISS.INVTY_LOC_CD             = RS2.INVTY_LOC_CD(+)
                       AND RS2.GLBL_CMPY_CD             = SWH2.GLBL_CMPY_CD(+)
                       AND RS2.EZCANCELFLAG             = SWH2.EZCANCELFLAG(+)
                       AND RS2.RTL_SWH_CD               = SWH2.RTL_SWH_CD(+)
                       AND SWH2.MDSE_COST_TP_CD(+)      = #assetRecovCostTp#
                       <!-- 2020/01/16 QC#55445 Add Start -->
                       AND ISS.MDSE_CD                  = D.MDSE_CD
                       AND D.EZCANCELFLAG               = H.EZCANCELFLAG
                       AND D.GLBL_CMPY_CD               = H.GLBL_CMPY_CD
                       AND D.MDSE_CST_UPD_HIST_HDR_PK   = H.MDSE_CST_UPD_HIST_HDR_PK
                       AND D.MDSE_CST_UPD_STS_CD        = #mdseCstUpdStsCd#
                       AND H.EZCANCELFLAG               = UT.EZCANCELFLAG
                       AND H.GLBL_CMPY_CD               = UT.GLBL_CMPY_CD
                       AND H.MDSE_CST_UPD_TP_CD         = UT.MDSE_CST_UPD_TP_CD
                       <!-- START 2021/04/06 R.Azucena [QC#58419,MOD] -->
                       <!-- AND ( -->
                       <!--         (UT.STD_COST_RELN_FLG = 'Y' AND SWH1.MDSE_INVTY_COST_PCT IS NOT NULL)  -->
                       <!--      OR (UT.STD_COST_RELN_FLG = 'N' AND SWH2.MDSE_INVTY_COST_PCT IS NOT NULL) -->
                       <!--      ) -->
                       AND UT.STD_COST_RELN_FLG         = 'Y'
                       AND SWH1.MDSE_INVTY_COST_PCT IS NOT NULL
                       <!-- END 2021/04/06 R.Azucena [QC#58419,MOD] -->
                       <!-- 2020/01/16 QC#55445 Add End -->
                 GROUP BY
                           ISS.MDSE_CD
                         , SWH1.MDSE_INVTY_COST_PCT
                         , SWH2.MDSE_INVTY_COST_PCT
                         <!-- 2020/01/16 QC#55445 Add Start -->
                         , H.MDSE_CST_UPD_HIST_HDR_PK
                         <!-- 2020/01/16 QC#55445 Add End -->
                 <!-- START 2021/04/06 R.Azucena [QC#58419,ADD] -->
                 UNION ALL
                 SELECT    ISS.MDSE_CD
                         , SUM(ISS.INVTY_QTY)           AS INVTY_QTY
                         , SWH1.MDSE_INVTY_COST_PCT     AS STANDARD_COST_PCT
                         , SWH2.MDSE_INVTY_COST_PCT     AS ASSET_RECOV_COST_PCT
                         , H.MDSE_CST_UPD_HIST_HDR_PK
                 FROM
                           INVTY_SNAP_SHOT_V     ISS
                         , RTL_SWH               RS1
                         , SWH                   SWH1
                         , RTL_SWH               RS2
                         , SWH                   SWH2
                         , MDSE_CST_UPD_HIST_DTL D
                         , MDSE_CST_UPD_HIST_HDR H
                         , MDSE_CST_UPD_TP       UT
                 WHERE
                           ISS.EZCANCELFLAG             = '0'
                       AND ISS.GLBL_CMPY_CD             = #glblCmpyCd#
                       AND ISS.INVTY_SNAP_SHOT_DT       = #invtySnapShotDt#
                       AND ISS.GLBL_CMPY_CD             = RS1.GLBL_CMPY_CD(+)
                       AND ISS.EZCANCELFLAG             = RS1.EZCANCELFLAG(+)
                       AND ISS.INVTY_LOC_CD             = RS1.INVTY_LOC_CD(+)
                       AND RS1.GLBL_CMPY_CD             = SWH1.GLBL_CMPY_CD(+)
                       AND RS1.EZCANCELFLAG             = SWH1.EZCANCELFLAG(+)
                       AND RS1.RTL_SWH_CD               = SWH1.RTL_SWH_CD(+)
                       AND SWH1.MDSE_COST_TP_CD(+)      = #stdCostTp#
                       AND ISS.GLBL_CMPY_CD             = RS2.GLBL_CMPY_CD(+)
                       AND ISS.EZCANCELFLAG             = RS2.EZCANCELFLAG(+)
                       AND ISS.INVTY_LOC_CD             = RS2.INVTY_LOC_CD(+)
                       AND RS2.GLBL_CMPY_CD             = SWH2.GLBL_CMPY_CD(+)
                       AND RS2.EZCANCELFLAG             = SWH2.EZCANCELFLAG(+)
                       AND RS2.RTL_SWH_CD               = SWH2.RTL_SWH_CD(+)
                       AND SWH2.MDSE_COST_TP_CD(+)      = #assetRecovCostTp#
                       AND ISS.MDSE_CD                  = D.MDSE_CD
                       AND D.EZCANCELFLAG               = H.EZCANCELFLAG
                       AND D.GLBL_CMPY_CD               = H.GLBL_CMPY_CD
                       AND D.MDSE_CST_UPD_HIST_HDR_PK   = H.MDSE_CST_UPD_HIST_HDR_PK
                       AND D.MDSE_CST_UPD_STS_CD        = #mdseCstUpdStsCd#
                       AND H.EZCANCELFLAG               = UT.EZCANCELFLAG
                       AND H.GLBL_CMPY_CD               = UT.GLBL_CMPY_CD
                       AND H.MDSE_CST_UPD_TP_CD         = UT.MDSE_CST_UPD_TP_CD
                       AND UT.STD_COST_RELN_FLG         = 'N'
                       AND SWH2.MDSE_INVTY_COST_PCT IS NOT NULL
                 GROUP BY
                           ISS.MDSE_CD
                         , SWH1.MDSE_INVTY_COST_PCT
                         , SWH2.MDSE_INVTY_COST_PCT
                         , H.MDSE_CST_UPD_HIST_HDR_PK
                 <!-- END 2021/04/06 R.Azucena [QC#58419,ADD] -->
                         ) ISS
            WHERE
                H.EZCANCELFLAG = '0'
            AND H.GLBL_CMPY_CD = #glblCmpyCd#
            AND H.EZCANCELFLAG = D.EZCANCELFLAG
            AND H.GLBL_CMPY_CD = D.GLBL_CMPY_CD
            AND H.MDSE_CST_UPD_HIST_HDR_PK = D.MDSE_CST_UPD_HIST_HDR_PK
            AND H.EZCANCELFLAG = MCUT.EZCANCELFLAG
            AND H.GLBL_CMPY_CD = MCUT.GLBL_CMPY_CD
            AND H.MDSE_CST_UPD_TP_CD = MCUT.MDSE_CST_UPD_TP_CD
            AND D.EZCANCELFLAG = M.EZCANCELFLAG
            AND D.GLBL_CMPY_CD = M.GLBL_CMPY_CD
            AND D.MDSE_CD = M.MDSE_CD
            AND D.EZCANCELFLAG = MCUS.EZCANCELFLAG (+)
            AND D.GLBL_CMPY_CD = MCUS.GLBL_CMPY_CD (+)
            AND D.MDSE_CST_UPD_STS_CD = MCUS.MDSE_CST_UPD_STS_CD (+)
            AND D.MDSE_CD = ISS.MDSE_CD (+)
            <!-- 2020/01/16 QC#55445 Add Start -->
            AND D.MDSE_CST_UPD_HIST_HDR_PK = ISS.MDSE_CST_UPD_HIST_HDR_PK(+)
            <!-- 2020/01/16 QC#55445 Add End -->
            AND D.MDSE_CST_UPD_STS_CD = #mdseCstUpdStsCd#
            AND MCUT.APVL_REQ_FLG = 'Y'
            <isNotNull property="mdseCstUpdTpCd">
            AND H.MDSE_CST_UPD_TP_CD = #mdseCstUpdTpCd#
            </isNotNull>
            <isNotNull property="mdseCstUpdGrpTxt">
            AND H.MDSE_CST_UPD_GRP_TXT like #mdseCstUpdGrpTxt#
            </isNotNull>
            ORDER BY D.MDSE_CD
            ) TMP 
            <!-- 2020/01/18 S21_NA#55487 Del Start -->
    <!--        WHERE ROWNUM &lt;= #rowNum# -->
            <!-- 2020/01/18 S21_NA#55487 Del End -->
            GROUP BY
                 TMP.MDSE_CST_UPD_HIST_HDR_PK
                ,TMP.MDSE_CD
                ,TMP.MDSE_DESC_SHORT_TXT
                ,TMP.MDSE_CST_UPD_TP_CD
                ,TMP.MDSE_CST_UPD_TP_NM
                ,TMP.MDSE_CST_UPD_GRP_TXT
                ,TMP.COA_MDSE_TP_CD
                ,TMP.COA_PROD_CD
                ,TMP.THIS_MTH_TOT_STD_COST_AMT
                ,TMP.RQST_TOT_STD_COST_AMT
                ,TMP.MDSE_CST_UPD_STS_CD
                ,TMP.MDSE_CST_UPD_EFF_FROM_DT
                ,TMP.MDSE_CST_UPD_CRAT_DT
                ,TMP.EZUPTIME
                ,TMP.EZUPTIMEZONE
                ,TMP.EZUPTIME_M1
                ,TMP.EZUPTIMEZONE_M1
                ,TMP.EZUPTIME_D1
                ,TMP.EZUPTIMEZONE_D1
                ,TMP.XX_REC_HIST_CRAT_TS_H
                ,TMP.XX_REC_HIST_CRAT_BY_NM_H
                ,TMP.XX_REC_HIST_UPD_TS_H
                ,TMP.XX_REC_HIST_UPD_BY_NM_H
                ,TMP.XX_REC_HIST_TBL_NM_H
                ,TMP.XX_REC_HIST_CRAT_TS_D
                ,TMP.XX_REC_HIST_CRAT_BY_NM_D
                ,TMP.XX_REC_HIST_UPD_TS_D
                ,TMP.XX_REC_HIST_UPD_BY_NM_D
                ,TMP.XX_REC_HIST_TBL_NM_D
            ORDER BY TMP.MDSE_CD
        )
        <!-- 2020/01/18 S21_NA#55487 Add Start -->
        WHERE 
            ROWNUM &lt;= #rowNum#
        <!-- 2020/01/18 S21_NA#55487 Add End -->
    </statement>

    <statement id="isDuplicateEffectiveDate" parameterClass="Map" resultClass="Integer">
        SELECT
           COUNT(D.MDSE_CST_UPD_HIST_HDR_PK) AS CNT
        FROM
            MDSE_CST_UPD_HIST_HDR H
           ,MDSE_CST_UPD_HIST_DTL D
           ,MDSE_CST_UPD_TP MCUT
           ,MDSE M
        WHERE
            H.EZCANCELFLAG = '0'
        AND H.GLBL_CMPY_CD = #glblCmpyCd#

        AND H.EZCANCELFLAG = D.EZCANCELFLAG
        AND H.GLBL_CMPY_CD = D.GLBL_CMPY_CD
        AND H.MDSE_CST_UPD_HIST_HDR_PK = D.MDSE_CST_UPD_HIST_HDR_PK

        AND H.EZCANCELFLAG = MCUT.EZCANCELFLAG
        AND H.GLBL_CMPY_CD = MCUT.GLBL_CMPY_CD
        AND H.MDSE_CST_UPD_TP_CD = MCUT.MDSE_CST_UPD_TP_CD

        AND D.EZCANCELFLAG = M.EZCANCELFLAG
        AND D.GLBL_CMPY_CD = M.GLBL_CMPY_CD
        AND D.MDSE_CD = M.MDSE_CD

        AND D.MDSE_CST_UPD_STS_CD = #mdseCstUpdStsCd#
        AND MCUT.APVL_REQ_FLG = 'Y'
        AND D.MDSE_CD = #mdseCd#
        AND D.MDSE_CST_UPD_EFF_FROM_DT = #EffFrom#
    </statement>

    <statement id="getMaxSnapShotDt" parameterClass="Map" resultClass="String">
        SELECT
            MAX(ISS.INVTY_SNAP_SHOT_DT) AS MAX_DT
        FROM
            INVTY_SNAP_SHOT ISS
        WHERE
            ISS.GLBL_CMPY_CD = #glblCmpyCd#
        AND ISS.EZCANCELFLAG = '0'
    </statement>

</sqlMap>
