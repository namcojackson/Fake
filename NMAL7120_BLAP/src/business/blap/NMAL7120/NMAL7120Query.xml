<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NMAL7120Query">

    <typeAlias alias="NMAL7120_ACMsg"    type="business.blap.NMAL7120.NMAL7120_ACMsg"/>
    <typeAlias alias="NMAL7120_ASMsg"    type="business.blap.NMAL7120.NMAL7120_ASMsg"/>
    
    <resultMap id="result.NMAL7120_ACMsg"       class="NMAL7120_ACMsg">
        <result property="csmpContrPk_A1"       column="CSMP_CONTR_PK"          javaType="EZDCBigDecimalItem"   />
        <result property="dsAcctNum_A1"         column="DS_ACCT_NUM"            javaType="EZDCStringItem"       />
        <result property="dsAcctNm_A1"          column="DS_ACCT_NM"             javaType="EZDCStringItem"       />
        <result property="csmpNum_A1 "           column="CSMP_NUM"               javaType="EZDCStringItem"       />
        <result property="dlrRefNum_A1"         column="DLR_REF_NUM"            javaType="EZDCStringItem"       />
        <result property="prcCatgCd_A1"         column="PRC_CATG_CD"            javaType="EZDCStringItem"       />
        <result property="prcCatgNm_A1"         column="PRC_CATG_NM"            javaType="EZDCStringItem"       />
        <result property="prcContrNum_A1"       column="PRC_CONTR_NUM"          javaType="EZDCStringItem"       />
        <result property="origCoaBrCd_A1"       column="ORIG_COA_BR_CD"         javaType="EZDCStringItem"       />
        <result property="rtlDlrCd_A1"          column="RTL_DLR_CD"             javaType="EZDCStringItem"       />
        <result property="effFromDt_A1"         column="EFF_FROM_DT"            javaType="EZDCDateItem"         />
        <result property="effThruDt_A1"         column="EFF_THRU_DT"            javaType="EZDCDateItem"         />
        <result property="cusaRejDt_A1"         column="CUSA_REJ_DT"            javaType="EZDCDateItem"         />
        <result property="erlTrmnDt_A1"         column="ERL_TRMN_DT"            javaType="EZDCDateItem"         />
        <result property="rnwCsmpNum_A1"        column="RNW_CSMP_NUM"           javaType="EZDCStringItem"       />
        <result property="uplftEquipRatio_A1"   column="UPLFT_EQUIP_RATIO"      javaType="EZDCBigDecimalItem"   />
        <result property="uplftAsryRatio_A1"    column="UPLFT_ASRY_RATIO"       javaType="EZDCBigDecimalItem"   />
        <result property="csmpNumCmntTxt_A1"    column="CSMP_NUM_CMNT_TXT"      javaType="EZDCStringItem"       />
        <result property="custMbrId_A1"         column="CUST_MBR_ID"            javaType="EZDCStringItem"       />
        <result property="csmpContrActvFlg_A1"  column="CSMP_CONTR_ACTV_FLG"    javaType="EZDCStringItem"       />
        <result property="xxModeNm13Txt_A1"     column="EXPIRED"                javaType="EZDCStringItem"       />
        <result property="ezUpTime_A1"          column="EZUPTIME"               javaType="EZDCStringItem"       />
        <result property="ezUpTimeZone_A1"      column="EZUPTIMEZONE"           javaType="EZDCStringItem"       />
    </resultMap>
    
    <resultMap id="result.NMAL7120_ASMsg"       class="NMAL7120_ASMsg">
        <result property="csmpContrPk_A1"       column="CSMP_CONTR_PK"          javaType="EZDCBigDecimalItem"   />
        <result property="dsAcctNum_A1"         column="DS_ACCT_NUM"            javaType="EZDCStringItem"       />
        <result property="dsAcctNm_A1"          column="DS_ACCT_NM"             javaType="EZDCStringItem"       />
        <result property="csmpNum_A1"           column="CSMP_NUM"               javaType="EZDCStringItem"       />
        <result property="dlrRefNum_A1"         column="DLR_REF_NUM"            javaType="EZDCStringItem"       />
        <result property="prcCatgCd_A1"         column="PRC_CATG_CD"            javaType="EZDCStringItem"       />
        <result property="prcCatgNm_A1"         column="PRC_CATG_NM"            javaType="EZDCStringItem"       />
        <result property="prcContrNum_A1"       column="PRC_CONTR_NUM"          javaType="EZDCStringItem"       />
        <result property="origCoaBrCd_A1"       column="ORIG_COA_BR_CD"         javaType="EZDCStringItem"       />
        <result property="rtlDlrCd_A1"          column="RTL_DLR_CD"             javaType="EZDCStringItem"       />
        <result property="effFromDt_A1"         column="EFF_FROM_DT"            javaType="EZDCDateItem"         />
        <result property="effThruDt_A1"         column="EFF_THRU_DT"            javaType="EZDCDateItem"         />
        <result property="cusaRejDt_A1"         column="CUSA_REJ_DT"            javaType="EZDCDateItem"         />
        <result property="erlTrmnDt_A1"         column="ERL_TRMN_DT"            javaType="EZDCDateItem"         />
        <result property="rnwCsmpNum_A1"        column="RNW_CSMP_NUM"           javaType="EZDCStringItem"       />
        <result property="uplftEquipRatio_A1"   column="UPLFT_EQUIP_RATIO"      javaType="EZDCBigDecimalItem"   />
        <result property="uplftAsryRatio_A1"    column="UPLFT_ASRY_RATIO"       javaType="EZDCBigDecimalItem"   />
        <result property="csmpNumCmntTxt_A1"    column="CSMP_NUM_CMNT_TXT"      javaType="EZDCStringItem"       />
        <result property="custMbrId_A1"         column="CUST_MBR_ID"            javaType="EZDCStringItem"       />
        <result property="csmpContrActvFlg_A1"  column="CSMP_CONTR_ACTV_FLG"    javaType="EZDCStringItem"       />
        <result property="xxModeNm13Txt_A1"     column="EXPIRED"                javaType="EZDCStringItem"       />
        <result property="ezUpTime_A1"          column="EZUPTIME"               javaType="EZDCStringItem"       />
        <result property="ezUpTimeZone_A1"      column="EZUPTIMEZONE"           javaType="EZDCStringItem"       />
    </resultMap>
    <statement id ="search" parameterClass="Map" resultMap="result.NMAL7120_ASMsg">
        SELECT * FROM (
        SELECT
            CC.CSMP_CONTR_PK
           ,CC.DS_ACCT_NM
           ,CC.DS_ACCT_NUM
           ,CC.CSMP_NUM
           ,CC.DLR_REF_NUM
           ,CC.PRC_CATG_CD
           ,PC.PRC_CATG_NM
           ,PC.PRC_CONTR_NUM
           ,CC.ORIG_COA_BR_CD
           ,CC.RTL_DLR_CD
           ,CC.EFF_FROM_DT
           ,CC.EFF_THRU_DT
           ,CC.CUSA_REJ_DT
           ,CC.ERL_TRMN_DT
           ,CC.RNW_CSMP_NUM
           ,CC.UPLFT_EQUIP_RATIO
           ,CC.UPLFT_ASRY_RATIO
           ,CC.CSMP_NUM_CMNT_TXT
           ,CC.CUST_MBR_ID
           ,CC.CSMP_CONTR_ACTV_FLG
           ,CC.EZUPTIME
           ,CC.EZUPTIMEZONE
           ,CASE WHEN CC.CSMP_CONTR_ACTV_FLG ='Y' AND NVL(CC.EFF_THRU_DT, '99991231') &lt; #slsDt#
                 THEN 'Yes'
                 ELSE '' END                   AS EXPIRED
        FROM 
            CSMP_CONTR CC
           ,PRC_CATG PC
        WHERE
            CC.EZCANCELFLAG = '0'
        AND CC.GLBL_CMPY_CD = #glblCmpyCd#
        <isNotNull property="dsAcctNm">
        AND CC.DS_ACCT_NM like #dsAcctNm#
        </isNotNull>
        <isNotNull property="dsAcctNum">
        AND CC.DS_ACCT_NUM like #dsAcctNum#
        </isNotNull>
        <isNotNull property="csmpNum">
        AND CC.CSMP_NUM like #csmpNum#
        </isNotNull>
        <isNotNull property="dlrRefNum">
        AND CC.DLR_REF_NUM like #dlrRefNum#
        </isNotNull>
        <isNotNull property="prcContrNum">
        AND PC.PRC_CONTR_NUM like #prcContrNum#
        </isNotNull>
        <isNotNull property="effFromDt">
        AND CC.EFF_FROM_DT &gt;= #effFromDt#
        </isNotNull>
        <isNotNull property="erlTrmnDt">
        AND NVL(CC.EFF_THRU_DT, '99991231') &lt;= #erlTrmnDt#
        </isNotNull>
        <isNotNull property="csmpContrActvFlg">
        AND CC.CSMP_CONTR_ACTV_FLG = #csmpContrActvFlg#
        </isNotNull>
        <isNotNull property="rtlDlrCd">
        AND CC.RTL_DLR_CD like #rtlDlrCd#
        </isNotNull>
        <isNotNull property="rnwCsmpNum">
        AND CC.RNW_CSMP_NUM like #rnwCsmpNum#
        </isNotNull>
        <isNotNull property="noCSMP">
        AND CC.CSMP_NUM IS NULL
        </isNotNull>
        <isEqual property="expiredFlg" compareValue="Yes">
        AND CC.CSMP_CONTR_ACTV_FLG = 'Y'
        AND NVL(CC.EFF_THRU_DT, '99991231') &lt; #slsDt#
         </isEqual>
        <isNotNull property="prcCatgNm">
        AND PC.PRC_CATG_NM like #prcCatgNm#
        </isNotNull>
        AND CC.PRC_CATG_CD      = PC.PRC_CATG_CD (+)
        AND CC.GLBL_CMPY_CD     = PC.GLBL_CMPY_CD (+)
        AND PC.PRC_LIST_TP_CD (+)  IN (#prcListTpCd01#, #prcListTpCd02#) 
        AND PC.EZCANCELFLAG(+) = '0'
        ORDER BY
            CC.DS_ACCT_NM
           ,CC.DS_ACCT_NUM
           ,CC.CSMP_NUM
           ,CC.DLR_REF_NUM
           ,CC.EFF_FROM_DT        
        ) TMP 
        WHERE ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="searchForCSV" parameterClass="Map" resultMap="result.NMAL7120_ACMsg">
       SELECT
            CC.CSMP_CONTR_PK
           ,CC.DS_ACCT_NM
           ,CC.DS_ACCT_NUM
           ,CC.CSMP_NUM
           ,CC.DLR_REF_NUM
           ,CC.PRC_CATG_CD
           ,PC.PRC_CATG_NM
           ,PC.PRC_CONTR_NUM
           ,CC.ORIG_COA_BR_CD
           ,CC.RTL_DLR_CD
           ,CC.EFF_FROM_DT
           ,CC.EFF_THRU_DT
           ,CC.CUSA_REJ_DT
           ,CC.ERL_TRMN_DT
           ,CC.RNW_CSMP_NUM
           ,CC.UPLFT_EQUIP_RATIO
           ,CC.UPLFT_ASRY_RATIO
           ,CC.CSMP_NUM_CMNT_TXT
           ,CC.CUST_MBR_ID
           ,CC.CSMP_CONTR_ACTV_FLG
           ,CC.EZUPTIME
           ,CC.EZUPTIMEZONE
           ,CASE WHEN CC.CSMP_CONTR_ACTV_FLG ='Y' AND NVL(CC.EFF_THRU_DT, '99991231') &lt; #slsDt#
                 THEN 'Yes'
                 ELSE '' END                   AS EXPIRED
        FROM 
            CSMP_CONTR CC
           ,PRC_CATG PC
        WHERE
            CC.EZCANCELFLAG = '0'
        AND CC.GLBL_CMPY_CD = #glblCmpyCd#
        <isNotNull property="dsAcctNm">
        AND CC.DS_ACCT_NM like #dsAcctNm#
        </isNotNull>
        <isNotNull property="dsAcctNum">
        AND CC.DS_ACCT_NUM like #dsAcctNum#
        </isNotNull>
        <isNotNull property="csmpNum">
        AND CC.CSMP_NUM like #csmpNum#
        </isNotNull>
        <isNotNull property="dlrRefNum">
        AND CC.DLR_REF_NUM like #dlrRefNum#
        </isNotNull>
        <isNotNull property="prcContrNum">
        AND PC.PRC_CONTR_NUM like #prcContrNum#
        </isNotNull>
        <isNotNull property="effFromDt">
        AND CC.EFF_FROM_DT &gt;= #effFromDt#
        </isNotNull>
        <isNotNull property="erlTrmnDt">
        AND NVL(CC.EFF_THRU_DT, '99991231') &lt;= #erlTrmnDt#
        </isNotNull>
        <isNotNull property="csmpContrActvFlg">
        AND CC.CSMP_CONTR_ACTV_FLG = #csmpContrActvFlg#
        </isNotNull>
        <isNotNull property="rtlDlrCd">
        AND CC.RTL_DLR_CD like #rtlDlrCd#
        </isNotNull>
        <isNotNull property="rnwCsmpNum">
        AND CC.RNW_CSMP_NUM like #rnwCsmpNum#
        </isNotNull>
        <isNotNull property="noCSMP">
        AND CC.CSMP_NUM IS NULL
        </isNotNull>
        <isEqual property="expiredFlg" compareValue="Yes">
        AND CC.CSMP_CONTR_ACTV_FLG = 'Y'
        AND NVL(CC.EFF_THRU_DT, '99991231') &lt; #slsDt#
        </isEqual>
        <isNotNull property="prcCatgNm">
        AND PC.PRC_CATG_NM like #prcCatgNm#
        </isNotNull>
        AND CC.PRC_CATG_CD      = PC.PRC_CATG_CD (+)
        AND CC.GLBL_CMPY_CD     = PC.GLBL_CMPY_CD (+)
        AND PC.PRC_LIST_TP_CD (+)  IN (#prcListTpCd01#, #prcListTpCd02#)
        AND PC.EZCANCELFLAG(+) = '0'
        ORDER BY
            CC.DS_ACCT_NM
           ,CC.DS_ACCT_NUM
           ,CC.CSMP_NUM
           ,CC.DLR_REF_NUM
           ,CC.EFF_FROM_DT        
        
    </statement>

    <statement id ="getDsAcctCust" parameterClass="Map"  resultClass="Map">
        SELECT 
            STC.SELL_TO_CUST_CD 
           ,STC.DS_ACCT_NM 
        FROM 
            SELL_TO_CUST STC
        WHERE 
            STC.EZCANCELFLAG = '0'
        AND STC.GLBL_CMPY_CD = #glblCmpyCd#
        AND STC.SELL_TO_CUST_CD = #dsAcctNum#
        UNION ALL
        SELECT 
            DAP.DS_ACCT_NUM 
           ,DAP.DS_ACCT_NM 
        FROM 
            DS_ACCT_PROS DAP
        WHERE 
            DAP.EZCANCELFLAG = '0'
        AND DAP.GLBL_CMPY_CD = #glblCmpyCd#
        AND DAP.DS_ACCT_NUM = #dsAcctNum#
    </statement>
    
    <statement id ="getPrcCatg" parameterClass="Map"  resultClass="Map">
        SELECT 
            PC.PRC_CATG_CD 
           ,PC.PRC_CATG_NM
        FROM 
            PRC_CATG PC
           ,PRC_CTX_RELN PCR
        WHERE 
            PC.EZCANCELFLAG = '0'
        AND PC.GLBL_CMPY_CD = #glblCmpyCd#
        AND PC.PRC_CATG_NM = #prcCatgNm#
        AND PC.EZCANCELFLAG = PCR.EZCANCELFLAG
        AND PC.GLBL_CMPY_CD = PCR.GLBL_CMPY_CD
        AND PC.PRC_LIST_TP_CD = PCR.PRC_LIST_TP_CD
        AND PCR.PRC_CTX_TP_CD = '40'
    </statement>
    <statement id ="getPrcContract" parameterClass="Map"  resultClass="Map">
        SELECT 
            PC.PRC_CONTR_NUM 
           ,PC.PRC_CONTR_NM
        FROM 
            PRC_CONTR PC
        WHERE 
            PC.EZCANCELFLAG = '0'
        AND PC.GLBL_CMPY_CD = #glblCmpyCd#
        AND PC.PRC_CONTR_NUM = #prcContrNum#
    </statement>
    <statement id ="getCoaBr" parameterClass="Map"  resultClass="Map">
        SELECT 
            CB.COA_BR_CD 
           ,CB.COA_BR_NM
        FROM 
            COA_BR CB
        WHERE 
            CB.EZCANCELFLAG = '0'
        AND CB.GLBL_CMPY_CD = #glblCmpyCd#
        AND CB.COA_BR_CD = #coaBrCd#
    </statement>
    <statement id ="searchTotCnt" parameterClass="Map" resultClass="Integer">
        SELECT
            count(*)
        FROM 
            CSMP_CONTR CC
           ,PRC_CATG PC
        WHERE
            CC.EZCANCELFLAG = '0'
        AND CC.GLBL_CMPY_CD = #glblCmpyCd#
        <isNotNull property="dsAcctNm">
        AND CC.DS_ACCT_NM like #dsAcctNm#
        </isNotNull>
        <isNotNull property="dsAcctNum">
        AND CC.DS_ACCT_NUM like #dsAcctNum#
        </isNotNull>
        <isNotNull property="csmpNum">
        AND CC.CSMP_NUM like #csmpNum#
        </isNotNull>
        <isNotNull property="dlrRefNum">
        AND CC.DLR_REF_NUM like #dlrRefNum#
        </isNotNull>
        <isNotNull property="prcContrNum">
        AND PC.PRC_CONTR_NUM like #prcContrNum#
        </isNotNull>
        <isNotNull property="effFromDt">
        AND CC.EFF_FROM_DT &gt;= #effFromDt#
        </isNotNull>
        <isNotNull property="erlTrmnDt">
        AND NVL(CC.EFF_THRU_DT, '99991231') &lt;= #erlTrmnDt#
        </isNotNull>
        <isNotNull property="csmpContrActvFlg">
        AND CC.CSMP_CONTR_ACTV_FLG = #csmpContrActvFlg#
        </isNotNull>
        <isNotNull property="rtlDlrCd">
        AND CC.RTL_DLR_CD like #rtlDlrCd#
        </isNotNull>
        <isNotNull property="rnwCsmpNum">
        AND CC.RNW_CSMP_NUM like #rnwCsmpNum#
        </isNotNull>
        <isNotNull property="noCSMP">
        AND CC.CSMP_NUM IS NULL
        </isNotNull>
        
        <isEqual property="expiredFlg" compareValue="Yes">
        AND CC.CSMP_CONTR_ACTV_FLG = 'Y'
        AND NVL(CC.EFF_THRU_DT, '99991231') &lt; #slsDt#
         </isEqual>
        
        <isNotNull property="prcCatgNm">
        AND PC.PRC_CATG_NM like #prcCatgNm#
        </isNotNull>
        AND CC.PRC_CATG_CD      = PC.PRC_CATG_CD (+)

        AND CC.GLBL_CMPY_CD     = PC.GLBL_CMPY_CD (+)
        AND PC.PRC_LIST_TP_CD (+)  IN (#prcListTpCd01#, #prcListTpCd02#)
        AND PC.EZCANCELFLAG(+) = '0'
        ORDER BY
            CC.DS_ACCT_NM
           ,CC.DS_ACCT_NUM
           ,CC.CSMP_NUM
           ,CC.DLR_REF_NUM
           ,CC.PRC_CATG_CD
           ,PC.PRC_CATG_NM
           ,CC.PRC_CONTR_NUM
           ,CC.ORIG_COA_BR_CD
           ,CC.RTL_DLR_CD
           ,CC.EFF_FROM_DT
    </statement>
    
    <statement id ="getDBDuplicated" parameterClass="Map"  resultClass="Map">
        SELECT 
            CC.CSMP_CONTR_PK 
        FROM 
            CSMP_CONTR CC
        WHERE 
            CC.EZCANCELFLAG = '0'
        AND CC.GLBL_CMPY_CD = #glblCmpyCd#
        AND CC.DS_ACCT_NUM = #dsAcctNum#
        <isNotNull property="csmpNum">
        AND CC.CSMP_NUM = #csmpNum#
        </isNotNull>
        <isNull property="csmpNum">
        AND CC.CSMP_NUM IS NULL
        </isNull>
        <isNotNull property="dlrRefNum">
        AND CC.DLR_REF_NUM = #dlrRefNum#
        </isNotNull>
        <isNull property="dlrRefNum">
        AND CC.DLR_REF_NUM IS NULL
        </isNull>
        
        AND ((CC.EFF_FROM_DT &lt;= #effFromDt#
        AND NVL(CC.EFF_THRU_DT, '99991231') &gt;= #effFromDt#)
        OR
        (CC.EFF_FROM_DT &lt;= #effThruDt#
        AND NVL(CC.EFF_THRU_DT, '99991231') &gt;= #effThruDt#)
        OR
        (CC.EFF_FROM_DT &gt;= #effFromDt#
        AND NVL(CC.EFF_THRU_DT, '99991231') &lt;= #effThruDt#)
        )
        
        <isNotNull property="targetDeleteFlg">
        AND CC.CSMP_CONTR_PK NOT IN
        <iterate property="targetDeleteList" var="targetDelete[]" open="(" close=" )" conjunction=",">
             #targetDelete[]#
        </iterate>
        </isNotNull>
        <isNotNull property="excludeScreenMsgFlg">
        AND CC.CSMP_CONTR_PK NOT IN
        <iterate property="excludeScreenMsgList" var="excludeScreenMsg[]" open="(" close=" )" conjunction=",">
             #excludeScreenMsg[]#
        </iterate>
        </isNotNull>

    </statement>
</sqlMap>
