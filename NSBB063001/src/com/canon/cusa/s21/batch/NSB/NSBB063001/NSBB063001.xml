<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSBB063001">
    <statement id="getInputData" parameterClass="Map" resultClass="Map">
        SELECT
             USG.FSR_NUM                                    AS FSR_NUM
            ,USG.DS_SVC_CALL_TP_CD                          AS DS_SVC_CALL_TP_CD
            ,USG.MDSE_CD                                    AS MDSE_CD
            ,USG.SVC_PRT_QTY                                AS SVC_PRT_QTY
            ,USG.PRT_USED_BY_TECH_CD                        AS PRT_USED_BY_TECH_CD
            ,CASE WHEN MD.THIS_MTH_TOT_STD_COST_AMT * USG.SVC_PRT_QTY &gt; #maxAmt#
                 THEN #maxAmt#
                 ELSE MD.THIS_MTH_TOT_STD_COST_AMT * USG.SVC_PRT_QTY
             END AS THIS_MTH_TOT_STD_COST_AMT
            ,#cashDiscPct#                                  AS CASH_DISC_PCT
            ,''                                             AS FILL_1_TXT_01
            ,TASK.MDL_GRP_NM                                AS MDL_GRP_NM
            ,TASK.SER_NUM                                   AS SER_NUM
            ,MACH.SVC_CONFIG_MSTR_PK                        AS SVC_CONFIG_MSTR_PK
            ,CONTR.CONTR_VRSN_EFF_FROM_DT                   AS CONTR_VRSN_EFF_FROM_DT
            ,VISIT.FSR_VISIT_ARV_DT                         AS FSR_VISIT_ARV_DT
            ,#fill1Txt_02#                                  AS FILL_1_TXT_02
            ,CASE    
                WHEN TO_NUMBER(VISIT.PREV_FSR_VISIT_NUM) &gt; #prevFsrVisitNum_1#
                THEN 'Y'
                ELSE 'N'
            END                                             AS FILL_1_TXT_03
        FROM
             FSR            FSR
            ,SVC_TASK       TASK 
            ,FSR_VISIT      VISIT
            ,FSR_USG        USG
            ,SVC_MACH_MSTR  MACH
            ,MDSE           MD
            ,DS_CONTR       CONTR
            ,DS_CONTR_DTL   CONTRDTL
            ,DS_CONTR_DTL_STS_V CNTRDTLSTS
        WHERE
                FSR.GLBL_CMPY_CD            = #glblCmpyCd#
            AND FSR.EZUPTIME             &gt; TO_CHAR(TO_TIMESTAMP(ADD_MONTHS(LAST_DAY(TO_DATE(#slsDt#, 'YYYYMMDD')), #addMonth#)), 'YYYYMMDDHH24MISSFF3')
            AND FSR.EZUPTIME             &lt; TO_CHAR(TO_TIMESTAMP(TO_DATE(#slsDt#, 'YYYYMMDD') + 1), 'YYYYMMDDHH24MISSFF3')
            AND FSR.GLBL_CMPY_CD            = VISIT.GLBL_CMPY_CD
            AND FSR.FSR_NUM                 = VISIT.FSR_NUM
            AND VISIT.GLBL_CMPY_CD          = TASK.GLBL_CMPY_CD
            AND VISIT.FSR_NUM               = TASK.FSR_NUM
            AND VISIT.SVC_TASK_NUM          = TASK.SVC_TASK_NUM
            AND VISIT.GLBL_CMPY_CD          = USG.GLBL_CMPY_CD
            AND VISIT.FSR_NUM               = USG.FSR_NUM
            AND VISIT.FSR_VISIT_NUM         = USG.FSR_VISIT_NUM
            AND TASK.GLBL_CMPY_CD           = MACH.GLBL_CMPY_CD
            AND TASK.SVC_MACH_MSTR_PK       = MACH.SVC_MACH_MSTR_PK
            AND USG.GLBL_CMPY_CD            = MD.GLBL_CMPY_CD
            AND USG.MDSE_CD                 = MD.MDSE_CD
            AND MACH.GLBL_CMPY_CD           = CONTRDTL.GLBL_CMPY_CD(+)
            AND MACH.SVC_MACH_MSTR_PK       = CONTRDTL.SVC_MACH_MSTR_PK(+)
            AND TASK.SVC_TASK_RCV_DT        &gt;= CONTRDTL.CONTR_EFF_FROM_DT(+)
            AND TASK.SVC_TASK_RCV_DT        &lt;= CONTRDTL.CONTR_EFF_THRU_DT(+)
            AND CONTRDTL.GLBL_CMPY_CD       = CNTRDTLSTS.GLBL_CMPY_CD(+)
            AND CONTRDTL.DS_CONTR_DTL_PK    = CNTRDTLSTS.DS_CONTR_DTL_PK(+)
            AND CNTRDTLSTS.DS_CONTR_CTRL_STS_CD(+) &lt;&gt; #dsContrCtrlStsCd_cancelled#
            AND CONTRDTL.GLBL_CMPY_CD       = CONTR.GLBL_CMPY_CD(+)
            AND CONTRDTL.DS_CONTR_PK        = CONTR.DS_CONTR_PK(+)
            AND CONTR.DS_CONTR_CATG_CD(+)   &lt;&gt; #dsCntrCatgCd_warranty#
            AND FSR.EZCANCELFLAG            = '0'
            AND TASK.EZCANCELFLAG           = '0'
            AND VISIT.EZCANCELFLAG          = '0'
            AND USG.EZCANCELFLAG            = '0'
            AND MACH.EZCANCELFLAG           = '0'
            AND MD.EZCANCELFLAG             = '0'
            AND CONTR.EZCANCELFLAG(+)       = '0'
            AND CONTRDTL.EZCANCELFLAG(+)    = '0'
            AND CNTRDTLSTS.EZCANCELFLAG(+)  = '0'
        ORDER BY
             FSR_VISIT_ARV_DT   ASC
            ,USG.FSR_NUM        ASC
            ,TASK.SER_NUM       ASC
            ,USG.MDSE_CD        ASC
    </statement>
</sqlMap>
