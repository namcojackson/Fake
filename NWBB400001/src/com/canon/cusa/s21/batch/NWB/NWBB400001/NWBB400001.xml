<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWBB400001">

    <typeAlias alias="CTAC_PSNTMsg" type="business.db.CTAC_PSNTMsg"/>
    <typeAlias alias="DS_CPO_RTRN_PRC_DTLTMsg" type="business.db.DS_CPO_RTRN_PRC_DTLTMsg"/>

    <statement id="getOrderCloseData" parameterClass="Map">
        SELECT
            DCRD.ORIG_INV_NUM                   AS ORIG_INV_NUM
            ,NVL(ORIG_I.NET_DUE_DT, #slsDt#)    AS NET_DUE_DT
            ,C.CPO_ORD_NUM                      AS CPO_ORD_NUM
            ,C.CPO_ORD_TS                       AS CPO_ORD_TS
            ,C.CUST_ISS_PO_NUM                  AS CUST_ISS_PO_NUM
            ,C.CUST_ISS_PO_DT                   AS CUST_ISS_PO_DT
            ,DCC.BILL_TO_CUST_LOC_CD            AS BILL_TO_CUST_LOC_CD
            ,C.SELL_TO_CUST_CD                  AS SELL_TO_CUST_CD
            ,STC.LOC_NM                         AS LOC_NM
            ,STC.ADDL_LOC_NM                    AS ADDL_LOC_NM
            ,STC.FIRST_LINE_ADDR                AS FIRST_LINE_ADDR
            ,STC.SCD_LINE_ADDR                  AS SCD_LINE_ADDR
            ,STC.THIRD_LINE_ADDR                AS THIRD_LINE_ADDR
            ,STC.FRTH_LINE_ADDR                 AS FRTH_LINE_ADDR
            ,STC.CTY_ADDR                       AS CTY_ADDR
            ,STC.PROV_NM                        AS PROV_NM
            ,STC_C.CNTY_NM                      AS CNTY_NM_STC_C
            ,STC.ST_CD                          AS ST_CD
            ,STC.POST_CD                        AS POST_CD
            ,STC.CTRY_CD                        AS CTRY_CD
            ,C.SELL_TO_FIRST_REF_CMNT_TXT       AS SELL_TO_FIRST_REF_CMNT_TXT
            ,C.SELL_TO_SCD_REF_CMNT_TXT         AS SELL_TO_SCD_REF_CMNT_TXT
            ,C.ADV_RCPT_NUM                     AS ADV_RCPT_NUM
            ,NVL(ORIG_I.INV_DT, #slsDt#)        AS INV_DT
            ,DCRD.PMT_TERM_CD                   AS PMT_TERM_CD
            ,P.PMT_TERM_NM                      AS PMT_TERM_NM
            ,DCRD.CASH_DISC_TERM_CD             AS CASH_DISC_TERM_CD
            ,C.ADMIN_PSN_CD                     AS ADMIN_PSN_CD
            ,MTD_1.MSG_TXT_INFO_TXT             AS MSG_TXT_INFO_TXT1
            ,MTD_2.MSG_TXT_INFO_TXT             AS MSG_TXT_INFO_TXT2
            ,MTD_3.MSG_TXT_INFO_TXT             AS MSG_TXT_INFO_TXT3
            ,MTD_4.MSG_TXT_INFO_TXT             AS MSG_TXT_INFO_TXT4
            ,DCRD.CCY_CD                        AS CCY_CD
            ,DCRD.EXCH_RATE                     AS EXCH_RATE
            ,BTC.FL_PLN_CMPY_FLG                AS FL_PLN_CMPY_FLG
            ,C.SYS_SRC_CD                       AS SYS_SRC_CD
            ,DCRD.PMT_TERM_CASH_DISC_CD         AS PMT_TERM_CASH_DISC_CD
            ,C.DS_ORD_TP_CD                     AS DS_ORD_TP_CD
            ,C.DS_ORD_RSN_CD                    AS DS_ORD_RSN_CD
            ,C.INV_RCPNT_CUST_CD                AS INV_RCPNT_CUST_CD
            ,DCCD.CR_CARD_CUST_REF_NUM          AS CR_CARD_CUST_REF_NUM
            ,DCCD.CR_CARD_TP_CD                 AS CR_CARD_TP_CD
            ,DCCD.CR_CARD_EXPR_YR_MTH           AS CR_CARD_EXPR_YR_MTH
            ,DOTPD.DS_INV_TP_CD                 AS DS_INV_TP_CD
            ,C.SLS_REP_TOC_CD                   AS SLS_REP_TOC_CD
            ,C.BILL_TO_CUST_ACCT_CD             AS BILL_TO_CUST_ACCT_CD
            ,C.SOLD_TO_CUST_LOC_CD              AS SOLD_TO_CUST_LOC_CD
            ,DOTPD.LINE_BIZ_TP_CD               AS LINE_BIZ_TP_CD
            ,DOTPD.INV_PRINT_STYLE_CD           AS INV_PRINT_STYLE_CD
            ,DCRD.INVTY_LOC_CD                  AS INVTY_LOC_CD
            ,DCC.SHIP_TO_CUST_LOC_CD            AS SHIP_TO_CUST_LOC_CD
            ,DCC.DROP_SHIP_FLG                  AS DROP_SHIP_FLG
            ,DCC.SHIP_TO_LOC_NM                 AS SHIP_TO_LOC_NM
            ,DCC.SHIP_TO_ADDL_LOC_NM            AS SHIP_TO_ADDL_LOC_NM
            ,DCC.SHIP_TO_FIRST_LINE_ADDR        AS SHIP_TO_FIRST_LINE_ADDR
            ,DCC.SHIP_TO_SCD_LINE_ADDR          AS SHIP_TO_SCD_LINE_ADDR
            ,DCC.SHIP_TO_THIRD_LINE_ADDR        AS SHIP_TO_THIRD_LINE_ADDR
            ,DCC.SHIP_TO_FRTH_LINE_ADDR         AS SHIP_TO_FRTH_LINE_ADDR
            ,DCC.SHIP_TO_CTY_ADDR               AS SHIP_TO_CTY_ADDR
            ,DCC.SHIP_TO_CNTY_NM                AS SHIP_TO_CNTY_NM
            ,DCC.SHIP_TO_PROV_NM                AS SHIP_TO_PROV_NM
            ,DCC.SHIP_TO_ST_CD                  AS SHIP_TO_ST_CD
            ,DCC.SHIP_TO_POST_CD                AS SHIP_TO_POST_CD
            ,DCC.SHIP_TO_CTRY_CD                AS SHIP_TO_CTRY_CD
            ,DCC.SHIP_TO_FIRST_REF_CMNT_TXT     AS SHIP_TO_FIRST_REF_CMNT_TXT
            ,DCC.SHIP_TO_SCD_REF_CMNT_TXT       AS SHIP_TO_SCD_REF_CMNT_TXT
            ,DCC.SHIP_TO_CUST_ACCT_CD           AS SHIP_TO_CUST_ACCT_CD
            ,DCRD.DS_CPO_RTRN_LINE_NUM          AS DS_CPO_RTRN_LINE_NUM
            ,DCRD.DS_CPO_RTRN_LINE_SUB_NUM      AS DS_CPO_RTRN_LINE_SUB_NUM
            ,DCRD.STK_STS_CD                    AS STK_STS_CD
            ,DCRD.SLS_REP_OR_SLS_TEAM_TOC_CD    AS SLS_REP_OR_SLS_TEAM_TOC_CD
            ,DCRD.MDSE_CD                       AS MDSE_CD
            ,DCRD.MDSE_NM                       AS MDSE_NM
            ,M.COA_PROD_CD                      AS COA_PROD_CD
            ,DCRD.TRX_CD                        AS TRX_CD
            ,DCRD.TRX_RSN_CD                    AS TRX_RSN_CD
            ,DCRD.ORD_QTY                       AS ORD_QTY
            ,DCRD.RTRN_QTY                      AS RTRN_QTY
            ,DCRD.MAN_PRC_FLG                   AS MAN_PRC_FLG
            ,DCRD.ENT_DEAL_NET_UNIT_PRC_AMT     AS ENT_DEAL_NET_UNIT_PRC_AMT
            ,DCRD.ENT_CPO_DTL_DEAL_NET_AMT      AS ENT_CPO_DTL_DEAL_NET_AMT
            ,PRC.DEAL_DISC_AMT                  AS DEAL_DISC_AMT
            ,DCRD.ENT_FUNC_NET_UNIT_PRC_AMT     AS ENT_FUNC_NET_UNIT_PRC_AMT
            ,DCRD.ENT_CPO_DTL_FUNC_NET_AMT      AS ENT_CPO_DTL_FUNC_NET_AMT
            ,PRC.FUNC_DISC_AMT                  AS FUNC_DISC_AMT
            ,DCRD.TAX_FLG                       AS TAX_FLG
            ,C.COA_ACCT_CD                      AS COA_ACCT_CD
            ,C.COA_PROJ_CD                      AS COA_PROJ_CD
            ,DCRD.SET_MDSE_CD                   AS SET_MDSE_CD
            ,DCRD.DEAL_PRC_LIST_PRC_AMT         AS DEAL_PRC_LIST_PRC_AMT
            ,DCRD.ENT_CPO_DTL_DEAL_SLS_AMT      AS ENT_CPO_DTL_DEAL_SLS_AMT
            ,DCRD.FUNC_PRC_LIST_PRC_AMT         AS FUNC_PRC_LIST_PRC_AMT
            ,DCRD.ENT_CPO_DTL_FUNC_SLS_AMT      AS ENT_CPO_DTL_FUNC_SLS_AMT
            ,DCRD.SVC_CONFIG_MSTR_PK            AS SVC_CONFIG_MSTR_PK
            ,DCRD.DS_CONTR_NUM                  AS DS_CONTR_NUM
            ,DCRD.DS_CONTR_SQ_NUM               AS DS_CONTR_SQ_NUM
            ,DCRD.FIRST_BLLG_ATTRB_VAL_TXT      AS FIRST_BLLG_ATTRB_VAL_TXT
            ,DCRD.SCD_BLLG_ATTRB_VAL_TXT        AS SCD_BLLG_ATTRB_VAL_TXT
            ,DCRD.THIRD_BLLG_ATTRB_VAL_TXT      AS THIRD_BLLG_ATTRB_VAL_TXT
            ,DCRD.FRTH_BLLG_ATTRB_VAL_TXT       AS FRTH_BLLG_ATTRB_VAL_TXT
            ,DCRD.FIFTH_BLLG_ATTRB_VAL_TXT      AS FIFTH_BLLG_ATTRB_VAL_TXT
            ,DCRD.SIXTH_BLLG_ATTRB_VAL_TXT      AS SIXTH_BLLG_ATTRB_VAL_TXT
            ,DCRD.CUST_UOM_CD                   AS CUST_UOM_CD
            ,DCRD.DS_ORD_POSN_NUM               AS DS_ORD_POSN_NUM
            ,DCRD.DS_CPO_LINE_NUM               AS DS_CPO_LINE_NUM
            ,DCRD.DS_CPO_LINE_SUB_NUM           AS DS_CPO_LINE_SUB_NUM
            ,DIT.TAX_CALC_FLG                   AS TAX_CALC_FLG
            ,DIT.TAX_EXEM_FLG                   AS TAX_EXEM_FLG
            ,DIT.TAX_EXEM_RSN_CD                AS TAX_EXEM_RSN_CD
            ,NVL(DIT.CR_DS_INV_TP_CD, DIT.DS_INV_TP_CD)  AS CR_DS_INV_TP_CD
            ,C.LEASE_PRCH_OPT_CD               	 AS LEASE_END_TERM_PRCH_OPT_CD
            ,NVL(ORIG_I.INV_DT, #slsDt#)        AS INV_DT_ORIG_I
            ,M.SVC_ALLOC_TP_CD                  AS SVC_ALLOC_TP_CD
            ,SAT.SVC_ALLOC_TRX_TP_NM            AS SVC_ALLOC_TRX_TP_NM
            ,M.TAX_EXEM_TP_CD                   AS TAX_EXEM_TP_CD
            ,BTC.DS_TAX_GRP_EXEM_CD             AS DS_TAX_GRP_EXEM_CD_DBTC
            ,DAC_B.DS_TAX_GRP_EXEM_CD           AS DS_TAX_GRP_EXEM_CD_DAC_B
            ,DTGE_B_L.DS_TAX_GRP_EXEM_RESL_FLG  AS DS_TAX_GRP_EXEM_RESL_FLG_L
            ,DTGE_B_A.DS_TAX_GRP_EXEM_RESL_FLG  AS DS_TAX_GRP_EXEM_RESL_FLG_A
            ,STCS.DS_TAX_GRP_EXEM_CD            AS DS_TAX_GRP_EXEM_CD_DSTC
            ,DAC_S.DS_TAX_GRP_EXEM_CD           AS DS_TAX_GRP_EXEM_CD_DAC_S
            ,DCC.DS_CPO_CONFIG_PK               AS DS_CPO_CONFIG_PK
            ,BTC.LOC_NUM                        AS LOC_NUM
            ,CASE WHEN NVL(OPT.INV_CRAT_PROC_FLG, 'N') = 'Y' AND NVL(OPT.RTRN_PROC_FLG, 'N') = 'Y' THEN 'Y' ELSE 'N' END AS INV_CRAT_FLG
            ,DCRD.CR_REBIL_CD                   AS CR_REBIL_CD
            ,M.IMG_SPLY_TP_CD                   AS IMG_SPLY_TP_CD
            ,STCS.GEO_CD                        AS GEO_CD
            ,STCS.DS_INSD_CTY_LIMIT_FLG         AS DS_INSD_CTY_LIMIT_FLG
            ,NVL(TA.TAX_AREA_ID, NVL(TA1.TAX_AREA_ID, TA2.TAX_AREA_ID)) AS TAX_AREA_ID
            ,S21P.GEO_CD                        AS GEO_CD_S21P
            ,S21P.DS_INSD_CTY_LIMIT_FLG         AS DS_INSD_CTY_LIMIT_FLG_S21P
            ,S21P.FIRST_LINE_ADDR               AS FIRST_LINE_ADDR_S21P
            ,S21P.SCD_LINE_ADDR                 AS SCD_LINE_ADDR_S21P
            ,S21P.CTY_ADDR                      AS CTY_ADDR_S21P
            ,S21P.ST_CD                         AS ST_CD_S21P
            ,CNTY_REP.CNTY_NM                   AS CNTY_NM_S21P
            ,S21P.POST_CD                       AS POST_CD_S21P
            ,S21P.CTRY_CD                       AS CTRY_CD_S21P
            ,RW.GEO_CD                          AS GEO_CD_RW
            ,DCRD.RTL_WH_CD                     AS RTL_WH_CD
            ,RW.FIRST_LINE_ADDR                 AS FIRST_LINE_ADDR_RW
            ,RW.SCD_LINE_ADDR                   AS SCD_LINE_ADDR_RW
            ,RW.CTY_ADDR                        AS CTY_ADDR_RW
            ,RW.ST_CD                           AS ST_CD_RW
            ,CNTY_WH.CNTY_NM                    AS CNTY_NM
            ,RW.POST_CD                         AS POST_CD_RW
            ,RW.CTRY_CD                         AS CTRY_CD_RW
            ,DCRD.SVC_MACH_MSTR_PK              AS SVC_MACH_MSTR_PK
            ,DCRD.PRC_CATG_CD                   AS PRC_CATG_CD
            ,C.DS_ORD_CATG_CD                   AS DS_ORD_CATG_CD
            ,DCRD.DS_ORD_LINE_CATG_CD           AS DS_ORD_LINE_CATG_CD
            ,C.CR_REBIL_RSN_CATG_CD
            ,M.SHPG_SER_TAKE_FLG
            <!-- QC#26415 Add Start -->
            ,NVL(DCRD.CUST_MDSE_CD,DCRD.ORIG_MDSE_CD) AS ORIG_OR_CUST_MDSE_CD
            <!-- QC#26415 Add End -->
            <!-- QC#28383 2018/10/02 add start -->
            ,M.INVTY_CTRL_FLG                   AS INVTY_CTRL_FLG
            ,M.INSTL_BASE_CTRL_FLG              AS INSTL_BASE_CTRL_FLG
            ,DM.SVC_MDL_TP_CD                   AS SVC_MDL_TP_CD
            ,DCC.SVC_CONFIG_MSTR_PK             AS SVC_CONFIG_MSTR_PK
            <!-- QC#28383 2018/10/02 add end -->
            <!-- QC#27299 2018/11/15 add start -->
            ,CASE 
                WHEN EXISTS (SELECT 1 FROM CPO_DTL CD WHERE CD.CPO_ORD_NUM = C.CPO_ORD_NUM AND CD.CR_REBIL_CD = #crRebillcredit# AND CD.GLBL_CMPY_CD= #glblCmpyCd# AND CD.EZCANCELFLAG='0') THEN
                  'Y'
                ELSE
                  'N'
             END                                AS ORD_MIX_FLG
            ,DCRD.ORIG_INVTY_LOC_CD             AS ORIG_INVTY_LOC_CD
            ,DCC.ORIG_SHIP_TO_CUST_LOC_CD       AS ORIG_SHIP_TO_CUST_LOC_CD
            ,DCC.ORIG_SHIP_TO_LOC_NM            AS ORIG_SHIP_TO_LOC_NM
            ,DCC.ORIG_SHIP_TO_ADDL_LOC_NM       AS ORIG_SHIP_TO_ADDL_LOC_NM
            ,DCC.ORIG_SHIP_FIRST_LINE_ADDR      AS ORIG_SHIP_FIRST_LINE_ADDR
            ,DCC.ORIG_SHIP_SCD_LINE_ADDR        AS ORIG_SHIP_SCD_LINE_ADDR
            ,DCC.ORIG_SHIP_THIRD_LINE_ADDR      AS ORIG_SHIP_THIRD_LINE_ADDR
            ,DCC.ORIG_SHIP_FRTH_LINE_ADDR       AS ORIG_SHIP_FRTH_LINE_ADDR
            ,DCC.ORIG_SHIP_TO_CTY_ADDR          AS ORIG_SHIP_TO_CTY_ADDR
            ,DCC.ORIG_SHIP_TO_ST_CD             AS ORIG_SHIP_TO_ST_CD
            ,DCC.ORIG_SHIP_TO_CNTY_NM           AS ORIG_SHIP_TO_CNTY_NM
            ,DCC.ORIG_SHIP_TO_POST_CD           AS ORIG_SHIP_TO_POST_CD
            ,DCC.ORIG_SHIP_TO_CTRY_CD           AS ORIG_SHIP_TO_CTRY_CD
            ,ORIG_STCS_S.GEO_CD                 AS ORIG_GEO_CD
            ,ORIG_STCS_S.DS_INSD_CTY_LIMIT_FLG  AS ORIG_DS_INSD_CTY_LIMIT_FLG
            ,ORIG_STCS_S.SELL_TO_CUST_CD        AS ORIG_SHIP_TO_CUST_ACCT_CD
            ,ORIG_STCS_S.DS_TAX_GRP_EXEM_CD     AS ORIG_DS_TAX_GRP_EXEM_CD_DSTC
            ,ORIG_STC_S.DS_TAX_GRP_EXEM_CD      AS ORIG_DS_TAX_GRP_EXEM_CD_DAC_S
            ,NVL(ORIG_TA.TAX_AREA_ID, NVL(ORIG_TA1.TAX_AREA_ID, ORIG_TA2.TAX_AREA_ID)) AS ORIG_TAX_AREA_ID
            ,ORIG_DIL_V.GEO_CD                  AS ORIG_GEO_CD_RW
            ,ORIG_DIL_V.RTL_WH_CD               AS ORIG_RTL_WH_CD
            ,ORIG_DIL_V.FIRST_LINE_ADDR         AS ORIG_FIRST_LINE_ADDR_RW
            ,ORIG_DIL_V.SCD_LINE_ADDR           AS ORIG_SCD_LINE_ADDR_RW
            ,ORIG_DIL_V.CTY_ADDR                AS ORIG_CTY_ADDR_RW
            ,ORIG_DIL_V.ST_CD                   AS ORIG_ST_CD_RW
            ,ORIG_DIL_V.POST_CD                 AS ORIG_POST_CD_RW
            ,ORIG_DIL_V.CTRY_CD                 AS ORIG_CTRY_CD_RW
            ,ORIG_CNTY_WH.CNTY_NM               AS ORIG_CNTY_NM
            <!-- QC#27299 2018/11/15 add end -->
          FROM
              CPO C
             ,DS_CPO_RTRN_DTL DCRD
             ,ALL_MDSE_V M
             ,DS_CPO_RTRN_DTL DCRD_B
             ,ALL_MDSE_V M_B
             ,INV ORIG_I
             ,DS_CPO_CONFIG DCC
             ,SELL_TO_CUST STC
             ,CNTY STC_C
             ,PMT_TERM P
             ,MSG_TXT_DTL MTD_1
             ,MSG_TXT_DTL MTD_2
             ,MSG_TXT_DTL MTD_3
             ,MSG_TXT_DTL MTD_4
             ,BILL_TO_CUST BTC
             ,DS_CR_CARD DCCD
             ,DS_ORD_TP_PROC_DFN DOTPD
             ,(SELECT
                  CPO_ORD_NUM
                 ,DS_CPO_RTRN_LINE_NUM
                 ,DS_CPO_RTRN_LINE_SUB_NUM
                 ,SUM(DEAL_DISC_AMT) DEAL_DISC_AMT
                 ,SUM(FUNC_DISC_AMT) FUNC_DISC_AMT
              FROM DS_CPO_RTRN_PRC_DTL
              WHERE
                  EZCANCELFLAG = '0'
              AND GLBL_CMPY_CD = #glblCmpyCd#
              GROUP BY
                  CPO_ORD_NUM,
                  DS_CPO_RTRN_LINE_NUM,
                  DS_CPO_RTRN_LINE_SUB_NUM ) PRC
             ,DS_INV_TP DIT
             ,SVC_ALLOC_TP SAT
             ,SELL_TO_CUST DAC_B
             ,DS_TAX_GRP_EXEM DTGE_B_L
             ,DS_TAX_GRP_EXEM DTGE_B_A
             ,SHIP_TO_CUST STCS
             ,SELL_TO_CUST DAC_S
             ,DS_ORD_LINE_CATG DOLC
             ,TAX_AREA TA
             ,TAX_AREA TA1
             ,TAX_AREA TA2
             ,CNTY CNTY
             ,TOC T
             ,ORG_FUNC_ASG OFA
             ,S21_PSN S21P
             ,CNTY CNTY_REP
             ,RTL_WH RW
             ,CNTY CNTY_WH
             ,DS_ORD_LINE_PROC_DFN DOLPD
             ,ORD_PROC_TP OPT
             <!-- QC#28383 2018/10/02 add start -->
             ,DS_MDL DM
             <!-- QC#28383 2018/10/02 add end -->
             <!-- QC#27299 2018/11/15 add start -->
             ,SHIP_TO_CUST ORIG_STCS_S
             ,SELL_TO_CUST ORIG_STC_S
             ,DS_INVTY_LOC_V ORIG_DIL_V
             ,CNTY ORIG_CNTY_WH
             ,CNTY ORIG_CNTY
             ,TAX_AREA ORIG_TA
             ,TAX_AREA ORIG_TA1
             ,TAX_AREA ORIG_TA2
             <!-- QC#27299 2018/11/15 add end -->
          WHERE
              C.EZCANCELFLAG        = '0'
          AND C.GLBL_CMPY_CD        = #glblCmpyCd#  --'ADB'
          AND C.ORD_HDR_STS_CD      = #ordHdrSts#  --Validated
          AND C.OPEN_FLG            = 'Y'   --Open
          AND DCRD.EZCANCELFLAG     = '0'
          AND C.GLBL_CMPY_CD        = DCRD.GLBL_CMPY_CD
          AND C.CPO_ORD_NUM         = DCRD.CPO_ORD_NUM
          AND DCRD.OPEN_FLG       = 'Y'  --Open
          AND M.EZCANCELFLAG (+)    = '0'
          AND DCRD.GLBL_CMPY_CD     = M.GLBL_CMPY_CD(+)
          AND DCRD.MDSE_CD          = M.MDSE_CD(+)
          AND NOT EXISTS (SELECT '1' FROM HLD     --Header Hold N
              WHERE EZCANCELFLAG    = '0'
              AND GLBL_CMPY_CD      = C.GLBL_CMPY_CD
              AND CPO_ORD_NUM       = C.CPO_ORD_NUM
              AND CPO_DTL_LINE_NUM IS NULL
              AND CPO_DTL_LINE_SUB_NUM IS NULL
              AND REL_FLG = 'N')
          AND NOT EXISTS (SELECT '1' FROM HLD     --No Line Hold
              WHERE EZCANCELFLAG    = '0'
              AND GLBL_CMPY_CD      = C.GLBL_CMPY_CD
              AND CPO_ORD_NUM       = C.CPO_ORD_NUM
              AND CPO_DTL_LINE_NUM  = DCRD.DS_CPO_RTRN_LINE_NUM
              AND CPO_DTL_LINE_SUB_NUM = DCRD.DS_CPO_RTRN_LINE_SUB_NUM
              AND TRX_SRC_TP_CD     = #trxSrcTpCd# --Whole Sales Return
              AND REL_FLG           = 'N')
          AND C.ORD_BOOK_FLG        = 'Y'  --Header is Booked
          AND 
          (
              (
                  M.INVTY_CTRL_FLG        = 'Y'
              AND DCRD.RTRN_LINE_STS_CD   = #rtrnLineStsCdReceived#
              AND EXISTS ( SELECT '1' FROM RWS_HDR RH, RWS_DTL RL
                  WHERE RH.RWS_NUM    = RL.RWS_NUM
                  AND RH.RWS_STS_CD  = #rwsStsRcv#
                  AND RH.TRX_ORD_NUM      = C.CPO_ORD_NUM
                  AND RL.TRX_LINE_NUM = DCRD.DS_CPO_RTRN_LINE_NUM
                  AND RL.TRX_LINE_SUB_NUM = DCRD.DS_CPO_RTRN_LINE_SUB_NUM)
              )
              OR
              (
                  M.INVTY_CTRL_FLG        = 'N'
                  <!-- QC#26657 -->
<!--              AND DCRD.RTRN_LINE_STS_CD   in (#rtrnLineStsCdBooked#, #rtrnLineStsCdReceived#)-->
                  AND (DCRD.RTRN_LINE_STS_CD   = #rtrnLineStsCdReceived#
                    OR (
                      M.MDSE_TP_CD               != #mdseTpSet#
                      AND DCRD.RTRN_LINE_STS_CD   = #rtrnLineStsCdBooked#
                    )
                  )
                  <!-- QC#26657 -->
              )
          )
          AND DCRD_B.EZCANCELFLAG (+)       = '0'        --Ref
          AND DCRD.GLBL_CMPY_CD             = DCRD_B.GLBL_CMPY_CD (+)               --Ref
          AND DCRD.CPO_ORD_NUM              = DCRD_B.CPO_ORD_NUM (+)                --Ref

          AND DCRD.REF_CPO_DTL_LINE_NUM     = DCRD_B.DS_CPO_RTRN_LINE_NUM (+)       --Ref
          AND DCRD.REF_CPO_DTL_LINE_SUB_NUM = DCRD_B.DS_CPO_RTRN_LINE_SUB_NUM (+)   --Ref
          AND M_B.EZCANCELFLAG (+)          = '0'        --Ref
          AND DCRD_B.GLBL_CMPY_CD           = M_B.GLBL_CMPY_CD (+)                  --Ref
          AND DCRD_B.MDSE_CD                = M_B.MDSE_CD (+)
          AND NOT EXISTS (SELECT '1' FROM HLD                                       --Ref Line not Hold
              WHERE EZCANCELFLAG            = '0'
              AND GLBL_CMPY_CD              = C.GLBL_CMPY_CD
              AND CPO_ORD_NUM               = C.CPO_ORD_NUM
              AND CPO_DTL_LINE_NUM          = DCRD_B.DS_CPO_RTRN_LINE_NUM
              AND CPO_DTL_LINE_SUB_NUM      = DCRD_B.DS_CPO_RTRN_LINE_SUB_NUM
              AND TRX_SRC_TP_CD             = #trxSrcTpCd#                           --Whole Sales Return
              AND REL_FLG = 'N'
          )
           --SET Hasn't UnEntry, UnProgress
          AND NOT EXISTS (
              SELECT '1' FROM DS_CPO_RTRN_DTL D, ALL_MDSE_V M
              WHERE
                  DCRD_B.SET_MDSE_CD          IS NOT NULL
              AND D.EZCANCELFLAG            = '0'
              AND D.GLBL_CMPY_CD            = DCRD_B.GLBL_CMPY_CD
              AND D.CPO_ORD_NUM             = DCRD_B.CPO_ORD_NUM
              AND D.DS_CPO_RTRN_LINE_NUM    = DCRD_B.DS_CPO_RTRN_LINE_NUM
              AND D.DS_CPO_RTRN_LINE_SUB_NUM != DCRD_B.DS_CPO_RTRN_LINE_SUB_NUM
              AND M.EZCANCELFLAG            = '0'
              AND D.GLBL_CMPY_CD            = M.GLBL_CMPY_CD
              AND D.MDSE_CD                 = M.MDSE_CD
              AND ((M.INVTY_CTRL_FLG        = 'Y'
                AND D.RTRN_LINE_STS_CD NOT IN
                  <iterate property="rtrnStsCdRccList" var="rtrnStsCdRcc[]" open=" (" close=")" conjunction=",">
                    #rtrnStsCdRcc[]#
                  </iterate>
              )
              OR (M.INVTY_CTRL_FLG          = 'N'
              AND D.RTRN_LINE_STS_CD NOT IN 
              <iterate property="rtrnStsCdBccList" var="rtrnStsCdBcc[]" open=" (" close=")" conjunction=",">
                #rtrnStsCdBcc[]#
              </iterate>
              ) )
          )
           --SET hasn't Hold
          AND NOT EXISTS (
              SELECT '1' FROM DS_CPO_RTRN_DTL D, HLD H
              WHERE 
                  DCRD_B.SET_MDSE_CD        IS NOT NULL
              AND D.EZCANCELFLAG            = '0'
              AND D.GLBL_CMPY_CD            = DCRD_B.GLBL_CMPY_CD
              AND D.CPO_ORD_NUM             = DCRD_B.CPO_ORD_NUM
              AND D.DS_CPO_RTRN_LINE_NUM    = DCRD_B.DS_CPO_RTRN_LINE_NUM
              AND D.DS_CPO_RTRN_LINE_SUB_NUM != DCRD_B.DS_CPO_RTRN_LINE_SUB_NUM
              AND H.EZCANCELFLAG            = '0'
              AND D.GLBL_CMPY_CD            = H.GLBL_CMPY_CD
              AND D.CPO_ORD_NUM             = H.CPO_ORD_NUM
              AND D.DS_CPO_RTRN_LINE_NUM    = H.CPO_DTL_LINE_NUM
              AND D.DS_CPO_RTRN_LINE_SUB_NUM = H.CPO_DTL_LINE_SUB_NUM
              AND H.TRX_SRC_TP_CD           = #trxSrcTpCd#
              AND H.REL_FLG                 = 'N'
          )
          AND (  --Ref State
                (
                  M_B.INVTY_CTRL_FLG        = 'N'  --Refno
                  AND DCRD_B.RTRN_LINE_STS_CD IN 
                  <iterate property="rtrnStsCdBccList" var="rtrnStsCdBcc[]" open=" (" close=")" conjunction=",">
                    #rtrnStsCdBcc[]#
                  </iterate>  --not(Booked, Closed, Cancelled)
                 )
              OR
                (M_B.MDSE_CD IS NULL)  --no Ref
              OR
                (
                  M_B.INVTY_CTRL_FLG        = 'Y'  --Ref material
                  AND DCRD_B.RTRN_LINE_STS_CD IN 
                  <iterate property="rtrnStsCdRccList" var="rtrnStsCdRcc[]" open=" (" close=")" conjunction=",">
                    #rtrnStsCdRcc[]#
                  </iterate>    --Received, Closed Cancelled
                  
                  AND EXISTS ( SELECT '1' FROM RWS_HDR RH, RWS_DTL RL       --Ref RWS Close
                    WHERE RH.EZCANCELFLAG   = '0'
                    AND RH.GLBL_CMPY_CD     = C.GLBL_CMPY_CD
                    AND RH.TRX_ORD_NUM      = C.CPO_ORD_NUM                 --Ref RWS Close
                    AND RH.RWS_STS_CD       = #rwsStsRcv#                   --Received
                    AND RL.EZCANCELFLAG     = '0'          --Ref RWS Close
                    AND RH.GLBL_CMPY_CD     = RL.GLBL_CMPY_CD               --Ref RWS Close
                    AND RH.RWS_NUM          = RL.RWS_NUM                    --Ref RWS Close
                    AND RL.TRX_LINE_NUM     = DCRD_B.DS_CPO_RTRN_LINE_NUM   --Ref RWS Close
                    AND RL.TRX_LINE_SUB_NUM = DCRD_B.DS_CPO_RTRN_LINE_SUB_NUM    )  --Ref RWS Close
                )
          )
           --SET Hasn't UnEntry, UnProgress
          AND NOT EXISTS (
              SELECT '1' FROM DS_CPO_RTRN_DTL D, ALL_MDSE_V M
              WHERE
                  DCRD.SET_MDSE_CD          IS NOT NULL
              AND D.EZCANCELFLAG            = '0'  --Same OrderNo
              AND D.GLBL_CMPY_CD            = DCRD.GLBL_CMPY_CD  --Same OrderNo
              AND D.CPO_ORD_NUM             = DCRD.CPO_ORD_NUM   --Same OrderNo
              AND D.DS_CPO_RTRN_LINE_NUM    = DCRD.DS_CPO_RTRN_LINE_NUM  --Same LineNo
              AND D.DS_CPO_RTRN_LINE_SUB_NUM <![CDATA[<>]]> DCRD.DS_CPO_RTRN_LINE_SUB_NUM  --Not Same LineSubNo
              AND M.EZCANCELFLAG            = '0'
              AND D.GLBL_CMPY_CD            = M.GLBL_CMPY_CD
              AND D.MDSE_CD                 = M.MDSE_CD
              AND ((M.INVTY_CTRL_FLG        = 'Y'  --material
                AND D.RTRN_LINE_STS_CD NOT IN
	              <iterate property="rtrnStsCdRccList" var="rtrnStsCdRcc[]" open=" (" close=")" conjunction=",">
	                #rtrnStsCdRcc[]#
	              </iterate>
              )  -- Not(Received, Closed, Cancelled)
              OR (M.INVTY_CTRL_FLG          = 'N'  --immaterial
              AND D.RTRN_LINE_STS_CD NOT IN 
              <iterate property="rtrnStsCdBccList" var="rtrnStsCdBcc[]" open=" (" close=")" conjunction=",">
                #rtrnStsCdBcc[]#
              </iterate>  --Not(Booked, Closed, Cancelled)
              ) )
          )
           --SET hasn't Hold
          AND NOT EXISTS (
              SELECT '1' FROM DS_CPO_RTRN_DTL D, HLD H
              WHERE 
                  DCRD.SET_MDSE_CD          IS NOT NULL
              AND D.EZCANCELFLAG = '0'
              AND D.GLBL_CMPY_CD = DCRD.GLBL_CMPY_CD
              AND D.CPO_ORD_NUM = DCRD.CPO_ORD_NUM  --Same OrderNo
              AND D.DS_CPO_RTRN_LINE_NUM = DCRD.DS_CPO_RTRN_LINE_NUM  --Same LineNo
              AND D.DS_CPO_RTRN_LINE_SUB_NUM <![CDATA[<>]]> DCRD.DS_CPO_RTRN_LINE_SUB_NUM  --Different LineSubNo
              AND H.EZCANCELFLAG = '0'
              AND D.GLBL_CMPY_CD = H.GLBL_CMPY_CD
              AND D.CPO_ORD_NUM = H.CPO_ORD_NUM
              AND D.DS_CPO_RTRN_LINE_NUM = H.CPO_DTL_LINE_NUM  --Line Hold
              AND D.DS_CPO_RTRN_LINE_SUB_NUM = H.CPO_DTL_LINE_SUB_NUM  --Line Hold
              AND H.TRX_SRC_TP_CD = #trxSrcTpCd# --Whole Sales Return  --Line Hold
              AND H.REL_FLG = 'N'  --Line Hold
          )
          AND ORIG_I.EZCANCELFLAG (+)   = '0'
          AND DCRD.GLBL_CMPY_CD         = ORIG_I.GLBL_CMPY_CD (+)
          AND DCRD.ORIG_INV_NUM         = ORIG_I.INV_NUM (+)
          AND DCC.EZCANCELFLAG          = '0'
          AND DCRD.GLBL_CMPY_CD         = DCC.GLBL_CMPY_CD
          AND DCRD.DS_CPO_CONFIG_PK     = DCC.DS_CPO_CONFIG_PK
          AND STC.EZCANCELFLAG (+)      = '0'
          AND C.GLBL_CMPY_CD            = STC.GLBL_CMPY_CD (+)
          AND C.SELL_TO_CUST_CD         = STC.SELL_TO_CUST_CD (+)
          AND STC_C.EZCANCELFLAG (+)    = '0'
          AND STC.GLBL_CMPY_CD          = STC_C.GLBL_CMPY_CD (+)
          AND STC.CNTY_PK               = STC_C.CNTY_PK (+)
          AND P.EZCANCELFLAG (+)        = '0'
          AND DCRD.GLBL_CMPY_CD         = P.GLBL_CMPY_CD (+)
          AND DCRD.PMT_TERM_CD          = P.PMT_TERM_CD (+)
          AND MTD_1.EZCANCELFLAG (+)    = '0'
          AND C.GLBL_CMPY_CD            = MTD_1.GLBL_CMPY_CD (+)
          AND C.CPO_ORD_NUM             = MTD_1.CPO_ORD_NUM (+)
          AND MTD_1.TXT_TP_CD (+)       = #invCmnt# --Invoice Cmnt
          AND MTD_1.TXT_SQ_NUM (+)      = 1
          AND MTD_2.EZCANCELFLAG (+)    = '0'
          AND C.GLBL_CMPY_CD            = MTD_2.GLBL_CMPY_CD (+)
          AND C.CPO_ORD_NUM             = MTD_2.CPO_ORD_NUM (+)
          AND MTD_2.TXT_TP_CD (+)       = #invCmnt# --Invoice Cmnt
          AND MTD_2.TXT_SQ_NUM (+)      = 2
          AND MTD_3.EZCANCELFLAG (+)    = '0'
          AND C.GLBL_CMPY_CD            = MTD_3.GLBL_CMPY_CD (+)
          AND C.CPO_ORD_NUM             = MTD_3.CPO_ORD_NUM (+)
          AND MTD_3.TXT_TP_CD (+)       = #invCmnt#--Invoice Cmnt
          AND MTD_3.TXT_SQ_NUM (+)      = 3
          AND MTD_4.EZCANCELFLAG (+)    = '0'
          AND C.GLBL_CMPY_CD            = MTD_4.GLBL_CMPY_CD (+)
          AND C.CPO_ORD_NUM             = MTD_4.CPO_ORD_NUM (+)
          AND MTD_4.TXT_TP_CD (+)       = #invCmnt# --Invoice Cmnt
          AND MTD_4.TXT_SQ_NUM (+)      = 4
          AND BTC.EZCANCELFLAG          = '0'
          AND DCC.GLBL_CMPY_CD          = BTC.GLBL_CMPY_CD
          AND DCC.BILL_TO_CUST_LOC_CD   = BTC.BILL_TO_CUST_CD
          AND DCCD.EZCANCELFLAG (+)     = '0'
          AND C.GLBL_CMPY_CD            = DCCD.GLBL_CMPY_CD (+)
          AND C.DS_CR_CARD_PK           = DCCD.DS_CR_CARD_PK (+)
          AND DOTPD.EZCANCELFLAG (+)    = '0'
          AND C.GLBL_CMPY_CD            = DOTPD.GLBL_CMPY_CD (+)
          AND C.DS_ORD_TP_CD            = DOTPD.DS_ORD_TP_CD (+)
          AND DCRD.CPO_ORD_NUM          = PRC.CPO_ORD_NUM (+)
          AND DCRD.DS_CPO_RTRN_LINE_NUM = PRC.DS_CPO_RTRN_LINE_NUM (+)
          AND DCRD.DS_CPO_RTRN_LINE_SUB_NUM = PRC.DS_CPO_RTRN_LINE_SUB_NUM (+)
          AND DIT.EZCANCELFLAG (+)      = '0'
          AND DOTPD.GLBL_CMPY_CD        = DIT.GLBL_CMPY_CD (+)
          AND DOTPD.DS_INV_TP_CD        = DIT.DS_INV_TP_CD (+)
          AND SAT.EZCANCELFLAG (+)      = '0'
          AND M.GLBL_CMPY_CD            = SAT.GLBL_CMPY_CD (+)
          AND M.SVC_ALLOC_TP_CD         = SAT.SVC_ALLOC_TP_CD (+)
          AND DAC_B.EZCANCELFLAG (+)    = '0'
          AND C.GLBL_CMPY_CD            = DAC_B.GLBL_CMPY_CD (+)
          AND C.BILL_TO_CUST_ACCT_CD    = DAC_B.SELL_TO_CUST_CD (+)
          AND DTGE_B_L.EZCANCELFLAG (+) = '0'
          AND BTC.GLBL_CMPY_CD          = DTGE_B_L.GLBL_CMPY_CD (+)
          AND BTC.DS_TAX_GRP_EXEM_CD    = DTGE_B_L.DS_TAX_GRP_EXEM_CD (+)
          AND DTGE_B_A.EZCANCELFLAG (+) = '0'
          AND DAC_B.GLBL_CMPY_CD        = DTGE_B_A.GLBL_CMPY_CD (+)
          AND DAC_B.DS_TAX_GRP_EXEM_CD  = DTGE_B_A.DS_TAX_GRP_EXEM_CD (+)
          AND STCS.EZCANCELFLAG (+)     = '0'
          AND DCC.GLBL_CMPY_CD          = STCS.GLBL_CMPY_CD (+)
          AND DCC.SHIP_TO_CUST_LOC_CD   = STCS.SHIP_TO_CUST_CD (+)

          <!-- QC#27299 2018/11/15 add start -->
          <!-- ORIG SHIP_TO_CUST -->
          AND ORIG_STCS_S.EZCANCELFLAG (+) = '0'
          AND DCC.GLBL_CMPY_CD             = ORIG_STCS_S.GLBL_CMPY_CD (+)
          AND DCC.ORIG_SHIP_TO_CUST_LOC_CD = ORIG_STCS_S.SHIP_TO_CUST_CD (+)

          <!-- ORIG SELL_TO_CUST -->
          AND ORIG_STC_S.EZCANCELFLAG (+)  = '0'
          AND ORIG_STCS_S.GLBL_CMPY_CD     = ORIG_STC_S.GLBL_CMPY_CD (+)
          AND ORIG_STCS_S.SELL_TO_CUST_CD = ORIG_STC_S.SELL_TO_CUST_CD (+)

          <!-- ORIG_CNTY_WH -->
          AND ORIG_DIL_V.EZCANCELFLAG (+)  = '0'
          AND DCRD.GLBL_CMPY_CD            = ORIG_DIL_V.GLBL_CMPY_CD (+)
          AND DCRD.ORIG_INVTY_LOC_CD       = ORIG_DIL_V.INVTY_LOC_CD (+)

          <!-- ORIG_CNTY_WH -->
          AND ORIG_CNTY_WH.EZCANCELFLAG (+) = '0'
          AND ORIG_DIL_V.GLBL_CMPY_CD      = ORIG_CNTY_WH.GLBL_CMPY_CD (+)
          AND ORIG_DIL_V.CNTY_PK           = ORIG_CNTY_WH.CNTY_PK (+)

          <!-- ORIG_CNTY -->
          AND ORIG_CNTY.EZCANCELFLAG (+)   = '0'
          AND DCC.GLBL_CMPY_CD          = ORIG_CNTY.GLBL_CMPY_CD (+)
          AND DCC.ORIG_SHIP_TO_CNTY_NM  = ORIG_CNTY.CNTY_NM (+)
          AND DCC.ORIG_SHIP_TO_ST_CD    = ORIG_CNTY.ST_CD (+)

          <!-- ORIG_TAX_AREA -->
          AND ORIG_TA.EZCANCELFLAG (+)  = '0'
          AND DCC.GLBL_CMPY_CD          = ORIG_TA.GLBL_CMPY_CD (+)
          AND DCC.ORIG_SHIP_TO_ST_CD    = ORIG_TA.ST_CD (+)
          AND ORIG_CNTY.CNTY_PK         = ORIG_TA.CNTY_PK (+)
          AND DCC.ORIG_SHIP_TO_CTY_ADDR = ORIG_TA.CTY_ADDR (+)

          <!-- ORIG_TAX_AREA1 -->
          AND ORIG_TA1.EZCANCELFLAG(+)  = '0'
          AND DCC.GLBL_CMPY_CD          = ORIG_TA1.GLBL_CMPY_CD(+)
          AND DCC.ORIG_SHIP_TO_ST_CD    = ORIG_TA1.ST_CD(+)
          AND ORIG_CNTY.CNTY_PK         = ORIG_TA1.CNTY_PK(+)
          AND ORIG_TA1.CTY_ADDR(+)      IS NULL

          <!-- ORIG_TAX_AREA2 -->
          AND ORIG_TA2.EZCANCELFLAG(+)  = '0'
          AND DCC.GLBL_CMPY_CD          = ORIG_TA2.GLBL_CMPY_CD(+)
          AND DCC.ORIG_SHIP_TO_ST_CD    = ORIG_TA2.ST_CD(+)
          AND ORIG_TA2.CTY_ADDR(+)      IS NULL
          AND ORIG_TA2.CNTY_PK(+)       IS NULL

          <!-- QC#27299 2018/11/15 add end -->

          AND DAC_S.EZCANCELFLAG (+)    = '0'
          AND DCC.GLBL_CMPY_CD          = DAC_S.GLBL_CMPY_CD (+)
          AND DCC.SHIP_TO_CUST_ACCT_CD  = DAC_S.SELL_TO_CUST_CD (+)
          AND DOLC.EZCANCELFLAG (+)     = '0'
          AND DCRD.GLBL_CMPY_CD         = DOLC.GLBL_CMPY_CD (+)
          AND DCRD.DS_ORD_LINE_CATG_CD  = DOLC.DS_ORD_LINE_CATG_CD (+)
          AND CNTY.EZCANCELFLAG (+)     = '0'
          AND DCC.GLBL_CMPY_CD          = CNTY.GLBL_CMPY_CD (+)
          AND DCC.SHIP_TO_CNTY_NM       = CNTY.CNTY_NM (+)
          AND DCC.SHIP_TO_ST_CD         = CNTY.ST_CD (+)
          AND TA.EZCANCELFLAG (+)       = '0'
          AND DCC.GLBL_CMPY_CD          = TA.GLBL_CMPY_CD (+)
          AND DCC.SHIP_TO_CTY_ADDR      = TA.CTY_ADDR (+)
          AND TA.EZCANCELFLAG (+)       = '0'
          AND DCC.GLBL_CMPY_CD          = TA.GLBL_CMPY_CD (+)
          AND DCC.SHIP_TO_ST_CD         = TA.ST_CD (+)
          AND TA.EZCANCELFLAG (+)       = '0'
          AND CNTY.GLBL_CMPY_CD         = TA.GLBL_CMPY_CD (+)
          AND CNTY.CNTY_PK              = TA.CNTY_PK (+)
          AND CNTY.GLBL_CMPY_CD         = TA1.GLBL_CMPY_CD(+)
          AND CNTY.ST_CD                = TA1.ST_CD(+)
          AND CNTY.CNTY_PK              = TA1.CNTY_PK(+)
          AND DCC.GLBL_CMPY_CD          = TA1.GLBL_CMPY_CD(+)
          AND DCC.SHIP_TO_ST_CD         = TA1.ST_CD(+)
          AND TA1.CTY_ADDR(+)          IS NULL
          AND TA1.EZCANCELFLAG(+)       = '0'
          AND DCC.GLBL_CMPY_CD          = TA2.GLBL_CMPY_CD(+)
          AND DCC.SHIP_TO_ST_CD         = TA2.ST_CD(+)
          AND TA2.CTY_ADDR(+)          IS NULL
          AND TA2.CNTY_PK(+)           IS NULL
          AND TA2.EZCANCELFLAG(+)       = '0'
          AND T.EZCANCELFLAG (+)        = '0'
          AND DCRD.GLBL_CMPY_CD         = T.GLBL_CMPY_CD (+)
          AND DCRD.SLS_REP_OR_SLS_TEAM_TOC_CD = T.TOC_CD (+)
          AND OFA.EZCANCELFLAG (+)      = '0'
          AND T.GLBL_CMPY_CD            = OFA.GLBL_CMPY_CD (+)
          AND T.TOC_CD                  = OFA.TOC_CD (+)
          AND OFA.EFF_FROM_DT (+) <![CDATA[<=]]> #slsDt# --'19000101'
          AND NVL(OFA.EFF_THRU_DT (+), '99991231') <![CDATA[>=]]> #slsDt# --SalesDate
          AND S21P.EZCANCELFLAG (+)     = '0'
          AND OFA.GLBL_CMPY_CD          = S21P.GLBL_CMPY_CD (+)
          AND OFA.PSN_CD                = S21P.PSN_CD (+)
          AND CNTY_REP.EZCANCELFLAG (+) = '0'
          AND S21P.GLBL_CMPY_CD         = CNTY_REP.GLBL_CMPY_CD (+)
          AND S21P.CNTY_PK              = CNTY_REP.CNTY_PK (+)
          AND RW.EZCANCELFLAG (+)       = '0'
          AND DCRD.GLBL_CMPY_CD         = RW.GLBL_CMPY_CD (+)
          AND DCRD.RTL_WH_CD            = RW.RTL_WH_CD (+)
          AND CNTY_WH.EZCANCELFLAG (+)  = '0'
          AND RW.GLBL_CMPY_CD           = CNTY_WH.GLBL_CMPY_CD (+)
          AND RW.CNTY_PK                = CNTY_WH.CNTY_PK (+)
          AND DOLPD.EZCANCELFLAG (+)    = '0'
          AND C.GLBL_CMPY_CD            = DOLPD.GLBL_CMPY_CD (+)
          AND C.DS_ORD_TP_CD            = DOLPD.DS_ORD_TP_CD (+)
          AND DCRD.DS_ORD_LINE_CATG_CD  = DOLPD.DS_ORD_LINE_CATG_CD (+)
          AND OPT.EZCANCELFLAG (+)      = '0'
          AND DOLPD.GLBL_CMPY_CD        = OPT.GLBL_CMPY_CD (+)
          AND DOLPD.ORD_PROC_TP_CD      = OPT.ORD_PROC_TP_CD (+)
          <!-- QC#28383 2018/10/02 add start -->
          AND DCC.GLBL_CMPY_CD          = DM.GLBL_CMPY_CD (+)
          AND DCC.MDL_ID                = DM.MDL_ID (+)
          AND DCC.EZCANCELFLAG (+)      = '0'
          <!-- QC#28383 2018/10/02 add start -->
          ORDER BY
              C.CPO_ORD_NUM
             ,DCC.BILL_TO_CUST_LOC_CD
             ,DCRD.PMT_TERM_CD
             ,DCRD.CASH_DISC_TERM_CD
             ,DCRD.CCY_CD
             ,DCRD.EXCH_RATE
             ,DCRD.PMT_TERM_CASH_DISC_CD
             ,DCRD.ORIG_INV_NUM
             ,DCRD.DS_CPO_RTRN_LINE_NUM
             ,DCRD.DS_CPO_RTRN_LINE_SUB_NUM
    </statement>

    <statement id="getCtacPsnFromCpo" parameterClass="Map" resultMap="result.getCtacPsnFromCpo">
<!-- QC#23559 add Start -->
        WITH    CTAC AS (
            SELECT
                 DCCP.DS_CPO_CTAC_PSN_PK
                ,DCCP.CTAC_PSN_PK
                ,DCCP.CTAC_PSN_TP_CD
            FROM
                 DS_CPO_CTAC_PSN    DCCP
            WHERE
                DCCP.GLBL_CMPY_CD       = #glblCmpyCd#
            AND DCCP.CPO_ORD_NUM        = #cpoOrdNum#
        <isNull property="dsCpoConfigPk">
            AND DCCP.DS_CPO_CONFIG_PK   IS NULL
        </isNull>
        <isNotNull property="dsCpoConfigPk">
            AND DCCP.DS_CPO_CONFIG_PK   = #dsCpoConfigPk#
        </isNotNull>
        <isNull property="scdCtacTpCd">
            AND DCCP.CTAC_PSN_TP_CD     = #ctacTpCd#
        </isNull>
        <isNotNull property="scdCtacTpCd">
            AND DCCP.CTAC_PSN_TP_CD     IN (#ctacTpCd#, #scdCtacTpCd#)
        </isNotNull>
            AND DCCP.EZCANCELFLAG       = '0'
        )
<!-- QC#23559 add End -->
        SELECT
             CTAC_PSN_PK
            ,CTAC_PSN_FIRST_NM
            ,CTAC_PSN_MID_NM
            ,CTAC_PSN_LAST_NM
        FROM
            DS_CPO_CTAC_PSN
        WHERE
            CTAC_PSN_PK = (
<!-- QC#23559 mod Start -->
<!-- 
                SELECT
                    MAX(DCCP.CTAC_PSN_PK)
                FROM
                    DS_CPO_CTAC_PSN DCCP
                WHERE
                    DCCP.GLBL_CMPY_CD     = #glblCmpyCd#
                <isNotNull property="dsCpoConfigPk">
                AND DCCP.DS_CPO_CONFIG_PK = #dsCpoConfigPk#
                </isNotNull>
                <isNotNull property="cpoOrdNum">
                AND DCCP.CPO_ORD_NUM      = #cpoOrdNum#
                </isNotNull>
                AND DCCP.CTAC_PSN_TP_CD   = #ctacTpCd#
                AND DCCP.EZCANCELFLAG     = '0'
 -->
               SELECT
                    NVL((SELECT MAX(CTAC_PSN_PK) FROM CTAC WHERE CTAC_PSN_TP_CD = #ctacTpCd#)
                    <isNotNull property="scdCtacTpCd">
                       ,(SELECT MAX(CTAC_PSN_PK) FROM CTAC WHERE CTAC_PSN_TP_CD = #scdCtacTpCd#)
                    </isNotNull>
                    <isNull property="scdCtacTpCd">
                       ,NULL
                    </isNull>
                    )
                FROM DUAL
<!-- QC#23559 mod End -->
            )
    </statement>
    <resultMap id="result.getCtacPsnFromCpo" class="CTAC_PSNTMsg">
        <result property="ctacPsnPk"            column="CTAC_PSN_PK"            javaType="EZDTBigDecimalItem"/>
        <result property="ctacPsnFirstNm"       column="CTAC_PSN_FIRST_NM"      javaType="EZDTStringItem"/>
        <result property="ctacPsnMidNm"         column="CTAC_PSN_MID_NM"        javaType="EZDTStringItem"/>
        <result property="ctacPsnLastNm"        column="CTAC_PSN_LAST_NM"       javaType="EZDTStringItem"/>
    </resultMap>

    <statement id="getCtacPsnFromCustomer" parameterClass="Map" resultMap="result.getCtacPsnFromCustomer">
<!-- QC#23559 add Start -->
        WITH CTAC AS (
            SELECT
                 DCR.CTAC_PSN_PK
                ,DCR.CTAC_TP_CD
                ,DCR.DS_PRIM_LOC_FLG
            FROM
                 DS_CTAC_PSN_RELN   DCR
                ,CTAC_PSN           CP
            WHERE
                DCR.GLBL_CMPY_CD            = #glblCmpyCd#
                <isNotNull property="custLocCd">
                AND DCR.LOC_NUM             = (
                        SELECT LOC_NUM
                            FROM
                                BILL_TO_CUST
                           WHERE
                                GLBL_CMPY_CD    = #glblCmpyCd#
                            AND BILL_TO_CUST_CD = #custLocCd#
                            AND EZCANCELFLAG    = '0'
                    )
                </isNotNull>
                <isNotNull property="custAcctCd">
                AND DCR.DS_ACCT_NUM         = #custAcctCd#
                </isNotNull>
                AND DCR.EFF_FROM_DT         &lt;= #invDt#
                AND (DCR.EFF_THRU_DT        &gt;= #invDt#
                    OR
                    DCR.EFF_THRU_DT         IS NULL
                )
                <isNull property="scdCtacTpCd">
                    AND DCR.CTAC_TP_CD      = #ctacTpCd#
                </isNull>
                <isNotNull property="scdCtacTpCd">
                    AND DCR.CTAC_TP_CD      IN (#ctacTpCd#, #scdCtacTpCd#)
                </isNotNull>
                AND DCR.EZCANCELFLAG        = '0'
                AND CP.GLBL_CMPY_CD         = DCR.GLBL_CMPY_CD
                AND CP.CTAC_PSN_PK          = DCR.CTAC_PSN_PK
                AND CP.EZCANCELFLAG         = '0'
                AND CP.CTAC_PSN_ACTV_FLG    = #activeFlg#
        )
<!-- QC#23559 add End -->
        SELECT
             CTAC_PSN_PK
            ,CTAC_PSN_FIRST_NM
            ,CTAC_PSN_MID_NM
            ,CTAC_PSN_LAST_NM
        FROM
            CTAC_PSN
        WHERE
            CTAC_PSN_PK = (
<!-- QC#23559 mod Start -->
<!-- 
                SELECT
                    MAX(CP.CTAC_PSN_PK)
                FROM
                     DS_CTAC_PSN_RELN DCR
                    ,CTAC_PSN CP
                WHERE
                    DCR.GLBL_CMPY_CD        = #glblCmpyCd#
                <isNotNull property="custLocCd">
                AND DCR.LOC_NUM             = (
                         SELECT LOC_NUM
                           FROM BILL_TO_CUST BTC
                          WHERE BTC.GLBL_CMPY_CD    = 'ADB'
                            AND BTC.BILL_TO_CUST_CD = #custLocCd#
                            AND BTC.RGTN_STS_CD     = 'P20'
                            AND BTC.EZCANCELFLAG    = '0'
                )
                </isNotNull>
                <isNotNull property="custAcctCd">
                AND DCR.DS_ACCT_NUM         = #custAcctCd#
                </isNotNull>
                AND DCR.EFF_FROM_DT         &lt;= #invDt#
                AND (DCR.EFF_THRU_DT        &gt;= #invDt#
                    OR
                    DCR.EFF_THRU_DT         IS NULL
                )
                AND DCR.CTAC_TP_CD           = #ctacTpCd#
                AND DCR.EZCANCELFLAG        = '0'
                AND CP.GLBL_CMPY_CD         = DCR.GLBL_CMPY_CD
                AND CP.CTAC_PSN_PK          = DCR.CTAC_PSN_PK
                AND CP.EZCANCELFLAG         = '0'
                AND CP.CTAC_PSN_ACTV_FLG    = #activeFlg#
                <isNotNull property="dsCtacPsnDeptCd">
                AND CP.DS_CTAC_PSN_DEPT_CD  = #dsCtacPsnDeptCd#
                </isNotNull>
 -->
                SELECT
                    NVL((SELECT MAX(CTAC_PSN_PK) FROM CTAC      WHERE CTAC_TP_CD = #ctacTpCd# AND DS_PRIM_LOC_FLG = 'Y')
                        ,NVL((SELECT MAX(CTAC_PSN_PK) FROM CTAC WHERE CTAC_TP_CD = #ctacTpCd#)
                <isNotNull property="scdCtacTpCd">
                            ,NVL((SELECT MAX(CTAC_PSN_PK) FROM CTAC WHERE CTAC_TP_CD = #scdCtacTpCd# AND DS_PRIM_LOC_FLG = 'Y')
                                ,(SELECT MAX(CTAC_PSN_PK) FROM CTAC WHERE CTAC_TP_CD = #scdCtacTpCd#)
                            )
                </isNotNull>
                <isNull property="scdCtacTpCd">
                            ,NULL
                </isNull>
                        )
                    )
                FROM DUAL
<!-- QC#23559 mod End -->
             )
    </statement>
    <resultMap id="result.getCtacPsnFromCustomer" class="CTAC_PSNTMsg">
        <result property="ctacPsnPk"            column="CTAC_PSN_PK"            javaType="EZDTBigDecimalItem"/>
        <result property="ctacPsnFirstNm"       column="CTAC_PSN_FIRST_NM"      javaType="EZDTStringItem"/>
        <result property="ctacPsnMidNm"         column="CTAC_PSN_MID_NM"        javaType="EZDTStringItem"/>
        <result property="ctacPsnLastNm"        column="CTAC_PSN_LAST_NM"       javaType="EZDTStringItem"/>
    </resultMap>

    <statement id="getFreightCharge" parameterClass="Map" resultClass="Map">
        SELECT
            CRPCB.CALC_PRC_AMT_RATE
            ,CRPCB.UNIT_PRC_AMT
        FROM
            CPO_RTRN_PRC_CALC_BASE CRPCB
        WHERE
            CRPCB.GLBL_CMPY_CD              = #glblCmpyCd#
        AND CRPCB.EZCANCELFLAG              = '0'
        AND CRPCB.CPO_ORD_NUM               = #cpoOrdNum#
        AND CRPCB.DS_CPO_RTRN_LINE_NUM      = #dSCpoRtrnLineNum#
        AND CRPCB.DS_CPO_RTRN_LINE_SUB_NUM  = #dsCpoRtrnLineSubNum#
        AND CRPCB.PRC_DTL_GRP_CD            = 'FRT'
    </statement>


    <statement id="getDsCpoRtnPrcDtl" parameterClass="Map" resultMap="result.getDsCpoRtnPrcDtl">
        SELECT
            DCRPD.PRMO_CATG_PK
            ,DCRPD.PRMO_PK
            ,DCRPD.DEAL_PK
            ,DCRPD.PRC_DT
            ,DCRPD.SHIP_UNIT_QTY
            ,DCRPD.DEAL_UNIT_PRC_AMT
            ,DCRPD.DEAL_LAST_NET_UNIT_PRC_AMT
            ,DCRPD.DEAL_NET_AMT
            ,DCRPD.DEAL_DISC_AMT
            ,DCRPD.DEAL_PRMO_NET_UNIT_PRC_AMT
            ,DCRPD.DEAL_PER_UNIT_FIX_AMT
            ,DCRPD.FUNC_PER_UNIT_FIX_AMT
            ,DCRPD.FUNC_UNIT_PRC_AMT
            ,DCRPD.FUNC_LAST_NET_UNIT_PRC_AMT
            ,DCRPD.FUNC_NET_AMT
            ,DCRPD.FUNC_DISC_AMT
            ,DCRPD.FUNC_PRMO_NET_UNIT_PRC_AMT
            ,DCRPD.COA_ACCT_CD
        FROM
            DS_CPO_RTRN_PRC_DTL DCRPD
        WHERE
            DCRPD.GLBL_CMPY_CD                  = #glblCmpyCd#
            AND DCRPD.EZCANCELFLAG              = '0'
            AND DCRPD.CPO_ORD_NUM               = #cpoOrdNum#
            AND DCRPD.DS_CPO_RTRN_LINE_NUM      = #dsCpoRtrnLineNum#
            AND DCRPD.DS_CPO_RTRN_LINE_SUB_NUM  = #dsCpoRtrnLineSubNum#
    </statement>
    
    <resultMap id="result.getDsCpoRtnPrcDtl" class="DS_CPO_RTRN_PRC_DTLTMsg">
        <result property="prmoCatgPk"               column="PRMO_CATG_PK"               javaType="EZDTBigDecimalItem"/>
        <result property="prmoPk"                   column="PRMO_PK"                    javaType="EZDTBigDecimalItem"/>
        <result property="dealPk"                   column="DEAL_PK"                    javaType="EZDTBigDecimalItem"/>
        <result property="prcDt"                    column="PRC_DT"                     javaType="EZDTStringItem"/>
        <result property="shipUnitQty"              column="SHIP_UNIT_QTY"              javaType="EZDTBigDecimalItem"/>
        <result property="dealUnitPrcAmt"           column="DEAL_UNIT_PRC_AMT"          javaType="EZDTBigDecimalItem"/>
        <result property="dealLastNetUnitPrcAmt"    column="DEAL_LAST_NET_UNIT_PRC_AMT" javaType="EZDTBigDecimalItem"/>
        <result property="dealNetAmt"               column="DEAL_NET_AMT"               javaType="EZDTBigDecimalItem"/>
        <result property="dealDiscAmt"              column="DEAL_DISC_AMT"              javaType="EZDTBigDecimalItem"/>
        <result property="dealPrmoNetUnitPrcAmt"    column="DEAL_PRMO_NET_UNIT_PRC_AMT" javaType="EZDTBigDecimalItem"/>
        <result property="dealPerUnitFixAmt"        column="DEAL_PER_UNIT_FIX_AMT"      javaType="EZDTBigDecimalItem"/>
        <result property="funcPerUnitFixAmt"        column="FUNC_PER_UNIT_FIX_AMT"      javaType="EZDTBigDecimalItem"/>
        <result property="funcUnitPrcAmt"           column="FUNC_UNIT_PRC_AMT"          javaType="EZDTBigDecimalItem"/>
        <result property="funcLastNetUnitPrcAmt"    column="FUNC_LAST_NET_UNIT_PRC_AMT" javaType="EZDTBigDecimalItem"/>
        <result property="funcNetAmt"               column="FUNC_NET_AMT"               javaType="EZDTBigDecimalItem"/>
        <result property="funcDiscAmt"              column="FUNC_DISC_AMT"              javaType="EZDTBigDecimalItem"/>
        <result property="funcPrmoNetUnitPrcAmt"    column="FUNC_PRMO_NET_UNIT_PRC_AMT" javaType="EZDTBigDecimalItem"/>
        <result property="coaAcctCd"                column="COA_ACCT_CD"                javaType="EZDTStringItem"/>
    </resultMap>


    <statement id="getSerNum" parameterClass="Map" resultClass="String">
        SELECT
            RPAS.SER_NUM
        FROM
            RWS_HDR             RH
            ,RWS_DTL            RD
            ,RWS_PUT_AWAY_SER   RPAS
        WHERE
            RH.GLBL_CMPY_CD             = #glblCmpyCd#
            AND RH.EZCANCELFLAG         = '0'
            AND RH.RWS_NUM              = RD.RWS_NUM
            AND RD.RWS_NUM              = RPAS.RWS_NUM
            AND RD.RWS_DTL_LINE_NUM     = RPAS.RWS_LINE_NUM
            AND RD.MDSE_CD              = RPAS.MDSE_CD
            AND RH.TRX_ORD_NUM          = #trxOrdNum#
            AND RD.TRX_LINE_NUM         = #trxLineNum#
            AND RD.TRX_LINE_SUB_NUM     = #trxLineSubNum#
    </statement>

    <statement id="getCpoOrdNum" parameterClass="Map" resultClass="String">
        SELECT
            C.CPO_ORD_NUM
        FROM
            CPO C
        WHERE
            C.GLBL_CMPY_CD = #glblCmpyCd#
            AND C.EZCANCELFLAG = '0'
            AND C.CPO_ORD_NUM = #cpoOrdNum#
            AND NOT EXISTS (
                SELECT '1'
                  FROM CPO_DTL
                 WHERE
                       GLBL_CMPY_CD = C.GLBL_CMPY_CD
                   AND CPO_ORD_NUM  = C.CPO_ORD_NUM
                   AND OPEN_FLG     = 'Y'
                   AND ORD_LINE_STS_CD NOT IN 
                       <iterate property="ordLnStsList" var="ordLnSts[]" open=" (" close=")" conjunction=",">
                       #ordLnSts[]#
                       </iterate>
                   AND EZCANCELFLAG  = '0')
            AND NOT EXISTS (
                SELECT '1'
                  FROM DS_CPO_RTRN_DTL
                 WHERE
                       GLBL_CMPY_CD = C.GLBL_CMPY_CD
                   AND CPO_ORD_NUM  = C.CPO_ORD_NUM
                   AND OPEN_FLG     = 'Y'
                   AND RTRN_LINE_STS_CD NOT IN
                       <iterate property="rtrnStsCdBccList" var="rtrnStsCdBcc[]" open=" (" close=")" conjunction=",">
                       #rtrnStsCdBcc[]#
                       </iterate>
                   AND EZCANCELFLAG  = '0')
    </statement>

    <statement id="getChildSet" parameterClass="Map" resultClass="Map">
        SELECT
            CD.CPO_DTL_LINE_NUM
            ,CD.CPO_DTL_LINE_SUB_NUM
            ,CD.ORD_QTY
        FROM
            CPO_DTL CD
        WHERE
            CD.GLBL_CMPY_CD          = #glblCmpyCd#
        AND CD.CPO_ORD_NUM           = #cpoOrdNum#
        AND CD.CPO_DTL_LINE_NUM      = #cpoDtlLineNum#
        AND CD.EZCANCELFLAG          = '0'
        ORDER BY
             CD.CPO_DTL_LINE_SUB_NUM
    </statement>

    <statement id="getBizAreaCd" parameterClass="Map" resultClass="String">
        SELECT
            OCB.SCD_BIZ_CTX_ATTRB_TXT
        FROM
            ORD_CATG_BIZ_CTX OCB
        WHERE
                OCB.GLBL_CMPY_CD       = #glblCmpyCd#
            AND OCB.ORD_CATG_CTX_TP_CD in
            <iterate property="ordCatgCtxTpCdList" var="ordCatgCtxTpCd[]" open=" (" close=")" conjunction=",">
                #ordCatgCtxTpCd[]#
            </iterate>
            AND  OCB.DS_ORD_CATG_CD    = #dsOrdCatgCd#
            AND (OCB.DS_ORD_TP_CD      is null
              OR OCB.DS_ORD_TP_CD      = #dsOrdTpCd#)
            <isNotNull property="dsOrdRsnCd">
            AND (OCB.DS_ORD_RSN_CD     is null
              OR OCB.DS_ORD_RSN_CD     = #dsOrdRsnCd#)
            </isNotNull>
            <isNull property="dsOrdRsnCd">
            AND (OCB.DS_ORD_RSN_CD     is null)
            </isNull>
            AND  OCB.EZCANCELFLAG      = '0'
        
    </statement>

    <statement id="checkPutAwaySerial" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)
        FROM
             RWS_HDR            RH
            ,RWS_DTL            RD
            ,RWS_PUT_AWAY_SER   RS
        WHERE
                RH.GLBL_CMPY_CD     = #glblCmpyCd#
            AND RH.TRX_ORD_NUM      = #trxOrdNum#
            AND RH.SCE_ORD_TP_CD    = 'RT'
            AND RH.EZCANCELFLAG     = '0'
            AND RH.GLBL_CMPY_CD     = RD.GLBL_CMPY_CD
            AND RH.RWS_NUM          = RD.RWS_NUM
            AND RD.TRX_LINE_NUM     = #trxLineNum#
            AND RD.TRX_LINE_SUB_NUM = #trxLineSubNum#
            AND RD.EZCANCELFLAG     = '0'
            AND RD.GLBL_CMPY_CD     = RS.GLBL_CMPY_CD
            AND RD.RWS_NUM          = RS.RWS_NUM
            AND RD.RWS_DTL_LINE_NUM = RS.RWS_LINE_NUM
            AND RS.MDSE_CD          = #mdseCd#
            AND RS.SER_NUM          = #serNum#
            AND RS.EZCANCELFLAG     = '0'
    </statement>
    <!-- QC#17348 add End -->
    <statement id="getCalcBaseForCharges" parameterClass="Map" resultClass="Map">
        SELECT
             CRPCB.CPO_RTRN_PRC_CALC_BASE_PK
            ,CRPCB.PRC_DTL_GRP_CD
            ,CRPCB.CALC_PRC_AMT_RATE + NVL(CRPCB2.CALC_PRC_AMT_RATE, 0) AS CALC_PRC_AMT_RATE
            ,CRPCB.UNIT_PRC_AMT
            ,PDG.CHRG_MDSE_CD
            ,MDSE.MDSE_NM
            ,MDSE.COA_PROD_CD
        FROM
             CPO_RTRN_PRC_CALC_BASE   CRPCB
            ,PRC_DTL_GRP              PDG
            ,ALL_MDSE_V               MDSE
            ,(
                SELECT
                      CRPCB2.GLBL_CMPY_CD
                     ,CRPCB2.EZCANCELFLAG
                     ,CRPCB2.CPO_ORD_NUM
                     ,CRPCB2.DS_CPO_RTRN_LINE_NUM
                     ,CRPCB2.DS_CPO_RTRN_LINE_SUB_NUM
                     ,CRPCB2.SPEC_COND_PRC_PK
                     ,CRPCB2.CALC_PRC_AMT_RATE
                FROM
                    CPO_RTRN_PRC_CALC_BASE   CRPCB2
                 WHERE
                     CRPCB2.GLBL_CMPY_CD             = #glblCmpyCd#
                 AND CRPCB2.EZCANCELFLAG             = '0'
                 AND CRPCB2.CPO_ORD_NUM              = #cpoOrdNum#
                 AND CRPCB2.DS_CPO_RTRN_LINE_NUM     = #cpoDtlLineNum#
                 AND CRPCB2.DS_CPO_RTRN_LINE_SUB_NUM = #cpoDtlLineSubNum#
                 AND CRPCB2.PRC_DTL_GRP_CD         IN
                     <iterate property="prcDtlGrpCdRnd" var="prcDtlGrpCd[]" open="(" close=")" conjunction=",">
                         #prcDtlGrpCd[]#
                     </iterate>
                 AND CRPCB2.PRC_COND_MAN_DEL_FLG     = #delFlg#
            ) CRPCB2
        WHERE
            CRPCB.GLBL_CMPY_CD              = #glblCmpyCd#
        AND CRPCB.EZCANCELFLAG              = '0'
        AND CRPCB.CPO_ORD_NUM               = #cpoOrdNum#
        AND CRPCB.DS_CPO_RTRN_LINE_NUM      = #cpoDtlLineNum#
        AND CRPCB.DS_CPO_RTRN_LINE_SUB_NUM  = #cpoDtlLineSubNum#
        AND CRPCB.PRC_DTL_GRP_CD         IN
             <iterate property="prcDtlGrpCdList" var="prcDtlGrpCd[]" open="(" close=")" conjunction=",">
                 #prcDtlGrpCd[]#
             </iterate>
        AND CRPCB.PRC_COND_MAN_DEL_FLG     = #delFlg#
        AND CRPCB.PRC_RULE_APPLY_FLG       = #applyFlg#
        AND CRPCB.GLBL_CMPY_CD             = PDG.GLBL_CMPY_CD
        AND CRPCB.EZCANCELFLAG             = PDG.EZCANCELFLAG
        AND CRPCB.PRC_DTL_GRP_CD           = PDG.PRC_DTL_GRP_CD

        AND PDG.GLBL_CMPY_CD               = MDSE.GLBL_CMPY_CD
        AND PDG.EZCANCELFLAG               = MDSE.EZCANCELFLAG
        AND PDG.CHRG_MDSE_CD               = MDSE.MDSE_CD

        AND CRPCB.GLBL_CMPY_CD             = CRPCB2.GLBL_CMPY_CD(+)
        AND CRPCB.EZCANCELFLAG             = CRPCB2.EZCANCELFLAG(+)
        AND CRPCB.CPO_ORD_NUM              = CRPCB2.CPO_ORD_NUM(+)
        AND CRPCB.DS_CPO_RTRN_LINE_NUM     = CRPCB2.DS_CPO_RTRN_LINE_NUM(+)
        AND CRPCB.DS_CPO_RTRN_LINE_SUB_NUM = CRPCB2.DS_CPO_RTRN_LINE_SUB_NUM(+)
        AND CRPCB.SPEC_COND_PRC_PK         = CRPCB2.SPEC_COND_PRC_PK(+)
        ORDER BY CRPCB.CPO_RTRN_PRC_CALC_BASE_PK
    </statement>

    <statement id="getCurLocNum" parameterClass="Map" resultClass="String">
        SELECT
            SMM.CUR_LOC_NUM
        FROM
            SVC_MACH_MSTR SMM
        WHERE
                SMM.GLBL_CMPY_CD              = #glblCmpyCd#
            AND SMM.SVC_CONFIG_MSTR_PK        = #svcConfigMstrPk#
            AND SMM.SVC_MACH_MSTR_STS_CD      = #svcMachMstrStsCd#
            AND SMM.EZCANCELFLAG              = '0'
        ORDER BY
            SMM.SVC_MACH_SQ_NUM
    </statement>

<!-- QC#27954 add Start -->
    <statement id="getOrdCatgBizCtx" parameterClass="Map" resultClass="Map">
        SELECT
             OCBC.ORD_CATG_CTX_TP_CD        AS ORD_CATG_CTX_TP_CD
           , OCBC.DS_ORD_CATG_CD            AS DS_ORD_CATG_CD
           , OCBC.DS_ORD_TP_CD              AS DS_ORD_TP_CD
           , OCBC.DS_ORD_RSN_CD             AS DS_ORD_RSN_CD
           , OCBC.FIRST_BIZ_CTX_ATTRB_TXT   AS FIRST_BIZ_CTX_ATTRB_TXT
        FROM
             ORD_CATG_BIZ_CTX    OCBC
        WHERE
                OCBC.GLBL_CMPY_CD           = #glblCmpyCd#
            AND OCBC.ORD_CATG_CTX_TP_CD     = #OrdCatgCtxTpCd#
            AND OCBC.DS_ORD_CATG_CD         = #dsOrdCatgCd#
            AND OCBC.EZCANCELFLAG           = '0'
        ORDER BY OCBC.DS_ORD_TP_CD NULLS LAST
               , OCBC.DS_ORD_RSN_CD NULLS LAST
    </statement>
<!-- QC#27954 add End -->

</sqlMap>
