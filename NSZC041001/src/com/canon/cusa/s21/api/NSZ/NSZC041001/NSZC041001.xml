<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<sqlMap namespace="NSZC041001">

    <statement id="countCrHldForBillTo" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             BILL_TO_CUST BTC
            ,DS_CLT_ACCT_STS DCAS
        WHERE
                BTC.GLBL_CMPY_CD       = #glblCmpyCd#
            AND BTC.BILL_TO_CUST_CD    = #billToCustCd#
            AND BTC.EZCANCELFLAG       = '0'
            AND BTC.GLBL_CMPY_CD       = DCAS.GLBL_CMPY_CD
            AND BTC.DS_CLT_ACCT_STS_CD = DCAS.DS_CLT_ACCT_STS_CD
            AND DCAS.CR_HLD_FLG        = 'Y'
            AND DCAS.EZCANCELFLAG      = '0'
    </statement>

    <statement id="countCrHldForAcct" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             SELL_TO_CUST STC
            ,DS_CLT_ACCT_STS DCAS
        WHERE
                STC.GLBL_CMPY_CD       = #glblCmpyCd#
            AND STC.SELL_TO_CUST_CD    = #sellToCustCd#
            AND STC.EZCANCELFLAG       = '0'
            AND STC.GLBL_CMPY_CD       = DCAS.GLBL_CMPY_CD
            AND STC.DS_CLT_ACCT_STS_CD = DCAS.DS_CLT_ACCT_STS_CD
            AND DCAS.CR_HLD_FLG        = 'Y'
            AND DCAS.EZCANCELFLAG      = '0'
    </statement>

<!-- add start 2018/07/19 QC#27143 -->
    <statement id="getContrNum" parameterClass="Map" resultClass="String">
        SELECT DISTINCT
            DC.DS_CONTR_NUM
        FROM
             SVC_TASK     ST
            ,DS_CONTR_DTL DCD
            ,DS_CONTR     DC
        WHERE
                ST.GLBL_CMPY_CD        = #glblCmpyCd#
            AND ST.SVC_TASK_NUM        = #svcTaskNum#
            AND ST.EZCANCELFLAG        = '0'
            AND ST.GLBL_CMPY_CD        = DCD.GLBL_CMPY_CD
            AND ST.SVC_MACH_MSTR_PK    = DCD.SVC_MACH_MSTR_PK
            AND DCD.EZCANCELFLAG       = '0'
            AND DCD.CONTR_EFF_FROM_DT  &lt;= #slsDt#
            AND NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT)  &gt;= #slsDt#
            AND DCD.GLBL_CMPY_CD       = DC.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK        = DC.DS_CONTR_PK
            AND DC.EZCANCELFLAG        = '0'
            AND DC.DS_CONTR_CATG_CD    &lt;&gt; #dsContrCatgWty#
    </statement>

    <statement id="countOverdueForBillTo" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             INV               I
            ,INV_LINE          IL
            ,CUST_CR_PRFL      CCP
            ,CONTR_CR_RISK_CLS CRC
            ,AR_TRX_BAL        ATB
        WHERE
                I.GLBL_CMPY_CD            = #glblCmpyCd#
            AND I.BILL_TO_CUST_CD         = #billToCustCd#
            AND I.EZCANCELFLAG            = '0'
            AND I.GLBL_CMPY_CD            = IL.GLBL_CMPY_CD
            AND I.INV_NUM                 = IL.INV_NUM
            AND IL.EZCANCELFLAG           = '0'
            <iterate property="dsContrNumList" var="dsContrNumList[]" open="AND IL.DS_CONTR_NUM IN (" close=")" conjunction=",">
                #dsContrNumList[]#
            </iterate>
            AND I.GLBL_CMPY_CD            = CCP.GLBL_CMPY_CD
            AND I.BILL_TO_CUST_CD         = CCP.BILL_TO_CUST_CD
            AND CCP.EZCANCELFLAG          = '0'
            AND CCP.GLBL_CMPY_CD          = CRC.GLBL_CMPY_CD
            AND CCP.CONTR_CR_RISK_CLS_CD  = CRC.CONTR_CR_RISK_CLS_CD
            AND CRC.EZCANCELFLAG          = '0'
            AND I.GLBL_CMPY_CD            = ATB.GLBL_CMPY_CD
            AND I.BILL_TO_CUST_ACCT_CD    = ATB.BILL_TO_CUST_ACCT_CD
            AND ATB.EZCANCELFLAG          = '0'
            AND ATB.AR_TRX_NUM         LIKE IL.INV_NUM || '%'
            AND ATB.AR_TRX_TP_CD          = #arTrxTpInvoice#
            AND ATB.AR_CASH_APPLY_STS_CD IN (#arCashApplyStsUnapplied#, #arCashApplyStsPartial#)
            AND TO_DATE(ATB.INV_DUE_DT, 'YYYYMMDD') + CRC.CONTR_GRACE_PER_DAYS_AOT &lt; TO_DATE(#slsDt#, 'YYYYMMDD')
    </statement>

    <statement id="countOverdueForAcct" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             INV               I
            ,INV_LINE          IL
            ,DS_ACCT_CR_PRFL   DACP
            ,CONTR_CR_RISK_CLS CRC
            ,AR_TRX_BAL        ATB
        WHERE
                I.GLBL_CMPY_CD            = #glblCmpyCd#
            AND I.BILL_TO_CUST_ACCT_CD    = #billToCustAcctCd#
            AND I.EZCANCELFLAG            = '0'
            AND I.GLBL_CMPY_CD            = IL.GLBL_CMPY_CD
            AND I.INV_NUM                 = IL.INV_NUM
            AND IL.EZCANCELFLAG           = '0'
            <iterate property="dsContrNumList" var="dsContrNumList[]" open="AND IL.DS_CONTR_NUM IN (" close=")" conjunction=",">
                #dsContrNumList[]#
            </iterate>
            AND I.GLBL_CMPY_CD            = DACP.GLBL_CMPY_CD
            AND I.BILL_TO_CUST_ACCT_CD    = DACP.DS_ACCT_NUM
            AND DACP.EZCANCELFLAG         = '0'
            AND DACP.GLBL_CMPY_CD         = CRC.GLBL_CMPY_CD
            AND DACP.CONTR_CR_RISK_CLS_CD = CRC.CONTR_CR_RISK_CLS_CD
            AND CRC.EZCANCELFLAG          = '0'
            AND I.GLBL_CMPY_CD            = ATB.GLBL_CMPY_CD
            AND I.BILL_TO_CUST_ACCT_CD    = ATB.BILL_TO_CUST_ACCT_CD
            AND ATB.EZCANCELFLAG          = '0'
            AND ATB.AR_TRX_NUM         LIKE IL.INV_NUM || '%'
            AND ATB.AR_TRX_TP_CD          = #arTrxTpInvoice#
            AND ATB.AR_CASH_APPLY_STS_CD IN (#arCashApplyStsUnapplied#, #arCashApplyStsPartial#)
            AND TO_DATE(ATB.INV_DUE_DT, 'YYYYMMDD') + CRC.CONTR_GRACE_PER_DAYS_AOT &lt; TO_DATE(#slsDt#, 'YYYYMMDD')
    </statement>
<!-- add end 2018/07/19 QC#27143 -->
</sqlMap>
