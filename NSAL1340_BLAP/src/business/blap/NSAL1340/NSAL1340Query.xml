<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAL1340Query">

    <typeAlias alias="NSAL1340CMsg"    type="business.blap.NSAL1340.NSAL1340CMsg"/>
    <typeAlias alias="NSAL1340_ACMsg"  type="business.blap.NSAL1340.NSAL1340_ACMsg"/>

    <statement id="getBandList" parameterClass="Map" resultMap="result.getBandList">
        SELECT
            BAND_LIST.MIN_COPY_VOL_CNT
          , BAND_LIST.MAX_COPY_VOL_CNT
          , PLB.PRC_LIST_BAND_DESC_TXT
          , BAND_LIST.TOT_BASE_AMT
          , BAND_LIST.CPC_AMT_RATE
          , BAND_LIST.MDSE_CD
          , BAND_LIST.PRC_SVC_TIER_TP_CD
          , BAND_LIST.PRC_SVC_TIER_TP_NM
          , BAND_LIST.PRC_SVC_TIER_TP_SORT_NUM
        FROM
            (
              (
                SELECT
                    PLSP.MIN_COPY_VOL_CNT    AS MIN_COPY_VOL_CNT
                  , PLSP.MAX_COPY_VOL_CNT    AS MAX_COPY_VOL_CNT
                  , PLSP.PRC_LIST_BAND_CD    AS PRC_LIST_BAND_CD
                  , PLSP.TOT_BASE_AMT        AS TOT_BASE_AMT
                  , PLSP.CPC_AMT_RATE        AS CPC_AMT_RATE
                  , PLSP.MDSE_CD             AS MDSE_CD
                  , NULL                     AS PRC_SVC_TIER_TP_CD
                  , NULL                     AS PRC_SVC_TIER_TP_NM
                  , NULL                     AS PRC_SVC_TIER_TP_SORT_NUM
                FROM 
                    PRC_LIST_SPLY_PGM PLSP
                WHERE
                    PLSP.GLBL_CMPY_CD        =     #glblCmpyCd#
                AND PLSP.PRC_CATG_CD         =     #prcCatgCd#
                AND PLSP.MDL_ID              =     #mdlId#
                AND PLSP.MDL_NM              =     #mdlNm#
                AND PLSP.PRC_MTR_PKG_PK      =     #prcMtrPkgPk#
                AND PLSP.PRC_SVC_PLN_TP_CD   =     #prcSvcPlnTpCd#
                AND PLSP.PRC_SVC_CONTR_TP_CD =     #prcSvcContrTpCd#
                AND PLSP.BLLG_MTR_LB_CD      =     #bllgMtrLbCd#
                AND PLSP.EFF_FROM_DT         &lt;= #prcBaseDt#
                AND
                  (
                   PLSP.EFF_THRU_DT          IS    NULL
                OR
                   PLSP.EFF_THRU_DT          &gt;= #prcBaseDt#
                  )
                AND PLSP.DEL_FLG             =     #flgN#
                --
                AND PLSP.TERM_FROM_MTH_AOT  &lt;=  #termMthNum#
                AND
                  (
                   PLSP.TERM_THRU_MTH_AOT   &gt;=  #termMthNum#
                 OR
                   PLSP.TERM_THRU_MTH_AOT   IS NULL
                  )
                --
                AND (
                    PLSP.SPLY_AGMT_PLN_PK   IS NULL
                    OR EXISTS (
                            SELECT
                                      1
                                FROM
                                    SPLY_AGMT_PLN   SAP
                                WHERE
                                    SAP.GLBL_CMPY_CD            = PLSP.GLBL_CMPY_CD
                                    AND SAP.SPLY_AGMT_PLN_PK    = PLSP.SPLY_AGMT_PLN_PK
                                    AND SAP.ACTV_FLG            = 'Y'
                                    AND SAP.EFF_FROM_DT        &lt;= #prcBaseDt#
                                    AND (
                                        SAP.EFF_THRU_DT        IS NULL
                                        OR SAP.EFF_THRU_DT     &gt;= #prcBaseDt#
                                    )
                                    AND SAP.DEL_FLG             = 'N'
                                    AND SAP.EZCANCELFLAG        = '0'
                    )
                )
                --
                AND PLSP.EZCANCELFLAG        = '0'
            )
            UNION
            (
                SELECT
                    PLS.MIN_COPY_VOL_CNT     AS MIN_COPY_VOL_CNT
                  , PLS.MAX_COPY_VOL_CNT     AS MAX_COPY_VOL_CNT
                  , PLS.PRC_LIST_BAND_CD     AS PRC_LIST_BAND_CD
                  , PLS.BASE_AMT             AS BASE_AMT
                  , PLS.CPC_AMT_RATE         AS CPC_AMT_RATE
                  , PLS.MDSE_CD              AS MDSE_CD
                  , NULL                     AS PRC_SVC_TIER_TP_CD
                  , NULL                     AS PRC_SVC_TIER_TP_NM
                  , NULL                     AS PRC_SVC_TIER_TP_SORT_NUM
                FROM 
                    PRC_LIST_SVC PLS
                WHERE
                    PLS.GLBL_CMPY_CD         =     #glblCmpyCd#
                AND PLS.PRC_CATG_CD          =     #prcCatgCd#
                AND PLS.MDL_ID               =     #mdlId#
                AND PLS.MDL_NM               =     #mdlNm#
                AND PLS.PRC_MTR_PKG_PK       =     #prcMtrPkgPk#
                AND PLS.PRC_SVC_PLN_TP_CD    =     #prcSvcPlnTpCd#
                AND PLS.PRC_SVC_CONTR_TP_CD  =     #prcSvcContrTpCd#
                AND PLS.BLLG_MTR_LB_CD       =     #bllgMtrLbCd#
                AND PLS.PRC_RATE_TP_CD       IN   (#annual#, #cpc#)
                AND PLS.EFF_FROM_DT          &lt;= #prcBaseDt#
                AND
                  (
                   PLS.EFF_THRU_DT           IS    NULL
                OR
                   PLS.EFF_THRU_DT           &gt;= #prcBaseDt#
                  )
                AND PLS.DEL_FLG              =     #flgN#
                --
                AND PLS.TERM_FROM_MTH_AOT   &lt;=  #termMthNum#
                AND
                  (
                   PLS.TERM_THRU_MTH_AOT    &gt;=  #termMthNum#
                 OR
                   PLS.TERM_THRU_MTH_AOT    IS NULL
                  )
                --
                AND PLS.EZCANCELFLAG         = '0'
            )
            UNION
            (
                SELECT
                    PLST.MIN_COPY_VOL_CNT           AS MIN_COPY_VOL_CNT
                  , PLST.MAX_COPY_VOL_CNT           AS MAX_COPY_VOL_CNT
                  , PLST.PRC_LIST_BAND_CD           AS PRC_LIST_BAND_CD
                  , PLST.BASE_AMT                   AS BASE_AMT
                  , PLST.CPC_AMT_RATE               AS CPC_AMT_RATE
                  , PLST.MDSE_CD                    AS MDSE_CD
                  , PSTT.PRC_SVC_TIER_TP_CD         AS PRC_SVC_TIER_TP_CD
                  , PSTT.PRC_SVC_TIER_TP_NM         AS PRC_SVC_TIER_TP_NM
                  , PSTT.PRC_SVC_TIER_TP_SORT_NUM   AS PRC_SVC_TIER_TP_SORT_NUM
                FROM 
                    PRC_LIST_SVC_TIER  PLST
                  , PRC_SVC_TIER_TP    PSTT
                WHERE
                    PLST.GLBL_CMPY_CD        =     #glblCmpyCd#
                AND PLST.PRC_CATG_CD         =     #prcCatgCd#
                AND PLST.MDL_ID              =     #mdlId#
                AND PLST.MDL_NM              =     #mdlNm#
                AND PLST.PRC_MTR_PKG_PK      =     #prcMtrPkgPk#
                AND PLST.PRC_SVC_PLN_TP_CD   =     #prcSvcPlnTpCd#
                AND PLST.PRC_SVC_CONTR_TP_CD =     #prcSvcContrTpCd#
                AND PLST.BLLG_MTR_LB_CD      =     #bllgMtrLbCd#
                AND PLST.EFF_FROM_DT         &lt;= #prcBaseDt#
                AND
                  (
                   PLST.EFF_THRU_DT          IS    NULL
                OR
                   PLST.EFF_THRU_DT          &gt;= #prcBaseDt#
                  )
                AND PLST.DEL_FLG             =     #flgN#
                --
                AND PLST.TERM_FROM_MTH_AOT  &lt;=  #termMthNum#
                AND
                  (
                   PLST.TERM_THRU_MTH_AOT   &gt;=  #termMthNum#
                 OR
                   PLST.TERM_THRU_MTH_AOT   IS NULL
                  )
                --
                AND PLST.PRC_SVC_TIER_TP_CD  =     PSTT.PRC_SVC_TIER_TP_CD
                AND PLST.GLBL_CMPY_CD        =     PSTT.GLBL_CMPY_CD
                AND PLST.EZCANCELFLAG        = '0'
                AND PSTT.EZCANCELFLAG        = '0'
            )
        ) BAND_LIST
        , PRC_LIST_BAND PLB
        WHERE
            BAND_LIST.PRC_LIST_BAND_CD  = PLB.PRC_LIST_BAND_CD
            AND PLB.GLBL_CMPY_CD        = #glblCmpyCd#
            AND PLB.EZCANCELFLAG        = '0'
        ORDER BY
            PLB.PRC_LIST_BAND_SORT_NUM
            , BAND_LIST.PRC_SVC_TIER_TP_SORT_NUM
    </statement>

    <resultMap id="result.getBandList" class="NSAL1340_ACMsg">
        <result property="minCopyVolCnt"         column="MIN_COPY_VOL_CNT"          javaType="EZDSBigDecimalItem"/>
        <result property="maxCopyVolCnt"         column="MAX_COPY_VOL_CNT"          javaType="EZDSBigDecimalItem"/>
        <result property="prcListBandDescTxt"    column="PRC_LIST_BAND_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="totBaseAmt"            column="TOT_BASE_AMT"              javaType="EZDSBigDecimalItem"/>
        <result property="cpcAmtRate"            column="CPC_AMT_RATE"              javaType="EZDSBigDecimalItem"/>
        <result property="mdseCd"                column="MDSE_CD"                   javaType="EZDSStringItem"/>
        <result property="prcSvcTierTpCd"        column="PRC_SVC_TIER_TP_CD"        javaType="EZDSStringItem"/>
        <result property="prcSvcTierTpNm"        column="PRC_SVC_TIER_TP_NM"        javaType="EZDSStringItem"/>
    </resultMap>

</sqlMap>
