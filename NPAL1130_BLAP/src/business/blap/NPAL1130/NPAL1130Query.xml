<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NPAL1130Query">

    <typeAlias alias="NPAL1130CMsg"   type="business.blap.NPAL1130.NPAL1130CMsg"/>

    <statement id="getMrpInfo" parameterClass="Map" resultClass="Map">
        SELECT ROP_QTY
              ,MAX_INVTY_QTY
              ,INVTY_LOC_CD
              <!-- START 2017/11/07 S.Katsuma [SOL#014(QC#18401),ADD] -->
              ,MRP_PLN_NM
              <!-- END 2017/11/07 S.Katsuma [SOL#014(QC#18401),ADD] -->
              <!-- START 2018/05/01 T.Tokutomi [QC#24814, ADD] -->
              ,CALC_ORD_PROC_CD
              <!-- END 2018/05/01 T.Tokutomi [QC#24814, ADD] -->
        FROM   MRP_INFO
        WHERE  GLBL_CMPY_CD = #cMsg.glblCmpyCd#
        AND    EZCANCELFLAG = '0'
        AND  ( MDSE_CD = #cMsg.mdseCd#
        OR     MDSE_CD = #cMsg.ordTakeMdseCd# )
        AND    RTL_WH_CD = #cMsg.rtlWhCd#
        <isNotNull property="cMsg.rtlSwhCd">
        AND    RTL_SWH_CD = #cMsg.rtlSwhCd#
        </isNotNull>
        AND    MRP_INFO_RGTN_STS_CD = #mrpInfoRgtnStsCd#
        AND    ROWNUM = 1 
    </statement>

    <statement id="getMdseCd" parameterClass="Map" resultClass="String">
        SELECT
            MAIN.MDSE_CD
        FROM (
            SELECT
                M.MDSE_CD
            FROM
                 ORD_TAKE_MDSE OTM
                ,MDSE M
            WHERE
                OTM.GLBL_CMPY_CD     = #glblCmpyCd#
            AND OTM.ORD_TAKE_MDSE_CD = #mdseCd#
            AND OTM.GLBL_CMPY_CD     = M.GLBL_CMPY_CD
            AND M.MDSE_CD         LIKE OTM.ORD_TAKE_MDSE_CD || '%'
            AND OTM.EZCANCELFLAG     = '0'
            AND M.EZCANCELFLAG       = '0'
            ORDER BY
                M.MDSE_CD
        ) MAIN
        WHERE 
            ROWNUM = 1
    </statement>
    
    <statement id="getRtlWhInfo" parameterClass="Map" resultClass="Map">
        SELECT
            RTL_WH_CD
           ,RTL_WH_NM
        FROM
            RTL_WH
        WHERE 1=1
        AND   GLBL_CMPY_CD = #glblCmpyCd#
        AND   EZCANCELFLAG = '0'
        AND   RTL_WH_CD    = #rtlWhCd#
    </statement>
    
    <!-- QC#29214 Add SQL Start-->
    <statement id="getCompatibleItem" parameterClass="Map" resultClass="String">
        SELECT
            RELN_MDSE_CD
        FROM
            MDSE_ITEM_FLIP_SET
        WHERE
                GLBL_CMPY_CD = #GLBL_CMPY_CD#
            AND MDSE_CD = #MDSE_CD#
            AND MDSE_ITEM_RELN_TP_CD IN
            <isNotNull property="MDSE_ITEM_RELN_TP_CD">
                <iterate property="MDSE_ITEM_RELN_TP_CD" var="MDSE_ITEM_RELN_TP_CD[]" open="(" close=")" conjunction=",">
                    #MDSE_ITEM_RELN_TP_CD[]#
                </iterate>
            </isNotNull>
            AND EZCANCELFLAG = '0'
        ORDER BY
            RELN_MDSE_CD
    </statement>
</sqlMap>
