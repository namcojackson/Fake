<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL2620Query">
    <typeAlias alias="NMAL2620_ASMsg"  type="business.blap.NMAL2620.NMAL2620_ASMsg"/>
        <statement id="getBizAreaList" parameterClass="Map" resultClass="Map">
            SELECT
                 D.BIZ_AREA_ORG_DESC_TXT AS BIZ_AREA_ORG_DESC_TXT
                ,D.BIZ_AREA_ORG_CD      AS BIZ_AREA_ORG_CD
            FROM 
                BIZ_AREA_ORG D
            WHERE
                    D.GLBL_CMPY_CD    = #glblCmpyCd#
                AND D.ORG_STRU_TP_CD  = #orgStruTpCd#
                AND D.SLS_FLG         = #slsFlg#
                AND D.EZCANCELFLAG    = '0'
            ORDER BY BIZ_AREA_ORG_SORT_NUM
        </statement>
        <statement id="getSelectModeList" parameterClass="Map" resultClass="Map">
            SELECT
                 D.TRTY_UPD_MODE_TP_CD         AS TRTY_UPD_MODE_TP_CD
                ,D.TRTY_UPD_MODE_TP_DESC_TXT  AS TRTY_UPD_MODE_TP_DESC_TXT
            FROM 
                TRTY_UPD_MODE_TP D
            WHERE
                  D.GLBL_CMPY_CD    = #glblCmpyCd#
              AND D.EZCANCELFLAG    = '0'
            ORDER BY TRTY_UPD_MODE_TP_SORT_NUM
        </statement>
        <statement id="getSearchData" parameterClass="Map" resultMap="result.getSearchData">
            SELECT
                 PSN_FIRST_NM
                 ,PSN_LAST_NM
                 ,LINE_BIZ_TP_CD
                 ,PSN_NUM
                 ,EFF_FROM_DT
                 ,EFF_THRU_DT
                 ,ACCT_TEAM_ROLE_TP_DESC_TXT
                 ,ORG_NM
                 ,ORG_CD
                 ,ORG_DESC_TXT
                 ,BIZ_AREA_ORG_DESC_TXT
                 ,ORG_FUNC_ROLE_TP_DESC_TXT
            FROM (
                SELECT
                     A.PSN_FIRST_NM                AS  PSN_FIRST_NM
                    ,A.PSN_LAST_NM                 AS  PSN_LAST_NM
                    ,A.LINE_BIZ_TP_CD              AS  LINE_BIZ_TP_CD
                    ,A.PSN_NUM                     AS  PSN_NUM
                    ,B.EFF_FROM_DT                 AS  EFF_FROM_DT
                    ,B.EFF_THRU_DT                 AS  EFF_THRU_DT
                    ,C.ACCT_TEAM_ROLE_TP_DESC_TXT  AS  ACCT_TEAM_ROLE_TP_DESC_TXT
                    ,D.ORG_NM                      AS  ORG_NM
                    ,D.ORG_CD                      AS  ORG_CD
                    ,D.ORG_DESC_TXT                AS  ORG_DESC_TXT
                    ,F.BIZ_AREA_ORG_DESC_TXT       AS  BIZ_AREA_ORG_DESC_TXT
                    ,I.ORG_FUNC_ROLE_TP_DESC_TXT   AS  ORG_FUNC_ROLE_TP_DESC_TXT
                FROM
                     S21_PSN              A
                    ,DS_ORG_RESRC_RELN    B
                    ,ACCT_TEAM_ROLE_TP    C
                    ,DS_ORG_UNIT          D
                    ,ORG_STRU_TP          E
                    ,BIZ_AREA_ORG         F
                    ,ORG_FUNC_ASG         G
                    ,ORG_TOC_CHNG_RQST    H
                    ,ORG_FUNC_ROLE_TP     I
                    ,BIZ_AREA_ORG         J
                WHERE
                        A.GLBL_CMPY_CD              = #glblCmpyCd#
                    <isNotNull property="psnNum">
                    AND A.PSN_NUM                   LIKE #psnNum#
                    </isNotNull>
                    <isNotNull property="psnCd">
                    AND A.PSN_CD                    LIKE #psnCd#
                    </isNotNull>
                    <isNotNull property="xxPsnNm">
                    AND( UPPER(A.PSN_LAST_NM)       LIKE UPPER(#xxPsnNm#)
                    OR  UPPER(A.PSN_FIRST_NM)       LIKE UPPER(#xxPsnNm#)
                    OR  UPPER(A.PSN_FIRST_NM)  || ' ' || UPPER(A.PSN_LAST_NM) LIKE UPPER(#xxPsnNm#))
                    </isNotNull>
                    AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
                    AND A.PSN_CD                    = B.PSN_CD
                    <iterate property="gnrnTpCd" var="elem[]" open="AND B.GNRN_TP_CD   IN (" close=")" conjunction=",">
                        #elem[]#
                    </iterate>
                    AND B.GLBL_CMPY_CD              = C.GLBL_CMPY_CD (+)
                    AND B.ACCT_TEAM_ROLE_TP_CD      = C.ACCT_TEAM_ROLE_TP_CD (+)
                    AND B.GLBL_CMPY_CD              = D.GLBL_CMPY_CD
                    AND B.ORG_CD                    = D.ORG_CD
                    AND B.ORG_STRU_TP_CD            = D.ORG_STRU_TP_CD
                    <isNotNull property="orgNm">
                    AND D.ORG_NM                 LIKE #orgNm#
                    </isNotNull>
                    AND D.GLBL_CMPY_CD              = E.GLBL_CMPY_CD
                    AND D.ORG_STRU_TP_CD            = E.ORG_STRU_TP_CD
                    AND E.TRTY_STRU_FLG             = #trtyStruFlg#
                    AND D.GLBL_CMPY_CD              = F.GLBL_CMPY_CD
                    AND D.FIRST_ORG_CD              = F.BIZ_AREA_ORG_CD
                    AND D.ORG_STRU_TP_CD            = F.ORG_STRU_TP_CD
                    <isNotNull property="bizAreaOrgCd">	
                    AND F.BIZ_AREA_ORG_CD           = #bizAreaOrgCd#
                    </isNotNull>
                    AND A.GLBL_CMPY_CD              = G.GLBL_CMPY_CD
                    AND A.PSN_CD                    = G.PSN_CD
                    AND G.EFF_FROM_DT               &lt;= #slsDate#
                    AND NVL(G.EFF_THRU_DT, #hitDate#)         &gt;= #slsDate#
                    AND G.GLBL_CMPY_CD              = H.GLBL_CMPY_CD
                    AND G.TOC_CD                    = H.TOC_CD
                    <iterate property="gnrnTpCd" var="elem[]" open="AND G.GNRN_TP_CD  IN (" close=")" conjunction=",">
                        #elem[]#
                    </iterate>
                    AND H.GLBL_CMPY_CD              = I.GLBL_CMPY_CD
                    AND H.ORG_FUNC_ROLE_TP_CD       = I.ORG_FUNC_ROLE_TP_CD
                    AND I.GLBL_CMPY_CD              = J.GLBL_CMPY_CD
                    AND I.ORG_STRU_TP_CD            = J.ORG_STRU_TP_CD
                    <isEqual property="slsRepFlg" compareValue="Y">
                    AND I.SLS_REP_FLG               = #slsFlg#
                    </isEqual>
                    AND J.ORG_STRU_TP_CD            = #orgStruTpCd#
                    AND J.SLS_FLG                   = #slsFlg#
                    AND A.EZCANCELFLAG              = '0'
                    AND B.EZCANCELFLAG              = '0'
                    AND C.EZCANCELFLAG(+)           = '0'
                    AND D.EZCANCELFLAG              = '0'
                    AND E.EZCANCELFLAG              = '0'
                    AND F.EZCANCELFLAG              = '0'
                    AND G.EZCANCELFLAG              = '0'
                    AND H.EZCANCELFLAG              = '0'
                    AND I.EZCANCELFLAG              = '0'
                    AND J.EZCANCELFLAG              = '0'
                ORDER BY
                    D.ORG_NM
            )
            WHERE
                ROWNUM        &lt;= #rowNum#
        </statement>
        <resultMap id="result.getSearchData"    class="NMAL2620_ASMsg">
            <result property="xxPsnNm_A"                 column="PSN_FIRST_NM"                javaType="EZDSStringItem" />
            <result property="psnLastNm_A"               column="PSN_LAST_NM"                 javaType="EZDSStringItem" />
            <result property="lineBizTpCd_A"             column="LINE_BIZ_TP_CD"              javaType="EZDSStringItem" />
            <result property="psnNum_A"                  column="PSN_NUM"                     javaType="EZDSStringItem" />
            <result property="effFromDt_A"               column="EFF_FROM_DT"                 javaType="EZDSDateItem" />
            <result property="effThruDt_A"               column="EFF_THRU_DT"                 javaType="EZDSDateItem" />
            <result property="acctTeamRoleTpDescTxt_A"   column="ACCT_TEAM_ROLE_TP_DESC_TXT"  javaType="EZDSStringItem" />
            <result property="orgNm_A"                   column="ORG_NM"                      javaType="EZDSStringItem" />
            <result property="orgCd_A"                   column="ORG_CD"                      javaType="EZDSStringItem" />
            <result property="orgDescTxt_A"              column="ORG_DESC_TXT"                javaType="EZDSStringItem" />
            <result property="bizAreaOrgDescTxt_A"       column="BIZ_AREA_ORG_DESC_TXT"       javaType="EZDSStringItem" />
            <result property="orgFuncRoleTpDescTxt_A"    column="ORG_FUNC_ROLE_TP_DESC_TXT"   javaType="EZDSStringItem" />
        </resultMap>

    <statement id="checkMoveToResrcTrtyRelnExist" parameterClass="Map" resultClass="Map">
        SELECT
             C.EFF_FROM_DT               AS EFF_FROM_DT
           , NVL(C.EFF_THRU_DT,#maxDt#)  AS EFF_THRU_DT
        FROM
             DS_ORG_UNIT           A
            ,ORG_STRU_TP           B
            ,DS_ORG_RESRC_RELN     C
            ,S21_PSN               D
        WHERE
             A.GLBL_CMPY_CD                 = #glblCmpyCd#
            <isNotNull property="orgCd">
            AND A.ORG_CD                    = #orgCd#
            </isNotNull>
            <isNotNull property="    orgNm">
            AND A.ORG_NM                    = #orgNm#
            </isNotNull>
            AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
            AND A.ORG_STRU_TP_CD            = B.ORG_STRU_TP_CD
            AND B.TRTY_STRU_FLG             = #trtyStruFlg#
            AND A.GLBL_CMPY_CD              = C.GLBL_CMPY_CD
            AND A.ORG_CD                    = C.ORG_CD
            AND A.ORG_STRU_TP_CD            = C.ORG_STRU_TP_CD
            AND C.GLBL_CMPY_CD              = D.GLBL_CMPY_CD
            AND C.PSN_CD                    = D.PSN_CD
            AND C.GNRN_TP_CD                IN (#gnrnTp_current#, #gnrnTp_future#)
            AND D.PSN_NUM                   = #psnNum#
            AND A.EZCANCELFLAG              = '0'
            AND B.EZCANCELFLAG              = '0'
            AND C.EZCANCELFLAG              = '0'
            AND D.EZCANCELFLAG              = '0'
    </statement>
        <statement id="checkMoveTerritory" parameterClass="Map" resultClass="Map">
            SELECT
                 A.PSN_NUM                AS  PSN_NUM
            FROM
                 S21_PSN    A
            WHERE
                    A.GLBL_CMPY_CD             = #glblCmpyCd#
                AND NVL(A.PSN_FIRST_NM,'') || ' ' || NVL(A.PSN_LAST_NM,'')      = #psnFirstNm#
                AND A.EZCANCELFLAG             = '0'
        </statement>
        <statement id="checkEffectiveDate" parameterClass="Map" resultClass="Map">
            SELECT
                 A.EFF_FROM_DT                AS  EFF_FROM_DT
                ,A.EFF_THRU_DT                AS  EFF_THRU_DT
            FROM
                 DS_ORG_UNIT    A
                ,ORG_STRU_TP    B
            WHERE
                    A.GLBL_CMPY_CD             = #glblCmpyCd#
                AND A.ORG_CD                   = #orgCd#
                AND A.GLBL_CMPY_CD             = B.GLBL_CMPY_CD
                AND A.ORG_STRU_TP_CD           = B.ORG_STRU_TP_CD
                AND B.TRTY_STRU_FLG            = #trtyStruFlg#
                AND A.EZCANCELFLAG             = '0'
                AND B.EZCANCELFLAG             = '0'
        </statement>
        <statement id="checkBusinessArea" parameterClass="Map" resultClass="Map">
            SELECT
                 C.BIZ_AREA_ORG_DESC_TXT    AS  BIZ_AREA_ORG_DESC_TXT
            FROM
                 DS_ORG_UNIT    A
                ,ORG_STRU_TP    B
                ,BIZ_AREA_ORG   C
            WHERE
                    A.GLBL_CMPY_CD             = #glblCmpyCd#
                AND A.ORG_CD                   = #orgCd#
                AND A.GLBL_CMPY_CD             = B.GLBL_CMPY_CD
                AND A.ORG_STRU_TP_CD           = B.ORG_STRU_TP_CD
                AND B.TRTY_STRU_FLG            = #trtyStruFlg#
                AND A.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                AND A.FIRST_ORG_CD             = C.BIZ_AREA_ORG_CD
                AND A.ORG_STRU_TP_CD           = C.ORG_STRU_TP_CD
                AND A.EZCANCELFLAG             = '0'
                AND B.EZCANCELFLAG             = '0'
                AND C.EZCANCELFLAG             = '0'
        </statement>
        <statement id="checkTargetTerritories" parameterClass="Map" resultClass="Map">
            SELECT
                 A.EFF_FROM_DT    AS  EFF_FROM_DT
            FROM
                 DS_ORG_UNIT    A
                ,ORG_STRU_TP    B
            WHERE
                    A.GLBL_CMPY_CD             = #glblCmpyCd#
                AND A.ORG_CD                   = #orgCd#
                AND A.EFF_FROM_DT              &lt;= #slsDate#
                AND NVL(A.EFF_THRU_DT, #hitDate#)         &gt;= #slsDate#
                AND A.GLBL_CMPY_CD             = B.GLBL_CMPY_CD
                AND A.ORG_STRU_TP_CD           = B.ORG_STRU_TP_CD
                AND B.TRTY_STRU_FLG            = #trtyStruFlg#
                AND A.EZCANCELFLAG             = '0'
                AND B.EZCANCELFLAG             = '0'
        </statement>
        <statement id="getEffFrDtRsrcRltn" parameterClass="Map" resultClass="Map">
            SELECT
                 C.EFF_FROM_DT    AS  EFF_FROM_DT
                ,C.EFF_THRU_DT    AS  EFF_THRU_DT
            FROM
                 DS_ORG_UNIT        A
                ,ORG_STRU_TP        B
                ,DS_ORG_RESRC_RELN  C
            WHERE
                    A.GLBL_CMPY_CD             = #glblCmpyCd#
                AND A.ORG_CD                   = #orgCd#
                AND A.EFF_FROM_DT              &lt;= #slsDate#
                AND NVL(A.EFF_THRU_DT, #hitDate#)         &gt;= #slsDate#
                AND A.GLBL_CMPY_CD             = B.GLBL_CMPY_CD
                AND A.ORG_STRU_TP_CD           = B.ORG_STRU_TP_CD
                AND B.TRTY_STRU_FLG            = #trtyStruFlg#
                AND A.ORG_CD                   = C.ORG_CD
                AND A.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                <iterate property="gnrnTpCd" var="elem[]" open="AND C.GNRN_TP_CD   IN (" close=")" conjunction=",">
                    #elem[]#
                </iterate>
                AND A.EZCANCELFLAG             = '0'
                AND B.EZCANCELFLAG             = '0'
                AND C.EZCANCELFLAG             = '0'
        </statement>
        <statement id="getEffFrDtTrrtryRl" parameterClass="Map" resultClass="Map">
            SELECT
                 C.EFF_FROM_DT    AS  EFF_FROM_DT
            FROM
                 DS_ORG_UNIT        A
                ,ORG_STRU_TP        B
                ,TRTY_RULE          C
            WHERE
                    A.GLBL_CMPY_CD             = #glblCmpyCd#
                AND A.ORG_CD                   = #orgCd#
                AND A.EFF_FROM_DT              &lt;= #slsDate#
                AND NVL(A.EFF_THRU_DT, #hitDate#)         &gt;= #slsDate#
                AND A.GLBL_CMPY_CD             = B.GLBL_CMPY_CD
                AND A.ORG_STRU_TP_CD           = B.ORG_STRU_TP_CD
                AND B.TRTY_STRU_FLG            = #trtyStruFlg#
                AND A.ORG_STRU_TP_CD           = C.ORG_STRU_TP_CD
                AND A.ORG_CD                   = C.ORG_CD
                AND A.EZCANCELFLAG             = '0'
                AND B.EZCANCELFLAG             = '0'
                AND C.EZCANCELFLAG             = '0'
        </statement>
        <statement id="getRelnDt" parameterClass="Map" resultClass="Map">
            SELECT
                 A.EFF_FROM_DT    AS  EFF_FROM_DT
            FROM
                 DS_ORG_RELN    A
                ,ORG_STRU_TP    B
            WHERE
                    A.GLBL_CMPY_CD             = #glblCmpyCd#
                AND A.ORG_CD                   = #orgCd#
                <iterate property="gnrnTpCd" var="elem[]" open="AND A.GNRN_TP_CD   IN (" close=")" conjunction=",">
                    #elem[]#
                </iterate>
                AND A.GLBL_CMPY_CD             = B.GLBL_CMPY_CD
                AND A.ORG_STRU_TP_CD           = B.ORG_STRU_TP_CD
                AND B.TRTY_STRU_FLG            = #trtyStruFlg#
                AND A.EZCANCELFLAG             = '0'
                AND B.EZCANCELFLAG             = '0'
        </statement>
        <statement id="getPsnNum" parameterClass="Map" resultClass="Map">
            SELECT
                 PSN.PSN_NUM    AS  PSN_NUM
            FROM
                 S21_PSN    PSN
            WHERE
                PSN.GLBL_CMPY_CD             = #glblCmpyCd#
            AND PSN.EZCANCELFLAG             = '0'
            AND
                (
                    UPPER(PSN.PSN_LAST_NM)  = UPPER(#xxPsnNm#)
                OR  UPPER(PSN.PSN_FIRST_NM) = UPPER(#xxPsnNm#)
                OR  UPPER(PSN.PSN_FIRST_NM) || ' ' || UPPER(PSN.PSN_LAST_NM) = UPPER(#xxPsnNm#)
                )
        </statement>

        <statement id="checkActiveChildOrganization" parameterClass="Map" resultClass="Map">
            SELECT
                UNIT.ORG_CD
              , NVL(UNIT.EFF_THRU_DT, #maxEffThruDt#) AS EFF_THRU_DT
            FROM
                DS_ORG_RELN RELN
              , ORG_STRU_TP STRU
              , DS_ORG_UNIT UNIT
            WHERE
                RELN.PRNT_ORG_CD        = #orgCd#
            AND RELN.GLBL_CMPY_CD       = #glblCmpyCd#
            AND RELN.EZCANCELFLAG       = '0'
            AND RELN.GLBL_CMPY_CD       = STRU.GLBL_CMPY_CD
            AND RELN.ORG_STRU_TP_CD     = STRU.ORG_STRU_TP_CD
            AND STRU.TRTY_STRU_FLG      = #flgOnY#
            AND STRU.EZCANCELFLAG       = '0'
            AND RELN.GLBL_CMPY_CD       = UNIT.GLBL_CMPY_CD
            AND RELN.ORG_CD             = UNIT.ORG_CD
            AND UNIT.EZCANCELFLAG       = '0'
        </statement>

        <statement id="checkParentRelation" parameterClass="Map" resultClass="Map">
            SELECT
                PRELN.ORG_CD
              , NVL(PRELN.EFF_THRU_DT, #maxEffThruDt#) AS EFF_THRU_DT
            FROM
                DS_ORG_RELN RELN
              , ORG_STRU_TP STRU
              , DS_ORG_RELN PRELN
              , ORG_STRU_TP PSTRU
            WHERE
                RELN.ORG_CD             = #orgCd#
            AND RELN.GLBL_CMPY_CD       = #glblCmpyCd#
            AND RELN.EZCANCELFLAG       = '0'
            AND RELN.GLBL_CMPY_CD       = STRU.GLBL_CMPY_CD
            AND RELN.ORG_STRU_TP_CD     = STRU.ORG_STRU_TP_CD
            AND STRU.TRTY_STRU_FLG      = #flgOnY#
            AND STRU.EZCANCELFLAG       = '0'
            AND RELN.PRNT_ORG_CD        = PRELN.ORG_CD
            AND RELN.GLBL_CMPY_CD       = PRELN.GLBL_CMPY_CD
            AND PRELN.EZCANCELFLAG      = '0'
            AND PRELN.GLBL_CMPY_CD      = PSTRU.GLBL_CMPY_CD
            AND PRELN.ORG_STRU_TP_CD    = PSTRU.ORG_STRU_TP_CD
            AND PSTRU.TRTY_STRU_FLG     = #flgOnY#
            AND PSTRU.EZCANCELFLAG      = '0'
        </statement>
</sqlMap>
