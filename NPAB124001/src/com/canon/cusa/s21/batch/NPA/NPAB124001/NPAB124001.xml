<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NPAB124001">

    <statement id="getLastUpdateTs" parameterClass="Map" resultClass="Map">
        
        SELECT
             DS_BIZ_PROC_LOG_PK
            ,DS_BIZ_LAST_UPD_TS
        FROM
            DS_BIZ_PROC_LOG DBPL
        WHERE 1=1
        AND GLBL_CMPY_CD      = #glblCmpyCd#
        AND DBPL.EZCANCELFLAG = '0'
        AND DBPL.PROC_PGM_ID  = #procPgmId#
        ORDER BY
             DS_BIZ_PROC_TRX_NUM
            ,DS_BIZ_PROC_TRX_DTL_NUM
            ,DS_BIZ_PROC_TRX_SUB_DTL_NUM
    </statement>

	<statement id="getWsOrderInfo" parameterClass="Map" resultClass="Map">
    SELECT
        CCV.CPO_ORD_NUM                        AS CPO_ORD_NUM
        ,CCV.ORD_HDR_STS_CD                    AS ORD_HDR_STS_CD
        ,CCV.CPO_HLD_FLG                       AS CPO_HLD_FLG
        ,CCV.SELL_TO_CUST_CD                   AS SELL_TO_CUST_CD
        ,CCV.CUST_ISS_PO_NUM                   AS CUST_ISS_PO_NUM
        ,CCV.CPO_ORD_TS                        AS CPO_ORD_TS
        ,CCDV.ORD_QTY                          AS ORIG_ORD_QTY
        ,CCDV.CPO_DTL_LINE_NUM                 AS CPO_DTL_LINE_NUM
        ,CCDV.CPO_DTL_LINE_SUB_NUM             AS CPO_DTL_LINE_SUB_NUM
        ,CCDV.ORD_LINE_STS_CD                  AS ORD_LINE_STS_CD
        ,CCDV.CCY_CD                           AS CCY_CD
        ,CSPV.MDSE_CD                          AS MDSE_CD
<!-- START 2019/10/09 T.Ogura [QC#53502,MOD] -->
<!--    ,CCDV.ENT_DEAL_NET_UNIT_PRC_AMT        AS ENT_DEAL_NET_UNIT_PRC_AMT -->
        ,CSPV.SP_FUNC_NET_UNIT_PRC_AMT         AS ENT_DEAL_NET_UNIT_PRC_AMT
<!-- END   2019/10/09 T.Ogura [QC#53502,MOD] -->
        ,CCDV.EDI_NUM                          AS EDI_NUM
        ,CCDV.EDI_SUB_NUM                      AS EDI_SUB_NUM
        ,CCDV.SHIP_TO_CUST_CD                  AS SHIP_TO_CUST_CD
        ,CCDV.SHIP_TO_LOC_NM                   AS SHIP_TO_LOC_NM
        ,CCDV.CUST_MDSE_CD                     AS CUST_MDSE_CD
        ,CSPV.SHPG_PLN_DPLY_LINE_NUM           AS SHPG_PLN_DPLY_LINE_NUM
        ,CSPV.SHPG_PLN_NUM                     AS SHPG_PLN_NUM
        ,CSPV.SHPG_STS_CD                      AS SHPG_STS_CD
        ,CSPV.PSD_DT                           AS PSD_DT
        ,CSPV.PDD_DT                           AS PDD_DT
        ,CSPV.ACTL_SHIP_DT                     AS ACTL_SHIP_DT
        ,CSPV.ACTL_ARV_DT                      AS ACTL_ARV_DT
        ,CSPV.ORD_QTY                          AS ORD_QTY
        ,CSPV.CR_HLD_QTY                       AS CR_HLD_QTY
        ,CSPV.SLS_HLD_QTY                      AS SLS_HLD_QTY
        ,CSPV.EZUPTIME                         AS EZUPTIME
        ,CSPV.PO_ORD_NUM                       AS PO_ORD_NUM
        ,CSPV.INVTY_LOC_CD                     AS INVTY_LOC_CD
        ,CSPV.SET_MDSE_CD                      AS SET_MDSE_CD
        ,CSPV.SET_SHPG_PLN_NUM                 AS SET_SHPG_PLN_NUM
        ,CSPV.PO_REQ_FLG                       AS PO_REQ_FLG
        ,CSPV.CUST_UOM_CD                      AS CUST_UOM_CD
        ,CSPV.CARR_CD                          AS CARR_CD
        ,CSPV.CARR_NM                          AS CARR_NM
        ,CSPV.PRO_NUM                          AS PRO_NUM
        ,CASE WHEN CSPV.PO_REQ_FLG = 'Y' THEN CSPV.THIRD_PTY_INV_NUM
              ELSE CSPV.SO_NUM
         END                                   AS SO_NUM
        <!--         ,CSPV.SO_NUM -->
        ,CSPV.SO_SLP_NUM                       AS SO_SLP_NUM
        ,CAMV.MDSE_NM                          AS MDSE_NM
        ,CSTCV.LOC_NM                          AS LOC_NM
        ,NVL(CSPV.ACTL_ARV_DT, CSPV.PDD_DT)    AS ETA_DT
        <!-- Start QC#20737 Add -->
        ,CAMV.MDSE_TP_CD                       AS MDSE_TP_CD
        ,CAMV.INVTY_CTRL_FLG                   AS INVTY_CTRL_FLG
        ,CAMV.AUTO_LIC_ALLOC_FLG               AS AUTO_LIC_ALLOC_FLG
        ,CSPV.TRX_HDR_NUM                      AS TRX_HDR_NUM
        ,CSPV.TRX_LINE_NUM                     AS TRX_LINE_NUM
        ,CSPV.TRX_LINE_SUB_NUM                 AS TRX_LINE_SUB_NUM
        <!-- End QC#20737 Add -->
    FROM
         CSA_CPO_V          CCV
        ,CSA_CPO_DTL_V      CCDV
        ,CSA_SHPG_PLN_V     CSPV
        ,CSA_ALL_MDSE_V     CAMV
        ,CSA_SELL_TO_CUST_V CSTCV
        WHERE 1=1
        AND CCV.EZCANCELFLAG          = '0'
        AND CCV.GLBL_CMPY_CD          = #glblCmpyCd#
  <!--  AND CCV.EZINUSERID            = #ezinUserId#-->
        AND CCV.CPO_ORD_TP_CD         = #cpoOrdTpCd#
        AND CCV.CUST_ISS_PO_NUM       IS NOT NULL
        AND CCV.CUST_ISS_PO_DT        IS NOT NULL
        AND CCDV.EZCANCELFLAG         = '0'
        AND CCV.GLBL_CMPY_CD          = CCDV.GLBL_CMPY_CD
        AND CCV.CPO_ORD_NUM           = CCDV.CPO_ORD_NUM
        AND CSPV.EZCANCELFLAG         = '0'
        AND CCDV.GLBL_CMPY_CD         = CSPV.GLBL_CMPY_CD
        AND CCDV.CPO_ORD_NUM          = CSPV.TRX_HDR_NUM
        AND CCDV.CPO_DTL_LINE_NUM     = CSPV.TRX_LINE_NUM
        AND CCDV.CPO_DTL_LINE_SUB_NUM = CSPV.TRX_LINE_SUB_NUM
        AND CSPV.TRX_SRC_TP_CD        = #trxSrcTpCd#
        AND CSPV.EZUPTIME          &gt;= #ezupTime#
        AND CSPV.SHPG_STS_CD NOT IN (
       <iterate property="shpgStsCdList" var="shpgStsCd[]" open="" close="" conjunction=",">
            #shpgStsCd[]#
        </iterate>
       )
        AND CAMV.EZCANCELFLAG     = '0'
        AND CSPV.GLBL_CMPY_CD     = CAMV.GLBL_CMPY_CD
        AND CSPV.MDSE_CD          = CAMV.MDSE_CD
        AND CSTCV.EZCANCELFLAG    = '0'
        AND CCV.GLBL_CMPY_CD      = CSTCV.GLBL_CMPY_CD
        AND CCV.SELL_TO_CUST_CD   = CSTCV.SELL_TO_CUST_CD
    <!-- Start QC#26090 Add -->
                <iterate property="billToCustCdList" var="billToCustCd[]" open="AND CCV.BILL_TO_CUST_CD IN (" close=")" conjunction=",">
                        #billToCustCd[]#
                </iterate>
                <iterate property="sellToCustCdList" var="sellToCustCd[]" open="AND CCV.SELL_TO_CUST_CD IN (" close=")" conjunction=",">
                        #sellToCustCd[]#
                </iterate>
        AND NOT EXISTS(
                        SELECT 
                            *
                        FROM
                            CSA_EDI_PO_DTL_SDQ_V CEPDSV
                        WHERE 1 = 1
                        AND CEPDSV.CPO_ORD_NUM     = CCDV.CPO_ORD_NUM
                        AND CEPDSV.EZCANCELFLAG    = '0'
                        AND CEPDSV.GLBL_CMPY_CD    = CCDV.GLBL_CMPY_CD
                        )
    <!-- Start QC#26090 End -->

    <!-- Start QC#20737 Add -->

<!-- START 2018/10/19 M.Naito [QC#30452,MOD] -->
    UNION
<!-- END 2018/10/19 M.Naito [QC#30452,MOD] -->

    SELECT
        CCV.CPO_ORD_NUM                     AS CPO_ORD_NUM
        ,CCV.ORD_HDR_STS_CD                 AS ORD_HDR_STS_CD
        ,CCV.CPO_HLD_FLG                    AS CPO_HLD_FLG
        ,CCV.SELL_TO_CUST_CD                AS SELL_TO_CUST_CD
        ,CCV.CUST_ISS_PO_NUM                AS CUST_ISS_PO_NUM
        ,CCV.CPO_ORD_TS                     AS CPO_ORD_TS
        ,CCDV.ORD_QTY                       AS ORIG_ORD_QTY
        ,CCDV.CPO_DTL_LINE_NUM              AS CPO_DTL_LINE_NUM
        ,CCDV.CPO_DTL_LINE_SUB_NUM          AS CPO_DTL_LINE_SUB_NUM
        ,CCDV.ORD_LINE_STS_CD               AS ORD_LINE_STS_CD
        ,CCDV.CCY_CD                        AS CCY_CD
        ,CSPV.MDSE_CD                       AS MDSE_CD
<!-- START 2019/10/09 T.Ogura [QC#53502,MOD] -->
<!--    ,CCDV.ENT_DEAL_NET_UNIT_PRC_AMT     AS ENT_DEAL_NET_UNIT_PRC_AMT -->
        ,CSPV.SP_FUNC_NET_UNIT_PRC_AMT      AS ENT_DEAL_NET_UNIT_PRC_AMT
<!-- END   2019/10/09 T.Ogura [QC#53502,MOD] -->
        ,CCDV.EDI_NUM                       AS EDI_NUM
        ,CCDV.EDI_SUB_NUM                   AS EDI_SUB_NUM
        ,CCDV.SHIP_TO_CUST_CD               AS SHIP_TO_CUST_CD
        ,CCDV.SHIP_TO_LOC_NM                AS SHIP_TO_LOC_NM
        ,CCDV.CUST_MDSE_CD                  AS CUST_MDSE_CD
        ,CSPV.SHPG_PLN_DPLY_LINE_NUM        AS SHPG_PLN_DPLY_LINE_NUM
        ,CSPV.SHPG_PLN_NUM                  AS SHPG_PLN_NUM
        ,CSPV.SHPG_STS_CD                   AS SHPG_STS_CD
        ,CSPV.PSD_DT                        AS PSD_DT
        ,CSPV.PDD_DT                        AS PDD_DT
        ,CSPV.ACTL_SHIP_DT                  AS ACTL_SHIP_DT
        ,CSPV.ACTL_ARV_DT                   AS ACTL_ARV_DT
        ,CSPV.ORD_QTY                       AS ORD_QTY
        ,CSPV.CR_HLD_QTY                    AS CR_HLD_QTY
        ,CSPV.SLS_HLD_QTY                   AS SLS_HLD_QTY
        ,CSPV.EZUPTIME                      AS EZUPTIME
        ,CSPV.PO_ORD_NUM                    AS PO_ORD_NUM
        ,CSPV.INVTY_LOC_CD                  AS INVTY_LOC_CD
        ,CSPV.SET_MDSE_CD                   AS SET_MDSE_CD
        ,CSPV.SET_SHPG_PLN_NUM              AS SET_SHPG_PLN_NUM
        ,CSPV.PO_REQ_FLG                    AS PO_REQ_FLG
        ,CSPV.CUST_UOM_CD                   AS CUST_UOM_CD
        ,CSPV.CARR_CD                       AS CARR_CD
        ,CSPV.CARR_NM                       AS CARR_NM
        ,CSPV.PRO_NUM                       AS PRO_NUM
        ,CASE WHEN CSPV.PO_REQ_FLG = 'Y' THEN CSPV.THIRD_PTY_INV_NUM
              ELSE CSPV.SO_NUM
         END                                AS SO_NUM
        ,CSPV.SO_SLP_NUM                    AS SO_SLP_NUM
        ,CAMV.MDSE_NM                       AS MDSE_NM
        ,CSTCV.LOC_NM                       AS LOC_NM
        ,NVL(CSPV.ACTL_ARV_DT, CSPV.PDD_DT) AS ETA_DT
        ,CAMV.MDSE_TP_CD                    AS MDSE_TP_CD
        ,CAMV.INVTY_CTRL_FLG                AS INVTY_CTRL_FLG
        ,CAMV.AUTO_LIC_ALLOC_FLG            AS AUTO_LIC_ALLOC_FLG
        ,CSPV.TRX_HDR_NUM                   AS TRX_HDR_NUM
        ,CSPV.TRX_LINE_NUM                  AS TRX_LINE_NUM
        ,CSPV.TRX_LINE_SUB_NUM              AS TRX_LINE_SUB_NUM
    FROM
         CSA_CPO_V          CCV
        ,CSA_CPO_DTL_V      CCDV
        ,CSA_SHPG_PLN_V     CSPV
        ,CSA_ALL_MDSE_V     CAMV
        ,CSA_SELL_TO_CUST_V CSTCV
        WHERE 1=1
        AND CCV.EZCANCELFLAG          = '0'
        AND CCV.GLBL_CMPY_CD          = #glblCmpyCd#
  <!--  AND CCV.EZINUSERID            = #ezinUserId#-->
        AND CCV.CPO_ORD_TP_CD         = #cpoOrdTpCd#
        AND CCV.CUST_ISS_PO_NUM       IS NOT NULL
        AND CCV.CUST_ISS_PO_DT        IS NOT NULL
        AND CCDV.EZCANCELFLAG         = '0'
        AND CCV.GLBL_CMPY_CD          = CCDV.GLBL_CMPY_CD
        AND CCV.CPO_ORD_NUM           = CCDV.CPO_ORD_NUM
        AND CSPV.EZCANCELFLAG         = '0'
        AND CCDV.GLBL_CMPY_CD         = CSPV.GLBL_CMPY_CD
        AND CCDV.CPO_ORD_NUM          = CSPV.TRX_HDR_NUM
        AND CCDV.CPO_DTL_LINE_NUM     = CSPV.TRX_LINE_NUM
        AND CCDV.CPO_DTL_LINE_SUB_NUM = CSPV.TRX_LINE_SUB_NUM
        AND CSPV.TRX_SRC_TP_CD        = #trxSrcTpCd#
        AND EXISTS (
                   SELECT
                       1
                   FROM
                       CSA_LAK_RPST_V  LAK
                   WHERE 1 = 1
                   <iterate property="cpoOrdTpCdList" var="cpoOrdTpCdList[]"   open="AND CCV.CPO_ORD_TP_CD NOT IN (" close=")" conjunction=",">
                       #cpoOrdTpCdList[]#
                   </iterate>
                   AND CCV.GLBL_CMPY_CD          = LAK.GLBL_CMPY_CD
                   AND CCV.CPO_ORD_NUM           = LAK.CPO_ORD_NUM
                   AND LAK.CPO_DTL_LINE_NUM      = CCDV.CPO_DTL_LINE_NUM
                   AND LAK.CPO_DTL_LINE_SUB_NUM  = CCDV.CPO_DTL_LINE_SUB_NUM
                   AND LAK.MDSE_CD               = CCDV.MDSE_CD
                   AND LAK.LAK_STS_CD            = #lakStsCd#
                   AND LAK.EZUPTIME           &gt;= #ezupTime#
                   AND LAK.EZCANCELFLAG          = '0'
                  )
        AND CSPV.SHPG_STS_CD NOT IN (
       <iterate property="shpgStsCdList" var="shpgStsCd[]" open="" close="" conjunction=",">
            #shpgStsCd[]#
        </iterate>
       )
        AND CAMV.EZCANCELFLAG     = '0'
        AND CSPV.GLBL_CMPY_CD     = CAMV.GLBL_CMPY_CD
        AND CSPV.MDSE_CD          = CAMV.MDSE_CD
        AND CSTCV.EZCANCELFLAG    = '0'
        AND CCV.GLBL_CMPY_CD      = CSTCV.GLBL_CMPY_CD
        AND CCV.SELL_TO_CUST_CD   = CSTCV.SELL_TO_CUST_CD
    <!-- Start QC#26090 Add -->
                <iterate property="billToCustCdList" var="billToCustCd[]" open="AND CCV.BILL_TO_CUST_CD IN (" close=")" conjunction=",">
                        #billToCustCd[]#
                </iterate>
                <iterate property="sellToCustCdList" var="sellToCustCd[]" open="AND CCV.SELL_TO_CUST_CD IN (" close=")" conjunction=",">
                        #sellToCustCd[]#
                </iterate>
        AND NOT EXISTS(
                        SELECT 
                            *
                        FROM
                            CSA_EDI_PO_DTL_SDQ_V CEPDSV
                        WHERE 1 = 1
                        AND CEPDSV.CPO_ORD_NUM     = CCDV.CPO_ORD_NUM
                        AND CEPDSV.EZCANCELFLAG    = '0'
                        AND CEPDSV.GLBL_CMPY_CD    = CCDV.GLBL_CMPY_CD
                        )
    <!-- Start QC#26090 End -->
        ORDER BY
            CUST_ISS_PO_NUM
           ,EDI_NUM
           ,TRX_HDR_NUM
           ,TRX_LINE_NUM
           ,TRX_LINE_SUB_NUM
           ,SHPG_PLN_DPLY_LINE_NUM
           ,SHPG_PLN_NUM
       <!-- End QC#20737 Add -->
    </statement>

    <statement id="mappingShpgStatus" parameterClass="Map" resultClass="Map">
        SELECT
            P.VND_PO_ACK_STS_CD
           ,P.ETD_DRV_PTRN_CD
           ,P.ETA_DRV_PTRN_CD
           ,V.PO_ACK_LINE_STS_CD
        FROM
            PO_ACK_VND_SHPG_STS_MAP P
           ,VND_PO_ACK_STS V
        WHERE 1=1
        AND P.EZCANCELFLAG      = '0'
        AND P.GLBL_CMPY_CD      = #glblCmpyCd#
        AND P.VND_SHPG_STS_CD   = #vndShpgStsCd#
        AND V.EZCANCELFLAG(+)   = '0'
        AND P.GLBL_CMPY_CD      = V.GLBL_CMPY_CD(+)
        AND P.VND_PO_ACK_STS_CD = V.VND_PO_ACK_STS_CD(+)
        AND ROWNUM = 1
    </statement>

    <statement id="getAckStsNm" parameterClass="Map" resultClass="String">
        SELECT
            PO_ACK_LINE_STS_NM
        FROM
            PO_ACK_LINE_STS
        WHERE 1=1
        AND EZCANCELFLAG       = '0'
        AND GLBL_CMPY_CD       = #glblCmpyCd#
        AND PO_ACK_LINE_STS_CD = #poAckLineStsCd#
        AND ROWNUM = 1
    </statement>

    <statement id="searchCsaCpoDtl" parameterClass="Map" resultClass="String">
        SELECT
            EDI_NUM
        FROM
            CSA_CPO_DTL_V
        WHERE 1=1
        AND EZCANCELFLAG         = '0'
        AND GLBL_CMPY_CD         = #glblCmpyCd#
        AND CPO_ORD_NUM          = #cpoOrdNum#
        AND CPO_DTL_LINE_NUM     = #cpoDtlLineNum#
        AND CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
        AND ROWNUM = 1
    </statement>

    <statement id="searchPoOrdDtlLineNum" parameterClass="Map" resultClass="String">
        SELECT
            PO_ORD_DTL_LINE_NUM
        FROM
            PO_DTL
        WHERE 1=1
        AND EZCANCELFLAG         = '0'
        AND GLBL_CMPY_CD         = #glblCmpyCd#
        AND PO_ORD_NUM           = #poOrdNum#
        <isNotNull property="poOrdDtlLineNum">
        AND PO_ORD_DTL_LINE_NUM  = #poOrdDtlLineNum#
        </isNotNull>
        <isNull property="poOrdDtlLineNum">
        AND PO_ORD_DTL_LINE_NUM  is NULL
        </isNull>
        AND ROWNUM = 1
    </statement>

    <statement id="searchAslMdseCd" parameterClass="Map" resultClass="Map">
        SELECT
            ASL_MDSE_CD
           ,PO_ORD_DTL_LINE_NUM
        FROM
            PO_DTL
        WHERE 1=1
        AND EZCANCELFLAG             = '0'
        AND GLBL_CMPY_CD             = #glblCmpyCd#
        AND PO_ORD_NUM               = #poOrdNum#
        AND SET_PO_ORD_DTL_LINE_NUM  = #setPoOrdDtlLineNum#
    </statement>

    <statement id="searchOrigAslMdseCd" parameterClass="Map" resultClass="String">
        SELECT
            ASL_MDSE_CD
        FROM
            PO_DTL
        WHERE 1=1
        AND EZCANCELFLAG             = '0'
        AND GLBL_CMPY_CD             = #glblCmpyCd#
        AND PO_ORD_NUM               = #poOrdNum#
         <isNotNull property="poOrdDtlLineNum">
        AND PO_ORD_DTL_LINE_NUM      = #poOrdDtlLineNum#
        </isNotNull>
         <isNull property="poOrdDtlLineNum">
        AND PO_ORD_DTL_LINE_NUM      IS NULL
        </isNull>
    </statement>

<!-- START 2018/10/19 M.Naito [QC#28830,ADD] -->
    <statement id="searchOrigAslMdseCdFromXref" parameterClass="Map" resultClass="String">
        SELECT DISTINCT
            PD.ASL_MDSE_CD
        FROM
            PO_DTL           PD
            ,EDI_PO_DTL_XREF EPD
        WHERE 1=1
        AND EPD.EZCANCELFLAG    = '0'
        AND EPD.GLBL_CMPY_CD    = #glblCmpyCd#
        AND EPD.EDI_PO_ORD_NUM  = #poOrdNum#
        AND PD.EZCANCELFLAG     = '0'
        AND EPD.GLBL_CMPY_CD    = PD.GLBL_CMPY_CD
        AND EPD.PO_ORD_NUM      = PD.PO_ORD_NUM
         <isNotNull property="poOrdDtlLineNum">
        AND PD.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
        </isNotNull>
         <isNull property="poOrdDtlLineNum">
        AND PD.PO_ORD_DTL_LINE_NUM IS NULL
        </isNull>
    </statement>
<!-- END 2018/10/19 M.Naito [QC#28830,ADD] -->

<!-- START 2019/02/25 M.Naito [QC#30452,ADD] -->
    <statement id="getPoOrdNumFromXref" parameterClass="Map" resultClass="String">
        SELECT DISTINCT
             PO.PO_ORD_NUM
        FROM
             PO               PO
            ,EDI_PO_DTL_XREF EPD
        WHERE
            EPD.EZCANCELFLAG    = '0'
        AND EPD.GLBL_CMPY_CD    = #glblCmpyCd#
        AND EPD.EDI_PO_ORD_NUM  = #poOrdNum#
        AND PO.EZCANCELFLAG     = '0'
        AND EPD.GLBL_CMPY_CD    = PO.GLBL_CMPY_CD
        AND EPD.PO_ORD_NUM      = PO.PO_ORD_NUM
    </statement>
<!-- END 2019/02/25 M.Naito [QC#30452,ADD] -->

    <statement id="searchMdseCmpsnTpCd" parameterClass="Map" resultClass="String">
        SELECT
            PO_MDSE_CMPSN_TP_CD
        FROM
            PO_DTL DPD
        WHERE 1=1
        AND DPD.EZCANCELFLAG             = '0'
        AND DPD.GLBL_CMPY_CD             = #glblCmpyCd#
        AND DPD.PO_ORD_NUM               = #poOrdNum#
        AND DPD.PO_ORD_DTL_LINE_NUM      = #poOrdDtlLineNum#
    </statement>

    <statement id="searcOrdTakeMdse" parameterClass="Map" resultClass="String">
        SELECT
            ORD_TAKE_MDSE_CD
        FROM
            CSA_ORD_TAKE_MDSE_V
        WHERE 1=1
        AND EZCANCELFLAG             = '0'
        AND GLBL_CMPY_CD             = #glblCmpyCd#
        AND ORD_TAKE_MDSE_CD         = #ordTakeMdseCd#
        AND ROWNUM = 1
    </statement>

    <statement id="getWsEdiOrderCancelInfo" parameterClass="Map" resultClass="Map">
           SELECT
                CEPHV.EZUPTIME              AS H_EZUPTIME
               ,CEPHV.CUST_EDI_PO_NUM       AS H_CUST_EDI_PO_NUM
               ,CEPHV.EDI_PROC_STS_CD       AS H_EDI_PROC_STS_CD
               ,CEPDV.EZUPTIME              AS D_EZUPTIME
               ,CEPDV.ORD_QTY               AS D_ORD_QTY
               ,CEPDV.CUSA_MDSE_CD          AS D_CUSA_MDSE_CD
               ,CEPDV.TRD_PTNR_SKU_CD       AS D_TRD_PTNR_SKU_CD
               ,CEPDV.UNIT_PRC_AMT          AS D_UNIT_PRC_AMT
               ,CEPDV.UOM_CD                AS D_UOM_CD
               ,CEPDV.ORIG_TRD_PTNR_SKU_CD  AS D_ORIG_TRD_PTNR_SKU_CD
               ,CEPDV.ORIG_ORD_QTY          AS D_ORIG_ORD_QTY
               ,CEPDV.ORIG_CUSA_MDSE_CD     AS D_ORIG_CUSA_MDSE_CD
               ,CEPDV.CUST_EDI_PO_NUM       AS D_CUST_EDI_PO_NUM
               ,CEPDV.EDI_PO_LINE_NUM       AS D_EDI_PO_LINE_NUM
               ,CEPDV.EDI_PROC_STS_CD       AS D_EDI_PROC_STS_CD
               ,CEPDSV.EZUPTIME             AS S_EZUPTIME
               ,CEPDSV.ORD_QTY              AS S_ORD_QTY
               ,CAMV.MDSE_NM                AS M_MDSE_NM
            FROM
                CSA_EDI_TRD_PTNR_V   CETPV
               ,CSA_EDI_PO_HDR_V     CEPHV
               ,CSA_EDI_PO_DTL_V     CEPDV
               ,CSA_EDI_PO_DTL_SDQ_V CEPDSV
               ,CSA_ALL_MDSE_V       CAMV
            WHERE 1=1
            AND CETPV.EZCANCELFLAG      = '0'
            AND CETPV.GLBL_CMPY_CD      = #glblCmpyCd#
            AND CETPV.EDI_TRD_PTNR_CD IN (
        <iterate property="ediTrdPtnrCdList" var="ediTrdPtnrCd[]" open="" close="" conjunction=",">
            #ediTrdPtnrCd[]#
        </iterate>
            )
            AND CEPHV.EZCANCELFLAG      = '0'
            AND CETPV.GLBL_CMPY_CD      = CEPHV.GLBL_CMPY_CD
            AND CETPV.SEND_ID           = CEPHV.SEND_ID
            AND CETPV.RCV_ID            = CEPHV.RCV_ID
            AND CETPV.EDI_TRD_PTNR_CD   = CEPHV.EDI_TRD_PTNR_CD
            AND CEPHV.EDI_TRX_PRPS_CD   = #ediTrxPrpsCd#
<!-- QC#24404 -->            
<!-- AND CEPHV.CPO_SRC_TP_CD     = #cpoSrcTpCd# -->
            AND CEPHV.CPO_SRC_TP_CD IN
        <iterate property="cpoSrcTpCdList" var="cpoSrcTpCd[]" open="(" conjunction= ", " close=")">
            #cpoSrcTpCd[]#
        </iterate>
            AND NVL(CEPHV.CPO_ORD_TP_CD , #cpoOrdTpCd# ) = #cpoOrdTpCd#
            AND CEPHV.SDQ_PO_TP_FLG     = #sdqPoTpFlg#
            AND CEPDV.EZCANCELFLAG      = '0'
            AND CEPHV.GLBL_CMPY_CD      = CEPDV.GLBL_CMPY_CD
            AND CEPHV.SEND_ID           = CEPDV.SEND_ID
            AND CEPHV.RCV_ID            = CEPDV.RCV_ID
            AND CEPHV.CUST_EDI_PO_NUM   = CEPDV.CUST_EDI_PO_NUM
            AND CEPHV.CUST_EDI_PO_DT    = CEPDV.CUST_EDI_PO_DT
            AND CEPHV.EDI_TRX_PRPS_CD   = CEPDV.EDI_TRX_PRPS_CD
            AND CEPHV.EDI_PROC_STS_CD IN(
        <iterate property="H_ediProcStsCdList" var="H_ediProcStsCd[]" open="" close="" conjunction=",">
            #H_ediProcStsCd[]#
        </iterate>
             )
            AND(    ( CEPHV.EDI_PROC_STS_CD = #ediProcStsCd_C# AND CEPDV.EZUPTIME  &gt;= #ezupTime# )
                OR  ( CEPHV.EDI_PROC_STS_CD = #ediProcStsCd_E# AND CEPDSV.EZUPTIME &gt;= #ezupTime# )
            )
            AND CEPDV.EDI_PROC_STS_CD  != #D_ediProcStsCd#
            AND CEPDSV.EZCANCELFLAG     = '0'
            AND CEPDV.GLBL_CMPY_CD      = CEPDSV.GLBL_CMPY_CD
            AND CEPDV.SEND_ID           = CEPDSV.SEND_ID
            AND CEPDV.RCV_ID            = CEPDSV.RCV_ID
            AND CEPDV.CUST_EDI_PO_NUM   = CEPDSV.CUST_EDI_PO_NUM
            AND CEPDV.CUST_EDI_PO_DT    = CEPDSV.CUST_EDI_PO_DT
            AND CEPDV.EDI_TRX_PRPS_CD   = CEPDSV.EDI_TRX_PRPS_CD
            AND CEPDV.EDI_PO_LINE_NUM   = CEPDSV.EDI_PO_LINE_NUM
            AND CAMV.EZCANCELFLAG(+)    = '0'
            AND CEPDV.GLBL_CMPY_CD      = CAMV.GLBL_CMPY_CD(+)
            AND CEPDV.CUSA_MDSE_CD      = CAMV.MDSE_CD(+)
        ORDER BY
            CEPHV.SEND_ID
           ,CEPHV.RCV_ID
           ,CEPHV.CUST_EDI_PO_NUM
           ,CEPHV.CUST_EDI_PO_DT 
           ,CEPDV.EDI_PO_LINE_NUM
           ,CEPDSV.EDI_PO_SUB_LINE_NUM
    </statement>

    <statement id="getWsEdiOrderNomalInfo" parameterClass="Map" resultClass="Map">
       SELECT
            *
        FROM
            (
               SELECT /*+ INDEX(CSPV SHPG_PLN_I2) */
                    CEPHV.EZUPTIME                 AS H_EZUPTIME
                   ,CEPHV.CUST_EDI_PO_NUM          AS H_CUST_EDI_PO_NUM
                   ,CEPHV.EDI_PROC_STS_CD          AS H_EDI_PROC_STS_CD
                   ,CEPDV.EZUPTIME                 AS D_EZUPTIME
                   ,CEPDV.ORD_QTY                  AS ED_ORD_QTY
                   ,CEPDV.CUSA_MDSE_CD             AS D_CUSA_MDSE_CD
                   ,CEPDV.TRD_PTNR_SKU_CD          AS D_TRD_PTNR_SKU_CD
                   ,CEPDV.UNIT_PRC_AMT             AS D_UNIT_PRC_AMT
                   ,CEPDV.ORIG_TRD_PTNR_SKU_CD     AS D_ORIG_TRD_PTNR_SKU_CD
                   ,CEPDV.ORIG_ORD_QTY             AS D_ORIG_ORD_QTY
                   ,CEPDV.ORIG_CUSA_MDSE_CD        AS D_ORIG_CUSA_MDSE_CD
                   ,CEPDV.CUST_EDI_PO_NUM          AS D_CUST_EDI_PO_NUM
                   ,CEPDV.EDI_PO_LINE_NUM          AS D_EDI_PO_LINE_NUM
                   ,CEPDV.EDI_PROC_STS_CD          AS D_EDI_PROC_STS_CD
                   ,CEPHV.SEND_ID                  AS H_SEND_ID  
                   ,CEPHV.RCV_ID                   AS H_RCV_ID
                   ,CEPHV.CUST_EDI_PO_DT           AS H_CUST_EDI_PO_DT
                   ,CEPDSV.EZUPTIME                AS S_EZUPTIME
                   ,CEPDSV.ORD_QTY                 AS S_ORD_QTY
                   ,CCV.CPO_ORD_NUM                AS H_CPO_ORD_NUM
                   ,CCV.ORD_HDR_STS_CD             AS H_ORD_HDR_STS_CD
                   ,CCV.CPO_HLD_FLG                AS H_CPO_HLD_FLG
                   ,CCV.SELL_TO_CUST_CD            AS H_SELL_TO_CUST_CD
                   ,CCV.CUST_ISS_PO_NUM            AS H_CUST_ISS_PO_NUM
                   ,CCV.EZUPTIME                   AS HC_EZUPTIME
                   ,CCV.CPO_ORD_TS                 AS H_CPO_ORD_TS
                   ,CCDV.ORD_QTY                   AS D_ORD_QTY
                   ,CCDV.CPO_DTL_LINE_NUM          AS D_CPO_DTL_LINE_NUM
                   ,CCDV.CPO_DTL_LINE_SUB_NUM      AS D_CPO_DTL_LINE_SUB_NUM
                   ,CCDV.CCY_CD                    AS D_CCY_CD
                   ,CEPDV.UOM_CD                   AS D_UOM_CD
                   ,CCDV.ENT_DEAL_NET_UNIT_PRC_AMT AS D_ENT_DEAL_NET_UNIT_PRC_AMT
                   ,CCDV.EDI_NUM                   AS D_EDI_NUM
                   ,CCDV.EDI_SUB_NUM               AS D_EDI_SUB_NUM
                   ,CCDV.SHIP_TO_CUST_CD           AS D_SHIP_TO_CUST_CD
                   ,CCDV.SHIP_TO_LOC_NM            AS D_SHIP_TO_LOC_NM
                   ,CCDV.ORD_LINE_STS_CD           AS D_ORD_LINE_STS_CD
                   ,CCDV.CUST_MDSE_CD              AS D_CUST_MDSE_CD
                   ,CSPV.MDSE_CD                   AS SP_MDSE_CD
                   ,CSPV.SHPG_PLN_DPLY_LINE_NUM    AS SP_SHPG_PLN_DPLY_LINE_NUM
                   ,CSPV.SHPG_PLN_NUM              AS SP_SHPG_PLN_NUM
                   ,CSPV.SHPG_STS_CD               AS SP_SHPG_STS_CD
                   ,CSPV.PSD_DT                    AS SP_PSD_DT
                   ,CSPV.PDD_DT                    AS SP_PDD_DT
                   ,CSPV.ACTL_SHIP_DT              AS SP_ACTL_SHIP_DT
                   ,CSPV.ACTL_ARV_DT               AS SP_ACTL_ARV_DT
                   ,CSPV.ORD_QTY                   AS SP_ORD_QTY
                   ,CSPV.CR_HLD_QTY                AS SP_CR_HLD_QTY
                   ,CSPV.SLS_HLD_QTY               AS SP_SLS_HLD_QTY
                   ,CSPV.EZUPTIME                  AS SP_EZUPTIME
                   ,CSPV.PO_ORD_NUM                AS SP_PO_ORD_NUM
                   ,CSPV.INVTY_LOC_CD              AS SP_INVTY_LOC_CD
                   ,CSPV.SET_MDSE_CD               AS SP_SET_MDSE_CD
                   ,CSPV.SET_SHPG_PLN_NUM          AS SP_SET_SHPG_PLN_NUM
                   ,CSPV.PO_REQ_FLG                AS SP_PO_REQ_FLG
                   ,CSPV.TRX_HDR_NUM               AS SP_TRX_HDR_NUM
                   ,CSPV.TRX_LINE_NUM              AS SP_TRX_LINE_NUM
                   ,CSPV.TRX_LINE_SUB_NUM          AS SP_TRX_LINE_SUB_NUM
                   ,CSPV.CUST_UOM_CD               AS SP_CUST_UOM_CD
                   ,CSPV.CARR_CD                   AS SP_CARR_CD
                   ,CSPV.CARR_NM                   AS SP_CARR_NM
                   ,CSPV.PRO_NUM                   AS SP_PRO_NUM
                   <!-- ,CSPV.SO_NUM                    AS SP_SO_NUM -->
                   ,CASE WHEN CSPV.PO_REQ_FLG = 'Y' THEN CSPV.THIRD_PTY_INV_NUM
                         ELSE CSPV.SO_NUM
                    END AS SP_SO_NUM
                   ,CSPV.SO_SLP_NUM                AS SP_SO_SLP_NUM
                   ,CAMV.MDSE_NM                   AS M_MDSE_NM
                   ,CSTCV.LOC_NUM                  AS CS_LOC_NUM
                   ,NVL(CSPV.ACTL_ARV_DT, CSPV.PDD_DT) AS ETA_DT
                   ,DECODE(CEPDV.EDI_PROC_STS_CD , #D_ediProcStsCd# , 1, 0) AS PROC_STS
                   <!-- Start QC#20737 Add  -->
                   ,CAMV.MDSE_TP_CD                AS MDSE_TP_CD
                   ,CAMV.INVTY_CTRL_FLG            AS INVTY_CTRL_FLG
                   ,CAMV.AUTO_LIC_ALLOC_FLG        AS AUTO_LIC_ALLOC_FLG
                   <!-- End QC#20737 Add  -->
                FROM
                    CSA_EDI_TRD_PTNR_V   CETPV
                   ,CSA_EDI_PO_HDR_V     CEPHV
                   ,CSA_EDI_PO_DTL_V     CEPDV
                   ,CSA_EDI_PO_DTL_SDQ_V CEPDSV
                   ,CSA_CPO_V            CCV
                   ,CSA_CPO_DTL_V        CCDV
                   ,CSA_SHPG_PLN_V       CSPV
                   ,CSA_ALL_MDSE_V       CAMV
                   ,CSA_SELL_TO_CUST_V   CSTCV
                WHERE 1=1
                AND CETPV.EZCANCELFLAG      = '0'
                AND CETPV.GLBL_CMPY_CD      = #glblCmpyCd#
                AND CETPV.EDI_TRD_PTNR_CD IN (
            <iterate property="ediTrdPtnrCdList" var="ediTrdPtnrCd[]" open="" close="" conjunction=",">
                #ediTrdPtnrCd[]#
            </iterate>
                )
                AND CEPHV.EZCANCELFLAG      = '0'
                AND CETPV.GLBL_CMPY_CD      = CEPHV.GLBL_CMPY_CD
                AND CETPV.SEND_ID           = CEPHV.SEND_ID 
                AND CETPV.RCV_ID            = CEPHV.RCV_ID
                AND CETPV.EDI_TRD_PTNR_CD   = CEPHV.EDI_TRD_PTNR_CD
                AND CEPHV.EDI_TRX_PRPS_CD   = #ediTrxPrpsCd#
<!-- QC#24404 -->            
<!-- AND CEPHV.CPO_SRC_TP_CD     = #cpoSrcTpCd# -->
            AND CEPHV.CPO_SRC_TP_CD IN
            <iterate property="cpoSrcTpCdList" var="cpoSrcTpCd[]" open="(" conjunction= ", " close=")">
                #cpoSrcTpCd[]#
            </iterate>
                AND NVL(CEPHV.CPO_ORD_TP_CD , #cpoOrdTpCd# ) = #cpoOrdTpCd#
                AND CEPHV.SDQ_PO_TP_FLG     = #sdqPoTpFlg#
                AND CEPHV.EDI_PROC_STS_CD   = #H_ediProcStsCd#
                AND CEPDV.EZCANCELFLAG      = '0'
                AND CEPHV.GLBL_CMPY_CD      = CEPDV.GLBL_CMPY_CD
                AND CEPHV.SEND_ID           = CEPDV.SEND_ID
                AND CEPHV.RCV_ID            = CEPDV.RCV_ID
                AND CEPHV.CUST_EDI_PO_NUM   = CEPDV.CUST_EDI_PO_NUM
                AND CEPHV.CUST_EDI_PO_DT    = CEPDV.CUST_EDI_PO_DT
                AND CEPHV.EDI_TRX_PRPS_CD   = CEPDV.EDI_TRX_PRPS_CD
                AND CEPDV.EDI_PROC_STS_CD NOT IN (
            <iterate property="D_ediProcStsCdList" var="D_ediProcStsCd[]" open="" close="" conjunction=",">
                #D_ediProcStsCd[]#
            </iterate>
                )
                AND CEPDSV.EZCANCELFLAG       = '0'
                AND CEPDV.GLBL_CMPY_CD        = CEPDSV.GLBL_CMPY_CD
                AND CEPDV.SEND_ID             = CEPDSV.SEND_ID
                AND CEPDV.RCV_ID              = CEPDSV.RCV_ID
                AND CEPDV.CUST_EDI_PO_NUM     = CEPDSV.CUST_EDI_PO_NUM
                AND CEPDV.CUST_EDI_PO_DT      = CEPDSV.CUST_EDI_PO_DT
                AND CEPDV.EDI_TRX_PRPS_CD     = CEPDSV.EDI_TRX_PRPS_CD
                AND CEPDV.EDI_PO_LINE_NUM     = CEPDSV.EDI_PO_LINE_NUM
                AND CCV.EZCANCELFLAG          = '0'
                AND CEPDSV.GLBL_CMPY_CD       = CCV.GLBL_CMPY_CD
                AND CEPDSV.CPO_ORD_NUM        = CCV.CPO_ORD_NUM
                AND CCDV.EZCANCELFLAG         = '0'
                AND CEPDSV.GLBL_CMPY_CD       = CCDV.GLBL_CMPY_CD
                AND CEPDSV.CPO_ORD_NUM        = CCDV.CPO_ORD_NUM
                AND CEPDSV.EDI_PO_LINE_NUM    = CCDV.EDI_NUM
                AND SUBSTR(CEPDSV.EDI_PO_SUB_LINE_NUM  , 4 , 3 )  = CCDV.EDI_SUB_NUM
                AND CSPV.EZCANCELFLAG         = '0'
                AND CCDV.GLBL_CMPY_CD         = CSPV.GLBL_CMPY_CD
                AND CCDV.CPO_ORD_NUM          = CSPV.TRX_HDR_NUM
                AND CCDV.CPO_DTL_LINE_NUM     = CSPV.TRX_LINE_NUM
                AND CCDV.CPO_DTL_LINE_SUB_NUM = CSPV.TRX_LINE_SUB_NUM
                AND CSPV.TRX_SRC_TP_CD        = #trxSrcTpCd#
                AND CSPV.SHPG_STS_CD  IN (
            <iterate property="shpgStsCdList" var="shpgStsCd[]" open="" close="" conjunction=",">
                #shpgStsCd[]#
            </iterate>
                )
                AND CSPV.EZUPTIME          &gt;= #ezupTime#
                AND CAMV.EZCANCELFLAG(+)      = '0'
                AND CSPV.GLBL_CMPY_CD         = CAMV.GLBL_CMPY_CD(+)
                AND CSPV.MDSE_CD              = CAMV.MDSE_CD(+)
                AND CSTCV.EZCANCELFLAG        = '0'
                AND CCV.GLBL_CMPY_CD          = CSTCV.GLBL_CMPY_CD
                AND CCV.SELL_TO_CUST_CD       = CSTCV.SELL_TO_CUST_CD
                ORDER BY
                 CEPHV.SEND_ID
                ,CEPHV.RCV_ID
                ,CEPHV.CUST_EDI_PO_NUM
                ,CEPHV.CUST_EDI_PO_DT
                ,DECODE(CEPDV.EDI_PROC_STS_CD , #D_ediProcStsCd# , 1, 0)
                ,CEPDV.EDI_PO_LINE_NUM
                ,CSPV.TRX_HDR_NUM
                ,CSPV.TRX_LINE_NUM
                ,CSPV.TRX_LINE_SUB_NUM
                ,CSPV.SHPG_PLN_DPLY_LINE_NUM
                ,CSPV.SHPG_PLN_NUM
        )
    <!-- Start QC#20737 Add  -->
    UNION

        SELECT
            *
        FROM
            (
               SELECT
                    CEPHV.EZUPTIME                 AS H_EZUPTIME
                   ,CEPHV.CUST_EDI_PO_NUM          AS H_CUST_EDI_PO_NUM
                   ,CEPHV.EDI_PROC_STS_CD          AS H_EDI_PROC_STS_CD
                   ,CEPDV.EZUPTIME                 AS D_EZUPTIME
                   ,CEPDV.ORD_QTY                  AS ED_ORD_QTY
                   ,CEPDV.CUSA_MDSE_CD             AS D_CUSA_MDSE_CD
                   ,CEPDV.TRD_PTNR_SKU_CD          AS D_TRD_PTNR_SKU_CD
                   ,CEPDV.UNIT_PRC_AMT             AS D_UNIT_PRC_AMT
                   ,CEPDV.ORIG_TRD_PTNR_SKU_CD     AS D_ORIG_TRD_PTNR_SKU_CD
                   ,CEPDV.ORIG_ORD_QTY             AS D_ORIG_ORD_QTY
                   ,CEPDV.ORIG_CUSA_MDSE_CD        AS D_ORIG_CUSA_MDSE_CD
                   ,CEPDV.CUST_EDI_PO_NUM          AS D_CUST_EDI_PO_NUM
                   ,CEPDV.EDI_PO_LINE_NUM          AS D_EDI_PO_LINE_NUM
                   ,CEPDV.EDI_PROC_STS_CD          AS D_EDI_PROC_STS_CD
                   ,CEPHV.SEND_ID                  AS H_SEND_ID  
                   ,CEPHV.RCV_ID                   AS H_RCV_ID
                   ,CEPHV.CUST_EDI_PO_DT           AS H_CUST_EDI_PO_DT
                   ,CEPDSV.EZUPTIME                AS S_EZUPTIME
                   ,CEPDSV.ORD_QTY                 AS S_ORD_QTY
                   ,CCV.CPO_ORD_NUM                AS H_CPO_ORD_NUM
                   ,CCV.ORD_HDR_STS_CD             AS H_ORD_HDR_STS_CD
                   ,CCV.CPO_HLD_FLG                AS H_CPO_HLD_FLG
                   ,CCV.SELL_TO_CUST_CD            AS H_SELL_TO_CUST_CD
                   ,CCV.CUST_ISS_PO_NUM            AS H_CUST_ISS_PO_NUM
                   ,CCV.EZUPTIME                   AS HC_EZUPTIME
                   ,CCV.CPO_ORD_TS                 AS H_CPO_ORD_TS
                   ,CCDV.ORD_QTY                   AS D_ORD_QTY
                   ,CCDV.CPO_DTL_LINE_NUM          AS D_CPO_DTL_LINE_NUM
                   ,CCDV.CPO_DTL_LINE_SUB_NUM      AS D_CPO_DTL_LINE_SUB_NUM
                   ,CCDV.CCY_CD                    AS D_CCY_CD
                   ,CEPDV.UOM_CD                   AS D_UOM_CD
                   ,CCDV.ENT_DEAL_NET_UNIT_PRC_AMT AS D_ENT_DEAL_NET_UNIT_PRC_AMT
                   ,CCDV.EDI_NUM                   AS D_EDI_NUM
                   ,CCDV.EDI_SUB_NUM               AS D_EDI_SUB_NUM
                   ,CCDV.SHIP_TO_CUST_CD           AS D_SHIP_TO_CUST_CD
                   ,CCDV.SHIP_TO_LOC_NM            AS D_SHIP_TO_LOC_NM
                   ,CCDV.ORD_LINE_STS_CD           AS D_ORD_LINE_STS_CD
                   ,CCDV.CUST_MDSE_CD              AS D_CUST_MDSE_CD
                   ,CSPV.MDSE_CD                   AS SP_MDSE_CD
                   ,CSPV.SHPG_PLN_DPLY_LINE_NUM    AS SP_SHPG_PLN_DPLY_LINE_NUM
                   ,CSPV.SHPG_PLN_NUM              AS SP_SHPG_PLN_NUM
                   ,CSPV.SHPG_STS_CD               AS SP_SHPG_STS_CD
                   ,CSPV.PSD_DT                    AS SP_PSD_DT
                   ,CSPV.PDD_DT                    AS SP_PDD_DT
                   ,CSPV.ACTL_SHIP_DT              AS SP_ACTL_SHIP_DT
                   ,CSPV.ACTL_ARV_DT               AS SP_ACTL_ARV_DT
                   ,CSPV.ORD_QTY                   AS SP_ORD_QTY
                   ,CSPV.CR_HLD_QTY                AS SP_CR_HLD_QTY
                   ,CSPV.SLS_HLD_QTY               AS SP_SLS_HLD_QTY
                   ,CSPV.EZUPTIME                  AS SP_EZUPTIME
                   ,CSPV.PO_ORD_NUM                AS SP_PO_ORD_NUM
                   ,CSPV.INVTY_LOC_CD              AS SP_INVTY_LOC_CD
                   ,CSPV.SET_MDSE_CD               AS SP_SET_MDSE_CD
                   ,CSPV.SET_SHPG_PLN_NUM          AS SP_SET_SHPG_PLN_NUM
                   ,CSPV.PO_REQ_FLG                AS SP_PO_REQ_FLG
                   ,CSPV.TRX_HDR_NUM               AS SP_TRX_HDR_NUM
                   ,CSPV.TRX_LINE_NUM              AS SP_TRX_LINE_NUM
                   ,CSPV.TRX_LINE_SUB_NUM          AS SP_TRX_LINE_SUB_NUM
                   ,CSPV.CUST_UOM_CD               AS SP_CUST_UOM_CD
                   ,CSPV.CARR_CD                   AS SP_CARR_CD
                   ,CSPV.CARR_NM                   AS SP_CARR_NM
                   ,CSPV.PRO_NUM                   AS SP_PRO_NUM
                   ,CASE WHEN CSPV.PO_REQ_FLG = 'Y' THEN CSPV.THIRD_PTY_INV_NUM
                         ELSE CSPV.SO_NUM
                    END AS SP_SO_NUM
                   ,CSPV.SO_SLP_NUM                AS SP_SO_SLP_NUM
                   ,CAMV.MDSE_NM                   AS M_MDSE_NM
                   ,CSTCV.LOC_NUM                  AS CS_LOC_NUM
                   ,NVL(CSPV.ACTL_ARV_DT, CSPV.PDD_DT) AS ETA_DT
                   ,DECODE(CEPDV.EDI_PROC_STS_CD , #D_ediProcStsCd# , 1, 0) AS PROC_STS
                   ,CAMV.MDSE_TP_CD                AS MDSE_TP_CD
                   ,CAMV.INVTY_CTRL_FLG            AS INVTY_CTRL_FLG
                   ,CAMV.AUTO_LIC_ALLOC_FLG        AS AUTO_LIC_ALLOC_FLG
                FROM
                    CSA_EDI_TRD_PTNR_V   CETPV
                   ,CSA_EDI_PO_HDR_V     CEPHV
                   ,CSA_EDI_PO_DTL_V     CEPDV
                   ,CSA_EDI_PO_DTL_SDQ_V CEPDSV
                   ,CSA_CPO_V            CCV
                   ,CSA_CPO_DTL_V        CCDV
                   ,CSA_SHPG_PLN_V       CSPV
                   ,CSA_ALL_MDSE_V       CAMV
                   ,CSA_SELL_TO_CUST_V   CSTCV
                WHERE 1=1
                AND CETPV.EZCANCELFLAG      = '0'
                AND CETPV.GLBL_CMPY_CD      = #glblCmpyCd#
                AND CETPV.EDI_TRD_PTNR_CD IN (
            <iterate property="ediTrdPtnrCdList" var="ediTrdPtnrCd[]" open="" close="" conjunction=",">
                #ediTrdPtnrCd[]#
            </iterate>
                )
                AND CEPHV.EZCANCELFLAG      = '0'
                AND CETPV.GLBL_CMPY_CD      = CEPHV.GLBL_CMPY_CD
                AND CETPV.SEND_ID           = CEPHV.SEND_ID 
                AND CETPV.RCV_ID            = CEPHV.RCV_ID
                AND CETPV.EDI_TRD_PTNR_CD   = CEPHV.EDI_TRD_PTNR_CD
                AND CEPHV.EDI_TRX_PRPS_CD   = #ediTrxPrpsCd#
<!-- QC#24404 -->            
<!-- AND CEPHV.CPO_SRC_TP_CD     = #cpoSrcTpCd# -->
            AND CEPHV.CPO_SRC_TP_CD IN
            <iterate property="cpoSrcTpCdList" var="cpoSrcTpCd[]" open="(" conjunction= ", " close=")">
                #cpoSrcTpCd[]#
            </iterate>
                AND NVL(CEPHV.CPO_ORD_TP_CD , #cpoOrdTpCd# ) = #cpoOrdTpCd#
                AND CEPHV.SDQ_PO_TP_FLG     = #sdqPoTpFlg#
                AND CEPHV.EDI_PROC_STS_CD   = #H_ediProcStsCd#
                AND CEPDV.EZCANCELFLAG      = '0'
                AND CEPHV.GLBL_CMPY_CD      = CEPDV.GLBL_CMPY_CD
                AND CEPHV.SEND_ID           = CEPDV.SEND_ID
                AND CEPHV.RCV_ID            = CEPDV.RCV_ID
                AND CEPHV.CUST_EDI_PO_NUM   = CEPDV.CUST_EDI_PO_NUM
                AND CEPHV.CUST_EDI_PO_DT    = CEPDV.CUST_EDI_PO_DT
                AND CEPHV.EDI_TRX_PRPS_CD   = CEPDV.EDI_TRX_PRPS_CD
                AND CEPDV.EDI_PROC_STS_CD NOT IN (
            <iterate property="D_ediProcStsCdList" var="D_ediProcStsCd[]" open="" close="" conjunction=",">
                #D_ediProcStsCd[]#
            </iterate>
                )
                AND CEPDSV.EZCANCELFLAG       = '0'
                AND CEPDV.GLBL_CMPY_CD        = CEPDSV.GLBL_CMPY_CD
                AND CEPDV.SEND_ID             = CEPDSV.SEND_ID
                AND CEPDV.RCV_ID              = CEPDSV.RCV_ID
                AND CEPDV.CUST_EDI_PO_NUM     = CEPDSV.CUST_EDI_PO_NUM
                AND CEPDV.CUST_EDI_PO_DT      = CEPDSV.CUST_EDI_PO_DT
                AND CEPDV.EDI_TRX_PRPS_CD     = CEPDSV.EDI_TRX_PRPS_CD
                AND CEPDV.EDI_PO_LINE_NUM     = CEPDSV.EDI_PO_LINE_NUM
                AND CCV.EZCANCELFLAG          = '0'
                AND CEPDSV.GLBL_CMPY_CD       = CCV.GLBL_CMPY_CD
                AND CEPDSV.CPO_ORD_NUM        = CCV.CPO_ORD_NUM
                AND CCDV.EZCANCELFLAG         = '0'
                AND CEPDSV.GLBL_CMPY_CD       = CCDV.GLBL_CMPY_CD
                AND CEPDSV.CPO_ORD_NUM        = CCDV.CPO_ORD_NUM
                AND CEPDSV.EDI_PO_LINE_NUM    = CCDV.EDI_NUM
                AND SUBSTR(CEPDSV.EDI_PO_SUB_LINE_NUM  , 4 , 3 )  = CCDV.EDI_SUB_NUM
                AND CSPV.EZCANCELFLAG         = '0'
                AND CCDV.GLBL_CMPY_CD         = CSPV.GLBL_CMPY_CD
                AND CCDV.CPO_ORD_NUM          = CSPV.TRX_HDR_NUM
                AND CCDV.CPO_DTL_LINE_NUM     = CSPV.TRX_LINE_NUM
                AND CCDV.CPO_DTL_LINE_SUB_NUM = CSPV.TRX_LINE_SUB_NUM
                AND CSPV.TRX_SRC_TP_CD        = #trxSrcTpCd#
                AND CSPV.SHPG_STS_CD  IN (
            <iterate property="shpgStsCdList" var="shpgStsCd[]" open="" close="" conjunction=",">
                #shpgStsCd[]#
            </iterate>
                )
                AND EXISTS (
                             SELECT
                                 1
                             FROM
                                 CSA_LAK_RPST_V  LAK
                             WHERE 1 = 1
                             <iterate property="cpoOrdTpCdList" var="cpoOrdTpCdList[]"   open="AND CCV.CPO_ORD_TP_CD NOT IN (" close=")" conjunction=",">
                                #cpoOrdTpCdList[]#
                             </iterate>
                             AND CCV.GLBL_CMPY_CD          = LAK.GLBL_CMPY_CD
                             AND CCV.CPO_ORD_NUM           = LAK.CPO_ORD_NUM
                             AND LAK.CPO_DTL_LINE_NUM      = CCDV.CPO_DTL_LINE_NUM
                             AND LAK.CPO_DTL_LINE_SUB_NUM  = CCDV.CPO_DTL_LINE_SUB_NUM
                             AND LAK.MDSE_CD               = CCDV.MDSE_CD
                             AND LAK.LAK_STS_CD            = #lakStsCd#
                             AND LAK.EZUPTIME           &gt;= #ezupTime#
                             AND LAK.EZCANCELFLAG          = '0'
                            )
                AND CAMV.EZCANCELFLAG(+)      = '0'
                AND CSPV.GLBL_CMPY_CD         = CAMV.GLBL_CMPY_CD(+)
                AND CSPV.MDSE_CD              = CAMV.MDSE_CD(+)
                AND CSTCV.EZCANCELFLAG        = '0'
                AND CCV.GLBL_CMPY_CD          = CSTCV.GLBL_CMPY_CD
                AND CCV.SELL_TO_CUST_CD       = CSTCV.SELL_TO_CUST_CD
                ORDER BY
                 CEPHV.SEND_ID
                ,CEPHV.RCV_ID
                ,CEPHV.CUST_EDI_PO_NUM
                ,CEPHV.CUST_EDI_PO_DT
                ,DECODE(CEPDV.EDI_PROC_STS_CD , #D_ediProcStsCd# , 1, 0)
                ,CEPDV.EDI_PO_LINE_NUM
                ,CSPV.TRX_HDR_NUM
                ,CSPV.TRX_LINE_NUM
                ,CSPV.TRX_LINE_SUB_NUM
                ,CSPV.SHPG_PLN_DPLY_LINE_NUM
                ,CSPV.SHPG_PLN_NUM
        )
        <!-- End QC#20737 Add  -->

    UNION

       SELECT
            *
        FROM
            (
           SELECT
                CEPHV.EZUPTIME                 AS H_EZUPTIME
               ,CEPHV.CUST_EDI_PO_NUM          AS H_CUST_EDI_PO_NUM
               ,CEPHV.EDI_PROC_STS_CD          AS H_EDI_PROC_STS_CD
               ,CEPDV.EZUPTIME                 AS D_EZUPTIME
               ,CEPDV.ORD_QTY                  AS ED_ORD_QTY
               ,CEPDV.CUSA_MDSE_CD             AS D_CUSA_MDSE_CD
               ,CEPDV.TRD_PTNR_SKU_CD          AS D_TRD_PTNR_SKU_CD
               ,CEPDV.UNIT_PRC_AMT             AS D_UNIT_PRC_AMT
               ,CEPDV.ORIG_TRD_PTNR_SKU_CD     AS D_ORIG_TRD_PTNR_SKU_CD
               ,CEPDV.ORIG_ORD_QTY             AS D_ORIG_ORD_QTY
               ,CEPDV.ORIG_CUSA_MDSE_CD        AS D_ORIG_CUSA_MDSE_CD
               ,CEPDV.CUST_EDI_PO_NUM          AS D_CUST_EDI_PO_NUM
               ,CEPDV.EDI_PO_LINE_NUM          AS D_EDI_PO_LINE_NUM
               ,CEPDV.EDI_PROC_STS_CD          AS D_EDI_PROC_STS_CD
               ,CEPHV.SEND_ID                  AS H_SEND_ID
               ,CEPHV.RCV_ID                   AS H_RCV_ID
               ,CEPHV.CUST_EDI_PO_DT           AS H_CUST_EDI_PO_DT
               ,CEPDSV.EZUPTIME                AS S_EZUPTIME
               ,CEPDSV.ORD_QTY                 AS S_ORD_QTY
               ,null                           AS H_CPO_ORD_NUM
               ,null                           AS H_ORD_HDR_STS_CD
               ,null                           AS H_CPO_HLD_FLG
               ,null                           AS H_SELL_TO_CUST_CD
               <!-- START 2021/05/12 J.Evangelista [QC#58718,MOD] -->
               <!-- ,null                           AS HC_EZUPTIME -->
               <!-- ,null                           AS H_CUST_ISS_PO_NUM -->
               ,CEPHV.CUST_EDI_PO_NUM          AS H_CUST_ISS_PO_NUM
               ,null                           AS HC_EZUPTIME
               <!--   END 2021/05/12 J.Evangelista [QC#58718,MOD] -->
               ,null                           AS H_CPO_ORD_TS
               ,null                           AS D_ORD_QTY
               ,null                           AS D_CPO_DTL_LINE_NUM
               ,null                           AS D_CPO_DTL_LINE_SUB_NUM
               ,null                           AS D_CCY_CD
               ,null                           AS D_UOM_CD
               ,null                           AS D_ENT_DEAL_NET_UNIT_PRC_AMT
               ,null                           AS D_EDI_NUM
               ,null                           AS D_EDI_SUB_NUM
               ,null                           AS D_SHIP_TO_CUST_CD
               ,null                           AS D_SHIP_TO_LOC_NM
               <!-- START 2021/05/12 J.Evangelista [QC#58718,MOD] -->
               <!-- ,null                           AS D_CUST_MDSE_CD -->
               <!-- ,null                           AS D_ORD_LINE_STS_CD -->
               ,null                           AS D_ORD_LINE_STS_CD
               ,null                           AS D_CUST_MDSE_CD
               <!--   END 2021/05/12 J.Evangelista [QC#58718,MOD] -->
               ,null                           AS SP_MDSE_CD
               ,null                           AS SP_SHPG_PLN_DPLY_LINE_NUM
               ,null                           AS SP_SHPG_PLN_NUM
               ,null                           AS SP_SHPG_STS_CD
               ,null                           AS SP_PSD_DT
               ,null                           AS SP_PDD_DT
               ,null                           AS SP_ACTL_SHIP_DT
               ,null                           AS SP_ACTL_ARV_DT
               ,null                           AS SP_ORD_QTY
               ,null                           AS SP_CR_HLD_QTY
               ,null                           AS SP_SLS_HLD_QTY
               ,null                           AS SP_EZUPTIME
               ,null                           AS SP_PO_ORD_NUM
               ,null                           AS SP_INVTY_LOC_CD
               ,null                           AS SP_SET_MDSE_CD
               ,null                           AS SP_SET_SHPG_PLN_NUM
               ,null                           AS SP_PO_REQ_FLG
               ,null                           AS SP_TRX_HDR_NUM
               ,null                           AS SP_TRX_LINE_NUM
               ,null                           AS SP_TRX_LINE_SUB_NUM
               ,null                           AS SP_CUST_UOM_CD
               ,null                           AS SP_CARR_CD
               ,null                           AS SP_CARR_NM
               ,null                           AS SP_PRO_NUM
               ,null                           AS SP_SO_NUM
               ,null                           AS SP_SO_SLP_NUM
               <!-- START 2021/05/12 J.Evangelista [QC#58718,MOD] -->
               <!-- ,null                           AS CS_LOC_NUM -->
               <!-- ,CAMV.MDSE_NM                   AS M_MDSE_NM -->
               ,CAMV.MDSE_NM                   AS M_MDSE_NM
               ,null                           AS CS_LOC_NUM
               <!--   END 2021/05/12 J.Evangelista [QC#58718,MOD] -->
               ,null                           AS ETA_DT
               ,DECODE(CEPDV.EDI_PROC_STS_CD , #D_ediProcStsCd# , 1, 0) AS PROC_STS
               <!-- Start QC#20737 Add  -->
               ,CAMV.MDSE_TP_CD                AS MDSE_TP_CD
               ,CAMV.INVTY_CTRL_FLG            AS INVTY_CTRL_FLG
               ,CAMV.AUTO_LIC_ALLOC_FLG        AS AUTO_LIC_ALLOC_FLG
               <!-- End QC#20737 Add  -->
             FROM
                CSA_EDI_TRD_PTNR_V   CETPV
               ,CSA_EDI_PO_HDR_V     CEPHV
               ,CSA_EDI_PO_DTL_V     CEPDV
               ,CSA_EDI_PO_DTL_SDQ_V CEPDSV
               ,CSA_ALL_MDSE_V       CAMV
            WHERE 1=1
            AND CETPV.EZCANCELFLAG      = '0'
            AND CETPV.GLBL_CMPY_CD      = #glblCmpyCd#
            AND CETPV.EDI_TRD_PTNR_CD IN (
        <iterate property="ediTrdPtnrCdList" var="ediTrdPtnrCd[]" open="" close="" conjunction=",">
            #ediTrdPtnrCd[]#
        </iterate>
            )
            AND CEPHV.EZCANCELFLAG       = '0'
            AND CETPV.GLBL_CMPY_CD       = CEPHV.GLBL_CMPY_CD
            AND CETPV.SEND_ID            = CEPHV.SEND_ID
            AND CETPV.RCV_ID             = CEPHV.RCV_ID
            AND CETPV.EDI_TRD_PTNR_CD    = CEPHV.EDI_TRD_PTNR_CD
            AND CEPHV.EDI_TRX_PRPS_CD    = #ediTrxPrpsCd#
            
<!-- QC#24404 -->            
<!-- AND CEPHV.CPO_SRC_TP_CD      = #cpoSrcTpCd#-->
            AND CEPHV.CPO_SRC_TP_CD IN
        <iterate property="cpoSrcTpCdList" var="cpoSrcTpCd[]" open="(" conjunction= ", " close=")">
            #cpoSrcTpCd[]#
        </iterate>
            AND NVL(CEPHV.CPO_ORD_TP_CD , #cpoOrdTpCd# ) = #cpoOrdTpCd#
            AND CEPHV.SDQ_PO_TP_FLG      = #sdqPoTpFlg#
            AND CEPHV.EDI_PROC_STS_CD    = #H_ediProcStsCd#
            AND CEPDV.EZCANCELFLAG       = '0'
            AND CEPHV.GLBL_CMPY_CD       = CEPDV.GLBL_CMPY_CD
            AND CEPHV.SEND_ID            = CEPDV.SEND_ID
            AND CEPHV.RCV_ID             = CEPDV.RCV_ID
            AND CEPHV.CUST_EDI_PO_NUM    = CEPDV.CUST_EDI_PO_NUM
            AND CEPHV.CUST_EDI_PO_DT     = CEPDV.CUST_EDI_PO_DT
            AND CEPHV.EDI_TRX_PRPS_CD    = CEPDV.EDI_TRX_PRPS_CD
            AND CEPDV.EDI_PROC_STS_CD    = #D_ediProcStsCd#
            AND CEPDSV.EZCANCELFLAG      = '0'
            AND CEPDV.GLBL_CMPY_CD       = CEPDSV.GLBL_CMPY_CD
            AND CEPDV.SEND_ID            = CEPDSV.SEND_ID
            AND CEPDV.RCV_ID             = CEPDSV.RCV_ID
            AND CEPDV.CUST_EDI_PO_NUM    = CEPDSV.CUST_EDI_PO_NUM
            AND CEPDV.CUST_EDI_PO_DT     = CEPDSV.CUST_EDI_PO_DT
            AND CEPDV.EDI_TRX_PRPS_CD    = CEPDSV.EDI_TRX_PRPS_CD
            AND CEPDV.EDI_PO_LINE_NUM    = CEPDSV.EDI_PO_LINE_NUM
            AND(
                    ( CEPDV.EDI_PROC_STS_CD   = #ediProcStsCd_C# AND CEPDV.EZUPTIME  &gt;= #ezupTime# )
                OR  ( CEPDV.EDI_PROC_STS_CD  != #ediProcStsCd_C# AND CEPDSV.EZUPTIME &gt;= #ezupTime# )
            )
            AND CAMV.EZCANCELFLAG(+)     = '0'
            AND CEPDV.GLBL_CMPY_CD       = CAMV.GLBL_CMPY_CD(+)
            AND CEPDV.CUSA_MDSE_CD       = CAMV.MDSE_CD(+)
            ORDER BY
                 CEPHV.SEND_ID
                ,CEPHV.RCV_ID
                ,CEPHV.CUST_EDI_PO_NUM
                ,CEPHV.CUST_EDI_PO_DT
                ,DECODE(CEPDV.EDI_PROC_STS_CD , #D_ediProcStsCd# , 1, 0)
                ,CEPDV.EDI_PO_LINE_NUM
           )
    </statement>

    <statement id="getPartsInfo" parameterClass="Map" resultClass="Map">
        SELECT
            CPOSO.P_CODE_CUST_SHIP_TO
           ,CPOSO.P_NUM_CUST_PO
           ,CPOSO.P_EZUPTIME
           ,CPOSO.P_DATE_ORDR_RCV
<!-- START 2019/08/28 T.Ogura [QC#52892,MOD] -->
<!--       ,CPOSO.P_PARTS_NUM -->
           ,TRIM(CPOSO.P_PARTS_NUM) AS P_PARTS_NUM
<!-- END   2019/08/28 T.Ogura [QC#52892,MOD] -->
           ,CPOSO.P_PARTS_NUM_ORIG
           ,CPOSO.P_NUM_ORDR
           ,CPOSO.CP_EZUPTIME
           ,CPOSO.P_CODE_WH
           ,CPOSO.P_QTY_ORDR_ACPT
           ,CPOSO.P_FLAG_CANCEL_BO
           ,CPOSO.P_DESC_PART
           ,CPOSO.P_CUST_PART_NUM
           ,CPOSO.P_QTY_ACPT_ORDR
           ,CPOSO.P_PRC_UNIT
           ,CPOSO.P_NUM_LINE
           ,CPOSO.P_QTY_PCSE_ORDR
           ,CPOSO.P_EDI_PARTS_NUM
           ,CPOSO.P_ORIG_TRD_PTNR_SKU_CD
           ,CPOSO.P_CODE_SHIP_VIA
           ,CPOSO.P_NUM_TRUCKER
           ,CPOSO.P_NUM_SO
           ,CPOSO.P_DATE_SHIP_PRSS
           ,CPOSO.P_DATE_SO_ISSUE
           ,CPOSO.P_CODE_STAT_SO
           ,CPOSO.P_CODE_CUST_SHIP_TO
           ,CPOSO.P_CODE_CUST_SOLD_TO
           ,CPOSO.P_CODE_STAT_OE
           ,CPOSO.P_CODE_TABLE_DESCRIPTION
           ,CPOSO.PH_NAME_CUST_01
           ,CPOSO.PE_NAME_CUST_01
           ,CPOSO.P_DATE_STOCK_IN_EST
           <!-- START 2022/11/08 A.Cullano [QC#60776, ADD] -->
           ,CPOSO.POYO_EZUPTIME
           <!-- END 2022/11/08 A.Cullano [QC#60776, ADD] -->
        FROM (
            SELECT
                CPCCV.P_CODE_CUST_SHIP_TO      AS P_CODE_CUST_SHIP_TO
               ,CPCCV.P_NUM_CUST_PO            AS P_NUM_CUST_PO
               ,CPCCV.EZUPTIME                 AS P_EZUPTIME
               ,CPCCV.P_DATE_ORDR_RCV          AS P_DATE_ORDR_RCV
               ,CPCDV.P_PARTS_NUM              AS P_PARTS_NUM
               ,CPCDV.P_PARTS_NUM_ORIG         AS P_PARTS_NUM_ORIG
               ,CPCDV.P_NUM_ORDR               AS P_NUM_ORDR
          --   ,CPCDV.EZUPTIME                 AS CP_EZUPTIME
               ,CASE WHEN CPSHV.EZUPTIME  IS NULL AND POYO.EZUPTIME &gt; CPCV.EZUPTIME THEN POYO.EZUPTIME
                     WHEN CPSHV.EZUPTIME  IS NULL         THEN CPCV.EZUPTIME
                     WHEN CPSHV.EZUPTIME  &gt; CPCV.EZUPTIME THEN CPSHV.EZUPTIME
                     ELSE CPCV.EZUPTIME
                END  AS CP_EZUPTIME
               ,CPCDV.P_CODE_WH                AS P_CODE_WH
               ,CPCDV.P_QTY_ORDR_ACPT          AS P_QTY_ORDR_ACPT
               ,CPCDV.P_FLAG_CANCEL_BO         AS P_FLAG_CANCEL_BO
               ,CPV.P_DESC_PART                AS P_DESC_PART
               ,CPCCDV.P_CUST_PART_NUM         AS P_CUST_PART_NUM
               ,NVL(CPSDV.P_QTY_SHIP_SCHED , CPCDV.P_QTY_ORDR_ACPT) AS P_QTY_ACPT_ORDR
               ,CPCCDV.P_PRC_UNIT              AS P_PRC_UNIT
               ,CPCCDV.P_NUM_LINE              AS P_NUM_LINE
               ,CPCCDV.P_QTY_PCSE_ORDR         AS P_QTY_PCSE_ORDR
               ,CPCCDV.P_EDI_PARTS_NUM         AS P_EDI_PARTS_NUM
               ,NVL(CPCCDV.P_EDI_PARTS_NUM, CPCCDV.P_PARTS_NUM)  AS  P_ORIG_TRD_PTNR_SKU_CD
               ,CPSHV.P_CODE_SHIP_VIA          AS P_CODE_SHIP_VIA
               ,CPSHV.P_NUM_TRUCKER            AS P_NUM_TRUCKER
               ,CPSHV.P_NUM_SO                 AS P_NUM_SO
               ,CPSHV.P_DATE_SHIP_PRSS         AS P_DATE_SHIP_PRSS
               ,CPSHV.P_DATE_SO_ISSUE          AS P_DATE_SO_ISSUE
               ,CPSHV.P_CODE_STAT_SO           AS P_CODE_STAT_SO
               --,CPCV.P_CODE_CUST_SHIP_TO       AS P_CODE_CUST_SHIP_TO
               ,CPCV.P_CODE_CUST_SOLD_TO       AS P_CODE_CUST_SOLD_TO
               ,CPCV.P_CODE_STAT_OE            AS P_CODE_STAT_OE
               ,CPSVV.P_CODE_TABLE_DESCRIPTION AS P_CODE_TABLE_DESCRIPTION
               ,CPCVSHIP.P_NAME_CUST_01        AS PH_NAME_CUST_01
               ,CPCVSELL.P_NAME_CUST_01        AS PE_NAME_CUST_01
               ,CPCV.EZUPTIME                  AS CPCV_EZUPTIME
               ,CPSHV.EZUPTIME                 AS CPSHV_EZUPTIME
               ,POYO.EZUPTIME                  AS POYO_EZUPTIME
               ,TO_CHAR(TO_DATE(POYO.P_DATE_STOCK_IN_EST, 'YYYYMMDD') + #days#, 'YYYYMMDD') AS P_DATE_STOCK_IN_EST
            FROM
                CSA_PRT_CUST_CPO_V       CPCCV
               ,CSA_PRT_CUST_CPO_DTL_V   CPCCDV
               ,CSA_PRT_CPO_V            CPCV
               ,CSA_PRT_CPO_DTL_V        CPCDV
               ,CSA_PRT_SO_DTL_V         CPSDV
               ,CSA_PRT_SO_HDR_V         CPSHV
               ,CSA_PRT_V                CPV
               ,CSA_PRT_CUST_V           CPCVSHIP
               ,CSA_PRT_CUST_V           CPCVSELL
               ,CSA_PRT_SHIP_VIA_V       CPSVV
               ,(SELECT
                  POYO.P_DATE_STOCK_IN_EST
                 ,POYO.EZUPTIME
                 ,XREF.P_NUM_CUST_PO
                 ,XREF.P_NUM_PO_PARTS
                 ,POYO.P_PARTS_NUM
                 FROM
                  CSA_PRT_VND_XREF_V       XREF
                 ,CSA_PRT_POYO_V           POYO
                 WHERE 
                     XREF.P_NUM_PO_PARTS = POYO.P_NUM_PO_PARTS
                 AND XREF.EZCANCELFLAG     = '0'
                 AND POYO.EZCANCELFLAG     = '0'
                ) POYO
            WHERE 1=1
            AND CPCCV.EZCANCELFLAG           = '0'
            AND CPCCV.P_CODE_ORDR_TYPE_PART NOT IN (
            <iterate property="pCodeOrdrTypePartList" var="pCodeOrdrTypePart[]" open="" close="" conjunction=",">
                #pCodeOrdrTypePart[]#
            </iterate>
            )
            AND CPCCDV.EZCANCELFLAG          = '0'
            AND CPCCV.P_CODE_CUST_SHIP_TO    = CPCCDV.P_CODE_CUST_SHIP_TO
            AND CPCCV.P_NUM_CUST_PO          = CPCCDV.P_NUM_CUST_PO
            AND CPCV.EZCANCELFLAG            = '0'
            AND CPCV.P_CODE_CUST_SHIP_TO     = CPCCDV.P_CODE_CUST_SHIP_TO
            AND CPCV.P_NUM_CUST_PO           = CPCCDV.P_NUM_CUST_PO
              <iterate property="pCodeCustSoldToList" var="pCodeCustSoldTo[]" open="AND CPCV.P_CODE_CUST_SOLD_TO IN (" close=")" conjunction=",">
                  #pCodeCustSoldTo[]#
              </iterate>
            AND CPCDV.EZCANCELFLAG           = '0'
            AND CPCDV.P_NUM_ORDR             = CPCV.P_NUM_ORDR
            AND CPCDV.P_PARTS_NUM_ORIG       = CPCCDV.P_PARTS_NUM
            AND CPSDV.EZCANCELFLAG(+)        = '0'
            AND CPCDV.P_PARTS_NUM            = CPSDV.P_PARTS_NUM(+)
            AND CPCDV.P_NUM_ORDR             = CPSDV.P_NUM_ORDR(+)
            AND CPSDV.P_QTY_SHIP_SCHED(+)    != #pQtyShipSched#
            AND CPSHV.EZCANCELFLAG(+)        = '0'
            AND CPSDV.P_NUM_SO               = CPSHV.P_NUM_SO(+)
            AND CPV.EZCANCELFLAG(+)          = '0'
            AND CPCDV.P_PARTS_NUM            = CPV.P_PARTS_NUM(+)
            AND CPCVSHIP.EZCANCELFLAG(+)     = '0'
            AND CPCCV.P_CODE_CUST_SHIP_TO    = CPCVSHIP.P_CODE_CUST(+)
            AND CPCVSELL.EZCANCELFLAG(+)     = '0'
            AND CPCVSHIP.P_CODE_CUST_SOLD_TO = CPCVSELL.P_CODE_CUST(+)
            AND CPSVV.EZCANCELFLAG(+)        = '0'
            AND CPSHV.P_CODE_SHIP_VIA        = CPSVV.P_CODE_SHIP_VIA(+)
            AND CPCCDV.P_NUM_CUST_PO          = POYO.P_NUM_CUST_PO(+)
            AND CPCCDV.P_PARTS_NUM            = POYO.P_PARTS_NUM(+)
            AND (
                   (CPCV.P_CODE_STAT_OE  = #pCodeStatOe1# AND CPCDV.P_QTY_SHIP_SCHED &gt; #pQtyShipSched# )
                OR (CPCV.P_CODE_STAT_OE  = #pCodeStatOe1# AND CPCDV.P_QTY_ORDR_ACPT     = #pQtyOrdrAcpt# )
                OR (CPCV.P_CODE_STAT_OE  = #pCodeStatOe4# AND CPCDV.P_CODE_IND_HOLD     = #pCodeIndHold# )
                OR (CPCV.P_CODE_STAT_OE  = #pCodeStatOe8# AND CPCDV.P_FLAG_CANCEL_BO    IS NULL )
                OR (CPCV.P_CODE_STAT_OE != #pCodeStatOe8# AND CPCDV.P_FLAG_CANCEL_BO    = #pFlagCancelBo# )
                OR (CPCV.P_CODE_STAT_OE IN (
                    <iterate property="pCodeStatOeList" var="pCodeStatOe[]" open="" close="" conjunction=",">
                        #pCodeStatOe[]#
                    </iterate>
                                           )
                    )
                 )
            AND
            NOT EXISTS 
                (
                  SELECT
                    'X'
                  FROM
                    CSA_PRT_ACK_CANC_WRK_V CPACWV
                  WHERE 1=1
                  AND CPACWV.P_FILE_ID    = #pFileId#
                  AND CPACWV.P_NUM_ORDR   = CPCV.P_NUM_ORDR
                  AND CPACWV.P_PARTS_NUM  = CPCDV.P_PARTS_NUM
                  AND (
                          (CPCV.P_CODE_STAT_OE    = #pCodeStatOe9#)
                       OR (CPCDV.P_FLAG_CANCEL_BO = #pFlagCancelBo#)
                       OR (CPCDV.P_QTY_ORDR_ACPT  = #pQtyOrdrAcpt#)
                      )
                 )
            ) CPOSO
        WHERE (
            CPOSO.CPCV_EZUPTIME              &gt;= #ezupTime#
        OR  CPOSO.CPSHV_EZUPTIME             &gt;= #ezupTime#
        OR  CPOSO.POYO_EZUPTIME              &gt;= #ezupTime#
            )
        ORDER BY
             CPOSO.P_CODE_CUST_SHIP_TO
            ,CPOSO.P_NUM_CUST_PO
            ,CPOSO.P_NUM_LINE
            ,CPOSO.P_PARTS_NUM
            ,CPOSO.P_NUM_ORDR
           <!-- START 2022/11/08 A.Cullano [QC#60776, ADD] -->
            ,CPOSO.P_DATE_STOCK_IN_EST
           <!-- START 2022/11/08 A.Cullano [QC#60776, ADD] -->
    </statement>


    <statement id="getNextPoAckNum" parameterClass="Map" resultClass="String">
    SELECT
         NVL (MAX(PO_ACK_NUM + 0 ) + 1 , 1 ) NEXT_PO_ACK_NUM
    FROM
        (
            SELECT
                MAX(PO_ACK_NUM + 0 ) AS PO_ACK_NUM
            FROM
                PO_ACK_HDR_WRK
            WHERE 1=1
            AND EZCANCELFLAG   = '0'
            AND GLBL_CMPY_CD   = #glblCmpyCd#
            AND EDI_PO_ORD_NUM = #ediPoOrdNum#
        UNION
            SELECT
                MAX(PO_ACK_NUM + 0 ) AS PO_ACK_NUM
            FROM
                PO_ACK_HDR
            WHERE 1=1
            AND EZCANCELFLAG   = '0'
            AND GLBL_CMPY_CD   = #glblCmpyCd#
            AND PO_ORD_NUM = #ediPoOrdNum#
        )
    </statement>

    <statement id="getLatestPoAckList" parameterClass="Map" resultClass="Map">
    SELECT
        *
    FROM (
            SELECT
                PD.PO_ACK_LINE_STS_CD
               ,PD.VND_PO_ACK_STS_CD
               ,PD.VND_CPO_ORD_NUM
               ,PD.VND_CPO_DTL_LINE_NUM
               ,PD.VND_CPO_DTL_LINE_SUB_NUM
               ,PD.SHPG_PLN_NUM
               ,PD.ETA_DT
            FROM
                PO_ACK_HDR_WRK PH
               ,PO_ACK_DTL_WRK PD
            WHERE 1=1
            AND PH.EZCANCELFLAG            = '0'
            AND PH.GLBL_CMPY_CD            = #glblCmpyCd#
            AND PH.EDI_PO_ORD_NUM          = #ediPoOrdNum#
            AND PD.EZCANCELFLAG            = '0'
            AND PH.GLBL_CMPY_CD            = PD.GLBL_CMPY_CD
            AND PH.PO_ACK_HDR_WRK_PK       = PD.PO_ACK_HDR_WRK_PK
            AND PD.EDI_PO_ORD_DTL_LINE_NUM = #ediPoOrdDtlLineNum#
            AND PD.SHPG_PLN_DPLY_LINE_NUM  = #shpgPlnDplyLineNum#
            ORDER BY
                TO_NUMBER(PH.PO_ACK_NUM) DESC
            )
    WHERE ROWNUM = 1
    </statement>

    <statement id="itemChangeCheck" parameterClass="Map" resultClass="String">
    SELECT
        ASL_MDSE_CD
    FROM
        PO_DTL DPD
    WHERE 1=1
    AND DPD.GLBL_CMPY_CD        = #glblCmpyCd#
    AND DPD.PO_ORD_NUM          = #poOrdNum#
    <isNotNull property="poOrdDtlLineNum">
    AND DPD.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
    </isNotNull>
    <isNull property="poOrdDtlLineNum">
    AND DPD.PO_ORD_DTL_LINE_NUM is NULL
    </isNull>
    AND ROWNUM                  = 1
    </statement>

    <statement id="itemChangeCheckOrdTakeMdse" parameterClass="Map" resultClass="String">
    SELECT
        OTM.MDSE_CD
    FROM
        ORD_TAKE_MDSE OTM
    WHERE 1=1
    AND OTM.GLBL_CMPY_CD        = #glblCmpyCd#
    AND OTM.ORD_TAKE_MDSE_CD    = #ordTakeMdseCd#
    AND OTM.EZCANCELFLAG        = '0'
    AND ROWNUM                  = 1
    </statement>

    <statement id="checkLakAssingn" parameterClass="Map" resultClass="String">
    SELECT
         COUNT(*) AS LAK_QTY
    FROM
         CSA_CPO_V       CPO
        ,CSA_LAK_RPST_V  LAK
    WHERE 1 = 1
    AND CPO.GLBL_CMPY_CD          = #cusaGlblCmpyCd#
    AND CPO.CPO_ORD_NUM           = #cpoOrdNum#
    AND CPO.EZCANCELFLAG          = '0'
    <iterate property="cpoOrdTpCdList" var="cpoOrdTpCdList[]"   open="AND CPO.CPO_ORD_TP_CD NOT IN (" close=")" conjunction=",">
          #cpoOrdTpCdList[]#
    </iterate>
    AND CPO.GLBL_CMPY_CD          = LAK.GLBL_CMPY_CD
    AND CPO.CPO_ORD_NUM           = LAK.CPO_ORD_NUM
    AND LAK.CPO_DTL_LINE_NUM      = #cpoDtlLineNum#
    AND LAK.CPO_DTL_LINE_SUB_NUM  = #cpoDtlLineSubNum#
    AND LAK.MDSE_CD               = #mdseCd#
    AND LAK.LAK_STS_CD            = #lakStsCd#
    AND LAK.EZCANCELFLAG          = '0'
    </statement>

    <statement id="checkPartsItemFlip" parameterClass="Map" resultClass="String">
    SELECT
         ASL_MDSE_CD
    FROM
         PO       PO
        ,PO_DTL   PD
    WHERE 1 = 1
    AND PO.GLBL_CMPY_CD         = #glblCmpyCd#
    AND PO.PO_ORD_NUM           = #poOrdNum#
    AND PO.EZCANCELFLAG         = '0'
    AND PO.PO_ORD_NUM           = PD.PO_ORD_NUM
    <isNotNull property="poOrdDtlLineNum">
    AND PD.PO_ORD_DTL_LINE_NUM  = #poOrdDtlLineNum#
    </isNotNull>
    AND PD.EZCANCELFLAG         = '0'
    AND PO.GLBL_CMPY_CD         = PD.GLBL_CMPY_CD
    </statement>

    <statement id="checkItemChangeData" parameterClass="Map" resultClass="BigDecimal">
    SELECT
         COUNT(PADW.GLBL_CMPY_CD)
    FROM
         PO_ACK_DTL_WRK PADW
    WHERE 1 = 1
    AND PADW.GLBL_CMPY_CD            = #glblCmpyCd#
    AND PADW.EDI_PO_ORD_NUM          = #ediPoOrdNum#
    <isNotNull property="ediPoOrdDtlLineNum">
    AND PADW.EDI_PO_ORD_DTL_LINE_NUM = #ediPoOrdDtlLineNum#
    </isNotNull>
    <isNull property="ediPoOrdDtlLineNum">
    AND PADW.EDI_PO_ORD_DTL_LINE_NUM IS NULL
    </isNull>
    AND PADW.VND_PO_ACK_STS_CD       = #ItemChange#
    AND PADW.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getBillToSellTo" parameterClass="Map" resultClass="Map">
        SELECT
            CSEV.BILL_TO_CUST_CD
           ,CSEV.SELL_TO_CUST_CD
        FROM
            CSA_TRD_PTNR_LOC_X_REF_V CXV
           ,CSA_SHIP_TO_CUST_V       CSHV
           ,CSA_SELL_TO_CUST_V       CSEV
        WHERE 1=1
        AND CXV.GLBL_CMPY_CD            = #cusaGlblCmpyCd#
            <iterate property="ediTrdPtnrCdList" var="ediTrdPtnrCd[]" open="AND CXV.EDI_TRD_PTNR_CD IN ( " close=")" conjunction=",">
                #ediTrdPtnrCd[]#
            </iterate>
        AND CXV.EDI_CUST_TP_CD          = #ediCustTpCd#
        AND CXV.EZCANCELFLAG            = '0'
        AND CXV.GLBL_CMPY_CD            = CSHV.GLBL_CMPY_CD
        AND CXV.SELL_TO_SHIP_TO_CUST_CD = CSHV.SHIP_TO_CUST_CD
        AND CSHV.EZCANCELFLAG           = '0'
        AND CSHV.GLBL_CMPY_CD           = CSEV.GLBL_CMPY_CD
        AND CSHV.SELL_TO_CUST_CD        = CSEV.SELL_TO_CUST_CD
        AND CSEV.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getSellToCustCd" parameterClass="Map" resultClass="Map">
        SELECT
           DISTINCT P_CODE_CUST_SOLD_TO
        FROM
            CSA_PRT_EDI_TRD_PTNR_V
        WHERE 1=1
        <iterate property="trdPtnrCdList" var="trdPtnrCd[]" open="AND P_CODE_TP IN (" close=")" conjunction=",">
            #trdPtnrCd[]#
        </iterate>
        AND EZCANCELFLAG             = '0'
    </statement>

    <!-- START 2022/11/08 A.Cullano [QC#60776, ADD] -->
    <statement id="isAvailPoAckDtlWrk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS INSTANCE
        FROM
            PO_ACK_DTL_WRK PODTLWRK
        WHERE 1 = 1
            AND PODTLWRK.GLBL_CMPY_CD    = #glblCmpyCd#
            AND PODTLWRK.EZCANCELFLAG    = '0'
            AND PODTLWRK.PO_ORD_NUM      = #poOrdNum#
            AND PODTLWRK.MDSE_CD         = #mdseCd#
            AND PODTLWRK.INBD_VIS_UPD_TS = #poyoDt#
    </statement>
    <!-- END 2022/11/08 A.Cullano [QC#60776, ADD] -->

</sqlMap>
