<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAL0830Query">
    <typeAlias alias="NSAL0830_ASMsg" type="business.blap.NSAL0830.NSAL0830_ASMsg"/>

    <statement id="getMainData" parameterClass="Map" resultMap="result.getMainData">

           SELECT
                 NULL AS XX_CHK_BOX
                ,DS_CONTR_INTFC_BAT_NUM
                ,DS_CONTR_SRC_REF_NUM
                ,CONTR_INTFC_SRC_TP_CD
                ,DS_CONTR_NUM
                ,DS_CONTR_INTFC_ACT_CD
                ,DS_CONTR_INTFC_ACT_DESC_TXT
                ,SER_NUM
                ,SVC_MACH_MSTR_PK
                ,MDSE_CD
                ,BLLG_MTR_LB_CD
                ,MTR_LB_DESC_TXT
                ,BLLG_MTR_LVL_NUM
                ,XS_MTR_COPY_QTY
                ,XS_MTR_AMT_RATE
                ,DS_CONTR_INTFC_STS_CD
                ,INTFC_ERR_MSG_TXT
                ,DS_CONTR_PROC_STS_DESC_TXT
                ,DS_CONTR_PROC_STS_CD
                ,DS_CONTR_INTFC_PK
                ,DS_XS_COPY_INTFC_PK
                ,NULL AS CPO_SVC_DTL_PK
                ,NULL AS XX_ROW_NUM
                ,NULL AS XX_MSG_ID
                ,XX_TP_CD
                ,EZUPTIME
                ,EZUPTIMEZONE
                ,CASE WHEN 1 =(ROW_NUMBER() OVER (PARTITION BY DS_CONTR_SRC_REF_NUM,CONTR_INTFC_SRC_TP_CD,DS_CONTR_INTFC_BAT_NUM,DS_CONTR_INTFC_BAT_NUM,SVC_MACH_MSTR_PK,BLLG_MTR_LB_CD ORDER BY XX_TP_CD DESC,XS_MTR_COPY_QTY)) 
                      THEN 'Y'
                      ELSE 'N'
                 END AS XX_DPLY_CTRL_FLG
                <!-- START 2016/11/28 K.Kojima [QC#14204, ADD] -->
                ,XX_REC_HIST_CRAT_TS_A
                ,XX_REC_HIST_CRAT_BY_NM_A
                ,XX_REC_HIST_UPD_TS_A
                ,XX_REC_HIST_UPD_BY_NM_A
                ,XX_REC_HIST_TBL_NM_A
                <!-- END 2016/11/28 K.Kojima [QC#14204, ADD] -->
            FROM
            (
               SELECT
                     CON.DS_CONTR_INTFC_BAT_NUM
                    ,CON.DS_CONTR_SRC_REF_NUM
                    ,CON.CONTR_INTFC_SRC_TP_CD
                    ,CON.DS_CONTR_NUM
                    ,CON.DS_CONTR_INTFC_ACT_CD
                    ,ACT.DS_CONTR_INTFC_ACT_DESC_TXT
                    ,CON.SER_NUM
                    ,CON.SVC_MACH_MSTR_PK
                    ,CON.MDSE_CD
                    ,CON.BLLG_MTR_LB_CD
                    ,ML.MTR_LB_DESC_TXT
                    ,ML.BLLG_MTR_LVL_NUM
                    ,CON.XS_MTR_COPY_QTY
                    ,CON.XS_MTR_AMT_RATE
                    ,NULL AS DS_CONTR_INTFC_STS_CD
                    ,NULL AS INTFC_ERR_MSG_TXT
                    ,PSTS.DS_CONTR_PROC_STS_DESC_TXT
                    ,CON.DS_CONTR_PROC_STS_CD
                    ,CON.DS_CONTR_INTFC_PK
                    ,NULL AS DS_XS_COPY_INTFC_PK
                    ,NULL AS CPO_SVC_DTL_PK
                    ,#xxTpCdH# AS XX_TP_CD
                    ,CON.EZUPTIME
                    ,CON.EZUPTIMEZONE
                    <!-- START 2016/11/28 K.Kojima [QC#14204, ADD] -->
                    ,CON.EZINTIME     AS XX_REC_HIST_CRAT_TS_A
                    ,CON.EZINUSERID   AS XX_REC_HIST_CRAT_BY_NM_A
                    ,CON.EZUPTIME     AS XX_REC_HIST_UPD_TS_A
                    ,CON.EZUPUSERID   AS XX_REC_HIST_UPD_BY_NM_A
                    ,CON.EZTABLEID    AS XX_REC_HIST_TBL_NM_A
                    <!-- END 2016/11/28 K.Kojima [QC#14204, ADD] -->
                FROM
                     DS_CONTR_INTFC CON
                    ,DS_CONTR_INTFC_ACT ACT
                    ,DS_CONTR_PROC_STS PSTS
                    ,MTR_LB ML
                WHERE
                    CON.GLBL_CMPY_CD            = #glblCmpyCd#
                <isNotNull property="dsContrIntfcPkList">
                    <iterate property="dsContrIntfcPkList" var="dsContrIntfcPkList[]" open=" AND CON.DS_CONTR_INTFC_PK IN (" close=")" conjunction=",">
                        #dsContrIntfcPkList[]#
                    </iterate>
                </isNotNull>
                <isNotNull property="dsContrNum">
                AND CON.DS_CONTR_NUM            = #dsContrNum#
                </isNotNull>
                <isNotNull property="dsContrIntfcBatNum">
                AND CON.DS_CONTR_INTFC_BAT_NUM  = #dsContrIntfcBatNum#
                </isNotNull>
                <isNotNull property="dsContrSrcRefNum">
                AND CON.DS_CONTR_SRC_REF_NUM    = #dsContrSrcRefNum#
                </isNotNull>
                <isNotNull property="contrIntfcSrcTpCd">
                AND CON.CONTR_INTFC_SRC_TP_CD   = #contrIntfcSrcTpCd#
                </isNotNull>
                <isNotNull property="xxErrFlgList">
                    <iterate property="xxErrFlgList" var="xxErrFlgList[]" open=" AND CON.DS_CONTR_PROC_STS_CD IN (" close=")" conjunction=",">
                        #xxErrFlgList[]#
                    </iterate>
                </isNotNull>
                AND CON.CONTR_INTFC_DTL_TP_CD   = #contrIntfcDtlTpCd#
                AND CON.EZCANCELFLAG            = '0'
                AND CON.GLBL_CMPY_CD            = ACT.GLBL_CMPY_CD(+)
                AND CON.DS_CONTR_INTFC_ACT_CD   = ACT.DS_CONTR_INTFC_ACT_CD(+)
                AND CON.EZCANCELFLAG            = ACT.EZCANCELFLAG(+)
                AND CON.GLBL_CMPY_CD            = PSTS.GLBL_CMPY_CD(+)
                AND CON.DS_CONTR_PROC_STS_CD    = PSTS.DS_CONTR_PROC_STS_CD(+)
                AND CON.EZCANCELFLAG            = PSTS.EZCANCELFLAG(+)
                AND CON.GLBL_CMPY_CD            = ML.GLBL_CMPY_CD(+)
                AND CON.BLLG_MTR_LB_CD          = ML.MTR_LB_CD(+)
                AND CON.EZCANCELFLAG            = ML.EZCANCELFLAG(+)
                AND (CON.XS_MTR_COPY_QTY    IS NOT NULL
                     OR CON.XS_MTR_AMT_RATE IS NOT NULL
                     OR NOT EXISTS(SELECT 1 FROM DS_XS_COPY_INTFC XPI
                                WHERE
                                XPI.GLBL_CMPY_CD                = CON.GLBL_CMPY_CD
                                AND XPI.DS_CONTR_INTFC_BAT_NUM  = CON.DS_CONTR_INTFC_BAT_NUM
                                AND XPI.DS_CONTR_SRC_REF_NUM    = CON.DS_CONTR_SRC_REF_NUM
                                AND XPI.CONTR_INTFC_SRC_TP_CD   = CON.CONTR_INTFC_SRC_TP_CD
                                AND NVL(XPI.SVC_MACH_MSTR_PK,0) = NVL(CON.SVC_MACH_MSTR_PK,0)
                                AND XPI.BLLG_MTR_LB_CD          = CON.BLLG_MTR_LB_CD
                                AND XPI.EZCANCELFLAG            = '0' )
                    )
            UNION ALL
               SELECT
                     XPI.DS_CONTR_INTFC_BAT_NUM
                    ,XPI.DS_CONTR_SRC_REF_NUM
                    ,XPI.CONTR_INTFC_SRC_TP_CD
                    ,CON.DS_CONTR_NUM
                    ,CON.DS_CONTR_INTFC_ACT_CD
                    ,ACT.DS_CONTR_INTFC_ACT_DESC_TXT
                    ,XPI.SER_NUM
                    ,XPI.SVC_MACH_MSTR_PK
                    ,XPI.MDSE_CD
                    ,XPI.BLLG_MTR_LB_CD
                    ,ML.MTR_LB_DESC_TXT
                    ,ML.BLLG_MTR_LVL_NUM
                    ,XPI.XS_MTR_COPY_QTY
                    ,XPI.XS_MTR_AMT_RATE
                    ,XPI.XS_COPY_INTFC_STS_CD AS DS_CONTR_INTFC_STS_CD
                    ,XPI.INTFC_ERR_MSG_TXT
                    ,PSTS.DS_CONTR_PROC_STS_DESC_TXT
                    ,CON.DS_CONTR_PROC_STS_CD
                    ,CON.DS_CONTR_INTFC_PK
                    ,XPI.DS_XS_COPY_INTFC_PK
                    ,NULL AS CPO_SVC_DTL_PK
                    ,#xxTpCdD# AS XX_TP_CD
                    ,XPI.EZUPTIME
                    ,XPI.EZUPTIMEZONE
                    <!-- START 2016/11/28 K.Kojima [QC#14204, ADD] -->
                    ,XPI.EZINTIME     AS XX_REC_HIST_CRAT_TS_A
                    ,XPI.EZINUSERID   AS XX_REC_HIST_CRAT_BY_NM_A
                    ,XPI.EZUPTIME     AS XX_REC_HIST_UPD_TS_A
                    ,XPI.EZUPUSERID   AS XX_REC_HIST_UPD_BY_NM_A
                    ,XPI.EZTABLEID    AS XX_REC_HIST_TBL_NM_A
                    <!-- END 2016/11/28 K.Kojima [QC#14204, ADD] -->
                FROM
                     DS_XS_COPY_INTFC XPI
                    ,DS_CONTR_INTFC CON
                    ,DS_CONTR_INTFC_ACT ACT
                    ,DS_CONTR_PROC_STS PSTS
                    ,MTR_LB ML
                WHERE
                    XPI.GLBL_CMPY_CD            = #glblCmpyCd#
                <isNotNull property="dsContrIntfcPkList">
                    <iterate property="dsContrIntfcPkList" var="dsContrIntfcPkList[]" open=" AND CON.DS_CONTR_INTFC_PK IN (" close=")" conjunction=",">
                        #dsContrIntfcPkList[]#
                    </iterate>
                </isNotNull>
                <isNotNull property="dsContrNum">
                AND CON.DS_CONTR_NUM            = #dsContrNum#
                </isNotNull>
                <isNotNull property="dsContrIntfcBatNum">
                AND XPI.DS_CONTR_INTFC_BAT_NUM  = #dsContrIntfcBatNum#
                </isNotNull>
                <isNotNull property="dsContrSrcRefNum">
                AND XPI.DS_CONTR_SRC_REF_NUM    = #dsContrSrcRefNum#
                </isNotNull>
                <isNotNull property="contrIntfcSrcTpCd">
                AND XPI.CONTR_INTFC_SRC_TP_CD   = #contrIntfcSrcTpCd#
                </isNotNull>
                <isNotNull property="xxErrFlgList">
                    <iterate property="xxErrFlgList" var="xxErrFlgList[]" open=" AND CON.DS_CONTR_PROC_STS_CD IN (" close=")" conjunction=",">
                        #xxErrFlgList[]#
                    </iterate>
                </isNotNull>
                AND XPI.EZCANCELFLAG            = '0'
                AND XPI.GLBL_CMPY_CD            = CON.GLBL_CMPY_CD
                AND XPI.DS_CONTR_INTFC_BAT_NUM  = CON.DS_CONTR_INTFC_BAT_NUM
                AND XPI.DS_CONTR_SRC_REF_NUM    = CON.DS_CONTR_SRC_REF_NUM
                AND XPI.CONTR_INTFC_SRC_TP_CD   = CON.CONTR_INTFC_SRC_TP_CD
                AND NVL(XPI.SVC_MACH_MSTR_PK,0) = NVL(CON.SVC_MACH_MSTR_PK,0)
                AND XPI.BLLG_MTR_LB_CD          = CON.BLLG_MTR_LB_CD
                AND XPI.EZCANCELFLAG            = CON.EZCANCELFLAG
                AND CON.CONTR_INTFC_DTL_TP_CD   = #contrIntfcDtlTpCd#
                AND CON.GLBL_CMPY_CD            = ACT.GLBL_CMPY_CD(+)
                AND CON.DS_CONTR_INTFC_ACT_CD   = ACT.DS_CONTR_INTFC_ACT_CD(+)
                AND CON.EZCANCELFLAG            = ACT.EZCANCELFLAG(+)
                AND CON.GLBL_CMPY_CD            = PSTS.GLBL_CMPY_CD(+)
                AND CON.DS_CONTR_PROC_STS_CD    = PSTS.DS_CONTR_PROC_STS_CD(+)
                AND CON.EZCANCELFLAG            = PSTS.EZCANCELFLAG(+)
                AND XPI.GLBL_CMPY_CD            = ML.GLBL_CMPY_CD(+)
                AND XPI.BLLG_MTR_LB_CD          = ML.MTR_LB_CD(+)
                AND XPI.EZCANCELFLAG            = ML.EZCANCELFLAG(+)
                ORDER BY
                     DS_CONTR_SRC_REF_NUM ASC
                    ,CONTR_INTFC_SRC_TP_CD ASC
                    ,DS_CONTR_INTFC_BAT_NUM ASC
               <!-- ,CPO_SVC_DTL_PK ASC -->
                    ,SVC_MACH_MSTR_PK ASC NULLS FIRST
                    ,BLLG_MTR_LB_CD ASC
                    ,XX_TP_CD DESC
                    ,XS_MTR_COPY_QTY ASC
            )
            WHERE
                ROWNUM &lt;= #limitNum#
            ORDER BY
                 DS_CONTR_SRC_REF_NUM ASC
                ,CONTR_INTFC_SRC_TP_CD ASC
                ,DS_CONTR_INTFC_BAT_NUM ASC
           <!-- ,CPO_SVC_DTL_PK ASC -->
                ,SVC_MACH_MSTR_PK ASC NULLS FIRST
                ,BLLG_MTR_LB_CD ASC
                ,XX_TP_CD DESC
                ,XS_MTR_COPY_QTY ASC
    </statement>

    <resultMap id="result.getMainData" class="NSAL0830_ASMsg">
        <result property="xxChkBox_A"               column="XX_CHK_BOX"                     javaType="EZDSStringItem" />
        <result property="dsContrIntfcBatNum_A"     column="DS_CONTR_INTFC_BAT_NUM"         javaType="EZDSStringItem" />
        <result property="dsContrSrcRefNum_A"       column="DS_CONTR_SRC_REF_NUM"           javaType="EZDSStringItem" />
        <result property="contrIntfcSrcTpCd_A"      column="CONTR_INTFC_SRC_TP_CD"          javaType="EZDSStringItem" />
        <result property="dsContrNum_A"             column="DS_CONTR_NUM"                   javaType="EZDSStringItem" />
        <result property="dsContrIntfcActCd_A"      column="DS_CONTR_INTFC_ACT_CD"          javaType="EZDSStringItem" />
        <result property="dsContrIntfcActDescTxt_A" column="DS_CONTR_INTFC_ACT_DESC_TXT"    javaType="EZDSStringItem" />
        <result property="serNum_A"                 column="SER_NUM"                        javaType="EZDSStringItem" />
        <result property="svcMachMstrPk_A"          column="SVC_MACH_MSTR_PK"               javaType="EZDSBigDecimalItem" />
        <result property="mdseCd_A"                 column="MDSE_CD"                        javaType="EZDSStringItem" />
        <result property="bllgMtrLbCd_A"            column="BLLG_MTR_LB_CD"                 javaType="EZDSStringItem" />
        <result property="mtrLbDescTxt_A"           column="MTR_LB_DESC_TXT"                javaType="EZDSStringItem" />
        <result property="xsMtrLvlNum_A"            column="BLLG_MTR_LVL_NUM"               javaType="EZDSStringItem" />
        <result property="xsMtrCopyQty_A"           column="XS_MTR_COPY_QTY"                javaType="EZDSBigDecimalItem" />
        <result property="xsMtrAmtRate_A"           column="XS_MTR_AMT_RATE"                javaType="EZDSBigDecimalItem" />
        <result property="dsContrIntfcStsCd_A"      column="DS_CONTR_INTFC_STS_CD"          javaType="EZDSStringItem" />
        <result property="intfcErrMsgTxt_A"         column="INTFC_ERR_MSG_TXT"              javaType="EZDSStringItem" />
        <result property="dsContrProcStsDescTxt_A"  column="DS_CONTR_PROC_STS_DESC_TXT"     javaType="EZDSStringItem" />
        <result property="dsContrProcStsCd_A"       column="DS_CONTR_PROC_STS_CD"           javaType="EZDSStringItem" />
        <result property="dsContrIntfcPk_A"         column="DS_CONTR_INTFC_PK"              javaType="EZDSBigDecimalItem" />
        <result property="dsXsCopyIntfcPk_A"        column="DS_XS_COPY_INTFC_PK"            javaType="EZDSBigDecimalItem" />
        <result property="xxTpCd_A"                 column="XX_TP_CD"                       javaType="EZDSStringItem"/>
        <result property="ezUpTime"                 column="EZUPTIME"                       javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone"             column="EZUPTIMEZONE"                   javaType="EZDSStringItem"/>
        <result property="xxDplyCtrlFlg_A"          column="XX_DPLY_CTRL_FLG"               javaType="EZDSStringItem"/>
        <!-- START 2016/11/28 K.Kojima [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_A"        column="XX_REC_HIST_CRAT_TS_A"          javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_A"      column="XX_REC_HIST_CRAT_BY_NM_A"       javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_A"         column="XX_REC_HIST_UPD_TS_A"           javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_A"       column="XX_REC_HIST_UPD_BY_NM_A"        javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_A"         column="XX_REC_HIST_TBL_NM_A"           javaType="EZDSStringItem"/>
        <!-- END 2016/11/28 K.Kojima [QC#14204, ADD] -->
   </resultMap>

    <statement id="getDsXsCopyIntfcPk" parameterClass="Map" resultClass="Map">
           SELECT
                 CON.DS_CONTR_NUM
                ,XPI.XS_COPY_INTFC_STS_CD AS DS_CONTR_INTFC_STS_CD
                ,XPI.INTFC_ERR_MSG_TXT
                ,PSTS.DS_CONTR_PROC_STS_DESC_TXT
                ,PSTS.DS_CONTR_PROC_STS_CD
                ,CON.DS_CONTR_INTFC_PK
                ,XPI.DS_XS_COPY_INTFC_PK
                ,XPI.EZUPTIME
                ,XPI.EZUPTIMEZONE
            FROM
                 DS_CONTR_INTFC CON
                ,DS_XS_COPY_INTFC XPI
                ,DS_CONTR_INTFC_ACT ACT
                ,DS_CONTR_PROC_STS PSTS
            WHERE
                CON.GLBL_CMPY_CD                = #glblCmpyCd#
                AND CON.EZCANCELFLAG            = '0'
                AND CON.GLBL_CMPY_CD            = XPI.GLBL_CMPY_CD
                AND CON.DS_CONTR_INTFC_BAT_NUM  = XPI.DS_CONTR_INTFC_BAT_NUM
                AND CON.DS_CONTR_SRC_REF_NUM    = XPI.DS_CONTR_SRC_REF_NUM
                AND CON.CONTR_INTFC_SRC_TP_CD   = XPI.CONTR_INTFC_SRC_TP_CD
                AND NVL(CON.SVC_MACH_MSTR_PK,0) = NVL(XPI.SVC_MACH_MSTR_PK,0)
                AND CON.BLLG_MTR_LB_CD          = XPI.BLLG_MTR_LB_CD
                AND CON.EZCANCELFLAG            = XPI.EZCANCELFLAG
                AND CON.GLBL_CMPY_CD            = ACT.GLBL_CMPY_CD(+)
                AND CON.DS_CONTR_INTFC_ACT_CD   = ACT.DS_CONTR_INTFC_ACT_CD(+)
                AND CON.EZCANCELFLAG            = ACT.EZCANCELFLAG(+)
                AND CON.GLBL_CMPY_CD            = PSTS.GLBL_CMPY_CD(+)
                AND CON.DS_CONTR_PROC_STS_CD    = PSTS.DS_CONTR_PROC_STS_CD(+)
                AND CON.EZCANCELFLAG            = PSTS.EZCANCELFLAG(+)
                AND XPI.DS_CONTR_INTFC_BAT_NUM  = #dsContrIntfcBatNum#
                AND XPI.DS_CONTR_SRC_REF_NUM    = #dsContrSrcRefNum#
                AND XPI.CONTR_INTFC_SRC_TP_CD   = #contrIntfcSrcTpCd#
                AND XPI.SER_NUM                 = #serNum#
                AND XPI.MDSE_CD                 = #mdseCd#
                AND XPI.BLLG_MTR_LB_CD          = #bllgMtrLbCd#
                AND ROWNUM                      = 1
    </statement>

    <statement id="getXsCopyIntfcData" parameterClass="Map" resultClass="Map">
            SELECT
                 A.DS_CONTR_NUM
                ,A.DS_CONTR_INTFC_STS_CD
                ,A.INTFC_ERR_MSG_TXT
                ,A.DS_CONTR_PROC_STS_DESC_TXT
                ,A.DS_CONTR_PROC_STS_CD
                ,A.DS_CONTR_INTFC_PK
                ,B.XS_MTR_COPY_QTY
                ,B.DS_XS_COPY_INTFC_PK
                ,A.EZUPTIME
                ,A.EZUPTIMEZONE
            FROM
                 (SELECT 
                         CON.GLBL_CMPY_CD
                        ,CON.DS_CONTR_INTFC_BAT_NUM
                        ,CON.DS_CONTR_SRC_REF_NUM
                        ,CON.CONTR_INTFC_SRC_TP_CD
                        ,CON.SVC_MACH_MSTR_PK
                        ,CON.BLLG_MTR_LB_CD
                        ,CON.DS_CONTR_NUM
                        ,CON.DS_CONTR_INTFC_STS_CD
                        ,CON.INTFC_ERR_MSG_TXT
                        ,PSTS.DS_CONTR_PROC_STS_DESC_TXT
                        ,CON.DS_CONTR_PROC_STS_CD
                        ,CON.DS_CONTR_INTFC_PK
                        ,CON.EZUPTIME
                        ,CON.EZUPTIMEZONE
                  FROM   
                         DS_CONTR_INTFC CON
                        ,DS_CONTR_PROC_STS PSTS
                  WHERE  
                            CON.GLBL_CMPY_CD            = #glblCmpyCd#
                        AND CON.EZCANCELFLAG            = '0'
                        AND CON.GLBL_CMPY_CD            = PSTS.GLBL_CMPY_CD(+)
                        AND CON.DS_CONTR_PROC_STS_CD    = PSTS.DS_CONTR_PROC_STS_CD(+)
                        AND CON.EZCANCELFLAG            = PSTS.EZCANCELFLAG(+)
                        AND CON.DS_CONTR_INTFC_BAT_NUM  = #dsContrIntfcBatNum#
                        AND CON.DS_CONTR_SRC_REF_NUM    = #dsContrSrcRefNum#
                        AND CON.CONTR_INTFC_SRC_TP_CD   = #contrIntfcSrcTpCd#
                        <isNotNull property="serNum">
                        AND CON.SER_NUM                 = #serNum# 
                        </isNotNull>
                        <isNull property="serNum">
                        AND CON.SER_NUM IS NULL 
                        </isNull>
                        <isNotNull property="mdseCd">
                        AND CON.MDSE_CD                 = #mdseCd#
                        </isNotNull>
                        <isNull property="mdseCd">
                        AND CON.MDSE_CD IS NULL
                        </isNull>
                        AND CON.BLLG_MTR_LB_CD          = #bllgMtrLbCd#) A
                ,(SELECT
                         XPI.GLBL_CMPY_CD
                        ,XPI.DS_CONTR_INTFC_BAT_NUM
                        ,XPI.DS_CONTR_SRC_REF_NUM
                        ,XPI.CONTR_INTFC_SRC_TP_CD
                        ,XPI.SVC_MACH_MSTR_PK
                        ,XPI.BLLG_MTR_LB_CD
                        ,XPI.XS_MTR_COPY_QTY
                        ,XPI.DS_XS_COPY_INTFC_PK
                        ,XPI.EZUPTIME
                        ,XPI.EZUPTIMEZONE
                  FROM
                         DS_CONTR_INTFC CON
                        ,DS_XS_COPY_INTFC XPI
                  WHERE
                         CON.GLBL_CMPY_CD                = #glblCmpyCd#
                     AND CON.EZCANCELFLAG            = '0'
                     AND CON.GLBL_CMPY_CD            = XPI.GLBL_CMPY_CD
                     AND CON.DS_CONTR_INTFC_BAT_NUM  = XPI.DS_CONTR_INTFC_BAT_NUM
                     AND CON.DS_CONTR_SRC_REF_NUM    = XPI.DS_CONTR_SRC_REF_NUM
                     AND CON.CONTR_INTFC_SRC_TP_CD   = XPI.CONTR_INTFC_SRC_TP_CD
                     AND NVL(CON.SVC_MACH_MSTR_PK,0) = NVL(XPI.SVC_MACH_MSTR_PK,0)
                     AND CON.BLLG_MTR_LB_CD          = XPI.BLLG_MTR_LB_CD
                     AND CON.EZCANCELFLAG            = XPI.EZCANCELFLAG
                     AND XPI.DS_CONTR_INTFC_BAT_NUM  = #dsContrIntfcBatNum#
                     AND XPI.DS_CONTR_SRC_REF_NUM    = #dsContrSrcRefNum#
                     AND XPI.CONTR_INTFC_SRC_TP_CD   = #contrIntfcSrcTpCd#
                     <isNotNull property="serNum">
                     AND XPI.SER_NUM                 = #serNum# 
                     </isNotNull>
                     <isNull property="serNum">
                     AND XPI.SER_NUM IS NULL 
                     </isNull>
                     <isNotNull property="mdseCd">
                     AND XPI.MDSE_CD                 = #mdseCd#
                     </isNotNull>
                     <isNull property="mdseCd">
                     AND XPI.MDSE_CD IS NULL
                     </isNull>
                     AND XPI.BLLG_MTR_LB_CD          = #bllgMtrLbCd#
                     AND XPI.XS_MTR_COPY_QTY         = #xsMtrCopyQty#) B
            WHERE
                    A.GLBL_CMPY_CD               = B.GLBL_CMPY_CD(+)
                AND A.DS_CONTR_INTFC_BAT_NUM     = B.DS_CONTR_INTFC_BAT_NUM(+)
                AND A.DS_CONTR_SRC_REF_NUM       = B.DS_CONTR_SRC_REF_NUM(+)
                AND A.CONTR_INTFC_SRC_TP_CD      = B.CONTR_INTFC_SRC_TP_CD(+)
                AND NVL(A.SVC_MACH_MSTR_PK,0)    = NVL(B.SVC_MACH_MSTR_PK,0)
                AND A.BLLG_MTR_LB_CD             = B.BLLG_MTR_LB_CD(+)
    </statement>

    <statement id="getDsContrIntfcPk" parameterClass="Map" resultClass="Map">
           SELECT
                 CON.DS_CONTR_NUM
                ,CON.DS_CONTR_INTFC_STS_CD
                ,CON.INTFC_ERR_MSG_TXT
                ,ACT.DS_CONTR_INTFC_ACT_DESC_TXT
                ,PSTS.DS_CONTR_PROC_STS_DESC_TXT
                ,PSTS.DS_CONTR_PROC_STS_CD
                ,CON.DS_CONTR_INTFC_PK
                ,CON.XS_MTR_COPY_QTY
                ,CON.EZUPTIME
                ,CON.EZUPTIMEZONE
            FROM
                 DS_CONTR_INTFC CON
                ,DS_CONTR_INTFC_ACT ACT
                ,DS_CONTR_PROC_STS PSTS
            WHERE
                CON.GLBL_CMPY_CD                = #glblCmpyCd#
                AND CON.EZCANCELFLAG            = '0'
                AND CON.GLBL_CMPY_CD            = ACT.GLBL_CMPY_CD(+)
                AND CON.DS_CONTR_INTFC_ACT_CD   = ACT.DS_CONTR_INTFC_ACT_CD(+)
                AND CON.EZCANCELFLAG            = ACT.EZCANCELFLAG(+)
                AND CON.GLBL_CMPY_CD            = PSTS.GLBL_CMPY_CD(+)
                AND CON.DS_CONTR_PROC_STS_CD    = PSTS.DS_CONTR_PROC_STS_CD(+)
                AND CON.EZCANCELFLAG            = PSTS.EZCANCELFLAG(+)
                AND CON.DS_CONTR_INTFC_BAT_NUM  = #dsContrIntfcBatNum#
                AND CON.DS_CONTR_SRC_REF_NUM    = #dsContrSrcRefNum#
                AND CON.CONTR_INTFC_SRC_TP_CD   = #contrIntfcSrcTpCd#
                <isNotNull property="serNum">
                AND CON.SER_NUM                 = #serNum# 
                </isNotNull>
                <isNull property="serNum">
                AND CON.SER_NUM IS NULL 
                </isNull>
                <isNotNull property="mdseCd">
                AND CON.MDSE_CD                 = #mdseCd#
                </isNotNull>
                <isNull property="mdseCd">
                AND CON.MDSE_CD IS NULL
                </isNull>
                AND CON.BLLG_MTR_LB_CD          = #bllgMtrLbCd#
                AND CON.CONTR_INTFC_DTL_TP_CD   = #contrIntfcDtlTpCd#
                AND ROWNUM                      = 1
    </statement>
    <statement id="getStatusUpdateTarget" parameterClass="Map" resultClass="Map">
            SELECT
                DCI.GLBL_CMPY_CD
               ,DCI.DS_CONTR_INTFC_PK
            FROM
                DS_CONTR_INTFC        DCI
            WHERE
                DCI.GLBL_CMPY_CD                = #glblCmpyCd#
                AND DCI.EZCANCELFLAG            = '0'
                AND DCI.DS_CONTR_PROC_STS_CD IN(#inProcess#, #reProcess#)
                AND (EXISTS(SELECT 1 FROM DS_CONTR_INTFC DCI2
                            WHERE
                            DCI2.GLBL_CMPY_CD                = DCI.GLBL_CMPY_CD
                            AND DCI2.DS_CONTR_INTFC_BAT_NUM  = DCI.DS_CONTR_INTFC_BAT_NUM
                            AND DCI2.CONTR_INTFC_SRC_TP_CD   = DCI.CONTR_INTFC_SRC_TP_CD
                            AND DCI2.DS_CONTR_SRC_REF_NUM    = DCI.DS_CONTR_SRC_REF_NUM
                       <!-- AND NVL(DCI2.CPO_SVC_DTL_PK, 0)  = NVL(DCI.CPO_SVC_DTL_PK, 0) -->
                            <iterate property="dsCntIntfcPkList" var="dsCntIntfcPkList[]" open="                AND DCI2.DS_CONTR_INTFC_PK IN (" close=")" conjunction=",">
                                #dsCntIntfcPkList[]#
                            </iterate>
                            AND DCI2.DS_CONTR_INTFC_STS_CD   = #intfcStsError#
                            AND DCI2.EZCANCELFLAG            = '0')
                  OR EXISTS(SELECT 1 FROM DS_XS_COPY_INTFC DXCI
                            WHERE
                            DCI.GLBL_CMPY_CD                = DXCI.GLBL_CMPY_CD
                            AND DCI.DS_CONTR_INTFC_BAT_NUM  = DXCI.DS_CONTR_INTFC_BAT_NUM
                            AND DCI.CONTR_INTFC_SRC_TP_CD   = DXCI.CONTR_INTFC_SRC_TP_CD
                            AND DCI.DS_CONTR_SRC_REF_NUM    = DXCI.DS_CONTR_SRC_REF_NUM
                       <!-- AND NVL(DCI.CPO_SVC_DTL_PK, 0)  = NVL(DXCI.CPO_SVC_DTL_PK, 0) -->
                            AND DXCI.XS_COPY_INTFC_STS_CD   = #intfcStsError#
                            <iterate property="dsXsCopyIntfcPkList" var="dsXsCopyIntfcPkList[]" open="                AND DXCI.DS_XS_COPY_INTFC_PK IN (" close=")" conjunction=",">
                                #dsXsCopyIntfcPkList[]#
                            </iterate>
                            AND DXCI.EZCANCELFLAG            = '0')
                )
            ORDER BY DCI.DS_CONTR_INTFC_PK
    </statement>

<!-- START 2016/07/28 M.Gotou [QC#12141, ADD] -->
    <statement id="countCpltData" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            DS_CONTR_INTFC     CON
        WHERE
                CON.GLBL_CMPY_CD          = #glblCmpyCd#
            AND CON.DS_CONTR_PROC_STS_CD  = #dsContrProcStsCd#
            AND CON.EZCANCELFLAG          = '0'
            <iterate property="dsContrIntfcPkList" var="dsContrIntfcPkList[]" open="AND CON.DS_CONTR_INTFC_PK IN (" close=")" conjunction=",">
                #dsContrIntfcPkList[]#
            </iterate>
    </statement>
    <statement id="getDsContrIntfcActDescTxt" parameterClass="Map" resultClass="String">
        SELECT
            DS_CONTR_INTFC_ACT_DESC_TXT
        FROM
        (
            SELECT
                ACT.DS_CONTR_INTFC_ACT_DESC_TXT
            FROM
                 DS_CONTR_INTFC     CON
                ,DS_CONTR_INTFC_ACT ACT
            WHERE
                    CON.GLBL_CMPY_CD          = #glblCmpyCd#
                AND CON.EZCANCELFLAG          = '0'
                AND CON.GLBL_CMPY_CD          = ACT.GLBL_CMPY_CD
                AND CON.DS_CONTR_INTFC_ACT_CD = ACT.DS_CONTR_INTFC_ACT_CD
                AND CON.EZCANCELFLAG          = ACT.EZCANCELFLAG
                <iterate property="dsContrIntfcPkList" var="dsContrIntfcPkList[]" open="AND CON.DS_CONTR_INTFC_PK IN (" close=")" conjunction=",">
                    #dsContrIntfcPkList[]#
                </iterate>
            ORDER BY
                CON.DS_CONTR_INTFC_PK
        )
        WHERE
            ROWNUM = 1
    </statement>
<!-- END 2016/07/28 M.Gotou [QC#12141, ADD] -->
</sqlMap>
