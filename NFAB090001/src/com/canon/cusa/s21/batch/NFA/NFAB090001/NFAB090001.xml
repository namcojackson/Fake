<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NFAB090001">

    <!-- 2016/02/23 CSA modification. Retrieve data regardless MDSE or Parts -->
   	<statement id="getOpenEndAmount" parameterClass="Map">
	    SELECT
			NVL(SUM( DLY_MDSE_SMRY_AMT ), 0) AS DLY_MDSE_SMRY_AMT_SUM
		FROM
		  	INVTY_DTL_RPT_SMRY_AMT RSA
		WHERE 
		     RSA.EZCANCELFLAG 		= '0' 
		 AND RSA.GLBL_CMPY_CD 		= #glblCmpyCd#
		 AND INVTY_SNAP_SHOT_DT 	= #invtySnapShotDt#
		 <isNotNull property="coaProdCd">   
		   AND COA_PROD_CD = #coaProdCd# 
		 </isNotNull>
		 <isNotNull property="coaAcctCd">
		   AND COA_ACCT_CD = #coaAcctCd# 
		 </isNotNull>
		 GROUP BY
		  	INVTY_SNAP_SHOT_DT
    </statement>
    
    <!-- 2016/02/23 CSA modification. Retrieve data regardless MDSE or Parts -->
    <statement id="getRvalAmount" parameterClass="Map">
	    SELECT
			NVL(SUM( RVAL_AMT ), 0) AS RVAL_AMT_SUM
		FROM
			MTH_INVTY_RPT_RVAL    RVAL
		WHERE 
		    RVAL.EZCANCELFLAG 	= '0' 
		AND RVAL.GLBL_CMPY_CD 	= #glblCmpyCd#
<!--		AND GL_DT 			= #glDt#-->
		AND GL_DT				BETWEEN #dateStart# AND #dateEnd#
		<isNotNull property="coaProdCd">   
		  AND COA_PROD_CD = #coaProdCd# 
		</isNotNull>
		 <isNotNull property="coaAcctCd">
		   AND COA_ACCT_CD = #coaAcctCd# 
		 </isNotNull>
    </statement>

    <!-- 2016/02/23 CSA modification. Retrieve data regardless MDSE or Parts -->
    <!-- 2016/02/23 CSA modification. No need to transaction information. Get summary amount -->
   	<statement id="getShipInOut" parameterClass="Map">
		SELECT 
			''					AS TRX_CD,
			''				    AS TRX_RSN_CD,
			SUM( INVTY_SHIP_AMT )	AS INVTY_SHIP_AMT
		FROM 
			DLY_INVTY_RPT_SHIP     IRS
		WHERE 
			IRS.EZCANCELFLAG 		= '0'
		AND IRS.GLBL_CMPY_CD 		= #glblCmpyCd#
		AND INVTY_IN_OUT_STS_CD = #invtyInOutStsCd#
		AND GL_DT				BETWEEN #dateStart# AND #dateEnd#
		<isNotNull property="coaProdCd">   
		  AND COA_PROD_CD = #coaProdCd# 
		</isNotNull>
		 <isNotNull property="coaAcctCd">
		   AND COA_ACCT_CD = #coaAcctCd# 
		 </isNotNull>
    </statement>
    
   	<statement id="back_getShipInOut" parameterClass="Map">
		SELECT 
			TRX_CD					AS TRX_CD,
			TRX_RSN_CD				AS TRX_RSN_CD,
			SUM( INVTY_SHIP_AMT )	AS INVTY_SHIP_AMT
		FROM 
			DLY_INVTY_RPT_SHIP     IRS
		WHERE 
			IRS.EZCANCELFLAG 		= '0'
		AND IRS.GLBL_CMPY_CD 		= #glblCmpyCd#
		AND INVTY_IN_OUT_STS_CD = #invtyInOutStsCd#
		AND GL_DT				BETWEEN #dateStart# AND #dateEnd#
		<isNotNull property="coaProdCd">   
		  AND COA_PROD_CD = #coaProdCd# 
		</isNotNull>
		GROUP BY
			TRX_CD,
			TRX_RSN_CD
		ORDER BY 
			TRX_CD,
			TRX_RSN_CD
    </statement>    

	<!-- 2016/02/23 CSA modification. Retrieve data regardless MDSE or Parts -->
	<statement id="getCoaProdCds" parameterClass="Map">   
		(
		  SELECT  
		  		 COA_PROD_CD  AS COA_PROD_CD
		  		,COA_ACCT_CD  AS COA_ACCT_CD
		  FROM  
		  		INVTY_DTL_RPT_SMRY_AMT  RSA
		  WHERE 
		        INVTY_SNAP_SHOT_DT BETWEEN #dateStart# AND #dateEnd#
		    AND RSA.GLBL_CMPY_CD         = #glblCmpyCd#
            AND RSA.EZCANCELFLAG         = '0'
		  GROUP BY COA_PROD_CD , COA_ACCT_CD
		)
		UNION
		(
		  SELECT  
		  		 COA_PROD_CD AS COA_PROD_CD
		  		,COA_ACCT_CD AS COA_ACCT_CD
		  FROM  
		  		DLY_INVTY_RPT_SHIP IRS
		  WHERE 
		        IRS.EZCANCELFLAG 	= '0' 
		    AND IRS.GLBL_CMPY_CD 	= #glblCmpyCd#
<!--		    AND GL_DT 			= #dateEnd# -->
		    AND GL_DT 	BETWEEN #dateStart# AND #dateEnd#
		  GROUP BY COA_PROD_CD , COA_ACCT_CD
		)
		UNION
		(
		  SELECT  
		  		COA_PROD_CD AS COA_PROD_CD
		  	   ,COA_ACCT_CD AS COA_ACCT_CD
		  FROM  
		  		MTH_INVTY_RPT_RVAL RVAL
		  WHERE 		      
		        RVAL.EZCANCELFLAG 	= '0' 
		    AND RVAL.GLBL_CMPY_CD 	= #glblCmpyCd#
<!--		    AND GL_DT 			= #dateEnd#-->
		    AND GL_DT 	BETWEEN #dateStart# AND #dateEnd#
		  GROUP BY COA_PROD_CD , COA_ACCT_CD
		)
		ORDER BY COA_PROD_CD
	</statement>

    <!-- 2016/02/23 CSA modification. Retrieve data regardless MDSE or Parts -->	
    <statement id="getMaxPrevDt" parameterClass="Map">
        SELECT DT.DT_PREV FROM
        (
            SELECT
                RSA.INVTY_SNAP_SHOT_DT AS DT_PREV
            FROM
                INVTY_DTL_RPT_SMRY_AMT RSA
            WHERE
                    INVTY_SNAP_SHOT_DT      &lt; #dateProc#
                AND RSA.GLBL_CMPY_CD           = #glblCmpyCd#
                AND RSA.EZCANCELFLAG           = '0'
            ORDER BY
                    RSA.INVTY_SNAP_SHOT_DT DESC
        ) DT WHERE
                    ROWNUM = 1
    </statement>
</sqlMap>
