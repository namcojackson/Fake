<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sqlMap namespace="NSZC070001">
    <statement id="getShipToCust" parameterClass="Map" resultClass="Map">
        SELECT 
              SHIP.CTRY_CD                  AS CTRY_CD
            , SHIP.POST_CD                  AS POST_CD
        FROM  FSR
            , SHIP_TO_CUST SHIP
        WHERE FSR.GLBL_CMPY_CD = #glblCmpyCd#
          AND FSR.FSR_NUM = #fsrNum#
          AND FSR.EZCANCELFLAG = '0'
          AND FSR.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD(+)
          AND ( CASE
                     <!-- START 2022/03/11 [QC#59702, MOD] -->
                     <!-- WHEN FSR.SHIP_TO_CUST_UPD_FLG = 'Y' THEN FSR.SHIP_TO_UPD_CUST_CD -->
                     WHEN FSR.SHIP_TO_UPD_CUST_CD IS NOT NULL THEN FSR.SHIP_TO_UPD_CUST_CD
                     ELSE FSR.SHIP_TO_CUST_CD
                     <!-- END   2022/03/11 [QC#59702, MOD] -->
                 END
              ) = SHIP.SHIP_TO_CUST_CD(+)
          AND SHIP.EZCANCELFLAG(+) = '0'
          AND ROWNUM = 1
    </statement>
    <statement id="getFollUpTask" parameterClass="Map" resultClass="String">
        SELECT
            FL.SVC_TASK_NUM
        FROM
            FSR_VISIT    FV
           ,FSR_VISIT    FL
        WHERE
            FV.GLBL_CMPY_CD          = #glblCmpyCd#
        AND FV.SVC_TASK_NUM          = #svcTaskNum#
        AND FV.GLBL_CMPY_CD          = FL.GLBL_CMPY_CD
        AND FV.FSR_NUM               = FL.FSR_NUM
        AND FV.NEXT_FSR_VISIT_NUM    = FL.FSR_VISIT_NUM
        AND FV.EZCANCELFLAG          = '0'
        AND FL.EZCANCELFLAG          = '0'
    </statement>
    <statement id="getCloseTaskList" parameterClass="Map" resultClass="String">
        SELECT
            ST.SVC_TASK_NUM
        FROM
            SVC_TASK   ST
        WHERE
            ST.GLBL_CMPY_CD          = #glblCmpyCd#
        AND ST.FSR_NUM               = #fsrNum#
     <isNotNull property="svcTaskNum">
        AND ST.SVC_TASK_NUM          &lt;&gt; #svcTaskNum#
     </isNotNull>
        AND ST.SVC_TASK_STS_CD       = #svcTaskStsCd#
        AND ST.EZCANCELFLAG          = '0'
    </statement>
</sqlMap>
