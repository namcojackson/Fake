<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAL0410Query">

    <typeAlias alias="NSAL0410_ACMsg" type="business.blap.NSAL0410.NSAL0410_ACMsg"/>
    <typeAlias alias="NSAL0410CMsg" type="business.blap.NSAL0410.NSAL0410CMsg"/>
    <typeAlias alias="NSAL0410_TCMsg" type="business.blap.NSAL0410.NSAL0410_TCMsg"/>
    <typeAlias alias="NSAL0410_BCMsg" type="business.blap.NSAL0410.NSAL0410_BCMsg"/>
    <statement id="getHeader" parameterClass="Map" resultMap="result.getHeader">
        SELECT
             A.DS_CONTR_NUM           AS DS_CONTR_NUM
            ,B.DS_CONTR_CTRL_STS_NM   AS DS_CONTR_CTRL_STS_NM
            ,C.SVC_CONTR_BR_DESC_TXT  AS SVC_CONTR_BR_DESC_TXT
            ,A.DS_CONTR_NM            AS DS_CONTR_NM
            ,A.DS_ACCT_NUM            AS DS_ACCT_NUM
            ,D.DS_ACCT_NM             AS DS_ACCT_NM
            ,A.DS_CONTR_CATG_CD       AS DS_CONTR_CATG_CD
            ,A.CONTR_VRSN_EFF_FROM_DT AS CONTR_VRSN_EFF_FROM_DT
            ,A.CONTR_VRSN_EFF_THRU_DT AS CONTR_VRSN_EFF_THRU_DT
            ,E.DS_CONTR_CATG_ABBR_NM
             || '_'
             || A.DS_CONTR_NUM        AS XX_SCR_ITEM_34_TXT
        FROM
             DS_CONTR         A
            ,DS_CONTR_STS_V   B
            ,(
                SELECT
                     C1.GLBL_CMPY_CD
                    ,C1.EZCANCELFLAG
                    ,C1.SVC_CONTR_BR_CD
                    ,C1.SVC_CONTR_BR_DESC_TXT
                    ,C1.EFF_FROM_DT
                    ,NVL(C1.EFF_THRU_DT, #effThruDt#) AS EFF_THRU_DT
                FROM
                    SVC_CONTR_BR C1
                WHERE
                    C1.GLBL_CMPY_CD = #glblCmpyCd#
                AND C1.EZCANCELFLAG = '0'
             ) C
            ,SELL_TO_CUST     D
            ,DS_CONTR_CATG    E
        WHERE
            A.GLBL_CMPY_CD        =  #glblCmpyCd#
        AND A.DS_CONTR_PK         =  #dsContrPk#
        AND A.EZCANCELFLAG        =  '0'
        AND A.GLBL_CMPY_CD        =  B.GLBL_CMPY_CD
        AND A.DS_CONTR_PK         =  B.DS_CONTR_PK
        AND B.EZCANCELFLAG        =  '0'
        AND A.GLBL_CMPY_CD        =  C.GLBL_CMPY_CD     (+)
        AND A.SVC_CONTR_BR_CD     =  C.SVC_CONTR_BR_CD  (+)
        AND C.EFF_FROM_DT     (+) &lt;= #slsDt#
        AND C.EFF_THRU_DT     (+) &gt;= #slsDt#
        AND C.EZCANCELFLAG    (+) =  '0'
        AND A.GLBL_CMPY_CD        =  D.GLBL_CMPY_CD     (+)
        AND A.DS_ACCT_NUM         =  D.SELL_TO_CUST_CD  (+)
        AND D.EZCANCELFLAG    (+) =  '0'
        AND A.GLBL_CMPY_CD        =  E.GLBL_CMPY_CD
        AND A.DS_CONTR_CATG_CD    =  E.DS_CONTR_CATG_CD
        AND E.EZCANCELFLAG        =  '0'

    </statement>
    <resultMap id="result.getHeader" class="NSAL0410CMsg">
        <result property="dsContrNum"         column="DS_CONTR_NUM"             javaType="EZDCStringItem"/>
        <result property="dsContrCtrlStsNm"   column="DS_CONTR_CTRL_STS_NM"     javaType="EZDCStringItem"/>
        <result property="svcContrBrDescTxt"  column="SVC_CONTR_BR_DESC_TXT"    javaType="EZDCStringItem"/>
        <result property="dsContrNm"          column="DS_CONTR_NM"              javaType="EZDCStringItem"/>
        <result property="dsAcctNum"          column="DS_ACCT_NUM"              javaType="EZDCStringItem"/>
        <result property="dsAcctNm"           column="DS_ACCT_NM"               javaType="EZDCStringItem"/>
        <result property="dsContrCatgCd_H"    column="DS_CONTR_CATG_CD"         javaType="EZDCStringItem"/>
        <result property="contrVrsnEffFromDt"  column="CONTR_VRSN_EFF_FROM_DT"  javaType="EZDCDateItem"/>
        <result property="contrVrsnEffThruDt"  column="CONTR_VRSN_EFF_THRU_DT"  javaType="EZDCDateItem"/>
        <result property="xxScrItem34Txt"     column="XX_SCR_ITEM_34_TXT"       javaType="EZDCStringItem"/>
    </resultMap>

    <statement id="getSvcBillByTpTable" parameterClass="Map" resultMap="result.getSvcBillByTpTable">
        SELECT
            BBY.SVC_BILL_BY_TP_CD
          , BBY.SVC_BILL_BY_TP_NM
          , BBY.SVC_BILL_BY_TP_SORT_NUM
          , BBY.FLAT_PRC_AVAL_FLG
          , BBY.PCT_PRC_AVAL_FLG 
        FROM
            SVC_BILL_BY_TP BBY 
        WHERE
            BBY.GLBL_CMPY_CD  = #glblCmpyCd# 
        AND BBY.EZCANCELFLAG  = '0'
        ORDER BY  
            BBY.SVC_BILL_BY_TP_SORT_NUM ASC
    </statement>
    <resultMap id="result.getSvcBillByTpTable" class="NSAL0410_TCMsg">
        <result property="svcBillByTpCd_T"       column="SVC_BILL_BY_TP_CD"       javaType="EZDSStringItem"/>
        <result property="svcBillByTpNm_T"       column="SVC_BILL_BY_TP_NM"       javaType="EZDSStringItem"/>
        <result property="svcBillByTpSortNum_T"  column="SVC_BILL_BY_TP_SORT_NUM" javaType="EZDSBigDecimalItem"/>
        <result property="flatPrcAvalFlg_T"      column="FLAT_PRC_AVAL_FLG"       javaType="EZDSStringItem"/>
        <result property="pctPrcAvalFlg_T"       column="PCT_PRC_AVAL_FLG"        javaType="EZDSStringItem"/>
    </resultMap>
    
    <statement id="getThisContrEffAddlChrgTp" parameterClass="Map" resultClass="Map">
        SELECT
            ADC.DS_CONTR_DTL_PK
           ,ADC.ADDL_CHRG_TP_CD
           ,ADC.EFF_FROM_DT
           ,NVL(ADC.TRMN_DT, ADC.EFF_THRU_DT) AS EFF_THRU_TRMN_DT
        FROM
            DS_CONTR_ADDL_CHRG ADC
           ,SVC_MACH_MSTR      SMM
           ,DS_CONTR_DTL       DTL
           ,DS_CONTR           CTR
        WHERE
            ADC.GLBL_CMPY_CD     = #glblCmpyCd#
        AND ADC.DS_CONTR_PK      = #dsContrPk#
        <isNotNull property="dsContrDtlPk">
        AND ADC.DS_CONTR_DTL_PK  = #dsContrDtlPk#
        </isNotNull>
        AND ADC.EZCANCELFLAG     = '0' 
        AND ADC.GLBL_CMPY_CD     = CTR.GLBL_CMPY_CD
        AND ADC.DS_CONTR_PK      = CTR.DS_CONTR_PK
        AND CTR.EZCANCELFLAG     = '0' 
        AND ADC.GLBL_CMPY_CD     = DTL.GLBL_CMPY_CD     (+) 
        AND ADC.DS_CONTR_PK      = DTL.DS_CONTR_PK      (+)
        AND ADC.DS_CONTR_DTL_PK  = DTL.DS_CONTR_DTL_PK  (+)
        AND DTL.EZCANCELFLAG (+) = '0' 
        AND DTL.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD     (+) 
        AND DTL.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK (+)
        AND SMM.EZCANCELFLAG (+) = '0'
    </statement>

    <statement id="getSerNum" parameterClass="Map" resultClass="Map">
        SELECT
            DTL.DS_CONTR_DTL_PK
           ,SMM.SER_NUM
           ,DTL.CONTR_EFF_FROM_DT   AS   EFF_FROM_DT
           ,DTL.CONTR_EFF_THRU_DT   AS   EFF_THRU_DT
        FROM
             DS_CONTR_DTL        DTL
            ,DS_CONTR_DTL_STS_V  DSV
            ,SVC_MACH_MSTR       SMM
        WHERE
            DTL.GLBL_CMPY_CD         = #glblCmpyCd#
        AND DTL.DS_CONTR_PK          = #dsContrPk#
        <isNotNull property="dsContrDtlPk">
        AND DTL.DS_CONTR_DTL_PK      = #dsContrDtlPk#
        </isNotNull>
        AND DTL.EZCANCELFLAG         = '0'
        AND DTL.GLBL_CMPY_CD         = DSV.GLBL_CMPY_CD
        AND DTL.DS_CONTR_DTL_PK      = DSV.DS_CONTR_DTL_PK
        AND DSV.CONTR_MACH_AVAL_FLG  = 'Y'
        AND DSV.EZCANCELFLAG         = '0'
        AND DTL.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD
        AND DTL.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK
        AND SMM.EZCANCELFLAG         = '0'
        ORDER BY
             SMM.SVC_CONFIG_MSTR_PK
            ,SMM.SVC_MACH_TP_CD
            ,DTL.DS_CONTR_DTL_PK
    </statement>

    <statement id="getDefaultBllgCycle" parameterClass="Map" resultMap="result.getDefaultBllgCycle">
        <!-- START 2017/12/26 K.Kojima [QC#18562,MOD] -->
        <!-- SELECT -->
        <!--      DTL.BASE_BLLG_CYCLE_CD -->
        <!--    , BLC.BLLG_CYCLE_SORT_NUM -->
        <!--  FROM -->
        <!--      BLLG_CYCLE   BLC -->
        <!--    , DS_CONTR_DTL DTL  -->
        <!--  WHERE -->
        <!--      BLC.BLLG_CYCLE_CD        = DTL.BASE_BLLG_CYCLE_CD -->
        <!--  AND DTL.DS_CONTR_PK          = #dsContrPk#  -->
        <!--  <isNotNull property="dsContrDtlPk"> -->
        <!--  AND DTL.DS_CONTR_DTL_PK      = #dsContrDtlPk# -->
        <!--  </isNotNull> -->
        <!--  AND BLC.GLBL_CMPY_CD         = #glblCmpyCd#  -->
        <!--  AND BLC.GLBL_CMPY_CD         = DTL.GLBL_CMPY_CD  -->
        <!--  AND BLC.EZCANCELFLAG         = '0' -->
        <!--  AND DTL.EZCANCELFLAG         = '0' -->
        <!--  ORDER BY   -->
        <!--      BLC.BLLG_CYCLE_SORT_NUM ASC -->
        SELECT
             DTL.BASE_BLLG_CYCLE_CD
            ,BLC.BLLG_CYCLE_SORT_NUM
        FROM
             DS_CONTR_DTL    DTL
            ,DS_CONTR_DTL_TP DCDT
            ,BLLG_CYCLE      BLC
            ,SVC_MACH_MSTR   SMM
            ,DS_CONTR_DTL    DTLP
            ,SVC_MACH_MSTR   SMMP
        WHERE
                DTL.GLBL_CMPY_CD         = 'ADB'
            AND DTL.DS_CONTR_PK          = #dsContrPk# 
            <isNotNull property="dsContrDtlPk">
            AND DTL.DS_CONTR_DTL_PK      = #dsContrDtlPk#
            </isNotNull>
            AND DTL.EZCANCELFLAG         = '0'
            AND DTL.GLBL_CMPY_CD         = DCDT.GLBL_CMPY_CD
            AND DTL.DS_CONTR_DTL_TP_CD   = DCDT.DS_CONTR_DTL_TP_CD
            AND DCDT.EZCANCELFLAG        = '0'
            AND DTL.GLBL_CMPY_CD         = BLC.GLBL_CMPY_CD
            AND DTL.BASE_BLLG_CYCLE_CD   = BLC.BLLG_CYCLE_CD
            AND BLC.EZCANCELFLAG         = '0'
            AND DTL.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD(+)
            AND DTL.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK(+)
            AND SMM.EZCANCELFLAG(+)      = '0'
            AND DTL.GLBL_CMPY_CD         = DTLP.GLBL_CMPY_CD(+)
            AND DTL.PRNT_DS_CONTR_DTL_PK = DTLP.DS_CONTR_DTL_PK(+)
            AND DTLP.EZCANCELFLAG(+)     = '0'
            AND DTLP.GLBL_CMPY_CD        = SMMP.GLBL_CMPY_CD(+)
            AND DTLP.SVC_MACH_MSTR_PK    = SMMP.SVC_MACH_MSTR_PK(+)
            AND SMMP.EZCANCELFLAG(+)     = '0'
        ORDER BY
             NVL(SMMP.SER_NUM, SMM.SER_NUM)
            ,NVL(SMMP.MDSE_CD, SMM.MDSE_CD)
            ,DCDT.DS_CONTR_DTL_TP_SORT_NUM
            ,DTL.DS_CONTR_DTL_PK
        <!-- END 2017/12/26 K.Kojima [QC#18562,MOD] -->
    </statement>
    <resultMap id="result.getDefaultBllgCycle" class="NSAL0410CMsg">
        <result property="bllgCycleCd_DF"       column="BASE_BLLG_CYCLE_CD"        javaType="EZDSStringItem"/>
        <result property="bllgCycleSortNum_DF"  column="BLLG_CYCLE_SORT_NUM"       javaType="EZDSBigDecimalItem"/>
    </resultMap>

    <statement id="getDsContrAddlChrg" parameterClass="Map" resultMap="result.getDsContrAddlChrg">
        SELECT
            ADC.DS_CONTR_PK
          , ADC.DS_CONTR_DTL_PK
          , ADC.DS_CONTR_ADDL_CHRG_PK
          , CTR.DS_CONTR_NUM
          , CASE
              WHEN DTL.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCd#
              THEN DCC.DS_CONTR_CATG_ABBR_NM
                   || '_'
                   || CTR.DS_CONTR_NUM
              ELSE SMM.SER_NUM
              END                AS SER_NUM
          , ADC.ADDL_CHRG_TP_CD
          , ADC.EFF_FROM_DT
          , ADC.EFF_THRU_DT
          , ADC.TRMN_DT
          , ADC.BLLG_CYCLE_CD
          , ADC.SVC_BILL_BY_TP_CD
          , ADC.ADDL_CHRG_FLAT_DEAL_PRC_AMT
          , ADC.ADDL_CHRG_APLC_PCT
          , ADC.ADDL_CHRG_INV_TP_CD
          , ADC.PRINT_DTL_FLG
          , ADC.ADDL_CHRG_INVD_FLG
          , ACT.INTG_MDSE_CD
          , MT1.TERM_COND_OPT_VAL_TXT
          <!-- START 2019/02/01 K.Kitachi [QC#29949, ADD] -->
          , DTL.SVC_MACH_MSTR_PK
          , MDS.MDSE_DESC_SHORT_TXT
          <!-- END 2019/02/01 K.Kitachi [QC#29949, ADD] -->
          , ADC.EZUPTIME
          , ADC.EZUPTIMEZONE
<!-- START 2016/12/05 [QC#14204, ADD] -->
          , ADC.EZINTIME        AS XX_REC_HIST_CRAT_TS
          , ADC.EZINUSERID      AS XX_REC_HIST_CRAT_BY_NM
          , ADC.EZUPTIME        AS XX_REC_HIST_UPD_TS
          , ADC.EZUPUSERID      AS XX_REC_HIST_UPD_BY_NM
          , ADC.EZTABLEID       AS XX_REC_HIST_TBL_NM
<!-- START 2016/12/05 [QC#14204, ADD] -->
        FROM
            DS_CONTR_ADDL_CHRG ADC
          , DS_CONTR           CTR
          , DS_CONTR_DTL       DTL
          , SVC_MACH_MSTR      SMM
          , DS_CONTR_CATG      DCC
          , ADDL_CHRG_TP_V     ACT
          , (
            SELECT
                 MTC.GLBL_CMPY_CD           GLBL_CMPY_CD
                ,MTC.MDSE_CD                MDSE_CD
                ,MTC.TERM_COND_OPT_VAL_TXT  TERM_COND_OPT_VAL_TXT
            FROM
                 MDSE_TERM_COND_OPT MTC
                ,TERM_COND_OPT_TP   TCT
            WHERE
                MTC.GLBL_CMPY_CD         = TCT.GLBL_CMPY_CD
            AND MTC.TERM_COND_OPT_TP_CD  = TCT.TERM_COND_OPT_TP_CD
            AND TCT.RSP_TM_TP_FLG        = 'Y'
            AND TCT.EZCANCELFLAG         = '0'
            AND MTC.EZCANCELFLAG         = '0'
            )  MT1
          <!-- START 2019/02/01 K.Kitachi [QC#29949, ADD] -->
          , MDSE               MDS
          <!-- END 2019/02/01 K.Kitachi [QC#29949, ADD] -->
        WHERE
            ADC.GLBL_CMPY_CD     = #glblCmpyCd# 
        AND ADC.GLBL_CMPY_CD     = CTR.GLBL_CMPY_CD 
        AND ADC.GLBL_CMPY_CD     = DTL.GLBL_CMPY_CD (+)
        AND ADC.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD (+)
        AND ADC.DS_CONTR_PK      = #dsContrPk#
        AND ADC.DS_CONTR_PK      = CTR.DS_CONTR_PK
        AND ADC.DS_CONTR_PK      = DTL.DS_CONTR_PK (+)
        <isNotNull property="dsContrDtlPk">
        AND DTL.DS_CONTR_DTL_PK  = #dsContrDtlPk#
        </isNotNull>
        AND ADC.DS_CONTR_DTL_PK  = DTL.DS_CONTR_DTL_PK (+)
        AND DTL.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK (+)
        AND ADC.EZCANCELFLAG     = '0' 
        AND CTR.EZCANCELFLAG     = '0' 
        AND DTL.EZCANCELFLAG (+) = '0' 
        AND SMM.EZCANCELFLAG (+) = '0'
        AND CTR.GLBL_CMPY_CD     = DCC.GLBL_CMPY_CD
        AND CTR.DS_CONTR_CATG_CD = DCC.DS_CONTR_CATG_CD
        AND DCC.EZCANCELFLAG     = '0'
        AND ADC.GLBL_CMPY_CD     = ACT.GLBL_CMPY_CD (+)
        AND ADC.ADDL_CHRG_TP_CD  = ACT.ADDL_CHRG_TP_CD(+)
        AND ACT.EZCANCELFLAG (+) = '0'
        AND ACT.GLBL_CMPY_CD     = MT1.GLBL_CMPY_CD (+)
        AND ACT.INTG_MDSE_CD     = MT1.MDSE_CD (+)
        <!-- START 2019/02/01 K.Kitachi [QC#29949, ADD] -->
        AND DTL.GLBL_CMPY_CD     = MDS.GLBL_CMPY_CD (+)
        AND DTL.SVC_PGM_MDSE_CD  = MDS.MDSE_CD (+)
        AND MDS.EZCANCELFLAG (+) = '0' 
        <!-- END 2019/02/01 K.Kitachi [QC#29949, ADD] -->
        ORDER BY
            ADC.DS_CONTR_DTL_PK ASC NULLS FIRST
          , ADC.ADDL_CHRG_TP_CD ASC
          , NVL(ADC.TRMN_DT, ADC.EFF_THRU_DT) ASC
          , ADC.DS_CONTR_ADDL_CHRG_PK ASC
    </statement>
    <resultMap id="result.getDsContrAddlChrg" class="NSAL0410_ACMsg">
        <result property="dsContrAddlChrgPk_A"       column="DS_CONTR_ADDL_CHRG_PK"         javaType="EZDSBigDecimalItem"/>
        <result property="dsContrPk_A"               column="DS_CONTR_PK"                   javaType="EZDSBigDecimalItem"/>
        <result property="dsContrDtlPk_A"            column="DS_CONTR_DTL_PK"               javaType="EZDSBigDecimalItem"/>
        <result property="dsContrNum_A"              column="DS_CONTR_NUM"                  javaType="EZDSStringItem"/>
        <result property="xxScrItem34Txt_A"          column="SER_NUM"                       javaType="EZDSStringItem"/> 
        <result property="addlChrgTpCd_SE"           column="ADDL_CHRG_TP_CD"               javaType="EZDSStringItem"/> 
        <result property="effFromDt_A"               column="EFF_FROM_DT"                   javaType="EZDSDateItem"/>
        <result property="effThruDt_A"               column="EFF_THRU_DT"                   javaType="EZDSDateItem"/>
        <result property="trmnDt_A"                  column="TRMN_DT"                       javaType="EZDSDateItem"/>
        <result property="bllgCycleCd_SE"            column="BLLG_CYCLE_CD"                 javaType="EZDSStringItem"/>
        <result property="svcBillByTpCd_SE"          column="SVC_BILL_BY_TP_CD"             javaType="EZDSStringItem"/>
        <result property="addlChrgFlatDealPrcAmt_A"  column="ADDL_CHRG_FLAT_DEAL_PRC_AMT"   javaType="EZDSBigDecimalItem"/>
        <result property="addlChrgAplcPct_A"         column="ADDL_CHRG_APLC_PCT"            javaType="EZDSBigDecimalItem"/>
        <result property="addlChrgInvTpCd_SE"        column="ADDL_CHRG_INV_TP_CD"           javaType="EZDSStringItem"/>
        <result property="printDtlFlg_A"             column="PRINT_DTL_FLG"                 javaType="EZDSStringItem"/>
        <result property="intgMdseCd_A"              column="INTG_MDSE_CD"                  javaType="EZDSStringItem"/>
        <result property="termCondOptValTxt_A"       column="TERM_COND_OPT_VAL_TXT"         javaType="EZDSStringItem"/>
        <result property="addlChrgInvdFlg_A"         column="ADDL_CHRG_INVD_FLG"            javaType="EZDSStringItem"/>
        <!-- START 2019/02/01 K.Kitachi [QC#29949, ADD] -->
        <result property="svcMachMstrPk_A"           column="SVC_MACH_MSTR_PK"              javaType="EZDCBigDecimalItem"/>
        <result property="mdseDescShortTxt_A"        column="MDSE_DESC_SHORT_TXT"           javaType="EZDCStringItem"/>
        <!-- END 2019/02/01 K.Kitachi [QC#29949, ADD] -->
        <result property="ezUpTime_A"                column="EZUPTIME"                      javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_A"            column="EZUPTIMEZONE"                  javaType="EZDSStringItem"/>
<!-- START 2016/12/05 [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_A"         column="XX_REC_HIST_CRAT_TS"           javaType="EZDCStringItem"/>
        <result property="xxRecHistCratByNm_A"       column="XX_REC_HIST_CRAT_BY_NM"        javaType="EZDCStringItem"/>
        <result property="xxRecHistUpdTs_A"          column="XX_REC_HIST_UPD_TS"            javaType="EZDCStringItem"/>
        <result property="xxRecHistUpdByNm_A"        column="XX_REC_HIST_UPD_BY_NM"         javaType="EZDCStringItem"/>
        <result property="xxRecHistTblNm_A"          column="XX_REC_HIST_TBL_NM"            javaType="EZDCStringItem"/>
<!-- END 2016/12/05 [QC#14204, ADD] -->
    </resultMap>

    <statement id="getBaseLeaseCmpyCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS LEASE_CMPY_CNT
        FROM
             DS_CONTR         A
            ,DS_CONTR_DTL     B
            ,BILL_TO_CUST     C
            ,SELL_TO_CUST     E
            ,DS_ACCT_CLS      F
        WHERE
            A.GLBL_CMPY_CD         = #glblCmpyCd#
        AND A.DS_CONTR_PK          = #dsContrPk#
        AND A.EZCANCELFLAG         = '0'
        AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD
        AND A.DS_CONTR_PK          = B.DS_CONTR_PK
        <isNotNull property="dsContrDtlPk">
        AND B.DS_CONTR_DTL_PK      = #dsContrDtlPk#
        </isNotNull>
        AND B.EZCANCELFLAG         = '0'
        AND B.GLBL_CMPY_CD         = C.GLBL_CMPY_CD
        AND B.BASE_BILL_TO_CUST_CD = C.BILL_TO_CUST_CD
        AND C.EZCANCELFLAG         = '0'
        AND C.GLBL_CMPY_CD         = E.GLBL_CMPY_CD
        AND C.SELL_TO_CUST_CD      = E.SELL_TO_CUST_CD
        AND E.EZCANCELFLAG         = '0'
        AND E.GLBL_CMPY_CD         = F.GLBL_CMPY_CD
        AND E.DS_ACCT_CLS_CD       = F.DS_ACCT_CLS_CD
        AND F.LEASE_CMPY_FLG       = 'Y'
        AND F.EZCANCELFLAG         = '0'

    </statement>

    <statement id="getUsageLeaseCmpyCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) LEASE_CMPY_CNT
        FROM
             DS_CONTR          A
            ,DS_CONTR_DTL      B
            ,DS_CONTR_BLLG_MTR C
            ,BILL_TO_CUST      D
            ,SELL_TO_CUST      F
            ,DS_ACCT_CLS       G
        WHERE
            A.GLBL_CMPY_CD             = #glblCmpyCd#
        AND A.DS_CONTR_PK              = #dsContrPk#
        AND A.EZCANCELFLAG             = '0'
        AND A.GLBL_CMPY_CD             = B.GLBL_CMPY_CD
        AND A.DS_CONTR_PK              = B.DS_CONTR_PK
        <isNotNull property="dsContrDtlPk">
        AND B.DS_CONTR_DTL_PK          = #dsContrDtlPk#
        </isNotNull>
        AND B.EZCANCELFLAG             = '0'
        AND B.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
        AND B.DS_CONTR_DTL_PK          = C.DS_CONTR_DTL_PK
        AND C.EZCANCELFLAG             = '0'
        AND C.GLBL_CMPY_CD             = D.GLBL_CMPY_CD
        AND C.BLLG_MTR_BILL_TO_CUST_CD = D.BILL_TO_CUST_CD
        AND D.EZCANCELFLAG             = '0'
        AND D.GLBL_CMPY_CD             = F.GLBL_CMPY_CD
        AND D.SELL_TO_CUST_CD          = F.SELL_TO_CUST_CD
        AND F.EZCANCELFLAG             = '0'
        AND F.GLBL_CMPY_CD             = G.GLBL_CMPY_CD
        AND F.DS_ACCT_CLS_CD           = G.DS_ACCT_CLS_CD
        AND G.LEASE_CMPY_FLG           = 'Y'
        AND G.EZCANCELFLAG             = '0'

    </statement>

    <statement id="getAddlChrgInv" parameterClass="Map" resultMap="result.getAddlChrgInv">
        SELECT
             Z.BLLG_PER_FROM_DT
            ,Z.BLLG_PER_THRU_DT
            ,Z.CUST_ISS_PO_DT
            ,Z.SER_NUM
            ,Z.ADDL_CHRG_TP_DESC_TXT
            ,Z.SVC_BILL_BY_TP_DESC_TXT
            ,Z.XX_SCR_ITEM_50_TXT
            ,Z.ADDL_CHRG_APLC_PCT
            ,Z.ADDL_CHRG_FLAT_DEAL_PRC_AMT
            ,Z.ADDL_CHRG_INV_TP_DESC_TXT
            ,Z.PRINT_DTL_FLG
            ,Z.INV_LINE_DEAL_NET_AMT
        FROM
            (
                SELECT
                     A.BLLG_PER_FROM_DT             AS BLLG_PER_FROM_DT
                    ,A.BLLG_PER_THRU_DT             AS BLLG_PER_THRU_DT
                    <!-- START 2017/08/02 K.Kojima [QC#19766, ADD] -->
                    <!-- ,A.CUST_ISS_PO_DT               AS CUST_ISS_PO_DT -->
                    ,L.INV_DT                       AS CUST_ISS_PO_DT
                    <!-- END 2017/08/02 K.Kojima [QC#19766, ADD] -->
                    ,D.SER_NUM                      AS SER_NUM
                    ,E.ADDL_CHRG_TP_DESC_TXT        AS ADDL_CHRG_TP_DESC_TXT
                    ,F.SVC_BILL_BY_TP_DESC_TXT      AS SVC_BILL_BY_TP_DESC_TXT
                    ,CASE B.SVC_BILL_BY_TP_CD WHEN #svcBillByTpCd#
                        THEN K.MTR_LB_NM
                        ELSE H.SVC_PGM_MDSE_NM
                     END                            AS XX_SCR_ITEM_50_TXT
                    ,B.ADDL_CHRG_APLC_PCT           AS ADDL_CHRG_APLC_PCT
                    ,B.ADDL_CHRG_FLAT_DEAL_PRC_AMT  AS ADDL_CHRG_FLAT_DEAL_PRC_AMT
                    ,G.ADDL_CHRG_INV_TP_DESC_TXT    AS ADDL_CHRG_INV_TP_DESC_TXT
                    ,B.PRINT_DTL_FLG                AS PRINT_DTL_FLG
                    <!-- START 2018/05/18 T.Wada [QC#26126, ADD] -->
                    ,A.INV_LINE_DEAL_NET_AMT
                    <!-- END   2018/05/18 T.Wada [QC#26126, ADD] -->
                FROM
                     SVC_INV_LINE             A
                    ,SVC_INV_LINE_ADDL_CHRG   B
                    ,DS_CONTR_DTL             C
                    ,SVC_MACH_MSTR            D
                    ,ADDL_CHRG_TP_V           E
                    ,SVC_BILL_BY_TP           F
                    ,ADDL_CHRG_INV_TP         G
                    ,SVC_INV_LINE             H
                    ,SVC_INV_LINE_MTR         I
                    ,DS_CONTR_BLLG_MTR        J
                    ,MTR_LB                   K
                    <!-- START 2017/08/02 K.Kojima [QC#19766, ADD] -->
                    ,SVC_INV                  L
                    <!-- END 2017/08/02 K.Kojima [QC#19766, ADD] -->
                WHERE
                        A.GLBL_CMPY_CD           = #glblCmpyCd#
                    AND A.DS_CONTR_PK            = #dsContrPk#
                    <isNotNull property="dsContrDtlPk">
                    AND A.DS_CONTR_DTL_PK        = #dsContrDtlPk#
                    </isNotNull>
                    AND A.SVC_INV_CHRG_TP_CD     = #svcInvChrgTpCd#
                    AND A.EZCANCELFLAG           = '0'
                    AND A.GLBL_CMPY_CD           = B.GLBL_CMPY_CD
                    AND A.SVC_INV_LINE_PK        = B.SVC_INV_LINE_PK
                    AND B.EZCANCELFLAG           = '0'
                    AND A.GLBL_CMPY_CD           = C.GLBL_CMPY_CD      (+)
                    AND A.DS_CONTR_DTL_PK        = C.DS_CONTR_DTL_PK   (+)
                    AND C.EZCANCELFLAG       (+) = '0'
                    AND C.GLBL_CMPY_CD           = D.GLBL_CMPY_CD      (+)
                    AND C.SVC_MACH_MSTR_PK       = D.SVC_MACH_MSTR_PK  (+)
                    AND D.EZCANCELFLAG       (+) = '0'
                    AND B.GLBL_CMPY_CD           = E.GLBL_CMPY_CD
                    AND B.ADDL_CHRG_TP_CD        = E.ADDL_CHRG_TP_CD
                    AND E.EZCANCELFLAG           = '0'
                    AND B.GLBL_CMPY_CD           = F.GLBL_CMPY_CD
                    AND B.SVC_BILL_BY_TP_CD      = F.SVC_BILL_BY_TP_CD
                    AND F.EZCANCELFLAG           = '0'
                    AND B.GLBL_CMPY_CD           = G.GLBL_CMPY_CD
                    AND B.ADDL_CHRG_INV_TP_CD    = G.ADDL_CHRG_INV_TP_CD
                    AND G.EZCANCELFLAG           = '0'
                    AND A.GLBL_CMPY_CD           = H.GLBL_CMPY_CD         (+)
                    AND A.PRNT_SVC_INV_LINE_PK   = H.SVC_INV_LINE_PK      (+)
                    AND H.EZCANCELFLAG       (+) = '0'
                    AND H.GLBL_CMPY_CD           = I.GLBL_CMPY_CD         (+)
                    AND H.SVC_INV_LINE_PK        = I.SVC_INV_LINE_PK      (+)
                    AND I.EZCANCELFLAG       (+) = '0'
                    AND I.GLBL_CMPY_CD           = J.GLBL_CMPY_CD         (+)
                    AND I.DS_CONTR_BLLG_MTR_PK   = J.DS_CONTR_BLLG_MTR_PK (+)
                    AND J.EZCANCELFLAG       (+) = '0'
                    AND J.GLBL_CMPY_CD           = K.GLBL_CMPY_CD         (+)
                    AND J.BLLG_MTR_LB_CD         = K.MTR_LB_CD            (+)
                    AND K.EZCANCELFLAG       (+) = '0'
                    <!-- START 2017/08/02 K.Kojima [QC#19766, ADD] -->
                    AND A.GLBL_CMPY_CD           = L.GLBL_CMPY_CD
                    AND A.SVC_INV_NUM            = L.SVC_INV_NUM
                    AND L.EZCANCELFLAG           = '0'
                    <!-- END 2017/08/02 K.Kojima [QC#19766, ADD] -->
                ORDER BY
                     BLLG_PER_FROM_DT DESC
                    ,BLLG_PER_THRU_DT DESC
            ) Z
        WHERE
            ROWNUM &lt;= #rowNum#

    </statement>
    <resultMap id="result.getAddlChrgInv" class="NSAL0410_BCMsg">
        <result property="bllgPerFromDt_B"           column="BLLG_PER_FROM_DT"             javaType="EZDCDateItem"/>
        <result property="bllgPerThruDt_B"           column="BLLG_PER_THRU_DT"             javaType="EZDCDateItem"/>
        <result property="custIssPoDt_B"             column="CUST_ISS_PO_DT"               javaType="EZDCDateItem"/>
        <result property="xxScrItem34Txt_B"          column="SER_NUM"                      javaType="EZDCStringItem"/>
        <result property="addlChrgTpDescTxt_B"       column="ADDL_CHRG_TP_DESC_TXT"        javaType="EZDCStringItem"/>
        <result property="svcBillByTpDescTxt_B"      column="SVC_BILL_BY_TP_DESC_TXT"      javaType="EZDCStringItem"/>
        <result property="xxScrItem50Txt_B"          column="XX_SCR_ITEM_50_TXT"           javaType="EZDCStringItem"/>
        <result property="addlChrgAplcPct_B"         column="ADDL_CHRG_APLC_PCT"           javaType="EZDCBigDecimalItem"/>
        <result property="addlChrgFlatDealPrcAmt_B"  column="ADDL_CHRG_FLAT_DEAL_PRC_AMT"  javaType="EZDCBigDecimalItem"/>
        <result property="invLineDealNetAmt_B"       column="INV_LINE_DEAL_NET_AMT"        javaType="EZDCBigDecimalItem"/>
        <result property="addlChrgInvTpDescTxt_B"    column="ADDL_CHRG_INV_TP_DESC_TXT"    javaType="EZDCStringItem"/>
        <result property="printDtlFlg_B"             column="PRINT_DTL_FLG"                javaType="EZDCStringItem"/>
    </resultMap>

    <statement id="getMachSvcBillByTp" parameterClass="Map" resultClass="Map">
        SELECT
             A.SVC_BILL_BY_TP_CD         AS SVC_BILL_BY_TP_CD
            ,A.SVC_BILL_BY_TP_DESC_TXT   AS SVC_BILL_BY_TP_DESC_TXT
        FROM
            SVC_BILL_BY_TP A
        WHERE
                A.GLBL_CMPY_CD      =  #glblCmpyCd#
            AND A.EZCANCELFLAG      =  '0'
            AND A.SVC_BILL_BY_TP_CD != #svcBillByTpCd#
        ORDER BY
            A.SVC_BILL_BY_TP_SORT_NUM

    </statement>

    <statement id="getFleetLine" parameterClass="Map" resultClass="Map">
        SELECT
            DTL.DS_CONTR_DTL_PK
           ,DTL.CONTR_EFF_FROM_DT   AS   EFF_FROM_DT
           ,DTL.CONTR_EFF_THRU_DT   AS   EFF_THRU_DT
        FROM
             DS_CONTR_DTL        DTL
            ,DS_CONTR_DTL_STS_V  DSV
        WHERE
            DTL.GLBL_CMPY_CD         = #glblCmpyCd#
        AND DTL.DS_CONTR_PK          = #dsContrPk#
        AND DTL.DS_CONTR_DTL_TP_CD   = #dsContrDtlTpCd#
        AND DTL.EZCANCELFLAG         = '0'
        AND DTL.GLBL_CMPY_CD         = DSV.GLBL_CMPY_CD
        AND DTL.DS_CONTR_DTL_PK      = DSV.DS_CONTR_DTL_PK
        AND DSV.CONTR_MACH_AVAL_FLG  = 'Y'
        AND DSV.EZCANCELFLAG         = '0'
        ORDER BY
            DTL.DS_CONTR_DTL_PK
    </statement>

    <statement id="getSlaTime" parameterClass="Map" resultClass="Map">
        SELECT
            ACT.INTG_MDSE_CD
          , MT1.TERM_COND_OPT_VAL_TXT
        FROM
            ADDL_CHRG_TP_V     ACT
          , (
            SELECT
                 MTC.GLBL_CMPY_CD           GLBL_CMPY_CD
                ,MTC.MDSE_CD                MDSE_CD
                ,MTC.TERM_COND_OPT_VAL_TXT  TERM_COND_OPT_VAL_TXT
            FROM
                 MDSE_TERM_COND_OPT MTC
                ,TERM_COND_OPT_TP   TCT
            WHERE
                MTC.GLBL_CMPY_CD         = TCT.GLBL_CMPY_CD
            AND MTC.TERM_COND_OPT_TP_CD  = TCT.TERM_COND_OPT_TP_CD
            AND TCT.RSP_TM_TP_FLG        = 'Y'
            AND TCT.EZCANCELFLAG         = '0'
            AND MTC.EZCANCELFLAG         = '0'
            )                  MT1
        WHERE
            ACT.GLBL_CMPY_CD     = #glblCmpyCd# 
        AND ACT.ADDL_CHRG_TP_CD  = #addlChrgTpCd# 
        AND ACT.EZCANCELFLAG     = '0'
        AND ACT.GLBL_CMPY_CD     = MT1.GLBL_CMPY_CD (+)
        AND ACT.INTG_MDSE_CD     = MT1.MDSE_CD (+)
        AND ROWNUM = 1
    </statement>
    <statement id="getAddlChrgTpV" parameterClass="Map" resultClass="Map">
        SELECT
             ADDL_CHRG_TP_CD
            ,ADDL_CHRG_TP_DESC_TXT
        FROM
            ADDL_CHRG_TP_V
        A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
        ORDER BY
             ADDL_CHRG_TP_DESC_TXT
    </statement>
    <!-- START 2017/12/26 K.Kojima [QC#18562,MOD] -->
    <statement id="getBllgCycleForBase" parameterClass="Map" resultMap="String">
        SELECT
             DTL.BASE_BLLG_CYCLE_CD
        FROM
             DS_CONTR_DTL    DTL
            ,DS_CONTR_DTL_TP DCDT
            ,SVC_MACH_MSTR   SMM
            ,DS_CONTR_DTL    DTLP
            ,SVC_MACH_MSTR   SMMP
        WHERE
                DTL.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DTL.DS_CONTR_PK          = #dsContrPk# 
            <isNotNull property="dsContrDtlPk">
            AND DTL.DS_CONTR_DTL_PK      = #dsContrDtlPk#
            </isNotNull>
            AND DTL.BASE_BLLG_CYCLE_CD   IS NOT NULL
            AND DTL.EZCANCELFLAG         = '0'
            AND DTL.GLBL_CMPY_CD         = DCDT.GLBL_CMPY_CD
            AND DTL.DS_CONTR_DTL_TP_CD   = DCDT.DS_CONTR_DTL_TP_CD
            AND DCDT.EZCANCELFLAG        = '0'
            AND DTL.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD(+)
            AND DTL.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK(+)
            AND SMM.EZCANCELFLAG(+)      = '0'
            AND DTL.GLBL_CMPY_CD         = DTLP.GLBL_CMPY_CD(+)
            AND DTL.PRNT_DS_CONTR_DTL_PK = DTLP.DS_CONTR_DTL_PK(+)
            AND DTLP.EZCANCELFLAG(+)     = '0'
            AND DTLP.GLBL_CMPY_CD        = SMMP.GLBL_CMPY_CD(+)
            AND DTLP.SVC_MACH_MSTR_PK    = SMMP.SVC_MACH_MSTR_PK(+)
            AND SMMP.EZCANCELFLAG(+)     = '0'
        ORDER BY
             NVL(SMMP.SER_NUM, SMM.SER_NUM)
            ,NVL(SMMP.MDSE_CD, SMM.MDSE_CD)
            ,DCDT.DS_CONTR_DTL_TP_SORT_NUM
            ,DTL.DS_CONTR_DTL_PK
    </statement>
    <statement id="getBllgCycleForUsage" parameterClass="Map" resultMap="String">
        SELECT
             DCBM.BLLG_MTR_BLLG_CYCLE_CD
        FROM
             DS_CONTR_DTL      DTL
            ,DS_CONTR_BLLG_MTR DCBM
            ,DS_CONTR_DTL_TP   DCDT
            ,SVC_MACH_MSTR     SMM
            ,DS_CONTR_DTL      DTLP
            ,SVC_MACH_MSTR     SMMP
            ,MTR_LB            ML
        WHERE
                DTL.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DTL.DS_CONTR_PK          = #dsContrPk# 
            <isNotNull property="dsContrDtlPk">
            AND DTL.DS_CONTR_DTL_PK      = #dsContrDtlPk#
            </isNotNull>
            AND DTL.EZCANCELFLAG         = '0'
            AND DTL.GLBL_CMPY_CD         = DCBM.GLBL_CMPY_CD
            AND DTL.DS_CONTR_DTL_PK      = DCBM.DS_CONTR_DTL_PK
            AND DCBM.BLLG_MTR_BLLG_CYCLE_CD IS NOT NULL
            AND DCBM.EZCANCELFLAG        = '0'
            AND DTL.GLBL_CMPY_CD         = DCDT.GLBL_CMPY_CD
            AND DTL.DS_CONTR_DTL_TP_CD   = DCDT.DS_CONTR_DTL_TP_CD
            AND DCDT.EZCANCELFLAG        = '0'
            AND DTL.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD(+)
            AND DTL.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK(+)
            AND SMM.EZCANCELFLAG(+)      = '0'
            AND DTL.GLBL_CMPY_CD         = DTLP.GLBL_CMPY_CD(+)
            AND DTL.PRNT_DS_CONTR_DTL_PK = DTLP.DS_CONTR_DTL_PK(+)
            AND DTLP.EZCANCELFLAG(+)     = '0'
            AND DTLP.GLBL_CMPY_CD        = SMMP.GLBL_CMPY_CD(+)
            AND DTLP.SVC_MACH_MSTR_PK    = SMMP.SVC_MACH_MSTR_PK(+)
            AND SMMP.EZCANCELFLAG(+)     = '0'
            AND DCBM.GLBL_CMPY_CD        = ML.GLBL_CMPY_CD
            AND DCBM.BLLG_MTR_LB_CD      = ML.MTR_LB_CD
            AND ML.EZCANCELFLAG          = '0'
        ORDER BY
             NVL(SMMP.SER_NUM, SMM.SER_NUM)
            ,NVL(SMMP.MDSE_CD, SMM.MDSE_CD)
            ,DCDT.DS_CONTR_DTL_TP_SORT_NUM
            ,DTL.DS_CONTR_DTL_PK
            ,ML.MTR_LB_SORT_NUM
    </statement>
    <!-- END 2017/12/26 K.Kojima [QC#18562,MOD] -->
    <!-- START 2018/05/24 K.Kitachi [QC#26223, ADD] -->
    <statement id="countInvSchd" parameterClass="Map" resultMap="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             DS_CONTR_DTL       A
            ,DS_CONTR_BLLG_SCHD B
        WHERE
                A.GLBL_CMPY_CD    = #glblCmpyCd#
            AND A.DS_CONTR_PK     = #dsContrPk#
            <isNotNull property="dsContrDtlPk">
            AND A.DS_CONTR_DTL_PK = #dsContrDtlPk#
            </isNotNull>
            AND A.EZCANCELFLAG    = '0'
            AND A.GLBL_CMPY_CD    = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK = B.DS_CONTR_DTL_PK
            AND B.INV_FLG         = 'Y'
            AND B.EZCANCELFLAG    = '0'
    </statement>
    <!-- END 2018/05/24 K.Kitachi [QC#26223, ADD] -->
</sqlMap>
