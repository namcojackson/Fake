<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPAL0170Query">

    <statement id="getPoMessageList" parameterClass="Map" resultClass="Map">
        SELECT
            EZUPTIME
            , PO_MSG_PK
            , PO_ORD_NUM
            , PO_ORD_DTL_LINE_NUM
            , PRCH_REQ_NUM
            , PRCH_REQ_LINE_NUM
            , PRCH_REQ_LINE_SUB_NUM
            , PO_MSG_TP_CD
            , PO_MSG_SEG_ID
            , PO_MSG_SUBMT_PSN_CD
            , PO_MSG_TXT
            , PO_MSG_TP_DESC_TXT
            <isNotNull property="msg.poOrdDtlLineNum">
            , DISP_PO_DTL_LINE_NUM
            </isNotNull>
        FROM (
            SELECT
                PM.EZUPTIME
                , PM.PO_MSG_PK
                , PM.PO_ORD_NUM
                , PM.PO_ORD_DTL_LINE_NUM
                , PM.PRCH_REQ_NUM
                , PM.PRCH_REQ_LINE_NUM
                , PM.PRCH_REQ_LINE_SUB_NUM
                , PM.PO_MSG_TP_CD
                , PM.PO_MSG_SEG_ID
                , PM.PO_MSG_SUBMT_PSN_CD
                , PM.PO_MSG_TXT
                , PMT.PO_MSG_TP_DESC_TXT
                <isNotNull property="msg.poOrdDtlLineNum">
                , DPD.DISP_PO_DTL_LINE_NUM
                </isNotNull>
            FROM
                PO_MSG PM
                , PO_MSG_TP PMT
                <isNotNull property="msg.poOrdDtlLineNum">
                , DS_PO_DTL DPD
                </isNotNull>
            WHERE
                -- JOIN TO PO_MSG
                PM.GLBL_CMPY_CD = #glblCmpyCd#
                AND PM.EZCANCELFLAG = '0'
                AND PM.PO_MSG_TP_CD = #msg.poMsgTpCd#
                -- JOIN TO PO_MSG_TP
                AND PM.GLBL_CMPY_CD	 = PMT.GLBL_CMPY_CD
                AND PM.PO_MSG_TP_CD	 = PMT.PO_MSG_TP_CD
                AND PMT.EZCANCELFLAG = '0'
                <isNotNull property="msg.poOrdDtlLineNum">
                -- JOIN TO DS_PO_DTL
                AND PM.GLBL_CMPY_CD = DPD.GLBL_CMPY_CD
                AND PM.PO_ORD_NUM = DPD.PO_ORD_NUM
                AND PM.PO_ORD_DTL_LINE_NUM = DPD.PO_ORD_DTL_LINE_NUM
                AND DPD.EZCANCELFLAG = '0'
                </isNotNull>
                <isNotNull property="msg.poOrdNum">
                AND PM.PO_ORD_NUM = #msg.poOrdNum#
                </isNotNull>
                <isNotNull property="msg.poOrdDtlLineNum">
                AND PM.PO_ORD_DTL_LINE_NUM = #msg.poOrdDtlLineNum#
                </isNotNull>
                <isNotNull property="msg.prchReqNum">
                AND PM.PRCH_REQ_NUM = #msg.prchReqNum#
                </isNotNull>
                <isNotNull property="msg.prchReqLineNum">
                AND PM.PRCH_REQ_LINE_NUM = #msg.prchReqLineNum#
                </isNotNull>
                <isNotNull property="msg.prchReqLineSubNum">
                AND PM.PRCH_REQ_LINE_SUB_NUM = #msg.prchReqLineSubNum#
                </isNotNull>
            ORDER BY
                PM.PO_MSG_PK ASC
        )
        WHERE ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getPoMsgDescTxt" parameterClass="Map" resultClass="String">
        SELECT
            PO_MSG_TP_DESC_TXT
        FROM
            PO_MSG_TP
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND PO_MSG_TP_CD = #poMsgTpCd#
        AND EZCANCELFLAG = '0'
    </statement>
</sqlMap>