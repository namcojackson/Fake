<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPAL1410Query">
    <!--Search-->
    <!-- QC#22178 Modify SQL. Outer join SVC_MACH_MSTR -->
    <statement id="search" parameterClass="Map" resultClass="Map">
        SELECT
            RO.RMNF_ORD_NUM
            ,RO.RMNF_ORD_TP_CD
            ,RO.RMNF_ORD_STS_CD
            ,RO.RMNF_MAIN_UNIT_MDSE_CD
            ,RO.RMNF_MAIN_UNIT_SER_NUM
            ,RO.RMNF_MDL_ID
            ,RO.SVC_CONFIG_MSTR_PK
            ,RO.RMNF_RTL_WH_CD
            ,RO.RMNF_RTL_SWH_CD
            ,RO.RMNF_INVTY_LOC_CD
            ,RO.WH_LOCTR_CD
            ,RO.OWNR_TECH_TOC_CD
            ,RO.RMNF_CRAT_DT
            ,RO.RMNF_START_DT
            ,RO.RMNF_END_DT
            ,RO.RMNF_PRT_USG_COST_AMT
            ,RO.RMNF_TOT_LBOR_AOT
            ,RO.RMNF_TOT_LBOR_COST_AMT
            ,RO.RMNF_OTH_COST_AMT
            ,RO.RMNF_MACH_COST_AMT
            ,RO.RMNF_TOT_COST_AMT
            ,RO.RMNF_ORD_CMNT_TXT
            ,RO.RMNF_USG_RTL_WH_CD
            ,RO.RMNF_USG_RTL_SWH_CD
            ,RO.EZUPTIME
            ,RO.EZUPTIMEZONE
            ,RW.RTL_WH_NM
            ,TM.TECH_NM
            ,ROS.RMNF_ORD_STS_NM
            ,MN.T_MDL_NM
            ,OMN.T_MDL_NM O_MDL_NM
            ,RS.INVTY_LOC_CD
            ,ROD.RMNF_ORD_DTL_LINE_NUM
            ,ROD.CMPT_MDSE_CD
            ,ROD.CMPT_SER_NUM
            ,ROD.SRC_RTL_SWH_CD
            ,ROD.SVC_MACH_MSTR_PK
            ,ROD.RMNF_TO_CMPT_MDSE_CD
            ,ROD.RMNF_TO_CMPT_SER_NUM
            ,ROD.RMNF_ORD_LINE_CMNT_TXT
            ,ROD.RMV_CONFIG_FLG
            ,ROD.ADD_CONFIG_FLG
            ,AMV1.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT1
            ,AMV2.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT2
            ,SMM.SVC_MACH_TP_CD
            ,SMM.SVC_MACH_MSTR_LOC_STS_CD
            ,NVL(SMM.STK_STS_CD, ROD.STK_STS_CD) AS STK_STS_CD
            ,SMM.SVC_MACH_QTY
            ,ROS.OPEN_STS_FLG
            ,RO.ORIG_MDL_ID
            ,RWS.RWS_NUM
            ,SO.SO_NUM
        FROM
            RMNF_ORD         RO
            ,RTL_WH          RW
            ,RTL_SWH         RS
            ,TECH_MSTR       TM
            ,MDL_NM          MN
            ,MDL_NM          OMN
            ,RMNF_ORD_DTL    ROD
            ,SVC_MACH_MSTR   SMM
            ,RMNF_ORD_STS    ROS
            ,ALL_MDSE_V      AMV1
            ,ALL_MDSE_V      AMV2
            ,SHPG_ORD        SO
            ,(SELECT
                   H.GLBL_CMPY_CD
                  ,H.RWS_NUM
                  ,D.PO_RCV_TRX_LINE_NUM
                  ,H.SRC_ORD_NUM
              FROM
                   RWS_HDR         H
                  ,RWS_DTL         D
              WHERE
                  H.GLBL_CMPY_CD   = D.GLBL_CMPY_CD
              AND H.RWS_NUM        = D.RWS_NUM
              AND H.SCE_ORD_TP_CD  = #rmnItemChange#
              AND H.EZCANCELFLAG   = '0'
              AND D.EZCANCELFLAG   = '0'
             ) RWS
        WHERE
                RO.GLBL_CMPY_CD          = #glblCmpyCd#
            AND RO.RMNF_ORD_NUM          = #rmnfOrdNum#
            AND RO.GLBL_CMPY_CD          = ROD.GLBL_CMPY_CD
            AND RO.RMNF_ORD_NUM          = ROD.RMNF_ORD_NUM
            AND ROD.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD (+)
            AND ROD.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK (+)
            AND RO.GLBL_CMPY_CD          = ROS.GLBL_CMPY_CD
            AND RO.RMNF_ORD_STS_CD       = ROS.RMNF_ORD_STS_CD
            AND RO.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
            AND RO.RMNF_RTL_WH_CD        = RW.RTL_WH_CD
            AND RO.GLBL_CMPY_CD          = RS.GLBL_CMPY_CD
            AND RO.RMNF_RTL_WH_CD        = RS.RTL_WH_CD
            AND RO.RMNF_RTL_SWH_CD       = RS.RTL_SWH_CD
            AND RO.GLBL_CMPY_CD          = TM.GLBL_CMPY_CD
            AND RO.OWNR_TECH_TOC_CD      = TM.TECH_TOC_CD
            AND RO.GLBL_CMPY_CD          = MN.T_GLBL_CMPY_CD (+)
            AND RO.RMNF_MDL_ID           = MN.T_MDL_ID (+)
            AND RO.GLBL_CMPY_CD          = OMN.T_GLBL_CMPY_CD (+)
            AND RO.ORIG_MDL_ID           = OMN.T_MDL_ID (+)
            AND ROD.GLBL_CMPY_CD         = AMV1.GLBL_CMPY_CD
            AND ROD.CMPT_MDSE_CD         = AMV1.MDSE_CD
            AND ROD.GLBL_CMPY_CD         = AMV2.GLBL_CMPY_CD
            AND ROD.RMNF_TO_CMPT_MDSE_CD = AMV2.MDSE_CD
            AND ROD.GLBL_CMPY_CD          = RWS.GLBL_CMPY_CD(+)
            AND ROD.RMNF_ORD_NUM          = RWS.SRC_ORD_NUM(+)
            AND ROD.RMNF_ORD_DTL_LINE_NUM = RWS.PO_RCV_TRX_LINE_NUM(+)
            AND RO.GLBL_CMPY_CD          = SO.GLBL_CMPY_CD(+)
            AND RO.RMNF_ORD_NUM          = SO.SRC_ORD_NUM(+)
            AND SO.SCE_ORD_TP_CD(+)      = #rmnItemChange#
            AND RO.EZCANCELFLAG          = '0'
            AND RW.EZCANCELFLAG          = '0'
            AND RS.EZCANCELFLAG          = '0'
            AND TM.EZCANCELFLAG          = '0'
            AND MN.EZCANCELFLAG (+)      = '0'
            AND OMN.EZCANCELFLAG (+)     = '0'
            AND ROD.EZCANCELFLAG         = '0'
            AND SMM.EZCANCELFLAG (+)     = '0'
            AND ROS.EZCANCELFLAG         = '0'
            AND AMV1.EZCANCELFLAG        = '0'
            AND AMV2.EZCANCELFLAG        = '0'
            AND SO.EZCANCELFLAG(+)       = '0'
        ORDER BY
            ROD.RMNF_ORD_DTL_LINE_NUM
    </statement>

    <statement id="searchParts" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            RPR.RMNF_PRT_REQ_PK
            ,RPR.MDSE_CD
            ,AMV.MDSE_DESC_SHORT_TXT
            ,RPR.PRT_RQST_QTY
            ,AMV.THIS_MTH_TOT_STD_COST_AMT
            ,INV.INVTY_AVAL_QTY
            ,AMV.RTRN_REQ_PRT_FLG
            ,AMV.ASSET_RECOV_COST_AMT * RPR.PRT_RQST_QTY AS ASSET_RECOV_COST_AMT
            ,DECODE(
                PT2.PROCR_TP_NM, NULL, PT1.PROCR_TP_NM, PT2.PROCR_TP_NM
            ) AS PROCR_TP_NM
            ,RPR.PRCH_REQ_NUM
            ,DECODE(
                PRD.PRCH_REQ_NUM, NULL, RW1.RTL_WH_NM, NVL(RW2.RTL_WH_NM, PVV.DPLY_VND_NM)
            ) AS RTL_WH_NM
            ,NVL(RD1.RWS_STS_CD, RD2.RWS_STS_CD) AS RWS_STS_CD
            ,(
                SELECT
                    SUM(RU.RMNF_PRT_QTY)
                FROM
                    RMNF_USG   RU
                WHERE
                        RU.GLBL_CMPY_CD = RPR.GLBL_CMPY_CD
                    AND RU.RMNF_ORD_NUM = RPR.RMNF_ORD_NUM
                    AND RU.MDSE_CD = RPR.MDSE_CD
                    AND RU.EZCANCELFLAG = '0'
                GROUP BY
                    RU.MDSE_CD) AS RMNF_PRT_QTY
            ,RPR.RMNF_PRT_REQ_LINE_NUM
            ,RPR.RMNF_STD_PRT_FLG
            ,RPR.RMNF_PRT_RQST_PROC_CD
            ,SOD.SO_NUM
        FROM
            RMNF_PRT_REQ            RPR
            ,ALL_MDSE_V             AMV
            ,INVTY                  INV
            ,PROCR_TP               PT1
            ,PROCR_TP               PT2
            ,RTL_WH                 RW1
            ,RTL_WH                 RW2
            ,PO_VND_V               PVV
            ,PRCH_REQ_DTL           PRD
            ,SHPG_ORD_DTL           SOD
            ,RWS_HDR                RWS
            ,RWS_DTL                RD1
            ,RWS_DTL                RD2
        WHERE
                RPR.RMNF_ORD_NUM                = #rmnfOrdNum#
            AND RPR.GLBL_CMPY_CD                = #glblCmpyCd#
            AND RPR.GLBL_CMPY_CD                = AMV.GLBL_CMPY_CD
            AND RPR.MDSE_CD                     = AMV.MDSE_CD
            AND RPR.GLBL_CMPY_CD                = PT1.GLBL_CMPY_CD
            AND RPR.PROCR_TP_CD                 = PT1.PROCR_TP_CD
            AND RPR.GLBL_CMPY_CD                = RW1.GLBL_CMPY_CD
            AND RPR.SRC_RTL_WH_CD               = RW1.RTL_WH_CD
            AND RPR.GLBL_CMPY_CD                = PRD.GLBL_CMPY_CD (+)
            AND RPR.RMNF_ORD_NUM                = PRD.TRX_REF_NUM (+)
            AND RPR.RMNF_PRT_REQ_LINE_NUM       = PRD.TRX_REF_LINE_NUM (+)
            AND PRD.GLBL_CMPY_CD                = RW2.GLBL_CMPY_CD (+)
            AND PRD.SRC_RTL_WH_CD               = RW2.RTL_WH_CD (+)
            AND PRD.GLBL_CMPY_CD                = PVV.GLBL_CMPY_CD (+)
            AND PRD.VND_CD                      = PVV.VND_CD (+)
            AND PRD.GLBL_CMPY_CD                = PT2.GLBL_CMPY_CD (+)
            AND PRD.PROCR_TP_CD                 = PT2.PROCR_TP_CD (+)
            AND RPR.GLBL_CMPY_CD                = INV.GLBL_CMPY_CD (+)
            AND RPR.MDSE_CD                     = INV.MDSE_CD (+)
            AND INV.INVTY_LOC_CD (+)            = #invtyLocCd# || RPR.SRC_RTL_SWH_CD
            AND INV.LOC_STS_CD (+)              = #locStsCd#
            AND INV.STK_STS_CD (+)              = #stkStsCd#
            AND RPR.GLBL_CMPY_CD                = SOD.GLBL_CMPY_CD (+)
            AND RPR.SO_NUM                      = SOD.SO_NUM (+)
            AND RPR.RMNF_PRT_REQ_LINE_NUM       = SOD.TRX_LINE_NUM (+)
            AND SOD.GLBL_CMPY_CD                = RWS.GLBL_CMPY_CD (+)
            AND SOD.SO_NUM                      = RWS.TRX_ORD_NUM (+)
            AND RWS.SCE_ORD_TP_CD (+)           = #sceOrdTpCd#
            AND RWS.GLBL_CMPY_CD                = RD1.GLBL_CMPY_CD (+)
            AND RWS.RWS_NUM                     = RD1.RWS_NUM (+)
            AND SOD.SO_SLP_NUM                  = RD1.TRX_LINE_NUM (+)
            AND PRD.GLBL_CMPY_CD                = RD2.GLBL_CMPY_CD (+)
            AND PRD.PRCH_REQ_NUM                = RD2.PRCH_REQ_NUM (+)
            AND PRD.PRCH_REQ_LINE_NUM           = RD2.PRCH_REQ_LINE_NUM (+)
            AND PRD.PRCH_REQ_LINE_SUB_NUM       = RD2.PRCH_REQ_LINE_SUB_NUM (+)
            AND RD1.GLBL_CMPY_CD                = RD2.GLBL_CMPY_CD (+)
            AND RD1.RWS_NUM                     = RD2.RWS_NUM (+)
            AND RD1.RWS_DTL_LINE_NUM            = RD2.RWS_DTL_LINE_NUM (+)
            AND RPR.EZCANCELFLAG                = '0'
            AND AMV.EZCANCELFLAG                = '0'
            AND PT1.EZCANCELFLAG                = '0'
            AND RW1.EZCANCELFLAG                = '0'
            AND PRD.EZCANCELFLAG (+)            = '0'
            AND RW2.EZCANCELFLAG (+)            = '0'
            AND PVV.EZCANCELFLAG (+)            = '0'
            AND PT2.EZCANCELFLAG (+)            = '0'
            AND INV.EZCANCELFLAG (+)            = '0'
            AND SOD.EZCANCELFLAG (+)            = '0'
            AND RWS.EZCANCELFLAG (+)            = '0'
            AND RD1.EZCANCELFLAG (+)            = '0'
            AND RD2.EZCANCELFLAG (+)            = '0'
        ORDER BY
            RPR.RMNF_STD_PRT_FLG
            ,RPR.RMNF_PRT_REQ_LINE_NUM
    </statement>

    <statement id="searchTask" parameterClass="Map" resultClass="Map">
       SELECT
             R.GLBL_CMPY_CD
            ,R.RMNF_ORD_NUM
            ,R.RMNF_TASK_NUM
            ,R.RMNF_TASK_DESC_TXT
            ,R.RMNF_TASK_START_DT
            ,R.RMNF_TASK_END_DT
            ,R.TECH_TOC_CD
            ,R.TECH_NM
            ,R.RMNF_LBOR_AOT
            ,NVL(R.RMNF_PRT_USG_COST_AMT , 0)                                  AS RMNF_PRT_USG_COST_AMT
            ,NVL(R.RMNF_LBOR_COST_AMT,0)                                       AS RMNF_LBOR_COST_AMT
            ,NVL(R.RMNF_PRT_USG_COST_AMT , 0) + NVL(R.RMNF_LBOR_COST_AMT , 0 ) AS RMNF_TOT_COST_AMT
            ,R.RMNF_TASK_PK
            ,R.EZUPTIME
            ,R.EZUPTIMEZONE
        FROM
        (
            SELECT
                 RT.GLBL_CMPY_CD           AS GLBL_CMPY_CD
                ,RT.RMNF_ORD_NUM           AS RMNF_ORD_NUM
                ,RT.RMNF_TASK_NUM          AS RMNF_TASK_NUM
                ,RT.RMNF_TASK_DESC_TXT     AS RMNF_TASK_DESC_TXT
                ,RT.RMNF_TASK_START_DT     AS RMNF_TASK_START_DT
                ,RT.RMNF_TASK_END_DT       AS RMNF_TASK_END_DT
                ,RT.TECH_TOC_CD            AS TECH_TOC_CD
                ,TM.TECH_NM                AS TECH_NM
                ,RT.RMNF_LBOR_AOT          AS RMNF_LBOR_AOT
                ,(
                        SELECT SUM(RU.RMNF_PRT_USG_COST_AMT)
                    FROM 
                        RMNF_USG RU
                    WHERE 
                            RU.RMNF_TASK_PK = RT.RMNF_TASK_PK
                        AND RU.GLBL_CMPY_CD = RT.GLBL_CMPY_CD
                        AND RU.EZCANCELFLAG = '0'
                )                          AS RMNF_PRT_USG_COST_AMT
                ,RT.RMNF_LBOR_COST_AMT     AS RMNF_LBOR_COST_AMT
                ,RT.RMNF_TASK_PK
                ,RT.EZUPTIME
                ,RT.EZUPTIMEZONE
            FROM
                 RMNF_TASK       RT
                ,TECH_MSTR       TM
            WHERE
                    RT.RMNF_ORD_NUM          = #rmnfOrdNum#
                AND RT.GLBL_CMPY_CD          = #glblCmpyCd#
                AND RT.RMNF_TASK_STS_CD      &lt;&gt; #rmnfTaskStsCd#
                AND RT.GLBL_CMPY_CD          = TM.GLBL_CMPY_CD
                AND RT.TECH_TOC_CD           = TM.TECH_TOC_CD
                AND RT.EZCANCELFLAG          = '0'
                AND TM.EZCANCELFLAG          = '0'
                ORDER BY RT.RMNF_TASK_NUM
        ) R
    </statement>

    <statement id="searchSerial" parameterClass="Map" resultClass="Map">
        SELECT
            SMM.MDSE_CD
            ,SMM.MDSE_CD                   AS CMPT_MDSE_CD
            ,SMM.SVC_MACH_TP_CD
            ,SMM.SVC_CONFIG_MSTR_PK
            ,MN.T_MDL_ID
            ,MN.T_MDL_NM
            ,AMV.MDSE_DESC_SHORT_TXT       AS MDSE_DESC_SHORT_TXT1
            ,AMV.MDSE_DESC_SHORT_TXT       AS MDSE_DESC_SHORT_TXT2
            ,SMM.SER_NUM                   AS CMPT_SER_NUM
            ,SMM.SVC_MACH_MSTR_PK
            ,SMM.SVC_MACH_QTY
            ,SMM.CUR_LOC_NUM
            ,SWH.RTL_WH_CD
            ,SWH.RTL_SWH_CD
            ,SMM.STK_STS_CD
        FROM
            SVC_MACH_MSTR          SMM
            ,SVC_CONFIG_MSTR       SCM
            ,MDL_NM                MN
            ,ALL_MDSE_V            AMV
            ,RTL_SWH               SWH
        WHERE
                SMM.GLBL_CMPY_CD       = #glblCmpyCd#
            AND SMM.SER_NUM            = #serNum#
            <isNotNull property="svcConfigMstrPk" >
            AND SMM.SVC_CONFIG_MSTR_PK = #svcConfigMstrPk#
            </isNotNull>
            <isNotNull property="mdseCd" >
            AND SMM.MDSE_CD            = #mdseCd#
            </isNotNull>
            <isNotNull property="popUpFlg">
            AND SMM.SVC_CONFIG_MSTR_PK IS NULL
            </isNotNull>
            AND SMM.SVC_CONFIG_MSTR_PK = SCM.SVC_CONFIG_MSTR_PK (+)
            AND SMM.GLBL_CMPY_CD       = SCM.GLBL_CMPY_CD (+)
            AND SCM.MDL_ID             = MN.T_MDL_ID (+)
            AND SCM.GLBL_CMPY_CD       = MN.T_GLBL_CMPY_CD (+)
            AND SMM.MDSE_CD            = AMV.MDSE_CD
            AND SMM.GLBL_CMPY_CD       = AMV.GLBL_CMPY_CD
            AND SMM.GLBL_CMPY_CD       = SWH.GLBL_CMPY_CD (+)
            AND SMM.CUR_LOC_NUM        = SWH.INVTY_LOC_CD  (+)
            AND SMM.EZCANCELFLAG       = '0'
            AND SCM.EZCANCELFLAG (+)   = '0'
            AND MN.EZCANCELFLAG (+)    = '0'
            AND AMV.EZCANCELFLAG       = '0'
            AND SWH.EZCANCELFLAG (+)   = '0'
    </statement>

    <statement id="searchConfigration" parameterClass="Map" resultClass="Map">
        SELECT
            SMM.SVC_CONFIG_MSTR_PK
            ,SMM.MDSE_CD                   AS CMPT_MDSE_CD
            ,AMV.MDSE_DESC_SHORT_TXT       AS MDSE_DESC_SHORT_TXT1
            ,AMV.MDSE_DESC_SHORT_TXT       AS MDSE_DESC_SHORT_TXT2
            ,SMM.SVC_MACH_TP_CD
            ,SMM.SER_NUM                   AS CMPT_SER_NUM
            ,SMM.SVC_MACH_MSTR_PK
            ,SMM.SVC_MACH_QTY
            ,SMM.CUR_LOC_NUM
            ,SWH.RTL_WH_CD
            ,SWH.RTL_SWH_CD AS SRC_RTL_SWH_CD
            ,SMM.STK_STS_CD
        FROM
            SVC_MACH_MSTR            SMM
            ,ALL_MDSE_V               AMV
            ,RTL_SWH                  SWH
        WHERE
                SMM.GLBL_CMPY_CD          = #glblCmpyCd#
            AND SMM.SVC_CONFIG_MSTR_PK    = #svcConfigMstrPk#
            <isNotNull property="svcMachMstrPk" >
            AND SMM.SVC_MACH_MSTR_PK = #svcMachMstrPk#
            </isNotNull>
            AND SMM.MDSE_CD                = AMV.MDSE_CD
            AND SMM.GLBL_CMPY_CD           = AMV.GLBL_CMPY_CD
            AND SMM.GLBL_CMPY_CD           = SWH.GLBL_CMPY_CD (+)
            AND SMM.CUR_LOC_NUM            = SWH.INVTY_LOC_CD  (+)
            AND SMM.EZCANCELFLAG           = '0'
            AND AMV.EZCANCELFLAG           = '0'
            AND SWH.EZCANCELFLAG (+)   = '0'
        ORDER BY
            SMM.SVC_MACH_TP_CD
            ,SMM.SVC_MACH_SQ_NUM
    </statement>

    <statement id="searchModel" parameterClass="Map" resultClass="Map">
        SELECT
            MN.T_MDL_ID
            ,MN.T_MDL_NM
        FROM
            DS_MDL_CONFIG    DMC
            ,MDL_NM          MN
        WHERE
                DMC.GLBL_CMPY_CD     = #glblCmpyCd#
            AND DMC.PRNT_MDSE_CD     = #prntMdseCd#
            AND DMC.CHILD_MDSE_CD IS NULL
            AND DMC.MDL_ID           = MN.T_MDL_ID
            AND DMC.GLBL_CMPY_CD     = MN.T_GLBL_CMPY_CD
            AND DMC.EZCANCELFLAG     = '0'
            AND MN.EZCANCELFLAG      = '0'
    </statement>

    <statement id="getSerial" parameterClass="Map" resultClass="Map">
        SELECT
            M.MDSE_CD
            ,M.SVC_MACH_TP_CD
            ,M.SVC_MACH_MSTR_PK
            ,M.STK_STS_CD
            ,C.SVC_CONFIG_MSTR_PK
            ,M.CUR_LOC_NUM
        FROM
            SVC_MACH_MSTR          M
            ,SVC_CONFIG_MSTR       C
        WHERE
                M.GLBL_CMPY_CD       = #glblCmpyCd#
            AND M.SER_NUM            = #serNum#
            AND M.MDSE_CD            = #mdseCd#
            AND M.SVC_CONFIG_MSTR_PK = C.SVC_CONFIG_MSTR_PK (+)
            AND M.GLBL_CMPY_CD       = C.GLBL_CMPY_CD (+)
            AND M.EZCANCELFLAG       = '0'
            AND C.EZCANCELFLAG (+)   = '0'
    </statement>

    <statement id="getOrderType" parameterClass="Map" resultClass="Map">
        SELECT
            T.RMNF_ORD_TP_CD
            ,T.RMNF_ORD_TP_DESC_TXT
        FROM
            RMNF_ORD_TP    T
        WHERE
                T.GLBL_CMPY_CD     = #glblCmpyCd#
            AND T.EZCANCELFLAG     = '0'
        ORDER BY
            T.RMNF_ORD_TP_SORT_NUM
    </statement>

    <statement id="getStarndardParts" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            RMSP.MDSE_CD
            ,AMV.MDSE_DESC_SHORT_TXT
            ,RMSP.RMNF_REQ_QTY AS PRT_RQST_QTY
            ,AMV.THIS_MTH_TOT_STD_COST_AMT
            ,NVL(INV.INVTY_AVAL_QTY, 0) AS INVTY_AVAL_QTY
            ,AMV.RTRN_REQ_PRT_FLG
            ,AMV.ASSET_RECOV_COST_AMT * RMSP.RMNF_REQ_QTY AS ASSET_RECOV_COST_AMT
            ,PT.PROCR_TP_NM
            ,RW2.RTL_WH_NM
        FROM
            RMNF_MDL_STD_PRT    RMSP
            ,ALL_MDSE_V         AMV
            <!-- QC#15846 Start -->
            <!-- ,RTL_WH             RW -->
            <!-- QC#15846 End -->
            ,RTL_WH             RW2
            ,RTL_SWH            RS
            ,INVTY              INV
            ,PROCR_TP           PT
        WHERE
                RMSP.GLBL_CMPY_CD      = #glblCmpyCd#
            AND RMSP.RMNF_MDL_ID       = #rmnfMdlId#
            AND RMSP.GLBL_CMPY_CD      = AMV.GLBL_CMPY_CD
            AND RMSP.MDSE_CD           = AMV.MDSE_CD
            <!-- QC#15846 Start -->
            <!-- AND RW.GLBL_CMPY_CD (+)    = #glblCmpyCd# -->
            <!-- AND RW.TECH_TOC_CD (+)     = #techTocCd#  -->
            <!-- AND RW.RTL_WH_CATG_CD (+)  = #rtlWhCatgCd# -->
            <!-- QC#15846 End -->
            <!-- QC#15846 Start -->
            AND RW2.GLBL_CMPY_CD (+)    = RMSP.GLBL_CMPY_CD
            AND RW2.GLBL_CMPY_CD (+)    = RS.GLBL_CMPY_CD
            AND RW2.RTL_WH_CD (+)       = RS.RTL_WH_CD
            <!-- QC#15846 End -->
            AND RS.PRTY_LOC_FLG (+)    = 'Y'
            AND RMSP.GLBL_CMPY_CD      = INV.GLBL_CMPY_CD (+)
            AND RMSP.MDSE_CD           = INV.MDSE_CD (+)
            AND RS.INVTY_LOC_CD        = INV.INVTY_LOC_CD (+)
            AND INV.LOC_STS_CD (+)     = #locStsCd#
            AND INV.STK_STS_CD (+)     = #stkStsCd#
            AND RMSP.GLBL_CMPY_CD      = PT.GLBL_CMPY_CD
            AND PT.PROCR_TP_CD         = #procrTpCd#
            AND RMSP.GLBL_CMPY_CD      = RW2.GLBL_CMPY_CD
            AND RW2.RTL_WH_CD          = #rtlWhCd#
            AND RMSP.EZCANCELFLAG      = '0'
            AND AMV.EZCANCELFLAG       = '0'
            <!-- QC#15846 Start -->
            <!-- AND RW.EZCANCELFLAG (+)    = '0' -->
            <!-- QC#15846 End -->
            AND RS.EZCANCELFLAG (+)    = '0'
            AND INV.EZCANCELFLAG (+)   = '0'
            AND PT.EZCANCELFLAG        = '0'
            AND RW2.EZCANCELFLAG       = '0'
<!-- START 2019/11/08 T.Ogura [QC#53940,ADD] -->
        ORDER BY
            RMSP.MDSE_CD ASC
<!-- END   2019/11/08 T.Ogura [QC#53940,ADD] -->
    </statement>

    <statement id="getTechName" parameterClass="Map" resultClass="Map">
        SELECT
            M.TECH_NM
        FROM
            TECH_MSTR  M
            ,S21_PSN   S
        WHERE
                M.GLBL_CMPY_CD                     = #glblCmpyCd#
            AND M.TECH_TOC_CD                      = #techTocCd#
            AND M.GLBL_CMPY_CD                     = S.GLBL_CMPY_CD
            AND M.TECH_TOC_CD                      = S.PSN_CD
            AND S.EFF_FROM_DT                  &lt;= #effFromDt#
            AND NVL(S.EFF_THRU_DT, '99991231') &gt;= #effThruDt#
            AND S.DEL_FLG                          = #delFlg#
            AND M.EZCANCELFLAG                     = '0'
            AND S.EZCANCELFLAG                     = '0'
    </statement>

    <statement id="getWhName" parameterClass="Map" resultClass="Map">
        SELECT
            RW.RTL_WH_NM
        FROM
            RTL_WH   RW
        WHERE
                RW.GLBL_CMPY_CD      = #glblCmpyCd#
            AND RW.RTL_WH_CD         = #rtlWhCd#
            AND RW.EZCANCELFLAG      = '0'
    </statement>

    <statement id="getWhInfo" parameterClass="Map" resultClass="Map">
        SELECT
            RW.RTL_WH_NM
            ,SW.INVTY_LOC_CD
        FROM
            RTL_WH   RW
            ,RTL_SWH SW
        WHERE
                RW.GLBL_CMPY_CD                     = #glblCmpyCd#
            AND RW.RTL_WH_CD                        = #rtlWhCd#
            AND RW.GLBL_CMPY_CD                     = SW.GLBL_CMPY_CD
            AND RW.RTL_WH_CD                        = SW.RTL_WH_CD
            AND SW.RTL_SWH_CD                       = #rtlSwhCd#
            AND SW.EFF_FROM_DT                  &lt;= #effFromDt#
            AND NVL(SW.EFF_THRU_DT, '99991231') &gt;= #effThruDt#
            AND RW.EZCANCELFLAG                     = '0'
            AND SW.EZCANCELFLAG                     = '0'
    </statement>

    <statement id="getRtlSwhList" parameterClass="Map" resultClass="Map">
        SELECT
            S.RTL_SWH_CD
            ,S.INVTY_LOC_CD
        FROM
            RTL_SWH  S
            ,RTL_WH   W
        WHERE
                S.GLBL_CMPY_CD                     = #glblCmpyCd#
            AND S.RTL_WH_CD                        = #rtlWhCd#
            AND S.EFF_FROM_DT                  &lt;= #effFromDt#
            AND NVL(S.EFF_THRU_DT, '99991231') &gt;= #effThruDt#
            AND S.GLBL_CMPY_CD                     = W.GLBL_CMPY_CD
            AND S.RTL_WH_CD                        = W.RTL_WH_CD
            AND S.EZCANCELFLAG                     = '0'
            AND W.EZCANCELFLAG                     = '0'
    </statement>

    <statement id="countLocator" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*) AS COUNT
        FROM
            WH_LOCTR   L
        WHERE
                L.GLBL_CMPY_CD      = #glblCmpyCd#
            AND L.RTL_WH_CD         = #rtlWhCd#
            AND L.WH_LOCTR_CD       = #whLoctrCd#
            AND L.EZCANCELFLAG      = '0'
    </statement>

    <statement id="getItemInfo" parameterClass="Map" resultClass="Map">
        SELECT
            M.SHPG_SER_TAKE_FLG
            ,M.MDSE_DESC_SHORT_TXT
        FROM
            MDSE            M
        WHERE
                M.GLBL_CMPY_CD                     = #glblCmpyCd#
            AND M.MDSE_CD                          = #mdseCd#
            <iterate property="rgtnStsCd" var="rgtnStsCdList[]" open="AND M.RGTN_STS_CD IN (" conjunction= ", " close=")">
                #rgtnStsCdList[]#
            </iterate>
            AND M.EZCANCELFLAG                     = '0'
    </statement>

    <statement id="getItemName" parameterClass="Map" resultClass="String">
        SELECT
            D.MDSE_DESC_SHORT_TXT
        FROM
            MDSE   D
        WHERE
                D.GLBL_CMPY_CD                     = #glblCmpyCd#
            AND D.MDSE_CD                          = #mdseCd#
            AND D.EZCANCELFLAG                     = '0'
    </statement>

    <statement id="getRmnfToCmptMdseCd" parameterClass="Map" resultClass="String">
        SELECT 
            RD.RMNF_TO_CMPT_MDSE_CD
        FROM 
            RMNF_ORD     RO
           ,RMNF_ORD_DTL RD
        WHERE 1 = 1
        AND RO.GLBL_CMPY_CD           = #glblCmpyCd#
        AND RO.RMNF_ORD_NUM           = #rmnfOrdNum#
        AND RO.EZCANCELFLAG           = '0'
        AND RO.RMNF_ORD_NUM           = RD.RMNF_ORD_NUM
        AND RO.RMNF_MAIN_UNIT_MDSE_CD = RD.CMPT_MDSE_CD
        AND RO.GLBL_CMPY_CD           = RD.GLBL_CMPY_CD
        AND RD.EZCANCELFLAG           = '0'
    </statement>

    <statement id="findSameRemanOrder" parameterClass="Map" resultClass="String">
        SELECT
            O.RMNF_ORD_NUM
        FROM
            RMNF_ORD        O
            ,RMNF_ORD_STS   S
        WHERE
                O.GLBL_CMPY_CD           = #glblCmpyCd#
            AND O.RMNF_RTL_WH_CD         = #rmnfRtlWhCd#
            AND O.WH_LOCTR_CD            = #whLoctrCd#
            AND O.RMNF_ORD_NUM    &lt;&gt; #rmnfOrdNum#
            AND O.GLBL_CMPY_CD           = S.GLBL_CMPY_CD
            AND O.RMNF_ORD_STS_CD        = S.RMNF_ORD_STS_CD
            AND S.OPEN_STS_FLG           = #openStsFlg#
            AND O.EZCANCELFLAG           = '0'
            AND S.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getShippingPlan" parameterClass="Map" resultClass="Map">
        SELECT
            S.SHPG_PLN_NUM
            ,S.TRX_LINE_NUM
        FROM
            SHPG_PLN        S
        WHERE
                S.GLBL_CMPY_CD           = #glblCmpyCd#
            AND S.TRX_SRC_TP_CD          = #trxSrcTpCd#
            AND S.TRX_HDR_NUM            = #trxHdrNum#
<!-- START 03/09/2020 T.Ogura [QC#56058,MOD] -->
<!--        AND S.SHPG_STS_CD            != #shpgStsCd# -->
            AND S.SHPG_STS_CD            = #shpgStsCd#
<!-- END   03/09/2020 T.Ogura [QC#56058,MOD] -->
            AND S.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getShippingPlanForSubmit" parameterClass="Map" resultClass="Map">
        SELECT
            S.SHPG_PLN_NUM
            ,S.TRX_LINE_NUM
            ,S.TRX_LINE_SUB_NUM
        FROM
            SHPG_PLN        S
        WHERE
                S.GLBL_CMPY_CD           = #glblCmpyCd#
            AND S.TRX_SRC_TP_CD          = #trxSrcTpCd#
            AND S.TRX_HDR_NUM            = #trxHdrNum#
            AND S.TRX_LINE_NUM           = #trxLineNum#
            AND S.TRX_LINE_SUB_NUM       = #trxLineSubNum#
            AND S.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getShippingPlanForParts" parameterClass="Map" resultClass="Map">
        SELECT
            S.SHPG_PLN_NUM
           ,R.RMNF_PRT_REQ_LINE_NUM
        FROM
            RMNF_PRT_REQ R
           ,SHPG_PLN     S
        WHERE
            R.GLBL_CMPY_CD          = #glblCmpyCd#
        AND R.RMNF_ORD_NUM          = #rmnfOrdNum#
        <isEqual property="createFlg" compareValue="Y">
        AND (   R.RMNF_PRT_RQST_PROC_CD = #rmnfPrtRqstProcCdInComp#
             OR (    R.RMNF_PRT_RQST_PROC_CD = #rmnfPrtRqstProcCdComp#
                 AND R.SO_NUM IS NULL
                )
            )
        </isEqual>
        <isNotEqual property="createFlg" compareValue="Y">
        AND R.RMNF_PRT_RQST_PROC_CD = #rmnfPrtRqstProcCdComp#
        </isNotEqual>
        AND R.GLBL_CMPY_CD          = S.GLBL_CMPY_CD
        AND R.RMNF_ORD_NUM          = S.TRX_HDR_NUM
        AND R.RMNF_PRT_REQ_LINE_NUM = S.TRX_LINE_NUM
        AND S.TRX_SRC_TP_CD         = #trxSrcTpCd#
        AND S.SHPG_STS_CD           != #shpgStsCd#
        AND R.EZCANCELFLAG          = '0'
        AND S.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getShippingOrderForSubmit" parameterClass="Map" resultClass="Map">
        SELECT
            S.SO_NUM
           ,S.SO_SLP_NUM
           ,S.MDSE_CD
           ,S.FROM_STK_STS_CD
           ,S.SHPG_QTY
           ,S.INVTY_LOC_CD
        FROM
            SHPG_ORD_DTL     S
        WHERE
            S.GLBL_CMPY_CD = #glblCmpyCd#
        AND S.SO_NUM       = #soNum#
        AND S.EZCANCELFLAG = '0'
        ORDER BY
            S.SO_SLP_NUM
    </statement>

    <!-- QC#22178 Modify -->
    <statement id="getRwsDtlLineNumList" parameterClass="Map" resultClass="Map">
        SELECT
            R.RWS_DTL_LINE_NUM
            ,R.PO_RCV_TRX_LINE_NUM
            ,R.SER_NUM_TAKE_FLG
        FROM
            RWS_DTL        R
        WHERE
                R.GLBL_CMPY_CD           = #glblCmpyCd#
            AND R.RWS_NUM                = #rwsNum#
            AND R.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getRemanParts" parameterClass="Map" resultClass="Map">
        SELECT
            R.GLBL_CMPY_CD
            ,R.RMNF_PRT_REQ_PK
            ,R.RMNF_ORD_NUM
            ,R.RMNF_PRT_REQ_LINE_NUM
            ,R.MDSE_CD
            ,R.PRT_RQST_QTY
            ,R.PROCR_TP_CD
            ,R.SRC_RTL_WH_CD
            ,R.SRC_RTL_SWH_CD
            ,R.SRC_INVTY_LOC_CD
            ,R.SO_NUM
            ,R.PRCH_REQ_NUM
            ,R.RMNF_STD_PRT_FLG
            ,R.RMNF_PRT_RQST_PROC_CD
            ,R.EZUPTIME
            ,R.EZUPTIMEZONE
            ,NVL(I.INVTY_AVAL_QTY, 0) AS INVTY_AVAL_QTY
        FROM
            RMNF_PRT_REQ    R
            ,INVTY          I
            ,MDSE   M
        WHERE
                R.GLBL_CMPY_CD           = #glblCmpyCd#
            AND R.RMNF_ORD_NUM           = #rmnfOrdNum#
            AND (
                    R.RMNF_PRT_RQST_PROC_CD     = #notComp#
                OR  (
                        R.RMNF_PRT_RQST_PROC_CD = #completed#
                    AND R.SO_NUM IS NULL
                    )
                )
            AND R.GLBL_CMPY_CD                  = I.GLBL_CMPY_CD (+)
            AND R.MDSE_CD                       = I.MDSE_CD (+)
            AND R.SRC_INVTY_LOC_CD              = I.INVTY_LOC_CD (+)
            AND I.LOC_STS_CD (+)                = #locStsCd#
            AND I.STK_STS_CD (+)                = #stkStsCd#
            AND R.GLBL_CMPY_CD                  = M.GLBL_CMPY_CD (+)
            AND R.MDSE_CD                       = M.MDSE_CD (+)
            AND R.EZCANCELFLAG                  = '0'
            AND I.EZCANCELFLAG (+)              = '0'
            AND M.EZCANCELFLAG (+)              = '0'
    </statement>

    <statement id="getPartsPk" parameterClass="Map" resultClass="Map">
        SELECT
            R.RMNF_PRT_REQ_PK
        FROM
            RMNF_PRT_REQ    R
        WHERE
                R.GLBL_CMPY_CD           = #glblCmpyCd#
            AND R.RMNF_ORD_NUM           = #rmnfOrdNum#
            AND R.SO_NUM                 IS NULL
            AND R.RMNF_PRT_RQST_PROC_CD  = #notComp#
            AND R.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getAllTask" parameterClass="Map" resultClass="Map">
        SELECT
            R.RMNF_TASK_PK
            ,R.RMNF_ORD_NUM
            ,R.RMNF_TASK_NUM
            ,R.RMNF_TASK_DESC_TXT
            ,R.RMNF_TASK_STS_CD
            ,R.TECH_TOC_CD
            ,R.RMNF_TASK_START_DT
            ,R.RMNF_TASK_END_DT
            ,R.RMNF_LBOR_AOT
            ,R.RMNF_COST_PER_HOUR_AMT
            ,R.RMNF_LBOR_COST_AMT
            ,R.RMNF_LBOR_CMNT_TXT
            ,R.SPCL_INSTN_CMNT_TXT
        FROM
            RMNF_TASK    R
        WHERE
                R.GLBL_CMPY_CD           = #glblCmpyCd#
            AND R.RMNF_ORD_NUM           = #rmnfOrdNum#
            AND R.RMNF_TASK_STS_CD       = #rmnfTaskStsCd#
            AND R.EZCANCELFLAG           = '0'
            ORDER BY R.RMNF_TASK_NUM
    </statement>

    <statement id="getAllUsage" parameterClass="Map" resultClass="Map">
        SELECT
            R.MDSE_CD
            ,R.RMNF_PRT_QTY
        FROM
            RMNF_USG    R
        WHERE
                R.GLBL_CMPY_CD           = #glblCmpyCd#
            AND R.RMNF_ORD_NUM           = #rmnfOrdNum#
            AND R.RMNF_TASK_NUM          = #rmnfTaskNum#
            AND R.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getPartsUsage" parameterClass="Map" resultClass="Map">
        SELECT
            U.RMNF_USG_PK
           ,U.RMNF_TASK_PK
           ,U.RMNF_ORD_NUM
           ,U.RMNF_TASK_NUM
           ,U.RMNF_USG_LINE_NUM
           ,U.RMNF_INVTY_LOC_CD  AS RMNF_USG_INVTY_LOC_CD
           ,U.RMNF_USG_RTRN_INVTY_LOC_CD
           ,U.RTRN_REQ_PRT_FLG
           ,U.MDSE_CD
           ,U.RMNF_PRT_QTY
           ,U.PRT_UNIT_COST_AMT
           ,U.RMNF_PRT_USG_COST_AMT
           ,U.ASSET_RECOV_COST_AMT
           ,M.RTRN_REQ_PRT_FLG
           ,M.RTRN_DSPL_TP_CD
           ,S.INVTY_LOC_CD
        FROM
            RMNF_USG     U
           ,MDSE         M
           ,RTL_SWH      S
        WHERE
            U.GLBL_CMPY_CD     = #glblCmpyCd#
        AND U.RMNF_ORD_NUM     = #rmnfOrdNum#
        AND U.GLBL_CMPY_CD     = M.GLBL_CMPY_CD
        AND U.MDSE_CD          = M.MDSE_CD
        AND M.GLBL_CMPY_CD     = S.GLBL_CMPY_CD (+)
        AND M.RTRN_DSPL_TP_CD  = S.RTL_SWH_CD (+)
        AND S.RTL_WH_CD (+)    = #rtlWhCd#
        AND U.EZCANCELFLAG     = '0'
        AND M.EZCANCELFLAG     = '0'
        AND S.EZCANCELFLAG (+) = '0'
    </statement>

    <statement id="getUnusedParts" parameterClass="Map" resultClass="Map">
        SELECT
            UNUSED_QTY
           ,MDSE_CD
           ,INVTY_LOC_CD
        FROM
            (
                SELECT
                    SUM(R.PRT_RQST_QTY) -
                        (
                            SELECT
                                NVL( SUM(RU.RMNF_PRT_QTY), 0)
                            FROM
                                RMNF_USG RU
                            WHERE
                                    RU.GLBL_CMPY_CD = #glblCmpyCd#
                                AND RU.RMNF_ORD_NUM = #rmnfOrdNum#
                                AND RU.MDSE_CD      = R.MDSE_CD
<!-- START 2019/12/11 T.Ogura [QC#54822,ADD] -->
                                AND RU.RMNF_PRT_USG_COMIT_FLG = 'Y'
<!-- END   2019/12/11 T.Ogura [QC#54822,ADD] -->
                                AND RU.EZCANCELFLAG = '0'
<!-- START 2019/12/11 T.Ogura [QC#54822,MOD] -->
<!--                    ) AS UNUSED_QTY -->
                        ) -
                        (
                            SELECT
                                NVL( SUM(RU.RMNF_PRT_REL_QTY), 0)
                            FROM
                                RMNF_USG RU
                            WHERE
                                    RU.GLBL_CMPY_CD = #glblCmpyCd#
                                AND RU.RMNF_ORD_NUM = #rmnfOrdNum#
                                AND RU.MDSE_CD      = R.MDSE_CD
                                AND RU.RMNF_PRT_USG_COMIT_FLG = 'Y'
                                AND RU.EZCANCELFLAG = '0'
                        ) AS UNUSED_QTY
<!-- END   2019/12/11 T.Ogura [QC#54822,MOD] -->
                   ,R.MDSE_CD
                   ,RS.INVTY_LOC_CD
                FROM
                    RMNF_PRT_REQ R
                   ,RMNF_ORD     RO
                   ,RTL_SWH      RS
                WHERE
                    R.GLBL_CMPY_CD         = #glblCmpyCd#
                AND R.RMNF_ORD_NUM         = #rmnfOrdNum#
                AND R.SO_NUM               IS NOT NULL
                AND R.RMNF_PRT_RQST_PROC_CD= #completed#
                AND R.EZCANCELFLAG         = '0'
                AND R.GLBL_CMPY_CD         = RO.GLBL_CMPY_CD
                AND R.RMNF_ORD_NUM         = RO.RMNF_ORD_NUM
                AND RO.EZCANCELFLAG        = '0'
                AND RO.GLBL_CMPY_CD        = RS.GLBL_CMPY_CD
                AND RO.RMNF_USG_RTL_WH_CD  = RS.RTL_WH_CD
                AND RO.RMNF_USG_RTL_SWH_CD = RS.RTL_SWH_CD
                AND RS.EZCANCELFLAG        = '0'
                GROUP BY
                    R.MDSE_CD
                   ,RS.INVTY_LOC_CD
            )
        WHERE
            UNUSED_QTY &gt; 0
    </statement>

    <statement id="getOpenSoForMach" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            SHPG_ORD SO
           ,SHPG_STS SS
        WHERE
            SO.GLBL_CMPY_CD  = #glblCmpyCd#
        AND SO.TRX_HDR_NUM   = #rmnfOrdNum#
        <iterate property="sceOrdTpCd" var="elem[]" open="AND SO.SCE_ORD_TP_CD IN(" close=")" conjunction=",">
            #elem[]#
        </iterate>
        
        AND SO.EZCANCELFLAG  = '0'
        AND SO.GLBL_CMPY_CD  = SS.GLBL_CMPY_CD
        AND SO.SHPG_STS_CD   = SS.SHPG_STS_CD
        AND SS.SO_PRINT_FLG  = #flgY#
        AND SS.SHIP_FLG      = #flgN#
        AND SS.EZCANCELFLAG  = '0'
    </statement>
    
    <statement id="getAssetRecovCostAmt" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            NVL (SUM(RU.ASSET_RECOV_COST_AMT) , 0) AS CAL_ASSET_RECOV_COST_AMT
        FROM 
            RMNF_USG  RU
        WHERE 1=1
        AND RU.EZCANCELFLAG  = '0'
        AND RU.GLBL_CMPY_CD  = #glblCmpyCd#
        AND RMNF_ORD_NUM     = #rmnfOrdNum#

    </statement>
    

    <statement id="getRmnfPrtUsgCostAmt" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            NVL (SUM( R.RMNF_PRT_QTY * M.THIS_MTH_TOT_STD_COST_AMT) , 0 ) AS CAL_RMNF_PRT_USG_COST_AMT
        FROM
            RMNF_USG R
           ,MDSE     M
        WHERE 1 = 1
        AND R.EZCANCELFLAG  = '0'
        AND R.GLBL_CMPY_CD  = #glblCmpyCd#
        AND R.MDSE_CD       = M.MDSE_CD
        AND R.RMNF_ORD_NUM  = #rmnfOrdNum#
         <isNotNull property="rmnfTaskNum" >
        AND R.RMNF_TASK_NUM = #rmnfTaskNum#
         </isNotNull>
        AND R.GLBL_CMPY_CD  = M.GLBL_CMPY_CD
        AND M.EZCANCELFLAG  = '0'

    </statement>

    <statement id="getRmnTotLborCostAmt" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            NVL (SUM(RT.RMNF_COST_PER_HOUR_AMT * RT.RMNF_LBOR_AOT) , 0 ) AS CAL_RMNF_TOT_LBOR_COST_AMT
        FROM 
            RMNF_TASK RT
        WHERE 1=1
        AND RT.RMNF_ORD_NUM      = #rmnfOrdNum#
        AND RT.GLBL_CMPY_CD      = #glblCmpyCd#
         <isNotNull property="rmnfTaskNum" >
        AND RT.RMNF_TASK_NUM     = #rmnfTaskNum#
         </isNotNull>
        AND RT.RMNF_TASK_STS_CD != #cancel#
        AND RT.EZCANCELFLAG      = '0'
    </statement>

    <statement id="getRmnTotLborCostAmtBeforeComp" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             (
             SELECT 
                NVL (SUM(RT.RMNF_LBOR_AOT), 0)
             FROM 
                RMNF_TASK RT
             WHERE 1 = 1
             AND RT.GLBL_CMPY_CD  =  #glblCmpyCd#
             AND RT.EZCANCELFLAG  = '0'
             AND RT.RMNF_ORD_NUM  =  #rmnfOrdNum#
              <isNotNull property="rmnfTaskNum" >
             AND RT.RMNF_TASK_NUM = #rmnfTaskNum#
             </isNotNull>
             AND RT.RMNF_TASK_STS_CD != #cancel#
             ) 
             * 
             (
             SELECT 
                 NVL (RCPH.RMNF_COST_PER_HOUR_AMT , 0)
             FROM
                 RMNF_COST_PER_HOUR RCPH
             WHERE 1=1
             AND ROWNUM = 1
             ) AS CAL_RMNF_LBOR_AOT
        FROM
            DUAL
    </statement>


    <statement id="getAftDeclPnt" parameterClass="Map" resultClass="Integer">
        SELECT
            C.AFT_DECL_PNT_DIGIT_NUM
        FROM
            GLBL_CMPY       G
            ,CCY            C
        WHERE
                G.GLBL_CMPY_CD              = #glblCmpyCd#
            AND G.GLBL_CMPY_CD              = C.GLBL_CMPY_CD
            AND G.STD_CCY_CD                = C.CCY_CD
            AND G.EZCANCELFLAG              = '0'
            AND C.EZCANCELFLAG              = '0'
    </statement>

    <statement id="getWmsAdjInfo" parameterClass="Map" resultClass="Map">
        SELECT
             RO.RMNF_ORD_NUM                AS RMNF_ORD_NUM
            ,RO.WH_LOCTR_CD                 AS WH_LOCTR_CD
            ,RU.MDSE_CD                     AS MDSE_CD
            ,RP.SRC_RTL_WH_CD               AS SRC_RTL_WH_CD
            ,RP.SRC_RTL_SWH_CD              AS SRC_RTL_SWH_CD
            ,SUM(RU.RMNF_PRT_QTY)           AS RMNF_PRT_QTY
            ,WH.WMS_WH_CD                   AS WMS_WH_CD
            ,WH.RTL_WH_CD || WH.WH_OWNR_CD  AS PACK_CD_TXT
            ,WH.WMS_ADJ_DNLD_INTFC_ID       AS WMS_ADJ_DNLD_INTFC_ID
        FROM
             RMNF_ORD        RO
            ,RMNF_USG        RU
            ,RMNF_PRT_REQ    RP
            ,DS_RTL_WH_V     WH
        WHERE
            RO.GLBL_CMPY_CD            = #glblCmpyCd#
        AND RO.RMNF_ORD_NUM            = #rmnfOrdNum#
        AND RO.GLBL_CMPY_CD            = RU.GLBL_CMPY_CD
        AND RO.RMNF_ORD_NUM            = RU.RMNF_ORD_NUM
        AND RU.GLBL_CMPY_CD            = RP.GLBL_CMPY_CD
        AND RU.RMNF_ORD_NUM            = RP.RMNF_ORD_NUM
        AND RU.MDSE_CD                 = RP.MDSE_CD
        AND RP.GLBL_CMPY_CD            = WH.GLBL_CMPY_CD
        AND RP.SRC_RTL_WH_CD           = WH.RTL_WH_CD
        AND RP.SRC_RTL_SWH_CD          = WH.RTL_SWH_CD
        AND RO.EZCANCELFLAG            = '0'
        AND RU.EZCANCELFLAG            = '0'
        AND RP.EZCANCELFLAG            = '0'
        AND WH.EZCANCELFLAG            = '0'
        GROUP BY
            RO.RMNF_ORD_NUM
           ,RO.WH_LOCTR_CD
           ,RU.MDSE_CD
           ,RP.SRC_RTL_WH_CD
           ,RP.SRC_RTL_SWH_CD
           ,WH.WMS_WH_CD
           ,WH.RTL_WH_CD||WH.WH_OWNR_CD
           ,WH.WMS_ADJ_DNLD_INTFC_ID
    </statement>

    <statement id="getPartsItemInfo" parameterClass="Map" resultClass="Map">
        SELECT
            AMV.MDSE_DESC_SHORT_TXT
           ,AMV.ASSET_RECOV_COST_AMT
           ,AMV.RTRN_REQ_PRT_FLG
           ,INV.INVTY_AVAL_QTY
        FROM
            ALL_MDSE_V AMV
           ,INVTY      INV
        WHERE
            AMV.MDSE_CD         = #mdseCd#
        AND INV.MDSE_CD(+)      = AMV.MDSE_CD
        AND INV.INVTY_LOC_CD(+) = #invtyLocCd#
        AND INV.LOC_STS_CD(+)   = #locStsCd#
        AND INV.STK_STS_CD(+)   = #stkStsCd#
        AND AMV.EZCANCELFLAG    = '0'
        AND INV.EZCANCELFLAG(+) = '0'
    </statement>

    <statement id="chkMdseIntangible" parameterClass="Map" resultClass="Integer">
        SELECT
                COUNT(M.MDSE_CD)
        FROM
                ALL_MDSE_V M
        WHERE 1=1
            AND M.GLBL_CMPY_CD      = #glblCmpyCd#
            AND M.MDSE_CD           = #mdseCd#
            AND M.INVTY_CTRL_FLG    = 'Y'
            AND M.INVTY_VAL_FLG     = 'Y'
            AND M.EZCANCELFLAG      = '0'
    </statement>
    <statement id="getMaxPrtReqLineNum" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            MAX(TO_NUMBER(RPR.RMNF_PRT_REQ_LINE_NUM))
        FROM
            RMNF_PRT_REQ RPR
        WHERE
            RPR.GLBL_CMPY_CD    = #glblCmpyCd#
        AND RPR.RMNF_ORD_NUM    = #rmnfOrdNum#
        AND RPR.EZCANCELFLAG    = '0'
    </statement>
    <statement id="isOpenedSoStdParts" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)
        FROM
            RMNF_PRT_REQ RPR
        WHERE 1=1
            AND RPR.GLBL_CMPY_CD        = #glblCmpyCd#
            AND RPR.RMNF_ORD_NUM        = #rmnfOrdNum#
            AND RPR.MDSE_CD             = #mdseCd#
            AND RPR.RMNF_STD_PRT_FLG    = 'Y'
            AND RPR.SO_NUM              IS NOT NULL
            AND RPR.RMNF_PRT_RQST_PROC_CD     = '1'
            AND RPR.EZCANCELFLAG        = '0'
    </statement>


    <statement id="searchSoRws" parameterClass="Map" resultClass="Map">
        SELECT
             SO.SO_NUM SO_RWS_NUM
            ,'N' RWS_NUM_FLG
            ,OT.SCE_ORD_TP_CD
            ,OT.SCE_ORD_TP_NM
            ,RW.RTL_WH_NM
            ,RS.RTL_SWH_CD RTL_SWH_NM
            ,SS.SHPG_STS_DESC_TXT STATUS
            ,SUBSTR(SO.EZINTIME, 1, 8) EZINTIME
        FROM
             RMNF_ORD        RO
            ,RTL_WH          RW
            ,RTL_SWH         RS
            ,SHPG_ORD        SO
            ,SHPG_STS        SS
            ,SCE_ORD_TP      OT
        WHERE
             RO.GLBL_CMPY_CD          = #glblCmpyCd#
        AND  RO.RMNF_ORD_NUM          = #rmnfOrdNum#
        AND  RO.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
        AND  RO.RMNF_RTL_WH_CD        = RW.RTL_WH_CD
        AND  RO.GLBL_CMPY_CD          = RS.GLBL_CMPY_CD
        AND  RO.RMNF_RTL_WH_CD        = RS.RTL_WH_CD
        AND  RO.RMNF_RTL_SWH_CD       = RS.RTL_SWH_CD
        AND  RO.GLBL_CMPY_CD          = SO.GLBL_CMPY_CD
        AND  RO.RMNF_ORD_NUM          = SO.SRC_ORD_NUM
        <isNotNull property="sceOrdTpList">
        <iterate property="sceOrdTpList" var="sceOrdTp[]" open="AND  SO.SCE_ORD_TP_CD IN (" close=")" conjunction=",">
            #sceOrdTp[]#
        </iterate>
        </isNotNull>
        AND  SO.SCE_ORD_TP_CD        != #remanUsage#
        AND  SO.GLBL_CMPY_CD          = SS.GLBL_CMPY_CD
        AND  SO.SHPG_STS_CD           = SS.SHPG_STS_CD
        AND  SO.SCE_ORD_TP_CD         = OT.SCE_ORD_TP_CD
        AND  SO.GLBL_CMPY_CD          = OT.GLBL_CMPY_CD
        AND  OT.INBD_OTBD_CD          = #outbound#
        AND  RO.EZCANCELFLAG          = '0'
        AND  RW.EZCANCELFLAG          = '0'
        AND  RS.EZCANCELFLAG          = '0'
        AND  SO.EZCANCELFLAG          = '0'
        AND  SS.EZCANCELFLAG          = '0'
        UNION
        SELECT
             RWS.RWS_NUM SO_RWS_NUM
            ,'Y' RWS_NUM_FLG
            ,OT.SCE_ORD_TP_CD
            ,OT.SCE_ORD_TP_NM
            ,RW.RTL_WH_NM
            ,RS.RTL_SWH_CD RTL_SWH_NM
            ,SS.RWS_STS_DESC_TXT STATUS
            ,SUBSTR(RWS.EZINTIME, 1, 8) EZINTIME
        FROM
             RMNF_ORD        RO
            ,RTL_WH          RW
            ,RTL_SWH         RS
            ,RWS_STS         SS
            ,RWS_HDR         RWS
            ,SCE_ORD_TP      OT
        WHERE
             RO.GLBL_CMPY_CD          = #glblCmpyCd#
        AND  RO.RMNF_ORD_NUM          = #rmnfOrdNum#
        AND  RO.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
        AND  RO.RMNF_RTL_WH_CD        = RW.RTL_WH_CD
        AND  RO.GLBL_CMPY_CD          = RS.GLBL_CMPY_CD
        AND  RO.RMNF_RTL_WH_CD        = RS.RTL_WH_CD
        AND  RO.RMNF_RTL_SWH_CD       = RS.RTL_SWH_CD
        AND  RO.GLBL_CMPY_CD          = RWS.GLBL_CMPY_CD
        AND  RO.RMNF_ORD_NUM          = RWS.SRC_ORD_NUM
        <isNotNull property="sceOrdTpList">
        <iterate property="sceOrdTpList" var="sceOrdTp[]" open="AND  RWS.SCE_ORD_TP_CD IN (" close=")" conjunction=",">
            #sceOrdTp[]#
        </iterate>
        </isNotNull>
        AND  RWS.GLBL_CMPY_CD         = SS.GLBL_CMPY_CD
        AND  RWS.RWS_STS_CD           = SS.RWS_STS_CD
        AND  RWS.GLBL_CMPY_CD         = OT.GLBL_CMPY_CD
        AND  RWS.SCE_ORD_TP_CD        = OT.SCE_ORD_TP_CD
        AND  OT.INBD_OTBD_CD          = #inbound#
        AND  RO.EZCANCELFLAG          = '0'
        AND  RW.EZCANCELFLAG          = '0'
        AND  RS.EZCANCELFLAG          = '0'
        AND  RWS.EZCANCELFLAG         = '0'
        AND  SS.EZCANCELFLAG          = '0'
        ORDER BY
             EZINTIME
            ,SCE_ORD_TP_CD
            ,RWS_NUM_FLG
            ,SO_RWS_NUM
    </statement>

    <statement id="getSceOrdTp" parameterClass="Map" resultClass="Map">
        SELECT
             SOT.SCE_ORD_TP_CD
            ,SOT.SCE_ORD_TP_NM
        FROM
             SCE_ORD_TP       SOT
        WHERE
             SOT.GLBL_CMPY_CD          = #glblCmpyCd#
        <iterate property="sceOrdTpList" var="sceOrdTp[]" open="AND SOT.SCE_ORD_TP_CD IN (" close=")" conjunction=",">
            #sceOrdTp[]#
        </iterate>
        AND  SOT.INBD_OTBD_CD          = #inbound#
        AND  SOT.EZCANCELFLAG          = '0'
        ORDER BY SCE_ORD_TP_CD
    </statement>
    
    <statement id="getPriorityInventoryCd" parameterClass="Map" resultClass="String">
        SELECT
             RS.INVTY_LOC_CD
        FROM
             RTL_SWH       RS
        WHERE
             RS.GLBL_CMPY_CD          = #glblCmpyCd#
        AND  RS.RTL_WH_CD             = #rtlWhCd#
        AND  RS.PRTY_LOC_FLG          = #prtyLocFlg#
        AND  RS.EZCANCELFLAG          = '0'
    </statement>


    <statement id="getStockStatusPulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
             SS.STK_STS_CD
            ,SS.STK_STS_DESC_TXT
        FROM
            STK_STS SS
        WHERE
            SS.GLBL_CMPY_CD = #glblCmpyCd#
        AND SS.EZCANCELFLAG = '0'
        ORDER BY SS.STK_STS_SORT_NUM ASC
    </statement>

</sqlMap>
