<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL7200Query">
    <typeAlias alias="NMAL7200_ACMsg"  type="business.blap.NMAL7200.NMAL7200_ACMsg"/>
    <statement id="getPriceGroupUsage" parameterClass="Map" resultMap="result.getPrcGrpUsg">
    SELECT
        USAGE_TYPE
        ,USAGE_VALUE
        ,USAGE_ID
        ,USAGE_ACTIVE
        ,PRICE_RULE_TYPE
      FROM
      (
      SELECT
            #usageType1#     AS USAGE_TYPE
           ,PCG.PRC_CATG_NM  AS USAGE_VALUE
           ,PCG.PRC_CATG_CD  AS USAGE_ID
           ,DECODE(PCG.ACTV_FLG, #actvFlg1#, #actvFlg2#, #actvFlg3#, #actvFlg4#) AS USAGE_ACTIVE
           ,''               AS PRICE_RULE_TYPE
      FROM
            PRC_CATG PCG
           ,PRC_CUST_AUDC PCA
           ,PRC_TRX_AUDC PTA
      WHERE
          PCG.GLBL_CMPY_CD    = #glblCmpyCd#
      AND PCG.EZCANCELFLAG    = '0'
      AND PCG.PRC_CATG_CD     = PCA.PRC_CATG_CD(+)
      AND PCG.GLBL_CMPY_CD    = PCA.GLBL_CMPY_CD(+)
      AND PCA.EZCANCELFLAG(+) = '0'
      AND PCG.PRC_CATG_CD     = PTA.PRC_CATG_CD(+)
      AND PCG.GLBL_CMPY_CD    = PTA.GLBL_CMPY_CD(+)
      AND PTA.EZCANCELFLAG(+) = '0'
      AND (EXISTS (SELECT 
                      1
                  FROM 
                      PRC_GRP PG 
                  WHERE 
                     PG.EZCANCELFLAG = '0'
                  <isNotNull property="prcGrpPk">
                     AND TO_CHAR(PG.PRC_GRP_PK) LIKE #prcGrpPk#
                  </isNotNull>
                  <isNotNull property="prcGrpNm">
                     AND PG.PRC_GRP_NM          LIKE #prcGrpNm#
                  </isNotNull>
                  <isNotNull property="prcGrpDescTxt">
                     AND PG.PRC_GRP_DESC_TXT    LIKE #prcGrpDescTxt#
                  </isNotNull>
                     AND PG.PRC_GRP_PK   = PTA.PRC_GRP_PK
                     AND PG.GLBL_CMPY_CD = PTA.GLBL_CMPY_CD)
      OR  EXISTS (SELECT 
                      1
                  FROM 
                      PRC_GRP PG 
                  WHERE  
                          PG.EZCANCELFLAG = '0'
                  <isNotNull property="prcGrpPk">
                      AND TO_CHAR(PG.PRC_GRP_PK) LIKE #prcGrpPk#
                  </isNotNull>
                  <isNotNull property="prcGrpNm">
                      AND PG.PRC_GRP_NM          LIKE #prcGrpNm#
                  </isNotNull>
                  <isNotNull property="prcGrpDescTxt">
                      AND PG.PRC_GRP_DESC_TXT    LIKE #prcGrpDescTxt#
                  </isNotNull>
                      AND PG.PRC_GRP_PK   = PCA.PRC_GRP_PK_01
                      AND PG.GLBL_CMPY_CD = PCA.GLBL_CMPY_CD)
      OR  EXISTS (SELECT 
                      1
                  FROM 
                      PRC_GRP PG 
                  WHERE 
                          PG.EZCANCELFLAG = '0'
                  <isNotNull property="prcGrpPk">
                      AND TO_CHAR(PG.PRC_GRP_PK) LIKE #prcGrpPk#
                  </isNotNull>
                  <isNotNull property="prcGrpNm">
                      AND PG.PRC_GRP_NM          LIKE #prcGrpNm#
                  </isNotNull>
                  <isNotNull property="prcGrpDescTxt">
                      AND PG.PRC_GRP_DESC_TXT    LIKE #prcGrpDescTxt#
                  </isNotNull>
                      AND PG.PRC_GRP_PK = PCA.PRC_GRP_PK_02
                      AND PG.GLBL_CMPY_CD = PCA.GLBL_CMPY_CD)
      OR  EXISTS (SELECT 
                     1 
                 FROM 
                     PRC_GRP PG 
                 WHERE
                          PG.EZCANCELFLAG = '0'
                 <isNotNull property="prcGrpPk">
                      AND TO_CHAR(PG.PRC_GRP_PK) LIKE #prcGrpPk#
                 </isNotNull>
                 <isNotNull property="prcGrpNm">
                      AND PG.PRC_GRP_NM          LIKE #prcGrpNm#
                 </isNotNull>
                 <isNotNull property="prcGrpDescTxt">
                      AND PG.PRC_GRP_DESC_TXT    LIKE #prcGrpDescTxt#
                 </isNotNull>
                      AND PG.PRC_GRP_PK = PCA.PRC_GRP_PK_03
                      AND PG.GLBL_CMPY_CD = PCA.GLBL_CMPY_CD)
         )
      GROUP BY 
           PCG.PRC_CATG_CD
          ,PCG.PRC_CATG_NM
          ,PCG.ACTV_FLG
          
      UNION ALL

      SELECT
         #usageType2#                 AS USAGE_TYPE
        ,PRH.PRC_RULE_NM              AS USAGE_VALUE
        ,TO_CHAR(PRH.PRC_RULE_HDR_PK) AS USAGE_ID
        ,DECODE(PRH.ACTV_FLG, #actvFlg1#, #actvFlg2#, #actvFlg3#, #actvFlg4#) AS USAGE_ACTIVE
        ,PRH.PRC_RULE_COND_TP_CD      AS PRICE_RULE_TYPE
      FROM
         PRC_RULE_HDR PRH
        ,PRC_RULE_TRX_COND PRTC
      WHERE
          PRH.EZCANCELFLAG     = '0'
      AND PRH.GLBL_CMPY_CD     = #glblCmpyCd#
      AND PRH.PRC_RULE_HDR_PK  = PRTC.PRC_RULE_HDR_PK
      AND PRH.GLBL_CMPY_CD     = PRTC.GLBL_CMPY_CD
      AND PRTC.EZCANCELFLAG = '0'
      AND PRTC.PRC_RULE_ATTRB_CD in
       <iterate property="attrbList" var="attrbList[]" open="(" close=")" conjunction=",">
                        #attrbList[]#
       </iterate>
      AND EXISTS (SELECT 
                    1
                 FROM 
                    PRC_GRP PG 
                 WHERE 
                    PG.EZCANCELFLAG = '0'
                 <isNotNull property="prcGrpPk">
                    AND TO_CHAR(PG.PRC_GRP_PK) LIKE #prcGrpPk#
                 </isNotNull>
                 <isNotNull property="prcGrpNm">
                    AND PG.PRC_GRP_NM          LIKE #prcGrpNm#
                 </isNotNull>
                 <isNotNull property="prcGrpDescTxt">
                    AND PG.PRC_GRP_DESC_TXT    LIKE #prcGrpDescTxt#
                 </isNotNull>
                    AND TO_CHAR(PG.PRC_GRP_PK) = PRTC.PRC_RULE_COND_FROM_TXT
                    AND PG.GLBL_CMPY_CD = PRTC.GLBL_CMPY_CD)
      GROUP BY 
           PRH.PRC_RULE_NM
          ,PRH.PRC_RULE_HDR_PK
          ,PRH.ACTV_FLG
          ,PRH.PRC_RULE_COND_TP_CD
      UNION ALL

      SELECT
        #usageType2#                  AS USAGE_TYPE
        ,PRH.PRC_RULE_NM              AS USAGE_VALUE
        ,TO_CHAR(PRH.PRC_RULE_HDR_PK) AS USAGE_ID
        ,DECODE(PRH.ACTV_FLG, #actvFlg1#, #actvFlg2#, #actvFlg3#, #actvFlg4#) AS USAGE_ACTIVE
        ,PRH.PRC_RULE_COND_TP_CD      AS PRICE_RULE_TYPE
      FROM
         PRC_RULE_HDR PRH
        ,PRC_ADJ_DTL PAD
      WHERE
          PRH.EZCANCELFLAG     = '0'
      AND PRH.GLBL_CMPY_CD     = #glblCmpyCd#
      AND PRH.PRC_RULE_HDR_PK  = PAD.PRC_RULE_HDR_PK
      AND PRH.GLBL_CMPY_CD     = PAD.GLBL_CMPY_CD
      AND PAD.EZCANCELFLAG = '0'
      AND (PAD.PRNT_PRC_ADJ_DTL_PK IS NULL OR PAD.PRC_ADJ_DTL_PK = PAD.PRNT_PRC_ADJ_DTL_PK)
      AND EXISTS (SELECT 
                    1
                 FROM 
                    PRC_GRP PG 
                 WHERE 
                    PG.EZCANCELFLAG = '0'
                 <isNotNull property="prcGrpPk">
                    AND TO_CHAR(PG.PRC_GRP_PK) LIKE #prcGrpPk#
                 </isNotNull>
                 <isNotNull property="prcGrpNm">
                    AND PG.PRC_GRP_NM          LIKE #prcGrpNm#
                 </isNotNull>
                 <isNotNull property="prcGrpDescTxt">
                    AND PG.PRC_GRP_DESC_TXT    LIKE #prcGrpDescTxt#
                 </isNotNull>
                    AND ( TO_CHAR(PG.PRC_GRP_PK) = PAD.PRC_RULE_COND_FROM_TXT_05
                       OR TO_CHAR(PG.PRC_GRP_PK) = PAD.PRC_RULE_COND_FROM_TXT_14
                       OR TO_CHAR(PG.PRC_GRP_PK) = PAD.PRC_RULE_COND_FROM_TXT_53
                       OR TO_CHAR(PG.PRC_GRP_PK) = PAD.PRC_RULE_COND_FROM_TXT_57 )
                    AND PG.GLBL_CMPY_CD = PAD.GLBL_CMPY_CD
          )
      GROUP BY 
           PRH.PRC_RULE_NM
          ,PRH.PRC_RULE_HDR_PK
          ,PRH.ACTV_FLG
          ,PRH.PRC_RULE_COND_TP_CD
      ) 
      WHERE ROWNUM &lt;= #rowNum#
      ORDER BY USAGE_TYPE
    </statement>
    <resultMap id="result.getPrcGrpUsg" class="NMAL7200_ACMsg">
        <result property="xxScrItem10Txt"    column="USAGE_TYPE"      javaType="EZDBStringItem"/>
        <result property="prcCatgNm"         column="USAGE_VALUE"     javaType="EZDBStringItem"/>
        <result property="xxScrItem30Txt"    column="USAGE_ID"        javaType="EZDBStringItem"/>
        <result property="xxScrItem7Txt"     column="USAGE_ACTIVE"    javaType="EZDBStringItem"/>
        <result property="prcRuleCondTpCd"   column="PRICE_RULE_TYPE" javaType="EZDBStringItem"/>
    </resultMap>
</sqlMap>

