<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NMAB561001">

     <statement id="getAcctLocUpdateReady" parameterClass="Map" resultClass="Map">
       <!-- START 2019/05/23 Hd.Sugawara [QC#50101,MOD] -->
       <!-- SELECT -->
       <!--     ACCT_LOC_PK -->
       <!--   , LOC_NUM -->
       <!--   , DS_ACCT_NUM   -->

       <!-- FROM  -->
       <!--     ACCT_LOC -->

       <!-- WHERE -->
       <!--     GLBL_CMPY_CD = #glblCmpyCd# -->
       <!-- AND EZCANCELFLAG = '0' -->
       <!-- AND EFF_FROM_DT  &lt;= #procDt# -->
       <!-- AND (EFF_THRU_DT IS NULL -->
       <!--   OR EFF_THRU_DT &gt; #procDt# ) -->
       <!-- AND RGTN_STS_CD  = #rgtnStsCdPendingCompletion# -->
       SELECT
           AL.ACCT_LOC_PK
         , AL.LOC_NUM
         , AL.DS_ACCT_NUM
         , PLW.PTY_LOC_PK
         , PLW.CMPY_PK
       FROM 
           ACCT_LOC AL
         , PTY_LOC_WRK PLW
       WHERE
           AL.GLBL_CMPY_CD     = #glblCmpyCd#
       AND AL.EZCANCELFLAG     = '0'
       AND AL.EFF_FROM_DT  &lt;= #procDt#
       AND (AL.EFF_THRU_DT IS NULL
         OR AL.EFF_THRU_DT &gt; #procDt# )
       AND AL.RGTN_STS_CD      = #rgtnStsCdPendingCompletion#

       AND AL.GLBL_CMPY_CD     = PLW.GLBL_CMPY_CD
       AND AL.PTY_LOC_PK       = PLW.PTY_LOC_PK
       AND PLW.EZCANCELFLAG    = '0'
       <!-- END 2019/05/23 Hd.Sugawara [QC#50101,MOD] -->

    </statement>

     <statement id="getCreditBalanceUpdate" parameterClass="Map" resultClass="String">

       SELECT
           AL.DS_ACCT_NUM

       FROM 
           BILL_TO_CUST BTC
         , CUST_CR_PRFL CCP
         , ACCT_LOC     AL

       WHERE
           BTC.GLBL_CMPY_CD    = #glblCmpyCd#
       AND BTC.EZCANCELFLAG    = '0'
       AND BTC.LOC_NUM         = #locNum#

       AND BTC.GLBL_CMPY_CD    = CCP.GLBL_CMPY_CD
       AND CCP.EZCANCELFLAG    = '0'
       AND BTC.BILL_TO_CUST_PK = CCP.BILL_TO_CUST_PK

       AND BTC.GLBL_CMPY_CD    = AL.GLBL_CMPY_CD
       AND AL.EZCANCELFLAG     = '0'
       AND BTC.LOC_NUM         = AL.LOC_NUM
       AND AL.DS_ACCT_NUM      &lt;&gt; #dsAcctNum#

      ORDER BY AL.EFF_THRU_DT DESC

    </statement>

     <statement id="getAcctLocUpdateTerminated" parameterClass="Map" resultClass="Map">

       SELECT
           ACCT_LOC_PK
         , LOC_NUM
         , DS_ACCT_NUM
         , PTY_LOC_PK

       FROM 
           ACCT_LOC

       WHERE
           GLBL_CMPY_CD = #glblCmpyCd#
       AND EZCANCELFLAG = '0'
       AND EFF_THRU_DT  &lt; #procDt#
       AND RGTN_STS_CD  IN (#rgtnStsCdPendingCompletion#, #rgtnStsCdReadyForOrderTaking#)

    </statement>

     <statement id="getPrinCustPk" parameterClass="Map" resultClass="Map">
       SELECT
           PRIN_CUST_PK

       FROM 
           PRIN_CUST

       WHERE
           GLBL_CMPY_CD = #glblCmpyCd#
       AND EZCANCELFLAG = '0'
       AND PTY_LOC_PK   = #ptyLocPk#

     </statement>

     <statement id="getPrimaryUpdate" parameterClass="Map" resultClass="Map">

       SELECT
           PLW.FIRST_LINE_ADDR  FIRST_LINE_ADDR
         , PLW.SCD_LINE_ADDR    SCD_LINE_ADDR
         , PLW.THIRD_LINE_ADDR  THIRD_LINE_ADDR
         , PLW.FRTH_LINE_ADDR   FRTH_LINE_ADDR
         , PLW.CTY_ADDR         CTY_ADDR
         , PLW.CNTY_PK          CNTY_PK
         , PLW.PROV_NM          PROV_NM
         , PLW.ST_CD            ST_CD
         , PLW.POST_CD          POST_CD
         , PLW.CTRY_CD          CTRY_CD
         , PLW.LOC_NUM          LOC_NUM
         , PLW.LOC_NM           LOC_NM
         , PLW.RGTN_STS_CD      RGTN_STS_CD
         , PLW.PTY_LOC_PK       PTY_LOC_PK
         , PLW.EFF_FROM_DT      EFF_FROM_DT
         , PLW.EFF_THRU_DT      EFF_THRU_DT
         , PLW.TEL_NUM          TEL_NUM
         , PLW.GEO_CD           GEO_CD
       <!-- START 2019/05/23 Hd.Sugawara [QC#50101,DEL] -->
       <!--   , BTC.BILL_TO_CUST_CD  BILL_TO_CUST_CD -->
       <!-- END 2019/05/23 Hd.Sugawara [QC#50101,DEL] -->
         
       FROM 
           ACCT_LOC     AL
         , PTY_LOC_WRK  PLW
       <!-- START 2019/05/23 Hd.Sugawara [QC#50101,DEL] -->
       <!--   , BILL_TO_CUST BTC -->
       <!-- END 2019/05/23 Hd.Sugawara [QC#50101,DEL] -->

       WHERE
           AL.GLBL_CMPY_CD     = #glblCmpyCd#
       AND AL.EZCANCELFLAG     = '0'
       AND AL.DS_ACCT_NUM      = #dsAcctNum#
       <!-- START 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
       AND NVL(AL.EFF_THRU_DT , #maxDt#) &gt;= #procDt#
       AND AL.RGTN_STS_CD      IN (#rgtnStsCdPendingCompletion#, #rgtnStsCdReadyForOrderTaking#)
       <!-- END 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->

       AND AL.GLBL_CMPY_CD     = PLW.GLBL_CMPY_CD
       AND PLW.EZCANCELFLAG    = '0'
       AND PLW.PTY_LOC_PK      = AL.PTY_LOC_PK
       <!-- START 2019/05/23 Hd.Sugawara [QC#50101,MOD] -->
       <!-- AND PLW.LOC_NUM         &lt;&gt; #locNum# -->
       AND NVL(PLW.EFF_THRU_DT , #maxDt#) &gt;= #procDt#
       AND PLW.RGTN_STS_CD     = #rgtnStsCdReadyForOrderTaking#
       <!-- END 2019/05/23 Hd.Sugawara [QC#50101,MOD] -->

       <!-- START 2019/05/23 Hd.Sugawara [QC#50101,DEL] -->
       <!-- AND PLW.GLBL_CMPY_CD    = BTC.GLBL_CMPY_CD -->
       <!-- AND BTC.EZCANCELFLAG    = '0' -->
       <!-- AND PLW.LOC_NUM         = BTC.LOC_NUM(+) -->
       <!-- END 2019/05/23 Hd.Sugawara [QC#50101,DEL] -->

       <!-- START 2019/05/23 Hd.Sugawara [QC#50101,MOD] -->
       <!-- ORDER BY PLW.PTY_LOC_PK -->
       ORDER BY AL.EFF_FROM_DT, PLW.PTY_LOC_PK
       <!-- END 2019/05/23 Hd.Sugawara [QC#50101,MOD] -->

    </statement>

    <statement id="getBillToCustUpdateReadyList" parameterClass="Map" resultClass="Map">
      SELECT
          BTC.BILL_TO_CUST_PK  BILL_TO_CUST_PK

      FROM
          BILL_TO_CUST    BTC
        , PTY_LOC_WRK     PLW
        , SELL_TO_CUST    STC
        , ACCT_LOC        AL

      WHERE
          BTC.GLBL_CMPY_CD     = #glblCmpyCd#
      AND BTC.EZCANCELFLAG     = '0'
      AND BTC.EFF_FROM_DT      &lt;= #procDt#
      AND (BTC.EFF_THRU_DT     IS NULL
       OR  BTC.EFF_THRU_DT     &gt; #procDt# )
      AND BTC.RGTN_STS_CD      = #rgtnStsCdPendingCompletion#
      AND BTC.COA_AFFL_CD      IS NOT NULL
      AND BTC.COA_CH_CD        IS NOT NULL

      AND BTC.GLBL_CMPY_CD     = PLW.GLBL_CMPY_CD
      AND PLW.EZCANCELFLAG     = '0'
      AND BTC.LOC_NUM          = PLW.LOC_NUM
      AND PLW.RGTN_STS_CD      = #rgtnStsCdReadyForOrderTaking#

      AND BTC.GLBL_CMPY_CD     = STC.GLBL_CMPY_CD
      AND STC.EZCANCELFLAG     = '0'
      AND BTC.SELL_TO_CUST_CD  = STC.SELL_TO_CUST_CD
      AND STC.RGTN_STS_CD      = #rgtnStsCdReadyForOrderTaking#

      AND STC.GLBL_CMPY_CD     = AL.GLBL_CMPY_CD
      AND AL.EZCANCELFLAG      = '0'
      AND STC.SELL_TO_CUST_CD  = AL.DS_ACCT_NUM
      AND PLW.LOC_NUM          = AL.LOC_NUM
      AND AL.RGTN_STS_CD       = #rgtnStsCdReadyForOrderTaking#

    </statement>

    <statement id="getBillToCustUpdateTerminatedList" parameterClass="Map" resultClass="Map">
      SELECT
          BTC.BILL_TO_CUST_PK  BILL_TO_CUST_PK
          <!-- START 2022/04/28 QC#59983 -->
          ,BTC.BILL_TO_CUST_CD  BILL_TO_CUST_CD
          ,BTC.LOC_NM  BILL_TO_CUST_NM
          <!-- END 2022/04/28 QC#59983 -->
      FROM
          BILL_TO_CUST    BTC

      WHERE
          BTC.GLBL_CMPY_CD     = #glblCmpyCd#
      AND BTC.EZCANCELFLAG     = '0'
      AND BTC.EFF_THRU_DT      &lt; #procDt#
      AND BTC.RGTN_STS_CD      IN (#rgtnStsCdPendingCompletion#, #rgtnStsCdReadyForOrderTaking#)

    </statement>

    <statement id="getShipToCustUpdateReadyList" parameterClass="Map" resultClass="Map">
      SELECT
          STC.SHIP_TO_CUST_PK  SHIP_TO_CUST_PK

      FROM
          SHIP_TO_CUST    STC
        , PTY_LOC_WRK     PLW
        , SELL_TO_CUST    SEL
        , ACCT_LOC        AL

      WHERE
          STC.GLBL_CMPY_CD     = #glblCmpyCd#
      AND STC.EZCANCELFLAG     = '0'
      AND STC.EFF_FROM_DT      &lt;= #procDt#
      AND (STC.EFF_THRU_DT     IS NULL
       OR  STC.EFF_THRU_DT     &gt; #procDt# )
      AND STC.RGTN_STS_CD      = #rgtnStsCdPendingCompletion#

      AND STC.GLBL_CMPY_CD     = PLW.GLBL_CMPY_CD
      AND PLW.EZCANCELFLAG     = '0'
      AND STC.LOC_NUM         = PLW.LOC_NUM
      AND PLW.RGTN_STS_CD      = #rgtnStsCdReadyForOrderTaking#

      AND STC.GLBL_CMPY_CD     = SEL.GLBL_CMPY_CD
      AND SEL.EZCANCELFLAG     = '0'
      AND STC.SELL_TO_CUST_CD  = SEL.SELL_TO_CUST_CD
      AND SEL.RGTN_STS_CD      = #rgtnStsCdReadyForOrderTaking#

      AND STC.GLBL_CMPY_CD     = AL.GLBL_CMPY_CD
      AND AL.EZCANCELFLAG      = '0'
      AND STC.SELL_TO_CUST_CD  = AL.DS_ACCT_NUM
      AND STC.LOC_NUM          = AL.LOC_NUM
      AND AL.RGTN_STS_CD       = #rgtnStsCdReadyForOrderTaking#

    </statement>

    <statement id="getShipToCustUpdateTerminatedList" parameterClass="Map" resultClass="Map">
      SELECT
          SHIP_TO_CUST_PK
          <!-- START 2022/04/28 QC#59983 -->
          ,SHIP_TO_CUST_CD  SHIP_TO_CUST_CD
          ,LOC_NM  SHIP_TO_CUST_NM
          <!-- END 2022/04/28 QC#59983 -->
      FROM
          SHIP_TO_CUST

      WHERE
          GLBL_CMPY_CD = #glblCmpyCd#
      AND EZCANCELFLAG = '0'
      AND EFF_THRU_DT  &lt; #procDt#
      AND RGTN_STS_CD  IN (#rgtnStsCdPendingCompletion#, #rgtnStsCdReadyForOrderTaking#)

    </statement>

    <statement id="getAccountRelationUpdateReadyList" parameterClass="Map" resultClass="Map">
      SELECT
          DS_ACCT_RELN_PK

      FROM
          DS_ACCT_RELN

      WHERE
          GLBL_CMPY_CD = #glblCmpyCd#
      AND EZCANCELFLAG = '0'
      AND EFF_FROM_DT  &lt;= #procDt#
      AND (EFF_THRU_DT IS NULL
       OR  EFF_THRU_DT &gt; #procDt# )
      AND RGTN_STS_CD  = #rgtnStsCdPendingCompletion#

    </statement>

    <statement id="getAccountRelationUpdateTerminatedList" parameterClass="Map" resultClass="Map">
      SELECT
          DS_ACCT_RELN_PK

      FROM
          DS_ACCT_RELN

      WHERE
          GLBL_CMPY_CD = #glblCmpyCd#
      AND EZCANCELFLAG = '0'
      AND EFF_THRU_DT  &lt; #procDt#
      AND RGTN_STS_CD  IN (#rgtnStsCdPendingCompletion#, #rgtnStsCdReadyForOrderTaking#)

    </statement>

    <statement id="getContactPointsList" parameterClass="Map" resultClass="Map">
      SELECT
          DCP.DS_CTAC_PNT_PK

      FROM
          DS_CTAC_PNT       DCP
        , DS_CTAC_PSN_RELN  DCPR

      WHERE
          DCP.GLBL_CMPY_CD         = #glblCmpyCd#
      AND DCP.EZCANCELFLAG         = '0'
      AND DCP.DS_CTAC_PNT_ACTV_FLG = #dsCtacPntActvFlg#

      AND DCP.GLBL_CMPY_CD         = DCPR.GLBL_CMPY_CD
      <!-- QC#59411 Mod Start -->
      AND DCPR.EZCANCELFLAG        = '0'
      AND DCP.CTAC_PSN_PK          = DCPR.CTAC_PSN_PK
      <!-- QC#59411 Mod End -->
      AND DCPR.EFF_THRU_DT         &lt; #procDt#

    </statement>

    <statement id="getVndList" parameterClass="Map" resultClass="Map">
      SELECT
          VND_PK
        , LOC_NUM

      FROM
          VND

      WHERE
          GLBL_CMPY_CD   = #glblCmpyCd#
      AND EZCANCELFLAG   = '0'
      AND RGTN_STS_CD    = #rgtnStsCdReadyForOrderTaking#
      AND EFF_THRU_DT    &lt; #procDt#

    </statement>

    <statement id="getPtyLocWrkList" parameterClass="Map" resultClass="Map">
      SELECT
          PTY_LOC_PK

      FROM
          PTY_LOC_WRK

      WHERE
          GLBL_CMPY_CD  = #glblCmpyCd#
      AND EZCANCELFLAG  = '0'
      AND LOC_NUM       = #locNum#
      AND RGTN_STS_CD   = #rgtnStsCdReadyForOrderTaking#
      
    </statement>

    <statement id="getShipToCustList" parameterClass="Map" resultClass="Map">
      SELECT
          SHIP_TO_CUST_PK

      FROM
          SHIP_TO_CUST

      WHERE
          GLBL_CMPY_CD  = #glblCmpyCd#
      AND EZCANCELFLAG  = '0'
      AND LOC_NUM       = #locNum#
      AND RGTN_STS_CD   = #rgtnStsCdReadyForOrderTaking#

    </statement>
    
    <statement id="getBillToByLocNum" parameterClass="Map" resultClass="Map">
      SELECT
          BILL_TO_CUST_PK
      FROM
          BILL_TO_CUST
      WHERE
          GLBL_CMPY_CD  = #glblCmpyCd#
      AND EZCANCELFLAG  = '0'
      AND LOC_NUM       = #locNum#
    </statement>

    <statement id="getShipToByLocNum" parameterClass="Map" resultClass="Map">
      SELECT
          SHIP_TO_CUST_PK
      FROM
          SHIP_TO_CUST
      WHERE
          GLBL_CMPY_CD  = #glblCmpyCd#
      AND EZCANCELFLAG  = '0'
      AND LOC_NUM       = #locNum#
    </statement>
        
    <statement id="getInvRcpntByLocNum" parameterClass="Map" resultClass="Map">
      SELECT
          CUST_PK
      FROM
          INV_RCPNT
      WHERE
          GLBL_CMPY_CD  = #glblCmpyCd#
      AND EZCANCELFLAG  = '0'
      AND LOC_NUM       = #locNum#
    </statement>
    
    <statement id="getAltPayerByLocNum" parameterClass="Map" resultClass="Map">
      SELECT
          BILL_TO_CUST_CD
        , SELL_TO_CUST_CD
      FROM
          ALT_PAYER
      WHERE
          GLBL_CMPY_CD  = #glblCmpyCd#
      AND EZCANCELFLAG  = '0'
      AND LOC_NUM       = #locNum#
    </statement>
    
    <!-- START 2022/09/15 A.Cullano [QC#60368, ADD] -->
    <statement id="getLogicalRemovedAltPayer" parameterClass="Map" resultClass="Map">
      SELECT
          EZTABLEID
        , EZCANCELFLAG
        , EZINTIME
        , EZINTIMEZONE
        , EZINCOMPANYCODE
        , EZINUSERID
        , EZINAPLID
        , EZUPTIME
        , EZUPTIMEZONE
        , EZUPCOMPANYCODE
        , EZUPUSERID
        , EZUPAPLID
        , GLBL_CMPY_CD
        , SELL_TO_CUST_CD
        , BILL_TO_CUST_CD
        , FIRST_LINE_ADDR
        , SCD_LINE_ADDR
        , THIRD_LINE_ADDR
        , FRTH_LINE_ADDR
        , CTY_ADDR
        , CNTY_PK
        , PROV_NM
        , ST_CD
        , POST_CD
        , CTRY_CD
        , LOC_NUM
        , LOC_NM
        , ADDL_LOC_NM
        , GLN_NUM
        , FIRST_REF_CMNT_TXT
        , SCD_REF_CMNT_TXT
        , DBA_NM
        , DUNS_NUM
        , RGTN_STS_CD
        , FL_PLN_CMPY_FLG
        , PTY_LOC_PK
        , LOC_ROLE_TP_CD
        , LOC_GRP_CD
        , EFF_FROM_DT
        , EFF_THRU_DT
        , REM_ID
        , CMPY_PK
        , PRIN_CUST_PK
        , FAX_NUM
        , TEL_NUM
      FROM
          ALT_PAYER
      WHERE
          GLBL_CMPY_CD    = #glblCmpyCd#
      AND EZCANCELFLAG    = '1'
      AND SELL_TO_CUST_CD = #sellToCustCd#
      AND BILL_TO_CUST_CD = #billToCustCd#
    </statement>
    <!-- START 2022/09/15 A.Cullano [QC#60368, ADD] -->

    <statement id="getAcctNmByAcctNum" parameterClass="Map" resultClass="String">
      SELECT
          DS_ACCT_NM
      FROM
          SELL_TO_CUST
      WHERE
          GLBL_CMPY_CD    = #glblCmpyCd#
      AND EZCANCELFLAG    = '0'
      AND SELL_TO_CUST_CD = #dsAcctNum#
    </statement>

    <statement id="getUpdatePtyLocWrkReadyList" parameterClass="Map" resultClass="Map">
      SELECT
          PTY_LOC_PK

      FROM
          PTY_LOC_WRK

      WHERE
           GLBL_CMPY_CD = #glblCmpyCd#
       AND EZCANCELFLAG = '0'
       AND EFF_FROM_DT  &lt;= #procDt#
       AND (EFF_THRU_DT IS NULL
         OR EFF_THRU_DT &gt; #procDt# )
       AND RGTN_STS_CD  = #rgtnStsCdPendingCompletion#
    </statement>

    <statement id="getUpdatePtyLocWrkTerminatedList" parameterClass="Map" resultClass="Map">
      SELECT
          PTY_LOC_PK

      FROM
          PTY_LOC_WRK

      WHERE
          GLBL_CMPY_CD = #glblCmpyCd#
      AND EZCANCELFLAG = '0'
      AND EFF_THRU_DT  &lt; #procDt#
      AND RGTN_STS_CD  IN (#rgtnStsCdPendingCompletion#, #rgtnStsCdReadyForOrderTaking#)

    </statement>

    <statement id="getUpdateDsShipToCustList" parameterClass="Map" resultClass="Map">
        SELECT 
            SHIP.SHIP_TO_CUST_PK
        FROM 
            BILL_TO_CUST BILL
          , SHIP_TO_CUST SHIP
        WHERE
            BILL.GLBL_CMPY_CD    = #glblCmpyCd#
        AND BILL.RGTN_STS_CD    != #rgtnStsCd_P20#
        AND BILL.GLBL_CMPY_CD    = SHIP.GLBL_CMPY_CD
        AND BILL.BILL_TO_CUST_CD = SHIP.RELN_BILL_TO_CUST_CD
        AND BILL.EZCANCELFLAG    = '0'
        AND SHIP.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getUpdateDsCustTrxRuleForDeleteDefBillToList" parameterClass="Map" resultClass="Map">
        SELECT 
            RULE.DS_CUST_TRX_RULE_PK
        FROM 
            BILL_TO_CUST     BILL
          , DS_CUST_TRX_RULE RULE
        WHERE
            BILL.GLBL_CMPY_CD    = #glblCmpyCd#
        AND BILL.RGTN_STS_CD    != #rgtnStsCd_P20#
        AND BILL.GLBL_CMPY_CD    = RULE.GLBL_CMPY_CD
        AND BILL.BILL_TO_CUST_CD = RULE.DS_DEF_BILL_TO_CD
        AND BILL.EZCANCELFLAG    = '0'
        AND RULE.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getUpdateDsCustTrxRuleForDeleteDefShipToList" parameterClass="Map" resultClass="Map">
        SELECT 
            RULE.DS_CUST_TRX_RULE_PK
        FROM 
            SHIP_TO_CUST     SHIP
          , DS_CUST_TRX_RULE RULE
        WHERE
            SHIP.GLBL_CMPY_CD    = #glblCmpyCd#
        AND SHIP.RGTN_STS_CD    != #rgtnStsCd_P20#
        AND SHIP.GLBL_CMPY_CD    = RULE.GLBL_CMPY_CD
        AND SHIP.SHIP_TO_CUST_CD = RULE.DS_DEF_SHIP_TO_CD
        AND SHIP.EZCANCELFLAG    = '0'
        AND RULE.EZCANCELFLAG    = '0'
    </statement>

    <!-- START 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
    <statement id="getAcctCmpyPkByAcctNum" parameterClass="Map" resultClass="BigDecimal">
      SELECT
          CMPY_PK
      FROM
          SELL_TO_CUST
      WHERE
          GLBL_CMPY_CD    = #glblCmpyCd#
      AND EZCANCELFLAG    = '0'
      AND SELL_TO_CUST_CD = #dsAcctNum#
    </statement>
    <!-- END 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->

    <!-- START 2022/04/28 QC#59983 -->
    <statement id="getCustomerSelectOpenTrx" parameterClass="Map" resultClass="BigDecimal">
    SELECT
        SUM(COUNT) AS COUNT
    FROM
        (SELECT
              COUNT(*) AS COUNT
         FROM
             CPO C
         WHERE
             C.GLBL_CMPY_CD            = #glblCmpyCd#
             AND C.EZCANCELFLAG        = '0'
             AND C.OPEN_FLG            = #openFlg#
             <isNotNull property="billToCustCd">
             AND C.BILL_TO_CUST_CD     = #billToCustCd#
             </isNotNull>
             <isNotNull property="shipToCustCd">
             AND C.ADD_SHIP_TO_CUST_CD     = #shipToCustCd#
             </isNotNull>
         UNION ALL
         SELECT
              COUNT(*) AS COUNT
         FROM
             CPO C
            ,CPO_DTL CD
            ,DS_CPO_CONFIG DCC
         WHERE
             C.GLBL_CMPY_CD            = #glblCmpyCd#
             AND C.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
             AND C.GLBL_CMPY_CD        = DCC.GLBL_CMPY_CD
             AND C.EZCANCELFLAG        = '0'
             AND CD.EZCANCELFLAG       = '0'
             AND DCC.EZCANCELFLAG      = '0'
             AND C.CPO_ORD_NUM         = CD.CPO_ORD_NUM
             AND C.CPO_ORD_NUM         = DCC.CPO_ORD_NUM
             AND DCC.DS_CPO_CONFIG_PK  = CD.DS_CPO_CONFIG_PK
             AND C.OPEN_FLG            = #openFlg#
             AND CD.OPEN_FLG           = C.OPEN_FLG
             <isNotNull property="billToCustCd">
             AND DCC.BILL_TO_CUST_ACCT_CD     = #billToCustCd#
             </isNotNull>
             <isNotNull property="shipToCustCd">
             AND DCC.SHIP_TO_CUST_LOC_CD      = #shipToCustCd#
             </isNotNull>
         UNION ALL
         SELECT COUNT(*) AS COUNT
         FROM CPO C
            , DS_CPO_CONFIG   DCC
            , DS_CPO_RTRN_DTL DCRD
         WHERE
             C.GLBL_CMPY_CD            = #glblCmpyCd#
             AND C.GLBL_CMPY_CD        = DCRD.GLBL_CMPY_CD
             AND C.GLBL_CMPY_CD        = DCC.GLBL_CMPY_CD
             AND C.EZCANCELFLAG        = '0'
             AND DCRD.EZCANCELFLAG     = '0'
             AND DCC.EZCANCELFLAG      = '0'
             AND C.CPO_ORD_NUM         = DCRD.CPO_ORD_NUM
             AND C.CPO_ORD_NUM         = DCC.CPO_ORD_NUM
             AND DCC.DS_CPO_CONFIG_PK  = DCRD.DS_CPO_CONFIG_PK
             AND C.OPEN_FLG            = #openFlg#
             AND DCRD.OPEN_FLG         = C.OPEN_FLG
             <isNotNull property="billToCustCd">
             AND DCC.BILL_TO_CUST_LOC_CD     = #billToCustCd#
             </isNotNull>
             <isNotNull property="shipToCustCd">
             AND DCC.SHIP_TO_CUST_LOC_CD     = #shipToCustCd#
             </isNotNull>
         UNION ALL
         SELECT COUNT(*) AS COUNT
         FROM SVC_TASK ST
            , FSR      F
         WHERE ST.GLBL_CMPY_CD           = #glblCmpyCd#
           AND ST.EZCANCELFLAG           = '0'
           AND ST.SVC_TASK_STS_CD NOT IN (#svcTaskStsClosed#, #svcTaskStsCancelled#)
           AND ST.GLBL_CMPY_CD           = F.GLBL_CMPY_CD
           AND ST.FSR_NUM                = F.FSR_NUM
           AND F.EZCANCELFLAG            = '0'
           AND F.GLBL_CMPY_CD            = ST.GLBL_CMPY_CD
           <isNotNull property="billToCustCd">
           AND F.BILL_TO_CUST_CD         = #billToCustCd#
           </isNotNull>
           <isNotNull property="shipToCustCd">
           AND F.SHIP_TO_CUST_CD         = #shipToCustCd#
           </isNotNull>
         UNION ALL
         SELECT COUNT(*) AS COUNT
         FROM SVC_MACH_MSTR SMM
         WHERE SMM.GLBL_CMPY_CD           = #glblCmpyCd#
           AND SMM.EZCANCELFLAG           = '0'
           AND SMM.SVC_MACH_TP_CD = #svcMachTpMachine#
           AND SMM.SVC_MACH_MSTR_STS_CD IN (#w4i#, #instl#, #w4r#, #dlrsv#)
           <isNotNull property="billToCustCd">
           AND SMM.BILL_TO_LOC_NUM        = #billToCustCd#
           </isNotNull>
           <isNotNull property="shipToCustCd">
           AND SMM.CUR_LOC_NUM            = #shipToCustCd#
           </isNotNull>
         <isNotNull property="billToCustCd">
         UNION ALL
         SELECT COUNT(*) AS COUNT
         FROM DS_CONTR DCR
            , DS_CONTR_STS_V DCSV
            , DS_CONTR_DTL   DCD
            , DS_CONTR_BLLG_SCHD DCBS
     WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
       AND DCR.EZCANCELFLAG  = '0'
       AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
       AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
       AND DCSV.EZCANCELFLAG = '0'
       AND DCSV.ETTL_AVAL_FLG = #flgY#
       AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
       AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
       AND DCR.DS_CONTR_PK  = DCD.DS_CONTR_PK
       AND DCD.EZCANCELFLAG = '0'
       AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
       AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
       AND DCBS.EZCANCELFLAG = '0'
       AND DCBS.INV_FLG  = #flgN#
       AND DCR.ALT_PAYER_CUST_CD = #billToCustCd#
       </isNotNull>
       <isNotNull property="shipToCustCd">
    UNION ALL
    SELECT COUNT(*) AS COUNT
      FROM DS_CONTR_DTL   DCD
         , DS_CONTR_STS_V DCSV
         , DS_CONTR_BLLG_SCHD DCBS
         , (SELECT * FROM LATERAL(
                SELECT HH.GLBL_CMPY_CD
                     , HH.SVC_MACH_MSTR_PK
                     , HH.CUR_LOC_ACCT_NUM
                     , HH.CUR_LOC_NUM
                     , ROW_NUMBER() OVER (
                         PARTITION BY HH.SVC_MACH_MSTR_PK
                         ORDER BY HH.SVC_MACH_MSTR_PK
                                , HH.HIST_CRAT_TS DESC
                     ) RANK_NUM
                  FROM SVC_MACH_MSTR_HIST H
                     , SVC_MACH_MSTR_HIST HH
                 WHERE H.GLBL_CMPY_CD = #glblCmpyCd#
                   AND H.SVC_MACH_MSTR_STS_CD IN (#w4i#, #instl#, #w4r#)
                   AND H.EZCANCELFLAG = '0'
                   AND H.CUR_LOC_NUM = #shipToCustCd#
                   AND H.GLBL_CMPY_CD = HH.GLBL_CMPY_CD
                   AND H.SVC_MACH_MSTR_PK = HH.SVC_MACH_MSTR_PK
                   AND HH.EZCANCELFLAG = '0'
                 ) LH
                 WHERE LH.RANK_NUM= 1
           ) SMM
     WHERE DCD.GLBL_CMPY_CD = #glblCmpyCd#
       AND DCD.EZCANCELFLAG = '0'
       AND DCD.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
       AND DCD.DS_CONTR_PK  = DCSV.DS_CONTR_PK
       AND DCSV.EZCANCELFLAG = '0'
       AND DCSV.ETTL_AVAL_FLG = #flgY#
       AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
       AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
       AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
       AND DCBS.EZCANCELFLAG = '0'
       AND DCBS.INV_FLG = #flgN#
       AND DCD.GLBL_CMPY_CD = SMM.GLBL_CMPY_CD
       AND DCD.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
       AND SMM.CUR_LOC_NUM = #shipToCustCd#
       </isNotNull>
       <isNotNull property="billToCustCd">
    UNION ALL
    SELECT COUNT(*) AS COUNT
      FROM DS_CONTR       DCR
         , DS_CONTR_STS_V DCSV
         , DS_CONTR_DTL   DCD
         , DS_CONTR_BLLG_SCHD DCBS
     WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
       AND DCR.EZCANCELFLAG  = '0'
       AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
       AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
       AND DCSV.EZCANCELFLAG = '0'
       AND DCSV.ETTL_AVAL_FLG = #flgY#
       AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
       AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
       AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
       AND DCD.EZCANCELFLAG = '0'
       AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
       AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
       AND DCBS.EZCANCELFLAG = '0'
       AND DCBS.INV_FLG  = #flgN#
       AND DCD.BASE_BILL_TO_CUST_CD = #billToCustCd#
    UNION ALL
    SELECT COUNT(*) AS COUNT
      FROM DS_CONTR       DCR
         , DS_CONTR_STS_V DCSV
         , DS_CONTR_DTL   DCD
         , DS_CONTR_BLLG_SCHD DCBS
         , DS_CONTR_BLLG_MTR DCBM
     WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
       AND DCR.EZCANCELFLAG  = '0'
       AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
       AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
       AND DCSV.EZCANCELFLAG = '0'
       AND DCSV.ETTL_AVAL_FLG = #flgY#
       AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
       AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
       AND DCR.DS_CONTR_PK  = DCD.DS_CONTR_PK
       AND DCD.EZCANCELFLAG = '0'
       AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
       AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
       AND DCBS.EZCANCELFLAG = '0'
       AND DCBS.INV_FLG  = #flgN#
       AND DCD.GLBL_CMPY_CD = DCBM.GLBL_CMPY_CD
       AND DCD.DS_CONTR_DTL_PK = DCBM.DS_CONTR_DTL_PK
       AND DCBM.EZCANCELFLAG = '0'
       AND DCBM.BLLG_MTR_BILL_TO_CUST_CD = #billToCustCd#
    UNION ALL
    SELECT COUNT(*) AS COUNT
      FROM DS_CONTR       DCR
         , DS_CONTR_STS_V DCSV
         , DS_CONTR_DTL   DCD
         , DS_CONTR_BLLG_SCHD DCBS
     WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
       AND DCR.EZCANCELFLAG  = '0'
       AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
       AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
       AND DCSV.EZCANCELFLAG = '0'
       AND DCSV.ETTL_AVAL_FLG = #flgN#
       AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
       AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
       AND DCR.DS_CONTR_PK  = DCD.DS_CONTR_PK
       AND DCD.EZCANCELFLAG = '0'
       AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
       AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
       AND DCBS.EZCANCELFLAG = '0'
       AND DCBS.INV_FLG  = #flgN#
       AND DCR.ALT_PAYER_CUST_CD = #billToCustCd#
       </isNotNull>
       <isNotNull property="shipToCustCd">
    UNION ALL
    SELECT COUNT(*) AS COUNT
      FROM DS_CONTR_DTL   DCD
         , DS_CONTR_STS_V DCSV
         , DS_CONTR_BLLG_SCHD DCBS
         , (
            SELECT * FROM (
                SELECT H.GLBL_CMPY_CD
                     , H.SVC_MACH_MSTR_PK
                     , H.CUR_LOC_ACCT_NUM
                     , H.CUR_LOC_NUM
                     , ROW_NUMBER() OVER (
                         PARTITION BY H.SVC_MACH_MSTR_PK
                         ORDER BY H.SVC_MACH_MSTR_PK
                                , H.HIST_CRAT_TS DESC
                     ) RANK_NUM
                  FROM SVC_MACH_MSTR_HIST H
                 WHERE H.GLBL_CMPY_CD = #glblCmpyCd#
                   AND H.SVC_MACH_MSTR_STS_CD IN (#w4i#, #instl#, #w4r#)
                   AND H.EZCANCELFLAG = '0'
                ) LH
                WHERE LH.RANK_NUM= 1
           ) SMM
     WHERE DCD.GLBL_CMPY_CD = #glblCmpyCd#
       AND DCD.EZCANCELFLAG = '0'
       AND DCD.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
       AND DCD.DS_CONTR_PK  = DCSV.DS_CONTR_PK
       AND DCSV.EZCANCELFLAG = '0'
       AND DCSV.ETTL_AVAL_FLG = #flgN#
       AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
       AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
       AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
       AND DCBS.EZCANCELFLAG = '0'
       AND DCBS.INV_FLG = #flgN#
       AND DCD.GLBL_CMPY_CD = SMM.GLBL_CMPY_CD
       AND DCD.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
       AND SMM.CUR_LOC_NUM = #shipToCustCd#
       </isNotNull>
       <isNotNull property="billToCustCd">
    UNION ALL
    SELECT COUNT(*) AS COUNT
      FROM DS_CONTR       DCR
         , DS_CONTR_STS_V DCSV
         , DS_CONTR_DTL   DCD
         , DS_CONTR_BLLG_SCHD DCBS
     WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
       AND DCR.EZCANCELFLAG  = '0'
       AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
       AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
       AND DCSV.EZCANCELFLAG = '0'
       AND DCSV.ETTL_AVAL_FLG = #flgN#
       AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
       AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
       AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
       AND DCD.EZCANCELFLAG = '0'
       AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
       AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
       AND DCBS.EZCANCELFLAG = '0'
       AND DCBS.INV_FLG  = #flgN#
       AND DCD.BASE_BILL_TO_CUST_CD = #billToCustCd#
    UNION ALL
    SELECT COUNT(*) AS COUNT
      FROM DS_CONTR       DCR
         , DS_CONTR_STS_V DCSV
         , DS_CONTR_DTL   DCD
         , DS_CONTR_BLLG_SCHD DCBS
         , DS_CONTR_BLLG_MTR DCBM
     WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
       AND DCR.EZCANCELFLAG  = '0'
       AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
       AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
       AND DCSV.EZCANCELFLAG = '0'
       AND DCSV.ETTL_AVAL_FLG = #flgN#
       AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
       AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
       AND DCR.DS_CONTR_PK  = DCD.DS_CONTR_PK
       AND DCD.EZCANCELFLAG = '0'
       AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
       AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
       AND DCBS.EZCANCELFLAG = '0'
       AND DCBS.INV_FLG  = #flgN#
       AND DCD.GLBL_CMPY_CD = DCBM.GLBL_CMPY_CD
       AND DCD.DS_CONTR_DTL_PK = DCBM.DS_CONTR_DTL_PK
       AND DCBM.EZCANCELFLAG = '0'
       AND DCBM.BLLG_MTR_BILL_TO_CUST_CD = #billToCustCd#
       </isNotNull>
        )
    </statement>
    <!-- END 2022/04/28 QC#59983 -->
</sqlMap>
    