<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLCB004001">

    <statement id="getPiList" parameterClass="Map">
        SELECT
            PIC.PHYS_INVTY_CTRL_PK
           ,PIC.PHYS_INVTY_NUM
           ,PIC.RTL_WH_CD
           ,RH.EFF_FROM_DT
           ,NVL(RH.EFF_THRU_DT,'99991231') EFF_THRU_DT
           ,PIC.RTL_SWH_CD
        FROM
            PHYS_INVTY_CTRL PIC
           ,RTL_WH          RH
        WHERE
            PIC.GLBL_CMPY_CD      = #glblCmpyCd#
        AND PIC.PHYS_INVTY_DT     = #physInvtyDt#
        AND PIC.PHYS_INVTY_STS_CD = #physInvtyStsCd#
        AND PIC.RTL_WH_CD         = RH.RTL_WH_CD
        AND PIC.GLBL_CMPY_CD      = RH.GLBL_CMPY_CD
    <iterate property="whLocTpCdList" var="elem[]" open="AND PIC.LOC_TP_CD IN (" close=") " conjunction=",">
        #elem[]#
    </iterate>
        AND PIC.EZCANCELFLAG      = '0'
        AND RH.EZCANCELFLAG       = '0'
        ORDER BY
            PIC.PHYS_INVTY_NUM
           ,PIC.WH_CD
    </statement>

    <statement id="checkOpenPi" parameterClass="Map" resultClass="String">
        SELECT
            PIC.PHYS_INVTY_CTRL_PK
        FROM 
            PHYS_INVTY_CTRL PIC
        WHERE 1 = 1
        AND PIC.GLBL_CMPY_CD        = #glblCmpyCd#
        AND PIC.RTL_WH_CD           = #rtlWhCd#
        AND PIC.RTL_SWH_CD          = #rtlSwhCd#
        AND PIC.PHYS_INVTY_CTRL_PK != #physInvtyCtrlPk#
        AND PIC.PHYS_INVTY_STS_CD   = #physInvtyStsCd#
        AND PIC.EZCANCELFLAG        = '0'
        AND ROWNUM                  = 1
    </statement>
</sqlMap>
