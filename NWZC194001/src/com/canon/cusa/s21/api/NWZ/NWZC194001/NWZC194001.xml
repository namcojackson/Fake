<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWZC194001">

    <typeAlias alias="SCHD_AGMT_ADJ_CONTRTMsg" type="business.db.SCHD_AGMT_ADJ_CONTRTMsg"/>

    <statement id="getSchdAgmtAdjTgt" parameterClass="Map" resultMap="result.getSchdAgmtAdjTgt">
        <isEqual property="schdAgmtAdjTpCd" compareValue="EXCH">
        WITH EXCH_MACH AS (
            SELECT
                 SVC_MACH_EXCH_TRK_PK
                ,ORIG_SVC_MACH_MSTR_PK
                ,EXCH_SVC_MACH_MSTR_PK
                ,ORIG_DS_CONTR_DTL_PK
                ,EXCH_DS_CONTR_DTL_PK
            FROM
                SVC_MACH_EXCH_TRK X
            WHERE
                    X.GLBL_CMPY_CD              = #glblCmpyCd#
                AND X.EZCANCELFLAG              = '0'
                AND X.EXCH_SVC_MACH_MSTR_PK     = #svcMachMstrPk#
        )
        </isEqual>
        SELECT
             D.GLBL_CMPY_CD
            ,D.SCHD_AGMT_NUM
            ,D.DS_CONTR_NUM
            ,D.SVC_CONFIG_MSTR_PK
            ,D.SER_NUM
            ,D.SCHD_AGMT_VLD_FROM_DT AS ORIG_VLD_FROM_DT
            ,D.SCHD_AGMT_VLD_THRU_DT AS ORIG_VLD_THRU_DT
            ,D.SCHD_AGMT_VLD_FROM_DT AS CHNG_VLD_FROM_DT
            <isEqual property="schdAgmtAdjTpCd" compareValue="RNEW">
            ,B.CONTR_EFF_THRU_DT     AS CHNG_VLD_THRU_DT
            </isEqual>
            <isEqual property="schdAgmtAdjTpCd" compareValue="TERM">
            ,B.CONTR_CLO_DT          AS CHNG_VLD_THRU_DT
            </isEqual>
            <isEqual property="schdAgmtAdjTpCd" compareValue="EXCH">
            ,D.SCHD_AGMT_VLD_THRU_DT AS CHNG_VLD_THRU_DT
            </isEqual>
            ,#schdAgmtAdjTpCd#       AS SCHD_AGMT_ADJ_TP_CD
            ,#stsUnprocessed#        AS SCHD_AGMT_ADJ_STS_CD
            <isEqual property="schdAgmtAdjTpCd" compareValue="EXCH">
            ,E.SVC_MACH_EXCH_TRK_PK
            ,E.ORIG_SVC_MACH_MSTR_PK
            ,E.EXCH_SVC_MACH_MSTR_PK
            ,E.ORIG_DS_CONTR_DTL_PK
            ,E.EXCH_DS_CONTR_DTL_PK
            ,D.BILL_TO_CUST_LOC_CD   AS ORIG_BILL_TO_CUST_LOC_CD
            ,F.BILL_TO_LOC_NUM       AS EXCH_BILL_TO_CUST_LOC_CD
            ,D.SHIP_TO_CUST_LOC_CD   AS ORIG_SHIP_TO_CUST_LOC_CD
            ,F.CUR_LOC_NUM           AS EXCH_SHIP_TO_CUST_LOC_CD
            ,D.SOLD_TO_CUST_LOC_CD   AS ORIG_SLD_TO_CUST_LOC_CD
            ,F.BILL_TO_LOC_NUM       AS EXCH_SLD_TO_CUST_LOC_CD
            </isEqual>
        FROM
            DS_CONTR            A
           ,DS_CONTR_DTL        B
           ,SVC_MACH_MSTR       C
           ,SCHD_AGMT           D
           <isEqual property="schdAgmtAdjTpCd" compareValue="EXCH">
           ,EXCH_MACH           E
           ,SVC_MACH_MSTR       F
           </isEqual>
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND B.EZCANCELFLAG          = '0'
            AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND C.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = D.GLBL_CMPY_CD
            AND D.EZCANCELFLAG          = '0'
            AND A.DS_CONTR_PK           = B.DS_CONTR_PK
            <isNotEqual property="schdAgmtAdjTpCd" compareValue="EXCH">
            AND A.DS_CONTR_PK           = #dsContrPk#
            AND C.SVC_MACH_TP_CD        = #svcMachTpCd#
            AND C.SVC_MACH_MSTR_PK      = #svcMachMstrPk#
            </isNotEqual>
            <isEqual property="schdAgmtAdjTpCd" compareValue="EXCH">
            AND B.SVC_MACH_MSTR_PK      = E.ORIG_SVC_MACH_MSTR_PK
            AND E.EXCH_SVC_MACH_MSTR_PK = F.SVC_MACH_MSTR_PK
            AND F.SVC_MACH_TP_CD        = #svcMachTpCd#
            </isEqual>
            AND B.SVC_MACH_MSTR_PK      = C.SVC_MACH_MSTR_PK
            AND A.DS_CONTR_NUM          = D.DS_CONTR_NUM
            AND B.SVC_CONFIG_MSTR_PK    = D.SVC_CONFIG_MSTR_PK
    </statement>

    <resultMap id="result.getSchdAgmtAdjTgt" class="SCHD_AGMT_ADJ_CONTRTMsg">
        <result property="glblCmpyCd"           column="GLBL_CMPY_CD"             javaType="EZDSStringItem"/>
        <result property="schdAgmtNum"          column="SCHD_AGMT_NUM"            javaType="EZDSStringItem"/>
        <result property="dsContrNum"           column="DS_CONTR_NUM"             javaType="EZDSStringItem"/>
        <result property="svcConfigMstrPk"      column="SVC_CONFIG_MSTR_PK"       javaType="EZDSBigDecimalItem"/>
        <result property="serNum"               column="SER_NUM"                  javaType="EZDSStringItem"/>
        <result property="origVldFromDt"        column="ORIG_VLD_FROM_DT"         javaType="EZDSStringItem"/>
        <result property="origVldThruDt"        column="ORIG_VLD_THRU_DT"         javaType="EZDSStringItem"/>
        <result property="chngVldFromDt"        column="CHNG_VLD_FROM_DT"         javaType="EZDSStringItem"/>
        <result property="chngVldThruDt"        column="CHNG_VLD_THRU_DT"         javaType="EZDSStringItem"/>
        <result property="schdAgmtAdjTpCd"      column="SCHD_AGMT_ADJ_TP_CD"      javaType="EZDSStringItem"/>
        <result property="schdAgmtAdjStsCd"     column="SCHD_AGMT_ADJ_STS_CD"     javaType="EZDSStringItem"/>
        <result property="svcMachExchTrkPk"     column="SVC_MACH_EXCH_TRK_PK"     javaType="EZDSBigDecimalItem"/>
        <result property="origSvcMachMstrPk"    column="ORIG_SVC_MACH_MSTR_PK"    javaType="EZDSBigDecimalItem"/>
        <result property="exchSvcMachMstrPk"    column="EXCH_SVC_MACH_MSTR_PK"    javaType="EZDSBigDecimalItem"/>
        <result property="origDsContrDtlPk"     column="ORIG_DS_CONTR_DTL_PK"     javaType="EZDSBigDecimalItem"/>
        <result property="exchDsContrDtlPk"     column="EXCH_DS_CONTR_DTL_PK"     javaType="EZDSBigDecimalItem"/>
        <result property="origBillToCustLocCd"  column="ORIG_BILL_TO_CUST_LOC_CD" javaType="EZDSStringItem"/>
        <result property="exchBillToCustLocCd"  column="EXCH_BILL_TO_CUST_LOC_CD" javaType="EZDSStringItem"/>
        <result property="origShipToCustLocCd"  column="ORIG_SHIP_TO_CUST_LOC_CD" javaType="EZDSStringItem"/>
        <result property="exchShipToCustLocCd"  column="EXCH_SHIP_TO_CUST_LOC_CD" javaType="EZDSStringItem"/>
        <result property="origSldToCustLocCd"   column="ORIG_SLD_TO_CUST_LOC_CD"  javaType="EZDSStringItem"/>
        <result property="exchSldToCustLocCd"   column="EXCH_SLD_TO_CUST_LOC_CD"  javaType="EZDSStringItem"/>
    </resultMap>

</sqlMap>
