<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL2710Query">

    <statement id="getTrtyRuleForPostal" parameterClass="Map" resultClass="Map">
        SELECT
            TRTY_RULE_POST_INFO.ORG_CD                       AS ORG_CD
            ,TRTY_RULE_POST_INFO.ORG_NM                      AS ORG_NM
            ,TRTY_RULE_POST_INFO.ORG_DESC_TXT                AS ORG_DESC_TXT
            ,TRTY_RULE_POST_INFO.BIZ_AREA_ORG_CD             AS BIZ_AREA_ORG_CD
            ,TRTY_RULE_POST_INFO.BIZ_AREA_ORG_DESC_TXT       AS BIZ_AREA_ORG_DESC_TXT
            ,TRTY_RULE_POST_INFO.TRTY_RULE_PK                AS TRTY_RULE_PK
            ,TRTY_RULE_POST_INFO.TRTY_RULE_FROM_VAL_TXT      AS TRTY_RULE_FROM_VAL_TXT
            ,TRTY_RULE_POST_INFO.TRTY_RULE_THRU_VAL_TXT      AS TRTY_RULE_THRU_VAL_TXT
            ,TRTY_RULE_POST_INFO.EFF_FROM_DT                 AS EFF_FROM_DT
            ,TRTY_RULE_POST_INFO.EFF_THRU_DT                 AS EFF_THRU_DT
            ,TRTY_RULE_POST_INFO.TRTY_GRP_TP_CD              AS TRTY_GRP_TP_CD
            ,TRTY_RULE_POST_INFO.TRTY_GRP_TP_DESC_TXT        AS TRTY_GRP_TP_DESC_TXT
            ,TRTY_RULE_POST_INFO.TRTY_RULE_OPRD_TP_CD        AS TRTY_RULE_OPRD_TP_CD
            ,TRTY_RULE_POST_INFO.TRTY_RULE_OPRD_TP_DESC_TXT  AS TRTY_RULE_OPRD_TP_DESC_TXT
            ,TRTY_RULE_POST_INFO.TRTY_RULE_LOGIC_TP_CD       AS TRTY_RULE_LOGIC_TP_CD
            ,TRTY_RULE_POST_INFO.TRTY_RULE_LOGIC_TP_DESC_TXT AS TRTY_RULE_LOGIC_TP_DESC_TXT
        FROM
            (SELECT
                OU.ORG_CD                       AS ORG_CD
                ,OU.ORG_NM                      AS ORG_NM
                ,OU.ORG_DESC_TXT                AS ORG_DESC_TXT
                ,AO.BIZ_AREA_ORG_CD             AS BIZ_AREA_ORG_CD
                ,AO.BIZ_AREA_ORG_DESC_TXT       AS BIZ_AREA_ORG_DESC_TXT
                ,TR.TRTY_RULE_PK                AS TRTY_RULE_PK
                ,TR.TRTY_RULE_FROM_VAL_TXT      AS TRTY_RULE_FROM_VAL_TXT
                ,CASE WHEN LENGTH(TR.TRTY_RULE_FROM_VAL_TXT) &lt;= 5
                     THEN RPAD(REPLACE(TR.TRTY_RULE_FROM_VAL_TXT,'%',''),9,'0')
                     WHEN LENGTH(TR.TRTY_RULE_FROM_VAL_TXT) &lt;= 10
                     THEN RPAD(REPLACE(REPLACE(TR.TRTY_RULE_FROM_VAL_TXT,'%',''),'-',''),9,'0')
                     ELSE '' 
                     END                        AS MODIFICATION_FROM_VAL_TXT
                ,TR.TRTY_RULE_THRU_VAL_TXT      AS TRTY_RULE_THRU_VAL_TXT
                ,CASE WHEN TR.TRTY_RULE_THRU_VAL_TXT IS NULL
                     THEN RPAD(REPLACE(REPLACE(TR.TRTY_RULE_FROM_VAL_TXT,'%',''),'-',''),9,'9')
                     WHEN LENGTH(TR.TRTY_RULE_THRU_VAL_TXT) &lt;= 5
                     THEN RPAD(REPLACE(TR.TRTY_RULE_THRU_VAL_TXT,'%',''),9,'9')
                     WHEN LENGTH(TR.TRTY_RULE_THRU_VAL_TXT) &lt;= 10
                     THEN RPAD(REPLACE(REPLACE(TR.TRTY_RULE_THRU_VAL_TXT,'%',''),'-',''),9,'9')
                     ELSE '' 
                     END                        AS MODIFICATION_THRU_VAL_TXT
                ,TR.EFF_FROM_DT                 AS EFF_FROM_DT
                ,TR.EFF_THRU_DT                 AS EFF_THRU_DT
                ,GT.TRTY_GRP_TP_CD              AS TRTY_GRP_TP_CD
                ,GT.TRTY_GRP_TP_DESC_TXT        AS TRTY_GRP_TP_DESC_TXT
                ,OT.TRTY_RULE_OPRD_TP_CD        AS TRTY_RULE_OPRD_TP_CD
                ,OT.TRTY_RULE_OPRD_TP_DESC_TXT  AS TRTY_RULE_OPRD_TP_DESC_TXT
                ,LT.TRTY_RULE_LOGIC_TP_CD       AS TRTY_RULE_LOGIC_TP_CD
                ,LT.TRTY_RULE_LOGIC_TP_DESC_TXT AS TRTY_RULE_LOGIC_TP_DESC_TXT
            FROM
                DS_ORG_UNIT         OU
                ,ORG_STRU_TP        ST
                ,BIZ_AREA_ORG       AO
                ,TRTY_RULE          TR
                ,TRTY_GRP_TP        GT
                ,TRTY_RULE_OPRD_TP  OT
                ,TRTY_RULE_LOGIC_TP LT
            WHERE
                OU.GLBL_CMPY_CD          = #glblCmpyCd#
            AND OU.EZCANCELFLAG          = '0'
            <isNotNull property="orgNm">
            AND OU.ORG_NM                LIKE #orgNm#
            </isNotNull>
            AND OU.GLBL_CMPY_CD          = ST.GLBL_CMPY_CD
            AND OU.EFF_FROM_DT           &lt;= #salesDate#
            AND (OU.EFF_THRU_DT           &gt;= #salesDate#
                OR OU.EFF_THRU_DT        IS NULL)
            AND ST.EZCANCELFLAG          = '0'
            AND OU.ORG_STRU_TP_CD        = ST.ORG_STRU_TP_CD
            AND ST.TRTY_STRU_FLG         = #trtyStruFlgY#
            AND OU.GLBL_CMPY_CD          = AO.GLBL_CMPY_CD
            AND AO.EZCANCELFLAG          = '0'
            AND OU.FIRST_ORG_CD          = AO.BIZ_AREA_ORG_CD
            <isNotNull property="bizAreaOrgCd">
            AND AO.BIZ_AREA_ORG_CD       = #bizAreaOrgCd#
            </isNotNull>
            AND OU.ORG_STRU_TP_CD        = AO.ORG_STRU_TP_CD
            AND OU.GLBL_CMPY_CD          = TR.GLBL_CMPY_CD
            AND TR.EZCANCELFLAG          = '0'
            AND OU.ORG_STRU_TP_CD        = TR.ORG_STRU_TP_CD
            AND OU.ORG_CD                = TR.ORG_CD
            AND TR.TRTY_RULE_TP_CD       = #trtyRuleTpPost#
            AND TR.EFF_FROM_DT           &lt;= #salesDate#
            AND (TR.EFF_THRU_DT           &gt;= #salesDate#
                OR TR.EFF_THRU_DT        IS NULL)
            AND OU.GLBL_CMPY_CD          = GT.GLBL_CMPY_CD
            AND GT.EZCANCELFLAG          = '0'
            AND OU.TRTY_GRP_TP_CD        = GT.TRTY_GRP_TP_CD
            <isNotNull property="trtyGrpTpCd">
            AND GT.TRTY_GRP_TP_CD        = #trtyGrpTpCd#
            </isNotNull>
            AND TR.GLBL_CMPY_CD          = OT.GLBL_CMPY_CD
            AND OT.EZCANCELFLAG          = '0'
            AND TR.TRTY_RULE_OPRD_TP_CD  = OT.TRTY_RULE_OPRD_TP_CD
            AND TR.GLBL_CMPY_CD          = LT.GLBL_CMPY_CD
            AND LT.EZCANCELFLAG          = '0'
            AND TR.TRTY_RULE_LOGIC_TP_CD = LT.TRTY_RULE_LOGIC_TP_CD
            ORDER BY
                OU.ORG_NM
            ) TRTY_RULE_POST_INFO
        WHERE
            ROWNUM                                        &lt;= #rowNum#
        <isNotNull property="trtyRuleFromValTxt">
        AND TRTY_RULE_POST_INFO.MODIFICATION_THRU_VAL_TXT &gt;= #trtyRuleFromValTxt#
        </isNotNull>
        <isNotNull property="trtyRuleThruValTxt">
        AND TRTY_RULE_POST_INFO.MODIFICATION_FROM_VAL_TXT &lt;= #trtyRuleThruValTxt#
        </isNotNull>
    </statement>

    <statement id="getPostalRuleForDownload" parameterClass="Map" resultClass="Map">
        SELECT
            TRTY_RULE_POST_INFO.ORG_NM                       AS ORG_NM
            ,TRTY_RULE_POST_INFO.TRTY_RULE_FROM_VAL_TXT      AS TRTY_RULE_FROM_VAL_TXT
            ,TRTY_RULE_POST_INFO.TRTY_RULE_THRU_VAL_TXT      AS TRTY_RULE_THRU_VAL_TXT
            ,TRTY_RULE_POST_INFO.TRTY_RULE_OPRD_TP_DESC_TXT  AS TRTY_RULE_OPRD_TP_DESC_TXT
        FROM
            (SELECT
                OU.ORG_CD                       AS ORG_CD
                ,OU.ORG_NM                      AS ORG_NM
                ,OU.ORG_DESC_TXT                AS ORG_DESC_TXT
                ,AO.BIZ_AREA_ORG_CD             AS BIZ_AREA_ORG_CD
                ,AO.BIZ_AREA_ORG_DESC_TXT       AS BIZ_AREA_ORG_DESC_TXT
                ,TR.TRTY_RULE_PK                AS TRTY_RULE_PK
                ,TR.TRTY_RULE_FROM_VAL_TXT      AS TRTY_RULE_FROM_VAL_TXT
                ,CASE WHEN LENGTH(TR.TRTY_RULE_FROM_VAL_TXT) &lt;= 5
                     THEN RPAD(REPLACE(TR.TRTY_RULE_FROM_VAL_TXT,'%',''),9,'0')
                     WHEN LENGTH(TR.TRTY_RULE_FROM_VAL_TXT) &lt;= 10
                     THEN RPAD(REPLACE(REPLACE(TR.TRTY_RULE_FROM_VAL_TXT,'%',''),'-',''),9,'0')
                     ELSE ''
                     END                        AS MODIFICATION_FROM_VAL_TXT
                ,TR.TRTY_RULE_THRU_VAL_TXT      AS TRTY_RULE_THRU_VAL_TXT
                ,CASE WHEN TR.TRTY_RULE_THRU_VAL_TXT IS NULL
                     THEN RPAD(REPLACE(REPLACE(TR.TRTY_RULE_FROM_VAL_TXT,'%',''),'-',''),9,'9')
                     WHEN LENGTH(TR.TRTY_RULE_THRU_VAL_TXT) &lt;= 5
                     THEN RPAD(REPLACE(TR.TRTY_RULE_THRU_VAL_TXT,'%',''),9,'9')
                     WHEN LENGTH(TR.TRTY_RULE_THRU_VAL_TXT) &lt;= 10
                     THEN RPAD(REPLACE(REPLACE(TR.TRTY_RULE_THRU_VAL_TXT,'%',''),'-',''),9,'9')
                     ELSE ''
                     END                        AS MODIFICATION_THRU_VAL_TXT
                ,TR.EFF_FROM_DT                 AS EFF_FROM_DT
                ,TR.EFF_THRU_DT                 AS EFF_THRU_DT
                ,GT.TRTY_GRP_TP_CD              AS TRTY_GRP_TP_CD
                ,GT.TRTY_GRP_TP_DESC_TXT        AS TRTY_GRP_TP_DESC_TXT
                ,OT.TRTY_RULE_OPRD_TP_CD        AS TRTY_RULE_OPRD_TP_CD
                ,OT.TRTY_RULE_OPRD_TP_DESC_TXT  AS TRTY_RULE_OPRD_TP_DESC_TXT
                ,LT.TRTY_RULE_LOGIC_TP_CD       AS TRTY_RULE_LOGIC_TP_CD
                ,LT.TRTY_RULE_LOGIC_TP_DESC_TXT AS TRTY_RULE_LOGIC_TP_DESC_TXT
            FROM
                DS_ORG_UNIT         OU
                ,ORG_STRU_TP        ST
                ,BIZ_AREA_ORG       AO
                ,TRTY_RULE          TR
                ,TRTY_GRP_TP        GT
                ,TRTY_RULE_OPRD_TP  OT
                ,TRTY_RULE_LOGIC_TP LT
            WHERE
                OU.GLBL_CMPY_CD          = #glblCmpyCd#
            AND OU.EZCANCELFLAG          = '0'
            <isNotNull property="orgNm">
            AND OU.ORG_NM                LIKE #orgNm#
            </isNotNull>
            AND OU.GLBL_CMPY_CD          = ST.GLBL_CMPY_CD
            AND OU.EFF_FROM_DT           &lt;= #salesDate#
            AND (OU.EFF_THRU_DT           &gt;= #salesDate#
                OR OU.EFF_THRU_DT        IS NULL)
            AND ST.EZCANCELFLAG          = '0'
            AND OU.ORG_STRU_TP_CD        = ST.ORG_STRU_TP_CD
            AND ST.TRTY_STRU_FLG         = #trtyStruFlgY#
            AND OU.GLBL_CMPY_CD          = AO.GLBL_CMPY_CD
            AND AO.EZCANCELFLAG          = '0'
            AND OU.FIRST_ORG_CD          = AO.BIZ_AREA_ORG_CD
            <isNotNull property="bizAreaOrgCd">
            AND AO.BIZ_AREA_ORG_CD       = #bizAreaOrgCd#
            </isNotNull>
            AND OU.ORG_STRU_TP_CD        = AO.ORG_STRU_TP_CD
            AND OU.GLBL_CMPY_CD          = TR.GLBL_CMPY_CD
            AND TR.EZCANCELFLAG          = '0'
            AND OU.ORG_STRU_TP_CD        = TR.ORG_STRU_TP_CD
            AND OU.ORG_CD                = TR.ORG_CD
            AND TR.TRTY_RULE_TP_CD       = #trtyRuleTpPost#
            AND TR.EFF_FROM_DT           &lt;= #salesDate#
            AND (TR.EFF_THRU_DT          &gt;= #salesDate#
                OR TR.EFF_THRU_DT        IS NULL)
            AND OU.GLBL_CMPY_CD          = GT.GLBL_CMPY_CD
            AND GT.EZCANCELFLAG          = '0'
            AND OU.TRTY_GRP_TP_CD        = GT.TRTY_GRP_TP_CD
            <isNotNull property="trtyGrpTpCd">
            AND GT.TRTY_GRP_TP_CD        = #trtyGrpTpCd#
            </isNotNull>
            AND TR.GLBL_CMPY_CD          = OT.GLBL_CMPY_CD
            AND OT.EZCANCELFLAG          = '0'
            AND TR.TRTY_RULE_OPRD_TP_CD  = OT.TRTY_RULE_OPRD_TP_CD
            AND TR.GLBL_CMPY_CD          = LT.GLBL_CMPY_CD
            AND LT.EZCANCELFLAG          = '0'
            AND TR.TRTY_RULE_LOGIC_TP_CD = LT.TRTY_RULE_LOGIC_TP_CD
            ORDER BY
                OU.ORG_NM
            ) TRTY_RULE_POST_INFO
        WHERE
            1 = 1
        <isNotNull property="trtyRuleFromValTxt">
        AND TRTY_RULE_POST_INFO.MODIFICATION_THRU_VAL_TXT &gt;= #trtyRuleFromValTxt#
        </isNotNull>
        <isNotNull property="trtyRuleThruValTxt">
        AND TRTY_RULE_POST_INFO.MODIFICATION_FROM_VAL_TXT &lt;= #trtyRuleThruValTxt#
        </isNotNull>
    </statement>

    <statement id="getOrgCd" parameterClass="Map" resultClass="Map">
        SELECT
            OU.ORG_CD         AS ORG_CD
        FROM
            DS_ORG_UNIT  OU
            ,ORG_STRU_TP ST
        WHERE
            OU.GLBL_CMPY_CD   = #glblCmpyCd#
        AND OU.EZCANCELFLAG   = '0'
        AND OU.ORG_NM         = #orgNm#
        AND OU.GLBL_CMPY_CD   = ST.GLBL_CMPY_CD
        AND ST.EZCANCELFLAG   = '0'
        AND OU.ORG_STRU_TP_CD = ST.ORG_STRU_TP_CD
        AND ST.TRTY_STRU_FLG  = #trtyStruFlgY#
    </statement>

    <statement id="getMoveFromEffctive" parameterClass="Map" resultClass="Map">
        SELECT
            OU.ORG_CD          AS ORG_CD
            ,OU.ORG_NM         AS ORG_NM
            ,OU.EFF_FROM_DT    AS ORG_EFF_FROM_DT
            ,OU.EFF_THRU_DT    AS ORG_EFF_THRU_DT
            ,TR.TRTY_RULE_PK   AS TRTY_RULE_PK
            ,TR.EFF_FROM_DT    AS RULE_EFF_FROM_DT
            ,TR.EFF_THRU_DT    AS RULE_EFF_THRU_DT
        FROM
            DS_ORG_UNIT        OU
            ,ORG_STRU_TP       ST
            ,TRTY_RULE         TR
        WHERE
            OU.GLBL_CMPY_CD    = #glblCmpyCd#
        AND OU.EZCANCELFLAG    = '0'
        <iterate property="orgCdList" var="orgCd[]" open="AND  OU.ORG_CD IN (" close=")" conjunction= ", " >
            #orgCd[]#
        </iterate>
        <iterate property="gnrnTpCdList" var="gnrnTpCd[]" open="AND  OU.GNRN_TP_CD IN (" close=")" conjunction= ", " >
            #gnrnTpCd[]#
        </iterate>
        AND OU.GLBL_CMPY_CD    = ST.GLBL_CMPY_CD
        AND ST.EZCANCELFLAG    = '0'
        AND OU.ORG_STRU_TP_CD  = ST.ORG_STRU_TP_CD
        AND ST.TRTY_STRU_FLG   = #trtyStruFlgY#
        AND OU.GLBL_CMPY_CD    = TR.GLBL_CMPY_CD
        AND TR.EZCANCELFLAG    = '0'
        <iterate property="rulePkList" var="rulePk[]" open="AND  TR.TRTY_RULE_PK IN (" close=")" conjunction= ", " >
            #rulePk[]#
        </iterate>
        AND OU.ORG_CD          = TR.ORG_CD
        AND OU.ORG_STRU_TP_CD  = TR.ORG_STRU_TP_CD
        AND TR.TRTY_RULE_TP_CD = #trtyRuleTpPost#
    </statement>

    <statement id="getLogicTypeMoveTo" parameterClass="Map" resultClass="Map">
        SELECT
            OU.ORG_CD                 AS ORG_CD
            ,TR.TRTY_RULE_PK          AS TRTY_RULE_PK
            ,LT.TRTY_RULE_LOGIC_TP_CD AS TRTY_RULE_LOGIC_TP_CD
        FROM
            DS_ORG_UNIT               OU
            ,ORG_STRU_TP              ST
            ,TRTY_RULE                TR
            ,TRTY_RULE_LOGIC_TP       LT
        WHERE
            OU.GLBL_CMPY_CD           = #glblCmpyCd#
        AND OU.EZCANCELFLAG           = '0'
        AND OU.ORG_CD                 = #orgCd#
        AND OU.GLBL_CMPY_CD           = ST.GLBL_CMPY_CD
        AND ST.EZCANCELFLAG           = '0'
        AND OU.ORG_STRU_TP_CD         = ST.ORG_STRU_TP_CD
        AND ST.TRTY_STRU_FLG          = #trtyStruFlgY#
        AND OU.GLBL_CMPY_CD           = TR.GLBL_CMPY_CD
        AND TR.EZCANCELFLAG           = '0'
        AND OU.ORG_CD                 = TR.ORG_CD
        AND OU.ORG_STRU_TP_CD         = TR.ORG_STRU_TP_CD
        AND TR.TRTY_RULE_TP_CD        = #trtyRuleTpPost#
        AND TR.EFF_FROM_DT            &lt;= #effThruDt#
        AND (TR.EFF_THRU_DT           &gt;= #effFromDt#
            OR TR.EFF_THRU_DT         IS NULL)
        AND TR.GLBL_CMPY_CD           = LT.GLBL_CMPY_CD
        AND LT.EZCANCELFLAG           = '0'
        AND TR.TRTY_RULE_LOGIC_TP_CD  = LT.TRTY_RULE_LOGIC_TP_CD
    </statement>

    <statement id="getEffectiveRange" parameterClass="Map" resultClass="Map">
        SELECT
            OU.ORG_CD         AS ORG_CD
            ,OU.EFF_FROM_DT   AS EFF_FROM_DT
            ,OU.EFF_THRU_DT   AS EFF_THRU_DT
        FROM
            DS_ORG_UNIT       OU
            ,ORG_STRU_TP      ST
        WHERE
            OU.GLBL_CMPY_CD   = #glblCmpyCd#
        AND OU.EZCANCELFLAG   = '0'
        AND OU.ORG_CD         = #orgCd#
        AND OU.GLBL_CMPY_CD   = ST.GLBL_CMPY_CD
        AND ST.EZCANCELFLAG   = '0'
        AND OU.ORG_STRU_TP_CD = ST.ORG_STRU_TP_CD
        AND ST.TRTY_STRU_FLG  = #trtyStruFlgY#
        AND OU.EFF_FROM_DT    &lt;= #effFromDt#
        AND (OU.EFF_THRU_DT   &gt;= #effThruDt#
            OR OU.EFF_THRU_DT IS NULL)
    </statement>

    <statement id="getTrtyRules" parameterClass="Map" resultClass="Map">
        SELECT
            UNIT.ORG_CD
          , UNIT.FIRST_ORG_CD
          , UNIT.TRTY_GRP_TP_CD
          , UNIT.TRTY_TP_CD
          , UNIT.EFF_FROM_DT AS ORG_EFF_FROM_DT
          , NVL(UNIT.EFF_THRU_DT, #maxEffThruDt#) AS ORG_EFF_THRU_DT
          , UNIT.ORG_TIER_CD
          , RULE.TRTY_RULE_TP_CD
          , RULE.TRTY_RULE_OPRD_TP_CD
          , RULE.TRTY_RULE_LOGIC_TP_CD
          , RULE.TRTY_RULE_FROM_VAL_TXT
          , RULE.TRTY_RULE_THRU_VAL_TXT
          , RULE.EFF_FROM_DT AS RULE_EFF_FROM_DT
          , NVL(RULE.EFF_THRU_DT, #maxEffThruDt#) AS RULE_EFF_THRU_DT
        FROM
            DS_ORG_UNIT UNIT
          , ORG_STRU_TP STRU
          , TRTY_RULE   RULE
        WHERE 
            UNIT.GLBL_CMPY_CD     = #glblCmpyCd#
        AND UNIT.ORG_CD           = #orgCd#
        AND UNIT.GLBL_CMPY_CD     = STRU.GLBL_CMPY_CD
        AND UNIT.ORG_STRU_TP_CD   = STRU.ORG_STRU_TP_CD
        AND STRU.TRTY_STRU_FLG    = #flgOnY#
        AND UNIT.EFF_FROM_DT  &lt;= #slsDt#
        AND NVL(UNIT.EFF_THRU_DT, #maxEffThruDt#) &gt;= #slsDt#
        AND UNIT.GLBL_CMPY_CD     = RULE.GLBL_CMPY_CD
        AND UNIT.ORG_CD           = RULE.ORG_CD
        AND RULE.TRTY_RULE_TP_CD  = #trtyRuleTpCd#
        AND RULE.EFF_FROM_DT  &lt;= #slsDt#
        AND NVL(RULE.EFF_THRU_DT, #maxEffThruDt#) &gt;= #slsDt#
    </statement>
</sqlMap>
