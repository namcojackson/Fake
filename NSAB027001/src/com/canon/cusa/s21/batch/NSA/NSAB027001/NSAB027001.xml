<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAB027001">
    <statement id="getInputData" parameterClass="Map" resultClass="Map">
        SELECT
             NSAI.PROC_DT
            ,NSAI.CFS_LEASE_PBL_NUM
            ,NSAI.CSA_INV_NUM
            ,NSAI.CSA_CONTR_NUM
            ,NSAI.CSA_CONTR_MOD_TXT
            ,NSAI.CFS_SER_NUM
            ,NSAI.INV_AMT
            ,NSAI.BLLG_PER_FROM_DT
            ,NSAI.BLLG_PER_THRU_DT
            ,NSAI.CFS_BLLG_TP_TXT
            ,NSAI.CFS_LEASE_NUM
            ,NSAI.END_CUST_NM
            ,NSAI.DS_ACCT_DLR_CD
            ,NSAI.INV_DT
            ,NSAI.BLLG_MTR_LB_NM
            ,NSAI.CFS_FTR_FLG_ORIG_TXT
            ,NSAI.CFS_CM_FLG_ORIG_TXT
            ,NSAI.CFS_FLEET_FLG_ORIG_TXT
            ,NSAI.CFS_INV_BAT_NUM
        FROM
            NSAI0270_01 NSAI
        WHERE
                NSAI.EZUPCOMPANYCODE   = #glblCmpyCd#
            AND NSAI.INTERFACE_ID      = #interfaceId#
            AND NSAI.TRANSACTION_ID    = #transactionId#
            AND NSAI.EZCANCELFLAG      = '0'
            AND NOT EXISTS (
                    SELECT
                        1
                    FROM
                        CFS_INV_INTFC CFS
                    WHERE
                            CFS.GLBL_CMPY_CD        = #glblCmpyCd#
                       AND  CFS.CFS_LEASE_PBL_NUM   = NSAI.CFS_LEASE_PBL_NUM
                       AND  CFS.EZCANCELFLAG        = '0'
                )
        ORDER BY
             NSAI.SEGMENT_ID
            ,NSAI.UNIT_ID
            ,NSAI.SEQ_NUMBER
            ,NSAI.CFS_LEASE_PBL_NUM
    </statement>
</sqlMap>
