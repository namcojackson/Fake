<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSAL0510Query">
    <typeAlias alias="NSAL0510_ASMsg"  type="business.blap.NSAL0510.NSAL0510_ASMsg"/>
    
    <statement id="getSearchData" parameterClass="Map" resultMap="result.getSearchData">
        SELECT
             B.DS_CONTR_DTL_PK  AS DS_CONTR_DTL_PK
            ,A.DS_SUB_CONTR_PK  AS DS_SUB_CONTR_PK
            ,A.VND_CD           AS VND_CD
            ,M.PRNT_VND_NM      AS PRNT_VND_NM
            ,C.DS_ACCT_NUM      AS DS_ACCT_NUM
            ,H.DS_ACCT_NM       AS DS_ACCT_NM
            ,C.DS_CONTR_NUM     AS DS_CONTR_NUM
            ,I.DS_CONTR_CTRL_STS_NM  AS DS_CONTR_CTRL_STS_NM
            ,CASE WHEN
                     A.EFF_FROM_DT      &lt;= #slsDt#
                 AND A.EFF_THRU_DT      &gt;= #slsDt#
                 AND A.CONTR_TRMN_FLG   &lt;&gt; #contrTrmnFlgIsY#
                 THEN
                     'Active'
                 ELSE
                     'In-Active'
                 END            AS SUB_CONTR_STS_NM
            ,A.DLR_FLEET_NUM    AS DLR_FLEET_NUM
            ,D.SER_NUM          AS SER_NUM
            ,F.T_MDL_NM         AS T_MDL_NM
            ,A.EFF_FROM_DT      AS EFF_FROM_DT
            ,A.EFF_THRU_DT      AS EFF_THRU_DT
            <!-- START 2016/12/07 K.Kojima [QC#14204, ADD] -->
            ,A.EZINTIME         AS XX_REC_HIST_CRAT_TS_A
            ,A.EZINUSERID       AS XX_REC_HIST_CRAT_BY_NM_A
            ,A.EZUPTIME         AS XX_REC_HIST_UPD_TS_A
            ,A.EZUPUSERID       AS XX_REC_HIST_UPD_BY_NM_A
            ,A.EZTABLEID        AS XX_REC_HIST_TBL_NM_A
            <!-- END 2016/12/07 K.Kojima [QC#14204, ADD] -->
          FROM
              DS_SUB_CONTR      A
             ,DS_CONTR_DTL      B
             ,DS_CONTR          C
             ,SVC_MACH_MSTR     D
             ,SVC_CONFIG_MSTR   E
             ,MDL_NM            F
             ,VND               G
             ,SELL_TO_CUST      H
             ,DS_CONTR_STS_V    I
             ,VND_TP_RELN       L
             ,PRNT_VND          M
         WHERE
                 A.GLBL_CMPY_CD     = #glblCmpyCd#
             <isNotNull property="dlrFleetNum">
             AND A.DLR_FLEET_NUM    = #dlrFleetNum#
             </isNotNull>
             <isEqual property="mdlActvFlg" compareValue="Y">
             AND A.EFF_FROM_DT      &lt;= #slsDt#
             AND A.EFF_THRU_DT      &gt;= #slsDt#
             AND A.CONTR_TRMN_FLG   &lt;&gt; #contrTrmnFlgIsY#
             </isEqual>
             <isEqual property="mdlActvFlg" compareValue="N">
             AND (
                    A.EFF_FROM_DT      &gt; #slsDt#
                 OR A.EFF_THRU_DT      &lt; #slsDt#
                 OR A.CONTR_TRMN_FLG   = #contrTrmnFlgIsY#
                 )
             </isEqual>
             <isNotNull property="vndCd">
             AND A.VND_CD           = #vndCd#
             </isNotNull>
             AND A.EZCANCELFLAG     = '0'
             AND B.GLBL_CMPY_CD     = A.GLBL_CMPY_CD
             AND B.DS_CONTR_DTL_PK  = A.DS_CONTR_DTL_PK
             AND B.EZCANCELFLAG     = '0'
             AND C.GLBL_CMPY_CD     = B.GLBL_CMPY_CD
             AND C.DS_CONTR_PK      = B.DS_CONTR_PK
             <isNotNull property="dsContrNum">
             AND C.DS_CONTR_NUM     = #dsContrNum#
             </isNotNull>
             <isNotNull property="dsAcctNum">
             AND C.DS_ACCT_NUM      = #dsAcctNum#
             </isNotNull>
             AND C.EZCANCELFLAG     = '0'
             AND D.GLBL_CMPY_CD     = B.GLBL_CMPY_CD
             AND D.SVC_MACH_MSTR_PK = B.SVC_MACH_MSTR_PK
             <isNotNull property="serNum">
             AND D.SER_NUM          = #serNum#
             </isNotNull>
             AND D.EZCANCELFLAG     = '0'
             AND E.GLBL_CMPY_CD     = D.GLBL_CMPY_CD
             AND E.SVC_MACH_MSTR_PK = D.SVC_MACH_MSTR_PK
             AND E.EZCANCELFLAG     = '0'
             AND F.T_GLBL_CMPY_CD   = E.GLBL_CMPY_CD
             AND F.T_MDL_ID         = E.MDL_ID
             <isNotNull property="t_MdlNm">
             AND F.T_MDL_NM         LIKE #t_MdlNm#
             </isNotNull>
             AND F.EZCANCELFLAG     = '0'
             AND G.GLBL_CMPY_CD     = A.GLBL_CMPY_CD
             AND G.VND_CD           = A.VND_CD
             AND G.EZCANCELFLAG     = '0'
             AND H.GLBL_CMPY_CD     = C.GLBL_CMPY_CD
             AND H.SELL_TO_CUST_CD  = C.DS_ACCT_NUM
             AND H.EZCANCELFLAG     = '0'
             AND I.GLBL_CMPY_CD     = C.GLBL_CMPY_CD
             AND I.DS_CONTR_PK      = C.DS_CONTR_PK
             <isNotNull property="dsContrCtrlSts">
             AND I.DS_CONTR_CTRL_STS_CD  = #dsContrCtrlSts#
             </isNotNull>
             <!-- START 2017/11/14 K.Kojima [QC#21886, ADD] -->
             <isNotNull property="dsContrCtrlStsList">
             <iterate property="dsContrCtrlStsList" var="dsContrCtrlStsList[]" open="AND I.DS_CONTR_CTRL_STS_CD IN (" close=")" conjunction=",">
             #dsContrCtrlStsList[]#
             </iterate>
             </isNotNull>
             <!-- END 2017/11/14 K.Kojima [QC#21886, ADD] -->
             AND I.EZCANCELFLAG     = '0'
             <!-- START 2017/03/06 K.Kojima [QC#17894,MOD] -->
             <!-- AND L.EZCANCELFLAG(+)  = '0' -->
             <!-- AND G.GLBL_CMPY_CD     = L.GLBL_CMPY_CD(+) -->
             <!-- AND G.VND_CD           = L.VND_CD(+) -->
             AND L.EZCANCELFLAG     = '0'
             AND G.GLBL_CMPY_CD     = L.GLBL_CMPY_CD
             AND G.VND_CD           = L.VND_CD
             <!-- END 2017/03/06 K.Kojima [QC#17894,MOD] -->
             <!-- START 2017/03/06 K.Kojima [QC#17894,ADD] -->
             AND L.VND_TP_CD        = #vndTpCdIsSvcDealer#
             <!-- END 2017/03/06 K.Kojima [QC#17894,ADD] -->
             AND M.EZCANCELFLAG(+)  = '0'
             AND G.GLBL_CMPY_CD     = M.GLBL_CMPY_CD(+)
             AND G.PRNT_VND_PK      = M.PRNT_VND_PK(+)
        ORDER BY
              A.VND_CD
             ,C.DS_ACCT_NUM
             ,C.DS_CONTR_NUM
             ,A.EFF_FROM_DT
    </statement>

    <resultMap id="result.getSearchData"        class="NSAL0510_ASMsg">
        <result property="dsContrDtlPk_A"       column="DS_CONTR_DTL_PK"    javaType="EZDCBigDecimalItem"/>
        <result property="dsSubContrPk_A"       column="DS_SUB_CONTR_PK"    javaType="EZDCBigDecimalItem"/>
        <result property="vndCd_A"              column="VND_CD"             javaType="EZDCStringItem"/>
        <result property="prntVndNm_A"          column="PRNT_VND_NM"        javaType="EZDCStringItem"/>
        <result property="dsAcctNum_A"          column="DS_ACCT_NUM"        javaType="EZDCStringItem"/>
        <result property="dsAcctNm_A"           column="DS_ACCT_NM"         javaType="EZDCStringItem"/>
        <result property="dsContrNum_A"         column="DS_CONTR_NUM"       javaType="EZDCStringItem"/>
        <result property="xxScrItem10Txt_A"     column="SUB_CONTR_STS_NM"   javaType="EZDCStringItem"/>
        <result property="dlrFleetNum_A"        column="DLR_FLEET_NUM"      javaType="EZDCStringItem"/>
        <result property="serNum_A"             column="SER_NUM"            javaType="EZDCStringItem"/>
        <result property="t_MdlNm_A"            column="T_MDL_NM"           javaType="EZDCStringItem"/>
        <result property="effFromDt_A"          column="EFF_FROM_DT"        javaType="EZDCStringItem"/>
        <result property="effThruDt_A"          column="EFF_THRU_DT"        javaType="EZDCStringItem"/>
        <!-- START 2016/12/07 K.Kojima [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_A"    column="XX_REC_HIST_CRAT_TS_A"    javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_A"  column="XX_REC_HIST_CRAT_BY_NM_A" javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_A"     column="XX_REC_HIST_UPD_TS_A"     javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_A"   column="XX_REC_HIST_UPD_BY_NM_A"  javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_A"     column="XX_REC_HIST_TBL_NM_A"     javaType="EZDSStringItem"/>
        <!-- END 2016/12/07 K.Kojima [QC#14204, ADD] -->
    </resultMap>

    <!-- START 2017/11/16 K.Kojima [QC#21886,ADD] -->
    <statement id="getContrCtrlStsCdPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
             DS_CONTR_CTRL_STS_CD
            ,DS_CONTR_CTRL_STS_NM
        FROM
            (
                SELECT
                     DCCS.DS_CONTR_CTRL_STS_CD
                    ,DCCS.DS_CONTR_CTRL_STS_NM
                    ,ROW_NUMBER() OVER(PARTITION BY DCCS.DS_CONTR_CTRL_STS_NM ORDER BY DCCS.DS_CONTR_CTRL_STS_CD DESC) AS ROW_NUM
                FROM
                    DS_CONTR_CTRL_STS DCCS
                WHERE
                        DCCS.GLBL_CMPY_CD                = #glblCmpyCd#
                    AND DCCS.DS_CONTR_CTRL_STS_CD &lt;&gt; #dsContrCtrlStsOrdr#
                    AND DCCS.EZCANCELFLAG                = '0'
            )
        WHERE
            ROW_NUM = 1
        ORDER BY
            DS_CONTR_CTRL_STS_CD ASC
    </statement>
    <statement id="getSameNameCtrlSts" parameterClass="Map" resultClass="String">
        SELECT
            B.DS_CONTR_CTRL_STS_CD
        FROM
             DS_CONTR_CTRL_STS A
            ,DS_CONTR_CTRL_STS B
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsCd#
            AND A.EZCANCELFLAG         = '0'
            AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD
            AND A.DS_CONTR_CTRL_STS_NM = B.DS_CONTR_CTRL_STS_NM
            AND A.EZCANCELFLAG         = '0'
    </statement>
    <!-- END 2017/11/16 K.Kojima [QC#21886,ADD] -->

</sqlMap>
