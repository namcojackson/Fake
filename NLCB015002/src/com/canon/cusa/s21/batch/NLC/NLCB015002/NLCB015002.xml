<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLCB015002">

    <statement id="findWork" parameterClass="Map">
        WITH RSLT_V AS (
            SELECT
                SORW.GLBL_CMPY_CD                 AS GLBL_CMPY_3_CD
                , SORW.MDSE_CD                    AS MDSE_12_CD
                , SORW.LOCAL_MDSE_CD
                , SORW.SHIP_GLBL_CMPY_CD          AS SHIP_TO_AFFL_CD
                <isNotEqual property="PROC_CD" compareValue="WE115">
                    <isNotEqual property="PROC_CD" compareValue="WE115M">
                , SORW.WH_CD                      AS INTFC_WH_CD
                    </isNotEqual>
                </isNotEqual>
                , NVL(SUM(SORW.WRK_DB_QTY_01), 0) AS SCM_DB_QTY_02
                , NVL(SUM(SORW.WRK_DB_QTY_02), 0) AS SCM_DB_QTY_03
                , NVL(SUM(SORW.WRK_DB_QTY_03), 0) AS SCM_DB_QTY_04
                , NVL(SUM(SORW.WRK_DB_QTY_04), 0) AS SCM_DB_QTY_06
                , NVL(SUM(SORW.WRK_DB_QTY_05), 0) AS SCM_DB_QTY_07
                , NVL(SUM(SORW.WRK_DB_QTY_06), 0) AS SCM_DB_QTY_09
                , NVL(SUM(SORW.WRK_DB_QTY_07), 0) AS SCM_DB_QTY_10
                , NVL(SUM(SORW.WRK_DB_QTY_08), 0) AS SCM_DB_QTY_11
                , NVL(SUM(SORW.WRK_DB_QTY_09), 0) AS SCM_DB_QTY_13
                , NVL(SUM(SORW.WRK_DB_QTY_10), 0) AS SCM_DB_QTY_14
                , NVL(SUM(SORW.WRK_DB_QTY_11), 0) AS SCM_DB_QTY_15
                , NVL(SUM(SORW.WRK_DB_QTY_12), 0) AS SCM_DB_QTY_17
                , NVL(SUM(SORW.WRK_DB_QTY_13), 0) AS SCM_DB_QTY_18
                , NVL(SUM(SORW.WRK_DB_QTY_14), 0) AS SCM_DB_QTY_19
                , NVL(SUM(SORW.WRK_DB_QTY_15), 0) AS SCM_DB_QTY_20
                , NVL(SUM(SORW.WRK_DB_QTY_16), 0) AS SCM_DB_QTY_21
                , NVL(SUM(SORW.WRK_DB_QTY_17), 0) AS SCM_DB_QTY_22
                , NVL(SUM(SORW.WRK_DB_QTY_18), 0) AS SCM_DB_QTY_23

                <!-- START DEL 09/04/2013 MEX-IF021 -->
                <!--  -
                <isEqual property="PROC_CD" compareValue="CAS115">
                , NVL(SUM(SORW.WRK_DB_QTY_19), 0) AS SCM_DB_QTY_24
                , NVL(SUM(SORW.WRK_DB_QTY_20), 0) AS SCM_DB_QTY_25
                , SORW.WRK_CUST_CD                AS INTFC_CUST_CD
                , SORW.DEF_WH_CD                  AS DEF_INTFC_WH_CD
                </isEqual>
                <isEqual property="PROC_CD" compareValue="CAS115M">
                , NVL(SUM(SORW.WRK_DB_QTY_19), 0) AS SCM_DB_QTY_24
                , NVL(SUM(SORW.WRK_DB_QTY_20), 0) AS SCM_DB_QTY_25
                , SORW.DEF_WH_CD                  AS DEF_INTFC_WH_CD
                </isEqual>
                -->
                <!-- END   DEL 09/04/2013 MEX-IF021 -->
 
                
            FROM
                STK_OUT_RSLT_WRK SORW
            WHERE
                SORW.GLBL_CMPY_CD = #GLBL_CMPY_CD#
                AND ((SORW.TRX_CD = #T_SLS#
                        AND SORW.TRX_RSN_CD IN (#TR_CR_AND_REBIL#, #TR_TRIAL_TO_SLS#
                                              , #CASH_MDSE#, #CASH_INI_SUP#, #CASH_SUP#, #CASH_CNT_SUP#, #R_CASH_RMA#))
                    OR (SORW.TRX_CD = #T_MOVE#
                        AND (SORW.TRX_RSN_CD IN (#TR_WH_TRANS_STK_OUT#, #TR_TRIAL_SHIP_STK_OUT#, #TR_DROP_SHIP_TRIAL_STK_OUT#, #TR_TRIAL_TO_INVTY_STK_IN#, #TR_EXPT_SALE_SHIP_STK_OUT#)
                         OR  SORW.TRX_RSN_CD IN (#TR_DRCT_SALE_SHIP_STK_OUT#, #TR_DRCT_SALE_SHIP_CANC_STK_IN#, #TR_DRCT_SALE_STOCK_OUT_INTANGIBLE_WITH_COST#)
                        ))
                    OR (SORW.TRX_CD = #T_EXP_SHIP#
                        AND SORW.TRX_RSN_CD IN (#TR_EXP_SHIP#, #TR_EXP_RTN#, #EX_LOAN_SHIP_OUT#, #EX_LOAN_INVTY_OUT#, #EX_LOAN_DROP_OUT#, #EX_LOAN_INTANG_OUT#))
                    OR (SORW.TRX_CD = #T_LOAN_SHIP#
                        AND SORW.TRX_RSN_CD IN (#TR_LOAN_SHIP_STK_OUT#, #TR_DROP_SHIP_LOAN_STK_OUT#))
                                              <!-- , #TR_LOAN_TO_ASSET_RETURN#, #TR_LOAN_SHIP_STK_OUT_ASSET#)) --><!-- ADD 09/04/2013 MEX-IF021 --><!--DEL 11/21/2013 Def.3151(Def.2928) -->
                    OR (SORW.TRX_CD = #T_RNTL_SHIP#
                        AND SORW.TRX_RSN_CD IN (#TR_RNTL_SHIP_STK_OUT#, #TR_RNTL_SHIP_DROP_STK_OUT#, #TR_RNTL_SHIP_STK_OUT_INTANG#, #TR_RNTL_TO_ASSET_RETURN#, #TR_RNTL_SHIP_STK_OUT_EXP#))
                    OR (SORW.TRX_CD = #T_ADJ#
                        AND SORW.TRX_RSN_CD IN (#TR_DSPL#, #TR_ADJ#, #TR_ITEM_CHNG_STK_OUT#, #TR_ITEM_CHNG_STK_IN#
                                              , #CYCLE_ADJ#, #PI_ADJ#, #RE_VEND_OUT#, #RE_EXP_OUT#, #KIT_OUT#, #KIT_IN#, #WH_TR_OUT#))
                    OR (SORW.TRX_CD = #T_INS_CLM#
                        AND SORW.TRX_RSN_CD IN (#TR_LOSS_ON_SHIP#, #TR_LOSS_ON_RCV#))

                    <!-- START ADD 11/21/2013 Def.3151 -->
                    OR (SORW.TRX_CD = #T_PARTS_USG#
                        AND SORW.TRX_RSN_CD IN (#TR_PARTS_USG#, #TR_PARTS_USG_RTN#)))
                    <!-- END   ADD 11/21/2013 Def.3151 -->

                    -- 240:REMANUFACTURING
                    OR (SORW.TRX_CD = #T_REMAN#
                        AND SORW.TRX_RSN_CD IN (#REMAN_PART_USE#, #REMAN_ITEM_OUT#, #REMAN_ITEM_IN#, #REMAN_PART_RETURN#, #REMAN_COMP_IN#, #REMAN_COMP_OUT#))
                    -- 310:EMSD_SHIPMENT
                    OR (SORW.TRX_CD = #T_EMSD_SHIP#
                        AND SORW.TRX_RSN_CD IN (#EMSD_OUT#, #EMSD_DROP_OUT# , #EMSD_OUT_INTG#, #EMSD_OUT_EXP#))

                <!-- START DEL 09/04/2013 MEX-IF021 -->
                <!-- 
                <isEqual property="PROC_CD" compareValue="CAS115">
                AND SORW.STK_STS_CD = #SS_GOOD#
                </isEqual>
                <isEqual property="PROC_CD" compareValue="CAS115M">
                AND SORW.STK_STS_CD = #SS_GOOD#
                </isEqual>
                 -->
                <!-- END   DEL 09/04/2013 MEX-IF021 -->

                AND SORW.EZCANCELFLAG = '0'
            GROUP BY
                SORW.GLBL_CMPY_CD
                , SORW.MDSE_CD
                , SORW.LOCAL_MDSE_CD
                , SORW.SHIP_GLBL_CMPY_CD
                <!-- START DEL 09/04/2013 MEX-IF021 -->
                <!-- 
                <isEqual property="PROC_CD" compareValue="CAS115">
                , SORW.WRK_CUST_CD
                , SORW.WH_CD
                , SORW.DEF_WH_CD
                </isEqual>
                <isEqual property="PROC_CD" compareValue="CAS115M">
                , SORW.WH_CD
                , SORW.DEF_WH_CD
                </isEqual>
                <isEqual property="PROC_CD" compareValue="WJETF610">
                , SORW.WH_CD
                </isEqual>
                 -->
                <!-- END   DEL 09/04/2013 MEX-IF021 -->
        )
        SELECT
            SUBSTR(RSLT_V.GLBL_CMPY_3_CD, 0, 3)           AS GLBL_CMPY_3_CD
            , SUBSTR(RSLT_V.MDSE_12_CD, 0, 12)            AS MDSE_12_CD
            , RSLT_V.LOCAL_MDSE_CD
            , SUBSTR(RSLT_V.SHIP_TO_AFFL_CD, 0, 3)        AS SHIP_TO_AFFL_CD
            <isNotEqual property="PROC_CD" compareValue="WE115">
                <isNotEqual property="PROC_CD" compareValue="WE115M">
            , SUBSTR(RSLT_V.INTFC_WH_CD, 0, 5)            AS INTFC_WH_CD
                </isNotEqual>
            </isNotEqual>
            , ISM.INTFC_SLS_YR_MTH                        AS ADMIN_YR_MTH
            , #PROC_DATE#                                 AS ADMIN_DT
            , TO_CHAR(RSLT_V.SCM_DB_QTY_02 + RSLT_V.SCM_DB_QTY_03
                    + RSLT_V.SCM_DB_QTY_04, '000000000S') AS SCM_DB_QTY_01
            , TO_CHAR(RSLT_V.SCM_DB_QTY_02, '000000000S') AS SCM_DB_QTY_02
            , TO_CHAR(RSLT_V.SCM_DB_QTY_03, '000000000S') AS SCM_DB_QTY_03
            , TO_CHAR(RSLT_V.SCM_DB_QTY_04, '000000000S') AS SCM_DB_QTY_04
            , TO_CHAR(RSLT_V.SCM_DB_QTY_06
                    + RSLT_V.SCM_DB_QTY_07, '000000000S') AS SCM_DB_QTY_05
            , TO_CHAR(RSLT_V.SCM_DB_QTY_06, '000000000S') AS SCM_DB_QTY_06
            , TO_CHAR(RSLT_V.SCM_DB_QTY_07, '000000000S') AS SCM_DB_QTY_07
            , TO_CHAR(RSLT_V.SCM_DB_QTY_09 + RSLT_V.SCM_DB_QTY_10
                    + RSLT_V.SCM_DB_QTY_11, '000000000S') AS SCM_DB_QTY_08
            , TO_CHAR(RSLT_V.SCM_DB_QTY_09, '000000000S') AS SCM_DB_QTY_09
            , TO_CHAR(RSLT_V.SCM_DB_QTY_10, '000000000S') AS SCM_DB_QTY_10
            , TO_CHAR(RSLT_V.SCM_DB_QTY_11, '000000000S') AS SCM_DB_QTY_11
            , TO_CHAR(RSLT_V.SCM_DB_QTY_13
                    + RSLT_V.SCM_DB_QTY_14, '000000000S') AS SCM_DB_QTY_12
            , TO_CHAR(RSLT_V.SCM_DB_QTY_13, '000000000S') AS SCM_DB_QTY_13
            , TO_CHAR(RSLT_V.SCM_DB_QTY_14, '000000000S') AS SCM_DB_QTY_14
            , TO_CHAR(RSLT_V.SCM_DB_QTY_15, '000000000S') AS SCM_DB_QTY_15
            , TO_CHAR(RSLT_V.SCM_DB_QTY_17
                    + RSLT_V.SCM_DB_QTY_18, '000000000S') AS SCM_DB_QTY_16
            , TO_CHAR(RSLT_V.SCM_DB_QTY_17, '000000000S') AS SCM_DB_QTY_17
            , TO_CHAR(RSLT_V.SCM_DB_QTY_18, '000000000S') AS SCM_DB_QTY_18
            , TO_CHAR(RSLT_V.SCM_DB_QTY_19, '000000000S') AS SCM_DB_QTY_19
            , TO_CHAR(RSLT_V.SCM_DB_QTY_20, '000000000S') AS SCM_DB_QTY_20
            , TO_CHAR(RSLT_V.SCM_DB_QTY_21, '000000000S') AS SCM_DB_QTY_21
            , TO_CHAR(RSLT_V.SCM_DB_QTY_22, '000000000S') AS SCM_DB_QTY_22
            , TO_CHAR(RSLT_V.SCM_DB_QTY_23, '000000000S') AS SCM_DB_QTY_23
            <!-- START DEL 09/04/2013 MEX-IF021 -->
            <!-- 
            <isEqual property="PROC_CD" compareValue="CAS115">
            , TO_CHAR(RSLT_V.SCM_DB_QTY_24, '000000000S') AS SCM_DB_QTY_24
            , TO_CHAR(RSLT_V.SCM_DB_QTY_25, '000000000S') AS SCM_DB_QTY_25
            , SUBSTR(RSLT_V.INTFC_CUST_CD, 0, 6)          AS INTFC_CUST_CD
            , SUBSTR(RSLT_V.DEF_INTFC_WH_CD, 0, 5)        AS DEF_INTFC_WH_CD
            </isEqual>
            <isEqual property="PROC_CD" compareValue="CAS115M">
            , TO_CHAR(RSLT_V.SCM_DB_QTY_24, '000000000S') AS SCM_DB_QTY_24
            , TO_CHAR(RSLT_V.SCM_DB_QTY_25, '000000000S') AS SCM_DB_QTY_25
            , SUBSTR(RSLT_V.DEF_INTFC_WH_CD, 0, 5)        AS DEF_INTFC_WH_CD
            </isEqual>
            -->
            <!-- END   DEL 09/04/2013 MEX-IF021 -->
        FROM
            RSLT_V
            , (SELECT
                   INTFC_SLS_YR_MTH
               FROM
                   INTFC_SLS_MTH_MGT
               WHERE
                   GLBL_CMPY_CD = #GLBL_CMPY_CD#
                   AND EZCANCELFLAG = '0') ISM
        ORDER BY
            RSLT_V.GLBL_CMPY_3_CD
            , RSLT_V.MDSE_12_CD
            , RSLT_V.SHIP_TO_AFFL_CD
            <!-- START DEL 09/04/2013 MEX-IF021 -->
            <!-- 
            <isEqual property="PROC_CD" compareValue="CAS115">
            , RSLT_V.INTFC_CUST_CD
            , RSLT_V.INTFC_WH_CD
            , RSLT_V.DEF_INTFC_WH_CD
            </isEqual>
            <isEqual property="PROC_CD" compareValue="CAS115M">
            , RSLT_V.INTFC_WH_CD
            , RSLT_V.DEF_INTFC_WH_CD
            </isEqual>
            <isEqual property="PROC_CD" compareValue="WJETF610">
            , RSLT_V.INTFC_WH_CD
            </isEqual>
             -->
            <!-- END   DEL 09/04/2013 MEX-IF021 -->
    </statement>

</sqlMap>
