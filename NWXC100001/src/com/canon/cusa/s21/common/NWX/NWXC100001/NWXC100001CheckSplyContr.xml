<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NWXC100001CheckSplyContr">
    <typeAlias alias="NWXC100001CheckSplyContrBean" type="com.canon.cusa.s21.common.NWX.NWXC100001.NWXC100001CheckSplyContrBean"/>
    <statement id="queryTagetData" parameterClass="Map" resultMap="result.NWXC100001CheckSplyContrBean">
        SELECT
                DC.DS_CONTR_NUM              DS_CONTR_NUM
              , DC.DS_CONTR_SQ_NUM           DS_CONTR_SQ_NUM
        FROM
                SVC_MACH_MSTR        SMM
              , DS_CONTR_DTL         DCD
              , DS_CONTR             DC
              , DS_CONTR_DTL         DCD2
              , DS_CONTR_DTL_TP      DCDT
              , DS_ACPO              DA
              , DS_ACPO_TRGT_DTL     DATD
        WHERE
<!-- SVC_MACH_MSTR  -->
                SMM.GLBL_CMPY_CD            = #glblCmpyCd#
          AND   SMM.SVC_CONFIG_MSTR_PK      = #svcConfigMstrPk#
          AND   SMM.EZCANCELFLAG            = '0'
<!-- DS_CONTR_DTL  -->
          AND   DCD.GLBL_CMPY_CD            = SMM.GLBL_CMPY_CD
          AND   DCD.SVC_MACH_MSTR_PK        = SMM.SVC_MACH_MSTR_PK 
          AND   DCD.DS_CONTR_DTL_STS_CD     = #dsContrDtlStsCd#
          AND   DCD.EZCANCELFLAG            = '0'
<!-- DS_CONTR      -->
          AND   DC.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
          AND   DC.DS_CONTR_PK              = DCD.DS_CONTR_PK
          AND   DC.DS_CONTR_STS_CD          = #dsContrStsCd#
          AND   DC.DS_CONTR_NUM             = #dsContrNum#
          <isNotNull property="dsContrSqNum">
          AND   DC.DS_CONTR_SQ_NUM          = #dsContrSqNum#
          </isNotNull>
          AND   DC.SELL_TO_CUST_CD          = #sellToCustCd#
          AND   DC.EZCANCELFLAG             = '0'
<!-- DS_CONTR_DTL (SUPPLY)  -->
          AND   DCD2.GLBL_CMPY_CD            = DCD.GLBL_CMPY_CD
          AND   DCD2.DS_CONTR_PK             = DCD.DS_CONTR_PK
          AND   DCD2.PRNT_DS_CONTR_DTL_PK    IN (DCD.PRNT_DS_CONTR_DTL_PK, DCD.DS_CONTR_DTL_PK)
          AND   DCD2.EZCANCELFLAG            = '0'
<!-- DS_CONTR_DTL_TP  -->
          AND   DCDT.GLBL_CMPY_CD            = DCD2.GLBL_CMPY_CD (+)
          AND   DCDT.DS_CONTR_DTL_TP_CD      = DCD2.DS_CONTR_DTL_TP_CD (+)
          AND   DCDT.SPLY_LINE_FLG           = 'Y'
          AND   DCDT.EZCANCELFLAG            = '0'
<!-- DS_ACPO  -->
          AND   DA.GLBL_CMPY_CD              = DCD2.GLBL_CMPY_CD
          AND   DA.DS_CONTR_DTL_PK           = DCD2.DS_CONTR_DTL_PK
          AND   DA.EZCANCELFLAG              = '0'

<!-- DS_ACPO_TRGT_DTL  -->
          AND   DATD.GLBL_CMPY_CD            = DA.GLBL_CMPY_CD
          AND   DATD.DS_ACPO_NUM             = DA.DS_ACPO_NUM
          AND   (DATD.MDSE_CD                = #mdseCd#
             OR  EXISTS(
                 SELECT 
                     *
                 FROM
                     ORD_TAKE_MDSE OTM
                 WHERE
                         OTM.GLBL_CMPY_CD     = DATD.GLBL_CMPY_CD
                     AND OTM.ORD_TAKE_MDSE_CD = DATD.MDSE_CD
                     AND OTM.ORD_TAKE_MDSE_CD = #ordTakeMdseCd#
                     AND OTM.EZCANCELFLAG     = '0'))
          AND   DATD.EZCANCELFLAG            = '0'
          AND   ROWNUM = 1
      </statement>
      <resultMap id="result.NWXC100001CheckSplyContrBean" class="NWXC100001CheckSplyContrBean">
        <result property="dsContrNum"           column="DS_CONTR_NUM"           javaType="String"/>
        <result property="dsContrSqNum"         column="DS_CONTR_SQ_NUM"        javaType="String"/>
    </resultMap>
</sqlMap>
