<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NWXC100001CheckHoldCondition">

    <typeAlias alias="SHPG_PLNTMsg"             type="business.db.SHPG_PLNTMsg"/>
    <statement id="queryTagetData" parameterClass="Map" resultClass="Map">
        <!-- SET Component -->
          SELECT
                 SP.SHPG_PLN_NUM                AS  SHPG_PLN_NUM
                ,CD.CPO_ORD_NUM                 AS  TRX_HDR_NUM
                ,CD.CPO_DTL_LINE_NUM            AS  TRX_LINE_NUM
                ,CD.CPO_DTL_LINE_SUB_NUM        AS  TRX_LINE_SUB_NUM
                ,SP.TRX_SRC_TP_CD               AS  TRX_SRC_TP_CD
          FROM
                 CPO_DTL  CD
                ,SHPG_PLN SP
          WHERE
                      
                         CD.GLBL_CMPY_CD            = #glblCmpyCd#
                 AND     CD.EZCANCELFLAG            = '0'
                 AND     CD.CPO_ORD_NUM             = #cpoOrdNum#
                 AND     CD.CPO_DTL_LINE_NUM        = #cpoDtlLineNum#
                 AND     SP.GLBL_CMPY_CD(+)         = #glblCmpyCd#
                 AND     SP.EZCANCELFLAG(+)         = '0'
                 AND     SP.TRX_HDR_NUM(+)          = CD.CPO_ORD_NUM 
                 AND     SP.TRX_LINE_NUM(+)         = CD.CPO_DTL_LINE_NUM
                 AND     SP.TRX_LINE_SUB_NUM(+)     = CD.CPO_DTL_LINE_SUB_NUM
                 AND     SP.TRX_SRC_TP_CD(+)        = #trxSrcTpCd#
                 <isNotNull property="setShpgPlnNum">
                 AND (    SP.SET_SHPG_PLN_NUM       = #setShpgPlnNum#
                       OR SP.SHPG_PLN_NUM           = #setShpgPlnNum#)
                 </isNotNull>
                 <isNull property="setShpgPlnNum">
                     <isNotNull property="shpgPlnNum">
                     AND SP.SHPG_PLN_NUM            = #shpgPlnNum#
                     </isNotNull>
                 </isNull>
     <!-- SHIP Complete -->
     <isNotNull property="shipCpltCd">
     <isNotEqual property="processMode" compareValue="01">
     UNION
       
          SELECT
                 SP.SHPG_PLN_NUM                AS  SHPG_PLN_NUM
                ,CD.CPO_ORD_NUM                 AS  TRX_HDR_NUM
                ,CD.CPO_DTL_LINE_NUM            AS  TRX_LINE_NUM
                ,CD.CPO_DTL_LINE_SUB_NUM        AS  TRX_LINE_SUB_NUM
                ,SP.TRX_SRC_TP_CD               AS  TRX_SRC_TP_CD
          FROM
                 CPO_DTL  CD
                ,SHPG_PLN SP
          WHERE
                      
                         CD.GLBL_CMPY_CD            = #glblCmpyCd#
                 AND     CD.EZCANCELFLAG            = '0'
                 AND     CD.CPO_ORD_NUM             = #cpoOrdNum#
                 AND     CD.CPO_DTL_LINE_NUM        &lt;&gt; #cpoDtlLineNum#
                 AND     SP.SHIP_CPLT_CD            = #shipCpltCd#
                 AND     SP.GLBL_CMPY_CD            = #glblCmpyCd#
                 AND     SP.EZCANCELFLAG            = '0'
                 AND     SP.TRX_HDR_NUM             = CD.CPO_ORD_NUM 
                 AND     SP.TRX_LINE_NUM            = CD.CPO_DTL_LINE_NUM
                 AND     SP.TRX_LINE_SUB_NUM        = CD.CPO_DTL_LINE_SUB_NUM
                 AND     SP.TRX_SRC_TP_CD           = #trxSrcTpCd#
            </isNotEqual>
        </isNotNull>
    </statement>


    <statement id="queryCpoLevelHold" parameterClass="Map" resultClass="Integer">
        SELECT
                 COUNT(*)
          FROM
                   HLD H
                  ,HLD_RSN HR
                  ,HLD_PROC_DFN HPD
         WHERE
                   H.GLBL_CMPY_CD             = #glblCmpyCd#
           AND     H.EZCANCELFLAG             = '0'
           AND     H.CPO_ORD_NUM              = #cpoOrdNum#
<!-- 2012/12/20 Delete Start Defect #58
           AND     H.TRX_SRC_TP_CD            = #trxSrcTpCd#
2012/12/20 Delete End -->
           AND     H.REL_FLG                  = 'N'
           AND     H.GLBL_CMPY_CD             = HR.GLBL_CMPY_CD
           AND     HR.EZCANCELFLAG            = '0'
           AND     H.HLD_RSN_CD               = HR.HLD_RSN_CD
           AND     HR.HLD_LVL_CD              = #hldLvlCd#
           AND     H.GLBL_CMPY_CD             = HPD.GLBL_CMPY_CD
           AND     HPD.EZCANCELFLAG           = '0'
           AND     H.HLD_RSN_CD               = HPD.HLD_RSN_CD
           AND     HPD.WH_TP_CD               = #whTpCd#
           <isEqual property="processMode" compareValue="01">
           AND     HPD.REL_PNT_REV_FLG        = 'Y'
           </isEqual>
           <isEqual property="processMode" compareValue="02">
           AND     HPD.REL_PNT_SO_PRINT_FLG        = 'Y'
           </isEqual>
    </statement>

    <statement id="queryCpoDtlLevelHold" parameterClass="Map" resultClass="Integer">
        SELECT
                 COUNT(*)
          FROM
                   HLD H
                  ,HLD_RSN HR
                  ,HLD_PROC_DFN HPD
         WHERE
                   H.GLBL_CMPY_CD             = #glblCmpyCd#
           AND     H.EZCANCELFLAG             = '0'
           AND     H.CPO_ORD_NUM              = #cpoOrdNum#
           AND     H.CPO_DTL_LINE_NUM         = #cpoDtlLineNum#
           AND     H.CPO_DTL_LINE_SUB_NUM     = #cpoDtlLineSubNum#
<!-- 2012/12/20 Delete Start Defect #58
           AND     H.TRX_SRC_TP_CD            = #trxSrcTpCd#
2012/12/20 Delete End -->
           AND     NVL(H.TRX_SRC_TP_CD,#trxSrcTpWholeSales#) = #trxSrcTpCd# <!-- QC#56247 2020/04/07 Add -->
           AND     H.REL_FLG                  = 'N'
           AND     H.GLBL_CMPY_CD             = HR.GLBL_CMPY_CD
           AND     HR.EZCANCELFLAG            = '0'
           AND     H.HLD_RSN_CD               = HR.HLD_RSN_CD
           AND     HR.HLD_LVL_CD              = #hldLvlCd#
           AND     H.GLBL_CMPY_CD             = HPD.GLBL_CMPY_CD
           AND     HPD.EZCANCELFLAG           = '0'
           AND     H.HLD_RSN_CD               = HPD.HLD_RSN_CD
           AND     HPD.WH_TP_CD               = #whTpCd#
           <isEqual property="processMode" compareValue="01">
           AND     HPD.REL_PNT_REV_FLG        = 'Y'
           </isEqual>
           <isEqual property="processMode" compareValue="02">
           AND     HPD.REL_PNT_SO_PRINT_FLG        = 'Y'
           </isEqual>
    </statement>

    <statement id="queryShpgPlnLevelHold" parameterClass="Map" resultClass="Integer">
        SELECT
                 COUNT(*)
          FROM
                   HLD H
                  ,HLD_RSN HR
                  ,HLD_PROC_DFN HPD
         WHERE
                   H.GLBL_CMPY_CD             = #glblCmpyCd#
           AND     H.EZCANCELFLAG             = '0'
           AND     H.CPO_ORD_NUM              = #cpoOrdNum#
           AND     H.SHPG_PLN_NUM             = #shpgPlnNum#
<!-- 2012/12/20 Delete Start Defect #58
           AND     H.TRX_SRC_TP_CD            = #trxSrcTpCd#
2012/12/20 Delete End -->
           AND     H.REL_FLG                  = 'N'
           AND     H.GLBL_CMPY_CD             = HR.GLBL_CMPY_CD
           AND     HR.EZCANCELFLAG            = '0'
           AND     H.HLD_RSN_CD               = HR.HLD_RSN_CD
           AND     HR.HLD_LVL_CD              = #hldLvlCd#
           AND     H.GLBL_CMPY_CD             = HPD.GLBL_CMPY_CD
           AND     HPD.EZCANCELFLAG           = '0'
           AND     H.HLD_RSN_CD               = HPD.HLD_RSN_CD
           AND     HPD.WH_TP_CD               = #whTpCd#
           <isEqual property="processMode" compareValue="01">
           AND     HPD.REL_PNT_REV_FLG        = 'Y'
           </isEqual>
           <isEqual property="processMode" compareValue="02">
           AND     HPD.REL_PNT_SO_PRINT_FLG        = 'Y'
           </isEqual>
    </statement>

    <statement id="shpgPlnNotMultiStsCd" parameterClass="Map" resultMap="result.SHPG_PLNTMsg" >
        SELECT
             SP.GLBL_CMPY_CD
             SP.TRX_HDR_NUM
            ,SP.TRX_LINE_NUM
            ,SP.TRX_LINE_SUB_NUM
            ,SP.TRX_SRC_TP_CD
            ,SP.SHPG_PLN_NUM
            ,SP.PO_REQ_FLG
            ,SP.MDSE_CD
            ,SP.SHIP_CPLT_CD
            ,SP.SET_SHPG_PLN_NUM
        FROM
                SHPG_PLN SP
        WHERE
              SP.GLBL_CMPY_CD               = #glblCmpyCd#
          AND SP.TRX_HDR_NUM                = #trxHdrNum#
          AND SP.SHPG_STS_CD    NOT IN
            <iterate property="shpgStsCd" var="shpgStsCd[]" open="(" close=")" conjunction=",">
                #shpgStsCd[]#
            </iterate>
          AND SP.EZCANCELFLAG               = '0'
    </statement>

    <resultMap id="result.SHPG_PLNTMsg" class="SHPG_PLNTMsg">
        <result property="glblCmpyCd"           column="GLBL_CMPY_CD"           javaType="EZDTStringItem"/>
        <result property="shpgPlnNum"           column="SHPG_PLN_NUM"           javaType="EZDTStringItem"/>
        <result property="trxHdrNum"            column="TRX_HDR_NUM"            javaType="EZDTStringItem"/>
        <result property="trxLineNum"           column="TRX_LINE_NUM"           javaType="EZDTStringItem"/>
        <result property="trxLineSubNum"        column="TRX_LINE_SUB_NUM"       javaType="EZDTStringItem"/>
        <result property="mdseCd"               column="MDSE_CD"                javaType="EZDTStringItem"/>
        <result property="trxSrcTpCd"           column="TRX_SRC_TP_CD"          javaType="EZDTStringItem"/>
        <result property="poReqFlg"             column="PO_REQ_FLG"             javaType="EZDTStringItem"/>
        <result property="shipCpltCd"           column="SHIP_CPLT_CD"           javaType="EZDTStringItem"/>
        <result property="setShpgPlnNum"        column="SET_SHPG_PLN_NUM"       javaType="EZDTStringItem"/>
    </resultMap>

</sqlMap>