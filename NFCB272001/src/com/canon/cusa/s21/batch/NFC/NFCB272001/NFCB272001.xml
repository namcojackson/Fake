<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NFCB272001">

    <statement id="getArReceipt" parameterClass="Map">
     SELECT *
       FROM 
       (SELECT
               ARUA.* 
              ,AR.PAYER_CUST_CD                      PAYER_CUST_CD
              ,AR.AR_RCPT_TRX_TP_CD                  AR_RCPT_TRX_TP_CD
              ,AR.AR_RCPT_TP_CD                      AR_RCPT_TP_CD
              ,AR.DEAL_CCY_CD                        DEAL_CCY_CD
              ,AR.FUNC_CCY_CD                        FUNC_CCY_CD
              ,AR.EXCH_RATE                          EXCH_RATE
              ,AR.AR_BANK_ACCT_CD                    AR_BANK_ACCT_CD
              ,AR.DEAL_RCPT_AMT                      DEAL_RCPT_AMT
              ,AR.FUNC_RCPT_AMT                      FUNC_RCPT_AMT
              ,AR.DEAL_NET_RCPT_AMT                  DEAL_NET_RCPT_AMT
              ,AR.FUNC_NET_RCPT_AMT                  FUNC_NET_RCPT_AMT
              ,AR.DEAL_VOID_AMT                      DEAL_VOID_AMT
              ,AR.FUNC_VOID_AMT                      FUNC_VOID_AMT
              ,AR.COA_PROD_CD                        COA_PROD_CD
              ,AR.TOC_CD                             TOC_CD
              ,AAD.ACCT_DT                           ACCT_DT
              ,NVL(AR.AR_RCPT_SRC_CD, #defRcptSrc#)  AR_RCPT_SRC_CD
              ,AR.RCPT_CHK_NUM                       RCPT_CHK_NUM
     FROM
     		  AR_RCPT           AR
             ,(SELECT GLBL_CMPY_CD         GLBL_CMPY_CD
                     ,AR_CASH_APP_PK       AR_CASH_APP_PK
                     ,AR_CASH_APP_SQ_NUM   AR_CASH_APP_SQ_NUM
                     ,RCPT_NUM             RCPT_NUM
                     ,GL_DT                GL_DT
                     ,AR_UN_APPLY_TP_CD    AR_UN_APPLY_TP_CD
                     ,AR_UN_APPLY_STS_CD   AR_UN_APPLY_STS_CD
                     ,EZUPTIME             EZUPTIME
                     ,EZUPTIMEZONE         EZUPTIMEZONE
                FROM AR_RCPT_UN_APPLY
               WHERE EZCANCELFLAG         =  '0'
                 AND GLBL_CMPY_CD         =  #glblCmpyCd#
                 AND AR_UN_APPLY_STS_CD   =  #new#
                 AND AJE_CRAT_CPLT_FLG    =  #ajeStatusFlg#
                 ) ARUA
             ,(SELECT ACCT_DT
                 FROM AR_ACCT_DT
                WHERE EZCANCELFLAG         =  '0'
                  AND GLBL_CMPY_CD         =  #glblCmpyCd#
                  AND ONL_BAT_TP_CD        =  #batch#
             ) AAD
     WHERE
               AR.GLBL_CMPY_CD            = ARUA.GLBL_CMPY_CD
           AND AR.EZCANCELFLAG            =  '0'
           AND AR.RCPT_NUM                = ARUA.RCPT_NUM
     UNION ALL
     SELECT
               ARUA.* 
              ,AR.PAYER_CUST_CD                      PAYER_CUST_CD
              ,AR.AR_RCPT_TRX_TP_CD                  AR_RCPT_TRX_TP_CD
              ,AR.AR_RCPT_TP_CD                      AR_RCPT_TP_CD
              ,AR.DEAL_CCY_CD                        DEAL_CCY_CD
              ,AR.FUNC_CCY_CD                        FUNC_CCY_CD
              ,AR.EXCH_RATE                          EXCH_RATE
              ,AR.AR_BANK_ACCT_CD                    AR_BANK_ACCT_CD
              ,(AR.DEAL_RCPT_AMT)                    DEAL_RCPT_AMT
              ,(AR.FUNC_RCPT_AMT)                    FUNC_RCPT_AMT
              ,(AR.DEAL_NET_RCPT_AMT)                DEAL_NET_RCPT_AMT
              ,(AR.FUNC_NET_RCPT_AMT)                FUNC_NET_RCPT_AMT
              ,(AR.DEAL_VOID_AMT)                    DEAL_VOID_AMT
              ,(AR.FUNC_VOID_AMT)                    FUNC_VOID_AMT
              ,AR.COA_PROD_CD                        COA_PROD_CD
              ,AR.TOC_CD                             TOC_CD
<!-- START 2019/10/07 H.Umeda [QC#53990,MOD] -->
<!--          ,NULL                                  ACCT_DT -->
              ,AAD.ACCT_DT                           ACCT_DT
<!-- START 2019/10/07 H.Umeda [QC#53990,MOD] -->
              ,NVL(AR.AR_RCPT_SRC_CD, #defRcptSrc#)  AR_RCPT_SRC_CD
              ,AR.RCPT_CHK_NUM                       RCPT_CHK_NUM
     FROM
     		  AR_RCPT           AR
             ,(SELECT GLBL_CMPY_CD         GLBL_CMPY_CD
                     ,AR_CASH_APP_PK       AR_CASH_APP_PK
                     ,AR_CASH_APP_SQ_NUM   AR_CASH_APP_SQ_NUM
                     ,RCPT_NUM             RCPT_NUM
                     ,GL_DT                GL_DT
                     ,AR_UN_APPLY_TP_CD    AR_UN_APPLY_TP_CD
                     ,AR_UN_APPLY_STS_CD   AR_UN_APPLY_STS_CD
                     ,EZUPTIME             EZUPTIME
                     ,EZUPTIMEZONE         EZUPTIMEZONE
                FROM AR_RCPT_UN_APPLY
               WHERE EZCANCELFLAG         =  '0'
                 AND GLBL_CMPY_CD         =  #glblCmpyCd#
                 AND AR_UN_APPLY_STS_CD   =  #void#
                 AND AJE_CRAT_CPLT_FLG    =  #ajeStatusFlg#
                 ) ARUA
<!-- START 2019/10/07 H.Umeda [QC#53990,ADD] -->
             ,(SELECT ACCT_DT
                 FROM AR_ACCT_DT
                WHERE EZCANCELFLAG         =  '0'
                  AND GLBL_CMPY_CD         =  #glblCmpyCd#
                  AND ONL_BAT_TP_CD        =  #batch#
             ) AAD
<!-- END   2019/10/07 H.Umeda [QC#53990,ADD] -->
                 
     WHERE
               AR.GLBL_CMPY_CD            =  ARUA.GLBL_CMPY_CD
           AND AR.EZCANCELFLAG            =  '0'
           AND AR.RCPT_NUM                = ARUA.RCPT_NUM 
     
    UNION ALL
    SELECT 
       AR.GLBL_CMPY_CD                       GLBL_CMPY_CD
      ,0                                     AR_CASH_APP_PK
      ,NULL                                  AR_CASH_APP_SQ_NUM
      ,AR.RCPT_NUM                           RCPT_NUM
      <!-- START 2018/06/04 Y.Matsui [QC#25368,MOD] -->
      <!-- ,NVL(ABR.AR_BAT_RCPT_DT, AR.GL_DT)     GL_DT -->
      ,AR.GL_DT                              GL_DT
      <!-- END   2018/06/04 Y.Matsui [QC#25368,MOD] -->
      ,NULL                                  AR_UN_APPLY_TP_CD
      ,NULL                                  AR_UN_APPLY_STS_CD
      ,AR.EZUPTIME                           EZUPTIME
      ,AR.EZUPTIMEZONE                       EZUPTIMEZONE
      ,AR.PAYER_CUST_CD                      PAYER_CUST_CD
      ,AR.AR_RCPT_TRX_TP_CD                  AR_RCPT_TRX_TP_CD
      ,AR.AR_RCPT_TP_CD                      AR_RCPT_TP_CD
      ,AR.DEAL_CCY_CD                        DEAL_CCY_CD
      ,AR.FUNC_CCY_CD                        FUNC_CCY_CD
      ,AR.EXCH_RATE                          EXCH_RATE
      ,AR.AR_BANK_ACCT_CD                    AR_BANK_ACCT_CD
      ,AR.DEAL_RCPT_AMT                      DEAL_RCPT_AMT
      ,AR.FUNC_RCPT_AMT                      FUNC_RCPT_AMT
      ,AR.DEAL_NET_RCPT_AMT                  DEAL_NET_RCPT_AMT
      ,AR.FUNC_NET_RCPT_AMT                  FUNC_NET_RCPT_AMT
      ,AR.DEAL_VOID_AMT                      DEAL_VOID_AMT
      ,AR.FUNC_VOID_AMT                      FUNC_VOID_AMT
      ,AR.COA_PROD_CD                        COA_PROD_CD
      ,AR.TOC_CD                             TOC_CD
      ,AAD.ACCT_DT                           ACCT_DT
      ,AR.AR_RCPT_SRC_CD                     AR_RCPT_SRC_CD
      ,AR.RCPT_CHK_NUM                       RCPT_CHK_NUM
 FROM AR_RCPT AR
      ,AR_BAT_RCPT ABR
      ,(SELECT ACCT_DT
          FROM AR_ACCT_DT
         WHERE EZCANCELFLAG         =  '0'
           AND GLBL_CMPY_CD         =  #glblCmpyCd#
           AND ONL_BAT_TP_CD        =  #batch#
             ) AAD
 WHERE AR.GLBL_CMPY_CD = #glblCmpyCd#
   AND AR.EZCANCELFLAG = '0'
   AND AR.GLBL_CMPY_CD = ABR.GLBL_CMPY_CD(+)
   AND AR.EZCANCELFLAG = ABR.EZCANCELFLAG(+)
   AND AR.AR_BAT_RCPT_NM = ABR.AR_BAT_RCPT_NM(+)
<!--
   AND (ABR.AR_BAT_RCPT_STS_CD = #batRcptStsClosed# OR ABR.AR_BAT_RCPT_STS_CD IS NULL)
-->
   AND AR.AJE_CRAT_CPLT_FLG = #ajeStatusFlg#
    )           
    ORDER BY
       GLBL_CMPY_CD
      ,RCPT_NUM
      ,AR_CASH_APP_PK
      ,AR_CASH_APP_SQ_NUM
    </statement>

</sqlMap>
