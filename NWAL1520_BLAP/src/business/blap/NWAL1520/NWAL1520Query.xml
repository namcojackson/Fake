<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWAL1520Query">

    <statement id="getCategoryTypeList" parameterClass="Map" resultClass="Map">
        SELECT
              CC.CONFIG_CATG_CD
            , CC.CONFIG_CATG_DESC_TXT
        FROM
             CONFIG_CATG CC
        WHERE
             CC.GLBL_CMPY_CD       = #glblCmpyCd#
         AND CC.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getHldReasonList" parameterClass="Map" resultClass="Map">
        SELECT
             HR.HLD_RSN_CD
        FROM
             HLD_RSN HR
        WHERE
             HR.GLBL_CMPY_CD       = #glblCmpyCd#
         AND HR.HLD_RSN_DESC_TXT LIKE #hldReason# || '%'
         AND HR.HLD_REL_AVAL_FLG   = 'Y'
         AND HR.EZCANCELFLAG       = '0'
    </statement>


    <statement id="getHldApplyReasonList" parameterClass="Map" resultClass="Map">
        SELECT
             HAR.HLD_APPLY_RSN_CD
        FROM
             HLD_APPLY_RSN HAR
        WHERE
             HAR.GLBL_CMPY_CD       = #glblCmpyCd#
         AND HAR.HLD_APPLY_RSN_DESC_TXT LIKE #hldApplyReason# || '%'
         AND HAR.EZCANCELFLAG       = '0'
    </statement>
    


    <statement id="getcpoOrdNum" parameterClass="Map" resultClass="Map">
        SELECT
             C.ORD_HDR_STS_CD
        FROM
             CPO C
        WHERE
             C.GLBL_CMPY_CD       = #glblCmpyCd#
         AND C.CPO_ORD_NUM        = #cpoOrdNum# 
         AND C.EZCANCELFLAG       = '0'
    </statement>


    <statement id="getOrderInfo" parameterClass="Map" resultClass="Map">
        SELECT
               CD.ORD_LINE_STS_CD              LINE_STS_CD
             , CD.CPO_DTL_LINE_NUM             CPO_DTL_LINE_NUM
             , CD.CPO_DTL_LINE_SUB_NUM         CPO_DTL_LINE_SUB_NUM
             , DCC.CONFIG_CATG_CD              CONFIG_CATG_CD
        FROM
               DS_CPO_CONFIG DCC
             , CPO_DTL       CD
        WHERE 
             DCC.GLBL_CMPY_CD                  = #glblCmpyCd# 
         AND DCC.CPO_ORD_NUM                   = #cpoOrdNum#
    <isNotNull property="configCatgCd">
         AND DCC.CONFIG_CATG_CD                = #configCatgCd#
    </isNotNull>
         AND DCC.GLBL_CMPY_CD                  = CD.GLBL_CMPY_CD 
         AND DCC.DS_CPO_CONFIG_PK              = CD.DS_CPO_CONFIG_PK 
         AND DCC.CPO_ORD_NUM                   = CD.CPO_ORD_NUM
    <isNotNull property="dsOrdPosnNum">
         AND CD.DS_ORD_POSN_NUM IN 
         <iterate property="dsOrdPosnNum" var="dsOrdPosnNum[]" open="(" close=")" conjunction=",">
             #dsOrdPosnNum[]#
         </iterate>
    </isNotNull>
    <isNotNull property="dsCpoLineNum">
         AND CD.DS_CPO_LINE_NUM IN 
         <iterate property="dsCpoLineNum" var="dsCpoLineNum[]" open="(" close=")" conjunction=",">
             #dsCpoLineNum[]#
         </iterate>
    </isNotNull>
         AND CD.CPO_DTL_LINE_SUB_NUM           &lt;&gt; #lineSubNum# 
         AND DCC.EZCANCELFLAG                  = '0'
         AND CD.EZCANCELFLAG                   = '0'

        UNION

        SELECT
               DCRD.RTRN_LINE_STS_CD            LINE_STS_CD
             , DCRD.DS_CPO_RTRN_LINE_NUM        DS_CPO_RTRN_LINE_NUM
             , DCRD.DS_CPO_RTRN_LINE_SUB_NUM    DS_CPO_RTRN_LINE_SUB_NUM
             , DCC.CONFIG_CATG_CD               CONFIG_CATG_CD
        FROM
               DS_CPO_CONFIG   DCC
             , DS_CPO_RTRN_DTL DCRD
        WHERE 
             DCC.GLBL_CMPY_CD                  = #glblCmpyCd# 
         AND DCC.CPO_ORD_NUM                   = #cpoOrdNum#
    <isNotNull property="configCatgCd">
         AND DCC.CONFIG_CATG_CD                = #configCatgCd#
    </isNotNull>
         AND DCC.GLBL_CMPY_CD                  = DCRD.GLBL_CMPY_CD 
         AND DCC.DS_CPO_CONFIG_PK              = DCRD.DS_CPO_CONFIG_PK 
         AND DCC.CPO_ORD_NUM                   = DCRD.CPO_ORD_NUM 
    <isNotNull property="dsOrdPosnNum">
         AND DCRD.DS_ORD_POSN_NUM IN 
         <iterate property="dsOrdPosnNum" var="dsOrdPosnNum[]" open="(" close=")" conjunction=",">
             #dsOrdPosnNum[]#
         </iterate>
    </isNotNull>
    <isNotNull property="dsCpoLineNum">
         AND DCRD.DS_CPO_LINE_NUM IN 
         <iterate property="dsCpoLineNum" var="dsCpoLineNum[]" open="(" close=")" conjunction=",">
             #dsCpoLineNum[]#
         </iterate>
    </isNotNull>
         AND DCRD.DS_CPO_RTRN_LINE_SUB_NUM     &lt;&gt; #lineSubNum# 
         AND DCC.EZCANCELFLAG                  = '0'
         AND DCRD.EZCANCELFLAG                 = '0'

    </statement>

      
    <statement id="getHldList" parameterClass="Map" resultClass="Map">
    WITH
        WRK AS (
        <isNull property="lineNums">
        <isNull property="configCatgCd">
-- CPO Level
            SELECT
                  H.REL_FLG                                                                            REL_FLG
                , H.HLD_DT                                                                             HLD_DT
                , H.HLD_RSN_CD                                                                         HLD_RSN_CD
                , H.HLD_DTL_TXT                                                                        HLD_DTL_TXT
                , H.REL_DT                                                                             REL_DT
                , H.REL_MEMO_TXT                                                                       REL_MEMO_TXT
                , H.HLD_PK                                                                             HLD_PK
                , HL.HLD_LVL_DESC_TXT                                                                  HLD_LVL_DESC_TXT
                , DC.CPO_ORD_NUM                                                                       CPO_ORD_NUM
                , NULL                                                                                 DS_ORD_POSN_NUM
                , NULL                                                                                 DS_CPO_LINE_NUM
                , NULL                                                                                 DS_CPO_LINE_SUB_NUM
                , HR.HLD_RSN_DESC_TXT                                                                  HLD_RSN_DESC_TXT
                , HR.REL_FUNC_TP_CD                                                                    REL_FUNC_TP_CD
                , DH_WRK.HLD_APPLY_RSN_DESC_TXT                                                        HLD_APPLY_RSN_DESC_TXT
                , PSN.USR_NM                                                                           REL_PSN_CD
                , PSN.FIRST_NM                                                                         REL_PSN_FIRST_NM
                , PSN.LAST_NM                                                                          REL_PSN_LAST_NM
                , DH_WRK.HLD_UNTIL_DT                                                                  HLD_UNTIL_DT
                , DH_WRK.USR_NM                                                                        APP_PSN_CD
                , DH_WRK.FIRST_NM                                                                      APP_PSN_FIRST_NM
                , DH_WRK.LAST_NM                                                                       APP_PSN_LAST_NM
                , DH_WRK.HLD_REL_RSN_DESC_TXT                                                          HLD_REL_RSN_DESC_TXT
                , DH_WRK.USR_NM || ' [' || DH_WRK.FIRST_NM || ',' || DH_WRK.LAST_NM || ']'             APP_BY
                , PSN.USR_NM || ' [' || PSN.FIRST_NM || ',' || PSN.LAST_NM || ']'                      REL_BY
                , TO_CHAR(HL.HLD_LVL_SORT_NUM, 'FM000')
                    || '-' || TO_CHAR(HR.HLD_RSN_SORT_NUM,'FM000')
                    || '-' || HL.HLD_LVL_DESC_TXT  || '-' || HR.HLD_RSN_DESC_TXT                       CNT_KEY
                , HL.HLD_LVL_SORT_NUM
                , HR.HLD_RSN_SORT_NUM
                , '1'                                                                                  AS DATA_TP    <!-- 2017/08/21 S21_NA#19951 Add -->
            FROM
                  HLD              H
                 ,HLD_RSN          HR
                 ,HLD_LVL          HL
                 ,AUTH_PSN         PSN
                 ,CPO              DC
                 
                 ,(
                     SELECT
                         H1.HLD_PK
                        ,PSN1.LAST_NM
                        ,PSN1.FIRST_NM
                        ,PSN1.USR_NM
                        ,HAR.HLD_APPLY_RSN_DESC_TXT
                        ,HAR.HLD_APPLY_RSN_CD
                        ,HRR.HLD_REL_RSN_DESC_TXT
                        ,H1.HLD_UNTIL_DT
                     FROM
                         HLD             H1
                        ,HLD_APPLY_RSN   HAR
                        ,HLD_REL_RSN     HRR
                        ,AUTH_PSN        PSN1
                     WHERE
                            H1.GLBL_CMPY_CD       = #glblCmpyCd#
                        AND H1.GLBL_CMPY_CD       = HAR.GLBL_CMPY_CD(+)
                        AND H1.HLD_APPLY_RSN_CD   = HAR.HLD_APPLY_RSN_CD(+)
                        AND H1.GLBL_CMPY_CD       = HRR.GLBL_CMPY_CD(+)
                        AND H1.HLD_REL_RSN_CD     = HRR.HLD_REL_RSN_CD(+)
                        AND H1.GLBL_CMPY_CD       = PSN1.GLBL_CMPY_CD(+)
                        AND H1.HLD_APPLY_PSN_CD   = PSN1.USR_NM(+)
                        AND H1.EZCANCELFLAG       = '0'
                        AND HAR.EZCANCELFLAG(+)   = '0'
                        AND HAR.EZCANCELFLAG(+)   = '0'
                        AND PSN1.EZCANCELFLAG(+)  = '0'
                 ) DH_WRK
                 
            WHERE
                    H.GLBL_CMPY_CD                = #glblCmpyCd#
                AND H.GLBL_CMPY_CD                = HR.GLBL_CMPY_CD 
                AND H.HLD_RSN_CD                  = HR.HLD_RSN_CD 
                AND HR.HLD_REL_AVAL_FLG           = 'Y'

                AND HR.GLBL_CMPY_CD               = HL.GLBL_CMPY_CD
                AND HR.HLD_LVL_CD                 = HL.HLD_LVL_CD

                AND H.GLBL_CMPY_CD                = PSN.GLBL_CMPY_CD(+)
                AND H.REL_PSN_CD                  = PSN.USR_NM(+)

                AND H.HLD_PK                      = DH_WRK.HLD_PK(+)

                AND H.GLBL_CMPY_CD                = DC.GLBL_CMPY_CD
                AND H.CPO_ORD_NUM                 = DC.CPO_ORD_NUM
                AND H.CPO_DTL_LINE_NUM            IS NULL
                AND H.CPO_DTL_LINE_SUB_NUM        IS NULL

                AND DC.EZCANCELFLAG               = '0'
                AND H.EZCANCELFLAG                = '0'
                AND HR.EZCANCELFLAG               = '0'
                AND HL.EZCANCELFLAG               = '0'
                AND PSN.EZCANCELFLAG (+)          = '0'

               <isNotNull property="cpoOrdNum">
                AND H.CPO_ORD_NUM                 = #cpoOrdNum# 
               </isNotNull>
               <isNotNull property="configCatgCd">
                AND EXISTS (
                        SELECT  
                            'X'
                        FROM 
                            DS_CPO_CONFIG    DCC
                           ,CPO              DC
                        WHERE
                                DCC.GLBL_CMPY_CD       = H.GLBL_CMPY_CD
                            AND DCC.CONFIG_CATG_CD     = #configCatgCd#
                            AND DCC.GLBL_CMPY_CD       = DC.GLBL_CMPY_CD
                            AND DCC.CPO_ORD_NUM        = DC.CPO_ORD_NUM
                            AND H.CPO_ORD_NUM          = DC.CPO_ORD_NUM
                            AND H.CPO_DTL_LINE_NUM     IS NULL
                            AND H.CPO_DTL_LINE_SUB_NUM IS NULL
                            AND DCC.EZCANCELFLAG       = '0'
                            AND DC.EZCANCELFLAG        = '0'
               )
               </isNotNull>
               <isNotNull property="hldReason">
                AND HR.HLD_RSN_CD               = #hldReason# 
               </isNotNull>
               <isNotNull property="hldApplyReason">
                AND DH_WRK.HLD_APPLY_RSN_CD     = #hldApplyReason#
               </isNotNull>
               <isEqual property="xxRadioBtn" compareValue="0">
                AND H.REL_FLG                   = 'Y'
               </isEqual>
               <isEqual property="xxRadioBtn" compareValue="1">
                AND H.REL_FLG                   = 'N'
               </isEqual>
               <!-- isNotNull property="configCatgOutBound" 2017/08/21 S21_NA#19951 Del -->
               <!-- AND H.TRX_SRC_TP_CD            is null 2017/08/21 S21_NA#19951 Del -->
               <!--/isNotNull  2017/08/21 S21_NA#19951 Del -->
               <!-- isNotNull property="configCatgInBound" 2017/08/21 S21_NA#19951 Del -->
               <!-- AND H.TRX_SRC_TP_CD            = #trxSrcTpCdReturn#  2017/08/21 S21_NA#19951 Del -->
               <!-- /isNotNull 2017/08/21 S21_NA#19951 Del -->
               <isNotNull property="hldUntilDt">
                AND DH_WRK.HLD_UNTIL_DT        = #hldUntilDt#
               </isNotNull>
<isNull property="isHdrOnly"> <!-- 2017/07/27 S21_NA#19916-2 Add -->
            UNION
</isNull> <!-- 2017/07/27 S21_NA#19916-2 Add -->
        </isNull>
        </isNull>
<isNull property="isHdrOnly"> <!-- 2017/07/27 S21_NA#19916-2 Add -->
-- LINE Level OutBound
            SELECT
                  H.REL_FLG                                                                            REL_FLG
                , H.HLD_DT                                                                             HLD_DT
                , H.HLD_RSN_CD                                                                         HLD_RSN_CD
                , H.HLD_DTL_TXT                                                                        HLD_DTL_TXT
                , H.REL_DT                                                                             REL_DT
                , H.REL_MEMO_TXT                                                                       REL_MEMO_TXT
                , H.HLD_PK                                                                             HLD_PK
                , HL.HLD_LVL_DESC_TXT                                                                  HLD_LVL_DESC_TXT
                , DCD.CPO_ORD_NUM                                                                      CPO_ORD_NUM
                , DCD.DS_ORD_POSN_NUM                                                                  DS_ORD_POSN_NUM
                , DCD.DS_CPO_LINE_NUM                                                                  DS_CPO_LINE_NUM
                , DCD.DS_CPO_LINE_SUB_NUM                                                              DS_CPO_LINE_SUB_NUM
                , HR.HLD_RSN_DESC_TXT                                                                  HLD_RSN_DESC_TXT
                , HR.REL_FUNC_TP_CD                                                                    REL_FUNC_TP_CD
                , DH_WRK.HLD_APPLY_RSN_DESC_TXT                                                        HLD_APPLY_RSN_DESC_TXT
                , PSN.USR_NM                                                                           REL_PSN_CD
                , PSN.FIRST_NM                                                                         REL_PSN_FIRST_NM
                , PSN.LAST_NM                                                                          REL_PSN_LAST_NM
                , DH_WRK.HLD_UNTIL_DT                                                                  HLD_UNTIL_DT
                , DH_WRK.USR_NM                                                                        APP_PSN_CD
                , DH_WRK.FIRST_NM                                                                      APP_PSN_FIRST_NM
                , DH_WRK.LAST_NM                                                                       APP_PSN_LAST_NM
                , DH_WRK.HLD_REL_RSN_DESC_TXT                                                          HLD_REL_RSN_DESC_TXT
                , DH_WRK.USR_NM || ' [' || DH_WRK.FIRST_NM || ',' || DH_WRK.LAST_NM || ']'             APP_BY
                , PSN.USR_NM || ' [' || PSN.FIRST_NM || ',' || PSN.LAST_NM || ']'                      REL_BY
                , TO_CHAR(HL.HLD_LVL_SORT_NUM, 'FM000')
                    || '-' || TO_CHAR(HR.HLD_RSN_SORT_NUM, 'FM000')
                    || '-' || HL.HLD_LVL_DESC_TXT  || '-' || HR.HLD_RSN_DESC_TXT                       CNT_KEY
                , HL.HLD_LVL_SORT_NUM
                , HR.HLD_RSN_SORT_NUM
                , '2'                                                                                  AS DATA_TP    <!-- 2017/08/21 S21_NA#19951 Add -->
            FROM
                  HLD              H
                 ,HLD_RSN          HR
                 ,HLD_LVL          HL
                 ,AUTH_PSN         PSN
                 ,CPO_DTL          DCD
                 
                 ,(
                     SELECT
                         H1.HLD_PK
                        ,PSN1.LAST_NM
                        ,PSN1.FIRST_NM
                        ,PSN1.USR_NM
                        ,HAR.HLD_APPLY_RSN_DESC_TXT
                        ,HAR.HLD_APPLY_RSN_CD
                        ,HRR.HLD_REL_RSN_DESC_TXT
                        ,H1.HLD_UNTIL_DT
                     FROM
                         HLD             H1
                        ,HLD_APPLY_RSN   HAR
                        ,HLD_REL_RSN     HRR
                        ,AUTH_PSN        PSN1
                     WHERE
                            H1.GLBL_CMPY_CD       = #glblCmpyCd#
                        AND H1.GLBL_CMPY_CD       = HAR.GLBL_CMPY_CD(+)
                        AND H1.HLD_APPLY_RSN_CD   = HAR.HLD_APPLY_RSN_CD(+)
                        AND H1.GLBL_CMPY_CD       = HRR.GLBL_CMPY_CD(+)
                        AND H1.HLD_REL_RSN_CD     = HRR.HLD_REL_RSN_CD(+)
                        AND H1.GLBL_CMPY_CD       = PSN1.GLBL_CMPY_CD(+)
                        AND H1.HLD_APPLY_PSN_CD   = PSN1.USR_NM(+)
                        AND H1.EZCANCELFLAG       = '0'
                        AND HAR.EZCANCELFLAG(+)   = '0'
                        AND HAR.EZCANCELFLAG(+)   = '0'
                        AND PSN1.EZCANCELFLAG(+)  = '0'
                 ) DH_WRK
                 
            WHERE
                    H.GLBL_CMPY_CD                = #glblCmpyCd#
                AND H.GLBL_CMPY_CD                = HR.GLBL_CMPY_CD 
                AND H.HLD_RSN_CD                  = HR.HLD_RSN_CD 
                AND HR.HLD_REL_AVAL_FLG           = 'Y'

                AND HR.GLBL_CMPY_CD               = HL.GLBL_CMPY_CD
                AND HR.HLD_LVL_CD                 = HL.HLD_LVL_CD

                AND H.GLBL_CMPY_CD                = PSN.GLBL_CMPY_CD(+)
                AND H.REL_PSN_CD                  = PSN.USR_NM(+)

                AND H.HLD_PK                      = DH_WRK.HLD_PK(+)

                AND H.GLBL_CMPY_CD                = DCD.GLBL_CMPY_CD
                AND H.CPO_ORD_NUM                 = DCD.CPO_ORD_NUM
                AND H.CPO_DTL_LINE_NUM            = DCD.CPO_DTL_LINE_NUM
                AND H.CPO_DTL_LINE_SUB_NUM        = DCD.CPO_DTL_LINE_SUB_NUM

                AND DCD.EZCANCELFLAG              = '0'
                AND H.EZCANCELFLAG                = '0'
                AND HR.EZCANCELFLAG               = '0'
                AND HL.EZCANCELFLAG               = '0'
                AND PSN.EZCANCELFLAG (+)          = '0'

               <isNotNull property="cpoOrdNum">
                AND H.CPO_ORD_NUM                 = #cpoOrdNum# 
               </isNotNull>
               <isNotNull property="configCatgCd">
                AND EXISTS (
                        SELECT  
                            'X'
                        FROM 
                            DS_CPO_CONFIG    DCC
                           ,CPO_DTL          DCD
                        WHERE
                                DCC.GLBL_CMPY_CD       = H.GLBL_CMPY_CD
                            AND DCC.CONFIG_CATG_CD     = #configCatgCd#
                            AND DCC.GLBL_CMPY_CD       = DCD.GLBL_CMPY_CD
                            AND DCC.DS_CPO_CONFIG_PK   = DCD.DS_CPO_CONFIG_PK
                            AND H.CPO_ORD_NUM          = DCD.CPO_ORD_NUM
                            AND H.CPO_DTL_LINE_NUM     = DCD.CPO_DTL_LINE_NUM
                            AND H.CPO_DTL_LINE_SUB_NUM = DCD.CPO_DTL_LINE_SUB_NUM
                            AND DCC.EZCANCELFLAG       = '0'
                            AND DCD.EZCANCELFLAG       = '0'
               )
               </isNotNull>
               <isNotNull property="lineNums">
                AND EXISTS (
                        SELECT
                            'X'
                        FROM 
                            CPO_DTL    DCD
                        WHERE 
                                DCD.GLBL_CMPY_CD          = H.GLBL_CMPY_CD
                            AND DCD.CPO_ORD_NUM           = H.CPO_ORD_NUM
                            AND DCD.CPO_DTL_LINE_NUM      = H.CPO_DTL_LINE_NUM
                            AND DCD.CPO_DTL_LINE_SUB_NUM  = H.CPO_DTL_LINE_SUB_NUM
                            AND DCD.EZCANCELFLAG          = '0'
                            AND DCD.DS_ORD_POSN_NUM IN 
                           <iterate property="dsOrdPosnNumList" var="dsOrdPosnNum[]" open="(" close=")" conjunction=",">
                               #dsOrdPosnNum[]#
                           </iterate>
                           <isNotNull property="hasLineNum">
                            AND DCD.DS_CPO_LINE_NUM IN 
                           <iterate property="dsCpoLineNumList" var="dsCpoLineNum[]" open="(" close=")" conjunction=",">
                                #dsCpoLineNum[]#
                           </iterate>
                           </isNotNull>
                )

               </isNotNull>
               <isNotNull property="hldReason">
                AND HR.HLD_RSN_CD               = #hldReason# 
               </isNotNull>
               <isNotNull property="hldApplyReason">
                AND DH_WRK.HLD_APPLY_RSN_CD     = #hldApplyReason#
               </isNotNull>
               <isEqual property="xxRadioBtn" compareValue="0">
                AND H.REL_FLG                   = 'Y'
               </isEqual>
               <isEqual property="xxRadioBtn" compareValue="1">
                AND H.REL_FLG                   = 'N'
               </isEqual>
               <!-- isNotNull property="configCatgOutBound" 2017/08/21 S21_NA#19951 Del -->
                AND H.TRX_SRC_TP_CD            is null
               <!-- /isNotNull 2017/08/21 S21_NA#19951 Del -->
               <!-- isNotNull property="configCatgInBound" 2017/08/21 S21_NA#19951 Del -->
                <!-- AND H.TRX_SRC_TP_CD            = #trxSrcTpCdReturn# 2017/08/21 S21_NA#19951 Del -->
               <!-- /isNotNull 2017/08/21 S21_NA#19951 Del -->
               <isNotNull property="hldUntilDt">
                AND DH_WRK.HLD_UNTIL_DT        = #hldUntilDt#
               </isNotNull>
-- LINE Level InBound
            UNION
            SELECT
                  H.REL_FLG                                                                            REL_FLG
                , H.HLD_DT                                                                             HLD_DT
                , H.HLD_RSN_CD                                                                         HLD_RSN_CD
                , H.HLD_DTL_TXT                                                                        HLD_DTL_TXT
                , H.REL_DT                                                                             REL_DT
                , H.REL_MEMO_TXT                                                                       REL_MEMO_TXT
                , H.HLD_PK                                                                             HLD_PK
                <!-- START 2017/09/19 H.Sugawara [QC#19918,MOD] -->
                <!-- , HL.HLD_LVL_DESC_TXT || '(RMA)'                                                       HLD_LVL_DESC_TXT -->
                , HL.HLD_LVL_DESC_TXT || #rmaSuffix#                                                   HLD_LVL_DESC_TXT
                <!-- END 2017/09/19 H.Sugawara [QC#19918,MOD] -->
                , DCRD.CPO_ORD_NUM                                                                     CPO_ORD_NUM
                , DCRD.DS_ORD_POSN_NUM                                                                 DS_ORD_POSN_NUM
                , DCRD.DS_CPO_LINE_NUM                                                                 DS_CPO_LINE_NUM
                , DCRD.DS_CPO_LINE_SUB_NUM                                                             DS_CPO_LINE_SUB_NUM
                , HR.HLD_RSN_DESC_TXT                                                                  HLD_RSN_DESC_TXT
                , HR.REL_FUNC_TP_CD                                                                    REL_FUNC_TP_CD
                , DH_WRK.HLD_APPLY_RSN_DESC_TXT                                                        HLD_APPLY_RSN_DESC_TXT
                , PSN.USR_NM                                                                           REL_PSN_CD
                , PSN.FIRST_NM                                                                         REL_PSN_FIRST_NM
                , PSN.LAST_NM                                                                          REL_PSN_LAST_NM
                , DH_WRK.HLD_UNTIL_DT                                                                  HLD_UNTIL_DT
                , DH_WRK.USR_NM                                                                        APP_PSN_CD
                , DH_WRK.FIRST_NM                                                                      APP_PSN_FIRST_NM
                , DH_WRK.LAST_NM                                                                       APP_PSN_LAST_NM
                , DH_WRK.HLD_REL_RSN_DESC_TXT                                                          HLD_REL_RSN_DESC_TXT
                , DH_WRK.USR_NM || ' [' || DH_WRK.FIRST_NM || ',' || DH_WRK.LAST_NM || ']'             APP_BY
                , PSN.USR_NM || ' [' || PSN.FIRST_NM || ',' || PSN.LAST_NM || ']'                      REL_BY
                , TO_CHAR(HL.HLD_LVL_SORT_NUM, 'FM000')
                    || '-' || TO_CHAR(HR.HLD_RSN_SORT_NUM, 'FM000')
                    || '-' || HL.HLD_LVL_DESC_TXT  || '-' || HR.HLD_RSN_DESC_TXT                       CNT_KEY
                , HL.HLD_LVL_SORT_NUM
                , HR.HLD_RSN_SORT_NUM
                , '3'                                                                                  AS DATA_TP    <!-- 2017/08/21 S21_NA#19951 Add -->
            FROM
                  HLD              H
                 ,HLD_RSN          HR
                 ,HLD_LVL          HL
                 ,AUTH_PSN         PSN
                 ,DS_CPO_RTRN_DTL  DCRD
                 
                 ,(
                     SELECT
                         H1.HLD_PK
                        ,PSN1.LAST_NM
                        ,PSN1.FIRST_NM
                        ,PSN1.USR_NM
                        ,HAR.HLD_APPLY_RSN_DESC_TXT
                        ,HAR.HLD_APPLY_RSN_CD
                        ,HRR.HLD_REL_RSN_DESC_TXT
                        ,H1.HLD_UNTIL_DT
                     FROM
                         HLD             H1
                        ,HLD_APPLY_RSN   HAR
                        ,HLD_REL_RSN     HRR
                        ,AUTH_PSN        PSN1
                     WHERE
                            H1.GLBL_CMPY_CD       = #glblCmpyCd#
                        AND H1.GLBL_CMPY_CD       = HAR.GLBL_CMPY_CD(+)
                        AND H1.HLD_APPLY_RSN_CD   = HAR.HLD_APPLY_RSN_CD(+)
                        AND H1.GLBL_CMPY_CD       = HRR.GLBL_CMPY_CD(+)
                        AND H1.HLD_REL_RSN_CD     = HRR.HLD_REL_RSN_CD(+)
                        AND H1.GLBL_CMPY_CD       = PSN1.GLBL_CMPY_CD(+)
                        AND H1.HLD_APPLY_PSN_CD   = PSN1.USR_NM(+)
                        AND H1.EZCANCELFLAG       = '0'
                        AND HAR.EZCANCELFLAG(+)   = '0'
                        AND HAR.EZCANCELFLAG(+)   = '0'
                        AND PSN1.EZCANCELFLAG(+)  = '0'
                 ) DH_WRK
                 
            WHERE
                    H.GLBL_CMPY_CD                = #glblCmpyCd#
                AND H.GLBL_CMPY_CD                = HR.GLBL_CMPY_CD 
                AND H.HLD_RSN_CD                  = HR.HLD_RSN_CD 
                AND HR.HLD_REL_AVAL_FLG           = 'Y'

                AND HR.GLBL_CMPY_CD               = HL.GLBL_CMPY_CD
                AND HR.HLD_LVL_CD                 = HL.HLD_LVL_CD

                AND H.GLBL_CMPY_CD                = PSN.GLBL_CMPY_CD(+)
                AND H.REL_PSN_CD                  = PSN.USR_NM(+)

                AND H.HLD_PK                      = DH_WRK.HLD_PK(+)

                AND H.GLBL_CMPY_CD                = DCRD.GLBL_CMPY_CD
                AND H.CPO_ORD_NUM                 = DCRD.CPO_ORD_NUM
                AND H.CPO_DTL_LINE_NUM            = DCRD.DS_CPO_RTRN_LINE_NUM
                AND H.CPO_DTL_LINE_SUB_NUM        = DCRD.DS_CPO_RTRN_LINE_SUB_NUM

                AND DCRD.EZCANCELFLAG             = '0'
                AND H.EZCANCELFLAG                = '0'
                AND HR.EZCANCELFLAG               = '0'
                AND HL.EZCANCELFLAG               = '0'
                AND PSN.EZCANCELFLAG (+)          = '0'

               <isNotNull property="cpoOrdNum">
                AND H.CPO_ORD_NUM                 = #cpoOrdNum# 
               </isNotNull>
               <isNotNull property="configCatgCd">
                AND EXISTS (
                        SELECT
                            'X'
                        FROM 
                            DS_CPO_CONFIG    DCC
                           ,DS_CPO_RTRN_DTL  DCRD
                        WHERE
                                DCC.GLBL_CMPY_CD       = H.GLBL_CMPY_CD
                            AND DCC.CONFIG_CATG_CD     = #configCatgCd#
                            AND DCC.GLBL_CMPY_CD       = DCRD.GLBL_CMPY_CD
                            AND DCC.DS_CPO_CONFIG_PK   = DCRD.DS_CPO_CONFIG_PK
                            AND H.CPO_ORD_NUM          = DCRD.CPO_ORD_NUM
                            AND H.CPO_DTL_LINE_NUM     = DCRD.DS_CPO_RTRN_LINE_NUM
                            AND H.CPO_DTL_LINE_SUB_NUM = DCRD.DS_CPO_RTRN_LINE_SUB_NUM
                            AND DCRD.EZCANCELFLAG      = '0'
                            AND DCC.EZCANCELFLAG       = '0'
               )
               </isNotNull>
               <isNotNull property="lineNums">
                AND EXISTS (
                        SELECT
                            'X'
                        FROM 
                            DS_CPO_RTRN_DTL    DCRD
                        WHERE 
                                DCRD.GLBL_CMPY_CD             = H.GLBL_CMPY_CD
                            AND DCRD.CPO_ORD_NUM              = H.CPO_ORD_NUM
                            AND DCRD.DS_CPO_RTRN_LINE_NUM     = H.CPO_DTL_LINE_NUM
                            AND DCRD.DS_CPO_RTRN_LINE_SUB_NUM = H.CPO_DTL_LINE_SUB_NUM
                            AND DCRD.EZCANCELFLAG             = '0'
                            AND DCRD.DS_ORD_POSN_NUM IN 
                           <iterate property="dsOrdPosnNumList" var="dsOrdPosnNum[]" open="(" close=")" conjunction=",">
                                #dsOrdPosnNum[]#
                           </iterate>

                           <isNotNull property="hasLineNum">
                            AND DCRD.DS_CPO_LINE_NUM IN 
                           <iterate property="dsCpoLineNumList" var="dsCpoLineNum[]" open="(" close=")" conjunction=",">
                                #dsCpoLineNum[]#
                           </iterate>
                           </isNotNull>
                )

               </isNotNull>
               <isNotNull property="hldReason">
                AND HR.HLD_RSN_CD               = #hldReason# 
               </isNotNull>
               <isNotNull property="hldApplyReason">
                AND DH_WRK.HLD_APPLY_RSN_CD     = #hldApplyReason#
               </isNotNull>
               <isEqual property="xxRadioBtn" compareValue="0">
                AND H.REL_FLG                   = 'Y'
               </isEqual>
               <isEqual property="xxRadioBtn" compareValue="1">
                AND H.REL_FLG                   = 'N'
               </isEqual>
               <!-- isNotNull property="configCatgOutBound" 2017/08/21 S21_NA#19951 Del -->
                <!-- AND H.TRX_SRC_TP_CD            is null 2017/08/21 S21_NA#19951 Del -->
               <!-- /isNotNull 2017/08/21 S21_NA#19951 Del -->
               <!-- isNotNull property="configCatgInBound" 2017/08/21 S21_NA#19951 Del -->
                AND H.TRX_SRC_TP_CD            = #trxSrcTpCdReturn#
               <!-- /isNotNull 2017/08/21 S21_NA#19951 Del -->
               <isNotNull property="hldUntilDt">
                AND DH_WRK.HLD_UNTIL_DT        = #hldUntilDt#
               </isNotNull>
</isNull> <!-- 2017/07/27 S21_NA#19916-2 Add -->
            ORDER BY
                 CPO_ORD_NUM      ASC
                ,DATA_TP          ASC               <!-- 2017/08/21 S21_NA#19951 Add -->
                ,DS_ORD_POSN_NUM  Nulls First
                ,DS_CPO_LINE_NUM  Nulls First
                ,DS_CPO_LINE_SUB_NUM  Nulls First   <!-- 2017/08/21 S21_NA#19951 Add -->
                ,HLD_LVL_SORT_NUM  ASC
                ,HLD_RSN_SORT_NUM  ASC
        )

        SELECT
             WRK.REL_FLG
            ,WRK.HLD_DT
            ,WRK.HLD_RSN_CD
            ,WRK.HLD_DTL_TXT
            ,WRK.REL_DT
            ,WRK.REL_MEMO_TXT
            ,WRK.HLD_PK
            ,WRK.HLD_LVL_DESC_TXT
            ,WRK.CPO_ORD_NUM
            ,WRK.DS_ORD_POSN_NUM
            ,WRK.DS_CPO_LINE_NUM
            ,WRK.DS_CPO_LINE_SUB_NUM
            ,WRK.HLD_RSN_DESC_TXT
            ,WRK.REL_FUNC_TP_CD
            ,WRK.HLD_APPLY_RSN_DESC_TXT
            ,WRK.REL_PSN_CD
            ,WRK.REL_PSN_FIRST_NM
            ,WRK.REL_PSN_LAST_NM
            ,WRK.HLD_UNTIL_DT
            ,WRK.APP_PSN_CD
            ,WRK.APP_PSN_FIRST_NM
            ,WRK.APP_PSN_LAST_NM
            ,WRK.HLD_REL_RSN_DESC_TXT
            ,WRK.APP_BY
            ,WRK.REL_BY
            ,WRK.CNT_KEY
        FROM
            WRK
        <!-- 
         WHERE
            ROWNUM <![CDATA[<=]]> #rowNum#
         -->

    </statement>
    
    <!-- Add Start 2019/09/11 QC#51929 -->
    <statement id="getRteStsRoutedCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
              COUNT(SP.RTE_STS_CD) AS CNT_ROUTE 
        FROM
              CPO_DTL  CD
            , SHPG_PLN SP 
        WHERE
                CD.GLBL_CMPY_CD         = #glblCmpyCd# 
            AND CD.CPO_ORD_NUM          = #cpoOrdNum# 
        <isNotNull property="lineParamList">
            AND (
            <iterate property="lineParamList" var="lineParam[]" open="(" close=")" conjunction=") OR (">
                    CD.DS_ORD_POSN_NUM  = #lineParam[].dsOrdPosnNum#
                AND CD.DS_CPO_LINE_NUM  = #lineParam[].dsCpoLineNum#
            </iterate>
            )
        </isNotNull>
            AND CD.CPO_DTL_LINE_SUB_NUM &lt;&gt; #lineSubNum# 
            AND CD.ORD_LINE_STS_CD      NOT IN (#ordLineStsShipped#, #ordLineStsClosed#, #ordLineStsCanceled#) 

            AND CD.CPO_ORD_NUM          = SP.TRX_HDR_NUM 
            AND CD.CPO_DTL_LINE_NUM     = SP.TRX_LINE_NUM 
            AND CD.CPO_DTL_LINE_SUB_NUM = SP.TRX_LINE_SUB_NUM 
            AND SP.RTE_STS_CD           IN (#rteStsRouted#, #rteStsSOCreating#) 

            AND CD.EZCANCELFLAG         = '0' 
            AND SP.EZCANCELFLAG         = '0'

    </statement>
    <!-- Add End 2019/09/11 QC#51929 -->
    <!-- 2019/09/20 QC#53184 Add Start -->
    <statement id="getShipPlanNumFromOrdNum" parameterClass="Map" resultClass="Map">
        SELECT
           SP.SHPG_PLN_NUM               AS SHPG_PLN_NUM
        FROM
            SHPG_PLN             SP
           ,CPO                  C
           ,CPO_DTL              CD
           ,DS_CPO_CONFIG        DCC
        WHERE
                C.GLBL_CMPY_CD          = #glblCmpyCd#
            AND C.CPO_ORD_NUM           = #cpoOrdNum#
            AND C.EZCANCELFLAG          = '0'
            AND C.GLBL_CMPY_CD          = DCC.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM           = DCC.CPO_ORD_NUM
            AND DCC.EZCANCELFLAG        = '0'
            AND DCC.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
            AND DCC.DS_CPO_CONFIG_PK    = CD.DS_CPO_CONFIG_PK
            AND CD.EZCANCELFLAG         = '0'
            AND CD.GLBL_CMPY_CD         = SP.GLBL_CMPY_CD
            AND CD.CPO_ORD_NUM          = SP.TRX_HDR_NUM
            AND CD.CPO_DTL_LINE_NUM     = SP.TRX_LINE_NUM 
            AND CD.CPO_DTL_LINE_SUB_NUM = SP.TRX_LINE_SUB_NUM
            AND SP.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getRmaDtlNumFromOrdNum" parameterClass="Map" resultClass="Map">
        SELECT
            RD.DS_CPO_RTRN_LINE_NUM       AS DS_CPO_RTRN_LINE_NUM
           ,RD.DS_CPO_RTRN_LINE_SUB_NUM   AS DS_CPO_RTRN_LINE_SUB_NUM
        FROM
            DS_CPO_RTRN_DTL      RD
           ,CPO                  C
        WHERE
                RD.GLBL_CMPY_CD = #glblCmpyCd#
            AND RD.CPO_ORD_NUM  = #cpoOrdNum#
            AND RD.EZCANCELFLAG = '0'
            AND RD.GLBL_CMPY_CD = C.GLBL_CMPY_CD
            AND RD.CPO_ORD_NUM  = C.CPO_ORD_NUM
            AND C.EZCANCELFLAG  = '0'
    </statement>
    <!-- 2019/09/20 QC#53184 Add End -->
</sqlMap>
