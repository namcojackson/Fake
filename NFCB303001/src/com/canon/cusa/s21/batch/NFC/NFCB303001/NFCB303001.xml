<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NFCB303001">
    
    <statement id="getRequestData" parameterClass="Map">
        SELECT
                WOR.GLBL_CMPY_CD
               ,WOR.AR_WRT_OFF_RQST_PK
               ,WOR.WRT_OFF_RQST_GRP_CD
               ,WOR.WRT_OFF_RQST_USR_ID
               ,WOR.AR_ADJ_RSN_CD
               ,WOR.AR_ADJ_TP_CD
               ,WOR.LOW_RMNG_BAL_AMT	
               ,WOR.HIGH_RMNG_BAL_AMT
               ,WOR.LOW_INV_NUM
               ,WOR.HIGH_INV_NUM
               ,WOR.LOW_INV_DUE_DT
               ,WOR.HIGH_INV_DUE_DT
               ,WOR.LOW_DS_ACCT_NUM
               ,WOR.HIGH_DS_ACCT_NUM
               ,WOR.LOW_BILL_TO_CUST_CD
               ,WOR.HIGH_BILL_TO_CUST_CD
               ,WOR.INV_TP_CD
               ,WOR.INCL_CONSL_INV_FLG
               ,WOR.WRT_OFF_OPT_TP_CD
               ,WOR.WRT_OFF_APPLY_AMT
               ,WOR.AR_WRT_OFF_NOTE_CD
               ,WOR.AR_WRT_OFF_NOTE_TXT
               ,WOR.AR_WRT_OFF_RQST_TP_CD
               ,WOR.AR_DS_WF_STS_CD
               ,NVL(AAR.AR_ADJ_RSN_NM, WON.AR_WRT_OFF_NOTE_NM)   AR_ADJ_RSN_NM
               ,AAT.AR_ADJ_TP_NM
               ,AAT.AR_ADJ_CATG_CD
               <!-- add start 2022/11/28 QC#57252 -->
               ,WOR.ADJ_COA_CMPY_CD
               ,WOR.ADJ_COA_BR_CD
               ,WOR.ADJ_COA_CC_CD
               ,WOR.ADJ_COA_ACCT_CD
               ,WOR.ADJ_COA_PROD_CD
               ,WOR.ADJ_COA_CH_CD
               ,WOR.ADJ_COA_AFFL_CD
               ,WOR.ADJ_COA_PROJ_CD
               ,WOR.ADJ_COA_EXTN_CD
               <!-- add end 2022/11/28 QC#57252 -->
         FROM 
             AR_WRT_OFF_RQST         WOR
            ,AR_ADJ_RSN              AAR
            ,AR_ADJ_TP               AAT
            ,AR_WRT_OFF_NOTE         WON
       WHERE
                WOR.GLBL_CMPY_CD            = #glblCmpyCd#
            AND WOR.EZCANCELFLAG            = '0'
            AND WOR.PROC_STS_CD             = #unProc#
            AND WOR.AR_DS_WF_STS_CD         = #wfSts#
            <isNotNull property="execMode">
            AND WOR.AR_WRT_OFF_RQST_TP_CD   = #execMode#
            </isNotNull>
            <isNull property="execMode">
            AND WOR.AR_WRT_OFF_RQST_TP_CD   &lt;&gt; #system#
            </isNull>
            AND WOR.GLBL_CMPY_CD            = AAR.GLBL_CMPY_CD(+)
            AND WOR.EZCANCELFLAG            = AAR.EZCANCELFLAG(+)
            AND WOR.AR_ADJ_RSN_CD           = AAR.AR_ADJ_RSN_CD(+)
            AND WOR.GLBL_CMPY_CD            = AAT.GLBL_CMPY_CD(+)
            AND WOR.EZCANCELFLAG            = AAT.EZCANCELFLAG(+)
            AND WOR.AR_ADJ_TP_CD            = AAT.AR_ADJ_TP_CD(+)
            AND WOR.EZCANCELFLAG            = WON.EZCANCELFLAG(+)
            AND WOR.GLBL_CMPY_CD            = WON.GLBL_CMPY_CD(+)
            AND WOR.AR_WRT_OFF_NOTE_CD      = WON.AR_WRT_OFF_NOTE_CD(+)
       ORDER BY AR_WRT_OFF_RQST_TP_CD
      </statement>
 
<!-- START 2018/11/19 T.Ogura [QC#29334,DEL] -->
<!--  <statement id="getApprovalLimit" parameterClass="Map" resultClass="Map"> -->
<!--        SELECT APVL_LIMIT_FROM_AMT -->
<!--              ,APVL_LIMIT_TO_AMT -->
<!--          FROM AR_ADJ_APVL_LIMIT -->
<!--         WHERE GLBL_CMPY_CD        = #glblCmpyCd# -->
<!--           AND EZCANCELFLAG        = '0' -->
<!--           AND AR_ADJ_APVL_USR_ID  = #usrId# -->
<!--           AND AR_ADJ_CATG_CD      = #arAdjCatgCd# -->
<!--           AND APVL_LIMIT_RF_FLG   = #flgN# -->
<!--           AND APVL_LIMIT_ACTV_FLG = #flgY# -->
<!--    </statement> -->
<!-- END   2018/11/19 T.Ogura [QC#29334,DEL] -->

        <statement id="getUserOfErrRqst" parameterClass="Map">
            SELECT MAX(PSN.EML_ADDR)          EML_ADDR
                  ,WRT_OFF_RQST_GRP_CD        WRT_OFF_RQST_GRP_CD
                  ,SUBSTR(WOR.EZINTIME, 1, 8) EZINTIME
              FROM AR_WRT_OFF_RQST WOR
                  ,S21_PSN         PSN                  
             WHERE WOR.GLBL_CMPY_CD        = #glblCmpyCd#
               AND WOR.EZCANCELFLAG        = '0'
               AND WOR.EZCANCELFLAG        = PSN.EZCANCELFLAG(+)
               AND WOR.GLBL_CMPY_CD        = PSN.GLBL_CMPY_CD(+)
               AND WOR.WRT_OFF_RQST_USR_ID = PSN.PSN_CD(+)
               AND WOR.AR_WRT_OFF_RQST_PK IN
               <iterate property="pkList" var="pk[]" open="(" close=")" conjunction=",">
               #pk[]#
               </iterate>
            GROUP BY WOR.WRT_OFF_RQST_USR_ID
                    ,WOR.WRT_OFF_RQST_GRP_CD
                    ,SUBSTR(WOR.EZINTIME, 1, 8)
        </statement>
	
</sqlMap>
