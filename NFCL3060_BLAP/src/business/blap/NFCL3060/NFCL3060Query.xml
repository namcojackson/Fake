<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NFCL3060Query">

    <typeAlias alias="NFCL3060SMsg"		type="business.blap.NFCL3060.NFCL3060SMsg"/>
    <typeAlias alias="NFCL3060_ASMsg"  type="business.blap.NFCL3060.NFCL3060_ASMsg"/>

    <statement id="getPaymentTerm" parameterClass="Map" resultMap="result.getPaymentTerm">
        SELECT
               Y.PMT_TERM_CASH_DISC_DESC_TXT
            FROM
	            (SELECT
	                 TRIM(I.PMT_TERM_CASH_DISC_CD)||' '||TRIM(I.PMT_TERM_CASH_DISC_DESC_TXT) PMT_TERM_CASH_DISC_DESC_TXT
	             FROM
	                 INV I
	             WHERE
	                I.GLBL_CMPY_CD                      = #glblCmpyCd#
	                <isNotNull property="arTrxNum">
	                AND I.INV_NUM                       = #arTrxNum#
	                </isNotNull>
	                AND I.EZCANCELFLAG                  = '0'
	                 ) Y
    </statement>

    <resultMap id="result.getPaymentTerm" class="NFCL3060SMsg">
        <result property="xxDplyByItemNm"     column="PMT_TERM_CASH_DISC_DESC_TXT"      javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="getInvList" parameterClass="Map" resultMap="result.getInvList">
        SELECT
             X.AR_TRX_NUM
            ,X.AR_TRX_NUM_B
            ,X.INV_DUE_DT
            ,X.DEAL_ORIG_GRS_AMT
            ,X.DEAL_RMNG_BAL_GRS_AMT
            ,X.AR_TRX_TP_DESC_TXT
            ,X.AR_CASH_APPLY_STS_DESC_TXT
        FROM
            (SELECT
                 ATB.AR_TRX_NUM
                ,TO_NUMBER(SUBSTR(ATB.AR_TRX_NUM,INSTR(ATB.AR_TRX_NUM, '-')+1)) AR_TRX_NUM_B
                ,ATB.INV_DUE_DT
                ,ATB.DEAL_ORIG_GRS_AMT
                ,ATB.DEAL_RMNG_BAL_GRS_AMT
                ,ATB.AR_TRX_TP_CD
                ,ATB.AR_CASH_APPLY_STS_CD
                ,ATT.AR_TRX_TP_DESC_TXT
                ,ACS.AR_CASH_APPLY_STS_DESC_TXT
            FROM
                 AR_TRX_BAL ATB
                ,AR_TRX_TP ATT
                ,AR_CASH_APPLY_STS ACS
            WHERE
                ATB.GLBL_CMPY_CD                    = #glblCmpyCd#
                <isNotNull property="arTrxNum">
                AND ATB.AR_TRX_NUM                  LIKE #arTrxNum# || '-%'
                </isNotNull>
                AND ATT.GLBL_CMPY_CD(+)             = ATB.GLBL_CMPY_CD
                AND ATT.AR_TRX_TP_CD(+)             = ATB.AR_TRX_TP_CD
                AND ACS.GLBL_CMPY_CD(+)             = ATB.GLBL_CMPY_CD
                AND ACS.AR_CASH_APPLY_STS_CD(+)     = ATB.AR_CASH_APPLY_STS_CD
                <!-- QC#25090 Add Start-->
                AND EXISTS
                    (SELECT 
                        PTCD.PMT_TERM_CASH_DISC_CD 
                     FROM 
                        PMT_TERM_CASH_DISC PTCD 
                     WHERE 
                        ATB.PMT_TERM_CASH_DISC_CD  = PTCD.PMT_TERM_CASH_DISC_CD 
                        AND PTCD.ISTL_PMT_TERM_FLG = #istlPmtTermFlg#
                        AND PTCD.GLBL_CMPY_CD      = #glblCmpyCd#
                        AND PTCD.EZCANCELFLAG      = '0'
                        )
                <!-- QC#25090 Add End-->
                AND ATB.EZCANCELFLAG                = '0'
                AND ATT.EZCANCELFLAG(+)             = '0'
                AND ACS.EZCANCELFLAG(+)             = '0'
            ORDER BY
                 ATB.INV_DUE_DT
                ,ATB.AR_TRX_NUM
                 ) X
      WHERE
        ROWNUM &lt;= #rowNum#
    </statement>

    <resultMap id="result.getInvList" class="NFCL3060_ASMsg">
        <result property="arTrxNum_A"                  column="AR_TRX_NUM"                      javaType="EZDSStringItem"/>
        <result property="arTrxNum_B"                  column="AR_TRX_NUM_B"                    javaType="EZDSStringItem"/>
        <result property="arTrxTpDescTxt_A"            column="AR_TRX_TP_DESC_TXT"              javaType="EZDSStringItem"/>
        <result property="invDueDt_A"                  column="INV_DUE_DT"                      javaType="EZDSStringItem"/>
        <result property="dealOrigGrsAmt_A"            column="DEAL_ORIG_GRS_AMT"               javaType="EZDTBigDecimalItem"/>
        <result property="dealRmngBalGrsAmt_A"         column="DEAL_RMNG_BAL_GRS_AMT"           javaType="EZDTBigDecimalItem"/>
        <result property="arCashApplyStsDescTxt_A"     column="AR_CASH_APPLY_STS_DESC_TXT"      javaType="EZDSStringItem"/>
    </resultMap>
</sqlMap>
