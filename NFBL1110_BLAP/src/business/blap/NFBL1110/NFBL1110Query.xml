<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NFBL1110Query">

    <typeAlias alias="NFBL1110CMsg" type="business.blap.NFBL1110.NFBL1110CMsg"/>

    <statement id="getBatPkByBatNum" parameterClass="Map" resultClass="Map">
        SELECT
            CM_MAINT_INV_BAT_PK
        FROM
            CM_MAINT_INV_BAT
        WHERE
            GLBL_CMPY_CD     = #glblCmpyCd#
        AND AP_BAT_NUM       = #apBatNum#
        AND EZCANCELFLAG     = '0'
    </statement>

    <statement id="getCntrTpPulldownListValue" parameterClass="Map" resultClass="Map">
        SELECT
            CNTR_TP_CD
        ,   CNTR_TP_NM
        FROM
            CNTR_TP
        WHERE
            GLBL_CMPY_CD     = #glblCmpyCd#
        AND EZCANCELFLAG     = '0'
        ORDER BY
            CNTR_TP_SORT_NUM
    </statement>

    <statement id="getInvListByBatNum" parameterClass="Map" resultClass="Map">
        SELECT
            AP_INV_NUM
        ,   AP_VND_CD
        ,   NVL(AP_INV_AMT,0) AP_INV_AMT
        FROM
            CM_MAINT_INV
        WHERE
            GLBL_CMPY_CD     = #glblCmpyCd#
        AND AP_BAT_NUM       = #apBatNum#
        AND EZCANCELFLAG     = '0'
        AND ROWNUM       &lt;= TO_NUMBER(#rownum#)
        ORDER BY
            AP_INV_NUM
        ,   AP_VND_CD
    </statement>

    <statement id="checkLocNm" parameterClass="Map" resultClass="Map">
        SELECT
            1
        FROM
            VND
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND LOC_NM       = #locNm#
        AND EZCANCELFLAG = '0'    
    </statement>

    <statement id="checkPrntVnd" parameterClass="Map" resultClass="Map">
        SELECT
            1
        FROM
            PRNT_VND
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND PRNT_VND_CD  = #prntVndCd#
        AND EZCANCELFLAG = '0'
    </statement>

    <statement id="searchRecordByBatchPk" parameterClass="Map" resultClass="Map">
        SELECT
            <!-- Batch Header Info -->
            CMIB.EZUPTIME                   CMIB_EZUPTIME
        ,   CMIB.EZUPTIMEZONE               CMIB_EZUPTIMEZONE
        ,   CMIB.CM_MAINT_INV_BAT_PK
        ,   CMIB.AP_BAT_NUM
        ,   CMIB.AP_BAT_DT
        ,   NVL(CMIB.AP_CTRL_AMT,0)         AP_CTRL_AMT
        ,   NVL(CMIB.AP_CTRL_CNT,0)         AP_CTRL_CNT
        ,   NVL(CMIB.AP_RUN_TOT_AMT,0)      AP_RUN_TOT_AMT
        ,   NVL(CMIB.AP_RUN_TOT_CNT,0)      AP_RUN_TOT_CNT
         <!-- START 2017/03/16 E.Kameishi [QC#14205,ADD] -->
        ,   CMIB.EZINTIME                   AS  XX_REC_HIST_CRAT_TS_BA
        ,   CMIB.EZINUSERID                 AS  XX_REC_HIST_CRAT_BY_NM_BA
        ,   CMIB.EZUPTIME                   AS  XX_REC_HIST_UPD_TS_BA
        ,   CMIB.EZUPUSERID                 AS  XX_REC_HIST_UPD_BY_NM_BA
        ,   CMIB.EZTABLEID                  AS  XX_REC_HIST_TBL_NM_BA
         <!-- END 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            <!-- Invoice Header Info -->
        ,   CMI.EZUPTIME                    CMI_EZUPTIME
        ,   CMI.EZUPTIMEZONE                CMI_EZUPTIMEZONE
        ,   CMI.AP_DS_WF_STS_CD
        ,   ADWS.AP_DS_WF_STS_NM
        ,   CMI.AP_MAINT_INV_STS_CD
        ,   AMIS.AP_MAINT_INV_STS_NM
        ,   CMI.AP_INV_NUM
        ,   CMI.INV_DT
        ,   VCC.VAR_CHAR_CONST_VAL          APVR_USR_NM
        ,   DV.PRNT_VND_CD
        ,   DV.PRNT_VND_NM
        ,   CMI.AP_VND_CD
        ,   CMI.VND_SITE_NM
        ,   NVL(CMI.AP_INV_AMT,0)           AP_INV_AMT
        ,   NVL(CMI.AP_MISC_AMT,0)          AP_MISC_AMT
        ,   NVL(CMI.AP_TAX_AMT,0)           AP_TAX_AMT
        ,   NVL(CMI.LATE_FEE_AMT,0)         LATE_FEE_AMT
         <!-- START 2017/03/16 E.Kameishi [QC#14205,ADD] -->
        ,   CMI.EZINTIME                   AS  XX_REC_HIST_CRAT_TS
        ,   CMI.EZINUSERID                 AS  XX_REC_HIST_CRAT_BY_NM
        ,   CMI.EZUPTIME                   AS  XX_REC_HIST_UPD_TS
        ,   CMI.EZUPUSERID                 AS  XX_REC_HIST_UPD_BY_NM
        ,   CMI.EZTABLEID                  AS  XX_REC_HIST_TBL_NM
         <!-- END 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            <!-- Invoice Line Info -->
        ,   CMIS.EZUPTIME                   CMIS_EZUPTIME
        ,   CMIS.EZUPTIMEZONE               CMIS_EZUPTIMEZONE
        ,   CMIS.SER_NUM
        ,   CMIS.OVRD_SER_NUM
        ,   CMIS.START_DT
        ,   CMIS.END_DT
        ,   NVL(CMIS.BASE_AMT,0)            BASE_AMT
        ,   CMIM.EZUPTIME                   CMIM_EZUPTIME
        ,   CMIM.EZUPTIMEZONE               CMIM_EZUPTIMEZONE
        ,   CMIM.CNT_TP_CD                  CNTR_TP_CD
        ,   CMIM.START_READ_MTR_CNT
        ,   CMIM.END_READ_MTR_CNT
        ,   CMIM.READ_MTR_CNT
        ,   CMIM.AP_TOL_AMT
         <!-- START 2017/03/16 E.Kameishi [QC#14205,ADD] -->
        ,   CMIS.EZINTIME                   AS  XX_REC_HIST_CRAT_TS_A1
        ,   CMIS.EZINUSERID                 AS  XX_REC_HIST_CRAT_BY_NM_A1
        ,   CMIS.EZUPTIME                   AS  XX_REC_HIST_UPD_TS_A1
        ,   CMIS.EZUPUSERID                 AS  XX_REC_HIST_UPD_BY_NM_A1
        ,   CMIS.EZTABLEID                  AS  XX_REC_HIST_TBL_NM_A1
         <!-- END 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            <!-- Comment Info -->
        ,   CMI.INV_CMNT_TXT
        ,   NVL(CMI.AP_ADJ_AMT,0)           AP_ADJ_AMT
        ,   CMI.AP_ADJ_RSN_CD
        FROM
            CM_MAINT_INV_BAT CMIB
        ,   CM_MAINT_INV     CMI
        ,   CM_MAINT_INV_SER CMIS
        ,   CM_MAINT_INV_MTR CMIM
        ,   AP_DS_WF_STS     ADWS
        ,   AP_MAINT_INV_STS AMIS
        ,   VAR_CHAR_CONST   VCC
        ,   (
                SELECT
                    V.GLBL_CMPY_CD
                ,   V.INV_VND_CD
                ,   V.LOC_NM
                ,   MAX(PV.PRNT_VND_CD)           PRNT_VND_CD
                ,   MAX(PV.PRNT_VND_NM)           PRNT_VND_NM
                FROM
                    PRNT_VND PV
                ,   VND      V
                WHERE
                    PV.GLBL_CMPY_CD   = #glblCmpyCd#
                AND PV.GLBL_CMPY_CD   = V.GLBL_CMPY_CD
                AND PV.PRNT_VND_PK    = V.PRNT_VND_PK
                AND PV.EZCANCELFLAG   = '0'
                AND V.EZCANCELFLAG    = '0'
                GROUP BY
                    V.GLBL_CMPY_CD
                ,   V.INV_VND_CD
                ,   V.LOC_NM
            )                DV
        WHERE
            CMIB.GLBL_CMPY_CD        = #glblCmpyCd#
        AND CMIB.GLBL_CMPY_CD        = CMI.GLBL_CMPY_CD
        AND CMIB.GLBL_CMPY_CD        = CMIS.GLBL_CMPY_CD
        AND CMI.GLBL_CMPY_CD         = CMIS.GLBL_CMPY_CD
        AND CMIB.CM_MAINT_INV_BAT_PK = $cmMaintInvBatPk$
        AND CMIB.AP_BAT_NUM          = CMI.AP_BAT_NUM
        AND CMI.AP_INV_NUM           = CMIS.AP_INV_NUM
        AND CMI.AP_VND_CD            = CMIS.AP_VND_CD
        AND CMIB.EZCANCELFLAG        = '0'
        AND CMI.EZCANCELFLAG         = '0'
        AND CMIS.EZCANCELFLAG        = '0'
        AND CMIS.GLBL_CMPY_CD        = CMIM.GLBL_CMPY_CD(+)
        AND CMIS.AP_INV_NUM          = CMIM.AP_INV_NUM(+)
        AND CMIS.AP_VND_CD           = CMIM.AP_VND_CD(+)
        AND CMIS.SER_NUM             = CMIM.SER_NUM(+)
        AND CMIS.START_DT            = CMIM.START_DT(+)
        AND '0'                      = CMIM.EZCANCELFLAG(+)
        AND CMI.GLBL_CMPY_CD         = ADWS.GLBL_CMPY_CD(+)
        AND CMI.AP_DS_WF_STS_CD      = ADWS.AP_DS_WF_STS_CD(+)
        AND '0'                      = ADWS.EZCANCELFLAG(+)
        AND CMI.GLBL_CMPY_CD         = AMIS.GLBL_CMPY_CD(+)
        AND CMI.AP_MAINT_INV_STS_CD  = AMIS.AP_MAINT_INV_STS_CD(+)
        AND '0'                      = AMIS.EZCANCELFLAG(+)
        AND CMI.AP_VND_CD            = DV.INV_VND_CD(+)
        AND CMI.VND_SITE_NM          = DV.LOC_NM(+)
        AND CMI.GLBL_CMPY_CD         = VCC.GLBL_CMPY_CD(+)
        AND CMI.APVR_USR_ID          = VCC.VAR_CHAR_CONST_NM(+)
        AND VCC.EZCANCELFLAG(+)      = '0'
        <!-- TODO row number -->
        ORDER BY
            CMI.AP_INV_NUM
        ,   CMI.AP_VND_CD
        ,   CMIM.CM_MAINT_INV_SER_LINE_NUM
        ,   CMIM.CM_MAINT_INV_MTR_LINE_NUM
    </statement>

    <statement id="getTotalRecordCount" parameterClass="Map" resultClass="Map">
        SELECT
            COUNT(*) * $recCntForOneSerNum$ TOT_REC_CNT
        FROM
            (
                SELECT
                    CMI.AP_INV_NUM
                ,   CMI.AP_VND_CD
                ,   CMIS.SER_NUM
                ,   CMIS.START_DT
                ,   CMIM.CNT_TP_CD
                FROM
                    CM_MAINT_INV_BAT CMIB
                ,   CM_MAINT_INV     CMI
                ,   CM_MAINT_INV_SER CMIS
                ,   CM_MAINT_INV_MTR CMIM
                ,   AP_DS_WF_STS     ADWS
                ,   AP_MAINT_INV_STS AMIS
                ,  (
                        SELECT
                            V.GLBL_CMPY_CD
                        ,   V.INV_VND_CD
                        ,   V.LOC_NM
                        ,   MAX(PV.PRNT_VND_CD)           PRNT_VND_CD
                        ,   MAX(PV.PRNT_VND_NM)           PRNT_VND_NM
                        FROM
                            PRNT_VND PV
                        ,   VND      V
                        WHERE
                            PV.GLBL_CMPY_CD   = #glblCmpyCd#
                        AND PV.GLBL_CMPY_CD   = V.GLBL_CMPY_CD
                        AND PV.PRNT_VND_PK    = V.PRNT_VND_PK
                        AND PV.EZCANCELFLAG   = '0'
                        AND V.EZCANCELFLAG    = '0'
                        GROUP BY
                            V.GLBL_CMPY_CD
                        ,   V.INV_VND_CD
                        ,   V.LOC_NM
                   )        DV
                WHERE
                    CMIB.GLBL_CMPY_CD        = #glblCmpyCd#
                AND CMIB.GLBL_CMPY_CD        = CMI.GLBL_CMPY_CD
                AND CMIB.GLBL_CMPY_CD        = CMIS.GLBL_CMPY_CD
                AND CMI.GLBL_CMPY_CD         = CMIS.GLBL_CMPY_CD
                AND CMIB.CM_MAINT_INV_BAT_PK = $cmMaintInvBatPk$
                AND CMIB.AP_BAT_NUM          = CMI.AP_BAT_NUM
                AND CMI.AP_INV_NUM           = CMIS.AP_INV_NUM
                AND CMI.AP_VND_CD            = CMIS.AP_VND_CD
                AND CMIB.EZCANCELFLAG        = '0'
                AND CMI.EZCANCELFLAG         = '0'
                AND CMIS.EZCANCELFLAG        = '0'
                AND CMIS.GLBL_CMPY_CD        = CMIM.GLBL_CMPY_CD(+)
                AND CMIS.AP_INV_NUM          = CMIM.AP_INV_NUM(+)
                AND CMIS.AP_VND_CD           = CMIM.AP_VND_CD(+)
                AND CMIS.SER_NUM             = CMIM.SER_NUM(+)
                AND CMIS.START_DT            = CMIM.START_DT(+)
                AND '0'                      = CMIM.EZCANCELFLAG(+)
                AND CMI.GLBL_CMPY_CD         = ADWS.GLBL_CMPY_CD(+)
                AND CMI.AP_DS_WF_STS_CD      = ADWS.AP_DS_WF_STS_CD(+)
                AND '0'                      = ADWS.EZCANCELFLAG(+)
                AND CMI.GLBL_CMPY_CD         = AMIS.GLBL_CMPY_CD(+)
                AND CMI.AP_MAINT_INV_STS_CD  = AMIS.AP_MAINT_INV_STS_CD(+)
                AND '0'                      = AMIS.EZCANCELFLAG(+)
                AND CMI.AP_VND_CD            = DV.INV_VND_CD(+)
                AND CMI.VND_SITE_NM          = DV.LOC_NM(+)
                GROUP BY
                    CMI.AP_INV_NUM
                ,   CMI.AP_VND_CD
                ,   CMIS.SER_NUM
                ,   CMIS.START_DT
                ,   CMIM.CNT_TP_CD
            )
    </statement>

    <statement id="searchRecordByInvInfo" parameterClass="Map" resultClass="Map">
        SELECT
            <!-- Batch Header Info -->
            CMIB.EZUPTIME                   CMIB_EZUPTIME
        ,   CMIB.EZUPTIMEZONE               CMIB_EZUPTIMEZONE
        ,   CMIB.CM_MAINT_INV_BAT_PK
        ,   CMIB.AP_BAT_NUM
        ,   CMIB.AP_BAT_DT
        ,   NVL(CMIB.AP_CTRL_AMT,0)         AP_CTRL_AMT
        ,   NVL(CMIB.AP_CTRL_CNT,0)         AP_CTRL_CNT
        ,   NVL(CMIB.AP_RUN_TOT_AMT,0)      AP_RUN_TOT_AMT
        ,   NVL(CMIB.AP_RUN_TOT_CNT,0)      AP_RUN_TOT_CNT
         <!-- START 2017/03/16 E.Kameishi [QC#14205,ADD] -->
        ,   CMIB.EZINTIME                   AS  XX_REC_HIST_CRAT_TS_BA
        ,   CMIB.EZINUSERID                 AS  XX_REC_HIST_CRAT_BY_NM_BA
        ,   CMIB.EZUPTIME                   AS  XX_REC_HIST_UPD_TS_BA
        ,   CMIB.EZUPUSERID                 AS  XX_REC_HIST_UPD_BY_NM_BA
        ,   CMIB.EZTABLEID                  AS  XX_REC_HIST_TBL_NM_BA
         <!-- END 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            <!-- Invoice Header Info -->
        ,   CMI.EZUPTIME                    CMI_EZUPTIME
        ,   CMI.EZUPTIMEZONE                CMI_EZUPTIMEZONE
        ,   CMI.AP_DS_WF_STS_CD
        ,   ADWS.AP_DS_WF_STS_NM
        ,   CMI.AP_MAINT_INV_STS_CD
        ,   AMIS.AP_MAINT_INV_STS_NM
        ,   CMI.AP_INV_NUM
        ,   CMI.INV_DT
        ,   VCC.VAR_CHAR_CONST_VAL          APVR_USR_NM
        ,   DV.PRNT_VND_CD
        ,   DV.PRNT_VND_NM
        ,   CMI.AP_VND_CD
        ,   CMI.VND_SITE_NM
        ,   NVL(CMI.AP_INV_AMT,0)           AP_INV_AMT
        ,   NVL(CMI.AP_MISC_AMT,0)          AP_MISC_AMT
        ,   NVL(CMI.AP_TAX_AMT,0)           AP_TAX_AMT
        ,   NVL(CMI.LATE_FEE_AMT,0)         LATE_FEE_AMT
         <!-- START 2017/03/16 E.Kameishi [QC#14205,ADD] -->
        ,   CMI.EZINTIME                   AS  XX_REC_HIST_CRAT_TS
        ,   CMI.EZINUSERID                 AS  XX_REC_HIST_CRAT_BY_NM
        ,   CMI.EZUPTIME                   AS  XX_REC_HIST_UPD_TS
        ,   CMI.EZUPUSERID                 AS  XX_REC_HIST_UPD_BY_NM
        ,   CMI.EZTABLEID                  AS  XX_REC_HIST_TBL_NM
         <!-- END 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            <!-- Invoice Line Info -->
        ,   CMIS.EZUPTIME                   CMIS_EZUPTIME
        ,   CMIS.EZUPTIMEZONE               CMIS_EZUPTIMEZONE
        ,   CMIS.SER_NUM
        ,   CMIS.OVRD_SER_NUM
        ,   CMIS.START_DT
        ,   CMIS.END_DT
        ,   NVL(CMIS.BASE_AMT,0)            BASE_AMT
        ,   CMIM.EZUPTIME                   CMIM_EZUPTIME
        ,   CMIM.EZUPTIMEZONE               CMIM_EZUPTIMEZONE
        ,   CMIM.CNT_TP_CD                  CNTR_TP_CD
        ,   CMIM.START_READ_MTR_CNT
        ,   CMIM.END_READ_MTR_CNT
        ,   CMIM.READ_MTR_CNT
        ,   CMIM.AP_TOL_AMT
         <!-- START 2017/03/16 E.Kameishi [QC#14205,ADD] -->
        ,   CMIS.EZINTIME                   AS  XX_REC_HIST_CRAT_TS_A1
        ,   CMIS.EZINUSERID                 AS  XX_REC_HIST_CRAT_BY_NM_A1
        ,   CMIS.EZUPTIME                   AS  XX_REC_HIST_UPD_TS_A1
        ,   CMIS.EZUPUSERID                 AS  XX_REC_HIST_UPD_BY_NM_A1
        ,   CMIS.EZTABLEID                  AS  XX_REC_HIST_TBL_NM_A1
         <!-- END 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            <!-- Comment Info -->
        ,   CMI.INV_CMNT_TXT
        ,   NVL(CMI.AP_ADJ_AMT,0)           AP_ADJ_AMT
        ,   CMI.AP_ADJ_RSN_CD
        FROM
            CM_MAINT_INV_BAT CMIB
        ,   CM_MAINT_INV     CMI
        ,   CM_MAINT_INV_SER CMIS
        ,   CM_MAINT_INV_MTR CMIM
        ,   AP_DS_WF_STS     ADWS
        ,   AP_MAINT_INV_STS AMIS
        ,   VAR_CHAR_CONST   VCC
        ,   (
                SELECT
                    V.GLBL_CMPY_CD
                ,   V.INV_VND_CD
                ,   V.LOC_NM
                ,   MAX(PV.PRNT_VND_CD)           PRNT_VND_CD
                ,   MAX(PV.PRNT_VND_NM)           PRNT_VND_NM
                FROM
                    PRNT_VND PV
                ,   VND      V
                WHERE
                    PV.GLBL_CMPY_CD   = #glblCmpyCd#
                AND PV.GLBL_CMPY_CD   = V.GLBL_CMPY_CD
                AND PV.PRNT_VND_PK    = V.PRNT_VND_PK
                AND PV.EZCANCELFLAG   = '0'
                AND V.EZCANCELFLAG    = '0'
                GROUP BY
                    V.GLBL_CMPY_CD
                ,   V.INV_VND_CD
                ,   V.LOC_NM
            )                DV
        WHERE
            CMIB.GLBL_CMPY_CD        = #glblCmpyCd#
        AND CMIB.GLBL_CMPY_CD        = CMI.GLBL_CMPY_CD
        AND CMIB.GLBL_CMPY_CD        = CMIS.GLBL_CMPY_CD
        AND CMI.GLBL_CMPY_CD         = CMIS.GLBL_CMPY_CD
        AND CMIB.AP_BAT_NUM          = CMI.AP_BAT_NUM
        AND CMI.AP_INV_NUM           = #apInvNum#
        AND CMI.AP_INV_NUM           = CMIS.AP_INV_NUM
        AND CMI.AP_VND_CD            = #apVndCd#
        AND CMI.AP_VND_CD            = CMIS.AP_VND_CD
        AND CMIB.EZCANCELFLAG        = '0'
        AND CMI.EZCANCELFLAG         = '0'
        AND CMIS.EZCANCELFLAG        = '0'
        AND CMIS.GLBL_CMPY_CD        = CMIM.GLBL_CMPY_CD(+)
        AND CMIS.AP_INV_NUM          = CMIM.AP_INV_NUM(+)
        AND CMIS.AP_VND_CD           = CMIM.AP_VND_CD(+)
        AND CMIS.SER_NUM             = CMIM.SER_NUM(+)
        AND CMIS.START_DT            = CMIM.START_DT(+)
        AND '0'                      = CMIM.EZCANCELFLAG(+)
        AND CMI.GLBL_CMPY_CD         = ADWS.GLBL_CMPY_CD(+)
        AND CMI.AP_DS_WF_STS_CD      = ADWS.AP_DS_WF_STS_CD(+)
        AND '0'                      = ADWS.EZCANCELFLAG(+)
        AND CMI.GLBL_CMPY_CD         = AMIS.GLBL_CMPY_CD(+)
        AND CMI.AP_MAINT_INV_STS_CD  = AMIS.AP_MAINT_INV_STS_CD(+)
        AND '0'                      = AMIS.EZCANCELFLAG(+)
        AND CMI.AP_VND_CD            = DV.INV_VND_CD(+)
        AND CMI.VND_SITE_NM          = DV.LOC_NM(+)
        AND CMI.GLBL_CMPY_CD         = VCC.GLBL_CMPY_CD(+)
        AND CMI.APVR_USR_ID          = VCC.VAR_CHAR_CONST_NM(+)
        AND VCC.EZCANCELFLAG(+)      = '0'
        <!-- row number -->
        ORDER BY
            CMI.AP_INV_NUM
        ,   CMI.AP_VND_CD
        ,   CMIM.CM_MAINT_INV_SER_LINE_NUM
        ,   CMIM.CM_MAINT_INV_MTR_LINE_NUM
    </statement>

    <statement id="getInvLineTotalRecordCount" parameterClass="Map" resultClass="Map">
        SELECT
            COUNT(*) * $recCntForOneSerNum$ TOT_REC_CNT
        FROM
            (
                SELECT
                    CMI.AP_INV_NUM
                ,   CMI.AP_VND_CD
                ,   CMIS.SER_NUM
                ,   CMIS.START_DT
                ,   CMIM.CNT_TP_CD
                FROM
                    CM_MAINT_INV_BAT CMIB
                ,   CM_MAINT_INV     CMI
                ,   CM_MAINT_INV_SER CMIS
                ,   CM_MAINT_INV_MTR CMIM
                ,   AP_DS_WF_STS     ADWS
                ,   AP_MAINT_INV_STS AMIS
                ,   (
                        SELECT
                            V.GLBL_CMPY_CD
                        ,   V.INV_VND_CD
                        ,   V.LOC_NM
                        ,   MAX(PV.PRNT_VND_CD)           PRNT_VND_CD
                        ,   MAX(PV.PRNT_VND_NM)           PRNT_VND_NM
                        FROM
                            PRNT_VND PV
                        ,   VND      V
                        WHERE
                            PV.GLBL_CMPY_CD   = #glblCmpyCd#
                        AND PV.GLBL_CMPY_CD   = V.GLBL_CMPY_CD
                        AND PV.PRNT_VND_PK    = V.PRNT_VND_PK
                        AND PV.EZCANCELFLAG   = '0'
                        AND V.EZCANCELFLAG    = '0'
                        GROUP BY
                            V.GLBL_CMPY_CD
                        ,   V.INV_VND_CD
                        ,   V.LOC_NM
                   )                DV
                WHERE
                    CMIB.GLBL_CMPY_CD        = #glblCmpyCd#
                AND CMIB.GLBL_CMPY_CD        = CMI.GLBL_CMPY_CD
                AND CMIB.GLBL_CMPY_CD        = CMIS.GLBL_CMPY_CD
                AND CMI.GLBL_CMPY_CD         = CMIS.GLBL_CMPY_CD
                AND CMIB.AP_BAT_NUM          = CMI.AP_BAT_NUM
                AND CMI.AP_INV_NUM           = #apInvNum#
                AND CMI.AP_INV_NUM           = CMIS.AP_INV_NUM
                AND CMI.AP_VND_CD            = #apVndCd#
                AND CMI.AP_VND_CD            = CMIS.AP_VND_CD
                AND CMIB.EZCANCELFLAG        = '0'
                AND CMI.EZCANCELFLAG         = '0'
                AND CMIS.EZCANCELFLAG        = '0'
                AND CMIS.GLBL_CMPY_CD        = CMIM.GLBL_CMPY_CD(+)
                AND CMIS.AP_INV_NUM          = CMIM.AP_INV_NUM(+)
                AND CMIS.AP_VND_CD           = CMIM.AP_VND_CD(+)
                AND CMIS.SER_NUM             = CMIM.SER_NUM(+)
                AND CMIS.START_DT            = CMIM.START_DT(+)
                AND '0'                      = CMIM.EZCANCELFLAG(+)
                AND CMI.GLBL_CMPY_CD         = ADWS.GLBL_CMPY_CD(+)
                AND CMI.AP_DS_WF_STS_CD      = ADWS.AP_DS_WF_STS_CD(+)
                AND '0'                      = ADWS.EZCANCELFLAG(+)
                AND CMI.GLBL_CMPY_CD         = AMIS.GLBL_CMPY_CD(+)
                AND CMI.AP_MAINT_INV_STS_CD  = AMIS.AP_MAINT_INV_STS_CD(+)
                AND '0'                      = AMIS.EZCANCELFLAG(+)
                AND CMI.AP_VND_CD            = DV.INV_VND_CD(+)
                AND CMI.VND_SITE_NM          = DV.LOC_NM(+)
                <!-- row number -->
                GROUP BY
                    CMI.AP_INV_NUM
                ,   CMI.AP_VND_CD
                ,   CMIS.SER_NUM
                ,   CMIS.START_DT
                ,   CMIM.CNT_TP_CD
            )
    </statement>

    <statement id="getPrntVndNm" parameterClass="Map" resultClass="Map">
        SELECT
            MAX(PRNT_VND_NM) PRNT_VND_NM
        FROM
            PRNT_VND
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND PRNT_VND_CD  = #prntVndCd#
        AND EZCANCELFLAG = '0'
        GROUP BY
            PRNT_VND_CD
    </statement>

    <statement id="getApAdjRsnPulldownValue"  parameterClass="Map" resultClass="Map">
        SELECT
            AAR.AP_ADJ_RSN_CD
        ,   AAR.AP_ADJ_RSN_NM
        FROM
            AP_ADJ_RSN AAR
        WHERE
            AAR.GLBL_CMPY_CD      = #glblCmpyCd#
        AND AAR.EZCANCELFLAG      = '0'
        ORDER BY
            AAR.AP_ADJ_RSN_SORT_NUM ASC
    </statement>

    <statement id="getCcyCd" parameterClass="Map" resultClass="Map">
        SELECT
            STD_CCY_CD
        FROM
            GLBL_CMPY
        WHERE
            GLBL_CMPY_CD     = #glblCmpyCd#
        AND EZCANCELFLAG     = '0'
    </statement>
    <statement id="countSerNum" parameterClass="Map" resultClass="Integer">
        
        SELECT
            COUNT(1)
        FROM 
            DS_SUB_CONTR DSC
           ,DS_CONTR_DTL DCD
           ,SVC_MACH_MSTR SMM
           ,VND V
        WHERE 
            DSC.GLBL_CMPY_CD     = #glblCmpyCd#
        AND (DSC.EFF_THRU_DT &gt;= #batchDt# OR DSC.EFF_THRU_DT IS NULL )
        AND DSC.EZCANCELFLAG     = '0'
        
        AND DSC.GLBL_CMPY_CD     = DCD.GLBL_CMPY_CD
        AND DSC.DS_CONTR_DTL_PK  = DCD.DS_CONTR_DTL_PK
        AND DCD.EZCANCELFLAG     = '0'
        
        AND DCD.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
        AND DCD.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
        AND SMM.SER_NUM          = #serNum#
        AND SMM.EZCANCELFLAG     = '0'
        
        AND DSC.GLBL_CMPY_CD    = V.GLBL_CMPY_CD
        AND DSC.VND_CD          = V.VND_CD
        AND V.LOC_NM            = #locNm#
        AND V.EZCANCELFLAG      = '0'
    </statement>
    <statement id="getApVndCd" parameterClass="Map" resultClass="String">
        
        SELECT
            V.INV_VND_CD     AS INV_VND_CD
        FROM          
            VND  V
           ,PRNT_VND  PV
        WHERE       
            V.GLBL_CMPY_CD  = #glblCmpyCd#  
        AND V.LOC_NM        = #locNm#
        AND V.EZCANCELFLAG  = '0'
        AND V.GLBL_CMPY_CD  = PV.GLBL_CMPY_CD  
        AND V.PRNT_VND_PK   = PV.PRNT_VND_PK
        AND PV.PRNT_VND_CD  = #prntVndCd#
        AND PV.EZCANCELFLAG = '0'
    </statement>

    <statement id="getAttDataForTherefore" parameterClass="Map" resultClass="Map">
        SELECT
            ATD.ATT_DATA_NM      AS DOC_MGT_DOC_ID
            ,DMC.DOC_MGT_CATG_CD AS DOC_MGT_CATG_CD
        FROM          
            ATT_DATA             ATD
            ,DOC_MGT_CATG        DMC
        WHERE       
            ATD.GLBL_CMPY_CD     = #glblCmpyCd#
        AND ATD.ATT_DATA_GRP_TXT = #attGrpTxt#
        AND ATD.EZCANCELFLAG     = '0'
        AND ATD.GLBL_CMPY_CD     = DMC.GLBL_CMPY_CD
        AND ATD.ATT_DOC_TP_CD    = DMC.ATT_DOC_TP_CD
        <iterate property="docMgtCatgList" var="docMgtCatg[]" open="        AND DMC.DOC_MGT_CATG_CD IN (" close=")" conjunction= ", " >
            #docMgtCatg[]#
        </iterate>
        AND DMC.EZCANCELFLAG     = '0'
        AND ROWNUM               = 1
    </statement>

    <statement id="chkInvRecordSts" parameterClass="Map" resultClass="String">
        SELECT
           AP_MAINT_INV_STS_CD
        FROM
            (
                SELECT
                    CMI.AP_MAINT_INV_STS_CD
                FROM
                    CM_MAINT_INV_BAT CMIB
                ,   CM_MAINT_INV     CMI
                ,   CM_MAINT_INV_SER CMIS
                WHERE
                    CMIB.GLBL_CMPY_CD        = #glblCmpyCd#
                AND CMIB.GLBL_CMPY_CD        = CMI.GLBL_CMPY_CD
                AND CMIB.GLBL_CMPY_CD        = CMIS.GLBL_CMPY_CD
                AND CMI.GLBL_CMPY_CD         = CMIS.GLBL_CMPY_CD
                AND CMIB.AP_BAT_NUM          = CMI.AP_BAT_NUM
                AND CMI.AP_INV_NUM           = #apInvNum#
                AND CMI.AP_INV_NUM           = CMIS.AP_INV_NUM
                AND CMI.AP_VND_CD            = #apVndCd#
                AND CMI.AP_VND_CD            = CMIS.AP_VND_CD
                AND CMIB.EZCANCELFLAG        = '0'
                AND CMI.EZCANCELFLAG         = '0'
                AND CMIS.EZCANCELFLAG        = '0'
            )
    </statement>
</sqlMap>