<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL1200Query">
    <typeAlias alias="NSAL1200_ASMsg"   type="business.blap.NSAL1200.NSAL1200_ASMsg"/>

    <statement id="getSearchData" parameterClass="Map" resultMap="result.getSearchData">
        SELECT
             NULL AS XX_CHK_BOX
            ,T.MDL_MTR_LB_CD
            ,T.MDL_MTR_LB_DESC_TXT
            ,T.MTR_ENTRY_MND_FLG
            ,T.MTR_MULT_RATE
            ,T.BLLG_MTR_MAP_PK_L1
            ,T.BLLG_MTR_LB_CD_L1
            ,T.BLLG_MTR_LB_DESC_TXT_L1
            ,T.BLLG_MTR_MAP_PK_L2
            ,T.BLLG_MTR_LB_CD_L2
            ,T.BLLG_MTR_LB_DESC_TXT_L2
            ,T.BLLG_MTR_MAP_PK_L3
            ,T.BLLG_MTR_LB_CD_L3
            ,T.BLLG_MTR_LB_DESC_TXT_L3
            ,T.CNTR_DIGIT_NUM
            <!-- START 2018/12/05 [QC#28644, ADD] -->
            ,T.TECH_READ_MND_FLG
            <!-- END 2018/12/05 [QC#28644, ADD] -->
            ,T.ACTV_FLG
            ,T.EFF_FROM_DT
            ,T.EFF_THRU_DT
            ,T.DS_MDL_MTR_PK
            ,T.MDL_EZUPTIME
            ,T.MDL_EZUPTIMEZONE
            <!-- START 2016/12/01 K.Kojima [QC#14204, ADD] -->
            ,T.XX_REC_HIST_CRAT_TS_A
            ,T.XX_REC_HIST_CRAT_BY_NM_A
            ,T.XX_REC_HIST_UPD_TS_A
            ,T.XX_REC_HIST_UPD_BY_NM_A
            ,T.XX_REC_HIST_TBL_NM_A
            <!-- END 2016/12/01 K.Kojima [QC#14204, ADD] -->
            ,T.MAP1_EZUPTIME
            ,T.MAP1_EZUPTIMEZONE
            ,T.MAP2_EZUPTIME
            ,T.MAP2_EZUPTIMEZONE
            ,T.MAP3_EZUPTIME
            ,T.MAP3_EZUPTIMEZONE
            ,NULL AS XX_VAL_UPD_FLG
            ,ROWNUM AS XX_ROW_NUM
            FROM (
                SELECT
                     MDL.MDL_MTR_LB_CD
                    ,MLM.MTR_LB_DESC_TXT    AS MDL_MTR_LB_DESC_TXT
                    ,MDL.MTR_ENTRY_MND_FLG
                    ,MDL.MTR_MULT_RATE
                    ,MAP1.BLLG_MTR_MAP_PK  AS BLLG_MTR_MAP_PK_L1
                    ,MAP1.BLLG_MTR_LB_CD   AS BLLG_MTR_LB_CD_L1
                    ,L1.MTR_LB_DESC_TXT    AS BLLG_MTR_LB_DESC_TXT_L1
                    ,MAP2.BLLG_MTR_MAP_PK  AS BLLG_MTR_MAP_PK_L2
                    ,MAP2.BLLG_MTR_LB_CD   AS BLLG_MTR_LB_CD_L2
                    ,L2.MTR_LB_DESC_TXT    AS BLLG_MTR_LB_DESC_TXT_L2
                    ,MAP3.BLLG_MTR_MAP_PK  AS BLLG_MTR_MAP_PK_L3
                    ,MAP3.BLLG_MTR_LB_CD   AS BLLG_MTR_LB_CD_L3
                    ,L3.MTR_LB_DESC_TXT    AS BLLG_MTR_LB_DESC_TXT_L3
                    ,MDL.CNTR_DIGIT_NUM
                    <!-- START 2018/12/05 [QC#28644, ADD] -->
                    ,MDL.TECH_READ_MND_FLG
                    <!-- END 2018/12/05 [QC#28644, ADD] -->
                    ,MDL.ACTV_FLG
                    ,MDL.EFF_FROM_DT
                    ,MDL.EFF_THRU_DT
                    ,MDL.DS_MDL_MTR_PK
                    ,MDL.EZUPTIME           AS MDL_EZUPTIME
                    ,MDL.EZUPTIMEZONE       AS MDL_EZUPTIMEZONE
                    <!-- START 2016/12/01 K.Kojima [QC#14204, ADD] -->
                    ,MDL.EZINTIME           AS XX_REC_HIST_CRAT_TS_A
                    ,MDL.EZINUSERID         AS XX_REC_HIST_CRAT_BY_NM_A
                    ,MDL.EZUPTIME           AS XX_REC_HIST_UPD_TS_A
                    ,MDL.EZUPUSERID         AS XX_REC_HIST_UPD_BY_NM_A
                    ,MDL.EZTABLEID          AS XX_REC_HIST_TBL_NM_A
                    <!-- END 2016/12/01 K.Kojima [QC#14204, ADD] -->
                    ,MAP1.EZUPTIME           AS MAP1_EZUPTIME
                    ,MAP1.EZUPTIMEZONE       AS MAP1_EZUPTIMEZONE
                    ,MAP2.EZUPTIME           AS MAP2_EZUPTIME
                    ,MAP2.EZUPTIMEZONE       AS MAP2_EZUPTIMEZONE
                    ,MAP3.EZUPTIME           AS MAP3_EZUPTIME
                    ,MAP3.EZUPTIMEZONE       AS MAP3_EZUPTIMEZONE
                FROM
                     MTR_GRP GRP
                    ,DS_MDL_MTR MDL
                    ,BLLG_MTR_MAP MAP1
                    ,BLLG_MTR_MAP MAP2
                    ,BLLG_MTR_MAP MAP3
                    ,MTR_LB MLM
                    ,MTR_LB L1
                    ,MTR_LB L2
                    ,MTR_LB L3
                WHERE
                    GRP.GLBL_CMPY_CD        = #glblCmpyCd#
                AND GRP.MTR_GRP_PK          = #mtrGrpPk_H#
                AND GRP.EZCANCELFLAG        = '0'
                AND GRP.GLBL_CMPY_CD        = MDL.GLBL_CMPY_CD
                AND GRP.MTR_GRP_PK          = MDL.MTR_GRP_PK
                AND MDL.EZCANCELFLAG        = '0'
                AND MDL.GLBL_CMPY_CD        = MAP1.GLBL_CMPY_CD(+)
                AND MDL.MTR_GRP_PK          = MAP1.MTR_GRP_PK(+)
                AND MDL.MDL_MTR_LB_CD       = MAP1.MDL_MTR_LB_CD(+)
                AND MAP1.BLLG_MTR_MAP_LVL_NUM(+) = #bllgMtrMapLvlNum_1#
                AND MAP1.EZCANCELFLAG(+)    = '0'
                AND MDL.GLBL_CMPY_CD        = MAP2.GLBL_CMPY_CD(+)
                AND MDL.MTR_GRP_PK          = MAP2.MTR_GRP_PK(+)
                AND MDL.MDL_MTR_LB_CD       = MAP2.MDL_MTR_LB_CD(+)
                AND MAP2.BLLG_MTR_MAP_LVL_NUM(+) = #bllgMtrMapLvlNum_2#
                AND MAP2.EZCANCELFLAG(+)    = '0'
                AND MDL.GLBL_CMPY_CD        = MAP3.GLBL_CMPY_CD(+)
                AND MDL.MTR_GRP_PK          = MAP3.MTR_GRP_PK(+)
                AND MDL.MDL_MTR_LB_CD       = MAP3.MDL_MTR_LB_CD(+)
                AND MAP3.BLLG_MTR_MAP_LVL_NUM(+) = #bllgMtrMapLvlNum_3#
                AND MAP3.EZCANCELFLAG(+)    = '0'
                AND MDL.GLBL_CMPY_CD        = MLM.GLBL_CMPY_CD(+)
                AND MDL.MDL_MTR_LB_CD       = MLM.MTR_LB_CD(+)
                AND MDL.EZCANCELFLAG        = MLM.EZCANCELFLAG(+)
                AND MAP1.GLBL_CMPY_CD       = L1.GLBL_CMPY_CD(+)
                AND MAP1.BLLG_MTR_LB_CD     = L1.MTR_LB_CD(+)
                AND L1.EZCANCELFLAG(+)      = '0'
                AND MAP2.GLBL_CMPY_CD       = L2.GLBL_CMPY_CD(+)
                AND MAP2.BLLG_MTR_LB_CD     = L2.MTR_LB_CD(+)
                AND L2.EZCANCELFLAG(+)      = '0'
                AND MAP3.GLBL_CMPY_CD       = L3.GLBL_CMPY_CD(+)
                AND MAP3.BLLG_MTR_LB_CD     = L3.MTR_LB_CD(+)
                AND L3.EZCANCELFLAG(+)      = '0'
                ORDER BY
                     MLM.MTR_LB_SORT_NUM ASC
            ) T 
            WHERE 
                ROWNUM &lt;= #limitNum#
    </statement>
    <resultMap id="result.getSearchData"        class="NSAL1200_ASMsg">
        <result property="xxRowNum_A"           column="XX_ROW_NUM"             javaType="EZDSBigDecimalItem"/>
        <result property="xxChkBox_A"           column="XX_CHK_BOX"             javaType="EZDSStringItem"/>
        <result property="mdlMtrLbCd_A"         column="MDL_MTR_LB_CD"          javaType="EZDSStringItem"/>
        <result property="mtrLbDescTxt_CN"      column="MDL_MTR_LB_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="mtrEntryMndFlg_A"     column="MTR_ENTRY_MND_FLG"      javaType="EZDSStringItem"/>
        <result property="mtrMultRate_A"        column="MTR_MULT_RATE"          javaType="EZDSBigDecimalItem"/>
        <result property="bllgMtrMapPk_L1"      column="BLLG_MTR_MAP_PK_L1"      javaType="EZDSBigDecimalItem"/>
        <result property="bllgMtrLbCd_L1"       column="BLLG_MTR_LB_CD_L1"       javaType="EZDSStringItem"/>
        <result property="mtrLbDescTxt_L1"      column="BLLG_MTR_LB_DESC_TXT_L1" javaType="EZDSStringItem"/>
        <result property="bllgMtrMapPk_L2"      column="BLLG_MTR_MAP_PK_L2"      javaType="EZDSBigDecimalItem"/>
        <result property="bllgMtrLbCd_L2"       column="BLLG_MTR_LB_CD_L2"       javaType="EZDSStringItem"/>
        <result property="mtrLbDescTxt_L2"      column="BLLG_MTR_LB_DESC_TXT_L2" javaType="EZDSStringItem"/>
        <result property="bllgMtrMapPk_L3"      column="BLLG_MTR_MAP_PK_L3"      javaType="EZDSBigDecimalItem"/>
        <result property="bllgMtrLbCd_L3"       column="BLLG_MTR_LB_CD_L3"       javaType="EZDSStringItem"/>
        <result property="mtrLbDescTxt_L3"      column="BLLG_MTR_LB_DESC_TXT_L3" javaType="EZDSStringItem"/>
        <result property="cntrDigitNum_A"       column="CNTR_DIGIT_NUM"          javaType="EZDSBigDecimalItem"/>
        <!-- START 2018/11/30 [QC#28644, ADD] -->
        <result property="techReadMndFlg_A"     column="TECH_READ_MND_FLG"       javaType="EZDSStringItem"/>
        <!-- END 2018/11/30 [QC#28644, ADD] -->
        <result property="actvFlg_A"            column="ACTV_FLG"               javaType="EZDSStringItem"/>
        <result property="effFromDt_A"          column="EFF_FROM_DT"            javaType="EZDSDateItem"/>
        <result property="effThruDt_A"          column="EFF_THRU_DT"            javaType="EZDSDateItem"/>
        <result property="dsMdlMtrPk_A"         column="DS_MDL_MTR_PK"          javaType="EZDSBigDecimalItem"/>
        <result property="xxValUpdFlg_A"        column="XX_VAL_UPD_FLG"         javaType="EZDSStringItem"/>
        <result property="ezUpTime_A"           column="MDL_EZUPTIME"           javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_A"       column="MDL_EZUPTIMEZONE"       javaType="EZDSStringItem"/>
        <!-- START 2016/12/01 K.Kojima [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_A"    column="XX_REC_HIST_CRAT_TS_A"    javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_A"  column="XX_REC_HIST_CRAT_BY_NM_A" javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_A"     column="XX_REC_HIST_UPD_TS_A"     javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_A"   column="XX_REC_HIST_UPD_BY_NM_A"  javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_A"     column="XX_REC_HIST_TBL_NM_A"     javaType="EZDSStringItem"/>
        <!-- END 2016/12/01 K.Kojima [QC#14204, ADD] -->
        <result property="ezUpTime_A1"          column="MAP1_EZUPTIME"          javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_A1"      column="MAP1_EZUPTIMEZONE"      javaType="EZDSStringItem"/>
        <result property="ezUpTime_A2"          column="MAP2_EZUPTIME"          javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_A2"      column="MAP2_EZUPTIMEZONE"      javaType="EZDSStringItem"/>
        <result property="ezUpTime_A3"          column="MAP3_EZUPTIME"          javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_A3"      column="MAP3_EZUPTIMEZONE"      javaType="EZDSStringItem"/>
   </resultMap>

    <statement id="getBllgMtrMap" parameterClass="Map" resultClass="Map">
        SELECT
             MLB.GLBL_CMPY_CD
            ,MLB.EZCANCELFLAG
            ,MLB.MTR_LB_CD
            ,MLB.MTR_LB_NM
            ,MLB.MTR_LB_SORT_NUM
            ,MLB.MTR_LB_DESC_TXT
        FROM     MTR_LB MLB
                WHERE MLB.GLBL_CMPY_CD      = #glblCmpyCd#
                <isNotNull property="bllgMtrLbCd">
                AND   MLB.MTR_LB_CD         = #bllgMtrLbCd#
                </isNotNull>
                <isNotNull property="mtrLbDescTxt">
                AND   MLB.MTR_LB_DESC_TXT   = #mtrLbDescTxt#
                </isNotNull>
                AND MLB.EFF_FROM_DT     &lt;= #slsDate#
                AND (MLB.EFF_THRU_DT    &gt;= #slsDate#
                          OR MLB.EFF_THRU_DT IS NULL)
                AND MLB.ACTV_FLG            = #actvFlg#
                AND   MLB.EZCANCELFLAG      = '0'
        ORDER BY
            MLB.MTR_LB_SORT_NUM ASC
    </statement>

    <statement id="getMtrLbMap" parameterClass="Map" resultClass="Map">
        SELECT 
             M.GLBL_CMPY_CD 
            ,M.EZCANCELFLAG 
            ,M.MTR_LB_CD 
            ,M.MTR_LB_NM 
            ,M.MTR_LB_DESC_TXT 
            ,M.MTR_LB_TP_CD 
            ,M.BLLG_MTR_LVL_NUM 
            ,M.MTR_LB_SORT_NUM 
        FROM 
            MTR_LB M 
        WHERE 
                M.GLBL_CMPY_CD              = #glblCmpyCd# 
            AND M.EFF_FROM_DT           &lt;= #slsDate#
            AND (M.EFF_THRU_DT          &gt;= #slsDate# 
                    OR M.EFF_THRU_DT IS NULL) 
            AND M.ACTV_FLG                  = #actvFlg#
            <isNotNull property="mtrLbCd">
            AND M.MTR_LB_CD                 = #mtrLbCd#
            </isNotNull>
            <isNotNull property="mtrLbDescTxt">
            AND M.MTR_LB_DESC_TXT           = #mtrLbDescTxt#
            </isNotNull>
            AND M.MTR_LB_TP_CD              = #mtrLbTpCd#
            AND M.MTR_IDX_CD                = #mtrIdxCd#
            AND M.EZCANCELFLAG              = '0' 
        ORDER BY
            M.MTR_LB_SORT_NUM ASC
    </statement>

    <statement id="getBllgMtrLbCdGreaterThanLv3" parameterClass="Map" resultClass="String">
        SELECT
            A.BLLG_MTR_LB_CD
        FROM
            BLLG_MTR_MAP A
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.MTR_GRP_PK           = #mtrGrpPk#
            AND A.MDL_MTR_LB_CD        = #mdlMtrLbCd#
            AND A.BLLG_MTR_MAP_LVL_NUM &gt; #bllgMtrMapLvlNum_3#
            AND A.ACTV_FLG             = 'Y'
            AND A.EFF_FROM_DT          &lt;= #slsDate#
            AND (A.EFF_THRU_DT         &gt;= #slsDate#
                OR A.EFF_THRU_DT IS NULL)
            AND A.EZCANCELFLAG         = '0'
    </statement>
</sqlMap>
