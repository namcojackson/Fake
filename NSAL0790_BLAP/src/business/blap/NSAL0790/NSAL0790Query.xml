<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAL0790Query">
    <typeAlias alias="NSAL0790CMsg"  type="business.blap.NSAL0790.NSAL0790CMsg"/>
    <typeAlias alias="NSAL0790_ASMsg"  type="business.blap.NSAL0790.NSAL0790_ASMsg"/>

    <statement id="getHeaderInfo" parameterClass="Map" resultMap="result.getHeaderInfo">
        SELECT
             DS_CONTR_PK
            ,DS_CONTR_NUM
            ,FLEET_CALC_PROC_CD
            ,FLEET_CALC_PROC_DESC_TXT
            ,VLD_MSG_TXT
        FROM
            (
                SELECT
                     A.DS_CONTR_PK              AS  DS_CONTR_PK
                    ,A.DS_CONTR_NUM             AS  DS_CONTR_NUM
                    ,A.FLEET_CALC_PROC_CD       AS  FLEET_CALC_PROC_CD
                    ,C.FLEET_CALC_PROC_DESC_TXT AS  FLEET_CALC_PROC_DESC_TXT
                    ,A.VLD_MSG_TXT              AS  VLD_MSG_TXT
                    ,CASE A.FLEET_CALC_PROC_CD
                        WHEN #fleetCalcProcIsInComplete#       THEN 1
                        WHEN #fleetCalcProcIsReBillInComplete# THEN 2
                        WHEN #fleetCalcProcIsReBillComplete#   THEN 3
                        WHEN #fleetCalcProcIsComplete#         THEN 4
                        ELSE                                        5
                     END                        AS SORT_NUM
                FROM
                     FLEET_READ_ROLL_UP         A
                    ,DS_CONTR                   B
                    ,FLEET_CALC_PROC            C
                WHERE
                        A.GLBL_CMPY_CD              = #glblCmpyCd#
                    <iterate property="fleetReadRollUpPkList" var="fleetReadRollUpPk[]" open="AND A.FLEET_READ_ROLL_UP_PK IN (" close=")" conjunction=",">
                        #fleetReadRollUpPk[]#
                    </iterate>
                    AND A.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
                    AND A.DS_CONTR_PK               = B.DS_CONTR_PK
                    AND B.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = C.GLBL_CMPY_CD(+)
                    AND A.FLEET_CALC_PROC_CD        = C.FLEET_CALC_PROC_CD(+)
                    AND C.EZCANCELFLAG(+)           = '0'
                ORDER BY
                     SORT_NUM
                    ,A.VLD_MSG_TXT
            )
        WHERE
            ROWNUM = 1
    </statement>
    <statement id="getDetailInfo" parameterClass="Map" resultMap="result.getDetailInfo">
            SELECT
                 SER_NUM
                ,MTR_LB_DESC_TXT
                ,CUR_READ_MTR_CNT
                ,TEST_COPY_QTY
                ,CUR_BLLG_PER_FROM_DT
                ,CUR_BLLG_PER_THRU_DT
                ,MTR_ENTRY_CPLT_FLG
                ,PRI_READ_MTR_CNT
                ,FLEET_CALC_PROC_DESC_TXT
                ,VLD_MSG_TXT
                ,SVC_MACH_MSTR_PK
                ,MTR_READ_DT
                ,FLEET_READ_ROLL_UP_PK
                ,DS_CONTR_BLLG_MTR_PK
                ,FLEET_CALC_PROC_CD
            FROM (
                SELECT
                     C.SER_NUM                  AS  SER_NUM
                    ,F.MTR_LB_DESC_TXT          AS  MTR_LB_DESC_TXT
                    ,C.CUR_READ_MTR_CNT         AS  CUR_READ_MTR_CNT
                    ,C.TEST_COPY_QTY            AS  TEST_COPY_QTY
                    ,C.CUR_BLLG_PER_FROM_DT     AS  CUR_BLLG_PER_FROM_DT
                    ,C.CUR_BLLG_PER_THRU_DT     AS  CUR_BLLG_PER_THRU_DT
                    ,D.MTR_ENTRY_CPLT_FLG       AS  MTR_ENTRY_CPLT_FLG
                    ,C.PRI_READ_MTR_CNT         AS  PRI_READ_MTR_CNT
                    ,E.FLEET_CALC_PROC_DESC_TXT AS  FLEET_CALC_PROC_DESC_TXT
                    ,C.VLD_MSG_TXT              AS  VLD_MSG_TXT
                    ,C.SVC_MACH_MSTR_PK         AS  SVC_MACH_MSTR_PK
                    ,A.MTR_READ_DT              AS  MTR_READ_DT
                    ,A.FLEET_READ_ROLL_UP_PK    AS  FLEET_READ_ROLL_UP_PK
                    ,A.DS_CONTR_BLLG_MTR_PK     AS  DS_CONTR_BLLG_MTR_PK
                    ,A.FLEET_CALC_PROC_CD       AS  FLEET_CALC_PROC_CD
                FROM
                     FLEET_READ_ROLL_UP         A
                    ,DS_CONTR                   B
                    ,FLEET_READ_ROLL_UP_DTL     C
                    ,DS_CONTR_BLLG_SCHD         D
                    ,FLEET_CALC_PROC            E
                    ,MTR_LB                     F
                WHERE
                        A.GLBL_CMPY_CD              = #glblCmpyCd#
                    <iterate property="fleetReadRollUpPkList" var="fleetReadRollUpPk[]" open="AND A.FLEET_READ_ROLL_UP_PK IN (" close=")" conjunction=",">
                        #fleetReadRollUpPk[]#
                    </iterate>
                    AND A.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
                    AND A.DS_CONTR_PK               = B.DS_CONTR_PK
                    AND B.EZCANCELFLAG              = '0'
                    AND A.GLBL_CMPY_CD              = C.GLBL_CMPY_CD
                    AND A.FLEET_READ_ROLL_UP_PK     = C.FLEET_READ_ROLL_UP_PK
                    AND C.EZCANCELFLAG              = '0'
                    AND C.GLBL_CMPY_CD              = D.GLBL_CMPY_CD
                    AND C.DS_CONTR_BLLG_SCHD_PK     = D.DS_CONTR_BLLG_SCHD_PK
                    AND D.EZCANCELFLAG              = '0'
                    AND C.GLBL_CMPY_CD              = E.GLBL_CMPY_CD(+)
                    AND C.FLEET_CALC_PROC_CD        = E.FLEET_CALC_PROC_CD(+)
                    AND E.EZCANCELFLAG(+)           = '0'
                    AND C.GLBL_CMPY_CD              = F.GLBL_CMPY_CD
                    AND C.MACH_MTR_LB_CD            = F.MTR_LB_CD
                    AND F.EZCANCELFLAG              = '0'
                ORDER BY
                     C.SER_NUM          ASC
                    ,C.SVC_MACH_MSTR_PK ASC
                    ,C.MACH_MTR_LB_CD   ASC
            )
            WHERE
                ROWNUM        &lt;= #rowNum#
    </statement>

    <statement id="getNewFleetReadRollUpPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            B.FLEET_READ_ROLL_UP_PK
        FROM
             FLEET_READ_ROLL_UP         A
            ,FLEET_READ_ROLL_UP         B
        WHERE
                A.GLBL_CMPY_CD               = #glblCmpyCd#
            AND A.FLEET_READ_ROLL_UP_PK      = #fleetReadRollUpPk#
            AND A.GLBL_CMPY_CD               = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK                = B.DS_CONTR_PK
            AND A.DS_CONTR_DTL_PK            = B.DS_CONTR_DTL_PK
            AND A.PRNT_DS_CONTR_BLLG_SCHD_PK = B.PRNT_DS_CONTR_BLLG_SCHD_PK
            AND B.FLEET_READ_ROLL_UP_PK      &lt;&gt; #fleetReadRollUpPk#
            AND B.EZCANCELFLAG = '0'
    </statement>

    <statement id="getNotEntryCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(D.DS_CONTR_BLLG_SCHD_PK) AS NOT_ENTRY_CNT
        FROM
             FLEET_READ_ROLL_UP         A
            ,DS_CONTR                   B
            ,FLEET_READ_ROLL_UP_DTL     C
            ,DS_CONTR_BLLG_SCHD         D
        WHERE
                A.GLBL_CMPY_CD              = #glblCmpyCd#
            <iterate property="fleetReadRollUpPkList" var="fleetReadRollUpPk[]" open="AND A.FLEET_READ_ROLL_UP_PK IN (" close=")" conjunction=",">
                #fleetReadRollUpPk[]#
            </iterate>
            AND A.EZCANCELFLAG              = '0'
            AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK               = B.DS_CONTR_PK
            AND B.EZCANCELFLAG              = '0'
            AND A.GLBL_CMPY_CD              = C.GLBL_CMPY_CD
            AND A.FLEET_READ_ROLL_UP_PK     = C.FLEET_READ_ROLL_UP_PK
            AND C.EZCANCELFLAG              = '0'
            AND C.GLBL_CMPY_CD              = D.GLBL_CMPY_CD
            AND C.DS_CONTR_BLLG_SCHD_PK     = D.DS_CONTR_BLLG_SCHD_PK
            AND D.MTR_ENTRY_CPLT_FLG        = 'N'
            AND D.EZCANCELFLAG              = '0'
    </statement>

    <resultMap id="result.getHeaderInfo"          class="NSAL0790CMsg">
        <result property="dsContrPk_H"            column="DS_CONTR_PK"              javaType="EZDSBigDecimalItem" />
        <result property="dsContrNum_H"           column="DS_CONTR_NUM"             javaType="EZDSStringItem" />
        <result property="fleetCalcProcCd_H"      column="FLEET_CALC_PROC_CD"       javaType="EZDSStringItem" />
        <result property="fleetCalcProcDescTxt_H" column="FLEET_CALC_PROC_DESC_TXT" javaType="EZDSStringItem" />
        <result property="vldMsgTxt_H"            column="VLD_MSG_TXT"              javaType="EZDSStringItem" />
    </resultMap>
    <resultMap id="result.getDetailInfo"          class="NSAL0790_ASMsg">
        <result property="serNum_A"               column="SER_NUM"                  javaType="EZDSStringItem" />
        <result property="mtrLbDescTxt_A"         column="MTR_LB_DESC_TXT"          javaType="EZDSStringItem" />
        <result property="curReadMtrCnt_A"        column="CUR_READ_MTR_CNT"         javaType="EZDSBigDecimalItem" />
        <result property="testCopyQty_A"          column="TEST_COPY_QTY"            javaType="EZDSBigDecimalItem" />
        <result property="curBllgPerFromDt_A"     column="CUR_BLLG_PER_FROM_DT"     javaType="EZDSDateItem" />
        <result property="curBllgPerThruDt_A"     column="CUR_BLLG_PER_THRU_DT"     javaType="EZDSDateItem" />
        <result property="mtrEntryCpltFlg_A"      column="MTR_ENTRY_CPLT_FLG"       javaType="EZDSStringItem" />
        <result property="priReadMtrCnt_A"        column="PRI_READ_MTR_CNT"         javaType="EZDSBigDecimalItem" />
        <result property="fleetCalcProcDescTxt_A" column="FLEET_CALC_PROC_DESC_TXT" javaType="EZDSStringItem" />
        <result property="vldMsgTxt_A"            column="VLD_MSG_TXT"              javaType="EZDSStringItem" />
        <result property="svcMachMstrPk_A"        column="SVC_MACH_MSTR_PK"         javaType="EZDSBigDecimalItem" />
        <result property="mtrReadDt_A"            column="MTR_READ_DT"              javaType="EZDSDateItem" />
        <result property="fleetReadRollUpPk_A"    column="FLEET_READ_ROLL_UP_PK"    javaType="EZDSBigDecimalItem" />
        <result property="dsContrBllgMtrPk_A"     column="DS_CONTR_BLLG_MTR_PK"     javaType="EZDSBigDecimalItem" />
        <result property="fleetCalcProcCd_A"      column="FLEET_CALC_PROC_CD"       javaType="EZDSStringItem" />
    </resultMap>
</sqlMap>
