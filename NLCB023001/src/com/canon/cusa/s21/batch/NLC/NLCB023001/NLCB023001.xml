<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLCB023001">
    <statement id="getSceOrdTp" parameterClass="Map" resultClass="Map">
        SELECT
            OT.TRX_CD
           ,OT.TRX_RSN_CD
           ,OT.INBD_OTBD_CD
        FROM
            SCE_ORD_TP    OT
        WHERE
            OT.GLBL_CMPY_CD   = #GLBL_CMPY_CD#
        AND OT.SCE_ORD_TP_CD  = #SCE_ORD_TP_CD#
        AND OT.EZCANCELFLAG   = '0'
    </statement>


    <statement id="getInventoryInfo" parameterClass="Map" resultClass="Map">
        SELECT
            SWH.RTL_WH_CD
           ,SWH.RTL_SWH_CD
           ,INV.INVTY_LOC_CD
           ,INV.LOC_STS_CD
           ,INV.STK_STS_CD
           ,INV.MDSE_CD
<!-- START 2018/05/16 T.hakodate [QC#25814,ADD] -->
           ,CASE
                  WHEN (MM.SVC_MACH_MSTR_PK IS NOT NULL  AND MM.SER_NUM IS NOT NULL ) THEN 1 ELSE INV.INVTY_AVAL_QTY END AS INVTY_AVAL_QTY
           ,MM.SVC_MACH_TP_CD
           ,MM.SVC_MACH_MSTR_PK
           ,NVL(MM.SVC_CONFIG_MSTR_PK , -1) AS SVC_CONFIG_MSTR_PK
           ,MM.SER_NUM
           ,MM.SVC_MACH_MSTR_STS_CD
           --,INV.INVTY_AVAL_QTY
           ,DM.MDL_GRP_ID
<!-- END   2018/05/16 T.Hakodate [QC#25814,ADD] -->
        FROM
            RTL_WH          WH
           ,RTL_SWH         SWH
           ,INVTY           INV
           <!-- START 2018/04/24 S.Katsuma [QC#23355,ADD] -->
           ,SWH             S
           <!-- END 2018/04/24 S.Katsuma [QC#23355,ADD] -->
<!-- START 2018/04/24 T.hakodate [QC#25814,ADD] -->
           ,SVC_MACH_MSTR   MM
           ,SVC_CONFIG_MSTR CM
           ,DS_MDL          DM
<!-- END 2018/04/24 T.hakodate [QC#25814,ADD] -->
        WHERE
            WH.GLBL_CMPY_CD                   = #GLBL_CMPY_CD#
        AND WH.RTL_WH_CATG_CD                 = #RTL_WH_CATG_CD#
        AND WH.EFF_FROM_DT                    &lt;= #SALES_DT#
        AND NVL(WH.EFF_THRU_DT, '9991231')    &gt;= #SALES_DT#
        AND WH.GLBL_CMPY_CD                   = SWH.GLBL_CMPY_CD
        AND WH.RTL_WH_CD                      = SWH.RTL_WH_CD
        AND SWH.EFF_FROM_DT                   &lt;= #SALES_DT#
        AND NVL(SWH.EFF_THRU_DT, '9991231')   &gt;= #SALES_DT#
        AND SWH.GLBL_CMPY_CD                  = INV.GLBL_CMPY_CD
        AND SWH.INVTY_LOC_CD                  = INV.INVTY_LOC_CD
        AND INV.LOC_STS_CD                    = #LOC_STS_CD#
        AND INV.INVTY_AVAL_QTY                &gt; 0
        AND WH.EZCANCELFLAG                   = '0'
        AND SWH.EZCANCELFLAG                  = '0'
        AND INV.EZCANCELFLAG                  = '0'
        <!-- START 2018/04/24 S.Katsuma [QC#23355,ADD] -->
        AND SWH.RTL_SWH_CD                    = S.RTL_SWH_CD
        AND S.MDSE_INVTY_COST_PCT      &lt;&gt; #MDSE_INVTY_COST_PCT_ZERO#
        <!-- END 2018/04/24 S.Katsuma [QC#23355,ADD] -->
<!-- START 2018/05/16 T.hakodate [QC#25814,ADD] -->
        AND SWH.GLBL_CMPY_CD                  = S.GLBL_CMPY_CD
        AND S.EZCANCELFLAG                    = '0'
        AND INV.INVTY_LOC_CD                  = MM.CUR_LOC_NUM(+)
        AND INV.GLBL_CMPY_CD                  = MM.GLBL_CMPY_CD(+)
        AND MM.EZCANCELFLAG(+)                = '0'
        AND MM.SVC_MACH_MAINT_AVAL_FLG(+)     = #SVC_MACH_MAINT_AVAL_FLG#
        AND INV.LOC_STS_CD                    = MM.SVC_MACH_MSTR_LOC_STS_CD(+)
        AND ( MM.SVC_MACH_MSTR_STS_CD(+)      = #SVC_MACH_MSTR_STS_CD_C#
          OR  MM.SVC_MACH_MSTR_STS_CD(+)      = #SVC_MACH_MSTR_STS_CD_R#
           )
        AND INV.MDSE_CD                       = MM.MDSE_CD(+)
        AND MM.GLBL_CMPY_CD                   = CM.GLBL_CMPY_CD(+)
        AND MM.SVC_CONFIG_MSTR_PK             = CM.SVC_CONFIG_MSTR_PK(+)
        AND CM.EZCANCELFLAG(+)                = '0'
        AND DM.EZCANCELFLAG(+)                = '0'
        AND CM.MDL_ID                         = DM.MDL_ID(+)
        AND CM.GLBL_CMPY_CD                   = DM.GLBL_CMPY_CD(+)
<!-- END   2018/05/16 T.hakodate [QC#25814,ADD] -->
        ORDER BY
            SWH.RTL_WH_CD 
          , MM.SVC_CONFIG_MSTR_PK NULLS LAST
          , MM.SVC_MACH_TP_CD 
          , INV.MDSE_CD
    </statement>


    <statement id="getMachineMasterInfo" parameterClass="Map" resultClass="Map">
        SELECT
            MM.SVC_MACH_MSTR_PK
           ,MM.SER_NUM
           ,MM.SVC_CONFIG_MSTR_PK
           ,MM.STK_STS_CD
           ,MM.SVC_MACH_MSTR_STS_CD
        FROM
            SVC_MACH_MSTR    MM
        WHERE
            MM.GLBL_CMPY_CD                = #GLBL_CMPY_CD#
        AND MM.CUR_LOC_NUM                 = #CUR_LOC_NUM#
        AND MM.MDSE_CD                     = #MDSE_CD#
        AND MM.SVC_MACH_MSTR_LOC_STS_CD    = #SVC_MACH_MSTR_LOC_STS_CD#
        AND MM.SVC_MACH_MAINT_AVAL_FLG     = #SVC_MACH_MAINT_AVAL_FLG#
        AND MM.SVC_CONFIG_MSTR_PK          IS NULL
        <iterate property="SVC_MACH_MSTR_STS_CD" var="SVC_MACH_MSTR_STS_CD[]" open="AND MM.SVC_MACH_MSTR_STS_CD IN (" close=")" conjunction=",">
            #SVC_MACH_MSTR_STS_CD[]#
        </iterate>
        AND MM.EZCANCELFLAG                = '0'
        ORDER BY MM.SVC_CONFIG_MSTR_PK NULLS LAST
    </statement>


    <statement id="getShpgPln" parameterClass="Map" resultClass="Map">
        SELECT
            SP.SHPG_PLN_NUM
        FROM
            SHPG_PLN    SP
        WHERE
            SP.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND SP.TRX_HDR_NUM              = #TRX_HDR_NUM#
        AND SP.TRX_LINE_NUM             = #TRX_LINE_NUM#
        AND SP.EZCANCELFLAG             = '0'
    </statement>


    <statement id="getRwsSerialInfo" parameterClass="Map" resultClass="Map">
        SELECT
            DTL.RWS_NUM
           ,DTL.RWS_DTL_LINE_NUM
           ,DTL.INVTY_STK_STS_CD
           ,HDR.SCE_ORD_TP_CD
           ,DTL.RWS_QTY
           ,DTL.INVTY_LOC_CD
           ,DTL.MDSE_CD
           ,HDR.RWS_REF_NUM
           ,SER.SER_NUM
           ,SER.SO_NUM
           ,SER.SO_SLP_NUM
           ,SER.MDSE_CD    SO_MDSE_CD
           ,MM.SVC_MACH_MSTR_PK
           ,MM.SVC_CONFIG_MSTR_PK
           ,MM.STK_STS_CD
           ,MM.SVC_MACH_MSTR_LOC_STS_CD
           ,MM.SVC_MACH_MSTR_STS_CD
        FROM
            RWS_HDR          HDR
           ,RWS_DTL          DTL
           ,SO_SER           SER
           ,SVC_MACH_MSTR    MM
        WHERE
            HDR.GLBL_CMPY_CD            = #GLBL_CMPY_CD#
        <iterate property="RWS_NUM" var="RWS_NUM[]" open="AND HDR.RWS_NUM IN (" close=")" conjunction=",">
            #RWS_NUM[]#
        </iterate>
        AND HDR.GLBL_CMPY_CD            = DTL.GLBL_CMPY_CD
        AND HDR.RWS_NUM                 = DTL.RWS_NUM
        AND HDR.GLBL_CMPY_CD            = SER.GLBL_CMPY_CD(+)
        AND HDR.TRX_ORD_NUM             = SER.SO_NUM(+)
        AND DTL.TRX_LINE_NUM            = SER.SO_SLP_NUM(+)
        AND HDR.GLBL_CMPY_CD            = MM.GLBL_CMPY_CD(+)
        AND SER.SER_NUM                 = MM.SER_NUM(+)
        AND SER.MDSE_CD                 = MM.MDSE_CD(+)
        AND HDR.EZCANCELFLAG            = '0'
        AND DTL.EZCANCELFLAG            = '0'
        AND SER.EZCANCELFLAG(+)         = '0'
        AND MM.EZCANCELFLAG(+)          = '0'
        ORDER BY
            DTL.RWS_NUM
           ,DTL.RWS_DTL_LINE_NUM
    </statement>


</sqlMap>
