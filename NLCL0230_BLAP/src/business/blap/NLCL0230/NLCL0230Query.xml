<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLCL0230Query">

    <typeAlias alias="alcl0230CMsg" type="business.blap.NLCL0230.NLCL0230CMsg"/>
    <typeAlias alias="alcl0230ACMsg" type="business.blap.NLCL0230.NLCL0230_ACMsg"/>

    <statement id="findInvty" parameterClass="alcl0230CMsg" resultMap="result.findInvty">
        SELECT
            INVTY_LOC_CD
            , INVTY_LOC_NM
            , INVTY_LOC_TP_CD
            , INVTY_LOC_TP_NM
        FROM (
            SELECT DISTINCT
                ILV.INVTY_LOC_CD
                , ILV.INVTY_LOC_NM
                , ILV.INVTY_LOC_TP_CD
                , ILV.INVTY_LOC_TP_NM
            FROM
                (
                SELECT                                                      --1. WH
                    W.EZCANCELFLAG     AS EZCANCELFLAG
                    ,W.GLBL_CMPY_CD     AS GLBL_CMPY_CD
                    ,W.WH_CD            AS INVTY_LOC_CD
                    ,W.LOC_NM           AS INVTY_LOC_NM
                    ,LT.LOC_TP_CD       AS INVTY_LOC_TP_CD
                    ,LT.LOC_TP_NM       AS INVTY_LOC_TP_NM
                FROM
                    WH          W
                    ,LOC_ROLE_TP LRT
                    ,LOC_GRP     LG
                    ,LOC_TP      LT
                WHERE
                        W.LOC_ROLE_TP_CD = LRT.LOC_ROLE_TP_CD
                    AND W.GLBL_CMPY_CD   = LRT.GLBL_CMPY_CD
                    AND W.LOC_GRP_CD     = LG.LOC_GRP_CD
                    AND W.GLBL_CMPY_CD   = LG.GLBL_CMPY_CD
                    AND W.LOC_GRP_CD     = LT.LOC_GRP_CD
                    AND W.LOC_ROLE_TP_CD = LT.LOC_ROLE_TP_CD
                    AND W.GLBL_CMPY_CD   = LT.GLBL_CMPY_CD
                    AND W.EZCANCELFLAG   = '0'
                    AND LRT.EZCANCELFLAG = '0'
                    AND LG.EZCANCELFLAG  = '0'
                    AND LT.EZCANCELFLAG  = '0'
                UNION
                SELECT                                                      --2. VND
                     V.EZCANCELFLAG     AS EZCANCELFLAG
                    ,V.GLBL_CMPY_CD     AS GLBL_CMPY_CD
                    ,V.VND_CD           AS INVTY_LOC_CD
                    ,PVV.DPLY_VND_NM    AS INVTY_LOC_NM
                    ,LT.LOC_TP_CD       AS INVTY_LOC_TP_CD
                    ,LT.LOC_TP_NM       AS INVTY_LOC_TP_NM
                FROM
                     VND         V
                    ,PO_VND_V    PVV
                    ,LOC_ROLE_TP LRT
                    ,LOC_GRP     LG
                    ,LOC_TP      LT
                WHERE
                        V.GLBL_CMPY_CD   = PVV.GLBL_CMPY_CD
                    AND V.VND_CD         = PVV.VND_CD
                    AND V.GLBL_CMPY_CD   = LRT.GLBL_CMPY_CD
                    AND V.LOC_ROLE_TP_CD = LRT.LOC_ROLE_TP_CD
                    AND V.GLBL_CMPY_CD   = LG.GLBL_CMPY_CD
                    AND V.LOC_GRP_CD     = LG.LOC_GRP_CD
                    AND V.GLBL_CMPY_CD   = LT.GLBL_CMPY_CD
                    AND V.LOC_GRP_CD     = LT.LOC_GRP_CD
                    AND V.LOC_ROLE_TP_CD = LT.LOC_ROLE_TP_CD
                    AND V.EZCANCELFLAG   = '0'
                    AND PVV.EZCANCELFLAG = '0'
                    AND LRT.EZCANCELFLAG = '0'
                    AND LG.EZCANCELFLAG  = '0'
                    AND LT.EZCANCELFLAG  = '0'
                UNION
                SELECT                                                      --3. BR
                    B.EZCANCELFLAG     AS EZCANCELFLAG
                    ,B.GLBL_CMPY_CD     AS GLBL_CMPY_CD
                    ,B.BR_CD            AS INVTY_LOC_CD
                    ,B.LOC_NM           AS INVTY_LOC_NM
                    ,LT.LOC_TP_CD       AS INVTY_LOC_TP_CD
                    ,LT.LOC_TP_NM       AS INVTY_LOC_TP_NM
                FROM
                    BR          B
                    ,LOC_ROLE_TP LRT
                    ,LOC_GRP     LG
                    ,LOC_TP      LT
                WHERE
                        B.LOC_ROLE_TP_CD = LRT.LOC_ROLE_TP_CD
                    AND B.GLBL_CMPY_CD   = LRT.GLBL_CMPY_CD
                    AND B.LOC_GRP_CD     = LG.LOC_GRP_CD
                    AND B.GLBL_CMPY_CD   = LG.GLBL_CMPY_CD
                    AND B.LOC_GRP_CD     = LT.LOC_GRP_CD
                    AND B.LOC_ROLE_TP_CD = LT.LOC_ROLE_TP_CD
                    AND B.GLBL_CMPY_CD   = LT.GLBL_CMPY_CD
                    AND B.EZCANCELFLAG   = '0'
                    AND LRT.EZCANCELFLAG = '0'
                    AND LG.EZCANCELFLAG  = '0'
                    AND LT.EZCANCELFLAG  = '0'
                UNION
                SELECT                                                      --4. IMPT_INV_CNSGN
                    I.EZCANCELFLAG      AS EZCANCELFLAG
                    ,I.GLBL_CMPY_CD      AS GLBL_CMPY_CD
                    ,I.IMPT_INV_CNSGN_CD AS INVTY_LOC_CD
                    ,I.IMPT_INV_CNSGN_NM AS INVTY_LOC_NM
                    ,LT.LOC_TP_CD        AS INVTY_LOC_TP_CD
                    ,LT.LOC_TP_NM        AS INVTY_LOC_TP_NM
                FROM
                    IMPT_INV_CNSGN I
                    ,LOC_TP         LT
                WHERE
                        I.EZCANCELFLAG  = '0'
                    AND LT.LOC_TP_CD    = '05'
                    AND LT.EZCANCELFLAG = '0'
                    AND I.DITL_FLG      = 'Y'
                UNION
                SELECT                                                      --5.SHIP_TO_CUST
                    S.EZCANCELFLAG     AS EZCANCELFLAG
                    ,S.GLBL_CMPY_CD     AS GLBL_CMPY_CD
                    ,S.SHIP_TO_CUST_CD  AS INVTY_LOC_CD
                    ,S.LOC_NM           AS INVTY_LOC_NM
                    ,LT.LOC_TP_CD       AS INVTY_LOC_TP_CD
                    ,LT.LOC_TP_NM       AS INVTY_LOC_TP_NM
                FROM
                    SHIP_TO_CUST S
                    ,LOC_ROLE_TP  LRT
                    ,LOC_GRP      LG
                    ,LOC_TP       LT
                WHERE
                        S.RGTN_STS_CD IN ('P20','P99')
                    AND S.LOC_ROLE_TP_CD = LRT.LOC_ROLE_TP_CD
                    AND S.GLBL_CMPY_CD   = LRT.GLBL_CMPY_CD
                    AND S.LOC_GRP_CD     = LG.LOC_GRP_CD
                    AND S.GLBL_CMPY_CD   = LG.GLBL_CMPY_CD
                    AND S.LOC_GRP_CD     = LT.LOC_GRP_CD
                    AND S.LOC_ROLE_TP_CD = LT.LOC_ROLE_TP_CD
                    AND S.GLBL_CMPY_CD   = LT.GLBL_CMPY_CD
                    AND S.EZCANCELFLAG   = '0'
                    AND LRT.EZCANCELFLAG = '0'
                    AND LG.EZCANCELFLAG  = '0'
                    AND LT.EZCANCELFLAG  = '0'
                    AND NOT EXISTS
                        (
                        SELECT
                            *
                        FROM
                            WH W
                        WHERE
                                S.GLBL_CMPY_CD    = W.GLBL_CMPY_CD
                            AND S.SHIP_TO_CUST_CD = W.WH_CD
                            AND W.EZCANCELFLAG    = '0'
                        )
                    AND NOT EXISTS
                        (
                        SELECT
                            *
                        FROM
                            VND V
                        WHERE
                                S.GLBL_CMPY_CD    = V.GLBL_CMPY_CD
                            AND S.SHIP_TO_CUST_CD = V.VND_CD
                            AND V.EZCANCELFLAG    = '0'
                        )
                    AND NOT EXISTS
                        (
                        SELECT
                            *
                        FROM
                            BR B
                        WHERE
                                S.GLBL_CMPY_CD    = B.GLBL_CMPY_CD
                            AND S.SHIP_TO_CUST_CD = B.BR_CD
                            AND B.EZCANCELFLAG    = '0'
                        )
                ) ILV
            WHERE
                ILV.GLBL_CMPY_CD = #glblCmpyCd#
                <isNotEqual property="invtyLocTpCd_P1" compareValue="--">
                    AND ILV.INVTY_LOC_TP_CD = #invtyLocTpCd_P1#
                </isNotEqual>
                <isNotNull property="invtyLocCd">
                    AND ILV.INVTY_LOC_CD LIKE #invtyLocCd#
                </isNotNull>
                <isNotNull property="invtyLocNm">
                    AND UPPER(ILV.INVTY_LOC_NM) LIKE UPPER(#invtyLocNm#) <!-- 2019/03/11 QC#30698 Add Upper() -->
                </isNotNull>
                AND ILV.EZCANCELFLAG = '0'
            ORDER BY
                ILV.INVTY_LOC_CD ASC
        )
        <isNotNull property="xxRowNum">
        <![CDATA[
            WHERE
                ROWNUM < #xxRowNum#
        ]]>
        </isNotNull>
    </statement>

    <resultMap id="result.findInvty" class="alcl0230ACMsg">
        <result property="invtyLocCd_A1"   column="INVTY_LOC_CD"    javaType="EZDTStringItem"/>
        <result property="invtyLocNm_A1"   column="INVTY_LOC_NM"    javaType="EZDTStringItem"/>
        <result property="invtyLocTpCd_A1" column="INVTY_LOC_TP_CD" javaType="EZDTStringItem"/>
        <result property="invtyLocTpNm_A1" column="INVTY_LOC_TP_NM" javaType="EZDTStringItem"/>
    </resultMap>


    <statement id="findInvtyWithMdse" parameterClass="alcl0230CMsg" resultMap="result.findInvtyWithMdse">
        WITH RSLT_V AS (
            SELECT DISTINCT
                IVT.INVTY_LOC_CD
                , ILV.INVTY_LOC_NM
                , IVT.LOC_TP_CD
                , ILV.INVTY_LOC_TP_NM
            FROM
                INVTY IVT
                ,(
                SELECT                                                      --1. WH
                    W.EZCANCELFLAG     AS EZCANCELFLAG
                    ,W.GLBL_CMPY_CD     AS GLBL_CMPY_CD
                    ,W.WH_CD            AS INVTY_LOC_CD
                    ,W.LOC_NM           AS INVTY_LOC_NM
                    ,LT.LOC_TP_CD       AS INVTY_LOC_TP_CD
                    ,LT.LOC_TP_NM       AS INVTY_LOC_TP_NM
                FROM
                    WH          W
                    ,LOC_ROLE_TP LRT
                    ,LOC_GRP     LG
                    ,LOC_TP      LT
                WHERE
                        W.LOC_ROLE_TP_CD = LRT.LOC_ROLE_TP_CD
                    AND W.GLBL_CMPY_CD   = LRT.GLBL_CMPY_CD
                    AND W.LOC_GRP_CD     = LG.LOC_GRP_CD
                    AND W.GLBL_CMPY_CD   = LG.GLBL_CMPY_CD
                    AND W.LOC_GRP_CD     = LT.LOC_GRP_CD
                    AND W.LOC_ROLE_TP_CD = LT.LOC_ROLE_TP_CD
                    AND W.GLBL_CMPY_CD   = LT.GLBL_CMPY_CD
                    AND W.EZCANCELFLAG   = '0'
                    AND LRT.EZCANCELFLAG = '0'
                    AND LG.EZCANCELFLAG  = '0'
                    AND LT.EZCANCELFLAG  = '0'
                UNION
                SELECT                                                      --2. VND
                     V.EZCANCELFLAG     AS EZCANCELFLAG
                    ,V.GLBL_CMPY_CD     AS GLBL_CMPY_CD
                    ,V.VND_CD           AS INVTY_LOC_CD
                    ,PVV.DPLY_VND_NM    AS INVTY_LOC_NM
                    ,LT.LOC_TP_CD       AS INVTY_LOC_TP_CD
                    ,LT.LOC_TP_NM       AS INVTY_LOC_TP_NM
                FROM
                     VND         V
                    ,PO_VND_V    PVV
                    ,LOC_ROLE_TP LRT
                    ,LOC_GRP     LG
                    ,LOC_TP      LT
                WHERE
                        V.GLBL_CMPY_CD   = PVV.GLBL_CMPY_CD
                    AND V.VND_CD         = PVV.VND_CD
                    AND V.GLBL_CMPY_CD   = LRT.GLBL_CMPY_CD
                    AND V.LOC_ROLE_TP_CD = LRT.LOC_ROLE_TP_CD
                    AND V.GLBL_CMPY_CD   = LG.GLBL_CMPY_CD
                    AND V.LOC_GRP_CD     = LG.LOC_GRP_CD
                    AND V.GLBL_CMPY_CD   = LT.GLBL_CMPY_CD
                    AND V.LOC_GRP_CD     = LT.LOC_GRP_CD
                    AND V.LOC_ROLE_TP_CD = LT.LOC_ROLE_TP_CD
                    AND V.EZCANCELFLAG   = '0'
                    AND PVV.EZCANCELFLAG = '0'
                    AND LRT.EZCANCELFLAG = '0'
                    AND LG.EZCANCELFLAG  = '0'
                    AND LT.EZCANCELFLAG  = '0'
                UNION
                SELECT                                                      --3. BR
                    B.EZCANCELFLAG     AS EZCANCELFLAG
                    ,B.GLBL_CMPY_CD     AS GLBL_CMPY_CD
                    ,B.BR_CD            AS INVTY_LOC_CD
                    ,B.LOC_NM           AS INVTY_LOC_NM
                    ,LT.LOC_TP_CD       AS INVTY_LOC_TP_CD
                    ,LT.LOC_TP_NM       AS INVTY_LOC_TP_NM
                FROM
                    BR          B
                    ,LOC_ROLE_TP LRT
                    ,LOC_GRP     LG
                    ,LOC_TP      LT
                WHERE
                        B.LOC_ROLE_TP_CD = LRT.LOC_ROLE_TP_CD
                    AND B.GLBL_CMPY_CD   = LRT.GLBL_CMPY_CD
                    AND B.LOC_GRP_CD     = LG.LOC_GRP_CD
                    AND B.GLBL_CMPY_CD   = LG.GLBL_CMPY_CD
                    AND B.LOC_GRP_CD     = LT.LOC_GRP_CD
                    AND B.LOC_ROLE_TP_CD = LT.LOC_ROLE_TP_CD
                    AND B.GLBL_CMPY_CD   = LT.GLBL_CMPY_CD
                    AND B.EZCANCELFLAG   = '0'
                    AND LRT.EZCANCELFLAG = '0'
                    AND LG.EZCANCELFLAG  = '0'
                    AND LT.EZCANCELFLAG  = '0'
                UNION
                SELECT                                                      --4. IMPT_INV_CNSGN
                    I.EZCANCELFLAG      AS EZCANCELFLAG
                    ,I.GLBL_CMPY_CD      AS GLBL_CMPY_CD
                    ,I.IMPT_INV_CNSGN_CD AS INVTY_LOC_CD
                    ,I.IMPT_INV_CNSGN_NM AS INVTY_LOC_NM
                    ,LT.LOC_TP_CD        AS INVTY_LOC_TP_CD
                    ,LT.LOC_TP_NM        AS INVTY_LOC_TP_NM
                FROM
                    IMPT_INV_CNSGN I
                    ,LOC_TP         LT
                WHERE
                        I.EZCANCELFLAG  = '0'
                    AND LT.LOC_TP_CD    = '05'
                    AND LT.EZCANCELFLAG = '0'
                    AND I.DITL_FLG      = 'Y'
                UNION
                SELECT                                                      --5.SHIP_TO_CUST
                    S.EZCANCELFLAG     AS EZCANCELFLAG
                    ,S.GLBL_CMPY_CD     AS GLBL_CMPY_CD
                    ,S.SHIP_TO_CUST_CD  AS INVTY_LOC_CD
                    ,S.LOC_NM           AS INVTY_LOC_NM
                    ,LT.LOC_TP_CD       AS INVTY_LOC_TP_CD
                    ,LT.LOC_TP_NM       AS INVTY_LOC_TP_NM
                FROM
                    SHIP_TO_CUST S
                    ,LOC_ROLE_TP  LRT
                    ,LOC_GRP      LG
                    ,LOC_TP       LT
                WHERE
                        S.RGTN_STS_CD IN ('P20','P99')
                    AND S.LOC_ROLE_TP_CD = LRT.LOC_ROLE_TP_CD
                    AND S.GLBL_CMPY_CD   = LRT.GLBL_CMPY_CD
                    AND S.LOC_GRP_CD     = LG.LOC_GRP_CD
                    AND S.GLBL_CMPY_CD   = LG.GLBL_CMPY_CD
                    AND S.LOC_GRP_CD     = LT.LOC_GRP_CD
                    AND S.LOC_ROLE_TP_CD = LT.LOC_ROLE_TP_CD
                    AND S.GLBL_CMPY_CD   = LT.GLBL_CMPY_CD
                    AND S.EZCANCELFLAG   = '0'
                    AND LRT.EZCANCELFLAG = '0'
                    AND LG.EZCANCELFLAG  = '0'
                    AND LT.EZCANCELFLAG  = '0'
                    AND NOT EXISTS
                        (
                        SELECT
                            *
                        FROM
                            WH W
                        WHERE
                                S.GLBL_CMPY_CD    = W.GLBL_CMPY_CD
                            AND S.SHIP_TO_CUST_CD = W.WH_CD
                            AND W.EZCANCELFLAG    = '0'
                        )
                    AND NOT EXISTS
                        (
                        SELECT
                            *
                        FROM
                            VND V
                        WHERE
                                S.GLBL_CMPY_CD    = V.GLBL_CMPY_CD
                            AND S.SHIP_TO_CUST_CD = V.VND_CD
                            AND V.EZCANCELFLAG    = '0'
                        )
                    AND NOT EXISTS
                        (
                        SELECT
                            *
                        FROM
                            BR B
                        WHERE
                                S.GLBL_CMPY_CD    = B.GLBL_CMPY_CD
                            AND S.SHIP_TO_CUST_CD = B.BR_CD
                            AND B.EZCANCELFLAG    = '0'
                        )
                 ) ILV
            WHERE
                IVT.GLBL_CMPY_CD = #glblCmpyCd#
                AND IVT.MDSE_CD = #mdseCd_F#
                <isNotEqual property="invtyLocTpCd_P1" compareValue="--">
                    AND IVT.LOC_TP_CD = #invtyLocTpCd_P1#
                </isNotEqual>
                <isNotNull property="invtyLocCd">
                    AND IVT.INVTY_LOC_CD LIKE #invtyLocCd#
                </isNotNull>
                AND IVT.EZCANCELFLAG = '0'
                AND IVT.GLBL_CMPY_CD = ILV.GLBL_CMPY_CD
                AND IVT.LOC_TP_CD = ILV.INVTY_LOC_TP_CD
                AND IVT.INVTY_LOC_CD = ILV.INVTY_LOC_CD
                <isNotNull property="invtyLocNm">
                    AND ILV.INVTY_LOC_NM LIKE #invtyLocNm#
                </isNotNull>
                AND ILV.EZCANCELFLAG = '0'
            ORDER BY
                IVT.INVTY_LOC_CD ASC
        )
        SELECT
            INVTY_LOC_CD
            , INVTY_LOC_NM
            , LOC_TP_CD
            , INVTY_LOC_TP_NM
        FROM
            RSLT_V
        <isNotNull property="xxRowNum">
        <![CDATA[
            WHERE
                ROWNUM < #xxRowNum#
        ]]>
        </isNotNull>
    </statement>

    <resultMap id="result.findInvtyWithMdse" class="alcl0230ACMsg">
        <result property="invtyLocCd_A1"  column="INVTY_LOC_CD"     javaType="EZDTStringItem"/>
        <result property="invtyLocNm_A1"  column="INVTY_LOC_NM"     javaType="EZDTStringItem"/>
        <result property="invtyLocTpCd_A1" column="INVTY_LOC_TP_CD" javaType="EZDTStringItem"/>
        <result property="invtyLocTpNm_A1" column="INVTY_LOC_TP_NM" javaType="EZDTStringItem"/>
    </resultMap>

</sqlMap>
