<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NLCL0620Query">
    <typeAlias alias="NLCL0620CMsg" type="business.blap.NLCL0620.NLCL0620CMsg" />
    <typeAlias alias="NLCL0620SMsg" type="business.blap.NLCL0620.NLCL0620SMsg" />
    <typeAlias alias="NLCL0620_ASMsg" type="business.blap.NLCL0620.NLCL0620_ASMsg" />
    <typeAlias alias="NLCL0620_FSMsg" type="business.blap.NLCL0620.NLCL0620_FSMsg" />

    <statement id="getTechnicianName" parameterClass="Map"
        resultClass="Map">
        <!-- START 2023/7/4 G.Quan [QC#61208, MOD] -->
        <!--  
        SELECT
            TM.TECH_TOC_CD
            ,TM.TECH_NM
        FROM
            TECH_MSTR TM
            ,S21_PSN SP
        WHERE
                TM.GLBL_CMPY_CD                        =    #glblCmpyCd#
            AND TM.TECH_TOC_CD                         =    #techTocCd#
            AND TM.TECH_TOC_CD                         =    SP.PSN_CD
            AND TM.GLBL_CMPY_CD                        =    SP.GLBL_CMPY_CD
            <isNotNull property="userId">
            AND (SP.HR_SUPV_ID                         =    #userId#
                 OR SP.PSN_CD                          =    #userId#)
            </isNotNull>
            AND SP.EFF_FROM_DT                     &lt;=    #salesDate#
            AND NVL(SP.EFF_THRU_DT, '99991231')    &gt;=    #salesDate#
            AND TM.EZCANCELFLAG                        =    '0'
            AND SP.EZCANCELFLAG                        =    '0'
            -->
        <isNotNull property="userId">
        WITH HR_SUPV AS (
            SELECT LEVEL AS LV, SP.PSN_CD, TRIM(SP.PSN_LAST_NM || ',' || SP.PSN_FIRST_NM || ' ' || SP.PSN_MID_NM) AS PSN_NM, SP.HR_SUPV_ID, SP.HR_SUPV_NM 
            FROM S21_PSN SP
            WHERE
                SP.GLBL_CMPY_CD  = #glblCmpyCd#
            AND SP.EZCANCELFLAG  = '0'
            START WITH SP.PSN_CD = #techTocCd#
            CONNECT BY PRIOR SP.HR_SUPV_ID = SP.PSN_CD
        )
        </isNotNull>
        SELECT
             RW.RTL_WH_CD AS TECH_TOC_CD
            ,RW.RTL_WH_NM AS TECH_NM
        FROM
             RTL_WH  RW
            ,S21_PSN SP
        WHERE
                RW.GLBL_CMPY_CD                        =    #glblCmpyCd#
            AND RW.RTL_WH_CD                           =    #techTocCd#
            AND RW.TECH_TOC_CD                         =    SP.PSN_CD
            AND RW.GLBL_CMPY_CD                        =    SP.GLBL_CMPY_CD
            <isNotNull property="userId">
            AND EXISTS (SELECT 1 FROM HR_SUPV SUPV WHERE SUPV.PSN_CD = #userId#)
            </isNotNull>
            AND SP.EFF_FROM_DT                     &lt;=    #salesDate#
            AND NVL(SP.EFF_THRU_DT, '99991231')    &gt;=    #salesDate#
            AND RW.EZCANCELFLAG                        =    '0'
            AND SP.EZCANCELFLAG                        =    '0'
        <!-- END 2023/7/4 G.Quan [QC#61208, MOD] -->
    </statement>
    <!-- QC#28755 ADD START -->
    <statement id="getLocationName" parameterClass="Map"
        resultClass="Map">
        <!-- START 2023/7/4 G.Quan [QC#61208, MOD] -->
        <!--  
        SELECT
             RW.RTL_WH_CD
            ,RW.RTL_WH_NM
        FROM
             RTL_WH  RW
            ,S21_PSN SP
        WHERE
                RW.GLBL_CMPY_CD                        =    #glblCmpyCd#
            AND RW.RTL_WH_CD                           =    #rtlWhCd#
            AND RW.TECH_TOC_CD                         =    SP.PSN_CD
            AND RW.GLBL_CMPY_CD                        =    SP.GLBL_CMPY_CD
            <isNotNull property="userId">
            AND (SP.HR_SUPV_ID                         =    #userId#
                 OR SP.PSN_CD                          =    #userId#)
            </isNotNull>
            AND SP.EFF_FROM_DT                     &lt;=    #salesDate#
            AND NVL(SP.EFF_THRU_DT, '99991231')    &gt;=    #salesDate#
            AND RW.EZCANCELFLAG                        =    '0'
            AND SP.EZCANCELFLAG                        =    '0'
            -->
        <isNotNull property="userId">
        WITH HR_SUPV_OWNER AS (
            SELECT LEVEL AS LV, SP.PSN_CD, TRIM(SP.PSN_LAST_NM || ',' || SP.PSN_FIRST_NM || ' ' || SP.PSN_MID_NM) AS PSN_NM, SP.HR_SUPV_ID, SP.HR_SUPV_NM 
            FROM
                S21_PSN SP
            WHERE
                SP.GLBL_CMPY_CD                        =    #glblCmpyCd#
            AND SP.EZCANCELFLAG                        =    '0'
            AND SP.EFF_FROM_DT                     &lt;=    #salesDate#
            AND NVL(SP.EFF_THRU_DT, '99991231')    &gt;=    #salesDate#
            START WITH SP.PSN_CD = 
                (
                    SELECT
                        RW.TECH_TOC_CD
                    FROM
                        RTL_WH  RW
                    WHERE
                        RW.GLBL_CMPY_CD                        =    #glblCmpyCd#
                    AND RW.EZCANCELFLAG                        =    '0'
                    AND RW.RTL_WH_CD                           =    #rtlWhCd#
                 )
            CONNECT BY PRIOR SP.HR_SUPV_ID = SP.PSN_CD
        )
        </isNotNull>
        SELECT
             RW.RTL_WH_CD
            ,RW.RTL_WH_NM
            ,RW.TECH_TOC_CD
        FROM
             RTL_WH  RW
            ,S21_PSN SP
        WHERE
                RW.GLBL_CMPY_CD                        =    #glblCmpyCd#
            AND RW.RTL_WH_CD                           =    #rtlWhCd#
            AND RW.TECH_TOC_CD                         =    SP.PSN_CD
            AND RW.GLBL_CMPY_CD                        =    SP.GLBL_CMPY_CD
            <isNotNull property="userId">
            AND EXISTS (SELECT 1 FROM HR_SUPV_OWNER SUPV WHERE SUPV.PSN_CD     = #userId#)
            </isNotNull>
            AND SP.EFF_FROM_DT                     &lt;=    #salesDate#
            AND NVL(SP.EFF_THRU_DT, '99991231')    &gt;=    #salesDate#
            AND RW.EZCANCELFLAG                        =    '0'
            AND SP.EZCANCELFLAG                        =    '0'
        <!-- END 2023/7/4 G.Quan [QC#61208, MOD] -->
    </statement>
    <!-- QC#28755 ADD END -->
    <statement id="getMaxAdjustSubmitDate" parameterClass="Map"
        resultClass="Map">
        SELECT
            PIC.PHYS_INVTY_NUM
        FROM
            PHYS_INVTY_CTRL PIC
            ,(SELECT
                    MAX(P.ADJ_SUBMT_TS) AS ADJ_SUBMT_TS
                FROM
                    PHYS_INVTY_CTRL P
                WHERE
                        P.GLBL_CMPY_CD                    =  #glblCmpyCd#
                    <!-- QC#28755 MOD START -->
                    <!-- AND P.TECH_TOC_CD                     =  #techTocCd# -->
                    <isNotNull property="techTocCd">
                        AND P.TECH_TOC_CD                 =  #techTocCd#
                    </isNotNull>
                    <isNotNull property="rtlWhCd">
                        AND P.RTL_WH_CD                   =  #rtlWhCd#
                    </isNotNull>
                    <!-- QC#28755 MOD END -->
                    AND P.PHYS_INVTY_STS_CD               =  #physInvtyStsCd#
                    AND P.PHYS_INVTY_CNT_STS_CD    &lt;&gt;  #physInvtyCntStsCd#
                    AND P.EZCANCELFLAG                    =  '0'
            ) LPIC
        WHERE
                PIC.GLBL_CMPY_CD          =  #glblCmpyCd#
            AND PIC.ADJ_SUBMT_TS          =  LPIC.ADJ_SUBMT_TS
            AND PIC.EZCANCELFLAG          =  '0'
            AND ROWNUM                &lt;=  #maxRownum#
    </statement>
    <statement id="getLastPhysicalInventory" parameterClass="Map"
        resultClass="Map">
        SELECT
            MAX(PIC.ADJ_SUBMT_TS) AS MAX_ADJ_SUBMT_TS
            ,SUM(PIC.ADJ_GRS_AMT) AS TOTAL_ADJ_GRS_AMT
            ,SUM(PIC.ADJ_NET_AMT) AS TOTAL_ADJ_NET_AMT
        FROM
            PHYS_INVTY_CTRL PIC
        WHERE
                PIC.GLBL_CMPY_CD               =  #glblCmpyCd#
            <!-- QC#28755 MOD START -->
            <!-- AND PIC.TECH_TOC_CD                =  #techTocCd# -->
            <isNotNull property="techTocCd">
                AND PIC.TECH_TOC_CD            =  #techTocCd#
            </isNotNull>
            <isNotNull property="rtlWhCd">
                AND PIC.RTL_WH_CD              =  #rtlWhCd#
            </isNotNull>
            <!-- QC#28755 MOD END -->
            AND PIC.PHYS_INVTY_NUM             =  #physInvtyNum#
            AND PIC.EZCANCELFLAG               =  '0'
        GROUP BY
            PIC.PHYS_INVTY_NUM
    </statement>
    <statement id="countPhysicalInventoryControlForName" parameterClass="Map"
        resultClass="Map">
        SELECT
            COUNT(*) AS CNT
        FROM
            PHYS_INVTY_CTRL PIC
        WHERE
                PIC.GLBL_CMPY_CD               =  #glblCmpyCd#
            AND PIC.PHYS_INVTY_CTRL_NM         =  #physInvtyCtrlNm#
            AND PIC.EZCANCELFLAG               =  '0'
    </statement>
    <statement id="countOpenOrder" parameterClass="Map" resultClass="Map">
         WITH CAIH AS(
            SELECT
                CAIH.AP_VND_INV_NUM
               ,CAIH.INV_DT
               ,CAIH.PO_NUM
               ,CAID.PO_ORD_DTL_LINE_NUM
            FROM
                CM_AP_INV_HDR CAIH
               ,CM_AP_INV_DTL CAID 
            WHERE
                CAIH.GLBL_CMPY_CD  = #glblCmpyCd#
            AND CAIH.ACCT_INV_STS_CD   = #entered#
            AND CAIH.AP_VND_CD         = CAID.AP_VND_CD
            AND CAIH.AP_VND_INV_NUM    = CAID.AP_VND_INV_NUM
            AND CAIH.AP_VND_INV_SQ_NUM = CAID.AP_VND_INV_SQ_NUM
            AND CAIH.EZCANCELFLAG   = '0'
            AND CAID.EZCANCELFLAG   = '0'
        ),PR_H1 AS (
                SELECT /* Open Tech PR */
                    PRD.PRCH_REQ_NUM
                    ,NVL(PRD.SO_NUM, RH.RWS_REF_NUM) AS SO_NUM
                    ,CASE
                        WHEN PRD2.PO_ORD_NUM IS NULL
                            THEN SUBSTR(PRD.SHIP_DT_TM_TS,1,8)
                        ELSE (
                            SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8)
                        )
                     END AS SHIP_DATE
                    ,PRD.PROCR_TP_CD
                    ,NVL(PRD.PRO_NUM, RH.IMPT_INV_BOL_NUM) AS PRO_NUM
                    ,CASE
                        WHEN PRD.PROCR_TP_CD = #procrTpCd1# THEN PV.PRNT_VND_NM
                        WHEN PRD.PROCR_TP_CD = #procrTpCd2# THEN RW.RTL_WH_NM
                        ELSE NULL END AS WAREHOUSE_OR_SUPPLIER
                    ,CASE WHEN SS.SHPG_STS_DESC_TXT IS NOT NULL THEN SS.SHPG_STS_DESC_TXT
                          WHEN EAHW.RWS_NUM IS NOT NULL THEN #shipped# 
                     END AS SHPG_STS_DESC_TXT
                    ,PRT.PRCH_REQ_TP_DESC_TXT
                    ,CASE 
                        WHEN PRD2.PO_ORD_NUM IS NULL
                            THEN TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(PRD.SHIP_DT_TM_TS,1,8), #physInvtyDt#), 'YYYYMMDD')
                        ELSE (
                            CASE WHEN TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD') &lt; 0 THEN 0
                                 ELSE TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD')
                            END
                        )
                     END AS AGE
                    ,PRD.MDSE_CD
                    ,RD.RWS_NUM
                FROM
                    PRCH_REQ        PR
                    ,PRCH_REQ_DTL   PRD
                    ,SHPG_ORD       SO
                    ,PRCH_REQ_STS   PRS
                    ,PRCH_REQ_TP    PRT
                    ,RTL_WH         RW
                    ,PRNT_VND       PV
                    ,SHPG_STS       SS
                    ,EDI_ASN_HDR_WRK EAHW
                    ,RWS_HDR RH
                    ,RWS_DTL        RD
                    ,PRCH_REQ_DTL   PRD2
                    ,CAIH CAIH
                WHERE
                        PR.GLBL_CMPY_CD                        =      #glblCmpyCd#
                    AND PR.PRCH_REQ_REC_TP_CD                  =      #prchReqRecTpCd#
                    <isNotNull property="rqstTechTocCd">
                        AND PR.RQST_TECH_TOC_CD                =      #rqstTechTocCd#
                    </isNotNull>
                    AND PR.PRCH_REQ_NUM                        =      PRD.PRCH_REQ_NUM
                    AND PR.GLBL_CMPY_CD                        =      PRD.GLBL_CMPY_CD
                    <isNotNull property="destRtlWhCd">
                        AND PRD.DEST_RTL_WH_CD                 =      #destRtlWhCd#
                    </isNotNull>
                    <!-- START 2021/09/29 R.Azucena [QC#59216, MOD] -->
                    <!-- AND ( -->
                    <!--   (PR.PRCH_REQ_SRC_TP_CD            &lt;&gt;      #choiceShipConfirmation# -->
                    <!--     AND PRD.PRCH_REQ_LINE_SUB_NUM   &lt;&gt;      #prchReqLineSubNum#) -->
                    <!--   OR (PR.PRCH_REQ_SRC_TP_CD                =      #choiceShipConfirmation# -->
                    <!--     AND PRD.PRCH_REQ_LINE_SUB_NUM          =      #prchReqLineSubNum#) -->
                    <!-- ) -->
                    <isNotNull property="shipConfirmationCdArray">
                        AND (
                          (PR.PRCH_REQ_SRC_TP_CD NOT IN
                              <iterate property="shipConfirmationCdArray" var="shipConfirmationCdArray[]" open="(" close=")" conjunction=",">
                                  #shipConfirmationCdArray[]#
                              </iterate>
                            AND PRD.PRCH_REQ_LINE_SUB_NUM     &lt;&gt;     #prchReqLineSubNum#)
                          OR (PR.PRCH_REQ_SRC_TP_CD IN
                              <iterate property="shipConfirmationCdArray" var="shipConfirmationCdArray[]" open="(" close=")" conjunction=",">
                                  #shipConfirmationCdArray[]#
                              </iterate>
                            AND PRD.PRCH_REQ_LINE_SUB_NUM      =      #prchReqLineSubNum#)
                        )
                    </isNotNull>
                    <!-- END 2021/09/29 R.Azucena [QC#59216, MOD] -->
                    AND PRD.PRCH_REQ_LINE_STS_CD              !=      #cancel#
                    AND PRD.SO_NUM                             =      SO.SO_NUM(+)
                    AND PRD.GLBL_CMPY_CD                       =      SO.GLBL_CMPY_CD(+)
                    AND PR.PRCH_REQ_STS_CD                     =      PRS.PRCH_REQ_STS_CD
                    AND PR.GLBL_CMPY_CD                        =      PRS.GLBL_CMPY_CD
                    AND PRS.OPEN_STS_FLG                       =      #openStsFlg#
                    AND PR.PRCH_REQ_TP_CD                      =      PRT.PRCH_REQ_TP_CD(+)
                    AND PR.GLBL_CMPY_CD                        =      PRT.GLBL_CMPY_CD(+)
                    AND PRD.SRC_RTL_WH_CD                      =      RW.RTL_WH_CD(+)
                    AND PRD.GLBL_CMPY_CD                       =      RW.GLBL_CMPY_CD(+)
                    AND PRD.PRNT_VND_CD                        =      PV.PRNT_VND_CD(+)
                    AND PRD.GLBL_CMPY_CD                       =      PV.GLBL_CMPY_CD(+)
                    AND SO.SHPG_STS_CD                         =      SS.SHPG_STS_CD(+)
                    AND SO.GLBL_CMPY_CD                        =      SS.GLBL_CMPY_CD(+)
                    AND PRD.GLBL_CMPY_CD                       =      RD.GLBL_CMPY_CD(+)
                    AND PRD.PRCH_REQ_NUM                       =      RD.PRCH_REQ_NUM(+)
                    AND PRD.PRCH_REQ_LINE_NUM                  =      RD.PRCH_REQ_LINE_NUM(+)
                    AND PRD.PRCH_REQ_LINE_SUB_NUM              =      RD.PRCH_REQ_LINE_SUB_NUM(+)
                    AND RD.GLBL_CMPY_CD                        =      RH.GLBL_CMPY_CD(+)
                    AND RD.RWS_NUM                             =      RH.RWS_NUM(+)
                    AND RH.GLBL_CMPY_CD                        =      EAHW.GLBL_CMPY_CD(+)
                    AND RH.RWS_NUM                             =      EAHW.RWS_NUM(+)
                    AND PRD.GLBL_CMPY_CD                       =      PRD2.GLBL_CMPY_CD(+)
                    AND PRD.PRCH_REQ_NUM                       =      PRD2.TRX_REF_NUM(+)
                    AND PRD.PRCH_REQ_LINE_NUM                  =      PRD2.TRX_REF_LINE_NUM(+)
                    AND PRD.PRCH_REQ_LINE_SUB_NUM              =      PRD2.TRX_REF_LINE_SUB_NUM(+)
                    AND PRD2.PO_ORD_NUM                        =      CAIH.PO_NUM(+)
                    AND PRD2.PO_ORD_DTL_LINE_NUM               =      CAIH.PO_ORD_DTL_LINE_NUM(+)
                    AND (EXISTS(SELECT 1 FROM RWS_HDR RH2 WHERE RH.GLBL_CMPY_CD = RH2.GLBL_CMPY_CD AND RH.RWS_NUM = RH2.RWS_NUM AND RH2.RWS_STS_CD IN(#printed#, #receiving#) AND RH2.EZCANCELFLAG = '0') OR RH.RWS_NUM IS NULL)
                    AND PR.EZCANCELFLAG                        =      '0'
                    AND PRD.EZCANCELFLAG                       =      '0'
                    AND SO.EZCANCELFLAG(+)                     =      '0'
                    AND PRS.EZCANCELFLAG                       =      '0'
                    AND PRT.EZCANCELFLAG(+)                    =      '0'
                    AND RW.EZCANCELFLAG(+)                     =      '0'
                    AND PV.EZCANCELFLAG(+)                     =      '0'
                    AND SS.EZCANCELFLAG(+)                     =      '0'
                    AND EAHW.EZCANCELFLAG(+)                   =      '0'
                    AND RD.EZCANCELFLAG(+)                     =      '0'
                    AND RH.EZCANCELFLAG(+)                     =      '0'
                    AND PRD2.EZCANCELFLAG(+)                   =      '0'
                UNION ALL
                SELECT  /* Open PO */
                    PO.PO_ORD_NUM AS PRCH_REQ_NUM
                   ,RH.RWS_REF_NUM AS SO_NUM
                   ,SUBSTR(EAHW.ASN_SHIP_DT_TM_TS ,1,8) AS SHIP_DATE
                   ,#procrTpCd1# AS PROCR_TP_CD
                   ,RH.IMPT_INV_BOL_NUM AS PRO_NUM
                   ,PV.PRNT_VND_NM AS WAREHOUSE_OR_SUPPLIER
                   ,CASE WHEN EAHW.ASN_SHIP_DT_TM_TS IS NOT NULL THEN #shipped# END AS SHPG_STS_DESC_TXT
                   ,PO.DS_PO_TP_NM AS PRCH_REQ_TP_DESC_TXT
                   ,CASE WHEN TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD') &lt; 0 THEN 0
                         ELSE TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD')
                    END AS AGE
                   ,PD.MDSE_CD
                   ,RD.RWS_NUM
               FROM
                   PO              PO
                  ,PO_DTL          PD
                  ,PRNT_VND        PV
                  ,RWS_HDR         RH
                  ,RWS_DTL         RD
                  ,EDI_ASN_HDR_WRK EAHW
                  ,CAIH            CAIH
              WHERE
                  PO.GLBL_CMPY_CD        = #glblCmpyCd#
              AND PO.PO_QLFY_CD          = #poQlfyCdTech#
              <isNotNull property="poOrdSrcCd">
              AND PO.PO_ORD_SRC_CD      IN
              <iterate property="poOrdSrcCd" var="poOrdSrcCd[]" open="(" close=")" conjunction=",">
                  #poOrdSrcCd[]#
              </iterate>
              </isNotNull>
              AND PO.GLBL_CMPY_CD        = PV.GLBL_CMPY_CD(+)
              AND PO.PRNT_VND_CD         = PV.PRNT_VND_CD(+)
              <isNotNull property="dsPoTpCd">
              AND PO.DS_PO_TP_CD    NOT IN
              <iterate property="dsPoTpCd" var="dsPoTpCd[]" open="(" close=")" conjunction=",">
                  #dsPoTpCd[]#
              </iterate>
              </isNotNull>
              AND PO.PO_ORD_NUM          = PD.PO_ORD_NUM
              <isNotNull property="poStsCd">
              AND PD.PO_STS_CD      NOT IN
              <iterate property="poStsCd" var="poStsCd[]" open="(" close=")" conjunction=",">
                  #poStsCd[]#
              </iterate>
              </isNotNull>
              <isNotNull property="rqstTechTocCd">
                  AND PO.RQST_TECH_TOC_CD = #rqstTechTocCd#
              </isNotNull>
              <isNotNull property="destRtlWhCd">
                  AND PO.DEST_RTL_WH_CD  =      #destRtlWhCd#
              </isNotNull>
              AND PO.GLBL_CMPY_CD        = RH.GLBL_CMPY_CD
              AND PD.PO_ORD_NUM          = RH.PO_RCV_TRX_HDR_NUM
              AND PD.PO_ORD_DTL_LINE_NUM = RD.PO_RCV_TRX_LINE_NUM
              AND RH.GLBL_CMPY_CD        = RD.GLBL_CMPY_CD
              AND RH.RWS_NUM             = RD.RWS_NUM
              AND RH.GLBL_CMPY_CD        = EAHW.GLBL_CMPY_CD(+)
              AND RH.RWS_NUM             = EAHW.RWS_NUM(+)
              AND PD.PO_ORD_NUM          = CAIH.PO_NUM(+)
              AND PD.PO_ORD_DTL_LINE_NUM = CAIH.PO_ORD_DTL_LINE_NUM(+) 
              AND EXISTS(SELECT 1 FROM RWS_HDR RH2 WHERE RH.GLBL_CMPY_CD = RH2.GLBL_CMPY_CD AND RH.RWS_NUM = RH2.RWS_NUM AND RH2.RWS_STS_CD IN(#printed#, #receiving#) AND RH2.EZCANCELFLAG = '0')
              AND PO.EZCANCELFLAG        = '0'
              AND PD.EZCANCELFLAG        = '0'
              AND PV.EZCANCELFLAG(+)     = '0'
              AND RH.EZCANCELFLAG        = '0'
              AND RD.EZCANCELFLAG        = '0'
              UNION ALL
                SELECT
                    PO.PO_ORD_NUM AS PRCH_REQ_NUM
                   ,RH.RWS_REF_NUM AS SO_NUM
                   ,SUBSTR(EAHW.ASN_SHIP_DT_TM_TS ,1,8) AS SHIP_DATE
                   ,#procrTpCd1# AS PROCR_TP_CD
                   ,RH.IMPT_INV_BOL_NUM AS PRO_NUM
                   ,PV.PRNT_VND_NM AS WAREHOUSE_OR_SUPPLIER
                   ,CASE WHEN EAHW.ASN_SHIP_DT_TM_TS IS NOT NULL THEN #shipped# END AS SHPG_STS_DESC_TXT
                   ,PO.DS_PO_TP_NM AS PRCH_REQ_TP_DESC_TXT
                   ,CASE WHEN TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD') &lt; 0 THEN 0
                         ELSE TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD')
                    END AS AGE
                   ,PD.MDSE_CD
                   ,RD.RWS_NUM
                FROM
                   PO              PO
                  ,PO_DTL          PD
                  ,PRNT_VND        PV
                  ,RWS_HDR         RH
                  ,RWS_DTL         RD
                  ,EDI_ASN_HDR_WRK EAHW
                  ,CAIH            CAIH
                WHERE
                  PO.GLBL_CMPY_CD        = #glblCmpyCd#
              AND PO.PO_QLFY_CD          = #poQlfyCdTech#
              <isNotNull property="poOrdSrcCd">
              AND PO.PO_ORD_SRC_CD   NOT IN
              <iterate property="poOrdSrcCd" var="poOrdSrcCd[]" open="(" close=")" conjunction=",">
                  #poOrdSrcCd[]#
              </iterate>
              </isNotNull>
              AND PO.GLBL_CMPY_CD        = PV.GLBL_CMPY_CD(+)
              AND PO.PRNT_VND_CD         = PV.PRNT_VND_CD(+)
              <isNotNull property="dsPoTpCd">
              AND PO.DS_PO_TP_CD    NOT IN
              <iterate property="dsPoTpCd" var="dsPoTpCd[]" open="(" close=")" conjunction=",">
                  #dsPoTpCd[]#
              </iterate>
              </isNotNull>
              AND PO.PO_ORD_NUM          = PD.PO_ORD_NUM
              <isNotNull property="poStsCd">
              AND PD.PO_STS_CD      NOT IN
              <iterate property="poStsCd" var="poStsCd[]" open="(" close=")" conjunction=",">
                  #poStsCd[]#
              </iterate>
              </isNotNull>
              <isNotNull property="rqstTechTocCd">
                  AND PO.RQST_TECH_TOC_CD = #rqstTechTocCd#
              </isNotNull>
              <isNotNull property="destRtlWhCd">
                  AND PO.DEST_RTL_WH_CD  =      #destRtlWhCd#
              </isNotNull>
              AND PD.TRX_REF_LINE_NUM     IS NULL
              AND PD.TRX_REF_LINE_SUB_NUM IS NULL
              AND PO.GLBL_CMPY_CD        = RH.GLBL_CMPY_CD
              AND PD.PO_ORD_NUM          = RH.PO_RCV_TRX_HDR_NUM
              AND PD.PO_ORD_DTL_LINE_NUM = RD.PO_RCV_TRX_LINE_NUM
              AND RH.GLBL_CMPY_CD        = RD.GLBL_CMPY_CD
              AND RH.RWS_NUM             = RD.RWS_NUM
              AND RH.GLBL_CMPY_CD        = EAHW.GLBL_CMPY_CD(+)
              AND RH.RWS_NUM             = EAHW.RWS_NUM(+)
              AND PD.PO_ORD_NUM          = CAIH.PO_NUM(+)
              AND PD.PO_ORD_DTL_LINE_NUM = CAIH.PO_ORD_DTL_LINE_NUM(+) 
              AND EXISTS(SELECT 1 FROM RWS_HDR RH2 WHERE RH.GLBL_CMPY_CD = RH2.GLBL_CMPY_CD AND RH.RWS_NUM = RH2.RWS_NUM AND RH2.RWS_STS_CD IN(#printed#, #receiving#) AND RH2.EZCANCELFLAG = '0')
              AND PO.EZCANCELFLAG        = '0'
              AND PD.EZCANCELFLAG        = '0'
              AND PV.EZCANCELFLAG(+)     = '0'
              AND RH.EZCANCELFLAG        = '0'
              AND RD.EZCANCELFLAG        = '0'
        )
        SELECT
                COUNT(*) AS CNT_OPEN_ORDR
        FROM
            (SELECT
                H1.PRCH_REQ_NUM
                ,H1.SO_NUM
                ,H1.SHIP_DATE
                ,H1.PROCR_TP_CD
                ,H1.PRO_NUM
                ,H1.WAREHOUSE_OR_SUPPLIER
                ,H1.SHPG_STS_DESC_TXT
                ,H1.PRCH_REQ_TP_DESC_TXT
                ,H1.AGE
                ,H1.MDSE_CD
                ,H1.RWS_NUM
            FROM
                PR_H1 H1
            WHERE (H1.SO_NUM IS NOT NULL OR H1.RWS_NUM IS NOT NULL)
            GROUP BY
                H1.PRCH_REQ_NUM
                ,H1.SO_NUM
                ,H1.SHIP_DATE
                ,H1.PROCR_TP_CD
                ,H1.PRO_NUM
                ,H1.WAREHOUSE_OR_SUPPLIER
                ,H1.SHPG_STS_DESC_TXT
                ,H1.PRCH_REQ_TP_DESC_TXT
                ,H1.AGE
                ,H1.MDSE_CD
                ,H1.RWS_NUM
            ) T1
        WHERE
            1 = 1
        AND AGE &gt; #thresholdOpenOrderDays#
        AND (SO_NUM IS NOT NULL AND RWS_NUM IS NOT NULL)
    </statement>
    <statement id="getTechnicianLocation" parameterClass="Map"
        resultClass="Map">
        SELECT
            RS.INVTY_LOC_CD
            ,RW.RTL_WH_CD
            ,RW.LOC_TP_CD
            ,RS.RTL_SWH_CD
            ,RW.TECH_TOC_CD
        FROM
            TECH_LOC TL
            ,RTL_SWH RS
            ,RTL_WH  RW
        WHERE
                TL.GLBL_CMPY_CD                        =  #glblCmpyCd#
            <!-- QC#28755 MOD START -->
            <!-- AND TL.TECH_TOC_CD                         =  #techTocCd# -->
            <isNotNull property="techTocCd">
                AND TL.TECH_TOC_CD                     =  #techTocCd#
            </isNotNull>
            <!-- QC#28755 MOD END -->
            AND TL.EFF_FROM_DT                     &lt;=  #salesDate#
            AND NVL(TL.EFF_THRU_DT, '99991231')    &gt;=  #salesDate#
            AND TL.TECH_LOC_CD                         =  RS.INVTY_LOC_CD
            AND TL.GLBL_CMPY_CD                        =  RS.GLBL_CMPY_CD
            AND RS.RTL_WH_CD                           =  RW.RTL_WH_CD
            AND RS.GLBL_CMPY_CD                        =  RW.GLBL_CMPY_CD
            <!-- QC#28755 ADD START -->
            <isNotNull property="rtlWhCd">
                AND RW.RTL_WH_CD                       =  #rtlWhCd#
            </isNotNull>
            <!-- QC#28755 ADD END -->
            AND RW.LOC_TP_CD                          IN
            <iterate property="locTpCd" var="locTpCd[]" open="(" close=")" conjunction=",">
                #locTpCd[]#
            </iterate>
            AND RW.EFF_FROM_DT                     &lt;=  #salesDate#
            AND NVL(RW.EFF_THRU_DT, '99991231')    &gt;=  #salesDate#
            AND TL.EZCANCELFLAG                        =  '0'
            AND RS.EZCANCELFLAG                        =  '0'
            AND RW.EZCANCELFLAG                        =  '0'
        GROUP BY
            RW.RTL_WH_CD
            ,RS.RTL_SWH_CD
            ,RW.LOC_TP_CD
            ,RS.INVTY_LOC_CD
            ,RW.TECH_TOC_CD
        ORDER BY
            RS.INVTY_LOC_CD ASC
    </statement>
    <statement id="search" parameterClass="Map" resultMap="result.NLCL0620_ASMsg">
        WITH CAIH AS(
            SELECT
                CAIH.AP_VND_INV_NUM
               ,CAIH.INV_DT
               ,CAIH.PO_NUM
               ,CAID.PO_ORD_DTL_LINE_NUM
            FROM
                CM_AP_INV_HDR CAIH
               ,CM_AP_INV_DTL CAID 
            WHERE
                CAIH.GLBL_CMPY_CD  = #glblCmpyCd#
            AND CAIH.ACCT_INV_STS_CD   = #entered#
            AND CAIH.AP_VND_CD         = CAID.AP_VND_CD
            AND CAIH.AP_VND_INV_NUM    = CAID.AP_VND_INV_NUM
            AND CAIH.AP_VND_INV_SQ_NUM = CAID.AP_VND_INV_SQ_NUM
            AND CAIH.EZCANCELFLAG   = '0'
            AND CAID.EZCANCELFLAG   = '0'
        ),PR_H1 AS (
                SELECT /* Open Tech PR */
                    PRD.PRCH_REQ_NUM
                    ,NVL(PRD.SO_NUM, RH.RWS_REF_NUM) AS SO_NUM
                    ,CASE
                        WHEN PRD2.PO_ORD_NUM IS NULL
                            THEN SUBSTR(PRD.SHIP_DT_TM_TS,1,8)
                        ELSE (
                            SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8)
                        )
                     END AS SHIP_DATE
                    ,PRD.PROCR_TP_CD
                    ,NVL(PRD.PRO_NUM, RH.IMPT_INV_BOL_NUM) AS PRO_NUM
                    ,CASE
                        WHEN PRD.PROCR_TP_CD = #procrTpCd1# THEN PV.PRNT_VND_NM
                        WHEN PRD.PROCR_TP_CD = #procrTpCd2# THEN RW.RTL_WH_NM
                        ELSE NULL END AS WAREHOUSE_OR_SUPPLIER
                    ,CASE WHEN SS.SHPG_STS_DESC_TXT IS NOT NULL THEN SS.SHPG_STS_DESC_TXT
                          WHEN EAHW.RWS_NUM IS NOT NULL THEN #shipped# 
                     END AS SHPG_STS_DESC_TXT
                    ,PRT.PRCH_REQ_TP_DESC_TXT
                    ,CASE 
                        WHEN PRD2.PO_ORD_NUM IS NULL
                            THEN TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(PRD.SHIP_DT_TM_TS,1,8), #physInvtyDt#), 'YYYYMMDD')
                        ELSE (
                            CASE WHEN TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD') &lt; 0 THEN 0
                                 ELSE TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD')
                            END
                        )
                     END AS AGE
                    ,PRD.MDSE_CD
                    ,RD.RWS_NUM
                    <!-- QC#56979 ADD START -->
                    <!-- START 2021/09/29 R.Azucena [QC#59216, MOD] -->
                    <!-- ,CU.CARR_TRK_URL -->
                    ,CASE
                        WHEN WIT_LTST.CARR_ENC_TRK_URL IS NOT NULL THEN WIT_LTST.CARR_ENC_TRK_URL
                        ELSE CU.CARR_TRK_URL
                     END AS CARR_TRK_URL
                    <!-- END 2021/09/29 R.Azucena [QC#59216, MOD] -->
                    <!-- QC#56979 ADD END -->
                FROM
                    PRCH_REQ        PR
                    ,PRCH_REQ_DTL   PRD
                    ,SHPG_ORD       SO
                    ,PRCH_REQ_STS   PRS
                    ,PRCH_REQ_TP    PRT
                    ,RTL_WH         RW
                    ,PRNT_VND       PV
                    ,SHPG_STS       SS
                    ,EDI_ASN_HDR_WRK EAHW
                    ,RWS_HDR RH
                    ,RWS_DTL        RD
                    ,PRCH_REQ_DTL   PRD2
                    ,CAIH CAIH
                    <!-- QC#56979 ADD START -->
                    ,CARR_URL       CU
                    <!-- QC#56979 ADD END -->
                    <!-- START 2021/09/29 R.Azucena [QC#59216, ADD] -->
                    ,(
                        SELECT
                            WIT_LTST.OTBD_ORD_NUM
                           ,WIT_LTST.GLBL_CMPY_CD
                           ,WIT_LTST.CARR_ENC_TRK_URL
                           ,WIT_LTST.EZCANCELFLAG
                        FROM
                          (
                              SELECT
                                 WIT.OTBD_ORD_NUM
                                ,WIT.GLBL_CMPY_CD
                                ,WIT.CARR_ENC_TRK_URL
                                ,WIT.EZCANCELFLAG
                                ,RANK() OVER(PARTITION BY WIT.OTBD_ORD_NUM ORDER BY WIT.WMS_INBD_TRX_PK DESC) RANK_REQ
                              FROM
                                 WMS_INBD_TRX WIT
                          ) WIT_LTST
                        WHERE
                            WIT_LTST.RANK_REQ = 1
                    ) WIT_LTST
                    <!-- END 2021/09/29 R.Azucena [QC#59216, ADD] -->
                WHERE
                        PR.GLBL_CMPY_CD                        =      #glblCmpyCd#
                    AND PR.PRCH_REQ_REC_TP_CD                  =      #prchReqRecTpCd#
                    <isNotNull property="rqstTechTocCd">
                        AND PR.RQST_TECH_TOC_CD                =      #rqstTechTocCd#
                    </isNotNull>
                    AND PR.PRCH_REQ_NUM                        =      PRD.PRCH_REQ_NUM
                    AND PR.GLBL_CMPY_CD                        =      PRD.GLBL_CMPY_CD
                    <isNotNull property="destRtlWhCd">
                        AND PRD.DEST_RTL_WH_CD                 =      #destRtlWhCd#
                    </isNotNull>
                    <!-- START 2021/09/29 R.Azucena [QC#59216, MOD] -->
                    <!-- AND ( -->
                    <!--   (PR.PRCH_REQ_SRC_TP_CD            &lt;&gt;      #choiceShipConfirmation# -->
                    <!--     AND PRD.PRCH_REQ_LINE_SUB_NUM   &lt;&gt;      #prchReqLineSubNum#) -->
                    <!--   OR (PR.PRCH_REQ_SRC_TP_CD                =      #choiceShipConfirmation# -->
                    <!--     AND PRD.PRCH_REQ_LINE_SUB_NUM          =      #prchReqLineSubNum#) -->
                    <!-- ) -->
                    <isNotNull property="shipConfirmationCdArray">
                        AND (
                          (PR.PRCH_REQ_SRC_TP_CD NOT IN
                              <iterate property="shipConfirmationCdArray" var="shipConfirmationCdArray[]" open="(" close=")" conjunction=",">
                                  #shipConfirmationCdArray[]#
                              </iterate>
                            AND PRD.PRCH_REQ_LINE_SUB_NUM     &lt;&gt;     #prchReqLineSubNum#)
                          OR (PR.PRCH_REQ_SRC_TP_CD IN
                              <iterate property="shipConfirmationCdArray" var="shipConfirmationCdArray[]" open="(" close=")" conjunction=",">
                                  #shipConfirmationCdArray[]#
                              </iterate>
                            AND PRD.PRCH_REQ_LINE_SUB_NUM      =      #prchReqLineSubNum#)
                        )
                    </isNotNull>
                    <!-- END 2021/09/29 R.Azucena [QC#59216, MOD] -->
                    AND PRD.PRCH_REQ_LINE_STS_CD              !=      #cancel#
                    AND PRD.SO_NUM                             =      SO.SO_NUM(+)
                    AND PRD.GLBL_CMPY_CD                       =      SO.GLBL_CMPY_CD(+)
                    AND PR.PRCH_REQ_STS_CD                     =      PRS.PRCH_REQ_STS_CD
                    AND PR.GLBL_CMPY_CD                        =      PRS.GLBL_CMPY_CD
                    AND PRS.OPEN_STS_FLG                       =      #openStsFlg#
                    AND PR.PRCH_REQ_TP_CD                      =      PRT.PRCH_REQ_TP_CD(+)
                    AND PR.GLBL_CMPY_CD                        =      PRT.GLBL_CMPY_CD(+)
                    AND PRD.SRC_RTL_WH_CD                      =      RW.RTL_WH_CD(+)
                    AND PRD.GLBL_CMPY_CD                       =      RW.GLBL_CMPY_CD(+)
                    AND PRD.PRNT_VND_CD                        =      PV.PRNT_VND_CD(+)
                    AND PRD.GLBL_CMPY_CD                       =      PV.GLBL_CMPY_CD(+)
                    AND SO.SHPG_STS_CD                         =      SS.SHPG_STS_CD(+)
                    AND SO.GLBL_CMPY_CD                        =      SS.GLBL_CMPY_CD(+)
                    AND PRD.GLBL_CMPY_CD                       =      RD.GLBL_CMPY_CD(+)
                    AND PRD.PRCH_REQ_NUM                       =      RD.PRCH_REQ_NUM(+)
                    AND PRD.PRCH_REQ_LINE_NUM                  =      RD.PRCH_REQ_LINE_NUM(+)
                    AND PRD.PRCH_REQ_LINE_SUB_NUM              =      RD.PRCH_REQ_LINE_SUB_NUM(+)
                    AND RD.GLBL_CMPY_CD                        =      RH.GLBL_CMPY_CD(+)
                    AND RD.RWS_NUM                             =      RH.RWS_NUM(+)
                    AND RH.GLBL_CMPY_CD                        =      EAHW.GLBL_CMPY_CD(+)
                    AND RH.RWS_NUM                             =      EAHW.RWS_NUM(+)
                    AND PRD.GLBL_CMPY_CD                       =      PRD2.GLBL_CMPY_CD(+)
                    AND PRD.PRCH_REQ_NUM                       =      PRD2.TRX_REF_NUM(+)
                    AND PRD.PRCH_REQ_LINE_NUM                  =      PRD2.TRX_REF_LINE_NUM(+)
                    AND PRD.PRCH_REQ_LINE_SUB_NUM              =      PRD2.TRX_REF_LINE_SUB_NUM(+)
                    AND PRD2.PO_ORD_NUM                        =      CAIH.PO_NUM(+)
                    AND PRD2.PO_ORD_DTL_LINE_NUM               =      CAIH.PO_ORD_DTL_LINE_NUM(+)
                    <!-- QC#56979 ADD START -->
                    AND PRD.GLBL_CMPY_CD                       =      CU.GLBL_CMPY_CD(+)
                    AND PRD.CARR_CD                            =      CU.VND_CD(+)
                    AND RD.CARR_CD                             =      CU.VND_CD(+)
                    <!-- QC#56979 ADD END -->
                    <!-- START 2021/09/29 R.Azucena [QC#59216, ADD] -->
                    AND PRD.GLBL_CMPY_CD                       =      WIT_LTST.GLBL_CMPY_CD(+)
                    AND PRD.SO_NUM                             =      WIT_LTST.OTBD_ORD_NUM(+)
                    <!-- END 2021/09/29 R.Azucena [QC#59216, ADD] -->
                    AND (EXISTS(SELECT 1 FROM RWS_HDR RH2 WHERE RH.GLBL_CMPY_CD = RH2.GLBL_CMPY_CD AND RH.RWS_NUM = RH2.RWS_NUM AND RH2.RWS_STS_CD IN(#printed#, #receiving#) AND RH2.EZCANCELFLAG = '0') OR RH.RWS_NUM IS NULL)
                    AND PR.EZCANCELFLAG                        =      '0'
                    AND PRD.EZCANCELFLAG                       =      '0'
                    AND SO.EZCANCELFLAG(+)                     =      '0'
                    AND PRS.EZCANCELFLAG                       =      '0'
                    AND PRT.EZCANCELFLAG(+)                    =      '0'
                    AND RW.EZCANCELFLAG(+)                     =      '0'
                    AND PV.EZCANCELFLAG(+)                     =      '0'
                    AND SS.EZCANCELFLAG(+)                     =      '0'
                    AND EAHW.EZCANCELFLAG(+)                   =      '0'
                    AND RD.EZCANCELFLAG(+)                     =      '0'
                    AND RH.EZCANCELFLAG(+)                     =      '0'
                    AND PRD2.EZCANCELFLAG(+)                   =      '0'
                    <!-- QC#56979 ADD START -->
                    AND CU.EZCANCELFLAG(+)                     =      '0'
                    <!-- QC#56979 ADD END -->
                    <!-- START 2021/09/29 R.Azucena [QC#59216, ADD] -->
                    AND WIT_LTST.EZCANCELFLAG(+)               =      '0'
                    <!-- END 2021/09/29 R.Azucena [QC#59216, ADD] -->
                UNION ALL
                SELECT  /* Open PO */
                    PO.PO_ORD_NUM AS PRCH_REQ_NUM
                   ,RH.RWS_REF_NUM AS SO_NUM
                   ,SUBSTR(EAHW.ASN_SHIP_DT_TM_TS ,1,8) AS SHIP_DATE
                   ,#procrTpCd1# AS PROCR_TP_CD
                   ,RH.IMPT_INV_BOL_NUM AS PRO_NUM
                   ,PV.PRNT_VND_NM AS WAREHOUSE_OR_SUPPLIER
                   ,CASE WHEN EAHW.ASN_SHIP_DT_TM_TS IS NOT NULL THEN #shipped# END AS SHPG_STS_DESC_TXT
                   ,PO.DS_PO_TP_NM AS PRCH_REQ_TP_DESC_TXT
                   ,CASE WHEN TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD') &lt; 0 THEN 0
                         ELSE TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD')
                    END AS AGE
                   ,PD.MDSE_CD
                   ,RD.RWS_NUM
                   <!-- QC#56979 ADD START -->
                   ,CU.CARR_TRK_URL
                   <!-- QC#56979 ADD END -->
               FROM
                   PO              PO
                  ,PO_DTL          PD
                  ,PRNT_VND        PV
                  ,RWS_HDR         RH
                  ,RWS_DTL         RD
                  ,EDI_ASN_HDR_WRK EAHW
                  ,CAIH            CAIH
                  <!-- QC#56979 ADD START -->
                  ,CARR_URL        CU
                  <!-- QC#56979 ADD END -->
              WHERE
                  PO.GLBL_CMPY_CD        = #glblCmpyCd#
              AND PO.PO_QLFY_CD          = #poQlfyCdTech#
              <isNotNull property="poOrdSrcCd">
              AND PO.PO_ORD_SRC_CD      IN
              <iterate property="poOrdSrcCd" var="poOrdSrcCd[]" open="(" close=")" conjunction=",">
                  #poOrdSrcCd[]#
              </iterate>
              </isNotNull>
              AND PO.GLBL_CMPY_CD        = PV.GLBL_CMPY_CD(+)
              AND PO.PRNT_VND_CD         = PV.PRNT_VND_CD(+)
              <isNotNull property="dsPoTpCd">
              AND PO.DS_PO_TP_CD    NOT IN
              <iterate property="dsPoTpCd" var="dsPoTpCd[]" open="(" close=")" conjunction=",">
                  #dsPoTpCd[]#
              </iterate>
              </isNotNull>
              AND PO.PO_ORD_NUM          = PD.PO_ORD_NUM
              <isNotNull property="poStsCd">
              AND PD.PO_STS_CD      NOT IN
              <iterate property="poStsCd" var="poStsCd[]" open="(" close=")" conjunction=",">
                  #poStsCd[]#
              </iterate>
              </isNotNull>
              <isNotNull property="rqstTechTocCd">
                  AND PO.RQST_TECH_TOC_CD = #rqstTechTocCd#
              </isNotNull>
              <isNotNull property="destRtlWhCd">
                  AND PO.DEST_RTL_WH_CD  =      #destRtlWhCd#
              </isNotNull>
              AND PO.GLBL_CMPY_CD        = RH.GLBL_CMPY_CD
              AND PD.PO_ORD_NUM          = RH.PO_RCV_TRX_HDR_NUM
              AND PD.PO_ORD_DTL_LINE_NUM = RD.PO_RCV_TRX_LINE_NUM
              AND RH.GLBL_CMPY_CD        = RD.GLBL_CMPY_CD
              AND RH.RWS_NUM             = RD.RWS_NUM
              AND RH.GLBL_CMPY_CD        = EAHW.GLBL_CMPY_CD(+)
              AND RH.RWS_NUM             = EAHW.RWS_NUM(+)
              AND PD.PO_ORD_NUM          = CAIH.PO_NUM(+)
              AND PD.PO_ORD_DTL_LINE_NUM = CAIH.PO_ORD_DTL_LINE_NUM(+)
              <!-- QC#56979 ADD START -->
              AND RD.GLBL_CMPY_CD        = CU.GLBL_CMPY_CD(+)
              AND RD.CARR_CD             = CU.VND_CD(+)
              <!-- QC#56979 ADD END -->
              AND EXISTS(SELECT 1 FROM RWS_HDR RH2 WHERE RH.GLBL_CMPY_CD = RH2.GLBL_CMPY_CD AND RH.RWS_NUM = RH2.RWS_NUM AND RH2.RWS_STS_CD IN(#printed#, #receiving#) AND RH2.EZCANCELFLAG = '0')
              AND PO.EZCANCELFLAG        = '0'
              AND PD.EZCANCELFLAG        = '0'
              AND PV.EZCANCELFLAG(+)     = '0'
              AND RH.EZCANCELFLAG        = '0'
              AND RD.EZCANCELFLAG        = '0'
              <!-- QC#56979 ADD START -->
              AND CU.EZCANCELFLAG(+)     = '0'
              <!-- QC#56979 ADD END -->
              UNION ALL
                SELECT
                    PO.PO_ORD_NUM AS PRCH_REQ_NUM
                   ,RH.RWS_REF_NUM AS SO_NUM
                   ,SUBSTR(EAHW.ASN_SHIP_DT_TM_TS ,1,8) AS SHIP_DATE
                   ,#procrTpCd1# AS PROCR_TP_CD
                   ,RH.IMPT_INV_BOL_NUM AS PRO_NUM
                   ,PV.PRNT_VND_NM AS WAREHOUSE_OR_SUPPLIER
                   ,CASE WHEN EAHW.ASN_SHIP_DT_TM_TS IS NOT NULL THEN #shipped# END AS SHPG_STS_DESC_TXT
                   ,PO.DS_PO_TP_NM AS PRCH_REQ_TP_DESC_TXT
                   ,CASE WHEN TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD') &lt; 0 THEN 0
                         ELSE TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD')
                    END AS AGE
                   ,PD.MDSE_CD
                   ,RD.RWS_NUM
                   <!-- QC#56979 ADD START -->
                   ,CU.CARR_TRK_URL
                   <!-- QC#56979 ADD END -->
                FROM
                   PO              PO
                  ,PO_DTL          PD
                  ,PRNT_VND        PV
                  ,RWS_HDR         RH
                  ,RWS_DTL         RD
                  ,EDI_ASN_HDR_WRK EAHW
                  ,CAIH            CAIH
                  <!-- QC#56979 ADD START -->
                  ,CARR_URL        CU
                  <!-- QC#56979 ADD END -->
                WHERE
                  PO.GLBL_CMPY_CD        = #glblCmpyCd#
              AND PO.PO_QLFY_CD          = #poQlfyCdTech#
              <isNotNull property="poOrdSrcCd">
              AND PO.PO_ORD_SRC_CD   NOT IN
              <iterate property="poOrdSrcCd" var="poOrdSrcCd[]" open="(" close=")" conjunction=",">
                  #poOrdSrcCd[]#
              </iterate>
              </isNotNull>
              AND PO.GLBL_CMPY_CD        = PV.GLBL_CMPY_CD(+)
              AND PO.PRNT_VND_CD         = PV.PRNT_VND_CD(+)
              <isNotNull property="dsPoTpCd">
              AND PO.DS_PO_TP_CD    NOT IN
              <iterate property="dsPoTpCd" var="dsPoTpCd[]" open="(" close=")" conjunction=",">
                  #dsPoTpCd[]#
              </iterate>
              </isNotNull>
              AND PO.PO_ORD_NUM          = PD.PO_ORD_NUM
              <isNotNull property="poStsCd">
              AND PD.PO_STS_CD      NOT IN
              <iterate property="poStsCd" var="poStsCd[]" open="(" close=")" conjunction=",">
                  #poStsCd[]#
              </iterate>
              </isNotNull>
              <isNotNull property="rqstTechTocCd">
                  AND PO.RQST_TECH_TOC_CD = #rqstTechTocCd#
              </isNotNull>
              <isNotNull property="destRtlWhCd">
                  AND PO.DEST_RTL_WH_CD  =      #destRtlWhCd#
              </isNotNull>
              AND PD.TRX_REF_LINE_NUM     IS NULL
              AND PD.TRX_REF_LINE_SUB_NUM IS NULL
              AND PO.GLBL_CMPY_CD        = RH.GLBL_CMPY_CD
              AND PD.PO_ORD_NUM          = RH.PO_RCV_TRX_HDR_NUM
              AND PD.PO_ORD_DTL_LINE_NUM = RD.PO_RCV_TRX_LINE_NUM
              AND RH.GLBL_CMPY_CD        = RD.GLBL_CMPY_CD
              AND RH.RWS_NUM             = RD.RWS_NUM
              AND RH.GLBL_CMPY_CD        = EAHW.GLBL_CMPY_CD(+)
              AND RH.RWS_NUM             = EAHW.RWS_NUM(+)
              AND PD.PO_ORD_NUM          = CAIH.PO_NUM(+)
              AND PD.PO_ORD_DTL_LINE_NUM = CAIH.PO_ORD_DTL_LINE_NUM(+)
              <!-- QC#56979 ADD START -->
              AND RD.GLBL_CMPY_CD        = CU.GLBL_CMPY_CD(+)
              AND RD.CARR_CD             = CU.VND_CD(+)
              <!-- QC#56979 ADD END -->
              AND EXISTS(SELECT 1 FROM RWS_HDR RH2 WHERE RH.GLBL_CMPY_CD = RH2.GLBL_CMPY_CD AND RH.RWS_NUM = RH2.RWS_NUM AND RH2.RWS_STS_CD IN(#printed#, #receiving#) AND RH2.EZCANCELFLAG = '0')
              AND PO.EZCANCELFLAG        = '0'
              AND PD.EZCANCELFLAG        = '0'
              AND PV.EZCANCELFLAG(+)     = '0'
              AND RH.EZCANCELFLAG        = '0'
              AND RD.EZCANCELFLAG        = '0'
              <!-- QC#56979 ADD START -->
              AND CU.EZCANCELFLAG(+)     = '0'
              <!-- QC#56979 ADD END -->
        )
        SELECT
                T1.PRCH_REQ_NUM
                ,T1.SO_NUM
                ,T1.SHIP_DATE
                ,T1.PROCR_TP_CD
                ,T1.PRO_NUM
                ,T1.WAREHOUSE_OR_SUPPLIER
                ,T1.SHPG_STS_DESC_TXT
                ,T1.PRCH_REQ_TP_DESC_TXT
                ,T1.AGE
                ,T1.MDSE_CD
                ,T1.RWS_NUM
                <!-- QC#56979 ADD START -->
                ,T1.CARR_TRK_URL
                <!-- QC#56979 ADD END -->
        FROM
            (SELECT
                H1.PRCH_REQ_NUM
                ,H1.SO_NUM
                ,H1.SHIP_DATE
                ,H1.PROCR_TP_CD
                ,H1.PRO_NUM
                ,H1.WAREHOUSE_OR_SUPPLIER
                ,H1.SHPG_STS_DESC_TXT
                ,H1.PRCH_REQ_TP_DESC_TXT
                ,H1.AGE
                ,H1.MDSE_CD
                ,H1.RWS_NUM
                <!-- QC#56979 ADD START -->
                ,H1.CARR_TRK_URL
                <!-- QC#56979 ADD END -->
            FROM
                PR_H1 H1
            WHERE (H1.SO_NUM IS NOT NULL OR H1.RWS_NUM IS NOT NULL)
            GROUP BY
                H1.PRCH_REQ_NUM
                ,H1.SO_NUM
                ,H1.SHIP_DATE
                ,H1.PROCR_TP_CD
                ,H1.PRO_NUM
                ,H1.WAREHOUSE_OR_SUPPLIER
                ,H1.SHPG_STS_DESC_TXT
                ,H1.PRCH_REQ_TP_DESC_TXT
                ,H1.AGE
                ,H1.MDSE_CD
                ,H1.RWS_NUM
                <!-- QC#56979 ADD START -->
                ,H1.CARR_TRK_URL
                <!-- QC#56979 ADD END -->
            ORDER BY
                H1.PRCH_REQ_NUM
                ,H1.SO_NUM
                ,H1.SHIP_DATE
                ,H1.PROCR_TP_CD
                ,H1.PRO_NUM
                ,H1.WAREHOUSE_OR_SUPPLIER
                ,H1.SHPG_STS_DESC_TXT
                ,H1.PRCH_REQ_TP_DESC_TXT
                ,H1.AGE
                ,H1.MDSE_CD
                ,H1.RWS_NUM
                <!-- QC#56979 ADD START -->
                ,H1.CARR_TRK_URL
                <!-- QC#56979 ADD END -->
            ) T1
        WHERE
                ROWNUM         &lt;=       #maxRownum#
    </statement>
    <resultMap id="result.NLCL0620_ASMsg" class="NLCL0620_ASMsg">
        <result property="prchReqNum_A1"                 column="PRCH_REQ_NUM"                  javaType="EZDSStringItem"/>
        <result property="prchReqTpDescTxt_A1"           column="PRCH_REQ_TP_DESC_TXT"          javaType="EZDSStringItem"/>
        <result property="rwsRefNum_A1"                      column="SO_NUM"                    javaType="EZDSStringItem"/>
        <result property="shipDt_A1"                     column="SHIP_DATE"                     javaType="EZDCDateItem"/>
        <result property="xxScrItem61Txt_A1"             column="WAREHOUSE_OR_SUPPLIER"         javaType="EZDSStringItem"/>
        <result property="proNum_A1"                     column="PRO_NUM"                       javaType="EZDSStringItem"/>
        <result property="shpgStsDescTxt_A1"             column="SHPG_STS_DESC_TXT"             javaType="EZDSStringItem"/>
        <result property="xxScrItem19Txt_A1"             column="AGE"                           javaType="EZDSStringItem"/>
<!-- START 2019/12/17 T.Ogura [QC#54986,ADD] -->
        <result property="mdseCd_A1"                     column="MDSE_CD"                       javaType="EZDSStringItem"/>
        <result property="rwsNum_A1"                     column="RWS_NUM"                       javaType="EZDSStringItem"/>
<!-- END   2019/12/17 T.Ogura [QC#54986,ADD] -->
<!-- START 2020/06/25 [QC#56979,ADD] -->
        <result property="carrTrkUrl_A1"                 column="CARR_TRK_URL"                  javaType="EZDSStringItem"/>
<!-- END   2020/06/25 [QC#56979,ADD] -->
    </resultMap>

<!-- START 2019/12/17 T.Ogura [QC#54986,ADD] -->
    <statement id="getDownloadList" parameterClass="Map" resultMap="result.NLCL0620_FSMsg">
        WITH CAIH AS(
            SELECT
                CAIH.AP_VND_INV_NUM
               ,CAIH.INV_DT
               ,CAIH.PO_NUM
               ,CAID.PO_ORD_DTL_LINE_NUM
            FROM
                CM_AP_INV_HDR CAIH
               ,CM_AP_INV_DTL CAID 
            WHERE
                CAIH.GLBL_CMPY_CD  = #glblCmpyCd#
            AND CAIH.ACCT_INV_STS_CD   = #entered#
            AND CAIH.AP_VND_CD         = CAID.AP_VND_CD
            AND CAIH.AP_VND_INV_NUM    = CAID.AP_VND_INV_NUM
            AND CAIH.AP_VND_INV_SQ_NUM = CAID.AP_VND_INV_SQ_NUM
            AND CAIH.EZCANCELFLAG   = '0'
            AND CAID.EZCANCELFLAG   = '0'
        ),PR_H1 AS (
                SELECT
                    PR.RQST_TECH_TOC_CD
                    ,(SELECT TM.TECH_NM FROM TECH_MSTR TM WHERE TM.GLBL_CMPY_CD = PRD.GLBL_CMPY_CD AND TM.TECH_TOC_CD = PR.RQST_TECH_TOC_CD AND TM.EZCANCELFLAG = '0') AS RQST_TECH_TOC_NM
                    ,PRD.DEST_RTL_WH_CD
                    ,(SELECT RW.RTL_WH_NM FROM RTL_WH RW WHERE RW.GLBL_CMPY_CD = PRD.GLBL_CMPY_CD AND RW.RTL_WH_CD = PRD.DEST_RTL_WH_CD AND RW.EZCANCELFLAG = '0') AS DEST_RTL_WH_NM
                    ,#physInvtyDt# AS PHYS_INVTY_DT
                    ,PRD.PRCH_REQ_NUM
                    ,NVL(PRD.SO_NUM, RH.RWS_REF_NUM) AS SO_NUM
                    ,CASE
                        WHEN PRD2.PO_ORD_NUM IS NULL
                            THEN SUBSTR(PRD.SHIP_DT_TM_TS,1,8)
                        ELSE (
                            SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8)
                        )
                     END AS SHIP_DATE
                    ,PRD.PROCR_TP_CD
                    ,NVL(PRD.PRO_NUM, RH.IMPT_INV_BOL_NUM) AS PRO_NUM
                    ,CASE
                        WHEN PRD.PROCR_TP_CD = #procrTpCd1# THEN PV.PRNT_VND_NM
                        WHEN PRD.PROCR_TP_CD = #procrTpCd2# THEN RW.RTL_WH_NM
                        ELSE NULL 
                     END AS WAREHOUSE_OR_SUPPLIER
                    ,CASE WHEN SS.SHPG_STS_DESC_TXT IS NOT NULL THEN SS.SHPG_STS_DESC_TXT
                          WHEN EAHW.RWS_NUM IS NOT NULL THEN #shipped# 
                     END AS SHPG_STS_DESC_TXT
                    ,PRT.PRCH_REQ_TP_DESC_TXT
                    ,CASE 
                        WHEN PRD2.PO_ORD_NUM IS NULL
                            THEN TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(PRD.SHIP_DT_TM_TS,1,8), #physInvtyDt#), 'YYYYMMDD')
                        ELSE (
                            CASE WHEN TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD') &lt; 0 THEN 0
                                 ELSE TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD')
                            END
                        )
                     END AS AGE
                    ,PRD.MDSE_CD
                    ,(SELECT MDSE.MDSE_DESC_SHORT_TXT FROM ALL_MDSE_V MDSE WHERE PRD.GLBL_CMPY_CD = MDSE.GLBL_CMPY_CD AND PRD.MDSE_CD = MDSE.MDSE_CD AND MDSE.EZCANCELFLAG = '0') AS MDSE_DESC_SHORT_TXT
                    ,RD.RWS_NUM
                FROM
                    PRCH_REQ        PR
                    ,PRCH_REQ_DTL   PRD
                    ,SHPG_ORD       SO
                    ,PRCH_REQ_STS   PRS
                    ,PRCH_REQ_TP    PRT
                    ,RTL_WH         RW
                    ,PRNT_VND       PV
                    ,SHPG_STS       SS
                    ,EDI_ASN_HDR_WRK EAHW
                    ,RWS_HDR RH
                    ,RWS_DTL        RD
                    ,PRCH_REQ_DTL   PRD2
                    ,CAIH CAIH
                WHERE
                        PR.GLBL_CMPY_CD                        =      #glblCmpyCd#
                    AND PR.PRCH_REQ_REC_TP_CD                  =      #prchReqRecTpCd#
                    <isNotNull property="rqstTechTocCd">
                        AND PR.RQST_TECH_TOC_CD                =      #rqstTechTocCd#
                    </isNotNull>
                    AND PR.PRCH_REQ_NUM                        =      PRD.PRCH_REQ_NUM
                    AND PR.GLBL_CMPY_CD                        =      PRD.GLBL_CMPY_CD
                    <isNotNull property="destRtlWhCd">
                        AND PRD.DEST_RTL_WH_CD                 =      #destRtlWhCd#
                    </isNotNull>
                    <!-- START 2021/09/29 R.Azucena [QC#59216, MOD] -->
                    <!-- AND ( -->
                    <!--   (PR.PRCH_REQ_SRC_TP_CD            &lt;&gt;      #choiceShipConfirmation# -->
                    <!--     AND PRD.PRCH_REQ_LINE_SUB_NUM   &lt;&gt;      #prchReqLineSubNum#) -->
                    <!--   OR (PR.PRCH_REQ_SRC_TP_CD                =      #choiceShipConfirmation# -->
                    <!--     AND PRD.PRCH_REQ_LINE_SUB_NUM          =      #prchReqLineSubNum#) -->
                    <!-- ) -->
                    <isNotNull property="shipConfirmationCdArray">
                        AND (
                          (PR.PRCH_REQ_SRC_TP_CD NOT IN
                              <iterate property="shipConfirmationCdArray" var="shipConfirmationCdArray[]" open="(" close=")" conjunction=",">
                                  #shipConfirmationCdArray[]#
                              </iterate>
                            AND PRD.PRCH_REQ_LINE_SUB_NUM     &lt;&gt;     #prchReqLineSubNum#)
                          OR (PR.PRCH_REQ_SRC_TP_CD IN
                              <iterate property="shipConfirmationCdArray" var="shipConfirmationCdArray[]" open="(" close=")" conjunction=",">
                                  #shipConfirmationCdArray[]#
                              </iterate>
                            AND PRD.PRCH_REQ_LINE_SUB_NUM      =      #prchReqLineSubNum#)
                        )
                    </isNotNull>
                    <!-- END 2021/09/29 R.Azucena [QC#59216, MOD] -->
                    AND PRD.PRCH_REQ_LINE_STS_CD              !=      #cancel#
                                        AND PRD.SO_NUM                             =      SO.SO_NUM(+)
                    AND PRD.GLBL_CMPY_CD                       =      SO.GLBL_CMPY_CD(+)
                    AND PR.PRCH_REQ_STS_CD                     =      PRS.PRCH_REQ_STS_CD
                    AND PR.GLBL_CMPY_CD                        =      PRS.GLBL_CMPY_CD
                    AND PRS.OPEN_STS_FLG                       =      #openStsFlg#
                    AND PR.PRCH_REQ_TP_CD                      =      PRT.PRCH_REQ_TP_CD(+)
                    AND PR.GLBL_CMPY_CD                        =      PRT.GLBL_CMPY_CD(+)
                    AND PRD.SRC_RTL_WH_CD                      =      RW.RTL_WH_CD(+)
                    AND PRD.GLBL_CMPY_CD                       =      RW.GLBL_CMPY_CD(+)
                    AND PRD.PRNT_VND_CD                        =      PV.PRNT_VND_CD(+)
                    AND PRD.GLBL_CMPY_CD                       =      PV.GLBL_CMPY_CD(+)
                    AND SO.SHPG_STS_CD                         =      SS.SHPG_STS_CD(+)
                    AND SO.GLBL_CMPY_CD                        =      SS.GLBL_CMPY_CD(+)
                    AND PRD.GLBL_CMPY_CD                       =      RD.GLBL_CMPY_CD(+)
                    AND PRD.PRCH_REQ_NUM                       =      RD.PRCH_REQ_NUM(+)
                    AND PRD.PRCH_REQ_LINE_NUM                  =      RD.PRCH_REQ_LINE_NUM(+)
                    AND PRD.PRCH_REQ_LINE_SUB_NUM              =      RD.PRCH_REQ_LINE_SUB_NUM(+)
                    AND RD.GLBL_CMPY_CD                        =      RH.GLBL_CMPY_CD(+)
                    AND RD.RWS_NUM                             =      RH.RWS_NUM(+)
                    AND RH.GLBL_CMPY_CD                        =      EAHW.GLBL_CMPY_CD(+)
                    AND RH.RWS_NUM                             =      EAHW.RWS_NUM(+)
                    AND PRD.GLBL_CMPY_CD                       =      PRD2.GLBL_CMPY_CD(+)
                    AND PRD.PRCH_REQ_NUM                       =      PRD2.TRX_REF_NUM(+)
                    AND PRD.PRCH_REQ_LINE_NUM                  =      PRD2.TRX_REF_LINE_NUM(+)
                    AND PRD.PRCH_REQ_LINE_SUB_NUM              =      PRD2.TRX_REF_LINE_SUB_NUM(+)
                    AND PRD2.PO_ORD_NUM                        =      CAIH.PO_NUM(+)
                    AND PRD2.PO_ORD_DTL_LINE_NUM               =      CAIH.PO_ORD_DTL_LINE_NUM(+)
                    AND (EXISTS(SELECT 1 FROM RWS_HDR RH2 WHERE RH.GLBL_CMPY_CD = RH2.GLBL_CMPY_CD AND RH.RWS_NUM = RH2.RWS_NUM AND RH2.RWS_STS_CD IN(#printed#, #receiving#) AND RH2.EZCANCELFLAG = '0') OR RH.RWS_NUM IS NULL)
                    AND PR.EZCANCELFLAG                        =      '0'
                    AND PRD.EZCANCELFLAG                       =      '0'
                    AND SO.EZCANCELFLAG(+)                     =      '0'
                    AND PRS.EZCANCELFLAG                       =      '0'
                    AND PRT.EZCANCELFLAG(+)                    =      '0'
                    AND RW.EZCANCELFLAG(+)                     =      '0'
                    AND PV.EZCANCELFLAG(+)                     =      '0'
                    AND SS.EZCANCELFLAG(+)                     =      '0'
                    AND EAHW.EZCANCELFLAG(+)                   =      '0'
                    AND RD.EZCANCELFLAG(+)                     =      '0'
                    AND RH.EZCANCELFLAG(+)                     =      '0'
                    AND PRD2.EZCANCELFLAG(+)                   =      '0'
                UNION ALL
                SELECT
                    PO.RQST_TECH_TOC_CD
                   ,(SELECT TM.TECH_NM FROM TECH_MSTR TM WHERE TM.GLBL_CMPY_CD = PO.GLBL_CMPY_CD AND TM.TECH_TOC_CD = PO.RQST_TECH_TOC_CD AND TM.EZCANCELFLAG = '0') AS RQST_TECH_TOC_NM
                   ,PO.DEST_RTL_WH_CD
                   ,(SELECT RW.RTL_WH_NM FROM RTL_WH RW WHERE RW.GLBL_CMPY_CD = PO.GLBL_CMPY_CD AND RW.RTL_WH_CD = PO.DEST_RTL_WH_CD AND RW.EZCANCELFLAG = '0') AS DEST_RTL_WH_NM
                   ,#physInvtyDt# AS PHYS_INVTY_DT
                   ,PO.PO_ORD_NUM AS PRCH_REQ_NUM
                   ,RH.RWS_REF_NUM AS SO_NUM
                   ,SUBSTR(EAHW.ASN_SHIP_DT_TM_TS ,1,8) AS SHIP_DATE
                   ,#procrTpCd1# AS PROCR_TP_CD
                   ,RH.IMPT_INV_BOL_NUM AS PRO_NUM
                   ,PV.PRNT_VND_NM AS WAREHOUSE_OR_SUPPLIER
                   ,CASE WHEN EAHW.ASN_SHIP_DT_TM_TS IS NOT NULL THEN #shipped# END AS SHPG_STS_DESC_TXT
                   ,PO.DS_PO_TP_NM AS PRCH_REQ_TP_DESC_TXT
                   ,CASE WHEN TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD') &lt; 0 THEN 0
                         ELSE TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD')
                    END AS AGE
                   ,PD.MDSE_CD
                   ,(SELECT MDSE.MDSE_DESC_SHORT_TXT FROM ALL_MDSE_V MDSE WHERE PD.GLBL_CMPY_CD = MDSE.GLBL_CMPY_CD AND PD.MDSE_CD = MDSE.MDSE_CD AND MDSE.EZCANCELFLAG = '0') AS MDSE_DESC_SHORT_TXT
                   ,RD.RWS_NUM
                FROM
                   PO              PO
                  ,PO_DTL          PD
                  ,PRNT_VND        PV
                  ,RWS_HDR         RH
                  ,RWS_DTL         RD
                  ,EDI_ASN_HDR_WRK EAHW
                  ,CAIH            CAIH
                WHERE
                  PO.GLBL_CMPY_CD        = #glblCmpyCd#
              AND PO.PO_QLFY_CD          = #poQlfyCdTech#
              <isNotNull property="poOrdSrcCd">
              AND PO.PO_ORD_SRC_CD      IN
              <iterate property="poOrdSrcCd" var="poOrdSrcCd[]" open="(" close=")" conjunction=",">
                  #poOrdSrcCd[]#
              </iterate>
              </isNotNull>
              AND PO.GLBL_CMPY_CD        = PV.GLBL_CMPY_CD(+)
              AND PO.PRNT_VND_CD         = PV.PRNT_VND_CD(+)
              <isNotNull property="dsPoTpCd">
              AND PO.DS_PO_TP_CD    NOT IN
              <iterate property="dsPoTpCd" var="dsPoTpCd[]" open="(" close=")" conjunction=",">
                  #dsPoTpCd[]#
              </iterate>
              </isNotNull>
              AND PO.PO_ORD_NUM          = PD.PO_ORD_NUM
              <isNotNull property="poStsCd">
              AND PD.PO_STS_CD      NOT IN
              <iterate property="poStsCd" var="poStsCd[]" open="(" close=")" conjunction=",">
                  #poStsCd[]#
              </iterate>
              </isNotNull>
              <isNotNull property="rqstTechTocCd">
                  AND PO.RQST_TECH_TOC_CD = #rqstTechTocCd#
              </isNotNull>
              <isNotNull property="destRtlWhCd">
                  AND PO.DEST_RTL_WH_CD  =      #destRtlWhCd#
              </isNotNull>
              AND PO.GLBL_CMPY_CD        = RH.GLBL_CMPY_CD
              AND PD.PO_ORD_NUM          = RH.PO_RCV_TRX_HDR_NUM
              AND PD.PO_ORD_DTL_LINE_NUM = RD.PO_RCV_TRX_LINE_NUM
              AND RH.GLBL_CMPY_CD        = RD.GLBL_CMPY_CD
              AND RH.RWS_NUM             = RD.RWS_NUM
              AND RH.GLBL_CMPY_CD        = EAHW.GLBL_CMPY_CD(+)
              AND RH.RWS_NUM             = EAHW.RWS_NUM(+)
              AND PD.PO_ORD_NUM          = CAIH.PO_NUM(+)
              AND PD.PO_ORD_DTL_LINE_NUM = CAIH.PO_ORD_DTL_LINE_NUM(+) 
              AND EXISTS(SELECT 1 FROM RWS_HDR RH2 WHERE RH.GLBL_CMPY_CD = RH2.GLBL_CMPY_CD AND RH.RWS_NUM = RH2.RWS_NUM AND RH2.RWS_STS_CD IN(#printed#, #receiving#) AND RH2.EZCANCELFLAG = '0')
              AND PO.EZCANCELFLAG        = '0'
              AND PD.EZCANCELFLAG        = '0'
              AND PV.EZCANCELFLAG(+)     = '0'
              AND RH.EZCANCELFLAG        = '0'
              AND RD.EZCANCELFLAG        = '0'
              UNION ALL
                SELECT
                    PO.RQST_TECH_TOC_CD
                   ,(SELECT TM.TECH_NM FROM TECH_MSTR TM WHERE TM.GLBL_CMPY_CD = PO.GLBL_CMPY_CD AND TM.TECH_TOC_CD = PO.RQST_TECH_TOC_CD AND TM.EZCANCELFLAG = '0') AS RQST_TECH_TOC_NM
                   ,PO.DEST_RTL_WH_CD
                   ,(SELECT RW.RTL_WH_NM FROM RTL_WH RW WHERE RW.GLBL_CMPY_CD = PO.GLBL_CMPY_CD AND RW.RTL_WH_CD = PO.DEST_RTL_WH_CD AND RW.EZCANCELFLAG = '0') AS DEST_RTL_WH_NM
                   ,#physInvtyDt# AS PHYS_INVTY_DT
                   ,PO.PO_ORD_NUM AS PRCH_REQ_NUM
                   ,RH.RWS_REF_NUM AS SO_NUM
                   ,SUBSTR(EAHW.ASN_SHIP_DT_TM_TS ,1,8) AS SHIP_DATE
                   ,#procrTpCd1# AS PROCR_TP_CD
                   ,RH.IMPT_INV_BOL_NUM AS PRO_NUM
                   ,PV.PRNT_VND_NM AS WAREHOUSE_OR_SUPPLIER
                   ,CASE WHEN EAHW.ASN_SHIP_DT_TM_TS IS NOT NULL THEN #shipped# END AS SHPG_STS_DESC_TXT
                   ,PO.DS_PO_TP_NM AS PRCH_REQ_TP_DESC_TXT
                   ,CASE WHEN TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD') &lt; 0 THEN 0
                         ELSE TO_DATE(#physInvtyDt#, 'YYYYMMDD') - TO_DATE(NVL(SUBSTR(EAHW.ASN_SHIP_DT_TM_TS,1,8), NVL(CAIH.INV_DT, #physInvtyDt#)), 'YYYYMMDD')
                    END AS AGE
                   ,PD.MDSE_CD
                   ,(SELECT MDSE.MDSE_DESC_SHORT_TXT FROM ALL_MDSE_V MDSE WHERE PD.GLBL_CMPY_CD = MDSE.GLBL_CMPY_CD AND PD.MDSE_CD = MDSE.MDSE_CD AND MDSE.EZCANCELFLAG = '0') AS MDSE_DESC_SHORT_TXT
                   ,RD.RWS_NUM
                FROM
                   PO              PO
                  ,PO_DTL          PD
                  ,PRNT_VND        PV
                  ,RWS_HDR         RH
                  ,RWS_DTL         RD
                  ,EDI_ASN_HDR_WRK EAHW
                  ,CAIH            CAIH
                WHERE
                  PO.GLBL_CMPY_CD        = #glblCmpyCd#
              AND PO.PO_QLFY_CD          = #poQlfyCdTech#
              <isNotNull property="poOrdSrcCd">
              AND PO.PO_ORD_SRC_CD   NOT IN
              <iterate property="poOrdSrcCd" var="poOrdSrcCd[]" open="(" close=")" conjunction=",">
                  #poOrdSrcCd[]#
              </iterate>
              </isNotNull>
              AND PO.GLBL_CMPY_CD        = PV.GLBL_CMPY_CD(+)
              AND PO.PRNT_VND_CD         = PV.PRNT_VND_CD(+)
              <isNotNull property="dsPoTpCd">
              AND PO.DS_PO_TP_CD    NOT IN
              <iterate property="dsPoTpCd" var="dsPoTpCd[]" open="(" close=")" conjunction=",">
                  #dsPoTpCd[]#
              </iterate>
              </isNotNull>
              AND PO.PO_ORD_NUM          = PD.PO_ORD_NUM
              <isNotNull property="poStsCd">
              AND PD.PO_STS_CD      NOT IN
              <iterate property="poStsCd" var="poStsCd[]" open="(" close=")" conjunction=",">
                  #poStsCd[]#
              </iterate>
              </isNotNull>
              <isNotNull property="rqstTechTocCd">
                  AND PO.RQST_TECH_TOC_CD = #rqstTechTocCd#
              </isNotNull>
              <isNotNull property="destRtlWhCd">
                  AND PO.DEST_RTL_WH_CD  =      #destRtlWhCd#
              </isNotNull>
              AND PD.TRX_REF_LINE_NUM     IS NULL
              AND PD.TRX_REF_LINE_SUB_NUM IS NULL
              AND PO.GLBL_CMPY_CD        = RH.GLBL_CMPY_CD
              AND PD.PO_ORD_NUM          = RH.PO_RCV_TRX_HDR_NUM
              AND PD.PO_ORD_DTL_LINE_NUM = RD.PO_RCV_TRX_LINE_NUM
              AND RH.GLBL_CMPY_CD        = RD.GLBL_CMPY_CD
              AND RH.RWS_NUM             = RD.RWS_NUM
              AND RH.GLBL_CMPY_CD        = EAHW.GLBL_CMPY_CD(+)
              AND RH.RWS_NUM             = EAHW.RWS_NUM(+)
              AND PD.PO_ORD_NUM          = CAIH.PO_NUM(+)
              AND PD.PO_ORD_DTL_LINE_NUM = CAIH.PO_ORD_DTL_LINE_NUM(+) 
              AND EXISTS(SELECT 1 FROM RWS_HDR RH2 WHERE RH.GLBL_CMPY_CD = RH2.GLBL_CMPY_CD AND RH.RWS_NUM = RH2.RWS_NUM AND RH2.RWS_STS_CD IN(#printed#, #receiving#) AND RH2.EZCANCELFLAG = '0')
              AND PO.EZCANCELFLAG        = '0'
              AND PD.EZCANCELFLAG        = '0'
              AND PV.EZCANCELFLAG(+)     = '0'
              AND RH.EZCANCELFLAG        = '0'
              AND RD.EZCANCELFLAG        = '0'
        )
        SELECT
                T1.RQST_TECH_TOC_CD
                ,T1.RQST_TECH_TOC_NM
                ,T1.DEST_RTL_WH_CD
                ,T1.DEST_RTL_WH_NM
                ,T1.PHYS_INVTY_DT
                ,T1.PRCH_REQ_NUM
                ,T1.SO_NUM
                ,T1.SHIP_DATE
                ,T1.PRO_NUM
                ,T1.WAREHOUSE_OR_SUPPLIER
                ,T1.SHPG_STS_DESC_TXT
                ,T1.PRCH_REQ_TP_DESC_TXT
                ,T1.AGE
                ,T1.MDSE_CD
                ,T1.MDSE_DESC_SHORT_TXT
                ,T1.RWS_NUM
        FROM
            (SELECT
                H1.RQST_TECH_TOC_CD
                ,H1.RQST_TECH_TOC_NM
                ,H1.DEST_RTL_WH_CD
                ,H1.DEST_RTL_WH_NM
                ,H1.PHYS_INVTY_DT
                ,H1.PRCH_REQ_NUM
                ,H1.SO_NUM
                ,H1.SHIP_DATE
                ,H1.PROCR_TP_CD
                ,H1.PRO_NUM
                ,H1.WAREHOUSE_OR_SUPPLIER
                ,H1.SHPG_STS_DESC_TXT
                ,H1.PRCH_REQ_TP_DESC_TXT
                ,H1.AGE
                ,H1.MDSE_CD
                ,H1.MDSE_DESC_SHORT_TXT
                ,H1.RWS_NUM
            FROM
                PR_H1 H1
            WHERE (H1.SO_NUM IS NOT NULL OR H1.RWS_NUM IS NOT NULL)
            GROUP BY
                H1.RQST_TECH_TOC_CD
                ,H1.RQST_TECH_TOC_NM
                ,H1.DEST_RTL_WH_CD
                ,H1.DEST_RTL_WH_NM
                ,H1.PHYS_INVTY_DT
                ,H1.PRCH_REQ_NUM
                ,H1.SO_NUM
                ,H1.SHIP_DATE
                ,H1.PROCR_TP_CD
                ,H1.PRO_NUM
                ,H1.WAREHOUSE_OR_SUPPLIER
                ,H1.SHPG_STS_DESC_TXT
                ,H1.PRCH_REQ_TP_DESC_TXT
                ,H1.AGE
                ,H1.MDSE_CD
                ,H1.MDSE_DESC_SHORT_TXT
                ,H1.RWS_NUM
            ORDER BY
                H1.PRCH_REQ_NUM
                ,H1.SO_NUM
                ,H1.SHIP_DATE
                ,H1.PROCR_TP_CD
                ,H1.PRO_NUM
                ,H1.WAREHOUSE_OR_SUPPLIER
                ,H1.SHPG_STS_DESC_TXT
                ,H1.PRCH_REQ_TP_DESC_TXT
                ,H1.AGE
                ,H1.MDSE_CD
                ,H1.RWS_NUM
            ) T1
        WHERE
                ROWNUM         &lt;=       #maxRownum#
    </statement>
    <resultMap id="result.NLCL0620_FSMsg" class="NLCL0620_FSMsg">
        <result property="techTocCd_F"                  column="RQST_TECH_TOC_CD"              javaType="EZDSStringItem"/>
        <result property="techNm_F"                     column="RQST_TECH_TOC_NM"              javaType="EZDSStringItem"/>
        <result property="rtlWhCd_F"                    column="DEST_RTL_WH_CD"                javaType="EZDSStringItem"/>
        <result property="rtlWhNm_F"                    column="DEST_RTL_WH_NM"                javaType="EZDSStringItem"/>
        <result property="physInvtyDt_F"                column="PHYS_INVTY_DT"                 javaType="EZDCDateItem"/>
        <result property="prchReqNum_F"                 column="PRCH_REQ_NUM"                  javaType="EZDSStringItem"/>
        <result property="prchReqTpDescTxt_F"           column="PRCH_REQ_TP_DESC_TXT"          javaType="EZDSStringItem"/>
        <result property="rwsRefNum_F"                  column="SO_NUM"                        javaType="EZDSStringItem"/>
        <result property="shipDt_F"                     column="SHIP_DATE"                     javaType="EZDCDateItem"/>
        <result property="xxScrItem61Txt_F"             column="WAREHOUSE_OR_SUPPLIER"         javaType="EZDSStringItem"/>
        <result property="proNum_F"                     column="PRO_NUM"                       javaType="EZDSStringItem"/>
        <result property="shpgStsDescTxt_F"             column="SHPG_STS_DESC_TXT"             javaType="EZDSStringItem"/>
        <result property="xxScrItem19Txt_F"             column="AGE"                           javaType="EZDSStringItem"/>
        <result property="mdseCd_F"                     column="MDSE_CD"                       javaType="EZDSStringItem"/>
        <result property="rwsNum_F"                     column="RWS_NUM"                       javaType="EZDSStringItem"/>
    </resultMap>
<!-- END   2019/12/17 T.Ogura [QC#54986,ADD] -->
</sqlMap>