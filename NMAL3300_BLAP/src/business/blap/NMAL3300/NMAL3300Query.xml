<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL3300Query">

    <typeAlias alias="NMAL3300CMsg"        type="business.blap.NMAL3300.NMAL3300CMsg"/>
    <typeAlias alias="NMAL3300SMsg"       type="business.blap.NMAL3300.NMAL3300SMsg"/>

    <resultMap id="result.getDisplayAval"                  class="NMAL3300SMsg">
        <result property="hrchEffLvlTpCd_A1"                 column="FIRST_BIZ_CTX_ATTRB_TXT_DISP"            javaType="EZDSStringItem"/>
        <result property="hrchEffLvlTpCd_A2"                 column="SCD_BIZ_CTX_ATTRB_TXT_DISP"              javaType="EZDSStringItem"/>
        <result property="hrchEffLvlTpCd_A3"                 column="THIRD_BIZ_CTX_ATTRB_TXT_DISP"            javaType="EZDSStringItem"/>
        <result property="hrchEffLvlTpCd_A4"                 column="FRTH_BIZ_CTX_ATTRB_TXT_DISP"             javaType="EZDSStringItem"/>
        <result property="hrchEffLvlTpCd_B1"                 column="FIRST_BIZ_CTX_ATTRB_NUM_SORT"            javaType="EZDSStringItem"/>
        <result property="hrchEffLvlTpCd_B2"                 column="SCD_BIZ_CTX_ATTRB_NUM_SORT"              javaType="EZDSStringItem"/>
        <result property="hrchEffLvlTpCd_B3"                 column="THIRD_BIZ_CTX_ATTRB_NUM_SORT"            javaType="EZDSStringItem"/>
        <result property="hrchEffLvlTpCd_B4"                 column="FRTH_BIZ_CTX_ATTRB_NUM_SORT"             javaType="EZDSStringItem"/>
        <result property="firstBizCtxAttrbTxt_A"             column="FIRST_BIZ_CTX_ATTRB_TXT"                 javaType="EZDSStringItem"/>
        <result property="scdBizCtxAttrbTxt_A"               column="SCD_BIZ_CTX_ATTRB_TXT"                   javaType="EZDSStringItem"/>
        <result property="thirdBizCtxAttrbTxt_A"             column="THIRD_BIZ_CTX_ATTRB_TXT"                 javaType="EZDSStringItem"/>
        <result property="frthBizCtxAttrbTxt_A"              column="FRTH_BIZ_CTX_ATTRB_TXT"                  javaType="EZDSStringItem"/>
        <result property="firstBizCtxAttrbNum_B"             column="FIRST_BIZ_CTX_ATTRB_NUM"                 javaType="EZDSBigDecimalItem"/>
        <result property="scdBizCtxAttrbNum_B"               column="SCD_BIZ_CTX_ATTRB_NUM"                   javaType="EZDSBigDecimalItem"/>
        <result property="thirdBizCtxAttrbNum_B"             column="THIRD_BIZ_CTX_ATTRB_NUM"                 javaType="EZDSBigDecimalItem"/>
        <result property="frthBizCtxAttrbNum_B"              column="FRTH_BIZ_CTX_ATTRB_NUM"                  javaType="EZDSBigDecimalItem"/>
    </resultMap>

    <statement id="getLocNumFromShipTo" parameterClass="Map" resultClass="Map">
        SELECT SHIP.LOC_NUM AS LOC_NUM
            , SHIP.DS_LOC_NM AS LOC_NM
            , SHIP.SELL_TO_CUST_CD AS SELL_TO_CUST_CD
            , SHIP.DS_ACCT_NM AS DS_ACCT_NM
        FROM SHIP_TO_CUST SHIP
        WHERE SHIP.GLBL_CMPY_CD = #glblCmpyCd#
        AND   SHIP.EZCANCELFLAG = '0'
        AND   SHIP.RGTN_STS_CD = #rgtnStsCd#
        AND   SHIP.SHIP_TO_CUST_CD = #shipToCustCd#
    </statement>

    <statement id="getLocNumFromBillTo" parameterClass="Map" resultClass="Map">
        SELECT BILL.LOC_NUM AS LOC_NUM
            , BILL.DS_LOC_NM AS LOC_NM
            , BILL.SELL_TO_CUST_CD AS SELL_TO_CUST_CD
            , BILL.DS_ACCT_NM AS DS_ACCT_NM
        FROM BILL_TO_CUST BILL
        WHERE BILL.GLBL_CMPY_CD = #glblCmpyCd#
        AND   BILL.EZCANCELFLAG = '0'
        AND   BILL.RGTN_STS_CD = #rgtnStsCd#
        AND   BILL.BILL_TO_CUST_CD = #billToCustCd#
    </statement>

    <statement id="getAcctNum" parameterClass="Map" resultClass="Map">
       SELECT CUST.SELL_TO_CUST_CD AS SELL_TO_CUST_CD
        , CUST.DS_ACCT_NM AS DS_ACCT_NM
       FROM SELL_TO_CUST CUST
       WHERE CUST.GLBL_CMPY_CD = #glblCmpyCd#
       AND   CUST.EZCANCELFLAG = '0'
       AND   CUST.RGTN_STS_CD = #rgtnStsCd#
       AND   CUST.SELL_TO_CUST_CD = #dsAcctNum#
    </statement>

<!-- START 2018/11/12 Hd.Sugawara [QC#28683,DEL] -->
<!--    <statement id="getCustSpclInstn" parameterClass="Map" resultClass="Map"> -->
<!--        SELECT RULE.DS_CUST_TRX_RULE_PK       AS DS_CUST_TRX_RULE_PK -->
<!--            , RULE.DS_ACCT_NUM                AS DS_ACCT_NUM -->
<!--            , RULE.LOC_NUM                    AS LOC_NUM -->
<!--            , RULE.DS_TRX_RULE_TP_CD          AS DS_TRX_RULE_TP_CD -->
<!--            , RULE_TP.DS_TRX_RULE_TP_NM       AS DS_TRX_RULE_TP_NM -->
<!--            , RULE.DS_PO_REQ_FLG              AS DS_PO_REQ_FLG -->
<!--            , RULE.DS_BLKT_PO_NUM             AS DS_BLKT_PO_NUM -->
<!--            , RULE.DS_PO_EXPR_DT              AS DS_PO_EXPR_DT -->
<!--            , RULE.DS_DEF_BILL_TO_CD          AS DS_DEF_BILL_TO_CD -->
<!--            , trim(BILL.FIRST_LINE_ADDR || ' ' || BILL.SCD_LINE_ADDR || ' ' || BILL.THIRD_LINE_ADDR || ' '  || BILL.FRTH_LINE_ADDR) -->
<!--                                              AS XX_ALL_LINE_ADDR_BILL -->
<!--            , RULE.DS_DEF_SHIP_TO_CD          AS DS_DEF_SHIP_TO_CD -->
<!--            , trim(SHIP.FIRST_LINE_ADDR || ' ' || SHIP.SCD_LINE_ADDR || ' ' || SHIP.THIRD_LINE_ADDR || ' '  || SHIP.FRTH_LINE_ADDR) -->
<!--                                              AS XX_ALL_LINE_ADDR_SHIP -->
<!--            , RULE.DS_CR_CARD_REQ_FLG         AS DS_CR_CARD_REQ_FLG -->
<!--            , RULE.DS_OVNGT_ALLW_FLG          AS DS_OVNGT_ALLW_FLG -->
<!--            , RULE.CUST_EFF_LVL_CD            AS CUST_EFF_LVL_CD -->
<!--            , LVL.CUST_EFF_LVL_NM             AS CUST_EFF_LVL_NM -->
<!--        FROM -->
<!--            DS_CUST_TRX_RULE RULE -->
<!--           , BILL_TO_CUST BILL -->
<!--           , SHIP_TO_CUST SHIP -->
<!--           , DS_TRX_RULE_TP RULE_TP -->
<!--           , CUST_EFF_LVL LVL -->
<!--        WHERE -->
<!--            RULE.GLBL_CMPY_CD = #glblCmpyCd# -->
<!--        AND RULE.EZCANCELFLAG = '0' -->
<!--        <isEqual property="selectAcctFlg" compareValue="Y"> -->
<!--        AND RULE.DS_ACCT_NUM = #searchKey# -->
<!--        </isEqual> -->
<!--        <isEqual property="selectLocFlg" compareValue="Y"> -->
<!--        AND RULE.LOC_NUM = #searchKey# -->
<!--        </isEqual> -->

<!--        AND RULE.GLBL_CMPY_CD = BILL.GLBL_CMPY_CD(+) -->
<!--        AND RULE.DS_DEF_BILL_TO_CD = BILL.BILL_TO_CUST_CD(+) -->
<!--        AND BILL.EZCANCELFLAG(+) = '0' -->

<!--        AND RULE.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD(+) -->
<!--        AND RULE.DS_DEF_SHIP_TO_CD = SHIP.SHIP_TO_CUST_CD(+) -->
<!--        AND SHIP.EZCANCELFLAG(+) = '0' -->

<!--        AND RULE.GLBL_CMPY_CD = RULE_TP.GLBL_CMPY_CD(+) -->
<!--        AND RULE.DS_TRX_RULE_TP_CD = RULE_TP.DS_TRX_RULE_TP_CD(+) -->
<!--        AND RULE_TP.EZCANCELFLAG(+) = '0' -->

<!--        AND RULE.GLBL_CMPY_CD = LVL.GLBL_CMPY_CD(+) -->
<!--        AND RULE.CUST_EFF_LVL_CD = LVL.CUST_EFF_LVL_CD(+) -->
<!--        AND LVL.EZCANCELFLAG(+) = '0' -->

<!--        AND (  NOT EXISTS (SELECT -->
<!--            1 -->
<!--        FROM -->
<!--            CUST_SPCL_INSTN_CTX CP -->
<!--        WHERE -->
<!--            CP.GLBL_CMPY_CD = #glblCmpyCd# -->
<!--        AND CP.EZCANCELFLAG = '0' -->
<!--        AND CP.CUST_SPCL_INSTN_CTX_TP_CD = #custSpclInstnCtxTpCd# -->
<!--        <isNotNull property="cMsg.funcMstrId_S"> -->
<!--        AND CP.FUNC_MSTR_ID = #cMsg.funcMstrId_S# -->
<!--        </isNotNull> -->
<!--        <isNotNull property="cMsg.funcMstrIdDescTxt_S"> -->
<!--        AND CP.FUNC_MSTR_ID_DESC_TXT = #cMsg.funcMstrIdDescTxt_S# -->
<!--        </isNotNull> -->
<!--             ) -->
<!--        OR ( EXISTS (SELECT -->
<!--            1 -->
<!--        FROM -->
<!--            CUST_SPCL_INSTN_CTX CP -->
<!--        WHERE -->
<!--            CP.GLBL_CMPY_CD = #glblCmpyCd# -->
<!--        AND CP.EZCANCELFLAG = '0' -->
        <!-- 2018/07/11 QC#26713 Add Start -->
<!--        AND CP.CUST_SPCL_INSTN_CTX_TP_CD = #custSpclInstnCtxTpCd# -->
        <!-- 2018/07/11 QC#26713 Add End -->

<!--        AND CP.GLBL_CMPY_CD = RULE.GLBL_CMPY_CD -->
<!--        AND CP.FIRST_BIZ_CTX_ATTRB_TXT = RULE.DS_TRX_RULE_TP_CD -->
<!--        <isNotNull property="cMsg.funcMstrId_S"> -->
<!--        AND CP.FUNC_MSTR_ID = #cMsg.funcMstrId_S# -->
<!--        </isNotNull> -->
<!--        <isNotNull property="cMsg.funcMstrIdDescTxt_S"> -->
<!--        AND CP.FUNC_MSTR_ID_DESC_TXT = #cMsg.funcMstrIdDescTxt_S# -->
<!--        </isNotNull> -->
<!--        ))) -->
<!--        ORDER BY -->
<!--            RULE_TP.DS_TRX_RULE_TP_SORT_NUM -->
<!--    </statement> -->
<!-- END 2018/11/12 Hd.Sugawara [QC#28683,DEL] -->

    <statement id="cntHrchEffLvlTp" parameterClass="Map" resultClass="Integer">
        SELECT COUNT(*) AS CNT
        FROM DS_ACCT_RELN RELN
        WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
        AND   RELN.EZCANCELFLAG = '0'
        AND   RELN.DS_ACCT_NUM = #dsAcctNum#
        <!-- 2018/07/11 QC#26713 Add Start -->
        AND   RELN.DS_ACCT_RELN_TP_CD = '1'
        <!-- 2018/07/11 QC#26713 Add End -->
    </statement>

<!-- START 2018/11/12 Hd.Sugawara [QC#28683,DEL] -->
<!--    <statement id="getAcctRefAttrb" parameterClass="Map" resultClass="Map"> -->
<!--        SELECT -->
<!--            ATTRB.DS_ACCT_REF_ATTRB_NUM   AS DS_ACCT_REF_ATTRB_NUM -->
<!--            , ATTRB.BLLG_ATTRB_NM         AS BLLG_ATTRB_NM -->
<!--            , ATTRB.BLLG_ATTRB_VAL_TXT    AS BLLG_ATTRB_VAL_TXT -->
<!--            , ATTRB.BLLG_ATTRB_ENBL_FLG   AS BLLG_ATTRB_ENBL_FLG -->
<!--            , ATTRB.BLLG_ATTRB_REQ_FLG    AS BLLG_ATTRB_REQ_FLG -->
<!--        FROM -->
<!--            DS_ACCT_REF_ATTRB ATTRB -->
<!--        WHERE -->
<!--            ATTRB.GLBL_CMPY_CD = #glblCmpyCd# -->
<!--        AND ATTRB.EZCANCELFLAG = '0' -->
<!--        <isNotNull property="dsAcctNum"> -->
<!--        AND ATTRB.DS_ACCT_NUM = #dsAcctNum# -->
<!--        </isNotNull> -->
<!--        <isNotNull property="locNum"> -->
<!--        AND ATTRB.LOC_NUM = #locNum# -->
<!--        ORDER BY  -->
<!--            ATTRB.DS_ACCT_REF_ATTRB_NUM -->
<!--          , ATTRB.DS_ACCT_REF_ATTRB_PK -->
<!--        </isNotNull> -->
<!--    </statement> -->
<!--    <statement id="getSpclHdlg" parameterClass="Map" resultClass="Map"> -->
<!--        SELECT -->
<!--            HDLG_TP.DS_SPCL_HDLG_TP_NM       AS DS_SPCL_HDLG_TP_NM -->
<!--            , HDLG_TP.DS_SPCL_HDLG_TP_VAL_NM AS DS_SPCL_HDLG_TP_VAL_NM -->
<!--            , LVL.CUST_EFF_LVL_NM            AS CUST_EFF_LVL_NM -->
<!--            , HDLG.EFF_FROM_DT               AS EFF_FROM_DT -->
<!--            , HDLG.EFF_THRU_DT               AS EFF_THRU_DT -->
<!--            , TO_CHAR(TO_TIMESTAMP(HDLG.EZINTIME, 'yyyymmddhh24missff3'), 'mm/dd/yyyy') AS EZINTIME -->
<!--            , TO_CHAR(TO_TIMESTAMP(HDLG.EZUPTIME, 'yyyymmddhh24missff3'), 'mm/dd/yyyy') AS EZUPTIME -->
<!--        FROM -->
<!--            DS_CUST_SPCL_HDLG HDLG -->
<!--            , CUST_EFF_LVL LVL -->
<!--            , DS_SPCL_HDLG_TP HDLG_TP -->
<!--        WHERE -->
<!--            HDLG.GLBL_CMPY_CD = #glblCmpyCd# -->
<!--        AND HDLG.EZCANCELFLAG = '0' -->
<!--        AND HDLG.DS_ACCT_NUM = #dsAcctNum# -->

<!--        AND HDLG.GLBL_CMPY_CD = LVL.GLBL_CMPY_CD -->
<!--        AND HDLG.CUST_EFF_LVL_CD = LVL.CUST_EFF_LVL_CD -->
<!--        AND LVL.EZCANCELFLAG = '0' -->

<!--        AND HDLG.GLBL_CMPY_CD = HDLG_TP.GLBL_CMPY_CD -->
<!--        AND HDLG.DS_SPCL_HDLG_TP_CD = HDLG_TP.DS_SPCL_HDLG_TP_CD -->
<!--        AND HDLG.DS_SPCL_HDLG_TP_VAL_CD = HDLG_TP.DS_SPCL_HDLG_TP_VAL_CD -->
<!--        AND HDLG_TP.EZCANCELFLAG = '0' -->
<!--        <isNotNull property="cMsg.dsSpclHdlgTpCd_D"> -->
<!--        AND HDLG.DS_SPCL_HDLG_TP_CD = #cMsg.dsSpclHdlgTpCd_D# -->
<!--        </isNotNull> -->
<!--        <isNotNull property="cMsg.custEffLvlCd_D"> -->
<!--        AND HDLG.CUST_EFF_LVL_CD = #cMsg.custEffLvlCd_D# -->
<!--        </isNotNull> -->
<!--        <isNotNull property="cMsg.effFromDt_C"> -->
<!--        AND HDLG.EFF_FROM_DT = #cMsg.effFromDt_C# -->
<!--        </isNotNull> -->
<!--        <isNotNull property="cMsg.effThruDt_C"> -->
<!--        AND NVL(HDLG.EFF_THRU_DT,'99991231') = #cMsg.effThruDt_C# -->
<!--        </isNotNull> -->
<!--        ORDER BY -->
<!--            HDLG_TP.DS_SPCL_HDLG_TP_NM -->
<!--          , HDLG_TP.DS_SPCL_HDLG_TP_VAL_NM -->
<!--     </statement> -->
<!-- END 2018/11/12 Hd.Sugawara [QC#28683,DEL] -->

     <statement id="getCustSpclMsg" parameterClass="Map" resultClass="Map">
        SELECT 
            MSG.DS_CUST_SPCL_MSG_PK        AS DS_CUST_SPCL_MSG_PK
            , MSG.LINE_BIZ_TP_CD           AS LINE_BIZ_TP_CD
            , BIZ_LINE.LINE_BIZ_TP_NM      AS LINE_BIZ_TP_NM
            , MSG.DS_BIZ_AREA_CD           AS DS_BIZ_AREA_CD
            , BIZ_AREA.DS_BIZ_AREA_NM      AS DS_BIZ_AREA_NM
            , MSG.DS_CUST_MSG_TXT          AS DS_CUST_MSG_TXT
            , MSG_TP.DS_CUST_MSG_TP_NM     AS DS_CUST_MSG_TP_NM
            , MSG.DS_PRINT_ON_INV_FLG      AS DS_PRINT_ON_INV_FLG
            , LVL.CUST_EFF_LVL_NM          AS CUST_EFF_LVL_NM
            , MSG.EFF_FROM_DT              AS EFF_FROM_DT
            , MSG.EFF_THRU_DT              AS EFF_THRU_DT
            , TO_CHAR(TO_TIMESTAMP(MSG.EZINTIME, 'yyyymmddhh24missff3'), 'mm/dd/yyyy') AS EZINTIME
            , TO_CHAR(TO_TIMESTAMP(MSG.EZUPTIME, 'yyyymmddhh24missff3'), 'mm/dd/yyyy') AS EZUPTIME
            <!-- QC#3580 -->
            , (
                SELECT A.EZBUSINESSID
                  FROM ATT_DATA A 
                 WHERE A.EZCANCELFLAG = '0' 
                   AND A.GLBL_CMPY_CD = MSG.GLBL_CMPY_CD 
                   AND A.ATT_DATA_GRP_TXT = TO_CHAR(MSG.DS_CUST_SPCL_MSG_PK)
                   <isNotNull property="attBizAplIds">
                   AND A.EZBUSINESSID IN 
                   	<iterate property="attBizAplIds" var="attBizAplIds[]" open="(" close=")" conjunction=",">
                     #attBizAplIds[]#
                   	</iterate>
                   </isNotNull>
                   AND ROWNUM &lt;= 1
              )                            AS EZBUSINESSID
        FROM 
            DS_CUST_SPCL_MSG MSG
            , LINE_BIZ_TP BIZ_LINE
            , DS_BIZ_AREA BIZ_AREA
            , DS_CUST_MSG_TP MSG_TP
            , CUST_EFF_LVL LVL
        WHERE
            MSG.GLBL_CMPY_CD = #glblCmpyCd#
        AND MSG.EZCANCELFLAG = '0'
        <isEqual property="selectAcctFlg" compareValue="Y">
        AND MSG.DS_ACCT_NUM = #searchKey#
        </isEqual>
        <isEqual property="selectLocFlg" compareValue="Y">
        AND MSG.LOC_NUM = #searchKey#
        </isEqual>

        AND MSG.GLBL_CMPY_CD = BIZ_LINE.GLBL_CMPY_CD
        AND MSG.LINE_BIZ_TP_CD = BIZ_LINE.LINE_BIZ_TP_CD
        AND BIZ_LINE.EZCANCELFLAG = '0'

        AND MSG.GLBL_CMPY_CD = BIZ_AREA.GLBL_CMPY_CD
        AND MSG.DS_BIZ_AREA_CD = BIZ_AREA.DS_BIZ_AREA_CD
        AND BIZ_AREA.EZCANCELFLAG = '0'

        AND MSG.GLBL_CMPY_CD = MSG_TP.GLBL_CMPY_CD
        AND MSG.DS_CUST_MSG_TP_CD = MSG_TP.DS_CUST_MSG_TP_CD
        AND MSG_TP.EZCANCELFLAG = '0'

        AND MSG.GLBL_CMPY_CD = LVL.GLBL_CMPY_CD
        AND MSG.CUST_EFF_LVL_CD = LVL.CUST_EFF_LVL_CD
        AND LVL.EZCANCELFLAG = '0'

        AND MSG.DS_CUST_MSG_TP_CD &lt;&gt; #custMsgTpCd#

        <!-- START 2018/11/12 Hd.Sugawara [QC#28683,DEL] -->
        <!-- <isNotNull property="cMsg.lineBizTpCd_D"> -->
        <!-- AND MSG.LINE_BIZ_TP_CD = #cMsg.lineBizTpCd_D# -->
        <!-- </isNotNull> -->
        <!-- <isNotNull property="cMsg.dsBizAreaCd_D"> -->
        <!-- AND MSG.DS_BIZ_AREA_CD = #cMsg.dsBizAreaCd_D# -->
        <!-- </isNotNull> -->
        <!-- <isNotNull property="cMsg.dsCustMsgTpCd_D"> -->
        <!-- AND MSG.DS_CUST_MSG_TP_CD = #cMsg.dsCustMsgTpCd_D# -->
        <!-- </isNotNull> -->
        <!-- <isNotNull property="cMsg.custEffLvlCd_D2"> -->
        <!-- AND MSG.CUST_EFF_LVL_CD = #cMsg.custEffLvlCd_D2# -->
        <!-- </isNotNull> -->
        <!-- <isNotNull property="cMsg.effFromDt_D"> -->
        <!-- AND MSG.EFF_FROM_DT = #cMsg.effFromDt_D# -->
        <!-- </isNotNull> -->
        <!-- <isNotNull property="cMsg.effThruDt_D"> -->
        <!-- AND NVL(MSG.EFF_THRU_DT,'99991231') = #cMsg.effThruDt_D# -->
        <!-- </isNotNull> -->
        <!-- <isEqual property="xxChkBox_VM" compareValue="Y"> -->
        <!-- END 2018/11/12 Hd.Sugawara [QC#28683,DEL] -->
        AND #slsDt# BETWEEN MSG.EFF_FROM_DT AND NVL(MSG.EFF_THRU_DT,'99991231')
        <!-- START 2018/11/12 Hd.Sugawara [QC#28683,DEL] -->
        <!-- </isEqual> -->
        <!-- END 2018/11/12 Hd.Sugawara [QC#28683,DEL] -->
        AND (  NOT EXISTS (SELECT
            1
        FROM
            CUST_SPCL_INSTN_CTX CP
        WHERE
            CP.GLBL_CMPY_CD = #glblCmpyCd#
        AND CP.EZCANCELFLAG = '0'
        AND CP.CUST_SPCL_INSTN_CTX_TP_CD = #custSpclInstnCtxTpCd#
        <isNotNull property="cMsg.funcMstrId_S">
        AND CP.FUNC_MSTR_ID = #cMsg.funcMstrId_S#
        </isNotNull>
        <isNotNull property="cMsg.funcMstrIdDescTxt_S">
        AND CP.FUNC_MSTR_ID_DESC_TXT = #cMsg.funcMstrIdDescTxt_S#
        </isNotNull>
             )
        OR ( EXISTS (SELECT
            1
        FROM
            CUST_SPCL_INSTN_CTX CP
        WHERE
            CP.GLBL_CMPY_CD = #glblCmpyCd#
        AND CP.EZCANCELFLAG = '0'
        <!-- 2018/07/11 QC#26713 Add Start -->
        AND CP.CUST_SPCL_INSTN_CTX_TP_CD = #custSpclInstnCtxTpCd#
        <!-- 2018/07/11 QC#26713 Add End -->

        AND CP.GLBL_CMPY_CD = MSG.GLBL_CMPY_CD
        AND CP.FIRST_BIZ_CTX_ATTRB_TXT = MSG.DS_BIZ_AREA_CD
        <isNotNull property="cMsg.funcMstrId_S">
        AND CP.FUNC_MSTR_ID = #cMsg.funcMstrId_S#
        </isNotNull>
        <isNotNull property="cMsg.funcMstrIdDescTxt_S">
        AND CP.FUNC_MSTR_ID_DESC_TXT = #cMsg.funcMstrIdDescTxt_S#
        </isNotNull>
        )))
        <!-- 2018/07/10 QC#26661 Add Start -->
        <isNotNull property="cMsg.lineBizTpCd_S">
        AND
        (
           MSG.LINE_BIZ_TP_CD = #cMsg.lineBizTpCd_S#
        OR MSG.LINE_BIZ_TP_CD = #lineBizTpAll#
        OR #cMsg.lineBizTpCd_S# = #lineBizTpAll#
        )
        </isNotNull>
        <!-- 2018/07/10 QC#26661 Add End -->
        ORDER BY
            BIZ_LINE.LINE_BIZ_TP_SORT_NUM
          , BIZ_AREA.DS_BIZ_AREA_SORT_NUM
          , MSG_TP.DS_CUST_MSG_TP_SORT_NUM
          , MSG.DS_CUST_SPCL_MSG_PK DESC 
          , NVL(MSG.EFF_THRU_DT,'99991231') DESC
     </statement>
     <statement id="getLobTypeWithMessageType" parameterClass="Map" resultClass="Map">
         SELECT
             BIZ_TP.LINE_BIZ_TP_CD     AS LINE_BIZ_TP_CD
            , MSG_TP.DS_CUST_MSG_TP_CD AS DS_CUST_MSG_TP_CD
         FROM
             LINE_BIZ_TP BIZ_TP
            , DS_CUST_MSG_TP MSG_TP
         WHERE
             BIZ_TP.GLBL_CMPY_CD = #glblCmpyCd#
         AND BIZ_TP.EZCANCELFLAG = '0'

         AND BIZ_TP.GLBL_CMPY_CD = MSG_TP.GLBL_CMPY_CD
         AND MSG_TP.EZCANCELFLAG = '0'
         AND MSG_TP.DS_CUST_MSG_TP_CD &lt;&gt; #custMsgTpCd#
     </statement>
     <statement id="getDisplayAvalCd" parameterClass="Map" resultMap="result.getDisplayAval">
         SELECT
              CTX_TP.FIRST_BIZ_CTX_ATTRB_TXT    AS FIRST_BIZ_CTX_ATTRB_TXT_DISP
              ,CTX_TP.SCD_BIZ_CTX_ATTRB_TXT     AS SCD_BIZ_CTX_ATTRB_TXT_DISP
              ,CTX_TP.THIRD_BIZ_CTX_ATTRB_TXT   AS THIRD_BIZ_CTX_ATTRB_TXT_DISP
              ,CTX_TP.FRTH_BIZ_CTX_ATTRB_TXT    AS FRTH_BIZ_CTX_ATTRB_TXT_DISP
              ,CTX_TP.FIRST_NUM_CTX_ATTRB_TXT   AS FIRST_BIZ_CTX_ATTRB_NUM_SORT
              ,CTX_TP.SCD_NUM_CTX_ATTRB_TXT     AS SCD_BIZ_CTX_ATTRB_NUM_SORT
              ,CTX_TP.THIRD_NUM_CTX_ATTRB_TXT   AS THIRD_BIZ_CTX_ATTRB_NUM_SORT
              ,CTX_TP.FRTH_NUM_CTX_ATTRB_TXT    AS FRTH_BIZ_CTX_ATTRB_NUM_SORT
          FROM
              CUST_SPCL_INSTN_CTX_TP CTX_TP
          WHERE
              CTX_TP.GLBL_CMPY_CD = #glblCmpyCd#
          AND CTX_TP.EZCANCELFLAG = '0'
          AND CTX_TP.CUST_SPCL_INSTN_CTX_TP_CD = #custSpclInstnCtxTpCd#
          AND ROWNUM = 1
     </statement>
     <statement id="cntDisplay" parameterClass="Map" resultClass="Integer">
         SELECT
            COUNT(*) AS CNT
        FROM
            CUST_SPCL_INSTN_CTX CP
        WHERE
            CP.GLBL_CMPY_CD =  #glblCmpyCd#
        AND CP.EZCANCELFLAG = '0'
        AND CP.CUST_SPCL_INSTN_CTX_TP_CD = #custSpclInstnCtxTpCd#
        <isNotNull property="cMsg.funcMstrId_S">
        AND CP.FUNC_MSTR_ID = #cMsg.funcMstrId_S#
        </isNotNull>
        <isNotNull property="cMsg.funcMstrIdDescTxt_S">
        AND CP.FUNC_MSTR_ID_DESC_TXT = #cMsg.funcMstrIdDescTxt_S#
        </isNotNull>
    </statement>
    <statement id="getDisplayAvalFlg" parameterClass="Map" resultMap="result.getDisplayAval">
        SELECT
            CASE
                WHEN SUM(
                    CASE
                        WHEN FIRST_BIZ_CTX_ATTRB_TXT = 'Y' THEN 1
                        ELSE 0
                    END
                ) &gt; 0 THEN 'Y'
                ELSE 'N'
            END AS FIRST_BIZ_CTX_ATTRB_TXT
            ,CASE
                WHEN SUM(
                    CASE
                        WHEN SCD_BIZ_CTX_ATTRB_TXT = 'Y' THEN 1
                ELSE 0
                    END
                ) &gt; 0 THEN 'Y'
                ELSE 'N'
            END AS SCD_BIZ_CTX_ATTRB_TXT
            ,CASE
                WHEN SUM(
                    CASE
                        WHEN THIRD_BIZ_CTX_ATTRB_TXT = 'Y' THEN 1
                        ELSE 0
                    END
                ) &gt; 0 THEN 'Y'
                ELSE 'N'
            END AS THIRD_BIZ_CTX_ATTRB_TXT
            ,CASE
                WHEN SUM(
                    CASE
                        WHEN FRTH_BIZ_CTX_ATTRB_TXT = 'Y' THEN 1
                        ELSE 0
                    END
                ) &gt; 0 THEN 'Y'
                ELSE 'N'
            END AS FRTH_BIZ_CTX_ATTRB_TXT
        FROM
            CUST_SPCL_INSTN_CTX CP
        WHERE
            CP.GLBL_CMPY_CD = #glblCmpyCd#
        AND CP.EZCANCELFLAG = '0'
        AND CP.CUST_SPCL_INSTN_CTX_TP_CD = #custSpclInstnCtxTpCd#
        <isNotNull property="cMsg.funcMstrId_S">
        AND CP.FUNC_MSTR_ID = #cMsg.funcMstrId_S#
        </isNotNull>
        <isNotNull property="cMsg.funcMstrIdDescTxt_S">
        AND CP.FUNC_MSTR_ID_DESC_TXT = #cMsg.funcMstrIdDescTxt_S#
        </isNotNull>
     </statement>

<!-- START 2018/11/12 Hd.Sugawara [QC#28683,DEL] -->
<!--     <statement id="getLvlSort" parameterClass="Map" resultMap="result.getDisplayAval"> -->
<!--        SELECT -->
<!--            CP.FIRST_BIZ_CTX_ATTRB_NUM AS FIRST_BIZ_CTX_ATTRB_NUM -->
<!--            ,CP.SCD_BIZ_CTX_ATTRB_NUM AS SCD_BIZ_CTX_ATTRB_NUM -->
<!--            ,CP.THIRD_BIZ_CTX_ATTRB_NUM AS THIRD_BIZ_CTX_ATTRB_NUM -->
<!--            ,CP.FRTH_BIZ_CTX_ATTRB_NUM AS FRTH_BIZ_CTX_ATTRB_NUM -->
<!--        FROM -->
<!--            CUST_SPCL_INSTN_CTX CP -->
<!--        WHERE -->
<!--            CP.GLBL_CMPY_CD = #glblCmpyCd# -->
<!--        AND CP.EZCANCELFLAG = '0' -->
<!--        AND CP.CUST_SPCL_INSTN_CTX_TP_CD = #custSpclInstnCtxTpCd# -->
<!--        <isNotNull property="cMsg.funcMstrId_S"> -->
<!--        AND CP.FUNC_MSTR_ID = #cMsg.funcMstrId_S# -->
<!--        </isNotNull> -->
<!--        <isNotNull property="cMsg.funcMstrIdDescTxt_S"> -->
<!--        AND CP.FUNC_MSTR_ID_DESC_TXT = #cMsg.funcMstrIdDescTxt_S# -->
<!--        </isNotNull> -->
<!--     </statement> -->
<!-- END 2018/11/12 Hd.Sugawara [QC#28683,DEL] -->

    <statement id="getSortNum" parameterClass="Map" resultClass="Map">
        SELECT
            <!-- 2018/07/11 QC#26713 Mod Start -->
            <!--
              CSIC.FIRST_BIZ_CTX_ATTRB_TXT AS FIRST_DATA
            , CSIC.SCD_BIZ_CTX_ATTRB_TXT AS SCD_DATA
            , CSIC.THIRD_BIZ_CTX_ATTRB_TXT AS THIRD_DATA
            , CSIC.FRTH_BIZ_CTX_ATTRB_TXT AS FRTH_DATA
            , CSIC.FIFTH_BIZ_CTX_ATTRB_TXT AS FIFTH_DATA
            -->
              CSICT.FIRST_BIZ_CTX_ATTRB_TXT AS FIRST_DATA
            , CSICT.SCD_BIZ_CTX_ATTRB_TXT AS SCD_DATA
            , CSICT.THIRD_BIZ_CTX_ATTRB_TXT AS THIRD_DATA
            , CSICT.FRTH_BIZ_CTX_ATTRB_TXT AS FRTH_DATA
            , CSICT.FIFTH_BIZ_CTX_ATTRB_TXT AS FIFTH_DATA
            <!-- 2018/07/11 QC#26713 Mod End -->
            , CSIC.FIRST_BIZ_CTX_ATTRB_NUM AS FIRST_NUM
            , CSIC.SCD_BIZ_CTX_ATTRB_NUM AS SCD_NUM
            , CSIC.THIRD_BIZ_CTX_ATTRB_NUM AS THIRD_NUM
            , CSIC.FRTH_BIZ_CTX_ATTRB_NUM AS FRTH_NUM
            , CSIC.FIFTH_BIZ_CTX_ATTRB_NUM AS FIFTH_NUM
        FROM
            CUST_SPCL_INSTN_CTX CSIC
        <!-- 2018/07/11 QC#26713 Add Start -->
          , CUST_SPCL_INSTN_CTX_TP CSICT
        <!-- 2018/07/11 QC#26713 Add End -->
        WHERE
            CSIC.GLBL_CMPY_CD = #glblCmpyCd#
        AND
            CSIC.EZCANCELFLAG = '0'
        AND
            CSIC.FUNC_MSTR_ID = #funcMstrId#
        AND
            CSIC.FUNC_MSTR_ID_DESC_TXT = #funcMstrIdDescTxt#
        AND
            CSIC.CUST_SPCL_INSTN_CTX_TP_CD = #custSpclInstnCtxCd#
        <!-- 2018/07/11 QC#26713 Add Start -->
        AND
            CSICT.EZCANCELFLAG = '0'
        AND
            CSIC.GLBL_CMPY_CD = CSICT.GLBL_CMPY_CD
        AND
            CSIC.CUST_SPCL_INSTN_CTX_TP_CD = CSICT.CUST_SPCL_INSTN_CTX_TP_CD
        <!-- 2018/07/11 QC#26713 Add End -->
        AND
            ROWNUM = #rowNum#
    </statement>

    <statement id="getSortDefNum" parameterClass="Map" resultClass="Map">
        SELECT
              CSICT.FIRST_BIZ_CTX_ATTRB_TXT AS FIRST_DEF_DATA
            , CSICT.SCD_BIZ_CTX_ATTRB_TXT AS SCD_DEF_DATA
            , CSICT.THIRD_BIZ_CTX_ATTRB_TXT AS THIRD_DEF_DATA
            , CSICT.FRTH_BIZ_CTX_ATTRB_TXT AS FRTH_DEF_DATA
            , CSICT.FIFTH_BIZ_CTX_ATTRB_TXT AS FIFTH_DEF_DATA
            , CSICT.FIRST_NUM_CTX_ATTRB_TXT AS FIRST_DEF_NUM
            , CSICT.SCD_NUM_CTX_ATTRB_TXT AS SCD_DEF_NUM
            , CSICT.THIRD_NUM_CTX_ATTRB_TXT AS THIRD_DEF_NUM
            , CSICT.FRTH_NUM_CTX_ATTRB_TXT AS FRTH_DEF_NUM
            , CSICT.FIFTH_NUM_CTX_ATTRB_TXT AS FIFTH_DEF_NUM
        FROM
            CUST_SPCL_INSTN_CTX_TP CSICT
        WHERE
            CSICT.GLBL_CMPY_CD = #glblCmpyCd#
        AND
            CSICT.EZCANCELFLAG = '0'
        <!-- 2018/07/11 QC#26713 Del Start -->
        <!--
        AND
            CSICT.MSTR_FUNC_ID = #mstrFuncId#
        -->
        <!-- 2018/07/11 QC#26713 Del End -->
        AND
            CSICT.CUST_SPCL_INSTN_CTX_TP_CD = #custSpclInstnCtxTpCd#
        AND
            ROWNUM = #rowNum#
    </statement>
</sqlMap>
