<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NFBL2100Query">
    <typeAlias alias="NFBL2100_ASMsg" type="business.blap.NFBL2100.NFBL2100_ASMsg"/>

    <statement id="getLocNm" parameterClass="Map" resultMap="String">
        SELECT
            DPLY_VND_NM
        FROM
            (
                SELECT
                    PV.PRNT_VND_NM || ' - ' || V.LOC_NM AS DPLY_VND_NM
                FROM
                     VND      V
                    ,PRNT_VND PV
                WHERE
                        V.GLBL_CMPY_CD  = #glblCmpyCd#
                    AND V.VND_CD        = #vndCd#
                    AND V.GLBL_CMPY_CD = PV.GLBL_CMPY_CD
                    AND V.PRNT_VND_PK  = PV.PRNT_VND_PK
                    AND V.EZCANCELFLAG  = '0'
                    AND PV.EZCANCELFLAG = '0'
                ORDER BY
                    V.EZINTIME DESC
            )
        WHERE
            ROWNUM = 1
    </statement>

    <statement id="getSearchData" parameterClass="Map" resultMap="result.getSearchData">
        SELECT
             AP_DS_WF_STS_DESC_TXT
            ,AP_DS_WF_STS_CD
            ,CPO_ORD_NUM
            ,INV_NUM
            ,SUBSTR(CPO_ORD_TS, 1, 8) AS CPO_ORD_TS
            ,DS_ORD_CATG_DESC_TXT
            ,DPLY_LINE_NUM
            ,CPO_DTL_FUNC_NET_AMT
            ,INV_BOL_NUM
            ,INV_LINE_NUM
            ,MDSE_CD
            ,MDSE_DESC_SHORT_TXT
            ,APVL_USR_NM
            ,APVL_RSPB_NM
            ,APVL_LIMIT_TO_AMT
            ,AP_WF_ML_NTFY_DT
            ,AP_WF_ML_NTFY_NUM
            ,AP_WF_RQST_CMNT_TXT
            ,AP_WF_RQST_RSP_DT
            ,VND_CD
            ,CR_AR_INV_NUM
            ,AP_INV_NUM
        FROM
            (
                SELECT
                     ADWS.AP_DS_WF_STS_DESC_TXT
                    ,ADWS.AP_DS_WF_STS_CD
                    ,ALBWR.CPO_ORD_NUM
                    ,ALBWR.INV_NUM
                    ,ALBWR.CPO_ORD_TS
                    ,DOC.DS_ORD_CATG_DESC_TXT
                    ,CDV.DPLY_LINE_NUM
                    ,ALBWR.CPO_DTL_FUNC_NET_AMT
                    ,ALBWR.INV_BOL_NUM
                    ,ALBWR.INV_LINE_NUM
                    ,ALBWR.MDSE_CD
                    ,MDS.MDSE_DESC_SHORT_TXT
                    ,ALBWR.APVL_USR_NM
                    ,ALBWR.APVL_RSPB_NM
                    ,ALBWR.APVL_LIMIT_TO_AMT
                    ,ALBWR.AP_WF_ML_NTFY_DT
                    ,ALBWR.AP_WF_ML_NTFY_NUM
                    ,ALBWR.AP_WF_RQST_CMNT_TXT
                    ,ALBWR.AP_WF_RQST_RSP_DT
                    ,ALBWR.VND_CD
                    ,ALBWR.CR_AR_INV_NUM
                    ,ALBWR.AP_INV_NUM
                FROM
                     AP_LSE_BO_WF_RQST ALBWR
                    ,AP_DS_WF_STS      ADWS
                    ,DS_ORD_CATG       DOC
                    ,MDSE              MDS
                    ,CPO_DTL_V         CDV
                WHERE
                    ALBWR.GLBL_CMPY_CD         = #glblCmpyCd#
                    AND ALBWR.GLBL_CMPY_CD     = ADWS.GLBL_CMPY_CD
                    AND ALBWR.AP_DS_WF_STS_CD  = ADWS.AP_DS_WF_STS_CD
                    AND ALBWR.GLBL_CMPY_CD     = DOC.GLBL_CMPY_CD(+)
                    AND ALBWR.DS_ORD_CATG_CD   = DOC.DS_ORD_CATG_CD(+)
                    AND ALBWR.GLBL_CMPY_CD     = MDS.GLBL_CMPY_CD(+)
                    AND ALBWR.MDSE_CD          = MDS.MDSE_CD(+)
                    AND ALBWR.GLBL_CMPY_CD     = CDV.GLBL_CMPY_CD(+)
                    AND ALBWR.CPO_ORD_NUM      = CDV.CPO_ORD_NUM(+)
                    AND ALBWR.CPO_DTL_LINE_NUM = CDV.CPO_DTL_LINE_NUM(+)
                    <isNotNull property="apDsWfStsCd" >
                    AND ALBWR.AP_DS_WF_STS_CD  = #apDsWfStsCd#
                    </isNotNull>
                    <isNotNull property="vndCd" >
                    AND ALBWR.VND_CD           = #vndCd#
                    </isNotNull>
                    <isNotNull property="cpoOrdTsFrom" >
                    AND ALBWR.CPO_ORD_TS     &gt;= #cpoOrdTsFrom#
                    </isNotNull>
                    <isNotNull property="cpoOrdTsTo" >
                    AND ALBWR.CPO_ORD_TS     &lt;= #cpoOrdTsTo#
                    </isNotNull>
                    <isNotNull property="cpoOrdNum" >
                    AND ALBWR.CPO_ORD_NUM      = #cpoOrdNum#
                    </isNotNull>
                    AND ALBWR.EZCANCELFLAG     = '0'
                    AND ADWS.EZCANCELFLAG      = '0'
                    AND DOC.EZCANCELFLAG(+)    = '0'
                    AND MDS.EZCANCELFLAG(+)    = '0'
                    AND CDV.EZCANCELFLAG(+)    = '0'
                ORDER BY
                     ALBWR.CPO_ORD_NUM
                    ,ALBWR.CPO_DTL_LINE_NUM
            )
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <resultMap id="result.getSearchData" class="NFBL2100_ASMsg">
        <result property="apDsWfStsDescTxt_A"     column="AP_DS_WF_STS_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="apDsWfStsCd_A"          column="AP_DS_WF_STS_CD"          javaType="EZDSStringItem"/>
        <result property="cpoOrdNum_A"            column="CPO_ORD_NUM"              javaType="EZDSStringItem"/>
        <result property="invNum_A"               column="INV_NUM"                  javaType="EZDSStringItem"/>
        <result property="xxToDt_A"               column="CPO_ORD_TS"               javaType="EZDSDateItem"/>
        <result property="dsOrdCatgDescTxt_A"     column="DS_ORD_CATG_DESC_TXT"     javaType="EZDSStringItem"/>
        <result property="dplyLineNum_A"          column="DPLY_LINE_NUM"            javaType="EZDSStringItem"/>
        <result property="cpoDtlFuncNetAmt_A"     column="CPO_DTL_FUNC_NET_AMT"     javaType="EZDSBigDecimalItem"/>
        <result property="invBolNum_A"            column="INV_BOL_NUM"              javaType="EZDSStringItem"/>
        <result property="invLineNum_A"           column="INV_LINE_NUM"             javaType="EZDSStringItem"/>
        <result property="mdseCd_A"               column="MDSE_CD"                  javaType="EZDSStringItem"/>
        <result property="mdseDescShortTxt_A"     column="MDSE_DESC_SHORT_TXT"      javaType="EZDSStringItem"/>
        <result property="apvlUsrNm_A"            column="APVL_USR_NM"              javaType="EZDSStringItem"/>
        <result property="apvlRspbNm_A"           column="APVL_RSPB_NM"             javaType="EZDSStringItem"/>
        <result property="apvlLimitAmt_A"         column="APVL_LIMIT_TO_AMT"        javaType="EZDSBigDecimalItem"/>
        <result property="apWfMlNtfyDt_A"         column="AP_WF_ML_NTFY_DT"         javaType="EZDSDateItem"/>
        <result property="apWfMlNtfyNum_A"        column="AP_WF_ML_NTFY_NUM"        javaType="EZDSBigDecimalItem"/>
        <result property="apWfRqstCmntTxt_A"      column="AP_WF_RQST_CMNT_TXT"      javaType="EZDSStringItem"/>
        <result property="apWfRqstRspDt_A"        column="AP_WF_RQST_RSP_DT"        javaType="EZDSDateItem"/>
        <result property="vndCd_A"                column="VND_CD"                   javaType="EZDSStringItem"/>
        <result property="crArInvNum_A"           column="CR_AR_INV_NUM"            javaType="EZDSStringItem"/>
        <result property="apInvNum_A"             column="AP_INV_NUM"               javaType="EZDSStringItem"/>
    </resultMap>
</sqlMap>
