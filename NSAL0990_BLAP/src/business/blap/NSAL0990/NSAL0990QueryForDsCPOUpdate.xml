<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAL0990QueryForDsCPOUpdate">

    <statement id="checkCodeTableDescText" parameterClass="Map" resultClass="Map">
        SELECT
            CT.$tblNm$_CD
        FROM
            $tblNm$ CT
        WHERE
                CT.GLBL_CMPY_CD         = #glblCmpyCd#
            AND UPPER(CT.$tblNm$_DESC_TXT)     = UPPER(#descTxt#)
            AND CT.EZCANCELFLAG         = '0'
    </statement>

    <statement id="checkCustCode" parameterClass="Map" resultClass="Map">
        SELECT
            A.$tblNm$_CD
        FROM
            $tblNm$ A
        WHERE
                A.GLBL_CMPY_CD  = #glblCmpyCd#
            AND A.$tblNm$_CD    = #custCd#
            AND A.EZCANCELFLAG = '0'
    </statement>
    <statement id="checkPriceCatgNm" parameterClass="Map" resultClass="Map">
        SELECT
            PC.PRC_CATG_CD
        FROM
            PRC_CATG PC
        WHERE
                PC.GLBL_CMPY_CD         = #glblCmpyCd#
            AND UPPER(PC.PRC_CATG_NM)   = UPPER(#prcCatgNm#)
            AND PC.EZCANCELFLAG         = '0'
    </statement>
    <statement id="checkAssociationProgram" parameterClass="Map" resultClass="Map">
        SELECT
            PC.PRC_CONTR_NUM
        FROM
            PRC_CONTR PC
        WHERE
                PC.GLBL_CMPY_CD     = #glblCmpyCd#
            AND PC.PRC_CONTR_NUM    = #prcContrNum#
            AND PC.EZCANCELFLAG     = '0'
    </statement>
    <statement id="checkModelText" parameterClass="Map" resultClass="Map">
        SELECT
            MN.T_MDL_ID
        FROM
            MDL_NM MN
        WHERE
                MN.T_GLBL_CMPY_CD = #glblCmpyCd#
            AND MN.T_MDL_NM = #mdlDescTxt#
            AND MN.EZCANCELFLAG = '0'
    </statement>
    <statement id="checkMdseCdFromAllMdseV" parameterClass="Map" resultClass="Map">
        SELECT
            M.MDSE_CD
        FROM
            ALL_MDSE_V M
        WHERE
                M.GLBL_CMPY_CD = #glblCmpyCd#
            AND M.MDSE_CD      = #mdseCd#
            AND M.EZCANCELFLAG = '0'
    </statement>
    <statement id="checkMachSerNum" parameterClass="Map" resultClass="Map">
        SELECT
            SMM.SVC_MACH_MSTR_PK
        FROM
            SVC_MACH_MSTR SMM
        WHERE
                SMM.GLBL_CMPY_CD = #glblCmpyCd#
            AND SMM.SER_NUM      = #serNum#
            AND SMM.MDSE_CD      = #mdseCd#
            AND SMM.EZCANCELFLAG = '0'
    </statement>
    <statement id="checkBillToCustAndBillToAccnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            BILL_TO_CUST BC
        WHERE
                BC.GLBL_CMPY_CD = #glblCmpyCd#
            AND BC.BILL_TO_CUST_CD = #billToCustCd#
            AND BC.RGTN_STS_CD = #rgtnStsCdReadyForOrdTake#
            AND BC.SELL_TO_CUST_CD = #billToCustAcctCd#
            AND BC.EZCANCELFLAG = '0'
    </statement>
    <statement id="checkShipToCustAndAhipToAccnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            SHIP_TO_CUST SH
        WHERE
                SH.GLBL_CMPY_CD = #glblCmpyCd#
            AND SH.SHIP_TO_CUST_CD = #shipToCustCd#
            AND SH.SELL_TO_CUST_CD = #shipToCustAcctCd#
            AND SH.RGTN_STS_CD = #rgtnStsCdReadyForOrdTake#
            AND SH.EZCANCELFLAG = '0'
    </statement>
    <statement id="checkSalesRepRelation" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            TOC T
            ,BIZ_AREA_ORG BAO
        WHERE
                T.GLBL_CMPY_CD = #glblCmpyCd#
            AND T.TOC_CD = #slsRepTocCd#
            AND T.EZCANCELFLAG = '0'
            AND T.GLBL_CMPY_CD = BAO.GLBL_CMPY_CD
            AND T.FIRST_ORG_CD = BAO.BIZ_ARE_ORG_CD 
            AND BAO.SLS_FLG = 'Y'
            AND BAO.ORG_STRU_TP_CD = #orgStruTpCd#
            AND BAO.EZCANCELFLAG = '0'
    </statement>
    <statement id="checkPrcListRelation" parameterClass="Map" resultClass="String">
        SELECT
            DOT.DEF_PRC_CATG_CD
        FROM
            DS_ORD_TP_PROC_DFN DOT
        WHERE
            DOT.GLBL_CMPY_CD = #glblCmpyCd#
            AND DOT.DS_ORD_TP_CD = #dsOrdTpCd#
            AND DOT.ACTV_FLG = 'Y'
            AND DOT.EFF_FROM_DT <![CDATA[<=]]> #slsDate#
<!-- START 2016/10/27 N.Arai [QC#14840, MOD] -->
            AND NVL(DOT.EFF_THRU_DT,#slsDate#) <![CDATA[>=]]> #slsDate#
<!-- END 2016/10/27 N.Arai [QC#14840, MOD] -->
    </statement>
    <statement id="checkCarrShpgSvcLvlAndShpgSvcLvl" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            SHPG_SVC_LVL_CARR_RELN SSLCR
        WHERE
                SSLCR.GLBL_CMPY_CD = #glblCmpyCd#
            AND SSLCR.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
            AND SSLCR.CARR_SVC_LVL_CD = #carrSvcLvlCd#
            AND SSLCR.EZCANCELFLAG = '0'
    </statement>
    <statement id="checkFrtCondRelation" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            FRT_COND_SVC_LVL_RELN FCSLR
        WHERE
                FCSLR.GLBL_CMPY_CD = #glblCmpyCd#
            AND FCSLR.LINE_BIZ_TP_CD = #lineBizTpCd#
            AND FCSLR.FRT_COND_CD = #frtCondCd#
            AND FCSLR.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
            AND FCSLR.CARR_SVC_LVL_CD = #carrSvcLvlCd#
            AND FCSLR.EZCANCELFLAG = '0'
    </statement>
    <statement id="checkCSMPNum" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            CSMP_CONTR CC
        WHERE
                CC.GLBL_CMPY_CD = #glblCmpyCd#
            <isNotNull property="csmpNum">
                AND CC.CSMP_NUM = #csmpNum#
            </isNotNull>
            <isNotNull property="dlrRefNum">
                AND CC.DLR_REF_NUM = #dlrRefNum#
            </isNotNull>
            AND CC.DS_ACCT_NUM = #soldToAcctNum#
            AND CC.EZCANCELFLAG = '0'
    </statement>
    <statement id="checkCustMdseAndMdse" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            CUST_MDSE_XREF CMX
        WHERE
            CMX.GLBL_CMPY_CD = #glblCmpyCd#
            AND CMX.MDSE_CD = #mdseCd#
            AND CMX.CUST_MDSE_CD = #custMdseCd#
            AND CMX.DS_ACCT_NUM = #sellToCustCd#
            AND CMX.CUST_MDSE_XREF_ENBL_FLG = 'Y'
            AND CMX.EZCANCELFLAG = '0'
    </statement>
    <statement id="getCcyCdByPriceCatgNm" parameterClass="Map" resultClass="Map">
        SELECT
            PC.PRC_CATG_CD
            ,PC.CCY_CD
        FROM
            PRC_CATG PC
        WHERE
                PC.GLBL_CMPY_CD         = #glblCmpyCd#
            AND UPPER(PC.PRC_CATG_NM)   = UPPER(#prcCatgNm#)
            AND PC.EZCANCELFLAG         = '0'
    </statement>
    <!-- statement id="checkRtlWhWithName" parameterClass="Map" resultClass="Map">
        SELECT
            RTL_WH_CD
            ,RTL_WH_NM
        FROM
            RTL_WH
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
            AND UPPER(RTL_WH_NM) = UPPER(#rtlWhNm#)
            AND EZCANCELFLAG = '0'
    </statement -->
    <statement id="checkRtlSubWhWithName" parameterClass="Map" resultClass="Map">
        SELECT
            RTL_WH_CD
            ,RTL_SWH_CD
            ,RTL_SWH_NM
        FROM
            DS_INVTY_LOC_V
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
            AND UPPER(RTL_WH_CD) = UPPER(#rtlWhCd#)
            AND UPPER(RTL_SWH_NM) = UPPER(#rtlSWhNm#)
            AND EZCANCELFLAG = '0'
    </statement>
    <statement id="checkFutureRddOrCriticEss" parameterClass="Map" resultClass="Map">
        SELECT
            ORD_CATG_CTX_TP_CD
        FROM
            ORD_CATG_BIZ_CTX
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
            AND (
                    (
                        DS_ORD_CATG_CD = #dsOrdCatgCd#
                        AND DS_ORD_TP_CD = #dsOrdTpCd#
                    )
                    OR
                    (
                        DS_ORD_CATG_CD = #dsOrdCatgCd#
                        AND DS_ORD_TP_CD IS NULL
                    )
            <iterate property="ordCatgCtxTpCdList" var="ordCatgCtxTpCd[]" open=" AND ORD_CATG_CTX_TP_CD IN (" close=")" conjunction=",">
                #ordCatgCtxTpCd[]#
            </iterate>
            )
            AND EZCANCELFLAG = '0'
    </statement>
    <statement id="getDsConfigPkForAlloc" parameterClass="Map" resultClass="Map">
        SELECT
            DCC.DS_CPO_CONFIG_PK
            ,DCC.BILL_TO_CUST_LOC_CD
        FROM
            DS_CPO_CONFIG DCC
        WHERE
            DCC.GLBL_CMPY_CD = #glblCmpyCd#
            AND DCC.CPO_ORD_NUM = #cpoOrdNum#
            AND DCC.CONFIG_CATG_CD = #configCatgOutbound#
            AND DCC.EZCANCELFLAG = '0'
        ORDER BY
            DCC.DS_CPO_CONFIG_PK
    </statement>
    <statement id="getSvcMachMaintFlg" parameterClass="Map" resultClass="Map">
        SELECT
            SMM.SVC_MACH_MAINT_AVAL_FLG
            ,SMM.SVC_MACH_MSTR_PK
        FROM
            SVC_MACH_MSTR SMM
        WHERE
            SMM.GLBL_CMPY_CD = #glblCmpyCd#
            AND SMM.SER_NUM = #serNum#
            <!-- AND SMM.MDSE_CD = #mdseCd# -->
            AND SMM.EZCANCELFLAG = '0'
    </statement>
    <statement id="getBizProcLogPK" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            BPL.BIZ_PROC_LOG_PK
        FROM
            BIZ_PROC_LOG BPL
        WHERE
            BPL.EZCANCELFLAG = '0'
            AND BPL.SUB_SYS_ID = #subSysID#
            AND BPL.PROC_ID = #procId#
            AND BPL.EVENT_ID = #eventId#
            AND BPL.DOC_TP_CD = #docTpCd#
            AND BPL.DOC_ID IS NULL
            AND BPL.PRNT_DOC_ID = #prntDocId#
            AND BPL.EZUPUSERID = #ezUpUsrId#
            AND BPL.EZUPTIMEZONE = #ezUpTimeZone#
            AND BPL.EZUPTIME &gt;= #ezUpTime# 
    </statement>
    <statement id="getRtlWh" parameterClass="Map" resultClass="Map">
        SELECT 
             DILV.RTL_WH_CD
            ,DILV.RTL_SWH_CD 
        FROM 
            DS_INVTY_LOC_V DILV 
        WHERE 
                DILV.EZCANCELFLAG   = '0' 
            AND DILV.GLBL_CMPY_CD   = #glblCmpyCd# 
            AND UPPER(DILV.RTL_WH_NM)    = UPPER(#rtlWhNm#) 
            <isNotNull property="rtlSwhNm">
            AND DILV.RTL_SWH_NM          = #rtlSwhNm#
            </isNotNull>
            <isNotNull property="rgtnStsCd">
            AND DILV.RGTN_STS_CD         = #rgtnStsCd#
            </isNotNull>
            <isNotNull property="slsDt">
            AND DILV.EFF_FROM_DT  <![CDATA[<=]]> #slsDt#
            AND NVL(DILV.EFF_THRU_DT, '99991231') <![CDATA[>=]]> #slsDt#
            </isNotNull>
    </statement>
    <statement id="checkSalesRep" parameterClass="Map" resultClass="Map">
        SELECT
            T.TOC_CD
           ,T.TOC_NM 
           ,CB.COA_BR_CD         AS COA_BR_CD
           ,CB.COA_BR_DESC_TXT   AS COA_BR_DESC_TXT
           ,CE.COA_EXTN_CD       AS COA_EXTN_CD
           ,CE.COA_EXTN_DESC_TXT AS COA_EXTN_DESC_TXT
           ,(CASE
                  WHEN CB.COA_BR_CD IS NOT NULL
                  THEN CB.COA_BR_CD || ':' || CB.COA_BR_DESC_TXT
             END) AS COA_BR_ITEM
           ,(CASE
                  WHEN CE.COA_EXTN_CD IS NOT NULL
                  THEN CE.COA_EXTN_CD || ':' || CE.COA_EXTN_DESC_TXT
             END) AS COA_EXTN_ITEM
        FROM
            TOC T
           ,ORG_FUNC_ROLE_TP OFRT
           ,BIZ_AREA_ORG BA 
           ,COA_BR   CB
           ,COA_EXTN CE
        WHERE
                T.GLBL_CMPY_CD        = #glblCmpyCd#
            AND T.TOC_CD              = #slsRepCd#
            AND T.EZCANCELFLAG        = '0'
            AND T.GLBL_CMPY_CD        = OFRT.GLBL_CMPY_CD
            AND T.ORG_FUNC_ROLE_TP_CD = OFRT.ORG_FUNC_ROLE_TP_CD
            AND OFRT.SLS_REP_FLG      = #flgOnY#
            AND OFRT.EZCANCELFLAG     = '0'
            AND OFRT.GLBL_CMPY_CD     = BA.GLBL_CMPY_CD
            AND OFRT.FIRST_ORG_CD     = BA.BIZ_AREA_ORG_CD
            AND BA.SLS_FLG            = #flgOnY#
            AND BA.ORG_STRU_TP_CD     = #orgStruTpCd#
            AND BA.EZCANCELFLAG       = '0'

            AND T.GLBL_CMPY_CD        = CB.GLBL_CMPY_CD (+)
            AND T.COA_BR_CD           = CB.COA_BR_CD (+)
            AND CB.EZCANCELFLAG (+)   = '0'

            AND T.GLBL_CMPY_CD        = CE.GLBL_CMPY_CD (+)
            AND T.COA_EXTN_CD         = CE.COA_EXTN_CD (+)
            AND CE.EZCANCELFLAG (+)   = '0'
    </statement>
    <statement id="getDsAcpo" parameterClass="Map" resultClass="String">
        <isNotNull property="svcMachMstrPk">
        SELECT
            C.DS_ACPO_NUM
        FROM
             DS_CONTR     A
            ,DS_CONTR_DTL B
            ,DS_ACPO      C
        WHERE
                A.GLBL_CMPY_CD       = #glblCmpyCd#
            AND A.EZCANCELFLAG       = '0'
            AND A.DS_CONTR_NUM       = #dsContrNum#
            AND A.DS_CONTR_CATG_CD   &lt;&gt; #dsContrCatgFleet#
            AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK        = B.DS_CONTR_PK
            AND B.EZCANCELFLAG       = '0'
            AND B.SVC_MACH_MSTR_PK   = #svcMachMstrPk#
            AND B.GLBL_CMPY_CD       = C.GLBL_CMPY_CD
            AND B.DS_CONTR_DTL_PK    = C.DS_CONTR_DTL_PK
            AND C.EZCANCELFLAG       = '0'
        </isNotNull>
        <isNull property="svcMachMstrPk">
        SELECT
            C.DS_ACPO_NUM
        FROM
             DS_CONTR     A
            ,DS_CONTR_DTL B
            ,DS_ACPO      C
        WHERE
                A.GLBL_CMPY_CD       = #glblCmpyCd#
            AND A.EZCANCELFLAG       = '0'
            AND A.DS_CONTR_NUM       = #dsContrNum#
            AND A.DS_CONTR_CATG_CD   = #dsContrCatgFleet#
            AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK        = B.DS_CONTR_PK
            AND B.EZCANCELFLAG       = '0'
            AND B.DS_CONTR_DTL_TP_CD = #dsContrDtlTpFleet#
            AND B.GLBL_CMPY_CD       = C.GLBL_CMPY_CD
            AND B.DS_CONTR_DTL_PK    = C.DS_CONTR_DTL_PK
            AND C.EZCANCELFLAG       = '0'
        </isNull>
    </statement>
    <statement id="getDsAcpoDtl" parameterClass="Map" resultClass="BigDecimal">
        <isNotNull property="svcMachMstrPk">
        SELECT
            COUNT(*)
        FROM
             DS_CONTR         A
            ,DS_CONTR_DTL     B
            ,DS_ACPO          C
            ,DS_ACPO_TRGT_DTL D
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.DS_CONTR_NUM      = #dsContrNum#
            AND A.DS_CONTR_CATG_CD   &lt;&gt; #dsContrCatgFleet#
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK       = B.DS_CONTR_PK
            AND B.EZCANCELFLAG      = '0'
            AND B.SVC_MACH_MSTR_PK  = #svcMachMstrPk#
            AND B.GLBL_CMPY_CD      = C.GLBL_CMPY_CD
            AND B.DS_CONTR_DTL_PK   = C.DS_CONTR_DTL_PK
            AND C.EZCANCELFLAG      = '0'
            AND C.GLBL_CMPY_CD      = D.GLBL_CMPY_CD
            AND C.DS_ACPO_NUM       = D.DS_ACPO_NUM
            AND D.EZCANCELFLAG      = '0'
            AND D.MDSE_CD           = #mdseCd#
        </isNotNull>
        <isNull property="svcMachMstrPk">
        SELECT
            COUNT(*)
        FROM
             DS_CONTR     A
            ,DS_CONTR_DTL B
            ,DS_ACPO      C
            ,DS_ACPO_TRGT_DTL D
        WHERE
                A.GLBL_CMPY_CD       = #glblCmpyCd#
            AND A.EZCANCELFLAG       = '0'
            AND A.DS_CONTR_NUM       = #dsContrNum#
            AND A.DS_CONTR_CATG_CD   = #dsContrCatgFleet#
            AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK        = B.DS_CONTR_PK
            AND B.EZCANCELFLAG       = '0'
            AND B.DS_CONTR_DTL_TP_CD = #dsContrDtlTpFleet#
            AND B.GLBL_CMPY_CD       = C.GLBL_CMPY_CD
            AND B.DS_CONTR_DTL_PK    = C.DS_CONTR_DTL_PK
            AND C.EZCANCELFLAG       = '0'
            AND C.GLBL_CMPY_CD      = D.GLBL_CMPY_CD
            AND C.DS_ACPO_NUM       = D.DS_ACPO_NUM
            AND D.EZCANCELFLAG      = '0'
            AND D.MDSE_CD           = #mdseCd#
        </isNull>
    </statement>
    <statement id="getNextDsAcpoTrgtLineNum" parameterClass="Map" resultClass="String">
        SELECT
            TO_CHAR(NVL(MAX(TO_NUMBER(DS_ACPO_TRGT_LINE_NUM)), 0) + #dsAcpoTrgtLineNum#, 'FM000')
        FROM
            DS_ACPO_TRGT_DTL A
        WHERE
                A.GLBL_CMPY_CD    =   #glblCmpyCd#
            AND A.EZCANCELFLAG    =   '0'
            AND A.DS_ACPO_NUM     =   #dsAcpoNum#
    </statement>
</sqlMap>
