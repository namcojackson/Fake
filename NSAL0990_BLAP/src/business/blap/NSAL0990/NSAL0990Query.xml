<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL0990Query">
    <statement id="getSvcMachMstr" parameterClass="Map" resultClass="Map">
        SELECT
             SMM.SER_NUM                        SER_NUM
            ,MNM.T_MDL_ID                       T_MDL_ID
            ,MNM.T_MDL_NM                       T_MDL_NM
            ,SMM.FIN_BR_CD                      FIN_BR_CD
            ,CBR.COA_BR_NM                      COA_BR_NM
            ,SMM.SVC_CONFIG_MSTR_PK             SVC_CONFIG_MSTR_PK
            ,SMM.SVC_BY_LINE_BIZ_TP_CD          SVC_BY_LINE_BIZ_TP_CD
            ,SMM.OWNR_ACCT_NUM                  OWNR_ACCT_NUM
            ,SMM.OWNR_LOC_NUM                   OWNR_LOC_NUM
            ,SMM.BILL_TO_ACCT_NUM               BILL_TO_ACCT_NUM
            ,SMM.BILL_TO_LOC_NUM                BILL_TO_LOC_NUM
            ,SMM.CUR_LOC_ACCT_NUM               CUR_LOC_ACCT_NUM
            ,SMM.CUR_LOC_NUM                    CUR_LOC_NUM
<!-- add start 2016/10/20 CSA Defect#15323 -->
<!-- START 2018/09/10 K.Kitachi [QC#26260, MOD] -->
            <!-- ,SCB.TOC_CD                         TOC_CD -->
            ,NVL(SCB2.TOC_CD, SCB.TOC_CD)       TOC_CD
<!-- END 2018/09/10 K.Kitachi [QC#26260, MOD] -->
<!-- add end 2016/10/20 CSA Defect#15323 -->
<!-- START 2018/09/10 K.Kitachi [QC#26260, ADD] -->
            ,SMM.SLD_BY_LINE_BIZ_TP_CD          SLD_BY_LINE_BIZ_TP_CD
<!-- END 2018/09/10 K.Kitachi [QC#26260, ADD] -->
        FROM
             SVC_MACH_MSTR          SMM
            ,SVC_CONFIG_MSTR        SCM
            ,MDL_NM                 MNM
            ,COA_BR                 CBR
<!-- add start 2016/10/20 CSA Defect#15323 -->
            ,SUB_CONTR_BR_MAP       SCB
<!-- add end 2016/10/20 CSA Defect#15323 -->
<!-- START 2018/09/10 K.Kitachi [QC#26260, ADD] -->
            ,SUB_CONTR_BR_MAP       SCB2
<!-- END 2018/09/10 K.Kitachi [QC#26260, ADD] -->
        WHERE
                SMM.GLBL_CMPY_CD          = #glblCmpyCd#
            AND SMM.SVC_MACH_MSTR_PK      = #svcMachMstrPk#
            AND SMM.EZCANCELFLAG          = '0'
            AND SMM.SVC_CONFIG_MSTR_PK    = SCM.SVC_CONFIG_MSTR_PK
            AND SMM.GLBL_CMPY_CD          = SCM.GLBL_CMPY_CD
            AND SCM.EZCANCELFLAG          = '0'
            AND SCM.MDL_ID                = MNM.T_MDL_ID
            AND SCM.GLBL_CMPY_CD          = MNM.T_GLBL_CMPY_CD
            AND MNM.EZCANCELFLAG          = '0'
            AND SMM.FIN_BR_CD             = CBR.COA_BR_CD(+)
            AND SMM.GLBL_CMPY_CD          = CBR.GLBL_CMPY_CD(+)
            AND CBR.EZCANCELFLAG(+)       = '0'
<!-- add start 2016/10/20 CSA Defect#15323 -->
            AND SMM.FIN_BR_CD             = SCB.SVC_CONTR_BR_CD(+)
            AND SMM.GLBL_CMPY_CD          = SCB.GLBL_CMPY_CD(+)
<!-- START 2018/01/09 M.Kidokoro [QC#20635,ADD] -->
            AND SMM.SVC_BY_LINE_BIZ_TP_CD = SCB.SVC_LINE_BIZ_CD(+)
<!-- END 2018/01/09 M.Kidokoro [QC#20635,ADD] -->
            AND SCB.ENBL_FLG(+)           = 'Y'
            AND SCB.EZCANCELFLAG(+)       = '0'
<!-- add end 2016/10/20 CSA Defect#15323 -->
<!-- START 2018/09/10 K.Kitachi [QC#26260, ADD] -->
            AND SMM.FIN_BR_CD             = SCB2.SVC_CONTR_BR_CD(+)
            AND SMM.GLBL_CMPY_CD          = SCB2.GLBL_CMPY_CD(+)
            AND SMM.SLD_BY_LINE_BIZ_TP_CD = SCB2.SVC_LINE_BIZ_CD(+)
            AND SCB2.ENBL_FLG(+)          = 'Y'
            AND SCB2.EZCANCELFLAG(+)      = '0'
<!-- END 2018/09/10 K.Kitachi [QC#26260, ADD] -->
    </statement>
    <statement id="getDsContr" parameterClass="Map" resultClass="Map">
<!-- mod start 2016/09/21 CSA Defect#13267 -->
        SELECT
             HDR.DS_CONTR_PK                    DS_CONTR_PK
            ,HDR.DS_CONTR_NUM                   DS_CONTR_NUM
            ,HDR.DS_ACCT_NUM                    DS_ACCT_NUM
            ,NVL(DTL.SVC_PGM_MDSE_CD, PRNTDTL.SVC_PGM_MDSE_CD)
                                                SVC_PGM_MDSE_CD
            ,HDR.CCY_CD                         CCY_CD
            ,HDR.TOC_CD                         TOC_CD
            ,HDR.SVC_CONTR_BR_CD                SVC_CONTR_BR_CD
            ,CBR.COA_BR_NM                      COA_BR_NM
            ,NVL(MDS.MDSE_DESC_SHORT_TXT, PRNTMDS.MDSE_DESC_SHORT_TXT)
                                                MDSE_DESC_SHORT_TXT
            ,DCC.DS_CONTR_CATG_DESC_TXT         DS_CONTR_CATG_DESC_TXT
            ,DCC.DS_CONTR_CATG_CD               DS_CONTR_CATG_CD
            ,HDR.SVC_LINE_BIZ_CD                SVC_LINE_BIZ_CD
            <!-- START 2018/01/15 K.Kojima [QC#23214,ADD] -->
            ,DCCLS.HDR_REP_USE_FLG              HDR_REP_USE_FLG
            <!-- END 2018/01/15 K.Kojima [QC#23214,ADD] -->
        FROM
             DS_CONTR_DTL           DTL
            ,DS_CONTR               HDR
            ,DS_CONTR_CATG          DCC
            ,MDSE                   MDS
            ,COA_BR                 CBR
            ,DS_CONTR_DTL           PRNTDTL
            ,MDSE                   PRNTMDS
            <!-- START 2018/01/15 K.Kojima [QC#23214,ADD] -->
            ,DS_CONTR_CLS           DCCLS
            <!-- END 2018/01/15 K.Kojima [QC#23214,ADD] -->
        WHERE
                DTL.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DTL.DS_CONTR_DTL_PK     = #dsContrDtlPk#
            AND DTL.EZCANCELFLAG        = '0'
            AND DTL.DS_CONTR_PK         = HDR.DS_CONTR_PK
            AND DTL.GLBL_CMPY_CD        = HDR.GLBL_CMPY_CD
            AND HDR.EZCANCELFLAG        = '0'
            AND HDR.DS_CONTR_CATG_CD    = DCC.DS_CONTR_CATG_CD
            AND HDR.GLBL_CMPY_CD        = DCC.GLBL_CMPY_CD
            AND DCC.EZCANCELFLAG        = '0'
            AND DTL.SVC_PGM_MDSE_CD     = MDS.MDSE_CD(+)
            AND DTL.GLBL_CMPY_CD        = MDS.GLBL_CMPY_CD(+)
            AND MDS.EZCANCELFLAG(+)     = '0'
            AND HDR.SVC_CONTR_BR_CD     = CBR.COA_BR_CD(+)
            AND HDR.GLBL_CMPY_CD        = CBR.GLBL_CMPY_CD(+)
            AND CBR.EZCANCELFLAG(+)     = '0'
            AND DTL.PRNT_DS_CONTR_DTL_PK
                                        = PRNTDTL.DS_CONTR_DTL_PK(+)
            AND DTL.GLBL_CMPY_CD        = PRNTDTL.GLBL_CMPY_CD(+)
            AND PRNTDTL.EZCANCELFLAG(+) = '0'
            AND PRNTDTL.SVC_PGM_MDSE_CD = PRNTMDS.MDSE_CD(+)
            AND PRNTDTL.GLBL_CMPY_CD    = PRNTMDS.GLBL_CMPY_CD(+)
            AND PRNTMDS.EZCANCELFLAG(+) = '0'
            <!-- START 2018/01/15 K.Kojima [QC#23214,ADD] -->
            AND HDR.GLBL_CMPY_CD        = DCCLS.GLBL_CMPY_CD
            AND HDR.DS_CONTR_CLS_CD     = DCCLS.DS_CONTR_CLS_CD
            AND DCCLS.EZCANCELFLAG      = '0'
            <!-- END 2018/01/15 K.Kojima [QC#23214,ADD] -->
<!-- mod end 2016/09/21 CSA Defect#13267 -->
    </statement>
    <statement id="getSvcTermAttrbMapValCd" parameterClass="Map" resultClass="String">
        SELECT
            NVL(DTL_COND.SVC_TERM_ATTRB_MAP_VAL_CD, CONTR_COND.SVC_TERM_ATTRB_MAP_VAL_CD)
                                                SVC_TERM_ATTRB_MAP_VAL_CD
        FROM
             SVC_TERM_COND_ATTRB    TCA
            ,SVC_TERM_COND          DTL_COND
            ,SVC_TERM_COND          CONTR_COND
        WHERE
                TCA.GLBL_CMPY_CD                = #glblCmpyCd#
            <isNotNull property="svcTermCondAttrbNm">
            AND TCA.SVC_TERM_COND_ATTRB_NM      = #svcTermCondAttrbNm#
            </isNotNull>
            AND TCA.EFF_FROM_DT             &lt;= #slsDt#
            AND (TCA.EFF_THRU_DT            &gt;= #slsDt#
            OR   TCA.EFF_THRU_DT               IS NULL)
            AND TCA.EZCANCELFLAG                = '0'
            AND TCA.SVC_TERM_COND_ATTRB_PK      = DTL_COND.SVC_TERM_COND_ATTRB_PK(+)
            AND TCA.GLBL_CMPY_CD                = DTL_COND.GLBL_CMPY_CD(+)
            AND DTL_COND.DS_CONTR_DTL_PK(+)     = #dsContrDtlPk#
            AND DTL_COND.EZCANCELFLAG(+)        = '0'
            AND TCA.SVC_TERM_COND_ATTRB_PK      = CONTR_COND.SVC_TERM_COND_ATTRB_PK(+)
            AND TCA.GLBL_CMPY_CD                = CONTR_COND.GLBL_CMPY_CD(+)
            AND CONTR_COND.DS_CONTR_PK(+)       = #dsContrPk#
            AND CONTR_COND.DS_CONTR_DTL_PK(+)   IS NULL <!-- 2018/06/04 H.Nagashima [QC#25966,ADD] -->
            AND CONTR_COND.EZCANCELFLAG(+)      = '0'
    </statement>
    <statement id="getSvcTermCondDataDispTxt" parameterClass="Map" resultClass="String">
        SELECT
            <isEqual property="fltFlg" compareValue="N">
            NVL(DTL_COND.SVC_TERM_COND_DATA_DISP_TXT, CONTR_COND.SVC_TERM_COND_DATA_DISP_TXT)
            </isEqual>
            <isEqual property="fltFlg" compareValue="Y">
            CONTR_COND.SVC_TERM_COND_DATA_DISP_TXT
            </isEqual>
                                                AS  SVC_TERM_COND_DATA_DISP_TXT
        FROM
             SVC_TERM_COND_ATTRB    TCA
            ,(SELECT
                   TCN.SVC_TERM_COND_ATTRB_PK
                  ,TCD.SVC_TERM_COND_DATA_SRC_CD
                  ,TCD.SVC_TERM_COND_DATA_DISP_TXT  
              FROM
                   SVC_TERM_COND          TCN
                  ,SVC_TERM_COND_DATA_SRC TCD
              WHERE
                      TCN.GLBL_CMPY_CD                = #glblCmpyCd#
                  AND TCN.DS_CONTR_DTL_PK             = #dsContrDtlPk#
                  AND TCN.EZCANCELFLAG                = '0'
                  AND TCN.GLBL_CMPY_CD                = TCD.GLBL_CMPY_CD
                  AND TCN.SVC_TERM_ATTRB_MAP_VAL_CD   = TCD.SVC_TERM_COND_DATA_VAL_CD
                  AND TCD.EZCANCELFLAG                = '0'
             ) DTL_COND
            ,(SELECT
                   TCN.SVC_TERM_COND_ATTRB_PK
                  ,TCD.SVC_TERM_COND_DATA_SRC_CD
                  ,TCD.SVC_TERM_COND_DATA_DISP_TXT  
              FROM
                   SVC_TERM_COND          TCN
                  ,SVC_TERM_COND_DATA_SRC TCD
              WHERE
                      TCN.GLBL_CMPY_CD                = #glblCmpyCd#
                  AND TCN.DS_CONTR_PK                 = #dsContrPk#
                  AND TCN.DS_CONTR_DTL_PK             IS NULL
                  AND TCN.EZCANCELFLAG                = '0'
                  AND TCN.GLBL_CMPY_CD                = TCD.GLBL_CMPY_CD
                  AND TCN.SVC_TERM_ATTRB_MAP_VAL_CD   = TCD.SVC_TERM_COND_DATA_VAL_CD
                  AND TCD.EZCANCELFLAG                = '0'
             ) CONTR_COND
        WHERE
                TCA.GLBL_CMPY_CD                = #glblCmpyCd#
            <isNotNull property="svcTermCondAttrbNm">
            AND TCA.SVC_TERM_COND_ATTRB_NM      = #svcTermCondAttrbNm#
            </isNotNull>
            AND TCA.EFF_FROM_DT             &lt;= #slsDt#
            AND (TCA.EFF_THRU_DT            &gt;= #slsDt#
            OR   TCA.EFF_THRU_DT               IS NULL)
            AND TCA.EZCANCELFLAG                = '0'
            AND TCA.SVC_TERM_COND_ATTRB_PK      = DTL_COND.SVC_TERM_COND_ATTRB_PK(+)
            AND TCA.SVC_TERM_COND_DATA_SRC_CD   = DTL_COND.SVC_TERM_COND_DATA_SRC_CD(+)
            AND TCA.SVC_TERM_COND_ATTRB_PK      = CONTR_COND.SVC_TERM_COND_ATTRB_PK(+)
            AND TCA.SVC_TERM_COND_DATA_SRC_CD   = CONTR_COND.SVC_TERM_COND_DATA_SRC_CD(+)
    </statement>
    <statement id="getOrderHistory" parameterClass="Map" resultClass="Map">
        SELECT
             SUBSTR(HDR.CPO_ORD_TS, 1, 8)       CPO_ORD_DT
            ,HDR.CPO_ORD_NUM                    CPO_ORD_NUM
            ,DTL.MDSE_CD                        MDSE_CD
            ,AMV.MDSE_DESC_SHORT_TXT            MDSE_DESC_SHORT_TXT
            ,DTL.ORD_QTY                        ORD_QTY
            ,CASE
                 WHEN HDR.OPEN_FLG = 'Y'
                 THEN
                    CASE
                       WHEN HDR.SUBMT_FLG = 'N'
                       THEN
                          CASE
                             WHEN     HDR.DI_CHK_HLD_FLG = 'Y'
                                  AND HDR.ORD_BOOK_REQ_TS IS NOT NULL
                             THEN
                                'DI CHECK HOLD'
                             ELSE
                                'ENTERED'
                          END
                       WHEN HDR.DI_CHK_HLD_FLG = 'Y'
                       THEN
                          'DI CHECK HOLD'
                       WHEN     HDR.CPO_HLD_FLG = 'Y'
                            AND HDR.WF_REJ_FLG = 'N'
                            AND EXISTS
                                   (SELECT 1
                                      FROM hld h
                                     WHERE     h.CPO_ORD_NUM =
                                                  HDR.CPO_ORD_NUM
                                           AND h.GLBL_CMPY_CD =
                                                  HDR.GLBL_CMPY_CD
                                           AND h.HLD_RSN_CD = 'W01'
                                           AND h.REL_FLG = 'N'
                                           AND h.EZCANCELFLAG = '0')
                       THEN
                          'VALIDATION HOLD'
                       WHEN     HDR.CPO_HLD_FLG = 'Y'
                            AND HDR.WF_REJ_FLG = 'N'
                            AND EXISTS
                                   (SELECT 1
                                      FROM hld h
                                     WHERE     h.CPO_ORD_NUM =
                                                  HDR.CPO_ORD_NUM
                                           AND h.GLBL_CMPY_CD =
                                                  HDR.GLBL_CMPY_CD
                                           AND h.HLD_RSN_CD IN ('W02',
                                                                'W03',
                                                                'W04',
                                                                'W05')
                                           AND h.REL_FLG = 'N'
                                           AND h.EZCANCELFLAG = '0')
                       THEN
                          'SUPPLY ABUSE HOLD'
                       WHEN     HDR.CPO_HLD_FLG = 'Y'
                            AND HDR.WF_REJ_FLG = 'N'
                            AND EXISTS
                                   (SELECT 1
                                      FROM hld h
                                     WHERE     h.CPO_ORD_NUM =
                                                  HDR.CPO_ORD_NUM
                                           AND h.GLBL_CMPY_CD =
                                                  HDR.GLBL_CMPY_CD
                                           AND h.HLD_RSN_CD = 'W06'
                                           AND h.REL_FLG = 'N'
                                           AND h.EZCANCELFLAG = '0')
                       THEN
                          'PROFITABILITY HOLD'
                       WHEN     HDR.WF_REJ_FLG = 'N'
                            AND EXISTS
                                   (SELECT 1
                                      FROM shpg_pln sp2
                                     WHERE     sp2.GLBL_CMPY_CD =
                                                  HDR.GLBL_CMPY_CD
                                           AND sp2.TRX_HDR_NUM =
                                                  HDR.CPO_ORD_NUM
                                           AND sp2.CR_HLD_QTY > 0
                                           AND sp2.EZCANCELFLAG = '0')
                       THEN
                          'CREDIT HOLD'
                       WHEN HDR.CPO_HLD_FLG = 'Y' AND HDR.WF_REJ_FLG = 'Y'
                       THEN
                          'PENDING RE-SUBMISSION'
                       WHEN HDR.ORD_BOOK_FLG = 'Y'
                       THEN
                          'BOOKED'
                       ELSE
                          'TBD'                                     -- TBD
                    END
                 WHEN HDR.OPEN_FLG = 'N'
                 THEN
                    CASE
                       WHEN HDR.ORD_HDR_STS_CD = '90' THEN 'CLOSED'
                       WHEN HDR.ORD_HDR_STS_CD = '99' THEN 'CANCELLED'
                    END
             END                     AS                 ORD_LINE_STS_NM
        FROM
             CPO_DTL                DTL
            ,CPO                    HDR
            ,ALL_MDSE_V             AMV
        WHERE
                DTL.GLBL_CMPY_CD                = #glblCmpyCd#
<!-- mod start 2016/10/04 CSA Defect#12898 -->
            AND (    DTL.SVC_CONFIG_MSTR_PK     = #svcConfigMstrPk#
                 OR (    DTL.SVC_CONFIG_MSTR_PK IS NULL
                     AND DTL.DS_CONTR_NUM       = #dsContrNum#)
                )
<!-- mod end 2016/10/04 CSA Defect#12898 -->
            AND DTL.ORD_LINE_STS_CD      &lt;&gt; #ordLineStsCd#
            <isNotNull property="targetDt">
            AND SUBSTR(DTL.EZINTIME, 1, 8)  &gt;= #targetDt#
            </isNotNull>
            AND DTL.EZCANCELFLAG                = '0'
            AND DTL.CPO_ORD_NUM                 = HDR.CPO_ORD_NUM
            AND DTL.GLBL_CMPY_CD                = HDR.GLBL_CMPY_CD
            AND HDR.DS_ORD_CATG_CD              = #dsOrdCatgCd#
            AND HDR.EZCANCELFLAG                = '0'
            AND DTL.MDSE_CD                     = AMV.MDSE_CD
            AND DTL.GLBL_CMPY_CD                = AMV.GLBL_CMPY_CD
            AND AMV.EZCANCELFLAG                = '0'
        ORDER BY
                HDR.CPO_ORD_TS          DESC
               ,HDR.CPO_ORD_NUM         DESC
               ,DTL.MDSE_CD             ASC
    </statement>
    <statement id="getLineDetailForSupplyOrder" parameterClass="Map" resultClass="Map">
<!-- START 2017/05/09 K.Kitachi [QC#18277, MOD] -->
        SELECT
             MDSE_CD
            ,MDSE_DESC_SHORT_TXT
            ,CPO_MIN_ORD_QTY
            ,IMG_SPLY_COLOR_TP_CD
            ,IMG_SPLY_COLOR_TP_NM
            ,BLACK_COLOR_FLG
            ,IN_POUND_WT
<!-- START 2017/12/05 M.Kidokoro [QC#21992, ADD] -->
            ,IMG_SPLY_OEM_CD
<!-- END 2017/12/05 M.Kidokoro [QC#21992, ADD] -->
<!-- START 2018/05/15 T.Wada [QC#24819, ADD] -->
            ,IMG_SPLY_TP_CD
<!-- START 2018/05/15 T.Wada [QC#24819, End] -->
        FROM
            (
                SELECT
                     NVL(MSR.MDSE_CD, MSR.ORD_TAKE_MDSE_CD)     MDSE_CD
                    ,MDS.MDSE_DESC_SHORT_TXT                    MDSE_DESC_SHORT_TXT
<!-- del start 2016/10/04 CSA Defect#12898 -->
<!--
                    ,NVL(
                     CASE
                        WHEN ISC.IMG_SPLY_COLOR_TP_CD = #colorTpBl#
                        THEN (
                                SELECT
                                    SSA.BW_ALLW_QTY
                                FROM
                                    SVC_SPLY_MACH_ALLW     SSA
                                WHERE
                                        SSA.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
                                    AND SSA.GLBL_CMPY_CD        = #glblCmpyCd#
                                    AND SSA.FRZ_FLG             = #frzFlg#
                                    AND SSA.EZCANCELFLAG        = '0'
                             )
                        ELSE (
                                SELECT
                                    SSA.COLOR_ALLW_QTY
                                FROM
                                    SVC_SPLY_MACH_ALLW     SSA
                                WHERE
                                        SSA.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
                                    AND SSA.GLBL_CMPY_CD        = #glblCmpyCd#
                                    AND SSA.FRZ_FLG             = #frzFlg#
                                    AND SSA.EZCANCELFLAG        = '0'
                             )
                        END
                        ,0)                             ALLW_QTY
                    ,NVL(
                     CASE
                        WHEN ISC.IMG_SPLY_COLOR_TP_CD = #colorTpBl#
                        THEN (
                                SELECT
                                    SSU.BW_USED_QTY
                                FROM
                                    SVC_SPLY_MACH_USED     SSU
                                WHERE
                                        SSU.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
                                    AND SSU.GLBL_CMPY_CD        = #glblCmpyCd#
                                    AND SSU.FRZ_FLG             = #frzFlg#
                                    AND SSU.EZCANCELFLAG        = '0'
                             )
                        ELSE (
                                SELECT
                                    SSU.COLOR_USED_QTY
                                FROM
                                    SVC_SPLY_MACH_USED     SSU
                                WHERE
                                        SSU.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
                                    AND SSU.GLBL_CMPY_CD        = #glblCmpyCd#
                                    AND SSU.FRZ_FLG             = #frzFlg#
                                    AND SSU.EZCANCELFLAG        = '0'
                             )
                        END
                        ,0)                             USED_QTY
-->
<!-- del end 2016/10/04 CSA Defect#12898 -->
                    ,MDS.CPO_MIN_ORD_QTY                CPO_MIN_ORD_QTY
                    ,ISC.IMG_SPLY_COLOR_TP_CD           IMG_SPLY_COLOR_TP_CD
                    ,ISC.IMG_SPLY_COLOR_TP_NM           IMG_SPLY_COLOR_TP_NM
                    ,ISC.BLACK_COLOR_FLG                BLACK_COLOR_FLG
                    ,MSP.IN_POUND_WT                    IN_POUND_WT
<!-- START 2017/12/05 M.Kidokoro [QC#21992, ADD] -->
                    ,MDS.IMG_SPLY_OEM_CD                IMG_SPLY_OEM_CD
<!-- END 2017/12/05 M.Kidokoro [QC#21992, ADD] -->
<!-- START 2018/05/15 T.Wada [QC#24819, ADD] -->
                    ,MDS.IMG_SPLY_TP_CD
<!-- START 2018/05/15 T.Wada [QC#24819, End] -->
                FROM
                     DS_MDL_SPLY_RELN       MSR
                    ,MDSE                   MDS
                    ,IMG_SPLY_COLOR_TP      ISC
                    ,MDSE_STORE_PKG         MSP
                    ,ORD_TAKE_MDSE          OTM
                WHERE
                        MSR.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND MSR.MDL_ID                = #mdlId#
                    AND MSR.EFF_FROM_DT       &lt;= #slsDt#
                    AND NVL(MSR.EFF_THRU_DT, '99991231') &gt;= #slsDt#
                    AND MSR.EZCANCELFLAG          = '0'
                    AND MSR.GLBL_CMPY_CD          = OTM.GLBL_CMPY_CD(+)
                    AND MSR.ORD_TAKE_MDSE_CD      = OTM.ORD_TAKE_MDSE_CD(+)
                    AND OTM.EZCANCELFLAG(+)       = '0'
                    AND NVL(MSR.MDSE_CD, OTM.MDSE_CD) = MDS.MDSE_CD
                    AND MSR.GLBL_CMPY_CD          = MDS.GLBL_CMPY_CD
                    AND MDS.EZCANCELFLAG          = '0'
                    AND MDS.IMG_SPLY_COLOR_TP_CD  = ISC.IMG_SPLY_COLOR_TP_CD(+)
                    AND MDS.GLBL_CMPY_CD          = ISC.GLBL_CMPY_CD(+)
                    AND ISC.EZCANCELFLAG(+)       = '0'
                    AND MDS.MDSE_CD               = MSP.MDSE_CD(+)
                    AND MDS.GLBL_CMPY_CD          = MSP.GLBL_CMPY_CD(+)
                    AND MSP.PKG_UOM_CD(+)         = #pkgUomCd#
                    AND MSP.EZCANCELFLAG(+)       = '0'
                ORDER BY
                    <!-- START 2018/07/19 K.Kitachi [QC#26978, MOD] -->
                    <!-- MSR.DS_MDL_SPLY_RELN_PK -->
                     ISC.IMG_SPLY_COLOR_TP_SORT_NUM NULLS LAST
                    ,NVL(MSR.MDSE_CD, MSR.ORD_TAKE_MDSE_CD)
                    <!-- END 2018/07/19 K.Kitachi [QC#26978, MOD] -->
            )
        WHERE
            ROWNUM &lt;= #rowNum#
<!-- END 2017/05/09 K.Kitachi [QC#18277, MOD] -->
    </statement>
    <statement id="getAddlLineDetail" parameterClass="Map" resultClass="Map">
        SELECT
             MDS.MDSE_CD                        MDSE_CD
            ,MDS.MDSE_DESC_SHORT_TXT            MDSE_DESC_SHORT_TXT
<!-- del start 2016/10/04 CSA Defect#12898 -->
<!--
            ,NVL(
             CASE
                WHEN ISC.IMG_SPLY_COLOR_TP_CD = #colorTpBl#
                THEN (
                        SELECT
                            SSA.BW_ALLW_QTY
                        FROM
                            SVC_SPLY_MACH_ALLW     SSA
                        WHERE
                                SSA.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
                            AND SSA.GLBL_CMPY_CD        = #glblCmpyCd#
                            AND SSA.FRZ_FLG             = #frzFlg#
                            AND SSA.EZCANCELFLAG        = '0'
                     )
                ELSE (
                        SELECT
                            SSA.COLOR_ALLW_QTY
                        FROM
                            SVC_SPLY_MACH_ALLW     SSA
                        WHERE
                                SSA.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
                            AND SSA.GLBL_CMPY_CD        = #glblCmpyCd#
                            AND SSA.FRZ_FLG             = #frzFlg#
                            AND SSA.EZCANCELFLAG        = '0'
                     )
                END
                ,0)                             ALLW_QTY
            ,NVL(
             CASE
                WHEN ISC.IMG_SPLY_COLOR_TP_CD = #colorTpBl#
                THEN (
                        SELECT
                            SSU.BW_USED_QTY
                        FROM
                            SVC_SPLY_MACH_USED     SSU
                        WHERE
                                SSU.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
                            AND SSU.GLBL_CMPY_CD        = #glblCmpyCd#
                            AND SSU.FRZ_FLG             = #frzFlg#
                            AND SSU.EZCANCELFLAG        = '0'
                     )
                ELSE (
                        SELECT
                            SSU.COLOR_USED_QTY
                        FROM
                            SVC_SPLY_MACH_USED     SSU
                        WHERE
                                SSU.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
                            AND SSU.GLBL_CMPY_CD        = #glblCmpyCd#
                            AND SSU.FRZ_FLG             = #frzFlg#
                            AND SSU.EZCANCELFLAG        = '0'
                     )
                END
                ,0)                             USED_QTY
-->
<!-- del end 2016/10/04 CSA Defect#12898 -->
            ,MDS.CPO_MIN_ORD_QTY                CPO_MIN_ORD_QTY
            ,ISC.BLACK_COLOR_FLG                BLACK_COLOR_FLG
            ,MSP.IN_POUND_WT                    IN_POUND_WT
<!-- START 2017/12/05 M.Kidokoro [QC#21992, ADD] -->
            ,MDS.IMG_SPLY_OEM_CD                IMG_SPLY_OEM_CD
<!-- END 2017/12/05 M.Kidokoro [QC#21992, ADD] -->
        FROM
             MDSE                   MDS
            ,MDSE_STORE_PKG         MSP
            ,IMG_SPLY_COLOR_TP      ISC
        WHERE
                MDS.GLBL_CMPY_CD          = #glblCmpyCd#
            AND MDS.MDSE_CD               = #mdseCd#
            AND MDS.EZCANCELFLAG          = '0'
            AND MDS.MDSE_CD               = MSP.MDSE_CD(+)
            AND MDS.GLBL_CMPY_CD          = MSP.GLBL_CMPY_CD(+)
            AND MSP.PKG_UOM_CD(+)         = #pkgUomCd#
            AND MSP.EZCANCELFLAG(+)       = '0'
            AND MDS.IMG_SPLY_COLOR_TP_CD  = ISC.IMG_SPLY_COLOR_TP_CD(+)
            AND MDS.GLBL_CMPY_CD          = ISC.GLBL_CMPY_CD(+)
            AND ISC.EZCANCELFLAG(+)       = '0'
    </statement>
    <statement id="checkCarrShpgSvcLvlAndShpgSvcLvl" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            SHPG_SVC_LVL_CARR_RELN SSLCR
        WHERE
                SSLCR.GLBL_CMPY_CD        = #glblCmpyCd#
            AND SSLCR.SHPG_SVC_LVL_CD     = #shpgSvcLvlCd#
            AND SSLCR.CARR_SVC_LVL_CD     = #carrSvcLvlCd#
            AND SSLCR.EZCANCELFLAG        = '0'
    </statement>
    <statement id="checkPOAndBillTo" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             BILL_TO_CUST       BC
            ,DS_CUST_TRX_RULE   TR
            ,ORD_CATG_BIZ_CTX   CTX
        WHERE
                BC.GLBL_CMPY_CD         = #glblCmpyCd#
            AND BC.BILL_TO_CUST_CD      = #billToCust#
            AND BC.EZCANCELFLAG         = '0'
            AND BC.GLBL_CMPY_CD         = TR.GLBL_CMPY_CD
            AND BC.BILL_TO_CUST_CD      = TR.LOC_NUM
            AND TR.DS_PO_REQ_FLG        = 'Y'
            AND TR.EZCANCELFLAG         = '0'
            AND TR.GLBL_CMPY_CD         = CTX.GLBL_CMPY_CD
            AND TR.DS_TRX_RULE_TP_CD    = CTX.FIRST_BIZ_CTX_ATTRB_TXT
            AND CTX.ORD_CATG_CTX_TP_CD  = #orgCatgCtxTpCdIsSupplyOrder#
            AND CTX.DS_ORD_CATG_CD      = #dsOrdCatgCd#
            <!-- START 2019/06/17 W.Honda [QC#50842, ADD]  -->
            AND (CTX.DS_ORD_TP_CD       = #dsOrdTpCd#
                OR  CTX.DS_ORD_TP_CD    IS NULL)
            <!-- END 2019/06/17 W.Honda [QC#50842, ADD]  -->
            AND CTX.EZCANCELFLAG        = '0'
    </statement>
    <statement id="checkPOAndAccount" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             DS_CUST_TRX_RULE   TR
            ,ORD_CATG_BIZ_CTX   CTX
        WHERE
                TR.GLBL_CMPY_CD         = #glblCmpyCd#
            AND TR.DS_ACCT_NUM          = #billToAcctNum#
            AND TR.LOC_NUM              IS NULL
            AND TR.DS_PO_REQ_FLG        = 'Y'
            AND TR.EZCANCELFLAG         = '0'
            AND TR.GLBL_CMPY_CD         = CTX.GLBL_CMPY_CD
            AND TR.DS_TRX_RULE_TP_CD    = CTX.FIRST_BIZ_CTX_ATTRB_TXT
            AND CTX.ORD_CATG_CTX_TP_CD  = #orgCatgCtxTpCdIsSupplyOrder#
            AND CTX.DS_ORD_CATG_CD      = #dsOrdCatgCd#
            <!-- START 2019/06/17 W.Honda [QC#50842, ADD]  -->
            AND (CTX.DS_ORD_TP_CD       = #dsOrdTpCd#
                OR  CTX.DS_ORD_TP_CD    IS NULL)
            <!-- END 2019/06/17 W.Honda [QC#50842, ADD]  -->
            AND CTX.EZCANCELFLAG        = '0'
    </statement>
    <statement id="checkFrtCondRelation" parameterClass="Map" resultClass="BigDecimal">
<!-- mod start 2016/10/19 CSA Defect#15344 -->
<!--
        SELECT
            COUNT(*)
        FROM
            FRT_COND_SVC_LVL_RELN FCSLR
        WHERE
                FCSLR.GLBL_CMPY_CD        = #glblCmpyCd#
            AND FCSLR.LINE_BIZ_TP_CD      = #lineBizTpCd#
            AND FCSLR.FRT_COND_CD         = #frtCondCd#
            AND FCSLR.SHPG_SVC_LVL_CD     = #shpgSvcLvlCd#
            <isNotNull property="carrSvcLvlCd">
            AND FCSLR.CARR_SVC_LVL_CD     = #carrSvcLvlCd#
            </isNotNull>
            AND FCSLR.EZCANCELFLAG        = '0'
-->
        SELECT
                  COUNT(FR.GLBL_CMPY_CD)
            FROM
                FRT_COND_SVC_LVL_RELN FR
            WHERE
                FR.GLBL_CMPY_CD       = #glblCmpyCd#
                AND FR.LINE_BIZ_TP_CD = (
                    SELECT
                              PD.LINE_BIZ_TP_CD
                        FROM
                            DS_ORD_TP_PROC_DFN PD
                        WHERE
                            PD.GLBL_CMPY_CD     = FR.GLBL_CMPY_CD
                            AND PD.DS_ORD_TP_CD = #dsOrdTpCd#
                            AND PD.ACTV_FLG     = 'Y' 
                            AND PD.EFF_FROM_DT &lt;= #slsDt#
                            AND (
                                PD.EFF_THRU_DT &gt;= #slsDt#
                             OR PD.EFF_THRU_DT IS NULL
                                )
                            AND PD.EZCANCELFLAG = '0'
                ) 
                AND FR.FRT_COND_CD     = #frtCondCd#
                AND FR.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
                <isNotNull property="carrSvcLvlCd">
                AND FR.CARR_SVC_LVL_CD = #carrSvcLvlCd#
                </isNotNull>
                AND FR.EZCANCELFLAG    = '0'
<!-- mod end 2016/10/19 CSA Defect#15344 -->
    </statement>
    <statement id="getSvcTermAttrb" parameterClass="Map" resultClass="String">
        SELECT
             TCA.SVC_TERM_ATTRB_MAP_VAL_CD       SVC_TERM_ATTRB_MAP_VAL_CD
        FROM
             SVC_TERM_COND_ATTRB    TCA
        WHERE
                TCA.GLBL_CMPY_CD                = #glblCmpyCd#
            AND TCA.SVC_TERM_COND_ATTRB_NM      = #svcTermCondAttrbNm#
            AND TCA.EFF_FROM_DT             &lt;= #slsDt#
            AND (TCA.EFF_THRU_DT            &gt;= #slsDt#
            OR   TCA.EFF_THRU_DT                IS NULL)
            AND TCA.EZCANCELFLAG                = '0'
    </statement>
    <statement id="getBillToInfo" parameterClass="Map" resultClass="Map">
        SELECT
             BTC.LOC_NM                LOC_NM
            ,BTC.FIRST_LINE_ADDR       FIRST_LINE_ADDR
            ,BTC.SCD_LINE_ADDR         SCD_LINE_ADDR
            ,BTC.CTY_ADDR              CTY_ADDR
            ,BTC.ST_CD                 ST_CD
            ,BTC.POST_CD               POST_CD
            ,BTC.CTY_ADDR              CTY_ADDR
            ,BTC.CTRY_CD               CTRY_CD
        FROM
             BILL_TO_CUST           BTC
        WHERE
                BTC.GLBL_CMPY_CD          = #glblCmpyCd#
            AND BTC.BILL_TO_CUST_CD       = #billToCustCd#
            AND BTC.EZCANCELFLAG          = '0'
    </statement>
    <statement id="getShipToInfo" parameterClass="Map" resultClass="Map">
        SELECT
             STC.LOC_NM                LOC_NM
             <!-- 2018/12/12 QC#29315 H.Kumagai Add Start -->
            ,STC.LOC_NUM                LOC_NUM
             <!-- 2018/12/12 QC#29315 H.Kumagai Add End -->
            ,STC.FIRST_LINE_ADDR       FIRST_LINE_ADDR
            ,STC.SCD_LINE_ADDR         SCD_LINE_ADDR
            ,STC.CTY_ADDR              CTY_ADDR
            ,STC.ST_CD                 ST_CD
            ,STC.POST_CD               POST_CD
            ,STC.CTY_ADDR              CTY_ADDR
            ,STC.CTRY_CD               CTRY_CD
            <!-- START 2017/09/28 U.Kim [QC#18746, ADD]  -->
            ,STC.SELL_TO_CUST_CD       SELL_TO_CUST_CD
            <!-- END 2017/09/28 U.Kim [QC#18746, ADD]  -->
        FROM
             SHIP_TO_CUST           STC
        WHERE
                STC.GLBL_CMPY_CD          = #glblCmpyCd#
            AND STC.SHIP_TO_CUST_CD       = #shipToCustCd#
            AND STC.EZCANCELFLAG          = '0'
    </statement>
    <statement id="getSvcSplyMisc" parameterClass="Map" resultClass="String">
        SELECT
             SSM.MDSE_CD        MDSE_CD
        FROM
             SVC_SPLY_MISC      SSM
        WHERE
                SSM.GLBL_CMPY_CD                = #glblCmpyCd#
            AND SSM.MDSE_CD                     = #mdseCd#
            AND SSM.ACTV_FLG                    = #actvFlg#
            AND SSM.EFF_FROM_DT             &lt;= #slsDt#
            AND (SSM.EFF_THRU_DT            &gt;= #slsDt#
            OR   SSM.EFF_THRU_DT                IS NULL)
            AND SSM.EZCANCELFLAG                = '0'
    </statement>
    <statement id="selectToc" parameterClass="Map" resultClass="Map">
        SELECT
            PSN.GEO_CD
           ,PSN.FIRST_LINE_ADDR
           ,PSN.SCD_LINE_ADDR
           ,PSN.CTY_ADDR
           ,PSN.ST_CD
           ,PSN.POST_CD
           ,PSN.CTRY_CD
           ,C.CNTY_NM
        FROM
            TOC TOC
           ,ORG_FUNC_ASG OFA
           ,S21_PSN PSN
           ,CNTY C
        WHERE
            TOC.GLBL_CMPY_CD = #glblCmpyCd#
        AND TOC.EZCANCELFLAG = '0'
        AND TOC.TOC_CD = #slsRepOrSlsTeamTocCd#
        AND TOC.GLBL_CMPY_CD = OFA.GLBL_CMPY_CD
        AND TOC.EZCANCELFLAG = OFA.EZCANCELFLAG
        AND TOC.TOC_CD = OFA.TOC_CD
        AND OFA.EFF_FROM_DT &lt;= #prcBaseDt#
        AND (OFA.EFF_THRU_DT &gt;= #prcBaseDt# OR OFA.EFF_THRU_DT IS NULL )
        AND OFA.GLBL_CMPY_CD = PSN.GLBL_CMPY_CD
        AND OFA.EZCANCELFLAG = PSN.EZCANCELFLAG
        AND OFA.PSN_CD = PSN.PSN_CD
        AND PSN.GLBL_CMPY_CD = C.GLBL_CMPY_CD(+)
        AND PSN.EZCANCELFLAG = C.EZCANCELFLAG(+)
        AND PSN.CNTY_PK = C.CNTY_PK(+)
    </statement>
    <statement id="checkCodeTableDescText" parameterClass="Map" resultClass="Map">
        SELECT
            CT.$tblNm$_CD
        FROM
            $tblNm$ CT
        WHERE
                CT.GLBL_CMPY_CD         = #glblCmpyCd#
            AND UPPER(CT.$tblNm$_DESC_TXT)     = UPPER(#descTxt#)
            AND CT.EZCANCELFLAG         = '0'
    </statement>
    <statement id="checkCarrSvcLvl" parameterClass="Map" resultClass="Map">
        SELECT
             CSL.CARR_SVC_LVL_CD                CARR_SVC_LVL_CD
            ,CSL.CARR_SVC_LVL_DESC_TXT          CARR_SVC_LVL_DESC_TXT
        FROM
             FRT_COND_SVC_LVL_RELN   RLN
            ,DS_ORD_TP_PROC_DFN      OTD
            ,CARR_SVC_LVL            CSL
        WHERE
                RLN.GLBL_CMPY_CD            = #glblCmpyCd#
            AND RLN.FRT_COND_CD             = #frtCondCd#
            AND RLN.SHPG_SVC_LVL_CD         = #shpgSvcLvlCd#
            AND RLN.EZCANCELFLAG            = '0'
            AND RLN.LINE_BIZ_TP_CD          = OTD.LINE_BIZ_TP_CD
            AND RLN.GLBL_CMPY_CD            = OTD.GLBL_CMPY_CD
            AND OTD.DS_ORD_TP_CD            = #dsOrdTpCd#
            AND OTD.EZCANCELFLAG            = '0'
            AND RLN.CARR_SVC_LVL_CD         = CSL.CARR_SVC_LVL_CD
            AND RLN.GLBL_CMPY_CD            = CSL.GLBL_CMPY_CD
            AND CSL.CARR_SVC_LVL_DESC_TXT   = #carrSvcLvlDescTxt#
            AND CSL.EZCANCELFLAG            = '0'
    </statement>
    <statement id="getFreightTermInfoList"  parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            FC.FRT_COND_CD       AS FRT_COND_CD
           ,FC.FRT_COND_DESC_TXT AS FRT_COND_DESC_TXT
           ,FC.FRT_COND_SORT_NUM AS FRT_COND_SORT_NUM <!-- QC#29191 -->
        FROM
            FRT_COND              FC
           ,FRT_COND_SVC_LVL_RELN FCSLR
           ,DS_ORD_TP_PROC_DFN    DFN <!-- QC#29191 -->
        WHERE
            FC.GLBL_CMPY_CD          = #glblCmpyCd#
            AND FC.FRT_COND_DESC_TXT LIKE #frtCondDescTxt#
            AND FC.EZCANCELFLAG      = '0'

            AND FC.GLBL_CMPY_CD      = FCSLR.GLBL_CMPY_CD
            AND FC.FRT_COND_CD       = FCSLR.FRT_COND_CD
            <!-- QC#29191
            AND FCSLR.LINE_BIZ_TP_CD = #lineBizTpCd#
            -->
            AND FCSLR.EZCANCELFLAG   = '0'
            <!-- QC#29191 -->
            AND FCSLR.LINE_BIZ_TP_CD = DFN.LINE_BIZ_TP_CD
            AND DFN.DS_ORD_TP_CD     = #dsOrdTpCd#
            AND FCSLR.GLBL_CMPY_CD   = DFN.GLBL_CMPY_CD
            AND DFN.EZCANCELFLAG     = '0'
        ORDER BY
            FC.FRT_COND_SORT_NUM
    </statement>
    <statement id="getShpgSvcLvlDataList" parameterClass="Map" resultClass="Map">
        SELECT 
             SSL.SHPG_SVC_LVL_CD
            ,SSL.SHPG_SVC_LVL_DESC_TXT
            ,SSL.SHPG_SVC_LVL_SORT_NUM
        FROM 
             SHPG_SVC_LVL           SSL
            ,FRT_COND_SVC_LVL_RELN  FCSLR
            ,DS_ORD_TP_PROC_DFN     DFN <!-- QC#29191 -->
        WHERE
                SSL.GLBL_CMPY_CD        = #glblCmpyCd#
            AND SSL.GLBL_CMPY_CD        = FCSLR.GLBL_CMPY_CD
            AND SSL.SHPG_SVC_LVL_CD     = FCSLR.SHPG_SVC_LVL_CD
            <!-- QC#29191
            AND FCSLR.LINE_BIZ_TP_CD    = #lineBizTpCd#
            -->
            <isNotNull property="frtCondCd">
                AND FCSLR.FRT_COND_CD   = #frtCondCd#
            </isNotNull>
            AND SSL.EZCANCELFLAG     = '0'
            AND FCSLR.EZCANCELFLAG   = '0'
            <!-- QC#29191 -->
            AND FCSLR.LINE_BIZ_TP_CD = DFN.LINE_BIZ_TP_CD
            AND DFN.DS_ORD_TP_CD     = #dsOrdTpCd#
            AND FCSLR.GLBL_CMPY_CD   = DFN.GLBL_CMPY_CD
            AND DFN.EZCANCELFLAG     = '0'
        GROUP BY
             SSL.SHPG_SVC_LVL_CD
            ,SSL.SHPG_SVC_LVL_DESC_TXT
            ,SSL.SHPG_SVC_LVL_SORT_NUM
        ORDER BY
             SSL.SHPG_SVC_LVL_SORT_NUM
    </statement>
    <statement id="getCarrSvcLvlInfoList"  parameterClass="Map" resultClass="Map">
        SELECT
            CSL.CARR_SVC_LVL_CD       AS CARR_SVC_LVL_CD
           ,CSL.CARR_SVC_LVL_DESC_TXT AS CARR_SVC_LVL_DESC_TXT
        FROM
            CARR_SVC_LVL          CSL
           ,FRT_COND_SVC_LVL_RELN RELN
           ,DS_ORD_TP_PROC_DFN    OTD
        WHERE
                CSL.GLBL_CMPY_CD              = #glblCmpyCd#
            AND CSL.CARR_SVC_LVL_DESC_TXT LIKE #carrSvcLvlDescTxt#
            AND CSL.EZCANCELFLAG          = '0'

            AND CSL.GLBL_CMPY_CD     = RELN.GLBL_CMPY_CD
            AND CSL.CARR_SVC_LVL_CD  = RELN.CARR_SVC_LVL_CD
            AND RELN.FRT_COND_CD     = #frtCondCd#
            AND RELN.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
            AND RELN.EZCANCELFLAG    = '0'

            AND RELN.GLBL_CMPY_CD   = OTD.GLBL_CMPY_CD
            AND RELN.LINE_BIZ_TP_CD = OTD.LINE_BIZ_TP_CD
            AND OTD.DS_ORD_TP_CD    = #dsOrdTpCd#
            AND OTD.EZCANCELFLAG    = '0'
    </statement>
<!-- add start 2016/10/04 CSA Defect#12898 -->
    <statement id="getFltLineInfo"  parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_DTL_PK       DS_CONTR_DTL_PK
            ,A.BASE_BILL_TO_CUST_CD  BILL_TO_CUST_CD
            ,B.SELL_TO_CUST_CD       BILL_SELL_TO_CUST_CD
            ,A.SHIP_TO_CUST_CD       SHIP_TO_CUST_CD
            ,D.SELL_TO_CUST_CD       SHIP_SELL_TO_CUST_CD
        FROM
             DS_CONTR_DTL            A
            ,BILL_TO_CUST            B
            ,SHIP_TO_CUST            D
        WHERE
                A.GLBL_CMPY_CD            = #glblCmpyCd#
            AND A.DS_CONTR_PK             = #dsContrPk#
            AND A.DS_CONTR_DTL_TP_CD      = #dsContrDtlTpFleet#
            AND A.EZCANCELFLAG            = '0'
            AND A.GLBL_CMPY_CD            = B.GLBL_CMPY_CD
            AND A.BASE_BILL_TO_CUST_CD    = B.BILL_TO_CUST_CD
            AND B.EZCANCELFLAG            = '0'
            AND A.GLBL_CMPY_CD            = D.GLBL_CMPY_CD
            AND A.SHIP_TO_CUST_CD         = D.SHIP_TO_CUST_CD
            AND D.EZCANCELFLAG            = '0'
    </statement>
    <statement id="getFltLineDetailForSupplyOrder" parameterClass="Map" resultClass="Map">
<!-- START 2017/05/09 K.Kitachi [QC#18277, MOD] -->
        SELECT
             MDSE_CD
            ,MDSE_DESC_SHORT_TXT
            ,CPO_MIN_ORD_QTY
            ,IMG_SPLY_COLOR_TP_CD
            ,IMG_SPLY_COLOR_TP_NM
            ,BLACK_COLOR_FLG
            ,IMG_SPLY_COLOR_TP_SORT_NUM
            ,IN_POUND_WT
            ,MDL_ID
<!-- START 2017/12/05 M.Kidokoro [QC#21992, ADD] -->
            ,IMG_SPLY_OEM_CD
<!-- END 2017/12/05 M.Kidokoro [QC#21992, ADD] -->
<!-- START 2018/05/15 T.Wada [QC#24819, ADD] -->
            ,IMG_SPLY_TP_CD
<!-- START 2018/05/15 T.Wada [QC#24819, End] -->
        FROM
            (
                SELECT DISTINCT
                     NVL(MSR.MDSE_CD, MSR.ORD_TAKE_MDSE_CD)
                                                        MDSE_CD
                    ,MDS.MDSE_DESC_SHORT_TXT            MDSE_DESC_SHORT_TXT
                    ,MDS.CPO_MIN_ORD_QTY                CPO_MIN_ORD_QTY
                    ,ISC.IMG_SPLY_COLOR_TP_CD           IMG_SPLY_COLOR_TP_CD
                    ,ISC.IMG_SPLY_COLOR_TP_NM           IMG_SPLY_COLOR_TP_NM
                    ,ISC.BLACK_COLOR_FLG                BLACK_COLOR_FLG
                    ,ISC.IMG_SPLY_COLOR_TP_SORT_NUM     IMG_SPLY_COLOR_TP_SORT_NUM
                    ,MSP.IN_POUND_WT                    IN_POUND_WT
                    ,SCM.MDL_ID                         MDL_ID
<!-- START 2017/12/05 M.Kidokoro [QC#21992, ADD] -->
                    ,MDS.IMG_SPLY_OEM_CD                IMG_SPLY_OEM_CD
<!-- END 2017/12/05 M.Kidokoro [QC#21992, ADD] -->
<!-- START 2018/05/15 T.Wada [QC#24819, ADD] -->
                    ,MDS.IMG_SPLY_TP_CD
<!-- START 2018/05/15 T.Wada [QC#24819, End] -->
                FROM
                     DS_CONTR_DTL           DTL
                    ,SVC_MACH_MSTR          SMM
                    ,SVC_CONFIG_MSTR        SCM
                    ,DS_MDL_SPLY_RELN       MSR
                    ,ORD_TAKE_MDSE          OTM
                    ,MDSE                   MDS
                    ,IMG_SPLY_COLOR_TP      ISC
                    ,MDSE_STORE_PKG         MSP
                WHERE
                        DTL.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND DTL.DS_CONTR_PK           = #dsContrPk#
                    AND DTL.CONTR_EFF_FROM_DT     &lt;= #slsDt#
                    AND NVL(DTL.CONTR_EFF_THRU_DT, #slsDt#)
                                                  &gt;= #slsDt#
                    AND DTL.EZCANCELFLAG          = '0'
                    AND DTL.GLBL_CMPY_CD          = SMM.GLBL_CMPY_CD
                    AND DTL.SVC_MACH_MSTR_PK      = SMM.SVC_MACH_MSTR_PK
                    AND SMM.SVC_MACH_TP_CD        = #svcMachTpMachine#
                    AND SMM.EZCANCELFLAG          = '0'
                    AND SMM.GLBL_CMPY_CD          = SCM.GLBL_CMPY_CD
                    AND SMM.SVC_CONFIG_MSTR_PK    = SCM.SVC_CONFIG_MSTR_PK
                    AND SCM.EZCANCELFLAG          = '0'
                    AND SCM.GLBL_CMPY_CD          = MSR.GLBL_CMPY_CD
                    AND SCM.MDL_ID                = MSR.MDL_ID
                    AND MSR.EFF_FROM_DT           &lt;= #slsDt#
                    AND NVL(MSR.EFF_THRU_DT, #slsDt#)
                                                  &gt;= #slsDt#
                    AND MSR.EZCANCELFLAG          = '0'
                    AND MSR.GLBL_CMPY_CD          = OTM.GLBL_CMPY_CD(+)
                    AND MSR.ORD_TAKE_MDSE_CD      = OTM.ORD_TAKE_MDSE_CD(+)
                    AND OTM.EZCANCELFLAG(+)       = '0'
                    AND MSR.GLBL_CMPY_CD          = MDS.GLBL_CMPY_CD
                    AND NVL(MSR.MDSE_CD, OTM.MDSE_CD) = MDS.MDSE_CD
                    AND MDS.EZCANCELFLAG          = '0'
                    AND MDS.GLBL_CMPY_CD          = ISC.GLBL_CMPY_CD(+)
                    AND MDS.IMG_SPLY_COLOR_TP_CD  = ISC.IMG_SPLY_COLOR_TP_CD(+)
                    AND ISC.EZCANCELFLAG(+)       = '0'
                    AND MDS.GLBL_CMPY_CD          = MSP.GLBL_CMPY_CD(+)
                    AND MDS.MDSE_CD               = MSP.MDSE_CD(+)
                    AND MSP.PKG_UOM_CD(+)         = #pkgUomCd#
                    AND MSP.EZCANCELFLAG(+)       = '0'
                ORDER BY
                     IMG_SPLY_COLOR_TP_SORT_NUM NULLS LAST
                    ,MDSE_CD
            )
        WHERE
            ROWNUM &lt;= #rowNum#
<!-- END 2017/05/09 K.Kitachi [QC#18277, MOD] -->
    </statement>
    <statement id="getDsContrDtlForFltMach" parameterClass="Map" resultClass="Map">
        SELECT
             DTL.DS_CONTR_DTL_PK                DS_CONTR_DTL_PK
            ,DTL.SVC_MACH_MSTR_PK               SVC_MACH_MSTR_PK
        FROM
             DS_CONTR_DTL           DTL
            ,SVC_MACH_MSTR          SMM
        WHERE
                DTL.GLBL_CMPY_CD          = #glblCmpyCd#
            AND DTL.DS_CONTR_PK           = #dsContrPk#
            AND DTL.CONTR_EFF_FROM_DT     &lt;= #slsDt#
            AND NVL(DTL.CONTR_EFF_THRU_DT, #slsDt#)
                                          &gt;= #slsDt#
            AND DTL.EZCANCELFLAG          = '0'
            AND DTL.GLBL_CMPY_CD          = SMM.GLBL_CMPY_CD
            AND DTL.SVC_MACH_MSTR_PK      = SMM.SVC_MACH_MSTR_PK
            AND SMM.SVC_MACH_TP_CD        = #svcMachTpMachine#
            AND SMM.EZCANCELFLAG          = '0'
        ORDER BY
            DS_CONTR_DTL_PK
    </statement>
    <statement id="getSupplyMdseInfo" parameterClass="Map" resultClass="Map">
        SELECT
             DMS.CUST_STK_QTY              AS CUST_STK_QTY
            ,MDS.IMG_SPLY_YIELD_CNT        AS STD_YIELD_CNT
            ,NVL(DMS.SPLY_TOL_PCT,5)       AS SPLY_TOL_PCT
            ,MDS.THIS_MTH_TOT_STD_COST_AMT AS THIS_MTH_TOT_STD_COST_AMT
        FROM
             SVC_CONFIG_MSTR  SCM
            ,DS_MDL_SPLY_RELN DMS
            ,ORD_TAKE_MDSE    OTM
            ,MDSE             MDS
        WHERE
                SCM.GLBL_CMPY_CD         = #glblCmpyCd#
            AND SCM.SVC_MACH_MSTR_PK     = #svcMachMstrPk#
            AND SCM.EZCANCELFLAG         = '0'
            AND SCM.GLBL_CMPY_CD         = DMS.GLBL_CMPY_CD
            AND SCM.MDL_ID               = DMS.MDL_ID
            AND DMS.EZCANCELFLAG         = '0'
            AND DMS.GLBL_CMPY_CD         = OTM.GLBL_CMPY_CD(+)
            AND DMS.ORD_TAKE_MDSE_CD     = OTM.ORD_TAKE_MDSE_CD(+)
            AND OTM.EZCANCELFLAG(+)      = '0'
            AND DMS.GLBL_CMPY_CD         = MDS.GLBL_CMPY_CD
            AND NVL(DMS.MDSE_CD, OTM.MDSE_CD) 
                                         = MDS.MDSE_CD
            AND MDS.IMG_SPLY_COLOR_TP_CD = #imgSplyColorTpCd#
            AND MDS.EZCANCELFLAG         = '0'
    </statement>
    <statement id="getStartMtrInfo" parameterClass="Map" resultClass="Map">
        SELECT
             SUM(NVL(SPMR.READ_MTR_CNT, 0))  AS READ_MTR_CNT
            ,MIN(SPMR.MTR_READ_DT)           AS MTR_READ_DT
        FROM
             SVC_PHYS_MTR_READ  SPMR
            ,SVC_PHYS_MTR       SPM
            ,MTR_LB             ML
        WHERE
                SPMR.GLBL_CMPY_CD      = #glblCmpyCd#
            AND SPMR.DS_CONTR_DTL_PK   = #dsContrDtlPk#
            AND SPMR.EZCANCELFLAG      = '0'
            AND SPMR.GLBL_CMPY_CD      = SPM.GLBL_CMPY_CD
            AND SPMR.SVC_PHYS_MTR_PK   = SPM.SVC_PHYS_MTR_PK
            AND SPM.EZCANCELFLAG       = '0'
            AND SPM.GLBL_CMPY_CD       = ML.GLBL_CMPY_CD
            AND SPM.MDL_MTR_LB_CD      = ML.MTR_LB_CD
            <isNotNull property="bwMtrflgY">
            AND ML.BW_MTR_FLG          = #bwMtrflgY#
            </isNotNull>
            <isNotNull property="colorMtrflgY">
            AND ML.COLOR_MTR_FLG       = #colorMtrflgY#
            </isNotNull>
            AND ML.EZCANCELFLAG        = '0'
        GROUP BY
             SPMR.DS_CONTR_DTL_PK
    </statement>
    <statement id="getBllgMtrList" parameterClass="Map" resultClass="Map">
        SELECT
             SUM(NVL(SPMR.READ_MTR_CNT, 0)) AS READ_MTR_CNT
            ,MIN(SPMR.MTR_READ_DT)          AS MTR_READ_DT
            ,DCB.BLLG_SCHD_THRU_DT          AS BLLG_SCHD_THRU_DT
        FROM
            (SELECT
                  DCB2.SVC_PHYS_MTR_READ_GRP_SQ
                 ,DCB2.BLLG_SCHD_THRU_DT
             FROM
                 (SELECT DISTINCT
                       DCB1.SVC_PHYS_MTR_READ_GRP_SQ   AS SVC_PHYS_MTR_READ_GRP_SQ
                      ,MIN(DCB1.BLLG_SCHD_THRU_DT)     AS BLLG_SCHD_THRU_DT
                  FROM
                      DS_CONTR_BLLG_SCHD DCB1
                  WHERE
                          DCB1.GLBL_CMPY_CD             = #glblCmpyCd#
                      AND DCB1.DS_CONTR_DTL_PK          = #dsContrDtlPk#
                      AND DCB1.USG_CHRG_FLG             = 'Y'
                      AND DCB1.MTR_ENTRY_CPLT_FLG       = 'Y'
                      AND DCB1.SVC_PHYS_MTR_READ_GRP_SQ IS NOT NULL
                      AND DCB1.BLLG_SCHD_THRU_DT        IS NOT NULL
                      AND DCB1.EZCANCELFLAG             = '0'
                      <!-- START 2017/12/18 K.Kojima [QC#23055,ADD] -->
                      AND EXISTS(
                          SELECT
                              1
                          FROM
                              DS_CONTR_BLLG_SCHD DCB2
                          WHERE
                                  DCB2.GLBL_CMPY_CD          = DCB1.GLBL_CMPY_CD
                              AND DCB2.DS_CONTR_BLLG_SCHD_PK = DCB1.PRNT_DS_CONTR_BLLG_SCHD_PK
                              AND DCB2.DS_CONTR_PRC_EFF_PK IS NOT NULL
                              AND DCB2.EZCANCELFLAG          = '0'
                      )
                      <!-- END 2017/12/18 K.Kojima [QC#23055,ADD] -->
                  GROUP BY
                      DCB1.SVC_PHYS_MTR_READ_GRP_SQ
                  ORDER BY
                      BLLG_SCHD_THRU_DT DESC)     DCB2
             WHERE
                 ROWNUM                       &lt;= #rowNum#
            )                  DCB
           ,SVC_PHYS_MTR_READ  SPMR
           ,SVC_PHYS_MTR       SPM
           ,MTR_LB             ML
        WHERE
                SPMR.GLBL_CMPY_CD             = #glblCmpyCd#
            AND SPMR.SVC_PHYS_MTR_READ_GRP_SQ = DCB.SVC_PHYS_MTR_READ_GRP_SQ
            AND SPMR.EZCANCELFLAG             = '0'
            AND SPMR.GLBL_CMPY_CD             = SPM.GLBL_CMPY_CD
            AND SPMR.SVC_PHYS_MTR_PK          = SPM.SVC_PHYS_MTR_PK
            AND SPM.EZCANCELFLAG              = '0'
            AND SPM.GLBL_CMPY_CD              = ML.GLBL_CMPY_CD
            AND SPM.MDL_MTR_LB_CD             = ML.MTR_LB_CD
            <isNotNull property="bwMtrflgY">
            AND ML.BW_MTR_FLG                 = #bwMtrflgY#
            </isNotNull>
            <isNotNull property="colorMtrflgY">
            AND ML.COLOR_MTR_FLG              = #colorMtrflgY#
            </isNotNull>
            AND ML.EZCANCELFLAG               = '0'
        GROUP BY
             DCB.SVC_PHYS_MTR_READ_GRP_SQ
            ,DCB.BLLG_SCHD_THRU_DT
        ORDER BY
            BLLG_SCHD_THRU_DT DESC
    </statement>
<!-- add end 2016/10/04 CSA Defect#12898 -->
<!-- add start 2017/01/06 CSA Defect#16012 -->
    <statement id="getRevenueCost" parameterClass="Map" resultClass="Map">
        SELECT
             A.DWH_TRGT_YR
            ,SUM(A.TOT_REV_AMT)     AS TOT_REV_AMT
            ,SUM(A.TOT_COST_AMT)    AS TOT_COST_AMT
        FROM
            SPLY_REV_COST_YR_SMRY    A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.DWH_TRGT_YR       &gt;= #targetTwoYrAgo#
            AND A.DWH_TRGT_YR       &lt;= #targetYr#
            AND A.DS_CONTR_PK       = #dsContrPk#
            <isNotNull property="svcMachMstrPk">
            AND A.SVC_MACH_MSTR_PK  = #svcMachMstrPk#
            </isNotNull>
        GROUP BY A.DWH_TRGT_YR
    </statement>
<!-- add end 2017/01/06 CSA Defect#16012 -->
<!-- START 2017/07/03 K.Kitachi [QC#19026, ADD] -->
    <!-- START 2018/07/03 K.Kitachi [QC#26924, MOD] -->
    <!-- <statement id="isTonerExistsSplyReln" parameterClass="Map" resultClass="BigDecimal"> -->
    <statement id="isExistsSplyReln" parameterClass="Map" resultClass="BigDecimal">
    <!-- END 2018/07/03 K.Kitachi [QC#26924, MOD] -->
        SELECT
            COUNT(*)
        FROM
            MDSE           A
        WHERE
                A.GLBL_CMPY_CD     = #glblCmpyCd#
            AND A.MDSE_CD          = #mdseCd#
            <!-- START 2018/01/26 K.Kojima [QC#22797,MOD] -->
            <!-- AND A.IMG_SPLY_TP_CD   = #imgSplyTpCd# -->
            <!-- START 2018/07/03 K.Kitachi [QC#26924, DEL] -->
            <!-- <iterate property="imgSplyTpCd" var="imgSplyTpCd[]" open="AND A.IMG_SPLY_TP_CD IN (" close=")" conjunction=","> -->
            <!-- #imgSplyTpCd[]# -->
            <!-- </iterate> -->
            <!-- END 2018/07/03 K.Kitachi [QC#26924, DEL] -->
            <!-- END 2018/01/26 K.Kojima [QC#22797,MOD] -->
            AND A.EZCANCELFLAG     = '0'
            AND EXISTS (
                SELECT
                    1
                FROM
                    DS_MDL_SPLY_RELN X
                WHERE
                        X.GLBL_CMPY_CD     = A.GLBL_CMPY_CD
                    AND X.MDSE_CD          = A.MDSE_CD
                    <!-- START 2018/09/19 T.Wada [QC#28333, ADD] -->
                    <isNotNull property="mdlId">
                    AND X.MDL_ID           = #mdlId#
                    </isNotNull>
                    <!-- END 2018/09/19 T.Wada [QC#28333, ADD] -->
                    AND X.EZCANCELFLAG     = '0'
            )
            AND ROWNUM           = 1
    </statement>
    <!-- START 2018/07/03 K.Kitachi [QC#26924, MOD] -->
    <!-- <statement id="isTonerExistsSplyRelnForOrdTakeMdse" parameterClass="Map" resultClass="BigDecimal"> -->
    <statement id="isExistsSplyRelnForOrdTakeMdse" parameterClass="Map" resultClass="BigDecimal">
    <!-- END 2018/07/03 K.Kitachi [QC#26924, MOD] -->
        SELECT
            COUNT(*)
        FROM
             ORD_TAKE_MDSE A
            ,MDSE          B
        WHERE
                A.GLBL_CMPY_CD     = #glblCmpyCd#
            AND A.ORD_TAKE_MDSE_CD = #mdseCd#
            AND A.EZCANCELFLAG     = '0'
            AND A.GLBL_CMPY_CD     = B.GLBL_CMPY_CD
            AND A.MDSE_CD          = B.MDSE_CD
            <!-- START 2018/01/26 K.Kojima [QC#22797,MOD] -->
            <!-- AND B.IMG_SPLY_TP_CD   = #imgSplyTpCd# -->
            <!-- START 2018/07/03 K.Kitachi [QC#26924, DEL] -->
            <!-- <iterate property="imgSplyTpCd" var="imgSplyTpCd[]" open="AND B.IMG_SPLY_TP_CD IN (" close=")" conjunction=","> -->
            <!-- #imgSplyTpCd[]# -->
            <!-- </iterate> -->
            <!-- END 2018/07/03 K.Kitachi [QC#26924, DEL] -->
            <!-- END 2018/01/26 K.Kojima [QC#22797,MOD] -->
            AND B.EZCANCELFLAG     = '0'
            AND EXISTS (
                SELECT
                    1
                FROM
                    DS_MDL_SPLY_RELN X
                WHERE
                        X.GLBL_CMPY_CD     = A.GLBL_CMPY_CD
                    AND X.ORD_TAKE_MDSE_CD = A.ORD_TAKE_MDSE_CD
                    <!-- START 2018/09/19 T.Wada [QC#28333, ADD] -->
                    <isNotNull property="mdlId">
                    AND X.MDL_ID           = #mdlId#
                    </isNotNull>
                    <!-- END 2018/09/19 T.Wada [QC#28333, ADD] -->
                    AND X.EZCANCELFLAG     = '0'
            )
            AND ROWNUM           = 1
    </statement>
<!-- END 2017/07/03 K.Kitachi [QC#19026, ADD] -->
<!-- START 2017/11/22 M.Kidokoro [QC#20497, ADD] -->
    <statement id="getDefaultFreightTermInfo"  parameterClass="Map" resultClass="Map">
        SELECT
             DFN.FRT_COND_CD
            ,FRT.FRT_COND_DESC_TXT
            ,DFN.DEF_SHPG_SVC_LVL_CD
        FROM
             DS_ORD_TP_PROC_DFN DFN
            ,FRT_COND           FRT
        WHERE
                DFN.GLBL_CMPY_CD   = #glblCmpyCd#
            AND DFN.DS_ORD_TP_CD   = #dsOrdTpCd#
            <!-- QC#29191
            AND DFN.LINE_BIZ_TP_CD = #lineBizTpCd#
            -->
            AND DFN.EZCANCELFLAG   = '0'
            AND DFN.GLBL_CMPY_CD   = FRT.GLBL_CMPY_CD
            AND DFN.FRT_COND_CD    = FRT.FRT_COND_CD
            AND FRT.EZCANCELFLAG   = '0'
    </statement>
<!-- END 2017/11/22 M.Kidokoro [QC#20497, ADD] -->
<!-- START 2017/12/26 K.Ishizuka [QC#20164, ADD] -->
    <statement id="getShpgLbl"  parameterClass="Map" resultClass="Map">
        SELECT
              CTAC_PSN_FIRST_NM
            , CTAC_PSN_LAST_NM
        FROM(
            SELECT 
                  DISTINCT
                  CP.CTAC_PSN_FIRST_NM
                , CP.CTAC_PSN_LAST_NM
                , CP.EZUPTIME
            FROM 
                  CTAC_PSN CP
                , DS_CTAC_PNT DCP
                , SVC_MACH_CTAC_PSN SMCP
            WHERE 
                    SMCP.GLBL_CMPY_CD = #glblCmpyCd#
                AND SMCP.EZCANCELFLAG = '0'
                AND SMCP.SVC_MACH_MSTR_PK = #svcMachMstrPk#
                AND SMCP.SVC_CTAC_TP_CD = #svcCtacTpCd#

                AND SMCP.GLBL_CMPY_CD = DCP.GLBL_CMPY_CD
                AND SMCP.DS_CTAC_PNT_PK = DCP.DS_CTAC_PNT_PK
                AND DCP.EZCANCELFLAG = '0'

                AND DCP.GLBL_CMPY_CD = CP.GLBL_CMPY_CD
                AND DCP.CTAC_PSN_PK = CP.CTAC_PSN_PK
                AND CP.EZCANCELFLAG = '0')
        ORDER BY EZUPTIME
    </statement>
<!-- START 2017/12/26 K.Ishizuka [QC#20164, ADD] -->

<!-- START 2018/05/28 M.Naito [QC#15410, ADD] -->
    <statement id="getContrDtlKeysByMachMstrPk"  parameterClass="Map" resultClass="Map">
        SELECT
              DCD.DS_CONTR_DTL_PK
             ,DCD.DS_CONTR_PK
        FROM
             DS_CONTR_DTL    DCD
             <!-- START 2023/07/14 T.Kimura [QC#61570, ADD] -->
             ,DS_CONTR_DTL_STS_V    DCDS
             ,MDSE                  MDSE
             ,SVC_COV_TMPL_DTL      SCTD
             <!-- END 2023/07/14 T.Kimura [QC#61570, ADD] -->
        WHERE
                DCD.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DCD.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
<!-- START 2023/07/14 T.Kimura [QC#61570, DEL] -->
<!-- START 2023/06/13 T.Kimura [QC#61570, MOD] -->
<!--            AND DCD.DS_CONTR_DTL_STS_CD NOT IN (#dsContrDtlStsCanc#, #dsContrDtlStsTrmd#, #dsContrDtlStsExpd#) -->
<!-- END 2023/06/13 T.Kimura [QC#61570, MOD] -->
<!-- END 2023/07/14 T.Kimura [QC#61570, DEL] -->
            AND DCD.EZCANCELFLAG        = '0'
<!-- START 2023/07/14 T.Kimura [QC#61570, ADD] -->
            AND DCDS.ETTL_AVAL_FLG                        = #ettlAvalFlg#
            AND DCD.GLBL_CMPY_CD                          = DCDS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK                       = DCDS.DS_CONTR_DTL_PK
            AND DCDS.EZCANCELFLAG                         = '0'
            AND DCD.GLBL_CMPY_CD                          = MDSE.GLBL_CMPY_CD
            AND DCD.SVC_PGM_MDSE_CD                       = MDSE.MDSE_CD
            AND MDSE.EZCANCELFLAG                         = '0'
            AND SCTD.EFF_FROM_DT                      &lt;= #slsDt#
            AND NVL(SCTD.EFF_THRU_DT, #maxEffThruDt#) &gt;= #slsDt#
            AND SCTD.SVC_COV_FEAT_CD                      = #covFeatCd#
            AND SCTD.SVC_COV_DTL_VAL_TXT                  = #covDtlValTxt#
            AND MDSE.GLBL_CMPY_CD                         = SCTD.GLBL_CMPY_CD
            AND MDSE.SVC_COV_TMPL_TP_CD                   = SCTD.SVC_COV_TMPL_TP_CD
            AND SCTD.EZCANCELFLAG                         = '0'
<!-- END 2023/07/14 T.Kimura [QC#61570, ADD] -->
    </statement>
<!-- END 2018/05/28 M.Naito [QC#15410, ADD] -->
<!-- START 2018/07/04 T.Wada [QC#23726, ADD] -->
    <statement id="getCarrSvcLvl" parameterClass="Map" resultClass="Map">
        SELECT
            CARR_SVC_LVL_CD
            ,CARR_SVC_LVL_DESC_TXT
        FROM
            (
             SELECT
                 SSLCR.CARR_SVC_LVL_CD
                 ,CSL.CARR_SVC_LVL_DESC_TXT
             FROM
                 SHPG_SVC_LVL_CARR_RELN SSLCR
                ,CARR_SVC_LVL           CSL
             WHERE
                 SSLCR.GLBL_CMPY_CD        = #glblCmpyCd#
                 AND SSLCR.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
                 AND SSLCR.CARR_CD         = #carrCd#
                 AND SSLCR.EZCANCELFLAG    = '0'
                 AND SSLCR.GLBL_CMPY_CD    = CSL.GLBL_CMPY_CD
                 AND SSLCR.CARR_SVC_LVL_CD = CSL.CARR_SVC_LVL_CD
                 AND CSL.EZCANCELFLAG      = '0'
             ORDER BY
                 SSLCR.CARR_SVC_LVL_CD DESC
            )
        WHERE
            ROWNUM = 1
    </statement>
    <statement id="getCarrCd" parameterClass="Map" resultClass="String">
        SELECT
            CARR_CD
        FROM
            (
            SELECT
                 SLC.CARR_CD
            FROM
                 SHPG_SVC_LVL_CARR_RELN SLC
            WHERE
                SLC.GLBL_CMPY_CD    = #glblCmpyCd#
            AND SLC.CARR_SVC_LVL_CD = #carrSvcLvlCd#
            AND SLC.EZCANCELFLAG    = '0'
            )
        WHERE
            ROWNUM = 1
    </statement>
<!-- END 2018/07/04 T.Wada [QC#23726, ADD] -->

    <!-- START 2018/09/10 K.Kitachi [QC#26260, ADD] -->
    <statement id="convLineBizTpToSvcLineBiz" parameterClass="Map" resultClass="String">
        SELECT
            RELN.SVC_LINE_BIZ_CD
        FROM
            SVC_LINE_BIZ_RELN RELN
        WHERE
                RELN.GLBL_CMPY_CD   = #glblCmpyCd#
            AND RELN.LINE_BIZ_TP_CD = #lineBizTpCd#
            AND RELN.EZCANCELFLAG   = '0'
    </statement>
    <!-- END 2018/09/10 K.Kitachi [QC#26260, ADD] -->

<!-- add start 2019/01/21 QC#27304 -->
    <statement id="getPsnNm" parameterClass="Map" resultClass="String">
        SELECT
            RTRIM(A.FIRST_NM || ' ' || A.LAST_NM) FULL_PSN_NM
        FROM
            AUTH_PSN A
        WHERE
                A.GLBL_CMPY_CD    = #glblCmpyCd#
            AND A.USR_NM          = #userId#
            AND A.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getSvcSplyOrdDtlPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.SVC_SPLY_ORD_DTL_PK
        FROM
            SVC_SPLY_ORD_DTL A
        WHERE
                A.GLBL_CMPY_CD    = #glblCmpyCd#
            AND A.SVC_SPLY_ORD_PK = #svcSplyOrdPk#
            AND A.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getSvcSplyOrd" parameterClass="Map" resultClass="Map">
        SELECT
             A.EZUPTIME
            ,A.EZUPTIMEZONE
            ,A.SVC_SPLY_ORD_PK
            ,A.SVC_MACH_MSTR_PK
            ,A.DS_CONTR_DTL_PK
            ,A.BILL_TO_LOC_NUM
            ,A.CUR_LOC_NUM
            ,A.CUST_ISS_PO_NUM
            ,A.CTAC_PSN_FIRST_NM
            ,A.CTAC_PSN_LAST_NM
            ,A.CTAC_PSN_EML_ADDR
            ,A.SVC_CMNT_TXT
            ,A.FRT_COND_DESC_TXT
            ,A.SHPG_SVC_LVL_CD
            ,A.CARR_SVC_LVL_DESC_TXT
            ,A.CARR_ACCT_NUM
            ,A.SCR_LB_NM
            ,A.SHPG_INSTN_CMNT_TXT
            ,A.DS_PMT_METH_CD
            ,A.INV_CMNT_TXT
            ,C.SELL_TO_CUST_CD CUR_LOC_ACCT_NUM
            ,D.SVC_CONFIG_MSTR_PK
            ,D.SER_NUM
            ,D.OWNR_ACCT_NUM
            ,D.OWNR_LOC_NUM
            ,D.BILL_TO_ACCT_NUM
            ,D.FIN_BR_CD
            ,D.SVC_BY_LINE_BIZ_TP_CD
            ,D.SLD_BY_LINE_BIZ_TP_CD
            ,F.T_MDL_ID
            ,F.T_MDL_NM
            ,G.COA_BR_NM
            ,NVL(I.TOC_CD, H.TOC_CD) TOC_CD
        FROM
             SVC_SPLY_ORD     A
            ,SHIP_TO_CUST     C
            ,SVC_MACH_MSTR    D
            ,SVC_CONFIG_MSTR  E
            ,MDL_NM           F
            ,COA_BR           G
            ,SUB_CONTR_BR_MAP H
            ,SUB_CONTR_BR_MAP I
            ,DS_CONTR_DTL     J
            ,DS_CONTR         K
       WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.SVC_SPLY_ORD_PK       = #svcSplyOrdPk#
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = C.GLBL_CMPY_CD(+)
            AND A.CUR_LOC_NUM           = C.SHIP_TO_CUST_CD(+)
            AND C.EZCANCELFLAG(+)       = '0'
            AND A.GLBL_CMPY_CD          = D.GLBL_CMPY_CD
            AND A.SVC_MACH_MSTR_PK      = D.SVC_MACH_MSTR_PK
            AND D.EZCANCELFLAG          = '0'
            AND D.GLBL_CMPY_CD          = E.GLBL_CMPY_CD
            AND D.SVC_CONFIG_MSTR_PK    = E.SVC_CONFIG_MSTR_PK
            AND E.EZCANCELFLAG          = '0'
            AND E.GLBL_CMPY_CD          = F.T_GLBL_CMPY_CD
            AND E.MDL_ID                = F.T_MDL_ID
            AND F.EZCANCELFLAG          = '0'
            AND D.GLBL_CMPY_CD          = G.GLBL_CMPY_CD(+)
            AND D.FIN_BR_CD             = G.COA_BR_CD(+)
            AND G.EZCANCELFLAG(+)       = '0'
            AND D.GLBL_CMPY_CD          = H.GLBL_CMPY_CD(+)
            AND D.FIN_BR_CD             = H.SVC_CONTR_BR_CD(+)
            AND H.ENBL_FLG(+)           = 'Y'
            AND H.EZCANCELFLAG(+)       = '0'
            AND D.GLBL_CMPY_CD          = I.GLBL_CMPY_CD(+)
            AND D.FIN_BR_CD             = I.SVC_CONTR_BR_CD(+)
            AND D.SLD_BY_LINE_BIZ_TP_CD = I.SVC_LINE_BIZ_CD(+)
            AND I.ENBL_FLG(+)           = 'Y'
            AND I.EZCANCELFLAG(+)       = '0'
            AND A.GLBL_CMPY_CD          = J.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK       = J.DS_CONTR_DTL_PK
            AND J.EZCANCELFLAG          = '0'
            AND J.GLBL_CMPY_CD          = K.GLBL_CMPY_CD
            AND J.DS_CONTR_PK           = K.DS_CONTR_PK
            AND K.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getSvcSplyOrdDtl" parameterClass="Map" resultClass="Map">
        SELECT
             SVC_SPLY_ORD_PK
            ,SVC_SPLY_ORD_DTL_PK
            ,SVC_MACH_MSTR_PK
            ,DS_CONTR_DTL_PK
            ,MDSE_CD
            ,ORD_CUST_UOM_QTY
            ,SER_NUM
            ,OWNR_ACCT_NUM
            ,SVC_BY_LINE_BIZ_TP_CD
            ,SVC_CONFIG_MSTR_PK
            ,T_MDL_ID
            ,T_MDL_NM
            ,DS_CONTR_PK
            ,DS_CONTR_NUM
            ,DS_CONTR_CATG_CD
            ,MDSE_DESC_SHORT_TXT
            ,CPO_MIN_ORD_QTY
            ,IMG_SPLY_OEM_CD
            ,IMG_SPLY_TP_CD
            ,IMG_SPLY_COLOR_TP_CD
            ,IMG_SPLY_COLOR_TP_NM
            ,BLACK_COLOR_FLG
            ,IN_POUND_WT
            ,COA_BR_NM
        FROM
            (
             SELECT
                  A.SVC_SPLY_ORD_PK
                 ,A.SVC_SPLY_ORD_DTL_PK
                 ,A.SVC_MACH_MSTR_PK
                 ,A.DS_CONTR_DTL_PK
                 ,A.MDSE_CD
                 ,A.ORD_CUST_UOM_QTY
                 ,B.SER_NUM
                 ,B.OWNR_ACCT_NUM
                 ,B.SVC_BY_LINE_BIZ_TP_CD
                 ,B.SVC_CONFIG_MSTR_PK
                 ,D.T_MDL_ID
                 ,D.T_MDL_NM
                 ,F.DS_CONTR_PK
                 ,F.DS_CONTR_NUM
                 ,F.DS_CONTR_CATG_CD
                 ,NVL(H.MDSE_DESC_SHORT_TXT, I.MDSE_DESC_SHORT_TXT) MDSE_DESC_SHORT_TXT
                 ,NVL(H.CPO_MIN_ORD_QTY, I.CPO_MIN_ORD_QTY) CPO_MIN_ORD_QTY
                 ,NVL(H.IMG_SPLY_OEM_CD, I.IMG_SPLY_OEM_CD) IMG_SPLY_OEM_CD
                 ,NVL(H.IMG_SPLY_TP_CD, I.IMG_SPLY_TP_CD) IMG_SPLY_TP_CD
                 ,J.IMG_SPLY_COLOR_TP_CD
                 ,J.IMG_SPLY_COLOR_TP_NM
                 ,J.BLACK_COLOR_FLG
                 ,K.IN_POUND_WT
                 ,L.COA_BR_NM
             FROM
                  SVC_SPLY_ORD_DTL  A
                 ,SVC_MACH_MSTR     B
                 ,SVC_CONFIG_MSTR   C
                 ,MDL_NM            D
                 ,DS_CONTR_DTL      E
                 ,DS_CONTR          F
                 ,ORD_TAKE_MDSE     G
                 ,MDSE              H
                 ,MDSE              I
                 ,IMG_SPLY_COLOR_TP J
                 ,MDSE_STORE_PKG    K
                 ,COA_BR            L
             WHERE
                     A.GLBL_CMPY_CD       = #glblCmpyCd#
                 AND A.SVC_SPLY_ORD_PK    = #svcSplyOrdPk#
                 AND A.EZCANCELFLAG       = '0'
                 AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD
                 AND A.SVC_MACH_MSTR_PK   = B.SVC_MACH_MSTR_PK
                 AND B.EZCANCELFLAG       = '0'
                 AND B.GLBL_CMPY_CD       = C.GLBL_CMPY_CD
                 AND B.SVC_CONFIG_MSTR_PK = C.SVC_CONFIG_MSTR_PK
                 AND C.EZCANCELFLAG       = '0'
                 AND C.GLBL_CMPY_CD       = D.T_GLBL_CMPY_CD
                 AND C.MDL_ID             = D.T_MDL_ID
                 AND K.EZCANCELFLAG       = '0'
                 AND A.GLBL_CMPY_CD       = E.GLBL_CMPY_CD
                 AND A.DS_CONTR_DTL_PK    = E.DS_CONTR_DTL_PK
                 AND E.EZCANCELFLAG       = '0'
                 AND E.GLBL_CMPY_CD       = F.GLBL_CMPY_CD
                 AND E.DS_CONTR_PK        = F.DS_CONTR_PK
                 AND F.EZCANCELFLAG       = '0'
                 AND A.GLBL_CMPY_CD       = G.GLBL_CMPY_CD(+)
                 AND A.MDSE_CD            = G.ORD_TAKE_MDSE_CD(+)
                 AND G.EZCANCELFLAG(+)    = '0'
                 AND A.GLBL_CMPY_CD       = H.GLBL_CMPY_CD(+)
                 AND A.MDSE_CD            = H.MDSE_CD(+)
                 AND H.EZCANCELFLAG(+)    = '0'
                 AND G.GLBL_CMPY_CD       = I.GLBL_CMPY_CD(+)
                 AND G.MDSE_CD            = I.MDSE_CD(+)
                 AND I.EZCANCELFLAG(+)    = '0'
                 AND A.GLBL_CMPY_CD       = J.GLBL_CMPY_CD(+)
                 AND NVL(H.IMG_SPLY_COLOR_TP_CD, I.IMG_SPLY_COLOR_TP_CD)
                                          = J.IMG_SPLY_COLOR_TP_CD(+)
                 AND J.EZCANCELFLAG(+)    = '0'
                 AND A.GLBL_CMPY_CD       = K.GLBL_CMPY_CD(+)
                 AND NVL(H.MDSE_CD, I.MDSE_CD)
                                          = K.MDSE_CD(+)
                 AND K.PKG_UOM_CD(+)      = #pkgUomCd#
                 AND K.EZCANCELFLAG(+)    = '0'
                 AND B.GLBL_CMPY_CD       = L.GLBL_CMPY_CD(+)
                 AND B.FIN_BR_CD          = L.COA_BR_CD(+)
                 AND L.EZCANCELFLAG(+)    = '0'
             ORDER BY
                 A.SVC_SPLY_ORD_DTL_PK
            )
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>
<!-- add end 2019/01/21 QC#27304 -->
</sqlMap>
