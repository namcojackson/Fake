<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL1120Query">

    <statement id="getBaseDataForRebil" parameterClass="Map" resultClass="Map">
        SELECT
             CUST_INCDT_ID
            ,SVC_CR_REBIL_STS_DESC_TXT
            ,SVC_CR_REBIL_DESC_TXT
            ,SVC_CR_REBIL_PK
            ,DS_CONTR_NUM
            ,DS_CONTR_CATG_CD
            ,DS_CONTR_CATG_ABBR_NM
            ,SVC_CR_REBIL_DTL_PK
            ,ORIG_SVC_INV_NUM
            ,SER_NUM
            ,MDSE_CD
            <!-- START 2022/04/04 E.Sanchez [QC#59914,ADD] -->
            ,DS_CONTR_DTL_PK
            ,SVC_MACH_MSTR_PK
            ,MDSE_DESC_SHORT_TXT
            <!-- END 2022/04/04 E.Sanchez [QC#59914,ADD] -->
            ,BASE_BLLG_FROM_DT
            ,BASE_BLLG_THRU_DT
            ,OLD_BASE_DEAL_AMT
            ,NEW_BASE_DEAL_AMT
<!--  START 2018/08/27 [QC#24555, ADD] -->
            ,OLD_BASE_UNIT_AMT
            ,NEW_BASE_UNIT_AMT
<!--  END   2018/08/27 [QC#24555, ADD] -->
            ,EZUPTIME
            ,EZUPTIMEZONE
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
            ,XX_REC_HIST_CRAT_TS
            ,XX_REC_HIST_CRAT_BY_NM
            ,XX_REC_HIST_UPD_TS
            ,XX_REC_HIST_UPD_BY_NM
            ,XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
        FROM (
            SELECT
                 REB.SVC_CR_REBIL_PK           AS SVC_CR_REBIL_PK
                ,REB.CUST_INCDT_ID             AS CUST_INCDT_ID
                ,REB.SVC_CR_REBIL_DESC_TXT     AS SVC_CR_REBIL_DESC_TXT
                ,RDL.SVC_CR_REBIL_DTL_PK       AS SVC_CR_REBIL_DTL_PK
                ,RDL.ORIG_SVC_INV_NUM          AS ORIG_SVC_INV_NUM
                ,RST.SVC_CR_REBIL_STS_DESC_TXT AS SVC_CR_REBIL_STS_DESC_TXT
                ,RBB.BASE_BLLG_FROM_DT         AS BASE_BLLG_FROM_DT
                ,RBB.BASE_BLLG_THRU_DT         AS BASE_BLLG_THRU_DT
                ,RBB.OLD_BASE_DEAL_AMT         AS OLD_BASE_DEAL_AMT
                ,RBB.NEW_BASE_DEAL_AMT         AS NEW_BASE_DEAL_AMT
<!--  START 2018/08/27 [QC#24555, ADD] -->
                ,RBB.OLD_BASE_UNIT_AMT
                ,RBB.NEW_BASE_UNIT_AMT
<!--  END   2018/08/27 [QC#24555, ADD] -->
                ,DCN.DS_CONTR_NUM              AS DS_CONTR_NUM
                ,DCN.DS_CONTR_CATG_CD          AS DS_CONTR_CATG_CD
                ,DCC.DS_CONTR_CATG_ABBR_NM     AS DS_CONTR_CATG_ABBR_NM
                ,SMM.SER_NUM                   AS SER_NUM
                ,SMM.MDSE_CD                   AS MDSE_CD
                <!-- START 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                ,DCD.DS_CONTR_DTL_PK           AS DS_CONTR_DTL_PK
                ,SMM.SVC_MACH_MSTR_PK          AS SVC_MACH_MSTR_PK
                ,MDS.MDSE_DESC_SHORT_TXT       AS MDSE_DESC_SHORT_TXT
                <!-- END 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                ,RDL.EZUPTIME                  AS EZUPTIME
                ,RDL.EZUPTIMEZONE              AS EZUPTIMEZONE
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
                ,RDL.EZINTIME                  AS XX_REC_HIST_CRAT_TS
                ,RDL.EZINUSERID                AS XX_REC_HIST_CRAT_BY_NM
                ,RDL.EZUPTIME                  AS XX_REC_HIST_UPD_TS
                ,RDL.EZUPUSERID                AS XX_REC_HIST_UPD_BY_NM
                ,RDL.EZTABLEID                 AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
            FROM
                 SVC_CR_REBIL_DTL       RDL
                ,SVC_CR_REBIL           REB
                ,SVC_CR_REBIL_BASE_BLLG RBB
                ,SVC_CR_REBIL_STS       RST
                ,DS_CONTR_DTL           DCD
                ,DS_CONTR               DCN
                ,DS_CONTR_CATG          DCC
                ,SVC_MACH_MSTR          SMM
                <!-- START 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                ,DS_CONTR_DTL_TP        DDT
                ,DS_CONTR_DTL           DCDP
                ,SVC_MACH_MSTR          SMMP
                ,MDSE                   MDS
                ,SVC_PGM_TP             SPT
                <!-- END 2022/04/04 E.Sanchez [QC#59914,ADD] -->
            WHERE
                    RDL.SVC_CR_REBIL_DTL_PK    = #svcCrRebilDtlPk#
                AND RDL.GLBL_CMPY_CD           = #glblCmpyCd#
                AND RDL.EZCANCELFLAG           = '0'
                AND RDL.SVC_CR_REBIL_PK        = REB.SVC_CR_REBIL_PK
                AND RDL.GLBL_CMPY_CD           = REB.GLBL_CMPY_CD
                AND REB.EZCANCELFLAG           = '0'
                AND RDL.SVC_CR_REBIL_DTL_PK    = RBB.SVC_CR_REBIL_DTL_PK
                AND RDL.GLBL_CMPY_CD           = RBB.GLBL_CMPY_CD
                AND RBB.EZCANCELFLAG           = '0'
                AND REB.SVC_CR_REBIL_STS_CD    = RST.SVC_CR_REBIL_STS_CD
                AND REB.GLBL_CMPY_CD           = RST.GLBL_CMPY_CD
                AND RST.EZCANCELFLAG           = '0'
                AND RBB.DS_CONTR_DTL_PK        = DCD.DS_CONTR_DTL_PK
                AND RBB.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
                AND DCD.EZCANCELFLAG           = '0'
                AND DCD.DS_CONTR_PK            = DCN.DS_CONTR_PK
                AND DCD.GLBL_CMPY_CD           = DCN.GLBL_CMPY_CD
                AND DCN.EZCANCELFLAG           = '0'
                AND DCN.DS_CONTR_CATG_CD       = DCC.DS_CONTR_CATG_CD
                AND DCN.GLBL_CMPY_CD           = DCC.GLBL_CMPY_CD
                AND DCC.EZCANCELFLAG           = '0'
                AND DCD.SVC_MACH_MSTR_PK       = SMM.SVC_MACH_MSTR_PK(+)
                AND DCD.GLBL_CMPY_CD           = SMM.GLBL_CMPY_CD(+)
                AND SMM.EZCANCELFLAG(+)        = '0'
                <!-- add start 2016/04/15 CSA Defect#7056 -->
                AND (
                        DCN.DS_CONTR_CATG_CD = #dsContrCatg_reg#
                        OR  DCD.DS_CONTR_DTL_TP_CD = #dsContrDtlTp_flt#
                        OR (DCN.DS_CONTR_CATG_CD = #dsContrCatg_agg# AND DCD.DS_CONTR_DTL_TP_CD &lt;&gt; #dsContrDtlTp_agg#)
                    )
                <!-- add end 2016/04/15 CSA Defect#7056 -->
                <!-- START 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                AND DCD.GLBL_CMPY_CD           = DDT.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_TP_CD     = DDT.DS_CONTR_DTL_TP_CD
                AND DDT.EZCANCELFLAG           = '0'
                AND DCD.GLBL_CMPY_CD           = DCDP.GLBL_CMPY_CD(+)
                AND DCD.PRNT_DS_CONTR_DTL_PK   = DCDP.DS_CONTR_DTL_PK(+)
                AND DCDP.EZCANCELFLAG(+)       = '0'
                AND DCDP.GLBL_CMPY_CD          = SMMP.GLBL_CMPY_CD(+)
                AND DCDP.SVC_MACH_MSTR_PK      = SMMP.SVC_MACH_MSTR_PK(+)
                AND SMMP.EZCANCELFLAG(+)       = '0'
                AND DCD.GLBL_CMPY_CD           = MDS.GLBL_CMPY_CD(+)
                AND DCD.SVC_PGM_MDSE_CD        = MDS.MDSE_CD(+)
                AND MDS.EZCANCELFLAG(+)        = '0'
                AND MDS.GLBL_CMPY_CD           = SPT.GLBL_CMPY_CD(+)
                AND MDS.SVC_PGM_TP_CD          = SPT.SVC_PGM_TP_CD(+)
                AND SPT.EZCANCELFLAG(+)        = '0'
                <!-- END 2022/04/04 E.Sanchez [QC#59914,ADD] -->
            ORDER BY
                <!-- START 2022/04/04 E.Sanchez [QC#59914,MOD] -->
                <!-- SMM.SER_NUM           ASC -->
                 NVL(SMMP.SER_NUM, SMM.SER_NUM)
                ,NVL(SMMP.MDSE_CD, SMM.MDSE_CD)
                ,SPT.SVC_PGM_TP_SORT_NUM
                ,NVL(DCD.DS_CONTR_CRAT_TP_CD, #dsContrCratTp#)
                ,NVL(DCD.PRNT_DS_CONTR_DTL_PK, DCD.DS_CONTR_DTL_PK)
                ,DDT.DS_CONTR_DTL_TP_SORT_NUM
                ,DCD.DS_CONTR_DTL_PK
                <!-- END 2022/04/04 E.Sanchez [QC#59914,MOD] -->
                ,RBB.BASE_BLLG_FROM_DT DESC)
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>
 
    <statement id="getBaseDataForInv" parameterClass="Map" resultClass="Map">
       SELECT
             CUST_INCDT_ID
            ,SVC_CR_REBIL_STS_DESC_TXT
            ,SVC_CR_REBIL_PK
            ,SVC_CR_REBIL_DESC_TXT
<!-- START 2017/10/02 U.Kim [QC#18749, ADD] -->
            ,SVC_CR_REBIL_STS_CD
<!-- END 2017/10/02 U.Kim [QC#18749, ADD] -->
            ,DS_CONTR_NUM
            ,DS_CONTR_CATG_CD
            ,DS_CONTR_CATG_ABBR_NM
            ,SVC_CR_REBIL_DTL_PK
            ,ORIG_SVC_INV_NUM
            ,SER_NUM
            ,MDSE_CD
            <!-- START 2022/04/04 E.Sanchez [QC#59914,ADD] -->
            ,DS_CONTR_DTL_PK
            ,SVC_MACH_MSTR_PK
            ,MDSE_DESC_SHORT_TXT
            <!-- END 2022/04/04 E.Sanchez [QC#59914,ADD] -->
            ,BASE_BLLG_FROM_DT
            ,BASE_BLLG_THRU_DT
            ,OLD_BASE_DEAL_AMT
            ,NEW_BASE_DEAL_AMT
            ,EZUPTIME
            ,EZUPTIMEZONE
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
            ,XX_REC_HIST_CRAT_TS
            ,XX_REC_HIST_CRAT_BY_NM
            ,XX_REC_HIST_UPD_TS
            ,XX_REC_HIST_UPD_BY_NM
            ,XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
        FROM (
            SELECT
                 SIL.SVC_INV_NUM            AS ORIG_SVC_INV_NUM
                ,SIL.BLLG_PER_FROM_DT       AS BASE_BLLG_FROM_DT
                ,SIL.BLLG_PER_THRU_DT       AS BASE_BLLG_THRU_DT
                ,SIL.INV_LINE_DEAL_NET_AMT  AS OLD_BASE_DEAL_AMT
                ,SMM.SER_NUM                AS SER_NUM
                ,SMM.MDSE_CD                AS MDSE_CD
                <!-- START 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                ,DCD.DS_CONTR_DTL_PK        AS DS_CONTR_DTL_PK
                ,SMM.SVC_MACH_MSTR_PK       AS SVC_MACH_MSTR_PK
                ,MDS.MDSE_DESC_SHORT_TXT    AS MDSE_DESC_SHORT_TXT
                <!-- END 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                ,DCN.DS_CONTR_NUM           AS DS_CONTR_NUM
                ,DCN.DS_CONTR_TP_CD         AS DS_CONTR_CATG_CD
                ,DCC.DS_CONTR_CATG_ABBR_NM  AS DS_CONTR_CATG_ABBR_NM
<!-- START 2017/10/02 U.Kim [QC#18749, MOD] -->
<!--            ,NULL                       AS CUST_INCDT_ID -->
<!--            ,NULL                       AS SVC_CR_REBIL_STS_DESC_TXT -->
<!--            ,NULL                       AS SVC_CR_REBIL_DESC_TXT -->
                ,SCR.CUST_INCDT_ID          AS CUST_INCDT_ID
                ,RST.SVC_CR_REBIL_STS_DESC_TXT  AS SVC_CR_REBIL_STS_DESC_TXT
                ,SCR.SVC_CR_REBIL_STS_CD    AS SVC_CR_REBIL_STS_CD
                ,SCR.SVC_CR_REBIL_DESC_TXT  AS SVC_CR_REBIL_DESC_TXT
<!-- END 2017/10/02 U.Kim [QC#18749, MOD] -->
                ,NULL                       AS SVC_CR_REBIL_PK
                ,NULL                       AS NEW_BASE_DEAL_AMT
                ,NULL                       AS SVC_CR_REBIL_DTL_PK
                ,NULL                       AS EZUPTIME
                ,NULL                       AS EZUPTIMEZONE
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
                ,SIL.EZINTIME               AS XX_REC_HIST_CRAT_TS
                ,SIL.EZINUSERID             AS XX_REC_HIST_CRAT_BY_NM
                ,SIL.EZUPTIME               AS XX_REC_HIST_UPD_TS
                ,SIL.EZUPUSERID             AS XX_REC_HIST_UPD_BY_NM
                ,SIL.EZTABLEID              AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
            FROM
                 SVC_INV_LINE   SIL
                ,SVC_MACH_MSTR  SMM
                ,DS_CONTR_DTL   DCD
                ,DS_CONTR       DCN
                ,DS_CONTR_CATG  DCC
<!-- START 2017/10/02 U.Kim [QC#18749, ADD] -->
                ,SVC_CR_REBIL   SCR
                ,SVC_CR_REBIL_STS RST
<!-- END 2017/10/02 U.Kim [QC#18749, ADD] -->
                <!-- START 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                ,DS_CONTR_DTL_TP        DDT
                ,DS_CONTR_DTL           DCDP
                ,SVC_MACH_MSTR          SMMP
                ,MDSE                   MDS
                ,SVC_PGM_TP             SPT
                <!-- END 2022/04/04 E.Sanchez [QC#59914,ADD] -->
            WHERE
                    SIL.SVC_INV_LINE_PK     = #svcInvLinePk#
                AND SIL.GLBL_CMPY_CD        = #glblCmpyCd#
                AND SIL.EZCANCELFLAG        = '0'
                AND SIL.DS_CONTR_DTL_PK     = DCD.DS_CONTR_DTL_PK
                AND SIL.GLBL_CMPY_CD        = DCD.GLBL_CMPY_CD
                AND DCD.EZCANCELFLAG        = '0'
                AND DCD.DS_CONTR_PK         = DCN.DS_CONTR_PK
                AND DCD.GLBL_CMPY_CD        = DCN.GLBL_CMPY_CD
                AND DCN.EZCANCELFLAG        = '0'
                AND DCN.DS_CONTR_CATG_CD    = DCC.DS_CONTR_CATG_CD
                AND DCN.GLBL_CMPY_CD        = DCC.GLBL_CMPY_CD
                AND DCC.EZCANCELFLAG        = '0'
                AND SIL.SVC_MACH_MSTR_PK    = SMM.SVC_MACH_MSTR_PK(+)
                AND SIL.GLBL_CMPY_CD        = SMM.GLBL_CMPY_CD(+)
                AND SMM.EZCANCELFLAG(+)     = '0'
<!-- START 2017/10/02 U.Kim [QC#18749, ADD] -->
                AND SIL.GLBL_CMPY_CD        = SCR.GLBL_CMPY_CD
                AND SCR.SVC_CR_REBIL_PK     = #svcCrRebilPk#
                AND SCR.EZCANCELFLAG        = '0'
                AND SCR.GLBL_CMPY_CD        = RST.GLBL_CMPY_CD
                AND SCR.SVC_CR_REBIL_STS_CD = RST.SVC_CR_REBIL_STS_CD
                AND RST.EZCANCELFLAG        = '0'
<!-- END 2017/10/02 U.Kim [QC#18749, ADD] -->
                <!-- add start 2016/04/15 CSA Defect#7056 -->
                AND (
                        DCN.DS_CONTR_CATG_CD = #dsContrCatg_reg#
                        OR  DCD.DS_CONTR_DTL_TP_CD = #dsContrDtlTp_flt#
                        OR (DCN.DS_CONTR_CATG_CD = #dsContrCatg_agg# AND DCD.DS_CONTR_DTL_TP_CD &lt;&gt; #dsContrDtlTp_agg#)
                    )
                <!-- add end 2016/04/15 CSA Defect#7056 -->
                <!-- START 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                AND DCD.GLBL_CMPY_CD           = DDT.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_TP_CD     = DDT.DS_CONTR_DTL_TP_CD
                AND DDT.EZCANCELFLAG           = '0'
                AND DCD.GLBL_CMPY_CD           = DCDP.GLBL_CMPY_CD(+)
                AND DCD.PRNT_DS_CONTR_DTL_PK   = DCDP.DS_CONTR_DTL_PK(+)
                AND DCDP.EZCANCELFLAG(+)       = '0'
                AND DCDP.GLBL_CMPY_CD          = SMMP.GLBL_CMPY_CD(+)
                AND DCDP.SVC_MACH_MSTR_PK      = SMMP.SVC_MACH_MSTR_PK(+)
                AND SMMP.EZCANCELFLAG(+)       = '0'
                AND DCD.GLBL_CMPY_CD           = MDS.GLBL_CMPY_CD(+)
                AND DCD.SVC_PGM_MDSE_CD        = MDS.MDSE_CD(+)
                AND MDS.EZCANCELFLAG(+)        = '0'
                AND MDS.GLBL_CMPY_CD           = SPT.GLBL_CMPY_CD(+)
                AND MDS.SVC_PGM_TP_CD          = SPT.SVC_PGM_TP_CD(+)
                AND SPT.EZCANCELFLAG(+)        = '0'
                <!-- END 2022/04/04 E.Sanchez [QC#59914,ADD] -->
            ORDER BY
                 SIL.SVC_INV_NUM        ASC
                <!-- START 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                ,NVL(SMMP.SER_NUM, SMM.SER_NUM)
                ,NVL(SMMP.MDSE_CD, SMM.MDSE_CD)
                ,SPT.SVC_PGM_TP_SORT_NUM
                ,NVL(DCD.DS_CONTR_CRAT_TP_CD, #dsContrCratTp#)
                ,NVL(DCD.PRNT_DS_CONTR_DTL_PK, DCD.DS_CONTR_DTL_PK)
                ,DDT.DS_CONTR_DTL_TP_SORT_NUM
                ,DCD.DS_CONTR_DTL_PK
                <!-- END 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                ,SIL.BLLG_PER_FROM_DT   ASC)
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getMeterDataForRebil" parameterClass="Map" resultClass="Map">
<!-- START 2018/07/19 K.Kojima [QC#26791,ADD] -->
        WITH MTR_FMLA_DATA AS (
            SELECT
                *
            FROM
                MTR_FMLA MF
            WHERE
                    MF.GLBL_CMPY_CD = #glblCmpyCd#
                AND MF.EZCANCELFLAG = '0'
        )
        ,MTR_FMLA_INFO AS (
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_01 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_01 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_02 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_02 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_03 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_03 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_04 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_04 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_05 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_05 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_06 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_06 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_07 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_07 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_08 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_08 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_09 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_09 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_10 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_10 IS NOT NULL
        )
<!-- END 2018/07/19 K.Kojima [QC#26791,ADD] -->
        SELECT
             CUST_INCDT_ID
            ,SVC_CR_REBIL_STS_DESC_TXT
            ,SVC_CR_REBIL_DESC_TXT
            ,DS_CONTR_NUM
            ,DS_CONTR_CATG_CD
            ,DS_CONTR_CATG_ABBR_NM
            ,ORIG_SVC_INV_NUM
            ,SVC_CR_REBIL_PK
            ,SVC_CR_REBIL_MTR_READ_PK
            ,SVC_CR_REBIL_MTR_BLLG_PK
            ,SVC_INV_LINE_MTR_PK
            ,SVC_MACH_MSTR_PK
            ,BLLG_MTR_LB_CD
            ,MTR_LB_CD
            ,SER_NUM
            ,START_MTR_READ_DT
            ,END_MTR_READ_DT
            ,MTR_LB_DESC_TXT
            ,OLD_START_READ_MTR_CNT
            ,OLD_END_READ_MTR_CNT
<!-- START 2017/09/15 E.Kameishi [QC#18636, MOD] -->
            <!-- ,OLD_START_TEST_MTR_CNT -->
            <!-- ,OLD_END_TEST_MTR_CNT -->
            ,OLD_TEST_MTR_CNT
<!-- END 2017/09/15 E.Kameishi [QC#18636, MOD] -->
            ,NEW_START_READ_MTR_CNT
            ,NEW_END_READ_MTR_CNT
<!-- START 2017/09/15 E.Kameishi [QC#18636, MOD] -->
            <!-- ,NEW_START_TEST_MTR_CNT -->
            <!-- ,NEW_END_TEST_MTR_CNT -->
            ,NEW_TEST_MTR_CNT
<!-- END 2017/09/15 E.Kameishi [QC#18636, MOD] -->
            ,EZUPTIME
            ,EZUPTIMEZONE
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
            ,XX_REC_HIST_CRAT_TS
            ,XX_REC_HIST_CRAT_BY_NM
            ,XX_REC_HIST_UPD_TS
            ,XX_REC_HIST_UPD_BY_NM
            ,XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
        FROM (
            SELECT
                 RDL.ORIG_SVC_INV_NUM           AS ORIG_SVC_INV_NUM
                ,RMB.SVC_CR_REBIL_MTR_BLLG_PK   AS SVC_CR_REBIL_MTR_BLLG_PK
                ,RMB.BLLG_MTR_LB_CD             AS BLLG_MTR_LB_CD
                ,REB.SVC_CR_REBIL_PK            AS SVC_CR_REBIL_PK
                ,REB.CUST_INCDT_ID              AS CUST_INCDT_ID
                ,REB.SVC_CR_REBIL_DESC_TXT      AS SVC_CR_REBIL_DESC_TXT
                ,RST.SVC_CR_REBIL_STS_DESC_TXT  AS SVC_CR_REBIL_STS_DESC_TXT
                ,RMR.SVC_CR_REBIL_MTR_READ_PK   AS SVC_CR_REBIL_MTR_READ_PK
                ,RMR.START_MTR_READ_DT          AS START_MTR_READ_DT
                ,RMR.END_MTR_READ_DT            AS END_MTR_READ_DT
                ,RMR.OLD_START_READ_MTR_CNT     AS OLD_START_READ_MTR_CNT
                ,RMR.OLD_END_READ_MTR_CNT       AS OLD_END_READ_MTR_CNT
<!-- START 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                <!-- ,RMR.OLD_START_TEST_MTR_CNT     AS OLD_START_TEST_MTR_CNT -->
                <!-- ,RMR.OLD_END_TEST_MTR_CNT       AS OLD_END_TEST_MTR_CNT -->
                ,RMR.OLD_TEST_MTR_CNT
<!-- END 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                ,RMR.NEW_START_READ_MTR_CNT     AS NEW_START_READ_MTR_CNT
                ,RMR.NEW_END_READ_MTR_CNT       AS NEW_END_READ_MTR_CNT
<!-- START 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                <!-- ,RMR.NEW_START_TEST_MTR_CNT     AS NEW_START_TEST_MTR_CNT -->
                <!-- ,RMR.NEW_END_TEST_MTR_CNT       AS NEW_END_TEST_MTR_CNT -->
                ,RMR.NEW_TEST_MTR_CNT
<!-- END 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                ,MLB.MTR_LB_CD                  AS MTR_LB_CD
                ,MLB.MTR_LB_DESC_TXT            AS MTR_LB_DESC_TXT
                ,DCN.DS_CONTR_NUM               AS DS_CONTR_NUM
                ,DCN.DS_CONTR_CATG_CD           AS DS_CONTR_CATG_CD
                ,DCC.DS_CONTR_CATG_ABBR_NM      AS DS_CONTR_CATG_ABBR_NM
                ,SMM.SVC_MACH_MSTR_PK           AS SVC_MACH_MSTR_PK
                ,SMM.SER_NUM                    AS SER_NUM
                ,RDL.EZUPTIME                   AS EZUPTIME
                ,RDL.EZUPTIMEZONE               AS EZUPTIMEZONE
                ,NULL                           AS SVC_INV_LINE_MTR_PK
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
                ,RMB.EZINTIME                   AS XX_REC_HIST_CRAT_TS
                ,RMB.EZINUSERID                 AS XX_REC_HIST_CRAT_BY_NM
                ,RMB.EZUPTIME                   AS XX_REC_HIST_UPD_TS
                ,RMB.EZUPUSERID                 AS XX_REC_HIST_UPD_BY_NM
                ,RMB.EZTABLEID                  AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
            FROM
                 SVC_CR_REBIL_MTR_BLLG  RMB
                ,SVC_CR_REBIL_DTL       RDL
                ,SVC_CR_REBIL           REB
                ,SVC_CR_REBIL_STS       RST
                ,SVC_CR_REBIL_MTR_READ  RMR
                ,MTR_LB                 MLB
                ,DS_CONTR_DTL           DCD
                ,DS_CONTR               DCN
                ,DS_CONTR_CATG          DCC
                ,SVC_PHYS_MTR           SPM
                ,SVC_MACH_MSTR          SMM
                <!-- START 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                ,DS_CONTR_DTL_TP        DDT
                ,DS_CONTR_DTL           DCDP
                ,SVC_MACH_MSTR          SMMP
                ,MDSE                   MDS
                ,SVC_PGM_TP             SPT
                <!-- END 2022/04/04 E.Sanchez [QC#59914,ADD] -->
            WHERE
                    RDL.SVC_CR_REBIL_DTL_PK         = #svcCrRebilDtlPk#
                AND RDL.GLBL_CMPY_CD                = #glblCmpyCd#
                AND RDL.EZCANCELFLAG                = '0'
                AND RDL.SVC_CR_REBIL_PK             = REB.SVC_CR_REBIL_PK
                AND RDL.GLBL_CMPY_CD                = REB.GLBL_CMPY_CD
                AND REB.EZCANCELFLAG                = '0'
                AND REB.SVC_CR_REBIL_STS_CD         = RST.SVC_CR_REBIL_STS_CD
                AND REB.GLBL_CMPY_CD                = RST.GLBL_CMPY_CD
                AND RST.EZCANCELFLAG                = '0'
                AND RDL.SVC_CR_REBIL_DTL_PK         = RMR.SVC_CR_REBIL_DTL_PK
                AND RDL.GLBL_CMPY_CD                = RMR.GLBL_CMPY_CD
                AND RMR.EZCANCELFLAG                = '0'
                AND RMR.SVC_CR_REBIL_MTR_BLLG_PK    = RMB.SVC_CR_REBIL_MTR_BLLG_PK(+)
                AND RMR.GLBL_CMPY_CD                = RMB.GLBL_CMPY_CD(+)
                AND RMB.EZCANCELFLAG(+)             = '0'
                AND RMR.PHYS_MTR_LB_CD              = MLB.MTR_LB_CD
                AND RMR.GLBL_CMPY_CD                = MLB.GLBL_CMPY_CD
                AND MLB.EZCANCELFLAG                = '0'
                AND RMR.DS_CONTR_DTL_PK             = DCD.DS_CONTR_DTL_PK
                AND RMR.GLBL_CMPY_CD                = DCD.GLBL_CMPY_CD
                AND DCD.EZCANCELFLAG                = '0'
                AND DCD.DS_CONTR_PK                 = DCN.DS_CONTR_PK
                AND DCD.GLBL_CMPY_CD                = DCN.GLBL_CMPY_CD
                AND DCN.EZCANCELFLAG                = '0'
                AND DCN.DS_CONTR_CATG_CD            = DCC.DS_CONTR_CATG_CD
                AND DCN.GLBL_CMPY_CD                = DCC.GLBL_CMPY_CD
                AND DCC.EZCANCELFLAG                = '0'
                AND RMR.SVC_PHYS_MTR_PK             = SPM.SVC_PHYS_MTR_PK
                AND RMR.GLBL_CMPY_CD                = SPM.GLBL_CMPY_CD
                AND SPM.EZCANCELFLAG                = '0'
                AND SPM.SVC_MACH_MSTR_PK            = SMM.SVC_MACH_MSTR_PK
                AND SPM.GLBL_CMPY_CD                = SMM.GLBL_CMPY_CD
                AND SMM.EZCANCELFLAG                = '0'
                <!-- START 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                AND DCD.GLBL_CMPY_CD                = DDT.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_TP_CD          = DDT.DS_CONTR_DTL_TP_CD
                AND DDT.EZCANCELFLAG                = '0'
                AND DCD.GLBL_CMPY_CD                = DCDP.GLBL_CMPY_CD(+)
                AND DCD.PRNT_DS_CONTR_DTL_PK        = DCDP.DS_CONTR_DTL_PK(+)
                AND DCDP.EZCANCELFLAG(+)            = '0'
                AND DCDP.GLBL_CMPY_CD               = SMMP.GLBL_CMPY_CD(+)
                AND DCDP.SVC_MACH_MSTR_PK           = SMMP.SVC_MACH_MSTR_PK(+)
                AND SMMP.EZCANCELFLAG(+)            = '0'
                AND DCD.GLBL_CMPY_CD                = MDS.GLBL_CMPY_CD(+)
                AND DCD.SVC_PGM_MDSE_CD             = MDS.MDSE_CD(+)
                AND MDS.EZCANCELFLAG(+)             = '0'
                AND MDS.GLBL_CMPY_CD                = SPT.GLBL_CMPY_CD(+)
                AND MDS.SVC_PGM_TP_CD               = SPT.SVC_PGM_TP_CD(+)
                AND SPT.EZCANCELFLAG(+)             = '0'
                <!-- END 2022/04/04 E.Sanchez [QC#59914,ADD] -->
<!-- START 2017/07/21 K.Kim [QC#17276, ADD] -->
<!-- START 2018/06/20 K.Kojima [QC#26791, DEL] -->
<!--            AND SPM.SVC_PHYS_MTR_PK NOT IN ( -->
<!--                SELECT -->
<!--                     SPM2.SVC_PHYS_MTR_PK -->
<!--                FROM -->
<!--                     SVC_CR_REBIL_DTL       RDL2 -->
<!--                    ,SVC_CR_REBIL_MTR_READ  RMR2 -->
<!--                    ,SVC_PHYS_MTR           SPM2 -->
<!--                    ,MTR_GRP                MGP2 -->
<!--                    ,MTR_LB                 MLB2 -->
<!--                WHERE -->
<!--                        RDL2.SVC_CR_REBIL_DTL_PK     = #svcCrRebilDtlPk# -->
<!--                    AND RDL2.GLBL_CMPY_CD            = #glblCmpyCd# -->
<!--                    AND RDL2.EZCANCELFLAG            = '0' -->
<!--                    AND RDL2.SVC_CR_REBIL_DTL_PK     = RMR2.SVC_CR_REBIL_DTL_PK -->
<!--                    AND RDL2.GLBL_CMPY_CD            = RMR2.GLBL_CMPY_CD -->
<!--                    AND RMR2.EZCANCELFLAG            = '0' -->
<!--                    AND RMR2.SVC_PHYS_MTR_PK         = SPM2.SVC_PHYS_MTR_PK -->
<!--                    AND RMR2.GLBL_CMPY_CD            = SPM2.GLBL_CMPY_CD -->
<!--                    AND SPM2.EZCANCELFLAG            = '0' -->
<!--                    AND MGP2.COLOR_MTR_AUTO_DRV_FLG  = 'Y' -->
<!--                    AND SPM2.MTR_GRP_PK              = MGP2.MTR_GRP_PK -->
<!--                    AND SPM2.GLBL_CMPY_CD            = MGP2.GLBL_CMPY_CD -->
<!--                    AND MGP2.EZCANCELFLAG            = '0' -->
<!--                    AND MLB2.COLOR_MTR_FLG           = 'Y' -->
<!--                    AND SPM2.MDL_MTR_LB_CD           = MLB2.MTR_LB_CD -->
<!--                    AND SPM2.GLBL_CMPY_CD            = MLB2.GLBL_CMPY_CD -->
<!--                    AND MLB2.EZCANCELFLAG            = '0' -->
<!--            ) -->
<!-- END 2018/06/20 K.Kojima [QC#26791, DEL] -->
<!-- END 2017/07/21 K.Kim [QC#17276, ADD] -->
<!-- START 2018/07/19 K.Kojima [QC#26791,ADD] -->
                AND (
                    RMB.DS_CONTR_BLLG_MTR_PK IS NOT NULL
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                             MTR_FMLA_INFO MFI
                        WHERE
                                MFI.MTR_GRP_PK       = SPM.MTR_GRP_PK
                            AND MFI.FMLA_MTR_LB_CD   = SPM.MDL_MTR_LB_CD
                    )
                )
                AND NOT EXISTS(
                    SELECT
                        1
                    FROM
                        MTR_FMLA MF
                    WHERE
                            MF.GLBL_CMPY_CD = SPM.GLBL_CMPY_CD
                        AND MF.MTR_GRP_PK   = SPM.MTR_GRP_PK
                        AND MF.MTR_LB_CD    = SPM.MDL_MTR_LB_CD
                        AND MF.EZCANCELFLAG = '0'
                )
<!-- END 2018/07/19 K.Kojima [QC#26791,ADD] -->
            ORDER BY
                <!-- START 2022/04/04 E.Sanchez [QC#59914,MOD] -->
                <!-- SMM.SER_NUM            ASC -->
                 NVL(SMMP.SER_NUM, SMM.SER_NUM)
                ,NVL(SMMP.MDSE_CD, SMM.MDSE_CD)
                ,SPT.SVC_PGM_TP_SORT_NUM
                ,NVL(DCD.DS_CONTR_CRAT_TP_CD, #dsContrCratTp#)
                ,NVL(DCD.PRNT_DS_CONTR_DTL_PK, DCD.DS_CONTR_DTL_PK)
                ,DDT.DS_CONTR_DTL_TP_SORT_NUM
                ,DCD.DS_CONTR_DTL_PK
                <!-- END 2022/04/04 E.Sanchez [QC#59914,MOD] -->
                ,RMR.START_MTR_READ_DT  DESC
                ,MLB.MTR_LB_SORT_NUM    ASC)
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getMeterDataForInv" parameterClass="Map" resultClass="Map">
<!-- START 2018/07/19 K.Kojima [QC#26791,ADD] -->
        WITH MTR_FMLA_DATA AS (
            SELECT
                *
            FROM
                MTR_FMLA MF
            WHERE
                    MF.GLBL_CMPY_CD = #glblCmpyCd#
                AND MF.EZCANCELFLAG = '0'
        )
        ,MTR_FMLA_INFO AS (
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_01 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_01 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_02 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_02 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_03 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_03 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_04 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_04 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_05 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_05 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_06 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_06 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_07 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_07 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_08 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_08 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_09 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_09 IS NOT NULL UNION
            SELECT A.MTR_GRP_PK,A.MTR_LB_CD,A.FMLA_MTR_LB_CD_10 AS FMLA_MTR_LB_CD FROM MTR_FMLA_DATA A WHERE A.FMLA_MTR_LB_CD_10 IS NOT NULL
        )
<!-- END 2018/07/19 K.Kojima [QC#26791,ADD] -->
<!-- START 2018/07/19 K.Kojima [QC#26791,MOD] -->
<!--    WITH -->
<!--        SIN AS ( -->
        , SIN AS (
<!-- END 2018/07/19 K.Kojima [QC#26791,MOD] -->
                    SELECT
                         SIL.GLBL_CMPY_CD               AS GLBL_CMPY_CD
                        ,SIL.SVC_INV_NUM                AS SVC_INV_NUM
                        ,SIL.DS_CONTR_DTL_PK            AS DS_CONTR_DTL_PK
                        ,SILM.SVC_INV_LINE_MTR_PK       AS SVC_INV_LINE_MTR_PK
                        ,SIL.SVC_CONTR_BLLG_PK          AS SVC_CONTR_BLLG_PK
<!-- START 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                        ,SIL.DS_CONTR_BLLG_SCHD_PK      AS DS_CONTR_BLLG_SCHD_PK
<!-- END 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                        ,SILM.PREV_PHYS_MTR_READ_GRP_SQ AS PREV_PHYS_MTR_READ_GRP_SQ
                        ,SILM.SVC_PHYS_MTR_READ_GRP_SQ  AS SVC_PHYS_MTR_READ_GRP_SQ
                        ,SILM.DS_CONTR_BLLG_MTR_PK      AS DS_CONTR_BLLG_MTR_PK
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
                        ,SILM.EZINTIME                  AS XX_REC_HIST_CRAT_TS
                        ,SILM.EZINUSERID                AS XX_REC_HIST_CRAT_BY_NM
                        ,SILM.EZUPTIME                  AS XX_REC_HIST_UPD_TS
                        ,SILM.EZUPUSERID                AS XX_REC_HIST_UPD_BY_NM
                        ,SILM.EZTABLEID                 AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
                    FROM
                         SVC_INV_LINE       SIL
                        ,SVC_INV_LINE_MTR   SILM
                    WHERE
                            SIL.SVC_INV_LINE_PK = #svcInvLinePk#
                        AND SIL.GLBL_CMPY_CD    = #glblCmpyCd#
                        AND SIL.EZCANCELFLAG    = '0'
                        AND SIL.SVC_INV_LINE_PK = SILM.SVC_INV_LINE_PK
                        AND SIL.GLBL_CMPY_CD    = SILM.GLBL_CMPY_CD
                        AND SILM.EZCANCELFLAG   = '0')
        SELECT
             CUST_INCDT_ID
            ,SVC_CR_REBIL_STS_DESC_TXT
            ,SVC_CR_REBIL_DESC_TXT
<!-- START 2017/10/02 U.Kim [QC#18749, ADD] -->
            ,SVC_CR_REBIL_STS_CD
<!-- END 2017/10/02 U.Kim [QC#18749, ADD] -->
            ,DS_CONTR_NUM
            ,DS_CONTR_CATG_CD
            ,DS_CONTR_CATG_ABBR_NM
            ,ORIG_SVC_INV_NUM
            ,SVC_CR_REBIL_PK
            ,SVC_CR_REBIL_MTR_READ_PK
            ,SVC_CR_REBIL_MTR_BLLG_PK
            ,SVC_INV_LINE_MTR_PK
            ,SVC_MACH_MSTR_PK
            ,BLLG_MTR_LB_CD
            ,MTR_LB_CD
            ,SER_NUM
            ,START_MTR_READ_DT
            ,END_MTR_READ_DT
            ,MTR_LB_DESC_TXT
            ,OLD_START_READ_MTR_CNT
            ,OLD_END_READ_MTR_CNT
<!-- START 2017/09/15 E.Kameishi [QC#18636, MOD] -->
            <!-- ,OLD_START_TEST_MTR_CNT -->
            <!-- ,OLD_END_TEST_MTR_CNT -->
            ,OLD_TEST_MTR_CNT
<!-- END 2017/09/15 E.Kameishi [QC#18636, MOD] -->
            ,NEW_START_READ_MTR_CNT
            ,NEW_END_READ_MTR_CNT
<!-- START 2017/09/15 E.Kameishi [QC#18636, MOD] -->
            <!-- ,NEW_START_TEST_MTR_CNT -->
            <!-- ,NEW_END_TEST_MTR_CNT -->
            ,NEW_TEST_MTR_CNT
<!-- END 2017/09/15 E.Kameishi [QC#18636, MOD] -->
            ,EZUPTIME
            ,EZUPTIMEZONE
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
            ,XX_REC_HIST_CRAT_TS
            ,XX_REC_HIST_CRAT_BY_NM
            ,XX_REC_HIST_UPD_TS
            ,XX_REC_HIST_UPD_BY_NM
            ,XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
        FROM (
            SELECT
                 SIN.SVC_INV_NUM            AS ORIG_SVC_INV_NUM
                ,SIN.SVC_INV_LINE_MTR_PK    AS SVC_INV_LINE_MTR_PK
                ,MRS.START_MTR_READ_DT      AS START_MTR_READ_DT
                ,MRS.OLD_START_READ_MTR_CNT AS OLD_START_READ_MTR_CNT
<!-- START 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                <!-- ,MRS.OLD_START_TEST_MTR_CNT AS OLD_START_TEST_MTR_CNT -->
<!-- END 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                ,MRS.MTR_LB_CD              AS MTR_LB_CD
                ,MRS.MTR_LB_DESC_TXT        AS MTR_LB_DESC_TXT
                ,MRS.SVC_MACH_MSTR_PK       AS SVC_MACH_MSTR_PK
                ,MRS.SER_NUM                AS SER_NUM
                ,MRE.END_MTR_READ_DT        AS END_MTR_READ_DT
                ,MRE.OLD_END_READ_MTR_CNT   AS OLD_END_READ_MTR_CNT
<!-- START 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                <!-- ,MRE.OLD_END_TEST_MTR_CNT   AS OLD_END_TEST_MTR_CNT -->
                ,MRS.OLD_TEST_MTR_CNT AS OLD_TEST_MTR_CNT
<!-- END 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                ,DCN.DS_CONTR_NUM           AS DS_CONTR_NUM
                ,DCC.DS_CONTR_CATG_ABBR_NM  AS DS_CONTR_CATG_ABBR_NM
                ,DCN.DS_CONTR_CATG_CD       AS DS_CONTR_CATG_CD
<!-- START 2017/10/02 U.Kim [QC#18749, MOD] -->
<!--            ,NULL                       AS CUST_INCDT_ID -->
<!--            ,NULL                       AS SVC_CR_REBIL_STS_DESC_TXT -->
<!--            ,NULL                       AS SVC_CR_REBIL_DESC_TXT -->
                ,SCR.CUST_INCDT_ID          AS CUST_INCDT_ID
                ,RST.SVC_CR_REBIL_STS_DESC_TXT  AS SVC_CR_REBIL_STS_DESC_TXT
                ,SCR.SVC_CR_REBIL_STS_CD    AS SVC_CR_REBIL_STS_CD
                ,SCR.SVC_CR_REBIL_DESC_TXT  AS SVC_CR_REBIL_DESC_TXT
<!-- END 2017/10/02 U.Kim [QC#18749, MOD] -->
                ,NULL                       AS SVC_CR_REBIL_PK
                ,NULL                       AS SVC_CR_REBIL_MTR_READ_PK
                ,NULL                       AS SVC_CR_REBIL_MTR_BLLG_PK
<!-- START 2017/10/02 U.Kim [QC#18749, MOD] -->
<!--            ,NULL                       AS BLLG_MTR_LB_CD -->
                ,MRS.BLLG_MTR_LB_CD         AS BLLG_MTR_LB_CD
<!-- END 2017/10/02 U.Kim [QC#18749, MOD] -->
                ,NULL                       AS NEW_START_READ_MTR_CNT
                ,NULL                       AS NEW_END_READ_MTR_CNT
<!-- START 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                <!-- ,NULL                       AS NEW_START_TEST_MTR_CNT -->
                <!-- ,NULL                       AS NEW_END_TEST_MTR_CNT -->
                ,NULL                       AS NEW_TEST_MTR_CNT
<!-- START 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                ,NULL                       AS EZUPTIME
                ,NULL                       AS EZUPTIMEZONE
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
                ,SIN.XX_REC_HIST_CRAT_TS    AS XX_REC_HIST_CRAT_TS
                ,SIN.XX_REC_HIST_CRAT_BY_NM AS XX_REC_HIST_CRAT_BY_NM
                ,SIN.XX_REC_HIST_UPD_TS     AS XX_REC_HIST_UPD_TS
                ,SIN.XX_REC_HIST_UPD_BY_NM  AS XX_REC_HIST_UPD_BY_NM
                ,SIN.XX_REC_HIST_TBL_NM     AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
            FROM
                (
                    SELECT
                         SPMS.PREV_PHYS_MTR_READ_GRP_SQ AS PREV_PHYS_MTR_READ_GRP_SQ
                        ,SPMS.SVC_PHYS_MTR_PK           AS SVC_PHYS_MTR_PK
                        ,SPMS.START_MTR_READ_DT         AS START_MTR_READ_DT
                        ,SPMS.OLD_START_READ_MTR_CNT    AS OLD_START_READ_MTR_CNT
<!-- START 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                        ,SPMS.OLD_TEST_MTR_CNT          AS OLD_TEST_MTR_CNT
<!-- END 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                        ,SPMS.DS_CONTR_BLLG_MTR_PK      AS DS_CONTR_BLLG_MTR_PK
<!-- START 2017/10/02 U.Kim [QC#18749, ADD] -->
                        ,SPMS.BLLG_MTR_LB_CD            AS BLLG_MTR_LB_CD
<!-- END 2017/10/02 U.Kim [QC#18749, ADD] -->
                        ,MTLB.MTR_LB_CD                 AS MTR_LB_CD
                        ,MTLB.MTR_LB_DESC_TXT           AS MTR_LB_DESC_TXT
                        ,MTLB.MTR_LB_SORT_NUM           AS MTR_LB_SORT_NUM
                        ,SMMR.SVC_MACH_MSTR_PK          AS SVC_MACH_MSTR_PK
                        ,SMMR.SER_NUM                   AS SER_NUM
                        <!-- START 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                        ,SMMR.MDSE_CD                   AS MDSE_CD
                        <!-- END 2022/04/04 E.Sanchez [QC#59914,ADD] -->
<!-- START 2018/07/19 K.Kojima [QC#26791,ADD] -->
                        ,SPMS.MTR_GRP_PK                AS MTR_GRP_PK
<!-- END 2018/07/19 K.Kojima [QC#26791,ADD] -->
                    FROM (
                        SELECT
                             SPM.GLBL_CMPY_CD               AS GLBL_CMPY_CD
                            ,SPM.SVC_PHYS_MTR_PK            AS SVC_PHYS_MTR_PK
                            ,SPM.SVC_PHYS_MTR_READ_GRP_SQ   AS PREV_PHYS_MTR_READ_GRP_SQ
                            ,SPM.SVC_MACH_MSTR_PK           AS SVC_MACH_MSTR_PK
                            ,SPM.MTR_LB_CD                  AS MTR_LB_CD
                            ,SPM.MTR_READ_DT                AS START_MTR_READ_DT
                            ,SPM.READ_MTR_CNT               AS OLD_START_READ_MTR_CNT
<!-- START 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                            ,BSTM.TEST_MTR_CNT              AS OLD_TEST_MTR_CNT
<!-- END 2017/09/15 E.Kameishi [QC#18636, MOD] -->
                            ,REN.DS_CONTR_BLLG_MTR_PK       AS DS_CONTR_BLLG_MTR_PK
<!-- START 2017/10/02 U.Kim [QC#18749, ADD] -->
                            ,REN.BLLG_MTR_LB_CD             AS BLLG_MTR_LB_CD
<!-- END 2017/10/02 U.Kim [QC#18749, ADD] -->
<!-- START 2018/07/19 K.Kojima [QC#26791,ADD] -->
                            ,SP.MTR_GRP_PK                  AS MTR_GRP_PK
<!-- END 2018/07/19 K.Kojima [QC#26791,ADD] -->
                        FROM
                             SVC_PHYS_MTR_READ  SPM
                            ,CONTR_PHYS_BLLG_MTR_RELN REN
                            ,SIN
<!-- START 2017/09/15 E.Kameishi [QC#18636, ADD] -->
                            ,BLLG_SCHD_TEST_MTR_SMRY BSTM
<!-- END 2017/09/15 E.Kameishi [QC#18636, ADD] -->
<!-- START 2018/07/19 K.Kojima [QC#26791,ADD] -->
                            ,SVC_PHYS_MTR SP
<!-- END 2018/07/19 K.Kojima [QC#26791,ADD] -->
                        WHERE
                                SPM.GLBL_CMPY_CD              = SIN.GLBL_CMPY_CD
                            AND SPM.SVC_PHYS_MTR_READ_GRP_SQ  = SIN.PREV_PHYS_MTR_READ_GRP_SQ
                            AND SPM.EZCANCELFLAG              = '0'
<!-- START 2018/07/19 K.Kojima [QC#26791,MOD] -->
<!--                        AND SPM.GLBL_CMPY_CD              = REN.GLBL_CMPY_CD -->
<!--                        AND SPM.SVC_PHYS_MTR_PK           = REN.SVC_PHYS_MTR_PK -->
<!--                        AND REN.EZCANCELFLAG              = '0' -->
<!--                        AND SIN.DS_CONTR_BLLG_MTR_PK      = REN.DS_CONTR_BLLG_MTR_PK -->
                            AND SPM.GLBL_CMPY_CD              = REN.GLBL_CMPY_CD(+)
                            AND SPM.SVC_PHYS_MTR_PK           = REN.SVC_PHYS_MTR_PK(+)
                            AND REN.EZCANCELFLAG(+)           = '0'
                            AND SIN.DS_CONTR_BLLG_MTR_PK      = REN.DS_CONTR_BLLG_MTR_PK(+)
<!-- END 2018/07/19 K.Kojima [QC#26791,MOD] -->
<!-- START 2017/09/15 E.Kameishi [QC#18636, MOD] -->
<!-- START 2018/07/19 K.Kojima [QC#26791,MOD] -->
<!--                        AND SIN.DS_CONTR_BLLG_SCHD_PK     = BSTM.DS_CONTR_BLLG_SCHD_PK -->
<!--                        AND SPM.SVC_PHYS_MTR_PK           = BSTM.SVC_PHYS_MTR_PK -->
                            AND SIN.DS_CONTR_BLLG_SCHD_PK     = BSTM.DS_CONTR_BLLG_SCHD_PK(+)
                            AND SPM.SVC_PHYS_MTR_PK           = BSTM.SVC_PHYS_MTR_PK(+)
<!-- END 2018/07/19 K.Kojima [QC#26791,MOD] -->
<!-- END 2017/09/15 E.Kameishi [QC#18636, MOD] -->
<!-- START 2018/07/19 K.Kojima [QC#26791,ADD] -->
                            AND SPM.GLBL_CMPY_CD              = SP.GLBL_CMPY_CD
                            AND SPM.SVC_PHYS_MTR_PK           = SP.SVC_PHYS_MTR_PK
                            AND SPM.EZCANCELFLAG              = '0'
<!-- END 2018/07/19 K.Kojima [QC#26791,ADD] -->
<!-- START 2017/07/21 K.Kim [QC#17276, ADD] -->
<!-- START 2018/06/20 K.Kojima [QC#26791, ADD] -->
<!--                        AND SPM.SVC_PHYS_MTR_PK NOT IN ( -->
<!--                            SELECT -->
<!--                                 DISTINCT SP1.SVC_PHYS_MTR_PK -->
<!--                            FROM -->
<!--                                 SVC_PHYS_MTR_READ         SPM2 -->
<!--                                ,CONTR_PHYS_BLLG_MTR_RELN  REN2 -->
<!--                                ,SIN -->
<!--                                ,SVC_PHYS_MTR              SP1 -->
<!--                                ,MTR_GRP                   MGP1 -->
<!--                                ,MTR_LB                    MTLB2 -->
<!--                            WHERE -->
<!--                                    SPM2.GLBL_CMPY_CD              = SIN.GLBL_CMPY_CD -->
<!--                                AND SPM2.SVC_PHYS_MTR_READ_GRP_SQ  = SIN.PREV_PHYS_MTR_READ_GRP_SQ -->
<!--                                AND SPM2.EZCANCELFLAG              = '0' -->
<!--                                AND SPM2.GLBL_CMPY_CD              = REN2.GLBL_CMPY_CD -->
<!--                                AND SPM2.SVC_PHYS_MTR_PK           = REN2.SVC_PHYS_MTR_PK -->
<!--                                AND REN2.EZCANCELFLAG              = '0' -->
<!--                                AND SIN.DS_CONTR_BLLG_MTR_PK       = REN2.DS_CONTR_BLLG_MTR_PK -->
<!--                                AND SP1.EZCANCELFLAG               = '0' -->
<!--                                AND SP1.GLBL_CMPY_CD               = SPM2.GLBL_CMPY_CD -->
<!--                                AND SP1.SVC_PHYS_MTR_PK            = SPM2.SVC_PHYS_MTR_PK -->
<!--                                AND MGP1.COLOR_MTR_AUTO_DRV_FLG    = 'Y' -->
<!--                                AND SP1.MTR_GRP_PK                 = MGP1.MTR_GRP_PK -->
<!--                                AND SP1.GLBL_CMPY_CD               = MGP1.GLBL_CMPY_CD -->
<!--                                AND MGP1.EZCANCELFLAG              = '0' -->
<!--                                AND MTLB2.COLOR_MTR_FLG            = 'Y' -->
<!--                                AND SP1.MDL_MTR_LB_CD              = MTLB2.MTR_LB_CD -->
<!--                                AND SP1.GLBL_CMPY_CD               = MTLB2.GLBL_CMPY_CD -->
<!--                                AND MTLB2.EZCANCELFLAG             = '0' -->
<!--                        ) -->
<!-- END 2018/06/20 K.Kojima [QC#26791, ADD] -->
<!-- END 2017/07/21 K.Kim [QC#17276, ADD] -->
                       ) SPMS
                        ,MTR_LB         MTLB
                        ,SVC_MACH_MSTR  SMMR
                    WHERE
                            SPMS.MTR_LB_CD          = MTLB.MTR_LB_CD
                        AND SPMS.GLBL_CMPY_CD       = MTLB.GLBL_CMPY_CD
                        AND MTLB.EZCANCELFLAG       = '0'
                        AND SPMS.SVC_MACH_MSTR_PK   = SMMR.SVC_MACH_MSTR_PK
                        AND SPMS.GLBL_CMPY_CD       = SMMR.GLBL_CMPY_CD
                        AND SMMR.EZCANCELFLAG       = '0') MRS
                ,(
                    SELECT
                             SPM.SVC_PHYS_MTR_READ_GRP_SQ   AS SVC_PHYS_MTR_READ_GRP_SQ
                            ,SPM.SVC_PHYS_MTR_PK            AS SVC_PHYS_MTR_PK
                            ,SPM.MTR_READ_DT                AS END_MTR_READ_DT
                            ,SPM.READ_MTR_CNT               AS OLD_END_READ_MTR_CNT
                            ,SPM.TEST_MTR_CNT               AS OLD_END_TEST_MTR_CNT
                            ,REN.DS_CONTR_BLLG_MTR_PK       AS DS_CONTR_BLLG_MTR_PK
                        FROM
                             SVC_PHYS_MTR_READ        SPM
                            ,CONTR_PHYS_BLLG_MTR_RELN REN
                            ,SIN
                        WHERE
                                SPM.GLBL_CMPY_CD             = SIN.GLBL_CMPY_CD
                            AND SPM.SVC_PHYS_MTR_READ_GRP_SQ = SIN.SVC_PHYS_MTR_READ_GRP_SQ
                            AND SPM.EZCANCELFLAG             = '0'
<!-- START 2018/07/19 K.Kojima [QC#26791,MOD] -->
<!--                        AND SPM.GLBL_CMPY_CD             = REN.GLBL_CMPY_CD -->
<!--                        AND SPM.SVC_PHYS_MTR_PK          = REN.SVC_PHYS_MTR_PK -->
<!--                        AND REN.EZCANCELFLAG             = '0' -->
<!--                        AND SIN.DS_CONTR_BLLG_MTR_PK     = REN.DS_CONTR_BLLG_MTR_PK -->
                            AND SPM.GLBL_CMPY_CD             = REN.GLBL_CMPY_CD(+)
                            AND SPM.SVC_PHYS_MTR_PK          = REN.SVC_PHYS_MTR_PK(+)
                            AND REN.EZCANCELFLAG(+)          = '0'
                            AND SIN.DS_CONTR_BLLG_MTR_PK     = REN.DS_CONTR_BLLG_MTR_PK(+)
<!-- END 2018/07/19 K.Kojima [QC#26791,MOD] -->
<!-- START 2017/07/21 K.Kim [QC#17276, ADD] -->
<!-- START 2018/06/20 K.Kojima [QC#26791, ADD] -->
<!--                        AND SPM.SVC_PHYS_MTR_PK NOT IN ( -->
<!--                            SELECT -->
<!--                                 DISTINCT SP1.SVC_PHYS_MTR_PK -->
<!--                            FROM -->
<!--                                 SVC_PHYS_MTR_READ         SPM2 -->
<!--                                ,CONTR_PHYS_BLLG_MTR_RELN  REN2 -->
<!--                                ,SIN -->
<!--                                ,SVC_PHYS_MTR              SP1 -->
<!--                                ,MTR_GRP                   MGP1 -->
<!--                                ,MTR_LB                    MTLB2 -->
<!--                            WHERE -->
<!--                                    SPM2.GLBL_CMPY_CD              = SIN.GLBL_CMPY_CD -->
<!--                                AND SPM2.SVC_PHYS_MTR_READ_GRP_SQ  = SIN.SVC_PHYS_MTR_READ_GRP_SQ -->
<!--                                AND SPM2.EZCANCELFLAG              = '0' -->
<!--                                AND SPM2.GLBL_CMPY_CD              = REN2.GLBL_CMPY_CD -->
<!--                                AND SPM2.SVC_PHYS_MTR_PK           = REN2.SVC_PHYS_MTR_PK -->
<!--                                AND REN2.EZCANCELFLAG              = '0' -->
<!--                                AND SIN.DS_CONTR_BLLG_MTR_PK       = REN2.DS_CONTR_BLLG_MTR_PK -->
<!--                                AND SP1.EZCANCELFLAG               = '0' -->
<!--                                AND SP1.GLBL_CMPY_CD               = SPM2.GLBL_CMPY_CD -->
<!--                                AND SP1.SVC_PHYS_MTR_PK            = SPM2.SVC_PHYS_MTR_PK -->
<!--                                AND MGP1.COLOR_MTR_AUTO_DRV_FLG    = 'Y' -->
<!--                                AND SP1.MTR_GRP_PK                 = MGP1.MTR_GRP_PK -->
<!--                                AND SP1.GLBL_CMPY_CD               = MGP1.GLBL_CMPY_CD -->
<!--                                AND MGP1.EZCANCELFLAG              = '0' -->
<!--                                AND MTLB2.COLOR_MTR_FLG            = 'Y' -->
<!--                                AND SP1.MDL_MTR_LB_CD              = MTLB2.MTR_LB_CD -->
<!--                                AND SP1.GLBL_CMPY_CD               = MTLB2.GLBL_CMPY_CD -->
<!--                                AND MTLB2.EZCANCELFLAG             = '0' -->
<!--                        ) -->
<!-- END 2018/06/20 K.Kojima [QC#26791, ADD] -->
<!-- END 2017/07/21 K.Kim [QC#17276, ADD] -->
               ) MRE
                ,SIN
                ,DS_CONTR_DTL   DCD
                ,DS_CONTR       DCN
                ,DS_CONTR_CATG  DCC
<!-- START 2017/10/02 U.Kim [QC#18749, ADD] -->
                ,SVC_CR_REBIL   SCR
                ,SVC_CR_REBIL_STS   RST
<!-- END 2017/10/02 U.Kim [QC#18749, ADD] -->
                <!-- START 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                ,DS_CONTR_DTL_TP        DDT
                ,DS_CONTR_DTL           DCDP
                ,SVC_MACH_MSTR          SMMP
                ,MDSE                   MDS
                ,SVC_PGM_TP             SPT
                <!-- END 2022/04/04 E.Sanchez [QC#59914,ADD] -->
            WHERE
                    SIN.PREV_PHYS_MTR_READ_GRP_SQ   = MRS.PREV_PHYS_MTR_READ_GRP_SQ
<!-- START 2018/07/19 K.Kojima [QC#26791,DEL] -->
<!--            AND SIN.DS_CONTR_BLLG_MTR_PK        = MRS.DS_CONTR_BLLG_MTR_PK -->
<!-- END 2018/07/19 K.Kojima [QC#26791,DEL] -->
                AND SIN.SVC_PHYS_MTR_READ_GRP_SQ    = MRE.SVC_PHYS_MTR_READ_GRP_SQ
<!-- START 2018/07/19 K.Kojima [QC#26791,DEL] -->
<!--            AND SIN.DS_CONTR_BLLG_MTR_PK        = MRE.DS_CONTR_BLLG_MTR_PK -->
<!-- END 2018/07/19 K.Kojima [QC#26791,DEL] -->
                AND MRS.SVC_PHYS_MTR_PK             = MRE.SVC_PHYS_MTR_PK
                AND SIN.DS_CONTR_DTL_PK             = DCD.DS_CONTR_DTL_PK
                AND SIN.GLBL_CMPY_CD                = DCD.GLBL_CMPY_CD
                AND DCD.EZCANCELFLAG                = '0'
                AND DCD.DS_CONTR_PK                 = DCN.DS_CONTR_PK
                AND DCD.GLBL_CMPY_CD                = DCN.GLBL_CMPY_CD
                AND DCN.EZCANCELFLAG                = '0'
                AND DCN.DS_CONTR_CATG_CD            = DCC.DS_CONTR_CATG_CD
                AND DCN.GLBL_CMPY_CD                = DCC.GLBL_CMPY_CD
                AND DCC.EZCANCELFLAG                = '0'
<!-- START 2017/10/02 U.Kim [QC#18749, ADD] -->
                AND SIN.GLBL_CMPY_CD                = SCR.GLBL_CMPY_CD
                AND SCR.SVC_CR_REBIL_PK             = #svcCrRebilPk#
                AND SCR.EZCANCELFLAG                = '0'
                AND SCR.GLBL_CMPY_CD                = RST.GLBL_CMPY_CD
                AND SCR.SVC_CR_REBIL_STS_CD         = RST.SVC_CR_REBIL_STS_CD
                AND RST.EZCANCELFLAG                = '0'
<!-- END 2017/10/02 U.Kim [QC#18749, ADD] -->
                <!-- START 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                AND DCD.GLBL_CMPY_CD                = DDT.GLBL_CMPY_CD
                AND DCD.DS_CONTR_DTL_TP_CD          = DDT.DS_CONTR_DTL_TP_CD
                AND DDT.EZCANCELFLAG                = '0'
                AND DCD.GLBL_CMPY_CD                = DCDP.GLBL_CMPY_CD(+)
                AND DCD.PRNT_DS_CONTR_DTL_PK        = DCDP.DS_CONTR_DTL_PK(+)
                AND DCDP.EZCANCELFLAG(+)            = '0'
                AND DCDP.GLBL_CMPY_CD               = SMMP.GLBL_CMPY_CD(+)
                AND DCDP.SVC_MACH_MSTR_PK           = SMMP.SVC_MACH_MSTR_PK(+)
                AND SMMP.EZCANCELFLAG(+)            = '0'
                AND DCD.GLBL_CMPY_CD                = MDS.GLBL_CMPY_CD(+)
                AND DCD.SVC_PGM_MDSE_CD             = MDS.MDSE_CD(+)
                AND MDS.EZCANCELFLAG(+)             = '0'
                AND MDS.GLBL_CMPY_CD                = SPT.GLBL_CMPY_CD(+)
                AND MDS.SVC_PGM_TP_CD               = SPT.SVC_PGM_TP_CD(+)
                AND SPT.EZCANCELFLAG(+)             = '0'
                <!-- END 2022/04/04 E.Sanchez [QC#59914,ADD] -->
<!-- START 2018/07/19 K.Kojima [QC#26791,ADD] -->
                AND NOT EXISTS(
                    SELECT
                        1
                    FROM
                        MTR_FMLA MF
                    WHERE
                            MF.GLBL_CMPY_CD = SIN.GLBL_CMPY_CD
                        AND MF.MTR_GRP_PK   = MRS.MTR_GRP_PK
                        AND MF.MTR_LB_CD    = MRS.MTR_LB_CD
                        AND MF.EZCANCELFLAG = '0'
                )
                AND (
                    MRS.BLLG_MTR_LB_CD IS NOT NULL
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                             MTR_FMLA_INFO            MFI
                            ,CONTR_PHYS_BLLG_MTR_RELN CPBMR2
                            ,SVC_PHYS_MTR             SPM2
                        WHERE
                                MFI.MTR_GRP_PK              = MRS.MTR_GRP_PK
                            AND MFI.FMLA_MTR_LB_CD          = MRS.MTR_LB_CD
                            AND CPBMR2.GLBL_CMPY_CD         = SIN.GLBL_CMPY_CD
                            AND CPBMR2.DS_CONTR_BLLG_MTR_PK = SIN.DS_CONTR_BLLG_MTR_PK
                            AND CPBMR2.EZCANCELFLAG         = '0'
                            AND CPBMR2.GLBL_CMPY_CD         = SPM2.GLBL_CMPY_CD
                            AND CPBMR2.SVC_PHYS_MTR_PK      = SPM2.SVC_PHYS_MTR_PK
                            AND SPM2.MDL_MTR_LB_CD          = MFI.MTR_LB_CD
                            AND SPM2.EZCANCELFLAG           = '0'
                    )
                )
<!-- END 2018/07/19 K.Kojima [QC#26791,ADD] -->
            ORDER BY
                 SIN.SVC_INV_NUM        ASC
                <!-- START 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                ,NVL(SMMP.SER_NUM, MRS.SER_NUM)
                ,NVL(SMMP.MDSE_CD, MRS.MDSE_CD)
                ,SPT.SVC_PGM_TP_SORT_NUM
                ,NVL(DCD.DS_CONTR_CRAT_TP_CD, #dsContrCratTp#)
                ,NVL(DCD.PRNT_DS_CONTR_DTL_PK, DCD.DS_CONTR_DTL_PK)
                ,DDT.DS_CONTR_DTL_TP_SORT_NUM
                ,DCD.DS_CONTR_DTL_PK
                <!-- END 2022/04/04 E.Sanchez [QC#59914,ADD] -->
                ,MRS.START_MTR_READ_DT  DESC
                ,MRS.MTR_LB_SORT_NUM    ASC)
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getPricingDataForRebilNonFleet" parameterClass="Map" resultMap="resultetPricingData">
        SELECT
             SVC_CR_REBIL_MTR_BLLG_PK
            ,SVC_INV_LINE_MTR_PK
            ,SVC_CR_REBIL_XS_MTR_BLLG_PK
            ,SVC_INV_LINE_XS_MTR_PK
            ,SER_NUM
            ,MTR_BLLG_FROM_DT
            ,MTR_BLLG_THRU_DT
            ,MTR_LB_CD
            ,MTR_LB_DESC_TXT
            ,NEW_MTR_CNT
            ,OLD_MTR_CHRG_DEAL_AMT
            ,OLD_XS_COPY_QTY
            ,OLD_XS_MTR_AMT_RATE
            ,NEW_XS_COPY_QTY
            ,NEW_XS_MTR_AMT_RATE
<!-- START 2018/08/27 [QC#24555, ADD] -->
            ,OLD_UNIT_XS_COPY_QTY
            ,NEW_UNIT_XS_COPY_QTY
<!-- END   2018/08/27 [QC#24555, ADD] -->
            ,ORIG_SVC_INV_NUM
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
            ,XX_REC_HIST_CRAT_TS
            ,XX_REC_HIST_CRAT_BY_NM
            ,XX_REC_HIST_UPD_TS
            ,XX_REC_HIST_UPD_BY_NM
            ,XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
        FROM (
            SELECT
                 RMBL.SVC_CR_REBIL_MTR_BLLG_PK      AS SVC_CR_REBIL_MTR_BLLG_PK
                ,RMBL.MTR_BLLG_FROM_DT              AS MTR_BLLG_FROM_DT
                ,RMBL.MTR_BLLG_THRU_DT              AS MTR_BLLG_THRU_DT
                ,RMBL.NEW_MTR_CNT                   AS NEW_MTR_CNT
                ,RMBL.OLD_MTR_CHRG_DEAL_AMT         AS OLD_MTR_CHRG_DEAL_AMT
                ,RXMB.SVC_CR_REBIL_XS_MTR_BLLG_PK   AS SVC_CR_REBIL_XS_MTR_BLLG_PK
                ,RXMB.OLD_XS_COPY_QTY               AS OLD_XS_COPY_QTY
                ,RXMB.OLD_XS_MTR_AMT_RATE           AS OLD_XS_MTR_AMT_RATE
                ,RXMB.NEW_XS_COPY_QTY               AS NEW_XS_COPY_QTY
                ,RXMB.NEW_XS_MTR_AMT_RATE           AS NEW_XS_MTR_AMT_RATE
                ,MTLB.MTR_LB_CD                     AS MTR_LB_CD
                ,MTLB.MTR_LB_DESC_TXT               AS MTR_LB_DESC_TXT
                ,MTLB.MTR_LB_SORT_NUM               AS MTR_LB_SORT_NUM
                ,SMMR.SER_NUM                       AS SER_NUM
                ,NULL                               AS SVC_INV_LINE_MTR_PK
                ,NULL                               AS SVC_INV_LINE_XS_MTR_PK
                ,RDTL.ORIG_SVC_INV_NUM              AS ORIG_SVC_INV_NUM
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
                ,RMBL.EZINTIME                      AS XX_REC_HIST_CRAT_TS
                ,RMBL.EZINUSERID                    AS XX_REC_HIST_CRAT_BY_NM
                ,RMBL.EZUPTIME                      AS XX_REC_HIST_UPD_TS
                ,RMBL.EZUPUSERID                    AS XX_REC_HIST_UPD_BY_NM
                ,RMBL.EZTABLEID                     AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
<!-- START 2018/08/27 [QC#24555, ADD] -->
            ,RXMB.OLD_UNIT_XS_COPY_QTY
            ,RXMB.NEW_UNIT_XS_COPY_QTY
<!-- END   2018/08/27 [QC#24555, ADD] -->
            FROM
                 SVC_CR_REBIL_MTR_BLLG      RMBL
                ,SVC_CR_REBIL_XS_MTR_BLLG   RXMB
                ,MTR_LB                     MTLB
                ,DS_CONTR_DTL               DSCD
                ,SVC_MACH_MSTR              SMMR
                ,SVC_CR_REBIL_DTL           RDTL
            WHERE
                    RMBL.GLBL_CMPY_CD               = #glblCmpyCd#
<!-- START 2018/07/19 K.Kojima [QC#26791,DEL] -->
<!--            <iterate property="svcCrRebilMtrBllgPkList" var="svcCrRebilMtrBllgPk[]" open="AND RMBL.SVC_CR_REBIL_MTR_BLLG_PK IN (" close=")" conjunction=","> -->
<!--                #svcCrRebilMtrBllgPk[]# -->
<!--            </iterate> -->
<!-- END 2018/07/19 K.Kojima [QC#26791,DEL] -->
                AND RMBL.EZCANCELFLAG               = '0'
                AND RMBL.SVC_CR_REBIL_MTR_BLLG_PK   = RXMB.SVC_CR_REBIL_MTR_BLLG_PK
                AND RMBL.GLBL_CMPY_CD               = RXMB.GLBL_CMPY_CD
                AND RXMB.EZCANCELFLAG               = '0'
                AND RMBL.BLLG_MTR_LB_CD             = MTLB.MTR_LB_CD
                AND RMBL.GLBL_CMPY_CD               = MTLB.GLBL_CMPY_CD
                AND MTLB.EZCANCELFLAG               = '0'
                AND RMBL.DS_CONTR_DTL_PK            = DSCD.DS_CONTR_DTL_PK
                AND RMBL.GLBL_CMPY_CD               = DSCD.GLBL_CMPY_CD
                AND DSCD.EZCANCELFLAG               = '0'
                AND DSCD.SVC_MACH_MSTR_PK           = SMMR.SVC_MACH_MSTR_PK
                AND DSCD.GLBL_CMPY_CD               = SMMR.GLBL_CMPY_CD
<!-- START 2018/07/19 K.Kojima [QC#26791,ADD] -->
                <iterate property="svcMachMstrPkList" var="svcMachMstrPk[]" open="AND SMMR.SVC_MACH_MSTR_PK IN (" close=")" conjunction=",">
                    #svcMachMstrPk[]#
                </iterate>
<!-- END 2018/07/19 K.Kojima [QC#26791,ADD] -->
                AND SMMR.EZCANCELFLAG               = '0'
                AND RMBL.SVC_CR_REBIL_DTL_PK        = RDTL.SVC_CR_REBIL_DTL_PK
                AND RMBL.GLBL_CMPY_CD               = RDTL.GLBL_CMPY_CD
<!-- START 2018/07/19 K.Kojima [QC#26791,ADD] -->
                AND RDTL.SVC_CR_REBIL_DTL_PK        = #svcCrRebilDtlPk#
<!-- END 2018/07/19 K.Kojima [QC#26791,ADD] -->
                AND RDTL.EZCANCELFLAG               = '0'
            <!-- add start 2016/04/18 CSA Defect#7056 -->
            UNION ALL
            <!-- Aggregate Line -->
            SELECT
                 RMBL.SVC_CR_REBIL_MTR_BLLG_PK      AS SVC_CR_REBIL_MTR_BLLG_PK
                ,RMBL.MTR_BLLG_FROM_DT              AS MTR_BLLG_FROM_DT
                ,RMBL.MTR_BLLG_THRU_DT              AS MTR_BLLG_THRU_DT
                ,RMBL.NEW_MTR_CNT                   AS NEW_MTR_CNT
                ,RMBL.OLD_MTR_CHRG_DEAL_AMT         AS OLD_MTR_CHRG_DEAL_AMT
                ,RXMB.SVC_CR_REBIL_XS_MTR_BLLG_PK   AS SVC_CR_REBIL_XS_MTR_BLLG_PK
                ,RXMB.OLD_XS_COPY_QTY               AS OLD_XS_COPY_QTY
                ,RXMB.OLD_XS_MTR_AMT_RATE           AS OLD_XS_MTR_AMT_RATE
                ,RXMB.NEW_XS_COPY_QTY               AS NEW_XS_COPY_QTY
                ,RXMB.NEW_XS_MTR_AMT_RATE           AS NEW_XS_MTR_AMT_RATE
                ,MTLB.MTR_LB_CD                     AS MTR_LB_CD
                ,MTLB.MTR_LB_DESC_TXT               AS MTR_LB_DESC_TXT
                ,MTLB.MTR_LB_SORT_NUM               AS MTR_LB_SORT_NUM
                ,NULL                               AS SER_NUM
                ,NULL                               AS SVC_INV_LINE_MTR_PK
                ,NULL                               AS SVC_INV_LINE_XS_MTR_PK
                ,RDTL.ORIG_SVC_INV_NUM              AS ORIG_SVC_INV_NUM
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
                ,RMBL.EZINTIME                      AS XX_REC_HIST_CRAT_TS
                ,RMBL.EZINUSERID                    AS XX_REC_HIST_CRAT_BY_NM
                ,RMBL.EZUPTIME                      AS XX_REC_HIST_UPD_TS
                ,RMBL.EZUPUSERID                    AS XX_REC_HIST_UPD_BY_NM
                ,RMBL.EZTABLEID                     AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
<!-- START 2018/08/27 [QC#24555, ADD] -->
            ,RXMB.OLD_UNIT_XS_COPY_QTY
            ,RXMB.NEW_UNIT_XS_COPY_QTY
<!-- END   2018/08/27 [QC#24555, ADD] -->
            FROM
                SVC_CR_REBIL_DTL            RDTL
                ,SVC_CR_REBIL_MTR_BLLG      RMBL
                ,SVC_CR_REBIL_XS_MTR_BLLG   RXMB
                ,MTR_LB                     MTLB
                ,DS_CONTR_DTL               DSCD
            WHERE
                    RDTL.GLBL_CMPY_CD               = #glblCmpyCd#
                AND RDTL.SVC_CR_REBIL_DTL_PK        = #svcCrRebilDtlPk#
                AND RDTL.EZCANCELFLAG               = '0'
                AND RDTL.GLBL_CMPY_CD               = RMBL.GLBL_CMPY_CD
                AND RDTL.SVC_CR_REBIL_DTL_PK        = RMBL.SVC_CR_REBIL_DTL_PK
                AND RMBL.EZCANCELFLAG               = '0'
                AND RMBL.SVC_CR_REBIL_MTR_BLLG_PK   = RXMB.SVC_CR_REBIL_MTR_BLLG_PK
                AND RMBL.GLBL_CMPY_CD               = RXMB.GLBL_CMPY_CD
                AND RXMB.EZCANCELFLAG               = '0'
                AND RMBL.BLLG_MTR_LB_CD             = MTLB.MTR_LB_CD
                AND RMBL.GLBL_CMPY_CD               = MTLB.GLBL_CMPY_CD
                AND MTLB.EZCANCELFLAG               = '0'
                AND RMBL.DS_CONTR_DTL_PK            = DSCD.DS_CONTR_DTL_PK
                AND RMBL.GLBL_CMPY_CD               = DSCD.GLBL_CMPY_CD
                AND DSCD.DS_CONTR_DTL_TP_CD         = #dsContrDtlTpAgg#
                AND DSCD.EZCANCELFLAG               = '0'
            <!-- add end 2016/04/18 CSA Defect#7056 -->
            ORDER BY
                 SER_NUM           ASC NULLS FIRST
                ,MTR_BLLG_FROM_DT  DESC
                ,MTR_LB_SORT_NUM   ASC
                ,OLD_XS_COPY_QTY   ASC)
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getPricingDataForRebilFleet" parameterClass="Map" resultMap="resultetPricingData">
        SELECT
             SVC_CR_REBIL_MTR_BLLG_PK
            ,SVC_INV_LINE_MTR_PK
            ,SVC_CR_REBIL_XS_MTR_BLLG_PK
            ,SVC_INV_LINE_XS_MTR_PK
            ,SER_NUM
            ,MTR_BLLG_FROM_DT
            ,MTR_BLLG_THRU_DT
            ,MTR_LB_CD
            ,MTR_LB_DESC_TXT
            ,NEW_MTR_CNT
            ,OLD_MTR_CHRG_DEAL_AMT
            ,OLD_XS_COPY_QTY
            ,OLD_XS_MTR_AMT_RATE
            ,NEW_XS_COPY_QTY
            ,NEW_XS_MTR_AMT_RATE
            ,ORIG_SVC_INV_NUM
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
            ,XX_REC_HIST_CRAT_TS
            ,XX_REC_HIST_CRAT_BY_NM
            ,XX_REC_HIST_UPD_TS
            ,XX_REC_HIST_UPD_BY_NM
            ,XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
<!-- START 2018/08/27 [QC#24555, ADD] -->
            ,OLD_UNIT_XS_COPY_QTY
            ,NEW_UNIT_XS_COPY_QTY
<!-- END   2018/08/27 [QC#24555, ADD] -->
        FROM (
            SELECT
                 RMBL.SVC_CR_REBIL_MTR_BLLG_PK      AS SVC_CR_REBIL_MTR_BLLG_PK
                ,RMBL.MTR_BLLG_FROM_DT              AS MTR_BLLG_FROM_DT
                ,RMBL.MTR_BLLG_THRU_DT              AS MTR_BLLG_THRU_DT
                ,RMBL.NEW_MTR_CNT                   AS NEW_MTR_CNT
                ,RMBL.OLD_MTR_CHRG_DEAL_AMT         AS OLD_MTR_CHRG_DEAL_AMT
                ,RXMB.SVC_CR_REBIL_XS_MTR_BLLG_PK   AS SVC_CR_REBIL_XS_MTR_BLLG_PK
                ,RXMB.OLD_XS_COPY_QTY               AS OLD_XS_COPY_QTY
                ,RXMB.OLD_XS_MTR_AMT_RATE           AS OLD_XS_MTR_AMT_RATE
                ,RXMB.NEW_XS_COPY_QTY               AS NEW_XS_COPY_QTY
                ,RXMB.NEW_XS_MTR_AMT_RATE           AS NEW_XS_MTR_AMT_RATE
                ,MTLB.MTR_LB_CD                     AS MTR_LB_CD
                ,MTLB.MTR_LB_DESC_TXT               AS MTR_LB_DESC_TXT
                ,NULL                               AS SER_NUM
                ,NULL                               AS SVC_INV_LINE_MTR_PK
                ,NULL                               AS SVC_INV_LINE_XS_MTR_PK
                ,RDTL.ORIG_SVC_INV_NUM              AS ORIG_SVC_INV_NUM
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
                ,RMBL.EZINTIME                      AS XX_REC_HIST_CRAT_TS
                ,RMBL.EZINUSERID                    AS XX_REC_HIST_CRAT_BY_NM
                ,RMBL.EZUPTIME                      AS XX_REC_HIST_UPD_TS
                ,RMBL.EZUPUSERID                    AS XX_REC_HIST_UPD_BY_NM
                ,RMBL.EZTABLEID                     AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
<!-- START 2018/08/27 [QC#24555, ADD] -->
               ,RXMB.OLD_UNIT_XS_COPY_QTY
               ,RXMB.NEW_UNIT_XS_COPY_QTY
<!-- END   2018/08/27 [QC#24555, ADD] -->
            FROM
                 SVC_CR_REBIL_MTR_BLLG      RMBL
                ,SVC_CR_REBIL_XS_MTR_BLLG   RXMB
                ,MTR_LB                     MTLB
                ,DS_CONTR_DTL               DSCD
                ,SVC_CR_REBIL_DTL           RDTL
            WHERE
                    RMBL.SVC_CR_REBIL_DTL_PK        = #svcCrRebilDtlPk#
                AND RMBL.GLBL_CMPY_CD               = #glblCmpyCd#
                AND RMBL.EZCANCELFLAG               = '0'
                AND RMBL.SVC_CR_REBIL_MTR_BLLG_PK   = RXMB.SVC_CR_REBIL_MTR_BLLG_PK
                AND RMBL.GLBL_CMPY_CD               = RXMB.GLBL_CMPY_CD
                AND RXMB.EZCANCELFLAG               = '0'
                AND RMBL.BLLG_MTR_LB_CD             = MTLB.MTR_LB_CD
                AND RMBL.GLBL_CMPY_CD               = MTLB.GLBL_CMPY_CD
                AND MTLB.EZCANCELFLAG               = '0'
                AND RMBL.DS_CONTR_DTL_PK            = DSCD.DS_CONTR_DTL_PK
                AND RMBL.GLBL_CMPY_CD               = DSCD.GLBL_CMPY_CD
                AND DSCD.DS_CONTR_DTL_TP_CD         = #dsContrDtlTpCd_Fleet#
                AND DSCD.EZCANCELFLAG               = '0'
                AND RMBL.SVC_CR_REBIL_DTL_PK        = RDTL.SVC_CR_REBIL_DTL_PK
                AND RMBL.GLBL_CMPY_CD               = RDTL.GLBL_CMPY_CD
                AND RDTL.EZCANCELFLAG               = '0'
            ORDER BY
                 RMBL.MTR_BLLG_FROM_DT  DESC
                ,MTLB.MTR_LB_SORT_NUM   ASC
                ,RXMB.OLD_XS_COPY_QTY   ASC)
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getPricingDataForInvNonFleet" parameterClass="Map" resultMap="resultetPricingData">
        SELECT
             SVC_CR_REBIL_MTR_BLLG_PK
            ,SVC_INV_LINE_MTR_PK
            ,SVC_CR_REBIL_XS_MTR_BLLG_PK
            ,SVC_INV_LINE_XS_MTR_PK
            ,SER_NUM
            ,MTR_BLLG_FROM_DT
            ,MTR_BLLG_THRU_DT
            ,MTR_LB_CD
            ,MTR_LB_DESC_TXT
            ,NEW_MTR_CNT
            ,OLD_MTR_CHRG_DEAL_AMT
            ,OLD_XS_COPY_QTY
            ,OLD_XS_MTR_AMT_RATE
            ,NEW_XS_COPY_QTY
            ,NEW_XS_MTR_AMT_RATE
            ,ORIG_SVC_INV_NUM
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
            ,XX_REC_HIST_CRAT_TS
            ,XX_REC_HIST_CRAT_BY_NM
            ,XX_REC_HIST_UPD_TS
            ,XX_REC_HIST_UPD_BY_NM
            ,XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
        FROM (
            SELECT
                 ILMR.SVC_INV_LINE_MTR_PK       AS SVC_INV_LINE_MTR_PK
                ,ILIN.BLLG_PER_FROM_DT          AS MTR_BLLG_FROM_DT
                ,ILIN.BLLG_PER_THRU_DT          AS MTR_BLLG_THRU_DT
                ,ILXM.SVC_INV_LINE_XS_MTR_PK    AS SVC_INV_LINE_XS_MTR_PK
                ,ILXM.XS_MTR_CHRG_DEAL_AMT      AS OLD_MTR_CHRG_DEAL_AMT
                ,ILXM.XS_MTR_COPY_QTY           AS OLD_XS_COPY_QTY
                ,ILXM.XS_MTR_AMT_RATE           AS OLD_XS_MTR_AMT_RATE
                ,MTLB.MTR_LB_CD                 AS MTR_LB_CD
                ,MTLB.MTR_LB_DESC_TXT           AS MTR_LB_DESC_TXT
                ,SMMR.SER_NUM                   AS SER_NUM
                ,NULL                           AS NEW_MTR_CNT
                ,NULL                           AS NEW_XS_COPY_QTY
                ,NULL                           AS NEW_XS_MTR_AMT_RATE
                ,NULL                           AS SVC_CR_REBIL_MTR_BLLG_PK
                ,NULL                           AS SVC_CR_REBIL_XS_MTR_BLLG_PK
                ,ILIN.SVC_INV_NUM               AS ORIG_SVC_INV_NUM
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
                ,ILMR.EZINTIME                      AS XX_REC_HIST_CRAT_TS
                ,ILMR.EZINUSERID                    AS XX_REC_HIST_CRAT_BY_NM
                ,ILMR.EZUPTIME                      AS XX_REC_HIST_UPD_TS
                ,ILMR.EZUPUSERID                    AS XX_REC_HIST_UPD_BY_NM
                ,ILMR.EZTABLEID                     AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
            FROM
                 SVC_INV_LINE_MTR    ILMR
                ,SVC_INV_LINE        ILIN
                ,SVC_INV_LINE_XS_MTR ILXM
                ,MTR_LB              MTLB
                ,SVC_MACH_MSTR       SMMR
            WHERE
                <iterate property="svcInvLineMtrPkList" var="svcInvLineMtrPk[]" open="ILMR.SVC_INV_LINE_MTR_PK IN (" close=")" conjunction=",">
                    #svcInvLineMtrPk[]#
                </iterate>
                AND ILMR.GLBL_CMPY_CD           = #glblCmpyCd#
                AND ILMR.EZCANCELFLAG           = '0'
                AND ILMR.SVC_INV_LINE_PK        = ILIN.SVC_INV_LINE_PK
                AND ILMR.GLBL_CMPY_CD           = ILIN.GLBL_CMPY_CD
                AND ILIN.EZCANCELFLAG           = '0'
                AND ILMR.SVC_INV_LINE_MTR_PK    = ILXM.SVC_INV_LINE_MTR_PK
                AND ILMR.GLBL_CMPY_CD           = ILXM.GLBL_CMPY_CD
                AND ILXM.EZCANCELFLAG           = '0'
                AND ILMR.MTR_LB_CD              = MTLB.MTR_LB_CD
                AND ILMR.GLBL_CMPY_CD           = MTLB.GLBL_CMPY_CD
                AND MTLB.EZCANCELFLAG           = '0'
                AND ILIN.SVC_MACH_MSTR_PK       = SMMR.SVC_MACH_MSTR_PK
                AND ILMR.GLBL_CMPY_CD           = SMMR.GLBL_CMPY_CD
                AND SMMR.EZCANCELFLAG           = '0'
                ORDER BY
                     SMMR.SER_NUM           ASC
                    ,ILIN.BLLG_PER_FROM_DT  DESC
                    ,MTLB.MTR_LB_SORT_NUM   ASC
                    ,ILXM.XS_MTR_COPY_QTY   ASC)
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getPricingDataForInvFleet" parameterClass="Map" resultMap="resultetPricingData">
        SELECT
             SVC_CR_REBIL_MTR_BLLG_PK
            ,SVC_INV_LINE_MTR_PK
            ,SVC_CR_REBIL_XS_MTR_BLLG_PK
            ,SVC_INV_LINE_XS_MTR_PK
            ,SER_NUM
            ,MTR_BLLG_FROM_DT
            ,MTR_BLLG_THRU_DT
            ,MTR_LB_CD
            ,MTR_LB_DESC_TXT
            ,NEW_MTR_CNT
            ,OLD_MTR_CHRG_DEAL_AMT
            ,OLD_XS_COPY_QTY
            ,OLD_XS_MTR_AMT_RATE
            ,NEW_XS_COPY_QTY
            ,NEW_XS_MTR_AMT_RATE
            ,ORIG_SVC_INV_NUM
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
            ,XX_REC_HIST_CRAT_TS
            ,XX_REC_HIST_CRAT_BY_NM
            ,XX_REC_HIST_UPD_TS
            ,XX_REC_HIST_UPD_BY_NM
            ,XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
        FROM (
            SELECT
                 ILMR.SVC_INV_LINE_MTR_PK       AS SVC_INV_LINE_MTR_PK
                ,ILIN.BLLG_PER_FROM_DT          AS MTR_BLLG_FROM_DT
                ,ILIN.BLLG_PER_THRU_DT          AS MTR_BLLG_THRU_DT
                ,ILXM.SVC_INV_LINE_XS_MTR_PK    AS SVC_INV_LINE_XS_MTR_PK
                ,ILXM.XS_MTR_CHRG_DEAL_AMT      AS OLD_MTR_CHRG_DEAL_AMT
                ,ILXM.XS_MTR_COPY_QTY           AS OLD_XS_COPY_QTY
                ,ILXM.XS_MTR_AMT_RATE           AS OLD_XS_MTR_AMT_RATE
                ,MTLB.MTR_LB_CD                 AS MTR_LB_CD
                ,MTLB.MTR_LB_DESC_TXT           AS MTR_LB_DESC_TXT
                ,NULL                           AS SER_NUM
                ,NULL                           AS NEW_MTR_CNT
                ,NULL                           AS NEW_XS_COPY_QTY
                ,NULL                           AS NEW_XS_MTR_AMT_RATE
                ,NULL                           AS SVC_CR_REBIL_MTR_BLLG_PK
                ,NULL                           AS SVC_CR_REBIL_XS_MTR_BLLG_PK
                ,ILIN.SVC_INV_NUM               AS ORIG_SVC_INV_NUM
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
                ,ILMR.EZINTIME                      AS XX_REC_HIST_CRAT_TS
                ,ILMR.EZINUSERID                    AS XX_REC_HIST_CRAT_BY_NM
                ,ILMR.EZUPTIME                      AS XX_REC_HIST_UPD_TS
                ,ILMR.EZUPUSERID                    AS XX_REC_HIST_UPD_BY_NM
                ,ILMR.EZTABLEID                     AS XX_REC_HIST_TBL_NM
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
            FROM
                 SVC_INV_LINE        ILIN
                ,SVC_INV_LINE_MTR    ILMR
                ,SVC_INV_LINE_XS_MTR ILXM
                ,MTR_LB              MTLB
                ,DS_CONTR_DTL        DSCD
            WHERE
                    ILIN.GLBL_CMPY_CD           = #glblCmpyCd#
                AND ILIN.SVC_INV_LINE_PK        = #svcInvLinePk#
                AND ILIN.EZCANCELFLAG           = '0'
                AND ILIN.SVC_INV_LINE_PK        = ILMR.SVC_INV_LINE_PK
                AND ILIN.GLBL_CMPY_CD           = ILMR.GLBL_CMPY_CD
                AND ILMR.EZCANCELFLAG           = '0'
                AND ILMR.SVC_INV_LINE_MTR_PK    = ILXM.SVC_INV_LINE_MTR_PK
                AND ILMR.GLBL_CMPY_CD           = ILXM.GLBL_CMPY_CD
                AND ILXM.EZCANCELFLAG           = '0'
                AND ILMR.MTR_LB_CD              = MTLB.MTR_LB_CD
                AND ILMR.GLBL_CMPY_CD           = MTLB.GLBL_CMPY_CD
                AND MTLB.EZCANCELFLAG           = '0'
                AND ILIN.DS_CONTR_DTL_PK        = DSCD.DS_CONTR_DTL_PK
                AND ILIN.GLBL_CMPY_CD           = DSCD.GLBL_CMPY_CD
                AND DSCD.DS_CONTR_DTL_TP_CD     = #dsContrDtlTpCd_Fleet#
                AND DSCD.EZCANCELFLAG           = '0'
                ORDER BY
                     ILIN.BLLG_PER_FROM_DT  DESC
                    ,MTLB.MTR_LB_SORT_NUM   ASC
                    ,ILXM.XS_MTR_COPY_QTY   ASC)
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <typeAlias alias="NSAL1120_CSMsg"  type="business.blap.NSAL1120.NSAL1120_CSMsg"/>

    <resultMap id="resultetPricingData" class="NSAL1120_CSMsg">
        <result property="svcCrRebilMtrBllgPk_C"    column="SVC_CR_REBIL_MTR_BLLG_PK"    javaType="EZDSBigDecimalItem" />
        <result property="svcInvLineMtrPk_C"        column="SVC_INV_LINE_MTR_PK"         javaType="EZDSBigDecimalItem" />
        <result property="svcCrRebilXsMtrBllgPk_C"  column="SVC_CR_REBIL_XS_MTR_BLLG_PK" javaType="EZDSBigDecimalItem" />
        <result property="svcInvLineXsMtrPk_C"      column="SVC_INV_LINE_XS_MTR_PK"      javaType="EZDSBigDecimalItem" />
        <result property="serNum_C"                 column="SER_NUM"                     javaType="EZDCStringItem" />
        <result property="mtrBllgFromDt_C"          column="MTR_BLLG_FROM_DT"            javaType="EZDSDateItem" />
        <result property="mtrBllgThruDt_C"          column="MTR_BLLG_THRU_DT"            javaType="EZDSDateItem" />
        <result property="mtrLbCd_C"                column="MTR_LB_CD"                   javaType="EZDCStringItem" />
        <result property="mtrLbDescTxt_C"           column="MTR_LB_DESC_TXT"             javaType="EZDCStringItem" />
        <result property="newMtrCnt_C"              column="NEW_MTR_CNT"                 javaType="EZDSBigDecimalItem" />
        <result property="oldMtrChrgDealAmt_C"      column="OLD_MTR_CHRG_DEAL_AMT"       javaType="EZDSBigDecimalItem" />
        <result property="oldXsCopyQty_C"           column="OLD_XS_COPY_QTY"             javaType="EZDSBigDecimalItem" />
        <result property="oldXsMtrAmtRate_C"        column="OLD_XS_MTR_AMT_RATE"         javaType="EZDSBigDecimalItem" />
        <result property="newXsCopyQty_C"           column="NEW_XS_COPY_QTY"             javaType="EZDSBigDecimalItem" />
        <result property="newXsMtrAmtRate_C"        column="NEW_XS_MTR_AMT_RATE"         javaType="EZDSBigDecimalItem" />
        <result property="origSvcInvNum_C"          column="ORIG_SVC_INV_NUM"            javaType="EZDSStringItem" />
<!-- START 2016/12/07 N.Arai [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_C"        column="XX_REC_HIST_CRAT_TS"         javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_C"      column="XX_REC_HIST_CRAT_BY_NM"      javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_C"         column="XX_REC_HIST_UPD_TS"          javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_C"       column="XX_REC_HIST_UPD_BY_NM"       javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_C"         column="XX_REC_HIST_TBL_NM"          javaType="EZDSStringItem"/>
<!-- END 2016/12/07 N.Arai [QC#14204, ADD] -->
<!-- START 2018/08/27 [QC#24555, ADD] -->
        <result property="oldUnitXsCopyQty_C"       column="OLD_UNIT_XS_COPY_QTY"        javaType="EZDSBigDecimalItem" />
        <result property="newUnitXsCopyQty_C"       column="NEW_UNIT_XS_COPY_QTY"        javaType="EZDSBigDecimalItem" />
<!-- END    2018/08/27 [QC#24555, ADD] -->
   </resultMap>
</sqlMap>
