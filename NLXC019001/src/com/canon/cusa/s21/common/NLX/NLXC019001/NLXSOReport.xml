<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLXSOReport">

    <!-- ==== Type Aliases ==== -->

    <!-- ==== Result Mapping ==== -->

    <statement id="selectSoMessage" parameterClass="Map">
     SELECT
               SO_MSG_DESC_TXT
              ,TXT_SQ_NUM
     FROM
               SHPG_ORD_MSG
     WHERE
                  SO_NUM            =  #soNum#
             AND  SO_MSG_TP_CD IN  ( #cpoInfo# , #routingMsg# )
             AND  EZCANCELFLAG      =  '0'
             AND  GLBL_CMPY_CD      =  #glblCmpyCd#
     ORDER BY
                  SO_NUM
                 ,SO_MSG_TP_CD
                 ,TXT_SQ_NUM
    </statement>

    <statement id="selectSoMessageBulk" parameterClass="Map">
     SELECT
               SO_MSG_DESC_TXT
              ,TXT_SQ_NUM
              ,SO_NUM
     FROM
               SHPG_ORD_MSG
     WHERE
             <iterate property="soNumList" var="soNumList[]" open="(" close=")" conjunction="OR">
                  SO_NUM            =  #soNumList[]#
             </iterate>
             AND  SO_MSG_TP_CD IN  ( #cpoInfo# , #routingMsg# )
             AND  EZCANCELFLAG      =  '0'
             AND  GLBL_CMPY_CD      =  #glblCmpyCd#
     ORDER BY
                  SO_NUM
                 ,SO_MSG_TP_CD
                 ,TXT_SQ_NUM
    </statement>
    
    <statement id="selectSo" parameterClass="Map">
     WITH
              SO_V AS
              (
               SELECT
                     SO.SO_NUM               SO_NUM
                ,    SO.DNLD_TM_TS           DNLD_TM_TS
                ,    SO.WH_CD                WH_CD
                ,    SO.FRT_CHRG_TO_CD       FRT_CHRG_TO_CD
                ,    SO.FRT_CHRG_METH_CD     FRT_CHRG_METH_CD
                ,    SO.CARR_ACCT_NUM        CARR_ACCT_NUM
                ,    SO.SHPG_SVC_LVL_CD      SHPG_SVC_LVL_CD
                ,    SO.SHPG_MODE_CD         SHPG_MODE_CD
                ,    SOD.TRX_HDR_NUM         TRX_HDR_NUM
                ,    SO.PSD_DT               PSD_DT
                ,    SO.PDD_DT               PDD_DT
                ,    SO.RSD_DT               RSD_DT
                ,    SO.RDD_DT               RDD_DT
                ,    SO.CUST_ISS_PO_NUM      CUST_ISS_PO_NUM
                ,    SO.RTE_GRP_NUM          RTE_GRP_NUM
                ,    SO.TOT_SHIP_AMT         TOT_SHIP_AMT
                ,    SO.SCE_ORD_TP_CD        SCE_ORD_TP_CD
                ,    SO.EXPT_SHPG_METH_CD    EXPT_SHPG_METH_CD
                ,    SOD.RQST_ORD_QTY        RQST_ORD_QTY
                ,    SOD.SHPG_QTY            SHPG_QTY
                ,    SOD.FROM_STK_STS_CD     FROM_STK_STS_CD
                ,    SOD.TO_STK_STS_CD       TO_STK_STS_CD
                ,    SOD.MDSE_CD             MDSE_CD
                ,    SOD.CUST_MDSE_CD        CUST_MDSE_CD
                ,    SOD.SER_NUM_TAKE_FLG    SER_NUM_TAKE_FLG
                ,    SOD.SET_MDSE_CD         SET_MDSE_CD
                ,    SOD.SET_MDSE_NM         SET_MDSE_NM
                ,    SO.GLBL_CMPY_CD         GLBL_CMPY_CD
                ,    SO.EZCANCELFLAG         EZCANCELFLAG
                ,    SOD.SO_SLP_NUM          SO_SLP_NUM
                <!-- 04/11/2012 Oce#22 START -->
                ,    SO.SO_CONFIG_FLG        SO_CONFIG_FLG
                ,    SOD.CONFIG_ITEM_FLG     CONFIG_ITEM_FLG
                <!-- 04/11/2012 Oce#22 END -->
                <!-- 2014/05/20 CSA#38 START -->
                ,    SOD.TOT_SHPG_WT         TOT_SHPG_WT
                <!-- 2014/05/20 CSA#38 END -->
                FROM
                  SHPG_ORD           SO
                 ,SHPG_ORD_DTL       SOD
               WHERE
                   <iterate property="soNumList" var="soNumList[]" open="(" close=")" conjunction="OR">
                        SO.SO_NUM                   =  #soNumList[]#
                   </iterate>
                   AND  SO.GLBL_CMPY_CD             =  #glblCmpyCd#
                   AND  SO.EZCANCELFLAG             =  '0'
                   AND  SOD.SO_NUM                  =  SO.SO_NUM
                   AND  SOD.GLBL_CMPY_CD            =  SO.GLBL_CMPY_CD
                   AND  SOD.EZCANCELFLAG            =  '0'
              )
     SELECT
               SO_V.SO_NUM                   SO_NUM
              ,SO_V.DNLD_TM_TS               DNLD_TM_TS
              ,SO_V.WH_CD                    WH_CD
              ,SO_V.FRT_CHRG_TO_CD           FRT_CHRG_TO_CD
              ,SO_V.FRT_CHRG_METH_CD         FRT_CHRG_METH_CD
              ,SO_V.CARR_ACCT_NUM            CARR_ACCT_NUM
              ,SO_V.SHPG_SVC_LVL_CD          SHPG_SVC_LVL_CD
              ,SO_V.SHPG_MODE_CD             SHPG_MODE_CD
              ,SO_V.TRX_HDR_NUM              TRX_HDR_NUM
              ,SO_V.PSD_DT                   PSD_DT
              ,SO_V.PDD_DT                   PDD_DT
              ,SO_V.RSD_DT                   RSD_DT
              ,SO_V.RDD_DT                   RDD_DT
              ,SO_V.CUST_ISS_PO_NUM          CUST_ISS_PO_NUM
              ,SO_V.RTE_GRP_NUM              RTE_GRP_NUM
              ,SO_V.TOT_SHIP_AMT             TOT_SHIP_AMT
              ,SO_V.SCE_ORD_TP_CD            SCE_ORD_TP_CD
              ,SO_V.EXPT_SHPG_METH_CD        SHPG_METH_CD
              ,MTH.SHPG_METH_NM              SHPG_METH_NM
              ,SOT.SCE_ORD_TP_NM             SCE_ORD_TP_NM
              ,SO_V.RQST_ORD_QTY             RQST_ORD_QTY
              ,SO_V.SHPG_QTY                 SHPG_QTY
              ,SO_V.FROM_STK_STS_CD          FROM_STK_STS_CD
              ,SO_V.TO_STK_STS_CD            TO_STK_STS_CD
              ,SO_V.MDSE_CD                  MDSE_CD
              ,SO_V.CUST_MDSE_CD             CUST_MDSE_CD
              ,SO_V.SER_NUM_TAKE_FLG         SER_NUM_TAKE_FLG
              ,SO_V.SET_MDSE_CD              SET_MDSE_CD
              ,SO_V.SET_MDSE_NM              SET_MDSE_NM
              ,FCM.FRT_CHRG_METH_NM          FRT_CHRG_METH_NM
              ,FCT.FRT_CHRG_TO_NM            FRT_CHRG_TO_NM
              ,GC.GLBL_CMPY_NM               GLBL_CMPY_NM
              ,GC.STD_CCY_CD                 STD_CCY_CD
              ,WH.FIRST_LINE_ADDR            FIRST_LINE_ADDR
              ,WH.SCD_LINE_ADDR              SCD_LINE_ADDR
              ,WH.THIRD_LINE_ADDR            THIRD_LINE_ADDR
              ,WH.FRTH_LINE_ADDR             FRTH_LINE_ADDR
              ,WH.CTY_ADDR                   CTY_ADDR
              ,WH.ST_CD                      ST_CD
              ,WH.POST_CD                    POST_CD
              ,MDSE.MDSE_NM                  MDSE_NM
              ,MDSE.UPC_CD                   UPC_CD
              ,STC.S80_SHPG_TERM_CD          S80_SHPG_TERM_CD
              ,SST.S80_SHPG_TERM_NM          S80_SHPG_TERM_NM
              ,MOD.SHPG_MODE_NM              SHPG_MODE_NM
              ,SSL.SHPG_SVC_LVL_NM           SHPG_SVC_LVL_NM
              ,SSFR.STK_STS_NM               FROM_STK_STS_NM
              ,SSTO.STK_STS_NM               TO_STK_STS_NM
              ,CRET.SO_CUST_LINE_LOC_NM_01   RT_CUST_LINE_LOC_NM_01
              ,CRET.SO_CUST_LINE_LOC_NM_02   RT_CUST_LINE_LOC_NM_02
              ,CRET.SO_CUST_LINE_ADDR_01     RT_CUST_LINE_ADDR_01
              ,CRET.SO_CUST_LINE_ADDR_02     RT_CUST_LINE_ADDR_02
              ,CRET.SO_CUST_LINE_ADDR_03     RT_CUST_LINE_ADDR_03
              ,CRET.SO_CUST_LINE_ADDR_04     RT_CUST_LINE_ADDR_04
              ,CRET.CTY_ADDR                 RT_CTY_ADDR
              ,CRET.ST_CD                    RT_ST_CD
              ,CRET.POST_CD                  RT_POST_CD
              ,CSEL.SO_CUST_LINE_LOC_NM_01   SL_CUST_LINE_LOC_NM_01
              ,CSEL.SO_CUST_LINE_LOC_NM_02   SL_CUST_LINE_LOC_NM_02
              ,CSEL.SO_CUST_LINE_ADDR_01     SL_CUST_LINE_ADDR_01
              ,CSEL.SO_CUST_LINE_ADDR_02     SL_CUST_LINE_ADDR_02
              ,CSEL.SO_CUST_LINE_ADDR_03     SL_CUST_LINE_ADDR_03
              ,CSEL.SO_CUST_LINE_ADDR_04     SL_CUST_LINE_ADDR_04
              ,CSEL.CTY_ADDR                 SL_CTY_ADDR
              ,CSEL.ST_CD                    SL_ST_CD
              ,CSEL.POST_CD                  SL_POST_CD
              ,CSHP.SO_CUST_LINE_LOC_NM_01   SP_CUST_LINE_LOC_NM_01
              ,CSHP.SO_CUST_LINE_LOC_NM_02   SP_CUST_LINE_LOC_NM_02
              ,CSHP.CTAC_PTNR_PSN_NM         SP_CTAC_PTNR_PSN_NM
              ,CSHP.SO_CUST_LINE_ADDR_01     SP_CUST_LINE_ADDR_01
              ,CSHP.SO_CUST_LINE_ADDR_02     SP_CUST_LINE_ADDR_02
              ,CSHP.SO_CUST_LINE_ADDR_03     SP_CUST_LINE_ADDR_03
              ,CSHP.SO_CUST_LINE_ADDR_04     SP_CUST_LINE_ADDR_04
              ,CSHP.CTY_ADDR                 SP_CTY_ADDR
              ,CSHP.ST_CD                    SP_ST_CD
              ,CSHP.POST_CD                  SP_POST_CD
              ,RBL.BIN_NUM                   BIN_NUM
              <!-- 04/11/2012 #22 START -->
              ,SO_V.SO_CONFIG_FLG            SO_CONFIG_FLG
              ,SO_V.CONFIG_ITEM_FLG          CONFIG_ITEM_FLG
              <!-- 04/11/2012 #22 END -->
              <!-- 2014/05/20 CSA#38 START -->
              ,SO_V.SO_SLP_NUM               SO_SLP_NUM
              <!-- 
              ,TRIM(TO_CHAR(SO_V.TOT_SHPG_WT, '9,999,999.9999'))
                                             TOT_SHPG_WT_PRINT_TXT
              -->
              ,SO_V.TOT_SHPG_WT
              ,MDSE.MDSE_RGTN_TP_CD          MDSE_RGTN_TP_CD
              <!-- 2014/05/20 CSA#38 END -->
     FROM
               FRT_CHRG_METH      FCM
              ,FRT_CHRG_TO        FCT
              ,GLBL_CMPY          GC
              ,WH                 WH
              ,MDSE               MDSE
              ,S80_SHPG_TERM      SST
              ,SHPG_MODE          MOD
              ,SHPG_METH          MTH
              ,SHPG_SVC_LVL       SSL
              ,SHPG_TERM_CONV     STC
              ,STK_STS            SSFR
              ,STK_STS            SSTO
              ,SCE_ORD_TP         SOT
              ,SHPG_ORD_CUST_DTL  CRET
              ,SHPG_ORD_CUST_DTL  CSEL
              ,SHPG_ORD_CUST_DTL  CSHP
              ,RTRN_BIN_LOC       RBL
              ,SO_V               SO_V 
     WHERE
                    SOT.INBD_OTBD_CD(+)         =  #inbdOtbdCd#
               AND  CRET.SO_CUST_DATA_TP_CD(+)  =  #retTpCd#
               AND  CSEL.SO_CUST_DATA_TP_CD(+)  =  #selTpCd#
               AND  CSHP.SO_CUST_DATA_TP_CD(+)  =  #shpTpCd#
               AND  SO_V.SCE_ORD_TP_CD          =  SOT.SCE_ORD_TP_CD(+)
               AND  SO_V.FRT_CHRG_TO_CD         =  FCT.FRT_CHRG_TO_CD(+)
               AND  SO_V.FRT_CHRG_TO_CD         =  STC.FRT_CHRG_TO_CD(+)
               AND  SO_V.FRT_CHRG_METH_CD       =  FCM.FRT_CHRG_METH_CD(+)
               AND  SO_V.FRT_CHRG_METH_CD       =  STC.FRT_CHRG_METH_CD(+)
               AND  SO_V.SHPG_MODE_CD           =  MOD.SHPG_MODE_CD(+)
               AND  SO_V.EXPT_SHPG_METH_CD      =  MTH.SHPG_METH_CD(+)
               AND  SO_V.SHPG_SVC_LVL_CD        =  SSL.SHPG_SVC_LVL_CD(+)
               AND  SO_V.WH_CD                  =  WH.WH_CD(+)
               AND  SO_V.SO_NUM                 =  CRET.SO_NUM (+)
               AND  SO_V.SO_NUM                 =  CSEL.SO_NUM (+)
               AND  SO_V.SO_NUM                 =  CSHP.SO_NUM (+)
               AND  SO_V.FROM_STK_STS_CD        =  SSFR.STK_STS_CD(+)
               AND  SO_V.TO_STK_STS_CD          =  SSTO.STK_STS_CD(+)
               AND  SO_V.MDSE_CD                =  MDSE.MDSE_CD(+)
               AND  STC.S80_SHPG_TERM_CD        =  SST.S80_SHPG_TERM_CD(+)
               AND  GC.EZCANCELFLAG(+)          =  '0'
               AND  SOT.EZCANCELFLAG(+)         =  '0'
               AND  FCT.EZCANCELFLAG(+)         =  '0'
               AND  STC.EZCANCELFLAG(+)         =  '0'
               AND  FCM.EZCANCELFLAG(+)         =  '0'
               AND  MOD.EZCANCELFLAG(+)         =  '0'
               AND  MTH.EZCANCELFLAG(+)         =  '0'
               AND  WH.EZCANCELFLAG(+)          =  '0'
               AND  CRET.EZCANCELFLAG(+)        =  '0'
               AND  CSEL.EZCANCELFLAG(+)        =  '0'
               AND  CSHP.EZCANCELFLAG(+)        =  '0'
               AND  MDSE.EZCANCELFLAG(+)        =  '0'
               AND  SSFR.EZCANCELFLAG(+)        =  '0'
               AND  SSTO.EZCANCELFLAG(+)        =  '0'
               AND  SST.EZCANCELFLAG(+)         =  '0'
               AND  SO_V.GLBL_CMPY_CD           =  GC.GLBL_CMPY_CD
               AND  SO_V.GLBL_CMPY_CD           =  SOT.GLBL_CMPY_CD(+)
               AND  SO_V.GLBL_CMPY_CD           =  FCT.GLBL_CMPY_CD(+)
               AND  SO_V.GLBL_CMPY_CD           =  STC.GLBL_CMPY_CD(+)
               AND  SO_V.GLBL_CMPY_CD           =  FCM.GLBL_CMPY_CD(+)
               AND  SO_V.GLBL_CMPY_CD           =  MOD.GLBL_CMPY_CD(+)
               AND  SO_V.GLBL_CMPY_CD           =  MTH.GLBL_CMPY_CD(+)
               AND  SO_V.GLBL_CMPY_CD           =  SSL.GLBL_CMPY_CD(+)
               AND  SO_V.GLBL_CMPY_CD           =  WH.GLBL_CMPY_CD(+)
               AND  SO_V.GLBL_CMPY_CD           =  CRET.GLBL_CMPY_CD(+)
               AND  SO_V.GLBL_CMPY_CD           =  CSEL.GLBL_CMPY_CD(+)
               AND  SO_V.GLBL_CMPY_CD           =  CSHP.GLBL_CMPY_CD(+)
               AND  SO_V.GLBL_CMPY_CD           =  MDSE.GLBL_CMPY_CD(+)
               AND  SO_V.GLBL_CMPY_CD           =  SSFR.GLBL_CMPY_CD(+)
               AND  SO_V.GLBL_CMPY_CD           =  SSTO.GLBL_CMPY_CD(+)
               AND  STC.GLBL_CMPY_CD            =  SST.GLBL_CMPY_CD(+)
               <!-- Add Defect#7680 -->
               AND SO_V.GLBL_CMPY_CD            =  RBL.GLBL_CMPY_CD(+)
               AND SO_V.MDSE_CD                 =  RBL.MDSE_CD(+) 
               AND SO_V.WH_CD                   =  RBL.WH_CD(+)
               AND SO_V.FROM_STK_STS_CD         =  RBL.STK_STS_CD(+)
     ORDER BY
                    SO_V.SO_NUM
                   ,SO_V.SO_SLP_NUM
    </statement>

    <!-- 2014/05/20 CSA#38 START -->
    <statement id="selectSoSer" parameterClass="Map">
    SELECT
          SS.SER_NUM
      FROM
        SO_SER SS
      WHERE
        SS.SO_NUM            = #soNum#
        AND SS.SO_SLP_NUM    = #soSlpNum#
        AND SS.SER_NUM       IS NOT NULL
        AND SS.GLBL_CMPY_CD  = #glblCmpyCd#
        AND SS.EZCANCELFLAG  = '0'
    </statement>
    <!-- 2014/05/20 CSA#38 END -->

    <statement id="getSO" parameterClass="Map" resultClass="Map">
        WITH SO_DTL_V AS (
            SELECT
                /*+ NO_AUTO_REOPTIMIZE NO_ADAPTIVE_PLAN */
                SO.GLBL_CMPY_CD                           AS GLBL_CMPY_CD
               ,DCDV.CPO_ORD_NUM
               ,DPD.PO_ORD_NUM
               ,SD.PRCH_REQ_NUM
               ,CASE WHEN DCDV.CPO_ORD_NUM IS NOT NULL THEN DCDV.CPO_ORD_NUM
                     WHEN DPD.PO_ORD_NUM   IS NOT NULL THEN DPD.PO_ORD_NUM
                     WHEN SD.PRCH_REQ_NUM  IS NOT NULL THEN SD.PRCH_REQ_NUM
                     ELSE SO.TRX_HDR_NUM
                END                                       AS SRC_ORD_NUM
               ,CASE WHEN DCDV.CPO_ORD_NUM IS NOT NULL THEN DCDV.DPLY_LINE_NUM
                     WHEN DPD.PO_ORD_NUM   IS NOT NULL THEN DPD.DISP_PO_DTL_LINE_NUM
                     WHEN SD.PRCH_REQ_NUM  IS NOT NULL THEN SD.PRCH_REQ_LINE_NUM || #lineNumSeparator# || TO_CHAR(SD.PRCH_REQ_LINE_SUB_NUM)
                     ELSE SD.TRX_LINE_NUM
                END                                       AS DPLY_LINE_NUM
               ,CASE WHEN DCDV.CPO_ORD_NUM IS NOT NULL THEN DCDV.CPO_DTL_LINE_NUM
                     WHEN DPD.PO_ORD_NUM   IS NOT NULL THEN DPD.PO_ORD_DTL_LINE_NUM
                     WHEN SD.PRCH_REQ_NUM  IS NOT NULL THEN SD.PRCH_REQ_LINE_NUM
                     ELSE SD.TRX_LINE_NUM
                END                                       AS SRC_ORD_LINE_NUM
               ,CASE WHEN DCDV.CPO_ORD_NUM IS NOT NULL THEN DCDV.CPO_DTL_LINE_SUB_NUM
                     WHEN SD.PRCH_REQ_NUM IS NOT NULL THEN TO_CHAR(SD.PRCH_REQ_LINE_SUB_NUM)
                     ELSE SD.TRX_LINE_SUB_NUM
                END                                       AS SRC_ORD_LINE_SUB_NUM
               ,SO.SO_NUM                                 AS SO_NUM
               ,SD.SO_SLP_NUM                             AS SO_SLP_NUM
               ,SOT.SCE_ORD_TP_NM                         AS SCE_ORD_TP_NM
               ,RW.RTL_WH_NM                              AS SHIP_FROM_RTL_WH_NM
               ,RW.RTL_WH_CATG_CD                         AS RTL_WH_CATG_CD
               ,SD.RTL_SWH_CD                             AS SHIP_FROM_RTL_SWH_CD
               ,DSLS.DS_SO_LINE_STS_DESC_TXT              AS DS_SO_LINE_STS_DESC_TXT
               ,DSLS.DS_SO_LINE_STS_CD                    AS DS_SO_LINE_STS_CD
               ,CASE WHEN SD.RMV_CONFIG_FLG = #flgY# THEN NULL
                     ELSE SO.SVC_CONFIG_MSTR_PK
                     END                                  AS SHIP_SVC_CONFIG_MSTR_PK
               ,SD.PICK_SVC_CONFIG_MSTR_PK                AS PICK_SVC_CONFIG_MSTR_PK
               ,SD.MDSE_CD                                AS MDSE_CD
               ,DMI.MDSE_DESC_SHORT_TXT                   AS MDSE_DESC_SHORT_TXT
               ,BOIT.BACK_ORD_IMPCT_TP_DESC_TXT           AS BACK_ORD_IMPCT_TP_DESC_TXT
               ,SD.FROM_STK_STS_CD                        AS FROM_STK_STS_CD
               ,SD.SHPG_QTY                               AS SHPG_QTY
               ,NVL(MSP.BASE_PKG_UOM_CD, SP.CUST_UOM_CD)  AS DPLY_PKG_UOM_CD
               ,MSP.IN_EACH_QTY                           AS UOM_EACH_QTY
               ,SD.PICK_CONF_QTY                          AS PICK_CONF_QTY
               ,SD.SHIP_QTY                               AS SHIP_QTY
               ,SD.SHPG_QTY - SD.SHIP_QTY                 AS SHPG_BAL_QTY
               ,SO.RDD_DT                                 AS RDD_DT
               ,PRD.RQST_RCV_DT                           AS RQST_RCV_DT
               ,PRD.RQST_RCV_TM                           AS RQST_RCV_TM
               ,SO.SO_CRAT_TS                             AS SO_CRAT_TS
               ,CASE WHEN SO.SO_NUM IS NOT NULL THEN SSSL.SHPG_SVC_LVL_DESC_TXT
                     ELSE OSSL.SHPG_SVC_LVL_DESC_TXT
                END                                       AS SHPG_SVC_LVL_DESC_TXT
               ,CASE WHEN SO.SO_NUM IS NOT NULL THEN SO.CARR_CD
                     ELSE SO.VND_CD
                END                                       AS CARR_CD
               ,CASE WHEN SO.SO_NUM IS NOT NULL THEN SV.LOC_NM
                     ELSE OV.LOC_NM
                END                                       AS CARR_NM
               ,CASE WHEN SO.SO_NUM IS NOT NULL THEN SO.CARR_CD
                     ELSE SO.VND_CD
                END                                       AS RQST_CARR_CD
               ,CASE WHEN SO.SO_NUM IS NOT NULL THEN SV.LOC_NM
                     ELSE OV.LOC_NM
                END                                       AS RQST_CARR_NM
               ,SO.CARR_ACCT_NUM                          AS CARR_ACCT_NUM
               ,T.TOC_NM                                  AS TOC_NM
               ,SO.SHIP_TO_CUST_ACCT_CD                   AS SHIP_TO_CUST_ACCT_CD
               ,SD.TO_INVTY_LOC_CD                        AS SHIP_TO_LOC_CD
               ,SOCD.SO_CUST_LINE_LOC_NM_01               AS SHIP_TO_LOC_NM
               ,SOCD.CTY_ADDR                             AS SHIP_TO_CTY_ADDR
               ,SOCD.ST_CD                                AS SHIP_TO_ST_CD
               ,SOCD.CTAC_PTNR_PSN_NM                     AS SHIP_TO_CTAC_PSN_NM
               ,SO.SCE_ORD_TP_CD                          AS SCE_ORD_TP_CD
               ,SO.TRX_SRC_TP_CD                          AS TRX_SRC_TP_CD
               ,SS.SO_PRINT_FLG                           AS SO_PRINT_FLG
               ,SS.SHIP_FLG                               AS SHIP_FLG
               ,SD.SER_NUM_TAKE_FLG                       AS SER_NUM_TAKE_FLG
               ,DMI.INSTL_BASE_CTRL_FLG                   AS INSTL_BASE_CTRL_FLG
               ,SD.RTL_WH_CD                              AS SHIP_FROM_RTL_WH_CD
               ,SD.INVTY_LOC_CD                           AS SHIP_FROM_LOC_CD
               ,SD.TRX_HDR_NUM                            AS TRX_HDR_NUM
               ,SD.TRX_LINE_NUM                           AS TRX_LINE_NUM
               ,SD.TRX_LINE_SUB_NUM                       AS TRX_LINE_SUB_NUM
               ,DSLS.SO_LINE_OPEN_FLG                     AS SO_LINE_OPEN_FLG
               ,SD.TO_STK_STS_CD                          AS TO_STK_STS_CD
               ,CASE WHEN WO.MAN_SEND_RQST_FLG  = #flgY# THEN #flgY#
                     WHEN SCT.MAN_SEND_RQST_FLG = #flgY# THEN #flgY#
                     WHEN OCT.MAN_SEND_RQST_FLG = #flgY# THEN #flgY#
                     ELSE #flgN#
                END                                       AS MAN_SEND_RQST_FLG
               ,CASE WHEN SO.DELY_REQ_FLG = #flgY#        THEN #flgY#
                     WHEN SO.DELY_REQ_TS IS NOT NULL      THEN #flgY#
                     ELSE #flgN#
                END                                       AS SEND_RQST_FLG
               ,SD.SET_MDSE_CD                            AS SET_MDSE_CD
               ,DCC.DS_COND_CONST_VAL_TXT_01              AS DS_COND_CONST_VAL_TXT_01
               ,DCC.DS_COND_CONST_VAL_TXT_04              AS DS_COND_CONST_VAL_TXT_04
               ,DCC.DS_COND_CONST_VAL_TXT_05              AS DS_COND_CONST_VAL_TXT_05
               ,DCC.DS_COND_CONST_VAL_TXT_06              AS DS_COND_CONST_VAL_TXT_06
               ,RW.INVTY_ACCT_CD                          AS INVTY_ACCT_CD
               ,NVL(DCON.MDL_ID, SCM.MDL_ID)              AS MDL_ID
               ,SO.WH_CD                                  AS WH_CD
               ,SO.BILL_TO_CUST_CD                        AS BILL_TO_CUST_CD
               ,SO.SHIP_TO_CUST_CD                        AS SHIP_TO_CUST_CD
               ,SO.CUST_ISS_PO_NUM                        AS CUST_ISS_PO_NUM
               ,SO.SO_PRT_FLG                             AS SO_PRT_FLG
               ,SO.EZUPTIME                               AS SO_EZUPTIME
               ,SO.EZUPTIMEZONE                           AS SO_EZUPTIMEZONE
               ,SD.EZINUSERID                             AS SOD_EZINUSERID
               ,SD.EZINTIME                               AS SOD_EZINTIME
               ,SD.EZUPUSERID                             AS SOD_EZUPUSERID
               ,SD.EZUPTIME                               AS SOD_EZUPTIME
               ,SD.EZUPTIMEZONE                           AS SOD_EZUPTIMEZONE
               ,SO.EZUPTIME                               AS DSO_EZUPTIME
               ,SO.EZUPTIMEZONE                           AS DSO_EZUPTIMEZONE
               ,SD.EZUPTIME                               AS DSOD_EZUPTIME
               ,SD.EZUPTIMEZONE                           AS DSOD_EZUPTIMEZONE
               ,SO.EZUPTIME                               AS SOS_EZUPTIME
               ,SO.EZUPTIMEZONE                           AS SOS_EZUPTIMEZONE
               ,CASE WHEN SODI.SHPG_INSTN_CMNT_TXT IS NOT NULL THEN #flgY#
                     ELSE #flgN#
                END                                       AS SHPG_ORD_DELY_INSTN_FLG
               ,CASE WHEN SO.SO_NUM IS NOT NULL THEN SO.SHPG_SVC_LVL_CD
                     ELSE SO.SHPG_SVC_LVL_CD
                END                                       AS SHPG_SVC_LVL_CD
               ,SODI.SHPG_INSTN_CMNT_TXT                  AS SHPG_INSTN_CMNT_TXT
               ,SD.TOT_SHPG_WT
               ,NVL(BD.BO_QTY,0)                          AS BO_QTY 
            FROM
                SHPG_ORD                SO
               ,SHPG_STS                SS
               ,SHPG_ORD_CUST_DTL       SOCD
               ,SHPG_ORD_DTL            SD
               ,SHPG_BO_DTL             BD 
               ,RTL_WH                  RW
               ,WH_OWNR                 WO
               ,PO_DTL                  DPD
               ,(
                    SELECT
                         DCD.EZCANCELFLAG
                        ,DCD.GLBL_CMPY_CD
                        ,DCD.CPO_ORD_NUM
                        ,DCD.CPO_DTL_LINE_NUM
                        ,DCD.CPO_DTL_LINE_SUB_NUM
                        ,DCD.SLS_REP_OR_SLS_TEAM_TOC_CD
                        ,DCD.DS_CPO_CONFIG_PK
                        ,DCD.CR_REBIL_CD
                        ,DCD.DPLY_LINE_NUM
                    FROM 
                        (
                            SELECT
                                 CD.EZCANCELFLAG
                                ,CD.GLBL_CMPY_CD
                                ,CD.CPO_ORD_NUM
                                ,CD.CPO_DTL_LINE_NUM
                                ,CD.CPO_DTL_LINE_SUB_NUM
                                ,CD.SLS_REP_OR_SLS_TEAM_TOC_CD
                                ,CD.DS_CPO_CONFIG_PK
                                ,CD.CR_REBIL_CD
                                ,CONCAT(CD.DS_ORD_POSN_NUM, #lineNumSeparator#) || CONCAT(CD.DS_CPO_LINE_NUM, NVL2(CD.DS_CPO_LINE_SUB_NUM, #lineNumSeparator#, '')) || CD.DS_CPO_LINE_SUB_NUM AS DPLY_LINE_NUM
                                ,NVL(CD.SBST_MDSE_CD, CD.MDSE_CD) AS MDSE_KEY
                            FROM 
                                 CPO_DTL        CD
                                ,CPO            C
                            WHERE 
                                CD.GLBL_CMPY_CD         = #glblCmpyCd#
                            AND CD.GLBL_CMPY_CD         = C.GLBL_CMPY_CD
                            AND CD.CPO_ORD_NUM          = C.CPO_ORD_NUM
                            AND CD.EZCANCELFLAG         = '0'
                            AND C.EZCANCELFLAG          = '0'
                        )                       DCD
                        ,MDSE                   M
                        ,ORD_TAKE_MDSE          OTM
                        ,MDSE                   M1
                    WHERE 
                        DCD.GLBL_CMPY_CD    = M.GLBL_CMPY_CD(+)
                    AND DCD.MDSE_KEY        = M.MDSE_CD(+)
                    AND DCD.GLBL_CMPY_CD    = OTM.GLBL_CMPY_CD(+)
                    AND DCD.MDSE_KEY        = OTM.ORD_TAKE_MDSE_CD(+)
                    AND M1.GLBL_CMPY_CD     = NVL(M.GLBL_CMPY_CD, OTM.GLBL_CMPY_CD)
                    AND M1.MDSE_CD          = NVL(M.MDSE_CD, OTM.MDSE_CD)
                    AND M.EZCANCELFLAG(+)   = '0'
                    AND OTM.EZCANCELFLAG(+) = '0'
                    AND M1.EZCANCELFLAG     = '0'
                ) DCDV
               ,DS_CPO_CONFIG           DCON
               ,TOC                     T
               ,SCE_ORD_TP              SOT
               ,DS_SO_LINE_STS          DSLS
               ,MDSE                    DMI
               ,BACK_ORD_IMPCT_TP       BOIT
               ,SHPG_ORD_DELY_INSTN     SODI
               ,PRCH_REQ_DTL            PRD
               ,DS_COND_CONST           DCC
               ,AVAL_SCE_ORD_TP_APP_ID  ASOTAI
               ,VND                     OV
               ,CARR_TP                 OCT
               ,SHPG_SVC_LVL            OSSL
               ,VND                     SV
               ,CARR_TP                 SCT
               ,SHPG_SVC_LVL            SSSL
               ,SHPG_PLN                SP
               ,MDSE_STORE_PKG          MSP
               ,SVC_CONFIG_MSTR         SCM
            WHERE
                SO.GLBL_CMPY_CD                 = #glblCmpyCd#
            AND SO.SO_NUM                       = #soNum#
            AND SO.GLBL_CMPY_CD                 = SS.GLBL_CMPY_CD
            AND SO.SHPG_STS_CD                  = SS.SHPG_STS_CD
            AND SO.GLBL_CMPY_CD                 = SOCD.GLBL_CMPY_CD(+)
            AND SO.SO_NUM                       = SOCD.SO_NUM(+)
            AND SOCD.SO_CUST_DATA_TP_CD(+)      = #soCustDataTpCd#
            AND SD.GLBL_CMPY_CD                 = SO.GLBL_CMPY_CD
            AND SD.SO_NUM                       = SO.SO_NUM
            AND SD.GLBL_CMPY_CD                 = RW.GLBL_CMPY_CD
            AND SD.RTL_WH_CD                    = RW.RTL_WH_CD
            AND RW.GLBL_CMPY_CD                 = WO.GLBL_CMPY_CD(+)
            AND RW.WH_OWNR_CD                   = WO.WH_OWNR_CD(+)
            AND SD.GLBL_CMPY_CD                 = DPD.GLBL_CMPY_CD(+)
            AND SD.TRX_HDR_NUM                  = DPD.PO_ORD_NUM(+)
            AND SD.TRX_LINE_NUM                 = DPD.PO_ORD_DTL_LINE_NUM(+)
            AND SD.GLBL_CMPY_CD                 = DCDV.GLBL_CMPY_CD(+)
            AND SD.TRX_HDR_NUM                  = DCDV.CPO_ORD_NUM(+)
            AND SD.TRX_LINE_NUM                 = DCDV.CPO_DTL_LINE_NUM(+)
            AND SD.TRX_LINE_SUB_NUM             = DCDV.CPO_DTL_LINE_SUB_NUM(+)
            AND DCDV.GLBL_CMPY_CD               = DCON.GLBL_CMPY_CD(+)
            AND DCDV.DS_CPO_CONFIG_PK           = DCON.DS_CPO_CONFIG_PK(+)
            AND DCDV.GLBL_CMPY_CD               = T.GLBL_CMPY_CD(+)
            AND DCDV.SLS_REP_OR_SLS_TEAM_TOC_CD = T.TOC_CD(+)
            AND SO.GLBL_CMPY_CD                 = SOT.GLBL_CMPY_CD
            AND SO.SCE_ORD_TP_CD                = SOT.SCE_ORD_TP_CD
            AND SOT.INBD_OTBD_CD                = #inbdOtbdCd#
            AND SD.GLBL_CMPY_CD                 = DSLS.GLBL_CMPY_CD
            AND SD.DS_SO_LINE_STS_CD            = DSLS.DS_SO_LINE_STS_CD
            AND SD.GLBL_CMPY_CD                 = DMI.GLBL_CMPY_CD
            AND SD.MDSE_CD                      = DMI.MDSE_CD
            AND DMI.GLBL_CMPY_CD                = BOIT.GLBL_CMPY_CD(+)
            AND DMI.BACK_ORD_IMPCT_TP_CD        = BOIT.BACK_ORD_IMPCT_TP_CD(+)
            AND SO.GLBL_CMPY_CD                 = SODI.GLBL_CMPY_CD(+)
            AND SO.SO_NUM                       = SODI.SO_NUM(+)
            AND SD.GLBL_CMPY_CD                 = PRD.GLBL_CMPY_CD(+)
            AND SD.PRCH_REQ_NUM                 = PRD.PRCH_REQ_NUM(+)
            AND SD.PRCH_REQ_LINE_NUM            = PRD.PRCH_REQ_LINE_NUM(+)
            AND SD.PRCH_REQ_LINE_SUB_NUM        = PRD.PRCH_REQ_LINE_SUB_NUM(+)
            AND SD.GLBL_CMPY_CD                 = BD.GLBL_CMPY_CD(+)
            AND SD.SO_NUM                       = BD.SO_NUM(+)
            AND SD.TRX_HDR_NUM                  = BD.TRX_HDR_NUM(+)
            AND SD.TRX_LINE_NUM                 = BD.TRX_LINE_NUM(+)
            AND SD.TRX_LINE_SUB_NUM             = BD.TRX_LINE_SUB_NUM(+)
            AND SO.GLBL_CMPY_CD                 = DCC.GLBL_CMPY_CD
            AND SO.SCE_ORD_TP_CD                = DCC.DS_COND_CONST_CD
            AND DCC.DS_COND_CONST_GRP_ID        = #dsCondConstGrpId#
            AND SO.GLBL_CMPY_CD                 = ASOTAI.GLBL_CMPY_CD
            AND SO.SCE_ORD_TP_CD                = ASOTAI.SCE_ORD_TP_CD
            AND ASOTAI.BIZ_APP_ID               = #bizAppId#
            AND SO.GLBL_CMPY_CD                 = OV.GLBL_CMPY_CD(+)
            AND SO.VND_CD                       = OV.VND_CD(+)
            AND OV.GLBL_CMPY_CD                 = OCT.GLBL_CMPY_CD(+)
            AND OV.CARR_TP_CD                   = OCT.CARR_TP_CD(+)
            AND SO.GLBL_CMPY_CD                 = SV.GLBL_CMPY_CD(+)
            AND SO.CARR_CD                      = SV.VND_CD(+)
            AND SV.GLBL_CMPY_CD                 = SCT.GLBL_CMPY_CD(+)
            AND SV.CARR_TP_CD                   = SCT.CARR_TP_CD(+)
            AND SO.GLBL_CMPY_CD                 = OSSL.GLBL_CMPY_CD(+)
            AND SO.SHPG_SVC_LVL_CD              = OSSL.SHPG_SVC_LVL_CD(+)
            AND SO.GLBL_CMPY_CD                 = SSSL.GLBL_CMPY_CD(+)
            AND SO.SHPG_SVC_LVL_CD              = SSSL.SHPG_SVC_LVL_CD(+)
            AND SD.GLBL_CMPY_CD                 = SP.GLBL_CMPY_CD(+)
            AND SD.SHPG_PLN_NUM                 = SP.SHPG_PLN_NUM(+)
            AND SP.GLBL_CMPY_CD                 = MSP.GLBL_CMPY_CD(+)
            AND SP.CUST_UOM_CD                  = MSP.PKG_UOM_CD(+)
            AND SP.MDSE_CD                      = MSP.MDSE_CD(+)
            AND SD.GLBL_CMPY_CD                 = SCM.GLBL_CMPY_CD(+)
            AND SD.PICK_SVC_CONFIG_MSTR_PK      = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.EZCANCELFLAG(+)             = '0'
            AND SO.EZCANCELFLAG                 = '0'
            AND SS.EZCANCELFLAG                 = '0'
            AND SOCD.EZCANCELFLAG(+)            = '0'
            AND SD.EZCANCELFLAG                 = '0'
            AND BD.EZCANCELFLAG(+)              = '0'
            AND RW.EZCANCELFLAG                 = '0'
            AND WO.EZCANCELFLAG(+)              = '0'
            AND DPD.EZCANCELFLAG(+)             = '0'
            AND DCDV.EZCANCELFLAG(+)            = '0'
            AND DCON.EZCANCELFLAG(+)            = '0'
            AND T.EZCANCELFLAG(+)               = '0'
            AND SOT.EZCANCELFLAG                = '0'
            AND DSLS.EZCANCELFLAG               = '0'
            AND DMI.EZCANCELFLAG                = '0'
            AND BOIT.EZCANCELFLAG(+)            = '0'
            AND SODI.EZCANCELFLAG(+)            = '0'
            AND PRD.EZCANCELFLAG(+)             = '0'
            AND DCC.EZCANCELFLAG                = '0'
            AND ASOTAI.EZCANCELFLAG             = '0'
            AND OV.EZCANCELFLAG(+)              = '0'
            AND OCT.EZCANCELFLAG(+)             = '0'
            AND SV.EZCANCELFLAG(+)              = '0'
            AND SCT.EZCANCELFLAG(+)             = '0'
            AND OSSL.EZCANCELFLAG(+)            = '0'
            AND SSSL.EZCANCELFLAG(+)            = '0'
            AND SP.EZCANCELFLAG(+)              = '0'
            AND MSP.EZCANCELFLAG(+)             = '0'
        )
        , SO_MSG AS (
            SELECT
                SOM.SO_NUM
               ,MAX(SOM.TXT_SQ_NUM) AS TXT_SQ_NUM
            FROM
                SO_DTL_V     SV
               ,SHPG_ORD_MSG SOM
             WHERE
                SOM.GLBL_CMPY_CD    = SV.GLBL_CMPY_CD
            AND SOM.SO_NUM          = SV.SO_NUM
            AND SOM.SO_MSG_TP_CD    = #soMsgTpCd#
            AND SOM.SO_MSG_DESC_TXT IS NOT NULL
            AND SOM.EZCANCELFLAG    = '0'
            GROUP BY
                SOM.SO_NUM
        )
        , PKT_V AS (
             SELECT
                  P.GLBL_CMPY_CD    AS GLBL_CMPY_CD
                 ,P.SO_NUM          AS SO_NUM
                 ,P.SO_SLP_NUM      AS SO_SLP_NUM
                 ,MAX(P.PKT_STS_TS) AS PKT_STS_TS
             FROM
                  SO_DTL_V SV
                 ,PKT      P
             WHERE
                 P.GLBL_CMPY_CD      = SV.GLBL_CMPY_CD
             AND P.SO_NUM            = SV.SO_NUM
             AND P.SO_SLP_NUM        = SV.SO_SLP_NUM
             AND P.DS_SO_LINE_STS_CD = #dsSoLineStsCd01#
             AND P.EZCANCELFLAG      = '0'
             GROUP BY
                  P.GLBL_CMPY_CD
                 ,P.SO_NUM
                 ,P.SO_SLP_NUM
         )
        , PKT_PACK_COMP_V AS (
             SELECT
                  P.GLBL_CMPY_CD    AS GLBL_CMPY_CD
                 ,P.SO_NUM          AS SO_NUM
                 ,P.SO_SLP_NUM      AS SO_SLP_NUM
                 ,MAX(P.PKT_STS_TS) AS PKT_PACK_STS_TS
             FROM
                  SO_DTL_V SV
                 ,PKT      P
             WHERE
                 P.GLBL_CMPY_CD      = SV.GLBL_CMPY_CD
             AND P.SO_NUM            = SV.SO_NUM
             AND P.SO_SLP_NUM        = SV.SO_SLP_NUM
             AND P.DS_SO_LINE_STS_CD = #dsSoLineStsCd02#
             AND P.EZCANCELFLAG      = '0'
             GROUP BY
                  P.GLBL_CMPY_CD
                 ,P.SO_NUM
                 ,P.SO_SLP_NUM
         )
        SELECT
            SDV.GLBL_CMPY_CD
           ,SDV.CPO_ORD_NUM
           ,SDV.PO_ORD_NUM
           ,SDV.PRCH_REQ_NUM
           ,SDV.SRC_ORD_NUM
           ,SDV.DPLY_LINE_NUM
           ,SDV.SRC_ORD_LINE_NUM
           ,SDV.SRC_ORD_LINE_SUB_NUM
           ,SDV.SO_NUM
           ,SDV.SO_SLP_NUM
           ,SDV.SCE_ORD_TP_NM
           ,SDV.SHIP_FROM_RTL_WH_NM
           ,SDV.SHIP_FROM_RTL_SWH_CD
           ,SDV.RTL_WH_CATG_CD
           ,SDV.DS_SO_LINE_STS_DESC_TXT
           ,SDV.DS_SO_LINE_STS_CD
           ,SDV.SHIP_SVC_CONFIG_MSTR_PK
           ,SDV.PICK_SVC_CONFIG_MSTR_PK
           ,SDV.MDSE_CD
           ,SDV.MDSE_DESC_SHORT_TXT
           ,SDV.BACK_ORD_IMPCT_TP_DESC_TXT
           ,SDV.FROM_STK_STS_CD
           ,SDV.DPLY_PKG_UOM_CD
           ,SDV.UOM_EACH_QTY
           ,SDV.RDD_DT
           ,SDV.RQST_RCV_DT
           ,SDV.RQST_RCV_TM
           ,SDV.SO_CRAT_TS
           ,SDV.SHPG_SVC_LVL_DESC_TXT
           ,SDV.CARR_CD
           ,SDV.CARR_NM
           ,SDV.RQST_CARR_CD
           ,SDV.RQST_CARR_NM
           ,SDV.CARR_ACCT_NUM
           ,SDV.TOC_NM
           ,SDV.SHIP_TO_CUST_ACCT_CD
           ,SDV.SHIP_TO_LOC_CD
           ,SDV.SHIP_TO_LOC_NM
           ,SDV.SHIP_TO_CTY_ADDR
           ,SDV.SHIP_TO_ST_CD
           ,SDV.SHIP_TO_CTAC_PSN_NM
           ,SDV.SCE_ORD_TP_CD
           ,SDV.TRX_SRC_TP_CD
           ,SDV.SER_NUM_TAKE_FLG
           ,SDV.INSTL_BASE_CTRL_FLG
           ,SDV.SHIP_FROM_RTL_WH_CD
           ,SDV.SHIP_FROM_LOC_CD
           ,SDV.TRX_HDR_NUM
           ,SDV.TRX_LINE_NUM
           ,SDV.TRX_LINE_SUB_NUM
           ,SDV.TO_STK_STS_CD
           ,SDV.MAN_SEND_RQST_FLG
           ,SDV.SEND_RQST_FLG
           ,SDV.SET_MDSE_CD
           ,SDV.DS_COND_CONST_VAL_TXT_01
           ,SDV.DS_COND_CONST_VAL_TXT_04
           ,SDV.DS_COND_CONST_VAL_TXT_05
           ,SDV.DS_COND_CONST_VAL_TXT_06
           ,SDV.INVTY_ACCT_CD
           ,SDV.MDL_ID
           ,SDV.SO_EZUPTIME
           ,SDV.SO_EZUPTIMEZONE
           ,SDV.SOD_EZUPTIME
           ,SDV.SOD_EZUPTIMEZONE
           ,SDV.DSO_EZUPTIME
           ,SDV.DSO_EZUPTIMEZONE
           ,SDV.DSOD_EZUPTIME
           ,SDV.DSOD_EZUPTIMEZONE
           ,SDV.SOS_EZUPTIME
           ,SDV.SOS_EZUPTIMEZONE
           ,SDV.SHPG_QTY
           ,SDV.PICK_CONF_QTY
           ,0 AS SHIP_QTY
           ,SDV.SHPG_BAL_QTY
           ,NULL AS BOL_NUM
           ,NULL AS TOT_FRT_AMT
           ,CASE WHEN SDV.PICK_CONF_QTY = 0 THEN NULL
                 ELSE PV.PKT_STS_TS
            END  AS PKT_STS_TS
           ,PAV.PKT_PACK_STS_TS
           ,NULL AS SHIP_DT_TM_TS
           ,SDV.SO_PRINT_FLG
           ,SDV.SHIP_FLG
           ,SDV.SO_LINE_OPEN_FLG
           ,NULL AS PACK_SLP_NUM
           ,CASE WHEN SM.TXT_SQ_NUM IS NOT NULL THEN #flgY#
                 ELSE SDV.SHPG_ORD_DELY_INSTN_FLG
            END  AS SHPG_ORD_DELY_INSTN_FLG
           ,SDV.SHPG_INSTN_CMNT_TXT
           ,SDV.SHPG_SVC_LVL_CD
           ,SDV.WH_CD
           ,SDV.BILL_TO_CUST_CD
           ,SDV.SHIP_TO_CUST_CD
           ,SDV.CUST_ISS_PO_NUM
           ,SDV.SO_PRT_FLG
           ,TO_NUMBER(SDV.SRC_ORD_LINE_NUM)     AS LINE_NUM
           ,TO_NUMBER(SDV.SRC_ORD_LINE_SUB_NUM) AS LINE_SUB_NUM
           ,SDV.SOD_EZINTIME                    AS XX_REC_HIST_CRAT_TS
           ,SDV.SOD_EZINUSERID                  AS XX_REC_HIST_CRAT_BY_NM
           ,SDV.SOD_EZUPTIME                    AS XX_REC_HIST_UPD_TS
           ,SDV.SOD_EZUPUSERID                  AS XX_REC_HIST_UPD_BY_NM
           ,'SHPG_ORD_DTL'                      AS XX_REC_HIST_TBL_NM
           ,SDV.SHPG_SVC_LVL_CD AS ACTL_SVC_LVL_CD
           ,SDV.TOT_SHPG_WT
           ,SDV.BO_QTY 
        FROM
            SO_DTL_V        SDV
           ,PKT_V           PV
           ,PKT_PACK_COMP_V PAV
           ,SO_MSG          SM
        WHERE
            NOT EXISTS (SELECT
                            1
                        FROM
                            SHPG_ORD_CONF_DTL SOCD
                        WHERE
                            SOCD.GLBL_CMPY_CD   = SDV.GLBL_CMPY_CD
                        AND SOCD.SO_NUM         = SDV.SO_NUM
                        AND SOCD.SO_SLP_NUM     = SDV.SO_SLP_NUM
                        AND SOCD.SO_PROC_STS_CD = #soProcStsCd#
                        AND SOCD.EZCANCELFLAG   = '0')
        AND SDV.GLBL_CMPY_CD = PV.GLBL_CMPY_CD(+)
        AND SDV.SO_NUM       = PV.SO_NUM(+)
        AND SDV.SO_SLP_NUM   = PV.SO_SLP_NUM(+)
        AND SDV.GLBL_CMPY_CD = PAV.GLBL_CMPY_CD(+)
        AND SDV.SO_NUM       = PAV.SO_NUM(+)
        AND SDV.SO_SLP_NUM   = PAV.SO_SLP_NUM(+)
        AND SDV.SO_NUM       = SM.SO_NUM(+)
        UNION
        SELECT
            SDV.GLBL_CMPY_CD
           ,SDV.CPO_ORD_NUM
           ,SDV.PO_ORD_NUM
           ,SDV.PRCH_REQ_NUM
           ,SDV.SRC_ORD_NUM
           ,SDV.DPLY_LINE_NUM
           ,SDV.SRC_ORD_LINE_NUM
           ,SDV.SRC_ORD_LINE_SUB_NUM
           ,SDV.SO_NUM
           ,SDV.SO_SLP_NUM
           ,SDV.SCE_ORD_TP_NM
           ,SDV.SHIP_FROM_RTL_WH_NM
           ,SDV.SHIP_FROM_RTL_SWH_CD
           ,SDV.RTL_WH_CATG_CD
           ,SDV.DS_SO_LINE_STS_DESC_TXT
           ,SDV.DS_SO_LINE_STS_CD
           ,SDV.SHIP_SVC_CONFIG_MSTR_PK
           ,SDV.PICK_SVC_CONFIG_MSTR_PK
           ,SDV.MDSE_CD
           ,SDV.MDSE_DESC_SHORT_TXT
           ,SDV.BACK_ORD_IMPCT_TP_DESC_TXT
           ,SDV.FROM_STK_STS_CD
           ,SDV.DPLY_PKG_UOM_CD
           ,SDV.UOM_EACH_QTY
           ,SDV.RDD_DT
           ,SDV.RQST_RCV_DT
           ,SDV.RQST_RCV_TM
           ,SDV.SO_CRAT_TS
           ,SDV.SHPG_SVC_LVL_DESC_TXT
           ,SOCD.VND_CD                  AS CARR_CD
           ,V.LOC_NM                     AS CARR_NM
           ,SDV.RQST_CARR_CD
           ,SDV.RQST_CARR_NM
           ,SDV.CARR_ACCT_NUM
           ,SDV.TOC_NM
           ,SDV.SHIP_TO_CUST_ACCT_CD
           ,SDV.SHIP_TO_LOC_CD
           ,SDV.SHIP_TO_LOC_NM
           ,SDV.SHIP_TO_CTY_ADDR
           ,SDV.SHIP_TO_ST_CD
           ,SDV.SHIP_TO_CTAC_PSN_NM
           ,SDV.SCE_ORD_TP_CD
           ,SDV.TRX_SRC_TP_CD
           ,SDV.SER_NUM_TAKE_FLG
           ,SDV.INSTL_BASE_CTRL_FLG
           ,SDV.SHIP_FROM_RTL_WH_CD
           ,SDV.SHIP_FROM_LOC_CD
           ,SDV.TRX_HDR_NUM
           ,SDV.TRX_LINE_NUM
           ,SDV.TRX_LINE_SUB_NUM
           ,SDV.TO_STK_STS_CD
           ,SDV.MAN_SEND_RQST_FLG
           ,SDV.SEND_RQST_FLG
           ,SDV.SET_MDSE_CD
           ,SDV.DS_COND_CONST_VAL_TXT_01
           ,SDV.DS_COND_CONST_VAL_TXT_04
           ,SDV.DS_COND_CONST_VAL_TXT_05
           ,SDV.DS_COND_CONST_VAL_TXT_06
           ,SDV.INVTY_ACCT_CD
           ,SDV.MDL_ID
           ,SDV.SO_EZUPTIME
           ,SDV.SO_EZUPTIMEZONE
           ,SDV.SOD_EZUPTIME
           ,SDV.SOD_EZUPTIMEZONE
           ,SDV.DSO_EZUPTIME
           ,SDV.DSO_EZUPTIMEZONE
           ,SDV.DSOD_EZUPTIME
           ,SDV.DSOD_EZUPTIMEZONE
           ,SDV.SOS_EZUPTIME
           ,SDV.SOS_EZUPTIMEZONE
           ,SDV.SHPG_QTY
           ,SDV.PICK_CONF_QTY
           ,SDV.SHIP_QTY
           ,0  AS SHPG_BAL_QTY
           ,DECODE(SOCD.BOL_NUM, '*', NULL, SOCD.BOL_NUM) AS BOL_NUM
           ,SOCD.TOT_FRT_AMT
           ,PV.PKT_STS_TS
           ,PAV.PKT_PACK_STS_TS
           ,SOCD.SHIP_DT_TM_TS
           ,SDV.SO_PRINT_FLG
           ,SDV.SHIP_FLG
           ,#flgN# AS SO_LINE_OPEN_FLG
           ,SDV.SO_NUM || '-1' AS PACK_SLP_NUM
           ,CASE WHEN SM.TXT_SQ_NUM IS NOT NULL THEN #flgY#
                 ELSE SDV.SHPG_ORD_DELY_INSTN_FLG
            END                AS SHPG_ORD_DELY_INSTN_FLG
           ,SDV.SHPG_INSTN_CMNT_TXT
           ,SDV.SHPG_SVC_LVL_CD
           ,SDV.WH_CD
           ,SDV.BILL_TO_CUST_CD
           ,SDV.SHIP_TO_CUST_CD
           ,SDV.CUST_ISS_PO_NUM
           ,SDV.SO_PRT_FLG
           ,TO_NUMBER(SDV.SRC_ORD_LINE_NUM)     AS LINE_NUM
           ,TO_NUMBER(SDV.SRC_ORD_LINE_SUB_NUM) AS LINE_SUB_NUM
           ,SOCD.EZINTIME                       AS XX_REC_HIST_CRAT_TS
           ,SOCD.EZINUSERID                     AS XX_REC_HIST_CRAT_BY_NM
           ,SOCD.EZUPTIME                       AS XX_REC_HIST_UPD_TS
           ,SOCD.EZUPUSERID                     AS XX_REC_HIST_UPD_BY_NM
           ,'SHPG_ORD_CONF_DTL'                 AS XX_REC_HIST_TBL_NM
           ,SOCD.SHPG_SVC_LVL_CD                AS ACTL_SVC_LVL_CD
           ,SDV.TOT_SHPG_WT
           ,SDV.BO_QTY 
        FROM
            SO_DTL_V          SDV
           ,(
                SELECT
                     SOCD.SO_NUM
                    ,SOCD.SO_SLP_NUM
                    ,SOCD.BOL_NUM
                    ,SOCD.SHIP_DT_TM_TS
                    ,SOCD.SHPG_SVC_LVL_CD
                    ,SOCD.SO_PROC_STS_CD
                    ,SOCD.TOT_FRT_AMT
                    ,SOCD.VND_CD
                    ,SOCD.GLBL_CMPY_CD
                    ,SOCD.EZINTIME
                    ,SOCD.EZINUSERID
                    ,SOCD.EZUPTIME
                    ,SOCD.EZUPUSERID
                    ,SOCD.EZCANCELFLAG
                    ,ROW_NUMBER() OVER (PARTITION BY SOCD.SO_NUM, SOCD.SO_SLP_NUM ORDER BY SOCD.SHIP_DT_TM_TS) RNUM
                FROM
                     SHPG_ORD_CONF_DTL SOCD
                WHERE
                    SOCD.SO_PROC_STS_CD = 'S'
                AND SOCD.EZCANCELFLAG   = '0'
            ) SOCD
           ,PKT_V             PV
           ,PKT_PACK_COMP_V   PAV
           ,SO_MSG            SM
           ,VND               V
        WHERE
            SDV.GLBL_CMPY_CD    = SOCD.GLBL_CMPY_CD
        AND SDV.SO_NUM          = SOCD.SO_NUM
        AND SDV.SO_SLP_NUM      = SOCD.SO_SLP_NUM
        AND SOCD.SO_PROC_STS_CD = #soProcStsCd#
        AND SOCD.RNUM           = 1
        AND SDV.GLBL_CMPY_CD    = PV.GLBL_CMPY_CD(+)
        AND SDV.SO_NUM          = PV.SO_NUM(+)
        AND SDV.SO_SLP_NUM      = PV.SO_SLP_NUM(+)
        AND SDV.GLBL_CMPY_CD    = PAV.GLBL_CMPY_CD(+)
        AND SDV.SO_NUM          = PAV.SO_NUM(+)
        AND SDV.SO_SLP_NUM      = PAV.SO_SLP_NUM(+)
        AND SDV.SO_NUM          = SM.SO_NUM(+)
        AND SOCD.GLBL_CMPY_CD   = V.GLBL_CMPY_CD(+)
        AND SOCD.VND_CD         = V.VND_CD(+)
        AND SOCD.EZCANCELFLAG   = '0'
        AND V.EZCANCELFLAG(+)   = '0'
        ORDER BY
            SRC_ORD_NUM
           ,SO_NUM
           ,SO_SLP_NUM
           ,SHIP_DT_TM_TS NULLS FIRST
    </statement>

    <statement id="getRetailWhAddress" parameterClass="Map" resultClass="Map">
        SELECT
             RWH.RTL_WH_CD
            ,RWH.FIRST_LINE_ADDR
            ,RWH.SCD_LINE_ADDR
            ,RWH.THIRD_LINE_ADDR
            ,RWH.FRTH_LINE_ADDR
            ,RWH.CTY_ADDR
            ,RWH.ST_CD
            ,RWH.POST_CD
            ,RWH.TEL_NUM
        FROM 
             RTL_WH RWH
        WHERE
             RWH.GLBL_CMPY_CD       = #glblCmpyCd#
        AND  RWH.RTL_WH_CD          = #rtlWhCd#
        AND  RWH.EFF_FROM_DT       &lt;= #procDt#
        AND (RWH.EFF_THRU_DT       &gt;= #procDt# OR RWH.EFF_THRU_DT IS NULL)
        AND  RWH.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getBillToAccountName" parameterClass="Map" resultClass="Map">
        SELECT
             SLC.DS_ACCT_NM
        FROM
             BILL_TO_CUST   BLC
            ,ACCT_LOC       AL
            ,SELL_TO_CUST   SLC
        WHERE
             BLC.BILL_TO_CUST_CD    = #billToCustCd#
        AND  BLC.GLBL_CMPY_CD       = #glblCmpyCd#
        AND  BLC.LOC_NUM            = AL.LOC_NUM
        AND  BLC.GLBL_CMPY_CD       = AL.GLBL_CMPY_CD
        AND  AL.DS_ACCT_NUM         = SLC.SELL_TO_CUST_CD
        AND  AL.GLBL_CMPY_CD        = SLC.GLBL_CMPY_CD
        AND  BLC.EZCANCELFLAG       = '0'
        AND  AL.EZCANCELFLAG        = '0'
        AND  SLC.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getShipToAccountName" parameterClass="Map" resultClass="Map">
        SELECT
             SLC.DS_ACCT_NM
        FROM
             SHIP_TO_CUST   SPC
            ,ACCT_LOC       AL
            ,SELL_TO_CUST   SLC
        WHERE
             SPC.SHIP_TO_CUST_CD    = #shipToCustCd#
        AND  SPC.GLBL_CMPY_CD       = #glblCmpyCd#
        AND  SPC.LOC_NUM            = AL.LOC_NUM
        AND  SPC.GLBL_CMPY_CD       = AL.GLBL_CMPY_CD
        AND  AL.DS_ACCT_NUM         = SLC.SELL_TO_CUST_CD
        AND  AL.GLBL_CMPY_CD        = SLC.GLBL_CMPY_CD
        AND  SPC.EZCANCELFLAG       = '0'
        AND  AL.EZCANCELFLAG        = '0'
        AND  SLC.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getShipToBillToAddress" parameterClass="Map" resultClass="Map">
        SELECT
             SOCD.SO_CUST_LINE_LOC_NM_01
            ,SOCD.SO_CUST_LINE_LOC_NM_02
            ,SOCD.SO_CUST_LINE_ADDR_01
            ,SOCD.SO_CUST_LINE_ADDR_02
            ,SOCD.SO_CUST_LINE_ADDR_03
            ,SOCD.SO_CUST_LINE_ADDR_04
            ,SOCD.CTAC_PTNR_PSN_NM
            ,SOCD.CTY_ADDR
            ,SOCD.ST_CD
            ,SOCD.POST_CD
            ,SOCD.CTRY_CD
        FROM
             SHPG_ORD_CUST_DTL SOCD
        WHERE
             SOCD.SO_NUM                = #soNum#
        AND  SOCD.SO_CUST_DATA_TP_CD    = #soCustDataTpCd#
        AND  SOCD.GLBL_CMPY_CD          = #glblCmpyCd#
        AND  SOCD.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getSOSerialOfShipped" parameterClass="Map" resultClass="Map">
        SELECT
             SSN.SER_NUM     AS SER_NUM
        FROM
             SHIP_SER_NUM   SSN
        WHERE
             SSN.GLBL_CMPY_CD   = #glblCmpyCd#
        AND  SSN.SO_NUM         = #soNum#
        AND  SSN.SO_SLP_NUM     = #soSlpNum#
        AND  SSN.MDSE_CD        = #mdseCd#
        AND  SSN.EZCANCELFLAG   = '0'
        ORDER BY
             SSN.SER_NUM ASC
    </statement>

    <statement id="getSOSerialOfOhter" parameterClass="Map" resultClass="Map">
        SELECT
             SS.SER_NUM     AS SER_NUM
        FROM
             SO_SER SS
        WHERE
             SS.GLBL_CMPY_CD    = #glblCmpyCd#
        AND  SS.SO_NUM          = #soNum#
        AND  SS.SO_SLP_NUM      = #soSlpNum#
        AND  SS.MDSE_CD         = #mdseCd#
        AND (    SS.WH_PICK_FLG = #whPickFlg#
             OR  SS.ORD_ASG_FLG = #ordAsgFlg#
            )
        AND NOT EXISTS (
             SELECT
                 1
             FROM
                 SHIP_SER_NUM SSN
             WHERE
                 SSN.GLBL_CMPY_CD = SS.GLBL_CMPY_CD
             AND SSN.SO_NUM       = SS.SO_NUM
             AND SSN.SER_NUM      = SS.SER_NUM
             AND SSN.MDSE_CD      = SS.MDSE_CD
             AND SSN.EZCANCELFLAG = '0'
             AND ROWNUM           = 1
            )
        AND  SS.EZCANCELFLAG    = '0'
        ORDER BY
             SS.SER_NUM
    </statement>

    <statement id="getSoMessage" parameterClass="Map" resultClass="Map">
        SELECT
             SOM.SO_MSG_DESC_TXT
        FROM
             SHPG_ORD_MSG   SOM
        WHERE
             SOM.SO_NUM             =  #soNum#
        AND  SOM.GLBL_CMPY_CD       =  #glblCmpyCd#
        AND  SOM.EZCANCELFLAG       =  '0'
        ORDER BY
             SOM.TXT_SQ_NUM
    </statement>

    <statement id="getTechInfo" parameterClass="Map" resultClass="Map">
        SELECT 
             PR.PRCH_REQ_NUM
            ,PRT.PRCH_REQ_TP_DESC_TXT
            ,SP.FULL_PSN_NM
        FROM 
             PRCH_REQ       PR
            ,PRCH_REQ_TP    PRT
            ,S21_PSN_V      SP
        WHERE 
             PR.PRCH_REQ_NUM        = #prchReqNum#
        AND  PR.GLBL_CMPY_CD        = #glblCmpyCd#
        AND  PR.PRCH_REQ_TP_CD      = PRT.PRCH_REQ_TP_CD
        AND  PR.GLBL_CMPY_CD        = PRT.GLBL_CMPY_CD
        AND  PR.RQST_TECH_TOC_CD    = SP.PSN_CD(+)
        AND  PR.GLBL_CMPY_CD        = SP.GLBL_CMPY_CD(+)
        AND  PR.EZCANCELFLAG        = '0'
        AND  PRT.EZCANCELFLAG       = '0'
        AND  SP.EZCANCELFLAG(+)     = '0'
    </statement>

    <statement id="getSoRptMap" parameterClass="Map" resultClass="Map">
        SELECT 
             SRM.PACK_LIST_TP_CD
        FROM 
             SO_RPT_MAP     SRM
        WHERE 
             SRM.SCE_ORD_TP_CD  = #sceOrdTpCd#
        AND  SRM.RTL_WH_CATG_CD = #rtlWhCatgCd#
        AND  SRM.GLBL_CMPY_CD   = #glblCmpyCd#
        AND  SRM.EZCANCELFLAG   = '0'
    </statement>

    <statement id="getRemoveShpgOrdRptWrkData" parameterClass="Map" resultClass="Map">
        SELECT 
            SRW.SHPG_ORD_RPT_WRK_PK
        FROM
            SHPG_ORD_RPT_WRK SRW
        WHERE 
            SRW.GLBL_CMPY_CD         = #glblCmpyCd#
        AND SRW.EZINTIME             &lt; #purgeTs#
        AND SRW.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getBoRecord" parameterClass="Map" resultClass="Map">
        SELECT
            SBD.GLBL_CMPY_CD
           ,SBD.SO_NUM
           ,SBD.SO_SLP_NUM
           ,SBD.MDSE_CD
           ,NVL(MDS.MDSE_DESC_SHORT_TXT,MDO.MDSE_DESC_SHORT_TXT) MDSE_DESC_SHORT_TXT
           ,NVL(MDS.SHPG_SER_TAKE_FLG  ,MDO.SHPG_SER_TAKE_FLG)   SHPG_SER_TAKE_FLG
           ,SBD.DS_SO_LINE_STS_CD
           ,SBD.RQST_ORD_QTY
           ,SBD.BO_QTY
        FROM
            SHPG_BO_DTL   SBD
           ,SHPG_ORD_DTL  SOD
           ,ORD_TAKE_MDSE OTM
           ,MDSE          MDS
           ,MDSE          MDO
        WHERE
            SBD.GLBL_CMPY_CD     = #glblCmpyCd#
        AND SBD.SO_NUM           = #soNum#
        AND SBD.EZCANCELFLAG     = '0'
        AND SBD.GLBL_CMPY_CD     = SOD.GLBL_CMPY_CD(+)
        AND SBD.SO_NUM           = SOD.SO_NUM(+)
        AND SBD.TRX_HDR_NUM      = SOD.TRX_HDR_NUM(+)
        AND SBD.TRX_LINE_NUM     = SOD.TRX_LINE_NUM(+)
        AND SBD.TRX_LINE_SUB_NUM = SOD.TRX_LINE_SUB_NUM(+)
        AND SOD.GLBL_CMPY_CD     IS NULL
        AND SOD.EZCANCELFLAG(+)  = '0'
        AND SBD.GLBL_CMPY_CD     = MDS.GLBL_CMPY_CD(+)
        AND SBD.MDSE_CD          = MDS.MDSE_CD(+)
        AND MDS.EZCANCELFLAG(+)  = '0'
        AND SBD.GLBL_CMPY_CD     = OTM.GLBL_CMPY_CD(+)
        AND SBD.MDSE_CD          = OTM.ORD_TAKE_MDSE_CD(+)
        AND OTM.EZCANCELFLAG(+)  = '0'
        AND OTM.GLBL_CMPY_CD     = MDO.GLBL_CMPY_CD(+)
        AND OTM.MDSE_CD          = MDO.MDSE_CD(+)
        AND MDO.EZCANCELFLAG(+)  = '0'
        ORDER BY
            SBD.SO_NUM
           ,SBD.SO_SLP_NUM
           ,SBD.TRX_LINE_NUM
           ,SBD.TRX_LINE_SUB_NUM
    </statement>
</sqlMap>
