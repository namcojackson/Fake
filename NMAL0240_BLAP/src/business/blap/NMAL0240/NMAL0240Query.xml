<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL0240Query">

    <typeAlias alias="NMAL0240SMsg"    type="business.blap.NMAL0240.NMAL0240SMsg"/>
    <typeAlias alias="NMAL0240_ASMsg"  type="business.blap.NMAL0240.NMAL0240_ASMsg"/>

    <statement id="getHeader" parameterClass="Map" resultMap="result.getHeaderSMsg">
        SELECT
            *
        FROM
            (
            SELECT 
                  MV.MDSE_CD
                , MV.MDSE_DESC_SHORT_TXT
                , MV.MDSE_ITEM_TP_CD
                , MIT.MDSE_ITEM_TP_DESC_TXT
                , MV.COA_MDSE_TP_CD
                , CPJ.COA_PROJ_DESC_TXT
                , MV.COA_PROD_CD || ':' || CPD.COA_PROD_NM AS COA_PROD
                , C.ACTV_FLG
                , MV.PRNT_CMPY_SET_MDSE_FLG
            FROM
                  ALL_MDSE_V    MV
                , MDSE_ITEM_TP  MIT
                , COA_PROJ      CPJ
                , COA_PROD      CPD
                , CMPSN         C
            WHERE
                    MV.GLBL_CMPY_CD = #glblCmpyCd#
                AND MV.EZCANCELFLAG = '0'
                AND MV.MDSE_CD      = #mdseCd#
                AND MV.GLBL_CMPY_CD    = MIT.GLBL_CMPY_CD
                AND MIT.EZCANCELFLAG   = '0'
                AND MV.MDSE_ITEM_TP_CD = MIT.MDSE_ITEM_TP_CD
                AND MV.GLBL_CMPY_CD   = CPJ.GLBL_CMPY_CD
                AND CPJ.EZCANCELFLAG  = '0'
                AND MV.COA_MDSE_TP_CD = CPJ.COA_PROJ_CD
                AND MV.GLBL_CMPY_CD  = CPD.GLBL_CMPY_CD
                AND CPD.EZCANCELFLAG = '0'
                AND MV.COA_PROD_CD   = CPD.COA_PROD_CD
                AND MV.GLBL_CMPY_CD    = C.GLBL_CMPY_CD (+)
                AND C.EZCANCELFLAG (+) = '0'
                AND MV.MDSE_CD         = C.PRNT_MDSE_CD (+)
            )
        WHERE
            ROWNUM = 1
    </statement>
    
    <statement id="getCusaHeader" parameterClass="Map" resultMap="result.getHeaderSMsg">
        SELECT
            *
        FROM
            (
            SELECT 
                  MV.MDSE_CD
                , MV.MDSE_NM MDSE_DESC_SHORT_TXT
                , M.MDSE_ITEM_TP_CD
                , NULL AS MDSE_ITEM_TP_DESC_TXT
                , M.COA_MDSE_TP_CD
                , NULL AS COA_PROJ_DESC_TXT
                , MV.COA_PROD_CD || ':' || CP.COA_PROD_NM AS COA_PROD
                , C.ACTV_FLG
                , 'Y' AS PRNT_CMPY_SET_MDSE_FLG
            FROM
                  $cusaMdse$    MV
                , $cusaCmpsn$   CV
                , COA_PROD      CP
                , CMPSN         C
                , ALL_MDSE_V    M
            WHERE
                    MV.GLBL_CMPY_CD = #cusaGlblCmpyCd#
                AND MV.EZCANCELFLAG = '0'
                AND MV.MDSE_CD      = #mdseCd#
                AND MV.MDSE_TP_CD   = #mdseTpCd#
                AND MV.GLBL_CMPY_CD = CV.GLBL_CMPY_CD
                AND CV.EZCANCELFLAG = '0'
                AND MV.MDSE_CD      = CV.PRNT_MDSE_CD
                AND CP.GLBL_CMPY_CD = #glblCmpyCd#
                AND CP.EZCANCELFLAG = '0'
                AND MV.COA_PROD_CD  = CP.COA_PROD_CD
                AND C.GLBL_CMPY_CD (+) = #glblCmpyCd#
                AND C.EZCANCELFLAG (+) = '0'
                AND CV.PRNT_MDSE_CD = C.PRNT_MDSE_CD (+)
                AND M.GLBL_CMPY_CD = #glblCmpyCd#
                AND M.EZCANCELFLAG = '0'
                AND MV.MDSE_CD     = M.MDSE_CD
            )
        WHERE
            ROWNUM = 1
    </statement>
    
    <resultMap id="result.getHeaderSMsg" class="NMAL0240SMsg">
        <result property="mdseCd"               column="MDSE_CD"                javaType="EZDSStringItem"/>
        <result property="mdseDescShortTxt"     column="MDSE_DESC_SHORT_TXT"    javaType="EZDSStringItem"/>
        <result property="mdseItemTpCd"         column="MDSE_ITEM_TP_CD"        javaType="EZDSStringItem"/>
        <result property="mdseItemTpDescTxt"    column="MDSE_ITEM_TP_DESC_TXT"  javaType="EZDSStringItem"/>
        <result property="coaMdseTpCd"          column="COA_MDSE_TP_CD"         javaType="EZDSStringItem"/>
        <result property="coaProjDescTxt"       column="COA_PROJ_DESC_TXT"      javaType="EZDSStringItem"/>
        <result property="xxScrItem61Txt"       column="COA_PROD"               javaType="EZDSStringItem"/>
        <result property="actvFlg"              column="ACTV_FLG"               javaType="EZDSStringItem"/>
        <result property="xxChkBox"             column="PRNT_CMPY_SET_MDSE_FLG" javaType="EZDSStringItem"/>
    </resultMap>
    
    <statement id="getRevision" parameterClass="Map" resultClass="Map">
         WITH
             CMP AS (
                SELECT
                      C.EZCANCELFLAG
                    , C.EZUPTIME
                    , C.EZUPTIMEZONE
                    , NULL AS CMPSN_CHNG_REQ_PK
                    , C.GLBL_CMPY_CD
                    , C.PRNT_MDSE_CD
                    , C.CMPSN_PK
                    , C.MDSE_CMPSN_TP_CD
                    , C.CHILD_MDSE_CD
                    , C.CHILD_ORD_TAKE_MDSE_CD
                    , C.CHILD_MDSE_QTY
                    , C.EFF_FROM_DT
                    , C.EFF_THRU_DT
                    , C.CUSA_MDSE_CD
                    , C.CMPSN_REVN_NUM
                    , C.ACTV_FLG
                    , C.CMPSN_REVN_CMNT_TXT
                    <!-- 2016/08/24 QC#2872 Add Start-->
                    , C.EZINTIME                  AS XX_REC_HIST_CRAT_TS
                    , C.EZINUSERID                AS XX_REC_HIST_CRAT_BY_NM
                    , C.EZUPTIME                  AS XX_REC_HIST_UPD_TS
                    , C.EZUPUSERID                AS XX_REC_HIST_UPD_BY_NM
                    ,'CMPSN'                      AS XX_REC_HIST_TBL_NM
                    <!-- 2016/08/24 QC#2872 Add End-->
                FROM
                      CMPSN         C
                WHERE
                        C.GLBL_CMPY_CD  = #glblCmpyCd#
                    AND C.EZCANCELFLAG  = '0'
                    AND C.PRNT_MDSE_CD  = #prntMdseCd#
            )
           , HIST AS (
                 SELECT
                      MAX(CH.EZUPTIME)     AS EZUPTIME
                    , MAX(CH.EZUPTIMEZONE) AS EZUPTIMEZONE
                    , CH.CMPSN_REVN_NUM
                FROM
                      CMPSN_HIST         CH
                WHERE   CH.CMPSN_REVN_NUM NOT IN (SELECT C.CMPSN_REVN_NUM FROM CMP C) 
                    AND CH.GLBL_CMPY_CD  = #glblCmpyCd#
                    AND CH.EZCANCELFLAG  = '0'
                    AND CH.PRNT_MDSE_CD  = #prntMdseCd#
                    AND CH.HIST_ACT_NM   = #histActNm_Upd#
                    AND CH.ACTV_FLG      = 'N'
                GROUP BY CH.CMPSN_REVN_NUM
           )
           , CMP_ALL AS (
                SELECT
                      CR.EZCANCELFLAG
                    , CR.EZUPTIME
                    , CR.EZUPTIMEZONE
                    , CR.CMPSN_CHNG_REQ_PK
                    , CR.GLBL_CMPY_CD
                    , CR.PRNT_MDSE_CD
                    , CR.CMPSN_PK
                    , CR.MDSE_CMPSN_TP_CD
                    , CR.CHILD_MDSE_CD
                    , CR.CHILD_ORD_TAKE_MDSE_CD
                    , CR.CHILD_MDSE_QTY
                    , CR.EFF_FROM_DT
                    , CR.EFF_THRU_DT
                    , CR.CUSA_MDSE_CD
                    , CR.CMPSN_REVN_NUM
                    , CR.ACTV_FLG
                    , CR.CMPSN_REVN_CMNT_TXT
                    <!-- 2016/08/24 QC#2872 Add Start-->
                    , CR.EZINTIME                  AS XX_REC_HIST_CRAT_TS
                    , CR.EZINUSERID                AS XX_REC_HIST_CRAT_BY_NM
                    , CR.EZUPTIME                  AS XX_REC_HIST_UPD_TS
                    , CR.EZUPUSERID                AS XX_REC_HIST_UPD_BY_NM
                    ,'CMPSN_CHNG_REQ'              AS XX_REC_HIST_TBL_NM
                    <!-- 2016/08/24 QC#2872 Add End-->
                FROM
                      CMPSN_CHNG_REQ         CR
                WHERE
                        CR.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND CR.EZCANCELFLAG      = '0'
                    AND CR.PRNT_MDSE_CD      = #prntMdseCd#
            UNION
                SELECT
                      C.EZCANCELFLAG
                    , C.EZUPTIME
                    , C.EZUPTIMEZONE
                    , C.CMPSN_CHNG_REQ_PK
                    , C.GLBL_CMPY_CD
                    , C.PRNT_MDSE_CD
                    , C.CMPSN_PK
                    , C.MDSE_CMPSN_TP_CD
                    , C.CHILD_MDSE_CD
                    , C.CHILD_ORD_TAKE_MDSE_CD
                    , C.CHILD_MDSE_QTY
                    , C.EFF_FROM_DT
                    , C.EFF_THRU_DT
                    , C.CUSA_MDSE_CD
                    , C.CMPSN_REVN_NUM
                    , C.ACTV_FLG
                    , C.CMPSN_REVN_CMNT_TXT
                    <!-- 2016/08/24 QC#2872 Add Start-->
                    , C.XX_REC_HIST_CRAT_TS
                    , C.XX_REC_HIST_CRAT_BY_NM
                    , C.XX_REC_HIST_UPD_TS
                    , C.XX_REC_HIST_UPD_BY_NM
                    , C.XX_REC_HIST_TBL_NM
                    <!-- 2016/08/24 QC#2872 Add End-->
                FROM
                      CMP C
            UNION
                SELECT
                      CH.EZCANCELFLAG
                    , NULL AS EZUPTIME
                    , NULL AS EZUPTIMEZONE
                    , NULL AS CMPSN_CHNG_REQ_PK
                    , CH.GLBL_CMPY_CD
                    , CH.PRNT_MDSE_CD
                    , CH.CMPSN_PK
                    , CH.MDSE_CMPSN_TP_CD
                    , CH.CHILD_MDSE_CD
                    , CH.CHILD_ORD_TAKE_MDSE_CD
                    , CH.CHILD_MDSE_QTY
                    , CH.EFF_FROM_DT
                    , CH.EFF_THRU_DT
                    , CH.CUSA_MDSE_CD
                    , CH.CMPSN_REVN_NUM
                    , CH.ACTV_FLG
                    , CH.CMPSN_REVN_CMNT_TXT
                    <!-- 2016/08/24 QC#2872 Add Start-->
                    , CH.EZUPTIME     AS XX_REC_HIST_CRAT_TS
                    , CH.EZINUSERID   AS XX_REC_HIST_CRAT_BY_NM
                    , CH.EZUPTIME     AS XX_REC_HIST_UPD_TS
                    , CH.EZUPUSERID   AS XX_REC_HIST_UPD_BY_NM
                    ,'CMPSN_HIST'     AS XX_REC_HIST_TBL_NM
                    <!-- 2016/08/24 QC#2872 Add End-->
                FROM
                      HIST               H
                    , CMPSN_HIST         CH
                WHERE
                        H.EZUPTIME       = CH.EZUPTIME
                    AND H.EZUPTIMEZONE   = CH.EZUPTIMEZONE
                    AND H.CMPSN_REVN_NUM = CH.CMPSN_REVN_NUM
                    AND CH.GLBL_CMPY_CD  = #glblCmpyCd#
                    AND CH.EZCANCELFLAG  = '0'
                    AND CH.PRNT_MDSE_CD  = #prntMdseCd#
                    AND CH.HIST_ACT_NM   = #histActNm_Upd#
            )
        SELECT
            *
        FROM
            (
            SELECT
                  C.CMPSN_REVN_NUM
                , C.CMPSN_REVN_CMNT_TXT
                , C.CMPSN_CHNG_REQ_PK
                , C.CMPSN_PK
                , C.EZUPTIME
                , C.EZUPTIMEZONE
                , C.EFF_FROM_DT
                , C.EFF_THRU_DT
                , MV.MDSE_CD
                , MV.MDSE_DESC_SHORT_TXT
                , MV.MDSE_ITEM_TP_CD
                , MV.COA_MDSE_TP_CD
                , C.CHILD_MDSE_QTY
                , CP.COA_PROJ_DESC_TXT
                , MV.COA_PROD_CD
                , CASE WHEN C.ACTV_FLG = 'Y'
                       THEN #active#
                       ELSE #inActive#
                  END ACTIVE
                , MV.RGTN_STS_CD
                <!-- 2016/08/24 QC#2872 Add Start-->
                , C.XX_REC_HIST_CRAT_TS
                , C.XX_REC_HIST_CRAT_BY_NM
                , C.XX_REC_HIST_UPD_TS
                , C.XX_REC_HIST_UPD_BY_NM
                , C.XX_REC_HIST_TBL_NM
                <!-- 2016/08/24 QC#2872 Add End-->
            FROM
                  CMP_ALL     C
                , ALL_MDSE_V  MV
                , COA_PROJ    CP
            WHERE
                    MV.GLBL_CMPY_CD = C.GLBL_CMPY_CD
                AND MV.MDSE_CD     IN (C.CHILD_MDSE_CD, C.CHILD_ORD_TAKE_MDSE_CD)
                AND MV.EZCANCELFLAG = '0'
                AND MV.GLBL_CMPY_CD   = CP.GLBL_CMPY_CD
                AND MV.COA_MDSE_TP_CD = CP.COA_PROJ_CD
                AND CP.EZCANCELFLAG   = '0'
            ORDER BY
                  C.CMPSN_REVN_NUM DESC
                , C.CMPSN_PK
            )
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>
    <statement id="getChildren" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM
            (
             SELECT 
                      C.CMPSN_REVN_NUM
                    , C.CMPSN_REVN_CMNT_TXT
                    , C.EZUPTIME
                    , C.EZUPTIMEZONE
                    , C.EFF_FROM_DT
                    , C.EFF_THRU_DT
                    , MV.MDSE_CD
                    , MV.MDSE_DESC_SHORT_TXT
                    , C.CHILD_MDSE_QTY
                    , CP.COA_PROJ_DESC_TXT
                    , MV.COA_PROD_CD
                    , CASE WHEN C.ACTV_FLG = 'Y' 
                           THEN #active#
                           ELSE #inActive#
                      END ACTIVE
                FROM
                      CMPSN C
                    , ALL_MDSE_V    MV
                    , COA_PROJ      CP
                WHERE
                        C.GLBL_CMPY_CD = #glblCmpyCd#
                    AND C.EZCANCELFLAG = '0'
                    AND C.PRNT_MDSE_CD = #childMdseCd#
                    AND C.EFF_FROM_DT &lt;= #slsDt#
                    AND NVL(C.EFF_THRU_DT, '99991231') &gt;= #slsDt#
                    AND C.GLBL_CMPY_CD  = MV.GLBL_CMPY_CD
                    AND MV.EZCANCELFLAG = '0'
                    AND (C.CHILD_MDSE_CD = MV.MDSE_CD OR C.CHILD_ORD_TAKE_MDSE_CD = MV.MDSE_CD)
                    AND MV.GLBL_CMPY_CD   = CP.GLBL_CMPY_CD
                    AND CP.EZCANCELFLAG  = '0'
                    AND MV.COA_MDSE_TP_CD = CP.COA_PROJ_CD
                ORDER BY C.CMPSN_PK
            )
        WHERE ROWNUM &lt;= #rowNum#
    </statement>
    <statement id="getCusaRevision" parameterClass="Map" resultClass="Map">
        SELECT 
            *
        FROM
            (
            SELECT --+ leading(d c)
                  1 AS CMPSN_REVN_NUM
                , NULL AS CMPSN_PK
                <!-- MOD QC5003 Start -->
                <!-- , C.EFF_FROM_DT-->
                <!-- MOD QC5003 End -->
                , D.MGT_DT EFF_FROM_DT
                , C.EFF_THRU_DT
                , MV.MDSE_CD
                , MV.MDSE_NM MDSE_DESC_SHORT_TXT
                , M.COA_MDSE_TP_CD
                , C.CHILD_MDSE_QTY
                , CP.COA_PROJ_DESC_TXT
                , MV.COA_PROD_CD
                , M.MDSE_ITEM_TP_CD
                , C.MDSE_CMPSN_TP_CD
                , M.RGTN_STS_CD
                <!-- 2016/08/24 QC#2872 Add Start-->
                , C.EZINTIME                  AS XX_REC_HIST_CRAT_TS
                , C.EZINUSERID                AS XX_REC_HIST_CRAT_BY_NM
                , C.EZUPTIME                  AS XX_REC_HIST_UPD_TS
                , C.EZUPUSERID                AS XX_REC_HIST_UPD_BY_NM
                , #cusaCmpsn#                 AS XX_REC_HIST_TBL_NM
                <!-- 2016/08/24 QC#2872 Add End-->
            FROM
                  $cusaCmpsn$ C
                , $cusaMdse$  MV
                , ALL_MDSE_V  M
                , COA_PROJ    CP
                <!-- ADD QC5003 Start -->
                , DT_MGT D
                <!-- ADD QC5003 End -->
            WHERE                    
                    C.GLBL_CMPY_CD = #cusaGlblCmpyCd#
                AND C.EZCANCELFLAG = '0'
                AND C.PRNT_MDSE_CD = #prntMdseCd#
                AND C.GLBL_CMPY_CD   = MV.GLBL_CMPY_CD
                AND MV.EZCANCELFLAG  = '0'
                AND (C.CHILD_MDSE_CD = MV.MDSE_CD OR C.CHILD_ORD_TAKE_MDSE_CD = MV.MDSE_CD)
                AND M.GLBL_CMPY_CD (+) = #glblCmpyCd#
                AND M.EZCANCELFLAG (+) = '0'
                AND MV.MDSE_CD         = M.MDSE_CD (+)
                <!-- ADD QC5003 Start -->
                AND CP.GLBL_CMPY_CD (+) = #glblCmpyCd#
                <!-- ADD QC5003 End -->
                AND CP.EZCANCELFLAG (+) = '0'
                <!-- ADD QC5003 Start -->
                AND M.COA_MDSE_TP_CD = CP.COA_PROJ_CD (+)
                AND D.GLBL_CMPY_CD = #glblCmpyCd#
                AND D.EZCANCELFLAG = '0'
                AND D.DT_MGT_PGM_ID = '*'
                AND D.DT_PROC_CD = 'S'
                <!-- ADD QC5003 End -->
            ORDER BY C.CMPSN_PK
            )
        WHERE ROWNUM &lt;= #rowNum#
    </statement>    
    <statement id="getMdse" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM
            (
            SELECT
                  M.MDSE_DESC_SHORT_TXT
                , CP.COA_PROJ_DESC_TXT
                , M.COA_PROD_CD
            FROM
                  ALL_MDSE_V  M
                , COA_PROJ CP
            WHERE
                    M.GLBL_CMPY_CD = #glblCmpyCd#
                AND M.EZCANCELFLAG = '0'
                AND M.MDSE_CD      = #mdseCd#
                AND M.GLBL_CMPY_CD   = CP.GLBL_CMPY_CD
                AND CP.EZCANCELFLAG   = '0'
                AND M.COA_MDSE_TP_CD = CP.COA_PROJ_CD
            )
        WHERE
            ROWNUM = 1
    </statement>
    <statement id="findOrdTakeMdse" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM
            (
            SELECT
                  O.ORD_TAKE_MDSE_CD
                , M.MDSE_CD
                , M.COA_MDSE_TP_CD
                , M.INVTY_CTRL_FLG
                , P.BASE_PKG_UOM_CD
                , M.MDSE_ITEM_TP_CD
            FROM
                  ORD_TAKE_MDSE O
                , MDSE M
                , PKG_UOM_CLS P
            WHERE
                    O.GLBL_CMPY_CD     = #glblCmpyCd#
                AND O.EZCANCELFLAG     = '0'
                AND O.ORD_TAKE_MDSE_CD = #mdseCd#
                AND O.GLBL_CMPY_CD     = M.GLBL_CMPY_CD
                AND O.EZCANCELFLAG     = '0'
                AND O.MDSE_CD          = M.MDSE_CD
                AND M.GLBL_CMPY_CD     = P.GLBL_CMPY_CD
                AND M.PKG_UOM_CLS_CD   = P.PKG_UOM_CLS_CD
                AND P.EZCANCELFLAG     = '0'
            )
        WHERE
            ROWNUM = 1
    </statement>
    <statement id="findMdse" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM
            (
            SELECT
                  M.COA_MDSE_TP_CD
                , M.INVTY_CTRL_FLG
                , P.BASE_PKG_UOM_CD
            FROM
                  MDSE M
                , PKG_UOM_CLS P
            WHERE
                    M.GLBL_CMPY_CD = #glblCmpyCd#
                AND M.EZCANCELFLAG = '0'
                AND M.MDSE_CD      = #mdseCd#
                AND M.GLBL_CMPY_CD  = P.GLBL_CMPY_CD
                AND M.PKG_UOM_CLS_CD = P.PKG_UOM_CLS_CD
                AND P.EZCANCELFLAG    = '0'
            )
        WHERE
            ROWNUM = 1
    </statement>
    <statement id="checkHierarchy" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM
            (
            SELECT 
                  C2.CMPSN_PK
            FROM
                  CMPSN C1
                , CMPSN C2
            WHERE
                    C1.GLBL_CMPY_CD = #glblCmpyCd#
                AND C1.EZCANCELFLAG = '0'
                AND C1.PRNT_MDSE_CD = #mdseCd#
                AND C1.EFF_FROM_DT &lt;= #slsDt#
                AND NVL(C1.EFF_THRU_DT, '99991231') &gt;= #slsDt#
                AND C1.GLBL_CMPY_CD  = C2.GLBL_CMPY_CD
                AND C2.EZCANCELFLAG  = '0'
                AND C1.CHILD_MDSE_CD = C2.PRNT_MDSE_CD
            UNION
            SELECT 
                  C2.CMPSN_PK
            FROM
                  CMPSN C1
                , ORD_TAKE_MDSE OTM
                , CMPSN C2
            WHERE
                    C1.GLBL_CMPY_CD = #glblCmpyCd#
                AND C1.EZCANCELFLAG = '0'
                AND C1.PRNT_MDSE_CD = #mdseCd#
                AND C1.EFF_FROM_DT &lt;= #slsDt#
                AND NVL(C1.EFF_THRU_DT, '99991231') &gt;= #slsDt#
                AND C1.GLBL_CMPY_CD = OTM.GLBL_CMPY_CD
                AND C1.EZCANCELFLAG = OTM.EZCANCELFLAG
                AND C1.CHILD_ORD_TAKE_MDSE_CD = OTM.ORD_TAKE_MDSE_CD
                AND C1.GLBL_CMPY_CD  = C2.GLBL_CMPY_CD
                AND C1.EZCANCELFLAG  = C2.EZCANCELFLAG
                AND C1.CHILD_ORD_TAKE_MDSE_CD = SUBSTR(C2.PRNT_MDSE_CD, 1, 8)
            )
        WHERE
            ROWNUM = 1
    </statement>
    <statement id="findMdseItemSts" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM
            (
            SELECT
                  S.DSCTN_FLG
                , S.SELL_HLD_FLG
            FROM
                  ALL_MDSE_V MV
                , MDSE_ITEM_STS S
            WHERE
                    MV.GLBL_CMPY_CD = #glblCmpyCd#
                AND MV.EZCANCELFLAG = '0'
                AND MV.MDSE_CD      = #mdseCd#
                AND MV.GLBL_CMPY_CD = S.GLBL_CMPY_CD
                AND S.EZCANCELFLAG  = '0'
                AND MV.MDSE_ITEM_STS_CD = S.MDSE_ITEM_STS_CD
            )
        WHERE
            ROWNUM = 1
    </statement>
    <statement id="getRevisionForCsv" parameterClass="Map" resultClass="Map">
         WITH
             CMP AS (
                SELECT
                      C.EZCANCELFLAG
                    , C.EZUPTIME
                    , C.EZUPTIMEZONE
                    , NULL AS CMPSN_CHNG_REQ_PK
                    , C.GLBL_CMPY_CD
                    , C.PRNT_MDSE_CD
                    , C.CMPSN_PK
                    , C.MDSE_CMPSN_TP_CD
                    , C.CHILD_MDSE_CD
                    , C.CHILD_ORD_TAKE_MDSE_CD
                    , C.CHILD_MDSE_QTY
                    , C.EFF_FROM_DT
                    , C.EFF_THRU_DT
                    , C.CUSA_MDSE_CD
                    , C.CMPSN_REVN_NUM
                    , C.ACTV_FLG
                    , C.CMPSN_REVN_CMNT_TXT
                FROM
                      CMPSN         C
                WHERE
                        C.GLBL_CMPY_CD  = #glblCmpyCd#
                    AND C.EZCANCELFLAG  = '0'
                    AND C.PRNT_MDSE_CD  = #prntMdseCd#
            )
           , HIST AS (
                 SELECT
                      MAX(CH.EZUPTIME)     AS EZUPTIME
                    , MAX(CH.EZUPTIMEZONE) AS EZUPTIMEZONE
                    , CH.CMPSN_REVN_NUM
                FROM
                      CMPSN_HIST         CH
                WHERE   CH.CMPSN_REVN_NUM NOT IN (SELECT C.CMPSN_REVN_NUM FROM CMP C) 
                    AND CH.GLBL_CMPY_CD  = #glblCmpyCd#
                    AND CH.EZCANCELFLAG  = '0'
                    AND CH.PRNT_MDSE_CD  = #prntMdseCd#
                    AND CH.HIST_ACT_NM   = #histActNm_Upd#
                    AND CH.ACTV_FLG     = 'N'
                GROUP BY CH.CMPSN_REVN_NUM
           )
           , CMP_ALL AS (
                SELECT
                      CR.EZCANCELFLAG
                    , CR.EZUPTIME
                    , CR.EZUPTIMEZONE
                    , CR.CMPSN_CHNG_REQ_PK
                    , CR.GLBL_CMPY_CD
                    , CR.PRNT_MDSE_CD
                    , CR.CMPSN_PK
                    , CR.MDSE_CMPSN_TP_CD
                    , CR.CHILD_MDSE_CD
                    , CR.CHILD_ORD_TAKE_MDSE_CD
                    , CR.CHILD_MDSE_QTY
                    , CR.EFF_FROM_DT
                    , CR.EFF_THRU_DT
                    , CR.CUSA_MDSE_CD
                    , CR.CMPSN_REVN_NUM
                    , CR.ACTV_FLG
                    , CR.CMPSN_REVN_CMNT_TXT
                FROM
                      CMPSN_CHNG_REQ         CR
                WHERE
                        CR.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND CR.EZCANCELFLAG      = '0'
                    AND CR.PRNT_MDSE_CD      = #prntMdseCd#
            UNION
                SELECT
                      C.EZCANCELFLAG
                    , C.EZUPTIME
                    , C.EZUPTIMEZONE
                    , C.CMPSN_CHNG_REQ_PK
                    , C.GLBL_CMPY_CD
                    , C.PRNT_MDSE_CD
                    , C.CMPSN_PK
                    , C.MDSE_CMPSN_TP_CD
                    , C.CHILD_MDSE_CD
                    , C.CHILD_ORD_TAKE_MDSE_CD
                    , C.CHILD_MDSE_QTY
                    , C.EFF_FROM_DT
                    , C.EFF_THRU_DT
                    , C.CUSA_MDSE_CD
                    , C.CMPSN_REVN_NUM
                    , C.ACTV_FLG
                    , C.CMPSN_REVN_CMNT_TXT
                FROM
                      CMP C
            UNION
                SELECT
                      CH.EZCANCELFLAG
                    , NULL AS EZUPTIME
                    , NULL AS EZUPTIMEZONE
                    , NULL AS CMPSN_CHNG_REQ_PK
                    , CH.GLBL_CMPY_CD
                    , CH.PRNT_MDSE_CD
                    , CH.CMPSN_PK
                    , CH.MDSE_CMPSN_TP_CD
                    , CH.CHILD_MDSE_CD
                    , CH.CHILD_ORD_TAKE_MDSE_CD
                    , CH.CHILD_MDSE_QTY
                    , CH.EFF_FROM_DT
                    , CH.EFF_THRU_DT
                    , CH.CUSA_MDSE_CD
                    , CH.CMPSN_REVN_NUM
                    , CH.ACTV_FLG
                    , CH.CMPSN_REVN_CMNT_TXT
                FROM
                      HIST               H
                    , CMPSN_HIST         CH
                WHERE
                        H.EZUPTIME       = CH.EZUPTIME
                    AND H.EZUPTIMEZONE   = CH.EZUPTIMEZONE
                    AND H.CMPSN_REVN_NUM = CH.CMPSN_REVN_NUM
                    AND CH.GLBL_CMPY_CD  = #glblCmpyCd#
                    AND CH.EZCANCELFLAG  = '0'
                    AND CH.PRNT_MDSE_CD  = #prntMdseCd#
                    AND CH.HIST_ACT_NM   = #histActNm_Upd#
                    AND CH.ACTV_FLG     = 'N'
            )

            SELECT
                  C.CMPSN_REVN_NUM
                , C.CMPSN_REVN_CMNT_TXT
                , C.EFF_FROM_DT
                , C.EFF_THRU_DT
                , MV.MDSE_CD
                , MV.MDSE_DESC_SHORT_TXT
                , MV.MDSE_ITEM_TP_CD
                , MV.COA_MDSE_TP_CD
                , C.CHILD_MDSE_QTY
                , CP.COA_PROJ_DESC_TXT
                , MV.COA_PROD_CD
                , CASE WHEN C.ACTV_FLG = 'Y'
                       THEN #active#
                       ELSE #inActive#
                  END ACTIVE
                , CH_C.CMPSN_REVN_NUM AS CMPSN_REVN_NUM_CH
                , CH_C.CMPSN_REVN_CMNT_TXT AS CMPSN_REVN_CMNT_TXT_CH
                , CH_C.EFF_FROM_DT AS EFF_FROM_DT_CH
                , CH_C.EFF_THRU_DT AS EFF_THRU_DT_CH
                , CH_MV.MDSE_CD AS MDSE_CD_CH
                , CH_MV.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT_CH
                , CH_C.CHILD_MDSE_QTY AS CHILD_MDSE_QTY_CH
                , CH_CP.COA_PROJ_DESC_TXT AS COA_PROJ_DESC_TXT_CH
                , CH_MV.COA_PROD_CD AS COA_PROD_CD_CH
                , CASE WHEN CH_C.ACTV_FLG = 'Y' 
                       THEN #active#
                       ELSE #inActive#
                  END ACTIVE_CH
                , CH_MV2.MDSE_CD AS MDSE_CD_CH2
                , CH_MV2.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT_CH2
                , CH_CP2.COA_PROJ_DESC_TXT AS COA_PROJ_DESC_TXT_CH2
                , CH_MV2.COA_PROD_CD AS COA_PROD_CD_CH2
            FROM
                  CMP_ALL     C
                , ALL_MDSE_V  MV
                , COA_PROJ    CP
                , CMPSN         CH_C
                , ALL_MDSE_V    CH_MV
                , COA_PROJ      CH_CP
                , ALL_MDSE_V    CH_MV2
                , COA_PROJ      CH_CP2
            WHERE
                    MV.GLBL_CMPY_CD = C.GLBL_CMPY_CD
                AND MV.MDSE_CD     IN (C.CHILD_MDSE_CD, C.CHILD_ORD_TAKE_MDSE_CD)
                AND MV.EZCANCELFLAG = '0'
                AND MV.GLBL_CMPY_CD   = CP.GLBL_CMPY_CD
                AND MV.COA_MDSE_TP_CD = CP.COA_PROJ_CD
                AND CP.EZCANCELFLAG   = '0'
                AND MV.GLBL_CMPY_CD       = CH_C.GLBL_CMPY_CD (+)
                AND MV.MDSE_CD            = CH_C.PRNT_MDSE_CD (+)
                AND CH_C.EZCANCELFLAG (+) = '0'
                AND CH_C.GLBL_CMPY_CD      = CH_MV.GLBL_CMPY_CD (+)
                AND CH_C.CHILD_MDSE_CD     = CH_MV.MDSE_CD (+)
                AND CH_MV.EZCANCELFLAG (+) = '0'
                AND CH_MV.GLBL_CMPY_CD     = CH_CP.GLBL_CMPY_CD (+)
                AND CH_MV.COA_MDSE_TP_CD   = CH_CP.COA_PROJ_CD (+)
                AND CH_CP.EZCANCELFLAG (+) = '0'
                AND CH_C.GLBL_CMPY_CD           = CH_MV2.GLBL_CMPY_CD (+)
                AND CH_C.CHILD_ORD_TAKE_MDSE_CD = CH_MV2.MDSE_CD (+)
                AND CH_MV2.EZCANCELFLAG (+)     = '0'
                AND CH_MV2.GLBL_CMPY_CD     = CH_CP2.GLBL_CMPY_CD (+)
                AND CH_MV2.COA_MDSE_TP_CD   = CH_CP2.COA_PROJ_CD (+)
                AND CH_CP2.EZCANCELFLAG (+) = '0'
            ORDER BY
                  C.CMPSN_REVN_NUM DESC
                , C.CMPSN_PK
                , CH_C.CMPSN_PK
    </statement>
    
    <statement id="findCmpsn" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM
            (
            SELECT
                  C.CMPSN_PK
            FROM
                  CMPSN C
            WHERE
                    C.GLBL_CMPY_CD = #glblCmpyCd#
                AND C.EZCANCELFLAG = '0'
                AND C.PRNT_MDSE_CD = #prntMdseCd#
            )
        WHERE
            ROWNUM = 1
    </statement>
    
    <statement id="getCusaMdseRgtnSts" parameterClass="Map" resultClass="Map">
        SELECT 
              MV.RGTN_STS_CD
        FROM
              $cusaMdse$    MV
        WHERE
                MV.GLBL_CMPY_CD = #cusaGlblCmpyCd#
            AND MV.EZCANCELFLAG = '0'
            AND MV.MDSE_CD      = #mdseCd#
    </statement>
    <!-- QC#10313 -->
    <statement id="getCmpsn" parameterClass="Map" resultClass="Map">
        SELECT 
              C.CMPSN_PK
        FROM
              CMPSN C
        WHERE
                C.GLBL_CMPY_CD = #cusaGlblCmpyCd#
            AND C.EZCANCELFLAG = '0'
            AND C.PRNT_MDSE_CD = #mdseCd#
    </statement>

    <statement id="getBomMessageList" parameterClass="Map" resultClass="Map">
        SELECT
             CM.CMPSN_MSG_PK
            ,CM.PRNT_MDSE_CD
            ,CM.CMPSN_MSG_SEG_ID
            ,CM.CMPSN_MSG_TXT
        FROM
            CMPSN_MSG CM
        WHERE
            CM.GLBL_CMPY_CD = #glblCmpyCd#
        AND CM.PRNT_MDSE_CD = #prntMdseCd#
        AND CM.EZCANCELFLAG = '0'
        AND ROWNUM &lt;= #rowNum#
        ORDER BY
            CM.CMPSN_MSG_PK ASC
    </statement>

</sqlMap>
