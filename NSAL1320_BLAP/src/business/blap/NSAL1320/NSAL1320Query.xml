<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAL1320Query">

    <statement id="getBllgCycleList" parameterClass="Map" resultClass="Map">
        SELECT
                  BC.BLLG_CYCLE_CD
                , BC.BLLG_CYCLE_DESC_TXT
                , BLLG_CYCLE_MTH_AOT
            FROM
                BLLG_CYCLE BC
            WHERE
                BC.GLBL_CMPY_CD             = #glblCmpyCd#
                AND BC.BLLG_CYCLE_ACTV_FLG  = 'Y'
                AND BC.EFF_FROM_DT         &lt;= #slsDt#
                AND ( 
                    BC.EFF_THRU_DT         &gt;= #slsDt#
                    OR BC.EFF_THRU_DT          IS NULL
                )
                AND BC.OM_CYCLE_FLG = 'Y'
                AND BC.EZCANCELFLAG = '0'
            ORDER BY
                BC.BLLG_CYCLE_SORT_NUM
    </statement>

    <statement id="searchShellItemWithLike" parameterClass="Map" resultClass="Map">
        SELECT
             NVL(OTM.ORD_TAKE_MDSE_CD, M.MDSE_CD) AS MDSE_CD
            ,M.MDSE_NM
            ,M.MDSE_DESC_SHORT_TXT
        FROM
             ITEM_TP_VAL_SET ITVS
            ,MDSE            M
            ,ORD_TAKE_MDSE   OTM
        WHERE
                ITVS.EZCANCELFLAG       = '0'
            AND ITVS.GLBL_CMPY_CD       = #glblCmpyCd#
            AND ITVS.ITEM_TP_CTX_TP_CD  = #itemTpCtxTpCd#
            AND ITVS.EZCANCELFLAG       = M.EZCANCELFLAG
            AND ITVS.GLBL_CMPY_CD       = M.GLBL_CMPY_CD
            AND ITVS.MDSE_ITEM_TP_CD    = M.MDSE_ITEM_TP_CD
            AND M.SVC_COV_TMPL_TP_CD IS NOT NULL
            AND M.RGTN_STS_CD           = #rgtnStsCd#
            <isNotNull property="mdseCd">
                <isEqual property="likeSearchFlg" compareValue="Y">
            AND M.MDSE_CD             LIKE #mdseCd#
            AND OTM.MDSE_CD(+)        LIKE #mdseCd#
                </isEqual>
                <isEqual property="likeSearchFlg" compareValue="N">
            AND M.MDSE_CD             = #mdseCd#
            AND OTM.MDSE_CD(+)          = #mdseCd#
                </isEqual>
            </isNotNull>
            <isNotNull property="mdseNm">
            AND RTRIM(M.MDSE_DESC_SHORT_TXT) LIKE #mdseNm#
            </isNotNull>
            AND M.EZCANCELFLAG          = OTM.EZCANCELFLAG(+)
            AND M.GLBL_CMPY_CD          = OTM.GLBL_CMPY_CD(+)
            AND M.MDSE_CD               = OTM.MDSE_CD(+)
        ORDER BY
            M.MDSE_CD
    </statement>

    <statement id="searchShellItem" parameterClass="Map" resultClass="Map">
        SELECT
             #mdseCd#   AS MDSE_CD
            ,M.MDSE_NM
            ,M.MDSE_DESC_SHORT_TXT
        FROM
             ITEM_TP_VAL_SET ITVS
            ,MDSE            M
        WHERE
                ITVS.EZCANCELFLAG       = '0'
            AND ITVS.GLBL_CMPY_CD       = #glblCmpyCd#
            AND ITVS.ITEM_TP_CTX_TP_CD  = #itemTpCtxTpCd#
            AND ITVS.EZCANCELFLAG       = M.EZCANCELFLAG
            AND ITVS.GLBL_CMPY_CD       = M.GLBL_CMPY_CD
            AND ITVS.MDSE_ITEM_TP_CD    = M.MDSE_ITEM_TP_CD
            AND M.SVC_COV_TMPL_TP_CD IS NOT NULL
            AND M.RGTN_STS_CD           = #rgtnStsCd#
            AND M.MDSE_CD             = NVL(
                                                ( 
                                                    SELECT
                                                              OTM.MDSE_CD
                                                        FROM
                                                            ORD_TAKE_MDSE OTM
                                                        WHERE
                                                            OTM.ORD_TAKE_MDSE_CD = #mdseCd#
                                                            AND OTM.EZCANCELFLAG = M.EZCANCELFLAG
                                                            AND OTM.GLBL_CMPY_CD = M.GLBL_CMPY_CD
                                                ) 
                                                , #mdseCd#
            )
    </statement>

    <statement id="getCustIssPoNum" parameterClass="Map" resultClass="Map">
        SELECT
                  DCTR.DS_BLKT_PO_NUM 
            FROM
                DS_CPO_CONFIG DCC
                , DS_CUST_TRX_RULE DCTR 
            WHERE
                DCC.GLBL_CMPY_CD             = #glblCmpyCd#
                AND DCC.BILL_TO_CUST_ACCT_CD = #acctCd#
                AND DCC.SHIP_TO_CUST_LOC_CD  = #locCd#
                AND DCC.EZCANCELFLAG         = '0' 
                AND DCC.GLBL_CMPY_CD         = DCTR.GLBL_CMPY_CD 
                AND DCC.BILL_TO_CUST_ACCT_CD = DCTR.DS_ACCT_NUM 
                AND DCC.SHIP_TO_CUST_LOC_CD  = DCTR.LOC_NUM 
                AND DCTR.DS_TRX_RULE_TP_CD   = #dsTrxRuleTpCd#
                AND DCTR.DS_PO_EXPR_DT      &gt;= #slsDt# 
                AND DCTR.EZCANCELFLAG        = '0'
    </statement>

    <statement id="getSvcConfigMstrPk" parameterClass="Map" resultClass="Map">
        SELECT
                  DCC.SVC_CONFIG_MSTR_PK
            FROM
                DS_CPO_CONFIG DCC
            WHERE
                DCC.GLBL_CMPY_CD        = #glblCmpyCd#
                AND DCC.CPO_ORD_NUM     = #cpoOrdNum#
                AND DCC.CONFIG_CATG_CD  = #configCatgCd#
                AND DCC.DS_ORD_POSN_NUM = #dsOrdPosnNum#
                AND DCC.EZCANCELFLAG    = '0'
    </statement>

    <!-- START 2017/07/12 K.Kojima [QC#19793,DEL] -->
    <!-- <statement id="getBaseDtlLineNum" parameterClass="Map" resultClass="Map"> -->
    <!--     SELECT -->
    <!--               DCD.CPO_DTL_LINE_NUM -->
    <!--             , DCD.CPO_DTL_LINE_SUB_NUM  -->
    <!--         FROM -->
    <!--             CPO_DTL_V DCD  -->
    <!--         WHERE -->
    <!--             DCD.GLBL_CMPY_CD        = #glblCmpyCd# -->
    <!--             AND DCD.CPO_ORD_NUM     = #cpoOrdNum# -->
    <!--             AND DCD.DS_ORD_POSN_NUM = (  -->
    <!--                 SELECT -->
    <!--                           D.DS_ORD_POSN_NUM  -->
    <!--                     FROM -->
    <!--                         CPO_DTL D  -->
    <!--                     WHERE -->
    <!--                         D.GLBL_CMPY_CD              = DCD.GLBL_CMPY_CD  -->
    <!--                         AND D.CPO_ORD_NUM           = DCD.CPO_ORD_NUM  -->
    <!--                         AND D.CPO_DTL_LINE_NUM      = #cpoDtlLineNum# -->
    <!--                         AND D.CPO_DTL_LINE_SUB_NUM  = #cpoDtlLineSubNum# -->
    <!--                         AND D.EZCANCELFLAG          = '0' -->
    <!--             )  -->
    <!--             AND DCD.BASE_CMPT_FLG   = 'Y' -->
    <!--             AND DCD.EZCANCELFLAG    = '0' -->
    <!-- </statement> -->
    <!-- END 2017/07/12 K.Kojima [QC#19793,DEL] -->

    <!-- START 2017/07/12 K.Kojima [QC#19793,DEL] -->
    <!-- <statement id="getAddlBaseItemLineList" parameterClass="Map" resultClass="Map"> -->
    <!--     SELECT -->
    <!--               CD.DPLY_LINE_NUM -->
    <!--             , CD.CPO_DTL_LINE_NUM -->
    <!--             , CD.CPO_DTL_LINE_SUB_NUM -->
    <!--             , MTVS.MDSE_TP_CTX_TP_CD -->
    <!--             , MDSE.MDSE_CD -->
    <!--             , MDSE.MDSE_NM -->
    <!--         FROM -->
    <!--             CPO_DTL_V        CD -->
    <!--             , MDSE_TP_VAL_SET   MTVS -->
    <!--             , ALL_MDSE_V        MDSE -->
    <!--         WHERE -->
    <!--             CD.GLBL_CMPY_CD             = #glblCmpyCd# -->
    <!--             AND CD.CPO_ORD_NUM          = #cpoOrdNum# -->
    <!--             AND CD.DS_ORD_POSN_NUM      = #dsOrdPosnNum# -->
    <!--             AND CD.EZCANCELFLAG         = '0' -->
    <!--             AND CD.GLBL_CMPY_CD         = MDSE.GLBL_CMPY_CD -->
    <!--             AND CD.MDSE_CD              = MDSE.MDSE_CD -->
    <!--             AND CD.EZCANCELFLAG         = MDSE.EZCANCELFLAG -->
    <!--             AND MTVS.GLBL_CMPY_CD       = MDSE.GLBL_CMPY_CD -->
    <!--             AND MTVS.COA_MDSE_TP_CD     = MDSE.COA_MDSE_TP_CD -->
    <!--             AND MTVS.MDSE_TP_CTX_TP_CD  = #cpoSvcAddlBaseItems# -->
    <!--             AND MTVS.EZCANCELFLAG       = MDSE.EZCANCELFLAG -->
    <!-- </statement> -->
    <!-- END 2017/07/12 K.Kojima [QC#19793,DEL] -->

    <statement id="searchDsContrPk" parameterClass="Map" resultClass="Map">
        SELECT
                  S.DS_CONTR_PK
                , C.DS_CONTR_NUM
                , C.DS_CONTR_NM
                , S.DS_CONTR_CTRL_STS_CD
                , S.DS_CONTR_CTRL_STS_NM
            FROM
                DS_CONTR            C
                , DS_CONTR_STS_V    S
                , DS_CONTR_CTRL_STS CS
            WHERE
                C.DS_CONTR_NUM              = #dsContrNum#
                AND C.DS_ACCT_NUM           = #dsAcctNum#
                AND C.GLBL_CMPY_CD          = #glblCmpyCd#
                AND C.EZCANCELFLAG          = '0'
                AND C.DS_CONTR_PK           = S.DS_CONTR_PK
                AND C.GLBL_CMPY_CD          = S.GLBL_CMPY_CD
                AND S.ADD_TO_CONTR_ELIG_FLG = 'Y'
                AND S.EZCANCELFLAG          = '0'
                AND CS.GLBL_CMPY_CD         = S.GLBL_CMPY_CD
                AND CS.DS_CONTR_CTRL_STS_CD = S.DS_CONTR_CTRL_STS_CD
                AND CS.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getBillToCustInfoList" parameterClass="Map" resultClass="Map">
        SELECT
            BTC.BILL_TO_CUST_CD AS BILL_TO_CUST_CD

                , ( 
                    RPAD( 
                        BTC.FIRST_LINE_ADDR
                        , LENGTH(BTC.FIRST_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.SCD_LINE_ADDR
                        , LENGTH(BTC.SCD_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.THIRD_LINE_ADDR
                        , LENGTH(BTC.THIRD_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.FRTH_LINE_ADDR
                        , LENGTH(BTC.FRTH_LINE_ADDR) + 1
                    ) || CONCAT(BTC.CTY_ADDR, ',') || RPAD(BTC.ST_CD, LENGTH(BTC.ST_CD) + 1) || RPAD(BTC.POST_CD, LENGTH(BTC.POST_CD) + 1)
                ) BILL_TO_ADDR

            ,(
              CASE WHEN BTC.FIRST_LINE_ADDR IS NOT NULL THEN
                  
                     DECODE (BTC.FIRST_LINE_ADDR, NULL, '', CONCAT(BTC.FIRST_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (BTC.SCD_LINE_ADDR, NULL, '', CONCAT(BTC.SCD_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (BTC.THIRD_LINE_ADDR, NULL, '', CONCAT(BTC.THIRD_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (BTC.FRTH_LINE_ADDR, NULL, '', CONCAT(BTC.FRTH_LINE_ADDR, CHR(13) || CHR(10)))
                  || CONCAT (BTC.CTY_ADDR, ',')
                  || RPAD (BTC.ST_CD, LENGTH (BTC.ST_CD) + 1)
                  || BTC.POST_CD
              END)               AS ENT_BILL_TO_ADDR
            ,DAC.SELL_TO_CUST_CD AS DS_ACCT_NUM
            ,DAC.DS_ACCT_NM      AS DS_ACCT_NM
        FROM
            BILL_TO_CUST    BTC
           ,SELL_TO_CUST    DAC
        WHERE
            BTC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND BTC.BILL_TO_CUST_CD LIKE #custCd#
            AND BTC.RGTN_STS_CD     = #rgtnStsCd#
            AND BTC.EZCANCELFLAG    = '0'
            
            AND BTC.GLBL_CMPY_CD    = DAC.GLBL_CMPY_CD
            AND BTC.SELL_TO_CUST_CD = DAC.SELL_TO_CUST_CD
            AND DAC.RGTN_STS_CD      = #rgtnStsCd#
            AND DAC.EZCANCELFLAG     = '0'
            AND ROWNUM          &lt;= 2  <!-- 2018/03/12 S21_NA#24090 Add -->
    </statement>

    <statement id="getBillToCustCount" parameterClass="Map" resultClass="Integer">
        SELECT
                  COUNT(B.GLBL_CMPY_CD) COUNT
            FROM
                BILL_TO_CUST B
            WHERE
                B.GLBL_CMPY_CD          = #glblCmpyCd#
                AND B.BILL_TO_CUST_CD   = #billToCustCd#
                AND B.RGTN_STS_CD       = #rgtnStsCd#
                AND B.EZCANCELFLAG      = '0'
    </statement>

    <statement id="getDsAcctCustCount" parameterClass="Map" resultClass="Integer">
        SELECT
                  COUNT(A.GLBL_CMPY_CD) COUNT 
            FROM
                SELL_TO_CUST A 
            WHERE
                A.GLBL_CMPY_CD        = #glblCmpyCd#
                AND A.SELL_TO_CUST_CD = #dsAcctNum#
                AND A.RGTN_STS_CD     = #rgtnStsCd#
                AND A.EZCANCELFLAG    = '0'
    </statement>

    <!-- START 2017/07/12 K.Kojima [QC#19793,DEL] -->
    <!-- <statement id="getOrderBillToInfo" parameterClass="Map" resultClass="Map"> -->
    <!--     SELECT -->
    <!--               DC.BILL_TO_CUST_ACCT_CD -->
    <!--             , DC.BILL_TO_CUST_ACCT_NM -->
    <!--             , DC.BILL_TO_CUST_CD -->
    <!--             , DC.BILL_TO_CUST_LOC_ADDR -->
    <!--         FROM -->
    <!--             CPO_V DC  -->
    <!--         WHERE -->
    <!--             DC.GLBL_CMPY_CD     = #glblCmpyCd# -->
    <!--             AND DC.CPO_ORD_NUM  = #cpoOrdNum# -->
    <!--             AND DC.EZCANCELFLAG = '0' -->
    <!-- </statement> -->
    <!-- END 2017/07/12 K.Kojima [QC#19793,DEL] -->

    <statement id="getBillByTpList" parameterClass="Map" resultClass="Map">
        SELECT
                  BBT.BILL_BY_TP_CD
                , BBT.BILL_BY_TP_DESC_TXT
            FROM
                BILL_BY_TP BBT
            WHERE
                BBT.GLBL_CMPY_CD        = #glblCmpyCd#
                AND BBT.EZCANCELFLAG    = '0'
                AND EXISTS (
                    SELECT
                              CD.GLBL_CMPY_CD
                        FROM
                            CPO_SVC_DEF_CUST_DECN CD
                            , CPO DC
                        WHERE
                            DC.GLBL_CMPY_CD       = BBT.GLBL_CMPY_CD
                            AND DC.CPO_ORD_NUM    = #cpoOrdNum#
                            AND DC.EZCANCELFLAG   = '0'
                            AND DC.GLBL_CMPY_CD   = CD.GLBL_CMPY_CD
                            AND DC.DS_ORD_CATG_CD = CD.DS_ORD_CATG_CD
                            <!-- START 2018/02/06 K.Kojima [QC#23357,ADD] -->
                            AND DC.DS_ORD_TP_CD   = CD.DS_ORD_TP_CD
                            <!-- END 2018/02/06 K.Kojima [QC#23357,ADD] -->
                            AND CD.BILL_BY_TP_CD  = BBT.BILL_BY_TP_CD
                            AND CD.EZCANCELFLAG   = '0'
                ) 
            ORDER BY
                BBT.BILL_BY_TP_SORT_NUM
    </statement>

    <statement id="getContractIndicatorList" parameterClass="Map" resultClass="Map">
        SELECT
                  C.DS_CONTR_CATG_CD
                , C.DS_CONTR_CATG_DESC_TXT
            FROM
                DS_CONTR_CATG   C
            WHERE
                C.GLBL_CMPY_CD      = #glblCmpyCd#
                AND C.OM_CATG_FLG   = 'Y'
                AND C.EZCANCELFLAG  = '0'
            ORDER BY
                C.DS_CONTR_CATG_SORT_NUM
    </statement>

    <statement id="getMntBillAsEquipInfo" parameterClass="Map" resultClass="Map">
        WITH CUST_V AS ( 
            SELECT
                      1 PRIORITY
                    , DC.BILL_TO_CUST_ACCT_CD   DS_ACCT_NUM
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- , DC.BILL_TO_CUST_ACCT_NM   DS_ACCT_NM -->
                    , STC.DS_ACCT_NM            DS_ACCT_NM
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , DC.BILL_TO_CUST_CD        SOLD_TO_CUST_LOC_CD
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- , DC.BILL_TO_CUST_LOC_ADDR  BILL_TO_SRCH_TXT -->
                    , RPAD(BTC.FIRST_LINE_ADDR, LENGTH(BTC.FIRST_LINE_ADDR) + 1)
                        || RPAD(BTC.SCD_LINE_ADDR, LENGTH(BTC.SCD_LINE_ADDR) + 1)
                        || RPAD(BTC.THIRD_LINE_ADDR, LENGTH(BTC.THIRD_LINE_ADDR) + 1)
                        || RPAD(BTC.FRTH_LINE_ADDR, LENGTH(BTC.FRTH_LINE_ADDR) + 1)
                        || CONCAT(BTC.CTY_ADDR, ',')
                        || RPAD(BTC.st_cd, LENGTH (BTC.ST_CD) + 1)
                        || BTC.POST_CD          BILL_TO_SRCH_TXT
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , DC.DS_ORD_CATG_CD
                    <!-- START 2017/07/12 K.Kojima [QC#19793,DEL] -->
                    <!-- , DC.DS_ORD_CATG_DESC_TXT -->
                    <!-- END 2017/07/12 K.Kojima [QC#19793,DEL] -->
                    , CD.APPLY_HDR_BILL_TO_FLG
                    , CD.APPLY_HDR_SLD_TO_FLG
                    , CD.APPLY_SPEC_CUST_FLG 
                FROM
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- CPO_V                DC -->
                      CPO                   DC
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , CPO_SVC_DEF_CUST_DECN CD
                    <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                    , SELL_TO_CUST          STC
                    , BILL_TO_CUST          BTC
                    <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
                WHERE
                    DC.GLBL_CMPY_CD              = #glblCmpyCd#
                    AND DC.CPO_ORD_NUM           = #cpoOrdNum#
                    AND DC.EZCANCELFLAG          = '0'
                    AND DC.GLBL_CMPY_CD          = CD.GLBL_CMPY_CD
                    AND DC.DS_ORD_CATG_CD        = CD.DS_ORD_CATG_CD
                    <!-- START 2018/02/06 K.Kojima [QC#23357,ADD] -->
                    AND DC.DS_ORD_TP_CD          = CD.DS_ORD_TP_CD
                    <!-- END 2018/02/06 K.Kojima [QC#23357,ADD] -->
                    AND CD.BILL_BY_TP_CD         = #billByTpCd#
                    AND CD.APPLY_HDR_BILL_TO_FLG = 'Y'
                    AND CD.EZCANCELFLAG          = '0'
                    <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                    AND DC.GLBL_CMPY_CD          = STC.GLBL_CMPY_CD(+)
                    AND DC.BILL_TO_CUST_ACCT_CD  = STC.SELL_TO_CUST_CD(+)
                    AND STC.EZCANCELFLAG(+)      = '0'
                    AND DC.GLBL_CMPY_CD          = BTC.GLBL_CMPY_CD(+)
                    AND DC.BILL_TO_CUST_CD       = BTC.BILL_TO_CUST_CD(+)
                    AND BTC.EZCANCELFLAG(+)      = '0'
                    <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
            UNION
            SELECT
                      2 PRIORITY
                    , DC.SELL_TO_CUST_CD        DS_ACCT_NUM
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- , DC.SOLD_TO_CUST_ACCT_NM   DS_ACCT_NM -->
                    , STC.DS_ACCT_NM            DS_ACCT_NM
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , DC.SOLD_TO_CUST_LOC_CD    SOLD_TO_CUST_LOC_CD
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- , DC.SOLD_TO_CUST_LOC_ADDR  BILL_TO_SRCH_TXT -->
                    , RPAD(BTC.FIRST_LINE_ADDR, LENGTH(BTC.FIRST_LINE_ADDR) + 1)
                        || RPAD(BTC.SCD_LINE_ADDR, LENGTH(BTC.SCD_LINE_ADDR) + 1)
                        || RPAD(BTC.THIRD_LINE_ADDR, LENGTH(BTC.THIRD_LINE_ADDR) + 1)
                        || RPAD(BTC.FRTH_LINE_ADDR, LENGTH(BTC.FRTH_LINE_ADDR) + 1)
                        || CONCAT(BTC.CTY_ADDR, ',')
                        || RPAD(BTC.st_cd, LENGTH (BTC.ST_CD) + 1)
                        || BTC.POST_CD          BILL_TO_SRCH_TXT
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , DC.DS_ORD_CATG_CD
                    <!-- START 2017/07/12 K.Kojima [QC#19793,DEL] -->
                    <!-- , DC.DS_ORD_CATG_DESC_TXT -->
                    <!-- END 2017/07/12 K.Kojima [QC#19793,DEL] -->
                    , CD.APPLY_HDR_BILL_TO_FLG
                    , CD.APPLY_HDR_SLD_TO_FLG
                    , CD.APPLY_SPEC_CUST_FLG 
                FROM
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- CPO_V                DC -->
                      CPO                   DC
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , CPO_SVC_DEF_CUST_DECN CD
                    <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                    , SELL_TO_CUST          STC
                    , BILL_TO_CUST          BTC
                    <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
                WHERE
                    DC.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND DC.CPO_ORD_NUM          = #cpoOrdNum#
                    AND DC.EZCANCELFLAG         = '0'
                    AND DC.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                    AND DC.DS_ORD_CATG_CD       = CD.DS_ORD_CATG_CD
                    <!-- START 2018/02/06 K.Kojima [QC#23357,ADD] -->
                    AND DC.DS_ORD_TP_CD         = CD.DS_ORD_TP_CD
                    <!-- END 2018/02/06 K.Kojima [QC#23357,ADD] -->
                    AND CD.BILL_BY_TP_CD        = #billByTpCd#
                    AND CD.APPLY_HDR_SLD_TO_FLG = 'Y'
                    AND CD.EZCANCELFLAG         = '0'
                    <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                    AND DC.GLBL_CMPY_CD          = STC.GLBL_CMPY_CD(+)
                    AND DC.SELL_TO_CUST_CD       = STC.SELL_TO_CUST_CD(+)
                    AND STC.EZCANCELFLAG(+)      = '0'
                    AND DC.GLBL_CMPY_CD          = BTC.GLBL_CMPY_CD(+)
                    AND DC.SOLD_TO_CUST_LOC_CD   = BTC.BILL_TO_CUST_CD(+)
                    AND BTC.EZCANCELFLAG(+)      = '0'
                    <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
            UNION 
            SELECT
                      3 PRIORITY
                    , CD.SPEC_DS_ACCT_NUM       DS_ACCT_NUM
                    , DAC.DS_ACCT_NM            DS_ACCT_NM
                    , CD.SPEC_BILL_TO_CUST_CD   SOLD_TO_CUST_LOC_CD
                    , RPAD( 
                        BTC.FIRST_LINE_ADDR
                        , LENGTH(BTC.FIRST_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.SCD_LINE_ADDR
                        , LENGTH(BTC.SCD_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.THIRD_LINE_ADDR
                        , LENGTH(BTC.THIRD_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.FRTH_LINE_ADDR
                        , LENGTH(BTC.FRTH_LINE_ADDR) + 1
                    ) || CONCAT(BTC.CTY_ADDR, ',') 
                      || RPAD(BTC.ST_CD, LENGTH(BTC.ST_CD) + 1) 
                      || RPAD(BTC.POST_CD, LENGTH(BTC.POST_CD) + 1)
                                                BILL_TO_SRCH_TXT
                    , DC.DS_ORD_CATG_CD
                    <!-- START 2017/07/12 K.Kojima [QC#19793,DEL] -->
                    <!-- , DC.DS_ORD_CATG_DESC_TXT -->
                    <!-- END 2017/07/12 K.Kojima [QC#19793,DEL] -->
                    , CD.APPLY_HDR_BILL_TO_FLG
                    , CD.APPLY_HDR_SLD_TO_FLG
                    , CD.APPLY_SPEC_CUST_FLG 
                FROM
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- CPO_V                DC -->
                      CPO                   DC
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , CPO_SVC_DEF_CUST_DECN CD
                    , SELL_TO_CUST DAC
                    , BILL_TO_CUST BTC 
                WHERE
                    DC.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND DC.CPO_ORD_NUM          = #cpoOrdNum#
                    AND DC.EZCANCELFLAG         = '0'
                    AND DC.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                    AND DC.DS_ORD_CATG_CD       = CD.DS_ORD_CATG_CD
                    <!-- START 2018/02/06 K.Kojima [QC#23357,ADD] -->
                    AND DC.DS_ORD_TP_CD         = CD.DS_ORD_TP_CD
                    <!-- END 2018/02/06 K.Kojima [QC#23357,ADD] -->
                    AND CD.BILL_BY_TP_CD        = #billByTpCd#
                    AND CD.APPLY_SPEC_CUST_FLG  = 'Y'
                    AND CD.EZCANCELFLAG         = '0'
                                                          --
                    AND CD.GLBL_CMPY_CD         = DAC.GLBL_CMPY_CD(+)
                    AND CD.SPEC_DS_ACCT_NUM     = DAC.SELL_TO_CUST_CD(+)
                    AND DAC.RGTN_STS_CD(+)      = #rgtnStsCd#
                    AND DAC.EFF_FROM_DT(+)     &lt;= #slsDt#
                    AND ( 
                        DAC.EFF_THRU_DT(+)      IS NULL
                        OR DAC.EFF_THRU_DT(+)  &gt;= #slsDt#
                    ) 
                    AND DAC.DS_ACCT_ACTV_CUST_FLG(+) = 'Y'
                    AND DAC.EZCANCELFLAG(+)          = '0'
                                                          --
                    AND CD.GLBL_CMPY_CD         = BTC.GLBL_CMPY_CD(+)
                    AND CD.SPEC_BILL_TO_CUST_CD = BTC.BILL_TO_CUST_CD(+)
                    AND BTC.RGTN_STS_CD(+)      = #rgtnStsCd#
                    AND BTC.EFF_FROM_DT(+)     &lt;= #slsDt#
                    AND (
                        BTC.EFF_THRU_DT(+)      IS NULL
                        OR BTC.EFF_THRU_DT(+)  &gt;= #slsDt#
                    )
                    AND BTC.EZCANCELFLAG(+)     = '0'
        ) 
        SELECT
                  DS_ACCT_NUM
                , DS_ACCT_NM
                , SOLD_TO_CUST_LOC_CD
                , BILL_TO_SRCH_TXT
            FROM
                CUST_V V
            ORDER BY
                V.PRIORITY
    </statement>

    <statement id="getContrInfo" parameterClass="Map" resultClass="Map">
        SELECT
                  HDR.DS_CONTR_PK
                , HDR.DS_CONTR_NUM
                , HDR.DS_CONTR_SQ_NUM
                , HDR.DS_CONTR_NM
                , VW1.DS_CONTR_CTRL_STS_CD HDR_STS_CD
                , VW1.DS_CONTR_CTRL_STS_NM HDR_STS_NM
                , DAC.SELL_TO_CUST_CD AS DS_ACCT_NUM
                , DAC.DS_ACCT_NM
                , HDR.DS_CONTR_CATG_CD
                , HTP.DS_CONTR_TP_NM
            FROM
                DS_CONTR            HDR
                , DS_CONTR_STS_V    VW1
                , SELL_TO_CUST      DAC
                , DS_CONTR_TP       HTP
            WHERE
                HDR.GLBL_CMPY_CD                = #glblCmpyCd#
                <isNotNull property="dsContrPk">
                AND HDR.DS_CONTR_PK             = #dsContrPk#
                </isNotNull>
                <isNotNull property="dsContrNum">
                AND HDR.DS_CONTR_NUM            = #dsContrNum#
                </isNotNull>
<!--                AND HDR.DS_CONTR_CATG_CD        = #dsContrCatgCd#-->
                AND HDR.EZCANCELFLAG            = '0'
                AND HDR.GLBL_CMPY_CD            = VW1.GLBL_CMPY_CD
                AND HDR.DS_CONTR_PK             = VW1.DS_CONTR_PK
                <!-- START 2017/07/20 M.Kidokoro [QC#18814, MOD] -->
                <!-- AND VW1.DS_CONTR_CTRL_STS_CD    = 'ACTV' -->
                AND VW1.ADD_TO_CONTR_ELIG_FLG   = 'Y'
                <!-- END 2017/07/20 M.Kidokoro [QC#18814, MOD] -->
                AND VW1.EZCANCELFLAG            = '0'
                AND HDR.GLBL_CMPY_CD            = DAC.GLBL_CMPY_CD
                AND HDR.DS_ACCT_NUM             = DAC.SELL_TO_CUST_CD
                AND DAC.EZCANCELFLAG            = '0'
                AND HDR.GLBL_CMPY_CD            = HTP.GLBL_CMPY_CD
                AND HDR.DS_CONTR_TP_CD          = HTP.DS_CONTR_TP_CD
                AND HTP.EZCANCELFLAG            = '0'
                <isNotNull property="serNum">
                AND EXISTS ( 
                    SELECT
                              1
                        FROM
                            DS_CONTR_DTL        DCD
                            , SVC_MACH_MSTR     SMM
                        WHERE
                            HDR.GLBL_CMPY_CD            = DCD.GLBL_CMPY_CD
                            AND HDR.DS_CONTR_PK         = DCD.DS_CONTR_PK
                            AND DCD.EZCANCELFLAG        = '0'
                            AND DCD.GLBL_CMPY_CD        = SMM.GLBL_CMPY_CD
                            AND DCD.SVC_MACH_MSTR_PK    = SMM.SVC_MACH_MSTR_PK
                            AND SMM.SER_NUM             = #serNum#
                           <!-- 2017/02/13 QC#16575 ADD STRAT -->
                            AND SMM.MDSE_CD             = #mdseCd#
                           <!-- 2017/02/13 QC#16575 ADD E N D -->
                            AND SMM.EZCANCELFLAG        = '0'
                ) 
                </isNotNull>
    </statement>

    <statement id="getHeaderInfoFromContrNum" parameterClass="Map" resultClass="Map">
        SELECT
                  DC.SVC_PGM_MDSE_CD
                , M.MDSE_DESC_SHORT_TXT
                , DC.DS_CONTR_CATG_CD
                , CEIL( 
                    MONTHS_BETWEEN( 
                        TO_DATE(DC.CONTR_VRSN_EFF_THRU_DT, 'yyyymmdd')
                        , TO_DATE(DC.CONTR_VRSN_EFF_FROM_DT, 'yyyymmdd')
                    )
                ) TERM_MTH_NUM
                <!-- START 2017/10/24 [QC#21556, ADD] -->
                , CEIL( 
                    MONTHS_BETWEEN( 
                          TO_DATE(DC.CONTR_VRSN_EFF_THRU_DT, 'yyyymmdd')
                        , TO_DATE(#slsDt#, 'yyyymmdd')
                    )
                ) TERM_MTH_NUM_RMNG 
                , DC.CONTR_VRSN_EFF_FROM_DT
                <!-- END   2017/10/24 [QC#21556, ADD] -->
                , DC.DS_ACCT_NUM
                , DAC.DS_ACCT_NM
                , DC.ALT_PAYER_CUST_CD
                , ( 
                    RPAD( 
                        BTC.FIRST_LINE_ADDR
                        , LENGTH(BTC.FIRST_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.SCD_LINE_ADDR
                        , LENGTH(BTC.SCD_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.THIRD_LINE_ADDR
                        , LENGTH(BTC.THIRD_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.FRTH_LINE_ADDR
                        , LENGTH(BTC.FRTH_LINE_ADDR) + 1
                    ) || CONCAT(BTC.CTY_ADDR, ',') || RPAD(BTC.ST_CD, LENGTH(BTC.ST_CD) + 1) || RPAD(BTC.POST_CD, LENGTH(BTC.POST_CD) + 1)
                ) BILL_TO_ADDR
                , ( 
                    CASE 
                        WHEN BTC.FIRST_LINE_ADDR IS NOT NULL 
                        THEN DECODE( 
                            BTC.FIRST_LINE_ADDR
                            , NULL
                            , ''
                            , CONCAT(BTC.FIRST_LINE_ADDR, CHR(13) || CHR(10))
                        ) || DECODE( 
                            BTC.SCD_LINE_ADDR
                            , NULL
                            , ''
                            , CONCAT(BTC.SCD_LINE_ADDR, CHR(13) || CHR(10))
                        ) || DECODE( 
                            BTC.THIRD_LINE_ADDR
                            , NULL
                            , ''
                            , CONCAT(BTC.THIRD_LINE_ADDR, CHR(13) || CHR(10))
                        ) || DECODE( 
                            BTC.FRTH_LINE_ADDR
                            , NULL
                            , ''
                            , CONCAT(BTC.FRTH_LINE_ADDR, CHR(13) || CHR(10))
                        ) || CONCAT(BTC.CTY_ADDR, ',') || RPAD(BTC.ST_CD, LENGTH(BTC.ST_CD) + 1) || BTC.POST_CD 
                        END
                ) AS ENT_BILL_TO_ADDR
                , DC.BASE_BLLG_CYCLE_CD
                <!-- START 2018/01/30 [QC#23857, MOD] -->
                ,(
                    CASE 
                        WHEN DC.MTR_BLLG_CYCLE_CD IS NOT NULL
                        THEN DC.MTR_BLLG_CYCLE_CD
                        ELSE (
                            SELECT
                                      BM.BLLG_MTR_BLLG_CYCLE_CD 
                                FROM
                                    ( 
                                        SELECT
                                            DCBM.BLLG_MTR_BLLG_CYCLE_CD
                                        FROM
                                            DS_CONTR_BLLG_MTR    DCBM
                                           ,DS_CONTR_DTL         DCD
                                        WHERE
                                                DCBM.GLBL_CMPY_CD       = DC.GLBL_CMPY_CD
                                            AND DCBM.EZCANCELFLAG       = '0'
                                            AND DCBM.GLBL_CMPY_CD       = DCD.GLBL_CMPY_CD
                                            AND DCD.EZCANCELFLAG        = '0'
                                            AND DCBM.DS_CONTR_DTL_PK    = DCD.DS_CONTR_DTL_PK
                                            AND DCD.DS_CONTR_PK         = DC.DS_CONTR_PK
                                        ORDER BY DCBM.DS_CONTR_DTL_PK,DCBM.BLLG_MTR_LB_CD
                                    ) BM 
                                WHERE
                                    ROWNUM = 1)
                    END
                  ) AS MTR_BLLG_CYCLE_CD
                <!-- END 2018/01/30 [QC#23857, MOD] -->
                --
                , ( 
                    CASE 
                        WHEN DC.PRC_SVC_PLN_TP_CD IS NOT NULL
                        THEN DC.PRC_SVC_PLN_TP_CD
                        ELSE (
                            SELECT
                                      PT.PRC_SVC_PLN_TP_CD 
                                FROM
                                    ( 
                                        SELECT
                                                  PT.PRC_SVC_PLN_TP_CD 
                                            FROM
                                                PRC_SVC_PLN_TP PT 
                                            WHERE
                                                PT.GLBL_CMPY_CD     = DC.GLBL_CMPY_CD
                                                AND PT.EZCANCELFLAG = '0' 
                                            ORDER BY
                                                PT.PRC_SVC_PLN_TP_SORT_NUM
                                    ) PT 
                                WHERE
                                    ROWNUM = 1)
                    END
                  ) AS PRC_SVC_PLN_TP_CD
                , ( 
                    CASE 
                        WHEN DC.PRC_SVC_CONTR_TP_CD IS NOT NULL
                        THEN DC.PRC_SVC_CONTR_TP_CD
                        ELSE (
                            SELECT
                                      CT.PRC_SVC_CONTR_TP_CD 
                                FROM
                                    ( 
                                        SELECT
                                                  CT.PRC_SVC_CONTR_TP_CD
                                            FROM
                                                PRC_SVC_CONTR_TP    CT
                                            WHERE
                                                CT.GLBL_CMPY_CD     = DC.GLBL_CMPY_CD
                                                AND CT.EZCANCELFLAG = '0' 
                                            ORDER BY
                                                CT.PRC_SVC_CONTR_TP_SORT_NUM
                                    ) CT
                                WHERE
                                    ROWNUM = 1
                        )
                    END
                  ) AS PRC_SVC_CONTR_TP_CD
                , ( 
                    CASE 
                        WHEN DC.BILL_BY_TP_CD IS NOT NULL
                        THEN DC.BILL_BY_TP_CD
                        ELSE (
                            SELECT
                                    BBT.BILL_BY_TP_CD
                                FROM
                                    (
                                        SELECT
                                            BBT.BILL_BY_TP_CD
                                        FROM
                                            BILL_BY_TP BBT
                                        WHERE
                                            BBT.GLBL_CMPY_CD        = #glblCmpyCd#
                                        AND BBT.EZCANCELFLAG    = '0'
                                        AND EXISTS (
                                                    SELECT
                                                        CD.GLBL_CMPY_CD
                                                    FROM
                                                        CPO_SVC_DEF_CUST_DECN   CD
                                                      , CPO                     DC
                                                    WHERE
                                                        DC.GLBL_CMPY_CD   = BBT.GLBL_CMPY_CD
                                                    AND DC.CPO_ORD_NUM    = #cpoOrdNum#
                                                    AND DC.EZCANCELFLAG   = '0'
                                                    AND DC.GLBL_CMPY_CD   = CD.GLBL_CMPY_CD
                                                    AND DC.DS_ORD_CATG_CD = CD.DS_ORD_CATG_CD
                                                    <!-- START 2018/02/06 K.Kojima [QC#23357,ADD] -->
                                                    AND DC.DS_ORD_TP_CD   = CD.DS_ORD_TP_CD
                                                    <!-- END 2018/02/06 K.Kojima [QC#23357,ADD] -->
                                                    AND CD.BILL_BY_TP_CD  = BBT.BILL_BY_TP_CD
                                                    AND CD.EZCANCELFLAG   = '0'
                                            ) 
                                        ORDER BY
                                            BBT.BILL_BY_TP_SORT_NUM
                                    ) BBT
                                WHERE
                                    ROWNUM = 1
                        )
                    END
                  ) AS BILL_BY_TP_CD
                <!-- 2018/05/17 QC#22482 Add Start -->
                , DC.MAN_CONTR_OVRD_FLG
                , SM.SVC_MEMO_RSN_CD
                , SMR.SVC_MEMO_RSN_DESC_TXT
                , SM.SVC_CMNT_TXT
                <!-- 2018/05/17 QC#22482 Add End -->
                <!-- START 2018/07/18 K.Kitachi [QC#26589, ADD] -->
                , DC.INV_SEPT_BASE_USG_FLG
                <!-- END 2018/07/18 K.Kitachi [QC#26589, ADD] -->
            FROM
                DS_CONTR            DC
                , ALL_MDSE_V        M
                , SELL_TO_CUST      DAC
                , BILL_TO_CUST      BTC
                <!-- 2018/05/17 QC#22482 Add Start -->
                , SVC_MEMO          SM
                , SVC_MEMO_RSN      SMR
                <!-- 2018/05/17 QC#22482 Add End -->
            WHERE
                DC.GLBL_CMPY_CD                 = #glblCmpyCd#
                AND DC.DS_CONTR_NUM             = #dsContrNum#
                AND DC.DS_CONTR_STS_CD   &lt;&gt; #dsContrStsCd#
                AND DC.EZCANCELFLAG             = '0'
                --
                AND DC.GLBL_CMPY_CD             = M.GLBL_CMPY_CD
                AND DC.SVC_PGM_MDSE_CD          = M.MDSE_CD
                AND M.EZCANCELFLAG              = '0'
                --
                AND DC.GLBL_CMPY_CD             = DAC.GLBL_CMPY_CD(+)
                AND DC.DS_ACCT_NUM              = DAC.SELL_TO_CUST_CD(+)
                AND DAC.EZCANCELFLAG(+)         = '0'
                --
                AND BTC.GLBL_CMPY_CD            = DC.GLBL_CMPY_CD
                AND BTC.BILL_TO_CUST_CD         = DC.ALT_PAYER_CUST_CD
                AND BTC.EZCANCELFLAG            = '0'
                <!-- 2018/05/17 QC#22482 Add Start -->
                --
                AND DC.GLBL_CMPY_CD             = SM.GLBL_CMPY_CD(+)
                AND DC.DS_CONTR_PK              = SM.DS_CONTR_PK(+)
                AND SM.SVC_MEMO_TP_CD(+)        = #svcMemoTpCd#
                AND SM.SVC_MEMO_TRX_NM(+)       = #svcMemoTrxNm#
                AND SM.EZCANCELFLAG(+)          = '0'
                --
                AND SM.GLBL_CMPY_CD             = SMR.GLBL_CMPY_CD(+)
                AND SM.SVC_MEMO_RSN_CD          = SMR.SVC_MEMO_RSN_CD(+)
                AND SMR.EZCANCELFLAG(+)         = '0'
                <!-- 2018/05/17 QC#22482 Add End -->
    </statement>

    <statement id="getSerNumFromContract" parameterClass="Map" resultClass="Map">
        SELECT
                  SMM.SER_NUM
                  <!-- 2017/02/13 QC#16575 ADD STRAT -->
                , SMM.MDSE_CD
                  <!-- 2017/02/13 QC#16575 ADD E N D -->
            FROM
                DS_CONTR_DTL        DCD
                , SVC_MACH_MSTR     SMM
            WHERE
                DCD.GLBL_CMPY_CD                   = #glblCmpyCd#
                AND DCD.DS_CONTR_PK                = #dsContrPk#
                AND DCD.DS_CONTR_DTL_STS_CD &lt;&gt; #dsContrDtlSts#
                AND DCD.EZCANCELFLAG               = '0'
                AND SMM.GLBL_CMPY_CD               = DCD.GLBL_CMPY_CD
                AND SMM.SVC_MACH_MSTR_PK           = DCD.SVC_MACH_MSTR_PK
                AND SMM.EZCANCELFLAG               = '0'
    </statement>

    <statement id="getInitDataFromCpo" parameterClass="Map" resultClass="Map">
        SELECT
                  A.DS_ORD_POSN_NUM
                , A.DPLY_LINE_NUM
                , A.CPO_DTL_LINE_NUM
                , A.CPO_DTL_LINE_SUB_NUM
                , A.DS_ORD_CATG_CD
                , A.SELL_TO_CUST_CD
                , A.SOLD_TO_CUST_LOC_CD
                , A.SOLD_TO_CUST_LOC_ADDR
                , A.DS_ACCT_NM
                , A.BILL_TO_CUST_ACCT_CD
                , A.BILL_TO_CUST_ACCT_NM
                , A.BILL_TO_CUST_CD
                , A.BILL_TO_CUST_LOC_ADDR
                , A.CR_REBIL_CD
                , A.PRC_BASE_DT
                , A.DS_ORD_TP_CD
                , A.SER_NUM
                , A.MDSE_CD
                <!-- START 2018/07/02 T.Tomita [QC#26738,ADD] -->
                , A.ORD_BOOK_FLG
                <!-- END 2018/07/02 T.Tomita [QC#26738,ADD] -->
                <!-- START 2024/03/12 M.Kuroi [QC#63638,ADD] -->
                , A.CPO_ORD_TS
                <!-- END 2024/03/12 M.Kuroi [QC#63638,ADD] -->
        FROM (
            SELECT
                      DCD.DS_ORD_POSN_NUM
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- , DCD.DPLY_LINE_NUM -->
                    , CONCAT (DCD.DS_ORD_POSN_NUM, '.')
                        || CONCAT (DCD.DS_CPO_LINE_NUM, DECODE (DCD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
                        || DCD.DS_CPO_LINE_SUB_NUM AS DPLY_LINE_NUM
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , DCD.CPO_DTL_LINE_NUM
                    , DCD.CPO_DTL_LINE_SUB_NUM
                    , DC.DS_ORD_CATG_CD
                    , DC.SELL_TO_CUST_CD
                    , DC.SOLD_TO_CUST_LOC_CD
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- , DC.SOLD_TO_CUST_LOC_ADDR -->
                    , RPAD(BTC_S.FIRST_LINE_ADDR, LENGTH(BTC_S.FIRST_LINE_ADDR) + 1)
                        || RPAD(BTC_S.SCD_LINE_ADDR, LENGTH(BTC_S.SCD_LINE_ADDR) + 1)
                        || RPAD(BTC_S.THIRD_LINE_ADDR, LENGTH(BTC_S.THIRD_LINE_ADDR) + 1)
                        || RPAD(BTC_S.FRTH_LINE_ADDR, LENGTH(BTC_S.FRTH_LINE_ADDR) + 1)
                        || CONCAT(BTC_S.CTY_ADDR, ',')
                        || RPAD(BTC_S.st_cd, LENGTH (BTC_S.ST_CD) + 1)
                        || BTC_S.POST_CD          AS SOLD_TO_CUST_LOC_ADDR
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , DAC.DS_ACCT_NM
                    --
                    , DC.BILL_TO_CUST_ACCT_CD
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- , DC.BILL_TO_CUST_ACCT_NM -->
                    , STC_B.DS_ACCT_NM            AS BILL_TO_CUST_ACCT_NM
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , DC.BILL_TO_CUST_CD
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- , DC.BILL_TO_CUST_LOC_ADDR -->
                    , RPAD(BTC_B.FIRST_LINE_ADDR, LENGTH(BTC_B.FIRST_LINE_ADDR) + 1)
                        || RPAD(BTC_B.SCD_LINE_ADDR, LENGTH(BTC_B.SCD_LINE_ADDR) + 1)
                        || RPAD(BTC_B.THIRD_LINE_ADDR, LENGTH(BTC_B.THIRD_LINE_ADDR) + 1)
                        || RPAD(BTC_B.FRTH_LINE_ADDR, LENGTH(BTC_B.FRTH_LINE_ADDR) + 1)
                        || CONCAT(BTC_B.CTY_ADDR, ',')
                        || RPAD(BTC_B.st_cd, LENGTH (BTC_B.ST_CD) + 1)
                        || BTC_B.POST_CD          AS BILL_TO_CUST_LOC_ADDR
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    --
                    , DCD.CR_REBIL_CD
                    , DCD.PRC_BASE_DT
                    , DC.DS_ORD_TP_CD
                    --
                    , NULL      SER_NUM
                    , NULL      MDSE_CD
                    <!-- START 2018/07/02 T.Tomita [QC#26738,ADD] -->
                    , DC.ORD_BOOK_FLG  ORD_BOOK_FLG
                    <!-- END 2018/07/02 T.Tomita [QC#26738,ADD] -->
                    <!-- START 2024/03/12 M.Kuroi [QC#63638,ADD] -->
                    , DC.CPO_ORD_TS
                    <!-- END 2024/03/12 M.Kuroi [QC#63638,ADD] -->
                    
                FROM
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!--   CPO_V         DC -->
                    <!-- , CPO_DTL_V     DCD -->
                      CPO           DC
                    , CPO_DTL       DCD
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , SELL_TO_CUST  DAC
                    , ALL_MDSE_V    M
                    <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                    , SELL_TO_CUST  STC_B
                    , BILL_TO_CUST  BTC_B
                    , BILL_TO_CUST  BTC_S
                    <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
                WHERE
                    DC.GLBL_CMPY_CD              = #glblCmpyCd#
                    AND DC.CPO_ORD_NUM           = #cpoOrdNum#
                    AND DC.EZCANCELFLAG          = '0'
                    AND DC.GLBL_CMPY_CD          = DAC.GLBL_CMPY_CD
                    AND DC.SELL_TO_CUST_CD       = DAC.SELL_TO_CUST_CD
                    AND DAC.EZCANCELFLAG         = '0'
                    AND DC.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD
                    AND DC.CPO_ORD_NUM           = DCD.CPO_ORD_NUM
                    AND DCD.BASE_CMPT_FLG        = 'Y'
                    AND DCD.EZCANCELFLAG         = '0'
                    --
                    AND DCD.GLBL_CMPY_CD         = M.GLBL_CMPY_CD
                    AND DCD.MDSE_CD              = M.MDSE_CD
                    AND M.INSTL_BASE_CTRL_FLG    = 'Y'
                    AND M.EZCANCELFLAG           = '0'
                    <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                    AND DC.GLBL_CMPY_CD          = STC_B.GLBL_CMPY_CD(+)
                    AND DC.BILL_TO_CUST_ACCT_CD  = STC_B.SELL_TO_CUST_CD(+)
                    AND STC_B.EZCANCELFLAG(+)      = '0'
                    AND DC.GLBL_CMPY_CD          = BTC_B.GLBL_CMPY_CD(+)
                    AND DC.BILL_TO_CUST_CD       = BTC_B.BILL_TO_CUST_CD(+)
                    AND BTC_B.EZCANCELFLAG(+)    = '0'
                    AND DC.GLBL_CMPY_CD          = BTC_S.GLBL_CMPY_CD(+)
                    AND DC.SOLD_TO_CUST_LOC_CD   = BTC_S.BILL_TO_CUST_CD(+)
                    AND BTC_S.EZCANCELFLAG(+)    = '0'
                    <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
            UNION ALL
            SELECT
                      DCD.DS_ORD_POSN_NUM
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- , DCD.DPLY_LINE_NUM -->
                    , CONCAT (DCD.DS_ORD_POSN_NUM, '.')
                        || CONCAT (DCD.DS_CPO_LINE_NUM, DECODE (DCD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
                        || DCD.DS_CPO_LINE_SUB_NUM AS DPLY_LINE_NUM
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , DCD.CPO_DTL_LINE_NUM
                    , DCD.CPO_DTL_LINE_SUB_NUM
                    , DC.DS_ORD_CATG_CD
                    , DC.SELL_TO_CUST_CD
                    , DC.SOLD_TO_CUST_LOC_CD
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- , DC.SOLD_TO_CUST_LOC_ADDR -->
                    , RPAD(BTC_S.FIRST_LINE_ADDR, LENGTH(BTC_S.FIRST_LINE_ADDR) + 1)
                        || RPAD(BTC_S.SCD_LINE_ADDR, LENGTH(BTC_S.SCD_LINE_ADDR) + 1)
                        || RPAD(BTC_S.THIRD_LINE_ADDR, LENGTH(BTC_S.THIRD_LINE_ADDR) + 1)
                        || RPAD(BTC_S.FRTH_LINE_ADDR, LENGTH(BTC_S.FRTH_LINE_ADDR) + 1)
                        || CONCAT(BTC_S.CTY_ADDR, ',')
                        || RPAD(BTC_S.st_cd, LENGTH (BTC_S.ST_CD) + 1)
                        || BTC_S.POST_CD          AS SOLD_TO_CUST_LOC_ADDR
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , DAC.DS_ACCT_NM
                    --
                    , DC.BILL_TO_CUST_ACCT_CD
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- , DC.BILL_TO_CUST_ACCT_NM -->
                    , STC_B.DS_ACCT_NM            AS BILL_TO_CUST_ACCT_NM
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , DC.BILL_TO_CUST_CD
                    <!-- , DC.BILL_TO_CUST_LOC_ADDR -->
                    , RPAD(BTC_B.FIRST_LINE_ADDR, LENGTH(BTC_B.FIRST_LINE_ADDR) + 1)
                        || RPAD(BTC_B.SCD_LINE_ADDR, LENGTH(BTC_B.SCD_LINE_ADDR) + 1)
                        || RPAD(BTC_B.THIRD_LINE_ADDR, LENGTH(BTC_B.THIRD_LINE_ADDR) + 1)
                        || RPAD(BTC_B.FRTH_LINE_ADDR, LENGTH(BTC_B.FRTH_LINE_ADDR) + 1)
                        || CONCAT(BTC_B.CTY_ADDR, ',')
                        || RPAD(BTC_B.st_cd, LENGTH (BTC_B.ST_CD) + 1)
                        || BTC_B.POST_CD          AS BILL_TO_CUST_LOC_ADDR
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    --
                    , DCD.CR_REBIL_CD
                    , DCD.PRC_BASE_DT
                    , DC.DS_ORD_TP_CD
                    --
                    , SMM.SER_NUM
                    , SMM.MDSE_CD
                    <!-- START 2018/07/02 T.Tomita [QC#26738,ADD] -->
                    , DC.ORD_BOOK_FLG  ORD_BOOK_FLG
                    <!-- END 2018/07/02 T.Tomita [QC#26738,ADD] -->
                    <!-- START 2024/03/12 M.Kuroi [QC#63638,ADD] -->
                    , DC.CPO_ORD_TS
                    <!-- END 2024/03/12 M.Kuroi [QC#63638,ADD] -->
                FROM
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!--    CPO_V            DC -->
                       CPO              DC
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , DS_CPO_CONFIG     DCC
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- , CPO_DTL_V         DCD -->
                    , CPO_DTL           DCD
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , SELL_TO_CUST      DAC
                    , ALL_MDSE_V        M
                    , SVC_CONFIG_MSTR   SCM
                    , SVC_MACH_MSTR     SMM
                    <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                    , SELL_TO_CUST  STC_B
                    , BILL_TO_CUST  BTC_B
                    , BILL_TO_CUST  BTC_S
                    <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
                WHERE
                    DC.GLBL_CMPY_CD              = #glblCmpyCd#
                    AND DC.CPO_ORD_NUM           = #cpoOrdNum#
                    AND DC.EZCANCELFLAG          = '0'
                    --
                    AND DC.GLBL_CMPY_CD          = DCC.GLBL_CMPY_CD
                    AND DC.CPO_ORD_NUM           = DCC.CPO_ORD_NUM
                    AND DCC.CONFIG_TP_CD         = #addToConfig#
                    AND DCC.EZCANCELFLAG         = '0'
                    --
                    AND DC.GLBL_CMPY_CD          = DAC.GLBL_CMPY_CD
                    AND DC.SELL_TO_CUST_CD       = DAC.SELL_TO_CUST_CD
                    AND DAC.EZCANCELFLAG         = '0'
                    --
                    AND DCC.GLBL_CMPY_CD         = DCD.GLBL_CMPY_CD
                    AND DCC.CPO_ORD_NUM          = DCD.CPO_ORD_NUM
                    AND DCC.DS_ORD_POSN_NUM      = DCD.DS_ORD_POSN_NUM
                    AND DCD.EZCANCELFLAG         = '0'
                    --
                    AND DCD.GLBL_CMPY_CD         = M.GLBL_CMPY_CD
                    AND DCD.MDSE_CD              = M.MDSE_CD
                    AND M.COA_MDSE_TP_CD IN (
                        SELECT
                                  VS.COA_MDSE_TP_CD
                            FROM
                                MDSE_TP_VAL_SET     VS
                            WHERE
                                VS.GLBL_CMPY_CD             = M.GLBL_CMPY_CD 
                                AND VS.MDSE_TP_CTX_TP_CD    = #cpoSvcAddlBaseItems#
                                AND VS.EZCANCELFLAG         = '0'
                    )
                    AND M.EZCANCELFLAG = '0'
                    --
                    AND DCC.GLBL_CMPY_CD        = SCM.GLBL_CMPY_CD
                    AND DCC.SVC_CONFIG_MSTR_PK  = SCM.SVC_CONFIG_MSTR_PK
                    AND SCM.EZCANCELFLAG        = '0'
                    --
                    AND SCM.GLBL_CMPY_CD        = SMM.GLBL_CMPY_CD
                    AND SCM.SVC_CONFIG_MSTR_PK  = SMM.SVC_CONFIG_MSTR_PK
                    AND SCM.SVC_MACH_MSTR_PK    = SMM.SVC_MACH_MSTR_PK
                    AND SMM.EZCANCELFLAG        = '0'
                    <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                    AND DC.GLBL_CMPY_CD          = STC_B.GLBL_CMPY_CD(+)
                    AND DC.BILL_TO_CUST_ACCT_CD  = STC_B.SELL_TO_CUST_CD(+)
                    AND STC_B.EZCANCELFLAG(+)      = '0'
                    AND DC.GLBL_CMPY_CD          = BTC_B.GLBL_CMPY_CD(+)
                    AND DC.BILL_TO_CUST_CD       = BTC_B.BILL_TO_CUST_CD(+)
                    AND BTC_B.EZCANCELFLAG(+)    = '0'
                    AND DC.GLBL_CMPY_CD          = BTC_S.GLBL_CMPY_CD(+)
                    AND DC.SOLD_TO_CUST_LOC_CD   = BTC_S.BILL_TO_CUST_CD(+)
                    AND BTC_S.EZCANCELFLAG(+)    = '0'
                    <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
        ) A
        ORDER BY
            DS_ORD_POSN_NUM
    </statement>

    <statement id="getInitDataFromShellContr" parameterClass="Map" resultClass="Map">
        SELECT
                  CPO_ORD_NUM
                , SELL_TO_CUST_CD
                , SOLD_TO_CUST_LOC_CD
                , DS_CONTR_DTL_PK
                , SHELL_LINE_NUM
                , SVC_PGM_MDSE_CD
                , DS_CONTR_CATG_CD
                , BASE_BLLG_CYCLE_CD
                , USG_BLLG_CYCLE_CD
                , CONTR_VRSN_EFF_FROM_DT
                , CONTR_VRSN_EFF_THRU_DT
                , CPO_SVC_AGMT_VER_NUM
                , DS_CONTR_PK
                , DS_CONTR_PK_AD
                , DS_CONTR_NUM
                , APPLY_EQUIP_BILL_TO_FLG
                , CUST_PO_NUM
                , PO_DT
                , CUST_ISS_PO_DT
                , MTR_READ_METH_CD
                , PRICE_XX_EXST_FLG
                , BASE_PRC_DEAL_AMT
                , DS_ORD_POSN_NUM
                , DS_CPO_CONFIG_PK
                , MDSE_CD
                , DPLY_LINE_NUM
                , CPO_DTL_LINE_NUM
                , CPO_DTL_LINE_SUB_NUM
                , MDL_ID
                , T_MDL_NM
                , MDL_DESC_TXT
                , SHIP_TO_SRCH_TXT
                , MDSE_DESC_SHORT_TXT
                , MDSE_DESC_LONG_TXT
                , PRC_SVC_CONTR_TP_DESC_TXT
                , PRC_SVC_PLN_TP_DESC_TXT
                , DS_CONTR_CATG_DESC_TXT
                , BASE_BLLG_CYCLE_DESC_TXT
                , USG_BLLG_CYCLE_DESC_TXT
                , BILL_BY_TP_DESC_TXT
                , MTR_READ_METH_DESC_TXT
                , DS_ACCT_NM
                , BILL_TO_SRCH_TXT
                , BILL_TO_CUST_ACCT_CD
                , BILL_TO_CUST_ACCT_NM
                , BILL_TO_CUST_LOC_ADDR
                , BILL_TO_CUST_LOC_CD
                , SHIP_TO_CUST_LOC_CD
                , SVC_CONFIG_MSTR_PK
                , CR_REBIL_CD
                , PRC_BASE_DT
                , DS_ORD_CATG_CD
                , DS_ORD_TP_CD
                , ORD_HDR_STS_CD
                , SHPG_STS_CD
                <!-- START 2024/03/12 M.Kuroi [QC#63638,ADD] -->
                , SHIP_FLG
                <!-- END 2024/03/12 M.Kuroi [QC#63638,ADD] -->
                , MAN_CONTR_OVRD_FLG
                , PRC_SVC_CONTR_TP_CD
                , PRC_SVC_PLN_TP_CD
                , FIX_TERM_IN_MTH_AOT
                , BILL_BY_TP_CD
                , TOT_BASE_PRC_DEAL_AMT
                , BILL_WITH_EQUIP_FLG
                , FROM_PER_MTH_NUM
                , TO_PER_MTH_NUM
                , TERM_MTH_AOT
                , ADD_CONTR_FLG
                , ADD_ASRY_FLG
                , SVC_MEMO_RSN_CD
                , SVC_CMNT_TXT
                , SVC_MEMO_RSN_DESC_TXT
                , CONTR_AVAL_FLG
                , DS_ORD_POSN_NUM_SORT
                , EZUPTIME
                , EZUPTIMEZONE
                , ORD_BOOK_FLG  AS ORD_BOOK_FLG
                , INV_SEPT_BASE_USG_FLG
            FROM
                (
                SELECT
                       DC.CPO_ORD_NUM
                     , C.DS_ACCT_NUM       AS SELL_TO_CUST_CD
                     , C.ALT_PAYER_CUST_CD AS SOLD_TO_CUST_LOC_CD
                     , CD.DS_CONTR_DTL_PK
                     , CD.SHELL_LINE_NUM
                     <!-- START 2018/07/23 K.Kitachi [QC#26589, MOD] -->
                     <!-- , C.SVC_PGM_MDSE_CD -->
                     , CASE 
                         WHEN CD.ADD_CONTR_FLG = 'Y'
                     <!-- mod start 2018/08/17 QC#23919 -->
                         THEN NVL(CD.SVC_PGM_MDSE_CD, FCD.SVC_PGM_MDSE_CD)
                     <!-- mod end 2018/08/17 QC#23919 -->
                         ELSE C.SVC_PGM_MDSE_CD
                       END AS SVC_PGM_MDSE_CD
                     , C.DS_CONTR_CATG_CD
                     <!-- , BBC.BLLG_CYCLE_CD AS BASE_BLLG_CYCLE_CD -->
                     , CASE 
                         WHEN CD.ADD_CONTR_FLG = 'Y'
                     <!-- mod start 2018/08/17 QC#23919 -->
                         THEN NVL(DBC.BLLG_CYCLE_CD, FDBC.BLLG_CYCLE_CD)
                     <!-- mod end 2018/08/17 QC#23919 -->
                         ELSE BBC.BLLG_CYCLE_CD
                       END AS BASE_BLLG_CYCLE_CD
                     <!-- START 2018/01/30 [QC#23857, MOD] -->
                     <!-- , NVL(UBC.BLLG_CYCLE_CD,BC.BLLG_CYCLE_CD) AS USG_BLLG_CYCLE_CD -->
                     , CASE 
                         WHEN CD.ADD_CONTR_FLG = 'Y'
                     <!-- mod start 2018/08/17 QC#23919 -->
                         THEN NVL(DUC.BLLG_CYCLE_CD, BC.BLLG_CYCLE_CD)
                     <!-- mod end 2018/08/17 QC#23919 -->
                         ELSE NVL(UBC.BLLG_CYCLE_CD, BC.BLLG_CYCLE_CD)
                       END AS USG_BLLG_CYCLE_CD
                     <!-- END 2018/01/30 [QC#23857, MOD] -->
                     <!-- END 2018/07/23 K.Kitachi [QC#26589, MOD] -->
                     , C.CONTR_VRSN_EFF_FROM_DT
                     , C.CONTR_VRSN_EFF_THRU_DT
                     , C.CPO_SVC_AGMT_VER_NUM
                     , CD.DS_CONTR_PK
                     <!-- START 2017/08/29 [QC#20665, MOD] -->
                     , CD.DS_CONTR_PK AS DS_CONTR_PK_AD
                     <!-- END   2017/08/29 [QC#20665, MOD] -->
                     , C.DS_CONTR_NUM
                     , C.APPLY_EQUIP_BILL_TO_FLG
                     , CCP.CUST_PO_NUM
                     , CCP.PO_DT
                     <!-- START 2018/04/16 A.Kosai [QC#20162,ADD] -->
                     , CCP.CUST_ISS_PO_DT
                     <!-- END 2018/04/16 A.Kosai [QC#20162,ADD] -->
                     , CD.MTR_READ_METH_CD
                     , 'Y' AS PRICE_XX_EXST_FLG
                     , CD.BASE_PRC_DEAL_AMT
                     , DCD.DS_ORD_POSN_NUM
                     , DCD.DS_CPO_CONFIG_PK
                     , DCD.MDSE_CD
                     <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                     <!-- , DCD.DPLY_LINE_NUM -->
                     , CONCAT (DCD.DS_ORD_POSN_NUM, '.')
                         || CONCAT (DCD.DS_CPO_LINE_NUM, DECODE (DCD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
                         || DCD.DS_CPO_LINE_SUB_NUM AS DPLY_LINE_NUM
                     <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                     , DCD.CPO_DTL_LINE_NUM
                     , DCD.CPO_DTL_LINE_SUB_NUM
                     , DCC.MDL_ID
                     , MN.T_MDL_NM
                     , DCC.MDL_DESC_TXT
                     , ( 
                         RPAD( 
                             DCC.SHIP_TO_FIRST_LINE_ADDR
                             , LENGTH(DCC.SHIP_TO_FIRST_LINE_ADDR) + 1
                         ) || RPAD( 
                             DCC.SHIP_TO_SCD_LINE_ADDR
                             , LENGTH(DCC.SHIP_TO_SCD_LINE_ADDR) + 1
                         ) || RPAD( 
                             DCC.SHIP_TO_THIRD_LINE_ADDR
                             , LENGTH(DCC.SHIP_TO_THIRD_LINE_ADDR) + 1
                         ) || RPAD( 
                             DCC.SHIP_TO_FRTH_LINE_ADDR
                             , LENGTH(DCC.SHIP_TO_FRTH_LINE_ADDR) + 1
                         ) || CONCAT(DCC.SHIP_TO_CTY_ADDR, ',') || RPAD( 
                             DCC.SHIP_TO_ST_CD
                             , LENGTH(DCC.SHIP_TO_ST_CD) + 1
                         ) || RPAD( 
                             DCC.SHIP_TO_POST_CD
                             , LENGTH(DCC.SHIP_TO_POST_CD) + 1
                         )
                     ) SHIP_TO_SRCH_TXT
                     <!-- START 2018/07/23 K.Kitachi [QC#26589, MOD] -->
                     <!-- , M.MDSE_DESC_SHORT_TXT -->
                     , CASE 
                         WHEN CD.ADD_CONTR_FLG = 'Y'
                         THEN DM.MDSE_DESC_SHORT_TXT
                         ELSE M.MDSE_DESC_SHORT_TXT
                       END AS MDSE_DESC_SHORT_TXT
                     <!-- , M.MDSE_DESC_LONG_TXT -->
                     , CASE 
                         WHEN CD.ADD_CONTR_FLG = 'Y'
                         THEN DM.MDSE_DESC_LONG_TXT
                         ELSE M.MDSE_DESC_LONG_TXT
                       END AS MDSE_DESC_LONG_TXT
                     , PCT.PRC_SVC_CONTR_TP_DESC_TXT
                     , PPT.PRC_SVC_PLN_TP_DESC_TXT
                     , CC.DS_CONTR_CATG_DESC_TXT
                     <!-- , BBC.BLLG_CYCLE_DESC_TXT AS BASE_BLLG_CYCLE_DESC_TXT -->
                     , CASE 
                         WHEN CD.ADD_CONTR_FLG = 'Y'
                     <!-- mod start 2018/08/17 QC#23919 -->
                         THEN NVL(DBC.BLLG_CYCLE_DESC_TXT, FDBC.BLLG_CYCLE_DESC_TXT)
                     <!-- mod end 2018/08/17 QC#23919 -->
                         ELSE BBC.BLLG_CYCLE_DESC_TXT
                       END AS BASE_BLLG_CYCLE_DESC_TXT
                     <!-- START 2018/01/30 [QC#23857, MOD] -->
                     <!-- , NVL(UBC.BLLG_CYCLE_DESC_TXT,BC.BLLG_CYCLE_DESC_TXT) AS USG_BLLG_CYCLE_DESC_TXT -->
                     , CASE 
                         WHEN CD.ADD_CONTR_FLG = 'Y'
                     <!-- mod start 2018/08/17 QC#23919 -->
                         THEN NVL(DUC.BLLG_CYCLE_DESC_TXT, BC.BLLG_CYCLE_DESC_TXT)
                     <!-- mod end 2018/08/17 QC#23919 -->
                         ELSE NVL(UBC.BLLG_CYCLE_DESC_TXT, BC.BLLG_CYCLE_DESC_TXT)
                       END AS USG_BLLG_CYCLE_DESC_TXT
                     <!-- END 2018/01/30 [QC#23857, MOD] -->
                     <!-- END 2018/07/23 K.Kitachi [QC#26589, MOD] -->
                     , BBT.BILL_BY_TP_DESC_TXT
                     , MRM.MTR_READ_METH_DESC_TXT
                     , DAC.DS_ACCT_NM
                     , ( 
                         RPAD( 
                             BTC.FIRST_LINE_ADDR
                             , LENGTH(BTC.FIRST_LINE_ADDR) + 1
                         ) || RPAD( 
                             BTC.SCD_LINE_ADDR
                             , LENGTH(BTC.SCD_LINE_ADDR) + 1
                         ) || RPAD( 
                             BTC.THIRD_LINE_ADDR
                             , LENGTH(BTC.THIRD_LINE_ADDR) + 1
                         ) || RPAD( 
                             BTC.FRTH_LINE_ADDR
                             , LENGTH(BTC.FRTH_LINE_ADDR) + 1
                         ) || CONCAT(BTC.CTY_ADDR, ',') || RPAD(BTC.ST_CD, LENGTH(BTC.ST_CD) + 1) || RPAD(BTC.POST_CD, LENGTH(BTC.POST_CD) + 1)
                      ) BILL_TO_SRCH_TXT
                     , DC.BILL_TO_CUST_ACCT_CD
                     <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                     <!-- , DC.BILL_TO_CUST_ACCT_NM -->
                     <!-- , DC.BILL_TO_CUST_LOC_ADDR -->
                     , STC_B.DS_ACCT_NM            AS BILL_TO_CUST_ACCT_NM
                     , RPAD(BTC_B.FIRST_LINE_ADDR, LENGTH(BTC_B.FIRST_LINE_ADDR) + 1)
                         || RPAD(BTC_B.SCD_LINE_ADDR, LENGTH(BTC_B.SCD_LINE_ADDR) + 1)
                         || RPAD(BTC_B.THIRD_LINE_ADDR, LENGTH(BTC_B.THIRD_LINE_ADDR) + 1)
                         || RPAD(BTC_B.FRTH_LINE_ADDR, LENGTH(BTC_B.FRTH_LINE_ADDR) + 1)
                         || CONCAT(BTC_B.CTY_ADDR, ',')
                         || RPAD(BTC_B.st_cd, LENGTH (BTC_B.ST_CD) + 1)
                         || BTC_B.POST_CD          AS BILL_TO_CUST_LOC_ADDR
                     <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                     , DCC.BILL_TO_CUST_LOC_CD
                     , DCC.SHIP_TO_CUST_LOC_CD
                     , DCC.SVC_CONFIG_MSTR_PK
                     , DCD.CR_REBIL_CD
                     , DCD.PRC_BASE_DT
                     , DC.DS_ORD_CATG_CD
                     , DC.DS_ORD_TP_CD
                     , DC.ORD_HDR_STS_CD
                     , SP.SHPG_STS_CD
                     <!-- START 2024/03/12 M.Kuroi [QC#63638,ADD] -->
                     , SS.SHIP_FLG
                     <!-- END 2024/03/12 M.Kuroi [QC#63638,ADD] -->
                     --
                     , C.MAN_CONTR_OVRD_FLG
                     , C.PRC_SVC_CONTR_TP_CD
                     , C.PRC_SVC_PLN_TP_CD
                     , C.FIX_TERM_IN_MTH_AOT
                     , C.BILL_BY_TP_CD
                     --
                     , CD.TOT_BASE_PRC_DEAL_AMT
                     , CD.BILL_WITH_EQUIP_FLG
                     , CD.FROM_PER_MTH_NUM
                     , CD.TO_PER_MTH_NUM
                     , (CD.TO_PER_MTH_NUM - CD.FROM_PER_MTH_NUM + 1) AS TERM_MTH_AOT
                     , CD.ADD_CONTR_FLG
                     , CD.ADD_ASRY_FLG
                     --
                     , SM.SVC_MEMO_RSN_CD
                     , SM.SVC_CMNT_TXT
                     <!-- START 2018/05/07 [QC#22482, ADD] -->
                     , SMR.SVC_MEMO_RSN_DESC_TXT
                     <!-- END 2018/05/07 [QC#22482, ADD] -->
                     --
                     <!-- START 2017/10/24 [QC#21656-1,MOD] -->
                     , (
                         CASE 
                             WHEN EXISTS (
                                 SELECT 1 FROM DS_CONTR_DTL CD1
                                     WHERE   CD1.GLBL_CMPY_CD               = #glblCmpyCd#
                                         AND CD1.CPO_ORD_NUM                = CD.CPO_ORD_NUM
                                         AND CD1.SHELL_LINE_NUM             = CD.SHELL_LINE_NUM
                                         AND CD1.DS_CONTR_DTL_STS_CD &lt;&gt; #dsContrDtlStsCd#
                                         AND CD1.EZCANCELFLAG               = '0'
                             ) AND C.DS_CONTR_STS_CD &lt;&gt; #dsContrStsCd#
                             THEN 'Y'
                             ELSE 'N'
                         END
                       ) AS CONTR_AVAL_FLG
                     <!-- END   2017/10/24 [QC#21656-1,MOD] -->
                     --
                 <!-- START 2017/08/31 [QC#20820, ADD] -->
                     , TO_NUMBER(DCD.DS_ORD_POSN_NUM) AS DS_ORD_POSN_NUM_SORT
                 <!-- END   2017/08/31 [QC#20820, ADD] -->
                     , C.EZUPTIME
                     , C.EZUPTIMEZONE
                     <!-- START 2018/07/02 T.Tomita [QC#26738,ADD] -->
                     , DC.ORD_BOOK_FLG  AS ORD_BOOK_FLG
                     <!-- END 2018/07/02 T.Tomita [QC#26738,ADD] -->
                     <!-- START 2018/07/18 K.Kitachi [QC#26589, ADD] -->
                     , C.INV_SEPT_BASE_USG_FLG
                     <!-- END 2018/07/18 K.Kitachi [QC#26589, ADD] -->
                     , RANK() OVER(PARTITION BY CD.DS_CONTR_DTL_PK ORDER BY CCP.EZINTIME, CCP.DS_CONTR_CR_CARD_PO_PK) AS RANK
                 FROM
                     <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                     <!--   CPO_V                 DC -->
                     <!-- , CPO_DTL_V             DCD -->
                       CPO                   DC
                     , CPO_DTL               DCD
                     <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                     , DS_CPO_CONFIG         DCC
                     , DS_CONTR_DTL          CD
                     , DS_CONTR              C
                     , DS_CONTR_CR_CARD_PO   CCP
                     , SHPG_PLN              SP
                     , SHPG_STS              SS
                     , ALL_MDSE_V            M
                     , MDL_NM                MN
                     , DS_CONTR_CATG         CC
                     , BLLG_CYCLE            BBC
                     , BLLG_CYCLE            UBC
                     , SELL_TO_CUST          DAC
                     , BILL_TO_CUST          BTC
                     , MTR_READ_METH         MRM
                     , BILL_BY_TP            BBT
                     , PRC_SVC_CONTR_TP      PCT
                     , PRC_SVC_PLN_TP        PPT
                     , SVC_MEMO              SM
                     <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                     , SELL_TO_CUST          STC_B
                     , BILL_TO_CUST          BTC_B
                     <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
                     <!-- START 2018/01/30 [QC#23857, ADD] -->
                     , (
                         SELECT
                             *
                         FROM
                            (
                             SELECT
                                 CD3.DS_CONTR_PK
                                ,UBC2.BLLG_CYCLE_CD
                                ,UBC2.BLLG_CYCLE_DESC_TXT
                             FROM
                                  CPO                    DC2
                                 ,CPO_DTL                DCD2
                                 ,DS_CONTR_DTL           CD2
                                 ,DS_CONTR_DTL           CD3
                                 ,DS_CONTR_BLLG_MTR      CBM
                                 ,BLLG_CYCLE             UBC2
                             WHERE
                                     DC2.GLBL_CMPY_CD           = #glblCmpyCd#
                                 AND DC2.CPO_ORD_NUM            = #refCpoOrdNum#
                                 AND DC2.EZCANCELFLAG           = '0'
                                 --
                                 AND DC2.GLBL_CMPY_CD           = DCD2.GLBL_CMPY_CD
                                 AND DC2.CPO_ORD_NUM            = DCD2.CPO_ORD_NUM
                                 AND DCD2.EZCANCELFLAG          = '0'
                                 --
                                 AND DCD2.GLBL_CMPY_CD          = CD2.GLBL_CMPY_CD
                                 AND DCD2.CPO_ORD_NUM           = CD2.CPO_ORD_NUM
                                 AND DCD2.CPO_DTL_LINE_NUM      = CD2.CPO_DTL_LINE_NUM
                                 AND DCD2.CPO_DTL_LINE_SUB_NUM  = CD2.CPO_DTL_LINE_SUB_NUM
                                 AND CD2.SHELL_LINE_NUM         IS NOT NULL
                                 <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                                 AND CD2.DS_CONTR_CRAT_TP_CD   = #dsContrCratTp#
                                 <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                                 AND (
                                         (
                                                 CD2.ADD_ASRY_FLG = #addAsryFlg01#
                                             AND CD2.DS_CONTR_DTL_TP_CD IN
                                             <iterate property="dsContrDtlTpCd01" var="dsContrDtlTpCd01[]" open=" (" close=")" conjunction=",">
                                                     #dsContrDtlTpCd01[]#
                                             </iterate>
                                         )
                                     OR
                                         (
                                                 CD2.ADD_ASRY_FLG = #addAsryFlg02#
                                             AND CD2.DS_CONTR_DTL_TP_CD IN
                                             <iterate property="dsContrDtlTpCd02" var="dsContrDtlTpCd02[]" open=" (" close=")" conjunction=",">
                                                     #dsContrDtlTpCd02[]#
                                             </iterate>
                                         )
                                 )
                                 AND CD2.EZCANCELFLAG           = '0'
                                 --
                                 AND CD2.GLBL_CMPY_CD           = CD3.GLBL_CMPY_CD
                                 AND CD2.DS_CONTR_PK            = CD3.DS_CONTR_PK
                                 AND CD3.EZCANCELFLAG           = '0'
                                 --
                                 AND CD3.GLBL_CMPY_CD           = CBM.GLBL_CMPY_CD
                                 AND CD3.DS_CONTR_DTL_PK        = CBM.DS_CONTR_DTL_PK
                                 AND CBM.EZCANCELFLAG           = '0'
                                 --
                                 AND CBM.GLBL_CMPY_CD           = UBC2.GLBL_CMPY_CD
                                 AND UBC2.EZCANCELFLAG          = '0'
                                 AND CBM.BLLG_MTR_BLLG_CYCLE_CD = UBC2.BLLG_CYCLE_CD
                             ORDER BY CBM.DS_CONTR_DTL_PK,CBM.BLLG_MTR_LB_CD
                            )     A
                         WHERE
                             ROWNUM = 1
                     )   BC
                     <!-- END 2018/01/30 [QC#23857, ADD] -->
                     <!-- START 2018/05/07 [QC#22482, ADD] -->
                     , SVC_MEMO_RSN          SMR
                     <!-- END 2018/05/07 [QC#22482, ADD] -->
                     <!-- START 2018/07/23 K.Kitachi [QC#26589, ADD] -->
                     , ALL_MDSE_V            DM
                     , BLLG_CYCLE            DBC
                     , BLLG_CYCLE            DUC
                     <!-- END 2018/07/23 K.Kitachi [QC#26589, ADD] -->
                     <!-- add start 2018/08/17 QC#23919 -->
                     , DS_CONTR_DTL          FCD
                     , BLLG_CYCLE            FDBC
                     <!-- add end 2018/08/17 QC#23919 -->
                 WHERE
                         DC.GLBL_CMPY_CD           = #glblCmpyCd#
                     AND DC.CPO_ORD_NUM            = #refCpoOrdNum#
                     AND DC.EZCANCELFLAG           = '0'
                     --
                     AND DC.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
                     AND DC.CPO_ORD_NUM            = DCD.CPO_ORD_NUM
                     AND DCD.EZCANCELFLAG          = '0'
                     --
                     AND DCD.GLBL_CMPY_CD          = DCC.GLBL_CMPY_CD
                     AND DCD.DS_CPO_CONFIG_PK      = DCC.DS_CPO_CONFIG_PK
                     AND DCC.EZCANCELFLAG          = '0'
                     --
                     AND DCD.GLBL_CMPY_CD          = CD.GLBL_CMPY_CD
                     AND DCD.CPO_ORD_NUM           = CD.CPO_ORD_NUM
                     AND DCD.CPO_DTL_LINE_NUM      = CD.CPO_DTL_LINE_NUM
                     AND DCD.CPO_DTL_LINE_SUB_NUM  = CD.CPO_DTL_LINE_SUB_NUM
                     AND CD.SHELL_LINE_NUM         IS NOT NULL
                     <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                     AND CD.DS_CONTR_CRAT_TP_CD    = #dsContrCratTp#
                     <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                     AND (
                             (
                                     CD.ADD_ASRY_FLG = #addAsryFlg01#
                                 AND CD.DS_CONTR_DTL_TP_CD IN
                                 <iterate property="dsContrDtlTpCd01" var="dsContrDtlTpCd01[]" open=" (" close=")" conjunction=",">
                                         #dsContrDtlTpCd01[]#
                                 </iterate>
                             )
                         OR
                             (
                                     CD.ADD_ASRY_FLG = #addAsryFlg02#
                                 AND CD.DS_CONTR_DTL_TP_CD IN
                                 <iterate property="dsContrDtlTpCd02" var="dsContrDtlTpCd02[]" open=" (" close=")" conjunction=",">
                                         #dsContrDtlTpCd02[]#
                                 </iterate>
                             )
                     )
                     AND CD.EZCANCELFLAG           = '0'
                     --
                     AND CD.GLBL_CMPY_CD           = C.GLBL_CMPY_CD
                     AND CD.DS_CONTR_PK            = C.DS_CONTR_PK
                     AND C.EZCANCELFLAG            = '0'
                     --
                     AND CD.GLBL_CMPY_CD           = CCP.GLBL_CMPY_CD(+)
                     AND CD.DS_CONTR_PK            = CCP.DS_CONTR_PK(+)
                     AND CD.DS_CONTR_DTL_PK        = CCP.DS_CONTR_DTL_PK(+)
                     AND CCP.EZCANCELFLAG(+)       = '0'
                     --
                     AND DCD.GLBL_CMPY_CD          = SP.GLBL_CMPY_CD(+)
                     AND DCD.CPO_ORD_NUM           = SP.TRX_HDR_NUM(+)
                     AND DCD.CPO_DTL_LINE_NUM      = SP.TRX_LINE_NUM(+)
                     AND DCD.CPO_DTL_LINE_SUB_NUM  = SP.TRX_LINE_SUB_NUM(+)
                     AND SP.EZCANCELFLAG(+)        = '0'
                     --
                     <!-- START 2024/03/12 M.Kuroi [QC#63638,ADD] -->
                     AND SP.GLBL_CMPY_CD           = SS.GLBL_CMPY_CD(+)
                     AND SP.SHPG_STS_CD            = SS.SHPG_STS_CD(+)
                     AND SS.EZCANCELFLAG(+)        = '0'
                     --
                     <!-- END 2024/03/12 M.Kuroi [QC#63638,ADD] -->
                     AND C.GLBL_CMPY_CD            = M.GLBL_CMPY_CD(+)
                     AND C.SVC_PGM_MDSE_CD         = M.MDSE_CD(+)
                     AND M.EZCANCELFLAG(+)         = '0'
                     --
                     AND CD.GLBL_CMPY_CD           = MN.T_GLBL_CMPY_CD(+)
                     AND CD.MDL_ID                 = MN.T_MDL_ID(+)
                     AND MN.EZCANCELFLAG(+)        = '0'
                     --
                     AND C.GLBL_CMPY_CD            = CC.GLBL_CMPY_CD(+)
                     AND C.DS_CONTR_CATG_CD        = CC.DS_CONTR_CATG_CD(+)
                     AND CC.EZCANCELFLAG(+)        = '0'
                     --
                     AND C.GLBL_CMPY_CD            = BBC.GLBL_CMPY_CD(+)
                     AND C.BASE_BLLG_CYCLE_CD      = BBC.BLLG_CYCLE_CD(+)
                     AND BBC.EZCANCELFLAG(+)       = '0'
                     --
                     AND C.GLBL_CMPY_CD            = UBC.GLBL_CMPY_CD(+)
                     AND C.MTR_BLLG_CYCLE_CD       = UBC.BLLG_CYCLE_CD(+)
                     AND UBC.EZCANCELFLAG(+)       = '0'
                     --
                     AND C.GLBL_CMPY_CD            = DAC.GLBL_CMPY_CD(+)
                     AND C.DS_ACCT_NUM             = DAC.SELL_TO_CUST_CD(+)
                     AND DAC.EZCANCELFLAG(+)       = '0'
                     --
                     AND C.GLBL_CMPY_CD            = BTC.GLBL_CMPY_CD(+)
                     AND C.ALT_PAYER_CUST_CD       = BTC.BILL_TO_CUST_CD(+)
                     AND BTC.EZCANCELFLAG(+)       = '0'
                     --
                     AND CD.GLBL_CMPY_CD           = MRM.GLBL_CMPY_CD(+)
                     AND CD.MTR_READ_METH_CD       = MRM.MTR_READ_METH_CD(+)
                     AND MRM.EZCANCELFLAG(+)       = '0'
                     --
                     AND C.GLBL_CMPY_CD            = BBT.GLBL_CMPY_CD(+)
                     AND C.BILL_BY_TP_CD           = BBT.BILL_BY_TP_CD(+)
                     AND BBT.EZCANCELFLAG(+)       = '0'
                     --
                     AND C.GLBL_CMPY_CD            = PCT.GLBL_CMPY_CD(+)
                     AND C.PRC_SVC_CONTR_TP_CD     = PCT.PRC_SVC_CONTR_TP_CD(+)
                     AND PCT.EZCANCELFLAG(+)       = '0'
                     --
                     AND C.GLBL_CMPY_CD            = PPT.GLBL_CMPY_CD(+)
                     AND C.PRC_SVC_PLN_TP_CD       = PPT.PRC_SVC_PLN_TP_CD(+)
                     AND PPT.EZCANCELFLAG(+)       = '0'
                     --
                     AND C.GLBL_CMPY_CD            = SM.GLBL_CMPY_CD(+)
                     AND C.DS_CONTR_PK             = SM.DS_CONTR_PK(+)
                     <!-- START 2017/07/28 [QC#20088, ADD] -->
                     AND C.DS_CONTR_PK             = SM.DS_CONTR_PK(+)
                     AND SM.SVC_MEMO_TP_CD(+)      = #svcMemoTpCd#
                     AND SM.SVC_MEMO_TRX_NM(+)     = #svcMemoTrxNm#
                     <!-- END   2017/07/28 [QC#20088, ADD] -->
                     AND SM.EZCANCELFLAG(+)        = '0'
                     <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                     AND DC.GLBL_CMPY_CD           = STC_B.GLBL_CMPY_CD(+)
                     AND DC.BILL_TO_CUST_ACCT_CD   = STC_B.SELL_TO_CUST_CD(+)
                     AND STC_B.EZCANCELFLAG(+)     = '0'
                     AND DC.GLBL_CMPY_CD           = BTC_B.GLBL_CMPY_CD(+)
                     AND DC.BILL_TO_CUST_CD        = BTC_B.BILL_TO_CUST_CD(+)
                     AND BTC_B.EZCANCELFLAG(+)     = '0'
                     <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
                     <!-- START 2018/01/30 [QC#23857, ADD] -->
                     AND C.DS_CONTR_PK             = BC.DS_CONTR_PK(+)
                     <!-- END 2018/01/30 [QC#23857, ADD] -->
                     <!-- START 2018/05/07 [QC#22482, ADD] -->
                     AND SM.GLBL_CMPY_CD           = SMR.GLBL_CMPY_CD(+)
                     AND SM.SVC_MEMO_RSN_CD        = SMR.SVC_MEMO_RSN_CD(+)
                     AND SMR.EZCANCELFLAG(+)       = '0'
                     <!-- END 2018/05/07 [QC#22482, ADD] -->
                     <!-- START 2018/07/23 K.Kitachi [QC#26589, ADD] -->
                     AND CD.GLBL_CMPY_CD           = DM.GLBL_CMPY_CD(+)
                     <!-- mod start 2018/08/17 QC#23919 -->
                     AND NVL(CD.SVC_PGM_MDSE_CD, FCD.SVC_PGM_MDSE_CD)
                                                   = DM.MDSE_CD(+)
                     <!-- mod end 2018/08/17 QC#23919 -->
                     AND DM.EZCANCELFLAG(+)        = '0'
                     AND CD.GLBL_CMPY_CD           = DBC.GLBL_CMPY_CD(+)
                     AND CD.BASE_BLLG_CYCLE_CD     = DBC.BLLG_CYCLE_CD(+)
                     AND DBC.EZCANCELFLAG(+)       = '0'
                     AND CD.GLBL_CMPY_CD           = DUC.GLBL_CMPY_CD(+)
                     AND CD.MTR_BLLG_CYCLE_CD      = DUC.BLLG_CYCLE_CD(+)
                     AND DUC.EZCANCELFLAG(+)       = '0'
                     <!-- END 2018/07/23 K.Kitachi [QC#26589, ADD] -->
                     <!-- add start 2018/08/17 QC#23919 -->
                     AND C.GLBL_CMPY_CD            = FCD.GLBL_CMPY_CD(+)
                     AND C.DS_CONTR_PK             = FCD.DS_CONTR_PK(+)
                     AND FCD.DS_CONTR_DTL_TP_CD(+) = #dsContrDtlTpCdFleet#
                     AND FCD.EZCANCELFLAG(+)       = '0'
                     AND FCD.GLBL_CMPY_CD          = FDBC.GLBL_CMPY_CD(+)
                     AND FCD.BASE_BLLG_CYCLE_CD    = FDBC.BLLG_CYCLE_CD(+)
                     AND FDBC.EZCANCELFLAG(+)      = '0'
                     <!-- add end 2018/08/17 QC#23919 -->
                     <!-- START 2019/01/09 S.Kitamura [QC#26928,ADD] -->
                     AND CCP.DS_CONTR_MACH_LVL_NUM(+) = #lvlNum#
                     AND CCP.CR_CARD_FLG(+)        = 'N'
                     <!-- AND CCP.PO_FROM_DT(+)         &lt;= #slsDt# -->
                     <!-- AND CCP.PO_DT(+)              &gt;= #slsDt# -->
                     <!-- END 2019/01/09 S.Kitamura [QC#26928,ADD] -->
                     <!-- END 2019/05/17 W.Honda [QC#50157,MOD] -->
                     )
            WHERE
                    RANK           = 1
            UNION
            SELECT
                  DC.CPO_ORD_NUM
                , C.DS_ACCT_NUM       AS SELL_TO_CUST_CD
                , C.ALT_PAYER_CUST_CD AS SOLD_TO_CUST_LOC_CD
                , NULL AS DS_CONTR_DTL_PK
                , C.SHELL_LINE_NUM
                , C.SVC_PGM_MDSE_CD
                , C.DS_CONTR_CATG_CD
                , BBC.BLLG_CYCLE_CD AS BASE_BLLG_CYCLE_CD
                , UBC.BLLG_CYCLE_CD AS USG_BLLG_CYCLE_CD
                , C.CONTR_VRSN_EFF_FROM_DT
                , C.CONTR_VRSN_EFF_THRU_DT
                , C.CPO_SVC_AGMT_VER_NUM
                , C.DS_CONTR_PK
                <!-- START 2017/08/29 [QC#20665, MOD] -->
                , NULL AS DS_CONTR_PK_AD
                <!-- END   2017/08/29 [QC#20665, MOD] -->
                , C.DS_CONTR_NUM
                , C.APPLY_EQUIP_BILL_TO_FLG
                , NULL AS CUST_PO_NUM
                , NULL AS PO_DT
                <!-- START 2018/04/16 A.Kosai [QC#20162,ADD] -->
                , NULL AS CUST_ISS_PO_DT
                <!-- END 2018/04/16 A.Kosai [QC#20162,ADD] -->
                , NULL AS MTR_READ_METH_CD
                , 'Y' AS PRICE_XX_EXST_FLG
                , 0 AS BASE_PRC_DEAL_AMT
                , NULL AS DS_ORD_POSN_NUM
                , NULL AS DS_CPO_CONFIG_PK
                , NULL AS MDSE_CD
                , NULL AS DPLY_LINE_NUM
                , NULL AS CPO_DTL_LINE_NUM
                , NULL AS CPO_DTL_LINE_SUB_NUM
                , NULL AS MDL_ID
                , NULL AS T_MDL_NM
                , NULL AS MDL_DESC_TXT
                , NULL AS SHIP_TO_SRCH_TXT
                , M.MDSE_DESC_SHORT_TXT
                , M.MDSE_DESC_LONG_TXT
                , PCT.PRC_SVC_CONTR_TP_DESC_TXT
                , PPT.PRC_SVC_PLN_TP_DESC_TXT
                , CC.DS_CONTR_CATG_DESC_TXT
                , BBC.BLLG_CYCLE_DESC_TXT AS BASE_BLLG_CYCLE_DESC_TXT
                , UBC.BLLG_CYCLE_DESC_TXT AS USG_BLLG_CYCLE_DESC_TXT
                , BBT.BILL_BY_TP_DESC_TXT
                , NULL AS MTR_READ_METH_DESC_TXT
                , DAC.DS_ACCT_NM
                , ( 
                    RPAD( 
                        BTC.FIRST_LINE_ADDR
                        , LENGTH(BTC.FIRST_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.SCD_LINE_ADDR
                        , LENGTH(BTC.SCD_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.THIRD_LINE_ADDR
                        , LENGTH(BTC.THIRD_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.FRTH_LINE_ADDR
                        , LENGTH(BTC.FRTH_LINE_ADDR) + 1
                    ) || CONCAT(BTC.CTY_ADDR, ',') || RPAD(BTC.ST_CD, LENGTH(BTC.ST_CD) + 1) || RPAD(BTC.POST_CD, LENGTH(BTC.POST_CD) + 1)
                 ) BILL_TO_SRCH_TXT
                , DC.BILL_TO_CUST_ACCT_CD
                <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                <!-- , DC.BILL_TO_CUST_ACCT_NM -->
                <!-- , DC.BILL_TO_CUST_LOC_ADDR -->
                , STC_B.DS_ACCT_NM            AS BILL_TO_CUST_ACCT_NM
                , RPAD(BTC_B.FIRST_LINE_ADDR, LENGTH(BTC_B.FIRST_LINE_ADDR) + 1)
                    || RPAD(BTC_B.SCD_LINE_ADDR, LENGTH(BTC_B.SCD_LINE_ADDR) + 1)
                    || RPAD(BTC_B.THIRD_LINE_ADDR, LENGTH(BTC_B.THIRD_LINE_ADDR) + 1)
                    || RPAD(BTC_B.FRTH_LINE_ADDR, LENGTH(BTC_B.FRTH_LINE_ADDR) + 1)
                    || CONCAT(BTC_B.CTY_ADDR, ',')
                    || RPAD(BTC_B.st_cd, LENGTH (BTC_B.ST_CD) + 1)
                    || BTC_B.POST_CD          AS BILL_TO_CUST_LOC_ADDR
                <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                , NULL AS BILL_TO_CUST_LOC_CD
                , NULL AS SHIP_TO_CUST_LOC_CD
                , NULL AS SVC_CONFIG_MSTR_PK
                , NULL AS CR_REBIL_CD
                , NULL AS PRC_BASE_DT
                , DC.DS_ORD_CATG_CD
                , DC.DS_ORD_TP_CD
                , DC.ORD_HDR_STS_CD
                , NULL AS SHPG_STS_CD
                <!-- START 2024/03/12 M.Kuroi [QC#63638,ADD] -->
                , NULL AS SHIP_FLG
                <!-- END 2024/03/12 M.Kuroi [QC#63638,ADD] -->
                --
                , C.MAN_CONTR_OVRD_FLG
                , C.PRC_SVC_CONTR_TP_CD
                , C.PRC_SVC_PLN_TP_CD
                , C.FIX_TERM_IN_MTH_AOT
                , C.BILL_BY_TP_CD
                --
                , 0 AS TOT_BASE_PRC_DEAL_AMT
                , C.BILL_WITH_EQUIP_FLG
                , C.FROM_PER_MTH_NUM
                , C.TO_PER_MTH_NUM
                , (C.TO_PER_MTH_NUM - C.FROM_PER_MTH_NUM + 1) AS TERM_MTH_AOT
                , NULL AS ADD_CONTR_FLG
                , NULL AS ADD_ASRY_FLG
                --
                , SM.SVC_MEMO_RSN_CD
                , SM.SVC_CMNT_TXT
                <!-- START 2018/05/07 [QC#22482, ADD] -->
                , SMR.SVC_MEMO_RSN_DESC_TXT
                <!-- END 2018/05/07 [QC#22482, ADD] -->
                --
                , (
                    CASE 
                        WHEN C.DS_CONTR_STS_CD &lt;&gt; #dsContrStsCd#
                        THEN 'Y'
                        ELSE 'N'
                    END
                  ) AS CONTR_AVAL_FLG
                --
            <!-- START 2017/08/31 [QC#20820, ADD] -->
                , NULL AS DS_ORD_POSN_NUM_SORT
            <!-- END   2017/08/31 [QC#20820, ADD] -->
                , C.EZUPTIME
                , C.EZUPTIMEZONE
                <!-- START 2018/07/02 T.Tomita [QC#26738,ADD] -->
                , DC.ORD_BOOK_FLG  AS ORD_BOOK_FLG
                <!-- END 2018/07/02 T.Tomita [QC#26738,ADD] -->
                <!-- START 2018/07/18 K.Kitachi [QC#26589, ADD] -->
                , C.INV_SEPT_BASE_USG_FLG
                <!-- END 2018/07/18 K.Kitachi [QC#26589, ADD] -->
            FROM
                <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                <!--   CPO_V                 DC -->
                  CPO                   DC
                <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
                , DS_CONTR              C
                , ALL_MDSE_V            M
                , DS_CONTR_CATG         CC
                , BLLG_CYCLE            BBC
                , BLLG_CYCLE            UBC
                , SELL_TO_CUST          DAC
                , BILL_TO_CUST          BTC
                , BILL_BY_TP            BBT
                , PRC_SVC_CONTR_TP      PCT
                , PRC_SVC_PLN_TP        PPT
                , SVC_MEMO              SM
                <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                , SELL_TO_CUST          STC_B
                , BILL_TO_CUST          BTC_B
                <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
                <!-- START 2018/05/07 [QC#22482, ADD] -->
                , SVC_MEMO_RSN          SMR
                <!-- END 2018/05/07 [QC#22482, ADD] -->
            WHERE
                    DC.GLBL_CMPY_CD           = #glblCmpyCd#
                AND DC.CPO_ORD_NUM            = #refCpoOrdNum#
                AND DC.EZCANCELFLAG           = '0'
                --
                AND DC.GLBL_CMPY_CD           = C.GLBL_CMPY_CD
                AND DC.CPO_ORD_NUM            = C.CPO_ORD_NUM
                AND C.DS_CONTR_NUM            IS NULL
                AND C.EZCANCELFLAG            = '0'
                --
                AND NOT EXISTS (
                    SELECT 
                        1
                    FROM
                        DS_CONTR_DTL CD
                    WHERE
                            CD.GLBL_CMPY_CD   = C.GLBL_CMPY_CD
                        AND CD.CPO_ORD_NUM    = C.CPO_ORD_NUM
                        AND CD.DS_CONTR_PK    = C.DS_CONTR_PK
                        AND CD.EZCANCELFLAG   = '0'
                    )
                --
                AND C.GLBL_CMPY_CD            = M.GLBL_CMPY_CD(+)
                AND C.SVC_PGM_MDSE_CD         = M.MDSE_CD(+)
                AND M.EZCANCELFLAG(+)         = '0'
                --
                AND C.GLBL_CMPY_CD            = CC.GLBL_CMPY_CD(+)
                AND C.DS_CONTR_CATG_CD        = CC.DS_CONTR_CATG_CD(+)
                AND CC.EZCANCELFLAG(+)        = '0'
                --
                AND C.GLBL_CMPY_CD            = BBC.GLBL_CMPY_CD(+)
                AND C.BASE_BLLG_CYCLE_CD      = BBC.BLLG_CYCLE_CD(+)
                AND BBC.EZCANCELFLAG(+)       = '0'
                --
                AND C.GLBL_CMPY_CD            = UBC.GLBL_CMPY_CD(+)
                AND C.MTR_BLLG_CYCLE_CD       = UBC.BLLG_CYCLE_CD(+)
                AND UBC.EZCANCELFLAG(+)       = '0'
                --
                AND C.GLBL_CMPY_CD            = DAC.GLBL_CMPY_CD(+)
                AND C.DS_ACCT_NUM             = DAC.SELL_TO_CUST_CD(+)
                AND DAC.EZCANCELFLAG(+)       = '0'
                --
                AND C.GLBL_CMPY_CD            = BTC.GLBL_CMPY_CD(+)
                AND C.ALT_PAYER_CUST_CD       = BTC.BILL_TO_CUST_CD(+)
                AND BTC.EZCANCELFLAG(+)       = '0'
                --
                AND C.GLBL_CMPY_CD            = BBT.GLBL_CMPY_CD(+)
                AND C.BILL_BY_TP_CD           = BBT.BILL_BY_TP_CD(+)
                AND BBT.EZCANCELFLAG(+)       = '0'
                --
                AND C.GLBL_CMPY_CD            = PCT.GLBL_CMPY_CD(+)
                AND C.PRC_SVC_CONTR_TP_CD     = PCT.PRC_SVC_CONTR_TP_CD(+)
                AND PCT.EZCANCELFLAG(+)       = '0'
                --
                AND C.GLBL_CMPY_CD            = PPT.GLBL_CMPY_CD(+)
                AND C.PRC_SVC_PLN_TP_CD       = PPT.PRC_SVC_PLN_TP_CD(+)
                AND PPT.EZCANCELFLAG(+)       = '0'
                --
                AND C.GLBL_CMPY_CD            = SM.GLBL_CMPY_CD(+)
                AND C.DS_CONTR_PK             = SM.DS_CONTR_PK(+)
                <!-- START 2017/07/28 [QC#20088, ADD] -->
                AND C.DS_CONTR_PK             = SM.DS_CONTR_PK(+)
                AND SM.SVC_MEMO_TP_CD(+)      = #svcMemoTpCd#
                AND SM.SVC_MEMO_TRX_NM(+)     = #svcMemoTrxNm#
                <!-- END   2017/07/28 [QC#20088, ADD] -->
                AND SM.EZCANCELFLAG(+)        = '0'
                <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                AND DC.GLBL_CMPY_CD           = STC_B.GLBL_CMPY_CD(+)
                AND DC.BILL_TO_CUST_ACCT_CD   = STC_B.SELL_TO_CUST_CD(+)
                AND STC_B.EZCANCELFLAG(+)     = '0'
                AND DC.GLBL_CMPY_CD           = BTC_B.GLBL_CMPY_CD(+)
                AND DC.BILL_TO_CUST_CD        = BTC_B.BILL_TO_CUST_CD(+)
                AND BTC_B.EZCANCELFLAG(+)     = '0'
                <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
                <!-- START 2018/05/07 [QC#22482, ADD] -->
                AND SM.GLBL_CMPY_CD           = SMR.GLBL_CMPY_CD(+)
                AND SM.SVC_MEMO_RSN_CD        = SMR.SVC_MEMO_RSN_CD(+)
                AND SMR.EZCANCELFLAG(+)       = '0'
                <!-- END 2018/05/07 [QC#22482, ADD] -->
            <!-- START 2017/08/28 [QC#20665, ADD] -->
            UNION
            SELECT
                  DC.CPO_ORD_NUM
                , C.DS_ACCT_NUM       AS SELL_TO_CUST_CD
                , C.ALT_PAYER_CUST_CD AS SOLD_TO_CUST_LOC_CD
                , NULL AS DS_CONTR_DTL_PK
                , C1.SHELL_LINE_NUM
                , C.SVC_PGM_MDSE_CD
                , C.DS_CONTR_CATG_CD
                , BBC.BLLG_CYCLE_CD AS BASE_BLLG_CYCLE_CD
                <!-- START 2018/01/30 [QC#23857, MOD] -->
                , NVL(UBC.BLLG_CYCLE_CD,BC.BLLG_CYCLE_CD) AS USG_BLLG_CYCLE_CD
                <!-- END 2018/01/30 [QC#23857, MOD] -->
                , C.CONTR_VRSN_EFF_FROM_DT
                , C.CONTR_VRSN_EFF_THRU_DT
                , C.CPO_SVC_AGMT_VER_NUM
                , C1.DS_CONTR_PK
                <!-- START 2017/08/29 [QC#20665, MOD] -->
                , C.DS_CONTR_PK AS DS_CONTR_PK_AD
                <!-- END   2017/08/29 [QC#20665, MOD] -->
                , C.DS_CONTR_NUM
                , C.APPLY_EQUIP_BILL_TO_FLG
                , NULL AS CUST_PO_NUM
                , NULL AS PO_DT
                <!-- START 2018/04/16 A.Kosai [QC#20162,ADD] -->
                , NULL AS CUST_ISS_PO_DT
                <!-- END 2018/04/16 A.Kosai [QC#20162,ADD] -->
                , NULL AS MTR_READ_METH_CD
                , 'Y' AS PRICE_XX_EXST_FLG
                , 0 AS BASE_PRC_DEAL_AMT
                , NULL AS DS_ORD_POSN_NUM
                , NULL AS DS_CPO_CONFIG_PK
                , NULL AS MDSE_CD
                , NULL AS DPLY_LINE_NUM
                , NULL AS CPO_DTL_LINE_NUM
                , NULL AS CPO_DTL_LINE_SUB_NUM
                , NULL AS MDL_ID
                , NULL AS T_MDL_NM
                , NULL AS MDL_DESC_TXT
                , NULL AS SHIP_TO_SRCH_TXT
                , M.MDSE_DESC_SHORT_TXT
                , M.MDSE_DESC_LONG_TXT
                , PCT.PRC_SVC_CONTR_TP_DESC_TXT
                , PPT.PRC_SVC_PLN_TP_DESC_TXT
                , CC.DS_CONTR_CATG_DESC_TXT
                , BBC.BLLG_CYCLE_DESC_TXT AS BASE_BLLG_CYCLE_DESC_TXT
                <!-- START 2018/01/30 [QC#23857, MOD] -->
                , NVL(UBC.BLLG_CYCLE_DESC_TXT,BC.BLLG_CYCLE_DESC_TXT) AS USG_BLLG_CYCLE_DESC_TXT
                <!-- END 2018/01/30 [QC#23857, MOD] -->
                , BBT.BILL_BY_TP_DESC_TXT
                , NULL AS MTR_READ_METH_DESC_TXT
                , DAC.DS_ACCT_NM
                , ( 
                    RPAD( 
                        BTC.FIRST_LINE_ADDR
                        , LENGTH(BTC.FIRST_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.SCD_LINE_ADDR
                        , LENGTH(BTC.SCD_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.THIRD_LINE_ADDR
                        , LENGTH(BTC.THIRD_LINE_ADDR) + 1
                    ) || RPAD( 
                        BTC.FRTH_LINE_ADDR
                        , LENGTH(BTC.FRTH_LINE_ADDR) + 1
                    ) || CONCAT(BTC.CTY_ADDR, ',') || RPAD(BTC.ST_CD, LENGTH(BTC.ST_CD) + 1) || RPAD(BTC.POST_CD, LENGTH(BTC.POST_CD) + 1)
                 ) BILL_TO_SRCH_TXT
                , DC.BILL_TO_CUST_ACCT_CD
                <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                <!-- , DC.BILL_TO_CUST_ACCT_NM -->
                <!-- , DC.BILL_TO_CUST_LOC_ADDR -->
                , STC_B.DS_ACCT_NM            AS BILL_TO_CUST_ACCT_NM
                , RPAD(BTC_B.FIRST_LINE_ADDR, LENGTH(BTC_B.FIRST_LINE_ADDR) + 1)
                    || RPAD(BTC_B.SCD_LINE_ADDR, LENGTH(BTC_B.SCD_LINE_ADDR) + 1)
                    || RPAD(BTC_B.THIRD_LINE_ADDR, LENGTH(BTC_B.THIRD_LINE_ADDR) + 1)
                    || RPAD(BTC_B.FRTH_LINE_ADDR, LENGTH(BTC_B.FRTH_LINE_ADDR) + 1)
                    || CONCAT(BTC_B.CTY_ADDR, ',')
                    || RPAD(BTC_B.st_cd, LENGTH (BTC_B.ST_CD) + 1)
                    || BTC_B.POST_CD          AS BILL_TO_CUST_LOC_ADDR
                <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                , NULL AS BILL_TO_CUST_LOC_CD
                , NULL AS SHIP_TO_CUST_LOC_CD
                , NULL AS SVC_CONFIG_MSTR_PK
                , NULL AS CR_REBIL_CD
                , NULL AS PRC_BASE_DT
                , DC.DS_ORD_CATG_CD
                , DC.DS_ORD_TP_CD
                , DC.ORD_HDR_STS_CD
                , NULL AS SHPG_STS_CD
                <!-- START 2024/03/12 M.Kuroi [QC#63638,ADD] -->
                , NULL AS SHIP_FLG
                <!-- END 2024/03/12 M.Kuroi [QC#63638,ADD] -->
                --
                , C.MAN_CONTR_OVRD_FLG
                <!-- mod start 2018/08/14 QC#23919 -->
                , C1.PRC_SVC_CONTR_TP_CD
                , C1.PRC_SVC_PLN_TP_CD
                <!-- mod end 2018/08/14 QC#23919 -->
                , C.FIX_TERM_IN_MTH_AOT
                <!-- mod start 2018/08/14 QC#23919 -->
                , C1.BILL_BY_TP_CD
                <!-- mod end 2018/08/14 QC#23919 -->
                --
                , 0 AS TOT_BASE_PRC_DEAL_AMT
                , C1.BILL_WITH_EQUIP_FLG
                , C1.FROM_PER_MTH_NUM
                , C1.TO_PER_MTH_NUM
                , (C1.TO_PER_MTH_NUM - C1.FROM_PER_MTH_NUM + 1) AS TERM_MTH_AOT
                , 'Y' AS ADD_CONTR_FLG
                , NULL AS ADD_ASRY_FLG
                --
                , SM.SVC_MEMO_RSN_CD
                , SM.SVC_CMNT_TXT
                <!-- START 2018/05/07 [QC#22482, ADD] -->
                , SMR.SVC_MEMO_RSN_DESC_TXT
                <!-- END 2018/05/07 [QC#22482, ADD] -->
                --
                <!-- START 2017/10/24 [QC#21656-1,MOD] -->
                , (
                    CASE 
                        WHEN C1.DS_CONTR_STS_CD &lt;&gt; #dsContrStsCd#
                        THEN 'Y'
                        ELSE 'N'
                    END
                  ) AS CONTR_AVAL_FLG
                <!-- END   2017/10/24 [QC#21656-1,MOD] -->
                --
            <!-- START 2017/08/31 [QC#20820, ADD] -->
                , NULL AS DS_ORD_POSN_NUM_SORT
            <!-- END   2017/08/31 [QC#20820, ADD] -->
                , C1.EZUPTIME
                , C1.EZUPTIMEZONE
                <!-- START 2018/07/02 T.Tomita [QC#26738,ADD] -->
                , DC.ORD_BOOK_FLG  AS ORD_BOOK_FLG
                <!-- END 2018/07/02 T.Tomita [QC#26738,ADD] -->
                <!-- START 2018/07/18 K.Kitachi [QC#26589, ADD] -->
                , C1.INV_SEPT_BASE_USG_FLG
                <!-- END 2018/07/18 K.Kitachi [QC#26589, ADD] -->
            FROM
                  CPO                   DC
                , DS_CONTR              C
                , DS_CONTR              C1
                , ALL_MDSE_V            M
                , DS_CONTR_CATG         CC
                , BLLG_CYCLE            BBC
                , BLLG_CYCLE            UBC
                , SELL_TO_CUST          DAC
                , BILL_TO_CUST          BTC
                , BILL_BY_TP            BBT
                , PRC_SVC_CONTR_TP      PCT
                , PRC_SVC_PLN_TP        PPT
                , SVC_MEMO              SM
                , SELL_TO_CUST          STC_B
                , BILL_TO_CUST          BTC_B
                <!-- START 2018/01/30 [QC#23857, ADD] -->
                , (
                    SELECT
                        *
                    FROM
                       (
                        SELECT
                            CD2.DS_CONTR_PK
                           ,UBC2.BLLG_CYCLE_CD
                           ,UBC2.BLLG_CYCLE_DESC_TXT
                        FROM
                             DS_CONTR               C2
                            ,DS_CONTR               C3
                            ,DS_CONTR_DTL           CD2
                            ,DS_CONTR_BLLG_MTR      CBM
                            ,BLLG_CYCLE             UBC2
                        WHERE
                                C3.GLBL_CMPY_CD            = #glblCmpyCd#
                            AND C3.CPO_ORD_NUM             = #refCpoOrdNum#
                            AND C3.DS_CONTR_STS_CD         = #dsContrStsCd#
                            AND C3.EZCANCELFLAG            = '0'
                            --
                            AND C2.GLBL_CMPY_CD            = C3.GLBL_CMPY_CD
                            AND C2.DS_CONTR_NUM            = C3.DS_CONTR_NUM
                            AND C2.DS_CONTR_STS_CD         &lt;&gt; #dsContrStsCd#
                            AND C2.EZCANCELFLAG            = '0'
                            --
                            AND NOT EXISTS (
                                SELECT 
                                    1
                                FROM
                                    DS_CONTR_DTL CD3
                                WHERE
                                        CD3.GLBL_CMPY_CD   = C2.GLBL_CMPY_CD
                                    AND CD3.CPO_ORD_NUM    = C2.CPO_ORD_NUM
                                    AND CD3.DS_CONTR_PK    = C2.DS_CONTR_PK
                                    AND CD3.EZCANCELFLAG   = '0'
                                )
                            AND C2.GLBL_CMPY_CD            = CD2.GLBL_CMPY_CD
                            AND CD2.EZCANCELFLAG           = '0'
                            AND C2.DS_CONTR_PK             = CD2.DS_CONTR_PK
                            --
                            AND CD2.GLBL_CMPY_CD           = CBM.GLBL_CMPY_CD
                            AND CD2.DS_CONTR_DTL_PK        = CBM.DS_CONTR_DTL_PK
                            AND CBM.EZCANCELFLAG           = '0'
                            --
                            AND CBM.GLBL_CMPY_CD           = UBC2.GLBL_CMPY_CD
                            AND UBC2.EZCANCELFLAG          = '0'
                            AND CBM.BLLG_MTR_BLLG_CYCLE_CD = UBC2.BLLG_CYCLE_CD
                        ORDER BY CBM.DS_CONTR_DTL_PK,CBM.BLLG_MTR_LB_CD
                       )     A
                    WHERE
                        ROWNUM = 1
                )   BC
                <!-- END 2018/01/30 [QC#23857, ADD] -->
                <!-- START 2018/05/07 [QC#22482, ADD] -->
                , SVC_MEMO_RSN          SMR
                <!-- END 2018/05/07 [QC#22482, ADD] -->
            WHERE
                    DC.GLBL_CMPY_CD           = #glblCmpyCd#
                AND DC.CPO_ORD_NUM            = #refCpoOrdNum#
                AND DC.EZCANCELFLAG           = '0'
                --
                AND DC.GLBL_CMPY_CD           = C1.GLBL_CMPY_CD
                AND DC.CPO_ORD_NUM            = C1.CPO_ORD_NUM
                AND C1.DS_CONTR_STS_CD        = #dsContrStsCd#
                AND C1.EZCANCELFLAG           = '0'
                --
                AND C.GLBL_CMPY_CD            = C1.GLBL_CMPY_CD
                AND C.DS_CONTR_NUM            = C1.DS_CONTR_NUM
                AND C.DS_CONTR_STS_CD &lt;&gt; #dsContrStsCd#
                AND C.EZCANCELFLAG            = '0'
                --
                AND NOT EXISTS (
                    SELECT 
                        1
                    FROM
                        DS_CONTR_DTL CD
                    WHERE
                            CD.GLBL_CMPY_CD   = C1.GLBL_CMPY_CD
                        AND CD.CPO_ORD_NUM    = C1.CPO_ORD_NUM
                        AND CD.DS_CONTR_PK    = C1.DS_CONTR_PK
                        AND CD.EZCANCELFLAG   = '0'
                    )
                --
                AND C.GLBL_CMPY_CD            = M.GLBL_CMPY_CD(+)
                AND C.SVC_PGM_MDSE_CD         = M.MDSE_CD(+)
                AND M.EZCANCELFLAG(+)         = '0'
                --
                AND C.GLBL_CMPY_CD            = CC.GLBL_CMPY_CD(+)
                AND C.DS_CONTR_CATG_CD        = CC.DS_CONTR_CATG_CD(+)
                AND CC.EZCANCELFLAG(+)        = '0'
                --
                AND C.GLBL_CMPY_CD            = BBC.GLBL_CMPY_CD(+)
                AND C.BASE_BLLG_CYCLE_CD      = BBC.BLLG_CYCLE_CD(+)
                AND BBC.EZCANCELFLAG(+)       = '0'
                --
                AND C.GLBL_CMPY_CD            = UBC.GLBL_CMPY_CD(+)
                AND C.MTR_BLLG_CYCLE_CD       = UBC.BLLG_CYCLE_CD(+)
                AND UBC.EZCANCELFLAG(+)       = '0'
                --
                AND C.GLBL_CMPY_CD            = DAC.GLBL_CMPY_CD(+)
                AND C.DS_ACCT_NUM             = DAC.SELL_TO_CUST_CD(+)
                AND DAC.EZCANCELFLAG(+)       = '0'
                --
                AND C.GLBL_CMPY_CD            = BTC.GLBL_CMPY_CD(+)
                AND C.ALT_PAYER_CUST_CD       = BTC.BILL_TO_CUST_CD(+)
                AND BTC.EZCANCELFLAG(+)       = '0'
                --
                AND C.GLBL_CMPY_CD            = BBT.GLBL_CMPY_CD(+)
                AND C.BILL_BY_TP_CD           = BBT.BILL_BY_TP_CD(+)
                AND BBT.EZCANCELFLAG(+)       = '0'
                --
                AND C.GLBL_CMPY_CD            = PCT.GLBL_CMPY_CD(+)
                AND C.PRC_SVC_CONTR_TP_CD     = PCT.PRC_SVC_CONTR_TP_CD(+)
                AND PCT.EZCANCELFLAG(+)       = '0'
                --
                AND C.GLBL_CMPY_CD            = PPT.GLBL_CMPY_CD(+)
                AND C.PRC_SVC_PLN_TP_CD       = PPT.PRC_SVC_PLN_TP_CD(+)
                AND PPT.EZCANCELFLAG(+)       = '0'
                --
                AND C.GLBL_CMPY_CD            = SM.GLBL_CMPY_CD(+)
                AND C.DS_CONTR_PK             = SM.DS_CONTR_PK(+)
                AND C.DS_CONTR_PK             = SM.DS_CONTR_PK(+)
                AND SM.SVC_MEMO_TP_CD(+)      = #svcMemoTpCd#
                AND SM.SVC_MEMO_TRX_NM(+)     = #svcMemoTrxNm#
                AND SM.EZCANCELFLAG(+)        = '0'
                AND DC.GLBL_CMPY_CD           = STC_B.GLBL_CMPY_CD(+)
                AND DC.BILL_TO_CUST_ACCT_CD   = STC_B.SELL_TO_CUST_CD(+)
                AND STC_B.EZCANCELFLAG(+)     = '0'
                AND DC.GLBL_CMPY_CD           = BTC_B.GLBL_CMPY_CD(+)
                AND DC.BILL_TO_CUST_CD        = BTC_B.BILL_TO_CUST_CD(+)
                AND BTC_B.EZCANCELFLAG(+)     = '0'
                <!-- START 2018/01/30 [QC#23857, ADD] -->
                AND C.DS_CONTR_PK             = BC.DS_CONTR_PK(+)
                <!-- END 2018/01/30 [QC#23857, ADD] -->
                <!-- START 2018/05/07 [QC#22482, ADD] -->
                AND SM.GLBL_CMPY_CD           = SMR.GLBL_CMPY_CD(+)
                AND SM.SVC_MEMO_RSN_CD        = SMR.SVC_MEMO_RSN_CD(+)
                AND SMR.EZCANCELFLAG(+)       = '0'
                <!-- END 2018/05/07 [QC#22482, ADD] -->
            <!-- END 2017/08/28 [QC#20665, ADD] -->
            ORDER BY
                  CPO_ORD_NUM
                , SHELL_LINE_NUM
            <!-- START 2017/08/31 [QC#20820, MOD] -->
            <!--, DS_ORD_POSN_NUM NULLS LAST      -->
                , DS_ORD_POSN_NUM_SORT NULLS LAST
            <!-- START 2017/08/31 [QC#20820, MOD] -->
                , CPO_DTL_LINE_NUM NULLS LAST
                , CPO_DTL_LINE_SUB_NUM NULLS LAST
    </statement>

    <statement id="existShellContr" parameterClass="Map" resultClass="Map">
        SELECT
                  CD.SHELL_LINE_NUM
                , DCD.DS_ORD_POSN_NUM
                , CD.DS_CONTR_DTL_PK
                , C.DS_CONTR_PK
                , DCD.CPO_ORD_NUM
                , DCD.CPO_DTL_LINE_NUM
                , DCD.CPO_DTL_LINE_SUB_NUM
                , DCD.SVC_CONFIG_MSTR_PK
                , C.CUST_PO_NUM
                , C.PO_DT
                , CD.MTR_READ_METH_CD
                , C.DS_CONTR_CATG_CD
                , CD.BILL_WITH_EQUIP_FLG
                , DCD.CR_REBIL_CD
            FROM
                <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                <!--   CPO_V             DC -->
                <!-- , CPO_DTL_V         DCD -->
                  CPO               DC
                , CPO_DTL           DCD
                <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
                , DS_CONTR_DTL      CD
                , DS_CONTR          C
            WHERE
                    DC.GLBL_CMPY_CD           = #glblCmpyCd#
                AND DC.CPO_ORD_NUM            = #cpoOrdNum#
                AND DC.EZCANCELFLAG           = '0'
                --
                AND DC.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
                AND DC.CPO_ORD_NUM            = DCD.CPO_ORD_NUM
                AND DCD.EZCANCELFLAG          = '0'
                <isNotNull property="dsOrdPosnNum">
                AND DCD.DS_ORD_POSN_NUM       = #dsOrdPosnNum#
                </isNotNull>
                --
                AND DCD.GLBL_CMPY_CD          = CD.GLBL_CMPY_CD
                AND DCD.CPO_ORD_NUM           = CD.CPO_ORD_NUM
                AND DCD.CPO_DTL_LINE_NUM      = CD.CPO_DTL_LINE_NUM
                AND DCD.CPO_DTL_LINE_SUB_NUM  = CD.CPO_DTL_LINE_SUB_NUM
                AND CD.SHELL_LINE_NUM         IS NOT NULL
                AND CD.EZCANCELFLAG           = '0'
                --
                AND CD.GLBL_CMPY_CD           = C.GLBL_CMPY_CD
                AND CD.DS_CONTR_PK            = C.DS_CONTR_PK
                AND C.EZCANCELFLAG            = '0'
        UNION
        SELECT
                  C.SHELL_LINE_NUM
                , NULL AS DS_ORD_POSN_NUM
                , NULL AS DS_CONTR_DTL_PK
                , C.DS_CONTR_PK
                , C.CPO_ORD_NUM
                , NULL AS CPO_DTL_LINE_NUM
                , NULL AS CPO_DTL_LINE_SUB_NUM
                , NULL AS SVC_CONFIG_MSTR_PK
                , C.CUST_PO_NUM
                , C.PO_DT
                , NULL AS MTR_READ_METH_CD
                , C.DS_CONTR_CATG_CD
                , C.BILL_WITH_EQUIP_FLG
                , NULL AS CR_REBIL_CD
            FROM
                <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                <!--   CPO_V             DC -->
                  CPO               DC
                <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
                , DS_CONTR          C
            WHERE
                    DC.GLBL_CMPY_CD           = #glblCmpyCd#
                AND DC.CPO_ORD_NUM            = #cpoOrdNum#
                AND DC.EZCANCELFLAG           = '0'
                --
                AND DC.GLBL_CMPY_CD           = C.GLBL_CMPY_CD
                AND DC.CPO_ORD_NUM            = C.CPO_ORD_NUM
                AND C.EZCANCELFLAG            = '0'
                --
                AND NOT EXISTS (
                    SELECT 
                        1
                    FROM
                        DS_CONTR_DTL CD
                    WHERE
                            CD.GLBL_CMPY_CD   = C.GLBL_CMPY_CD
                        AND CD.CPO_ORD_NUM    = C.CPO_ORD_NUM
                        AND CD.DS_CONTR_PK    = C.DS_CONTR_PK
                        AND CD.EZCANCELFLAG   = '0'
                    )
    </statement>

    <statement id="getSvcConfigRef" parameterClass="Map" resultClass="Map">
        <!-- START 2019/05/17 W.Honda [QC#50157,MOD] -->
        SELECT
                  SHELL_LINE_NUM
                , DS_ORD_POSN_NUM
                , DS_CONTR_DTL_PK
                , DS_CONTR_PK
                , CPO_ORD_NUM
                , CPO_DTL_LINE_NUM
                , CPO_DTL_LINE_SUB_NUM
                , SVC_CONFIG_MSTR_PK
                , CUST_PO_NUM
                , PO_DT
                , MTR_READ_METH_CD
                , DS_CONTR_CATG_CD
                , BILL_WITH_EQUIP_FLG
                , CR_REBIL_CD
            FROM
                (
                 SELECT
                        CD.SHELL_LINE_NUM
                      , DCD.DS_ORD_POSN_NUM
                      , CD.DS_CONTR_DTL_PK
                      , C.DS_CONTR_PK
                      , DCD.CPO_ORD_NUM
                      , DCD.CPO_DTL_LINE_NUM
                      , DCD.CPO_DTL_LINE_SUB_NUM
                      , DCD.SVC_CONFIG_MSTR_PK
                      , CCP.CUST_PO_NUM
                      , CCP.PO_DT
                      , CD.MTR_READ_METH_CD
                      , C.DS_CONTR_CATG_CD
                      , CD.BILL_WITH_EQUIP_FLG
                      , DCD.CR_REBIL_CD
                      , RANK() OVER(PARTITION BY CD.DS_CONTR_DTL_PK ORDER BY CCP.EZINTIME, CCP.DS_CONTR_CR_CARD_PO_PK) AS RANK
                  FROM
                      <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                      <!--   CPO_V               DC -->
                      <!-- , CPO_DTL_V           DCD -->
                        CPO                 DC
                      , CPO_DTL             DCD
                      <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
                      , DS_CPO_CONFIG       DCC
                      , DS_CONTR_DTL        CD
                      , DS_CONTR            C
                      , DS_CONTR_CR_CARD_PO CCP
                  WHERE
                          DC.GLBL_CMPY_CD           = #glblCmpyCd#
                      AND DC.CPO_ORD_NUM            = #cpoOrdNum#
                      AND DC.EZCANCELFLAG           = '0'
                      --
                      AND DC.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
                      AND DC.CPO_ORD_NUM            = DCD.CPO_ORD_NUM
                      AND DCD.EZCANCELFLAG          = '0'
                      --
                      AND DCD.GLBL_CMPY_CD          = DCC.GLBL_CMPY_CD
                      AND DCD.SVC_CONFIG_MSTR_PK    = DCC.SVC_CONFIG_MSTR_PK
                      AND DCC.EZCANCELFLAG          = '0'
                      --
                      AND DCD.GLBL_CMPY_CD          = CD.GLBL_CMPY_CD
                      AND DCD.CPO_ORD_NUM           = CD.CPO_ORD_NUM
                      AND DCD.CPO_DTL_LINE_NUM      = CD.CPO_DTL_LINE_NUM
                      AND DCD.CPO_DTL_LINE_SUB_NUM  = CD.CPO_DTL_LINE_SUB_NUM
                      AND CD.SHELL_LINE_NUM         IS NOT NULL
                      <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                      AND CD.DS_CONTR_CRAT_TP_CD   = #dsContrCratTp#
                      <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
                      AND CD.EZCANCELFLAG           = '0'
                      --
                      AND CD.GLBL_CMPY_CD           = C.GLBL_CMPY_CD
                      AND CD.DS_CONTR_PK            = C.DS_CONTR_PK
                      AND C.EZCANCELFLAG            = '0'
                      --
                      AND CD.GLBL_CMPY_CD           = CCP.GLBL_CMPY_CD(+)
                      AND CD.DS_CONTR_DTL_PK        = CCP.DS_CONTR_DTL_PK(+)
                      AND CCP.EZCANCELFLAG (+)      = '0'
                      <!-- START 2019/01/09 S.Kitamura [QC#26928,ADD] -->
                      AND CCP.DS_CONTR_MACH_LVL_NUM(+) = #lvlNum#
                      AND CCP.CR_CARD_FLG(+)        = 'N'
                      <!-- AND CCP.PO_FROM_DT(+)         &lt;= #slsDt# -->
                      <!-- AND CCP.PO_DT(+)              &gt;= #slsDt# -->
                      <!-- END 2019/01/09 S.Kitamura [QC#26928,ADD] -->
                )
            WHERE
                    RANK           = 1
            ORDER BY
                  CPO_DTL_LINE_NUM
                , CPO_DTL_LINE_SUB_NUM
            <!-- END 2019/05/17 W.Honda [QC#50157,MOD] -->
    </statement>

    <statement id="getRentalOrderCnt" parameterClass="Map" resultClass="Integer">
        SELECT
                  ( 
                    SELECT
                              COUNT(DC.GLBL_CMPY_CD) 
                        FROM
                            <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                            <!--   CPO_V DC -->
                              CPO              DC
                            <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
                            , ORD_CATG_BIZ_CTX BC 
                        WHERE
                            DC.GLBL_CMPY_CD           = #glblCmpyCd#
                            AND DC.CPO_ORD_NUM        = #cpoOrdNum#
                            AND DC.EZCANCELFLAG       = '0' 
                            AND DC.GLBL_CMPY_CD       = BC.GLBL_CMPY_CD 
                            AND BC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTpCd#
                            AND DC.DS_ORD_CATG_CD     = BC.DS_ORD_CATG_CD 
                            AND DC.DS_ORD_TP_CD       = BC.DS_ORD_TP_CD 
                            AND DC.DS_ORD_RSN_CD      = BC.DS_ORD_RSN_CD 
                            AND BC.EZCANCELFLAG       = '0'
                ) + ( 
                    SELECT
                              COUNT(DC.GLBL_CMPY_CD) 
                        FROM
                            <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                            <!--   CPO_V DC -->
                              CPO              DC
                            <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
                            , ORD_CATG_BIZ_CTX BC 
                        WHERE
                            DC.GLBL_CMPY_CD           = #glblCmpyCd#
                            AND DC.CPO_ORD_NUM        = #cpoOrdNum#
                            AND DC.EZCANCELFLAG       = '0' 
                            AND DC.GLBL_CMPY_CD       = BC.GLBL_CMPY_CD 
                            AND BC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTpCd#
                            AND DC.DS_ORD_CATG_CD     = BC.DS_ORD_CATG_CD 
                            AND DC.DS_ORD_TP_CD       = BC.DS_ORD_TP_CD 
                            AND BC.DS_ORD_RSN_CD     IS NULL 
                            AND BC.EZCANCELFLAG       = '0'
                ) + ( 
                    SELECT
                              COUNT(DC.GLBL_CMPY_CD) 
                        FROM
                            <!-- START 2017/07/12 K.Kojima [QC#19793,ADD] -->
                            <!--   CPO_V DC -->
                              CPO              DC
                            <!-- END 2017/07/12 K.Kojima [QC#19793,ADD] -->
                            , ORD_CATG_BIZ_CTX BC 
                        WHERE
                            DC.GLBL_CMPY_CD           = #glblCmpyCd#
                            AND DC.CPO_ORD_NUM        = #cpoOrdNum#
                            AND DC.EZCANCELFLAG       = '0' 
                            AND DC.GLBL_CMPY_CD       = BC.GLBL_CMPY_CD 
                            AND BC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTpCd#
                            AND DC.DS_ORD_CATG_CD     = BC.DS_ORD_CATG_CD 
                            AND BC.DS_ORD_TP_CD      IS NULL 
                            AND BC.DS_ORD_RSN_CD     IS NULL 
                            AND BC.EZCANCELFLAG       = '0'
                ) CNT 
            FROM
                DUAL
    </statement>

    <statement id="getAmount" parameterClass="Map" resultClass="Map">
    <!-- START 2019/01/18  K.Fujimoto [QC#29782, ADD] -->
    WITH SV_LINE_V AS (
           SELECT
                CD1.GLBL_CMPY_CD,
                CD1.DS_CONTR_DTL_PK,
                CD1.PRNT_DS_CONTR_DTL_PK,
                CD1.DS_CONTR_DTL_TP_CD,
                CD1.BASE_PRC_DEAL_AMT,
                CASE WHEN
                  EXISTS(
                     SELECT 
                         1
                     FROM 
                         DS_CONTR_DTL CD2
                     WHERE 
                         CD2.DS_CONTR_PK            = CD1.DS_CONTR_PK
                     AND CD2.DS_CONTR_DTL_PK &lt;&gt; CD1.DS_CONTR_DTL_PK
                     AND CD2.GLBL_CMPY_CD           = CD1.GLBL_CMPY_CD
                     AND CD2.EZCANCELFLAG           = '0'
                     AND CD2.CPO_ORD_NUM            = CD1.CPO_ORD_NUM
                     AND CD2.CPO_DTL_LINE_NUM       = CD1.CPO_DTL_LINE_NUM
                     AND CD2.CPO_DTL_LINE_SUB_NUM   = CD1.CPO_DTL_LINE_SUB_NUM
                     AND CD2.DS_CONTR_CRAT_TP_CD    = #dsContrCratTpOther#
                           )
                    OR CD1.DS_CONTR_CRAT_TP_CD = #dsContrCratTpSupply#
               THEN
                    0
               ELSE
                    CD1.RNTL_PRC_AMT
               END AS RNTL_PRC_AMT,
               CD1.EZCANCELFLAG,
               <!-- START 2019/02/26  K.Fujimoto [QC#30525, ADD] -->
               CD1.DS_CONTR_CRAT_TP_CD,
               CD1.DS_CONTR_PK
               <!-- START 2019/02/26  K.Fujimoto [QC#30525, ADD] -->
           FROM
                DS_CONTR_DTL CD1
           WHERE 
                CD1.GLBL_CMPY_CD        = #glblCmpyCd#
            AND CD1.CPO_ORD_NUM         = #cpoOrdNum#
            AND CD1.EZCANCELFLAG        = '0'
            AND CD1.DS_CONTR_CRAT_TP_CD IN (#dsContrCratTpShell#, #dsContrCratTpSupply#)
        )
        <!-- END   2019/01/18  K.Fujimoto [QC#29782, ADD] -->
        SELECT
                  WK_V.DS_CONTR_DTL_PK
                , (
                <!-- START 2018/08/07 W.Honda [QC#26325,MOD] -->
                    <!-- (WK_V.TOT_AMT_SV + WK_V.TOT_AMT_EQ + WK_V.TOT_AMT_AD) * MULTIPLY -->
                    (WK_V.TOT_AMT_SV + WK_V.TOT_AMT_EQ + WK_V.TOT_AMT_RT + WK_V.TOT_AMT_AD) * MULTIPLY
                <!-- END 2018/08/07 W.Honda [QC#26325,MOD] -->
                <!-- START 2018/04/16 A.Kosai [QC#10374,MOD] -->
                <!--   ) AS TOT_AMT_LN -->
                  ) AS TERM_AMT_TT
                <!-- END 2018/04/16 A.Kosai [QC#10374,MOD] -->
                , (
                    WK_V.TOT_AMT_SV * MULTIPLY
                <!-- START 2018/04/16 A.Kosai [QC#10374,MOD] -->
                <!--   ) AS TOT_AMT_SV -->
                  ) AS TERM_AMT_EQ
                <!-- START 2018/08/03 W.Honda [QC#26325,ADD] -->
                , (
                    WK_V.TOT_AMT_RT * MULTIPLY
                  ) AS TERM_AMT_RT
                <!-- END 2018/08/03 W.Honda [QC#26325,ADD] -->
                <!-- END 2018/04/16 A.Kosai [QC#10374,MOD] -->
                , (
                    WK_V.TOT_AMT_EQ * MULTIPLY
                <!-- START 2018/04/16 A.Kosai [QC#10374,MOD] -->
                <!--   ) AS TOT_AMT_EQ -->
                  ) AS TERM_AMT_AC
                <!-- END 2018/04/16 A.Kosai [QC#10374,MOD] -->
                , (
                    WK_V.TOT_AMT_AD * MULTIPLY
                <!-- START 2018/04/16 A.Kosai [QC#10374,MOD] -->
                <!--   ) AS TOT_AMT_AD -->
                  ) AS TERM_AMT_AD
                <!-- END 2018/04/16 A.Kosai [QC#10374,MOD] -->
                <!-- START 2018/04/16 A.Kosai [QC#10374,ADD] -->
                <!-- START 2018/08/07 W.Honda [QC#26325,MOD] -->
                <!-- , WK_V.TOT_AMT_SV + WK_V.TOT_AMT_EQ + WK_V.TOT_AMT_AD AS DEAL_AMT_TT -->
                , (
                    WK_V.TOT_AMT_SV + WK_V.TOT_AMT_EQ + WK_V.TOT_AMT_RT + WK_V.TOT_AMT_AD
                  ) AS DEAL_AMT_TT
                <!-- END 2018/08/07 W.Honda [QC#26325,MOD] -->
                , WK_V.TOT_AMT_SV                                     AS DEAL_AMT_EQ
                <!-- START 2018/08/03 W.Honda [QC#26325,ADD] -->
                , WK_V.TOT_AMT_RT                                     AS DEAL_AMT_RT
                <!-- END 2018/08/03 W.Honda [QC#26325,ADD] -->
                , WK_V.TOT_AMT_EQ                                     AS DEAL_AMT_AC
                , WK_V.TOT_AMT_AD                                     AS DEAL_AMT_AD
                , WK_V.MULTIPLY                                       AS MULTIPLY
                <!-- END 2018/04/16 A.Kosai [QC#10374,ADD] -->
        FROM (
            SELECT 
                      CD.DS_CONTR_DTL_PK
                    , CD.CPO_ORD_NUM
                    , CD.SHELL_LINE_NUM
                    , DCD.DS_ORD_POSN_NUM
                    , DCD.CPO_DTL_LINE_NUM
                    , DCD.CPO_DTL_LINE_SUB_NUM
                    , (
                          <!-- START 2019/02/26  K.Fujimoto [QC#30525, MOD] -->
                          SELECT
                            SUM(BASE_PRC_DEAL_AMT)
                          FROM
                          (
                             SELECT
                                 <!-- START 2018/03/14 M.Naito [QC#23378,MOD] -->
                                 <!-- NVL(CD1.BASE_PRC_DEAL_AMT, 0)  -->
                                 (
                                     CASE
                                         WHEN (CD1.BASE_PRC_DEAL_AMT IS NOT NULL AND CD1.BASE_PRC_DEAL_AMT != 0) THEN CD1.BASE_PRC_DEAL_AMT - NVL(CD1.RNTL_PRC_AMT, 0)
                                         ELSE NVL(CD1.BASE_PRC_DEAL_AMT, 0)
                                     END
                                 ) AS BASE_PRC_DEAL_AMT
                                 <!-- END 2018/03/14 M.Naito [QC#23378,MOD] -->
                             FROM
                                 <!-- START 2019/01/18  K.Fujimoto [QC#29782, MOD] -->
                                 SV_LINE_V CD1
                                 <!-- END   2019/01/18  K.Fujimoto [QC#29782, MOD] -->
                             WHERE 
                                 CD1.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                             <isNotEqual property="isFleet" compareValue="Y">
                             AND CD1.DS_CONTR_DTL_PK     = CD.DS_CONTR_DTL_PK
                             AND CD.DS_CONTR_DTL_TP_CD IN
                             <iterate property="dsContrDtlTpCdSv" var="dsContrDtlTpCdSv[]" open=" (" close=")" conjunction=",">
                                 #dsContrDtlTpCdSv[]#
                             </iterate>
                             </isNotEqual>
                             <isEqual property="isFleet" compareValue="Y">
                             AND CD1.DS_CONTR_PK         = CD.DS_CONTR_PK
                             AND CD1.DS_CONTR_DTL_TP_CD  = #dsContrDtlTpCdFleet#
                             </isEqual>
                             AND CD1.EZCANCELFLAG         = '0'
                             
                             UNION ALL
                             
                             SELECT
                                 NVL(SUM(CD1.BASE_PRC_DEAL_AMT), 0) - NVL(SUM(CD1.RNTL_PRC_AMT), 0) AS BASE_PRC_DEAL_AMT
                             FROM
                                  SV_LINE_V       CD1
                             WHERE 
                                 CD1.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                             AND CD1.PRNT_DS_CONTR_DTL_PK = CD.DS_CONTR_DTL_PK
                             AND CD1.DS_CONTR_DTL_TP_CD IN
                             <iterate property="dsContrDtlTpCdEq1" var="dsContrDtlTpCdEq1[]" open=" (" close=")" conjunction=",">
                                 #dsContrDtlTpCdEq1[]#
                             </iterate>
                             AND CD1.EZCANCELFLAG         = '0'
                             AND DS_CONTR_CRAT_TP_CD      = #dsContrCratTpSupply#
                             
                             UNION ALL
                             
                             SELECT
                                 NVL(SUM(CD1.BASE_PRC_DEAL_AMT), 0) - NVL(SUM(CD1.RNTL_PRC_AMT), 0) AS BASE_PRC_DEAL_AMT
                             FROM
                                  SV_LINE_V       CD1
                             WHERE 
                                 CD1.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                             AND CD1.DS_CONTR_DTL_PK      = CD.DS_CONTR_DTL_PK
                             AND CD1.DS_CONTR_DTL_TP_CD IN
                             <iterate property="dsContrDtlTpCdEq1" var="dsContrDtlTpCdEq1[]" open=" (" close=")" conjunction=",">
                                 #dsContrDtlTpCdEq1[]#
                             </iterate>
                             AND DS_CONTR_CRAT_TP_CD      = #dsContrCratTpSupply#
                             AND CD1.EZCANCELFLAG         = '0'
                          )
                      ) AS TOT_AMT_SV
                    , (
                          SELECT 
                              SUM(WK_EQ.TOT_AMT_EQ)
                          FROM (
                              SELECT
                                  <!-- START 2018/08/03 W.Honda [QC#26325,MOD] -->
                                  <!-- NVL(SUM(CD1.BASE_PRC_DEAL_AMT), 0) AS TOT_AMT_EQ -->
                                  NVL(SUM(CD1.BASE_PRC_DEAL_AMT), 0) - NVL(SUM(CD1.RNTL_PRC_AMT), 0) AS TOT_AMT_EQ
                                  <!-- END 2018/08/03 W.Honda [QC#26325,MOD] -->
                              FROM
                                   <!-- START 2019/01/18  K.Fujimoto [QC#29782, MOD] -->
                                   SV_LINE_V       CD1
                                   <!-- END   2019/01/18  K.Fujimoto [QC#29782, MOD] -->
                              WHERE 
                                  CD1.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                              AND CD1.PRNT_DS_CONTR_DTL_PK = CD.DS_CONTR_DTL_PK
                              AND CD1.DS_CONTR_DTL_TP_CD IN
                              <iterate property="dsContrDtlTpCdEq1" var="dsContrDtlTpCdEq1[]" open=" (" close=")" conjunction=",">
                                  #dsContrDtlTpCdEq1[]#
                              </iterate>
                              AND CD1.EZCANCELFLAG        = '0'
                              <!-- START 2019/02/26  K.Fujimoto [QC#30525, ADD] -->
                              AND DS_CONTR_CRAT_TP_CD   &lt;&gt;  #dsContrCratTpSupply#
                              <!-- END   2019/02/26  K.Fujimoto [QC#30525, ADD] -->
                              <!-- START 2018/06/19 K.Kojima [QC#26591, ADD] -->
                              UNION ALL
                              SELECT
                                  <!-- START 2018/06/22 K.Kojima [QC#26591, MOD] -->
                                  <!-- NVL(SUM(CD1.BASE_PRC_DEAL_AMT), 0) AS TOT_AMT_EQ -->
                                  NVL(SUM(CD1.BASE_PRC_DEAL_AMT), 0) - NVL(SUM(CD1.RNTL_PRC_AMT), 0) AS TOT_AMT_EQ
                                  <!-- END 2018/06/22 K.Kojima [QC#26591, MOD] -->
                              FROM
                                   <!-- START 2019/01/18  K.Fujimoto [QC#29782, MOD] -->
                                   SV_LINE_V       CD1
                                   <!-- END   2019/01/18  K.Fujimoto [QC#29782, MOD] -->
                              WHERE 
                                  CD1.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                              AND CD1.DS_CONTR_DTL_PK      = CD.DS_CONTR_DTL_PK
                              AND CD1.DS_CONTR_DTL_TP_CD IN
                              <iterate property="dsContrDtlTpCdEq1" var="dsContrDtlTpCdEq1[]" open=" (" close=")" conjunction=",">
                                  #dsContrDtlTpCdEq1[]#
                              </iterate>
                              <!-- START 2019/02/26  K.Fujimoto [QC#30525, ADD] -->
                              AND DS_CONTR_CRAT_TP_CD   &lt;&gt;  #dsContrCratTpSupply#
                              <!-- END   2019/02/26  K.Fujimoto [QC#30525, ADD] -->
                              AND CD1.EZCANCELFLAG        = '0'
                              <!-- END 2018/06/19 K.Kojima [QC#26591, ADD] -->
                              <!-- START 2018/08/03 W.Honda [QC#26325,DEL] -->
                              <!-- UNION ALL -->
                              <!-- START 2018/03/14 M.Naito [QC#23378,MOD] -->
                              <!-- SELECT
                                  NVL(SUM(CD1.RNTL_PRC_AMT), 0) AS TOT_AMT_EQ
                              FROM
                                   DS_CONTR_DTL       CD1
                              WHERE 
                                  CD1.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                              <isNotEqual property="isFleet" compareValue="Y">
                              AND CD1.DS_CONTR_DTL_PK      = CD.DS_CONTR_DTL_PK
                              </isNotEqual>
                              <isEqual property="isFleet" compareValue="Y">
                              AND (
                                      CD1.DS_CONTR_DTL_PK      = CD.DS_CONTR_DTL_PK
                                      OR
                                      CD1.PRNT_DS_CONTR_DTL_PK = CD.DS_CONTR_DTL_PK
                                  )
                              </isEqual>
                              AND CD1.EZCANCELFLAG         = '0' -->
                              <!-- SELECT
                                  NVL(SUM(AC1.ADDL_CHRG_FLAT_DEAL_PRC_AMT), 0) AS TOT_AMT_EQ
                              FROM
                                   DS_CONTR_DTL       CD1
                                  ,DS_CONTR_ADDL_CHRG AC1
                              WHERE 
                                  CD1.GLBL_CMPY_CD            = CD.GLBL_CMPY_CD
                              AND CD1.PRNT_DS_CONTR_DTL_PK    = CD.DS_CONTR_DTL_PK
                              AND CD1.DS_CONTR_DTL_TP_CD IN
                              <iterate property="dsContrDtlTpCdEq1" var="dsContrDtlTpCdEq1[]" open=" (" close=")" conjunction=",">
                                  #dsContrDtlTpCdEq1[]#
                              </iterate>
                              AND CD1.EZCANCELFLAG        = '0'
                              AND CD1.GLBL_CMPY_CD        = AC1.GLBL_CMPY_CD
                              AND CD1.DS_CONTR_DTL_PK     = AC1.DS_CONTR_DTL_PK
                              AND AC1.ADDL_CHRG_CATG_CD   = #addlChrgCatgCdEq#
                              AND AC1.EZCANCELFLAG        = '0'
                              UNION ALL
                              SELECT
                                  NVL(SUM(AC1.ADDL_CHRG_FLAT_DEAL_PRC_AMT), 0) AS TOT_AMT_EQ
                              FROM
                                   DS_CONTR_DTL       CD1
                                  ,DS_CONTR_ADDL_CHRG AC1
                              WHERE 
                                  CD1.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                              AND CD1.DS_CONTR_DTL_PK     = CD.DS_CONTR_DTL_PK
                              AND CD.DS_CONTR_DTL_TP_CD IN
                              <iterate property="dsContrDtlTpCdEq2" var="dsContrDtlTpCdEq2[]" open=" (" close=")" conjunction=",">
                                  #dsContrDtlTpCdEq2[]#
                              </iterate>
                              AND CD1.EZCANCELFLAG        = '0'
                              AND CD1.GLBL_CMPY_CD        = AC1.GLBL_CMPY_CD
                              AND CD1.DS_CONTR_DTL_PK     = AC1.DS_CONTR_DTL_PK
                              AND AC1.ADDL_CHRG_CATG_CD   = #addlChrgCatgCdEq#
                              AND AC1.EZCANCELFLAG        = '0' -->
                              <!-- END 2018/03/14 M.Naito [QC#23378,MOD] -->
                              <!-- END 2018/08/03 W.Honda [QC#26325,DEL] -->
                          ) WK_EQ
                      ) AS TOT_AMT_EQ
                    <!-- START 2018/08/03 W.Honda [QC#26325,ADD] -->
                    , (
                          SELECT 
                              SUM(WK_RT.TOT_AMT_RT)
                          FROM (
                              SELECT
                                  NVL(SUM(CD1.RNTL_PRC_AMT), 0) AS TOT_AMT_RT
                              FROM
                                  DS_CONTR_DTL       CD1
                              WHERE 
                                  CD1.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                              AND CD1.PRNT_DS_CONTR_DTL_PK = CD.DS_CONTR_DTL_PK
                              AND CD1.DS_CONTR_DTL_TP_CD IN
                              <iterate property="dsContrDtlTpCdEq1" var="dsContrDtlTpCdEq1[]" open=" (" close=")" conjunction=",">
                                  #dsContrDtlTpCdEq1[]#
                              </iterate>
                              AND CD1.DS_CONTR_CRAT_TP_CD &lt;&gt; #dsContrCratTpSupply#
                              AND CD1.EZCANCELFLAG         = '0'
                              UNION ALL
                              SELECT
                                  NVL(SUM(CD1.RNTL_PRC_AMT), 0) AS TOT_AMT_RT
                              FROM
                                   DS_CONTR_DTL       CD1
                              WHERE 
                                  CD1.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                              AND CD1.DS_CONTR_DTL_PK      = CD.DS_CONTR_DTL_PK
                              AND CD1.DS_CONTR_DTL_TP_CD IN
                              <iterate property="dsContrDtlTpCdEq1" var="dsContrDtlTpCdEq1[]" open=" (" close=")" conjunction=",">
                                  #dsContrDtlTpCdEq1[]#
                              </iterate>
                              AND CD1.DS_CONTR_CRAT_TP_CD &lt;&gt; #dsContrCratTpSupply#
                              AND CD1.EZCANCELFLAG         = '0'
                              UNION ALL
                              SELECT
                                  NVL(SUM(CD1.RNTL_PRC_AMT), 0) AS TOT_AMT_RT
                              FROM
                                  DS_CONTR_DTL       CD1
                              WHERE 
                                  CD1.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
                              AND CD1.DS_CONTR_DTL_TP_CD NOT IN
                              <iterate property="dsContrDtlTpCdEq1" var="dsContrDtlTpCdEq1[]" open=" (" close=")" conjunction=",">
                                  #dsContrDtlTpCdEq1[]#
                              </iterate>
                              <isNotEqual property="isFleet" compareValue="Y">
                              AND CD1.DS_CONTR_DTL_PK      = CD.DS_CONTR_DTL_PK
                              </isNotEqual>
                              <isEqual property="isFleet" compareValue="Y">
                              AND (
                                      CD1.DS_CONTR_DTL_PK      = CD.DS_CONTR_DTL_PK
                                      OR
                                      CD1.PRNT_DS_CONTR_DTL_PK = CD.DS_CONTR_DTL_PK
                                  )
                              </isEqual>
                              AND CD1.EZCANCELFLAG         = '0'
                          ) WK_RT
                      ) AS TOT_AMT_RT
                    <!-- END 2018/08/03 W.Honda [QC#26325,ADD] -->
                    , (
                          SELECT
                              NVL(SUM(AC1.ADDL_CHRG_FLAT_DEAL_PRC_AMT), 0)
                          FROM
                               DS_CONTR_DTL       CD1
                              ,DS_CONTR_ADDL_CHRG AC1
                          WHERE 
                              CD1.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                          AND CD1.DS_CONTR_DTL_PK     = CD.DS_CONTR_DTL_PK
                          AND CD.DS_CONTR_DTL_TP_CD IN
                          <iterate property="dsContrDtlTpCdAd" var="dsContrDtlTpCdAd[]" open=" (" close=")" conjunction=",">
                              #dsContrDtlTpCdAd[]#
                          </iterate>
                          AND CD1.EZCANCELFLAG        = '0'
                          AND CD1.GLBL_CMPY_CD        = AC1.GLBL_CMPY_CD
                          AND CD1.DS_CONTR_DTL_PK     = AC1.DS_CONTR_DTL_PK
                          AND AC1.ADDL_CHRG_CATG_CD   = #addlChrgCatgCdAd#
                          AND AC1.EZCANCELFLAG        = '0'
                      ) AS TOT_AMT_AD
                    , (
                        CASE 
                            WHEN C.BASE_BLLG_CYCLE_CD = #baseBllgCycleCd# THEN
                                (CD.TO_PER_MTH_NUM - CD.FROM_PER_MTH_NUM + 1)
                            ELSE
                                <!-- START 2017/06/13 K.Kojima [QC#19073, MOD] -->
                                <!-- (CD.TO_PER_MTH_NUM - CD.FROM_PER_MTH_NUM + 1) / NVL(BC.BLLG_CYCLE_AOT, 1) -->
                                (CD.TO_PER_MTH_NUM - CD.FROM_PER_MTH_NUM + 1) / NVL(BC.BLLG_CYCLE_MTH_AOT, 1)
                                <!-- END 2017/06/13 K.Kojima [QC#19073, MOD] -->
                        END
                      ) AS MULTIPLY
                FROM
                      DS_CONTR_DTL          CD
                    , DS_CONTR              C
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- , CPO_DTL_V             DCD -->
                    , CPO_DTL               DCD
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , BLLG_CYCLE            BC
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
                    AND CD.CPO_ORD_NUM              = DCD.CPO_ORD_NUM
                    AND CD.CPO_DTL_LINE_NUM         = DCD.CPO_DTL_LINE_NUM
                    AND CD.CPO_DTL_LINE_SUB_NUM     = DCD.CPO_DTL_LINE_SUB_NUM
                    AND CD.SHELL_LINE_NUM           IS NOT NULL
                    AND DCD.EZCANCELFLAG            = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND C.GLBL_CMPY_CD              = BC.GLBL_CMPY_CD(+)
                    AND C.BASE_BLLG_CYCLE_CD        = BC.BLLG_CYCLE_CD(+)
                    AND BC.EZCANCELFLAG(+)          = '0'
        ) WK_V
        ORDER BY
             WK_V.CPO_ORD_NUM
           , WK_V.SHELL_LINE_NUM
           , TO_NUMBER(WK_V.DS_ORD_POSN_NUM)
           , WK_V.CPO_DTL_LINE_NUM
           , WK_V.CPO_DTL_LINE_SUB_NUM
    </statement>

    <statement id="getDsContrDtlOtherCpoCount" parameterClass="Map" resultClass="Integer">
        SELECT
             COUNT(A.DS_CONTR_DTL_PK) AS COUNT
        FROM
             DS_CONTR_DTL         A
            ,DS_CONTR_DTL_STS_V   B
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND (  A.CPO_ORD_NUM &lt;&gt; #cpoOrdNum#
                OR A.CPO_ORD_NUM        IS NULL)
            AND A.DS_CONTR_PK           = #dsContrPk#
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK       = B.DS_CONTR_DTL_PK
            <iterate property="dsContrCtrlStsCdList" var="dsContrCtrlStsCd[]" open="AND B.DS_CONTR_CTRL_STS_CD NOT IN (" close=")" conjunction=",">
                #dsContrCtrlStsCd[]#
            </iterate>
            AND B.EZCANCELFLAG          = '0'
    </statement>

    <!-- START 2017/06/20 K.Kojima [QC#19053, ADD] -->
    <statement id="getAmountForNewLine" parameterClass="Map" resultClass="Map">
        SELECT
                  WK_V.DS_CONTR_DTL_PK
                , (
                    WK_V.TOT_AMT_SV * MULTIPLY
                <!-- START 2018/04/16 A.Kosai [QC#10374,MOD] -->
                <!--   ) AS TOT_AMT_LN -->
                  ) AS TERM_AMT_TT
                <!-- END 2018/04/16 A.Kosai [QC#10374,MOD] -->
                , (
                    WK_V.TOT_AMT_SV * MULTIPLY
                <!-- START 2018/04/16 A.Kosai [QC#10374,MOD] -->
                <!--   ) AS TOT_AMT_SV -->
                <!-- , 0 AS TOT_AMT_EQ -->
                <!-- , 0 AS TOT_AMT_AD -->
                  ) AS TERM_AMT_SV
                , 0 AS TERM_AMT_AC
                , 0 AS TERM_AMT_AD
                <!-- END 2018/04/16 A.Kosai [QC#10374,MOD] -->
                <!-- START 2018/04/16 A.Kosai [QC#10374,ADD] -->
                , WK_V.TOT_AMT_SV AS DEAL_AMT_TT
                , WK_V.TOT_AMT_SV AS DEAL_AMT_EQ
                , 0               AS DEAL_AMT_AC
                , 0               AS DEAL_AMT_AD
                , WK_V.MULTIPLY   AS MULTIPLY
                <!-- END 2018/04/16 A.Kosai [QC#10374,ADD] -->
        FROM (
            SELECT 
                      CD.DS_CONTR_DTL_PK
                    , CD.CPO_ORD_NUM
                    , CD.SHELL_LINE_NUM
                    , NVL(CD.BASE_PRC_DEAL_AMT, 0) AS TOT_AMT_SV
                    , 0 AS TOT_AMT_EQ
                    , 0 AS TOT_AMT_AD
                    , (
                        CASE 
                            WHEN C.BASE_BLLG_CYCLE_CD = #baseBllgCycleCd# THEN
                                (CD.TO_PER_MTH_NUM - CD.FROM_PER_MTH_NUM + 1)
                            ELSE
                                (CD.TO_PER_MTH_NUM - CD.FROM_PER_MTH_NUM + 1) / NVL(BC.BLLG_CYCLE_MTH_AOT, 1)
                        END
                      ) AS MULTIPLY
                FROM
                      DS_CONTR_DTL          CD
                    , DS_CONTR              C
                    , BLLG_CYCLE            BC
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.SHELL_LINE_NUM           = #shellLineNum#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpShell#
                    AND CD.MDL_ID                   = #mdlId#
                    AND CD.EZCANCELFLAG             = '0'
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND C.EZCANCELFLAG              = '0'
                    AND C.GLBL_CMPY_CD              = BC.GLBL_CMPY_CD(+)
                    AND C.BASE_BLLG_CYCLE_CD        = BC.BLLG_CYCLE_CD(+)
                    AND BC.EZCANCELFLAG(+)          = '0'
        ) WK_V
    </statement>

    <statement id="getInitDataFromModelPricingHeader" parameterClass="Map" resultClass="Map">
        SELECT
                  WK_V.DS_CONTR_DTL_PK
                , WK_V.MDL_ID
                , WK_V.T_MDL_NM
                , (
                    SELECT COUNT(1)
                        FROM DS_CONTR_DTL CD1
                    WHERE   
                            CD1.GLBL_CMPY_CD        = WK_V.GLBL_CMPY_CD
                        AND CD1.DS_CONTR_PK         = WK_V.DS_CONTR_PK
                        AND CD1.CPO_ORD_NUM         = WK_V.CPO_ORD_NUM
                    <isNotEqual property="isFleet" compareValue="Y">
                        AND CD1.MDL_ID              = WK_V.MDL_ID
                    </isNotEqual>
                        AND CD1.DS_CONTR_DTL_TP_CD IN
                        <iterate property="dsContrDtlTpCdMac" var="dsContrDtlTpCdMac[]" open=" (" close=")" conjunction=",">
                                #dsContrDtlTpCdMac[]#
                        </iterate>
                        AND CD1.EZCANCELFLAG        = '0'
                  ) AS MDL_QTY
                , WK_V.SVC_PRC_CATG_CD
                , WK_V.PRC_CATG_CD
                , WK_V.PRC_CATG_NM
                , WK_V.PRC_LIST_TP_CD
                , WK_V.PRC_MTR_PKG_PK
                , WK_V.PRC_MTR_PKG_NM
                , CASE
                      WHEN
                          EXISTS
                              (SELECT 1 
                                  FROM    CONTR_XS_COPY            CXC 
                                         ,DS_CONTR_BLLG_MTR        CBM
                                  WHERE   CXC.GLBL_CMPY_CD         = CBM.GLBL_CMPY_CD
                                  AND     CXC.DS_CONTR_BLLG_MTR_PK = CBM.DS_CONTR_BLLG_MTR_PK
                                  AND     CXC.XS_MTR_FIRST_FLG     = #xsMtrFirstFlgN#
                                  AND     CXC.EZCANCELFLAG         = '0'
                                  AND     CBM.GLBL_CMPY_CD         = WK_V.GLBL_CMPY_CD
                                  AND     CBM.DS_CONTR_DTL_PK      = WK_V.DS_CONTR_DTL_PK
                                  AND     CBM.EZCANCELFLAG         = '0')
                      THEN
                          WK_V.PRC_TIER_SVC_OFFER_CD
                      ELSE
                          NULL
                  END AS PRC_TIER_SVC_OFFER_CD
                , WK_V.BASE_PRC_DEAL_AMT
                , (WK_V.TO_PER_MTH_NUM - WK_V.FROM_PER_MTH_NUM + 1) AS TERM_MTH_AOT
                , (
                    CASE 
                        WHEN WK_V.DS_CONTR_STS_CD &lt;&gt; #dsContrStsCd#
                        THEN 'Y'
                        ELSE 'N'
                    END
                  ) AS CONTR_CRAT_FLG
                , (
                    CASE 
                        WHEN WK_V.DS_CONTR_STS_CD &lt;&gt; #dsContrStsCd#
                        THEN 'N'
                        --
                        WHEN WK_V.ORD_LINE_STS_CD &gt;= #ordLineStsPartiallyShipped#
                        THEN 'N'
                        --
                        WHEN EXISTS (
                            SELECT
                                      1
                                FROM
                                      DS_CPO_CONFIG_V   CV
                                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                                    <!-- , CPO_DTL_V         DV -->
                                    , CPO_DTL           DV
                                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                                    , SHPG_PLN          SP
                                WHERE
                                    CV.GLBL_CMPY_CD             = #glblCmpyCd#
                                    AND CV.CPO_ORD_NUM          = #cpoOrdNum#
                                    AND CV.MDL_ID               = WK_V.MDL_ID
                                    AND CV.EZCANCELFLAG         = '0'
                                    AND CV.GLBL_CMPY_CD         = DV.GLBL_CMPY_CD
                                    AND CV.DS_CPO_CONFIG_PK     = DV.DS_CPO_CONFIG_PK
                                    AND CV.DS_ORD_POSN_NUM      = DV.DS_ORD_POSN_NUM
                                    AND DV.BASE_CMPT_FLG        = 'Y'
                                    <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                    AND DV.ORD_LINE_STS_CD &lt;&gt; #ordLineStsCancelled#
                                    <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                    AND DV.EZCANCELFLAG         = '0'
                                     
                                    AND DV.GLBL_CMPY_CD         = SP.GLBL_CMPY_CD
                                    AND DV.CPO_ORD_NUM          = SP.TRX_HDR_NUM
                                    AND DV.CPO_DTL_LINE_NUM     = SP.TRX_LINE_NUM
                                    AND DV.CPO_DTL_LINE_SUB_NUM = SP.TRX_LINE_SUB_NUM
                                    AND SP.SHPG_STS_CD      &gt;= #shpgStsArrived#
                                    <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                    AND SP.SHPG_STS_CD   &lt;&gt; #shpgStsCancelled#
                                    <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                                    AND SP.EZCANCELFLAG         = '0'
                        ) 
                        THEN 'N'
                        --
                        ELSE 'Y'
                    END
                  ) AS SCR_ENT_AVAL_FLG
        FROM (
            SELECT
                      CD.DS_CONTR_DTL_PK
                    , CD.MDL_ID
                    , MN.T_MDL_NM
                    , CD.SVC_PRC_CATG_CD
                    , CD.PRC_CATG_CD
                    , PC.PRC_CATG_NM
                    , PC.PRC_LIST_TP_CD
                    , CD.PRC_MTR_PKG_PK
                    , PMP.PRC_MTR_PKG_NM
                    , TSO.PRC_TIER_SVC_OFFER_CD
                    , CD.BASE_PRC_DEAL_AMT
                    , CD.FROM_PER_MTH_NUM 
                    , CD.TO_PER_MTH_NUM
                    , C.DS_CONTR_STS_CD
                    , MAX(DCD.ORD_LINE_STS_CD)  ORD_LINE_STS_CD
                    , C.DS_CONTR_PK
                    , DCD.CPO_ORD_NUM
                    , CD.GLBL_CMPY_CD
                FROM
                      DS_CONTR_DTL          CD
                    , DS_CONTR              C
                    <!-- START 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    <!-- , CPO_DTL_V             DCD -->
                    , CPO_DTL               DCD
                    <!-- END 2017/07/12 K.Kojima [QC#19793,MOD] -->
                    , DS_CONTR_BLLG_MTR     CBM
                    , MDL_NM                MN
                    , ALL_MDSE_V            AMV
                    , PRC_MTR_PKG           PMP
                    , PRC_CATG              PC
                    , XS_CHRG_TP            XCT
                    , PRC_TIER_SVC_OFFER    TSO
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.SHELL_LINE_NUM           = #shellLineNum#
                    <isNotEqual property="isFleet" compareValue="Y">
                    AND CD.MDL_ID                   = #mdlId#
                    </isNotEqual>
                    AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCd#
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
                    AND CD.CPO_ORD_NUM              = DCD.CPO_ORD_NUM
                    <!-- START 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                    AND DCD.ORD_LINE_STS_CD  &lt;&gt; #ordLineStsCancelled#
                    <!-- END 2019/10/10 K.Kitachi [QC#54074, ADD] -->
                    AND DCD.EZCANCELFLAG            = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = PMP.GLBL_CMPY_CD(+)
                    AND CD.PRC_MTR_PKG_PK           = PMP.PRC_MTR_PKG_PK(+)
                    AND PMP.EZCANCELFLAG(+)         = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD(+)
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK(+)
                    AND CBM.EZCANCELFLAG(+)         = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = MN.T_GLBL_CMPY_CD(+)
                    AND CD.MDL_ID                   = MN.T_MDL_ID(+)
                    AND MN.EZCANCELFLAG(+)          = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = AMV.GLBL_CMPY_CD(+)
                    AND CD.SVC_PGM_MDSE_CD          = AMV.MDSE_CD(+)
                    AND AMV.EZCANCELFLAG(+)         = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = PC.GLBL_CMPY_CD(+)
                    AND CD.PRC_CATG_CD              = PC.PRC_CATG_CD(+)
                    AND PC.EZCANCELFLAG(+)          = '0'
                    --
                    AND CBM.GLBL_CMPY_CD            = XCT.GLBL_CMPY_CD(+)
                    AND CBM.XS_CHRG_TP_CD           = XCT.XS_CHRG_TP_CD(+)
                    AND XCT.EZCANCELFLAG(+)         = '0'
                    --
                    AND XCT.GLBL_CMPY_CD            = TSO.GLBL_CMPY_CD(+)
                    AND XCT.PRC_TIER_SVC_OFFER_CD   = TSO.PRC_TIER_SVC_OFFER_CD(+)
                    AND TSO.EZCANCELFLAG(+)         = '0'
                GROUP BY
                      CD.DS_CONTR_DTL_PK
                    , CD.MDL_ID
                    , MN.T_MDL_NM
                    , CD.SVC_PRC_CATG_CD
                    , CD.PRC_CATG_CD
                    , PC.PRC_CATG_NM
                    , PC.PRC_LIST_TP_CD
                    , CD.PRC_MTR_PKG_PK
                    , PMP.PRC_MTR_PKG_NM
                    , TSO.PRC_TIER_SVC_OFFER_CD
                    , CD.BASE_PRC_DEAL_AMT
                    , CD.FROM_PER_MTH_NUM 
                    , CD.TO_PER_MTH_NUM
                    , C.DS_CONTR_STS_CD
                    , C.DS_CONTR_PK
                    , DCD.CPO_ORD_NUM
                    , CD.GLBL_CMPY_CD
        ) WK_V
        ORDER BY
            WK_V.MDL_ID
    </statement>

    <statement id="getInitDataFromModelPricingDetail" parameterClass="Map" resultClass="Map">
        SELECT
                  WK_V.DS_CONTR_DTL_PK
                , WK_V.DS_CONTR_BLLG_MTR_PK
                , WK_V.CONTR_PHYS_BLLG_MTR_RELN_PK
                , WK_V.CONTR_XS_COPY_PK
                , WK_V.MDL_ID
                , WK_V.T_MDL_NM
                , WK_V.PRC_CATG_CD
                , WK_V.PRC_LIST_BAND_CD
                , WK_V.PRC_LIST_BAND_DESC_TXT
                , WK_V.PRC_BOOK_MDSE_CD
                , WK_V.BLLG_MTR_LB_CD
                , WK_V.BLLG_MTR_LB_DESC_TXT
                , WK_V.REG_MTR_LB_CD
                , WK_V.REG_MTR_LB_DESC_TXT
                , WK_V.CONTR_MTR_MULT_RATE
                , WK_V.XS_MTR_COPY_QTY
                , WK_V.MAX_COPY_VOL_CNT
                , WK_V.XS_MTR_AMT_RATE
                , WK_V.DS_ACCT_NM
                , WK_V.SELL_TO_CUST_CD
                , WK_V.BILL_TO_SRCH_TXT
                , WK_V.BILL_TO_CUST_CD
                , WK_V.INTG_MDSE_CD
                , WK_V.REG_MTR_LB_SORT_NUM
                , WK_V.PRC_SVC_TIER_TP_CD
                , WK_V.PRC_SVC_TIER_TP_DESC_TXT
                , WK_V.PRC_SVC_TIER_TP_SORT_NUM
                , WK_V.ACTV_FLG
                , WK_V.XX_FLG_NM
                <!-- 2018/05/09 QC#25030 add start -->
                , WK_V.BLLG_FREE_COPY_CNT
                , WK_V.BLLG_MIN_CNT
                , WK_V.BLLG_MIN_AMT_RATE
                , WK_V.BLLG_ROLL_OVER_RATIO
                <!-- 2018/05/09 QC#25030 add end -->
                
        FROM (
            SELECT DISTINCT
                      CD.DS_CONTR_DTL_PK
                    , CBM.DS_CONTR_BLLG_MTR_PK
                    , NULL AS CONTR_PHYS_BLLG_MTR_RELN_PK
                    , CXC.CONTR_XS_COPY_PK
                    , CD.MDL_ID
                    , MN.T_MDL_NM
                    , CD.PRC_CATG_CD
                    , CBM.PRC_LIST_BAND_CD
                    , PLB.PRC_LIST_BAND_DESC_TXT
                    , CBM.PRC_BOOK_MDSE_CD
                    , MLB.MTR_LB_CD AS BLLG_MTR_LB_CD
                    , MLB.MTR_LB_DESC_TXT AS BLLG_MTR_LB_DESC_TXT
                    , NULL AS REG_MTR_LB_CD
                    , NULL AS REG_MTR_LB_DESC_TXT
                    , NULL AS CONTR_MTR_MULT_RATE
                    , CXC.XS_MTR_COPY_QTY
                    , CXC.MAX_COPY_VOL_CNT
                    , CXC.XS_MTR_AMT_RATE
                    , DAC.DS_ACCT_NM
                    , CBM.SELL_TO_CUST_CD
                    , (
                        RPAD( 
                            BTC.FIRST_LINE_ADDR
                            , LENGTH(BTC.FIRST_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.SCD_LINE_ADDR
                            , LENGTH(BTC.SCD_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.THIRD_LINE_ADDR
                            , LENGTH(BTC.THIRD_LINE_ADDR) + 1
                        ) || RPAD( 
                            BTC.FRTH_LINE_ADDR
                            , LENGTH(BTC.FRTH_LINE_ADDR) + 1
                        ) || CONCAT(BTC.CTY_ADDR, ',') || RPAD(BTC.ST_CD, LENGTH(BTC.ST_CD) + 1) || RPAD(BTC.POST_CD, LENGTH(BTC.POST_CD) + 1)
                      ) AS BILL_TO_SRCH_TXT
                    , CBM.BLLG_MTR_BILL_TO_CUST_CD AS BILL_TO_CUST_CD
                    , CBM.INTG_MDSE_CD
                    , NULL AS REG_MTR_LB_SORT_NUM
                    , CXC.PRC_SVC_TIER_TP_CD
                    , PTT.PRC_SVC_TIER_TP_DESC_TXT
                    , PTT.PRC_SVC_TIER_TP_SORT_NUM
                    , CBR.ACTV_FLG
                    , #flgNmP# AS XX_FLG_NM
                    , 1 AS SORT_NUM
                    <!-- 2018/05/09 QC#25030 add start -->
                    , CBM.BLLG_FREE_COPY_CNT
                    , CBM.BLLG_MIN_CNT
                    , CBM.BLLG_MIN_AMT_RATE
                    , CBM.BLLG_ROLL_OVER_RATIO
                   <!-- 2018/05/09 QC#25030 add end -->
                FROM
                      DS_CONTR_DTL              CD
                    , DS_CONTR                  C
                    , DS_CONTR_BLLG_MTR         CBM
                    , CONTR_PHYS_BLLG_MTR_RELN  CBR
                    , CONTR_XS_COPY             CXC
                    , MDL_NM                    MN
                    , PRC_LIST_BAND             PLB
                    , MTR_LB                    MLB
                    , SELL_TO_CUST              DAC
                    , BILL_TO_CUST              BTC
                    , PRC_SVC_TIER_TP           PTT
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.SHELL_LINE_NUM           = #shellLineNum#
                    <isNotEqual property="isFleet" compareValue="Y">
                    AND CD.MDL_ID                   = #mdlId#
                    </isNotEqual>
                    AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCd#
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = MN.T_GLBL_CMPY_CD(+)
                    AND CD.MDL_ID                   = MN.T_MDL_ID(+)
                    AND MN.EZCANCELFLAG(+)          = '0'
                    --
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG            = '0'
                    --
                    AND CBM.PRC_LIST_BAND_CD        = PLB.PRC_LIST_BAND_CD(+)
                    AND CBM.GLBL_CMPY_CD            = PLB.GLBL_CMPY_CD(+)
                    AND PLB.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = MLB.MTR_LB_CD(+)
                    AND CBM.GLBL_CMPY_CD            = MLB.GLBL_CMPY_CD(+)
                    AND MLB.EZCANCELFLAG(+)         = '0'
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            PRC_MTR_PKG_BLLG_MTR PBM
                        WHERE
                                PBM.GLBL_CMPY_CD    = CD.GLBL_CMPY_CD
                            AND PBM.PRC_MTR_PKG_PK  = CD.PRC_MTR_PKG_PK
                            AND PBM.MTR_LB_CD       = MLB.MTR_LB_CD
                            AND PBM.EZCANCELFLAG    = '0'
                    )
                    --
                    AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
                    AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                    AND CBR.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.DS_CONTR_BLLG_MTR_PK    = CXC.DS_CONTR_BLLG_MTR_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CXC.GLBL_CMPY_CD(+)
                    AND CXC.XS_MTR_FIRST_FLG        = #xsMtrFirstFlg# -- 'Y'
                    AND CXC.EZCANCELFLAG(+)         = '0'
                    --
                    AND CD.SELL_TO_CUST_CD          = DAC.SELL_TO_CUST_CD(+)
                    AND CD.GLBL_CMPY_CD             = DAC.GLBL_CMPY_CD(+)
                    AND DAC.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_BILL_TO_CUST_CD = BTC.BILL_TO_CUST_CD(+)
                    AND CBM.GLBL_CMPY_CD             = BTC.GLBL_CMPY_CD(+)
                    AND BTC.EZCANCELFLAG(+)          = '0'
                    --
                    AND CXC.GLBL_CMPY_CD            = PTT.GLBL_CMPY_CD(+)
                    AND CXC.PRC_SVC_TIER_TP_CD      = PTT.PRC_SVC_TIER_TP_CD(+)
                    AND PTT.EZCANCELFLAG(+)         = '0'
            UNION ALL
            SELECT
                      CD.DS_CONTR_DTL_PK
                    , CBM.DS_CONTR_BLLG_MTR_PK
                    , CBR.CONTR_PHYS_BLLG_MTR_RELN_PK
                    , NULL AS CONTR_XS_COPY_PK
                    , CD.MDL_ID
                    , MN.T_MDL_NM
                    , CD.PRC_CATG_CD
                    , CBM.PRC_LIST_BAND_CD
                    , PLB.PRC_LIST_BAND_DESC_TXT
                    , CBM.PRC_BOOK_MDSE_CD
                    , MLB.MTR_LB_CD AS BLLG_MTR_LB_CD
                    , MLB.MTR_LB_DESC_TXT AS BLLG_MTR_LB_DESC_TXT
                    , CBR.REG_MTR_LB_CD
                    , MLP.MTR_LB_DESC_TXT AS REG_MTR_LB_DESC_TXT
                    , CBR.CONTR_MTR_MULT_RATE
                    , NULL AS XS_MTR_COPY_QTY
                    , NULL AS MAX_COPY_VOL_CNT
                    , NULL AS XS_MTR_AMT_RATE
                    , NULL AS DS_ACCT_NM
                    , NULL AS BILL_TO_CUST_CD
                    , NULL AS BILL_TO_SRCH_TXT
                    , NULL AS BILL_TO_LOC_NUM
                    , CBM.INTG_MDSE_CD
                    , MLP.MTR_LB_SORT_NUM AS REG_MTR_LB_SORT_NUM
                    , NULL AS PRC_SVC_TIER_TP_CD
                    , NULL AS PRC_SVC_TIER_TP_DESC_TXT
                    , NULL AS PRC_SVC_TIER_TP_SORT_NUM
                    , CBR.ACTV_FLG
                    , #flgNmH# AS XX_FLG_NM
                    , 2 AS SORT_NUM
                    <!-- 2018/05/09 QC#25030 add start -->
                    , CBM.BLLG_FREE_COPY_CNT
                    , CBM.BLLG_MIN_CNT
                    , CBM.BLLG_MIN_AMT_RATE
                    , CBM.BLLG_ROLL_OVER_RATIO
                   <!-- 2018/05/09 QC#25030 add end -->
                FROM
                      DS_CONTR_DTL              CD
                    , DS_CONTR                  C
                    , DS_CONTR_BLLG_MTR         CBM
                    , CONTR_PHYS_BLLG_MTR_RELN  CBR
                    , MDL_NM                    MN
                    , PRC_LIST_BAND             PLB
                    , MTR_LB                    MLB
                    , MTR_LB                    MLP
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.SHELL_LINE_NUM           = #shellLineNum#
                    <isNotEqual property="isFleet" compareValue="Y">
                    AND CD.MDL_ID                   = #mdlId#
                    </isNotEqual>
                    AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCd#
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.GLBL_CMPY_CD             = MN.T_GLBL_CMPY_CD(+)
                    AND CD.MDL_ID                   = MN.T_MDL_ID(+)
                    AND MN.EZCANCELFLAG(+)          = '0'
                    --
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG            = '0'
                    --
                    AND CBM.PRC_LIST_BAND_CD        = PLB.PRC_LIST_BAND_CD(+)
                    AND CBM.GLBL_CMPY_CD            = PLB.GLBL_CMPY_CD(+)
                    AND PLB.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = MLB.MTR_LB_CD(+)
                    AND CBM.GLBL_CMPY_CD            = MLB.GLBL_CMPY_CD(+)
                    AND MLB.EZCANCELFLAG(+)         = '0'
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            PRC_MTR_PKG_BLLG_MTR PBM
                        WHERE
                                PBM.GLBL_CMPY_CD    = CD.GLBL_CMPY_CD
                            AND PBM.PRC_MTR_PKG_PK  = CD.PRC_MTR_PKG_PK
                            AND PBM.MTR_LB_CD       = MLB.MTR_LB_CD
                            AND PBM.EZCANCELFLAG    = '0'
                    )
                    --
                    AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
                    AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                    AND CBR.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBR.REG_MTR_LB_CD           = MLP.MTR_LB_CD(+)
                    AND CBR.GLBL_CMPY_CD            = MLP.GLBL_CMPY_CD(+)
                    AND MLP.EZCANCELFLAG(+)         = '0'
            UNION ALL
            SELECT
                      CD.DS_CONTR_DTL_PK
                    , CBM.DS_CONTR_BLLG_MTR_PK
                    , CBR.CONTR_PHYS_BLLG_MTR_RELN_PK
                    , CXC.CONTR_XS_COPY_PK
                    , CD.MDL_ID
                    , NULL AS T_MDL_NM
                    , NULL AS PRC_CATG_CD
                    , NULL AS PRC_LIST_BAND_CD
                    , NULL AS PRC_LIST_BAND_DESC_TXT
                    , NULL AS PRC_BOOK_MDSE_CD
                    , MLB.MTR_LB_CD AS BLLG_MTR_LB_CD
                    , NULL AS BLLG_MTR_LB_DESC_TXT
                    , NULL AS REG_MTR_LB_CD
                    , NULL AS REG_MTR_LB_DESC_TXT
                    , NULL AS CONTR_MTR_MULT_RATE
                    , CXC.XS_MTR_COPY_QTY
                    , CXC.MAX_COPY_VOL_CNT
                    , CXC.XS_MTR_AMT_RATE
                    , NULL AS DS_ACCT_NM
                    , NULL AS SELL_TO_CUST_CD
                    , NULL AS BILL_TO_SRCH_TXT
                    , NULL AS BILL_TO_CUST_CD
                    , NULL AS INTG_MDSE_CD
                    , NULL AS REG_MTR_LB_SORT_NUM
                    , CXC.PRC_SVC_TIER_TP_CD
                    , PTT.PRC_SVC_TIER_TP_DESC_TXT
                    , PTT.PRC_SVC_TIER_TP_SORT_NUM
                    , CBR.ACTV_FLG
                    , #flgNmT# AS XX_FLG_NM
                    , 3 AS SORT_NUM
                    <!-- 2018/05/09 QC#25030 add start -->
                    , NULL AS BLLG_FREE_COPY_CNT
                    , NULL AS BLLG_MIN_CNT
                    , NULL AS BLLG_MIN_AMT_RATE
                    , NULL AS BLLG_ROLL_OVER_RATIO
                   <!-- 2018/05/09 QC#25030 add end -->
                FROM
                      DS_CONTR_DTL              CD
                    , DS_CONTR                  C
                    , DS_CONTR_BLLG_MTR         CBM
                    , CONTR_PHYS_BLLG_MTR_RELN  CBR
                    , CONTR_XS_COPY             CXC
                    , PRC_SVC_TIER_TP           PTT
                    , MTR_LB                    MLB
                WHERE
                        CD.GLBL_CMPY_CD             = #glblCmpyCd#
                    AND CD.DS_CONTR_PK              = #dsContrPk#
                    AND CD.SHELL_LINE_NUM           = #shellLineNum#
                    <isNotEqual property="isFleet" compareValue="Y">
                    AND CD.MDL_ID                   = #mdlId#
                    </isNotEqual>
                    AND CD.CPO_ORD_NUM              = #cpoOrdNum#
                    AND CD.DS_CONTR_DTL_TP_CD       = #dsContrDtlTpCd#
                    AND CD.EZCANCELFLAG             = '0'
                    --
                    AND CD.DS_CONTR_PK              = C.DS_CONTR_PK
                    AND CD.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
                    AND C.EZCANCELFLAG              = '0'
                    --
                    AND CD.DS_CONTR_DTL_PK          = CBM.DS_CONTR_DTL_PK
                    AND CD.GLBL_CMPY_CD             = CBM.GLBL_CMPY_CD
                    AND CBM.EZCANCELFLAG            = '0'
                    --
                    AND CBM.BLLG_MTR_LB_CD          = MLB.MTR_LB_CD(+)
                    AND CBM.GLBL_CMPY_CD            = MLB.GLBL_CMPY_CD(+)
                    AND MLB.EZCANCELFLAG(+)         = '0'
                    AND EXISTS (
                        SELECT
                            1
                        FROM
                            PRC_MTR_PKG_BLLG_MTR PBM
                        WHERE
                                PBM.GLBL_CMPY_CD    = CD.GLBL_CMPY_CD
                            AND PBM.PRC_MTR_PKG_PK  = CD.PRC_MTR_PKG_PK
                            AND PBM.MTR_LB_CD       = MLB.MTR_LB_CD
                            AND PBM.EZCANCELFLAG    = '0'
                    )
                    --
                    AND CBM.BLLG_MTR_LB_CD          = CBR.BLLG_MTR_LB_CD(+)
                    AND CBM.DS_CONTR_DTL_PK         = CBR.DS_CONTR_DTL_PK(+)
                    AND CBM.GLBL_CMPY_CD            = CBR.GLBL_CMPY_CD(+)
                    AND CBR.EZCANCELFLAG(+)         = '0'
                    --
                    AND CBM.DS_CONTR_BLLG_MTR_PK    = CXC.DS_CONTR_BLLG_MTR_PK
                    AND CBM.GLBL_CMPY_CD            = CXC.GLBL_CMPY_CD
                    AND CXC.XS_MTR_FIRST_FLG        = #xsMtrFirstFlgN#
                    AND CXC.EZCANCELFLAG            = '0'
                    --
                    AND CXC.GLBL_CMPY_CD            = PTT.GLBL_CMPY_CD(+)
                    AND CXC.PRC_SVC_TIER_TP_CD      = PTT.PRC_SVC_TIER_TP_CD(+)
                    AND PTT.EZCANCELFLAG(+)         = '0'
        ) WK_V
        ORDER BY
              SORT_NUM
            , BLLG_MTR_LB_CD
            , INTG_MDSE_CD              NULLS LAST
            , XS_MTR_COPY_QTY           NULLS LAST
            , REG_MTR_LB_SORT_NUM       NULLS FIRST
            , PRC_SVC_TIER_TP_SORT_NUM


    </statement>

    <statement id="getPrcRateTpCd" parameterClass="Map" resultClass="String">
        SELECT
                PLS.PRC_RATE_TP_CD
                , PLS.MDL_ID
                , PLS.PRC_MTR_PKG_PK
                , PLS.BASE_AMT
            FROM
                 PRC_CATG       DPC
               , PRC_LIST_SVC   PLS
            WHERE
                DPC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DPC.EZCANCELFLAG        = '0'
            AND DPC.PRC_CATG_CD         = #prcCatgCd#
            AND DPC.ACTV_FLG            = #activFlg#
            ANd DPC.DEL_FLG             = #delFlg#
            AND DPC.EFF_FROM_DT        &lt;= #prcBaseDt#
            AND (
                DPC.EFF_THRU_DT        &gt;= #prcBaseDt#
             OR DPC.EFF_THRU_DT        IS NULL )
            AND DPC.GLBL_CMPY_CD        = PLS.GLBL_CMPY_CD
            AND DPC.EZCANCELFLAG        = PLS.EZCANCELFLAG
            AND DPC.PRC_CATG_CD         = PLS.PRC_CATG_CD
            AND PLS.MDL_ID              = #mdlId#
        <isNotNull property="prcMtrPkgPk">
            AND PLS.PRC_MTR_PKG_PK      = #prcMtrPkgPk#
        </isNotNull>
            AND PLS.PRC_SVC_PLN_TP_CD   = #prcSvcPlnTpCd#
            AND PLS.PRC_SVC_CONTR_TP_CD = #prcSvcContrTpCd#
            --
                AND PLS.TERM_FROM_MTH_AOT  &lt;=  #termMthNum#
                AND
                  (
                   PLS.TERM_THRU_MTH_AOT   &gt;=  #termMthNum#
                 OR
                   PLS.TERM_THRU_MTH_AOT   IS NULL
                  )
            --
            AND PLS.EFF_FROM_DT        &lt;= #prcBaseDt#
            AND (
                PLS.EFF_THRU_DT        &gt;= #prcBaseDt#
             OR PLS.EFF_THRU_DT        IS NULL )
            AND PLS.DEL_FLG             = #delFlg#
            AND ROWNUM                  = #rownum1#
    </statement>
    <!-- END 2017/06/20 K.Kojima [QC#19053, ADD] -->

    <!-- START 2017/09/27 [QC#21154, ADD] -->
    <statement id="getSoldToCustInfo" parameterClass="Map" resultClass="Map">
        SELECT
                  DC.SELL_TO_CUST_CD        DS_ACCT_NUM
                , STC.DS_ACCT_NM            DS_ACCT_NM
                , DC.SOLD_TO_CUST_LOC_CD    SOLD_TO_CUST_LOC_CD
                , RPAD(BTC.FIRST_LINE_ADDR, LENGTH(BTC.FIRST_LINE_ADDR) + 1)
                    || RPAD(BTC.SCD_LINE_ADDR, LENGTH(BTC.SCD_LINE_ADDR) + 1)
                    || RPAD(BTC.THIRD_LINE_ADDR, LENGTH(BTC.THIRD_LINE_ADDR) + 1)
                    || RPAD(BTC.FRTH_LINE_ADDR, LENGTH(BTC.FRTH_LINE_ADDR) + 1)
                    || CONCAT(BTC.CTY_ADDR, ',')
                    || RPAD(BTC.st_cd, LENGTH (BTC.ST_CD) + 1)
                    || BTC.POST_CD          BILL_TO_SRCH_TXT
            FROM
                  CPO                   DC
                , SELL_TO_CUST          STC
                , BILL_TO_CUST          BTC
            WHERE
                    DC.GLBL_CMPY_CD         = #glblCmpyCd#
                AND DC.CPO_ORD_NUM          = #cpoOrdNum#
                AND DC.EZCANCELFLAG         = '0'
                AND DC.GLBL_CMPY_CD         = STC.GLBL_CMPY_CD(+)
                AND DC.SELL_TO_CUST_CD      = STC.SELL_TO_CUST_CD(+)
                AND STC.EZCANCELFLAG(+)     = '0'
                AND DC.GLBL_CMPY_CD         = BTC.GLBL_CMPY_CD(+)
                AND DC.SOLD_TO_CUST_LOC_CD  = BTC.BILL_TO_CUST_CD(+)
                AND BTC.EZCANCELFLAG(+)     = '0'
    </statement>
    <!-- END   2017/09/27 [QC#21154, ADD] -->

    <!-- START 2017/10/25 [QC#21556, ADD] -->
    <statement id="getContrTermInfo" parameterClass="Map" resultClass="Map">
        SELECT
                  DC.DS_CONTR_PK
                , DCD1.DS_CONTR_DTL_PK
                , DCD2.DS_CONTR_DTL_PK
                , CEIL( 
                    MONTHS_BETWEEN( 
                        TO_DATE(DC.CONTR_VRSN_EFF_THRU_DT, 'yyyymmdd')
                        , TO_DATE(DC.CONTR_VRSN_EFF_FROM_DT, 'yyyymmdd')
                    )
                ) TERM_MTH_NUM
                , CEIL( 
                    MONTHS_BETWEEN( 
                          TO_DATE(DC.CONTR_VRSN_EFF_THRU_DT, 'yyyymmdd')
                        , TO_DATE(#slsDt#, 'yyyymmdd')
                    )
                ) TERM_MTH_NUM_RMNG 
                , CEIL( 
                    MONTHS_BETWEEN( 
                        TO_DATE(DCD1.CONTR_EFF_THRU_DT, 'yyyymmdd')
                        , TO_DATE(DCD1.CONTR_EFF_FROM_DT, 'yyyymmdd')
                    )
                ) TERM_MTH_NUM_MACH
                , CEIL( 
                    MONTHS_BETWEEN( 
                          TO_DATE(DCD1.CONTR_EFF_THRU_DT, 'yyyymmdd')
                        , TO_DATE(#slsDt#, 'yyyymmdd')
                    )
                ) TERM_MTH_NUM_MACH_RMNG 
                , DC.CONTR_VRSN_EFF_FROM_DT
                , DC.CONTR_VRSN_EFF_THRU_DT
                , DCD.CONTR_EFF_FROM_DT
                , DCD.CONTR_EFF_THRU_DT
            FROM

                  DS_CPO_CONFIG     DCC
                , CPO_DTL           CD
                , SVC_CONFIG_MSTR   SCM
                , DS_CONTR_DTL      DCD
                , DS_CONTR          DC
            WHERE

                    DCC.GLBL_CMPY_CD                = #glblCmpyCd#
                AND DCC.CPO_ORD_NUM                 = #cpoOrdNum#
                AND DCC.DS_ORD_POSN_NUM             = #dsOrdPosnNum#
                AND DCC.EZCANCELFLAG                = '0'
                --
                AND DCC.GLBL_CMPY_CD                = CD.GLBL_CMPY_CD
                AND DCC.DS_CPO_CONFIG_PK            = CD.DS_CPO_CONFIG_PK
                AND CD.CPO_ORD_NUM                  = #cpoOrdNum#
                AND CD.CPO_DTL_LINE_NUM             = #cpoDtlLineNum#
                AND CD.CPO_DTL_LINE_SUB_NUM         = #cpoDtlLineSubNum#
                AND CD.EZCANCELFLAG                 = '0'
                --
                AND DCC.GLBL_CMPY_CD                = SCM.GLBL_CMPY_CD
                AND DCC.SVC_CONFIG_MSTR_PK          = SCM.SVC_CONFIG_MSTR_PK
                AND SCM.EZCANCELFLAG                = '0'
                --
                AND SCM.GLBL_CMPY_CD                = DCD.GLBL_CMPY_CD
                AND SCM.SVC_CONFIG_MSTR_PK          = DCD.SVC_CONFIG_MSTR_PK
                AND DCD.DS_CONTR_PK                 = #dsContrPk#
                AND DCD.DS_CONTR_DTL_TP_CD   &lt;&gt; #dsContrDtlTpCd#
                AND DCD.EZCANCELFLAG                = '0'
                --
                AND DCD.GLBL_CMPY_CD                = DC.GLBL_CMPY_CD
                AND DCD.DS_CONTR_PK                 = DC.DS_CONTR_PK
                AND DC.EZCANCELFLAG                 = '0'
    </statement>
    <!-- END   2017/10/25 [QC#21556, ADD] -->
    <!-- START 2018/04/20 A.Kosai [QC#21919, ADD] -->
    <statement id="getIstlInfo" parameterClass="Map" resultClass="Map">
        SELECT
             X.CPO_ORD_NUM      AS CPO_ORD_NUM
            ,X.DS_CPO_CONFIG_PK AS DS_CPO_CONFIG_PK
            ,X.ISTL_DIV_CD      AS ISTL_DIV_CD
        FROM
            DS_CPO_ISTL_INFO X
        WHERE
            EXISTS (
                SELECT
                    *
                FROM
                    CPO_DTL Z
                WHERE
                        Z.GLBL_CMPY_CD         = #glblCmpyCd#
                    AND Z.EZCANCELFLAG         = '0'
                    AND Z.CPO_ORD_NUM          = #cpoOrdNum#
                    AND Z.CPO_DTL_LINE_NUM     = #cpoDtlLineNum#
                    AND Z.CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
                    AND Z.GLBL_CMPY_CD         = X.GLBL_CMPY_CD
                    AND Z.CPO_ORD_NUM          = X.CPO_ORD_NUM
                    AND Z.DS_CPO_CONFIG_PK     = X.DS_CPO_CONFIG_PK
            )
        UNION ALL
        SELECT
             Y.CPO_ORD_NUM      AS CPO_ORD_NUM
            ,Y.DS_CPO_CONFIG_PK AS DS_CPO_CONFIG_PK
            ,Y.ISTL_DIV_CD      AS ISTL_DIV_CD
        FROM
            DS_CPO_ISTL_INFO Y
        WHERE
                Y.GLBL_CMPY_CD     =  #glblCmpyCd#
            AND Y.EZCANCELFLAG     =  '0'
            AND Y.CPO_ORD_NUM      =  #cpoOrdNum#
            AND Y.DS_CPO_CONFIG_PK IS NULL
        ORDER BY
            DS_CPO_CONFIG_PK ASC
    </statement>
    <statement id="convLineBizTpToSvcLineBiz" parameterClass="Map" resultClass="String">
        SELECT
            RELN.SVC_LINE_BIZ_CD
        FROM
            SVC_LINE_BIZ_RELN RELN
        WHERE
                RELN.GLBL_CMPY_CD   = #glblCmpyCd#
            AND RELN.EZCANCELFLAG   = '0'
            AND RELN.LINE_BIZ_TP_CD = NVL(#lineBizTpCd#, #nullString#)
    </statement>
    <!-- END   2018/04/20 A.Kosai [QC#21919, ADD] -->
    <!-- START 2019/05/23 W.Honda [QC#50157, ADD] -->
    <statement id="getExistCrCardPO" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            DS_CONTR_CR_CARD_PO_PK
        FROM
            (
            SELECT
                CCP.DS_CONTR_CR_CARD_PO_PK
            FROM
                DS_CONTR_CR_CARD_PO CCP
            WHERE
                CCP.GLBL_CMPY_CD    = #glblCmpyCd#
            AND CCP.EZCANCELFLAG    = '0'
            AND CCP.DS_CONTR_DTL_PK = #dsContrDtlPk#
            ORDER BY
            CCP.EZINTIME
            )
        WHERE
            ROWNUM = 1
    </statement>
    <!-- END   2019/05/23 W.Honda [QC#50157, ADD] -->
    <!-- START 2019/11/29 K.Kitachi [QC#53682, ADD] -->
    <statement id="countAddToContrAccReln" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             CPO_DTL       CD
            ,DS_CONTR_DTL  DCD
            ,SVC_MACH_MSTR SMM
        WHERE
                CD.GLBL_CMPY_CD         = #glblCmpyCd#
            AND CD.CPO_ORD_NUM          = #cpoOrdNum#
            AND CD.CPO_DTL_LINE_NUM     = #cpoDtlLineNum#
            AND CD.CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
            AND CD.EZCANCELFLAG         = '0'
            AND CD.GLBL_CMPY_CD         = DCD.GLBL_CMPY_CD
            AND CD.SVC_CONFIG_MSTR_PK   = DCD.SVC_CONFIG_MSTR_PK
            AND DCD.DS_CONTR_PK         = #dsContrPk#
            AND DCD.EZCANCELFLAG        = '0'
            AND DCD.GLBL_CMPY_CD        = SMM.GLBL_CMPY_CD
            AND DCD.SVC_CONFIG_MSTR_PK  = SMM.SVC_CONFIG_MSTR_PK
            AND DCD.SVC_MACH_MSTR_PK    = SMM.SVC_MACH_MSTR_PK
            AND SMM.SVC_MACH_TP_CD      = #svcMachTpCd#
            AND SMM.EZCANCELFLAG        = '0'
    </statement>
    <!-- END 2019/11/29 K.Kitachi [QC#53682, ADD] -->
    <!-- START 2020/05/27 T.Wada [QC#55922, ADD] -->
    <statement id="countDsContrBllgMtr" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            COUNT(*) 
        FROM
            DS_CONTR_BLLG_MTR    A
           ,DS_CONTR_DTL         B
        WHERE 
            A.GLBL_CMPY_CD              = #glblCmpyCd#
        AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
        AND A.DS_CONTR_DTL_PK           = B.DS_CONTR_DTL_PK
        AND B.DS_CONTR_PK               = #dsContrPk#
        AND A.EZCANCELFLAG              = '0'
        AND B.EZCANCELFLAG              = '0'
    </statement>
    <!-- END 2020/05/27 T.Wada [QC#55922, ADD] -->
    <!-- START 2024/03/12 M.Kuroi [QC#63638,ADD] -->
    <statement id="getLatestShpgSts" parameterClass="Map" resultClass="String">
        SELECT 
            SP.SHPG_STS_CD
        FROM
            SHPG_PLN             SP
        WHERE 
            SP.GLBL_CMPY_CD             = #glblCmpyCd#
        AND SP.TRX_HDR_NUM              = #refCpoOrdNum#
        AND SP.TRX_LINE_NUM             = #cpoDtlLineNum#
        AND SP.TRX_LINE_SUB_NUM         = #cpoDtlLineSubNum#
        AND SP.EZCANCELFLAG             = '0'
    </statement>
    <!-- END 2024/03/12 M.Kuroi [QC#63638,ADD] -->
</sqlMap>
