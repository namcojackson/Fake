<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NYEL8840Query">
    <statement id="procDfnList" parameterClass="Map" resultClass="Map">
        SELECT
               PD.WF_BIZ_APP_ID
               , PD.WF_DESC_TXT
        FROM
               WF_PROC_DFN      PD
        WHERE
               PD.GLBL_CMPY_CD    = #glblCmpyCd#
               AND PD.EZCANCELFLAG    = '0'
               AND PD.WF_BIZ_APP_ID != 'ALL'
               AND PD.WF_BIZ_APP_ID != 'SYSTEM'
        ORDER BY PD.WF_DESC_TXT
    </statement>

    <statement id="getDelegateUser" parameterClass="Map" resultClass="Map">
        SELECT
            DLGT.WF_DLGT_USR_PK
            , DLGT.WF_USR_ID
            , DLGT.EFF_FROM_DT
            , DLGT.EFF_FROM_HOUR_MN
            , DLGT.EFF_THRU_DT
            , DLGT.EFF_THRU_HOUR_MN
            , DLGT.WF_DESC_TXT
            , DLGT.WF_BIZ_APP_ID
            , DLGT.PROCNM
            , DLGT.EZUPTIME
        FROM
            (
                SELECT
                    DU.WF_DLGT_USR_PK
                    , WU.WF_USR_ID
                    , DU.EFF_FROM_DT
                    , DU.EFF_FROM_HOUR_MN
                    , DU.EFF_THRU_DT
                    , DU.EFF_THRU_HOUR_MN
                    , DU.WF_DESC_TXT
                    , PD.WF_BIZ_APP_ID
                    , PD.WF_DESC_TXT PROCNM
                    , DU.EZUPTIME
                FROM
                    WF_DLGT_USR DU
                    , WF_PROC_DLGT_USR_RELN PDUR
                    , WF_PROC_DFN PD
                    , WF_USR WU
                WHERE
                            DU.EZCANCELFLAG = '0'
                    AND     PDUR.EZCANCELFLAG = '0'
                    AND     PD.EZCANCELFLAG = '0'
                    AND     WU.EZCANCELFLAG = '0'
                    AND     DU.GLBL_CMPY_CD = #glblCmpyCd#
                    AND     PDUR.GLBL_CMPY_CD = #glblCmpyCd#
                    AND     PD.GLBL_CMPY_CD = #glblCmpyCd#
                    AND     WU.GLBL_CMPY_CD = #glblCmpyCd#
                    AND     DU.WF_DLGT_USR_PK = PDUR.WF_DLGT_USR_PK
                    AND     PD.WF_PROC_DFN_PK = PDUR.WF_PROC_DFN_PK
                    AND     WU.WF_USR_PK = DU.TO_WF_USR_PK
                <isNotNull property="wfBizAppId">
                    AND     PD.WF_BIZ_APP_ID = #wfBizAppId#
                </isNotNull>
                <isNotNull property="fromWfUsrId">
                    AND     DU.FROM_WF_USR_PK   IN (
                        SELECT
                            WF_USR_PK
                        FROM
                           WF_USR
                        WHERE
                                  EZCANCELFLAG = '0'
                          AND     GLBL_CMPY_CD = #glblCmpyCd#
                    <isNotNull property="fromWfUsrTpCd">
                          AND     WF_USR_TP_CD = #fromWfUsrTpCd#
                    </isNotNull>
                          AND     WF_USR_ID = #fromWfUsrId#
                      )
                </isNotNull>
                <isNotNull property="toDtHHMM">
                    AND     DU.EFF_THRU_DT  || DU.EFF_THRU_HOUR_MN &gt;= #toDtHHMM#
                </isNotNull>
                ORDER BY DU.EFF_FROM_DT, PD.WF_BIZ_APP_ID, WU.WF_USR_ID
            ) DLGT
        WHERE
            ROWNUM            &lt;= #maxNum#
    </statement>

    <statement id="checkPeriodOverlap" parameterClass="Map" resultClass="Map">
        SELECT
            DLGT.WF_DLGT_USR_PK
            , DLGT.WF_USR_ID
            , DLGT.EFF_FROM_DT
            , DLGT.EFF_FROM_HOUR_MN
            , DLGT.EFF_THRU_DT
            , DLGT.EFF_THRU_HOUR_MN
            , DLGT.WF_DESC_TXT
            , DLGT.WF_BIZ_APP_ID
            , DLGT.PROCNM
            , DLGT.EZUPTIME
        FROM
            (
                SELECT
                    DU.WF_DLGT_USR_PK
                    , WU.WF_USR_ID
                    , DU.EFF_FROM_DT
                    , DU.EFF_FROM_HOUR_MN
                    , DU.EFF_THRU_DT
                    , DU.EFF_THRU_HOUR_MN
                    , DU.WF_DESC_TXT
                    , PD.WF_BIZ_APP_ID
                    , PD.WF_DESC_TXT PROCNM
                    , DU.EZUPTIME
                FROM
                    WF_DLGT_USR DU
                    , WF_PROC_DLGT_USR_RELN PDUR
                    , WF_PROC_DFN PD
                    , WF_USR WU
                WHERE
                            DU.EZCANCELFLAG = '0'
                    AND     PDUR.EZCANCELFLAG = '0'
                    AND     PD.EZCANCELFLAG = '0'
                    AND     WU.EZCANCELFLAG = '0'
                    AND     DU.GLBL_CMPY_CD = #glblCmpyCd#
                    AND     PDUR.GLBL_CMPY_CD = #glblCmpyCd#
                    AND     PD.GLBL_CMPY_CD = #glblCmpyCd#
                    AND     WU.GLBL_CMPY_CD = #glblCmpyCd#
                    AND     DU.WF_DLGT_USR_PK = PDUR.WF_DLGT_USR_PK
                    AND     PD.WF_PROC_DFN_PK = PDUR.WF_PROC_DFN_PK
                    AND     WU.WF_USR_PK = DU.TO_WF_USR_PK
                <isNotNull property="wfBizAppId">
                    AND     PD.WF_BIZ_APP_ID IN ('ALL', #wfBizAppId#)
                </isNotNull>
                <isNotNull property="fromWfUsrId">
                    AND     DU.FROM_WF_USR_PK   IN (
                        SELECT
                            WF_USR_PK
                        FROM
                           WF_USR
                        WHERE
                                  EZCANCELFLAG = '0'
                          AND     GLBL_CMPY_CD = #glblCmpyCd#
                    <isNotNull property="fromWfUsrTpCd">
                          AND     WF_USR_TP_CD = #fromWfUsrTpCd#
                    </isNotNull>
                          AND     WF_USR_ID = #fromWfUsrId#
                      )
                </isNotNull>
                <isNotNull property="toWfUsrId">
                    AND     DU.TO_WF_USR_PK   IN (
                        SELECT
                            WF_USR_PK
                        FROM
                           WF_USR
                        WHERE
                                  EZCANCELFLAG = '0'
                          AND     GLBL_CMPY_CD = #glblCmpyCd#
                    <isNotNull property="toWfUsrTpCd">
                          AND     WF_USR_TP_CD = #toWfUsrTpCd#
                    </isNotNull>
                          AND     WF_USR_ID = #toWfUsrId#
                      )
                </isNotNull>
                    AND (
                        (DU.EFF_FROM_DT || DU.EFF_FROM_HOUR_MN &gt;= #fromDtHHMM#
                          AND  DU.EFF_FROM_DT || DU.EFF_FROM_HOUR_MN &lt;= #toDtHHMM#)
                        OR
                        (DU.EFF_THRU_DT || DU.EFF_THRU_HOUR_MN&gt;= #fromDtHHMM#
                          AND  DU.EFF_THRU_DT || DU.EFF_THRU_HOUR_MN &lt;= #toDtHHMM#)
                        OR
                        (DU.EFF_FROM_DT || DU.EFF_FROM_HOUR_MN &lt;= #fromDtHHMM#
                          AND  DU.EFF_THRU_DT || DU.EFF_THRU_HOUR_MN &gt;= #toDtHHMM#)
                        OR
                        (DU.EFF_FROM_DT || DU.EFF_FROM_HOUR_MN &gt;= #fromDtHHMM#
                          AND  DU.EFF_THRU_DT || DU.EFF_THRU_HOUR_MN &lt;= #toDtHHMM#)
                    )
                ORDER BY DU.EFF_FROM_DT
            ) DLGT
        WHERE
            ROWNUM = 1
    </statement>
</sqlMap>
