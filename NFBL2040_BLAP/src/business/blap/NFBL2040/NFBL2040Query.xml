<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NFBL2040Query">

    <typeAlias alias="NFBL2040CMsg" type="business.blap.NFBL2040.NFBL2040CMsg"/>

    <statement id="getCmApInvTpPulldownValue"  parameterClass="Map" resultClass="Map">
        SELECT
            CM_AP_INV_TP_CD
        ,   CM_AP_INV_TP_DESC_TXT
        FROM
            CM_AP_INV_TP
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND EZCANCELFLAG = '0' 
        ORDER BY
            CM_AP_INV_TP_SORT_NUM ASC
    </statement>

    <statement id="getCmInvMatchPulldownValue"  parameterClass="Map" resultClass="Map">
        SELECT
            CM_INV_MATCH_CD
        ,   CM_INV_MATCH_DESC_TXT
        FROM
            CM_INV_MATCH
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND EZCANCELFLAG = '0' 
        ORDER BY
            CM_INV_MATCH_SORT_NUM ASC
    </statement>

    <statement id="getApLineTpPulldownValue"  parameterClass="Map" resultClass="Map">
        SELECT
            AP_LINE_TP_CD
        ,   AP_LINE_TP_DESC_TXT
        FROM
            AP_LINE_TP
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd# 
        AND AP_LINE_TP_CD   &lt;&gt; #variance#
        <isNotNull property="notDispApLineTp">
        AND AP_LINE_TP_CD   NOT IN #notDispApLineTp#
        </isNotNull>
        AND EZCANCELFLAG = '0' 
        ORDER BY
            AP_LINE_TP_SORT_NUM ASC
    </statement>

    <statement id="getInvRecordFromOtherScreen" parameterClass="Map" resultClass="Map">
        <!-- START 2018/03/23 [QC#20316,MOD] -->
        SELECT
        <!-- Hidden Value for check logic -->
            A.PO_STS_CD
        <!-- HEADER TAB -->
        ,   A.DPLY_VND_NM                 <!-- Vendor Name -->
        ,   A.AP_VND_CD                   <!-- Location -->
        ,   A.AP_VND_INV_NUM              <!-- Invoice Number -->
        ,   A.INV_DT                      <!-- Invoice Date -->
        ,   A.PAY_ALONE_FLG               <!-- Pay Alone Flag -->
        ,   A.AP_PMT_CHK_NUM              <!-- Payment Number -->
        ,   A.VND_PMT_METH_CD             <!-- Payment Method Code -->
        ,   A.VND_PMT_METH_DESC_TXT       <!-- Payment Method Name -->
        ,   A.ACCT_INV_STS_CD             <!-- Accounting Invoice Status Code -->
        ,   A.ACCT_INV_STS_DESC_TXT       <!-- Status -->
        ,   A.PRNT_VND_CD                 <!-- Vendor Number -->
        ,   A.CM_INV_MATCH_CD             <!-- Invoice Matching -->
        ,   DECODE(A.PO_NUM, #none#, NULL, A.PO_NUM) PO_NUM  <!-- PO Number -->
        ,   A.AC_INV_TOT_COST_AMT         <!-- Invoice Amount -->
        ,   A.VND_PMT_TERM_CD             <!-- Payment Term Code -->
        ,   A.VND_PMT_TERM_DESC_TXT       <!-- Terms -->
        ,   A.PMT_DT                      <!-- Payment Date -->
        ,   A.HDR_PMT_AMT                 <!-- Amount Paid -->
        ,   A.TERM_NET_DUE_DT             <!-- Terms Date -->
        ,   A.PO_APVL_DT                  <!-- PO Date -->
        ,   A.ENT_PO_DTL_DEAL_NET_AMT     <!-- PO Amount -->
        ,   DECODE(A.DELY_ORD_NUM, #none#, NULL, A.DELY_ORD_NUM) DELY_ORD_NUM  <!-- Receipt Number -->
        ,   RWS.RWS_NUM                   <!-- RWS Number -->
        ,   A.INV_HDR_DESC_TXT            <!-- Description -->
        ,   A.AC_OC_TOT_DISC_AMT          <!-- Discount -->
        ,   A.AP_INV_CATG_DESC_TXT        <!-- Source -->
        ,   A.INV_AUTH_DT                 <!-- Accounting Date -->
        ,   A.CM_AP_INV_TP_CD             <!-- Invoice Type -->
        <!-- START 2017/03/16 E.Kameishi [QC#14205,ADD] -->
        ,   A.XX_REC_HIST_CRAT_TS
        ,   A.XX_REC_HIST_CRAT_BY_NM
        ,   A.XX_REC_HIST_UPD_TS
        ,   A.XX_REC_HIST_UPD_BY_NM 
        ,   A.XX_REC_HIST_TBL_NM
        <!-- END 2017/03/16 E.Kameishi [QC#14205,ADD] -->
        <!-- START 2017/12/26 [QC#23022,ADD] -->
        ,   A.AP_INV_CATG_CD
        <!-- END 2017/12/26 [QC#23022,ADD] -->
        <!-- START 2018/02/27 [QC#23505,ADD] -->
        ,   A.AP_VND_INV_SQ_NUM
        <!-- END 2018/02/27 [QC#23505,ADD] -->

        <!-- HOLDS TAB -->
        ,   A.PMT_HLD_FLG

         <!-- LINES TAB -->
        ,   A.AP_LINE_TP_CD               <!-- Line Type -->
        ,   A.MDSE_CD                     <!-- Item -->
        ,   A.MDSE_DESC_SHORT_TXT         <!-- Line Description -->
        ,   A.LINE_AMT                    <!-- Line Amount -->
        ,   A.UOM_CD                      <!-- Unit Of Measure -->
        ,   A.XX_CMNT_TXT                 <!-- Charge Account -->
        ,   A.AP_ACCT_DESC_TXT            <!-- Account Description -->
        ,   A.ENT_DEAL_NET_UNIT_PRC_AMT   <!-- Unit Price -->
        ,   A.INV_QTY                     <!-- Invoice Quantity -->
        ,   A.PO_QTY                      <!-- Ordered Quantity -->
        ,   A.INV_RCV_QTY                 <!-- Received Quantity -->
        ,   A.AP_REJ_QTY                  <!-- Rejected Quantity -->
        ,   A.AP_BILL_QTY                 <!-- Billed Quantity -->
        ,   A.CONTR_NUM                   <!-- Contract -->
        ,   A.CUST_DLR_CD                 <!-- Dealer Code -->
        ,   A.SER_NUM                     <!-- Serial Number -->
        ,   A.CSMP_INV_NUM                <!-- CSMP Invoice -->
        ,   A.ISTL_LOC                    <!-- Install Location -->
        ,   A.CM_STK_IN_PK
        ,   A.INV_ASG_FLG
        ,   A.ORIG_VND_INV_NUM
        ,   A.ORIG_VND_INV_SQ_NUM
        ,   A.ORIG_DELY_ORD_NUM
        ,   A.AP_VND_INV_LINE_NUM
        ,   A.CM_INV_ACCT_DIST_LINE_NUM
        ,   A.PO_MATCH_TP_CD
        ,   A.CSI_ENT_FUNC_NET_UNIT_PRC_AMT   CSI_ENT_FUNC_NET_UNIT_PRC_AMT
        ,   A.CSI_ENT_PO_DTL_FUNC_NET_AMT     CSI_ENT_PO_DTL_FUNC_NET_AMT
        ,   A.CSI_ENT_DEAL_NET_UNIT_PRC_AMT   CSI_ENT_DEAL_NET_UNIT_PRC_AMT
        ,   A.CSI_ENT_PO_DTL_DEAL_NET_AMT     CSI_ENT_PO_DTL_DEAL_NET_AMT

        <!-- START 2017/03/16 E.Kameishi [QC#14205,ADD] -->
        ,   A.XX_REC_HIST_CRAT_TS_A1
        ,   A.XX_REC_HIST_CRAT_BY_NM_A1
        ,   A.XX_REC_HIST_UPD_TS_A1
        ,   A.XX_REC_HIST_UPD_BY_NM_A1
        ,   A.XX_REC_HIST_TBL_NM_A1
        <!-- END 2017/03/16 E.Kameishi [QC#14205,ADD] -->
         <!-- DISTRIBUTIONS TAB -->
        ,   A.AC_INV_JRNL_COST_AMT        <!-- Line Amount -->
        ,   A.PO_ORD_DTL_LINE_NUM
        <!-- START 2018/02/26 [QC#23505,ADD] -->
        ,   DECODE(A.LINE_PO_NUM, 'NONE', NULL, A.LINE_PO_NUM) LINE_PO_NUM <!-- PO# -->
        ,   A.INV_CRCT_DT INV_CRCT_DT                                      <!-- Correction Date -->
        ,   A.LINE_AP_VND_INV_SQ_NUM                 LINE_AP_VND_INV_SQ_NUM
        <!-- END   2018/02/26 [QC#23505,ADD] -->
        <!-- START 2018/03/16 [QC#24089,ADD] -->
        ,   A.PO_LINE_STS_CD                         PO_LINE_STS_CD
        <!-- END   2018/03/16 [QC#24089,ADD] -->
        <!-- START 2018/05/07 [QC#25828,ADD] -->
        ,   A.PD_ENT_DEAL_NET_UNIT_PRC_AMT           PD_ENT_DEAL_NET_UNIT_PRC_AMT
        <!-- END   2018/05/07 [QC#25828,ADD] -->
        ,   A.VND_RTRN_NUM                           VND_RTRN_NUM
        <!-- START 2018/07/17 S.Katsuma [QC#27078,ADD -->
        ,   A.DISP_PO_DTL_LINE_NUM                   DISP_PO_DTL_LINE_NUM
        <!-- END 2018/07/17 S.Katsuma [QC#27078,ADD -->

        <!-- START 2017/08/02 [QC#27025-1,ADD] -->
        ,   A.EZUPTIME                               EZUPTIME
        ,   A.EZUPTIMEZONE                           EZUPTIMEZONE
        <!-- END   2017/08/02 [QC#27025-1,ADD] -->

        <!-- START 2018/08/03 [QC#27563,ADD] -->
        ,   A.ENT_PO_DTL_DEAL_NET_AMT_LINE           ENT_PO_DTL_DEAL_NET_AMT_LINE
        <!-- END   2018/08/03 [QC#27563,ADD] -->
        <!-- START 2018/08/15 [QC#27029-1,ADD] -->
        ,   A.VRD_ENT_DEAL_NET_UNIT_PRC_AMT          VRD_ENT_DEAL_NET_UNIT_PRC_AMT
        <!-- END   2018/08/15 [QC#27029-1,ADD] -->

        FROM (
            <!-- EDI GATEWAY start -->
            SELECT
            <!-- Hidden Value for check logic -->
                PO.PO_HDR_STS_CD                     PO_STS_CD
            <!-- HEADER TAB -->
            ,   NVL(V.DPLY_VND_NM,PV.DPLY_VND_NM)    DPLY_VND_NM                 <!-- Vendor Name -->
            ,   CAIH.AP_VND_CD                       AP_VND_CD                   <!-- Location -->
            ,   CAIH.AP_VND_INV_NUM                  AP_VND_INV_NUM              <!-- Invoice Number -->
            ,   CAIH.INV_DT                          INV_DT                      <!-- Invoice Date -->
            ,   CAIH.PAY_ALONE_FLG                   PAY_ALONE_FLG               <!-- Pay Alone Flag -->
            ,   CAIH.AP_PMT_CHK_NUM                  AP_PMT_CHK_NUM              <!-- Payment Number -->
            ,   V.VND_PMT_METH_CD                    VND_PMT_METH_CD             <!-- Payment Method Code -->
            ,   NVL(CAIH.ARCS_PMT_METH_CD,VPM.VND_PMT_METH_DESC_TXT) VND_PMT_METH_DESC_TXT <!-- Payment Method Name -->
            ,   CAIH.ACCT_INV_STS_CD                 ACCT_INV_STS_CD             <!-- Accounting Invoice Status Code -->
            ,   AIS.ACCT_INV_STS_DESC_TXT            ACCT_INV_STS_DESC_TXT       <!-- Status -->
            ,   CAIH.PRNT_VND_CD                     PRNT_VND_CD                 <!-- Vendor Number -->
            ,   CAIH.CM_INV_MATCH_CD                 CM_INV_MATCH_CD             <!-- Invoice Matching -->
            <!-- START 2020/02/17 [QC#53413, MOD] -->
            <!-- ,   CAIH.PO_NUM                          PO_NUM -->                      <!-- PO Number -->
            ,   CAID.PO_NUM                          PO_NUM                      <!-- PO Number -->
            <!-- END   2020/02/17 [QC#53413, MOD] -->
            ,   CAIH.AC_SC_TOT_GND_INV_AMT           AC_INV_TOT_COST_AMT         <!-- Invoice Amount -->
            ,   CAIH.VND_PMT_TERM_CD                 VND_PMT_TERM_CD             <!-- Payment Term Code -->
            ,   VPT.VND_PMT_TERM_DESC_TXT            VND_PMT_TERM_DESC_TXT       <!-- Terms -->
            ,   CAIH.ARCS_PMT_DT                     PMT_DT                      <!-- Payment Date -->
            ,   NVL(CAIH.ARCS_PMT_AMT,0)             HDR_PMT_AMT                 <!-- Amount Paid -->
            ,   CAIH.PMT_DUE_DT                      TERM_NET_DUE_DT             <!-- Terms Date -->
            ,   PO.PO_APVL_DT                        PO_APVL_DT                  <!-- PO Date -->
            ,   PD_HDR.ENT_PO_DTL_DEAL_NET_AMT       ENT_PO_DTL_DEAL_NET_AMT     <!-- PO Amount -->
            ,   NVL(CAID.DELY_ORD_NUM, CIAD.DELY_ORD_NUM)       DELY_ORD_NUM     <!-- Receipt Number -->
            ,   CAIH.INV_HDR_DESC_TXT                INV_HDR_DESC_TXT            <!-- Description -->
            ,   0                                    AC_OC_TOT_DISC_AMT          <!-- Discount -->
            ,   AIC.AP_INV_CATG_DESC_TXT             AP_INV_CATG_DESC_TXT        <!-- Source -->
            ,   CAIH.INV_AUTH_DT                     INV_AUTH_DT                 <!-- Accounting Date -->
            ,   CAIH.CM_AP_INV_TP_CD                 CM_AP_INV_TP_CD             <!-- Invoice Type -->
            <!-- START 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            ,   CAIH.EZINTIME                        XX_REC_HIST_CRAT_TS
            ,   CAIH.EZINUSERID                      XX_REC_HIST_CRAT_BY_NM
            ,   CAIH.EZUPTIME                        XX_REC_HIST_UPD_TS
            ,   CAIH.EZUPUSERID                      XX_REC_HIST_UPD_BY_NM
            ,   CAIH.EZTABLEID                       XX_REC_HIST_TBL_NM
            <!-- END 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            <!-- START 2017/12/26 [QC#23022,ADD] -->
            ,   CAIH.AP_INV_CATG_CD                  AP_INV_CATG_CD
            <!-- END 2017/12/26 [QC#23022,ADD] -->
            <!-- START 2018/02/27 [QC#23505,ADD] -->
            ,   CAIH.AP_VND_INV_SQ_NUM               AP_VND_INV_SQ_NUM
            <!-- END 2018/02/27 [QC#23505,ADD] -->
            
            <!-- HOLDS TAB -->
            ,   CAIH.PMT_HLD_FLG                     PMT_HLD_FLG
            
             <!-- LINES TAB -->
            ,   CIAD.AP_LINE_TP_CD                   AP_LINE_TP_CD               <!-- Line Type -->
            ,   NVL(CAID.MDSE_CD, CIAD.MDSE_CD)      MDSE_CD                     <!-- Item -->
            ,   NVL(CAID.MDSE_DESC_SHORT_TXT, CIAD.MDSE_DESC_SHORT_TXT)             MDSE_DESC_SHORT_TXT         <!-- Line Description -->
            ,   CASE
                    WHEN CIAD.AP_LINE_TP_CD = #apLineTpItem#
                    THEN NVL(CAID.AC_SC_FOB_COST_AMT, CIAD.AC_INV_JRNL_COST_AMT)
                    WHEN CIAD.AP_LINE_TP_CD &lt;&gt; #apLineTpItem#
                    THEN CIAD.AC_INV_JRNL_COST_AMT
                END                                  LINE_AMT                    <!-- Line Amount -->
            ,   CIAD.UOM_CD                          UOM_CD                      <!-- Unit Of Measure -->
            ,   DECODE(CIAD.DR_COA_CMPY_CD,NULL,NULL,CIAD.DR_COA_CMPY_CD || '.' ||
                                                  CIAD.DR_COA_BR_CD   || '.' ||
                                                  CIAD.DR_COA_CC_CD   || '.' ||
                                                  CIAD.DR_COA_ACCT_CD || '.' ||
                                                  CIAD.DR_COA_PROD_CD || '.' ||
                                                  CIAD.DR_COA_CH_CD   || '.' ||
                                                  CIAD.DR_COA_AFFL_CD || '.' ||
                                                  CIAD.DR_COA_PROJ_CD || '.' ||
                                                  CIAD.DR_COA_EXTN_CD)
                                                     XX_CMNT_TXT                 <!-- Charge Account -->
            ,   CA.COA_ACCT_DESC_TXT                 AP_ACCT_DESC_TXT            <!-- Account Description -->
            <!-- START 2018/06/20 [QC#26169, MOD] -->
            ,   NVL(CAID.ENT_DEAL_NET_UNIT_PRC_AMT, 0)
                                                     ENT_DEAL_NET_UNIT_PRC_AMT   <!-- Unit Price --> 
            <!-- END   2018/06/20 [QC#26169, MOD] -->
            ,   CIAD.INV_QTY                         INV_QTY                     <!-- Invoice Quantity -->
            ,   CIAD.PO_QTY                          PO_QTY                      <!-- Ordered Quantity -->
            ,   CAID.INV_RCV_QTY                     INV_RCV_QTY                 <!-- Received Quantity -->
            ,   CIAD.AP_REJ_QTY                      AP_REJ_QTY                  <!-- Rejected Quantity -->
            ,   CIAD.AP_BILL_QTY                     AP_BILL_QTY                 <!-- Billed Quantity -->
            ,   CIAD.CONTR_NUM                       CONTR_NUM                   <!-- Contract -->
            ,   CIAD.CUST_DLR_CD                     CUST_DLR_CD                 <!-- Dealer Code -->
            ,   CIAD.SER_NUM                         SER_NUM                     <!-- Serial Number -->
            ,   CIAD.CSMP_INV_NUM                    CSMP_INV_NUM                <!-- CSMP Invoice -->
            ,   DECODE(
                    ISTL_LOC_FIRST_LINE_ADDR ||
                    ISTL_LOC_FL_NM           ||
                    ISTL_LOC_CTY_ADDR        ||
                    ISTL_LOC_ST_CD           ||
                    ISTL_LOC_POST_CD
                ,   NULL
                ,   NULL
                ,   ISTL_LOC_FIRST_LINE_ADDR || ', '||
                    ISTL_LOC_FL_NM           || ', '||
                    ISTL_LOC_CTY_ADDR        || ', '||
                    ISTL_LOC_ST_CD           || ', '||
                    ISTL_LOC_POST_CD)                ISTL_LOC                    <!-- Install Location -->
            ,   CSI.CM_STK_IN_PK                     CM_STK_IN_PK
            ,   'Y'                                  INV_ASG_FLG
            ,   DECODE(CSI.ORIG_VND_INV_NUM,NULL,CSI.VND_INV_NUM)
                                                     ORIG_VND_INV_NUM
            ,   DECODE(CSI.ORIG_VND_INV_SQ_NUM,NULL,CSI.VND_INV_SQ_NUM)
                                                     ORIG_VND_INV_SQ_NUM
            ,   DECODE(CSI.ORIG_DELY_ORD_NUM,NULL,CSI.DELY_ORD_NUM)
                                                     ORIG_DELY_ORD_NUM
            ,   NVL(CAID.AP_VND_INV_LINE_NUM, CIAD.AP_VND_INV_LINE_NUM)             AP_VND_INV_LINE_NUM
            ,   CIAD.CM_INV_ACCT_DIST_LINE_NUM       CM_INV_ACCT_DIST_LINE_NUM
            ,   PD.PO_MATCH_TP_CD                    PO_MATCH_TP_CD
            <!-- START 2018/08/14 [QC#27029-1,MOD] -->
            ,   CSI.ENT_FUNC_NET_UNIT_PRC_AMT       CSI_ENT_FUNC_NET_UNIT_PRC_AMT
            ,   CSI.ENT_PO_DTL_FUNC_NET_AMT         CSI_ENT_PO_DTL_FUNC_NET_AMT
            ,   CSI.ENT_DEAL_NET_UNIT_PRC_AMT       CSI_ENT_DEAL_NET_UNIT_PRC_AMT
            ,   CSI.ENT_PO_DTL_DEAL_NET_AMT         CSI_ENT_PO_DTL_DEAL_NET_AMT
            <!-- END   2018/08/14 [QC#27029-1,MOD] -->
            <!-- START 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            ,   CIAD.EZINTIME                        XX_REC_HIST_CRAT_TS_A1
            ,   CIAD.EZINUSERID                      XX_REC_HIST_CRAT_BY_NM_A1
            ,   CIAD.EZUPTIME                        XX_REC_HIST_UPD_TS_A1
            ,   CIAD.EZUPUSERID                      XX_REC_HIST_UPD_BY_NM_A1
            ,   CIAD.EZTABLEID                       XX_REC_HIST_TBL_NM_A1
            <!-- END 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            <!-- DISTRIBUTIONS TAB -->
            ,   CIAD.AC_INV_JRNL_COST_AMT            AC_INV_JRNL_COST_AMT        <!-- Line Amount -->
            ,   CAID.PO_ORD_DTL_LINE_NUM             PO_ORD_DTL_LINE_NUM
            <!-- START 2018/02/26 [QC#23505,ADD] -->
            ,   NVL(CAID.PO_NUM, CIAD.PO_NUM)        LINE_PO_NUM                 <!-- PO# -->
            ,   CIAD.INV_CRCT_DT                     INV_CRCT_DT                 <!-- Correction Date -->
            ,   CIAD.AP_VND_INV_SQ_NUM               LINE_AP_VND_INV_SQ_NUM
            <!-- END   2018/02/26 [QC#23505,ADD] -->
            <!-- START 2018/03/16 [QC#24089,ADD] -->
            ,   PD.PO_LINE_STS_CD                    PO_LINE_STS_CD
            <!-- END   2018/03/16 [QC#24089,ADD] -->
            <!-- START 2018/05/07 [QC#25828,ADD] -->
            ,   PD.PD_ENT_DEAL_NET_UNIT_PRC_AMT      PD_ENT_DEAL_NET_UNIT_PRC_AMT
            <!-- END   2018/05/07 [QC#25828,ADD] -->
            <!-- mod start 2022/02/15 QC#57090 -->
            <!-- ,   CAIH.VND_RTRN_NUM                    VND_RTRN_NUM -->
            ,   CAID.VND_RTRN_NUM                    VND_RTRN_NUM
            <!-- mod end 2022/02/15 QC#57090 -->
            <!-- START 2018/07/17 S.Katsuma [QC#27078,ADD -->
            ,   PD.DISP_PO_DTL_LINE_NUM              DISP_PO_DTL_LINE_NUM
            <!-- END 2018/07/17 S.Katsuma [QC#27078,ADD -->
            <!-- START 2017/08/02 [QC#27025-1,ADD] -->
            ,   CAIH.EZUPTIME                        EZUPTIME
            ,   CAIH.EZUPTIMEZONE                    EZUPTIMEZONE
            <!-- END   2017/08/02 [QC#27025-1,ADD] -->
            <!-- START 2018/08/03 [QC#27563,ADD] -->
            ,   PD.ENT_PO_DTL_DEAL_NET_AMT           ENT_PO_DTL_DEAL_NET_AMT_LINE
            <!-- END   2018/08/03 [QC#27563,ADD] -->
            <!-- START 2018/08/15 [QC#27029-1,ADD] -->
            ,   VRD.VRD_ENT_DEAL_NET_UNIT_PRC_AMT    VRD_ENT_DEAL_NET_UNIT_PRC_AMT
            <!-- END   2018/08/15 [QC#27029-1,ADD] -->

            FROM
                CM_AP_INV_HDR    CAIH
            ,   CM_AP_INV_DTL    CAID
            ,   CM_INV_ACCT_DIST CIAD
            ,   (
                    SELECT
                        PD.PO_ORD_NUM
                    ,   PD.PO_ORD_DTL_LINE_NUM
                    <!-- START 2018/03/16 [QC#24089,ADD] -->
                    ,   PD.PO_LINE_STS_CD
                    <!-- END   2018/03/16 [QC#24089,ADD] -->
                    ,   MIN(PD.PO_MATCH_TP_CD) PO_MATCH_TP_CD
                    ,   MIN(NVL(PD.ENT_DEAL_NET_UNIT_PRC_AMT, 0))           PD_ENT_DEAL_NET_UNIT_PRC_AMT
                    <!-- START 2018/07/17 S.Katsuma [QC#27078,ADD -->
                    ,   MIN(PD.DISP_PO_DTL_LINE_NUM) DISP_PO_DTL_LINE_NUM
                    <!-- END 2018/07/17 S.Katsuma [QC#27078,ADD -->
                    <!-- START 2018/08/03 [QC#27563,ADD] -->
                    ,   MIN(PD.ENT_PO_DTL_DEAL_NET_AMT) ENT_PO_DTL_DEAL_NET_AMT
                    <!-- END   2018/08/03 [QC#27563,ADD] -->
                    FROM
                        PO_DTL    PD
                    WHERE
                        PD.GLBL_CMPY_CD         = #glblCmpyCd#
                    AND PD.EZCANCELFLAG         = '0'
<!-- START 2018/02/26 [QC#23505,MOD] -->
<isNotEqual property="isCorrected" compareValue="Y">
                    AND EXISTS
                            (
                                SELECT
                                    1
                                <!-- START 2020/02/17 [QC#53413, MOD] -->
                                <!-- FROM
                                    CM_AP_INV_HDR    CAIH
                                WHERE
                                    CAIH.GLBL_CMPY_CD      = PD.GLBL_CMPY_CD
                                AND CAIH.AP_VND_CD         = #apVndCd#
                                AND CAIH.AP_VND_INV_NUM    = #apVndInvNum#
                                AND CAIH.AP_VND_INV_SQ_NUM = #apVndInvSqNum#
                                AND CAIH.PO_NUM            = PD.PO_ORD_NUM  -->
                                FROM
                                    CM_AP_INV_HDR    CAIH
                                   ,CM_AP_INV_DTL    CAID
                                WHERE
                                    CAID.GLBL_CMPY_CD      = PD.GLBL_CMPY_CD
                                AND CAID.AP_VND_CD         = #apVndCd#
                                AND CAID.AP_VND_INV_NUM    = #apVndInvNum#
                                AND CAID.AP_VND_INV_SQ_NUM = #apVndInvSqNum#
                                AND CAID.PO_NUM            = PD.PO_ORD_NUM
                                AND CAID.GLBL_CMPY_CD      = CAIH.GLBL_CMPY_CD
                                AND CAID.AP_VND_CD         = CAIH.AP_VND_CD 
                                AND CAID.AP_VND_INV_NUM    = CAIH.AP_VND_INV_NUM
                                AND CAID.AP_VND_INV_SQ_NUM = CAIH.AP_VND_INV_SQ_NUM
                                AND CAID.EZCANCELFLAG      = '0'
                                <!-- END   2020/02/17 [QC#53413, MOD] -->
                                AND CAIH.EZCANCELFLAG      = '0'
                            )
                            
</isNotEqual>
<isEqual property="isCorrected" compareValue="Y">
                    AND EXISTS
                            (
                                SELECT
                                    1
                                FROM
                                    CM_AP_INV_DTL  CAID
                                WHERE
                                    CAID.GLBL_CMPY_CD      = PD.GLBL_CMPY_CD
                                AND CAID.AP_VND_CD         = #apVndCd#
                                AND CAID.AP_VND_INV_NUM    = #apVndInvNum#
                                AND CAID.PO_NUM            = PD.PO_ORD_NUM
                                AND CAID.EZCANCELFLAG      = '0'
                            )
</isEqual>
<!-- END 2018/02/26 [QC#23505,MOD] -->
                    GROUP BY
                        PD.PO_ORD_NUM
                    ,   PD.PO_ORD_DTL_LINE_NUM
                    <!-- START 2018/03/16 [QC#24089,ADD] -->
                    ,   PD.PO_LINE_STS_CD
                    <!-- END   2018/03/16 [QC#24089,ADD] -->
                )                PD
            <!-- START 2018/08/15 [QC#27029-1,ADD] -->
            ,   (
                    SELECT
                        VRD.VND_RTRN_NUM
                    ,   VRD.TRX_LINE_NUM
                    ,   VRD.TRX_LINE_SUB_NUM
                    ,   MIN(NVL(VRD.DEAL_VND_RTRN_UNIT_PRC_AMT, 0))           VRD_ENT_DEAL_NET_UNIT_PRC_AMT
                    FROM
                        VND_RTRN_DTL    VRD
                    WHERE
                        VRD.GLBL_CMPY_CD         = #glblCmpyCd#
                    AND VRD.EZCANCELFLAG         = '0'
                    AND EXISTS
                            (
                                SELECT
                                    1
                                FROM
                                    CM_AP_INV_DTL  CAID
                                WHERE
                                    CAID.GLBL_CMPY_CD      = VRD.GLBL_CMPY_CD
                                AND CAID.AP_VND_CD         = #apVndCd#
                                AND CAID.AP_VND_INV_NUM    = #apVndInvNum#
                                AND CAID.VND_RTRN_NUM      = VRD.VND_RTRN_NUM
                                AND CAID.EZCANCELFLAG      = '0'
                            )
                    GROUP BY
                        VRD.VND_RTRN_NUM
                    ,   VRD.TRX_LINE_NUM
                    ,   VRD.TRX_LINE_SUB_NUM
            ) VRD
            <!-- END   2018/08/15 [QC#27029-1,ADD] -->
            ,   (
                    SELECT
                        PD.PO_ORD_NUM
                    ,   SUM(NVL(PD.ENT_PO_DTL_DEAL_NET_AMT,0)) ENT_PO_DTL_DEAL_NET_AMT
                    FROM
                        PO_DTL PD
                    WHERE
                        PD.GLBL_CMPY_CD        = #glblCmpyCd#
                    AND PD.PO_MDSE_CMPSN_TP_CD &lt;&gt; #poMdseCmpsnTpChild#
                    AND PD.EZCANCELFLAG        = '0'
                    AND EXISTS
                            (
                                SELECT
                                    1
                                <!-- START 2020/02/17 [QC#53413, MOD] -->
                                <!-- FROM
                                    CM_AP_INV_HDR    CAIH
                                WHERE
                                    CAIH.GLBL_CMPY_CD      = PD.GLBL_CMPY_CD
                                AND CAIH.AP_VND_CD         = #apVndCd#
                                AND CAIH.AP_VND_INV_NUM    = #apVndInvNum#
                                AND CAIH.AP_VND_INV_SQ_NUM = #apVndInvSqNum#
                                AND CAIH.PO_NUM            = PD.PO_ORD_NUM -->
                                FROM
                                    CM_AP_INV_HDR    CAIH
                                   ,CM_AP_INV_DTL    CAID
                                WHERE
                                    CAID.GLBL_CMPY_CD      = PD.GLBL_CMPY_CD
                                AND CAID.AP_VND_CD         = #apVndCd#
                                AND CAID.AP_VND_INV_NUM    = #apVndInvNum#
                                AND CAID.AP_VND_INV_SQ_NUM = #apVndInvSqNum#
                                AND CAID.PO_NUM            = PD.PO_ORD_NUM
                                AND CAID.GLBL_CMPY_CD      = CAIH.GLBL_CMPY_CD
                                AND CAID.AP_VND_CD         = CAIH.AP_VND_CD 
                                AND CAID.AP_VND_INV_NUM    = CAIH.AP_VND_INV_NUM
                                AND CAID.AP_VND_INV_SQ_NUM = CAIH.AP_VND_INV_SQ_NUM
                                <!-- START 2018/04/06 [QC#25086,ADD] -->
                                AND (CAIH.CM_AP_INV_TP_CD IN(#cmApInvTpCd01#, #cmApInvTpCd02#) OR CAIH.CM_AP_INV_TP_CD IS NULL)
                                <!-- END   2018/04/06 [QC#25086,ADD] -->
                                AND CAID.EZCANCELFLAG      = '0'
                                AND CAIH.EZCANCELFLAG      = '0'
                                <!-- END   2020/02/17 [QC#53413, MOD] -->
                            )
                    GROUP BY
                        PD.PO_ORD_NUM
                   <!-- START 2018/02/20 [QC#21703,ADD] -->
                   UNION ALL
                    SELECT
                         VR.VND_RTRN_NUM            AS PO_ORD_NUM
                        ,NVL(VR.TOT_VND_RTRN_AMT,0) AS ENT_PO_DTL_DEAL_NET_AMT
                    FROM
                         VND_RTRN VR
                    <!-- mod start 2022/02/15 QC#57090 -->
                    <!--     ,CM_AP_INV_HDR    CAIH -->
                    <!-- WHERE -->
                    <!--     VR.GLBL_CMPY_CD        = 'ADB' -->
                    <!-- AND VR.EZCANCELFLAG        = '0' -->
                    <!-- AND CAIH.GLBL_CMPY_CD      = VR.GLBL_CMPY_CD -->
                    <!-- AND CAIH.AP_INV_CATG_CD    = #apInvCatgCd# -->
                    <!-- AND CAIH.AP_VND_CD         = #apVndCd# -->
                    <!-- AND CAIH.AP_VND_INV_NUM    = #apVndInvNum# -->
                    <!-- AND CAIH.AP_VND_INV_SQ_NUM = #apVndInvSqNum# -->
                    <!-- AND CAIH.VND_RTRN_NUM      = VR.VND_RTRN_NUM -->
                    <!-- START 2018/04/06 [QC#25086,ADD] -->
                    <!-- AND CAIH.CM_AP_INV_TP_CD   = #cmApInvTpCd02# -->
                    <!-- END   2018/04/06 [QC#25086,ADD] -->
                    <!-- AND CAIH.EZCANCELFLAG      = '0' -->
                    <!-- END 2018/02/20 [QC#21703,ADD] -->
                    WHERE
                        VR.GLBL_CMPY_CD        = #glblCmpyCd#
                    AND VR.EZCANCELFLAG        = '0'
                    AND EXISTS
                            (
                                SELECT
                                    1
                                FROM
                                     CM_AP_INV_HDR    CAIH
                                    ,CM_AP_INV_DTL    CAID
                                WHERE
                                    CAIH.GLBL_CMPY_CD      = VR.GLBL_CMPY_CD
                                AND CAIH.AP_VND_CD         = #apVndCd#
                                AND CAIH.AP_VND_INV_NUM    = #apVndInvNum#
                                AND CAIH.AP_VND_INV_SQ_NUM = #apVndInvSqNum#
                                AND CAIH.AP_INV_CATG_CD    = #apInvCatgCd#
                                AND CAIH.CM_AP_INV_TP_CD   = #cmApInvTpCd02#
                                AND CAIH.EZCANCELFLAG      = '0'
                                AND CAIH.GLBL_CMPY_CD      = CAID.GLBL_CMPY_CD
                                AND CAIH.AP_VND_CD         = CAID.AP_VND_CD 
                                AND CAIH.AP_VND_INV_NUM    = CAID.AP_VND_INV_NUM
                                AND CAIH.AP_VND_INV_SQ_NUM = CAID.AP_VND_INV_SQ_NUM
                                AND CAID.VND_RTRN_NUM      = VR.VND_RTRN_NUM
                                AND CAID.EZCANCELFLAG      = '0'
                            )
                    <!-- mod end 2022/02/15 QC#57090 -->
                )                PD_HDR
            ,   (
                    SELECT
                        PV.GLBL_CMPY_CD
                    ,   V.VND_CD
                    ,   PV.PRNT_VND_CD          PRNT_VND_CD
                    ,   PV.PRNT_VND_NM || ' - ' || V.LOC_NM    DPLY_VND_NM
                    ,   V.VND_PMT_METH_CD       VND_PMT_METH_CD
                    FROM
                        PRNT_VND PV
                    ,   VND      V
                    WHERE
                        PV.GLBL_CMPY_CD   = #glblCmpyCd#
                    AND PV.GLBL_CMPY_CD   = V.GLBL_CMPY_CD
                    AND PV.PRNT_VND_PK    = V.PRNT_VND_PK
                    AND V.EZCANCELFLAG    = '0'
                    AND PV.EZCANCELFLAG   = '0'

                )                V
            ,   (
                    SELECT
                        PRNT_VND_CD
                    ,   MAX(PV.PRNT_VND_NM || ' - ' || V.LOC_NM) DPLY_VND_NM
                    FROM
                        PRNT_VND PV
                    ,   VND      V
                    WHERE
                        PV.GLBL_CMPY_CD   = #glblCmpyCd#
                    AND PV.GLBL_CMPY_CD   = V.GLBL_CMPY_CD
                    AND PV.PRNT_VND_PK    = V.PRNT_VND_PK
                    AND V.EZCANCELFLAG    = '0'
                    AND PV.EZCANCELFLAG   = '0'
                    GROUP BY
                        PRNT_VND_CD
                )                PV
            ,   ACCT_INV_STS     AIS
            ,   MDSE             M
            ,   PO               PO
            ,   (
                    SELECT
                        PO_ORD_NUM                                       PO_ORD_NUM
                    ,   PO_ORD_DTL_LINE_NUM                              PO_ORD_DTL_LINE_NUM
                    ,   MIN(CM_STK_IN_PK)                                CM_STK_IN_PK
                    ,   MIN(ORIG_VND_INV_NUM)                            ORIG_VND_INV_NUM
                    ,   MIN(VND_INV_NUM)                                 VND_INV_NUM
                    ,   MIN(ORIG_VND_INV_SQ_NUM)                         ORIG_VND_INV_SQ_NUM
                    ,   MIN(VND_INV_SQ_NUM)                              VND_INV_SQ_NUM
                    ,   MIN(ORIG_DELY_ORD_NUM)                           ORIG_DELY_ORD_NUM
                    ,   MIN(DELY_ORD_NUM)                                DELY_ORD_NUM
                    <!-- START 2018/08/14 [QC#27029-1,ADD] -->
                    ,   SUM(ENT_PO_DTL_DEAL_NET_AMT)                     ENT_PO_DTL_DEAL_NET_AMT
                    ,   MIN(ENT_DEAL_NET_UNIT_PRC_AMT)                   ENT_DEAL_NET_UNIT_PRC_AMT
                    ,   SUM(ENT_PO_DTL_FUNC_NET_AMT)                     ENT_PO_DTL_FUNC_NET_AMT
                    ,   MIN(ENT_FUNC_NET_UNIT_PRC_AMT)                   ENT_FUNC_NET_UNIT_PRC_AMT
                    <!-- END   2018/08/14 [QC#27029-1,ADD] -->

                    FROM
                        CM_STK_IN CSI
                    WHERE
                        CSI.GLBL_CMPY_CD            =     #glblCmpyCd#
                    AND CSI.EZCANCELFLAG            =     '0'
                    AND EXISTS
                            (
                                SELECT
                                    1
                                FROM
                                    CM_INV_ACCT_DIST CIAD
                                WHERE
                                    CIAD.GLBL_CMPY_CD      = CSI.GLBL_CMPY_CD
                                AND CIAD.AP_VND_CD         = #apVndCd#
                                AND CIAD.AP_VND_INV_NUM    = #apVndInvNum#
<!-- START 2018/02/26 [QC#23505,MOD] -->
                            <isNotEqual property="isCorrected" compareValue="Y">
                                AND CIAD.AP_VND_INV_SQ_NUM = #apVndInvSqNum#
                            </isNotEqual>
<!-- END 2018/02/26 [QC#23505,MOD] -->
                                AND CIAD.PO_NUM            = CSI.PO_ORD_NUM
                                AND CIAD.MDSE_CD           = CSI.MDSE_CD
                                AND CIAD.EZCANCELFLAG      = '0'
                            )
                    GROUP BY
                        CSI.PO_ORD_NUM
                    ,   CSI.PO_ORD_DTL_LINE_NUM
                )                CSI
            ,   COA_ACCT         CA
            ,   VND_PMT_METH     VPM
            ,   AP_INV_CATG      AIC
            ,   VND_PMT_TERM     VPT
            WHERE 1 = 1
            AND CAIH.GLBL_CMPY_CD                   =     #glblCmpyCd#
            AND CAIH.AP_VND_CD                      =     #apVndCd#
            AND CAIH.AP_VND_INV_NUM                 =     #apVndInvNum#
            AND CAIH.AP_VND_INV_SQ_NUM              =     #apVndInvSqNum#
            AND CAIH.AP_INV_TP_CD                   =     #apInvTpCd00#
            AND CAIH.EZCANCELFLAG                   =     '0'
            AND CAIH.GLBL_CMPY_CD                   =     CIAD.GLBL_CMPY_CD
            AND CAIH.AP_VND_CD                      =     CIAD.AP_VND_CD
            AND CAIH.AP_VND_INV_NUM                 =     CIAD.AP_VND_INV_NUM
<!-- START 2018/02/26 [QC#23505,MOD] -->
            <isNotEqual property="isCorrected" compareValue="Y">
            AND CAIH.AP_VND_INV_SQ_NUM              =     CIAD.AP_VND_INV_SQ_NUM
            </isNotEqual>
<!-- END 2018/02/26 [QC#23505,MOD] -->
            AND CIAD.EZCANCELFLAG                   =     '0'
            AND CIAD.GLBL_CMPY_CD                   =     CAID.GLBL_CMPY_CD(+)
            AND CIAD.AP_VND_CD                      =     CAID.AP_VND_CD(+)
            AND CIAD.AP_VND_INV_NUM                 =     CAID.AP_VND_INV_NUM(+)
<!-- START 2018/02/26 [QC#23505,MOD] -->
            <isNotEqual property="isCorrected" compareValue="Y">
            AND CIAD.AP_VND_INV_SQ_NUM              =     CAID.AP_VND_INV_SQ_NUM(+)
            </isNotEqual>
<!-- END 2018/02/26 [QC#23505,MOD] -->
            AND CIAD.AP_VND_INV_LINE_NUM            =     CAID.AP_VND_INV_LINE_NUM(+)
            AND CAID.EZCANCELFLAG(+)                =     '0'
<!-- START 2018/02/26 [QC#23505,MOD] -->
            <isEqual property="isCorrected" compareValue="Y">
            AND CIAD.GLBL_CMPY_CD                   =     CAID.GLBL_CMPY_CD(+)
            AND CIAD.AP_VND_CD                      =     CAID.AP_VND_CD(+)
            AND CIAD.AP_VND_INV_NUM                 =     CAID.AP_VND_INV_NUM(+)
            AND CIAD.AP_VND_INV_SQ_NUM              =     CAID.AP_VND_INV_SQ_NUM(+)
            </isEqual>
            AND CAID.PO_NUM                         =     PD.PO_ORD_NUM(+)
            AND CAID.PO_ORD_DTL_LINE_NUM            =     PD.PO_ORD_DTL_LINE_NUM(+)
           <!-- START 2020/05/29 [QC#57034,MOD] -->
           <!--  <isNotEqual property="isCorrected" compareValue="Y">  -->
            AND (CIAD.PO_NUM                         =     PD_HDR.PO_ORD_NUM OR CIAD.VND_RTRN_NUM                         =     PD_HDR.PO_ORD_NUM)
           <!-- </isNotEqual>  -->
           <!-- END 2020/05/29 [QC#57034,MOD] -->
<!-- END 2018/02/26 [QC#23505,MOD] -->
<!-- START 2018/08/15 [QC#27029-1,ADD] -->
            AND CAID.VND_RTRN_NUM                   =     VRD.VND_RTRN_NUM(+)
            AND CAID.PO_ORD_DTL_LINE_NUM            =     VRD.TRX_LINE_NUM(+)
<!-- END   2018/08/15 [QC#27029-1,ADD] -->
            AND CAIH.AP_VND_CD                      =     V.VND_CD(+)
            AND CAIH.PRNT_VND_CD                    =     PV.PRNT_VND_CD(+)
            AND CAIH.GLBL_CMPY_CD                   =     AIS.GLBL_CMPY_CD(+)
            AND CAIH.ACCT_INV_STS_CD                =     AIS.ACCT_INV_STS_CD(+)
            AND '0'                                 =     AIS.EZCANCELFLAG(+)
            AND CIAD.GLBL_CMPY_CD                   =     M.GLBL_CMPY_CD(+)
            AND CIAD.MDSE_CD                        =     M.MDSE_CD(+)
            AND '0'                                 =     M.EZCANCELFLAG(+)
            AND CIAD.GLBL_CMPY_CD                   =     PO.GLBL_CMPY_CD(+)
            AND CIAD.PO_NUM                         =     PO.PO_ORD_NUM(+)
            AND '0'                                 =     PO.EZCANCELFLAG(+)
            AND CAID.PO_NUM                         =     CSI.PO_ORD_NUM(+)
            AND CAID.PO_ORD_DTL_LINE_NUM            =     CSI.PO_ORD_DTL_LINE_NUM(+)
            AND CIAD.GLBL_CMPY_CD                   =     CA.GLBL_CMPY_CD(+)
            AND CIAD.DR_COA_ACCT_CD                 =     CA.COA_ACCT_CD(+)
            AND '0'                                 =     CA.EZCANCELFLAG(+)
            AND V.GLBL_CMPY_CD                      =     VPM.GLBL_CMPY_CD(+)
            AND V.VND_PMT_METH_CD                   =     VPM.VND_PMT_METH_CD(+)
            AND '0'                                 =     VPM.EZCANCELFLAG(+)
            AND CAIH.GLBL_CMPY_CD                   =     AIC.GLBL_CMPY_CD(+)
            AND CAIH.AP_INV_CATG_CD                 =     AIC.AP_INV_CATG_CD(+)
            AND '0'                                 =     AIC.EZCANCELFLAG(+)
            AND CAIH.GLBL_CMPY_CD                   =     VPT.GLBL_CMPY_CD(+)
            AND CAIH.VND_PMT_TERM_CD                =     VPT.VND_PMT_TERM_CD(+)
            AND '0'                                 =     VPT.EZCANCELFLAG(+)
            <!-- START 2020/02/26 [QC#56998, DEL] -->
            <!-- START 2020/02/17 [QC#53413, ADD] -->
            <!-- AND CAID.PO_NUM                         =     PD_HDR.PO_ORD_NUM(+)  -->
            <!-- END   2020/02/17 [QC#53413, ADD] -->
            <!-- END   2020/05/26 [QC#56998, DEL] -->
            <!-- EDI GATEWAY end -->
            <!-- MDSE Return start -->
            UNION ALL
            SELECT
            <!-- Hidden Value for check logic -->
                NULL                                 PO_STS_CD
            <!-- HEADER TAB -->
            ,   NVL(V.DPLY_VND_NM,PV.DPLY_VND_NM)    DPLY_VND_NM                 <!-- Vendor Name -->
            ,   CAIH.AP_VND_CD                       AP_VND_CD                   <!-- Location -->
            ,   CAIH.AP_VND_INV_NUM                  AP_VND_INV_NUM              <!-- Invoice Number -->
            ,   CAIH.INV_DT                          INV_DT                      <!-- Invoice Date -->
            ,   CAIH.PAY_ALONE_FLG                   PAY_ALONE_FLG               <!-- Pay Alone Flag -->
            ,   CAIH.AP_PMT_CHK_NUM                  AP_PMT_CHK_NUM              <!-- Payment Number -->
            ,   V.VND_PMT_METH_CD                    VND_PMT_METH_CD             <!-- Payment Method Code -->
            ,   NVL(CAIH.ARCS_PMT_METH_CD,VPM.VND_PMT_METH_DESC_TXT) VND_PMT_METH_DESC_TXT <!-- Payment Method Name -->
            ,   CAIH.ACCT_INV_STS_CD                 ACCT_INV_STS_CD             <!-- Accounting Invoice Status Code -->
            ,   AIS.ACCT_INV_STS_DESC_TXT            ACCT_INV_STS_DESC_TXT       <!-- Status -->
            ,   CAIH.PRNT_VND_CD                     PRNT_VND_CD                 <!-- Vendor Number -->
            ,   CAIH.CM_INV_MATCH_CD                 CM_INV_MATCH_CD             <!-- Invoice Matching -->
            <!-- START 2020/02/17 [QC#53413, MOD] -->
            <!-- ,   CAIH.PO_NUM                          PO_NUM -->                      <!-- PO Number -->
            ,   CAID.PO_NUM                          PO_NUM                      <!-- PO Number -->
            <!-- START 2020/02/17 [QC#53413, MOD] -->
            ,   CAIH.AC_SC_TOT_GND_INV_AMT           AC_INV_TOT_COST_AMT         <!-- Invoice Amount -->
            ,   CAIH.VND_PMT_TERM_CD                 VND_PMT_TERM_CD             <!-- Payment Term Code -->
            ,   VPT.VND_PMT_TERM_DESC_TXT            VND_PMT_TERM_DESC_TXT       <!-- Terms -->
            ,   CAIH.ARCS_PMT_DT                     PMT_DT                      <!-- Payment Date -->
            ,   NVL(CAIH.ARCS_PMT_AMT,0)             HDR_PMT_AMT                 <!-- Amount Paid -->
            ,   CAIH.PMT_DUE_DT                      TERM_NET_DUE_DT             <!-- Terms Date -->
            ,   NULL                                 PO_APVL_DT                  <!-- PO Date -->
            ,   NVL(VR.TOT_VND_RTRN_AMT,0)           ENT_PO_DTL_DEAL_NET_AMT     <!-- PO Amount -->
            ,   NVL(CAID.DELY_ORD_NUM, CIAD.DELY_ORD_NUM)       DELY_ORD_NUM     <!-- Receipt Number -->
            ,   CAIH.INV_HDR_DESC_TXT                INV_HDR_DESC_TXT            <!-- Description -->
            ,   0                                    AC_OC_TOT_DISC_AMT          <!-- Discount -->
            ,   AIC.AP_INV_CATG_DESC_TXT             AP_INV_CATG_DESC_TXT        <!-- Source -->
            ,   CAIH.INV_AUTH_DT                     INV_AUTH_DT                 <!-- Accounting Date -->
            ,   CAIH.CM_AP_INV_TP_CD                 CM_AP_INV_TP_CD             <!-- Invoice Type -->
            <!-- START 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            ,   CAIH.EZINTIME                        XX_REC_HIST_CRAT_TS
            ,   CAIH.EZINUSERID                      XX_REC_HIST_CRAT_BY_NM
            ,   CAIH.EZUPTIME                        XX_REC_HIST_UPD_TS
            ,   CAIH.EZUPUSERID                      XX_REC_HIST_UPD_BY_NM
            ,   CAIH.EZTABLEID                       XX_REC_HIST_TBL_NM
            <!-- END 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            <!-- START 2017/12/26 [QC#23022,ADD] -->
            ,   CAIH.AP_INV_CATG_CD                  AP_INV_CATG_CD
            <!-- END 2017/12/26 [QC#23022,ADD] -->
            <!-- START 2018/02/27 [QC#23505,ADD] -->
            ,   CAIH.AP_VND_INV_SQ_NUM               AP_VND_INV_SQ_NUM
            <!-- END 2018/02/27 [QC#23505,ADD] -->
            
            <!-- HOLDS TAB -->
            ,   CAIH.PMT_HLD_FLG                     PMT_HLD_FLG
            
             <!-- LINES TAB -->
            ,   CIAD.AP_LINE_TP_CD                   AP_LINE_TP_CD               <!-- Line Type -->
            ,   NVL(CAID.MDSE_CD, CIAD.MDSE_CD)      MDSE_CD                     <!-- Item -->
            ,   NVL(CAID.MDSE_DESC_SHORT_TXT, CIAD.MDSE_DESC_SHORT_TXT)             MDSE_DESC_SHORT_TXT         <!-- Line Description -->
            ,   CASE
                    WHEN CIAD.AP_LINE_TP_CD = #apLineTpItem#
                    THEN NVL(CAID.AC_SC_FOB_COST_AMT, CIAD.AC_INV_JRNL_COST_AMT)
                    WHEN CIAD.AP_LINE_TP_CD &lt;&gt; #apLineTpItem#
                    THEN CIAD.AC_INV_JRNL_COST_AMT
                END                                  LINE_AMT                    <!-- Line Amount -->
            ,   CIAD.UOM_CD                          UOM_CD                      <!-- Unit Of Measure -->
            ,   DECODE(CIAD.DR_COA_CMPY_CD,NULL,NULL,CIAD.DR_COA_CMPY_CD || '.' ||
                                                  CIAD.DR_COA_BR_CD   || '.' ||
                                                  CIAD.DR_COA_CC_CD   || '.' ||
                                                  CIAD.DR_COA_ACCT_CD || '.' ||
                                                  CIAD.DR_COA_PROD_CD || '.' ||
                                                  CIAD.DR_COA_CH_CD   || '.' ||
                                                  CIAD.DR_COA_AFFL_CD || '.' ||
                                                  CIAD.DR_COA_PROJ_CD || '.' ||
                                                  CIAD.DR_COA_EXTN_CD)
                                                     XX_CMNT_TXT                 <!-- Charge Account -->
            ,   CA.COA_ACCT_DESC_TXT                 AP_ACCT_DESC_TXT            <!-- Account Description -->
            ,   NVL(CIAD.ENT_DEAL_NET_UNIT_PRC_AMT, 0)
                                                     ENT_DEAL_NET_UNIT_PRC_AMT   <!-- Unit Price -->
            ,   CIAD.INV_QTY                         INV_QTY                     <!-- Invoice Quantity -->
            ,   CIAD.PO_QTY                          PO_QTY                      <!-- Ordered Quantity -->
            ,   CAID.INV_RCV_QTY                     INV_RCV_QTY                 <!-- Received Qunatity -->
            ,   CIAD.AP_REJ_QTY                      AP_REJ_QTY                  <!-- Rejected Quantity -->
            ,   CIAD.AP_BILL_QTY                     AP_BILL_QTY                 <!-- Billed Quantity -->
            ,   CIAD.CONTR_NUM                       CONTR_NUM                   <!-- Contract -->
            ,   CIAD.CUST_DLR_CD                     CUST_DLR_CD                 <!-- Dealer Code -->
            ,   CIAD.SER_NUM                         SER_NUM                     <!-- Serial Number -->
            ,   CIAD.CSMP_INV_NUM                    CSMP_INV_NUM                <!-- CSMP Invoice -->
            ,   DECODE(
                    ISTL_LOC_FIRST_LINE_ADDR ||
                    ISTL_LOC_FL_NM           ||
                    ISTL_LOC_CTY_ADDR        ||
                    ISTL_LOC_ST_CD           ||
                    ISTL_LOC_POST_CD
                ,   NULL
                ,   NULL
                ,   ISTL_LOC_FIRST_LINE_ADDR || ', '||
                    ISTL_LOC_FL_NM           || ', '||
                    ISTL_LOC_CTY_ADDR        || ', '||
                    ISTL_LOC_ST_CD           || ', '||
                    ISTL_LOC_POST_CD)                ISTL_LOC                    <!-- Install Location -->
            ,   CSI.CM_STK_IN_PK                     CM_STK_IN_PK
            ,   'Y'                                  INV_ASG_FLG
            ,   DECODE(CSI.ORIG_VND_INV_NUM,NULL,CSI.VND_INV_NUM)
                                                     ORIG_VND_INV_NUM
            ,   DECODE(CSI.ORIG_VND_INV_SQ_NUM,NULL,CSI.VND_INV_SQ_NUM)
                                                     ORIG_VND_INV_SQ_NUM
            ,   DECODE(CSI.ORIG_DELY_ORD_NUM,NULL,CSI.DELY_ORD_NUM)
                                                     ORIG_DELY_ORD_NUM
            ,   NVL(CAID.AP_VND_INV_LINE_NUM, CIAD.AP_VND_INV_LINE_NUM)             AP_VND_INV_LINE_NUM
            ,   CIAD.CM_INV_ACCT_DIST_LINE_NUM       CM_INV_ACCT_DIST_LINE_NUM
            ,   NULL                                 PO_MATCH_TP_CD
            ,   CIAD.ENT_FUNC_NET_UNIT_PRC_AMT       CSI_ENT_FUNC_NET_UNIT_PRC_AMT
            ,   CIAD.ENT_PO_DTL_FUNC_NET_AMT         CSI_ENT_PO_DTL_FUNC_NET_AMT
            ,   CIAD.ENT_DEAL_NET_UNIT_PRC_AMT       CSI_ENT_DEAL_NET_UNIT_PRC_AMT
            ,   CIAD.ENT_PO_DTL_DEAL_NET_AMT         CSI_ENT_PO_DTL_DEAL_NET_AMT
            <!-- START 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            ,   CIAD.EZINTIME                        XX_REC_HIST_CRAT_TS_A1
            ,   CIAD.EZINUSERID                      XX_REC_HIST_CRAT_BY_NM_A1
            ,   CIAD.EZUPTIME                        XX_REC_HIST_UPD_TS1_A1
            ,   CIAD.EZUPUSERID                      XX_REC_HIST_UPD_BY_NM_A1
            ,   CIAD.EZTABLEID                       XX_REC_HIST_TBL_NM_A1
            <!-- END 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            <!-- DISTRIBUTIONS TAB -->
            ,   CIAD.AC_INV_JRNL_COST_AMT            AC_INV_JRNL_COST_AMT        <!-- Line Amount -->
            ,   CAID.PO_ORD_DTL_LINE_NUM             PO_ORD_DTL_LINE_NUM
            <!-- START 2018/02/26 [QC#23505,ADD] -->
            ,   NVL(CAID.PO_NUM, CIAD.PO_NUM)        LINE_PO_NUM                 <!-- PO# -->
            ,   NULL                                 INV_CRCT_DT                 <!-- Correction Date -->
            ,   CIAD.AP_VND_INV_SQ_NUM               LINE_AP_VND_INV_SQ_NUM
            <!-- END   2018/02/26 [QC#23505,ADD] -->
            <!-- START 2018/03/16 [QC#24089,ADD] -->
            ,   NULL                                 PO_LINE_STS_CD
            <!-- END   2018/03/16 [QC#24089,ADD] -->
            <!-- START 2018/05/07 [QC#25828,ADD] -->
            ,   NULL                                 PD_ENT_DEAL_NET_UNIT_PRC_AMT
            <!-- END   2018/05/07 [QC#25828,ADD] -->
            <!-- mod start 2022/02/15 QC#57090 -->
            <!-- ,   CAIH.VND_RTRN_NUM                    VND_RTRN_NUM -->
            ,   CAID.VND_RTRN_NUM                    VND_RTRN_NUM
            <!-- mod end 2022/02/15 QC#57090 -->
            <!-- START 2018/07/17 S.Katsuma [QC#27078,ADD -->
            ,   NULL                                 DISP_PO_DTL_LINE_NUM
            <!-- END 2018/07/17 S.Katsuma [QC#27078,ADD -->
            <!-- START 2017/08/02 [QC#27025-1,ADD] -->
            ,   CAIH.EZUPTIME                        EZUPTIME
            ,   CAIH.EZUPTIMEZONE                    EZUPTIMEZONE
            <!-- END   2017/08/02 [QC#27025-1,ADD] -->
            <!-- START 2018/08/03 [QC#27563,ADD] -->
            ,   NULL                                 ENT_PO_DTL_DEAL_NET_AMT_LINE
            <!-- END   2018/08/03 [QC#27563,ADD] -->
            <!-- START 2018/08/15 [QC#27029-1,ADD] -->
            ,   NULL                                 VRD_ENT_DEAL_NET_UNIT_PRC_AMT
            <!-- END   2018/08/15 [QC#27029-1,ADD] -->
            FROM
                CM_AP_INV_HDR    CAIH
            ,   CM_AP_INV_DTL    CAID
            ,   CM_INV_ACCT_DIST CIAD
            ,   VND_RTRN         VR
            ,   (
                    SELECT
                        PV.GLBL_CMPY_CD
                    ,   V.VND_CD
                    ,   PV.PRNT_VND_CD          PRNT_VND_CD
                    ,   PV.PRNT_VND_NM || ' - ' || V.LOC_NM DPLY_VND_NM
                    ,   V.VND_PMT_METH_CD       VND_PMT_METH_CD
                    FROM
                        PRNT_VND PV
                    ,   VND      V
                    WHERE
                        PV.GLBL_CMPY_CD   = #glblCmpyCd#
                    AND PV.GLBL_CMPY_CD   = V.GLBL_CMPY_CD
                    AND PV.PRNT_VND_PK    = V.PRNT_VND_PK
                    AND V.EZCANCELFLAG    = '0'
                    AND PV.EZCANCELFLAG   = '0'
                )                V
            ,   (
                    SELECT
                        PRNT_VND_CD
                    ,   MAX(PV.PRNT_VND_NM || ' - ' || V.LOC_NM) DPLY_VND_NM
                    FROM
                        PRNT_VND PV
                    ,   VND      V
                    WHERE
                        PV.GLBL_CMPY_CD   = #glblCmpyCd#
                    AND PV.GLBL_CMPY_CD   = V.GLBL_CMPY_CD
                    AND PV.PRNT_VND_PK    = V.PRNT_VND_PK
                    AND V.EZCANCELFLAG    = '0'
                    AND PV.EZCANCELFLAG   = '0'
                    GROUP BY
                        PRNT_VND_CD
                )                PV
            ,   ACCT_INV_STS     AIS
            ,   MDSE             M
            ,   (
                    SELECT
                        PO_ORD_NUM                                       PO_ORD_NUM
                    ,   MDSE_CD                                          MDSE_CD
                    ,   MIN(CM_STK_IN_PK)                                CM_STK_IN_PK
                    ,   MIN(ORIG_VND_INV_NUM)                            ORIG_VND_INV_NUM
                    ,   MIN(VND_INV_NUM)                                 VND_INV_NUM
                    ,   MIN(ORIG_VND_INV_SQ_NUM)                         ORIG_VND_INV_SQ_NUM
                    ,   MIN(VND_INV_SQ_NUM)                              VND_INV_SQ_NUM
                    ,   MIN(ORIG_DELY_ORD_NUM)                           ORIG_DELY_ORD_NUM
                    ,   MIN(DELY_ORD_NUM)                                DELY_ORD_NUM
                    FROM
                        CM_STK_IN CSI
                    WHERE
                        CSI.GLBL_CMPY_CD            =     #glblCmpyCd#
                    AND CSI.EZCANCELFLAG            =     '0'
                    AND EXISTS
                            (
                                SELECT
                                    1
                                FROM
                                    CM_INV_ACCT_DIST CIAD
                                WHERE
                                    CIAD.GLBL_CMPY_CD      = CSI.GLBL_CMPY_CD
                                AND CIAD.AP_VND_CD         = #apVndCd#
                                AND CIAD.AP_VND_INV_NUM    = #apVndInvNum#
                                AND CIAD.AP_VND_INV_SQ_NUM = #apVndInvSqNum#
                                AND CIAD.PO_NUM            = CSI.PO_ORD_NUM
                                AND CIAD.MDSE_CD           = CSI.MDSE_CD
                                AND CIAD.EZCANCELFLAG      = '0'
                            )
                    GROUP BY
                        CSI.PO_ORD_NUM
                    ,   CSI.MDSE_CD
                )                CSI
            ,   COA_ACCT         CA
            ,   VND_PMT_METH     VPM
            ,   AP_INV_CATG      AIC
            ,   VND_PMT_TERM     VPT
            WHERE 1 = 1
            AND CAIH.GLBL_CMPY_CD                   =     #glblCmpyCd#
            AND CAIH.AP_VND_CD                      =     #apVndCd#
            AND CAIH.AP_VND_INV_NUM                 =     #apVndInvNum#
            AND CAIH.AP_VND_INV_SQ_NUM              =     #apVndInvSqNum#
            AND CAIH.AP_INV_TP_CD                   =     #apInvTpCd02#
            AND CAIH.EZCANCELFLAG                   =     '0'
            AND CAIH.GLBL_CMPY_CD                   =     CIAD.GLBL_CMPY_CD
            AND CAIH.AP_VND_CD                      =     CIAD.AP_VND_CD
            AND CAIH.AP_VND_INV_NUM                 =     CIAD.AP_VND_INV_NUM
            AND CAIH.AP_VND_INV_SQ_NUM              =     CIAD.AP_VND_INV_SQ_NUM
            AND CIAD.EZCANCELFLAG                   =     '0'
            AND CIAD.GLBL_CMPY_CD                   =     CAID.GLBL_CMPY_CD(+)
            AND CIAD.AP_VND_CD                      =     CAID.AP_VND_CD(+)
            AND CIAD.AP_VND_INV_NUM                 =     CAID.AP_VND_INV_NUM(+)
            AND CIAD.AP_VND_INV_SQ_NUM              =     CAID.AP_VND_INV_SQ_NUM(+)
            AND CIAD.AP_VND_INV_LINE_NUM            =     CAID.AP_VND_INV_LINE_NUM(+)
            AND CAID.EZCANCELFLAG(+)                =     '0'
            AND CIAD.GLBL_CMPY_CD                   =     VR.GLBL_CMPY_CD
            AND CIAD.VND_RTRN_NUM                   =     VR.VND_RTRN_NUM
            AND CAIH.AP_VND_CD                      =     V.VND_CD(+)
            AND CAIH.PRNT_VND_CD                    =     PV.PRNT_VND_CD(+)
            AND CAIH.GLBL_CMPY_CD                   =     AIS.GLBL_CMPY_CD(+)
            AND CAIH.ACCT_INV_STS_CD                =     AIS.ACCT_INV_STS_CD(+)
            AND '0'                                 =     AIS.EZCANCELFLAG(+)
            AND CIAD.GLBL_CMPY_CD                   =     M.GLBL_CMPY_CD(+)
            AND CIAD.MDSE_CD                        =     M.MDSE_CD(+)
            AND '0'                                 =     M.EZCANCELFLAG(+)
            AND CIAD.PO_NUM                         =     CSI.PO_ORD_NUM(+)
            AND CIAD.MDSE_CD                        =     CSI.MDSE_CD(+)
            AND CIAD.GLBL_CMPY_CD                   =     CA.GLBL_CMPY_CD(+)
            AND CIAD.DR_COA_ACCT_CD                 =     CA.COA_ACCT_CD(+)
            AND '0'                                 =     CA.EZCANCELFLAG(+)
            AND V.GLBL_CMPY_CD                      =     VPM.GLBL_CMPY_CD(+)
            AND V.VND_PMT_METH_CD                   =     VPM.VND_PMT_METH_CD(+)
            AND '0'                                 =     VPM.EZCANCELFLAG(+)
            AND CAIH.GLBL_CMPY_CD                   =     AIC.GLBL_CMPY_CD(+)
            AND CAIH.AP_INV_CATG_CD                 =     AIC.AP_INV_CATG_CD(+)
            AND '0'                                 =     AIC.EZCANCELFLAG(+)
            AND CAIH.GLBL_CMPY_CD                   =     VPT.GLBL_CMPY_CD(+)
            AND CAIH.VND_PMT_TERM_CD                =     VPT.VND_PMT_TERM_CD(+)
            AND '0'                                 =     VPT.EZCANCELFLAG(+)
            <!-- MDSE Return end -->
            <!-- Not exists PO Number and Vendor Return Number start -->
            UNION ALL
            SELECT
            <!-- Hidden Value for check logic -->
                NULL                                 PO_STS_CD
            <!-- HEADER TAB -->
            ,   NVL(V.DPLY_VND_NM,PV.DPLY_VND_NM)    DPLY_VND_NM                 <!-- Vendor Name -->
            ,   CAIH.AP_VND_CD                       AP_VND_CD                   <!-- Location -->
            ,   CAIH.AP_VND_INV_NUM                  AP_VND_INV_NUM              <!-- Invoice Number -->
            ,   CAIH.INV_DT                          INV_DT                      <!-- Invoice Date -->
            ,   CAIH.PAY_ALONE_FLG                   PAY_ALONE_FLG               <!-- Pay Alone Flag -->
            ,   CAIH.AP_PMT_CHK_NUM                  AP_PMT_CHK_NUM              <!-- Payment Number -->
            ,   V.VND_PMT_METH_CD                    VND_PMT_METH_CD             <!-- Payment Method Code -->
            ,   NVL(CAIH.ARCS_PMT_METH_CD,VPM.VND_PMT_METH_DESC_TXT) VND_PMT_METH_DESC_TXT <!-- Payment Method Name -->
            ,   CAIH.ACCT_INV_STS_CD                 ACCT_INV_STS_CD             <!-- Accounting Invoice Status Code -->
            ,   AIS.ACCT_INV_STS_DESC_TXT            ACCT_INV_STS_DESC_TXT       <!-- Status -->
            ,   CAIH.PRNT_VND_CD                     PRNT_VND_CD                 <!-- Vendor Number -->
            ,   CAIH.CM_INV_MATCH_CD                 CM_INV_MATCH_CD             <!-- Invoice Matching -->
            <!-- START 2020/02/17 [QC#53413, MOD] -->
            <!-- ,   CAIH.PO_NUM                          PO_NUM -->                      <!-- PO Number -->
            ,   CAID.PO_NUM                          PO_NUM                      <!-- PO Number -->
            <!-- START 2020/02/17 [QC#53413, MOD] -->
            ,   CAIH.AC_SC_TOT_GND_INV_AMT           AC_INV_TOT_COST_AMT         <!-- Invoice Amount -->
            ,   CAIH.VND_PMT_TERM_CD                 VND_PMT_TERM_CD             <!-- Payment Term Code -->
            ,   VPT.VND_PMT_TERM_DESC_TXT            VND_PMT_TERM_DESC_TXT       <!-- Terms -->
            ,   CAIH.ARCS_PMT_DT                     PMT_DT                      <!-- Payment Date -->
            ,   NVL(CAIH.ARCS_PMT_AMT,0)             HDR_PMT_AMT                 <!-- Amount Paid -->
            ,   CAIH.PMT_DUE_DT                      TERM_NET_DUE_DT             <!-- Terms Date -->
            ,   NULL                                 PO_APVL_DT                  <!-- PO Date -->
            ,   0                                    ENT_PO_DTL_DEAL_NET_AMT     <!-- PO Amount -->
            ,   NVL(CAID.DELY_ORD_NUM, CIAD.DELY_ORD_NUM)       DELY_ORD_NUM     <!-- Receipt Number -->
            ,   CAIH.INV_HDR_DESC_TXT                INV_HDR_DESC_TXT            <!-- Description -->
            ,   0                                    AC_OC_TOT_DISC_AMT          <!-- Discount -->
            ,   AIC.AP_INV_CATG_DESC_TXT             AP_INV_CATG_DESC_TXT        <!-- Source -->
            ,   CAIH.INV_AUTH_DT                     INV_AUTH_DT                 <!-- Accounting Date -->
            ,   CAIH.CM_AP_INV_TP_CD                 CM_AP_INV_TP_CD             <!-- Invoice Type -->
            <!-- START 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            ,   CAIH.EZINTIME                        XX_REC_HIST_CRAT_TS
            ,   CAIH.EZINUSERID                      XX_REC_HIST_CRAT_BY_NM
            ,   CAIH.EZUPTIME                        XX_REC_HIST_UPD_TS
            ,   CAIH.EZUPUSERID                      XX_REC_HIST_UPD_BY_NM
            ,   CAIH.EZTABLEID                       XX_REC_HIST_TBL_NM
            <!-- END 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            <!-- START 2017/12/26 [QC#23022,ADD] -->
            ,   CAIH.AP_INV_CATG_CD                  AP_INV_CATG_CD
            <!-- END 2017/12/26 [QC#23022,ADD] -->
            <!-- START 2018/02/27 [QC#23505,ADD] -->
            ,   CAIH.AP_VND_INV_SQ_NUM               AP_VND_INV_SQ_NUM
            <!-- END 2018/02/27 [QC#23505,ADD] -->
            
            <!-- HOLDS TAB -->
            ,   CAIH.PMT_HLD_FLG                     PMT_HLD_FLG
            
             <!-- LINES TAB -->
            ,   CIAD.AP_LINE_TP_CD                   AP_LINE_TP_CD               <!-- Line Type -->
            ,   NVL(CAID.MDSE_CD, CIAD.MDSE_CD)      MDSE_CD                     
            ,   NVL(CAID.MDSE_DESC_SHORT_TXT, CIAD.MDSE_DESC_SHORT_TXT) MDSE_DESC_SHORT_TXT         <!-- Line Description -->
            ,   CASE
                    WHEN CIAD.AP_LINE_TP_CD = #apLineTpItem#
                    THEN NVL(CAID.AC_SC_FOB_COST_AMT, CIAD.AC_INV_JRNL_COST_AMT)
                    WHEN CIAD.AP_LINE_TP_CD &lt;&gt; #apLineTpItem#
                    THEN CIAD.AC_INV_JRNL_COST_AMT
                END                                  LINE_AMT                    <!-- Line Amount -->
            ,   CIAD.UOM_CD                          UOM_CD                      <!-- Unit Of Measure -->
            ,   DECODE(CIAD.DR_COA_CMPY_CD,NULL,NULL,CIAD.DR_COA_CMPY_CD || '.' ||
                                                  CIAD.DR_COA_BR_CD   || '.' ||
                                                  CIAD.DR_COA_CC_CD   || '.' ||
                                                  CIAD.DR_COA_ACCT_CD || '.' ||
                                                  CIAD.DR_COA_PROD_CD || '.' ||
                                                  CIAD.DR_COA_CH_CD   || '.' ||
                                                  CIAD.DR_COA_AFFL_CD || '.' ||
                                                  CIAD.DR_COA_PROJ_CD || '.' ||
                                                  CIAD.DR_COA_EXTN_CD)
                                                     XX_CMNT_TXT                 <!-- Charge Account -->
            ,   CA.COA_ACCT_DESC_TXT                 AP_ACCT_DESC_TXT            <!-- Account Description -->
            ,   NVL(CIAD.ENT_DEAL_NET_UNIT_PRC_AMT, 0)
                                                     ENT_DEAL_NET_UNIT_PRC_AMT   <!-- Unit Price -->
            ,   CIAD.INV_QTY                         INV_QTY                     <!-- Invoice Quantity -->
            ,   CIAD.PO_QTY                          PO_QTY                      <!-- Ordered Quantity -->
            ,   CAID.INV_RCV_QTY                     INV_RCV_QTY                 <!-- Received Quantity -->
            ,   CIAD.AP_REJ_QTY                      AP_REJ_QTY                  <!-- Rejected Quantity -->
            ,   CIAD.AP_BILL_QTY                     AP_BILL_QTY                 <!-- Billed Quantity -->
            ,   CIAD.CONTR_NUM                       CONTR_NUM                   <!-- Contract -->
            ,   CIAD.CUST_DLR_CD                     CUST_DLR_CD                 <!-- Dealer Code -->
            ,   CIAD.SER_NUM                         SER_NUM                     <!-- Serial Number -->
            ,   CIAD.CSMP_INV_NUM                    CSMP_INV_NUM                <!-- CSMP Invoice -->
            ,   DECODE(
                    ISTL_LOC_FIRST_LINE_ADDR ||
                    ISTL_LOC_FL_NM           ||
                    ISTL_LOC_CTY_ADDR        ||
                    ISTL_LOC_ST_CD           ||
                    ISTL_LOC_POST_CD
                ,   NULL
                ,   NULL
                ,   ISTL_LOC_FIRST_LINE_ADDR || ', '||
                    ISTL_LOC_FL_NM           || ', '||
                    ISTL_LOC_CTY_ADDR        || ', '||
                    ISTL_LOC_ST_CD           || ', '||
                    ISTL_LOC_POST_CD)                ISTL_LOC                    <!-- Install Location -->
            ,   NULL                                 CM_STK_IN_PK
            ,   'Y'                                  INV_ASG_FLG
            ,   NULL                                 ORIG_VND_INV_NUM
            ,   NULL                                 ORIG_VND_INV_SQ_NUM
            ,   NULL                                 ORIG_DELY_ORD_NUM
            ,   NVL(CAID.AP_VND_INV_LINE_NUM, CIAD.AP_VND_INV_LINE_NUM)             AP_VND_INV_LINE_NUM
            ,   CIAD.CM_INV_ACCT_DIST_LINE_NUM       CM_INV_ACCT_DIST_LINE_NUM
            ,   NULL                                 PO_MATCH_TP_CD
            ,   CIAD.ENT_FUNC_NET_UNIT_PRC_AMT       CSI_ENT_FUNC_NET_UNIT_PRC_AMT
            ,   CIAD.ENT_PO_DTL_FUNC_NET_AMT         CSI_ENT_PO_DTL_FUNC_NET_AMT
            ,   CIAD.ENT_DEAL_NET_UNIT_PRC_AMT       CSI_ENT_DEAL_NET_UNIT_PRC_AMT
            ,   CIAD.ENT_PO_DTL_DEAL_NET_AMT         CSI_ENT_PO_DTL_DEAL_NET_AMT
            <!-- START 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            ,   CIAD.EZINTIME                        XX_REC_HIST_CRAT_TS_A1
            ,   CIAD.EZINUSERID                      XX_REC_HIST_CRAT_BY_NM_A1
            ,   CIAD.EZUPTIME                        XX_REC_HIST_UPD_TS_A1
            ,   CIAD.EZUPUSERID                      XX_REC_HIST_UPD_BY_NM_A1
            ,   CIAD.EZTABLEID                       XX_REC_HIST_TBL_NM_A1
            <!-- END 2017/03/16 E.Kameishi [QC#14205,ADD] -->
            <!-- DISTRIBUTIONS TAB -->
            ,   CIAD.AC_INV_JRNL_COST_AMT            AC_INV_JRNL_COST_AMT        <!-- Line Amount -->
            ,   CAID.PO_ORD_DTL_LINE_NUM             PO_ORD_DTL_LINE_NUM
            <!-- START 2018/02/26 [QC#23505,ADD] -->
            ,   NVL(CAID.PO_NUM, CIAD.PO_NUM)        LINE_PO_NUM                 <!-- PO# -->
            ,   NULL                                 INV_CRCT_DT                 <!-- Correction Date -->
            ,   CIAD.AP_VND_INV_SQ_NUM               LINE_AP_VND_INV_SQ_NUM
            <!-- END   2018/02/26 [QC#23505,ADD] -->
            <!-- START 2018/03/16 [QC#24089,ADD] -->
            ,   NULL                                 PO_LINE_STS_CD
            <!-- END   2018/03/16 [QC#24089,ADD] -->
            <!-- START 2018/05/07 [QC#25828,ADD] -->
            ,   NULL                                 PD_ENT_DEAL_NET_UNIT_PRC_AMT
            <!-- END   2018/05/07 [QC#25828,ADD] -->
            <!-- mod start 2022/02/15 QC#57090 -->
            <!-- ,   CAIH.VND_RTRN_NUM                    VND_RTRN_NUM -->
            ,   CAID.VND_RTRN_NUM                    VND_RTRN_NUM
            <!-- mod end 2022/02/15 QC#57090 -->
            <!-- START 2018/07/17 S.Katsuma [QC#27078,ADD -->
            ,   NULL                                 DISP_PO_DTL_LINE_NUM
            <!-- END 2018/07/17 S.Katsuma [QC#27078,ADD -->
            <!-- START 2017/08/02 [QC#27025-1,ADD] -->
            ,   CAIH.EZUPTIME                        EZUPTIME
            ,   CAIH.EZUPTIMEZONE                    EZUPTIMEZONE
            <!-- END   2017/08/02 [QC#27025-1,ADD] -->
            <!-- START 2018/08/03 [QC#27563,ADD] -->
            ,   NULL                                 ENT_PO_DTL_DEAL_NET_AMT_LINE
            <!-- END   2018/08/03 [QC#27563,ADD] -->
            <!-- START 2018/08/15 [QC#27029-1,ADD] -->
            ,   NULL                                 VRD_ENT_DEAL_NET_UNIT_PRC_AMT
            <!-- END   2018/08/15 [QC#27029-1,ADD] -->
            FROM
                CM_AP_INV_HDR    CAIH
            ,   CM_AP_INV_DTL    CAID
            ,   CM_INV_ACCT_DIST CIAD
            ,   (
                    SELECT
                        PV.GLBL_CMPY_CD
                    ,   V.VND_CD
                    ,   PV.PRNT_VND_CD          PRNT_VND_CD
                    ,   PV.PRNT_VND_NM || ' - ' || V.LOC_NM    DPLY_VND_NM
                    ,   V.VND_PMT_METH_CD      VND_PMT_METH_CD
                    FROM
                        PRNT_VND PV
                    ,   VND      V
                    WHERE
                        PV.GLBL_CMPY_CD   = #glblCmpyCd#
                    AND PV.GLBL_CMPY_CD   = V.GLBL_CMPY_CD
                    AND PV.PRNT_VND_PK    = V.PRNT_VND_PK
                    AND V.EZCANCELFLAG    = '0'
                    AND PV.EZCANCELFLAG   = '0'
                )                V
            ,   (
                    SELECT
                        PRNT_VND_CD
                    ,   MAX(PV.PRNT_VND_NM || ' - ' || V.LOC_NM) DPLY_VND_NM
                    FROM
                        PRNT_VND PV
                    ,   VND      V
                    WHERE
                        PV.GLBL_CMPY_CD   = #glblCmpyCd#
                    AND PV.GLBL_CMPY_CD   = V.GLBL_CMPY_CD
                    AND PV.PRNT_VND_PK    = V.PRNT_VND_PK
                    AND V.EZCANCELFLAG    = '0'
                    AND PV.EZCANCELFLAG   = '0'
                    GROUP BY
                        PRNT_VND_CD
                )                PV
            ,   ACCT_INV_STS     AIS
            ,   MDSE             M
            ,   COA_ACCT         CA
            ,   VND_PMT_METH     VPM
            ,   AP_INV_CATG      AIC
            ,   VND_PMT_TERM     VPT
            WHERE 1 = 1
            AND CAIH.GLBL_CMPY_CD                   =     #glblCmpyCd#
            AND CAIH.AP_VND_CD                      =     #apVndCd#
            AND CAIH.AP_VND_INV_NUM                 =     #apVndInvNum#
            AND CAIH.AP_VND_INV_SQ_NUM              =     #apVndInvSqNum#
            AND CAIH.EZCANCELFLAG                   =     '0'
            AND CAIH.GLBL_CMPY_CD                   =     CIAD.GLBL_CMPY_CD
            AND CAIH.AP_VND_CD                      =     CIAD.AP_VND_CD
            AND CAIH.AP_VND_INV_NUM                 =     CIAD.AP_VND_INV_NUM
            AND CAIH.AP_VND_INV_SQ_NUM              =     CIAD.AP_VND_INV_SQ_NUM
            AND CIAD.EZCANCELFLAG                   =     '0'
            AND CIAD.GLBL_CMPY_CD                   =     CAID.GLBL_CMPY_CD(+)
            AND CIAD.AP_VND_CD                      =     CAID.AP_VND_CD(+)
            AND CIAD.AP_VND_INV_NUM                 =     CAID.AP_VND_INV_NUM(+)
            AND CIAD.AP_VND_INV_SQ_NUM              =     CAID.AP_VND_INV_SQ_NUM(+)
            AND CIAD.AP_VND_INV_LINE_NUM            =     CAID.AP_VND_INV_LINE_NUM(+)
            AND CAID.EZCANCELFLAG(+)                =     '0'
            AND CAIH.AP_VND_CD                      =     V.VND_CD(+)
            AND CAIH.PRNT_VND_CD                    =     PV.PRNT_VND_CD(+)
            AND CAIH.GLBL_CMPY_CD                   =     AIS.GLBL_CMPY_CD(+)
            AND CAIH.ACCT_INV_STS_CD                =     AIS.ACCT_INV_STS_CD(+)
            AND '0'                                 =     AIS.EZCANCELFLAG(+)
            AND CIAD.GLBL_CMPY_CD                   =     M.GLBL_CMPY_CD(+)
            AND CIAD.MDSE_CD                        =     M.MDSE_CD(+)
            AND '0'                                 =     M.EZCANCELFLAG(+)
            AND CIAD.GLBL_CMPY_CD                   =     CA.GLBL_CMPY_CD(+)
            AND CIAD.DR_COA_ACCT_CD                 =     CA.COA_ACCT_CD(+)
            AND '0'                                 =     CA.EZCANCELFLAG(+)
            AND V.GLBL_CMPY_CD                      =     VPM.GLBL_CMPY_CD(+)
            AND V.VND_PMT_METH_CD                   =     VPM.VND_PMT_METH_CD(+)
            AND '0'                                 =     VPM.EZCANCELFLAG(+)
            AND CAIH.GLBL_CMPY_CD                   =     AIC.GLBL_CMPY_CD(+)
            AND CAIH.AP_INV_CATG_CD                 =     AIC.AP_INV_CATG_CD(+)
            AND '0'                                 =     AIC.EZCANCELFLAG(+)
            AND CAIH.GLBL_CMPY_CD                   =     VPT.GLBL_CMPY_CD(+)
            AND CAIH.VND_PMT_TERM_CD                =     VPT.VND_PMT_TERM_CD(+)
            AND '0'                                 =     VPT.EZCANCELFLAG(+)
            AND NOT EXISTS
                    (
                        SELECT
                            1
                        FROM
                            PO
                        WHERE
                            PO.GLBL_CMPY_CD = CIAD.GLBL_CMPY_CD
                        AND PO.PO_ORD_NUM   = CIAD.PO_NUM
                        AND PO.EZCANCELFLAG = '0'
                    )
            AND NOT EXISTS
                    (
                        SELECT
                            1
                        FROM
                            VND_RTRN VR
                        WHERE
                            VR.GLBL_CMPY_CD = CIAD.GLBL_CMPY_CD
                        AND VR.VND_RTRN_NUM = CIAD.VND_RTRN_NUM
                        AND VR.EZCANCELFLAG = '0'
                    )
            <!-- Not exists PO Number and Vendor Return Number end -->
    ) A
,   (
        SELECT
             IT.RWS_REF_NUM         RWS_REF_NUM
            ,CASE WHEN MIN(RWS.RWS_NUM) &lt;&gt; MAX(RWS.RWS_NUM) THEN NULL ELSE MIN(RWS.RWS_NUM)
             END                    RWS_NUM
        FROM
             INVTY_TRX IT
            ,RWS_HDR   RWS
        WHERE
                IT.GLBL_CMPY_CD     = #glblCmpyCd#
            AND IT.EZCANCELFLAG     = '0'
            AND IT.GLBL_CMPY_CD     = RWS.GLBL_CMPY_CD
            AND IT.RWS_NUM          = RWS.RWS_NUM
            AND RWS.EZCANCELFLAG    = '0'
            AND EXISTS
                    (
                        SELECT
                            1
                        FROM
                            CM_INV_ACCT_DIST  CIAD
                        WHERE
                                CIAD.GLBL_CMPY_CD      = IT.GLBL_CMPY_CD
                            AND CIAD.AP_VND_CD         = #apVndCd#
                            AND CIAD.AP_VND_INV_NUM    = #apVndInvNum#
                            AND CIAD.AP_VND_INV_SQ_NUM = #apVndInvSqNum#
                            AND CIAD.DELY_ORD_NUM      = IT.RWS_REF_NUM
                            AND CIAD.EZCANCELFLAG      = '0'
                    )
        GROUP BY
            IT.RWS_REF_NUM
    ) RWS
    WHERE
        A.DELY_ORD_NUM = RWS.RWS_REF_NUM (+)
    ORDER BY
        A.AP_VND_INV_LINE_NUM
       ,A.CM_INV_ACCT_DIST_LINE_NUM
    <!-- END 2018/03/23 [QC#20316,MOD] -->
    </statement>

    <statement id="getMdseCatgRecord" parameterClass="Map" resultClass="Map">
    <!-- START 2018/03/23 [QC#20316,MOD] -->
        SELECT
        <!-- Record Unit -->
            V.PO_ORD_NUM
        ,   V.MDSE_CD
        <!-- Hidden Value for check logic -->
        ,   V.PO_STS_CD
        <!-- HEADER tab -->
        ,   V.DPLY_VND_NM                               DPLY_VND_NM                <!-- Vendor Name -->
        ,   V.VND_CD                                    AP_VND_CD                  <!-- Location -->
        ,   NULL                                        AP_VND_INV_NUM             <!-- Invoice Number -->
        ,   NULL                                        INV_DT                     <!-- Invoice Date -->
        ,   NULL                                        PAY_ALONE_FLG              <!-- Pay Alone Flag -->
        ,   NULL                                        INV_PMT_NUM                <!-- Payment Number -->
        ,   V.VND_PMT_METH_CD                           VND_PMT_METH_CD            <!-- Payment Method Code -->
        ,   V.VND_PMT_METH_DESC_TXT                     VND_PMT_METH_DESC_TXT      <!-- Payment Method Name -->
        ,   NULL                                        ACCT_INV_STS_CD            <!-- Accounting Invoice Status Code -->
        ,   NULL                                        ACCT_INV_STS_DESC_TXT      <!-- Status -->
        ,   V.PRNT_VND_CD                               PRNT_VND_CD                <!-- Vendor Number -->
        <isNotNull property="delyOrdNum">
            ,   #receiptMatch#                          CM_INV_MATCH_CD            <!-- Invoice Matching -->
        </isNotNull>
        <isNull property="delyOrdNum">
            <isNotNull property="poNum">
                ,   #poMatch#                           CM_INV_MATCH_CD            <!-- Invoice Matching -->
           </isNotNull>
           <isNull property="poNum">
                ,   ''                                  CM_INV_MATCH_CD            <!-- Invoice Matching -->
           </isNull>
        </isNull>
        ,   V.PO_ORD_NUM                                PO_NUM                     <!-- PO Number -->
        ,   0                                           AC_INV_TOT_COST_AMT        <!-- Invoice Amount -->
        ,   V.VND_PMT_TERM_CD                           VND_PMT_TERM_CD            <!-- Payment Term Code -->
        ,   V.VND_PMT_TERM_DESC_TXT                     VND_PMT_TERM_DESC_TXT      <!-- Terms -->
        ,   NULL                                        PMT_DT                     <!-- Payment Date -->
        ,   0                                           HDR_PMT_AMT                <!-- Amount Paid -->
        ,   NULL                                        TERM_NET_DUE_DT            <!-- Terms Date -->
        ,   V.PO_APVL_DT                                PO_APVL_DT                 <!-- PO Date -->
        ,   V.ENT_PO_DTL_DEAL_NET_AMT                   ENT_PO_DTL_DEAL_NET_AMT    <!-- PO Amount -->
        ,   V.ENT_PO_DTL_DEAL_NET_AMT_LINE              ENT_PO_DTL_DEAL_NET_AMT_LINE    <!-- PO Line Amount -->
        ,   V.DELY_ORD_NUM                              DELY_ORD_NUM               <!-- Receipt Number -->
        ,   V.RWS_NUM                                   RWS_NUM                    <!-- RWS Number -->
        ,   NULL                                        INV_HDR_DESC_TXT           <!-- Description -->
        ,   0                                           AC_OC_TOT_DISC_AMT         <!-- Discount -->
        ,   V.AP_INV_CATG_DESC_TXT                      AP_INV_CATG_DESC_TXT       <!-- Source -->
        ,   NULL                                        INV_AUTH_DT                <!-- Accounting Date -->
        ,   NULL                                        CM_AP_INV_TP_CD            <!-- Invoice Type -->

        <!-- HOLDS TAB -->
        ,   NULL                                        PMT_HLD_FLG
        ,   NULL                                        PMT_HLD_CD
        ,   NULL                                        PMT_HLD_NM                 <!-- Hold Name -->
        ,   NULL                                        PMT_HLD_DT                 <!-- Hold Date -->
        ,   NULL                                        PMT_HLD_RSN_CD
        ,   NULL                                        PMT_HLD_RSN_NM             <!-- Hold Reason -->
        ,   NULL                                        PMT_HLD_PSN_CD             <!-- Held By -->
        ,   NULL                                        PMT_HLD_REL_PSN_CD         <!-- Released By -->
        ,   NULL                                        PMT_HLD_REL_DT             <!-- Released Date -->
        ,   NULL                                        PMT_HLD_REL_RSN_CD
        ,   NULL                                        PMT_HLD_REL_RSN_NM         <!-- Release Reason -->
        ,   NULL                                        PMT_HLD_REL_CMNT_TXT       <!-- Release Note -->
        
        <!-- LINES tab -->
        ,   #apLineTpCd#                                AP_LINE_TP_CD              <!-- Line Type (Merchandise) -->
        ,   V.MDSE_CD                                   MDSE_CD                    <!-- Item -->
        ,   V.MDSE_DESC_SHORT_TXT                       MDSE_DESC_SHORT_TXT        <!-- Line Description -->
        ,   0                                           LINE_AMT                   <!-- Line Amount -->
        ,   V.UOM_CD                                    UOM_CD                     <!-- Unit Of Measure -->
        ,   V.XX_CMNT_TXT                               XX_CMNT_TXT                <!-- Charge Account -->
        ,   V.AP_ACCT_DESC_TXT                          AP_ACCT_DESC_TXT           <!-- Account Description -->
        ,   V.ENT_DEAL_NET_UNIT_PRC_AMT                 ENT_DEAL_NET_UNIT_PRC_AMT  <!-- Unit Price -->
        ,   V.INV_QTY                                   INV_QTY                    <!-- Invoice Quantity -->
        ,   V.PO_QTY                                    PO_QTY                     <!-- Ordered Quantity -->
        ,   V.INV_RCV_QTY                               INV_RCV_QTY                <!-- Received Quantity -->
        ,   V.AP_REJ_QTY                                AP_REJ_QTY                 <!-- Rejected Quantity -->
        ,   V.AP_BILL_QTY                               AP_BILL_QTY                <!-- Billed Quantity -->
        ,   NULL                                        CONTR_NUM                  <!-- Contract -->
        ,   NULL                                        CUST_DLR_CD                <!-- Dealer Code -->
        ,   NULL                                        SER_NUM                    <!-- Serial Number -->
        ,   NULL                                        CSMP_INV_NUM               <!-- CSMP Invoice -->
        ,   NULL                                        ISTL_LOC                   <!-- Install Location -->
        ,   V.CM_STK_IN_PK                              CM_STK_IN_PK
        ,   V.INV_ASG_FLG                               INV_ASG_FLG
        ,   V.ORIG_VND_INV_NUM                          ORIG_VND_INV_NUM
        ,   V.ORIG_VND_INV_SQ_NUM                       ORIG_VND_INV_SQ_NUM
        ,   V.ORIG_DELY_ORD_NUM                         ORIG_DELY_ORD_NUM
        ,   V.PO_ORD_DTL_LINE_NUM                       PO_ORD_DTL_LINE_NUM
        ,   V.PO_MATCH_TP_CD                            PO_MATCH_TP_CD
        ,   V.CSI_ENT_PO_DTL_DEAL_NET_AMT               CSI_ENT_PO_DTL_DEAL_NET_AMT
        ,   V.CSI_ENT_DEAL_NET_UNIT_PRC_AMT             CSI_ENT_DEAL_NET_UNIT_PRC_AMT
        ,   V.CSI_ENT_PO_DTL_FUNC_NET_AMT               CSI_ENT_PO_DTL_FUNC_NET_AMT
        ,   V.CSI_ENT_FUNC_NET_UNIT_PRC_AMT             CSI_ENT_FUNC_NET_UNIT_PRC_AMT
        <!-- START 2018/02/26 [QC#23505,ADD] -->
        ,   V.LINE_PO_NUM                               LINE_PO_NUM
        <!-- END   2018/02/26 [QC#23505,ADD] -->
        <!-- START 2018/03/16 [QC#24089,ADD] -->
        ,   V.PO_LINE_STS_CD                            PO_LINE_STS_CD
        <!-- END   2018/03/16 [QC#24089,ADD] -->
        <!-- START 2018/05/07 [QC#25828,ADD] -->
        ,   V.PD_ENT_DEAL_NET_UNIT_PRC_AMT              PD_ENT_DEAL_NET_UNIT_PRC_AMT
        <!-- END   2018/05/07 [QC#25828,ADD] -->
        <!-- DISTRIBUTIONS TAB -->
        ,   V.AC_INV_JRNL_COST_AMT                      AC_INV_JRNL_COST_AMT        <!-- Line Amount -->
        <!-- START 2018/07/17 S.Katsuma [QC#27078,ADD -->
        ,   V.DISP_PO_DTL_LINE_NUM                      DISP_PO_DTL_LINE_NUM
        <!-- END 2018/07/17 S.Katsuma [QC#27078,ADD -->
        FROM
            (
                SELECT
                    PD.PO_ORD_NUM
                ,   MIN(PD.MDSE_CD)                                      MDSE_CD
                ,   MIN(PO.PO_HDR_STS_CD)                                PO_STS_CD
                ,   CASE
                        WHEN
                            MIN(PO_MIN_LINE.LINE_CNT) &gt; 1
                        THEN
                            NULL
                        ELSE
                            PD.PO_ORD_DTL_LINE_NUM
                    END                                                  PO_ORD_DTL_LINE_NUM
                ,   MIN(PVV.DPLY_VND_NM)                                 DPLY_VND_NM
                ,   MIN(PVV.VND_CD)                                      VND_CD
                ,   MIN(V.VND_PMT_METH_CD)                               VND_PMT_METH_CD
                ,   MIN(VPM.VND_PMT_METH_DESC_TXT)                       VND_PMT_METH_DESC_TXT
                ,   MIN(PO.PRNT_VND_CD)                                  PRNT_VND_CD
                <!-- START 2018/10/12 [QC#28226,MOD] -->
                ,   MIN(PO.VND_PMT_TERM_CD)                              VND_PMT_TERM_CD
                ,   MIN(VPT.VND_PMT_TERM_DESC_TXT)                       VND_PMT_TERM_DESC_TXT
                <!-- END   2018/10/12 [QC#28226,MOD] -->
                ,   MIN(PO.PO_APVL_DT)                                   PO_APVL_DT
                ,   MIN(PD_HDR.ENT_PO_DTL_DEAL_NET_AMT)                  ENT_PO_DTL_DEAL_NET_AMT
                ,   MIN(PD.ENT_PO_DTL_DEAL_NET_AMT)                      ENT_PO_DTL_DEAL_NET_AMT_LINE
                ,   MIN(CSI_SUM.DELY_ORD_NUM)                            DELY_ORD_NUM
                <isNotNull property="rwsNum">
                ,   MIN(RWS.RWS_NUM)                                     RWS_NUM
                </isNotNull>
                <isNull property="rwsNum">
                ,   ''                                                   RWS_NUM
                </isNull>
                ,   MIN(M.MDSE_NM)                                       MDSE_DESC_SHORT_TXT
                ,   MIN(NVL(CSI_SUM.AC_INV_JRNL_COST_AMT,0))             AC_INV_JRNL_COST_AMT
                ,   MIN(PD.PO_DISP_UOM_CD)                              UOM_CD
                ,   CASE
                    WHEN
                        MIN(PD.PO_LINE_TP_CD) IN (#poLineTpItt#, #poLineTpExp# , #poLineTpExpWR#)
                    THEN
                        DECODE(MIN(PA.COA_CMPY_CD),NULL,
                                                      <!-- start 2017/03/10 QC#17802 MOD -->
                                                      DECODE(MIN(PVV.SPLY_COA_CMPY_CD),NULL,NULL,
                                                                MIN(PVV.SPLY_COA_CMPY_CD)         || '.' ||
                                                                MIN(PVV.SPLY_COA_BR_CD)           || '.' ||
                                                                MIN(PVV.SPLY_COA_CC_CD)           || '.' ||
                                                                MIN(PVV.SPLY_COA_ACCT_CD)         || '.' ||
                                                                MIN(PVV.SPLY_COA_PROD_CD)         || '.' ||
                                                                MIN(PVV.SPLY_COA_CH_CD)           || '.' ||
                                                                MIN(PVV.SPLY_COA_AFFL_CD)         || '.' ||
                                                                MIN(PVV.SPLY_COA_PROJ_CD)         || '.' ||
                                                                MIN(PVV.SPLY_COA_EXTN_CD))
                                                       ,MIN(PA.COA_CMPY_CD)         || '.' ||
                                                             MIN(PA.COA_BR_CD)           || '.' ||
                                                             MIN(PA.COA_CC_CD)           || '.' ||
                                                             MIN(PA.COA_ACCT_CD)         || '.' ||
                                                             MIN(PA.COA_PROD_CD)         || '.' ||
                                                             MIN(PA.COA_CH_CD)           || '.' ||
                                                             MIN(PA.COA_AFFL_CD)         || '.' ||
                                                             MIN(PA.COA_PROJ_CD)         || '.' ||
                                                             MIN(PA.COA_EXTN_CD))
                                                      <!-- end 2017/03/10 QC#17802 MOD -->
                    WHEN
                        MIN(PD.PO_LINE_TP_CD) = #poLineTpAsset#
                    THEN
                                                             #defCoaCmpyCd#              || '.' ||
                                                             #defCoaBrCd#                || '.' ||
                                                             #defCoaCcCd#                || '.' ||
                                                             MIN(ABC.CLING_COA_ACCT_CD)  || '.' ||
                                                             #defCoaProdCd#              || '.' ||
                                                             #defCoaChCd#                || '.' ||
                                                             #defCoaAfflCd#              || '.' ||
                                                             #defCoaProjCd#              || '.' ||
                                                             #defCoaExtnCd# 
                    ELSE
                                                             #defCoaCmpyCd#              || '.' ||
                                                             #defCoaBrCd#                || '.' ||
                                                             #defCoaCcCd#                || '.' ||
                                                             MIN(CPA.COA_ACCT_CD)        || '.' ||
                                                             #defCoaProdCd#              || '.' ||
                                                             #defCoaChCd#                || '.' ||
                                                             MIN(V.VND_COA_AFFL_CD)      || '.' ||
                                                             #defCoaProjCd#              || '.' ||
                                                             #defCoaExtnCd# 
                    END                                                  XX_CMNT_TXT
                ,   CASE
                    WHEN
                        MIN(PD.PO_LINE_TP_CD) IN (#poLineTpItt#, #poLineTpExp#, #poLineTpExpWR#)
                    THEN
                        <!-- start 2017/03/10 QC#17802 MOD -->
                        NVL(MIN(CA1.COA_ACCT_DESC_TXT),MIN(CA4.COA_ACCT_DESC_TXT))
                        <!-- end 2017/03/10 QC#17802 MOD -->
                    WHEN
                        MIN(PD.PO_LINE_TP_CD) = #poLineTpAsset#
                    THEN
                        MIN(CA2.COA_ACCT_DESC_TXT)
                    ELSE
                        MIN(CA3.COA_ACCT_DESC_TXT)
                    END                                                  AP_ACCT_DESC_TXT
                ,   MIN(NVL(PD.ENT_DEAL_NET_UNIT_PRC_AMT, 0))       ENT_DEAL_NET_UNIT_PRC_AMT
                ,   MIN(NVL(CSI_SUM.INV_QTY,0))                          INV_QTY
                ,   MIN(NVL(PO_MIN_LINE.PO_QTY,0))                       PO_QTY
                <!-- QC#14858-Sol#060 Modify Start -->
                ,   MIN(
                        CASE WHEN
                            PD.PO_LINE_TP_CD IN (#poLineTpItt#, #poLineTpExpWR#)
                        THEN
                            NVL(PO_MIN_LINE.PO_RCV_QTY,0)
                        ELSE
                            NVL(CSI_SUM.RCV_QTY,0)
                    END
                    )INV_RCV_QTY
                <!-- QC#14858-Sol#060 Modify End -->
                ,   MIN(NVL(PO_MIN_LINE.PO_CANC_QTY,0))                  AP_REJ_QTY
                ,   MIN(NVL(CIAD_SUM.AP_BILL_QTY,0))                     AP_BILL_QTY
                ,   MIN(CSI_SUM.CM_STK_IN_PK)                            CM_STK_IN_PK
                ,   MIN(CSI_SUM.INV_ASG_FLG)                             INV_ASG_FLG
                ,   DECODE(MIN(CSI_SUM.ORIG_VND_INV_NUM),NULL,MIN(CSI_SUM.VND_INV_NUM))
                                                                         ORIG_VND_INV_NUM
                ,   DECODE(MIN(CSI_SUM.ORIG_VND_INV_SQ_NUM),NULL,MIN(CSI_SUM.VND_INV_SQ_NUM))
                                                                         ORIG_VND_INV_SQ_NUM
                ,   DECODE(MIN(CSI_SUM.ORIG_DELY_ORD_NUM),NULL,MIN(CSI_SUM.DELY_ORD_NUM))
                                                                         ORIG_DELY_ORD_NUM
                ,   MIN(PD.PO_MATCH_TP_CD)                               PO_MATCH_TP_CD
                ,   MIN(AIC.AP_INV_CATG_DESC_TXT)                        AP_INV_CATG_DESC_TXT
                <!-- START 2018/07/02 S.Katsuma [QC#26566,MOD] -->
                <!-- START 2018/08/03 [QC#27563,MOD] -->
                ,   MIN(CSI_AMT.ENT_PO_DTL_DEAL_NET_AMT)                 CSI_ENT_PO_DTL_DEAL_NET_AMT
                <!-- END   2018/08/03 [QC#27563,MOD] -->
                <!-- END 2018/07/02 S.Katsuma [QC#26566,MOD] -->
                ,   MIN(CSI_AMT.ENT_DEAL_NET_UNIT_PRC_AMT)               CSI_ENT_DEAL_NET_UNIT_PRC_AMT
                ,   MIN(CSI_AMT.ENT_PO_DTL_FUNC_NET_AMT)                 CSI_ENT_PO_DTL_FUNC_NET_AMT
                ,   MIN(CSI_AMT.ENT_FUNC_NET_UNIT_PRC_AMT)               CSI_ENT_FUNC_NET_UNIT_PRC_AMT
                <!-- START 2018/02/26 [QC#23505,ADD] -->
                ,   PD.PO_ORD_NUM                                        LINE_PO_NUM
                <!-- END   2018/02/26 [QC#23505,ADD] -->
                <!-- START 2018/03/16 [QC#24089,ADD] -->
                ,   PD.PO_LINE_STS_CD                                    PO_LINE_STS_CD
                <!-- END   2018/03/16 [QC#24089,ADD] -->
                <!-- START 2018/05/07 [QC#25828,ADD] -->
                ,   MIN(NVL(PD.ENT_DEAL_NET_UNIT_PRC_AMT, 0))            PD_ENT_DEAL_NET_UNIT_PRC_AMT
                <!-- END   2018/05/07 [QC#25828,ADD] -->
                <!-- START 2018/07/17 S.Katsuma [QC#27078,ADD -->
                ,   MIN(PD.DISP_PO_DTL_LINE_NUM)                         DISP_PO_DTL_LINE_NUM
                <!-- END 2018/07/17 S.Katsuma [QC#27078,ADD -->
                FROM
                    PO_DTL           PD
                ,   (
                        SELECT
                            PD.PO_ORD_NUM
                        ,   SUM(NVL(PD.ENT_PO_DTL_DEAL_NET_AMT,0)) ENT_PO_DTL_DEAL_NET_AMT
                        FROM
                            PO_DTL    PD
                        WHERE
                            PD.GLBL_CMPY_CD                    = #glblCmpyCd#
                        <isNotNull property="poNum">
                        AND PD.PO_ORD_NUM                      = #poNum#
                        </isNotNull>
                        AND PD.PO_MDSE_CMPSN_TP_CD             &lt;&gt; #poMdseCmpsnTpChild#
                        AND PD.EZCANCELFLAG                    = '0'
                        <isNotNull property="delyOrdNum">
                        AND EXISTS
                                (
                                    SELECT
                                        1
                                    FROM
                                        CM_STK_IN CSI
                                    WHERE
                                        CSI.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                                    AND CSI.PO_ORD_NUM   = PD.PO_ORD_NUM
                                    AND CSI.MDSE_CD      = PD.MDSE_CD
                                    AND CSI.DELY_ORD_NUM = #delyOrdNum#
                                    AND CSI.TRX_CD       = #trxCd#
                                    AND CSI.TRX_RSN_CD   = #trxRsnCd#
                                    AND CSI.EZCANCELFLAG = '0'
                                )
                        </isNotNull>
                        GROUP BY
                            PD.PO_ORD_NUM
                    )                PD_HDR
                ,   PO               PO
                ,   (
                        SELECT
                            PD.PO_ORD_NUM               PO_ORD_NUM
                        ,   MIN(PD.MDSE_CD)             MDSE_CD
                        ,   PD.PO_ORD_DTL_LINE_NUM      PO_ORD_DTL_LINE_NUM
                        ,   SUM(PD.PO_QTY)              PO_QTY
                        ,   SUM(PD.PO_RCV_QTY)          PO_RCV_QTY
                        ,   SUM(PD.PO_CANC_QTY)         PO_CANC_QTY
                        ,   SUM(PD.PO_BAL_QTY)          PO_BAL_QTY
                        ,   COUNT(*)                    LINE_CNT
                        FROM
                            PO_DTL    PD
                        WHERE
                            PD.GLBL_CMPY_CD                     =     #glblCmpyCd#
                        <isNotNull property="poNum">
                        AND PD.PO_ORD_NUM                       =     #poNum#
                        </isNotNull>
                        AND PD.EZCANCELFLAG                     =     '0'
                        <isNotNull property="delyOrdNum">
                        AND EXISTS
                                (
                                    SELECT
                                        1
                                    FROM
                                        CM_STK_IN CSI
                                    WHERE
                                        CSI.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                                    AND CSI.PO_ORD_NUM   = PD.PO_ORD_NUM
                                    AND CSI.PO_ORD_DTL_LINE_NUM = PD.PO_ORD_DTL_LINE_NUM
                                    AND CSI.MDSE_CD      = PD.MDSE_CD
                                    AND CSI.DELY_ORD_NUM = #delyOrdNum#
                                    AND CSI.TRX_CD       = #trxCd#
                                    AND CSI.TRX_RSN_CD   = #trxRsnCd#
                                    AND CSI.EZCANCELFLAG = '0'
                                )
                        </isNotNull>
                        GROUP BY
                            PD.PO_ORD_NUM
                        ,   PD.PO_ORD_DTL_LINE_NUM
                    )                PO_MIN_LINE
                ,   (
                        SELECT
                            CSI.PO_ORD_NUM                                   PO_ORD_NUM
                        ,   MIN(CSI.MDSE_CD)                                 MDSE_CD
                        ,   CASE WHEN MIN(CSI.DELY_ORD_NUM) &lt;&gt; MAX(CSI.DELY_ORD_NUM) THEN NULL ELSE MIN(CSI.DELY_ORD_NUM)
                            END                                              DELY_ORD_NUM
                        ,   MIN(CSI.VND_CD)                                  VND_CD
                        ,   MIN(CSI.THIS_MTH_FOB_COST_AMT)                   AC_INV_JRNL_COST_AMT
                        ,   SUM(INV_QTY)                                     INV_QTY
                        ,   SUM(RCV_QTY)                                     RCV_QTY
                        ,   MIN(CM_STK_IN_PK)                                CM_STK_IN_PK
                        ,   MIN(INV_ASG_FLG)                                 INV_ASG_FLG
                        ,   MIN(ORIG_VND_INV_NUM)                            ORIG_VND_INV_NUM
                        ,   MIN(VND_INV_NUM)                                 VND_INV_NUM
                        ,   MIN(ORIG_VND_INV_SQ_NUM)                         ORIG_VND_INV_SQ_NUM
                        ,   MIN(VND_INV_SQ_NUM)                              VND_INV_SQ_NUM
                        ,   MIN(ORIG_DELY_ORD_NUM)                           ORIG_DELY_ORD_NUM
                        ,   PO_ORD_DTL_LINE_NUM                              PO_ORD_DTL_LINE_NUM
                        FROM
                            CM_STK_IN CSI
                        WHERE
                            CSI.GLBL_CMPY_CD                    =     #glblCmpyCd#
                        AND CSI.TRX_CD                          =     #trxCd#
                        AND CSI.TRX_RSN_CD                      =     #trxRsnCd#
                        <isNotNull property="poNum">
                        AND CSI.PO_ORD_NUM                      =     #poNum#
                        </isNotNull>
                        <isNotNull property="delyOrdNum">
                        AND CSI.DELY_ORD_NUM                    =     #delyOrdNum#
                        </isNotNull>
                        AND CSI.EZCANCELFLAG                    =     '0'
                        GROUP BY
                            CSI.PO_ORD_NUM
                        ,   CSI.PO_ORD_DTL_LINE_NUM
                    )                CSI_SUM
                ,   (
                     SELECT
                         CSID.PO_ORD_NUM                                  PO_ORD_NUM
                     ,   MIN(CSID.MDSE_CD)                                MDSE_CD
                     ,   CSID.PO_ORD_DTL_LINE_NUM                         PO_ORD_DTL_LINE_NUM
                     ,   MIN(CSID.DELY_ORD_NUM)                           DELY_ORD_NUM
                     ,   MIN(CSID.VND_CD)                                  VND_CD
                     ,   MIN(CSID.CM_STK_IN_PK)                           CM_STK_IN_PK
                     ,   SUM(CSID.ENT_PO_DTL_DEAL_NET_AMT)                ENT_PO_DTL_DEAL_NET_AMT
                     ,   MIN(CSID.ENT_DEAL_NET_UNIT_PRC_AMT)              ENT_DEAL_NET_UNIT_PRC_AMT
                     ,   SUM(CSID.ENT_PO_DTL_FUNC_NET_AMT)                ENT_PO_DTL_FUNC_NET_AMT
                     ,   MIN(CSID.ENT_FUNC_NET_UNIT_PRC_AMT)              ENT_FUNC_NET_UNIT_PRC_AMT
                     FROM
                            ( SELECT
                                  CSI.PO_ORD_NUM                                   PO_ORD_NUM
                              ,   CSI.MDSE_CD                                      MDSE_CD
                              ,   CSI.PO_ORD_DTL_LINE_NUM                          PO_ORD_DTL_LINE_NUM
                              ,   CASE WHEN MIN(CSI.DELY_ORD_NUM) &lt;&gt; MAX(CSI.DELY_ORD_NUM) THEN NULL ELSE MIN(CSI.DELY_ORD_NUM)
                                  END                                              DELY_ORD_NUM
                              ,   MIN(CSI.VND_CD)                                  VND_CD
                              ,   MIN(CSI.CM_STK_IN_PK)                            CM_STK_IN_PK
                              ,   MIN(CSI.ENT_PO_DTL_DEAL_NET_AMT)                 ENT_PO_DTL_DEAL_NET_AMT
                              ,   MIN(CSI.ENT_DEAL_NET_UNIT_PRC_AMT)               ENT_DEAL_NET_UNIT_PRC_AMT
                              ,   MIN(CSI.ENT_PO_DTL_FUNC_NET_AMT)                 ENT_PO_DTL_FUNC_NET_AMT
                              ,   MIN(CSI.ENT_FUNC_NET_UNIT_PRC_AMT)               ENT_FUNC_NET_UNIT_PRC_AMT
                              FROM
                                  CM_STK_IN CSI
                              WHERE
                                  CSI.GLBL_CMPY_CD                    =     #glblCmpyCd#
                              AND CSI.TRX_CD                          =     #trxCd#
                              AND CSI.TRX_RSN_CD                      =     #trxRsnCd#
                              <isNotNull property="poNum">
                              AND CSI.PO_ORD_NUM                      =     #poNum#
                              </isNotNull>
                              <isNotNull property="delyOrdNum">
                              AND CSI.DELY_ORD_NUM                    =     #delyOrdNum#
                              </isNotNull>
                              AND CSI.EZCANCELFLAG                    =     '0'
                              GROUP BY
                                  CSI.PO_ORD_NUM
                              ,   CSI.PO_ORD_DTL_LINE_NUM
                              ,   CSI.MDSE_CD
                            ) CSID
                     GROUP BY
                         CSID.PO_ORD_NUM
                     ,   CSID.PO_ORD_DTL_LINE_NUM
                    )                CSI_AMT
                ,   (
                        SELECT
                            V.GLBL_CMPY_CD
                        ,   V.VND_CD
                        ,   VB.PRNT_VND_CD                            PRNT_VND_CD
                        ,   VB.IN_VND_CD                              IN_VND_CD
                        ,   MIN(VB.PRNT_VND_NM || ' - ' || V.LOC_NM)  DPLY_VND_NM
                        ,   MIN(V.VND_PMT_METH_CD)                    VND_PMT_METH_CD
                        ,   MIN(V.VND_PMT_TERM_CD)                    VND_PMT_TERM_CD
                        ,   MIN(VPT.VND_PMT_TERM_DESC_TXT)            VND_PMT_TERM_DESC_TXT
                        ,   MIN(V.COA_AFFL_CD)                        VND_COA_AFFL_CD
                        FROM
                            (
                                SELECT
                                     PV.GLBL_CMPY_CD    AS GLBL_CMPY_CD
                                    ,PV.PRNT_VND_CD     AS PRNT_VND_CD
                                    ,PV.PRNT_VND_NM     AS PRNT_VND_NM
                                    ,V1.VND_CD          AS IN_VND_CD
                                    ,V1.VND_CD          AS VND_CD
                                FROM
                                     PRNT_VND PV
                                    ,VND V1
                                WHERE 
                                    PV.GLBL_CMPY_CD = #glblCmpyCd#
                                AND PV.GLBL_CMPY_CD = V1.GLBL_CMPY_CD
                                AND PV.PRNT_VND_PK  = V1.PRNT_VND_PK
                                AND V1.SPLY_PMT_FLG = #splyPmtFlgY#
                                AND PV.EZCANCELFLAG = '0'
                                AND V1.EZCANCELFLAG = '0'
                                UNION ALL
                                SELECT
                                     PV.GLBL_CMPY_CD    AS GLBL_CMPY_CD
                                    ,PV.PRNT_VND_CD     AS PRNT_VND_CD
                                    ,PV.PRNT_VND_NM     AS PRNT_VND_NM
                                    ,V1.VND_CD          AS IN_VND_CD
                                    ,MIN(V2.VND_CD)     AS VND_CD
                                FROM
                                     PRNT_VND PV
                                    ,VND V1
                                    ,VND V2
                                WHERE 
                                    PV.GLBL_CMPY_CD     = #glblCmpyCd#
                                AND PV.GLBL_CMPY_CD     = V1.GLBL_CMPY_CD
                                AND PV.GLBL_CMPY_CD     = V2.GLBL_CMPY_CD(+)
                                AND PV.PRNT_VND_PK      = V1.PRNT_VND_PK
                                AND PV.PRNT_VND_PK      = V2.PRNT_VND_PK(+)
                                AND V1.SPLY_PMT_FLG     = #splyPmtFlgN#
                                AND V2.SPLY_PMT_FLG(+)  = #splyPmtFlgY#
                                AND PV.EZCANCELFLAG     = '0'
                                AND V1.EZCANCELFLAG     = '0'
                                AND V2.EZCANCELFLAG(+)  = '0'
                                GROUP BY PV.GLBL_CMPY_CD, PV.PRNT_VND_CD, PV.PRNT_VND_NM, V1.VND_CD
                            )        VB
                        ,   VND      V
                        ,   VND_PMT_TERM VPT
                        WHERE
                            VB.GLBL_CMPY_CD      = V.GLBL_CMPY_CD(+)
                        AND VB.VND_CD            = V.VND_CD(+)
                        AND V.GLBL_CMPY_CD       = VPT.GLBL_CMPY_CD(+)
                        AND V.VND_PMT_TERM_CD    = VPT.VND_PMT_TERM_CD(+)
                        AND V.EZCANCELFLAG(+)    = '0'
                        AND VPT.EZCANCELFLAG(+)  = '0'
                        <isNotNull property="delyOrdNum">
                        AND EXISTS
                                (
                                    SELECT
                                        1
                                    FROM
                                        CM_STK_IN CSI
                                    WHERE
                                        CSI.GLBL_CMPY_CD                    =     #glblCmpyCd#
                                    <isNotNull property="poNum">
                                    AND CSI.PO_ORD_NUM                      =     #poNum#
                                    </isNotNull>
                                    AND CSI.DELY_ORD_NUM                    =     #delyOrdNum#
                                    AND CSI.EZCANCELFLAG                    =     '0'
                                    AND CSI.GLBL_CMPY_CD                    =     V.GLBL_CMPY_CD
                                    AND CSI.VND_CD                          =     V.VND_CD
                                )
                        </isNotNull>
                        GROUP BY
                            V.GLBL_CMPY_CD
                        ,   V.VND_CD
                        ,   VB.PRNT_VND_CD
                        ,   VB.IN_VND_CD
                    )                V
                ,   VND_PMT_METH     VPM
                <!-- START 2018/10/12 [QC#28226,ADD] -->
                ,   VND_PMT_TERM     VPT
                <!-- START 2018/10/12 [QC#28226,ADD] -->
                ,   MDSE             M
                ,   COA_PROJ_ACCT    CPA
                ,   PO_ACCT          PA
                ,   ASSET_BOOK_CTRL  ABC
                ,   COA_ACCT         CA1
                ,   COA_ACCT         CA2
                ,   COA_ACCT         CA3
                <!-- start 2017/03/10 QC#17802 ADD -->
                ,   COA_ACCT         CA4
                <!-- end   2017/03/10 QC#17802 ADD -->
                ,   (
                        SELECT
                            CAID.PO_NUM                   PO_ORD_NUM
                        ,   CAID.PO_ORD_DTL_LINE_NUM      PO_ORD_DTL_LINE_NUM
                        ,   MIN(CIAD.MDSE_CD)             MDSE_CD
                        ,   SUM(CIAD.AP_BILL_QTY)         AP_BILL_QTY
                        FROM
                            CM_INV_ACCT_DIST    CIAD
                           ,CM_AP_INV_DTL       CAID
                        WHERE
                            CIAD.GLBL_CMPY_CD                     = #glblCmpyCd#
                        AND CIAD.GLBL_CMPY_CD                     = CAID.GLBL_CMPY_CD
                        AND CIAD.AP_VND_CD                        = CAID.AP_VND_CD
                        AND CIAD.AP_VND_INV_NUM                   = CAID.AP_VND_INV_NUM
                        AND CIAD.AP_VND_INV_SQ_NUM                = CAID.AP_VND_INV_SQ_NUM
                        AND CIAD.AP_VND_INV_LINE_NUM              = CAID.AP_VND_INV_LINE_NUM
                        <isNotNull property="poNum">
                        AND CIAD.PO_NUM                           =     #poNum#
                        </isNotNull>
                        AND CIAD.EZCANCELFLAG                     =     '0'
                        <isNotNull property="delyOrdNum">
                        AND EXISTS
                                (
                                    SELECT
                                        1
                                    FROM
                                        CM_STK_IN CSI
                                    WHERE
                                        CSI.GLBL_CMPY_CD = CIAD.GLBL_CMPY_CD
                                    AND CSI.PO_ORD_NUM   = CIAD.PO_NUM
                                    AND CSI.MDSE_CD      = CIAD.MDSE_CD
                                    AND CSI.DELY_ORD_NUM = #delyOrdNum#
                                    AND CSI.TRX_CD       = #trxCd#
                                    AND CSI.TRX_RSN_CD   = #trxRsnCd#
                                    AND CSI.EZCANCELFLAG = '0'
                                )
                        </isNotNull>
                        GROUP BY
                            CAID.PO_NUM
                        ,   CAID.PO_ORD_DTL_LINE_NUM
                    )                CIAD_SUM
                ,   AP_INV_CATG      AIC
                ,   (
                                   SELECT
                                          V.GLBL_CMPY_CD
                                         ,V.VND_CD
                                         ,VB.IN_VND_CD
                                         ,VB.PRNT_VND_NM || ' - ' || V.LOC_NM AS DPLY_VND_NM
                                         ,V.EZCANCELFLAG
                                         <!-- start 2017/03/10 QC#17802 ADD -->
                                         ,V.SPLY_COA_CMPY_CD
                                         ,V.SPLY_COA_BR_CD
                                         ,V.SPLY_COA_CC_CD
                                         ,V.SPLY_COA_ACCT_CD
                                         ,V.SPLY_COA_PROD_CD
                                         ,V.SPLY_COA_CH_CD
                                         ,V.SPLY_COA_AFFL_CD
                                         ,V.SPLY_COA_PROJ_CD
                                         ,V.SPLY_COA_EXTN_CD
                                         <!-- end 2017/03/10 QC#17802 ADD -->
                                   FROM
                                        (
                                            SELECT
                                                 PV.GLBL_CMPY_CD    AS GLBL_CMPY_CD
                                                ,PV.PRNT_VND_CD     AS PRNT_VND_CD
                                                ,PV.PRNT_VND_NM     AS PRNT_VND_NM
                                                ,V1.VND_CD          AS IN_VND_CD
                                                ,V1.VND_CD          AS VND_CD
                                            FROM
                                                 PRNT_VND PV
                                                ,VND V1
                                            WHERE 
                                                PV.GLBL_CMPY_CD = #glblCmpyCd#
                                            AND PV.GLBL_CMPY_CD = V1.GLBL_CMPY_CD
                                            AND PV.PRNT_VND_PK  = V1.PRNT_VND_PK
                                            AND V1.SPLY_PMT_FLG = #splyPmtFlgY#
                                            AND PV.EZCANCELFLAG = '0'
                                            AND V1.EZCANCELFLAG = '0'
                                            UNION ALL
                                            SELECT
                                                 PV.GLBL_CMPY_CD    AS GLBL_CMPY_CD
                                                ,PV.PRNT_VND_CD     AS PRNT_VND_CD
                                                ,PV.PRNT_VND_NM     AS PRNT_VND_NM
                                                ,V1.VND_CD          AS IN_VND_CD
                                                ,MIN(V2.VND_CD)     AS VND_CD
                                            FROM
                                                 PRNT_VND PV
                                                ,VND V1
                                                ,VND V2
                                            WHERE 
                                                PV.GLBL_CMPY_CD     = #glblCmpyCd#
                                            AND PV.GLBL_CMPY_CD     = V1.GLBL_CMPY_CD
                                            AND PV.GLBL_CMPY_CD     = V2.GLBL_CMPY_CD(+)
                                            AND PV.PRNT_VND_PK      = V1.PRNT_VND_PK
                                            AND PV.PRNT_VND_PK      = V2.PRNT_VND_PK(+)
                                            AND V1.SPLY_PMT_FLG     = #splyPmtFlgN#
                                            AND V2.SPLY_PMT_FLG(+)  = #splyPmtFlgY#
                                            AND PV.EZCANCELFLAG     = '0'
                                            AND V1.EZCANCELFLAG     = '0'
                                            AND V2.EZCANCELFLAG(+)  = '0'
                                            GROUP BY PV.GLBL_CMPY_CD, PV.PRNT_VND_CD, PV.PRNT_VND_NM, V1.VND_CD
                                        )        VB
                                       ,VND      V
                                   WHERE
                                            VB.GLBL_CMPY_CD     = V.GLBL_CMPY_CD(+)
                                        AND VB.VND_CD           = V.VND_CD(+)
                                        AND V.EZCANCELFLAG(+)   = '0'
                    ) PVV
                <isNotNull property="rwsNum">
                ,   (
                        SELECT
                             IT.RWS_REF_NUM         RWS_REF_NUM
                            ,CASE WHEN MIN(RWS.RWS_NUM) &lt;&gt; MAX(RWS.RWS_NUM) THEN NULL ELSE MIN(RWS.RWS_NUM)
                             END                    RWS_NUM
                        FROM 
                             INVTY_TRX IT
                            ,RWS_HDR   RWS
                        WHERE
                                IT.GLBL_CMPY_CD     = #glblCmpyCd#
                            AND IT.EZCANCELFLAG     = '0'
                            <isNotNull property="delyOrdNum">
                            AND IT.RWS_REF_NUM      = #delyOrdNum#
                            </isNotNull>
                            AND IT.GLBL_CMPY_CD     = RWS.GLBL_CMPY_CD
                            AND IT.RWS_NUM          = RWS.RWS_NUM
                            AND RWS.RWS_NUM         = #rwsNum#
                            AND RWS.EZCANCELFLAG    = '0'
                        GROUP BY
                            IT.RWS_REF_NUM
                    )                RWS
                </isNotNull>
                WHERE
                    PD.GLBL_CMPY_CD                = #glblCmpyCd#
                <isNotNull property="poNum">
                AND PD.PO_ORD_NUM                  = #poNum#
                </isNotNull>
                <!-- QC#21754 Modify -->
                <isNotNull property="poLineStsClose">
                AND PD.PO_LINE_STS_CD             != #poLineStsClose#
                </isNotNull>
                <!-- START 2022/02/08 [QC#59613, ADD] -->
                AND PD.PO_LINE_STS_CD             != #poLineStsCancelled#
                <!-- END 2022/02/08 [QC#59613, ADD] -->
                AND PD.EZCANCELFLAG                = '0'
                AND PD.GLBL_CMPY_CD                = PO.GLBL_CMPY_CD
                AND PD.PO_ORD_NUM                  = PO.PO_ORD_NUM
                AND PO.EZCANCELFLAG                = '0'
                AND PD.PO_ORD_NUM                  = PD_HDR.PO_ORD_NUM
                AND PD.PO_ORD_NUM                  = PO_MIN_LINE.PO_ORD_NUM
                AND PD.PO_ORD_DTL_LINE_NUM         = PO_MIN_LINE.PO_ORD_DTL_LINE_NUM
                AND PD.PO_ORD_NUM                  = CSI_SUM.PO_ORD_NUM(+)
                AND PD.PO_ORD_DTL_LINE_NUM         = CSI_SUM.PO_ORD_DTL_LINE_NUM(+)
                AND NVL(PO.VND_CD, CSI_SUM.VND_CD) = V.IN_VND_CD(+)
                AND PD.PO_ORD_NUM                  = CSI_AMT.PO_ORD_NUM(+)
                AND PD.PO_ORD_DTL_LINE_NUM         = CSI_AMT.PO_ORD_DTL_LINE_NUM(+)
                AND NVL(PO.VND_CD, CSI_AMT.VND_CD) = V.IN_VND_CD(+)
                AND V.GLBL_CMPY_CD                 = VPM.GLBL_CMPY_CD(+)
                AND V.VND_PMT_METH_CD              = VPM.VND_PMT_METH_CD(+)
                AND VPM.EZCANCELFLAG(+)            = '0'
                <!-- START 2018/10/12 [QC#28226,ADD] -->
                AND PO.GLBL_CMPY_CD                = VPT.GLBL_CMPY_CD(+)
                AND PO.VND_PMT_TERM_CD             = VPT.VND_PMT_TERM_CD(+)
                AND VPT.EZCANCELFLAG(+)            = '0'
                <!-- END   2018/10/12 [QC#28226,ADD] -->
                AND PD.GLBL_CMPY_CD                = M.GLBL_CMPY_CD(+)
                AND PD.MDSE_CD                     = M.MDSE_CD(+)
                AND M.EZCANCELFLAG(+)              = '0'
                AND M.GLBL_CMPY_CD                 = CPA.GLBL_CMPY_CD(+)
                AND M.COA_MDSE_TP_CD               = CPA.COA_PROJ_CD(+)
                AND CPA.COA_PROJ_ACCT_TP_CD(+)     = #coaProjAcctTpAccrual#
                AND CPA.EZCANCELFLAG(+)            = '0'
                AND PD.GLBL_CMPY_CD                = PA.GLBL_CMPY_CD(+)
                AND PD.PO_ORD_NUM                  = PA.PO_ORD_NUM(+)
                AND PD.PO_ORD_DTL_LINE_NUM         = PA.PO_ORD_DTL_LINE_NUM(+)
                AND PA.PO_ACCT_TP_CD(+)            = #poAcctTpCd#
                AND PA.EZCANCELFLAG(+)             = '0'
                AND PD.PO_ORD_NUM                  = CIAD_SUM.PO_ORD_NUM(+)
                AND PD.PO_ORD_DTL_LINE_NUM         = CIAD_SUM.PO_ORD_DTL_LINE_NUM(+)
                AND PD.GLBL_CMPY_CD                = AIC.GLBL_CMPY_CD(+)
                AND AIC.AP_INV_CATG_CD(+)          = #apInvCatgCd#
                AND AIC.EZCANCELFLAG(+)            = '0'
                AND PO.GLBL_CMPY_CD                = PVV.GLBL_CMPY_CD(+)
                AND PO.VND_CD                      = PVV.IN_VND_CD(+)
                AND PVV.EZCANCELFLAG(+)            = '0'
                AND PD.GLBL_CMPY_CD                = ABC.GLBL_CMPY_CD(+)
                AND ABC.ASSET_TP_CD(+)             = #assetTpCdEmsd#
                AND ABC.EFF_FROM_DT(+)         &lt;= #salesDate#
                AND NVL(ABC.EFF_THRU_DT(+), #salesDate#) &gt;= #salesDate#
                AND ABC.EZCANCELFLAG(+)            = '0'
                AND PA.GLBL_CMPY_CD                = CA1.GLBL_CMPY_CD(+)
                AND PA.COA_ACCT_CD                 = CA1.COA_ACCT_CD(+)
                AND CA1.EZCANCELFLAG(+)            = '0'
                AND ABC.GLBL_CMPY_CD               = CA2.GLBL_CMPY_CD(+)
                AND ABC.CLING_COA_ACCT_CD          = CA2.COA_ACCT_CD(+)
                AND CA2.EZCANCELFLAG(+)            = '0'
                AND CPA.GLBL_CMPY_CD               = CA3.GLBL_CMPY_CD(+)
                AND CPA.COA_ACCT_CD                = CA3.COA_ACCT_CD(+)
                AND CA3.EZCANCELFLAG(+)            = '0'
                <!-- start 2017/03/10 QC#17802 ADD -->
                AND PVV.GLBL_CMPY_CD               = CA4.GLBL_CMPY_CD(+)
                AND PVV.SPLY_COA_ACCT_CD           = CA4.COA_ACCT_CD(+)
                AND CA4.EZCANCELFLAG(+)            = '0'
                <!-- end 2017/03/10 QC#17802 ADD -->
                <!-- end 2016/12/13 QC#16139,16476 MOD -->
                <isNotNull property="rwsNum">
                AND CSI_SUM.DELY_ORD_NUM           = RWS.RWS_REF_NUM
                AND CSI_AMT.DELY_ORD_NUM           = RWS.RWS_REF_NUM
                </isNotNull>
                <!-- start 2018/08/09 QC#27029-1 ADD -->
                <!-- START 2018/11/20 QC#28660   MOD -->
                <!-- START 2018/11/20 QC#28660   MOD -->
                <!-- START 2021/01/08 A.Marte [QC#57862,MOD] -->
                <isNotNull property="isInvoicedPo">
                 AND EXISTS (
                         SELECT
                             1
                         FROM
                             CM_AP_INV_DTL DTL
                         WHERE
                                 DTL.GLBL_CMPY_CD = PO.GLBL_CMPY_CD
                             AND DTL.PO_NUM       = PO.PO_ORD_NUM
                             AND DTL.EZCANCELFLAG = '0'
                 )
                </isNotNull>
                <!-- END 2021/01/08 A.Marte [QC#57862,MOD] -->
                <!-- END 2018/11/20 QC#28660   MOD -->
                <!-- end 2018/08/09 QC#27029-1 ADD -->
                GROUP BY
                     PD.PO_ORD_NUM
                 <!-- START 2018/03/16 [QC#20316,MOD] -->
                    ,PD.PO_ORD_DTL_LINE_NUM
                 <!-- END   2018/03/16 [QC#20316,MOD] -->
                 <!-- START 2018/03/16 [QC#24089,ADD] -->
                    ,PD.PO_LINE_STS_CD
                 <!-- END   2018/03/16 [QC#24089,ADD] -->
            ) V
            <iterate property="poOrdDtlLines" var="poOrdDtlLines[]" open="WHERE V.PO_ORD_DTL_LINE_NUM IN (" close=")" conjunction=",">
            #poOrdDtlLines[]#
            </iterate>
        ORDER BY
            V.PO_ORD_DTL_LINE_NUM
    </statement>

    <statement id="getMdseReturnCatgRecord" parameterClass="Map" resultClass="Map">
        SELECT
        <!-- Record Unit -->
            V.VND_RTRN_NUM                              VND_RTRN_NUM
        ,   V.MDSE_CD
        <!-- Hidden Value for check logic -->
        ,   V.PO_STS_CD
        <!-- HEADER tab -->
        ,   V.DPLY_VND_NM                               DPLY_VND_NM                <!-- Vendor Name -->
        ,   V.VND_CD                                    AP_VND_CD                  <!-- Location -->
        ,   NULL                                        AP_VND_INV_NUM             <!-- Invoice Number -->
        ,   NULL                                        INV_DT                     <!-- Invoice Date -->
        ,   NULL                                        PAY_ALONE_FLG              <!-- Pay Alone Flag -->
        ,   NULL                                        INV_PMT_NUM                <!-- Payment Number -->
        ,   V.VND_PMT_METH_CD                           VND_PMT_METH_CD            <!-- Payment Method Code -->
        ,   V.VND_PMT_METH_DESC_TXT                     VND_PMT_METH_DESC_TXT      <!-- Payment Method Name -->
        ,   NULL                                        ACCT_INV_STS_CD            <!-- Accounting Invoice Status Code -->
        ,   NULL                                        ACCT_INV_STS_DESC_TXT      <!-- Status -->
        ,   V.PRNT_VND_CD                               PRNT_VND_CD                <!-- Vendor Number -->
        <isNotNull property="delyOrdNum">
            ,   #receiptMatch#                          CM_INV_MATCH_CD            <!-- Invoice Matching -->
        </isNotNull>
        <isNull property="delyOrdNum">
            <isNotNull property="poNum">
                ,   #poMatch#                           CM_INV_MATCH_CD            <!-- Invoice Matching -->
           </isNotNull>
           <isNotNull property="vndRtrnNum">
                ,   #poMatch#                           CM_INV_MATCH_CD            <!-- Invoice Matching -->
           </isNotNull>
           <isNull property="poNum">
                ,   ''                                  CM_INV_MATCH_CD            <!-- Invoice Matching -->
           </isNull>
           <isNull property="vndRtrnNum">
                ,   ''                                  CM_INV_MATCH_CD            <!-- Invoice Matching -->
           </isNull>
        </isNull>
        ,   V.VND_RTRN_NUM                              VND_RTRN_NUM               <!-- PO Number -->
        ,   0                                           AC_INV_TOT_COST_AMT        <!-- Invoice Amount -->
        ,   V.VND_PMT_TERM_CD                           VND_PMT_TERM_CD            <!-- Payment Term Code -->
        ,   V.VND_PMT_TERM_DESC_TXT                     VND_PMT_TERM_DESC_TXT      <!-- Terms -->
        ,   NULL                                        PMT_DT                     <!-- Payment Date -->
        ,   0                                           HDR_PMT_AMT                <!-- Amount Paid -->
        ,   NULL                                        TERM_NET_DUE_DT            <!-- Terms Date -->
        ,   V.VND_RTRN_SUBMT_DT                         PO_APVL_DT                 <!-- PO Date -->
        ,   V.ENT_PO_DTL_DEAL_NET_AMT                   ENT_PO_DTL_DEAL_NET_AMT    <!-- PO Amount -->
        ,   V.DELY_ORD_NUM                              DELY_ORD_NUM               <!-- Receipt Number -->
        ,   V.RWS_NUM                                   RWS_NUM                    <!-- RWS Number -->
        ,   NULL                                        INV_HDR_DESC_TXT           <!-- Description -->
        ,   0                                           AC_OC_TOT_DISC_AMT         <!-- Discount -->
        ,   V.AP_INV_CATG_DESC_TXT                      AP_INV_CATG_DESC_TXT       <!-- Source -->
        ,   NULL                                        INV_AUTH_DT                <!-- Accounting Date -->
        ,   NULL                                        CM_AP_INV_TP_CD            <!-- Invoice Type -->

        <!-- HOLDS TAB -->
        ,   NULL                                        PMT_HLD_FLG
        ,   NULL                                        PMT_HLD_CD
        ,   NULL                                        PMT_HLD_NM                 <!-- Hold Name -->
        ,   NULL                                        PMT_HLD_DT                 <!-- Hold Date -->
        ,   NULL                                        PMT_HLD_RSN_CD
        ,   NULL                                        PMT_HLD_RSN_NM             <!-- Hold Reason -->
        ,   NULL                                        PMT_HLD_PSN_CD             <!-- Held By -->
        ,   NULL                                        PMT_HLD_REL_PSN_CD         <!-- Released By -->
        ,   NULL                                        PMT_HLD_REL_DT             <!-- Released Date -->
        ,   NULL                                        PMT_HLD_REL_RSN_CD
        ,   NULL                                        PMT_HLD_REL_RSN_NM         <!-- Release Reason -->
        ,   NULL                                        PMT_HLD_REL_CMNT_TXT       <!-- Release Note -->
        
        <!-- LINES tab -->
        ,   #apLineTpCd#                                AP_LINE_TP_CD              <!-- Line Type (Merchandise) -->
        ,   V.MDSE_CD                                   MDSE_CD                    <!-- Item -->
        ,   V.MDSE_DESC_SHORT_TXT                       MDSE_DESC_SHORT_TXT        <!-- Line Description -->
        ,   0                                           LINE_AMT                   <!-- Line Amount -->
        ,   V.UOM_CD                                    UOM_CD                     <!-- Unit Of Measure -->
        ,   V.XX_CMNT_TXT                               XX_CMNT_TXT                <!-- Charge Account -->
        ,   V.AP_ACCT_DESC_TXT                          AP_ACCT_DESC_TXT           <!-- Account Description -->
        ,   V.ENT_DEAL_NET_UNIT_PRC_AMT                 ENT_DEAL_NET_UNIT_PRC_AMT  <!-- Unit Price -->
        ,   V.INV_QTY                                   INV_QTY                    <!-- Invoice Quantity -->
        <!-- start 2018/02/02 QC#21703 MOD -->
        ,   -(V.PO_QTY)                                 PO_QTY                     <!-- Ordered Quantity -->
        <!-- end   2018/02/02 QC#21703 MOD -->
        ,   V.INV_RCV_QTY                               INV_RCV_QTY                <!-- Received Quantity -->
        ,   V.AP_REJ_QTY                                AP_REJ_QTY                 <!-- Rejected Quantity -->
        ,   V.AP_BILL_QTY                               AP_BILL_QTY                <!-- Billed Quantity -->
        ,   NULL                                        CONTR_NUM                  <!-- Contract -->
        ,   NULL                                        CUST_DLR_CD                <!-- Dealer Code -->
        ,   NULL                                        SER_NUM                    <!-- Serial Number -->
        ,   NULL                                        CSMP_INV_NUM               <!-- CSMP Invoice -->
        ,   NULL                                        ISTL_LOC                   <!-- Install Location -->
        ,   V.CM_STK_IN_PK                              CM_STK_IN_PK
        ,   V.INV_ASG_FLG                               INV_ASG_FLG
        ,   V.ORIG_VND_INV_NUM                          ORIG_VND_INV_NUM
        ,   V.ORIG_VND_INV_SQ_NUM                       ORIG_VND_INV_SQ_NUM
        ,   V.ORIG_DELY_ORD_NUM                         ORIG_DELY_ORD_NUM
        ,   V.PO_ORD_DTL_LINE_NUM                       PO_ORD_DTL_LINE_NUM
        ,   V.PO_MATCH_TP_CD                            PO_MATCH_TP_CD
        ,   V.CSI_ENT_DEAL_NET_UNIT_PRC_AMT             CSI_ENT_DEAL_NET_UNIT_PRC_AMT
        ,   V.CSI_ENT_PO_DTL_FUNC_NET_AMT               CSI_ENT_PO_DTL_FUNC_NET_AMT
        ,   V.CSI_ENT_FUNC_NET_UNIT_PRC_AMT             CSI_ENT_FUNC_NET_UNIT_PRC_AMT
        <!-- START 2018/08/15 [QC#27029-1,ADD] -->
        ,   V.VRD_ENT_DEAL_NET_UNIT_PRC_AMT             VRD_ENT_DEAL_NET_UNIT_PRC_AMT
        <!-- END   2018/08/15 [QC#27029-1,ADD] -->
        <!-- DISTRIBUTIONS TAB -->
        ,   V.AC_INV_JRNL_COST_AMT                      AC_INV_JRNL_COST_AMT        <!-- Line Amount -->
        FROM
            (
                SELECT
                <!-- START 2018/04/10 [QC#20316,MOD] -->
                    VRD.VND_RTRN_NUM
                ,   VRD.TRX_LINE_NUM
                ,   VRD.TRX_LINE_SUB_NUM
                ,   MIN(VRD.MDSE_CD)                                     MDSE_CD
                <!-- END 2018/04/10 [QC#20316,MOD] -->
                ,   NULL                                                 PO_STS_CD
                <!-- START 2018/04/10 [QC#20316,MOD] -->
                ,   VRD.TRX_LINE_NUM                                     PO_ORD_DTL_LINE_NUM
                <!-- END 2018/04/10 [QC#20316,MOD] -->
                ,   MIN(V.DPLY_VND_NM)                                   DPLY_VND_NM
                <!-- START 2019/04/08 [QC#31071,MOD] -->
                ,   MIN(V.VND_CD)                                        VND_CD
                <!-- END   2019/04/08 [QC#31071,MOD] -->
                ,   MIN(V.VND_PMT_METH_CD)                               VND_PMT_METH_CD
                ,   MIN(VPM.VND_PMT_METH_DESC_TXT)                       VND_PMT_METH_DESC_TXT
                ,   MIN(V.PRNT_VND_CD)                                   PRNT_VND_CD
                ,   MIN(V.VND_PMT_TERM_CD)                               VND_PMT_TERM_CD
                ,   MIN(V.VND_PMT_TERM_DESC_TXT)                         VND_PMT_TERM_DESC_TXT
                ,   MIN(VR.VND_RTRN_SUBMT_DT)                            VND_RTRN_SUBMT_DT
                ,   MIN(NVL(VR.TOT_VND_RTRN_AMT,0))                      ENT_PO_DTL_DEAL_NET_AMT
                ,   MIN(CSI_SUM.DELY_ORD_NUM)                            DELY_ORD_NUM
                <isNotNull property="rwsNum">
                ,   MIN(RWS.RWS_NUM)                                     RWS_NUM
                </isNotNull>
                <isNull property="rwsNum">
                ,   ''                                                   RWS_NUM
                </isNull>
                ,   MIN(M.MDSE_NM)                                       MDSE_DESC_SHORT_TXT
                ,   MIN(NVL(CSI_SUM.AC_INV_JRNL_COST_AMT,0))             AC_INV_JRNL_COST_AMT
                ,   MIN(VRD.UOM_CD)                                      UOM_CD
                <!-- START 2018/06/26 S.Katsuma [QC#26566,MOD] -->
                <!-- start 2018/02/02 QC#21703 MOD -->
                <!-- start 2016/12/13 QC#16476 MOD -->
                <!--
                ,   MIN(V.VND_RTRN_COA_CMPY_CD) || '.' ||
                    MIN(V.VND_RTRN_COA_BR_CD)   || '.' ||
                    MIN(V.VND_RTRN_COA_CC_CD)   || '.' ||
                    MIN(V.VND_RTRN_COA_ACCT_CD) || '.' ||
                    MIN(V.VND_RTRN_COA_PROD_CD) || '.' ||
                    MIN(V.VND_RTRN_COA_CH_CD)   || '.' ||
                    MIN(V.VND_RTRN_COA_AFFL_CD) || '.' ||
                    MIN(V.VND_RTRN_COA_PROJ_CD) || '.' ||
                    MIN(V.VND_RTRN_COA_EXTN_CD)
                                                                         XX_CMNT_TXT -->
                ,   MIN(CDA.CM_COA_CMPY_CD) || '.' ||
                    MIN(CDA.CM_COA_BR_CD)   || '.' ||
                    MIN(CDA.CM_COA_CC_CD)   || '.' ||
                    MIN(CDA.CM_COA_ACCT_CD) || '.' ||
                    MIN(CDA.CM_COA_PROD_CD) || '.' ||
                    MIN(CDA.CM_COA_CH_CD)   || '.' ||
                    MIN(CDA.CM_COA_AFFL_CD) || '.' ||
                    MIN(CDA.CM_COA_PROJ_CD) || '.' ||
                    MIN(CDA.CM_COA_EXTN_CD)
                                                                         XX_CMNT_TXT
                <!-- end 2016/12/13 QC#16476 MOD -->
                <!-- end 2018/02/02 QC#21703 MOD -->
                ,   MIN(CA.COA_ACCT_DESC_TXT)                            AP_ACCT_DESC_TXT
                <!-- END 2018/06/26 S.Katsuma [QC#26566,MOD] -->
                ,   MIN(NVL(VRD.DEAL_VND_RTRN_UNIT_PRC_AMT,0))           ENT_DEAL_NET_UNIT_PRC_AMT
                ,   MIN(NVL(CSI_SUM.INV_QTY,0))                          INV_QTY
                ,   MIN(VRD.RTRN_QTY)                                    PO_QTY
                ,   MIN(NVL(CSI_SUM.RCV_QTY,0))                          INV_RCV_QTY
                ,   0                                                    AP_REJ_QTY
                ,   MIN(NVL(CIAD_SUM.AP_BILL_QTY,0))                     AP_BILL_QTY
                ,   MIN(CSI_SUM.CM_STK_IN_PK)                            CM_STK_IN_PK
                ,   MIN(CSI_SUM.INV_ASG_FLG)                             INV_ASG_FLG
                ,   DECODE(MIN(CSI_SUM.ORIG_VND_INV_NUM),NULL,MIN(CSI_SUM.VND_INV_NUM))
                                                                         ORIG_VND_INV_NUM
                ,   DECODE(MIN(CSI_SUM.ORIG_VND_INV_SQ_NUM),NULL,MIN(CSI_SUM.VND_INV_SQ_NUM))
                                                                         ORIG_VND_INV_SQ_NUM
                ,   DECODE(MIN(CSI_SUM.ORIG_DELY_ORD_NUM),NULL,MIN(CSI_SUM.DELY_ORD_NUM))
                                                                         ORIG_DELY_ORD_NUM
                ,   NULL                                                 PO_MATCH_TP_CD
                ,   MIN(AIC.AP_INV_CATG_DESC_TXT)                        AP_INV_CATG_DESC_TXT
                ,   MIN(CSI_AMT.ENT_DEAL_NET_UNIT_PRC_AMT)               CSI_ENT_DEAL_NET_UNIT_PRC_AMT
                ,   MIN(CSI_AMT.ENT_PO_DTL_FUNC_NET_AMT)                 CSI_ENT_PO_DTL_FUNC_NET_AMT
                ,   MIN(CSI_AMT.ENT_FUNC_NET_UNIT_PRC_AMT)               CSI_ENT_FUNC_NET_UNIT_PRC_AMT
                <!-- START 2018/08/15 [QC#27029-1,ADD] -->
                ,   MIN(NVL(VRD.DEAL_VND_RTRN_UNIT_PRC_AMT,0))           VRD_ENT_DEAL_NET_UNIT_PRC_AMT
                <!-- END   2018/08/15 [QC#27029-1,ADD] -->
                FROM
                    VND_RTRN_DTL     VRD
                ,   VND_RTRN         VR
                <!-- START 2018/04/10 [QC#20316,MOD] -->
                ,   (
                        SELECT
                            CSI.VND_RTRN_NUM                                 VND_RTRN_NUM
                        ,   CSI.TRX_LINE_NUM                                 TRX_LINE_NUM
                        ,   CSI.TRX_LINE_SUB_NUM                             TRX_LINE_SUB_NUM
                        ,   MIN(CSI.PO_ORD_NUM)                              PO_ORD_NUM
                        ,   MIN(CSI.MDSE_CD)                                 MDSE_CD
                        ,   CASE WHEN MIN(CSI.DELY_ORD_NUM) &lt;&gt; MAX(CSI.DELY_ORD_NUM) THEN NULL ELSE MIN(CSI.DELY_ORD_NUM)
                            END                                              DELY_ORD_NUM
                        ,   MIN(CSI.VND_CD)                                  VND_CD
                        <!-- start 2018/02/02 QC#21703 MOD -->
                        ,   MIN(CSI.STK_IN_SC_FOB_COST_AMT)                  AC_INV_JRNL_COST_AMT
                        <!-- end   2018/02/02 QC#21703 MOD -->
                        ,   SUM(INV_QTY)                                     INV_QTY
                        ,   SUM(RCV_QTY)                                     RCV_QTY
                        ,   MIN(CM_STK_IN_PK)                                CM_STK_IN_PK
                        ,   MIN(INV_ASG_FLG)                                 INV_ASG_FLG
                        ,   MIN(ORIG_VND_INV_NUM)                            ORIG_VND_INV_NUM
                        ,   MIN(VND_INV_NUM)                                 VND_INV_NUM
                        ,   MIN(ORIG_VND_INV_SQ_NUM)                         ORIG_VND_INV_SQ_NUM
                        ,   MIN(VND_INV_SQ_NUM)                              VND_INV_SQ_NUM
                        ,   MIN(ORIG_DELY_ORD_NUM)                           ORIG_DELY_ORD_NUM
                        ,   MIN(PO_ORD_DTL_LINE_NUM)                         PO_ORD_DTL_LINE_NUM
                        FROM
                            CM_STK_IN CSI
                        WHERE
                            CSI.GLBL_CMPY_CD                    =     #glblCmpyCd#
                        AND CSI.TRX_CD                          =     #trxCd#
                        AND CSI.TRX_RSN_CD                      =     #trxRsnCd#
                        <isNotNull property="poNum">
                        AND CSI.PO_ORD_NUM                      =     #poNum#
                        </isNotNull>
                        <isNotNull property="delyOrdNum">
                        AND CSI.DELY_ORD_NUM                    =     #delyOrdNum#
                        </isNotNull>
                        AND CSI.EZCANCELFLAG                    =     '0'
                        GROUP BY
                            CSI.VND_RTRN_NUM
                        ,   CSI.TRX_LINE_NUM
                        ,   CSI.TRX_LINE_SUB_NUM
                    )                CSI_SUM
                                ,   (
                     SELECT
                         CSID.VND_RTRN_NUM                                VND_RTRN_NUM
                     ,   CSID.TRX_LINE_NUM                                TRX_LINE_NUM
                     ,   CSID.TRX_LINE_SUB_NUM                            TRX_LINE_SUB_NUM
                     ,   MIN(CSID.MDSE_CD)                                MDSE_CD
                     ,   MIN(CSID.PO_ORD_NUM)                             PO_ORD_NUM
                     ,   MIN(CSID.PO_ORD_DTL_LINE_NUM)                    PO_ORD_DTL_LINE_NUM
                     ,   MIN(CSID.DELY_ORD_NUM)                           DELY_ORD_NUM
                     ,   MIN(CSID.VND_CD)                                 VND_CD
                     ,   MIN(CSID.CM_STK_IN_PK)                           CM_STK_IN_PK
                     ,   SUM(CSID.ENT_PO_DTL_DEAL_NET_AMT)                ENT_PO_DTL_DEAL_NET_AMT
                     ,   MIN(CSID.ENT_DEAL_NET_UNIT_PRC_AMT)              ENT_DEAL_NET_UNIT_PRC_AMT
                     ,   SUM(CSID.ENT_PO_DTL_FUNC_NET_AMT)                ENT_PO_DTL_FUNC_NET_AMT
                     ,   MIN(CSID.ENT_FUNC_NET_UNIT_PRC_AMT)              ENT_FUNC_NET_UNIT_PRC_AMT
                     FROM
                            ( SELECT
                                  CSI.VND_RTRN_NUM                                 VND_RTRN_NUM
                              ,   CSI.TRX_LINE_NUM                                 TRX_LINE_NUM
                              ,   CSI.TRX_LINE_SUB_NUM                             TRX_LINE_SUB_NUM
                              ,   MIN(CSI.MDSE_CD)                                 MDSE_CD
                              ,   MIN(CSI.PO_ORD_NUM)                              PO_ORD_NUM
                              ,   MIN(CSI.PO_ORD_DTL_LINE_NUM)                     PO_ORD_DTL_LINE_NUM
                              ,   CASE WHEN MIN(CSI.DELY_ORD_NUM) &lt;&gt; MAX(CSI.DELY_ORD_NUM) THEN NULL ELSE MIN(CSI.DELY_ORD_NUM)
                                  END                                              DELY_ORD_NUM
                              ,   MIN(CSI.VND_CD)                                  VND_CD
                              ,   MIN(CSI.CM_STK_IN_PK)                            CM_STK_IN_PK
                              ,   MIN(CSI.ENT_PO_DTL_DEAL_NET_AMT)                 ENT_PO_DTL_DEAL_NET_AMT
                              ,   MIN(CSI.ENT_DEAL_NET_UNIT_PRC_AMT)               ENT_DEAL_NET_UNIT_PRC_AMT
                              ,   MIN(CSI.ENT_PO_DTL_FUNC_NET_AMT)                 ENT_PO_DTL_FUNC_NET_AMT
                              ,   MIN(CSI.ENT_FUNC_NET_UNIT_PRC_AMT)               ENT_FUNC_NET_UNIT_PRC_AMT
                              FROM
                                  CM_STK_IN CSI
                              WHERE
                                  CSI.GLBL_CMPY_CD                    =     #glblCmpyCd#
                              AND CSI.TRX_CD                          =     #trxCd#
                              AND CSI.TRX_RSN_CD                      =     #trxRsnCd#
                              <isNotNull property="poNum">
                              AND CSI.PO_ORD_NUM                      =     #poNum#
                              </isNotNull>
                              <isNotNull property="delyOrdNum">
                              AND CSI.DELY_ORD_NUM                    =     #delyOrdNum#
                              </isNotNull>
                              AND CSI.EZCANCELFLAG                    =     '0'
                              GROUP BY
                                  CSI.VND_RTRN_NUM
                              ,   CSI.TRX_LINE_NUM
                              ,   CSI.TRX_LINE_SUB_NUM
                            ) CSID
                     GROUP BY
                         CSID.VND_RTRN_NUM
                     ,   CSID.TRX_LINE_NUM
                     ,   CSID.TRX_LINE_SUB_NUM
                    )                CSI_AMT
                <!-- END   2018/04/10 [QC#20316,MOD] -->
                <!-- START 2019/04/08 [QC#31071,MOD] -->
                     ,(
                        SELECT
                            VB.GLBL_CMPY_CD
                        ,   V.VND_CD
                        ,   MIN(VB.PRNT_VND_CD)          PRNT_VND_CD
                        ,   MIN(VB.IN_VND_CD)            IN_VND_CD
                        ,   MIN(VB.PRNT_VND_NM || ' - ' || V.LOC_NM)  DPLY_VND_NM
                        ,   MIN(V.VND_PMT_METH_CD)       VND_PMT_METH_CD
                        ,   MIN(V.VND_PMT_TERM_CD)       VND_PMT_TERM_CD
                        ,   MIN(VPT.VND_PMT_TERM_DESC_TXT) VND_PMT_TERM_DESC_TXT
                        ,   MIN(V.VND_RTRN_COA_CMPY_CD)  VND_RTRN_COA_CMPY_CD
                        ,   MIN(V.VND_RTRN_COA_BR_CD)    VND_RTRN_COA_BR_CD
                        ,   MIN(V.VND_RTRN_COA_CC_CD)    VND_RTRN_COA_CC_CD
                        ,   MIN(V.VND_RTRN_COA_ACCT_CD)  VND_RTRN_COA_ACCT_CD
                        ,   MIN(V.VND_RTRN_COA_PROD_CD)  VND_RTRN_COA_PROD_CD
                        ,   MIN(V.VND_RTRN_COA_CH_CD)    VND_RTRN_COA_CH_CD
                        ,   MIN(V.VND_RTRN_COA_AFFL_CD)  VND_RTRN_COA_AFFL_CD
                        ,   MIN(V.VND_RTRN_COA_PROJ_CD)  VND_RTRN_COA_PROJ_CD
                        ,   MIN(V.VND_RTRN_COA_EXTN_CD)  VND_RTRN_COA_EXTN_CD
                        FROM
                            (
                                SELECT
                                     PV.GLBL_CMPY_CD    AS GLBL_CMPY_CD
                                    ,PV.PRNT_VND_CD     AS PRNT_VND_CD
                                    ,PV.PRNT_VND_NM     AS PRNT_VND_NM
                                    ,V1.VND_CD          AS IN_VND_CD
                                    ,V1.VND_CD          AS VND_CD
                                FROM
                                     PRNT_VND PV
                                    ,VND V1
                                WHERE 
                                    PV.GLBL_CMPY_CD = #glblCmpyCd#
                                AND PV.GLBL_CMPY_CD = V1.GLBL_CMPY_CD
                                AND PV.PRNT_VND_PK  = V1.PRNT_VND_PK
                                AND V1.SPLY_PMT_FLG = #splyPmtFlgY#
                                AND PV.EZCANCELFLAG = '0'
                                AND V1.EZCANCELFLAG = '0'
                                UNION ALL
                                SELECT
                                     PV.GLBL_CMPY_CD    AS GLBL_CMPY_CD
                                    ,PV.PRNT_VND_CD     AS PRNT_VND_CD
                                    ,PV.PRNT_VND_NM     AS PRNT_VND_NM
                                    ,V1.VND_CD          AS IN_VND_CD
                                    ,MIN(V2.VND_CD)     AS VND_CD
                                FROM
                                     PRNT_VND PV
                                    ,VND V1
                                    ,VND V2
                                WHERE 
                                    PV.GLBL_CMPY_CD     = #glblCmpyCd#
                                AND PV.GLBL_CMPY_CD     = V1.GLBL_CMPY_CD
                                AND PV.GLBL_CMPY_CD     = V2.GLBL_CMPY_CD(+)
                                AND PV.PRNT_VND_PK      = V1.PRNT_VND_PK
                                AND PV.PRNT_VND_PK      = V2.PRNT_VND_PK(+)
                                AND V1.SPLY_PMT_FLG     = #splyPmtFlgN#
                                AND V2.SPLY_PMT_FLG(+)  = #splyPmtFlgY#
                                AND PV.EZCANCELFLAG     = '0'
                                AND V1.EZCANCELFLAG     = '0'
                                AND V2.EZCANCELFLAG(+)  = '0'
                                GROUP BY PV.GLBL_CMPY_CD, PV.PRNT_VND_CD, PV.PRNT_VND_NM, V1.VND_CD
                            )        VB
                        ,   VND      V
                        ,   VND_PMT_TERM VPT
                        WHERE
                            VB.GLBL_CMPY_CD      = V.GLBL_CMPY_CD(+)
                        AND VB.VND_CD            = V.VND_CD(+)
                        AND V.EZCANCELFLAG(+)    = '0'
                        AND V.GLBL_CMPY_CD       = VPT.GLBL_CMPY_CD(+)
                        <!-- start 2018/02/02 QC#21703 MOD -->
                        AND VPT.VND_PMT_TERM_CD    = #cmVndPmtTermCd#
                        <!-- end   2018/02/02 QC#21703 MOD -->
                        AND VPT.EZCANCELFLAG(+)  = '0'
                        GROUP BY
                            VB.GLBL_CMPY_CD
                        ,   V.VND_CD
                        ,   VB.PRNT_VND_CD
                        ,   VB.IN_VND_CD
                    )                V
                <!-- END   2019/04/08 [QC#31071,MOD] -->
                ,   VND_PMT_METH     VPM
                ,   MDSE      M
                ,   COA_ACCT  CA
                <!-- START 2018/04/10 [QC#20316,MOD] -->
                ,   (
                        SELECT
                            CAID.PO_NUM                   PO_ORD_NUM
                        ,   CAID.PO_ORD_DTL_LINE_NUM      PO_ORD_DTL_LINE_NUM
                        ,   MIN(CIAD.MDSE_CD)             MDSE_CD
                        ,   SUM(CIAD.AP_BILL_QTY)         AP_BILL_QTY
                        FROM
                            CM_INV_ACCT_DIST    CIAD
                           ,CM_AP_INV_DTL       CAID
                        WHERE
                            CIAD.GLBL_CMPY_CD                     = #glblCmpyCd#
                        AND CIAD.GLBL_CMPY_CD                     = CAID.GLBL_CMPY_CD
                        AND CIAD.AP_VND_CD                        = CAID.AP_VND_CD
                        AND CIAD.AP_VND_INV_NUM                   = CAID.AP_VND_INV_NUM
                        AND CIAD.AP_VND_INV_SQ_NUM                = CAID.AP_VND_INV_SQ_NUM
                        AND CIAD.AP_VND_INV_LINE_NUM              = CAID.AP_VND_INV_LINE_NUM
                        <isNotNull property="poNum">
                        AND CIAD.PO_NUM                           =     #poNum#
                        </isNotNull>
                        AND CIAD.EZCANCELFLAG                     =     '0'
                        <isNotNull property="delyOrdNum">
                        AND EXISTS
                                (
                                    SELECT
                                        1
                                    FROM
                                        CM_STK_IN CSI
                                    WHERE
                                        CSI.GLBL_CMPY_CD = CIAD.GLBL_CMPY_CD
                                    AND CSI.PO_ORD_NUM   = CIAD.PO_NUM
                                    AND CSI.MDSE_CD      = CIAD.MDSE_CD
                                    AND CSI.DELY_ORD_NUM = #delyOrdNum#
                                    AND CSI.TRX_CD       = #trxCd#
                                    AND CSI.TRX_RSN_CD   = #trxRsnCd#
                                    AND CSI.EZCANCELFLAG = '0'
                                )
                        </isNotNull>
                        GROUP BY
                            CAID.PO_NUM
                        ,   CAID.PO_ORD_DTL_LINE_NUM
                    )                CIAD_SUM
                <!-- END   2018/04/10 [QC#20316,MOD] -->
                ,   AP_INV_CATG      AIC
                <isNotNull property="rwsNum">
                ,   (
                        SELECT
                             IT.RWS_REF_NUM         RWS_REF_NUM
                            ,CASE WHEN MIN(RWS.RWS_NUM) &lt;&gt; MAX(RWS.RWS_NUM) THEN NULL ELSE MIN(RWS.RWS_NUM)
                             END                    RWS_NUM
                        FROM 
                             INVTY_TRX IT
                            ,RWS_HDR   RWS
                        WHERE
                                IT.GLBL_CMPY_CD     = #glblCmpyCd#
                            AND IT.EZCANCELFLAG     = '0'
                            <isNotNull property="delyOrdNum">
                            AND IT.RWS_REF_NUM      = #delyOrdNum#
                            </isNotNull>
                            AND IT.GLBL_CMPY_CD     = RWS.GLBL_CMPY_CD
                            AND IT.RWS_NUM          = RWS.RWS_NUM
                            AND RWS.RWS_NUM         = #rwsNum#
                            AND RWS.EZCANCELFLAG    = '0'
                        GROUP BY
                            IT.RWS_REF_NUM
                    )                RWS
                </isNotNull>
                <!-- START 2018/06/26 S.Katsuma [QC#26566,ADD] -->
                ,   CM_DEF_ACCT      CDA
                <!-- END 2018/06/26 S.Katsuma [QC#26566,ADD] -->
                WHERE
                    VRD.GLBL_CMPY_CD         = #glblCmpyCd#
                <isNotNull property="vndRtrnNum">
                AND VRD.VND_RTRN_NUM         = #vndRtrnNum#
                </isNotNull>
                AND VRD.GLBL_CMPY_CD         = VR.GLBL_CMPY_CD
                AND VRD.VND_RTRN_NUM         = VR.VND_RTRN_NUM
                AND VRD.EZCANCELFLAG         = '0'
                AND VR.EZCANCELFLAG          = '0'
                <!-- START 2018/04/10 [QC#20316,MOD] -->
                AND VRD.VND_RTRN_NUM         = CSI_SUM.VND_RTRN_NUM
                AND VRD.TRX_LINE_NUM         = CSI_SUM.TRX_LINE_NUM
                AND VRD.TRX_LINE_SUB_NUM     = CSI_SUM.TRX_LINE_SUB_NUM
                <!-- START 2019/04/08 [QC#31071,MOD] -->
                AND VR.SHIP_TO_VND_CD           = V.IN_VND_CD(+)
                <!-- END   2019/04/08 [QC#31071,MOD] -->
                AND VRD.VND_RTRN_NUM         = CSI_AMT.PO_ORD_NUM
                AND VRD.TRX_LINE_NUM         = CSI_AMT.TRX_LINE_NUM
                AND VRD.TRX_LINE_SUB_NUM     = CSI_AMT.TRX_LINE_SUB_NUM
                <!-- END   2018/04/10 [QC#20316,MOD] -->
                AND V.GLBL_CMPY_CD           = VPM.GLBL_CMPY_CD(+)
                AND V.VND_PMT_METH_CD        = VPM.VND_PMT_METH_CD(+)
                AND '0'                      = VPM.EZCANCELFLAG(+)
                AND VRD.GLBL_CMPY_CD         = M.GLBL_CMPY_CD(+)
                AND VRD.MDSE_CD              = M.MDSE_CD(+)
                AND '0'                      = M.EZCANCELFLAG(+)
                AND V.GLBL_CMPY_CD           = CA.GLBL_CMPY_CD(+)
                AND V.VND_RTRN_COA_ACCT_CD   = CA.COA_ACCT_CD(+)
                AND '0'                      = CA.EZCANCELFLAG(+)
                <!-- START 2018/04/10 [QC#20316,MOD] -->
                AND VRD.VND_RTRN_NUM         = CIAD_SUM.PO_ORD_NUM(+)
                AND VRD.TRX_LINE_NUM         = CIAD_SUM.PO_ORD_DTL_LINE_NUM(+)
                <!-- END   2018/04/10 [QC#20316,MOD] -->
                AND VRD.GLBL_CMPY_CD         = AIC.GLBL_CMPY_CD(+)
                AND #apInvCatgCd#            = AIC.AP_INV_CATG_CD(+)
                AND '0'                      = AIC.EZCANCELFLAG(+)
                <isNotNull property="rwsNum">
                AND CSI_SUM.DELY_ORD_NUM    = RWS.RWS_REF_NUM
                AND CSI_AMT.DELY_ORD_NUM    = RWS.RWS_REF_NUM
                </isNotNull>
                <!-- START 2018/06/26 S.Katsuma [QC#26566,ADD] -->
                AND VRD.GLBL_CMPY_CD         = CDA.GLBL_CMPY_CD(+)
                AND CDA.CM_DEF_ACCT_CD(+)    = #cmDefAcctCdRtrn#
                AND CDA.EZCANCELFLAG(+)      = '0'
                <!-- END 2018/06/26 S.Katsuma [QC#26566,ADD] -->
                <!-- START 2018/04/10 [QC#20316,MOD] -->
                GROUP BY
                    VRD.VND_RTRN_NUM
                ,   VRD.TRX_LINE_NUM
                ,   VRD.TRX_LINE_SUB_NUM
                <!-- END 2018/04/10 [QC#20316,MOD] -->

            ) V
        <!-- START 2018/04/10 [QC#20316,MOD] -->
        ORDER BY
            V.TRX_LINE_NUM
        ,   V.TRX_LINE_SUB_NUM
        <!-- END 2018/04/10 [QC#20316,MOD] -->
    </statement>

    <statement id="getHoldRecord" parameterClass="Map" resultClass="Map">
        <!-- START 2018/03/28 QC#24277 MOD -->
        SELECT
            CIPH.AP_VND_CD
        ,   CIPH.AP_VND_INV_NUM
        ,   CIPH.AP_VND_INV_SQ_NUM
        ,   DECODE(CIPH.AP_VND_INV_LINE_NUM, #apVndInvLineNum0000#, #emptyApVndInvLineNum#, CIPH.AP_VND_INV_LINE_NUM) AS AP_VND_INV_LINE_NUM
        ,   CIPH.PMT_HLD_CD
        ,   CIPH.PMT_HLD_RSN_CD
        ,   PH.PMT_HLD_DESC_TXT        <!-- Hold Name -->
        ,   CIPH.PMT_HLD_DT            <!-- Hold Date -->
        ,   PHR.PMT_HLD_RSN_DESC_TXT   <!-- Hold Reason -->
        ,   CIPH.PMT_HLD_PSN_CD        <!-- Held By -->
        ,   CIPH.PMT_HLD_FLG           <!-- Hold Release Checkbox -->
        ,   CIPH.PMT_HLD_REL_PSN_CD    <!-- Released By -->
        ,   CIPH.PMT_HLD_REL_DT        <!-- Released Date -->
        ,   CIPH.PMT_HLD_REL_RSN_CD    <!-- Release Reason -->
        ,   CIPH.PMT_HLD_REL_CMNT_TXT  <!-- Release Note -->
        FROM
            CM_INV_PMT_HLD   CIPH
        ,   PMT_HLD          PH
        ,   PMT_HLD_RSN      PHR
        ,   PMT_HLD_REL_RSN  PHRR
        WHERE
            CIPH.GLBL_CMPY_CD       = #glblCmpyCd#
        AND CIPH.AP_VND_CD          = #apVndCd#
        AND CIPH.AP_VND_INV_NUM     = #apVndInvNum#
        AND CIPH.AP_VND_INV_SQ_NUM  = #apVndInvSqNum#
        AND CIPH.EZCANCELFLAG       = '0'
        AND CIPH.GLBL_CMPY_CD       = PH.GLBL_CMPY_CD(+)
        AND CIPH.PMT_HLD_CD         = PH.PMT_HLD_CD(+)
        AND '0'                     = PH.EZCANCELFLAG(+)
        AND CIPH.GLBL_CMPY_CD       = PHR.GLBL_CMPY_CD(+)
        AND CIPH.PMT_HLD_RSN_CD     = PHR.PMT_HLD_RSN_CD(+)
        AND '0'                     = PHR.EZCANCELFLAG(+)
        AND CIPH.GLBL_CMPY_CD       = PHRR.GLBL_CMPY_CD(+)
        AND CIPH.PMT_HLD_REL_RSN_CD = PHRR.PMT_HLD_REL_RSN_CD(+)
        AND '0'                     = PHRR.EZCANCELFLAG(+)
        ORDER BY
            CIPH.AP_VND_INV_LINE_NUM NULLS LAST
        <!-- END   2018/03/28 QC#24277 MOD -->
    </statement>

    <statement id="getPmtHldRelRsnPulldownValue"  parameterClass="Map" resultClass="Map">
        SELECT
            PMT_HLD_REL_RSN_CD
        ,   PMT_HLD_REL_RSN_DESC_TXT 
        FROM
            PMT_HLD_REL_RSN
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd# 
        AND EZCANCELFLAG = '0' 
        ORDER BY
            PMT_HLD_REL_RSN_SORT_NUM ASC
    </statement>

    <statement id="getPmtHldDescTxtByPmtHldCd"  parameterClass="Map" resultClass="String">
        SELECT
            PMT_HLD_DESC_TXT
        FROM
            PMT_HLD
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd# 
        AND PMT_HLD_CD   = #pmtHldCd# 
        AND EZCANCELFLAG = '0' 
    </statement>

    <statement id="getPmtHldRsnDescTxtByPmtHldRsnCd"  parameterClass="Map" resultClass="String">
        SELECT
            PMT_HLD_RSN_DESC_TXT
        FROM
            PMT_HLD_RSN
        WHERE
            GLBL_CMPY_CD         = #glblCmpyCd#
        AND PMT_HLD_RSN_CD       = #pmtHldRsnCd#
        AND EZCANCELFLAG         = '0'
    </statement>

    <statement id="getAcctInvStsCdByAcctInvStsDescTxt"  parameterClass="Map" resultClass="String">
        SELECT
            ACCT_INV_STS_CD
        FROM
            ACCT_INV_STS
        WHERE
            GLBL_CMPY_CD          = #glblCmpyCd#
        AND ACCT_INV_STS_DESC_TXT = #acctInvStsDescTxt#
        AND EZCANCELFLAG          = '0'
    </statement>

    <statement id="getCmStkInPkListByPartialCondition"  parameterClass="Map" resultClass="Map">
        SELECT
            CM_STK_IN_PK
        FROM
            CM_STK_IN
        WHERE
            GLBL_CMPY_CD          = #glblCmpyCd#
        AND PO_ORD_NUM            = #poOrdNum#
        AND MDSE_CD               = #mdseCd#
        AND EZCANCELFLAG          = '0'
    </statement>

    <statement id="getApInvCatgCdFromDescTxt"  parameterClass="Map" resultClass="Map">
        SELECT
            AP_INV_CATG_CD
        FROM
            AP_INV_CATG
        WHERE
            GLBL_CMPY_CD          = #glblCmpyCd#
        AND AP_INV_CATG_DESC_TXT  = #apInvCatgDescTxt#
        AND EZCANCELFLAG          = '0'
    </statement>

    <statement id="getListCmApInvDtlByPartialKey" parameterClass="Map" resultClass="Map">
        SELECT
             PD.PO_ORD_NUM              AS PO_ORD_NUM
            ,PD.MDSE_CD                 AS MDSE_CD
            ,NVL(PD.PO_INV_BAL_QTY, 0)  AS PO_INV_BAL_QTY
            ,PD.PO_ORD_DTL_LINE_NUM     AS PO_ORD_DTL_LINE_NUM
            ,PD.PO_STS_CD               AS PO_STS_CD
            ,PD.PO_LINE_STS_CD          AS PO_LINE_STS_CD
        FROM
             PO_DTL     PD
        WHERE
                PD.GLBL_CMPY_CD         = #glblCmpyCd#
            AND PD.EZCANCELFLAG         = '0'
            AND PD.PO_ORD_NUM           = #poOrdNum#
            AND (
                    (
                        PD.PO_LINE_STS_CD = #poLineStsCdIsOpen#
                        <iterate property="poStsCdIsOpenList" var="poStsCdIsOpenList[]" open="AND PD.PO_STS_CD IN (" close=")" conjunction=",">
                        #poStsCdIsOpenList[]#
                        </iterate>
                    )
                    OR
                    (
                        <iterate property="poLinsStsCdIsOpenForXXList" var="poLinsStsCdIsOpenForXXList[]" open="PD.PO_LINE_STS_CD IN (" close=")" conjunction=",">
                        #poLinsStsCdIsOpenForXXList[]#
                        </iterate>
                    )
                )
        ORDER BY
            PD.PO_ORD_NUM
        ,   PD.MDSE_CD
        ,   PD.PO_ORD_DTL_LINE_NUM
    </statement>

    <statement id="getCreditLineAccountCode" parameterClass="Map" resultClass="Map">
        SELECT
            CR_COA_CMPY_CD || '.' ||
            CR_COA_BR_CD   || '.' ||
            CR_COA_CC_CD   || '.' ||
            CR_COA_ACCT_CD || '.' ||
            CR_COA_PROD_CD || '.' ||
            CR_COA_CH_CD   || '.' ||
            CR_COA_AFFL_CD || '.' ||
            CR_COA_PROJ_CD || '.' ||
            CR_COA_EXTN_CD           XX_CMNT_TXT
        FROM
            CM_AP_INV_HDR    CAIH
           ,CM_INV_ACCT_DIST CIAD
        WHERE
            CAIH.GLBL_CMPY_CD      = #glblCmpyCd#
        AND CAIH.AP_VND_CD         = #apVndCd#
        AND CAIH.AP_VND_INV_NUM    = #apVndInvNum#
        AND CAIH.AP_VND_INV_SQ_NUM = #apVndInvSqNum#
        AND CAIH.AP_VND_CD         = CIAD.AP_VND_CD
        AND CAIH.AP_VND_INV_NUM    = CIAD.AP_VND_INV_NUM
        AND CAIH.AP_VND_INV_SQ_NUM = CIAD.AP_VND_INV_SQ_NUM
        AND CAIH.EZCANCELFLAG      = '0'
        AND CIAD.EZCANCELFLAG      = '0'
        AND ROWNUM                 = 1
    </statement>

    <statement id="getVndSplyCoaData" parameterClass="Map" resultClass="Map">
        SELECT
            V.SPLY_COA_CMPY_CD
           ,V.SPLY_COA_BR_CD
           ,V.SPLY_COA_CC_CD
           ,V.SPLY_COA_ACCT_CD
           ,V.SPLY_COA_PROD_CD
           ,V.SPLY_COA_CH_CD
           ,V.SPLY_COA_AFFL_CD
           ,V.SPLY_COA_PROJ_CD
           ,V.SPLY_COA_EXTN_CD
        FROM
            VND V
        WHERE
            V.GLBL_CMPY_CD        = #glblCmpyCd#
        AND V.VND_CD              = #apVndCd#
        AND V.EZCANCELFLAG        = '0'
        AND ROWNUM                 = 1
    </statement>

    <statement id="getVendorInfo" parameterClass="Map" resultClass="Map">
        SELECT
           V.EZCANCELFLAG,
           V.GLBL_CMPY_CD,
           V.VND_CD,
           V.LOC_NM,
           V.INAC_DT,
           PV.PRNT_VND_CD,
           PV.PRNT_VND_NM || ' - ' || V.LOC_NM AS DPLY_VND_NM,
           PV.PRNT_VND_TP_CD,
           V.INV_TOL_RATE
        FROM
           PRNT_VND    PV,
           VND         V,
           VND_TP_RELN VTR
        WHERE
             V.GLBL_CMPY_CD   = #glblCmpyCd#
         AND V.EZCANCELFLAG   = '0'
         AND V.VND_CD         = #apVndCd#
         AND V.RGTN_STS_CD    = #readyForOrderTaking#
         AND V.EFF_THRU_DT   &gt;= #salesDate#
        <!-- START 2018/09/26 QC#28099 ADD -->
        <isNotNull property="splyPmtFlgY">
         AND V.SPLY_PMT_FLG   = #splyPmtFlgY#
        </isNotNull>
        <!-- END   2018/09/26 QC#28099 ADD -->
         AND V.VND_CD         = VTR.VND_CD
         AND V.GLBL_CMPY_CD   = VTR.GLBL_CMPY_CD
         AND VTR.EZCANCELFLAG = '0'
         AND VTR.VND_TP_CD    = #supplier#
         AND V.GLBL_CMPY_CD   = PV.GLBL_CMPY_CD
         AND PV.EZCANCELFLAG  = '0'
         AND V.PRNT_VND_PK    = PV.PRNT_VND_PK
         AND (   PV.INAC_DT  IS NULL
              OR PV.INAC_DT  &gt; #salesDate#)
    </statement>

    <statement id="getSumPoQty" parameterClass="Map" resultClass="Map">
        SELECT
        <!-- START 2018/03/28 QC#24793 MOD -->
        <!-- SUM(PD.PO_DISP_QTY) SUM_PO_DISP_QTY -->
            SUM(PD.PO_QTY) SUM_PO_QTY
        <!-- START 2018/03/28 QC#24793 MOD -->
        FROM
            PO_DTL    PD
        WHERE
                PD.GLBL_CMPY_CD        = #glblCmpyCd#
            AND PD.PO_ORD_NUM          = #poOrdNum#
        <!-- START 2018/03/28 QC#24277 MOD -->
            <isNotNull property="poOrdDtlLineNum">
            AND PD.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
            </isNotNull>
            <isNull property="poOrdDtlLineNum">
            AND PD.MDSE_CD             = #mdseCd#
            </isNull>
        <!-- END   2018/03/28 QC#24277 MOD -->
            AND PD.EZCANCELFLAG        = '0'
        GROUP BY
            PD.PO_ORD_NUM
           ,PD.MDSE_CD
    </statement>

    <statement id="getSumBilledQty" parameterClass="Map" resultClass="Map">
        <!-- 2018/03/28 QC#24277 MOD -->
        <!-- 2018/01/09 QC#22143 MOD -->
        SELECT
           SUM(CIAD.AP_BILL_QTY) SUM_AP_BILL_QTY
        FROM
            CM_INV_ACCT_DIST CIAD
           ,CM_AP_INV_DTL    CAID
           ,CM_AP_INV_HDR    CAIH
        WHERE
             CIAD.GLBL_CMPY_CD            = #glblCmpyCd#
         AND CIAD.EZCANCELFLAG            = '0'
         AND CIAD.GLBL_CMPY_CD            = CAID.GLBL_CMPY_CD
         AND CIAD.AP_VND_CD               = CAID.AP_VND_CD
         AND CIAD.AP_VND_INV_NUM          = CAID.AP_VND_INV_NUM
         AND CIAD.AP_VND_INV_SQ_NUM       = CAID.AP_VND_INV_SQ_NUM
         AND CIAD.AP_VND_INV_LINE_NUM     = CAID.AP_VND_INV_LINE_NUM
         AND CAID.PO_NUM                  = #poOrdNum#
         <isNotNull property="poOrdDtlLineNum">
         AND CAID.PO_ORD_DTL_LINE_NUM     = #poOrdDtlLineNum#
         </isNotNull>
         <isNull property="poOrdDtlLineNum">
         AND CAID.MDSE_CD                 = #mdseCd#
         </isNull>
         AND CAID.EZCANCELFLAG            = '0'
         AND CAID.GLBL_CMPY_CD            = CAIH.GLBL_CMPY_CD
         AND CAID.AP_VND_CD               = CAIH.AP_VND_CD
         AND CAID.AP_VND_INV_NUM          = CAIH.AP_VND_INV_NUM
         AND CAIH.ACCT_INV_STS_CD  &lt;&gt; #cancel#
         AND CAIH.AP_VND_INV_NUM   &lt;&gt; #apVndInvNum#
         <!-- START 2018/05/08 QC#25139 ADD -->
         <!-- START 2018/11/20 QC#28660 MOD -->
         <isNotNull property="entered">
         AND CAIH.ACCT_INV_STS_CD  &lt;&gt; #entered#
         </isNotNull>
         <!-- END 2018/11/20 QC#28660 MOD -->
         <!-- END 2018/05/08 QC#25139 ADD -->
         AND CAIH.EZCANCELFLAG            = '0'
         <!-- START 2021/09/28 G.Delgado [QC#58775, DEL] -->
         <!-- GROUP BY CIAD.MDSE_CD -->
         <!-- END 2021/09/28 G.Delgado [QC#58775, DEL] -->
        <!-- 2018/01/09 QC#22143 MOD -->
        <!-- 2018/03/28 QC#24277 MOD -->
    </statement>

    <!-- QC#21653 ADD / QC#14858-Sol#060 UPDATE -->
    <statement id="getSumRcvQty" parameterClass="Map" resultClass="Map">
        SELECT
            PD.PO_ORD_NUM
            ,PD.MDSE_CD
            ,MIN(PD.PO_ORD_DTL_LINE_NUM) PO_ORD_DTL_LINE_NUM
            ,MIN(CASE WHEN
                PD.PO_LINE_TP_CD IN (#poLineTpItt#, #poLineTpExpWR#)
             THEN
                NVL(PD.PO_RCV_QTY,0)
             ELSE
                CSI.SUM_RCV_QTY
             END) SUM_RWS_QTY
        FROM
             PO_DTL PD
            ,(
                SELECT
                    C.GLBL_CMPY_CD
                   ,C.PO_ORD_NUM
                   ,C.MDSE_CD
                   ,NVL(SUM(C.RCV_QTY),0) SUM_RCV_QTY
                FROM
                    CM_STK_IN C
                WHERE
                    C.EZCANCELFLAG = '0'
                GROUP BY
                    C.GLBL_CMPY_CD
                   ,C.PO_ORD_NUM
                   ,C.MDSE_CD
            ) CSI
        WHERE
            PD.GLBL_CMPY_CD        = #glblCmpyCd#
        AND PD.PO_ORD_NUM          = #poOrdNum#
        AND PD.MDSE_CD             = #mdseCd#
        AND PD.EZCANCELFLAG        = '0'
        AND PD.GLBL_CMPY_CD        = CSI.GLBL_CMPY_CD(+)
        AND PD.PO_ORD_NUM          = CSI.PO_ORD_NUM(+)
        AND PD.MDSE_CD             = CSI.MDSE_CD(+)
        GROUP BY
             PD.PO_ORD_NUM
            ,PD.MDSE_CD
    </statement>

    <!-- 2018/03/28 QC#24277 ADD -->
    <statement id="getSumRcvQtyByPoOrdDtlLineNum" parameterClass="Map" resultClass="Map">
        SELECT
             PD.PO_ORD_NUM
            ,PD.PO_ORD_DTL_LINE_NUM
            ,MIN(CASE WHEN
                PD.PO_LINE_TP_CD IN (#poLineTpItt#, #poLineTpExpWR#)
             THEN
                NVL(PD.PO_RCV_QTY,0)
             ELSE
                CSI.SUM_RCV_QTY
             END) SUM_RWS_QTY
        FROM
             PO_DTL PD
            ,(
                SELECT
                    C.GLBL_CMPY_CD
                   ,C.PO_ORD_NUM
                   ,C.PO_ORD_DTL_LINE_NUM
                   ,NVL(SUM(C.RCV_QTY),0) SUM_RCV_QTY
                FROM
                    CM_STK_IN C
                WHERE
                    C.EZCANCELFLAG = '0'
                GROUP BY
                    C.GLBL_CMPY_CD
                   ,C.PO_ORD_NUM
                   ,C.PO_ORD_DTL_LINE_NUM
            ) CSI
        WHERE
            PD.GLBL_CMPY_CD        = #glblCmpyCd#
        AND PD.PO_ORD_NUM          = #poOrdNum#
        AND PD.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
        AND PD.EZCANCELFLAG        = '0'
        AND PD.GLBL_CMPY_CD        = CSI.GLBL_CMPY_CD(+)
        AND PD.PO_ORD_NUM          = CSI.PO_ORD_NUM(+)
        AND PD.PO_ORD_DTL_LINE_NUM = CSI.PO_ORD_DTL_LINE_NUM(+)
        GROUP BY
             PD.PO_ORD_NUM
            ,PD.PO_ORD_DTL_LINE_NUM
    </statement>
    <!-- 2018/03/28 QC#24277 ADD -->

    <statement id="getPoInfo" parameterClass="Map" resultClass="Map">
        SELECT
             P.PO_ORD_NUM             PO_ORD_NUM
            ,DPT.DS_PO_TP_DESC_TXT    DS_PO_TP_DESC_TXT
            ,PHS.PO_HDR_STS_DESC_TXT  PO_HDR_STS_DESC_TXT
            ,PAS.PO_APVL_STS_DESC_TXT PO_APVL_STS_DESC_TXT
            ,P.GLBL_CMPY_CD           GLBL_CMPY_CD
            ,P.EZCANCELFLAG           EZCANCELFLAG
        FROM
             PO         P
            ,DS_PO_TP   DPT
            ,PO_HDR_STS PHS
            ,PO_APVL_STS PAS
        WHERE
                P.GLBL_CMPY_CD      = #glblCmpyCd#
            AND P.EZCANCELFLAG      = '0'
            AND P.PO_ORD_NUM        = #poOrdNum#
            AND P.GLBL_CMPY_CD      = DPT.GLBL_CMPY_CD
            AND P.DS_PO_TP_CD       = DPT.DS_PO_TP_CD
            AND DPT.EZCANCELFLAG    = '0'
            AND P.GLBL_CMPY_CD      = PHS.GLBL_CMPY_CD
            AND P.PO_HDR_STS_CD     = PHS.PO_HDR_STS_CD
            <isEqual property="excludeClosedOrder" compareValue="Y">
            AND P.PO_HDR_STS_CD    &lt;&gt; #closed#
            </isEqual>
            <!-- START 2018/03/06 [QC#23505,ADD] -->
            <isNotNull property="prntVndCd">
            AND P.PRNT_VND_CD       = #prntVndCd#
            </isNotNull>
            <isNotNull property="vndCd">
            AND P.VND_CD            = #vndCd#
            </isNotNull>
            <!-- END   2018/03/06 [QC#23505,ADD] -->
            AND PHS.EZCANCELFLAG    = '0'
            AND P.GLBL_CMPY_CD      = PAS.GLBL_CMPY_CD
            AND P.PO_APVL_STS_CD    = PAS.PO_APVL_STS_CD
            AND PAS.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getPmtHldPulldownValue"  parameterClass="Map" resultClass="Map">
        SELECT
            PMT_HLD_CD
        ,   PMT_HLD_DESC_TXT
        FROM
            PMT_HLD
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND EZCANCELFLAG = '0'
        ORDER BY
            PMT_HLD_SORT_NUM ASC
    </statement>

    <statement id="getPmtHldRsnPulldownValue"  parameterClass="Map" resultClass="Map">
        SELECT
            PMT_HLD_RSN_CD
        ,   PMT_HLD_RSN_DESC_TXT
        FROM
            PMT_HLD_RSN
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND EZCANCELFLAG = '0'
        ORDER BY
            PMT_HLD_RSN_SORT_NUM ASC
    </statement>

    <statement id="getPoVendorInfo" parameterClass="Map" resultClass="Map">
        SELECT
             P.PO_ORD_NUM            PO_ORD_NUM
            ,P.VND_CD                VND_CD
            ,P.PRNT_VND_CD           PRNT_VND_CD
        FROM
             PO         P
        WHERE
                P.GLBL_CMPY_CD      = #glblCmpyCd#
            AND P.PO_ORD_NUM        = #poOrdNum#
            AND P.EZCANCELFLAG      = '0'
    </statement>

    <statement id="getPoSts" parameterClass="Map" resultClass="Map">
        SELECT
             PD.PO_LINE_STS_CD      AS PO_LINE_STS_CD
            ,PD.PO_STS_CD           AS PO_STS_CD
            ,PD.PO_ORD_NUM          AS PO_ORD_NUM
            ,PD.PO_ORD_DTL_LINE_NUM AS PO_ORD_DTL_LINE_NUM
        FROM
             PO         P
            ,PO_DTL     PD
        WHERE
                P.GLBL_CMPY_CD          = #glblCmpyCd#
            AND P.EZCANCELFLAG          = '0'
            AND P.PO_ORD_NUM            = #poNum#
            AND P.GLBL_CMPY_CD          = PD.GLBL_CMPY_CD
            AND P.PO_ORD_NUM            = PD.PO_ORD_NUM
            <iterate property="poOrdDtlLines" var="poOrdDtlLines[]" open="AND PD.PO_ORD_DTL_LINE_NUM IN (" close=")" conjunction=",">
            #poOrdDtlLines[]#
            </iterate>
            AND PD.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getVndPmt" parameterClass="Map" resultClass="Map">
        SELECT
             PV.PRNT_VND_CD                                                  AS PRNT_VND_CD
            ,V.VND_PK                                                        AS VND_PK
            ,V.VND_CD                                                        AS VND_CD
            ,PV.PAY_ALONE_FLG                                                AS PAY_ALONE_FLG
            ,NVL(V.VND_PMT_METH_CD, PV.VND_PMT_METH_CD)                      AS VND_PMT_METH_CD
            ,NVL(V_VPM.VND_PMT_METH_DESC_TXT, PV_VPM.VND_PMT_METH_DESC_TXT)  AS VND_PMT_METH_DESC_TXT
            ,NVL(V.VND_PMT_TERM_CD, PV.VND_PMT_TERM_CD)                      AS VND_PMT_TERM_CD
            ,NVL(V_VPT.VND_PMT_TERM_DESC_TXT, PV_VPT.VND_PMT_TERM_DESC_TXT)  AS VND_PMT_TERM_DESC_TXT
            ,NVL(V_VPT.PAY_DT_FIX_FLG, PV_VPT.PAY_DT_FIX_FLG)                AS PAY_DT_FIX_FLG
            ,NVL(V_VPT.PAY_MTH_AOT, PV_VPT.PAY_MTH_AOT)                      AS PAY_MTH_AOT
            ,NVL(V_VPT.PAY_DAY, PV_VPT.PAY_DAY)                              AS PAY_DAY
            ,NVL(V_VPT.PAY_DAY_AOT, PV_VPT.PAY_DAY_AOT)                      AS PAY_DAY_AOT
         FROM
             PRNT_VND       PV
            ,VND            V
            ,VND_PMT_METH   PV_VPM
            ,VND_PMT_METH   V_VPM
            ,VND_PMT_TERM   PV_VPT
            ,VND_PMT_TERM   V_VPT
        WHERE
                PV.GLBL_CMPY_CD         = #glblCmpyCd#
            AND PV.EZCANCELFLAG         = '0'
            AND PV.GLBL_CMPY_CD         = V.GLBL_CMPY_CD
            AND PV.PRNT_VND_PK          = V.PRNT_VND_PK
            AND V.EZCANCELFLAG          = '0'
            AND V.VND_CD                = #apVndCd#
            AND V.EZCANCELFLAG          = '0'
            AND PV.GLBL_CMPY_CD         = PV_VPM.GLBL_CMPY_CD    (+)
            AND PV.VND_PMT_METH_CD      = PV_VPM.VND_PMT_METH_CD (+)
            AND PV_VPM.EZCANCELFLAG (+) = '0'
            AND V.GLBL_CMPY_CD          = V_VPM.GLBL_CMPY_CD    (+)
            AND V.VND_PMT_METH_CD       = V_VPM.VND_PMT_METH_CD (+)
            AND V_VPM.EZCANCELFLAG (+)  = '0'
            AND PV.GLBL_CMPY_CD         = PV_VPT.GLBL_CMPY_CD    (+)
            AND PV.VND_PMT_TERM_CD      = PV_VPT.VND_PMT_TERM_CD (+)
            AND PV_VPT.EZCANCELFLAG (+) = '0'
            AND V.GLBL_CMPY_CD          = V_VPT.GLBL_CMPY_CD    (+)
            AND V.VND_PMT_TERM_CD       = V_VPT.VND_PMT_TERM_CD (+)
            AND V_VPT.EZCANCELFLAG (+)  = '0'
    </statement>

    <statement id="getPmtTermDt" parameterClass="Map" resultClass="Map">
        SELECT
             VPT.VND_PMT_TERM_CD                                             AS VND_PMT_TERM_CD
            ,CASE
                WHEN
                    VPT.PAY_DT_FIX_FLG = 'N'
                THEN
                    CASE
                        WHEN
                            VPT.PAY_DAY_AOT IS NULL
                        THEN
                            #invDt#
                        ELSE
                            TO_CHAR(TO_DATE(#invDt#, 'yyyymmdd') + VPT.PAY_DAY_AOT, 'yyyymmdd')
                    END
                ELSE
                    CASE
                        WHEN
                                VPT.PAY_DAY IS NULL
                            OR  VPT.PAY_MTH_AOT IS NULL
                            OR  VPT.CLO_THRU_DAY IS NULL
                        THEN
                            #invDt#
                        ELSE
                            CASE
                                WHEN
                                    VPT.CLO_THRU_DAY = '00'
                                THEN
                                    TO_CHAR(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE(#invDt#, 'yyyymmdd'), 'yyyymm') || VPT.PAY_DAY, 'yyyymmdd'), VPT.PAY_MTH_AOT), 'yyyymmdd')
                                ELSE
                                    CASE
                                        WHEN
                                            TO_CHAR(TO_DATE(#invDt#, 'yyyymmdd'), 'dd') >= VPT.CLO_THRU_DAY
                                        THEN
                                            TO_CHAR(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE(#invDt#, 'yyyymmdd'), 'yyyymm') || VPT.PAY_DAY, 'yyyymmdd'), VPT.PAY_MTH_AOT + 1), 'yyyymmdd')
                                        ELSE
                                            TO_CHAR(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE(#invDt#, 'yyyymmdd'), 'yyyymm') || VPT.PAY_DAY, 'yyyymmdd'), VPT.PAY_MTH_AOT), 'yyyymmdd')
                                    END
                            END
                    END
             END                                                             AS TERM_NET_DUE_DT
        FROM
            VND_PMT_TERM   VPT
        WHERE
                VPT.GLBL_CMPY_CD          = #glblCmpyCd#
            AND VPT.EZCANCELFLAG          = '0'
            AND VPT.VND_PMT_TERM_DESC_TXT = #vndPmtTermDescTxt#
            AND VPT.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getAttDataForTherefore"  parameterClass="Map" resultClass="Map">
        SELECT
            ATD.ATT_DATA_PK
            ,ATD.ATT_DATA_GRP_TXT
            ,ATD.ATT_DATA_NM      AS DOC_MGT_DOC_ID
            ,ATD.ATT_DOC_TP_CD    AS ATT_DOC_TP_CD
            ,DMC.DOC_MGT_CATG_CD  AS DOC_MGT_CATG_CD
        FROM
            ATT_DATA      ATD
            ,DOC_MGT_CATG DMC
        WHERE
            ATD.GLBL_CMPY_CD     = #glblCmpyCd#
        AND ATD.ATT_DATA_GRP_TXT = #attDataGrpTxt#
        AND ATD.EZCANCELFLAG     = '0'
        AND DMC.GLBL_CMPY_CD     = ATD.GLBL_CMPY_CD
        AND DMC.ATT_DOC_TP_CD    = ATD.ATT_DOC_TP_CD
        <iterate property="thereforeCatgList" var="thereforeCatg[]" open="AND DMC.DOC_MGT_CATG_CD IN (" close=")" conjunction= ", " >
            #thereforeCatg[]#
        </iterate>
        AND DMC.EZCANCELFLAG     = '0'
    </statement>
    <!-- start 2017/01/23 QC#17090 ADD -->
    <statement id="getCoaCdForVar" parameterClass="Map" resultClass="Map">
        SELECT
            LBT.COA_CC_CD
        ,   CPA.COA_ACCT_CD
        ,   MDSE.COA_PROD_CD
        ,   MDSE.COA_MDSE_TP_CD
        <!-- START 2018/08/02 QC#27557 ADD -->
        ,   CDA.CM_COA_BR_CD
        ,   CDA.CM_COA_CH_CD
        ,   CDA.CM_COA_AFFL_CD
        ,   CDA.CM_COA_EXTN_CD
        <!-- END   2018/08/02 QC#27557 ADD -->
        FROM
            MDSE_DLY_SNAP_SHOT    MDSE
        ,   LINE_BIZ_TP           LBT
        ,   COA_PROJ_ACCT         CPA
        <!-- START 2018/08/02 QC#27557 ADD -->
        ,   CM_DEF_ACCT           CDA
        <!-- END   2018/08/02 QC#27557 ADD -->
        WHERE
              MDSE.GLBL_CMPY_CD           = #glblCmpyCd#
        AND   MDSE.EZCANCELFLAG           = '0'
        AND   MDSE.MDSE_CD                = #mdseCd#
        AND   MDSE.LTST_REC_FLG           = #flgY#
        AND   MDSE.GLBL_CMPY_CD           = LBT.GLBL_CMPY_CD(+)
        AND   MDSE.LINE_BIZ_TP_CD         = LBT.LINE_BIZ_TP_CD(+)
        AND   MDSE.EZCANCELFLAG           = LBT.EZCANCELFLAG(+)
        AND   MDSE.GLBL_CMPY_CD           = CPA.GLBL_CMPY_CD(+)
        AND   MDSE.COA_MDSE_TP_CD         = CPA.COA_PROJ_CD(+)
        AND   MDSE.EZCANCELFLAG           = CPA.EZCANCELFLAG(+)
        AND   CPA.COA_PROJ_ACCT_TP_CD(+)  = #coaProjAcctTpCd#
        <!-- START 2018/08/02 QC#27557 ADD -->
        AND   MDSE.GLBL_CMPY_CD           = CDA.GLBL_CMPY_CD(+)
        AND   #cmDefAcctCdVar#            = CDA.CM_DEF_ACCT_CD(+)
        AND   MDSE.EZCANCELFLAG           = CDA.EZCANCELFLAG(+)
        <!-- END   2018/08/02 QC#27557 ADD -->
    </statement>
    <!-- end 2017/01/23 QC#17090 ADD -->
    <!-- start 2017/11/14 QC#21727 ADD -->
    <statement id="getChargeAcct" parameterClass="Map" resultClass="Map">
        SELECT 
             COA_CMPY_CD
            ,COA_AFFL_CD
            ,COA_BR_CD,COA_CC_CD
            ,COA_ACCT_CD,COA_PROD_CD
            ,COA_CH_CD,COA_PROJ_CD
            ,COA_EXTN_CD
        FROM
               DEF_DPLY_COA_INFO
        WHERE
               GLBL_CMPY_CD             = #glblCmpyCd#
           AND APP_FUNC_ID              = #appFuncId#
           AND EZCANCELFLAG             = '0'
    </statement>
    <statement id="getSumBilledQtyExcluveCanInv" parameterClass="Map" resultClass="Map">
        SELECT
           SUM(CIAD.AP_BILL_QTY) SUM_AP_BILL_QTY
        FROM
            CM_INV_ACCT_DIST   CIAD
        <isNotNull property="poOrdDtlLineNum">
           ,CM_AP_INV_DTL      CAID
        </isNotNull>
           ,CM_AP_INV_HDR      CAIH
        WHERE
             CIAD.GLBL_CMPY_CD        = #glblCmpyCd#
         AND CIAD.EZCANCELFLAG        = '0'
         <isNotNull property="poOrdNum">
         AND CIAD.PO_NUM              = #poOrdNum#
         </isNotNull>
    <!-- START 2018/08/15 QC#27029-1 ADD -->
         <isNotNull property="vndRtrnNum">
         AND CIAD.VND_RTRN_NUM        = #vndRtrnNum#
         </isNotNull>
    <!-- END   2018/08/15 QC#27029-1 ADD -->
         <!-- AND CIAD.MDSE_CD             = #mdseCd# --> <!-- 2019/11/27 QC#54355 DEL -->
    <!-- START 2019/03/19 QC#30829 ADD -->
         <isNotNull property="apVndInvNum">
         AND CAIH.AP_VND_INV_NUM   &lt;&gt; #apVndInvNum#
         </isNotNull>
    <!-- END   2019/03/19 QC#30829 ADD -->
    <!-- START 2018/03/22 QC#20316 ADD -->
         <isNull property="poOrdDtlLineNum">
         AND CIAD.GLBL_CMPY_CD        = CAIH.GLBL_CMPY_CD
         AND CIAD.AP_VND_CD           = CAIH.AP_VND_CD
         AND CIAD.AP_VND_INV_NUM      = CAIH.AP_VND_INV_NUM
         AND CAIH.ACCT_INV_STS_CD    != #cancel#
    <!-- START 2018/03/22 QC#25139 ADD -->
    <!-- START 2018/11/20 QC#28660 MOD -->
         <isNotNull property="entered">
         AND CAIH.ACCT_INV_STS_CD    != #entered#
         </isNotNull>
    <!-- END 2018/11/20 QC#28660 MOD -->
    <!-- END 2018/03/22 QC#25139 ADD -->
         </isNull>
         <isNotNull property="poOrdDtlLineNum">
         AND CIAD.GLBL_CMPY_CD        = CAID.GLBL_CMPY_CD
         AND CIAD.AP_VND_CD           = CAID.AP_VND_CD
         AND CIAD.AP_VND_INV_NUM      = CAID.AP_VND_INV_NUM
         AND CIAD.AP_VND_INV_SQ_NUM   = CAID.AP_VND_INV_SQ_NUM
         AND CIAD.AP_VND_INV_LINE_NUM = CAID.AP_VND_INV_LINE_NUM
         AND CAID.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
         AND CAID.GLBL_CMPY_CD        = CAIH.GLBL_CMPY_CD
         AND CAID.AP_VND_CD           = CAIH.AP_VND_CD
         AND CAID.AP_VND_INV_NUM      = CAIH.AP_VND_INV_NUM
         AND CAID.AP_VND_INV_SQ_NUM   = CAIH.AP_VND_INV_SQ_NUM
         AND CAIH.ACCT_INV_STS_CD    != #cancel#
    <!-- START 2018/03/22 QC#25139 ADD -->
    <!-- START 2018/11/20 QC#28660 MOD -->
         <isNotNull property="entered">
         AND CAIH.ACCT_INV_STS_CD    != #entered#
         </isNotNull>
    <!-- END 2018/11/20 QC#28660 MOD -->
    <!-- END 2018/03/22 QC#25139 ADD -->
         </isNotNull>
    <!-- END   2018/03/22 QC#20316 ADD -->
         AND CAIH.EZCANCELFLAG        = '0'
    <!-- GROUP BY CIAD.MDSE_CD --> <!-- 2019/11/27 QC#54355 DEL -->
    </statement>

    <!-- end 2017/11/14 QC#21727 ADD -->
    <!-- 2017/12/20 QC#14858-Sol#060 ADD -->
    <statement id="getTextItem" parameterClass="Map" resultClass="Map">
        SELECT
            M.MDSE_CD
        FROM
            MDSE M
        WHERE
            M.GLBL_CMPY_CD    = #glblCmpyCd#
        AND M.MDSE_CD         = #mdseCd#
        AND M.MDSE_ITEM_TP_CD = #tpTextItem#
        AND M.EZCANCELFLAG    = '0'
    </statement>

    <!-- 2017/12/20 QC#14858-Sol#060 ADD -->
    <statement id="getMdseDescTxtFromPO" parameterClass="Map" resultClass="String">
        SELECT
            PD.MDSE_DESC_SHORT_TXT
        FROM
            PO_DTL PD
        WHERE
            PD.GLBL_CMPY_CD = #glblCmpyCd#
        AND PD.PO_ORD_NUM   = #poOrdNum#
        AND PD.MDSE_CD      = #mdseCd#
        AND PD.EZCANCELFLAG = '0'
    </statement>

    <!-- 2018/01/24 QC#18602-Sol#102 ADD -->
    <statement id="getDsPoTpCd" parameterClass="Map" resultClass="String">
        SELECT
            P.DS_PO_TP_CD
        FROM
            PO P
        WHERE
            P.GLBL_CMPY_CD      = #glblCmpyCd#
        AND P.PO_ORD_NUM        = #poOrdNum#
        AND P.EZCANCELFLAG      = '0'
    </statement>

    <!-- 2018/01/24 QC#18602-Sol#102 ADD -->
    <statement id="getInvoicePoTotalAmt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            NVL(SUM(CIAD.AC_INV_JRNL_COST_AMT), 0) TOT_LINE_AMT
        FROM
             CM_AP_INV_HDR       CAIH
            ,CM_INV_ACCT_DIST    CIAD
        WHERE
            CAIH.GLBL_CMPY_CD      = #glblCmpyCd#
        <!-- AND CAIH.PO_NUM            = #poOrdNum# -->
        AND CAIH.AP_VND_INV_NUM    != #apVndInvNum#
        AND CAIH.ACCT_INV_STS_CD NOT IN (#Canceled#, #Voided#)
        AND CAIH.EZCANCELFLAG      = '0'
        AND CAIH.AP_VND_CD         = CIAD.AP_VND_CD
        AND CAIH.AP_VND_INV_NUM    = CIAD.AP_VND_INV_NUM
        AND CAIH.AP_VND_INV_SQ_NUM = CIAD.AP_VND_INV_SQ_NUM
        AND CIAD.MDSE_CD           = #mdseCd#
        AND CIAD.EZCANCELFLAG      = '0'
        AND CIAD.PO_NUM            = #poOrdNum#
        AND CAIH.GLBL_CMPY_CD      = CIAD.GLBL_CMPY_CD
        GROUP BY
           CIAD.AP_VND_CD
    </statement>
    
    <!-- 2018/01/29 QC#18602-Sol#102 ADD -->
    <statement id="getTotalPoAmtOfMdse" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            SUM(NVL(PD.ENT_PO_DTL_DEAL_NET_AMT, 0)) TOT_LINE_AMT
        FROM
            PO_DTL      PD
        WHERE
            PD.GLBL_CMPY_CD      = #glblCmpyCd#
        AND PD.PO_ORD_NUM        = #poOrdNum#
        AND PD.MDSE_CD           = #mdseCd#
        AND PD.EZCANCELFLAG      = '0'
        GROUP BY
            PD.GLBL_CMPY_CD
           ,PD.PO_ORD_NUM
           ,PD.MDSE_CD
    </statement>
        
    <!-- 2018/01/29 QC#18602-Sol#102 ADD -->
    <statement id="getInvoicePoTotalAmtByMdse" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            NVL(SUM(CIAD.AC_INV_JRNL_COST_AMT), 0) TOT_LINE_AMT
        FROM
             CM_AP_INV_HDR       CAIH
            ,CM_INV_ACCT_DIST    CIAD
        WHERE
            CAIH.AP_VND_CD         = CIAD.AP_VND_CD
        AND CAIH.AP_VND_INV_NUM    = CIAD.AP_VND_INV_NUM
        AND CAIH.AP_VND_INV_SQ_NUM = CIAD.AP_VND_INV_SQ_NUM
        AND CAIH.EZCANCELFLAG      = '0'
        AND CIAD.EZCANCELFLAG      = '0'
        AND CAIH.GLBL_CMPY_CD      = #glblCmpyCd#
        <!-- AND CAIH.PO_NUM            = #poOrdNum# -->
        AND CIAD.PO_NUM            = #poOrdNum#
        AND CIAD.MDSE_CD           = #mdseCd#
        AND CAIH.ACCT_INV_STS_CD NOT IN (#Canceled#, #Voided#)
    </statement>
    
    <!-- 2018/01/29 QC#18602-Sol#102 ADD -->
    <statement id="getPoLineAmtByMdse" parameterClass="Map" resultClass="BigDecimal">
         SELECT
            SUM(NVL(PD.ENT_PO_DTL_DEAL_NET_AMT, 0)) TOT_LINE_AMT
        FROM
            PO_DTL      PD
        WHERE
            PD.GLBL_CMPY_CD      = #glblCmpyCd#
        AND PD.PO_ORD_NUM        = #poOrdNum#
        AND PD.MDSE_CD           = #mdseCd#
        AND PD.EZCANCELFLAG      = '0'
        GROUP BY
            PD.GLBL_CMPY_CD
           ,PD.PO_ORD_NUM
           ,PD.MDSE_CD
    </statement>

    <!-- START 2018/06/26 S.Katsuma [QC#24617,ADD] -->
    <statement id="getRtlWhNmByPo" parameterClass="Map" resultClass="String">
        SELECT
            WH.LOC_NM
        FROM (
            SELECT
                GLBL_CMPY_CD
               ,PO_ORD_NUM
               ,PO_ORD_DTL_LINE_NUM
               ,INVTY_LOC_CD
            FROM
                CM_STK_IN
            WHERE
                GLBL_CMPY_CD        = #glblCmpyCd#
            AND EZCANCELFLAG        = '0'
            AND PO_ORD_NUM          = #poOrdNum#
            AND PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
            GROUP BY
                GLBL_CMPY_CD
               ,PO_ORD_NUM
               ,PO_ORD_DTL_LINE_NUM
               ,INVTY_LOC_CD
            ) CTI
           ,WH WH
        WHERE
            CTI.GLBL_CMPY_CD = WH.GLBL_CMPY_CD
        AND CTI.INVTY_LOC_CD = WH.WH_CD
        AND WH.EZCANCELFLAG  = '0'
    </statement>
    <!-- END 2018/06/26 S.Katsuma [QC#24617,ADD] -->

    <!-- 2018/07/27 QC#27029 ADD -->
    <statement id="getInvoicedQtyOfVendorReturn" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            NVL(SUM(CIAD.AP_BILL_QTY), 0) TOT_AP_BILL_QTY
        FROM
             CM_AP_INV_HDR       CAIH
            ,CM_INV_ACCT_DIST    CIAD
        WHERE
            CAIH.AP_VND_CD         = CIAD.AP_VND_CD
        AND CAIH.AP_VND_INV_NUM    = CIAD.AP_VND_INV_NUM
        AND CAIH.AP_VND_INV_SQ_NUM = CIAD.AP_VND_INV_SQ_NUM
        AND CAIH.EZCANCELFLAG      = '0'
        AND CIAD.EZCANCELFLAG      = '0'
        AND CAIH.GLBL_CMPY_CD      = #glblCmpyCd#
        <!-- mod start 2022/02/15 QC#57090 -->
        <!-- AND CAIH.VND_RTRN_NUM      = #vndRtnNum# -->
        AND CIAD.VND_RTRN_NUM      = #vndRtnNum#
        <!-- mod end 2022/02/15 QC#57090 -->
        AND CIAD.MDSE_CD           = #mdseCd#
        AND CAIH.ACCT_INV_STS_CD NOT IN (#Canceled#, #Voided#)
    </statement>

    <!-- 2018/09/04 QC#28039  ADD -->
    <!-- START 2018/10/03 QC#28660 MOD -->
    <statement id="getListCmApInvDtlByPartialKeyForCreditMemo" parameterClass="Map" resultClass="Map">
        SELECT
             PD.PO_ORD_NUM              AS PO_ORD_NUM
            ,PD.MDSE_CD                 AS MDSE_CD
            ,NVL(PD.PO_INV_BAL_QTY, 0)  AS PO_INV_BAL_QTY
            ,PD.PO_ORD_DTL_LINE_NUM     AS PO_ORD_DTL_LINE_NUM
            ,PD.PO_STS_CD               AS PO_STS_CD
            ,PD.PO_LINE_STS_CD          AS PO_LINE_STS_CD
        FROM
             PO_DTL     PD
        WHERE
                PD.GLBL_CMPY_CD         = #glblCmpyCd#
            AND PD.EZCANCELFLAG         = '0'
            AND PD.PO_ORD_NUM           = #poOrdNum#
            AND (
                    (
                        PD.PO_LINE_STS_CD = #poLineStsCdIsOpen#
                        <iterate property="poStsCdIsOpenList" var="poStsCdIsOpenList[]" open="AND PD.PO_STS_CD IN (" close=")" conjunction=",">
                        #poStsCdIsOpenList[]#
                        </iterate>
                    )
                    OR
                    (
                        <iterate property="poLinsStsCdIsOpenForXXList" var="poLinsStsCdIsOpenForXXList[]" open="PD.PO_LINE_STS_CD IN (" close=")" conjunction=",">
                        #poLinsStsCdIsOpenForXXList[]#
                        </iterate>
                    )
                    OR
                    (
                        PD.PO_STS_CD = #poStsCdIsClosed#
                    )
                )
        ORDER BY
            PD.PO_ORD_NUM
        ,   PD.MDSE_CD
        ,   PD.PO_ORD_DTL_LINE_NUM
    </statement>
    <!-- END   2018/10/03 QC#28660 MOD -->
    <!-- 2018/09/04 QC#28039  ADD -->
    <!-- START 2018/10/03 QC#28099  ADD -->
    <statement id="getVendorReturnVendorInfo" parameterClass="Map" resultClass="Map">
        SELECT
             VR.VND_RTRN_NUM          VND_RTRN_NUM
            ,VR.SHIP_TO_VND_CD        SHIP_TO_VND_CD
            ,PV.PRNT_VND_CD           PRNT_VND_CD
        FROM
             VND_RTRN        VR
            ,VND             V
            ,PRNT_VND        PV
        WHERE
                VR.GLBL_CMPY_CD      = #glblCmpyCd#
            AND VR.VND_RTRN_NUM      = #vndRtrnNum#
            AND VR.GLBL_CMPY_CD      = V.GLBL_CMPY_CD
            AND VR.SHIP_TO_VND_CD    = V.VND_CD
            AND V.GLBL_CMPY_CD       = PV.GLBL_CMPY_CD
            AND V.PRNT_VND_PK        = PV.PRNT_VND_PK
            AND VR.EZCANCELFLAG      = '0'
            AND V.EZCANCELFLAG       = '0'
            AND PV.EZCANCELFLAG      = '0'
    </statement>
    <!-- END   2018/10/03 QC#28099  ADD -->
    <!-- START 2018/10/10 [QC#28521,ADD] -->
    <statement id="getBilledQtyInvMdse" parameterClass="Map" resultClass="Map">
        SELECT
           SUM(CIAD.AP_BILL_QTY) SUM_AP_BILL_QTY
        FROM
            CM_INV_ACCT_DIST   CIAD
           ,CM_AP_INV_DTL      CAID
           ,CM_AP_INV_HDR      CAIH
        WHERE
             CIAD.GLBL_CMPY_CD        = #glblCmpyCd#
         AND CIAD.EZCANCELFLAG        = '0'
         AND CIAD.PO_NUM              = #poOrdNum#
         AND CIAD.MDSE_CD             = #mdseCd#
         AND CIAD.GLBL_CMPY_CD        = CAID.GLBL_CMPY_CD
         AND CIAD.AP_VND_CD           = CAID.AP_VND_CD
         AND CIAD.AP_VND_INV_NUM      = CAID.AP_VND_INV_NUM
         AND CIAD.AP_VND_INV_SQ_NUM   = CAID.AP_VND_INV_SQ_NUM
         AND CIAD.AP_VND_INV_LINE_NUM = CAID.AP_VND_INV_LINE_NUM
         AND CIAD.AP_VND_INV_NUM      = #apVndInvNum#
         AND CAID.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
         AND CAID.GLBL_CMPY_CD        = CAIH.GLBL_CMPY_CD
         AND CAID.AP_VND_CD           = CAIH.AP_VND_CD
         AND CAID.AP_VND_INV_NUM      = CAIH.AP_VND_INV_NUM
         AND CAID.AP_VND_INV_SQ_NUM   = CAIH.AP_VND_INV_SQ_NUM
         AND CAIH.EZCANCELFLAG        = '0'
        GROUP BY CIAD.MDSE_CD
    </statement>
    <!-- END 2018/10/10 [QC#28521,ADD] -->
    <!-- START 2018/11/20 [QC#28660,ADD] -->
    <statement id="getAssociatedInvoice" parameterClass="Map" resultClass="Map">
        SELECT
            CAIH.GLBL_CMPY_CD
           ,CAIH.AP_VND_CD
           ,CAIH.AP_VND_INV_NUM
           ,CAIH.AP_VND_INV_SQ_NUM
        FROM
            CM_AP_INV_HDR      CAIH
           ,CM_AP_INV_DTL      CAID <!-- 2020/03/13 [QC#53413, ADD] -->
        WHERE
             CAIH.GLBL_CMPY_CD        = #glblCmpyCd#
         AND CAIH.EZCANCELFLAG        = '0'
         AND CAIH.CM_AP_INV_TP_CD    != #cmApInvTpCd#
         <!-- AND CAIH.PO_NUM              = #poNum#  --> <!-- 2020/03/13 [QC#53413, DEL] -->
         AND CAIH.ACCT_INV_STS_CD    IN (#entered#, #authorized#)
         AND CAIH.EZCANCELFLAG        = '0'
         <!-- START 2020/03/13 [QC#53413,ADD] -->
         AND CAID.GLBL_CMPY_CD        = CAID.GLBL_CMPY_CD
         AND CAID.AP_VND_CD           = CAIH.AP_VND_CD
         AND CAID.AP_VND_INV_NUM      = CAIH.AP_VND_INV_NUM
         AND CAID.AP_VND_INV_SQ_NUM   = CAIH.AP_VND_INV_SQ_NUM
         AND CAID.PO_NUM              = #poNum#
         AND CAID.EZCANCELFLAG        = '0'
         <!-- START 2020/03/13 [QC#53413,ADD] -->
    </statement>

    <statement id="getAssociatedCreditMemo" parameterClass="Map" resultClass="Map">
        SELECT
            CAIH.GLBL_CMPY_CD
           ,CAIH.AP_VND_CD
           ,CAIH.AP_VND_INV_NUM
           ,CAIH.AP_VND_INV_SQ_NUM
        FROM
            CM_AP_INV_HDR      CAIH
           ,CM_AP_INV_DTL      CAID <!-- 2020/03/13 [QC#53413, ADD] -->
        WHERE
             CAIH.GLBL_CMPY_CD        = #glblCmpyCd#
         AND CAIH.EZCANCELFLAG        = '0'
         AND CAIH.CM_AP_INV_TP_CD     = #cmApInvTpCd#
         <!-- AND CAIH.PO_NUM              = #poNum# --> <!-- 2020/03/13 [QC#53413, DEL] -->
         AND CAIH.ACCT_INV_STS_CD    IN (#entered#, #authorized#)
         AND CAIH.EZCANCELFLAG        = '0'
         <!-- START 2020/03/13 [QC#53413,ADD] -->
         AND CAID.GLBL_CMPY_CD        = CAID.GLBL_CMPY_CD
         AND CAID.AP_VND_CD           = CAIH.AP_VND_CD
         AND CAID.AP_VND_INV_NUM      = CAIH.AP_VND_INV_NUM
         AND CAID.AP_VND_INV_SQ_NUM   = CAIH.AP_VND_INV_SQ_NUM
         AND CAID.PO_NUM              = #poNum#
         AND CAID.EZCANCELFLAG        = '0'
         <!-- START 2020/03/13 [QC#53413,ADD] -->
    </statement>
    <!-- END 2018/11/20 [QC#28660,ADD] -->

    <!-- START 2021/04/26 R.Azucena [QC#56829,ADD] -->
    <statement id="getPmtHldQtyCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            NVL(SUM(HOLD_QTY_LIST.HOLD_QTY),0)
        FROM (
            SELECT
                MAX(CIAD.AP_BILL_QTY) AS HOLD_QTY
            FROM
                CM_INV_ACCT_DIST   CIAD
        <isNotNull property="poOrdDtlLineNum">
               ,CM_AP_INV_DTL      CAID
        </isNotNull>
               ,CM_AP_INV_HDR      CAIH
            WHERE
                CIAD.GLBL_CMPY_CD        = #glblCmpyCd#
            AND CIAD.EZCANCELFLAG        = '0'
            AND CIAD.MDSE_CD             = #mdseCd#
            AND CIAD.GLBL_CMPY_CD        = CAIH.GLBL_CMPY_CD
            AND CIAD.AP_VND_CD           = CAIH.AP_VND_CD
            AND CIAD.AP_VND_INV_NUM      = CAIH.AP_VND_INV_NUM
        <isNotNull property="poOrdNum">
            AND CIAD.PO_NUM              = #poOrdNum#
        </isNotNull>
        <isNotNull property="vndRtrnNum">
            AND CIAD.VND_RTRN_NUM        = #vndRtrnNum#
        </isNotNull>
        <isNotNull property="poOrdDtlLineNum">
            AND CIAD.GLBL_CMPY_CD        = CAID.GLBL_CMPY_CD
            AND CIAD.AP_VND_CD           = CAID.AP_VND_CD
            AND CIAD.AP_VND_INV_NUM      = CAID.AP_VND_INV_NUM
            AND CIAD.AP_VND_INV_SQ_NUM   = CAID.AP_VND_INV_SQ_NUM
            AND CIAD.AP_VND_INV_LINE_NUM = CAID.AP_VND_INV_LINE_NUM
            AND CAID.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
            AND CAID.AP_VND_INV_SQ_NUM   = CAIH.AP_VND_INV_SQ_NUM
            AND CAID.EZCANCELFLAG        = '0'
        </isNotNull>
        <!-- START 2021/06/04 H.Dimay [QC#56829, ADD] -->
        <isNotNull property="apVndInvNum">
        <!-- END 2021/06/04 H.Dimay [QC#56829, ADD] -->
            AND CAIH.AP_VND_INV_NUM      &lt;&gt; #apVndInvNum#
        <!-- START 2021/06/04 H.Dimay [QC#56829, ADD] -->
        </isNotNull>
        <!-- END 2021/06/04 H.Dimay [QC#56829, ADD] NFBL-->
            AND CAIH.EZCANCELFLAG        = '0'
            AND CAIH.PMT_HLD_FLG         = 'Y'
            GROUP BY
                CIAD.AP_VND_INV_NUM, CIAD.AP_VND_INV_SQ_NUM, CIAD.AP_VND_INV_LINE_NUM
         ) HOLD_QTY_LIST
    </statement>
    <!-- END 2021/04/26 R.Azucena [QC#56829,ADD] -->

    <!-- Start 2023/1/17 S.Nakatani [QC#60812, ADD]-->
    <statement id="getUpateAjeCmIntfcRecord" parameterClass="Map" resultClass="Map">
    SELECT
        A.AJE_CM_INTFC_PK
    FROM
        AJE_CM_INTFC A 
    WHERE
            A.GLBL_CMPY_CD      = #glblCmpyCd# 
        AND A.EZCANCELFLAG      = '0'
        AND A.VND_CD            = #apVndCd#
        AND A.AP_VND_INV_NUM    = #apVndInvNum#
    </statement>
    
    <statement id="getUpateCmAcrlWriteOffRecord" parameterClass="Map" resultClass="Map">
    SELECT
        A.CM_ACRL_WRITE_OFF_PK
    FROM
        CM_ACRL_WRITE_OFF A 
    WHERE
            A.GLBL_CMPY_CD      = #glblCmpyCd# 
        AND A.EZCANCELFLAG      = '0'
        AND A.AP_VND_CD         = #apVndCd#
        AND A.AP_VND_INV_NUM    = #apVndInvNum#

    </statement>
    
    <statement id="getUpateJrnlEntryRecord" parameterClass="Map" resultClass="Map">
    SELECT
        A.JRNL_ENTRY_PK
    FROM
        JRNL_ENTRY A 
    WHERE
            A.GLBL_CMPY_CD            = #glblCmpyCd# 
        AND A.EZCANCELFLAG            = '0'
        AND A.TRX_CD                  = #trxCostCalc#
        <iterate property="trxRsnList" var="trxRsnList[]" open="AND A.TRX_RSN_CD IN (" close=")" conjunction=",">
            #trxRsnList[]#
        </iterate>
        AND A.JRNL_ENTRY_SCD_ATTRB_NM = #txtApInvNum#
        AND A.VND_CD                  = #apVndCd#
        AND A.JRNL_ENTRY_SCD_REF_TXT  = #apVndInvNum#
    </statement>
    <statement id="getArcsPmtId" parameterClass="Map" resultClass="Map">
    SELECT
          A.ARCS_PMT_ID
        , A.AP_VND_CD
    FROM
        AP_INV_PMT A 
    WHERE
            A.GLBL_CMPY_CD            = #glblCmpyCd# 
        AND A.EZCANCELFLAG            = '0'
        AND A.AP_VND_CD               IN (  SELECT 
                                                VND2.VND_CD 
                                            FROM 
                                                  VND VND1
                                                , VND VND2
                                                , PRNT_VND P_VND 
                                            WHERE
                                                     VND1.PRNT_VND_PK  = P_VND.PRNT_VND_PK 
                                                 AND VND1.VND_CD       = #apVndCd# 
                                                 AND P_VND.PRNT_VND_PK = VND2.PRNT_VND_PK
                                          )
        AND A.AP_VND_INV_NUM          = #apVndInvNum#
    </statement>
    <!-- End 2023/1/17 S.Nakatani [QC#60812, ADD]-->
</sqlMap>
