<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NPAB261001">
    <statement id="getPoAckIntfcLst" parameterClass="Map" resultClass="Map">
        SELECT
            EPAH.PO_ACK_ORD_NUM
           ,EPAH.PO_ACK_HDR_CRAT_DT
           ,EPAH.PO_ACK_HDR_CRAT_TM
           ,EPAH.PO_ACK_HDR_VND_ORD_NUM
           ,EPAD.PO_ACK_ORD_NUM DTL_PO_ACK_ORD_NUM
           ,EPAD.PO_ACK_ORD_DTL_LINE_NUM
           ,EPAD.PO_ACK_MDSE_CD
           ,EPAD.PO_ACK_VND_MDSE_CD
           ,EPAD.PO_ACK_CONF_QTY
           ,EPAD.PO_ACK_ORD_PRC_NUM
           ,EPAD.PO_ACK_DTL_UOM_CD
           ,EPAD.PO_ACK_DTL_RDD_DT
           ,EPAD.PO_ACK_DTL_PO_ACK_CD
           ,VPAS.VND_PO_ACK_STS_CD
           ,VPAS.PO_ACK_LINE_STS_CD
           ,PALS.PO_ACK_LINE_STS_NM
        FROM
            NPAI0410_01             EPAH
           ,NPAI0410_04             EPAD
           ,PO_ACK_VND_SHPG_STS_MAP PAVS
           ,VND_PO_ACK_STS          VPAS
           ,PO_ACK_LINE_STS         PALS
        WHERE
            EPAH.INTERFACE_ID         = #interfaceId#
        AND EPAH.TRANSACTION_ID       = #transactionId#
        AND EPAH.INTERFACE_ID         = EPAD.INTERFACE_ID (+)
        AND EPAH.TRANSACTION_ID       = EPAD.TRANSACTION_ID (+)
        AND EPAH.PO_ACK_ORD_NUM       = EPAD.PO_ACK_ORD_NUM (+)
        AND EPAD.PO_ACK_DTL_PO_ACK_CD = PAVS.VND_SHPG_STS_CD (+)
        AND PAVS.GLBL_CMPY_CD (+)     = #glblCmpyCd#
        AND PAVS.GLBL_CMPY_CD         = VPAS.GLBL_CMPY_CD (+)
        AND PAVS.VND_PO_ACK_STS_CD    = VPAS.VND_PO_ACK_STS_CD (+)
        AND VPAS.GLBL_CMPY_CD         = PALS.GLBL_CMPY_CD (+)
        AND VPAS.PO_ACK_LINE_STS_CD   = PALS.PO_ACK_LINE_STS_CD (+)
        AND EPAH.EZCANCELFLAG         = '0'
        AND EPAD.EZCANCELFLAG (+)     = '0'
        AND PAVS.EZCANCELFLAG (+)     = '0'
        AND VPAS.EZCANCELFLAG (+)     = '0'
        AND PALS.EZCANCELFLAG (+)     = '0'
        ORDER BY
<!-- START 2020/09/02 A.Marte [QC#56898,MOD] -->
<!--    EPAH.UNIT_ID DESC  -->
<!--    ,EPAD.SEQ_NUMBER DESC -->
        EPAH.PO_ACK_ORD_NUM DESC
<!-- END 2020/09/02 A.Marte [QC#56898,MOD] -->
    </statement>


    <statement id="getMaxPoAckNumFromPoAckHdrWrk" parameterClass="Map" resultClass="String">
        SELECT
            MAX(TO_NUMBER(PAHW.PO_ACK_NUM))
        FROM
            PO_ACK_HDR_WRK PAHW
        WHERE
            PAHW.EDI_PO_ORD_NUM = #ediPoOrdNum#
        AND PAHW.GLBL_CMPY_CD   = #glblCmpyCd#
        AND PAHW.EZCANCELFLAG   = '0'
    </statement>

    <statement id="getMaxPoAckNumFromPoAckHdr" parameterClass="Map" resultClass="String">
        SELECT
            MAX(TO_NUMBER(PAH.PO_ACK_NUM))
        FROM
            PO_ACK_HDR PAH
        WHERE
            PAH.PO_ORD_NUM     = #poOrdNum#
        AND PAH.GLBL_CMPY_CD   = #glblCmpyCd#
        AND PAH.EZCANCELFLAG   = '0'
    </statement>

<!-- START 2018/11/12 M.Naito [QC#29050,MOD] -->
    <statement id="getVndUom" parameterClass="Map" resultClass="String">
        SELECT
            TPU.PKG_UOM_CD
        FROM
            TRD_PTNR_UOM_XREF TPU
           ,PKG_UOM           PU
           ,PKG_UOM           PU2
        WHERE
            TPU.GLBL_CMPY_CD    = #glblCmpyCd#
        AND TPU.VND_CD          = #vndCd#
        AND TPU.TRD_PTNR_UOM_CD = #poAckDtlUomCd#
        AND TPU.EZCANCELFLAG    = '0'
        AND TPU.GLBL_CMPY_CD    = PU.GLBL_CMPY_CD
        AND TPU.PKG_UOM_CD      = PU.PKG_UOM_CD
        AND PU.EZCANCELFLAG     = '0'
        AND PU.GLBL_CMPY_CD     = PU2.GLBL_CMPY_CD
        AND PU.PKG_UOM_CLS_CD   = PU2.PKG_UOM_CLS_CD
        AND PU2.PKG_UOM_CD      = #pkgUomCd#
        AND PU2.EZCANCELFLAG    = '0'
        AND ROWNUM              = 1
    </statement>
<!-- END 2018/11/12 M.Naito [QC#29050,MOD] -->

    <statement id="getVndCd" parameterClass="Map" resultClass="String">
        SELECT
            RAV.RCV_ASN_VND_CD
        FROM
            RCV_ASN_VND RAV
        WHERE
            RAV.GLBL_CMPY_CD  = #glblCmpyCd#
        AND RAV.VND_SYS_TP_CD = #vndSysTpCd#
        AND RAV.EZCANCELFLAG  = '0'
    </statement>

    <statement id="getPoInfo" parameterClass="Map" resultClass="Map">
        SELECT
            PD.PO_ORD_NUM
           ,PD.SHPG_SVC_LVL_CD
           ,PD.SHIP_TO_ST_CD
        FROM
            PO_DTL PD
        WHERE
            PD.GLBL_CMPY_CD        = #glblCmpyCd#
        AND PD.PO_ORD_NUM          = #poOrdNum#
        AND PD.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
        AND PD.EZCANCELFLAG        = '0'
    </statement>

    <statement id="getDelyLeadAot" parameterClass="Map" resultClass="BigDecimal">
    SELECT
        A.DELY_LEAD_AOT
    FROM (
        SELECT
            VSL_ACK.VND_SHIP_LT_PRIORITY
           ,VSL_ACK.DELY_LEAD_AOT
        FROM (
            <!-- priority 1 : VND_CD, ST_CD, METH_CD -->
            SELECT
                1 VND_SHIP_LT_PRIORITY
               ,VSL.DELY_LEAD_AOT
            FROM
                VND_SHIP_LT VSL
            WHERE
                VSL.GLBL_CMPY_CD     = #glblCmpyCd#
            AND VSL.VND_CD           = #vndCd#
            AND VSL.DEST_ST_CD       = #stCd#
            AND VSL.VND_SHIP_METH_CD = #vndShipMethCd#
            AND VSL.EZCANCELFLAG     = '0'
            <!-- priority 2 : VND_CD, METH_CD -->
            UNION
            SELECT
                2 VND_SHIP_LT_PRIORITY
               ,VSL.DELY_LEAD_AOT
            FROM
                VND_SHIP_LT VSL
            WHERE
                VSL.GLBL_CMPY_CD     = #glblCmpyCd#
            AND VSL.VND_CD           = #vndCd#
            AND VSL.DEST_ST_CD       = #ast#
            AND VSL.VND_SHIP_METH_CD = #vndShipMethCd#
            AND VSL.EZCANCELFLAG     = '0'
            <!-- priority 3 : VND_CD -->
            UNION
            SELECT
                3 VND_SHIP_LT_PRIORITY
               ,VSL.DELY_LEAD_AOT
            FROM
                VND_SHIP_LT VSL
            WHERE
                VSL.GLBL_CMPY_CD     = #glblCmpyCd#
            AND VSL.VND_CD           = #vndCd#
            AND VSL.DEST_ST_CD       = #ast#
            AND VSL.VND_SHIP_METH_CD = #ast#
            AND VSL.EZCANCELFLAG     = '0'
        ) VSL_ACK
        ORDER BY
            VSL_ACK.VND_SHIP_LT_PRIORITY
    ) A
    WHERE
        ROWNUM = 1
    </statement>

    <statement id="getMdseNm" parameterClass="Map" resultClass="String">
        SELECT
            PD.MDSE_NM
        FROM
            PO_DTL PD
        WHERE
            PD.GLBL_CMPY_CD        = #glblCmpyCd#
        AND PD.PO_ORD_NUM          = #poOrdNum#
        AND PD.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
        AND PD.MDSE_CD             = #mdseCd#
        AND PD.EZCANCELFLAG        = '0'
    </statement>

    <statement id="getSplyItemNumFromAsl" parameterClass="Map" resultClass="String">
        SELECT
            AD.SPLY_ITEM_NUM
        FROM
             ASL_HDR AH
            ,ASL_DTL AD
        WHERE
            AH.GLBL_CMPY_CD                 = #glblCmpyCd#
        AND AH.ASL_START_DT                 &lt;= #batDt#
        AND NVL(AH.ASL_END_DT, '99991231')  &gt;= #batDt#
        AND AH.EZCANCELFLAG                 = '0'
        AND AH.GLBL_CMPY_CD                 = AD.GLBL_CMPY_CD
        AND AH.ASL_HDR_PK                   = AD.ASL_HDR_PK
        AND AD.VND_CD                       = #vndCd#
        AND AD.MDSE_CD                      = #mdseCd#
        AND AD.EFF_FROM_DT                  &lt;= #batDt#
        AND NVL(AD.EFF_THRU_DT, '99991231') &gt;= #batDt#
        AND AD.EZCANCELFLAG                 = '0'
    </statement>

<!-- START 2018/11/12 M.Naito [QC#29050,ADD] -->
    <statement id="getMdseStorePkg" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            MDSE_STORE_PKG MSP
        WHERE
            MSP.GLBL_CMPY_CD    = #glblCmpyCd#
        AND MSP.MDSE_CD         = #mdseCd#
        AND MSP.BASE_PKG_UOM_CD = #basePkgUomCd#
        AND MSP.PKG_UOM_CD      = #pkgUomCd#
        AND MSP.EZCANCELFLAG    = '0'
    </statement>
<!-- END 2018/11/12 M.Naito [QC#29050,ADD] -->
</sqlMap>
