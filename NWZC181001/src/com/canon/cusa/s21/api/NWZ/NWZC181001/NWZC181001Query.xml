<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWZC181001Query">

    <statement id="countAutoSplyInfo" parameterClass="Map" resultClass="BigDecimal">
        SELECT              
            COUNT(OCBC.ORD_CATG_BIZ_CTX_PK)
        FROM
            ORD_CATG_BIZ_CTX OCBC
        WHERE
            OCBC.GLBL_CMPY_CD       = #pMsg.glblCmpyCd#
        AND OCBC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTpCd#
        AND OCBC.DS_ORD_CATG_CD     = #pMsg.dsOrdCatgCd#
        AND (
            OCBC.DS_ORD_TP_CD       = #pMsg.dsOrdTpCd#
            OR
            OCBC.DS_ORD_TP_CD IS NULL
        )
        AND OCBC.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getContractTypeForOrdEntry" parameterClass="Map" resultClass="String">
        SELECT
            DC.PRC_SVC_CONTR_TP_CD
        FROM
            DS_CPO_CONFIG       DCC
           ,CPO_DTL             CD
           ,DS_CONTR_DTL        DCD
           ,DS_CONTR            DC
        WHERE
            DCC.GLBL_CMPY_CD         = #pMsg.glblCmpyCd# 
        AND DCC.DS_CPO_CONFIG_PK     = #pMsg.dsCpoConfigPk#
        AND DCC.EZCANCELFLAG         = '0'

        AND DCC.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD
        AND DCC.DS_CPO_CONFIG_PK     = CD.DS_CPO_CONFIG_PK
        AND CD.EZCANCELFLAG          = '0'

        AND CD.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM           = DCD.CPO_ORD_NUM
        AND CD.CPO_DTL_LINE_NUM      = DCD.CPO_DTL_LINE_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM  = DCD.CPO_DTL_LINE_SUB_NUM
        AND DCD.EZCANCELFLAG         = '0'

        AND DCD.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD
        AND DCD.DS_CONTR_PK          = DC.DS_CONTR_PK
        AND DCD.EZCANCELFLAG         = '0'
        ORDER BY
             DCD.CPO_ORD_NUM
            ,DCD.CPO_DTL_LINE_NUM
            ,DCD.CPO_DTL_LINE_SUB_NUM
    </statement>

    <statement id="getContractTypeForOrdImp" parameterClass="Map" resultClass="String">
        SELECT
            DISD.PRC_SVC_CONTR_TP_CD
        FROM
            DS_IMPT_ORD_CONFIG      DIOC
           ,DS_IMPT_ORD_DTL         DIOD
           ,DS_IMPT_SVC_CONFIG_REF  DISCR
           ,DS_IMPT_SVC_DTL         DISD
        WHERE
            DIOC.GLBL_CMPY_CD          = #pMsg.glblCmpyCd#
        AND DIOC.DS_IMPT_ORD_CONFIG_PK = #pMsg.dsImptOrdConfigPk#
        AND DIOC.EZCANCELFLAG          = '0'

        AND DIOC.GLBL_CMPY_CD          = DIOD.GLBL_CMPY_CD
        AND DIOC.DS_IMPT_ORD_CONFIG_PK = DIOD.DS_IMPT_ORD_CONFIG_PK
        AND DIOD.EZCANCELFLAG          = '0'

        AND DIOD.GLBL_CMPY_CD          = DISCR.GLBL_CMPY_CD
        AND DIOD.DS_IMPT_ORD_PK        = DISCR.DS_IMPT_ORD_PK
        AND DIOD.DS_IMPT_ORD_DTL_PK    = DISCR.DS_IMPT_ORD_DTL_PK
        AND DISCR.EZCANCELFLAG         = '0'

        AND DISCR.GLBL_CMPY_CD         = DISD.GLBL_CMPY_CD
        AND DISCR.DS_IMPT_SVC_DTL_PK   = DISD.DS_IMPT_SVC_DTL_PK
        AND DISD.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getLineCatg" parameterClass="Map" resultClass="String">
        SELECT
            OLVS.DS_ORD_LINE_CATG_CD
        FROM 
            ORD_LINE_VAL_SET OLVS
        WHERE
            OLVS.GLBL_CMPY_CD            = #pMsg.glblCmpyCd#
        AND OLVS.ORD_LINE_CTX_TP_CD      = #ordLineCtxTpCd#
        AND OLVS.THIRD_BIZ_CTX_ATTRB_TXT = #thirdBizCtxAttrbTxt#
        AND OLVS.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getLineCatgForInitSply" parameterClass="Map" resultClass="String">
        SELECT
            OLVS.DS_ORD_LINE_CATG_CD
        FROM 
            ORD_LINE_VAL_SET OLVS
        WHERE
            OLVS.GLBL_CMPY_CD       = #pMsg.glblCmpyCd#
        AND OLVS.EZCANCELFLAG       = '0'
        AND OLVS.ORD_LINE_CTX_TP_CD = #ordLineCtxTpCd#
    </statement>

    <statement id="getChildMdseList" parameterClass="Map" resultClass="Map">
        SELECT 
            CASE
                WHEN CMP.CHILD_MDSE_CD IS NOT NULL AND OTM.ORD_TAKE_MDSE_CD IS NOT NULL THEN
                    OTM.ORD_TAKE_MDSE_CD
                WHEN CMP.CHILD_MDSE_CD IS NOT NULL AND OTM.ORD_TAKE_MDSE_CD IS NULL THEN
                    CMP.CHILD_MDSE_CD
                ELSE
                    CMP.CHILD_ORD_TAKE_MDSE_CD
            END AS MDSE_CD
            ,CMP.CHILD_MDSE_QTY 
        FROM
            CMPSN CMP
            ,ORD_TAKE_MDSE OTM
        WHERE 
                CMP.GLBL_CMPY_CD                    = #glblCmpyCd#
            AND CMP.EZCANCELFLAG                    = '0'
            AND CMP.PRNT_MDSE_CD                    = #prntMdseCd#
            AND CMP.EFF_FROM_DT                     &lt;= #slsDt#
            AND NVL(CMP.EFF_THRU_DT, '99991231')    &gt;= #slsDt#
            AND CMP.GLBL_CMPY_CD                    = OTM.GLBL_CMPY_CD(+)
            AND SUBSTR(CMP.CHILD_MDSE_CD,1,#ordTakeLen#) = OTM.ORD_TAKE_MDSE_CD(+)
            AND OTM.EZCANCELFLAG(+)                 = '0'
        ORDER BY
            CMP.CMPSN_PK
        <!-- 2017/03/01 QC#16800 Add End   -->
     </statement>
    
</sqlMap>
