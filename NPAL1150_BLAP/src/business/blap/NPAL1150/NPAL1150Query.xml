<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPAL1150Query">
    <typeAlias alias="NPAL1150_ASMsg" type="business.blap.NPAL1150.NPAL1150_ASMsg"/>

    <!--Search-->
    <statement id="getEdiAsnErrorList" parameterClass="Map" resultMap="result.NPAL1150_ASMsg">
       SELECT
              VND.DPLY_VND_NM                    AS VND_NM
              ,EAHW.ASN_SO_NUM                   AS ASN_SO_NUM
              ,EAHW.EDI_PO_ORD_NUM               AS EDI_PO_ORD_NUM
              ,STS.ASN_EDI_PROC_STS_CD           AS ASN_EDI_PROC_STS_CD
              ,STS.ASN_EDI_PROC_STS_NM           AS ASN_EDI_PROC_STS_NM
              ,EAHW.EDI_RCV_TS                   AS EDI_RCV_TS
              ,EAHW.VND_INVTY_LOC_CD             AS VND_INVTY_LOC_CD
              ,EAHW.ASN_SHIP_DT_TM_TS            AS ASN_SHIP_DT_TM_TS
              ,EAHW.EZUPTIME                     AS EZUPTIME
              ,EAHW.EZUPTIMEZONE                 AS EZUPTIMEZONE
              ,STS.OPEN_ASN_WRK_FLG              AS OPEN_ASN_WRK_FLG
       FROM    EDI_ASN_HDR_WRK                   EAHW
              ,ASN_EDI_PROC_STS                  STS
              ,PO_VND_V                          VND
       WHERE      EAHW.GLBL_CMPY_CD              = #glblCmpyCd#
         <isNotNull property="vndCd">
             AND  EAHW.VND_CD                    = #vndCd#
         </isNotNull>
         <isNotNull property="ediPoOrdNum">
             AND  EAHW.EDI_PO_ORD_NUM            = #ediPoOrdNum#
         </isNotNull>
         <isNotNull property="asnEdiProcStsCd">
             AND  EAHW.ASN_EDI_PROC_STS_CD       = #asnEdiProcStsCd#
         </isNotNull>
         <isNotNull property="ediRcvDateTsFrom">
             AND  EAHW.EDI_RCV_TS            &gt;= #ediRcvDateTsFrom#
         </isNotNull>
         <isNotNull property="ediRcvDateTsTo">
             AND  EAHW.EDI_RCV_TS            &lt;= #ediRcvDateTsTo#
         </isNotNull>
         AND  EAHW.EZCANCELFLAG                  = '0'
         AND  EAHW.GLBL_CMPY_CD                  = STS.GLBL_CMPY_CD(+)
         AND  EAHW.ASN_EDI_PROC_STS_CD           = STS.ASN_EDI_PROC_STS_CD(+)
         AND  STS.EZCANCELFLAG(+)                = '0'
         AND  EAHW.GLBL_CMPY_CD                  = VND.GLBL_CMPY_CD(+)
         AND  EAHW.VND_CD                        = VND.VND_CD(+)
         AND  VND.EZCANCELFLAG(+)                = '0'
         <isNotNull property="batErrMsgTxt">
             AND  EXISTS (
                 SELECT
                     *
                 FROM
                     EDI_ASN_ERR_WRK A
                 WHERE
                     A.GLBL_CMPY_CD        =    EAHW.GLBL_CMPY_CD
                     AND A.ASN_SO_NUM      =    EAHW.ASN_SO_NUM
                     AND A.EZCANCELFLAG    =    '0'
                     AND A.BAT_ERR_MSG_TXT LIKE #batErrMsgTxt#
             )
         </isNotNull>
         AND  ROWNUM                         &lt;= #maxRowNum#
         ORDER    BY                             ASN_SO_NUM
                                                ,EDI_PO_ORD_NUM
                                                ,EDI_RCV_TS
                                                ,ASN_SHIP_DT_TM_TS
    </statement>

    <resultMap id="result.NPAL1150_ASMsg" class="NPAL1150_ASMsg">
        <result property="dplyVndNm_B1"            column="VND_NM"                  javaType="EZDSStringItem"/>
        <result property="asnSoNum_B1"             column="ASN_SO_NUM"              javaType="EZDSStringItem"/>
        <result property="ediPoOrdNum_B1"          column="EDI_PO_ORD_NUM"          javaType="EZDSStringItem"/>
        <result property="asnEdiProcStsCd_B1"      column="ASN_EDI_PROC_STS_CD"     javaType="EZDSStringItem"/>
        <result property="asnEdiProcStsNm_B1"      column="ASN_EDI_PROC_STS_NM"     javaType="EZDSStringItem"/>
        <result property="ediRcvDateTs_B1"         column="EDI_RCV_TS"              javaType="EZDSStringItem"/>
        <result property="vndInvtyLocCd_B1"        column="VND_INVTY_LOC_CD"        javaType="EZDSStringItem"/>
        <result property="asnShipDtTmTs_B1"        column="ASN_SHIP_DT_TM_TS"       javaType="EZDSStringItem"/>
        <result property="ezUpTime_B1"             column="EZUPTIME"                javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_B1"         column="EZUPTIMEZONE"            javaType="EZDSStringItem"/>
        <result property="openAsnWrkFlg_B1"        column="OPEN_ASN_WRK_FLG"        javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="getSoLinkHeader" parameterClass="Map" resultClass="Map">
        SELECT   VND.DPLY_VND_NM            AS VND_NM
                ,STS.ASN_EDI_PROC_STS_NM    AS ASN_EDI_PROC_STS_NM
                ,EAHW.EDI_RCV_TS            AS EDI_RCV_TS
                ,EAHW.ASN_SO_NUM            AS ASN_SO_NUM
                ,EAHW.EDI_PO_ORD_NUM        AS EDI_PO_ORD_NUM
                ,EAHW.VND_INVTY_LOC_CD      AS VND_INVTY_LOC_CD
                ,EAHW.ASN_SHIP_DT_TM_TS     AS ASN_SHIP_DT_TM_TS
                ,EAHW.SHIP_FROM_SO_NUM      AS SHIP_FROM_SO_NUM
                ,EAEW.BAT_ERR_MSG_TXT       AS BAT_ERR_MSG_TXT
                ,XREF.PO_ORD_NUM            AS XREF_ORD_NUM
                ,EAHW.PO_ORD_NUM            AS EADW_PO_ORD_NUM
                ,EAHW.EDI_PO_ORD_NUM        AS EADW_EDI_PO_ORD_NUM
                ,CASE WHEN XREF.PO_ORD_NUM  IS NOT NULL THEN XREF.PO_ORD_NUM
                      WHEN EAHW.PO_ORD_NUM  IS NOT NULL THEN EAHW.PO_ORD_NUM
                      WHEN LENGTH(EAHW.EDI_PO_ORD_NUM) &lt;= $poOrdNumLength$ THEN EAHW.EDI_PO_ORD_NUM
                      ELSE NULL
                 END                        AS PO_ORD_NUM
                ,EAHW.VND_CD                AS VND_CD
                ,EAHW.ITRL_INTFC_ID         AS ITRL_INTFC_ID
          FROM   EDI_ASN_HDR_WRK               EAHW
                ,EDI_ASN_ERR_WRK               EAEW
                ,ASN_EDI_PROC_STS              STS
                ,PO_VND_V                      VND
                ,EDI_PO_DTL_XREF               XREF
         WHERE   EAHW.GLBL_CMPY_CD               = #glblCmpyCd#
           AND   EAHW.ASN_SO_NUM                 = #asnSoNum#
           AND   EAHW.GLBL_CMPY_CD               = STS.GLBL_CMPY_CD(+)
           AND   EAHW.ASN_EDI_PROC_STS_CD        = STS.ASN_EDI_PROC_STS_CD(+)
           AND   EAHW.GLBL_CMPY_CD               = VND.GLBL_CMPY_CD(+)
           AND   EAHW.VND_CD                     = VND.VND_CD(+)
           AND   EAHW.GLBL_CMPY_CD               = EAEW.GLBL_CMPY_CD(+)
           AND   EAHW.ASN_SO_NUM                 = EAEW.ASN_SO_NUM(+)
           AND   EAEW.ASN_LINE_NUM(+)            IS NULL
           AND   EAHW.GLBL_CMPY_CD               = XREF.GLBL_CMPY_CD(+)
           AND   EAHW.EDI_PO_ORD_NUM             = XREF.EDI_PO_ORD_NUM(+)
           AND   XREF.EDI_PO_ORD_DTL_LINE_NUM(+) = #asterisk#
           AND   EAHW.EZCANCELFLAG               = '0'
           AND   VND.EZCANCELFLAG(+)             = '0'
           AND   STS.EZCANCELFLAG(+)             = '0'
           AND   EAEW.EZCANCELFLAG(+)            = '0'
           AND   XREF.EZCANCELFLAG(+)            = '0'
         ORDER   BY                            EAEW.EDI_ASN_ERR_WRK_PK
    </statement>

    <statement id="getSoLinkDetail" parameterClass="Map" resultClass="Map">
        SELECT  EAWRK.EDI_PO_ORD_DTL_LINE_NUM                            AS  HDN_EDI_PO_ORD_DTL_LINE_NUM
        <isNotNull property="xrefUseFlg">
               ,CASE WHEN A_PD.DISP_PO_DTL_LINE_NUM IS NOT NULL THEN A_PD.DISP_PO_DTL_LINE_NUM
                     ELSE EAWRK.EDI_PO_ORD_DTL_LINE_NUM
                END                                                      AS  EDI_PO_ORD_DTL_LINE_NUM
               ,CASE WHEN B_PD.DISP_PO_DTL_LINE_NUM IS NOT NULL THEN B_PD.DISP_PO_DTL_LINE_NUM
                     WHEN C_PD.DISP_PO_DTL_LINE_NUM IS NOT NULL THEN C_PD.DISP_PO_DTL_LINE_NUM
                     WHEN A_PD.DISP_PO_DTL_LINE_NUM IS NOT NULL THEN A_PD.DISP_PO_DTL_LINE_NUM
                     ELSE EAWRK.PO_ORD_DTL_LINE_NUM
                END                                                      AS  PO_ORD_DTL_LINE_NUM
         </isNotNull>
         <isNull property="xrefUseFlg">
               ,EAWRK.EDI_PO_ORD_DTL_LINE_NUM                            AS  EDI_PO_ORD_DTL_LINE_NUM
               ,EAWRK.PO_ORD_DTL_LINE_NUM                                AS  PO_ORD_DTL_LINE_NUM
         </isNull>
               ,EAWRK.PO_ORD_DTL_LINE_NUM                                AS  HDN_PO_ORD_DTL_LINE_NUM
               ,EAWRK.EDI_SUB_NUM                                        AS  EDI_SUB_NUM
               ,EAWRK.ASN_SO_NUM                                         AS  ASN_SO_NUM
               ,EAWRK.ASN_LINE_NUM                                       AS  ASN_LINE_NUM
               ,EAWRK.ASN_SO_SLP_NUM                                     AS  ASN_SO_SLP_NUM
               ,EAWRK.MDSE_CD                                            AS  MDSE_CD
               ,EAWRK.MDSE_CD_UPD_FLG                                    AS  MDSE_CD_UPD_FLG
               ,EAWRK.ASN_QTY                                            AS  ASN_QTY
               ,EAWRK.ASN_CARR_CD                                        AS  ASN_CARR_CD    
               ,EAWRK.ASN_PRO_NUM                                        AS  ASN_PRO_NUM
               ,EAWRK.ASN_BOL_NUM                                        AS  ASN_BOL_NUM
               ,EAWRK.ASN_PLN_DELY_DT                                    AS  ASN_PLN_DELY_DT
               ,EAWRK.BAT_ERR_MSG_TXT                                    AS  BAT_ERR_MSG_TXT
               ,EAWRK.EDI_PO_ORD_NUM                                     AS  EDI_PO_ORD_NUM
               ,EAWRK.DEZUPTIME                                          AS  DEZUPTIME
               ,EAWRK.DEZUPTIMEZONE                                      AS  DEZUPTIMEZONE
         FROM
               (SELECT   
                    EADW.EDI_PO_ORD_DTL_LINE_NUM   AS EDI_PO_ORD_DTL_LINE_NUM
                   ,EADW.EDI_SUB_NUM               AS EDI_SUB_NUM
                   ,EADW.ASN_SO_NUM                AS ASN_SO_NUM
                   ,EADW.ASN_LINE_NUM              AS ASN_LINE_NUM
                   ,EADW.ASN_SO_SLP_NUM            AS ASN_SO_SLP_NUM
                   ,EADW.ASN_MDSE_CD               AS MDSE_CD
                   ,EADW.MDSE_CD_UPD_FLG           AS MDSE_CD_UPD_FLG
                   ,EADW.ASN_QTY                   AS ASN_QTY
                   ,EADW.ASN_CARR_CD               AS ASN_CARR_CD
                   ,EADW.ASN_PRO_NUM               AS ASN_PRO_NUM
                   ,EADW.ASN_BOL_NUM               AS ASN_BOL_NUM
                   ,EADW.ASN_PLN_DELY_DT           AS ASN_PLN_DELY_DT
                   ,EAEW.BAT_ERR_MSG_TXT           AS BAT_ERR_MSG_TXT
                   ,EADW.EZUPTIME                  AS DEZUPTIME
                   ,EADW.EZUPTIMEZONE              AS DEZUPTIMEZONE
                   ,EADW.GLBL_CMPY_CD              AS GLBL_CMPY_CD
                   ,EAHW.PO_ORD_NUM                AS PO_ORD_NUM
                   ,EAHW.EDI_PO_ORD_NUM            AS EDI_PO_ORD_NUM
                   ,EADW.PO_ORD_DTL_LINE_NUM       AS PO_ORD_DTL_LINE_NUM
                 FROM  EDI_ASN_DTL_WRK             EADW
                      ,EDI_ASN_HDR_WRK             EAHW
                      ,EDI_ASN_ERR_WRK             EAEW
               WHERE   EADW.GLBL_CMPY_CD            = #glblCmpyCd#
                 AND   EADW.ASN_SO_NUM              = #asnSoNum#
                 AND   EADW.GLBL_CMPY_CD            = EAEW.GLBL_CMPY_CD(+)
                 AND   EADW.ASN_SO_NUM              = EAEW.ASN_SO_NUM(+)
                 AND   EADW.ASN_LINE_NUM            = EAEW.ASN_LINE_NUM(+)
                 AND   EADW.GLBL_CMPY_CD            = EAHW.GLBL_CMPY_CD
                 AND   EADW.ASN_SO_NUM              = EAHW.ASN_SO_NUM
                 AND   EADW.EZCANCELFLAG            = '0'
                 AND   EAEW.EZCANCELFLAG(+)         = '0'
                 AND   EAHW.EZCANCELFLAG            = '0'
               ) EAWRK
         <isNotNull property="xrefUseFlg">
               ,EDI_PO_DTL_XREF   EPDX
               ,PO_DTL         A_PD
               ,PO_DTL         B_PD
               ,PO_DTL         C_PD
         </isNotNull>
         WHERE   ROWNUM                        &lt;= #maxRowNum#
         <isNotNull property="xrefUseFlg">
           AND   EAWRK.GLBL_CMPY_CD                 = EPDX.GLBL_CMPY_CD(+)
           AND   EAWRK.EDI_PO_ORD_NUM               = EPDX.EDI_PO_ORD_NUM(+)
           AND   EAWRK.EDI_PO_ORD_DTL_LINE_NUM      = EPDX.EDI_PO_ORD_DTL_LINE_NUM(+)
           AND   EPDX.EZCANCELFLAG(+)               = '0'
           AND   EAWRK.GLBL_CMPY_CD                 = A_PD.GLBL_CMPY_CD(+)
           AND   EAWRK.EDI_PO_ORD_NUM               = A_PD.PO_ORD_NUM(+)
           AND   EAWRK.EDI_PO_ORD_DTL_LINE_NUM      = A_PD.PO_ORD_DTL_LINE_NUM(+)
           AND   A_PD.EZCANCELFLAG(+)               = '0'
           AND   EPDX.GLBL_CMPY_CD                  = B_PD.GLBL_CMPY_CD(+)
           AND   EPDX.PO_ORD_NUM                    = B_PD.PO_ORD_NUM(+)
           AND   EPDX.PO_ORD_DTL_LINE_NUM           = B_PD.PO_ORD_DTL_LINE_NUM(+)
           AND   B_PD.EZCANCELFLAG(+)               = '0'
           AND   EAWRK.GLBL_CMPY_CD                 = C_PD.GLBL_CMPY_CD(+)
           AND   EAWRK.PO_ORD_NUM                   = C_PD.PO_ORD_NUM(+)
           AND   EAWRK.PO_ORD_DTL_LINE_NUM          = C_PD.PO_ORD_DTL_LINE_NUM(+)
           AND   C_PD.EZCANCELFLAG(+)               = '0'
         </isNotNull>
         ORDER   BY                                HDN_EDI_PO_ORD_DTL_LINE_NUM
                                                  ,EDI_PO_ORD_DTL_LINE_NUM
                                                  ,EDI_SUB_NUM
                                                  ,ASN_LINE_NUM
    </statement>

    <statement id="getLogicLineNum" parameterClass="Map" resultClass="Map">
            SELECT
                 A.PO_ORD_DTL_LINE_NUM
            FROM 
                 PO_DTL   A
            WHERE
                    A.GLBL_CMPY_CD                  =     #glblCmpyCd#
                AND A.PO_ORD_NUM                    =     #poOrdNum#
                AND A.DISP_PO_DTL_LINE_NUM          =     #poOrdDtlLineNum#
                AND A.EZCANCELFLAG                  =     '0'
     </statement>

    <statement id="getPoDtl" parameterClass="Map" resultClass="Map">
            SELECT
                 PD.PO_ORD_NUM              AS PO_ORD_NUM
                ,PD.PO_ORD_DTL_LINE_NUM     AS PO_ORD_DTL_LINE_NUM
                ,PD.DISP_PO_DTL_LINE_NUM    AS DISP_PO_DTL_LINE_NUM
                ,PD.PO_STS_CD                AS PO_STS_CD
                ,PD.ASL_MDSE_CD             AS ASL_MDSE_CD
            FROM 
                 PO_DTL     PD
            WHERE 1=1
                AND PD.GLBL_CMPY_CD                 = #glblCmpyCd#
                AND PD.PO_ORD_NUM                   = #poOrdNum#
                AND PD.DISP_PO_DTL_LINE_NUM         = #dispPoDtlLineNum#
                AND PD.EZCANCELFLAG                 = '0'
                AND ROWNUM                           = 1
     </statement>

</sqlMap>
