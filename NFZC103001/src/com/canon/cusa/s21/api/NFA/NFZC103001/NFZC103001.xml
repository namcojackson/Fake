<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NFZC103001">

    <statement id="getInvoice" parameterClass="Map" resultClass="Map">
        SELECT
             A.GLBL_CMPY_CD
            ,A.DS_INV_SLS_CR_PK
            ,A.INV_NUM
            ,A.INV_BOL_LINE_NUM
            ,A.INV_LINE_NUM
            ,A.INV_LINE_SUB_NUM
            ,A.INV_TRX_LINE_SUB_NUM
            ,A.MDSE_CD
            ,A.INV_LINE_SPL_TP_CD
            ,A.INV_LINE_SPL_PCT
            ,A.SLS_REP_TOC_CD
            ,A.SLS_REP_CR_PCT
            ,A.DEAL_SLS_CR_AMT
            ,A.FUNC_SLS_CR_AMT
            ,A.DEAL_CCY_CD
            ,A.DFRD_ACCTG_RULE_CD
            ,A.DFRD_ACCTG_RULE_DURN_AOT
            ,A.DURN_START_DT
            ,A.DEAL_ORIG_DFRD_AMT
            ,A.FUNC_ORIG_DFRD_AMT
            ,A.DEAL_DFRD_BAL_AMT
            ,A.FUNC_DFRD_BAL_AMT
            ,A.DEAL_SCHD_REV_AMT
            ,A.FUNC_SCHD_REV_AMT
            ,A.REV_RECOG_CNT
            ,A.FIRST_REV_RECOG_DT
            ,A.NEXT_REV_RECOG_DT
            ,A.REV_RECOG_PROC_STS_CD
            ,A.SLS_REP_BR_CD
            ,A.COA_CMPY_CD
            ,A.COA_AFFL_CD
            ,A.COA_BR_CD
            ,A.COA_CH_CD
            ,A.COA_CC_CD
            ,A.COA_ACCT_CD
            ,A.COA_PROD_CD
            ,A.COA_PROJ_CD
            ,A.COA_EXTN_CD
            ,A.TRX_CD
            ,A.TRX_RSN_CD
            ,A.MAN_INV_CRAT_CMNT_TXT
            ,A.DS_CPO_CONFIG_PK
            ,B.SYS_SRC_CD
            ,F.SYS_SRC_NM
            ,B.INV_TP_CD
            ,B.ACCT_DT
            ,B.INV_DT
            ,B.BILL_TO_CUST_CD
            ,B.SELL_TO_CUST_CD
            ,B.CPO_ORD_NUM
            <!-- DEL 2016/12/08 [QC#16174]
            ,D.TOT_BOL_DEAL_TAX_AMT
            ,D.TOT_BOL_FUNC_TAX_AMT  -->
            <!-- ADD 2016/12/08 [QC#16174]  -->
            ,C.INV_LINE_DEAL_TAX_AMT
            ,C.INV_LINE_FUNC_TAX_AMT
            ,D.FRT_DEAL_TAX_AMT
            ,D.FRT_FUNC_TAX_AMT
            
            ,D.SHIP_DEAL_FRT_AMT
            ,D.SHIP_FUNC_FRT_AMT
            ,D.SHIP_TO_CUST_CD
            ,D.SHIP_TO_ST_CD
            ,B.DS_ORD_TP_CD
            ,B.DS_ORD_RSN_CD
            ,B.DS_INV_TP_CD
            ,B.BILL_TO_CUST_ACCT_CD
            ,DECODE(G.DFRD_REV_FLG, #flgY#, #dfrd#, #immediate#) AS AJE_ACCTG_RULE_CD
            ,#invoice#                                           AS INV_INVTY_IND_TP_CD
            ,#dspt#                                              AS DSPT
            ,A.DFRD_ACCTG_RULE_CD                                AS DFRD_ACCTG_RULE_CD
            ,H.AR_COA_CMPY_CD                                    AS "INVTP-AR_CMPY_CD"
            ,H.AR_COA_BR_CD                                      AS "INVTP-AR_BR_CD"
            ,H.AR_COA_CC_CD                                      AS "INVTP-AR_CC_CD"
            ,H.AR_COA_ACCT_CD                                    AS "INVTP-AR_ACCT_CD"
            ,H.AR_COA_PROD_CD                                    AS "INVTP-AR_PROD_CD"
            ,H.AR_COA_CH_CD                                      AS "INVTP-AR_CH_CD"
            ,H.AR_COA_AFFL_CD                                    AS "INVTP-AR_AFFL_CD"
            ,H.AR_COA_PROJ_CD                                    AS "INVTP-AR_PROJ_CD"
            ,H.AR_COA_EXTN_CD                                    AS "INVTP-AR_EXTN_CD"
            ,H.SLS_COA_CMPY_CD                                   AS "INVTP-REV_CMPY_CD"
            ,H.SLS_COA_BR_CD                                     AS "INVTP-REV_BR_CD"
            ,H.SLS_COA_CC_CD                                     AS "INVTP-REV_CC_CD"
            ,H.SLS_COA_ACCT_CD                                   AS "INVTP-REV_ACCT_CD"
            ,H.SLS_COA_PROD_CD                                   AS "INVTP-REV_PROD_CD"
            ,H.SLS_COA_CH_CD                                     AS "INVTP-REV_CH_CD"
            ,H.SLS_COA_AFFL_CD                                   AS "INVTP-REV_AFFL_CD"
            ,H.SLS_COA_PROJ_CD                                   AS "INVTP-REV_PROJ_CD"
            ,H.SLS_COA_EXTN_CD                                   AS "INVTP-REV_EXTN_CD"
            ,H.UN_EARN_COA_CMPY_CD                               AS "INVTP-UNEARN_CMPY_CD"
            ,H.UN_EARN_COA_BR_CD                                 AS "INVTP-UNEARN_BR_CD"
            ,H.UN_EARN_COA_CC_CD                                 AS "INVTP-UNEARN_CC_CD"
            ,H.UN_EARN_COA_ACCT_CD                               AS "INVTP-UNEARN_ACCT_CD"
            ,H.UN_EARN_COA_PROD_CD                               AS "INVTP-UNEARN_PROD_CD"
            ,H.UN_EARN_COA_CH_CD                                 AS "INVTP-UNEARN_CH_CD"
            ,H.UN_EARN_COA_AFFL_CD                               AS "INVTP-UNEARN_AFFL_CD"
            ,H.UN_EARN_COA_PROJ_CD                               AS "INVTP-UNEARN_PROJ_CD"
            ,H.UN_EARN_COA_EXTN_CD                               AS "INVTP-UNEARN_EXTN_CD"
            ,I.COA_BR_CD                                         AS "TOC_BR_CD"
            ,I.COA_CC_CD                                         AS "TOC_CC_CD"
            ,I.COA_EXTN_CD                                       AS "TOC_EXTN_CD"
            ,J.REV_COA_ACCT_CD                                   AS "ITEM-REV_ACCT_CD"
            <!-- start add 2016/07/25 -->
            ,J.COGS_COA_ACCT_CD                                  AS "ITEM-COS_ACCT_CD"
            ,J.EXP_COA_ACCT_CD                                   AS "ITEM-EXP_ACCT_CD"
            ,J.ACRL_COA_ACCT_CD                                  AS "ITEM-ACRL_ACCT_CD"
            ,(CASE
                 WHEN K.COA_TAX_ACCT_CD IS NULL THEN #stAcctCd#
                 ELSE K.COA_TAX_ACCT_CD END )                    AS "ST_ACCT_CD"
            <!-- end 2016/07/25 -->
            <!-- START 2016/09/12 J.Kim [QC#13561,MOD] -->
            ,NVL(M.COA_CH_CD, L.COA_CH_CD)                       AS "CUST-SITE_CH_CD"
            ,NVL(M.COA_AFFL_CD, L.COA_AFFL_CD)                   AS "CUST-SITE_AFFL_CD"
            ,L.COA_CH_CD                                         AS "CUST-ACCT_CH_CD"
            <!-- END 2016/09/12 J.Kim [QC#13561,MOD] -->
            ,L.COA_AFFL_CD                                       AS "CUST-ACCT_AFFL_CD"
            ,NVL(MS.COA_CH_CD, LS.COA_CH_CD)                     AS "SELL-SITE_CH_CD"
            ,NVL(MS.COA_AFFL_CD, LS.COA_AFFL_CD)                 AS "SELL-SITE_AFFL_CD"
            ,LS.COA_CH_CD                                        AS "SELL-CUST_CH_CD"
            ,LS.COA_AFFL_CD                                      AS "SELL-CUST_AFFL_CD"
            ,J.COA_CC_CD                                         AS "ITEM_CC_CD"
            ,J.COA_PROD_CD                                       AS "ITEM_PROD_CD"
            ,J.COA_MDSE_TP_CD                                    AS "ITEM_PROJ_CD"
            ,A.COA_CMPY_CD                                       AS "LINK_CMPY_CD"
            ,A.COA_BR_CD                                         AS "LINK_BR_CD"
            ,A.COA_CC_CD                                         AS "LINK_CC_CD" 
            ,A.COA_ACCT_CD                                       AS "LINK_ACCT_CD"
            ,A.COA_PROD_CD                                       AS "LINK_PROD_CD"
            ,A.COA_CH_CD                                         AS "LINK_CH_CD"
            ,A.COA_AFFL_CD                                       AS "LINK_AFFL_CD"
            ,A.COA_PROJ_CD                                       AS "LINK_PROJ_CD"
            ,A.COA_EXTN_CD                                       AS "LINK_EXTN_CD"
            ,M.COA_CMPY_CD                                       AS "LOC_CMPY_CD"
            ,M.COA_BR_CD                                         AS "LOC_BR_CD"
            ,M.COA_CC_CD                                         AS "LOC_CC_CD"
            ,M.COA_ACCT_CD                                       AS "LOC_ACCT_CD"
            ,M.COA_PROD_CD                                       AS "LOC_PROD_CD"
            ,M.COA_CH_CD                                         AS "LOC_CH_CD"
            ,M.COA_AFFL_CD                                       AS "LOC_AFFL_CD"
            ,M.COA_PROJ_CD                                       AS "LOC_PROJ_CD"
            ,M.COA_EXTN_CD                                       AS "LOC_EXTN_CD"
            <!-- start 2016/10/26 QC#14590 -->
            <!-- start mod 2016/07/18 -->
            <!-- ,P.FIN_BR_CD                                         AS "IB_BR_CD"-->
            <!-- ,NVL(P.FIN_BR_CD, SMM.FIN_BR_CD)                     AS "IB_BR_CD"-->
            ,NVL(P.FIN_BR_CD, NVL(SMM.FIN_BR_CD, NVL(NVL(SBFX.FIN_BR_CD, SBPX.SVC_BR_CD), NVL(SBFX_5.FIN_BR_CD, SBPX_5.SVC_BR_CD))))
                                                                 AS "IB_BR_CD"
            <!-- start add 2017/10/26 QC#21752 -->
            ,P.FIN_BR_CD
            ,SMM.FIN_BR_CD
            ,SBFX.FIN_BR_CD
            ,SBPX.SVC_BR_CD
            ,SBFX_5.FIN_BR_CD
            ,SBPX_5.SVC_BR_CD
            <!-- end add 2017/10/26 QC#21752 -->
            ,NVL(SBFX.FIN_BR_CD, SBPX.SVC_BR_CD)                 AS "CONTR-SHIP-TO_BR_CD"
            <!-- end mod 2016/07/18 -->
            <!-- end 2016/10/26 QC#14590 -->
            <!-- remove 2016/09/20 Machine Mapping is required for Machine's item code
            ,NVL(Q.AJE_COA_PROD_MAP_TO_CD, J.COA_PROD_CD)        AS "MACH-MAP_PROD_CD"
            -->
            <!-- start add 2016/07/18 -->
            ,LBT.COA_CC_CD                                       AS "LINE-BIZ_CC_CD"
            <!-- end 2016/07/18 -->
            <!-- start add 2016/07/20 for CSMP -->
            ,CDA.CM_COA_CMPY_CD                                  AS "AP-CSMP_CMPY_CD"
            ,CDA.CM_COA_BR_CD                                    AS "AP-CSMP_BR_CD"
            ,CDA.CM_COA_CC_CD                                    AS "AP-CSMP_CC_CD"
            ,CDA.CM_COA_ACCT_CD                                  AS "AP-CSMP_ACCT_CD"
            ,CDA.CM_COA_PROD_CD                                  AS "AP-CSMP_PROD_CD"
            ,CDA.CM_COA_CH_CD                                    AS "AP-CSMP_CH_CD"
            ,CDA.CM_COA_AFFL_CD                                  AS "AP-CSMP_AFFL_CD"
            ,CDA.CM_COA_PROJ_CD                                  AS "AP-CSMP_PROJ_CD"
            ,CDA.CM_COA_EXTN_CD                                  AS "AP-CSMP_EXTN_CD"
            <!-- end 2016/07/20 -->
            <!-- start 2016/09/20 QC#14589 -->
            <!-- At Machine -->
            ,MDSE_MACH.COA_PROD_CD                                    AS "MACH_PROD_CD"
            ,MDSE_MACH.COA_MDSE_TP_CD                                 AS "MACH_PROJ_CD"
            ,MDSE_MACH.COA_CC_CD                                      AS "MACH_CC_CD"
            ,NVL(Q.AJE_COA_PROD_MAP_TO_CD, NVL(MDSE_MACH.COA_PROD_CD, CPM.AJE_COA_PROD_MAP_TO_CD))     AS "MACH-MAP_PROD_CD"
            <!-- end 2016/09/20 -->
            <!-- start 2016/09/23 QC#14662 -->
            <!-- start mod 2017/11/28 QC#22468 -->
            ,V.COA_AFFL_CD                                       AS "ORIG-CUST-ACCT_AFFL_CD"
            ,V.COA_CH_CD                                         AS "ORIG-CUST-ACCT_CH_CD"
            ,NVL(T.COA_AFFL_CD, V.COA_AFFL_CD)                   AS "ORIG-CUST-SITE_AFFL_CD"
            ,NVL(T.COA_CH_CD, V.COA_CH_CD)                       AS "ORIG-CUST-SITE_CH_CD"
            <!-- end mod 2017/11/28 QC#22468 -->
            <!-- end 2016/09/23 QC#14662 -->
            <!-- QC#17116 mod Start -->
            <!-- start 2016/10/17 QC#14590 -->
            <!-- 
            ,AILA.SVC_COA_CC_CD                                  AS "ALLOC-SVC_CC_CD"
             ,(CASE
                WHEN P.SVC_BY_LINE_BIZ_TP_CD = #lineBizTp_PPS#
                    THEN AILA.SPLY_PPS_COA_CC_CD
                WHEN P.SVC_BY_LINE_BIZ_TP_CD = #lineBizTp_LFS#
                    THEN AILA.SPLY_LFS_COA_CC_CD
                ELSE AILA.SPLY_ESS_COA_CC_CD END
             )                                                   AS "ALLOC-SPLY_CC_CD"
            ,AILA.SVC_COA_ACCT_CD                                AS "ALLOC-SVC_ACCT_CD"
            ,AILA.SPLY_COA_ACCT_CD                               AS "ALLOC-SPLY_ACCT_CD"
            ,AILA.EQUIP_COA_ACCT_CD                              AS "ALLOC-EQUIP_ACCT_CD"
             -->
            <!-- end   2016/10/17 QC#14590 -->
            ,(CASE
                WHEN DCH.DS_CONTR_CATG_CD   = #dsContrCatgFLEET#
                    THEN LBT1.SPLY_COA_CC_CD
                WHEN MDS.SVC_ALLOC_TP_CD    = #svcAllocTpOPTIMA#
                    THEN LBT2.SPLY_COA_CC_CD
                ELSE
            <!-- start 2017/12/07 QC#22848 -->
                    NVL(LBT.SPLY_COA_CC_CD, NVL(LBT3.SPLY_COA_CC_CD, LBT2.SPLY_COA_CC_CD))
            <!-- end 2017/12/07 QC#22848 -->
             END)                                                AS "LOB-SPLY_CC_CD"
            ,(CASE
                WHEN DCH.DS_CONTR_CATG_CD   = #dsContrCatgFLEET#
                    THEN LBT1.SVC_COA_CC_CD
                WHEN MDS.SVC_ALLOC_TP_CD    = #svcAllocTpOPTIMA#
                    THEN LBT2.SVC_COA_CC_CD
                ELSE
            <!-- start 2017/12/07 QC#22848 -->
                    NVL(LBT.SVC_COA_CC_CD, NVL(LBT3.SVC_COA_CC_CD, LBT2.SVC_COA_CC_CD))
            <!-- end 2017/12/07 QC#22848 -->
             END)                                                AS "LOB-SVC_CC_CD"
        <!-- QC#17116 mod End -->
            <!-- start 2016/11/24 QC#16103 -->
            ,(CASE WHEN CB.COA_BR_TP_CD = #newcore# THEN I.COA_BR_CD
                   ELSE #defBrNewcore# END) AS "NEWCORE_BR_CD"
            ,(CASE WHEN CB.COA_BR_TP_CD = #newcore# THEN I.COA_CC_CD
                   ELSE #defCcNewcore# END) AS "NEWCORE_CC_CD"
            <!-- end 2016/11/24 QC#16103 -->
            <!-- start 2016/12/02 QC#16148 -->
            <!-- This column is for FM(BSD) judgment. -->
            ,DECODE(DCH2.DS_CONTR_CLS_CD, #bsd#, #fm#, #nonFm#)  AS "FM_IND_TP_CD"
            <!-- end 2016/12/02 QC#16148 -->
        FROM
             DS_INV_SLS_CR      A
            ,INV                B
            ,INV_LINE           C
            ,INV_BOL            D
            ,SYS_SRC            F
            ,DFRD_ACCTG_RULE    G
            ,DS_INV_TP          H
            ,TOC_DLY_SNAP_SHOT  I
            ,MDSE_DLY_SNAP_SHOT J
            ,COA_TAX_ST         K
            ,SELL_TO_CUST       L
            ,BILL_TO_CUST       M
            ,SELL_TO_CUST       LS
            ,BILL_TO_CUST       MS
            <!-- start mod 2017/10/26 QC#21752 -->
            ,SVC_INV_LINE       O
            <!-- end mod 2017/10/26 QC#21752 -->
            ,SVC_MACH_MSTR      P
            ,AJE_COA_PROD_MAP   Q
            ,LINE_BIZ_TP        LBT
            <!-- QC#17116 add Start -->
            ,LINE_BIZ_TP        LBT1
            ,LINE_BIZ_TP        LBT2
            ,LINE_BIZ_TP        LBT3
            ,MDSE               MDS
            <!-- QC#17116 add End -->
            ,CM_DEF_ACCT        CDA
            <!-- start 2016/09/20 QC#14589 -->
            ,MDSE_DLY_SNAP_SHOT MDSE_MACH
            ,SVC_CONFIG_MSTR    SCM
            ,SVC_MACH_MSTR      SMM
            <!-- end 2016/09/20 QC#14589 -->
            <!-- start 2016/09/23 QC#14662 -->
            ,INV                R
            ,BILL_TO_CUST       T
            ,SELL_TO_CUST       V
            <!-- end 2016/09/23 QC#14662 -->
            <!-- start 2016/10/17 QC#14590 -->
            ,AJE_INV_LINE_ALLOC AILA
            <!-- end   2016/10/17 QC#14590 -->
            <!-- start 2016/10/26 QC#14590 -->
            ,SVC_INV_LINE       SIL
            ,DS_CONTR           DCH
            ,DS_CONTR_DTL       DCD
            ,SHIP_TO_CUST       STC
            ,SVC_BR_POST_XREF   SBPX
            ,SVC_BR_FIN_BR_XREF SBFX
            ,SVC_BR_POST_XREF   SBPX_5
            ,SVC_BR_FIN_BR_XREF SBFX_5
            ,AJE_COA_PROD_MAP   CPM
            <!-- end   2016/10/26 QC#14590 -->
            <!-- start 2016/11/24 QC#16103 -->
            ,COA_BR             CB
            <!-- end 2016/11/24 QC#16103 -->
            <!-- start 2016/12/07 QC#16148 -->
            <!-- This table is for FM(BSD) judgment. -->
            ,DS_CONTR           DCH2
            <!-- end   2016/12/07 QC#16148 -->
            <!-- start 2017/11/20 QC#22288 -->
            ,SVC_INV            SI
            <!-- end   2017/11/20 QC#22288 -->
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.INV_NUM              = #invNum#
            AND B.GLBL_CMPY_CD         = A.GLBL_CMPY_CD
            AND B.INV_NUM              = A.INV_NUM
            AND C.GLBL_CMPY_CD         = A.GLBL_CMPY_CD
            AND C.INV_NUM              = A.INV_NUM
            AND C.INV_BOL_LINE_NUM     = A.INV_BOL_LINE_NUM
            AND C.INV_LINE_NUM         = A.INV_LINE_NUM
            AND C.INV_LINE_SUB_NUM     = A.INV_LINE_SUB_NUM
            AND D.GLBL_CMPY_CD         = A.GLBL_CMPY_CD
            AND D.INV_NUM              = A.INV_NUM
            AND D.INV_BOL_LINE_NUM     = A.INV_BOL_LINE_NUM
            AND F.GLBL_CMPY_CD(+)      = A.GLBL_CMPY_CD
            AND F.SYS_SRC_CD(+)        = B.SYS_SRC_CD
            AND B.GLBL_CMPY_CD         = H.GLBL_CMPY_CD(+)
            AND B.DS_INV_TP_CD         = H.DS_INV_TP_CD(+)
            AND A.GLBL_CMPY_CD         = I.GLBL_CMPY_CD(+)
            AND A.SLS_REP_TOC_CD       = I.TOC_CD(+)
            <!-- start mod 2016/10/11 QC#14547 MDSE_CD in Invoice Line to be used for SRT. Otherwise, service allocation goes to dummy item.  -->
            AND C.GLBL_CMPY_CD         = J.GLBL_CMPY_CD(+)
            AND (CASE WHEN A.INV_LINE_SPL_TP_CD = #dev# THEN C.MDSE_CD
                      ELSE A.MDSE_CD END)      = J.MDSE_CD(+)
            <!-- end mod 2016/10/11 QC#14547 -->
            AND D.GLBL_CMPY_CD         = K.GLBL_CMPY_CD(+)
            <!-- START 2016/07/15 S.Fujita [QC#10787,MOD] -->
            <!-- 
            AND D.SHIP_TO_ST_CD        = K.COA_TAX_ST_CD(+)
            -->
            AND NVL(D.SHIP_TO_ST_CD, M.ST_CD)   = K.COA_TAX_ST_CD(+)
            <!-- END   2016/07/15 S.Fujita [QC#10787,MOD] -->
            AND K.COA_TAX_CTRY_CD(+)   = NVL(D.SHIP_TO_CTRY_CD, 'US')
            AND B.GLBL_CMPY_CD         = L.GLBL_CMPY_CD(+)
            AND B.BILL_TO_CUST_ACCT_CD = L.SELL_TO_CUST_CD(+)
            AND B.GLBL_CMPY_CD         = M.GLBL_CMPY_CD(+)
            AND B.BILL_TO_CUST_CD      = M.BILL_TO_CUST_CD(+)
            AND B.GLBL_CMPY_CD         = LS.GLBL_CMPY_CD(+)
            AND B.SELL_TO_CUST_CD      = LS.SELL_TO_CUST_CD(+)
            AND B.GLBL_CMPY_CD         = MS.GLBL_CMPY_CD(+)
            AND B.SOLD_TO_CUST_LOC_CD  = MS.BILL_TO_CUST_CD(+)
            <!-- start mod 2017/10/26 QC#21752 -->
            AND C.GLBL_CMPY_CD         = O.GLBL_CMPY_CD(+)
            AND C.SVC_INV_LINE_PK      = O.SVC_INV_LINE_PK(+)
            <!-- end mod 2017/10/26 QC#21752 -->
            AND O.GLBL_CMPY_CD         = P.GLBL_CMPY_CD(+)
            AND O.SVC_MACH_MSTR_PK     = P.SVC_MACH_MSTR_PK(+)
            <!-- remove 2016/09/20 Machine Mapping is required for Machine's item code
            AND J.GLBL_CMPY_CD         = Q.GLBL_CMPY_CD(+)
            AND J.COA_PROD_CD          = Q.AJE_COA_PROD_MAP_CD(+)
            -->
            AND J.LTST_REC_FLG(+)      = 'Y'
            AND A.EZCANCELFLAG         = '0'
            AND B.EZCANCELFLAG         = '0'
            AND C.EZCANCELFLAG         = '0'
            AND D.EZCANCELFLAG         = '0'
            AND F.EZCANCELFLAG(+)      = '0'
            AND H.EZCANCELFLAG(+)      = '0'
            AND I.EZCANCELFLAG(+)      = '0'
            AND J.EZCANCELFLAG(+)      = '0'
            AND K.EZCANCELFLAG(+)      = '0'
            AND L.EZCANCELFLAG(+)      = '0'
            AND M.EZCANCELFLAG(+)      = '0'
            AND LS.EZCANCELFLAG(+)     = '0'
            AND MS.EZCANCELFLAG(+)     = '0'
            AND O.EZCANCELFLAG(+)      = '0'
            AND P.EZCANCELFLAG(+)      = '0'
            AND Q.EZCANCELFLAG(+)      = '0'
            AND A.GLBL_CMPY_CD         = G.GLBL_CMPY_CD(+)
            AND A.EZCANCELFLAG         = G.EZCANCELFLAG(+)
            AND A.DFRD_ACCTG_RULE_CD   = G.DFRD_ACCTG_RULE_CD(+)
            AND P.GLBL_CMPY_CD         = LBT.GLBL_CMPY_CD(+)
            AND P.EZCANCELFLAG         = LBT.EZCANCELFLAG(+)
            AND P.SVC_BY_LINE_BIZ_TP_CD = LBT.LINE_BIZ_TP_CD(+)
            <!-- QC#17116 add Start -->
            AND DCH.GLBL_CMPY_CD        = LBT1.GLBL_CMPY_CD(+)
            AND DCH.SVC_LINE_BIZ_CD     = LBT1.LINE_BIZ_TP_CD(+)
            AND LBT1.EZCANCELFLAG(+)    = '0'

            AND B.GLBL_CMPY_CD          = LBT2.GLBL_CMPY_CD(+)
            AND B.LINE_BIZ_TP_CD        = LBT2.LINE_BIZ_TP_CD(+)
            AND LBT2.EZCANCELFLAG(+)    = '0'

            AND C.GLBL_CMPY_CD          = MDS.GLBL_CMPY_CD(+)
            AND C.MDSE_CD               = MDS.MDSE_CD(+)
            AND MDS.EZCANCELFLAG(+)     = '0'

            AND DCH2.GLBL_CMPY_CD        = LBT3.GLBL_CMPY_CD(+)
            AND DCH2.SVC_LINE_BIZ_CD     = LBT3.LINE_BIZ_TP_CD(+)
            AND LBT3.EZCANCELFLAG(+)    = '0'
            <!-- QC#17116 add End -->
            AND A.GLBL_CMPY_CD         = CDA.GLBL_CMPY_CD(+)
            AND A.EZCANCELFLAG         = CDA.EZCANCELFLAG(+)
            AND #csmp#                 = CDA.CM_DEF_ACCT_CD(+)
            <!-- start 2016/09/20 QC#14589 For Machine's Item Code -->
            AND C.GLBL_CMPY_CD                 = SCM.GLBL_CMPY_CD(+)
            AND C.EZCANCELFLAG                 = SCM.EZCANCELFLAG(+)
            AND C.SVC_CONFIG_MSTR_PK           = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.GLBL_CMPY_CD               = SMM.GLBL_CMPY_CD(+)
            AND SCM.EZCANCELFLAG               = SMM.EZCANCELFLAG(+)
            AND SCM.SVC_MACH_MSTR_PK           = SMM.SVC_MACH_MSTR_PK(+)
            AND MDSE_MACH.GLBL_CMPY_CD(+)      = #glblCmpyCd#
            AND MDSE_MACH.EZCANCELFLAG(+)      = '0'
            AND NVL(P.MDSE_CD, NVL(SMM.MDSE_CD, C.MDSE_CD))    = MDSE_MACH.MDSE_CD(+)
            AND MDSE_MACH.LTST_REC_FLG(+)      = 'Y'
            AND MDSE_MACH.GLBL_CMPY_CD         = Q.GLBL_CMPY_CD(+)
            AND MDSE_MACH.COA_PROD_CD          = Q.AJE_COA_PROD_MAP_CD(+)
            <!-- end 2016/09/20 -->
            <!-- start 2016/09/23 QC#14662 -->
            AND B.CSMP_ORIG_INV_NUM            = R.INV_NUM(+)
            AND B.GLBL_CMPY_CD                 = R.GLBL_CMPY_CD(+)
            AND R.EZCANCELFLAG(+)              = '0'
            <!-- mod start 2017/11/28 QC#22468 -->
            AND R.SOLD_TO_CUST_LOC_CD          = T.BILL_TO_CUST_CD(+)
            AND R.GLBL_CMPY_CD                 = T.GLBL_CMPY_CD(+)
            AND T.EZCANCELFLAG(+)              = '0'
            AND R.SELL_TO_CUST_CD              = V.SELL_TO_CUST_CD(+)
            AND R.GLBL_CMPY_CD                 = V.GLBL_CMPY_CD(+)
            AND V.EZCANCELFLAG(+)              = '0'
            <!-- mod end 2017/11/28 QC#22468 -->
            <!-- start 2016/10/17 QC#14590 -->
            AND A.GLBL_CMPY_CD                 = AILA.GLBL_CMPY_CD(+)
            AND A.AJE_INV_LINE_ALLOC_CD        = AILA.AJE_INV_LINE_ALLOC_CD(+)
            AND AILA.EZCANCELFLAG(+)           = '0'
            <!-- end   2016/10/17 QC#14590 -->
            <!-- start 2016/10/26 QC#14590 -->
            AND C.GLBL_CMPY_CD                 = SIL.GLBL_CMPY_CD(+)
            AND C.SVC_INV_LINE_PK              = SIL.SVC_INV_LINE_PK(+)
            AND SIL.EZCANCELFLAG(+)            = '0'
            AND SIL.GLBL_CMPY_CD               = DCH.GLBL_CMPY_CD(+)
            AND SIL.DS_CONTR_PK                = DCH.DS_CONTR_PK(+)
            AND DCH.EZCANCELFLAG(+)            = '0'
            AND SIL.GLBL_CMPY_CD               = DCD.GLBL_CMPY_CD(+)
            AND SIL.DS_CONTR_DTL_PK            = DCD.DS_CONTR_DTL_PK(+)
            AND DCD.EZCANCELFLAG(+)            = '0'
            AND DCD.GLBL_CMPY_CD               = STC.GLBL_CMPY_CD(+)
            AND DCD.SHIP_TO_CUST_CD            = STC.SHIP_TO_CUST_CD(+)
            AND STC.EZCANCELFLAG(+)            = '0'
            AND STC.GLBL_CMPY_CD               = SBPX.GLBL_CMPY_CD(+)
            AND STC.POST_CD                    = SBPX.POST_CD(+)
            AND DCH.SVC_LINE_BIZ_CD            = SBPX.SVC_LINE_BIZ_CD(+)
            AND SBPX.EZCANCELFLAG(+)           = '0'
            AND SBPX.GLBL_CMPY_CD              = SBFX.GLBL_CMPY_CD(+)
            AND SBPX.SVC_BR_CD                 = SBFX.SVC_BR_CD(+)
            AND SBPX.SVC_LINE_BIZ_CD           = SBFX.SVC_LINE_BIZ_CD(+)
            AND SBFX.EZCANCELFLAG(+)           = '0'
            AND STC.GLBL_CMPY_CD               = SBPX_5.GLBL_CMPY_CD(+)
            AND SUBSTR(STC.POST_CD,1,5)        = SBPX_5.POST_CD(+)
            AND SBPX_5.EZCANCELFLAG(+)         = '0'
            AND DCH.SVC_LINE_BIZ_CD            = SBPX_5.SVC_LINE_BIZ_CD(+)
            AND SBPX_5.GLBL_CMPY_CD            = SBFX_5.GLBL_CMPY_CD(+)
            AND SBPX_5.SVC_BR_CD               = SBFX_5.SVC_BR_CD(+)
            AND SBPX_5.SVC_LINE_BIZ_CD         = SBFX_5.SVC_LINE_BIZ_CD(+)
            AND SBFX_5.EZCANCELFLAG(+)         = '0'
            <!-- start QC#14590 2016/10/26 In case of fleet, machine master can't be identified. -->
            AND #glblCmpyCd#                   = CPM.GLBL_CMPY_CD(+)
            AND 'FLT'                          = CPM.AJE_COA_PROD_MAP_CD(+)
            <!-- end QC#14590 2016/10/26 -->
            <!-- end   2016/10/26 QC#14590 -->
            <!-- start 2016/11/24 QC#16103 -->
            AND CB.EZCANCELFLAG(+)             = '0'
            AND I.GLBL_CMPY_CD                 = CB.GLBL_CMPY_CD(+)
            AND I.COA_BR_CD                    = CB.COA_BR_CD(+)
            <!-- end 2016/11/24 QC#16103 -->
            AND NOT EXISTS (
                SELECT
                    'X'
                FROM
                    AJE_INV_ACCT_DIST    H
                WHERE
                        H.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND H.DS_INV_SLS_CR_PK  = A.DS_INV_SLS_CR_PK
                    AND H.EZCANCELFLAG      = '0'
            )

            <!-- start 2016/12/07 QC#16148 -->
            <!-- This join condition is for FM(BSD) judgment. -->
            <!-- start 2017/11/20 QC#22288 -->
            AND B.GLBL_CMPY_CD              = SI.GLBL_CMPY_CD(+)
            AND B.SVC_INV_PK                = SI.SVC_INV_PK(+)
            AND B.EZCANCELFLAG              = SI.EZCANCELFLAG(+)
            AND SI.GLBL_CMPY_CD             = DCH2.GLBL_CMPY_CD(+)
            AND SI.DS_CONTR_PK              = DCH2.DS_CONTR_PK(+)
            <!-- end 2017/11/20 QC#22288 -->
            <!-- end   2016/12/07 QC#16148 -->
            ORDER BY
                 INV_BOL_LINE_NUM
                ,INV_LINE_NUM
                ,INV_LINE_SUB_NUM
                ,DS_INV_SLS_CR_PK
    </statement>

    <!-- start 2018/01/31 QC#23689 -->
    <statement id="getInvoiceForContract" parameterClass="Map" resultClass="Map">
        SELECT
             A.GLBL_CMPY_CD
            ,A.DS_INV_SLS_CR_PK
            ,A.INV_NUM
            ,A.INV_BOL_LINE_NUM
            ,A.INV_LINE_NUM
            ,A.INV_LINE_SUB_NUM
            ,A.INV_TRX_LINE_SUB_NUM
            ,A.MDSE_CD
            ,A.INV_LINE_SPL_TP_CD
            ,A.INV_LINE_SPL_PCT
            ,A.SLS_REP_TOC_CD
            ,A.SLS_REP_CR_PCT
            ,A.DEAL_SLS_CR_AMT
            ,A.FUNC_SLS_CR_AMT
            ,A.DEAL_CCY_CD
            ,A.DFRD_ACCTG_RULE_CD
            ,A.DFRD_ACCTG_RULE_DURN_AOT
            ,A.DURN_START_DT
            ,A.DEAL_ORIG_DFRD_AMT
            ,A.FUNC_ORIG_DFRD_AMT
            ,A.DEAL_DFRD_BAL_AMT
            ,A.FUNC_DFRD_BAL_AMT
            ,A.DEAL_SCHD_REV_AMT
            ,A.FUNC_SCHD_REV_AMT
            ,A.REV_RECOG_CNT
            ,A.FIRST_REV_RECOG_DT
            ,A.NEXT_REV_RECOG_DT
            ,A.REV_RECOG_PROC_STS_CD
            ,A.SLS_REP_BR_CD
            ,A.COA_CMPY_CD
            ,A.COA_AFFL_CD
            ,A.COA_BR_CD
            ,A.COA_CH_CD
            ,A.COA_CC_CD
            ,A.COA_ACCT_CD
            ,A.COA_PROD_CD
            ,A.COA_PROJ_CD
            ,A.COA_EXTN_CD
            ,A.TRX_CD
            ,A.TRX_RSN_CD
            ,A.MAN_INV_CRAT_CMNT_TXT
            ,A.DS_CPO_CONFIG_PK
            ,B.SYS_SRC_CD
            ,F.SYS_SRC_NM
            ,B.INV_TP_CD
            ,B.ACCT_DT
            ,B.INV_DT
            ,B.BILL_TO_CUST_CD
            ,B.SELL_TO_CUST_CD
            ,B.CPO_ORD_NUM
            ,C.INV_LINE_DEAL_TAX_AMT
            ,C.INV_LINE_FUNC_TAX_AMT
            ,D.FRT_DEAL_TAX_AMT
            ,D.FRT_FUNC_TAX_AMT
            ,D.SHIP_DEAL_FRT_AMT
            ,D.SHIP_FUNC_FRT_AMT
            ,D.SHIP_TO_CUST_CD
            ,D.SHIP_TO_ST_CD
            ,B.DS_ORD_TP_CD
            ,B.DS_ORD_RSN_CD
            ,B.DS_INV_TP_CD
            ,B.BILL_TO_CUST_ACCT_CD
            ,DECODE(G.DFRD_REV_FLG, #flgY#, #dfrd#, #immediate#) AS AJE_ACCTG_RULE_CD
            ,#invoice#                                           AS INV_INVTY_IND_TP_CD
            ,#dspt#                                              AS DSPT
            ,A.DFRD_ACCTG_RULE_CD                                AS DFRD_ACCTG_RULE_CD
            ,H.AR_COA_CMPY_CD                                    AS "INVTP-AR_CMPY_CD"
            ,H.AR_COA_BR_CD                                      AS "INVTP-AR_BR_CD"
            ,H.AR_COA_CC_CD                                      AS "INVTP-AR_CC_CD"
            ,H.AR_COA_ACCT_CD                                    AS "INVTP-AR_ACCT_CD"
            ,H.AR_COA_PROD_CD                                    AS "INVTP-AR_PROD_CD"
            ,H.AR_COA_CH_CD                                      AS "INVTP-AR_CH_CD"
            ,H.AR_COA_AFFL_CD                                    AS "INVTP-AR_AFFL_CD"
            ,H.AR_COA_PROJ_CD                                    AS "INVTP-AR_PROJ_CD"
            ,H.AR_COA_EXTN_CD                                    AS "INVTP-AR_EXTN_CD"
            ,H.SLS_COA_CMPY_CD                                   AS "INVTP-REV_CMPY_CD"
            ,H.SLS_COA_BR_CD                                     AS "INVTP-REV_BR_CD"
            ,H.SLS_COA_CC_CD                                     AS "INVTP-REV_CC_CD"
            ,H.SLS_COA_ACCT_CD                                   AS "INVTP-REV_ACCT_CD"
            ,H.SLS_COA_PROD_CD                                   AS "INVTP-REV_PROD_CD"
            ,H.SLS_COA_CH_CD                                     AS "INVTP-REV_CH_CD"
            ,H.SLS_COA_AFFL_CD                                   AS "INVTP-REV_AFFL_CD"
            ,H.SLS_COA_PROJ_CD                                   AS "INVTP-REV_PROJ_CD"
            ,H.SLS_COA_EXTN_CD                                   AS "INVTP-REV_EXTN_CD"
            ,H.UN_EARN_COA_CMPY_CD                               AS "INVTP-UNEARN_CMPY_CD"
            ,H.UN_EARN_COA_BR_CD                                 AS "INVTP-UNEARN_BR_CD"
            ,H.UN_EARN_COA_CC_CD                                 AS "INVTP-UNEARN_CC_CD"
            ,H.UN_EARN_COA_ACCT_CD                               AS "INVTP-UNEARN_ACCT_CD"
            ,H.UN_EARN_COA_PROD_CD                               AS "INVTP-UNEARN_PROD_CD"
            ,H.UN_EARN_COA_CH_CD                                 AS "INVTP-UNEARN_CH_CD"
            ,H.UN_EARN_COA_AFFL_CD                               AS "INVTP-UNEARN_AFFL_CD"
            ,H.UN_EARN_COA_PROJ_CD                               AS "INVTP-UNEARN_PROJ_CD"
            ,H.UN_EARN_COA_EXTN_CD                               AS "INVTP-UNEARN_EXTN_CD"
            ,I.COA_BR_CD                                         AS "TOC_BR_CD"
            ,I.COA_CC_CD                                         AS "TOC_CC_CD"
            ,I.COA_EXTN_CD                                       AS "TOC_EXTN_CD"
            ,J.REV_COA_ACCT_CD                                   AS "ITEM-REV_ACCT_CD"
            ,J.COGS_COA_ACCT_CD                                  AS "ITEM-COS_ACCT_CD"
            ,J.EXP_COA_ACCT_CD                                   AS "ITEM-EXP_ACCT_CD"
            ,J.ACRL_COA_ACCT_CD                                  AS "ITEM-ACRL_ACCT_CD"
            ,(CASE
                 WHEN K.COA_TAX_ACCT_CD IS NULL THEN #stAcctCd#
                 ELSE K.COA_TAX_ACCT_CD END )                    AS "ST_ACCT_CD"
            ,NVL(MS.COA_CH_CD, LS.COA_CH_CD)                     AS "SELL-SITE_CH_CD"
            ,NVL(MS.COA_AFFL_CD, LS.COA_AFFL_CD)                 AS "SELL-SITE_AFFL_CD"
            ,LS.COA_CH_CD                                        AS "SELL-CUST_CH_CD"
            ,LS.COA_AFFL_CD                                      AS "SELL-CUST_AFFL_CD"
            ,J.COA_CC_CD                                         AS "ITEM_CC_CD"
            ,J.COA_PROD_CD                                       AS "ITEM_PROD_CD"
            ,J.COA_MDSE_TP_CD                                    AS "ITEM_PROJ_CD"
            ,A.COA_CMPY_CD                                       AS "LINK_CMPY_CD"
            ,A.COA_BR_CD                                         AS "LINK_BR_CD"
            ,A.COA_CC_CD                                         AS "LINK_CC_CD" 
            ,A.COA_ACCT_CD                                       AS "LINK_ACCT_CD"
            ,A.COA_PROD_CD                                       AS "LINK_PROD_CD"
            ,A.COA_CH_CD                                         AS "LINK_CH_CD"
            ,A.COA_AFFL_CD                                       AS "LINK_AFFL_CD"
            ,A.COA_PROJ_CD                                       AS "LINK_PROJ_CD"
            ,A.COA_EXTN_CD                                       AS "LINK_EXTN_CD"
            ,NVL(P.FIN_BR_CD, NVL(SMM.FIN_BR_CD, NVL(NVL(SBFX.FIN_BR_CD, SBPX.SVC_BR_CD), NVL(SBFX_5.FIN_BR_CD, SBPX_5.SVC_BR_CD))))
                                                                 AS "IB_BR_CD"
            ,P.FIN_BR_CD
            ,SMM.FIN_BR_CD
            ,SBFX.FIN_BR_CD
            ,SBPX.SVC_BR_CD
            ,SBFX_5.FIN_BR_CD
            ,SBPX_5.SVC_BR_CD
            ,NVL(SBFX.FIN_BR_CD, SBPX.SVC_BR_CD)                 AS "CONTR-SHIP-TO_BR_CD"
            ,LBT.COA_CC_CD                                       AS "LINE-BIZ_CC_CD"
            ,NVL(Q.AJE_COA_PROD_MAP_TO_CD, NVL(MDSE_MACH.COA_PROD_CD, CPM.AJE_COA_PROD_MAP_TO_CD))     AS "MACH-MAP_PROD_CD"
            ,(CASE
                WHEN DCH.DS_CONTR_CATG_CD   = #dsContrCatgFLEET#
                    THEN LBT1.SPLY_COA_CC_CD
                WHEN MDS.SVC_ALLOC_TP_CD    = #svcAllocTpOPTIMA#
                    THEN LBT2.SPLY_COA_CC_CD
                ELSE
                    NVL(LBT.SPLY_COA_CC_CD, NVL(LBT3.SPLY_COA_CC_CD, LBT2.SPLY_COA_CC_CD))
             END)                                                AS "LOB-SPLY_CC_CD"
            ,(CASE
                WHEN DCH.DS_CONTR_CATG_CD   = #dsContrCatgFLEET#
                    THEN LBT1.SVC_COA_CC_CD
                WHEN MDS.SVC_ALLOC_TP_CD    = #svcAllocTpOPTIMA#
                    THEN LBT2.SVC_COA_CC_CD
                ELSE
                    NVL(LBT.SVC_COA_CC_CD, NVL(LBT3.SVC_COA_CC_CD, LBT2.SVC_COA_CC_CD))
             END)                                                AS "LOB-SVC_CC_CD"
            ,(CASE WHEN CB.COA_BR_TP_CD = #newcore# THEN I.COA_BR_CD
                   ELSE #defBrNewcore# END) AS "NEWCORE_BR_CD"
            ,(CASE WHEN CB.COA_BR_TP_CD = #newcore# THEN I.COA_CC_CD
                   ELSE #defCcNewcore# END) AS "NEWCORE_CC_CD"
            ,L.COA_AFFL_CD                                       AS "CUST-ACCT_AFFL_CD"
        FROM
             DS_INV_SLS_CR      A
            ,INV                B
            ,INV_LINE           C
            ,INV_BOL            D
            ,SYS_SRC            F
            ,DFRD_ACCTG_RULE    G
            ,DS_INV_TP          H
            ,TOC_DLY_SNAP_SHOT  I
            ,MDSE_DLY_SNAP_SHOT J
            ,COA_TAX_ST         K
            ,SELL_TO_CUST       L
            ,BILL_TO_CUST       M
            ,SELL_TO_CUST       LS
            ,BILL_TO_CUST       MS
            ,SVC_INV_LINE       O
            ,SVC_MACH_MSTR      P
            ,AJE_COA_PROD_MAP   Q
            ,LINE_BIZ_TP        LBT
            ,LINE_BIZ_TP        LBT1
            ,LINE_BIZ_TP        LBT2
            ,LINE_BIZ_TP        LBT3
            ,MDSE               MDS
            ,MDSE_DLY_SNAP_SHOT MDSE_MACH
            ,SVC_CONFIG_MSTR    SCM
            ,SVC_MACH_MSTR      SMM
            ,SVC_INV_LINE       SIL
            ,DS_CONTR           DCH
            ,DS_CONTR_DTL       DCD
            ,SHIP_TO_CUST       STC
            ,SVC_BR_POST_XREF   SBPX
            ,SVC_BR_FIN_BR_XREF SBFX
            ,SVC_BR_POST_XREF   SBPX_5
            ,SVC_BR_FIN_BR_XREF SBFX_5
            ,AJE_COA_PROD_MAP   CPM
            ,COA_BR             CB
            ,DS_CONTR           DCH2
            ,SVC_INV            SI
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.INV_NUM              = #invNum#
            AND B.GLBL_CMPY_CD         = A.GLBL_CMPY_CD
            AND B.INV_NUM              = A.INV_NUM
            AND C.GLBL_CMPY_CD         = A.GLBL_CMPY_CD
            AND C.INV_NUM              = A.INV_NUM
            AND C.INV_BOL_LINE_NUM     = A.INV_BOL_LINE_NUM
            AND C.INV_LINE_NUM         = A.INV_LINE_NUM
            AND C.INV_LINE_SUB_NUM     = A.INV_LINE_SUB_NUM
            AND D.GLBL_CMPY_CD         = A.GLBL_CMPY_CD
            AND D.INV_NUM              = A.INV_NUM
            AND D.INV_BOL_LINE_NUM     = A.INV_BOL_LINE_NUM
            AND F.GLBL_CMPY_CD(+)      = A.GLBL_CMPY_CD
            AND F.SYS_SRC_CD(+)        = B.SYS_SRC_CD
            AND B.GLBL_CMPY_CD         = H.GLBL_CMPY_CD(+)
            AND B.DS_INV_TP_CD         = H.DS_INV_TP_CD(+)
            AND A.GLBL_CMPY_CD         = I.GLBL_CMPY_CD(+)
            AND A.SLS_REP_TOC_CD       = I.TOC_CD(+)
            AND C.GLBL_CMPY_CD         = J.GLBL_CMPY_CD(+)
            AND (CASE WHEN A.INV_LINE_SPL_TP_CD = #dev# THEN C.MDSE_CD
                      ELSE A.MDSE_CD END)      = J.MDSE_CD(+)
            AND D.GLBL_CMPY_CD         = K.GLBL_CMPY_CD(+)
            AND NVL(D.SHIP_TO_ST_CD, M.ST_CD)   = K.COA_TAX_ST_CD(+)
            AND K.COA_TAX_CTRY_CD(+)   = NVL(D.SHIP_TO_CTRY_CD, 'US')
            AND B.GLBL_CMPY_CD         = L.GLBL_CMPY_CD(+)
            AND B.BILL_TO_CUST_ACCT_CD = L.SELL_TO_CUST_CD(+)
            AND B.GLBL_CMPY_CD         = M.GLBL_CMPY_CD(+)
            AND B.BILL_TO_CUST_CD      = M.BILL_TO_CUST_CD(+)
            AND B.GLBL_CMPY_CD         = LS.GLBL_CMPY_CD(+)
            AND B.SELL_TO_CUST_CD      = LS.SELL_TO_CUST_CD(+)
            AND B.GLBL_CMPY_CD         = MS.GLBL_CMPY_CD(+)
            AND B.SOLD_TO_CUST_LOC_CD  = MS.BILL_TO_CUST_CD(+)
            AND C.GLBL_CMPY_CD         = O.GLBL_CMPY_CD(+)
            AND C.SVC_INV_LINE_PK      = O.SVC_INV_LINE_PK(+)
            AND O.GLBL_CMPY_CD         = P.GLBL_CMPY_CD(+)
            AND O.SVC_MACH_MSTR_PK     = P.SVC_MACH_MSTR_PK(+)
            AND J.LTST_REC_FLG(+)      = 'Y'
            AND A.EZCANCELFLAG         = '0'
            AND B.EZCANCELFLAG         = '0'
            AND C.EZCANCELFLAG         = '0'
            AND D.EZCANCELFLAG         = '0'
            AND F.EZCANCELFLAG(+)      = '0'
            AND H.EZCANCELFLAG(+)      = '0'
            AND I.EZCANCELFLAG(+)      = '0'
            AND J.EZCANCELFLAG(+)      = '0'
            AND K.EZCANCELFLAG(+)      = '0'
            AND L.EZCANCELFLAG(+)      = '0'
            AND M.EZCANCELFLAG(+)      = '0'
            AND LS.EZCANCELFLAG(+)     = '0'
            AND MS.EZCANCELFLAG(+)     = '0'
            AND O.EZCANCELFLAG(+)      = '0'
            AND P.EZCANCELFLAG(+)      = '0'
            AND Q.EZCANCELFLAG(+)      = '0'
            AND A.GLBL_CMPY_CD         = G.GLBL_CMPY_CD(+)
            AND A.EZCANCELFLAG         = G.EZCANCELFLAG(+)
            AND A.DFRD_ACCTG_RULE_CD   = G.DFRD_ACCTG_RULE_CD(+)
            AND P.GLBL_CMPY_CD         = LBT.GLBL_CMPY_CD(+)
            AND P.EZCANCELFLAG         = LBT.EZCANCELFLAG(+)
            AND P.SVC_BY_LINE_BIZ_TP_CD = LBT.LINE_BIZ_TP_CD(+)
            AND DCH.GLBL_CMPY_CD        = LBT1.GLBL_CMPY_CD(+)
            AND DCH.SVC_LINE_BIZ_CD     = LBT1.LINE_BIZ_TP_CD(+)
            AND LBT1.EZCANCELFLAG(+)    = '0'
            AND B.GLBL_CMPY_CD          = LBT2.GLBL_CMPY_CD(+)
            AND B.LINE_BIZ_TP_CD        = LBT2.LINE_BIZ_TP_CD(+)
            AND LBT2.EZCANCELFLAG(+)    = '0'
            AND C.GLBL_CMPY_CD          = MDS.GLBL_CMPY_CD(+)
            AND C.MDSE_CD               = MDS.MDSE_CD(+)
            AND MDS.EZCANCELFLAG(+)     = '0'
            AND DCH2.GLBL_CMPY_CD        = LBT3.GLBL_CMPY_CD(+)
            AND DCH2.SVC_LINE_BIZ_CD     = LBT3.LINE_BIZ_TP_CD(+)
            AND LBT3.EZCANCELFLAG(+)    = '0'
            AND C.GLBL_CMPY_CD                 = SCM.GLBL_CMPY_CD(+)
            AND C.EZCANCELFLAG                 = SCM.EZCANCELFLAG(+)
            AND C.SVC_CONFIG_MSTR_PK           = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.GLBL_CMPY_CD               = SMM.GLBL_CMPY_CD(+)
            AND SCM.EZCANCELFLAG               = SMM.EZCANCELFLAG(+)
            AND SCM.SVC_MACH_MSTR_PK           = SMM.SVC_MACH_MSTR_PK(+)
            AND MDSE_MACH.GLBL_CMPY_CD(+)      = #glblCmpyCd#
            AND MDSE_MACH.EZCANCELFLAG(+)      = '0'
            AND NVL(P.MDSE_CD, NVL(SMM.MDSE_CD, C.MDSE_CD))    = MDSE_MACH.MDSE_CD(+)
            AND MDSE_MACH.LTST_REC_FLG(+)      = 'Y'
            AND MDSE_MACH.GLBL_CMPY_CD         = Q.GLBL_CMPY_CD(+)
            AND MDSE_MACH.COA_PROD_CD          = Q.AJE_COA_PROD_MAP_CD(+)
            AND C.GLBL_CMPY_CD                 = SIL.GLBL_CMPY_CD(+)
            AND C.SVC_INV_LINE_PK              = SIL.SVC_INV_LINE_PK(+)
            AND SIL.EZCANCELFLAG(+)            = '0'
            AND SIL.GLBL_CMPY_CD               = DCH.GLBL_CMPY_CD(+)
            AND SIL.DS_CONTR_PK                = DCH.DS_CONTR_PK(+)
            AND DCH.EZCANCELFLAG(+)            = '0'
            AND SIL.GLBL_CMPY_CD               = DCD.GLBL_CMPY_CD(+)
            AND SIL.DS_CONTR_DTL_PK            = DCD.DS_CONTR_DTL_PK(+)
            AND DCD.EZCANCELFLAG(+)            = '0'
            AND DCD.GLBL_CMPY_CD               = STC.GLBL_CMPY_CD(+)
            AND DCD.SHIP_TO_CUST_CD            = STC.SHIP_TO_CUST_CD(+)
            AND STC.EZCANCELFLAG(+)            = '0'
            AND STC.GLBL_CMPY_CD               = SBPX.GLBL_CMPY_CD(+)
            AND STC.POST_CD                    = SBPX.POST_CD(+)
            AND DCH.SVC_LINE_BIZ_CD            = SBPX.SVC_LINE_BIZ_CD(+)
            AND SBPX.EZCANCELFLAG(+)           = '0'
            AND SBPX.GLBL_CMPY_CD              = SBFX.GLBL_CMPY_CD(+)
            AND SBPX.SVC_BR_CD                 = SBFX.SVC_BR_CD(+)
            AND SBPX.SVC_LINE_BIZ_CD           = SBFX.SVC_LINE_BIZ_CD(+)
            AND SBFX.EZCANCELFLAG(+)           = '0'
            AND STC.GLBL_CMPY_CD               = SBPX_5.GLBL_CMPY_CD(+)
            AND SUBSTR(STC.POST_CD,1,5)        = SBPX_5.POST_CD(+)
            AND SBPX_5.EZCANCELFLAG(+)         = '0'
            AND DCH.SVC_LINE_BIZ_CD            = SBPX_5.SVC_LINE_BIZ_CD(+)
            AND SBPX_5.GLBL_CMPY_CD            = SBFX_5.GLBL_CMPY_CD(+)
            AND SBPX_5.SVC_BR_CD               = SBFX_5.SVC_BR_CD(+)
            AND SBPX_5.SVC_LINE_BIZ_CD         = SBFX_5.SVC_LINE_BIZ_CD(+)
            AND SBFX_5.EZCANCELFLAG(+)         = '0'
            AND #glblCmpyCd#                   = CPM.GLBL_CMPY_CD(+)
            AND 'FLT'                          = CPM.AJE_COA_PROD_MAP_CD(+)
            AND CB.EZCANCELFLAG(+)             = '0'
            AND I.GLBL_CMPY_CD                 = CB.GLBL_CMPY_CD(+)
            AND I.COA_BR_CD                    = CB.COA_BR_CD(+)
            AND NOT EXISTS (
                SELECT
                    'X'
                FROM
                    AJE_INV_ACCT_DIST    H
                WHERE
                        H.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND H.DS_INV_SLS_CR_PK  = A.DS_INV_SLS_CR_PK
                    AND H.EZCANCELFLAG      = '0'
            )
            AND B.GLBL_CMPY_CD              = SI.GLBL_CMPY_CD(+)
            AND B.SVC_INV_PK                = SI.SVC_INV_PK(+)
            AND B.EZCANCELFLAG              = SI.EZCANCELFLAG(+)
            AND SI.GLBL_CMPY_CD             = DCH2.GLBL_CMPY_CD(+)
            AND SI.DS_CONTR_PK              = DCH2.DS_CONTR_PK(+)
            ORDER BY
                 INV_BOL_LINE_NUM
                ,INV_LINE_NUM
                ,INV_LINE_SUB_NUM
                ,DS_INV_SLS_CR_PK
    </statement>
    <!-- end 2018/01/31 QC#23689 -->

    <statement id="getAjeInvAcctDist" parameterClass="Map" resultClass="Map">
        SELECT
             GLBL_CMPY_CD
            ,AJE_INV_ACCT_DIST_PK
        FROM
            AJE_INV_ACCT_DIST   A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.PROC_STS_CD       = #procStsCd#
            AND A.JRNL_CRAT_DT      IS NULL
            AND A.EZCANCELFLAG      = '0'
    </statement>

    <!-- START 2016/12/26 T.Murai [QC#16818,ADD] -->
    <statement id="getAjeInvAcctDistList" parameterClass="Map" resultClass="Map">
        SELECT
            AID.DS_INV_SLS_CR_PK
           ,AID.AJE_INV_ACCT_DIST_PK
           ,AID.AJE_INV_ACCT_CLS_CD
           ,AID.DR_CR_TP_CD
        FROM
            AJE_INV_ACCT_DIST   AID
        WHERE
                AID.GLBL_CMPY_CD        = #glblCmpyCd#
            AND AID.INV_NUM             = #invNum#
            AND AID.EZCANCELFLAG        = '0'
        ORDER BY
            AID.DS_INV_SLS_CR_PK
           ,AID.DR_CR_TP_CD
           ,AID.AJE_INV_ACCT_CLS_CD
    </statement>
    <!-- END   2016/12/26 T.Murai [QC#16818,ADD] -->

    <!-- QC#19726 add Start -->
    <statement id="getBsPlTp" parameterClass="Map" resultClass="String">
        SELECT
             BS_PL_TP_CD
        FROM
             COA_ACCT       CA
            ,TRIAL_BAL_TP   TBT
        WHERE
                CA.GLBL_CMPY_CD     = #glblCmpyCd#
            AND CA.COA_ACCT_CD      = #coaAcctCd#
            AND CA.EZCANCELFLAG     = '0'
            AND CA.GLBL_CMPY_CD     = TBT.GLBL_CMPY_CD
            AND CA.TRIAL_BAL_TP_CD  = TBT.TRIAL_BAL_TP_CD
            AND TBT.EZCANCELFLAG    = '0'
    </statement>
    <!-- QC#19726 add End -->

    <!-- QC#23166 add Start -->
    <statement id="getSvcInvChrgTp" parameterClass="Map" resultClass="Map">
        SELECT
             IL.SVC_INV_CHRG_TP_CD      AS INV_SVC_INV_CHRG_TP_CD
            ,SIL2.SVC_INV_CHRG_TP_CD    AS SVC_INV_CHRG_TP_CD
            ,DISC.DS_INV_SLS_CR_PK
        FROM
             DS_INV_SLS_CR  DISR
            ,INV_LINE       IL
            ,SVC_INV_LINE   SIL1
            ,SVC_INV_LINE   SIL2
            ,DS_INV_SLS_CR  DISC
            ,INV            IV
        WHERE
                DISR.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DISR.INV_NUM              = #invNum#
            AND DISR.EZCANCELFLAG         = '0'
            AND DISR.TRX_CD               = #trxCd#
            <iterate property="trxRsnCdList" var="trxRsnCd[]" open="AND DISR.TRX_RSN_CD          IN (" close=")" conjunction=",">
            #trxRsnCd[]#
            </iterate>
            AND DISR.GLBL_CMPY_CD         = IL.GLBL_CMPY_CD 
            AND DISR.INV_NUM              = IL.INV_NUM
            AND DISR.INV_BOL_LINE_NUM     = IL.INV_BOL_LINE_NUM
            AND DISR.INV_LINE_NUM         = IL.INV_LINE_NUM
            AND DISR.INV_LINE_SUB_NUM     = IL.INV_LINE_SUB_NUM
            AND IL.EZCANCELFLAG           = '0'
            AND IL.GLBL_CMPY_CD           = SIL1.GLBL_CMPY_CD
            AND IL.SVC_INV_LINE_PK        = SIL1.SVC_INV_LINE_PK
            AND SIL1.EZCANCELFLAG         = '0'
            AND SIL1.GLBL_CMPY_CD         = SIL2.GLBL_CMPY_CD(+)
            AND SIL1.PRNT_SVC_INV_LINE_PK = SIL2.SVC_INV_LINE_PK(+)
            AND SIL2.EZCANCELFLAG(+)      = '0'
            AND IL.GLBL_CMPY_CD           = DISC.GLBL_CMPY_CD
            AND IL.INV_NUM                = DISC.INV_NUM
            AND IL.INV_BOL_LINE_NUM       = DISC.INV_BOL_LINE_NUM
            AND IL.INV_LINE_NUM           = DISC.INV_LINE_NUM
            AND IL.INV_LINE_SUB_NUM       = DISC.INV_LINE_SUB_NUM
            AND DISR.GLBL_CMPY_CD         = IV.GLBL_CMPY_CD 
            AND DISR.INV_NUM              = IV.INV_NUM
            AND IV.INV_TP_CD              &lt;&gt; #creditMemo#
            AND IV.EZCANCELFLAG           = '0'
    </statement>
    <!-- QC#23166 add End -->
</sqlMap>
