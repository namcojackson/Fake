<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NFAB312001">

<!-- #################### Type Alias #################### -->

<!-- #################### Statement #################### -->


    <statement id="getTrxPtrn" parameterClass="Map" resultClass="Map">
       SELECT 
            ACI.SYS_SRC_CD AS SYS_SRC_CD,
            ACI.TRX_CD     AS TRX_CD,
            ACI.TRX_RSN_CD AS TRX_RSN_CD
        FROM 
            AJE_ACRL_INTFC ACI
        WHERE 
            ACI.EZCANCELFLAG = '0'
        AND    ACI.GLBL_CMPY_CD = #glblCmpyCd#
        AND    NOT EXISTS 
        (
            SELECT '*'
            FROM AJE_INTFC_CTRL      AIC
           WHERE AIC.EZCANCELFLAG    = '0'
             AND AIC.GLBL_CMPY_CD    = #glblCmpyCd#
             AND AIC.AJE_INTFC_TP_CD = #ajeIntfcTpCd#
             AND AIC.JRNL_CPLT_FLG   = #jrnlCpltFlg#
             AND AIC.GLBL_CMPY_CD    = ACI.GLBL_CMPY_CD
             AND AIC.AJE_INTFC_PK    = ACI.AJE_ACRL_INTFC_PK
        )
        GROUP BY 
            ACI.SYS_SRC_CD,
            ACI.TRX_CD,
            ACI.TRX_RSN_CD
        ORDER BY 
            ACI.TRX_CD,
            ACI.TRX_RSN_CD,
            ACI.SYS_SRC_CD
    </statement>

    <statement id="getAjeArIntfcNotJrnlized" parameterClass="Map" resultClass="Map">
       SELECT
            AAI.GLBL_CMPY_CD          GLBL_CMPY_CD
           ,AAI.AJE_ACRL_INTFC_PK     AJE_INTFC_PK
           ,AAI.GL_DT                 GL_DT
           ,AAI.SYS_SRC_CD            SYS_SRC_CD
           ,SS.SYS_SRC_NM             SYS_SRC_NM
           ,AAI.TRX_CD                TRX_CD
           ,TRX.TRX_NM                TRX_NM
           ,AAI.TRX_RSN_CD            TRX_RSN_CD
           ,TRX_RSN.TRX_RSN_NM        TRX_RSN_NM
           ,CCY.ACCT_ARTH_TP_CD       ACCT_ARTH_TP_CD
           ,CCY.ORCL_CCY_CD           ORCL_CCY_CD
           ,AAI.DEAL_CCY_CD           DEAL_CCY_CD
           ,AAI.FUNC_CCY_CD           FUNC_CCY_CD
           ,AAI.EXCH_RATE             EXCH_RATE
           ,AAI.JRNL_DEAL_AMT         JRNL_DEAL_AMT
           ,AAI.JRNL_FUNC_AMT         JRNL_FUNC_AMT
           ,AAI.SLS_REP_CR_PCT        SLS_REP_CR_PCT
           ,AAI.SER_NUM               SER_NUM
           ,AAI.SVC_MACH_MSTR_PK      SVC_MACH_MSTR_PK
           ,AAI.SVC_CONFIG_MSTR_PK    SVC_CONFIG_MSTR_PK
           ,AAI.DS_CONTR_PK           DS_CONTR_PK
           ,AAI.DS_CONTR_NUM          DS_CONTR_NUM
           ,AAI.DS_CONTR_DTL_PK       DS_CONTR_DTL_PK
           ,AAI.DS_ACCT_NUM           DS_ACCT_NUM
           ,AAI.TOC_CD                TOC_CD
           ,AAI.AJE_ITEM_CD           AJE_ITEM_CD
           ,AAI.AJE_ITEM_DESC_TXT     AJE_ITEM_DESC_TXT
           
           -- For LINK
           ,AAI.COA_CMPY_CD           "LINK_CMPY_CD"
           ,AAI.COA_BR_CD             "LINK_BR_CD"
           ,AAI.COA_CC_CD             "LINK_CC_CD"
           ,AAI.COA_ACCT_CD           "LINK_ACCT_CD"
           ,AAI.COA_PROD_CD           "LINK_PROD_CD"
           ,AAI.COA_CH_CD             "LINK_CH_CD"
           ,AAI.COA_AFFL_CD           "LINK_AFFL_CD"
           ,AAI.COA_PROJ_CD           "LINK_PROJ_CD"
           ,AAI.COA_EXTN_CD           "LINK_EXTN_CD"
        FROM 
             AJE_ACRL_INTFC         AAI
            ,SYS_SRC                SS
            ,TRX                    TRX
            ,TRX_RSN                TRX_RSN
            ,CCY                    CCY
        WHERE 
                   AAI.EZCANCELFLAG         = '0'
            AND    SS.EZCANCELFLAG          = '0'
            AND    TRX.EZCANCELFLAG         = '0'
            AND    TRX_RSN.EZCANCELFLAG     = '0'
            AND    CCY.EZCANCELFLAG(+)      = '0'
            AND    AAI.GLBL_CMPY_CD         = #glblCmpyCd#
            AND    AAI.GLBL_CMPY_CD         = SS.GLBL_CMPY_CD
            AND    AAI.SYS_SRC_CD           = SS.SYS_SRC_CD
            AND    TRX.GLBL_CMPY_CD         = TRX_RSN.GLBL_CMPY_CD
            AND    TRX.TRX_CD               = TRX_RSN.TRX_CD
            AND    AAI.GLBL_CMPY_CD         = TRX.GLBL_CMPY_CD
            AND    AAI.TRX_CD               = TRX.TRX_CD
            AND    AAI.GLBL_CMPY_CD         = TRX_RSN.GLBL_CMPY_CD
            AND    AAI.TRX_RSN_CD           = TRX_RSN.TRX_RSN_CD
            AND    AAI.GLBL_CMPY_CD         = CCY.GLBL_CMPY_CD(+)
            AND    AAI.FUNC_CCY_CD          = CCY.CCY_CD(+)
            <!-- START 2024/01/22 [QC#62449,Del] -->
            <!-- AND    SUBSTR(GL_DT,1,6)        = #lastMonth# -->
            <!-- END 2024/01/22 [QC#62449,Del] -->
            AND    NOT EXISTS 
            (
                SELECT '*'
                FROM AJE_INTFC_CTRL      AIC
               WHERE AIC.EZCANCELFLAG    = '0'
                 AND AIC.GLBL_CMPY_CD    = #glblCmpyCd#
                 AND AIC.AJE_INTFC_TP_CD = #ajeIntfcTpCd#
                 AND AIC.JRNL_CPLT_FLG   = #jrnlCpltFlg#
                 AND AIC.GLBL_CMPY_CD    = AAI.GLBL_CMPY_CD
                 AND AIC.AJE_INTFC_PK    = AAI.AJE_ACRL_INTFC_PK
            )
     </statement>

</sqlMap>
