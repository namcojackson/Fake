<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSZC005001">

    <typeAlias alias="FSR_VISITTMsg"       type="business.db.FSR_VISITTMsg" />
    <typeAlias alias="SVC_SUPPL_TASKTMsg"  type="business.db.SVC_SUPPL_TASKTMsg" />

     <statement id="getBillTp" parameterClass="Map" resultClass="Map">
        SELECT
             A.SVC_TASK_STS_CD
            ,B.LBOR_CHRG_FLG
            ,B.PRT_CHRG_FLG
            ,B.EXP_CHRG_FLG
            ,B.DRUM_CHRG_FLG
        FROM 
             SVC_TASK     A
            ,SVC_BILL_TP  B
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.FSR_NUM           = #fsrNum#
            <isNotNull property="svcTaskNum">
            AND A.SVC_TASK_NUM      = #svcTaskNum#
            </isNotNull>
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.SVC_BILL_TP_CD    = B.SVC_BILL_TP_CD
            AND B.EZCANCELFLAG      = '0'
    </statement>
    <statement id="getCallTp" parameterClass="Map" resultClass="Map">
        SELECT
             A.SVC_TASK_STS_CD
            ,B.SVC_ISTL_REQ_FLG
            ,B.SVC_CALL_FLG
            ,B.SVC_PRVNT_MAINT_FLG
            ,C.FSR_NUM
            ,C.FSR_STS_CD
            ,C.FSR_TP_CD
        FROM 
             SVC_TASK        A
            ,DS_SVC_CALL_TP  B
            ,FSR             C
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.SVC_TASK_NUM      = #svcTaskNum#
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.DS_SVC_CALL_TP_CD = B.DS_SVC_CALL_TP_CD
            AND B.EZCANCELFLAG      = '0'
            AND A.GLBL_CMPY_CD      = C.GLBL_CMPY_CD
            AND A.FSR_NUM           = C.FSR_NUM
            AND C.EZCANCELFLAG      = '0'
    </statement>
    <statement id="getFollUpInfo" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_SVC_CALL_TP_CD
            ,A.REQ_TECH_FLG
            ,A.SVC_TASK_STS_CD
            ,A.ERL_FOLL_UP_START_CD
            ,A.LATE_FOLL_UP_START_CD
            ,A.REQ_PRT_FLG
            ,A.START_STD_APPLY_FLG
            ,B.SYS_DT_FLG               AS ERL_SYS_DT_FLG
            ,B.SVC_RSP_TM_MN_AOT_FLG    AS ERL_SVC_RSP_TM_MN_AOT_FLG
            ,B.ADDL_TM_NUM              AS ERL_ADDL_TM_NUM
            ,C.SYS_DT_FLG               AS LATE_SYS_DT_FLG
            ,C.SVC_RSP_TM_MN_AOT_FLG    AS LATE_SVC_RSP_TM_MN_AOT_FLG
            ,C.ADDL_TM_NUM              AS LATE_ADDL_TM_NUM
            <!-- START 2019/11/18 K.Fujimoto [QC#53491, ADD] -->
            ,D.ONS_SPRT_CALL_FLG        AS ONS_SPRT_CALL_FLG
            <!-- START 2019/11/18 K.Fujimoto [QC#53491, ADD] -->
        FROM 
             SVC_PBLM_RSN_FOLL_UP  A
            ,SVC_FOLL_UP_START     B
            ,SVC_FOLL_UP_START     C
            <!-- START 2019/11/18 K.Fujimoto [QC#53491, ADD] -->
            ,SVC_PBLM_CRCT_TP      D
            <!-- START 2019/11/18 K.Fujimoto [QC#53491, ADD] -->
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.SVC_PBLM_CRCT_TP_CD   = #svcPblmCrctTpCd#
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.ERL_FOLL_UP_START_CD  = B.SVC_FOLL_UP_START_CD
            AND B.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND A.LATE_FOLL_UP_START_CD = C.SVC_FOLL_UP_START_CD
            AND C.EZCANCELFLAG          = '0'
            <!-- START 2019/11/18 K.Fujimoto [QC#53491, ADD] -->
            AND A.GLBL_CMPY_CD          = D.GLBL_CMPY_CD
            AND A.SVC_PBLM_CRCT_TP_CD   = D.SVC_PBLM_CRCT_TP_CD
            AND D.EZCANCELFLAG          = '0'
            <!-- START 2019/11/18 K.Fujimoto [QC#53491, ADD] -->
    </statement>
    <statement id="getFsrExpAmt" parameterClass="Map" resultClass="Map">
        SELECT
             SUM(NVL(A.SVC_EXP_DEAL_AMT, 0))      AS SVC_EXP_DEAL_AMT
            ,SUM(NVL(A.SVC_EXP_FUNC_AMT, 0))      AS SVC_EXP_FUNC_AMT
            ,SUM(NVL(A.SVC_EXP_DEAL_DISC_AMT, 0)) AS SVC_EXP_DEAL_DISC_AMT
            ,SUM(NVL(A.SVC_EXP_FUNC_DISC_AMT, 0)) AS SVC_EXP_FUNC_DISC_AMT
        FROM 
            FSR_EXP A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.FSR_NUM           = #fsrNum#
            AND A.FSR_VISIT_NUM     = #fsrVisitNum#
            AND A.SVC_TASK_NUM      = #svcTaskNum#
        GROUP BY
             A.FSR_NUM 
            ,A.FSR_VISIT_NUM 
            ,A.SVC_TASK_NUM 
    </statement>
    <statement id="getFsrExpPkListForDelete" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.FSR_EXP_PK
        FROM
            FSR_EXP A
        WHERE
                A.GLBL_CMPY_CD  = #glblCmpyCd#
            AND A.EZCANCELFLAG  = '0'
            AND A.FSR_NUM       = #fsrNum#
            AND A.FSR_VISIT_NUM = #fsrVisitNum#
    </statement>
    <statement id="getFsrIstlChkPkListForDelete" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.FSR_ISTL_CHK_LIST_PK
        FROM
            FSR_ISTL_CHK_LIST A
        WHERE
                A.GLBL_CMPY_CD  = #glblCmpyCd#
            AND A.EZCANCELFLAG  = '0'
            AND A.FSR_NUM       = #fsrNum#
            AND A.SVC_TASK_NUM  = #svcTaskNum#
    </statement>
    <statement id="getFsrUsgAmt" parameterClass="Map" resultClass="Map">
        SELECT
             SUM(NVL(A.SVC_PRT_DEAL_AMT, 0))      AS SVC_PRT_DEAL_AMT
            ,SUM(NVL(A.SVC_PRT_FUNC_AMT, 0))      AS SVC_PRT_FUNC_AMT
            ,SUM(NVL(A.SVC_PRT_DEAL_DISC_AMT, 0)) AS SVC_PRT_DEAL_DISC_AMT
            ,SUM(NVL(A.SVC_PRT_FUNC_DISC_AMT, 0)) AS SVC_PRT_FUNC_DISC_AMT
        FROM 
            FSR_USG A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.FSR_NUM           = #fsrNum#
            AND A.FSR_VISIT_NUM     = #fsrVisitNum#
            AND A.SVC_TASK_NUM      = #svcTaskNum#
        GROUP BY
             A.FSR_NUM 
            ,A.FSR_VISIT_NUM 
            ,A.SVC_TASK_NUM 
    </statement>
    <statement id="getFsrUsgPkListForDelete" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.FSR_USG_PK
        FROM
            FSR_USG A
        WHERE
                A.GLBL_CMPY_CD  = #glblCmpyCd#
            AND A.EZCANCELFLAG  = '0'
            AND A.FSR_NUM       = #fsrNum#
            AND A.SVC_TASK_NUM  = #svcTaskNum#
    </statement>
    <statement id="getFsrVisitAmt" parameterClass="Map" resultMap="result.FSR_VISITTMsg">
        SELECT
             SUM(NVL(A.SVC_LBOR_DEAL_AMT, 0))          AS SVC_LBOR_DEAL_AMT
            ,SUM(NVL(A.SVC_LBOR_FUNC_AMT, 0))          AS SVC_LBOR_FUNC_AMT
            ,SUM(NVL(A.SVC_LBOR_DEAL_DISC_AMT, 0))     AS SVC_LBOR_DEAL_DISC_AMT
            ,SUM(NVL(A.SVC_LBOR_FUNC_DISC_AMT, 0))     AS SVC_LBOR_FUNC_DISC_AMT
            ,SUM(NVL(A.SVC_LBOR_INV_DEAL_AMT, 0))      AS SVC_LBOR_INV_DEAL_AMT
            ,SUM(NVL(A.SVC_LBOR_INV_FUNC_AMT, 0))      AS SVC_LBOR_INV_FUNC_AMT
            ,SUM(NVL(A.SVC_LBOR_INV_DEAL_DISC_AMT, 0)) AS SVC_LBOR_INV_DEAL_DISC_AMT
            ,SUM(NVL(A.SVC_LBOR_INV_FUNC_DISC_AMT, 0)) AS SVC_LBOR_INV_FUNC_DISC_AMT
            ,SUM(NVL(A.SVC_TRVL_DEAL_AMT, 0))          AS SVC_TRVL_DEAL_AMT
            ,SUM(NVL(A.SVC_TRVL_FUNC_AMT, 0))          AS SVC_TRVL_FUNC_AMT
            ,SUM(NVL(A.SVC_TRVL_DEAL_DISC_AMT, 0))     AS SVC_TRVL_DEAL_DISC_AMT
            ,SUM(NVL(A.SVC_TRVL_FUNC_DISC_AMT, 0))     AS SVC_TRVL_FUNC_DISC_AMT
            ,SUM(NVL(A.SVC_PRT_DEAL_AMT, 0))           AS SVC_PRT_DEAL_AMT
            ,SUM(NVL(A.SVC_PRT_FUNC_AMT, 0))           AS SVC_PRT_FUNC_AMT
            ,SUM(NVL(A.SVC_PRT_DEAL_DISC_AMT, 0))      AS SVC_PRT_DEAL_DISC_AMT
            ,SUM(NVL(A.SVC_PRT_FUNC_DISC_AMT, 0))      AS SVC_PRT_FUNC_DISC_AMT
            ,SUM(NVL(A.SVC_EXP_DEAL_AMT, 0))           AS SVC_EXP_DEAL_AMT
            ,SUM(NVL(A.SVC_EXP_FUNC_AMT, 0))           AS SVC_EXP_FUNC_AMT
            ,SUM(NVL(A.SVC_EXP_DEAL_DISC_AMT, 0))      AS SVC_EXP_DEAL_DISC_AMT
            ,SUM(NVL(A.SVC_EXP_FUNC_DISC_AMT, 0))      AS SVC_EXP_FUNC_DISC_AMT
        FROM 
            FSR_VISIT A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.FSR_NUM           = #fsrNum#
        GROUP BY
             A.FSR_NUM
    </statement>
    <statement id="getFsrVisitTmEventLborCnt" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*) AS COUNT
        FROM 
             FSR_VISIT_TM_EVENT  A
            ,SVC_TM_EVENT        B
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.FSR_NUM           = #fsrNum#
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.SVC_TM_EVENT_CD   = B.SVC_TM_EVENT_CD
            AND B.EZCANCELFLAG      = '0'
            AND B.INCL_LBOR_TM_FLG  = #inclLborTmFlgY#
    </statement>
    <statement id="getFsrVisitTmEventPkListForDelete" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.FSR_VISIT_TM_EVENT_PK
        FROM
            FSR_VISIT_TM_EVENT A
        WHERE
                A.GLBL_CMPY_CD  = #glblCmpyCd#
            AND A.EZCANCELFLAG  = '0'
            AND A.FSR_NUM       = #fsrNum#
            AND A.FSR_VISIT_NUM = #fsrVisitNum#
    </statement>
    <statement id="getFsrVisitTotAmt" parameterClass="Map" resultClass="Map">
        SELECT
             A.FSR_NUM 
            ,A.FSR_VISIT_NUM 
            ,A.SVC_TASK_NUM 
            ,SUM(NVL(A.SVC_LBOR_DEAL_AMT, 0))      +
             SUM(NVL(A.SVC_LBOR_INV_DEAL_AMT, 0))  +
             SUM(NVL(A.SVC_TRVL_DEAL_AMT, 0))        +
             SUM(NVL(A.SVC_PRT_DEAL_AMT, 0))       +
             SUM(NVL(A.SVC_EXP_DEAL_AMT, 0))       AS TOT_AMT
        FROM 
            FSR_VISIT A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.FSR_NUM           = #fsrNum#
            AND A.SVC_TASK_NUM      = #svcTaskNum#
        GROUP BY
             A.FSR_NUM 
            ,A.FSR_VISIT_NUM 
            ,A.SVC_TASK_NUM 
    </statement>
    <statement id="getIwrRgtnCond" parameterClass="Map" resultClass="String">
        SELECT
            A.IWR_LAST_COMM_TS
        FROM
            IWR_RGTN_COND  A
        WHERE
                A.GLBL_CMPY_CD     = #glblCmpyCd#
            AND A.EZCANCELFLAG     = '0'
            AND A.SVC_MACH_MSTR_PK = #svcMachMstrPk#
            AND A.IWR_DEINS_DT     IS NULL
            AND A.IWR_RGTN_DT      IS NOT NULL
    </statement>
    <statement id="getRecallCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             C.RCLL_COPY_VOL_CNT
        FROM
             SVC_MACH_MSTR    A
            ,SVC_CONFIG_MSTR  B
            ,DS_MDL           C
        WHERE
                A.GLBL_CMPY_CD       = #glblCmpyCd#
            AND A.EZCANCELFLAG       = '0'
            AND A.SVC_MACH_MSTR_PK   = #svcMachMstrPk#
            AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD
            AND A.SVC_CONFIG_MSTR_PK = B.SVC_CONFIG_MSTR_PK
            AND B.EZCANCELFLAG       = '0'
            AND B.GLBL_CMPY_CD       = C.GLBL_CMPY_CD
            AND B.MDL_ID             = C.MDL_ID
            AND C.EZCANCELFLAG       = '0'
    </statement>
    <statement id="getPrevTotMtr" parameterClass="Map" resultClass="Map">
        SELECT
             A.READ_MTR_CNT
            ,A.MTR_READ_DT
            ,C.TOT_MTR_FLG
        FROM 
             SVC_PHYS_MTR_READ  A
            ,SVC_PHYS_MTR       B
            ,MTR_LB             C
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.SVC_MACH_MSTR_PK  = #svcMachMstrPk#
            AND A.SVC_PHYS_MTR_PK   = #svcPhysMtrPk#
            AND A.DS_MTR_READ_TP_GRP_CD
                                    = #dsMtrReadTpGrpCdService#
            AND A.MTR_READ_DT       &lt;= #mtrReadDt#
            AND (   A.FSR_NUM       IS NULL
            
                 <!-- START 2019/12/11 K.Fujimoto [QC#55040, MOD] -->
                 OR (     A.FSR_NUM       &lt;&gt; #fsrNum#
                      AND NOT EXISTS(
                                  SELECT
                                         1
                                    FROM
                                         SVC_TASK D
                                        ,DS_SVC_CALL_TP E
                                   WHERE
                                         D.EZCANCELFLAG      = '0'
                                     AND D.GLBL_CMPY_CD      = A.GLBL_CMPY_CD
                                     AND D.SVC_TASK_NUM      = A.SVC_TASK_NUM
                                     AND E.EZCANCELFLAG      = '0'
                                     AND D.GLBL_CMPY_CD      = E.GLBL_CMPY_CD
                                     AND D.DS_SVC_CALL_TP_CD = E.DS_SVC_CALL_TP_CD
                                     AND E.ONS_SPRT_CALL_FLG = 'Y'
                                )
                    )
                 <!-- END   2019/12/11 K.Fujimoto [QC#55040, MOD] -->
                )
            AND A.VLD_MTR_FLG       = #vldMtrFlgY#
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.SVC_PHYS_MTR_PK   = B.SVC_PHYS_MTR_PK
            AND B.EZCANCELFLAG      = '0'
            AND B.GLBL_CMPY_CD      = C.GLBL_CMPY_CD
            AND B.MDL_MTR_LB_CD     = C.MTR_LB_CD
            AND C.EZCANCELFLAG      = '0'
        ORDER BY
             A.MTR_READ_DT DESC
            ,A.RGTN_MTR_DT DESC
            ,A.SVC_PHYS_MTR_READ_GRP_SQ DESC
    </statement>
    <statement id="getPrtInfo" parameterClass="Map" resultClass="Map">
        SELECT
            <!-- START 2019/12/13 K.Fujimoto [QC#54426,DEL] -->
            <!-- 
             A.BIZ_HRS_SUN_FROM_TM
            ,A.BIZ_HRS_SUN_TO_TM
            ,A.BIZ_HRS_MON_FRI_FROM_TM
            ,A.BIZ_HRS_MON_FRI_TO_TM
            ,A.BIZ_HRS_SAT_FROM_TM
            ,A.BIZ_HRS_SAT_TO_TM
            ,A.FLD_SVC_BR_CD
             -->
            <!-- END   2019/12/13 K.Fujimoto [QC#54426,DEL] -->
            C.FIRST_PROD_CTRL_CD
            <!-- START 2019/12/13 K.Fujimoto [QC#54426,DEL] -->
            <!-- ,D.RSP_TM_UP_MN_AOT  -->
            <!-- END   2019/12/13 K.Fujimoto [QC#54426,DEL] -->
        FROM 
             SVC_MACH_MSTR     A
            <!-- START 2019/12/13 K.Fujimoto [QC#54426,DEL] -->
            <!-- ,SVC_CONFIG_MSTR   B -->
            <!-- END   2019/12/13 K.Fujimoto [QC#54426,DEL] -->
            ,MDSE              C
            <!-- START 2019/12/13 K.Fujimoto [QC#54426,DEL] -->
            <!-- ,DS_MDL            D                       -->
            <!-- END   2019/12/13 K.Fujimoto [QC#54426,DEL] -->
        WHERE
                A.GLBL_CMPY_CD        = #glblCmpyCd#
            AND A.EZCANCELFLAG        = '0'
            AND A.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
            <!-- START 2019/12/13 K.Fujimoto [QC#54426,DEL] -->
            <!-- 
            AND A.GLBL_CMPY_CD        = B.GLBL_CMPY_CD
            AND A.SVC_CONFIG_MSTR_PK  = B.SVC_CONFIG_MSTR_PK
            AND B.EZCANCELFLAG        = '0'
            -->
            <!-- END   2019/12/13 K.Fujimoto [QC#54426,DEL] -->
            AND A.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
            AND A.MDSE_CD             = C.MDSE_CD
            AND C.EZCANCELFLAG        = '0'
            <!-- START 2019/12/13 K.Fujimoto [QC#54426,DEL] -->
            <!--
            AND B.GLBL_CMPY_CD        = D.GLBL_CMPY_CD
            AND B.MDL_ID              = D.MDL_ID
            AND D.EZCANCELFLAG        = '0'
            -->
            <!-- END   2019/12/13 K.Fujimoto [QC#54426,DEL] -->
    </statement>
    <statement id="getSupplTask" parameterClass="Map" resultMap="result.SVC_SUPPL_TASKTMsg">
        SELECT
             A.SVC_SUPPL_FROM_DT
            ,A.SVC_SUPPL_FROM_TM
            ,A.SVC_SUPPL_TO_DT
            ,A.SVC_SUPPL_TO_TM
            ,A.SVC_SUPPL_TM_NUM
            ,A.SVC_TRVL_TM_NUM
            ,A.DURN_TM_NUM
        FROM 
             SVC_SUPPL_TASK     A
            ,SVC_SUPPL_TASK_TP  B
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.EZCANCELFLAG         = '0'
            <!-- START 2021/09/10 R.Cabral [QC#58979, DEL] -->
            <!-- AND A.FSR_NUM              = #fsrNum# -->
            <!-- END   2021/09/10 R.Cabral [QC#58979, DEL] -->
            AND A.SVC_TASK_NUM         = #svcTaskNum#
            AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD
            AND A.SVC_SUPPL_TASK_TP_CD = B.SVC_SUPPL_TASK_TP_CD
            AND B.EZCANCELFLAG         = '0'
            AND B.SVC_ITRPT_FLG        = #svcItrptFlgY#
            <!-- START 2021/09/10 R.Cabral [QC#58979, ADD] -->
            AND B.EXCL_LBOR_FLG        = #exclLborFlg#
            <!-- END   2021/09/10 R.Cabral [QC#58979, ADD] -->
        ORDER BY
             A.SVC_SUPPL_FROM_DT ASC
            ,A.SVC_SUPPL_FROM_TM ASC
            ,A.SVC_SUPPL_TO_DT ASC
            ,A.SVC_SUPPL_TO_TM ASC
    </statement>
    <statement id="getSvcInvCnt" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*) AS COUNT
        FROM 
            SVC_INV  A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.FSR_NUM           = #fsrNum#
            AND A.FSR_VISIT_NUM     = #fsrVisitNum#
    </statement>
    <statement id="getSvcPhysMtrReadList" parameterClass="Map" resultClass="Map">
        SELECT
             A.SVC_PHYS_MTR_READ_PK
            ,A.READ_MTR_CNT
        FROM 
            SVC_PHYS_MTR_READ A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.SVC_MACH_MSTR_PK  = #svcMachMstrPk#
            AND A.SVC_PHYS_MTR_PK   = #svcPhysMtrPk#
            AND A.FSR_NUM           = #fsrNum#
            AND A.FSR_VISIT_NUM     = #fsrVisitNum#
            AND A.VLD_MTR_FLG       = #vldMtrFlgY#
        ORDER BY
             A.MTR_READ_DT ASC
            ,A.RGTN_MTR_DT ASC
            ,A.SVC_PHYS_MTR_READ_GRP_SQ ASC
    </statement>
    <statement id="getSvcTaskNumByStsCd" parameterClass="Map" resultClass="String">
        SELECT
            A.SVC_TASK_NUM
        FROM
            SVC_TASK  A
        WHERE
                A.GLBL_CMPY_CD     = #glblCmpyCd#
            AND A.EZCANCELFLAG     = '0'
            AND A.FSR_NUM          = #fsrNum#
            <isNotNull property="svcTaskNum">
            AND A.SVC_TASK_NUM     = #svcTaskNum#
            </isNotNull>
            <isNotNull property="svcTaskNumEx">
            AND A.SVC_TASK_NUM     &lt;&gt; #svcTaskNumEx#
            </isNotNull>
            <iterate property="svcTaskStsList" var="svcTaskSts[]" open="AND A.SVC_TASK_STS_CD NOT IN (" close=")" conjunction=",">
                #svcTaskSts[]#
            </iterate>
        ORDER BY
             A.SVC_TASK_RCV_DT ASC
            ,A.SVC_TASK_RCV_TM ASC
    </statement>
    <statement id="getSvcTaskRcvDt" parameterClass="Map" resultClass="String">
        SELECT
            A.SVC_TASK_RCV_DT
        FROM
            SVC_TASK  A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.SVC_MACH_MSTR_PK  = #svcMachMstrPk#
            AND A.DS_SVC_CALL_TP_CD = #dsSvcCallTpSystem#
            <iterate property="svcTaskStsList" var="svcTaskSts[]" open="AND A.SVC_TASK_STS_CD NOT IN (" close=")" conjunction=",">
                #svcTaskSts[]#
            </iterate>
    </statement>
    <statement id="getTocCd" parameterClass="Map" resultClass="String">
        SELECT
            TOC_CD
        FROM(
            SELECT
                B.TOC_CD
            FROM
                 ORG_FUNC_ASG     A
                ,TOC              B
                ,ORG_FUNC_ROLE_TP C
            WHERE
                    A.GLBL_CMPY_CD        = #glblCmpyCd#
                AND A.EZCANCELFLAG        = '0'
                AND A.PSN_CD              = #psnCd#
                AND A.EFF_FROM_DT         &lt;= #slsDt#
                AND NVL(A.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
                AND A.GLBL_CMPY_CD        = B.GLBL_CMPY_CD
                AND A.TOC_CD              = B.TOC_CD
                AND A.EZCANCELFLAG        = '0'
                AND C.GLBL_CMPY_CD        = B.GLBL_CMPY_CD
                AND C.ORG_FUNC_ROLE_TP_CD = B.ORG_FUNC_ROLE_TP_CD
                AND C.TECH_MSTR_REQ_FLG   = 'Y'
                AND C.EZCANCELFLAG        = '0'
            ORDER BY
                C.MGR_FLG ASC, C.ORG_FUNC_ROLE_TP_SORT_NUM ASC
            )
        WHERE
            ROWNUM = 1
    </statement>
    <statement id="getTotMtrFlg" parameterClass="Map" resultClass="Map">
        SELECT
             A.SVC_PHYS_MTR_PK
            ,B.MTR_LB_CD
            ,B.TOT_MTR_FLG
<!-- add start 2018/06/29 QC#26795 -->
            ,POWER(10, A.CNTR_DIGIT_NUM) ROLL_OVER_CNT
<!-- add end 2018/06/29 QC#26795 -->
        FROM 
             SVC_PHYS_MTR  A
            ,MTR_LB        B
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.SVC_MACH_MSTR_PK  = #svcMachMstrPk#
            <isNotNull property="mtrLbCd">
            AND A.MDL_MTR_LB_CD     = #mtrLbCd#
            </isNotNull>
            <isNotNull property="svcPhysMtrPk">
            AND A.SVC_PHYS_MTR_PK   = #svcPhysMtrPk#
            </isNotNull>
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.MDL_MTR_LB_CD     = B.MTR_LB_CD
            AND B.EZCANCELFLAG      = '0'
    </statement>
    <statement id="getExchRateData" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            B.ACTL_EXCH_RATE
        FROM
            CCY A,
            ACCT_DLY_ACTL_EXCH_RATES B
        WHERE
            A.GLBL_CMPY_CD = #glblCmpyCd#
            AND A.CCY_CD = #ccyCd#
            AND A.EZCANCELFLAG = '0'
            AND B.GLBL_CMPY_CD = A.GLBL_CMPY_CD
            AND B.CCY_CD = A.CCY_CD
            AND B.ACTL_EXCH_RATE_ENT_DT &lt;= #slsDt#
            AND B.ACTL_EXCH_RATE IS NOT NULL
            AND B.EZCANCELFLAG = '0'

        ORDER BY
            B.ACTL_EXCH_RATE_ENT_DT DESC
    </statement>
    <statement id="getLborFsrVisitTask" parameterClass="Map" resultClass="Map">
        SELECT
            A.SVC_TASK_NUM
            ,A.SVC_LBOR_TM_NUM
            ,A.FSR_VISIT_NUM
            ,B.SVC_LBOR_CHRG_FLG
<!-- START 2018/12/12 [QC#28633, ADD] -->
            ,C.TRVL_CHRG_FLG
<!-- END 2018/12/12 [QC#28633, ADD] -->
        FROM
            FSR_VISIT_TASK A
            ,SVC_TASK B
<!-- START 2018/12/12 [QC#28633, ADD] -->
            ,SVC_BILL_TP C
<!-- END 2018/12/12 [QC#28633, ADD] -->
        WHERE
                A.GLBL_CMPY_CD  = #glblCmpyCd#
            AND A.FSR_NUM       = #fsrNum#
            AND A.EZCANCELFLAG  = '0'
            AND A.GLBL_CMPY_CD  = B.GLBL_CMPY_CD
            AND A.SVC_TASK_NUM  = B.SVC_TASK_NUM
            AND B.SVC_TASK_STS_CD &lt;&gt; #svcTaskStsCd#
            AND B.EZCANCELFLAG  = '0'
<!-- START 2018/12/12 [QC#28633, ADD] -->
            AND B.GLBL_CMPY_CD   = C.GLBL_CMPY_CD
            AND B.SVC_BILL_TP_CD = C.SVC_BILL_TP_CD
            AND C.EZCANCELFLAG   = '0'
<!-- END 2018/12/12 [QC#28633, ADD] -->
    </statement>
    <statement id="getToc" parameterClass="Map" resultClass="String">
        SELECT
            A.TOC_CD
        FROM
            ORG_FUNC_ASG A
        WHERE
                A.GLBL_CMPY_CD  = #glblCmpyCd#
            AND A.PSN_CD        = #techCd#
            AND A.EFF_FROM_DT   &lt;= #slsDt#
            AND NVL(A.EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
            AND A.EZCANCELFLAG  = '0'
    </statement>
    <statement id="getDeleteTargetFsrChrgDtl" parameterClass="Map" resultClass="Map">
        SELECT
             A.FSR_CHRG_DTL_PK
            ,A.FSR_NUM
            ,A.FSR_VISIT_NUM
        FROM
            FSR_CHRG_DTL A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.FSR_NUM           = #fsrNum#
            AND A.EZCANCELFLAG      = '0'
            <iterate property="fsrChrgDtlPkList" var="fsrChrgDtlPk[]" open="AND FSR_CHRG_DTL_PK NOT IN (" close=")" conjunction=",">
                #fsrChrgDtlPk[]#
            </iterate>
        ORDER BY
            A.FSR_CHRG_DTL_PK
    </statement>
    <statement id="getInvHeaderInfo" parameterClass="Map" resultClass="Map">
        SELECT
            A.BILL_TO_CUST_CD
            ,A.SELL_TO_CUST_CD
            ,A.SHIP_TO_CUST_CD
            ,A.DS_CONTR_PK
            ,A.PMT_TERM_CASH_DISC_CD
            ,B.SVC_MACH_MSTR_PK
            ,B.SER_NUM
            ,C.MDSE_CD
            ,D.MDL_ID
            ,E.T_MDL_NM
            ,F.DS_CONTR_NUM
        FROM
            FSR_CHRG A
            ,FSR B
            ,SVC_MACH_MSTR C
            ,SVC_CONFIG_MSTR D
            ,MDL_NM E
            ,DS_CONTR F
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.FSR_NUM               = #fsrNum#
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.FSR_NUM               = B.FSR_NUM
            AND B.EZCANCELFLAG          = '0'
            AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND B.SVC_MACH_MSTR_PK      = C.SVC_MACH_MSTR_PK
            AND C.EZCANCELFLAG          = '0'
            AND C.GLBL_CMPY_CD          = D.GLBL_CMPY_CD
            AND C.SVC_CONFIG_MSTR_PK    = D.SVC_CONFIG_MSTR_PK
            AND D.EZCANCELFLAG          = '0'
            AND D.GLBL_CMPY_CD          = E.T_GLBL_CMPY_CD
            AND D.MDL_ID                = E.T_MDL_ID
            AND A.GLBL_CMPY_CD          = F.GLBL_CMPY_CD(+)
            AND A.DS_CONTR_PK           = F.DS_CONTR_PK(+)
            AND F.EZCANCELFLAG(+)       = '0'
    </statement>
    <statement id="getMinVisitTech" parameterClass="Map" resultClass="String">
        SELECT
            NVL(A.TECH_CD, A.SVC_ASG_TECH_CD) AS TECH_CD
        FROM 
            FSR_VISIT A
            ,(
                SELECT
                    MIN(A.FSR_VISIT_NUM) MIN_VISIT_NUM
                FROM
                    FSR_VISIT A
                WHERE
                    A.GLBL_CMPY_CD        = #glblCmpyCd#
                AND A.FSR_NUM             = #fsrNum#
                AND A.FSR_VISIT_STS_CD   &lt;&gt; #cancelled#
                AND A.EZCANCELFLAG        =  '0'
                AND (
                        A.TECH_CD         IS NOT NULL
                    OR  A.SVC_ASG_TECH_CD IS NOT NULL
                    )
            ) MIN_VISIT
        WHERE
            A.GLBL_CMPY_CD  = #glblCmpyCd#
        AND A.FSR_NUM       = #fsrNum#
        AND A.FSR_VISIT_NUM = MIN_VISIT.MIN_VISIT_NUM
        AND A.EZCANCELFLAG  = '0'
    </statement>
    <statement id="getMinPoTask" parameterClass="Map" resultClass="Map">
        SELECT
            A.CUST_PO_NUM
            ,A.CUST_PO_DT
        FROM 
            SVC_TASK A
            ,(
                SELECT
                    MIN(A.CUST_PO_NUM) MIN_PO_NUM
                FROM
                    SVC_TASK A
                WHERE
                    A.GLBL_CMPY_CD      = #glblCmpyCd#
                AND A.FSR_NUM           = #fsrNum#
                AND A.SVC_TASK_STS_CD &lt;&gt; #cancelled#
                AND A.EZCANCELFLAG      = '0'
            ) MIN_PO_TASK
        WHERE
            A.GLBL_CMPY_CD  = #glblCmpyCd#
        AND A.FSR_NUM       = #fsrNum#
        AND A.CUST_PO_NUM = MIN_PO_TASK.MIN_PO_NUM
        AND A.EZCANCELFLAG  = '0'
    </statement>
    <!-- START 2018/09/10 K.Kojima [QC#26149,ADD] -->
    <statement id="getPoFromTE" parameterClass="Map" resultClass="Map">
        SELECT
            TED.CUST_PO_NUM
        FROM
             FSR           F
            ,TEMP_ETTL_DTL TED
        WHERE
                F.GLBL_CMPY_CD     = #glblCmpyCd#
            AND F.FSR_NUM          = #fsrNum#
            AND F.EZCANCELFLAG     = '0'
            AND F.GLBL_CMPY_CD     = TED.GLBL_CMPY_CD
            AND F.TEMP_ETTL_NUM    = TED.TEMP_ETTL_NUM
            AND F.SVC_MACH_MSTR_PK = TED.SVC_MACH_MSTR_PK
            AND TED.CUST_PO_NUM    IS NOT NULL
            AND TED.EZCANCELFLAG   = '0'
    </statement>
    <!-- END 2018/09/10 K.Kojima [QC#26149,ADD] -->
    <statement id="getInvDtlInfo" parameterClass="Map" resultClass="Map">
        SELECT
            A.SVC_INV_CHRG_TP_CD
            ,A.MDSE_CD
            ,A.SVC_CHRG_QTY
            ,A.SVC_CHRG_UNIT_AOT
            ,A.UOM_CD
            ,A.SVC_CHRG_UNIT_AMT
            ,A.SVC_CHRG_DEAL_AMT
            ,A.SVC_CHRG_FUNC_AMT
            ,A.SVC_CHRG_DISC_RATE
            ,A.SVC_CHRG_DEAL_DISC_AMT
            ,A.SLS_REP_TOC_CD
            ,B.SVC_TASK_NUM
            ,B.SVC_TASK_CPLT_DT
            ,B.SVC_TASK_CPLT_TM
        FROM
            FSR_CHRG_DTL A
            ,SVC_TASK B
        WHERE
                A.GLBL_CMPY_CD     = #glblCmpyCd#
            AND A.FSR_NUM          = #fsrNum#
            AND A.EZCANCELFLAG     = '0'
            AND A.GLBL_CMPY_CD     = B.GLBL_CMPY_CD(+)
            AND A.SVC_TASK_NUM     = B.SVC_TASK_NUM(+)
            AND B.EZCANCELFLAG(+)  = '0'
        ORDER BY
            A.SVC_TASK_NUM, A.SVC_INV_CHRG_TP_CD
    </statement>
<!-- START 2017/06/27 N.Arai [QC#19125, MOD] -->
<!--    <statement id="getModsEventCount" parameterClass="Map" resultClass="String">    -->
    <statement id="getModsEventCount" parameterClass="Map" resultClass="Map">
<!-- START 2022/05/25 K.Kitachi [QC#59987, MOD] -->
<!--    SELECT -->
<!--         A.SVC_MOD_PLN_ID -->
            <!-- START 2018/08/20 K.Kitachi [QC#27460, MOD] -->
            <!-- ,B.SVC_MACH_MSTR_PK -->
<!--        ,NVL(B.SVC_MACH_MSTR_PK -->
<!--            ,( -->
<!--                SELECT -->
<!--                    SMM.SVC_MACH_MSTR_PK -->
<!--                FROM -->
<!--                     MDSE_ITEM_FLIP_SET FLP -->
<!--                    ,SVC_MACH_MSTR      SMM -->
<!--                WHERE -->
<!--                        A.GLBL_CMPY_CD   = FLP.GLBL_CMPY_CD -->
<!--                    AND A.MOD_ITEM_TXT   = FLP.MDSE_CD -->
<!--                    <iterate property="mdseItemRelnTpCdList" var="mdseItemRelnTpCd[]" open="AND FLP.MDSE_ITEM_RELN_TP_CD IN (" close=")" conjunction=","> -->
<!--                        #mdseItemRelnTpCd[]# -->
<!--                    </iterate> -->
<!--                    AND FLP.EZCANCELFLAG = '0' -->
<!--                    AND A.GLBL_CMPY_CD   = SMM.GLBL_CMPY_CD -->
<!--                    AND A.SER_NUM_TXT    = SMM.SER_NUM -->
<!--                    AND FLP.RELN_MDSE_CD = SMM.MDSE_CD -->
<!--                    AND SMM.EZCANCELFLAG = '0' -->
<!--            ) -->
<!--        ) SVC_MACH_MSTR_PK -->
            <!-- END 2018/08/20 K.Kitachi [QC#27460, MOD] -->
<!--    FROM -->
<!--        FSR_VISIT_TM_EVENT A -->
<!--        ,SVC_MACH_MSTR B -->
<!--    WHERE -->
<!--            A.GLBL_CMPY_CD      = #glblCmpyCd# -->
<!--        AND A.SVC_TASK_NUM      = #svcTaskNum# -->
<!--        AND A.SVC_TM_EVENT_CD   = #modification# -->
<!--        AND A.EZCANCELFLAG      = '0' -->
<!--        AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD(+) -->
<!--        AND A.SER_NUM_TXT       = B.SER_NUM(+) -->
<!--        AND A.MOD_ITEM_TXT      = B.MDSE_CD(+) -->
<!--        AND B.EZCANCELFLAG(+)   = '0' -->
        SELECT
             A.SVC_MOD_PLN_ID
            ,D.SVC_MACH_MSTR_PK
        FROM
             FSR_VISIT_TM_EVENT A
            ,SVC_TASK           B
            ,SVC_MACH_MSTR      C
            ,SVC_MACH_MSTR      D
        WHERE
                A.GLBL_CMPY_CD       = #glblCmpyCd#
            AND A.SVC_TASK_NUM       = #svcTaskNum#
            AND A.SVC_TM_EVENT_CD    = #modification#
            AND A.EZCANCELFLAG       = '0'
            AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD
            AND A.SVC_TASK_NUM       = B.SVC_TASK_NUM
            AND B.EZCANCELFLAG       = '0'
            AND B.GLBL_CMPY_CD       = C.GLBL_CMPY_CD
            AND B.SVC_MACH_MSTR_PK   = C.SVC_MACH_MSTR_PK
            AND C.EZCANCELFLAG       = '0'
            AND A.GLBL_CMPY_CD       = D.GLBL_CMPY_CD
            AND A.SER_NUM_TXT        = D.SER_NUM
            AND A.MOD_ITEM_TXT       = D.MDSE_CD
            AND C.SVC_CONFIG_MSTR_PK = D.SVC_CONFIG_MSTR_PK
            AND D.EZCANCELFLAG       = '0'
        UNION
        SELECT
             A.SVC_MOD_PLN_ID
            ,D.SVC_MACH_MSTR_PK
        FROM
             FSR_VISIT_TM_EVENT A
            ,MDSE_ITEM_FLIP_SET X
            ,SVC_TASK           B
            ,SVC_MACH_MSTR      C
            ,SVC_MACH_MSTR      D
        WHERE
                A.GLBL_CMPY_CD       = #glblCmpyCd#
            AND A.SVC_TASK_NUM       = #svcTaskNum#
            AND A.SVC_TM_EVENT_CD    = #modification#
            AND A.EZCANCELFLAG       = '0'
            AND A.GLBL_CMPY_CD       = X.GLBL_CMPY_CD
            AND A.MOD_ITEM_TXT       = X.MDSE_CD
            <iterate property="mdseItemRelnTpCdList" var="mdseItemRelnTpCd[]" open="AND X.MDSE_ITEM_RELN_TP_CD IN (" close=")" conjunction=",">
                #mdseItemRelnTpCd[]#
            </iterate>
            AND X.EZCANCELFLAG       = '0'
            AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD
            AND A.SVC_TASK_NUM       = B.SVC_TASK_NUM
            AND B.EZCANCELFLAG       = '0'
            AND B.GLBL_CMPY_CD       = C.GLBL_CMPY_CD
            AND B.SVC_MACH_MSTR_PK   = C.SVC_MACH_MSTR_PK
            AND C.EZCANCELFLAG       = '0'
            AND A.GLBL_CMPY_CD       = D.GLBL_CMPY_CD
            AND A.SER_NUM_TXT        = D.SER_NUM
            AND X.RELN_MDSE_CD       = D.MDSE_CD
            AND C.SVC_CONFIG_MSTR_PK = D.SVC_CONFIG_MSTR_PK
            AND D.EZCANCELFLAG       = '0'
        ORDER BY
             SVC_MOD_PLN_ID
            ,SVC_MACH_MSTR_PK
<!-- END 2022/05/25 K.Kitachi [QC#59987, MOD] -->
    </statement>
<!-- END 2017/06/27 N.Arai [QC#19125, MOD] -->
    <statement id="getStdCcyDigit" parameterClass="Map" resultClass="Integer">
        SELECT
            B.AFT_DECL_PNT_DIGIT_NUM

        FROM
            GLBL_CMPY A,
            CCY B

        WHERE
            A.GLBL_CMPY_CD = #glblCmpyCd#
            AND A.EZCANCELFLAG = '0'
            AND B.GLBL_CMPY_CD = A.GLBL_CMPY_CD
            AND B.CCY_CD = A.STD_CCY_CD
            AND B.EZCANCELFLAG = '0'
    </statement>
    <statement id="getMtrReqMdlFlg" parameterClass="Map" resultClass="String">
        SELECT
             C.MTR_REQ_MDL_FLG
        FROM
             SVC_MACH_MSTR    A
            ,SVC_CONFIG_MSTR  B
            ,DS_MDL           C
        WHERE
                A.GLBL_CMPY_CD       = #glblCmpyCd#
            AND A.EZCANCELFLAG       = '0'
            AND A.SVC_MACH_MSTR_PK   = #svcMachMstrPk#
            AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD
            AND A.SVC_CONFIG_MSTR_PK = B.SVC_CONFIG_MSTR_PK
            AND B.EZCANCELFLAG       = '0'
            AND B.GLBL_CMPY_CD       = C.GLBL_CMPY_CD
            AND B.MDL_ID             = C.MDL_ID
            AND C.EZCANCELFLAG       = '0'
    </statement>
    <statement id="getShipToInfo" parameterClass="Map" resultClass="Map">
            SELECT
                 SHIP.CTRY_CD
                ,SHIP.POST_CD
            FROM
                 SVC_TASK TASK
                ,FSR
                ,SHIP_TO_CUST SHIP
            WHERE
                TASK.GLBL_CMPY_CD    = #glblCmpyCd#
            AND TASK.SVC_TASK_NUM    = #svcTaskNum#
            AND TASK.EZCANCELFLAG    = '0'
            AND TASK.GLBL_CMPY_CD    = FSR.GLBL_CMPY_CD
            AND TASK.FSR_NUM         = FSR.FSR_NUM
            AND FSR.EZCANCELFLAG     = '0'
            AND ( CASE
                     <!-- START 2022/03/11 [QC#59702, MOD] -->
                     <!-- WHEN FSR.SHIP_TO_CUST_UPD_FLG = 'Y' THEN FSR.SHIP_TO_UPD_CUST_CD -->
                     WHEN FSR.SHIP_TO_UPD_CUST_CD IS NOT NULL THEN FSR.SHIP_TO_UPD_CUST_CD
                     <!-- END   2022/03/11 [QC#59702, MOD] -->
                     ELSE FSR.SHIP_TO_CUST_CD
                 END
                )                    = SHIP.SHIP_TO_CUST_CD
            AND FSR.GLBL_CMPY_CD     = SHIP.GLBL_CMPY_CD
            AND SHIP.EZCANCELFLAG    = '0'
    </statement>
    <statement id="getUpdateCustomerInfo" parameterClass="Map" resultClass="Map">
<!-- START 2017/12/04 U.Kim[QC#19907, DEL] -->
<!--        SELECT -->
<!--             FSR.SHIP_TO_CUST_UPD_FLG -->
<!--            ,FSR.SHIP_TO_UPD_CUST_CD -->
<!--            ,FSR.BILL_TO_CUST_UPD_FLG -->
<!--            ,FSR.BILL_TO_UPD_CUST_CD -->
<!--            ,SHIP.SELL_TO_CUST_CD AS BILL_TO_ACCT_NUM -->
<!--            ,BILL.SELL_TO_CUST_CD AS CUR_LOC_ACCT_NUM -->
<!--        FROM -->
<!--            FSR -->
<!--            ,SHIP_TO_CUST       SHIP -->
<!--            ,BILL_TO_CUST       BILL -->
<!--        WHERE -->
<!--            FSR.GLBL_CMPY_CD        = #glblCmpyCd# -->
<!--        AND FSR.FSR_NUM             = #fsrNum# -->
<!--        AND FSR.GLBL_CMPY_CD        = SHIP.GLBL_CMPY_CD -->
<!--        AND FSR.SHIP_TO_UPD_CUST_CD = SHIP.SHIP_TO_CUST_CD -->
<!--        AND FSR.GLBL_CMPY_CD        = BILL.GLBL_CMPY_CD -->
<!--        AND FSR.BILL_TO_UPD_CUST_CD = BILL.BILL_TO_CUST_CD -->
<!--        AND FSR.EZCANCELFLAG        = '0' -->
<!--        AND SHIP.EZCANCELFLAG       = '0' -->
<!--        AND BILL.EZCANCELFLAG       = '0' -->
<!-- END 2017/12/04 U.Kim[QC#19907, DEL] -->
<!-- START 2017/12/04 U.Kim[QC#19907, ADD] -->
            SELECT
                 FSR.BILL_TO_CUST_UPD_FLG
                ,FSR.SHIP_TO_CUST_UPD_FLG
                ,NBILL.SELL_TO_CUST_CD || '/' || NBSEL.DS_ACCT_NM AS NEW_BILL_TO_ACCT
                ,NBILL.LOC_NUM         || '/' || NBILL.FIRST_LINE_ADDR
                    || DECODE(NBILL.SCD_LINE_ADDR,   null, '', ' ' || NBILL.SCD_LINE_ADDR)
                    || DECODE(NBILL.THIRD_LINE_ADDR, null, '', ' ' || NBILL.THIRD_LINE_ADDR)
                    || DECODE(NBILL.FRTH_LINE_ADDR,  null, '', ' ' || NBILL.FRTH_LINE_ADDR)
                    || DECODE(NBILL.CTY_ADDR,        null, '', ',' || NBILL.CTY_ADDR)
                    || DECODE(NBILL.ST_CD,           null, '', ',' || NBILL.ST_CD)
                    || DECODE(NBILL.POST_CD,         null, '', ' ' || NBILL.POST_CD)
                                                                  AS NEW_BILL_TO_LOC
                ,NSHIP.SELL_TO_CUST_CD || '/' || NSSEL.DS_ACCT_NM AS NEW_SHIP_TO_ACCT
                ,NSHIP.LOC_NUM         || '/' || NSHIP.FIRST_LINE_ADDR
                    || DECODE(NSHIP.SCD_LINE_ADDR,   null, '', ' ' || NSHIP.SCD_LINE_ADDR)
                    || DECODE(NSHIP.THIRD_LINE_ADDR, null, '', ' ' || NSHIP.THIRD_LINE_ADDR)
                    || DECODE(NSHIP.FRTH_LINE_ADDR,  null, '', ' ' || NSHIP.FRTH_LINE_ADDR)
                    || DECODE(NSHIP.CTY_ADDR,        null, '', ',' || NSHIP.CTY_ADDR)
                    || DECODE(NSHIP.ST_CD,           null, '', ',' || NSHIP.ST_CD)
                    || DECODE(NSHIP.POST_CD,         null, '', ' ' || NSHIP.POST_CD)
                                                                  AS NEW_SHIP_TO_LOC
                ,OBILL.SELL_TO_CUST_CD || '/' || OBSEL.DS_ACCT_NM AS OLD_BILL_TO_ACCT
                ,OBILL.LOC_NUM         || '/' || OBILL.FIRST_LINE_ADDR
                    || DECODE(OBILL.SCD_LINE_ADDR,   null, '', ' ' || OBILL.SCD_LINE_ADDR)
                    || DECODE(OBILL.THIRD_LINE_ADDR, null, '', ' ' || OBILL.THIRD_LINE_ADDR)
                    || DECODE(OBILL.FRTH_LINE_ADDR,  null, '', ' ' || OBILL.FRTH_LINE_ADDR)
                    || DECODE(OBILL.CTY_ADDR,        null, '', ',' || OBILL.CTY_ADDR)
                    || DECODE(OBILL.ST_CD,           null, '', ',' || OBILL.ST_CD)
                    || DECODE(OBILL.POST_CD,         null, '', ' ' || OBILL.POST_CD)
                                                                  AS OLD_BILL_TO_LOC
                ,OSHIP.SELL_TO_CUST_CD || '/' || OSSEL.DS_ACCT_NM AS OLD_SHIP_TO_ACCT
                ,OSHIP.LOC_NUM         || '/' || OSHIP.FIRST_LINE_ADDR
                    || DECODE(OSHIP.SCD_LINE_ADDR,   null, '', ' ' || OSHIP.SCD_LINE_ADDR)
                    || DECODE(OSHIP.THIRD_LINE_ADDR, null, '', ' ' || OSHIP.THIRD_LINE_ADDR)
                    || DECODE(OSHIP.FRTH_LINE_ADDR,  null, '', ' ' || OSHIP.FRTH_LINE_ADDR)
                    || DECODE(OSHIP.CTY_ADDR,        null, '', ',' || OSHIP.CTY_ADDR)
                    || DECODE(OSHIP.ST_CD,           null, '', ',' || OSHIP.ST_CD)
                    || DECODE(OSHIP.POST_CD,         null, '', ' ' || OSHIP.POST_CD)
                                                                  AS OLD_SHIP_TO_LOC
            FROM
                FSR
                ,SHIP_TO_CUST       NSHIP
                ,BILL_TO_CUST       NBILL
                ,SELL_TO_CUST       NSSEL
                ,SELL_TO_CUST       NBSEL
                ,SHIP_TO_CUST       OSHIP
                ,BILL_TO_CUST       OBILL
                ,SELL_TO_CUST       OSSEL
                ,SELL_TO_CUST       OBSEL
            WHERE
                FSR.GLBL_CMPY_CD        = #glblCmpyCd#
            AND FSR.FSR_NUM             = #fsrNum#
            AND FSR.GLBL_CMPY_CD        = NBILL.GLBL_CMPY_CD(+)
            AND FSR.BILL_TO_UPD_CUST_CD = NBILL.BILL_TO_CUST_CD(+)
            AND FSR.GLBL_CMPY_CD        = NSHIP.GLBL_CMPY_CD(+)
            AND FSR.SHIP_TO_UPD_CUST_CD = NSHIP.SHIP_TO_CUST_CD(+)
            AND NBILL.GLBL_CMPY_CD      = NBSEL.GLBL_CMPY_CD(+)
            AND NBILL.SELL_TO_CUST_CD   = NBSEL.SELL_TO_CUST_CD(+)
            AND NSHIP.GLBL_CMPY_CD      = NSSEL.GLBL_CMPY_CD(+)
            AND NSHIP.SELL_TO_CUST_CD   = NSSEL.SELL_TO_CUST_CD(+)
            AND FSR.GLBL_CMPY_CD        = OBILL.GLBL_CMPY_CD(+)
            AND FSR.BILL_TO_CUST_CD     = OBILL.BILL_TO_CUST_CD(+)
            AND FSR.GLBL_CMPY_CD        = OSHIP.GLBL_CMPY_CD(+)
            AND FSR.SHIP_TO_CUST_CD     = OSHIP.SHIP_TO_CUST_CD(+)
            AND OBILL.GLBL_CMPY_CD      = OBSEL.GLBL_CMPY_CD(+)
            AND OBILL.SELL_TO_CUST_CD   = OBSEL.SELL_TO_CUST_CD(+)
            AND OSHIP.GLBL_CMPY_CD      = OSSEL.GLBL_CMPY_CD(+)
            AND OSHIP.SELL_TO_CUST_CD   = OSSEL.SELL_TO_CUST_CD(+)
            AND FSR.EZCANCELFLAG        = '0'
            AND NSHIP.EZCANCELFLAG(+)   = '0'
            AND NBILL.EZCANCELFLAG(+)   = '0'
            AND NSSEL.EZCANCELFLAG(+)   = '0'
            AND NBSEL.EZCANCELFLAG(+)   = '0'
            AND OSHIP.EZCANCELFLAG(+)   = '0'
            AND OBILL.EZCANCELFLAG(+)   = '0'
            AND OSSEL.EZCANCELFLAG(+)   = '0'
            AND OBSEL.EZCANCELFLAG(+)   = '0'
<!-- END 2017/12/04 U.Kim[QC#19907, ADD] -->
    </statement>

    <resultMap id="result.FSR_VISITTMsg" class="FSR_VISITTMsg">
        <result property="svcLborDealAmt"         column="SVC_LBOR_DEAL_AMT"           javaType="EZDTBigDecimalItem"/>
        <result property="svcLborFuncAmt"         column="SVC_LBOR_FUNC_AMT"           javaType="EZDTBigDecimalItem"/>
        <result property="svcLborDealDiscAmt"     column="SVC_LBOR_DEAL_DISC_AMT"      javaType="EZDTBigDecimalItem"/>
        <result property="svcLborFuncDiscAmt"     column="SVC_LBOR_FUNC_DISC_AMT"      javaType="EZDTBigDecimalItem"/>
        <result property="svcLborInvDealAmt"      column="SVC_LBOR_INV_DEAL_AMT"       javaType="EZDTBigDecimalItem"/>
        <result property="svcLborInvFuncAmt"      column="SVC_LBOR_INV_FUNC_AMT"       javaType="EZDTBigDecimalItem"/>
        <result property="svcLborInvDealDiscAmt"  column="SVC_LBOR_INV_DEAL_DISC_AMT"  javaType="EZDTBigDecimalItem"/>
        <result property="svcLborInvFuncDiscAmt"  column="SVC_LBOR_INV_FUNC_DISC_AMT"  javaType="EZDTBigDecimalItem"/>
        <result property="svcTrvlDealAmt"         column="SVC_TRVL_DEAL_AMT"           javaType="EZDTBigDecimalItem"/>
        <result property="svcTrvlFuncAmt"         column="SVC_TRVL_FUNC_AMT"           javaType="EZDTBigDecimalItem"/>
        <result property="svcTrvlDealDiscAmt"     column="SVC_TRVL_DEAL_DISC_AMT"      javaType="EZDTBigDecimalItem"/>
        <result property="svcTrvlFuncDiscAmt"     column="SVC_TRVL_FUNC_DISC_AMT"      javaType="EZDTBigDecimalItem"/>
        <result property="svcPrtDealAmt"          column="SVC_PRT_DEAL_AMT"            javaType="EZDTBigDecimalItem"/>
        <result property="svcPrtFuncAmt"          column="SVC_PRT_FUNC_AMT"            javaType="EZDTBigDecimalItem"/>
        <result property="svcPrtDealDiscAmt"      column="SVC_PRT_DEAL_DISC_AMT"       javaType="EZDTBigDecimalItem"/>
        <result property="svcPrtFuncDiscAmt"      column="SVC_PRT_FUNC_DISC_AMT"       javaType="EZDTBigDecimalItem"/>
        <result property="svcExpDealAmt"          column="SVC_EXP_DEAL_AMT"            javaType="EZDTBigDecimalItem"/>
        <result property="svcExpFuncAmt"          column="SVC_EXP_FUNC_AMT"            javaType="EZDTBigDecimalItem"/>
        <result property="svcExpDealDiscAmt"      column="SVC_EXP_DEAL_DISC_AMT"       javaType="EZDTBigDecimalItem"/>
        <result property="svcExpFuncDiscAmt"      column="SVC_EXP_FUNC_DISC_AMT"       javaType="EZDTBigDecimalItem"/>
    </resultMap>
    <resultMap id="result.SVC_SUPPL_TASKTMsg" class="SVC_SUPPL_TASKTMsg">
        <result property="svcSupplFromDt"         column="SVC_SUPPL_FROM_DT"           javaType="EZDTStringItem" />
        <result property="svcSupplFromTm"         column="SVC_SUPPL_FROM_TM"           javaType="EZDTStringItem" />
        <result property="svcSupplToDt"           column="SVC_SUPPL_TO_DT"             javaType="EZDTStringItem" />
        <result property="svcSupplToTm"           column="SVC_SUPPL_TO_TM"             javaType="EZDTStringItem" />
        <result property="svcSupplTmNum"          column="SVC_SUPPL_TM_NUM"            javaType="EZDTBigDecimalItem" />
        <result property="svcTrvlTmNum"           column="SVC_TRVL_TM_NUM"             javaType="EZDTBigDecimalItem" />
        <result property="durnTmNum"              column="DURN_TM_NUM"                 javaType="EZDTBigDecimalItem" />
    </resultMap>
<!-- START 2016/10/03 T.Tomita [QC#11896, ADD] -->
    <statement id="getHoldData" parameterClass="Map" resultClass="Map">
        SELECT
             C.HLD_PK
            ,C.HLD_RSN_CD
            ,C.CPO_ORD_NUM
            ,C.CPO_DTL_LINE_NUM
            ,C.CPO_DTL_LINE_SUB_NUM
        FROM
             SVC_TASK        A
            ,DS_CPO_RTRN_DTL B
            ,HLD             C
            ,HDD_RMV         D
        WHERE
                A.GLBL_CMPY_CD             = #glblCmpyCd#
            AND A.EZCANCELFLAG             = '0'
            AND A.SVC_MACH_MSTR_PK         = #svcMachMstrPk#
            AND A.SVC_TASK_STS_CD          = #svcTaskStsCd#
            AND A.GLBL_CMPY_CD             = B.GLBL_CMPY_CD
            AND A.SVC_MACH_MSTR_PK         = B.SVC_MACH_MSTR_PK
            AND B.EZCANCELFLAG             = '0'
            AND B.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
            AND B.CPO_ORD_NUM              = C.CPO_ORD_NUM
            AND B.DS_CPO_RTRN_LINE_NUM     = C.CPO_DTL_LINE_NUM
            AND B.DS_CPO_RTRN_LINE_SUB_NUM = C.CPO_DTL_LINE_SUB_NUM
            AND C.EZCANCELFLAG             = '0'
            AND C.TRX_SRC_TP_CD            = #trxSrcTpCd#
            AND C.REL_FLG                  = 'N'
            AND B.GLBL_CMPY_CD             = D.GLBL_CMPY_CD
            AND B.HDD_RMV_CD               = D.HDD_RMV_CD
            AND C.HLD_RSN_CD               = D.HLD_RSN_CD
            AND D.EZCANCELFLAG             = '0'
    </statement>
<!-- END 2016/10/03 T.Tomita [QC#11896, ADD] -->
    <statement id="getFsrVisitTmEvent" parameterClass="Map" resultClass="BigDecimal">
        SELECT
                A.FSR_VISIT_TM_EVENT_PK
        FROM
                FSR_VISIT_TM_EVENT A
                ,SVC_TM_EVENT B
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.FSR_NUM           = #fsrNum#
            AND A.FSR_VISIT_NUM     = #fsrVisitNum#
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND B.EZCANCELFLAG      = '0'
            AND A.SVC_TM_EVENT_CD   = B.SVC_TM_EVENT_CD
            <isEqual property="lborEvent" compareValue="Y">
                AND B.INCL_LBOR_TM_FLG  = 'Y'
            </isEqual>
            <isEqual property="trvlEvent" compareValue="Y">
                AND B.INCL_TRVL_TM_FLG  = 'Y'
            </isEqual>
        ORDER BY
            A.SVC_TM_EVENT_FROM_DT
            ,A.SVC_TM_EVENT_FROM_TM
    </statement>
<!-- START 2016/12/14 K.Ochiai [QC#15735, ADD] -->
    <statement id="geMailInfo" parameterClass="Map" resultClass="Map">
        SELECT
             A.SER_NUM
            ,A.SVC_MACH_MSTR_PK
            ,C.DS_ACCT_NM
            ,D.FIRST_LINE_ADDR
            ,D.SCD_LINE_ADDR
            ,D.THIRD_LINE_ADDR
            ,D.FRTH_LINE_ADDR
            ,D.CTY_ADDR
            ,D.ST_CD
            ,D.POST_CD
            ,A.CUST_TEL_NUM
            ,A.CUST_TEL_EXTN_NUM
            ,A.SVC_CUST_ATTN_TXT
            ,F.TECH_NM
            ,A.SVC_TASK_NUM
            ,A.SVC_TASK_CPLT_DT
        FROM
            SVC_TASK        A
            ,FSR            B
            ,SELL_TO_CUST   C
            ,SHIP_TO_CUST   D
            ,FSR_VISIT      E
            ,TECH_MSTR      F
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.SVC_TASK_NUM          = #svcTaskNum#
            AND A.FSR_NUM               = B.FSR_NUM
            AND B.BILL_TO_CUST_ACCT_CD  = C.SELL_TO_CUST_CD
            AND B.SHIP_TO_CUST_CD       = D.SHIP_TO_CUST_CD
            AND A.FSR_NUM               = E.FSR_NUM
            AND A.SVC_TASK_NUM          = E.SVC_TASK_NUM
            AND E.TECH_CD               = F.TECH_TOC_CD
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND B.GLBL_CMPY_CD          = D.GLBL_CMPY_CD
            AND A.GLBL_CMPY_CD          = E.GLBL_CMPY_CD
            AND E.GLBL_CMPY_CD          = F.GLBL_CMPY_CD
            AND B.EZCANCELFLAG          = '0'
            AND C.EZCANCELFLAG          = '0'
            AND D.EZCANCELFLAG          = '0'
            AND E.EZCANCELFLAG          = '0'
            AND F.EZCANCELFLAG          = '0'
    </statement>
<!-- END 2016/12/14 K.Ochiai [QC#15735, ADD] -->
    <statement id="getPhysInvtyFlg" parameterClass="Map" resultClass="String">
        SELECT
            A.PHYS_INVTY_FLG
        FROM
            TECH_PHYS_INVTY_V  A
        WHERE
                A.GLBL_CMPY_CD   = #glblCmpyCd#
            AND A.EZCANCELFLAG   = '0'
            AND A.TECH_TOC_CD    = #techCd#
    </statement>
    <!-- START 2017/07/03 K.Kojima [QC#19732,ADD] -->
    <statement id="getOpenTaskCount" parameterClass="Map" resultClass="BigDecimal">
        SELECT
        	COUNT(*) AS COUNT
        FROM
             SVC_TASK     ST
            ,SVC_TASK_STS STS
        WHERE
                ST.GLBL_CMPY_CD    = #glblCmpyCd#
            AND ST.FSR_NUM         = #fsrNum#
            AND ST.GLBL_CMPY_CD    = STS.GLBL_CMPY_CD
            AND ST.SVC_TASK_STS_CD = STS.SVC_TASK_STS_CD
            AND STS.OPEN_TASK_FLG  = #flgY#
            AND ST.EZCANCELFLAG    = '0'
    </statement>
    <!-- END 2017/07/03 K.Kojima [QC#19732,ADD] -->
<!-- START 2017/10/18 U.Kim [QC#21794, ADD] -->
    <statement id="getSvcModStsBySvcTaskNumAndSvcMachMstrPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            STS.SVC_MOD_STS_PK
        FROM
            SVC_MOD_STS STS
        WHERE
                STS.GLBL_CMPY_CD       = #glblCmpyCd#
            AND STS.SVC_MACH_MSTR_PK   = #svcMachMstrPk#
            AND STS.SVC_TASK_NUM       = #svcTaskNum#
            AND STS.EZCANCELFLAG       = '0'
    </statement>
<!-- END 2017/10/18 U.Kim [QC#21794, ADD] -->
<!-- START 2017/12/04 U.Kim [QC#19907, ADD]-->
    <statement id="getUserIdNm" parameterClass="Map" resultClass="Map">
        SELECT
             USR_ID
            ,USR_NM
        FROM
            (
            SELECT
                 FSRE.FSR_EVENT_EXE_USR_ID                                        AS USR_ID
                ,DECODE(SPSN.PSN_FIRST_NM, NULL, NULL, SPSN.PSN_FIRST_NM)      ||
                 DECODE(SPSN.PSN_MID_NM,   NULL, NULL, ' ' || SPSN.PSN_MID_NM) ||
                 DECODE(SPSN.PSN_LAST_NM,  NULL, NULL, ' ' || SPSN.PSN_LAST_NM)   AS USR_NM
            FROM
                 FSR_EVENT     FSRE
                ,S21_PSN       SPSN
            WHERE
                    FSRE.GLBL_CMPY_CD             = #glblCmpyCd#
                AND FSRE.FSR_NUM                  = #fsrNum#
                AND FSRE.FSR_VISIT_NUM            = #fsrVisitNum#
                AND FSRE.EZCANCELFLAG             = '0'
                AND FSRE.GLBL_CMPY_CD             = SPSN.GLBL_CMPY_CD(+)
                AND FSRE.FSR_EVENT_EXE_USR_ID     = SPSN.PSN_CD(+)
                AND SPSN.EZCANCELFLAG(+)          = '0'
            ORDER BY
                 FSR_EVENT_EXE_TS
                ,SVC_DISPT_EVENT_CD
            )
        WHERE
            ROWNUM = 1
    </statement>
<!-- END 2017/12/04 U.Kim [QC#19907, ADD]-->

<!-- add start 2019/10/24 K.Fujimoto QC#53441 -->
    <statement id="getLatestInSvcPhysMtrReadGrp" parameterClass="Map" resultClass="Map">
    WITH TARGET_MTR AS (
          SELECT
                 DISTINCT SVC_PHYS_MTR_READ_GRP_SQ
            FROM
           (
             SELECT
                    A.SVC_PHYS_MTR_READ_GRP_SQ
                   ,RANK() OVER(PARTITION BY A.SVC_TASK_NUM ORDER BY A.MTR_READ_DT DESC, A.SVC_PHYS_MTR_READ_GRP_SQ DESC) AS RANK
               FROM
                    SVC_PHYS_MTR_READ A
              WHERE
                    A.GLBL_CMPY_CD      = #glblCmpyCd#
                AND A.EZCANCELFLAG      = '0'
                AND A.SVC_MACH_MSTR_PK  = #svcMachMstrPk#
                AND A.SVC_TASK_NUM      = #svcTaskNum#
                AND A.VLD_MTR_FLG       = #vldMtrFlgY#
                AND A.DS_TEST_COPY_CLS_CD = #inMtr#
            )
           WHERE RANK = 1
      )
      SELECT
             MTR.MTR_LB_CD
            <!-- mod start 2019/11/27 QC#54837 -->
            <!-- ,MTR.CNTR_RESET_TP_CD -->
            ,CASE WHEN MTR.CNTR_RESET_TP_CD IS NOT NULL THEN MTR.CNTR_RESET_TP_CD
                  WHEN MTR.DS_MTR_READ_TP_CD = #dsMtrReadTpAdjust# THEN MTR.DS_MTR_READ_TP_CD
             END CNTR_RESET_TP_CD
            <!-- mod end 2019/11/27 QC#54837 -->
        FROM
             SVC_PHYS_MTR_READ MTR
            ,TARGET_MTR TMTR
       WHERE
             MTR.GLBL_CMPY_CD      = #glblCmpyCd#
         AND MTR.EZCANCELFLAG      = '0'
         AND MTR.SVC_PHYS_MTR_READ_GRP_SQ = TMTR.SVC_PHYS_MTR_READ_GRP_SQ
    </statement>
<!-- add end 2019/10/24 K.Fujimoto QC#53441 -->
<!-- add start 2019/08/09 QC#52105 -->
    <statement id="getSvcPhysMtrReadGrpSq" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            DISTINCT A.SVC_PHYS_MTR_READ_GRP_SQ
        FROM 
            SVC_PHYS_MTR_READ A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.SVC_MACH_MSTR_PK  = #svcMachMstrPk#
            AND A.SVC_TASK_NUM      = #svcTaskNum#
            AND A.VLD_MTR_FLG       = #vldMtrFlgY#
            <isNotNull property="dsMtrReadTpCd">
            AND A.DS_MTR_READ_TP_CD = #dsMtrReadTpCd#
            </isNotNull>
        ORDER BY
            A.SVC_PHYS_MTR_READ_GRP_SQ ASC
    </statement>
<!-- add end 2019/08/09 QC#52105 -->
<!-- add start 2019/09/03 QC#52128 -->
    <statement id="getSvcPhysMtrDigitNum" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            CNTR_DIGIT_NUM
        FROM 
            SVC_PHYS_MTR A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.SVC_MACH_MSTR_PK  = #svcMachMstrPk#
            AND A.MDL_MTR_LB_CD     = #mtrLbCd#
    </statement>
<!-- add end 2019/09/03 QC#52128 -->
<!-- add Start 2019/10/15 QC#54115 -->
    <statement id="isFirstVisitDeinsReq" parameterClass="Map" resultClass="String">
        SELECT
            SVC_DEINS_REQ_FLG
        FROM 
            FSR_VISIT FV
           ,DS_SVC_CALL_TP CT
           ,SVC_TASK ST
        WHERE
                FV.GLBL_CMPY_CD      = #glblCmpyCd#
            AND FV.EZCANCELFLAG      = '0'
            AND FV.FSR_NUM           = #fsrNum#
            AND FV.FSR_VISIT_NUM     = '01'
            AND ST.GLBL_CMPY_CD      = FV.GLBL_CMPY_CD
            AND ST.SVC_TASK_NUM      = FV.SVC_TASK_NUM
            AND ST.EZCANCELFLAG      = '0'
            AND ST.GLBL_CMPY_CD      = CT.GLBL_CMPY_CD
            AND ST.DS_SVC_CALL_TP_CD = CT.DS_SVC_CALL_TP_CD
            AND CT.EZCANCELFLAG      = '0'
    </statement>
<!-- add End   2019/10/15 QC#54115 -->
    <!-- START 2019/11/18 K.Fujimoto [QC#53491, ADD] -->
    <statement id="getOnsSprtCallFlg" parameterClass="Map" resultClass="String">
    SELECT
           CALL.ONS_SPRT_CALL_FLG
      FROM
           SVC_TASK TASK
          ,DS_SVC_CALL_TP CALL
     WHERE
           TASK.GLBL_CMPY_CD = #glblCmpyCd#
       AND TASK.EZCANCELFLAG = '0'
       AND TASK.SVC_TASK_NUM = #svcTaskNum#
       AND TASK.DS_SVC_CALL_TP_CD = CALL.DS_SVC_CALL_TP_CD
       AND CALL.EZCANCELFLAG = '0'
    </statement>
    <statement id="isAlreadyCreatedCallFlg" parameterClass="Map" resultClass="String">
    SELECT
           'Y'
      FROM
           SVC_MEMO MEMO
     WHERE
           MEMO.GLBL_CMPY_CD = #glblCmpyCd#
       AND MEMO.EZCANCELFLAG = '0'
       AND MEMO.SVC_TASK_NUM = #svcTaskNum#
       AND MEMO.SVC_CMNT_TXT like #message# || '%'
    </statement>
    <statement id="isRcllFlg" parameterClass="Map" resultClass="String">
    SELECT
           CASE
              WHEN
                   SVC_TASK_CPLT_DT IS NULL
              THEN
                   'N'
              WHEN
                   TO_DATE(#sysDt#, #dateFormat#) - MDL.RCLL_GLBL_INTVL_DAYS_AOT
                      &lt;= TO_DATE(SVC_TASK_CPLT_DT, #dateFormat#)
              THEN
                   'Y'
              ELSE
                   'N'
           END
      FROM
           SVC_MACH_MSTR   SMM
          ,SVC_CONFIG_MSTR SCM
          ,DS_MDL          MDL
          ,(SELECT
                   ST.SVC_MACH_MSTR_PK      AS SVC_MACH_MSTR_PK
                  ,MAX(ST.SVC_TASK_CPLT_DT) AS SVC_TASK_CPLT_DT
              FROM SVC_TASK ST
                  ,DS_SVC_CALL_TP SCT
             WHERE ST.GLBL_CMPY_CD = #glblCmpyCd#
               AND ST.EZCANCELFLAG = '0'
               AND ST.SVC_TASK_CPLT_DT IS NOT NULL
               AND ST.GLBL_CMPY_CD = SCT.GLBL_CMPY_CD
               AND ST.DS_SVC_CALL_TP_CD = SCT.DS_SVC_CALL_TP_CD
               AND SCT.EZCANCELFLAG = '0'
               AND SCT.ONS_SPRT_CALL_FLG = 'N'
               AND ST.SVC_MACH_MSTR_PK = #svcMachMstrPk#
             GROUP BY ST.SVC_MACH_MSTR_PK
            ) TASK
     WHERE
           SMM.GLBL_CMPY_CD              = #glblCmpyCd#
       AND SMM.EZCANCELFLAG              = '0'
       AND SMM.SVC_MACH_MSTR_PK          = #svcMachMstrPk#
       AND SCM.GLBL_CMPY_CD              = SCM.GLBL_CMPY_CD
       AND SMM.SVC_CONFIG_MSTR_PK        = SCM.SVC_CONFIG_MSTR_PK
       AND SCM.EZCANCELFLAG              = '0'
       AND SCM.GLBL_CMPY_CD              = MDL.GLBL_CMPY_CD
       AND SCM.MDL_ID                    = MDL.MDL_ID
       AND MDL.RCLL_GLBL_INTVL_DAYS_AOT IS NOT NULL
       AND MDL.EZCANCELFLAG              = '0'
       AND SMM.SVC_MACH_MSTR_PK          = TASK.SVC_MACH_MSTR_PK(+)
    </statement>
    <!-- END   2019/11/18 K.Fujimoto [QC#53491, ADD] -->
    <!-- add start 2020/04/08 QC#56328 -->
    <statement id="getSvcModSendClickByTaskNum" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.SVC_MOD_SEND_CLICK_PK
        FROM
            SVC_MOD_SEND_CLICK A
        WHERE
                A.GLBL_CMPY_CD     = #glblCmpyCd#
            AND A.SVC_TASK_NUM     = #svcTaskNum#
            AND A.EZCANCELFLAG     = '0'
    </statement>
    <!-- add end 2020/04/08 QC#56328 -->
    <!-- START 2022/04/19 [QC#59911, ADD] -->
    <statement id="countCpltFsrEvent" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)
        FROM
            FSR_EVENT A
        WHERE
                A.GLBL_CMPY_CD       = #glblCmpyCd#
            AND A.EZCANCELFLAG       = '0'
            AND A.SVC_TASK_NUM       = #svcTaskNum#
            AND A.SVC_DISPT_EVENT_CD = #svcDisptEventCd#
    </statement>
    <!-- END   2022/04/19 [QC#59911, ADD] -->
<!-- START 2023/03/13 T.Wada [QC#61217, ADD] -->
    <statement id="checkSvcModStsClosed" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)
        FROM
            SVC_MOD_STS STS
            ,SVC_MOD SMD
        WHERE
                STS.GLBL_CMPY_CD       = #glblCmpyCd#
            AND STS.SVC_MACH_MSTR_PK   = #svcMachMstrPk#
            AND STS.SVC_TASK_NUM       = #svcTaskNum#
            AND STS.SVC_MOD_PROC_STS_CD= #svcModProcStsCd#
            AND STS.SVC_MOD_PK         = SMD.SVC_MOD_PK
            AND SMD.SVC_MOD_PLN_ID     = #svcModPlnId#
            AND STS.EZCANCELFLAG       = '0'
            AND SMD.EZCANCELFLAG       = '0'
    </statement>
<!-- END 2023/03/13 T.Wada [QC#61217, ADD] -->

    <!-- START 2023/07/14 K.Watanabe [QC#61310, ADD] -->
    <statement id="getShowRoomMachineCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             SVC_MACH_MSTR SMM
            ,RTL_SWH       RS
        WHERE
                SMM.EZCANCELFLAG                = '0'
            AND SMM.GLBL_CMPY_CD                = #glblCmpyCd#
            AND SMM.SVC_MACH_TP_CD              = #svcMachTpCd#
            AND SMM.SVC_CONFIG_MSTR_PK          IS NOT NULL
            <iterate property="svcMachMstrStsCdList" var="svcMachMstrStsCd[]" open="AND SMM.SVC_MACH_MSTR_STS_CD IN (" close=")" conjunction=",">
                #svcMachMstrStsCd[]#
            </iterate>
            AND SMM.GLBL_CMPY_CD                = RS.GLBL_CMPY_CD
            AND SMM.SVC_MACH_MSTR_PK            = #svcMachMstrPk#
            AND SMM.CUR_LOC_NUM                 = RS.INVTY_LOC_CD
            AND RS.EZCANCELFLAG                 = '0'
            AND RS.RTL_WH_CATG_CD               = #rtlWhCatgCd#
            AND RS.EFF_FROM_DT                  &lt;= #startDt#
            AND NVL(RS.EFF_THRU_DT, #startDt#)  &gt;= #startDt#
    </statement>
    <!-- END 2023/07/14 K.Watanabe [QC#61310, ADD] -->
 </sqlMap>