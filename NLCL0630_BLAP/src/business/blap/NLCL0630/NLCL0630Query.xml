<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NLCL0630Query">
    <typeAlias alias="NLCL0630CMsg" type="business.blap.NLCL0630.NLCL0630CMsg" />
    <typeAlias alias="NLCL0630SMsg" type="business.blap.NLCL0630.NLCL0630SMsg" />
    <typeAlias alias="NLCL0630_ASMsg" type="business.blap.NLCL0630.NLCL0630_ASMsg" />

    <statement id="getTechnicianName" parameterClass="Map"
        resultClass="Map">
        <!-- START 2023/8/15 G.Quan [QC#61208, MOD] -->
        <!-- 
        SELECT
            TM.TECH_TOC_CD
            ,TM.TECH_NM
        FROM
            TECH_MSTR TM
            ,S21_PSN SP
        WHERE
                TM.GLBL_CMPY_CD                        =    #glblCmpyCd#
            AND TM.TECH_TOC_CD                         =    #techTocCd#
            AND TM.TECH_TOC_CD                         =    SP.PSN_CD
            AND TM.GLBL_CMPY_CD                        =    SP.GLBL_CMPY_CD
        <isNotNull property="userId">
            AND (SP.HR_SUPV_ID                         =    #userId#
                 OR SP.PSN_CD                          =    #userId#)
        </isNotNull>
        -->
<!-- START 2018/12/11 T.Ogura [QC#28755,ADD] -->
            <!-- 
            AND SP.EFF_FROM_DT                     &lt;=    #salesDate#
            AND NVL(SP.EFF_THRU_DT, '99991231')    &gt;=    #salesDate#
            -->
<!-- END   2018/12/11 T.Ogura [QC#28755,ADD] -->
            <!-- 
            AND TM.EZCANCELFLAG                        =    '0'
            AND SP.EZCANCELFLAG                        =    '0'
            -->
        <isNotNull property="userId">
        WITH HR_SUPV AS (
            SELECT LEVEL AS LV, SP.PSN_CD, TRIM(SP.PSN_LAST_NM || ',' || SP.PSN_FIRST_NM || ' ' || SP.PSN_MID_NM) AS PSN_NM, SP.HR_SUPV_ID, SP.HR_SUPV_NM 
            FROM S21_PSN SP
            WHERE
                SP.GLBL_CMPY_CD  = #glblCmpyCd#
            AND SP.EZCANCELFLAG  = '0'
            START WITH SP.PSN_CD = #techTocCd#
            CONNECT BY PRIOR SP.HR_SUPV_ID = SP.PSN_CD
        )
        </isNotNull>
        SELECT
             RW.RTL_WH_CD AS TECH_TOC_CD
            ,RW.RTL_WH_NM AS TECH_NM
        FROM
             RTL_WH  RW
            ,S21_PSN SP
        WHERE
                RW.GLBL_CMPY_CD                        =    #glblCmpyCd#
            AND RW.RTL_WH_CD                           =    #techTocCd#
            AND RW.TECH_TOC_CD                         =    SP.PSN_CD
            AND RW.GLBL_CMPY_CD                        =    SP.GLBL_CMPY_CD
            <isNotNull property="userId">
            AND EXISTS (SELECT 1 FROM HR_SUPV SUPV WHERE SUPV.PSN_CD = #userId#)
            </isNotNull>
            AND SP.EFF_FROM_DT                     &lt;=    #salesDate#
            AND NVL(SP.EFF_THRU_DT, '99991231')    &gt;=    #salesDate#
            AND RW.EZCANCELFLAG                        =    '0'
            AND SP.EZCANCELFLAG                        =    '0'
        <!-- END 2023/8/15 G.Quan [QC#61208, MOD] -->
    </statement>
<!-- START 2018/12/11 T.Ogura [QC#28755,ADD] -->
    <statement id="getLocationName" parameterClass="Map"
        resultClass="Map">
        <!-- START 2023/8/15 G.Quan [QC#61208, MOD] -->
        <!-- 
        SELECT
            RW.RTL_WH_CD
            ,RW.RTL_WH_NM
        FROM
            RTL_WH RW
            ,S21_PSN SP
        WHERE
                RW.GLBL_CMPY_CD                        =    #glblCmpyCd#
            AND RW.RTL_WH_CD                           =    #rtlWhCd#
            AND RW.EFF_FROM_DT                     &lt;=    #salesDate#
            AND NVL(RW.EFF_THRU_DT, '99991231')    &gt;=    #salesDate#
            AND RW.EZCANCELFLAG                        =    '0'
            AND RW.GLBL_CMPY_CD                        =    SP.GLBL_CMPY_CD
            AND RW.TECH_TOC_CD                         =    SP.PSN_CD
        <isNotNull property="userId">
            AND (SP.HR_SUPV_ID                         =    #userId#
                 OR SP.PSN_CD                          =    #userId#)
        </isNotNull>
            AND SP.EFF_FROM_DT                     &lt;=    #salesDate#
            AND NVL(SP.EFF_THRU_DT, '99991231')    &gt;=    #salesDate#
            AND SP.EZCANCELFLAG                        =    '0'
         -->
        <isNotNull property="userId">
        WITH HR_SUPV_OWNER AS (
            SELECT LEVEL AS LV, SP.PSN_CD, TRIM(SP.PSN_LAST_NM || ',' || SP.PSN_FIRST_NM || ' ' || SP.PSN_MID_NM) AS PSN_NM, SP.HR_SUPV_ID, SP.HR_SUPV_NM 
            FROM
                S21_PSN SP
            WHERE
                SP.GLBL_CMPY_CD                        =    #glblCmpyCd#
            AND SP.EZCANCELFLAG                        =    '0'
            AND SP.EFF_FROM_DT                     &lt;=    #salesDate#
            AND NVL(SP.EFF_THRU_DT, '99991231')    &gt;=    #salesDate#
            START WITH SP.PSN_CD = 
                (
                    SELECT
                        RW.TECH_TOC_CD
                    FROM
                        RTL_WH  RW
                    WHERE
                        RW.GLBL_CMPY_CD                        =    #glblCmpyCd#
                    AND RW.EZCANCELFLAG                        =    '0'
                    AND RW.RTL_WH_CD                           =    #rtlWhCd#
                 )
            CONNECT BY PRIOR SP.HR_SUPV_ID = SP.PSN_CD
        )
        </isNotNull>
        SELECT
             RW.RTL_WH_CD
            ,RW.RTL_WH_NM
            ,RW.TECH_TOC_CD
        FROM
             RTL_WH  RW
            ,S21_PSN SP
        WHERE
                RW.GLBL_CMPY_CD                        =    #glblCmpyCd#
            AND RW.RTL_WH_CD                           =    #rtlWhCd#
            AND RW.TECH_TOC_CD                         =    SP.PSN_CD
            AND RW.GLBL_CMPY_CD                        =    SP.GLBL_CMPY_CD
            <isNotNull property="userId">
            AND EXISTS (SELECT 1 FROM HR_SUPV_OWNER SUPV WHERE SUPV.PSN_CD     = #userId#)
            </isNotNull>
            AND SP.EFF_FROM_DT                     &lt;=    #salesDate#
            AND NVL(SP.EFF_THRU_DT, '99991231')    &gt;=    #salesDate#
            AND RW.EZCANCELFLAG                        =    '0'
            AND SP.EZCANCELFLAG                        =    '0'
        <!-- END 2023/8/15 G.Quan [QC#61208, MOD] -->
    </statement>
<!-- END   2018/12/11 T.Ogura [QC#28755,ADD] -->
    <statement id="search" parameterClass="Map" resultMap="result.NLCL0630_ASMsg">
        <!-- START 2023/8/15 G.Quan [QC#61208, ADD] -->
        <isNotNull property="userId">
        WITH HR_SUPV_OWNER AS (
            SELECT LEVEL AS LV, SP.PSN_CD, TRIM(SP.PSN_LAST_NM || ',' || SP.PSN_FIRST_NM || ' ' || SP.PSN_MID_NM) AS PSN_NM, SP.HR_SUPV_ID, SP.HR_SUPV_NM 
            FROM
                S21_PSN SP
            WHERE
                SP.GLBL_CMPY_CD                        =    #glblCmpyCd#
            AND SP.EZCANCELFLAG                        =    '0'
            AND SP.EFF_FROM_DT                     &lt;=    #salesDate#
            AND NVL(SP.EFF_THRU_DT, '99991231')    &gt;=    #salesDate#
            START WITH SP.PSN_CD = 
                (
                    SELECT
                        RW.TECH_TOC_CD
                    FROM
                        RTL_WH  RW
                    WHERE
                        RW.GLBL_CMPY_CD                        =    #glblCmpyCd#
                    AND RW.EZCANCELFLAG                        =    '0'
                    AND RW.RTL_WH_CD                           =    #rtlWhCd#
                 )
            CONNECT BY PRIOR SP.HR_SUPV_ID = SP.PSN_CD
        )
        </isNotNull>
        <!-- END 2023/8/15 G.Quan [QC#61208, ADD] -->
        SELECT
            T1.PHYS_INVTY_NUM
            ,T1.TECH_TOC_CD
            ,T1.TECH_NM
            ,T1.PHYS_INVTY_DT
            ,T1.PHYS_INVTY_CTRL_NM
            ,T1.WH_CD
            ,T1.ADJ_SUBMT_DT
            ,T1.ADJ_GRS_AMT
            ,T1.ADJ_NET_AMT
            ,T1.PHYS_INVTY_STS_CD
            ,T1.PHYS_INVTY_STS_NM
            ,T1.RTL_WH_CATG_DESC_TXT
<!-- START 2018/12/11 T.Ogura [QC#28755,ADD] -->
            ,T1.RTL_WH_CD
            ,T1.RTL_WH_NM
<!-- END   2018/12/11 T.Ogura [QC#28755,ADD] -->
        FROM
            (SELECT
                PIC.PHYS_INVTY_NUM
                ,PIC.TECH_TOC_CD
                ,PIC.TECH_NM
                ,PIC.PHYS_INVTY_DT
                ,PIC.PHYS_INVTY_CTRL_NM
                ,PIC.WH_CD
                ,SUBSTR(PIC.ADJ_SUBMT_TS,1,8) AS ADJ_SUBMT_DT
                ,PIC.ADJ_GRS_AMT
                ,PIC.ADJ_NET_AMT
                ,PIC.PHYS_INVTY_STS_CD
                ,PIC.PHYS_INVTY_STS_NM
                ,RWC.RTL_WH_CATG_DESC_TXT
<!-- START 2018/12/11 T.Ogura [QC#28755,ADD] -->
                ,RW.RTL_WH_CD
                ,RW.RTL_WH_NM
<!-- END   2018/12/11 T.Ogura [QC#28755,ADD] -->
            FROM
                PHYS_INVTY_CTRL PIC
                ,S21_PSN        SP
                ,RTL_SWH        RS
                ,RTL_WH         RW
                ,RTL_WH_CATG    RWC
            WHERE
                    PIC.GLBL_CMPY_CD                       =      #glblCmpyCd#
            <isNotNull property="cMsg.techTocCd">
                AND PIC.TECH_TOC_CD                        =      #cMsg.techTocCd#
            </isNotNull>
            <isNotNull property="cMsg.physInvtyDt_DF">
                AND PIC.PHYS_INVTY_DT                  &gt;=      #cMsg.physInvtyDt_DF#
            </isNotNull>
            <isNotNull property="cMsg.physInvtyDt_DT">
                AND PIC.PHYS_INVTY_DT                  &lt;=      #cMsg.physInvtyDt_DT#
            </isNotNull>
            <isNotNull property="cMsg.physInvtyCtrlNm">
                AND PIC.PHYS_INVTY_CTRL_NM                 LIKE   #cMsg.physInvtyCtrlNm#
            </isNotNull>
                AND PIC.TECH_TOC_CD                        =      SP.PSN_CD
                AND PIC.GLBL_CMPY_CD                       =      SP.GLBL_CMPY_CD
            <isNotNull property="userId">
            <!-- START 2023/8/15 G.Quan [QC#61208, MOD] -->
                <!--
                AND (SP.HR_SUPV_ID                         =      #userId#
                     OR SP.PSN_CD                          =      #userId#)
                -->
                AND EXISTS (SELECT 1 FROM HR_SUPV_OWNER SUPV WHERE SUPV.PSN_CD     = #userId#)
            <!-- END 2023/8/15 G.Quan [QC#61208, MOD] -->
            </isNotNull>
                AND PIC.WH_CD                              =      RS.INVTY_LOC_CD
                AND PIC.GLBL_CMPY_CD                       =      RS.GLBL_CMPY_CD
                AND RS.RTL_WH_CD                           =      RW.RTL_WH_CD
                AND RS.GLBL_CMPY_CD                        =      RW.GLBL_CMPY_CD
            <isNotNull property="coaBrCd">
                AND RW.COA_BR_CD                           =      #coaBrCd#
            </isNotNull>
<!-- START 2018/12/11 T.Ogura [QC#28755,ADD] -->
            <isNotNull property="cMsg.rtlWhCd">
                AND RW.RTL_WH_CD                           =      #cMsg.rtlWhCd#
            </isNotNull>
<!-- END   2018/12/11 T.Ogura [QC#28755,ADD] -->
                AND RW.RTL_WH_CATG_CD                      =      RWC.RTL_WH_CATG_CD
                AND RW.GLBL_CMPY_CD                        =      RWC.GLBL_CMPY_CD
                AND PIC.EZCANCELFLAG                       =      '0'
                AND SP.EZCANCELFLAG                        =      '0'
                AND RS.EZCANCELFLAG                        =      '0'
                AND RW.EZCANCELFLAG                        =      '0'
                AND RWC.EZCANCELFLAG                       =      '0'
            ORDER BY
                PIC.PHYS_INVTY_NUM         ASC
                ,PIC.TECH_TOC_CD           ASC
                ,PIC.PHYS_INVTY_DT         ASC
                ,PIC.PHYS_INVTY_CTRL_NM    ASC
                ,PIC.WH_CD                 ASC
            ) T1
        WHERE
                ROWNUM         &lt;=       #maxRownum#
    </statement>
    <resultMap id="result.NLCL0630_ASMsg" class="NLCL0630_ASMsg">
        <result property="physInvtyNum_A1"              column="PHYS_INVTY_NUM"                javaType="EZDSStringItem"/>
        <result property="techTocCd_A1"                 column="TECH_TOC_CD"                   javaType="EZDSStringItem"/>
        <result property="techNm_A1"                    column="TECH_NM"                       javaType="EZDSStringItem"/>
        <result property="physInvtyDt_A1"               column="PHYS_INVTY_DT"                 javaType="EZDSDateItem"/>
        <result property="physInvtyCtrlNm_A1"           column="PHYS_INVTY_CTRL_NM"            javaType="EZDSStringItem"/>
        <result property="whCd_A1"                      column="WH_CD"                         javaType="EZDSStringItem"/>
        <result property="shipDt_A1"                    column="ADJ_SUBMT_DT"                  javaType="EZDCDateItem"/>
        <result property="adjGrsAmt_A1"                 column="ADJ_GRS_AMT"                   javaType="EZDSBigDecimalItem"/>
        <result property="adjNetAmt_A1"                 column="ADJ_NET_AMT"                   javaType="EZDSBigDecimalItem"/>
        <result property="physInvtyStsCd_A1"            column="PHYS_INVTY_STS_CD"             javaType="EZDSStringItem"/>
        <result property="physInvtyStsNm_A1"            column="PHYS_INVTY_STS_NM"             javaType="EZDSStringItem"/>
        <result property="rtlWhCatgDescTxt_A1"          column="RTL_WH_CATG_DESC_TXT"          javaType="EZDSStringItem"/>
<!-- START 2018/12/11 T.Ogura [QC#28755,ADD] -->
        <result property="rtlWhCd_A1"                   column="RTL_WH_CD"                     javaType="EZDSStringItem"/>
        <result property="rtlWhNm_A1"                   column="RTL_WH_NM"                     javaType="EZDSStringItem"/>
<!-- END   2018/12/11 T.Ogura [QC#28755,ADD] -->
    </resultMap>
<!-- START 2018/12/03 T.Ogura [QC#27978,ADD] -->
    <statement id="getPhysicalInventoryStatusName" parameterClass="Map"
        resultClass="Map">
        SELECT
            PIS.PHYS_INVTY_STS_DESC_TXT
        FROM
            PHYS_INVTY_STS PIS
        WHERE
                PIS.GLBL_CMPY_CD               =  #glblCmpyCd#
            AND PIS.PHYS_INVTY_STS_CD          =  #physInvtyStsCd#
            AND PIS.EZCANCELFLAG               =  '0'
    </statement>
<!-- END   2018/12/03 T.Ogura [QC#27978,ADD] -->
<!-- START 2018/12/03 T.Ogura [QC#27978,ADD] -->
    <statement id="getCountStatus" parameterClass="Map"
        resultClass="Map">
        SELECT
            PIC.PHYS_INVTY_CNT_STS_CD
        FROM
            PHYS_INVTY_CTRL PIC
        WHERE
                PIC.GLBL_CMPY_CD                        =    #glblCmpyCd#
            AND PIC.PHYS_INVTY_NUM                      =    #physInvtyNum#
            AND PIC.EZCANCELFLAG                        =    '0'
            AND ROWNUM                                  =    #rownum#
    </statement>
<!-- END   2018/12/03 T.Ogura [QC#27978,ADD] -->
<!-- START 2018/12/03 T.Ogura [QC#27978,ADD] -->
    <statement id="getPIControlsFromPINumer" parameterClass="Map"
        resultClass="Map">
        SELECT
            PIC.PHYS_INVTY_CTRL_PK
        FROM
            PHYS_INVTY_CTRL PIC
        WHERE
                PIC.GLBL_CMPY_CD                        =    #glblCmpyCd#
            AND PIC.PHYS_INVTY_NUM                      =    #physInvtyNum#
            AND PIC.EZCANCELFLAG                        =    '0'
    </statement>
<!-- END   2018/12/03 T.Ogura [QC#27978,ADD] -->
<!-- START 2018/12/11 T.Ogura [QC#28755,ADD] -->
    <statement id="countSameLocationOpenStatus" parameterClass="Map"
        resultClass="BigDecimal">
        SELECT
            COUNT(1)
        FROM
            PHYS_INVTY_CTRL PIC
            , RTL_SWH       RS
        WHERE
            PIC.GLBL_CMPY_CD          = #glblCmpyCd#
            AND PIC.PHYS_INVTY_STS_CD = #physInvtyStsCd#
            AND PIC.EZCANCELFLAG      = '0'
            AND PIC.GLBL_CMPY_CD      = RS.GLBL_CMPY_CD
            AND PIC.WH_CD             = RS.INVTY_LOC_CD
            AND RS.RTL_WH_CD          = #rtlWhCd#
            AND RS.EZCANCELFLAG       = '0'
    </statement>
<!-- END   2018/12/11 T.Ogura [QC#28755,ADD] -->
</sqlMap>