<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLXProdLineListCreater">

    <statement id="getProduct" parameterClass="Map">
        SELECT
            PROD_CTRL_CD
            , PROD_CTRL_CD || ':' || PROD_CTRL_NM AS PROD_CTRL
            , MDSE_STRU_ELMNT_TP_CD
        FROM
            PROD_CTRL
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
            AND MDSE_STRU_ELMNT_TP_CD = #mdseStruElmntTpCd#
            <iterate property="layerList" var="layerList[]" open="AND PROD_CTRL_CD IN (" close=")" conjunction=",">
                #layerList[]#
            </iterate>
            AND EZCANCELFLAG = '0'
        ORDER BY
            PROD_CTRL_CD ASC
    </statement>

    <statement id="getProductFromPLG" parameterClass="Map">
SELECT
          PROD_CTRL_CD
        , PROD_CTRL_CD || ':' || PROD_CTRL_NM AS PROD_CTRL
        , MDSE_STRU_ELMNT_TP_CD 
    FROM
        PROD_CTRL P 
    WHERE
        GLBL_CMPY_CD              = #glblCmpyCd# 
        AND MDSE_STRU_ELMNT_TP_CD = #mdseStruElmntTpCd# 
        AND EXISTS( 
            SELECT
                      * 
                FROM
                    MDSE_STRU MS 
                WHERE
                    MS.FIRST_PROD_CTRL_CD       = P.PROD_CTRL_CD 
            <isNotNull property="layerList">
            <iterate property="layerList" var="layerList[]"
             open="                   AND MS.ZEROTH_PROD_CTRL_CD IN (" close=")" conjunction=",">
                #layerList[]#
            </iterate>
            </isNotNull>
        ) 
    ORDER BY
        P.PROD_CTRL_CD
    </statement>

</sqlMap>
