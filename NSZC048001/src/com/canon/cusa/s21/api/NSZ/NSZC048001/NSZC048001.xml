<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSZC048001">
    <statement id="getDsMdlConfigPk" parameterClass="Map" resultClass="Map">
        SELECT
            Z.DS_MDL_CONFIG_PK
<!-- START 2018/01/09 U.Kim [QC#23352,ADD] -->
            ,Z.PRNT_MDSE_CD
            ,Z.MDL_ID
<!-- END 2018/01/09 U.Kim [QC#23352,ADD] -->
        FROM
            (
                SELECT
                     DMC.DS_MDL_CONFIG_PK
                    ,DMC.PRNT_MDSE_CD
<!-- START 2018/01/09 U.Kim [QC#23352,ADD] -->
                    ,DMC.MDL_ID
<!-- END 2018/01/09 U.Kim [QC#23352,ADD] -->
                    ,DMC.EFF_FROM_DT
                    ,CASE
                         WHEN DMC.EFF_THRU_DT IS NOT NULL
                             THEN DMC.EFF_THRU_DT
                             ELSE #maxEffThruDt#
                     END AS EFF_THRU_DT
                FROM
                     DS_MDL_CONFIG DMC
                    ,DS_MDL        DM
                WHERE
                        DMC.GLBL_CMPY_CD      =    #glblCmpyCd#
                    AND DMC.EZCANCELFLAG      =    '0'
<!-- START 2017/05/25 K.Kitachi [QC#18642, MOD] -->
                <isEqual property="likeSrchFlg" compareValue="Y">
                    AND DMC.PRNT_MDSE_CD      LIKE #prntMdseCd#
                </isEqual>
                <isEqual property="likeSrchFlg" compareValue="N">
                    AND DMC.PRNT_MDSE_CD      =    #prntMdseCd#
                </isEqual>
<!-- END 2017/05/25 K.Kitachi [QC#18642, MOD] -->
                    AND DMC.DS_MDL_CONFIG_PK  =    DMC.PRNT_CONFIG_PK
                    AND DMC.GLBL_CMPY_CD      =    DM.GLBL_CMPY_CD
                    AND DMC.MDL_ID            =    DM.MDL_ID
                    AND DM.EZCANCELFLAG       =    '0'
                    AND DM.MDL_ACTV_FLG       =    #mdlActvFlg#
<!-- START 2018/01/09 U.Kim [QC#23352,ADD] -->
                <isEqual property="childMode" compareValue="Y">
                    AND EXISTS(
                        SELECT
                            1
                        FROM
                            SVC_MDL_TP SMT
                        WHERE
                                DM.GLBL_CMPY_CD  = SMT.GLBL_CMPY_CD
                            AND DM.SVC_MDL_TP_CD = SMT.SVC_MDL_TP_CD
                            AND SMT.SW_MDL_FLG   = 'Y'
                            AND SMT.EZCANCELFLAG = '0'
                    )
                </isEqual>
<!-- END 2018/01/09 U.Kim [QC#23352,ADD] -->
            ) Z
        WHERE
                Z.EFF_FROM_DT      &lt;= #slsDt#
            AND Z.EFF_THRU_DT      &gt;= #slsDt#
    </statement>
<!-- START 2018/01/09 U.Kim [QC#23352,ADD] -->
    <statement id="getDsMdlConfigPkForChild" parameterClass="Map" resultClass="Map">
        SELECT
             Z.PRNT_MDSE_CD
            ,Z.MDL_ID
            ,Z.DS_MDL_CONFIG_PK
        FROM
            (
                SELECT
                     DMC.PRNT_CONFIG_PK AS DS_MDL_CONFIG_PK
                    ,DM.MDL_ID
                    ,DMC.PRNT_MDSE_CD
                    ,DMC.EFF_FROM_DT
                    ,CASE
                         WHEN DMC.EFF_THRU_DT IS NOT NULL
                             THEN DMC.EFF_THRU_DT
                             ELSE #maxEffThruDt#
                     END AS EFF_THRU_DT
                FROM
                     DS_MDL_CONFIG DMC
                    ,DS_MDL        DM
                WHERE
                        DMC.GLBL_CMPY_CD      =    #glblCmpyCd#
                    AND DMC.EZCANCELFLAG      =    '0'
                <isEqual property="likeSrchFlg" compareValue="Y">
                    AND DMC.CHILD_MDSE_CD     LIKE #childMdseCd#
                </isEqual>
                <isEqual property="likeSrchFlg" compareValue="N">
                    AND DMC.CHILD_MDSE_CD     =    #childMdseCd#
                </isEqual>
                    AND DMC.GLBL_CMPY_CD      =    DM.GLBL_CMPY_CD
                    AND DMC.MDL_ID            =    DM.MDL_ID
                    AND DM.EZCANCELFLAG       =    '0'
                    AND DM.MDL_ACTV_FLG       =    #mdlActvFlg#
                    AND EXISTS(
                        SELECT
                            1
                        FROM
                            SVC_MDL_TP SMT
                        WHERE
                                DM.GLBL_CMPY_CD  = SMT.GLBL_CMPY_CD
                            AND DM.SVC_MDL_TP_CD = SMT.SVC_MDL_TP_CD
                            AND SMT.SW_MDL_FLG   = 'Y'
                            AND SMT.EZCANCELFLAG = '0'
                    )
            ) Z
        WHERE
                Z.EFF_FROM_DT      &lt;= #slsDt#
            AND Z.EFF_THRU_DT      &gt;= #slsDt#
    </statement>
<!-- END 2018/01/09 U.Kim [QC#23352,ADD] -->
    <statement id="getChildMdse" parameterClass="Map" resultClass="Map">
        SELECT
            D.MDL_ID
           ,D.PRNT_MDSE_CD
           ,D.CHILD_MDSE_CD
           ,D.ORD_TAKE_MDSE_CD
        FROM
            (
            SELECT
                C.*
               ,(
                    SELECT
                        COUNT(*)
                    FROM
                        (
<!-- START 2017/05/25 K.Kitachi [QC#18642, MOD] -->
                            SELECT
<!--                            A.MDL_ID           AS MDL_ID -->
<!--                           ,A.PRNT_MDSE_CD     AS PRNT_MDSE_CD -->
<!--                           ,A.CHILD_MDSE_CD    AS CHILD_MDSE_CD -->
<!--                           ,B.ORD_TAKE_MDSE_CD AS ORD_TAKE_MDSE_CD -->
                                A.EFF_FROM_DT      AS EFF_FROM_DT
                               ,CASE
                                    WHEN A.EFF_THRU_DT IS NOT NULL
                                        THEN A.EFF_THRU_DT
                                        ELSE #maxEffThruDt#
                                END AS EFF_THRU_DT
                            FROM
                                DS_MDL_CONFIG A
<!--                           ,ORD_TAKE_MDSE B -->
                            WHERE
                                    A.GLBL_CMPY_CD       = #glblCmpyCd#
                                AND A.PRNT_CONFIG_PK     = C.PRNT_CONFIG_PK
                                AND A.CHILD_MDSE_CD      IS NOT NULL
<!--                            AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD     (+) -->
<!--                            AND SUBSTR(A.CHILD_MDSE_CD, 1, 8) -->
<!--                                                     = B.ORD_TAKE_MDSE_CD (+) -->
<!--                            AND B.EZCANCELFLAG   (+) = '0' -->
<!-- END 2017/05/25 K.Kitachi [QC#18642, MOD] -->
                        ) C
                    WHERE
                            C.EFF_FROM_DT    &lt;= #slsDt#
                        AND C.EFF_THRU_DT    &gt;= #slsDt#
                ) AS CHILD_MDSE_CNT
            FROM
                (
                    SELECT
                        A.MDL_ID           AS MDL_ID
                       ,A.PRNT_CONFIG_PK   AS PRNT_CONFIG_PK
                       ,A.PRNT_MDSE_CD     AS PRNT_MDSE_CD
                       ,A.CHILD_MDSE_CD    AS CHILD_MDSE_CD
                       ,B.ORD_TAKE_MDSE_CD AS ORD_TAKE_MDSE_CD
                       ,A.EFF_FROM_DT      AS EFF_FROM_DT
                       ,CASE
                            WHEN A.EFF_THRU_DT IS NOT NULL
                                THEN A.EFF_THRU_DT
                                ELSE #maxEffThruDt#
                        END AS EFF_THRU_DT
                    FROM
                        DS_MDL_CONFIG A
                       ,ORD_TAKE_MDSE B
                    WHERE
                            A.GLBL_CMPY_CD       = #glblCmpyCd#
                        AND A.PRNT_CONFIG_PK     = #dsMdlConfigPk#
                        AND A.CHILD_MDSE_CD      IS NOT NULL
                        AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD     (+)
<!-- START 2017/05/25 K.Kitachi [QC#18642, MOD] -->
                    <isEqual property="substrSrchFlg" compareValue="Y">
                        AND SUBSTR(A.CHILD_MDSE_CD, 1, 8)
                                                 = B.ORD_TAKE_MDSE_CD (+)
                    </isEqual>
                    <isEqual property="substrSrchFlg" compareValue="N">
<!-- START 2017/06/19 K.Kojima [QC#19234, MOD] -->
<!--                         AND A.CHILD_MDSE_CD      = B.MDSE_CD          (+) -->
                        AND A.CHILD_MDSE_CD      = B.ORD_TAKE_MDSE_CD (+)
<!-- END 2017/06/19 K.Kojima [QC#19234, MOD] -->
                    </isEqual>
<!-- END 2017/05/25 K.Kitachi [QC#18642, MOD] -->
                        AND B.EZCANCELFLAG   (+) = '0'
                ) C
            WHERE
                    C.EFF_FROM_DT    &lt;= #slsDt#
                AND C.EFF_THRU_DT    &gt;= #slsDt#
            ) D
        WHERE
                D.CHILD_MDSE_CNT &lt;= #childMdseCnt#
    </statement>
<!-- START 2018/01/09 U.Kim [QC#23352,ADD] -->
    <statement id="getChildMdseForChildMode" parameterClass="Map" resultClass="Map">
        SELECT
            C.MDL_ID
           ,C.PRNT_MDSE_CD
           ,C.CHILD_MDSE_CD
           ,C.ORD_TAKE_MDSE_CD
        FROM
                (
                    SELECT
                        A.MDL_ID           AS MDL_ID
                       ,A.PRNT_CONFIG_PK   AS PRNT_CONFIG_PK
                       ,A.PRNT_MDSE_CD     AS PRNT_MDSE_CD
                       ,A.CHILD_MDSE_CD    AS CHILD_MDSE_CD
                       ,B.ORD_TAKE_MDSE_CD AS ORD_TAKE_MDSE_CD
                       ,A.EFF_FROM_DT      AS EFF_FROM_DT
                       ,CASE
                            WHEN A.EFF_THRU_DT IS NOT NULL
                                THEN A.EFF_THRU_DT
                                ELSE #maxEffThruDt#
                        END AS EFF_THRU_DT
                    FROM
                        DS_MDL_CONFIG A
                       ,ORD_TAKE_MDSE B
                    WHERE
                            A.GLBL_CMPY_CD       = #glblCmpyCd#
                        AND A.PRNT_CONFIG_PK     = #dsMdlConfigPk#
                        AND A.CHILD_MDSE_CD      IS NOT NULL
                        AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD     (+)
                    <isEqual property="substrSrchFlg" compareValue="Y">
                        AND SUBSTR(A.CHILD_MDSE_CD, 1, 8)
                                                 = B.ORD_TAKE_MDSE_CD (+)
                    </isEqual>
                    <isEqual property="substrSrchFlg" compareValue="N">
                        AND A.CHILD_MDSE_CD      = B.ORD_TAKE_MDSE_CD (+)
                    </isEqual>
                        AND B.EZCANCELFLAG   (+) = '0'
                ) C
            WHERE
                    C.EFF_FROM_DT    &lt;= #slsDt#
                AND C.EFF_THRU_DT    &gt;= #slsDt#
    </statement>
<!-- END 2018/01/09 U.Kim [QC#23352,ADD] -->
    <statement id="getMdlId" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            A.MDL_ID
        FROM
            DS_MDL_CONFIG A
        WHERE
                A.GLBL_CMPY_CD = #glblCmpyCd#
            AND A.EZCANCELFLAG = '0'
            AND A.DS_MDL_CONFIG_PK IN (
                SELECT
                     Z.DS_MDL_CONFIG_PK
                FROM
                    (
                        SELECT
                             DMC.GLBL_CMPY_CD
                            ,DMC.DS_MDL_CONFIG_PK
                            ,DMC.PRNT_MDSE_CD
                            ,DMC.EFF_FROM_DT
                            ,CASE
                                 WHEN DMC.EFF_THRU_DT IS NOT NULL
                                     THEN DMC.EFF_THRU_DT
                                     ELSE #maxEffThruDt#
                             END AS EFF_THRU_DT
                        FROM
                             DS_MDL_CONFIG DMC
                            ,DS_MDL        DM
                        WHERE
                                DMC.GLBL_CMPY_CD      =    #glblCmpyCd#
                            AND DMC.EZCANCELFLAG      =    '0'
<!-- START 2017/05/25 K.Kitachi [QC#18642, MOD] -->
                        <isEqual property="likeSrchFlg" compareValue="Y">
                            AND DMC.PRNT_MDSE_CD      LIKE #prntMdseCd#
                        </isEqual>
                        <isEqual property="likeSrchFlg" compareValue="N">
                            AND DMC.PRNT_MDSE_CD      =    #prntMdseCd#
                        </isEqual>
<!-- END 2017/05/25 K.Kitachi [QC#18642, MOD] -->
                            AND DMC.DS_MDL_CONFIG_PK  =    DMC.PRNT_CONFIG_PK
                            AND DMC.GLBL_CMPY_CD      =    DM.GLBL_CMPY_CD
                            AND DMC.MDL_ID            =    DM.MDL_ID
                            AND DM.EZCANCELFLAG       =    '0'
                            AND DM.MDL_ACTV_FLG       =    #mdlActvFlg#
                    ) Z
                WHERE
                        Z.EFF_FROM_DT      &lt;= #slsDt#
                    AND Z.EFF_THRU_DT      &gt;= #slsDt#
            )
            AND NOT EXISTS (
                SELECT
                    *
                FROM
                    (
                    SELECT
                         B.EFF_FROM_DT
                        ,CASE
                            WHEN B.EFF_THRU_DT IS NOT NULL
                                THEN B.EFF_THRU_DT
                                ELSE #maxEffThruDt#
                         END AS EFF_THRU_DT
                    FROM
                        DS_MDL_CONFIG B
                    WHERE
                            B.GLBL_CMPY_CD   = A.GLBL_CMPY_CD
                        AND B.EZCANCELFLAG   = A.EZCANCELFLAG
                        AND B.PRNT_CONFIG_PK = A.DS_MDL_CONFIG_PK
                        AND B.CHILD_MDSE_CD  IS NOT NULL
                    ) C
                WHERE   
                        C.EFF_FROM_DT &lt;= #slsDt#
                    AND C.EFF_THRU_DT &gt;= #slsDt#
            )
    </statement>
<!-- START 2018/01/09 U.Kim [QC#23352,ADD] -->
    <statement id="countSwMdl" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             DS_MDL     DM
            ,SVC_MDL_TP SMT
        WHERE
                DM.GLBL_CMPY_CD  = #glblCmpyCd#
            AND DM.MDL_ID        = #mdlId#
            AND DM.EZCANCELFLAG  = '0'
            AND DM.GLBL_CMPY_CD  = SMT.GLBL_CMPY_CD
            AND DM.SVC_MDL_TP_CD = SMT.SVC_MDL_TP_CD
            AND SMT.SW_MDL_FLG   = 'Y'
            AND SMT.EZCANCELFLAG = '0'
    </statement>
<!-- END 2018/01/09 U.Kim [QC#23352,ADD] -->
</sqlMap>
