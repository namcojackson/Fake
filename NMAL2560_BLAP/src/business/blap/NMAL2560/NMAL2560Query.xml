<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL2560Query">

    <typeAlias alias="NMAL2560SMsg"    type="business.blap.NMAL2560.NMAL2560SMsg"/>
    <typeAlias alias="NMAL2560_ASMsg"  type="business.blap.NMAL2560.NMAL2560_ASMsg"/>
    <typeAlias alias="NMAL2560_CSMsg"  type="business.blap.NMAL2560.NMAL2560_CSMsg"/>

    <statement id="getSearchList" parameterClass="Map" resultMap="result.getSearchList">
        SELECT
            A.ROW_ID
            ,A.BIZ_AREA_ORG_CD
            ,A.ORG_HRCH_STRU_DFN_NM
            ,A.EFF_FROM_DT
            ,A.EFF_THRU_DT
            ,A.ORG_TIER_CD
            ,A.STRU_DFN_CD
            ,CASE WHEN A.INS_USR_NM IS NOT NULL THEN
            A.EZINUSERID || '(' || A.INS_FIRST_NM || ' ' || A.INS_LAST_NM || ')'
            ELSE A.EZINUSERID END AS CREATED_BY
            ,A.EZINTIME
            ,CASE WHEN A.UPD_USR_NM IS NOT NULL THEN
            A.EZUPUSERID || '(' || A.UPD_FIRST_NM || ' ' || A.UPD_LAST_NM || ')'
            ELSE A.EZUPUSERID END AS LAST_UPDATED_BY
            ,A.EZUPTIME
            ,A.ORG_HRCH_STRU_DFN_PK
            ,A.EZUPTIMEZONE
        FROM
        (
        SELECT
            ROW_NUMBER() OVER(ORDER BY OHSD.BIZ_AREA_ORG_CD) AS ROW_ID
            ,OHSD.BIZ_AREA_ORG_CD        AS BIZ_AREA_ORG_CD
            ,OHSD.ORG_HRCH_STRU_DFN_NM   AS ORG_HRCH_STRU_DFN_NM
            ,OHSD.EFF_FROM_DT            AS EFF_FROM_DT
            ,OHSD.EFF_THRU_DT            AS EFF_THRU_DT
            ,OHSD.ORG_TIER_CD            AS ORG_TIER_CD
            ,OHSD.STRU_DFN_CD            AS STRU_DFN_CD
            ,OHSD.EZINUSERID             AS EZINUSERID
            ,OHSD.EZINTIME               AS EZINTIME
            ,OHSD.EZUPUSERID             AS EZUPUSERID
            ,OHSD.EZUPTIME               AS EZUPTIME
            ,OHSD.ORG_HRCH_STRU_DFN_PK   AS ORG_HRCH_STRU_DFN_PK
            ,OHSD.EZUPTIMEZONE           AS EZUPTIMEZONE
            ,API.USR_NM                  AS INS_USR_NM
            ,API.FIRST_NM                AS INS_FIRST_NM
            ,API.LAST_NM                 AS INS_LAST_NM
            ,APU.USR_NM                  AS UPD_USR_NM
            ,APU.FIRST_NM                AS UPD_FIRST_NM
            ,APU.LAST_NM                 AS UPD_LAST_NM
        FROM
            ORG_HRCH_STRU_DFN  OHSD
            ,BIZ_AREA_ORG      BAO
            ,ORG_TIER          OT
            ,AUTH_PSN          API
            ,AUTH_PSN          APU
        WHERE
            OHSD.GLBL_CMPY_CD     = #glblCmpyCd#
        AND OHSD.EZCANCELFLAG     = '0'
        <isNotNull property="bizAreaOrgCd">
            AND OHSD.BIZ_AREA_ORG_CD = #bizAreaOrgCd#
        </isNotNull>
        <isNull property="xxChkBox">
            AND (
              (
                OHSD.EFF_FROM_DT &lt;= #salesDate#
                AND NVL(OHSD.EFF_THRU_DT, '99991231') &gt;= #salesDate#
              )
              OR OHSD.EFF_FROM_DT &gt;= #salesDate#
            )
        </isNull>
        AND OHSD.GLBL_CMPY_CD    = BAO.GLBL_CMPY_CD
        AND OHSD.EZCANCELFLAG    = BAO.EZCANCELFLAG
        AND OHSD.BIZ_AREA_ORG_CD = BAO.BIZ_AREA_ORG_CD
        
        AND OHSD.GLBL_CMPY_CD    = OT.GLBL_CMPY_CD
        AND OHSD.EZCANCELFLAG    = OT.EZCANCELFLAG
        AND OHSD.ORG_TIER_CD     = OT.ORG_TIER_CD
        
        AND OHSD.GLBL_CMPY_CD    = API.GLBL_CMPY_CD(+)
        AND OHSD.EZCANCELFLAG    = API.EZCANCELFLAG(+)
        AND OHSD.EZINUSERID      = API.USR_NM(+)
        
        AND OHSD.GLBL_CMPY_CD    = APU.GLBL_CMPY_CD(+)
        AND OHSD.EZCANCELFLAG    = APU.EZCANCELFLAG(+)
        AND OHSD.EZINUSERID      = APU.USR_NM(+)
        AND OHSD.EZUPUSERID      = APU.USR_NM(+)
        ORDER BY
            BAO.BIZ_AREA_ORG_SORT_NUM ASC
            ,OHSD.EFF_FROM_DT DESC
            ,LPAD(OHSD.ORG_TIER_CD, 2, 0) ASC
        ) A
        <isNotNull property="rowNum">
            WHERE ROWNUM &lt;= #rowNum#
        </isNotNull>
    </statement>

    <resultMap id="result.getSearchList"       class="NMAL2560_CSMsg">
        <result property="xxRowId_C"           column="ROW_ID"                 javaType="EZDSStringItem"/>
        <result property="bizAreaOrgCd_C"      column="BIZ_AREA_ORG_CD"        javaType="EZDSStringItem"/>
        <result property="orgHrchStruDfnNm_C"  column="ORG_HRCH_STRU_DFN_NM"   javaType="EZDSStringItem"/>
        <result property="effFromDt_C"         column="EFF_FROM_DT"            javaType="EZDSStringItem"/>
        <result property="effThruDt_C"         column="EFF_THRU_DT"            javaType="EZDSStringItem"/>
        <result property="orgTierCd_C"         column="ORG_TIER_CD"            javaType="EZDSStringItem"/>
        <result property="struDfnCd_C"         column="STRU_DFN_CD"            javaType="EZDSStringItem"/>
        <result property="xxChkMaxDescTxt_IN"  column="CREATED_BY"             javaType="EZDSStringItem"/>
        <result property="ezInTime_C"          column="EZINTIME"               javaType="EZDSStringItem"/>
        <result property="xxChkMaxDescTxt_UP"  column="LAST_UPDATED_BY"        javaType="EZDSStringItem"/>
        <result property="ezUpTime_C"          column="EZUPTIME"               javaType="EZDSStringItem"/>
        <result property="orgHrchStruDfnPk_C"  column="ORG_HRCH_STRU_DFN_PK"   javaType="EZDSBigDecimalItem"/>
        <result property="ezUpTimeZone_C"      column="EZUPTIMEZONE"           javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="getOrgHrchStruDfnList" parameterClass="Map" resultClass="Map">
        SELECT
            LPAD(OHSD.BIZ_AREA_ORG_CD, 8, 0)  AS BIZ_AREA_ORG_CD
            ,OHSD.EFF_FROM_DT                 AS EFF_FROM_DT
            ,OHSD.EFF_THRU_DT                 AS EFF_THRU_DT
            ,OHSD.ORG_HRCH_STRU_DFN_PK        AS ORG_HRCH_STRU_DFN_PK
        FROM
            ORG_HRCH_STRU_DFN  OHSD
        WHERE
            OHSD.GLBL_CMPY_CD = #glblCmpyCd#
        AND OHSD.ORG_TIER_CD = #orgTierCd#
        AND OHSD.EZCANCELFLAG = '0'
        <iterate property="bizAreaOrgCd" var="elem[]" open="AND (" close=")" conjunction="OR">
            OHSD.BIZ_AREA_ORG_CD = #elem[]#
        </iterate>
    </statement>

</sqlMap>
