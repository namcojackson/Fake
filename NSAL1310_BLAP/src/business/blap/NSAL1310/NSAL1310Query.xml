<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL1310Query">
    <typeAlias alias="NSAL1310_ASMsg" type="business.blap.NSAL1310.NSAL1310_ASMsg"/>

    <statement id="getSearchData" parameterClass="Map" resultMap="result.getSearchData">
        SELECT
             DEF_COV_TERM_COND_PK
            ,SVC_TERM_COND_ATTRB_PK
            ,SVC_COV_TMPL_TP_CD
            ,SVC_TERM_ATTRB_DEF_VAL_TXT
            ,ATTRB_UPD_AVAL_FLG
            ,ASG_CONTR_LVL_FLG
            ,ASG_MACH_LVL_FLG
            ,COV_TERM_COND_ACTV_FLG
            ,EFF_FROM_DT
            ,EFF_THRU_DT
            ,SVC_TERM_ATTRB_DESC_TXT
            ,SVC_TERM_DATA_TP_CD
            ,SVC_TERM_COND_DATA_SRC_CD
            ,PHYS_MAINT_TRGT_TBL_NM
            ,SVC_TERM_ATTRB_SORT_NUM
            ,SVC_TERM_COND_CATG_DESC_TXT
            ,EZUPTIME
            ,EZUPTIMEZONE
            <!-- START 2016/12/01 K.Kojima [QC#14204, ADD] -->
            ,XX_REC_HIST_CRAT_TS_A
            ,XX_REC_HIST_CRAT_BY_NM_A
            ,XX_REC_HIST_UPD_TS_A
            ,XX_REC_HIST_UPD_BY_NM_A
            ,XX_REC_HIST_TBL_NM_A
            <!-- END 2016/12/01 K.Kojima [QC#14204, ADD] -->
        FROM
            (
                SELECT
                     DCTC.DEF_COV_TERM_COND_PK
                    ,DCTC.SVC_TERM_COND_ATTRB_PK
                    ,DCTC.SVC_COV_TMPL_TP_CD
                    ,DCTC.SVC_TERM_ATTRB_DEF_VAL_TXT
                    ,DCTC.ATTRB_UPD_AVAL_FLG
                    ,DCTC.ASG_CONTR_LVL_FLG
                    ,DCTC.ASG_MACH_LVL_FLG
                    ,DCTC.COV_TERM_COND_ACTV_FLG
                    ,DCTC.EFF_FROM_DT
                    ,DCTC.EFF_THRU_DT
                    ,STCA.SVC_TERM_ATTRB_DESC_TXT
                    ,STCA.SVC_TERM_DATA_TP_CD
                    ,STCA.SVC_TERM_COND_DATA_SRC_CD
                    ,STCA.PHYS_MAINT_TRGT_TBL_NM
                    ,STCA.SVC_TERM_ATTRB_SORT_NUM
                    ,STCC.SVC_TERM_COND_CATG_DESC_TXT
                    ,DCTC.EZUPTIME
                    ,DCTC.EZUPTIMEZONE
                    <!-- START 2016/12/01 K.Kojima [QC#14204, ADD] -->
                    ,DCTC.EZINTIME    AS XX_REC_HIST_CRAT_TS_A
                    ,DCTC.EZINUSERID  AS XX_REC_HIST_CRAT_BY_NM_A
                    ,DCTC.EZUPTIME    AS XX_REC_HIST_UPD_TS_A
                    ,DCTC.EZUPUSERID  AS XX_REC_HIST_UPD_BY_NM_A
                    ,DCTC.EZTABLEID   AS XX_REC_HIST_TBL_NM_A
                    <!-- END 2016/12/01 K.Kojima [QC#14204, ADD] -->
                FROM
                     DEF_COV_TERM_COND   DCTC
                    ,SVC_TERM_COND_ATTRB STCA
                    ,SVC_TERM_COND_CATG  STCC
                WHERE
                        DCTC.GLBL_CMPY_CD                       = #glblCmpyCd#
                    AND DCTC.GLBL_CMPY_CD                       = STCA.GLBL_CMPY_CD
                    AND DCTC.SVC_TERM_COND_ATTRB_PK             = STCA.SVC_TERM_COND_ATTRB_PK
                    AND STCA.GLBL_CMPY_CD                       = STCC.GLBL_CMPY_CD(+)
                    AND STCA.SVC_TERM_COND_CATG_PK              = STCC.SVC_TERM_COND_CATG_PK(+)
                    <isNotNull property="svcCovTmplTpCd" >
                    AND DCTC.SVC_COV_TMPL_TP_CD                 = #svcCovTmplTpCd#
                    </isNotNull>
                    <isNotNull property="svcTermAttrbDescTxt" >
                    AND UPPER(STCA.SVC_TERM_ATTRB_DESC_TXT)  LIKE #svcTermAttrbDescTxt#
                    </isNotNull>
                    <isEqual property="archived" compareValue="Y" >
                    AND DCTC.COV_TERM_COND_ACTV_FLG             = #flagY#
                    AND DCTC.EFF_FROM_DT                    &lt;= #salesDate#
                    AND NVL(DCTC.EFF_THRU_DT, #maxDate#)    &gt;= #salesDate#
                    </isEqual>
                    AND STCA.SVC_TERM_ATTRB_ACTV_FLG            = #flagY#
                    AND STCA.EFF_FROM_DT                    &lt;= #salesDate#
                    AND NVL(STCA.EFF_THRU_DT, #maxDate#)    &gt;= #salesDate#
                    AND STCC.SVC_TERM_COND_CATG_ACTV_FLG(+)     = #flagY#
                    AND STCC.EFF_FROM_DT(+)                  &lt;= #salesDate#
                    AND NVL(STCC.EFF_THRU_DT(+), #maxDate#) &gt;= #salesDate#
                    AND DCTC.EZCANCELFLAG                       = '0'
                    AND STCA.EZCANCELFLAG                       = '0'
                    AND STCC.EZCANCELFLAG(+)                    = '0'
                ORDER BY
                     DCTC.SVC_COV_TMPL_TP_CD
                    ,STCA.SVC_TERM_ATTRB_SORT_NUM
                    ,DCTC.EFF_FROM_DT
            )
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <resultMap id="result.getSearchData" class="NSAL1310_ASMsg">
        <result property="defCovTermCondPk_A1"       column="DEF_COV_TERM_COND_PK"        javaType="EZDSBigDecimalItem"/>
        <result property="svcTermCondAttrbPk_A1"     column="SVC_TERM_COND_ATTRB_PK"      javaType="EZDSBigDecimalItem"/>
        <result property="svcCovTmplTpCd_A1"         column="SVC_COV_TMPL_TP_CD"          javaType="EZDSStringItem"/>
        <result property="svcTermAttrbDefValTxt_A1"  column="SVC_TERM_ATTRB_DEF_VAL_TXT"  javaType="EZDSStringItem"/>
        <result property="attrbUpdAvalFlg_A1"        column="ATTRB_UPD_AVAL_FLG"          javaType="EZDSStringItem"/>
        <result property="asgContrLvlFlg_A1"         column="ASG_CONTR_LVL_FLG"           javaType="EZDSStringItem"/>
        <result property="asgMachLvlFlg_A1"          column="ASG_MACH_LVL_FLG"            javaType="EZDSStringItem"/>
        <result property="covTermCondActvFlg_A1"     column="COV_TERM_COND_ACTV_FLG"      javaType="EZDSStringItem"/>
        <result property="effFromDt_A1"              column="EFF_FROM_DT"                 javaType="EZDSDateItem"/>
        <result property="effThruDt_A1"              column="EFF_THRU_DT"                 javaType="EZDSDateItem"/>
        <result property="svcTermAttrbDescTxt_A1"    column="SVC_TERM_ATTRB_DESC_TXT"     javaType="EZDSStringItem"/>
        <result property="svcTermDataTpCd_A1"        column="SVC_TERM_DATA_TP_CD"         javaType="EZDSStringItem"/>
        <result property="svcTermCondDataSrcCd_A1"   column="SVC_TERM_COND_DATA_SRC_CD"   javaType="EZDSStringItem"/>
        <result property="physMaintTrgtTblNm_A1"     column="PHYS_MAINT_TRGT_TBL_NM"      javaType="EZDSStringItem"/>
        <result property="svcTermAttrbSortNum_A1"    column="SVC_TERM_ATTRB_SORT_NUM"     javaType="EZDSBigDecimalItem"/>
        <result property="svcTermCondCatgDescTxt_A1" column="SVC_TERM_COND_CATG_DESC_TXT" javaType="EZDSStringItem"/>
        <result property="ezUpTime_A1"               column="EZUPTIME"                    javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_A1"           column="EZUPTIMEZONE"                javaType="EZDSStringItem"/>
        <result property="svcTermAttrbDefValTxt_BK"  column="SVC_TERM_ATTRB_DEF_VAL_TXT"  javaType="EZDSStringItem"/>
        <result property="attrbUpdAvalFlg_BK"        column="ATTRB_UPD_AVAL_FLG"          javaType="EZDSStringItem"/>
        <result property="asgContrLvlFlg_BK"         column="ASG_CONTR_LVL_FLG"           javaType="EZDSStringItem"/>
        <result property="asgMachLvlFlg_BK"          column="ASG_MACH_LVL_FLG"            javaType="EZDSStringItem"/>
        <result property="covTermCondActvFlg_BK"     column="COV_TERM_COND_ACTV_FLG"      javaType="EZDSStringItem"/>
        <result property="effFromDt_BK"              column="EFF_FROM_DT"                 javaType="EZDSDateItem"/>
        <result property="effThruDt_BK"              column="EFF_THRU_DT"                 javaType="EZDSDateItem"/>
        <!-- START 2016/12/01 K.Kojima [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_A"         column="XX_REC_HIST_CRAT_TS_A"       javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_A"       column="XX_REC_HIST_CRAT_BY_NM_A"    javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_A"          column="XX_REC_HIST_UPD_TS_A"        javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_A"        column="XX_REC_HIST_UPD_BY_NM_A"     javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_A"          column="XX_REC_HIST_TBL_NM_A"        javaType="EZDSStringItem"/>
        <!-- END 2016/12/01 K.Kojima [QC#14204, ADD] -->
    </resultMap>

    <statement id="getDropDownData" parameterClass="Map" resultClass="Map">
        SELECT
             SVC_TERM_COND_DATA_VAL_CD
            ,SVC_TERM_COND_DATA_DISP_TXT
        FROM
            (
                SELECT
                     STDS.SVC_TERM_COND_DATA_VAL_CD
                    ,STDS.SVC_TERM_COND_DATA_DISP_TXT
                FROM
                    SVC_TERM_COND_DATA_SRC STDS
                WHERE
                        STDS.GLBL_CMPY_CD              = #glblCmpyCd#
                    AND STDS.SVC_TERM_COND_DATA_SRC_CD = #svcTermCondDataSrcCd#
                    AND STDS.EZCANCELFLAG              = '0'
                ORDER BY
                    STDS.SVC_TERM_COND_DATA_SORT_NUM
            )
        WHERE
           ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getLookupData" parameterClass="Map" resultClass="Map">
        SELECT
             C.TARGET_CD
            ,C.TARGET_NAME
        FROM
            (
                SELECT
                     B.TARGET_CD
                    ,B.TARGET_NAME
                FROM
                    (
                        SELECT
                             TO_CHAR(SUBSTR(A.$physMaintTrgtColNm$, 0, #keyLen#))                                   AS TARGET_CD
                            ,SUBSTR(A.$physDplyTrgtColNm$, 0, #valLen#)                                             AS TARGET_NAME
                            ,ROW_NUMBER() OVER(PARTITION BY A.$physMaintTrgtColNm$ ORDER BY A.$physMaintTrgtColNm$) AS ROW_NUM 
                        FROM
                            $physMaintTrgtTblNm$ A
                        WHERE
                                A.GLBL_CMPY_CD = #glblCmpyCd#
                            AND A.EZCANCELFLAG = '0'
                            <!-- add start 2018/06/25 QC#17369 -->
                            <isNotNull property="valTxt" >
                            AND A.$physMaintTrgtColNm$ = #valTxt#
                            </isNotNull>
                            <!-- add end 2018/06/25 QC#17369 -->
                    ) B
                WHERE
                    B.ROW_NUM = 1
                ORDER BY
                    B.TARGET_CD
            ) C
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getDuplicateData" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS DATA_COUNT
        FROM
            DEF_COV_TERM_COND DCTC
        WHERE
                DCTC.GLBL_CMPY_CD                    = #glblCmpyCd#
            AND DCTC.SVC_COV_TMPL_TP_CD              = #svcCovTmplTpCd#
            AND DCTC.SVC_TERM_COND_ATTRB_PK          = #svcTermCondAttrbPk#
            AND DCTC.EFF_FROM_DT                 &lt;= #effThruDt#
            AND NVL(DCTC.EFF_THRU_DT, #maxDate#) &gt;= #effFromDt#
            <isNotNull property="pkList" >
            <iterate property="pkList" var="pkList[]" open="AND DCTC.DEF_COV_TERM_COND_PK NOT IN (" close=")" conjunction=",">
            #pkList[]#
            </iterate>
            </isNotNull>
            AND DCTC.EZCANCELFLAG                    = '0'
    </statement>

 </sqlMap>
