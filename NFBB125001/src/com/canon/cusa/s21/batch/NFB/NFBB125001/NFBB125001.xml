<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NFBB125001">

    <statement id="SELECT_RECORD" parameterClass="Map">
    <!-- START 2018/03/19 T.Kikuhara [QC#20316,MOD] -->
        SELECT
            CIAD.MDSE_CD
        ,   CIAD.AP_VND_CD
        ,   SUBSTR(CIAD.AP_VND_INV_NUM,1,13)        AP_VND_INV_NUM
        ,   CAIH.INV_DT
        ,   CIAD.AP_VND_INV_SQ_NUM
        ,   CIAD.AP_VND_INV_LINE_NUM
        ,   NVL(CIAD.AC_INV_JRNL_COST_AMT,0)        STD_COST_AMT
        ,   CASE WHEN CIAD.AP_LINE_TP_CD = #apLineTp# THEN NVL(CIAD.AP_BILL_QTY, 0) ELSE 0 END TOT_ASSET_QTY
        ,   STC.SELL_TO_CUST_CD                     SHIP_TO_CUST_ACCT_CD
        FROM
            CM_AP_INV_HDR       CAIH
        ,   CM_INV_ACCT_DIST    CIAD
        ,   CM_DEF_ACCT         CDA
        ,   MDSE                M
        ,   PO_DTL              PD
        ,   SHIP_TO_CUST        STC
        WHERE
            CAIH.GLBL_CMPY_CD           = #glblCmpyCd#
        AND NVL(CIAD.AC_INV_JRNL_COST_AMT,0) &gt; 0
        AND CAIH.GLBL_CMPY_CD           = CIAD.GLBL_CMPY_CD
        AND CAIH.GLBL_CMPY_CD           = CDA.GLBL_CMPY_CD
        AND CAIH.GLBL_CMPY_CD           = M.GLBL_CMPY_CD(+)
        AND CIAD.GLBL_CMPY_CD           = CDA.GLBL_CMPY_CD
        AND CIAD.GLBL_CMPY_CD           = M.GLBL_CMPY_CD(+)
        AND CDA.GLBL_CMPY_CD            = M.GLBL_CMPY_CD(+)
        AND CIAD.GLBL_CMPY_CD           = PD.GLBL_CMPY_CD
        AND PD.GLBL_CMPY_CD             = STC.GLBL_CMPY_CD
        AND CAIH.AP_VND_CD              = CIAD.AP_VND_CD
        AND CAIH.AP_VND_INV_NUM         = CIAD.AP_VND_INV_NUM
        AND CAIH.AP_VND_INV_SQ_NUM      = CIAD.AP_VND_INV_SQ_NUM
        AND CAIH.ACCT_INV_STS_CD        = #acctInvStsCd_20#
        AND CDA.CM_DEF_ACCT_CD          IN (#cmDefAcctCdAsset#, #cmDefAcctCdFreight#, #cmDefAcctCdTax#)
        AND CIAD.DR_COA_ACCT_CD         = CDA.CM_COA_ACCT_CD
        AND CIAD.MDSE_CD                = M.MDSE_CD(+)
        AND CIAD.PO_NUM                 = PD.PO_ORD_NUM
        AND PD.SHIP_TO_CUST_CD          = STC.SHIP_TO_CUST_CD
        AND CAIH.EZCANCELFLAG           = '0'
        AND CIAD.EZCANCELFLAG           = '0'
        AND CDA.EZCANCELFLAG            = '0'
        AND M.EZCANCELFLAG (+)          = '0'
        AND PD.EZCANCELFLAG             = '0'
        AND STC.EZCANCELFLAG            = '0'
        AND EXISTS (SELECT 1 FROM CM_INV_ACCT_DIST CIAD2, CM_DEF_ACCT CDA2 WHERE CIAD2.EZCANCELFLAG = '0' AND CDA2.EZCANCELFLAG = '0' AND CIAD2.GLBL_CMPY_CD = #glblCmpyCd# AND CDA2.GLBL_CMPY_CD = #glblCmpyCd# AND CIAD2.PO_NUM = CIAD.PO_NUM and CIAD2.DR_COA_ACCT_CD = CDA2.CM_COA_ACCT_CD and CDA2.CM_DEF_ACCT_CD = #cmDefAcctCdAsset#)
        GROUP BY
            CIAD.MDSE_CD
        ,   CIAD.AP_VND_CD
        ,   CIAD.AP_VND_INV_NUM
        ,   CAIH.INV_DT
        ,   CIAD.AP_VND_INV_SQ_NUM
        ,   CIAD.AP_VND_INV_LINE_NUM
        ,   CIAD.AC_INV_JRNL_COST_AMT
        ,   CIAD.AP_BILL_QTY
        ,   CIAD.AP_LINE_TP_CD
        ,   STC.SELL_TO_CUST_CD
        ORDER BY
            CIAD.MDSE_CD
        ,   CIAD.AP_VND_CD
        ,   CIAD.AP_VND_INV_NUM
        ,   CAIH.INV_DT
        ,   CIAD.AP_VND_INV_SQ_NUM
        ,   CIAD.AC_INV_JRNL_COST_AMT
        ,   CIAD.AP_BILL_QTY
    <!-- END 2018/03/19 T.Kikuhara [QC#20316,MOD] -->
    </statement>

</sqlMap>
