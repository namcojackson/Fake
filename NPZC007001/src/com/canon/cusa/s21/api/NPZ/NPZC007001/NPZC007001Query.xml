<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPZC007001Query">
    <typeAlias alias="NPZC007001PMsg" type="business.parts.NPZC007001PMsg"/>
    <typeAlias alias="VNDTMsg" type="business.db.VNDTMsg"/>

    <statement id="getVNDTMsg" parameterClass="NPZC007001PMsg" resultMap="rs_getVNDTMsg">
        SELECT
            VND.GLBL_CMPY_CD        AS  GLBL_CMPY_CD
            , VND.VND_CD            AS  VND_CD
            , VND.FIRST_LINE_ADDR   AS  FIRST_LINE_ADDR
            , VND.SCD_LINE_ADDR     AS  SCD_LINE_ADDR
            , VND.THIRD_LINE_ADDR   AS  THIRD_LINE_ADDR
            , VND.FRTH_LINE_ADDR    AS  FRTH_LINE_ADDR
            , VND.CTY_ADDR          AS  CTY_ADDR
            , VND.ST_CD             AS  ST_CD
            , VND.POST_CD           AS  POST_CD
            , VND.CTRY_CD           AS  CTRY_CD
            , VND.FAX_NUM           AS  FAX_NUM
            , VND.TEL_NUM           AS  TEL_NUM
            , VND.COA_AFFL_CD       AS  COA_AFFL_CD
            , VND.ATTN_NM           AS  ATTN_NM
            , VND.LOC_NM            AS  LOC_NM
        FROM
            VND	VND
        WHERE
            VND.GLBL_CMPY_CD    =    #glblCmpyCd#
            AND	VND.VND_CD      =    #vndCd#
    </statement>
    <resultMap id="rs_getVNDTMsg" class="VNDTMsg">
        <result property="vndCd" column="VND_CD" javaType="EZDTStringItem"/>
        <result property="firstLineAddr" column="FIRST_LINE_ADDR" javaType="EZDTStringItem"/>
        <result property="scdLineAddr" column="SCD_LINE_ADDR" javaType="EZDTStringItem"/>
        <result property="thirdLineAddr" column="THIRD_LINE_ADDR" javaType="EZDTStringItem"/>
        <result property="frthLineAddr" column="FRTH_LINE_ADDR" javaType="EZDTStringItem"/>
        <result property="fifthLineAddr" column="FIFTH_LINE_ADDR" javaType="EZDTStringItem"/>
        <result property="sixthLineAddr" column="SIXTH_LINE_ADDR" javaType="EZDTStringItem"/>
        <result property="ctyAddr" column="CTY_ADDR" javaType="EZDTStringItem"/>
        <result property="stCd" column="ST_CD" javaType="EZDTStringItem"/>
        <result property="postCd" column="POST_CD" javaType="EZDTStringItem"/>
        <result property="ctryCd" column="CTRY_CD" javaType="EZDTStringItem"/>
        <result property="faxNum" column="FAX_NUM" javaType="EZDTStringItem"/>
        <result property="telNum" column="TEL_NUM" javaType="EZDTStringItem"/>
        <result property="coaAfflCd" column="COA_AFFL_CD" javaType="EZDTStringItem"/>
        <result property="attnNm" column="ATTN_NM" javaType="EZDTStringItem"/>
        <result property="locNm" column="LOC_NM" javaType="EZDTStringItem"/>
    </resultMap>
    <statement id="getCnsgnCd" parameterClass="Map" resultClass="String">
        SELECT
            PCWC.CNSGN_CD
        FROM
            PO_CNSGN_WH_CONV PCWC
        WHERE
            PCWC.GLBL_CMPY_CD = #glblCmpyCd#
            AND PCWC.WH_CD = #whCd#
            AND PCWC.EZCANCELFLAG = '0'
            AND ROWNUM = 1
    </statement>
    <statement id="getPo" parameterClass="Map"
        resultClass="Map">
        SELECT
             PO.PO_ORD_NUM                AS P_PO_ORD_NUM
            ,PO.GLBL_CMPY_CD              AS P_GLBL_CMPY_CD
            ,PO.EZTABLEID                 AS P_EZTABLEID
            ,PO.EZCANCELFLAG              AS P_EZCANCELFLAG
            ,PO.EZINTIME                  AS P_EZINTIME
            ,PO.EZINTIMEZONE              AS P_EZINTIMEZONE
            ,PO.EZINCOMPANYCODE           AS P_EZINCOMPANYCODE
            ,PO.EZINUSERID                AS P_EZINUSERID
            ,PO.EZINAPLID                 AS P_EZINAPLID
            ,PO.EZUPTIME                  AS P_EZUPTIME
            ,PO.EZUPTIMEZONE              AS P_EZUPTIMEZONE
            ,PO.EZUPCOMPANYCODE           AS P_EZUPCOMPANYCODE
            ,PO.EZUPUSERID                AS P_EZUPUSERID
            ,PO.EZUPAPLID                 AS P_EZUPAPLID
            ,PO.PO_APVL_DT                AS P_PO_APVL_DT
            ,PO.PO_STS_CD                 AS P_PO_STS_CD
            ,PO.VND_CD                    AS P_VND_CD
            ,PO.VND_NM                    AS P_VND_NM
            ,PO.INVTY_LOC_CD              AS P_INVTY_LOC_CD
            ,PO.PO_ORD_CMNT_TXT           AS P_PO_ORD_CMNT_TXT
            ,PO.PO_ORD_SHPG_INSTN_TXT     AS P_PO_ORD_SHPG_INSTN_TXT
            ,PO.PO_SEND_FLG               AS P_PO_SEND_FLG
            ,PO.VND_DROP_SHIP_FLG         AS P_VND_DROP_SHIP_FLG
            ,PO.PO_PRINT_FLG              AS P_PO_PRINT_FLG
            ,PO.WRK_ORD_NUM               AS P_WRK_ORD_NUM
            ,PO.TOC_CD                    AS P_TOC_CD
            ,PO.PO_CHRG_CD                AS P_PO_CHRG_CD
            ,PO.FIRST_PROD_CTRL_CD        AS P_FIRST_PROD_CTRL_CD
            ,PO.PO_PRCH_ORD_TP_CD         AS P_PO_PRCH_ORD_TP_CD
            ,PO.PO_SHPG_METH_CD           AS P_PO_SHPG_METH_CD
            ,PO.PO_DELY_PRTY_CD           AS P_PO_DELY_PRTY_CD
            ,PO.PO_CPLT_DELY_FLG          AS P_PO_CPLT_DELY_FLG
            ,PO.VND_ISS_ORD_NUM           AS P_VND_ISS_ORD_NUM
            ,PO.PO_SUBMT_PSN_CD           AS P_PO_SUBMT_PSN_CD
            ,PO.PO_SUBMT_TS               AS P_PO_SUBMT_TS
            ,PO.PO_APVL_PSN_CD            AS P_PO_APVL_PSN_CD
            ,PO.PO_APVL_TS                AS P_PO_APVL_TS
            ,PO.RWS_AUTO_CRAT_FLG         AS P_RWS_AUTO_CRAT_FLG
            ,PO.PO_ORD_SRC_CD             AS P_PO_ORD_SRC_CD
            ,PO.CMBN_PO_TP_CD             AS P_CMBN_PO_TP_CD
            ,PO.PO_ORD_NUM                AS DP_PO_ORD_NUM
            ,PO.GLBL_CMPY_CD              AS DP_GLBL_CMPY_CD
            ,PO.EZTABLEID                 AS DP_EZTABLEID
            ,PO.EZCANCELFLAG              AS DP_EZCANCELFLAG
            ,PO.EZINTIME                  AS DP_EZINTIME
            ,PO.EZINTIMEZONE              AS DP_EZINTIMEZONE
            ,PO.EZINCOMPANYCODE           AS DP_EZINCOMPANYCODE
            ,PO.EZINUSERID                AS DP_EZINUSERID
            ,PO.EZINAPLID                 AS DP_EZINAPLID
            ,PO.EZUPTIME                  AS DP_EZUPTIME
            ,PO.EZUPTIMEZONE              AS DP_EZUPTIMEZONE
            ,PO.EZUPCOMPANYCODE           AS DP_EZUPCOMPANYCODE
            ,PO.EZUPUSERID                AS DP_EZUPUSERID
            ,PO.EZUPAPLID                 AS DP_EZUPAPLID
            ,PO.DS_PO_TP_CD               AS DP_DS_PO_TP_CD
            ,PO.DS_PO_TP_NM               AS DP_DS_PO_TP_NM
            ,PO.PO_HDR_TXT                AS DP_PO_HDR_TXT
            ,PO.FSR_NUM                   AS DP_FSR_NUM
            ,PO.TRSMT_METH_TP_CD          AS DP_TRSMT_METH_TP_CD
            ,PO.SEND_PO_FAX_NUM           AS DP_SEND_PO_FAX_NUM
            ,PO.SEND_PO_EML_ADDR          AS DP_SEND_PO_EML_ADDR
            ,PO.VND_SHPG_TP_CD            AS DP_VND_SHPG_TP_CD
            ,PO.FIRST_ORD_MSG_TXT         AS DP_FIRST_ORD_MSG_TXT
            ,PO.SCD_ORD_MSG_TXT           AS DP_SCD_ORD_MSG_TXT
            ,PO.THIRD_ORD_MSG_TXT         AS DP_THIRD_ORD_MSG_TXT
            ,PO.LINE_BIZ_TP_CD            AS DP_LINE_BIZ_TP_CD
            ,PO.CARR_ACCT_NUM             AS DP_CARR_ACCT_NUM
            ,PO.PO_HDR_STS_CD             AS DP_PO_HDR_STS_CD
            ,PO.PO_APVL_STS_CD            AS DP_PO_APVL_STS_CD
            ,PO.PO_QLFY_CD                AS DP_PO_QLFY_CD
            ,PO.PRNT_VND_CD               AS DP_PRNT_VND_CD
            ,PO.PRNT_VND_NM               AS DP_PRNT_VND_NM
            ,PO.RQST_TECH_TOC_CD          AS DP_RQST_TECH_TOC_CD
            ,PO.DEST_RTL_WH_CD            AS DP_DEST_RTL_WH_CD
            ,PO.SRC_RTL_WH_CD             AS DP_SRC_RTL_WH_CD
            ,PO.RQST_RCV_DT               AS DP_RQST_RCV_DT
            ,PO.RQST_RCV_TM               AS DP_RQST_RCV_TM
            ,PO.PRCH_GRP_CD               AS DP_PRCH_GRP_CD
            ,PO.VND_PMT_TERM_CD           AS DP_VND_PMT_TERM_CD
            ,PO.VND_PMT_TERM_DESC_TXT     AS DP_VND_PMT_TERM_DESC_TXT
            ,PO.RTRN_SHIP_TO_RTL_WH_CD    AS DP_RTRN_SHIP_TO_RTL_WH_CD
            ,PO.SHIP_FROM_SO_NUM_LIST_TXT AS DP_SHIP_FROM_SO_NUM_LIST_TXT
            ,PO.PO_SEND_TS                AS DP_PO_SEND_TS
            ,PO.EIP_RPT_RQST_PK           AS DP_EIP_RPT_RQST_PK
            ,PO.VND_ISS_ORD_NUM           AS VND_ISS_ORD_NUM
            ,PO.PO_SUBMT_PSN_CD           AS PO_SUBMT_PSN_CD
        FROM
            PO PO
        WHERE
            PO.GLBL_CMPY_CD = #glblCmpyCd#
        AND PO.PO_ORD_NUM   = #poOrdNum#
        AND PO.EZCANCELFLAG = '0'
    </statement>
    <statement id="getPoTotalAmount" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            SUM(PD.ENT_PO_DTL_DEAL_NET_AMT) PO_TOTAL_AMOUNT
        FROM
            PO_DTL PD
        WHERE
            PD.GLBL_CMPY_CD            = #glblCmpyCd#
        AND PD.PO_ORD_NUM              = #poOrdNum#
        AND PD.PO_STS_CD               &lt;&gt; #poStsCd#
        AND PD.SET_PO_ORD_DTL_LINE_NUM IS NULL
        AND PD.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getPoRptWrk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) COUNT
        FROM
            PO_RPT_WRK
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND PO_ORD_NUM   = #poOrdNum#
            AND USR_ID       = #usrId#
            AND RCV_RPT_TS   = #rcvRptTs#
            AND EZCANCELFLAG = '0'
    </statement>

    <statement id="getPrntVndNm" parameterClass="Map" resultClass="String">
        SELECT
            SUBSTR ( PVV.PRNT_VND_NM , 0 , 60 ) AS PRNT_VND_NM
        FROM
            PO_VND_V PVV
        WHERE 1=1
            AND PVV.GLBL_CMPY_CD = #glblCmpyCd#
            AND PVV.VND_CD       = #vndCd# 
            AND PVV.EZCANCELFLAG = '0'
            AND ROWNUM           = 1
    </statement>
    

    <typeAlias alias="PO_RPT_INFOTMsg" type="business.db.PO_RPT_INFOTMsg"/>
    <statement id="getPoRptInfo" parameterClass="Map" resultMap="rs_getPoRptInfoTMsg">
        SELECT
             PRI.PO_RPT_INFO_TP_CD
            ,PRI.PO_RPT_INFO_NUM
            ,PRI.TTL_VAL_TXT
            ,PRI.DESC_VAL_TXT
        FROM
             PO_RPT_INFO PRI
        WHERE
             PRI.GLBL_CMPY_CD       = #glblCmpyCd#
        AND  PRI.PO_RPT_INFO_TP_CD  = #poRptInfoTpCd#
        AND  PRI.EFF_FROM_DT       &lt;= #procDt#
        AND (PRI.EFF_THRU_DT       &gt;= #procDt# OR PRI.EFF_THRU_DT IS NULL)
        AND  PRI.EZCANCELFLAG       = '0'
        ORDER BY
            PRI.PO_RPT_INFO_NUM
    </statement>
    <resultMap id="rs_getPoRptInfoTMsg" class="PO_RPT_INFOTMsg">
        <result property="poRptInfoTpCd" column="PO_RPT_INFO_TP_CD" javaType="EZDTStringItem"/>
        <result property="poRptInfoNum" column="PO_RPT_INFO_NUM" javaType="EZDTBigDecimalItem"/>
        <result property="ttlValTxt" column="TTL_VAL_TXT" javaType="EZDTStringItem"/>
        <result property="descValTxt" column="DESC_VAL_TXT" javaType="EZDTStringItem"/>
    </resultMap>

    <statement id="getDepartment" parameterClass="Map" resultClass="String">
        WITH 
            ORG AS (
                SELECT DISTINCT 
                     B.BIZ_AREA_ORG_CD
                    ,B.TIER
                    ,A.TOC_CD
                    ,CASE B.TIER
                        WHEN A.FIRST_ORG_TIER_CD    THEN A.FIRST_ORG_CD
                        WHEN A.SCD_ORG_TIER_CD      THEN A.SCD_ORG_CD 
                        WHEN A.THIRD_ORG_TIER_CD    THEN A.THIRD_ORG_CD
                        WHEN A.FRTH_ORG_TIER_CD     THEN A.FRTH_ORG_CD
                        WHEN A.FIFTH_ORG_TIER_CD    THEN A.FIFTH_ORG_CD
                        WHEN A.SIXTH_ORG_TIER_CD    THEN A.SIXTH_ORG_CD 
                        WHEN A.SVNTH_ORG_TIER_CD    THEN A.SVNTH_ORG_CD
                        WHEN A.EIGHTH_ORG_TIER_CD   THEN A.EIGHTH_ORG_CD
                        WHEN A.NINTH_ORG_TIER_CD    THEN A.NINTH_ORG_CD
                        WHEN A.TENTH_ORG_TIER_CD    THEN A.TENTH_ORG_CD
                        WHEN A.ELVTH_ORG_TIER_CD    THEN A.ELVTH_ORG_CD
                        ELSE                             NULL
                     END AS ORG_CD
                    ,CASE B.TIER
                        WHEN A.FIRST_ORG_TIER_CD    THEN A.FIRST_ORG_NM
                        WHEN A.SCD_ORG_TIER_CD      THEN A.SCD_ORG_NM 
                        WHEN A.THIRD_ORG_TIER_CD    THEN A.THIRD_ORG_NM
                        WHEN A.FRTH_ORG_TIER_CD     THEN A.FRTH_ORG_NM
                        WHEN A.FIFTH_ORG_TIER_CD    THEN A.FIFTH_ORG_NM
                        WHEN A.SIXTH_ORG_TIER_CD    THEN A.SIXTH_ORG_NM 
                        WHEN A.SVNTH_ORG_TIER_CD    THEN A.SVNTH_ORG_NM
                        WHEN A.EIGHTH_ORG_TIER_CD   THEN A.EIGHTH_ORG_NM
                        WHEN A.NINTH_ORG_TIER_CD    THEN A.NINTH_ORG_NM
                        WHEN A.TENTH_ORG_TIER_CD    THEN A.TENTH_ORG_NM
                        WHEN A.ELVTH_ORG_TIER_CD    THEN A.ELVTH_ORG_NM 
                        ELSE                             NULL
                     END AS ORG_NM
                    ,A.GLBL_CMPY_CD
                FROM
                     S21_ORG A
                    ,(
                        SELECT  
                             OSD.BIZ_AREA_ORG_CD
                            ,OSD.ORG_TIER_CD AS TIER 
                        FROM
                             ORG_HRCH_STRU_DFN OSD
                            ,STRU_DFN SDN
                        WHERE
                             1=1
                        AND  OSD.GLBL_CMPY_CD       = #glblCmpyCd#
                        AND  OSD.ORG_STRU_TP_CD     = #orgStruTpCd#
                        AND  OSD.BIZ_AREA_ORG_CD    = '1'
                        AND  OSD.STRU_DFN_CD        = SDN.STRU_DFN_CD
                        AND  OSD.GLBL_CMPY_CD       = SDN.GLBL_CMPY_CD
                        AND  SDN.BU_FLG             = 'Y'
                        AND  OSD.EZCANCELFLAG       = '0'
                        AND  SDN.EZCANCELFLAG       = '0'
                     ) B
                WHERE
                     A.GLBL_CMPY_CD                 = #glblCmpyCd#
                AND  A.EZCANCELFLAG                 = '0'
            )
        SELECT DISTINCT
             ORG.ORG_NM AS BU_NM
        FROM
             S21_ORG SOG
            ,ORG_FUNC_ASG OFA
            ,TOC TOC
            ,ORG ORG
        WHERE
             SOG.GLBL_CMPY_CD                   = #glblCmpyCd#
        AND  SOG.FIRST_ORG_CD                   = ORG.BIZ_AREA_ORG_CD
        AND  SOG.GLBL_CMPY_CD                   = ORG.GLBL_CMPY_CD
        AND  SOG.TOC_CD                         = OFA.TOC_CD
        AND  SOG.GLBL_CMPY_CD                   = OFA.GLBL_CMPY_CD
        AND  SOG.TOC_CD                         = TOC.TOC_CD
        AND  SOG.GLBL_CMPY_CD                   = TOC.GLBL_CMPY_CD
        AND  OFA.GNRN_TP_CD                    IN (#gnrnTpCd_01#, #gnrnTpCd_02#)
        AND  OFA.EFF_FROM_DT                   &lt;= #procDt#
        AND  NVL(OFA.EFF_THRU_DT,'99991231')   &gt;= #procDt#
        AND  TOC.TOC_CD                         = ORG.TOC_CD(+)
        AND  OFA.PSN_CD                         = #psnCd#
        AND  SOG.EZCANCELFLAG                   = '0'
        AND  OFA.EZCANCELFLAG                   = '0'
        AND  TOC.EZCANCELFLAG                   = '0'
    </statement>

    <!-- QC#23929 ADD START -->
    <statement id="getPoTotalAmountforOpen" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            SUM(PD.ENT_PO_DTL_DEAL_NET_AMT) PO_TOTAL_AMOUNT
        FROM
            PO_DTL PD
        WHERE
            PD.GLBL_CMPY_CD            = #glblCmpyCd#
        AND PD.PO_ORD_NUM              = #poOrdNum#
    <!-- QC#25841 MOD START -->
        <iterate property="poLineStsCd" var="poLineStsCdList[]" open="AND PD.PO_LINE_STS_CD NOT IN (" conjunction= ", " close=")">
            #poLineStsCdList[]#
        </iterate>        
<!--        <iterate property="poStsCd" var="poStsCdList[]" open="AND PD.PO_STS_CD NOT IN (" conjunction= ", " close=")">-->
<!--            #poStsCdList[]#-->
<!--        </iterate>        -->
    <!-- QC#25841 MOD END -->
        AND PD.SET_PO_ORD_DTL_LINE_NUM IS NULL
        AND PD.EZCANCELFLAG            = '0'
    </statement>
    <!-- QC#23929 ADD END -->
    
    <!-- QC#21354 ADD START -->
    <statement id="getByrTelNum" parameterClass="Map" resultClass="String">
        SELECT
            WRK_TEL_NUM
        FROM
            AUTH_PSN AP
        WHERE 1=1
            AND AP.GLBL_CMPY_CD = #glblCmpyCd#
            AND AP.USR_NM       = #poSubmtPsnCd# 
            AND AP.EZCANCELFLAG = '0'
            AND ROWNUM           = 1
    </statement>
    <!-- QC#21354 ADD END -->
    
</sqlMap>
