<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLZC408001">

    <statement id="getRemoveRec" parameterClass="Map" resultClass="Map">
        SELECT
            CSA_RMA_RPT_WRK_PK
        FROM
            CSA_RMA_RPT_WRK          RRW
        WHERE
            RRW.GLBL_CMPY_CD         = #glblCmpyCd#
        AND RRW.EZINTIME             &lt; #purgeTs#
        AND RRW.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getRmaInfo" parameterClass="Map" resultClass="Map">
        SELECT
            RH.RWS_NUM
            ,RH.TRX_ORD_NUM
            ,RD.RWS_DTL_LINE_NUM
            ,RD.CARR_CD
            ,RH.WH_CD
<!-- START #QC22885 MOD -->
--            ,RW.SHIP_TO_LOC_NM
            ,RW.RTL_WH_NM
<!-- END #QC22885 MOD -->
            ,RW.FIRST_LINE_ADDR
            ,RW.SCD_LINE_ADDR
            ,RW.THIRD_LINE_ADDR
            ,RW.FRTH_LINE_ADDR
            ,RW.CTY_ADDR
            ,RW.ST_CD
            ,RW.POST_CD
            ,RH.RWS_REF_NUM
            ,RH.SCHD_ETA_DT
            ,CPO.CUST_ISS_PO_NUM
            ,RH.FROM_LOC_NM_01
            ,RH.FROM_LOC_ADDR_01
            ,RH.FROM_LOC_ADDR_02
            ,RH.FROM_LOC_ADDR_03
            ,RH.FROM_LOC_ADDR_04
            ,RH.FROM_LOC_CTY_ADDR
            ,RH.FROM_LOC_ST_CD
            ,RH.FROM_LOC_POST_CD
            ,RH.SVC_CONFIG_MSTR_PK
<!-- START #QC22885 MOD -->
--            ,RW.RTRN_TO_LOC_NM
            ,RW.RTL_WH_NM
<!-- END #QC22885 MOD -->
            ,RW.RTRN_TO_FIRST_LINE_ADDR
            ,RW.RTRN_TO_SCD_LINE_ADDR
            ,RW.RTRN_TO_THIRD_LINE_ADDR
            ,RW.RTRN_TO_FRTH_LINE_ADDR
            ,RW.RTRN_TO_CTY_ADDR
            ,RW.RTRN_TO_ST_CD
            ,RW.RTRN_TO_POST_CD
            ,CONCAT(DCRD.DS_ORD_POSN_NUM, DECODE(DCRD.DS_CPO_LINE_NUM, NULL, '', '.'))||CONCAT(DCRD.DS_CPO_LINE_NUM,  DECODE(DCRD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))||DCRD.DS_CPO_LINE_SUB_NUM AS CPO_DPLY_LINE_NUM
            ,RD.MDSE_CD
            ,MDSE.MDSE_DESC_SHORT_TXT
            ,DCRD.SER_NUM
            ,RD.RWS_QTY
            ,RD.INVTY_LOC_CD
            ,RW2.INVTY_OWNR_CD || RSW.RTL_SWH_CD AS PKG_CD
            ,MSP.IN_POUND_WT
<!-- START QC#24216 MOD -->
            ,RH.FROM_LOC_PSN_NM
            ,RH.FROM_LOC_TEL_NUM
<!-- END   QC#24216 MOD -->
        FROM
            RWS_HDR             RH
            ,RTL_WH             RW
            ,CPO                CPO
            ,RWS_DTL            RD
            ,DS_CPO_RTRN_DTL    DCRD
            ,MDSE               MDSE
            ,PKG_UOM_CLS        PUC
            ,MDSE_STORE_PKG     MSP
            ,RWS_STS            RS
            ,RTL_SWH            RSW
            ,RTL_WH             RW2
        WHERE
            RH.GLBL_CMPY_CD               = #glblCmpyCd#
        AND RH.RWS_NUM                    = #rwsNum#
        AND RH.GLBL_CMPY_CD               = RW.GLBL_CMPY_CD
        AND RH.WH_CD                      = RW.RTL_WH_CD
        AND RH.GLBL_CMPY_CD               = CPO.GLBL_CMPY_CD
        AND RH.TRX_ORD_NUM                = CPO.CPO_ORD_NUM
        AND RH.GLBL_CMPY_CD               = RD.GLBL_CMPY_CD
        AND RH.RWS_NUM                    = RD.RWS_NUM
        AND RH.GLBL_CMPY_CD               = DCRD.GLBL_CMPY_CD
        AND RH.TRX_ORD_NUM                = DCRD.CPO_ORD_NUM
        AND DCRD.DS_CPO_RTRN_LINE_NUM     = RD.TRX_LINE_NUM
        AND DCRD.DS_CPO_RTRN_LINE_SUB_NUM = RD.TRX_LINE_SUB_NUM
        AND RD.GLBL_CMPY_CD               = RSW.GLBL_CMPY_CD
        AND RD.INVTY_LOC_CD               = RSW.INVTY_LOC_CD
        AND RSW.GLBL_CMPY_CD              = RW2.GLBL_CMPY_CD
        AND RSW.RTL_WH_CD                 = RW2.RTL_WH_CD
        AND RD.GLBL_CMPY_CD               = MSP.GLBL_CMPY_CD
        AND RD.MDSE_CD                    = MSP.MDSE_CD
        AND RD.GLBL_CMPY_CD               = MDSE.GLBL_CMPY_CD
        AND RD.MDSE_CD                    = MDSE.MDSE_CD
        AND MDSE.GLBL_CMPY_CD             = PUC.GLBL_CMPY_CD
        AND MDSE.PKG_UOM_CLS_CD           = PUC.PKG_UOM_CLS_CD
        AND PUC.GLBL_CMPY_CD              = MSP.GLBL_CMPY_CD
        AND PUC.BASE_PKG_UOM_CD           = MSP.BASE_PKG_UOM_CD
        AND RS.RWS_OPEN_FLG               = 'Y'
        AND RH.GLBL_CMPY_CD               = RS.GLBL_CMPY_CD
        AND RH.RWS_STS_CD                 = RS.RWS_STS_CD
        AND RH.EZCANCELFLAG               = '0'
        AND RW.EZCANCELFLAG               = '0'
        AND CPO.EZCANCELFLAG              = '0'
        AND RD.EZCANCELFLAG               = '0'
        AND DCRD.EZCANCELFLAG             = '0'
        AND MDSE.EZCANCELFLAG             = '0'
        AND PUC.EZCANCELFLAG              = '0'
        AND MSP.EZCANCELFLAG              = '0'
        AND RS.EZCANCELFLAG               = '0'
        AND RSW.EZCANCELFLAG              = '0'
        AND RW2.EZCANCELFLAG              = '0'
        ORDER BY
            TO_NUMBER(DCRD.DS_ORD_POSN_NUM)
           ,DCRD.DS_CPO_LINE_NUM
           ,DCRD.DS_CPO_LINE_SUB_NUM
           ,RD.MDSE_CD
           ,DCRD.SER_NUM
    </statement>

    <statement id="getRemoveRmaPrintLogRec" parameterClass="Map" resultClass="Map">
        SELECT
            RRPL.PROC_PGM_ID
            ,RRPL.RWS_NUM
            ,RRPL.RWS_REF_NUM
        FROM
            RPT_RMA_PRINT_LOG  RRPL
            ,CPO               CPO
        WHERE 
            RRPL.GLBL_CMPY_CD         = #glblCmpyCd#
        AND RRPL.GLBL_CMPY_CD         = CPO.GLBL_CMPY_CD
        AND RRPL.CPO_ORD_NUM          = CPO.CPO_ORD_NUM
        AND CPO.ORD_HDR_STS_CD        IN (#closed#, #canceled#)
        AND RRPL.EZCANCELFLAG         = '0'
        AND CPO.EZCANCELFLAG          = '0'
    </statement>

    <statement id="chkRmaPrintLogRec" parameterClass="Map" resultClass="BigDecimal">
        SELECT COUNT(1)
        FROM
            RPT_RMA_PRINT_LOG        RRPL
        WHERE 
            RRPL.GLBL_CMPY_CD        = #glblCmpyCd#
        AND RRPL.PROC_PGM_ID         = #procPgmId#
        AND RRPL.RWS_NUM             = #rwsNum#
        AND RRPL.RWS_REF_NUM         = #rwsRefNum#
        AND RRPL.EZCANCELFLAG        = '0'
               
    </statement>

    <statement id="getRtrnCmnt" parameterClass="Map" resultClass="Map">
        SELECT
            RTRN_TRX_CMNT_TXT
        FROM
            RTRN_TRX_CMNT RTC
        WHERE
            RTC.GLBL_CMPY_CD      = #glblCmpyCd#
        AND RTC.TRX_HDR_NUM       = #trxHdrNum#
        AND RTC.MSG_CTRL_TP_CD    = #msgCtrlTpCd#
        AND RTC.RTRN_TRX_CMNT_TXT IS NOT NULL
        AND RTC.EZCANCELFLAG      = '0'
        ORDER BY
            RTC.UPD_TS DESC
    </statement>
</sqlMap>
