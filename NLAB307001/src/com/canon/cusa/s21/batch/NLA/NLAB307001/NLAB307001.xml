<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLAB307001">

    <!-- ==== Type Aliases ==== -->
    <typeAlias alias="DsCondConstInfo"     type="com.canon.cusa.s21.batch.NLA.NLAB307001.DsCondConstInfo"/>
    <typeAlias alias="RwsSchdDtlInfo"      type="com.canon.cusa.s21.batch.NLA.NLAB307001.RwsSchdDtlInfo"/>
    <typeAlias alias="RmaTrkStsInfo"       type="com.canon.cusa.s21.batch.NLA.NLAB307001.RmaTrkStsInfo"/>

    <!-- ==== Statement ==== -->
    <!-- ==== Result Mapping ==== -->

    <statement id="getDsCondConstInfo" parameterClass="Map" resultMap="result.getDsCondConstInfo">
         SELECT
                DCC.DS_COND_CONST_CD         AS DS_COND_CONST_CD
               ,DCC.DS_COND_CONST_VAL_TXT_01 AS DS_COND_CONST_VAL_TXT_01
               ,DCC.DS_COND_CONST_VAL_TXT_02 AS DS_COND_CONST_VAL_TXT_02
               ,RTS.SCHD_COORD_STS_CD        AS SCHD_COORD_STS_CD
               ,RTS.NTFY_ML_SEND_FLG         AS NTFY_ML_SEND_FLG
           FROM
                DS_COND_CONST     DCC
               ,RTRN_TRK_STS      RTS
          WHERE
                DCC.GLBL_CMPY_CD             = #glblCmpyCd#
            AND DCC.DS_COND_CONST_GRP_ID     = #dsCondConstGrpId#
            AND DCC.EZCANCELFLAG             = '0'
            AND DCC.GLBL_CMPY_CD             = RTS.GLBL_CMPY_CD
            AND DCC.DS_COND_CONST_VAL_TXT_02 = RTS.RTRN_TRK_STS_CD
            AND RTS.EZCANCELFLAG             = '0'
    </statement>

    <resultMap id="result.getDsCondConstInfo" class="DsCondConstInfo">
        <result property="dsCondConstCd"        column="DS_COND_CONST_CD"          javaType="String"/>
        <result property="dsCondConstValTxt01"  column="DS_COND_CONST_VAL_TXT_01"  javaType="String"/>
        <result property="dsCondConstValTxt02"  column="DS_COND_CONST_VAL_TXT_02"  javaType="String"/>
        <result property="schdCoordStsCd"       column="SCHD_COORD_STS_CD"         javaType="String"/>
        <result property="ntfyMlSendFlg"        column="NTFY_ML_SEND_FLG"          javaType="String"/>
    </resultMap>

    <statement id="getRwsSchdDtlInfo1" parameterClass="Map" resultMap="result.getRwsSchdDtlInfo">
         SELECT
                RD.RWS_NUM               AS RWS_NUM
               ,RD.RWS_DTL_LINE_NUM      AS RWS_DTL_LINE_NUM
               ,RD.EZUPUSERID            AS EZUPUSERID
               ,RD.EZUPTIME              AS EZUPTIME
           FROM
                SCHD_COORD_STS    SCS
               ,RWS_DTL           RD
               ,RWS_STS           RS
          WHERE
                RD.GLBL_CMPY_CD            = #glblCmpyCd#
            AND TO_CHAR(TO_DATE(SUBSTR(RD.EZUPTIME,1,8),#dtFmt#) + #pastDays#, #dtFmt#) &lt;= #batchDate#
            AND (RD.RTRN_TRK_STS_CD &lt;&gt; #rtrnTrkStsCd# OR RD.RTRN_TRK_STS_CD IS NULL)
            AND RD.EZCANCELFLAG            = '0'
            AND RD.GLBL_CMPY_CD            = SCS.GLBL_CMPY_CD
            AND RD.SCHD_COORD_STS_CD       = SCS.SCHD_COORD_STS_CD
            AND SCS.SCHD_OPEN_FLG          = #flgOn#
            AND SCS.EZCANCELFLAG           = '0'
            AND RD.GLBL_CMPY_CD            = RS.GLBL_CMPY_CD
            AND RD.RWS_STS_CD              = RS.RWS_STS_CD
            AND RS.RWS_OPEN_FLG            = #flgOn#
            AND RS.RCV_FLG                 = #flgOff#
            AND RS.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getRwsSchdDtlInfo2" parameterClass="Map" resultMap="result.getRwsSchdDtlInfo">
         SELECT
                RD.RWS_NUM               AS RWS_NUM
               ,RD.RWS_DTL_LINE_NUM      AS RWS_DTL_LINE_NUM
               ,RD.EZUPUSERID            AS EZUPUSERID
               ,RD.EZUPTIME              AS EZUPTIME
           FROM
                SCHD_COORD_STS    SCS
               ,RWS_DTL           RD
               ,RWS_STS           RS
          WHERE
                RD.GLBL_CMPY_CD            = #glblCmpyCd#
            AND TO_CHAR(TO_DATE(SUBSTR(RD.SCHD_PICK_UP_DT,1,8),#dtFmt#) + #pastDays#, #dtFmt#) &lt;= #batchDate#
            AND (RD.RTRN_TRK_STS_CD &lt;&gt; #rtrnTrkStsCd# OR RD.RTRN_TRK_STS_CD IS NULL)
            AND RD.EZCANCELFLAG            = '0'
            AND RD.GLBL_CMPY_CD            = SCS.GLBL_CMPY_CD
            AND RD.SCHD_COORD_STS_CD       = SCS.SCHD_COORD_STS_CD
            AND SCS.SCHD_OPEN_FLG          = #flgOn#
            AND SCS.EZCANCELFLAG           = '0'
            AND RD.ACTL_PICK_UP_DT         IS NULL
            AND RD.GLBL_CMPY_CD            = RS.GLBL_CMPY_CD
            AND RD.RWS_STS_CD              = RS.RWS_STS_CD
            AND RS.RWS_OPEN_FLG            = #flgOn#
            AND RS.RCV_FLG                 = #flgOff#
            AND RS.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getRwsSchdDtlInfo3" parameterClass="Map" resultMap="result.getRwsSchdDtlInfo">
         SELECT
                RD.RWS_NUM               AS RWS_NUM
               ,RD.RWS_DTL_LINE_NUM      AS RWS_DTL_LINE_NUM
               ,RD.EZUPUSERID            AS EZUPUSERID
               ,RD.EZUPTIME              AS EZUPTIME
           FROM
                RWS_DTL           RD
               ,RWS_STS           RS
               ,SCHD_COORD_STS    SCS
               ,RWS_HDR           RH
          WHERE
                RD.GLBL_CMPY_CD           = #glblCmpyCd#
            AND RD.ACTL_PICK_UP_DT        IS NULL
            AND RD.EZCANCELFLAG           = '0'
            AND RD.GLBL_CMPY_CD           = RS.GLBL_CMPY_CD
            AND RD.RWS_STS_CD             = RS.RWS_STS_CD
            AND RS.RWS_OPEN_FLG           = #flgOn#
            AND RS.RCV_FLG                = #flgOff#
            AND RS.EZCANCELFLAG           = '0'
            AND (RD.RTRN_TRK_STS_CD &lt;&gt; #rtrnTrkStsCd# OR RD.RTRN_TRK_STS_CD IS NULL)
            AND RD.GLBL_CMPY_CD           = SCS.GLBL_CMPY_CD
            AND RD.SCHD_COORD_STS_CD      = SCS.SCHD_COORD_STS_CD
            AND SCS.SCHD_OPEN_FLG         = #flgOn#
            AND SCS.EZCANCELFLAG          = '0'
            AND RD.GLBL_CMPY_CD           = RH.GLBL_CMPY_CD
            AND RD.RWS_NUM                = RH.RWS_NUM
            AND RH.EZCANCELFLAG           = '0'
            AND EXISTS (
                        SELECT
                               *
                          FROM
                               DS_CPO_RTRN_DTL   D_CRD
                              ,CPO_DTL           D_CD
                              ,SHPG_ORD_DTL      SOD
                              ,SHPG_ORD_CONF_DTL SOCD
                         WHERE
                               RD.GLBL_CMPY_CD               = D_CRD.GLBL_CMPY_CD
                           AND RH.TRX_ORD_NUM                = D_CRD.CPO_ORD_NUM
                           AND RD.TRX_LINE_NUM               = D_CRD.DS_CPO_RTRN_LINE_NUM
                           AND RD.TRX_LINE_SUB_NUM           = D_CRD.DS_CPO_RTRN_LINE_SUB_NUM
                           AND D_CRD.EZCANCELFLAG            = '0'
                           AND D_CRD.GLBL_CMPY_CD            = D_CD.GLBL_CMPY_CD
                           AND D_CRD.CPO_ORD_NUM             = D_CD.CPO_ORD_NUM
                           AND D_CRD.SVC_CONFIG_MSTR_PK      = D_CD.SVC_CONFIG_MSTR_PK
                           AND D_CD.EZCANCELFLAG             = '0'
                           AND D_CD.GLBL_CMPY_CD             = SOD.GLBL_CMPY_CD
                           AND D_CD.CPO_ORD_NUM              = SOD.TRX_HDR_NUM
                           AND D_CD.DS_CPO_LINE_NUM          = SOD.TRX_LINE_NUM
                           AND D_CD.DS_CPO_LINE_SUB_NUM      = SOD.TRX_LINE_SUB_NUM
                           AND SOD.EZCANCELFLAG              = '0'
                           AND SOD.GLBL_CMPY_CD              = SOCD.GLBL_CMPY_CD
                           AND SOD.SO_NUM                    = SOCD.SO_NUM
                           AND SOD.SO_SLP_NUM                = SOCD.SO_SLP_NUM
                           AND TO_CHAR(TO_DATE(SUBSTR(SOCD.SHIP_DT_TM_TS,1,8),#dtFmt#) + 10, #dtFmt#) &lt;= #batchDate#
                           AND SOCD.EZCANCELFLAG             = '0'
                        )
    </statement>

    <resultMap id="result.getRwsSchdDtlInfo" class="RwsSchdDtlInfo">
        <result property="rwsNum"            column="RWS_NUM"              javaType="String"/>
        <result property="rwsDtlLineNum"     column="RWS_DTL_LINE_NUM"     javaType="String"/>
        <result property="ezUpUserId"        column="EZUPUSERID"           javaType="String"/>
        <result property="ezUpTime"          column="EZUPTIME"             javaType="String"/>
    </resultMap>

    <statement id="getRmaTrkStsInfo" parameterClass="Map" resultMap="result.getRmaTrkStsInfo">
         SELECT
                RTNW.RTRN_TRK_NTFY_WRK_PK         AS RTRN_TRK_NTFY_WRK_PK
               ,RTNW.RWS_NUM                      AS RWS_NUM
               ,RTNW.RWS_DTL_LINE_NUM             AS RWS_DTL_LINE_NUM
               ,RTS.RTRN_TRK_STS_DESC_TXT         AS RTRN_TRK_STS_DESC_TXT
               ,RTNG.ML_GRP_ID                    AS ML_GRP_ID
               ,RTNG.ML_TMPL_ID                   AS ML_TMPL_ID
               ,RTNG.ORD_SLS_REP_USG_FLG          AS ORD_SLS_REP_USG_FLG
               ,D_CRD.CPO_ORD_NUM                 AS CPO_ORD_NUM
               ,SP.EML_ADDR                       AS EML_ADDR
           FROM
                RTRN_TRK_NTFY_WRK RTNW
               ,RTRN_TRK_STS      RTS
               ,RTRN_TRK_NTFY_GRP RTNG
               ,RWS_DTL           RD
               ,RWS_HDR           RH
               ,DS_CPO_RTRN_DTL   D_CRD
               ,ORG_FUNC_ASG      OFA
               ,S21_PSN           SP
          WHERE
                RTNW.GLBL_CMPY_CD                 = #glblCmpyCd#
            AND RTNW.EZCANCELFLAG                 = '0'
            AND RTNW.GLBL_CMPY_CD                 = RTS.GLBL_CMPY_CD
            AND RTNW.RTRN_TRK_STS_CD              = RTS.RTRN_TRK_STS_CD
            AND RTS.EZCANCELFLAG                  = '0'
            AND RTS.GLBL_CMPY_CD                  = RTNG.GLBL_CMPY_CD
            AND RTS.RTRN_TRK_NTFY_GRP_CD          = RTNG.RTRN_TRK_NTFY_GRP_CD
            AND RTNG.EZCANCELFLAG                 = '0'
            AND RTNW.GLBL_CMPY_CD                 = RD.GLBL_CMPY_CD
            AND RTNW.RWS_NUM                      = RD.RWS_NUM
            AND RTNW.RWS_DTL_LINE_NUM             = RD.RWS_DTL_LINE_NUM
            AND RD.EZCANCELFLAG                   = '0'
            AND RTNW.GLBL_CMPY_CD                 = RH.GLBL_CMPY_CD
            AND RTNW.RWS_NUM                      = RH.RWS_NUM
            AND RH.EZCANCELFLAG                   = '0'
            AND RD.GLBL_CMPY_CD                   = D_CRD.GLBL_CMPY_CD
            AND RH.TRX_ORD_NUM                    = D_CRD.CPO_ORD_NUM
            AND RD.TRX_LINE_NUM                   = D_CRD.DS_CPO_RTRN_LINE_NUM
            AND RD.TRX_LINE_SUB_NUM               = D_CRD.DS_CPO_RTRN_LINE_SUB_NUM
            AND D_CRD.EZCANCELFLAG                = '0'
            AND D_CRD.GLBL_CMPY_CD                = OFA.GLBL_CMPY_CD(+)
            AND D_CRD.SLS_REP_OR_SLS_TEAM_TOC_CD  = OFA.TOC_CD(+)
            AND OFA.EFF_FROM_DT(+)            &lt;= #batchDate#
            AND OFA.EFF_THRU_DT(+)            &gt;= #batchDate#
            AND OFA.EZCANCELFLAG(+)               = '0'
            AND OFA.GLBL_CMPY_CD                  = SP.GLBL_CMPY_CD(+)
            AND OFA.PSN_CD                        = SP.PSN_CD(+)
            AND SP.EFF_FROM_DT(+)             &lt;= #batchDate#
            AND SP.EFF_THRU_DT(+)             &gt;= #batchDate#
            AND SP.EZCANCELFLAG(+)                = '0'
          ORDER BY
                RTNG.ML_GRP_ID
               ,D_CRD.CPO_ORD_NUM
               ,RTNW.RWS_NUM
               ,RTNW.RWS_DTL_LINE_NUM
    </statement>

    <resultMap id="result.getRmaTrkStsInfo" class="RmaTrkStsInfo">
        <result property="rtrnTrkNtfyWrkPk"     column="RTRN_TRK_NTFY_WRK_PK"        javaType="BigDecimal"/>
        <result property="rwsNum"               column="RWS_NUM"                     javaType="String"/>
        <result property="rwsDtlLineNum"        column="RWS_DTL_LINE_NUM"            javaType="String"/>
        <result property="rtrnTrkStsDescTxt"    column="RTRN_TRK_STS_DESC_TXT"       javaType="String"/>
        <result property="mlGrpId"              column="ML_GRP_ID"                   javaType="String"/>
        <result property="mlTmplId"             column="ML_TMPL_ID"                  javaType="String"/>
        <result property="ordSlsRepUsgFlg"      column="ORD_SLS_REP_USG_FLG"         javaType="String"/>
        <result property="cpoOrdNum"            column="CPO_ORD_NUM"                 javaType="String"/>
        <result property="emlAddr"              column="EML_ADDR"                    javaType="String"/>
    </resultMap>

</sqlMap>
