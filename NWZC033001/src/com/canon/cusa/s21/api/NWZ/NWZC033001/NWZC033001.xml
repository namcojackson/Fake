<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWZC033001">


    <statement id="queryEachCompChk" parameterClass="Map" resultClass="Integer">
        SELECT
              COUNT(*)

        FROM
              SHPG_PLN SP

        WHERE
                SP.GLBL_CMPY_CD          = #glblCmpyCd#
            AND SP.TRX_SRC_TP_CD         = #trxSrcTpCd#
            AND SP.TRX_HDR_NUM             = #trxHdrNum#
            AND SP.TRX_LINE_NUM             = #trxLineNum#
            AND SP.TRX_LINE_SUB_NUM       != #trxLineNumSet#
            AND SP.PO_REQ_FLG              = 'N'
            AND (
                     EXISTS (
                                    SELECT    *
                                    FROM    MDSE M
                                       WHERE         M.GLBL_CMPY_CD         = #glblCmpyCd#
                                            AND  SP.MDSE_CD             = M.MDSE_CD  
                                              AND  M.INVTY_CTRL_FLG            = 'Y'
                                            AND  M.EZCANCELFLAG           = '0'
                              )
                  OR  EXISTS (
                                    SELECT    *
                                    FROM     MDSE M
                                            ,ORD_TAKE_MDSE OTM
                                       WHERE         M.GLBL_CMPY_CD         = #glblCmpyCd#
                                               AND  OTM.GLBL_CMPY_CD         = #glblCmpyCd#
                                               AND  OTM.ORD_TAKE_MDSE_CD   = SP.MDSE_CD     
                                              AND  M.MDSE_CD                = OTM.MDSE_CD 
                                              AND  M.INVTY_CTRL_FLG            = 'Y'
                                            AND  M.EZCANCELFLAG           = '0'
                                              AND OTM.EZCANCELFLAG         = '0'
                              )
               )
            AND SP.EZCANCELFLAG          = '0'
            
            AND ROWNUM <![CDATA[ <= ]]> 1
    </statement>

    <statement id="getInProcAmt" parameterClass="Map" resultClass="Map">
        SELECT
            C.PAYER_CUST_CD PAYER_CUST_CD
            ,SUM(CD.ENT_FUNC_NET_UNIT_PRC_AMT * CD.ORD_QTY) TOT_AMT
        FROM
            CPO C
            ,CPO_DTL CD
        WHERE
                C.GLBL_CMPY_CD           = #glblCmpyCd#
            AND    C.CPO_ORD_NUM            = #cpoOrdNum#
            AND C.EZCANCELFLAG           = '0'
            AND CD.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND CD.CPO_ORD_NUM           = C.CPO_ORD_NUM
            AND CD.CPO_DTL_LINE_SUB_NUM != #cpoDtlLineSubNum#
            AND CD.EZCANCELFLAG          = '0'
        GROUP BY C.PAYER_CUST_CD
    </statement>

    <statement id="cntTrialLoanHold" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)
        FROM
            HLD H
        WHERE
                H.GLBL_CMPY_CD = #glblCmpyCd#
            AND    H.CPO_ORD_NUM  = #cpoOrdNum#
            AND H.REL_FLG       = 'N'
            AND H.EZCANCELFLAG = '0'
    </statement>

    <statement id="getBomInfo" parameterClass="Map" resultClass="Map">
        SELECT
             C.CPO_ORD_NUM                    CPO_ORD_NUM
            ,C.CPO_DTL_LINE_NUM               CPO_DTL_LINE_NUM
            ,C.CPO_DTL_LINE_SUB_NUM           CPO_DTL_LINE_SUB_NUM
            ,C.DS_ORD_POSN_NUM                DS_ORD_POSN_NUM
            ,M.MDSE_CD                        MDSE_CD
            ,M.MDSE_TP_CD                     MDSE_TP_CD
        FROM
             CPO_DTL    C
            ,MDSE       M
        WHERE
                C.GLBL_CMPY_CD         = #glblCmpyCd#
            AND C.CPO_ORD_NUM          = #cpoOrdNum#
            AND C.CPO_DTL_LINE_NUM     = #cpoDtlLineNum#
            AND C.CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
            AND C.EZCANCELFLAG         = '0'

            AND M.GLBL_CMPY_CD         = C.GLBL_CMPY_CD
            AND M.MDSE_CD              = C.MDSE_CD
            AND M.EZCANCELFLAG         = '0'
    </statement>

    <statement id="isBaseCmp" parameterClass="Map" resultClass="Integer">
        SELECT
             COUNT(CMP.GLBL_CMPY_CD) CNT
        FROM
             CMPSN          CMP
        WHERE
                CMP.GLBL_CMPY_CD   = #glblCmpyCd#
            AND CMP.PRNT_MDSE_CD   = #prntMdseCd#
            AND (CMP.CHILD_MDSE_CD = #childMdseCd# OR CMP.CHILD_ORD_TAKE_MDSE_CD = #childMdseCd#)
            AND CMP.EZCANCELFLAG   = '0'
            AND CMP.BASE_CMPT_FLG  = #baseCmpFlg#
    </statement>

</sqlMap>
