<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAL0230Query">

    <typeAlias alias="NMAL0230SMsg"    type="business.blap.NMAL0230.NMAL0230SMsg"/>
    <typeAlias alias="NMAL0230_ASMsg"  type="business.blap.NMAL0230.NMAL0230_ASMsg"/>

    <statement id="getBomList" parameterClass="Map" resultMap="result.getBomList">
        WITH
             CMP AS (
                SELECT
                      C.EZCANCELFLAG
                    , C.EZUPTIME
                    , C.EZUPTIMEZONE
                    , NULL AS CMPSN_CHNG_REQ_PK
                    , C.GLBL_CMPY_CD
                    , C.PRNT_MDSE_CD
                    , C.CMPSN_PK
                    , C.MDSE_CMPSN_TP_CD
                    , C.CHILD_MDSE_CD
                    , C.CHILD_ORD_TAKE_MDSE_CD
                    , C.CHILD_MDSE_QTY
                    , C.EFF_FROM_DT
                    , C.EFF_THRU_DT
                    , C.CUSA_MDSE_CD
                    , C.CMPSN_REVN_NUM
                    , C.ACTV_FLG
                    , C.CMPSN_REVN_CMNT_TXT
                FROM
                      CMPSN         C
                WHERE
                        C.GLBL_CMPY_CD  = #glblCmpyCd#
                    AND C.EZCANCELFLAG  = '0'
            )
           , HIST AS (
                 SELECT
                      MAX(CH.EZUPTIME)     AS EZUPTIME
                    , MAX(CH.EZUPTIMEZONE) AS EZUPTIMEZONE
                    , CH.CMPSN_PK
                    , CH.CMPSN_REVN_NUM
                FROM
                      CMPSN_HIST         CH
                WHERE   CH.GLBL_CMPY_CD  = #glblCmpyCd#
                    AND CH.EZCANCELFLAG  = '0'
                    AND CH.HIST_ACT_NM   = #histActNm#
                    AND CH.ACTV_FLG     = 'N'
                GROUP BY CH.CMPSN_PK, CH.CMPSN_REVN_NUM
           )
           , CMP_ALL AS (
                SELECT
                      CR.EZCANCELFLAG
                    , CR.EZUPTIME
                    , CR.EZUPTIMEZONE
                    , CR.CMPSN_CHNG_REQ_PK
                    , CR.GLBL_CMPY_CD
                    , CR.PRNT_MDSE_CD
                    , CR.CMPSN_PK
                    , CR.MDSE_CMPSN_TP_CD
                    , CR.CHILD_MDSE_CD
                    , CR.CHILD_ORD_TAKE_MDSE_CD
                    , CR.CHILD_MDSE_QTY
                    , CR.EFF_FROM_DT
                    , CR.EFF_THRU_DT
                    , CR.CUSA_MDSE_CD
                    , CR.CMPSN_REVN_NUM
                    , CR.ACTV_FLG
                    , CR.CMPSN_REVN_CMNT_TXT
                FROM
                      CMPSN_CHNG_REQ         CR
                WHERE
                        CR.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND CR.EZCANCELFLAG      = '0'
            UNION
                SELECT
                      C.EZCANCELFLAG
                    , C.EZUPTIME
                    , C.EZUPTIMEZONE
                    , C.CMPSN_CHNG_REQ_PK
                    , C.GLBL_CMPY_CD
                    , C.PRNT_MDSE_CD
                    , C.CMPSN_PK
                    , C.MDSE_CMPSN_TP_CD
                    , C.CHILD_MDSE_CD
                    , C.CHILD_ORD_TAKE_MDSE_CD
                    , C.CHILD_MDSE_QTY
                    , C.EFF_FROM_DT
                    , C.EFF_THRU_DT
                    , C.CUSA_MDSE_CD
                    , C.CMPSN_REVN_NUM
                    , C.ACTV_FLG
                    , C.CMPSN_REVN_CMNT_TXT
                FROM
                      CMP C
            UNION
                SELECT
                      CH.EZCANCELFLAG
                    , NULL AS EZUPTIME
                    , NULL AS EZUPTIMEZONE
                    , NULL AS CMPSN_CHNG_REQ_PK
                    , CH.GLBL_CMPY_CD
                    , CH.PRNT_MDSE_CD
                    , CH.CMPSN_PK
                    , CH.MDSE_CMPSN_TP_CD
                    , CH.CHILD_MDSE_CD
                    , CH.CHILD_ORD_TAKE_MDSE_CD
                    , CH.CHILD_MDSE_QTY
                    , CH.EFF_FROM_DT
                    , CH.EFF_THRU_DT
                    , CH.CUSA_MDSE_CD
                    , CH.CMPSN_REVN_NUM
                    , CH.ACTV_FLG
                    , CH.CMPSN_REVN_CMNT_TXT
                FROM
                      HIST               H
                    , CMPSN_HIST         CH
                WHERE
                        H.EZUPTIME       = CH.EZUPTIME
                    AND H.EZUPTIMEZONE   = CH.EZUPTIMEZONE
                    AND H.CMPSN_PK       = CH.CMPSN_PK
                    AND H.CMPSN_REVN_NUM = CH.CMPSN_REVN_NUM
                    AND CH.GLBL_CMPY_CD  = #glblCmpyCd#
                    AND CH.EZCANCELFLAG  = '0'
                    AND CH.HIST_ACT_NM   = #histActNm#
                    AND CH.ACTV_FLG     = 'N'
            )
            , MDSE_ALL AS
            (
                SELECT
                      MV.GLBL_CMPY_CD 
                    , MV.EZCANCELFLAG
                    , MV.MDSE_CD
                    , MV.MDSE_DESC_SHORT_TXT 
                    , MV.MDSE_ITEM_TP_CD
                    , MV.COA_MDSE_TP_CD
                    , CP.COA_PROJ_DESC_TXT
                    , MV.COA_PROD_CD
                FROM
                      ALL_MDSE_V  MV
                    , COA_PROJ    CP
                WHERE 
                    MV.GLBL_CMPY_CD = #glblCmpyCd#
                AND MV.EZCANCELFLAG = '0'
                AND MV.GLBL_CMPY_CD   = CP.GLBL_CMPY_CD
                AND MV.COA_MDSE_TP_CD = CP.COA_PROJ_CD
                AND CP.EZCANCELFLAG   = '0'
            )        
        
        SELECT
            *
        FROM
            (
            SELECT
                  X.MDSE_CD
                , X.MDSE_DESC_SHORT_TXT
                <!-- START 2018/07/12 S.Katsuma [QC#26542,MOD] -->
                , X.MDSE_ITEM_TP_NM
                <!-- START 2018/07/12 S.Katsuma [QC#26542,MOD] -->
                , X.CMPSN_REVN_NUM
                , X.COA_MDSE_TP_CD
                , X.COA_PROJ_DESC_TXT
                , X.COA_PROD_CD
                , X.EFF_FROM_DT
                , X.EFF_THRU_DT
                , X.ACTV_FLG
                , X.PRNT_CMPY_SET_MDSE_FLG
            FROM
                (
                SELECT 
                    *
                FROM
                    (
                        SELECT
                              M.MDSE_CD
                            , M.MDSE_DESC_SHORT_TXT
                            <!-- START 2018/07/12 S.Katsuma [QC#26542,MOD] -->
                            , MIT.MDSE_ITEM_TP_NM
                            <!-- END 2018/07/12 S.Katsuma [QC#26542,MOD] -->
                            , CPJ.COA_PROJ_DESC_TXT
                            , M.COA_PROD_CD || ':' || CPD.COA_PROD_NM AS COA_PROD
                            , M.COA_PROD_CD
                            , M.COA_MDSE_TP_CD
                            , M.PRNT_CMPY_SET_MDSE_FLG
                            , C.ACTV_FLG
                            , C.CMPSN_REVN_NUM
                            , C.CMPSN_REVN_CMNT_TXT
                            , C.EFF_FROM_DT
                            , C.EFF_THRU_DT
                            , MV1.MDSE_CD AS MDSE_CD_PR
                            , MV1.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT_PR
                            , C.CHILD_MDSE_QTY AS CHILD_MDSE_QTY_PR
                            , MV1.COA_PROJ_DESC_TXT AS COA_PROJ_DESC_TXT_PR
                            , MV1.COA_PROD_CD AS COA_PROD_CD_PR
                            , MV1.COA_MDSE_TP_CD AS COA_MDSE_TP_CD_PR
                            , CASE WHEN C.ACTV_FLG = 'Y'
                                   THEN #active#
                                   ELSE #inActive#
                              END ACTIVE_PR
                            , MV2.MDSE_CD AS MDSE_CD_PR2
                            , MV2.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT_PR2
                            , MV2.COA_PROJ_DESC_TXT AS COA_PROJ_DESC_TXT_PR2
                            , MV2.COA_PROD_CD AS COA_PROD_CD_PR2
                            , MV2.COA_MDSE_TP_CD AS COA_MDSE_TP_CD_PR2
                            , CH_C.CMPSN_REVN_NUM AS CMPSN_REVN_NUM_CH
                            , CH_C.CMPSN_REVN_CMNT_TXT AS CMPSN_REVN_CMNT_TXT_CH
                            , CH_C.EFF_FROM_DT AS EFF_FROM_DT_CH
                            , CH_C.EFF_THRU_DT AS EFF_THRU_DT_CH
                            , CH_MV1.MDSE_CD AS MDSE_CD_CH
                            , CH_MV1.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT_CH
                            , CH_C.CHILD_MDSE_QTY AS CHILD_MDSE_QTY_CH
                            , CH_MV1.COA_PROJ_DESC_TXT AS COA_PROJ_DESC_TXT_CH
                            , CH_MV1.COA_PROD_CD AS COA_PROD_CD_CH
                            , CASE WHEN CH_C.ACTV_FLG = 'Y' 
                                   THEN #active#
                                   ELSE #inActive#
                              END ACTIVE_CH
                            , CH_MV2.MDSE_CD AS MDSE_CD_CH2
                            , CH_MV2.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT_CH2
                            , CH_MV2.COA_PROJ_DESC_TXT AS COA_PROJ_DESC_TXT_CH2
                            , CH_MV2.COA_PROD_CD AS COA_PROD_CD_CH2
                        FROM
                              MDSE         M
                            , MDSE_ITEM_TP MIT
                            , COA_PROJ     CPJ
                            , COA_PROD     CPD
                            , CMP_ALL     C
                            , MDSE_ALL    MV1
                            , MDSE_ALL    MV2
                            , CMPSN       CH_C
                            , MDSE_ALL    CH_MV1
                            , MDSE_ALL    CH_MV2
                        WHERE
                                M.GLBL_CMPY_CD = #glblCmpyCd#
                            AND M.EZCANCELFLAG = '0'
                        <isNotNull property="mdseCd_BO">
                            AND M.MDSE_CD LIKE #mdseCd_BO#
                        </isNotNull>
                        <isNotNull property="mdseDescShortTxt_BO">
                            AND M.MDSE_DESC_SHORT_TXT LIKE #mdseDescShortTxt_BO#
                        </isNotNull>
                        <isNotNull property="coaProdCd_BO">
                            AND M.COA_PROD_CD       = #coaProdCd_BO#
                        </isNotNull>
                            AND M.MDSE_ITEM_TP_CD   IN (#mdseItemTpCd_Set#, #mdseItemTpCd_Kit#)
                        <isNotNull property="coaMdseTpCd_BO">
                            AND M.COA_MDSE_TP_CD    = #coaMdseTpCd_BO#
                        </isNotNull>
                        <isNotNull property="mdseItemTpCd_BO">
                            AND M.MDSE_ITEM_TP_CD   = #mdseItemTpCd_BO#
                        </isNotNull>
                            AND M.GLBL_CMPY_CD      = MIT.GLBL_CMPY_CD
                            AND M.MDSE_ITEM_TP_CD   = MIT.MDSE_ITEM_TP_CD
                            AND MIT.EZCANCELFLAG    = '0'
                            AND M.GLBL_CMPY_CD      = CPJ.GLBL_CMPY_CD
                            AND M.COA_MDSE_TP_CD    = CPJ.COA_PROJ_CD
                            AND CPJ.EZCANCELFLAG    = '0'
                            AND M.GLBL_CMPY_CD      = CPD.GLBL_CMPY_CD
                            AND M.COA_PROD_CD       = CPD.COA_PROD_CD
                            AND CPD.EZCANCELFLAG    = '0'
                            AND M.MDSE_CD           = C.PRNT_MDSE_CD (+)
                        <isNotNull property="effFromDt_BO">
                            AND C.EFF_FROM_DT        = #effFromDt_BO#
                        </isNotNull>
                        <isNotNull property="effThruDt_BO">
                            AND NVL(C.EFF_THRU_DT,'99991231') = #effThruDt_BO#
                        </isNotNull>
                        <isNotNull property="cmpsnRevnNum_BO">
                            AND C.CMPSN_REVN_NUM     = #cmpsnRevnNum_BO#
                        </isNotNull>
                        <isNotNull property="actvFlg_BO">
                            AND C.ACTV_FLG (+)         = #actvFlg_BO#
                        </isNotNull>
                            AND C.GLBL_CMPY_CD         = MV1.GLBL_CMPY_CD (+)
                            AND C.CHILD_MDSE_CD        = MV1.MDSE_CD (+)
                            AND MV1.EZCANCELFLAG (+)   = '0'
                            AND C.GLBL_CMPY_CD           = MV2.GLBL_CMPY_CD (+)
                            AND C.CHILD_ORD_TAKE_MDSE_CD = MV2.MDSE_CD (+)
                            AND MV2.EZCANCELFLAG (+)     = '0'
                            AND MV1.GLBL_CMPY_CD        = CH_C.GLBL_CMPY_CD (+)
                            AND MV1.MDSE_CD             = CH_C.PRNT_MDSE_CD (+)
                            AND CH_C.EZCANCELFLAG (+)   = '0'
                        <isNotNull property="mdseCmpsnTpCd_CO">
                            AND CH_C.MDSE_CMPSN_TP_CD (+)  = #mdseCmpsnTpCd_CO#
                        </isNotNull>
                        <isNotNull property="effFromDt_CO">
                            AND CH_C.EFF_FROM_DT (+)       = #effFromDt_CO#
                        </isNotNull>
                        <isNotNull property="effThruDt_CO">
                            AND NVL(CH_C.EFF_THRU_DT (+),'99991231') = #effThruDt_CO#
                        </isNotNull>
                        <isNotNull property="cmpsnRevnNum_CO">
                            AND CH_C.CMPSN_REVN_NUM (+)     = #cmpsnRevnNum_CO#
                        </isNotNull>
                        <isNotNull property="actvFlg_CO">
                            AND CH_C.ACTV_FLG (+)          = #actvFlg_CO#
                        </isNotNull>
                            AND CH_C.GLBL_CMPY_CD          = CH_MV1.GLBL_CMPY_CD (+)
                            AND CH_C.CHILD_MDSE_CD         = CH_MV1.MDSE_CD (+)
                            AND CH_MV1.EZCANCELFLAG (+)    = '0'
                            AND CH_C.GLBL_CMPY_CD           = CH_MV2.GLBL_CMPY_CD (+)
                            AND CH_C.CHILD_ORD_TAKE_MDSE_CD = CH_MV2.MDSE_CD (+)
                            AND CH_MV2.EZCANCELFLAG (+)     = '0'
                        ORDER BY
                              M.MDSE_CD
                            , C.CMPSN_REVN_NUM DESC
                            , C.CMPSN_PK
                            , CH_C.CMPSN_PK
                    )
                WHERE       
                     1 = 1
                  <isNotNull property="mdseCd_CO">
                    AND ( MDSE_CD_PR LIKE #mdseCd_CO# OR MDSE_CD_PR2 LIKE #mdseCd_CO# )
                  </isNotNull>
                  <isNotNull property="mdseDescShortTxt_CO">
                    AND ( MDSE_DESC_SHORT_TXT_PR LIKE #mdseDescShortTxt_CO# OR MDSE_DESC_SHORT_TXT_PR2 LIKE #mdseDescShortTxt_CO# )
                  </isNotNull>
                  <isNotNull property="coaMdseTpCd_CO">
                    AND ( COA_MDSE_TP_CD_PR = #coaMdseTpCd_CO# OR COA_MDSE_TP_CD_PR2 = #coaMdseTpCd_CO# )
                  </isNotNull>
                  <isNotNull property="coaProdCd_CO">
                    AND ( COA_PROD_CD_PR = #coaProdCd_CO# OR COA_PROD_CD_PR2 = #coaProdCd_CO# )
                  </isNotNull>
                ) X
            GROUP BY
                      X.MDSE_CD
                    , X.MDSE_DESC_SHORT_TXT
                    <!-- START 2018/07/12 S.Katsuma [QC#26542,MOD] -->
                    , X.MDSE_ITEM_TP_NM
                    <!-- END 2018/07/12 S.Katsuma [QC#26542,MOD] -->
                    , X.CMPSN_REVN_NUM
                    , X.COA_MDSE_TP_CD
                    , X.COA_PROJ_DESC_TXT
                    , X.COA_PROD_CD
                    , X.EFF_FROM_DT
                    , X.EFF_THRU_DT
                    , X.ACTV_FLG
                    , X.PRNT_CMPY_SET_MDSE_FLG
            ORDER BY
                  X.MDSE_CD
            )
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>
    <resultMap id="result.getBomList" class="NMAL0230_ASMsg">
        <result property="mdseCd_A"         column="MDSE_CD"           javaType="EZDSStringItem"/>
        <result property="mdseDescShortTxt_A" column="MDSE_DESC_SHORT_TXT" javaType="EZDSStringItem"/>
        <result property="mdseItemTpNm_A"   column="MDSE_ITEM_TP_NM"   javaType="EZDSStringItem"/>
        <result property="cmpsnRevnNum_A"   column="CMPSN_REVN_NUM"    javaType="EZDSBigDecimalItem"/>
        <!-- Mod Start 2016/12/12 T.Aoi S21_NA#16591 -->
        <!--
        <result property="coaMdseTpNm_A"    column="COA_MDSE_TP_NM"    javaType="EZDSStringItem"/>
        -->
        <result property="coaProjDescTxt_A"    column="COA_PROJ_DESC_TXT"    javaType="EZDSStringItem"/>
        <!-- Mod End   2016/12/12 T.Aoi S21_NA#16591 -->
        <result property="coaProdCd_A"      column="COA_PROD_CD"       javaType="EZDSStringItem"/>
        <result property="effFromDt_A"      column="EFF_FROM_DT"       javaType="EZDSStringItem"/>
        <result property="effThruDt_A"      column="EFF_THRU_DT"       javaType="EZDSStringItem"/>
        <result property="actvFlg_A"        column="ACTV_FLG"          javaType="EZDSStringItem"/>
    </resultMap>
    <statement id="getRevisionForCsv" parameterClass="Map" resultClass="Map">
        WITH
             CMP AS (
                SELECT
                      C.EZCANCELFLAG
                    , C.EZUPTIME
                    , C.EZUPTIMEZONE
                    , NULL AS CMPSN_CHNG_REQ_PK
                    , C.GLBL_CMPY_CD
                    , C.PRNT_MDSE_CD
                    , C.CMPSN_PK
                    , C.MDSE_CMPSN_TP_CD
                    , C.CHILD_MDSE_CD
                    , C.CHILD_ORD_TAKE_MDSE_CD
                    , C.CHILD_MDSE_QTY
                    , C.EFF_FROM_DT
                    , C.EFF_THRU_DT
                    , C.CUSA_MDSE_CD
                    , C.CMPSN_REVN_NUM
                    , C.ACTV_FLG
                    , C.CMPSN_REVN_CMNT_TXT
                FROM
                      CMPSN         C
                WHERE
                        C.GLBL_CMPY_CD  = #glblCmpyCd#
                    AND C.EZCANCELFLAG  = '0'
            )
           , HIST AS (
                 SELECT
                      MAX(CH.EZUPTIME)     AS EZUPTIME
                    , MAX(CH.EZUPTIMEZONE) AS EZUPTIMEZONE
                    , CH.CMPSN_PK
                    , CH.CMPSN_REVN_NUM
                FROM
                      CMPSN_HIST         CH
                WHERE   CH.GLBL_CMPY_CD  = #glblCmpyCd#
                    AND CH.EZCANCELFLAG  = '0'
                    AND CH.HIST_ACT_NM   = #histActNm#
                    AND CH.ACTV_FLG     = 'N'
                GROUP BY CH.CMPSN_PK, CH.CMPSN_REVN_NUM
           )
           , CMP_ALL AS (
                SELECT
                      CR.EZCANCELFLAG
                    , CR.EZUPTIME
                    , CR.EZUPTIMEZONE
                    , CR.CMPSN_CHNG_REQ_PK
                    , CR.GLBL_CMPY_CD
                    , CR.PRNT_MDSE_CD
                    , CR.CMPSN_PK
                    , CR.MDSE_CMPSN_TP_CD
                    , CR.CHILD_MDSE_CD
                    , CR.CHILD_ORD_TAKE_MDSE_CD
                    , CR.CHILD_MDSE_QTY
                    , CR.EFF_FROM_DT
                    , CR.EFF_THRU_DT
                    , CR.CUSA_MDSE_CD
                    , CR.CMPSN_REVN_NUM
                    , CR.ACTV_FLG
                    , CR.CMPSN_REVN_CMNT_TXT
                FROM
                      CMPSN_CHNG_REQ         CR
                WHERE
                        CR.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND CR.EZCANCELFLAG      = '0'
            UNION
                SELECT
                      C.EZCANCELFLAG
                    , C.EZUPTIME
                    , C.EZUPTIMEZONE
                    , C.CMPSN_CHNG_REQ_PK
                    , C.GLBL_CMPY_CD
                    , C.PRNT_MDSE_CD
                    , C.CMPSN_PK
                    , C.MDSE_CMPSN_TP_CD
                    , C.CHILD_MDSE_CD
                    , C.CHILD_ORD_TAKE_MDSE_CD
                    , C.CHILD_MDSE_QTY
                    , C.EFF_FROM_DT
                    , C.EFF_THRU_DT
                    , C.CUSA_MDSE_CD
                    , C.CMPSN_REVN_NUM
                    , C.ACTV_FLG
                    , C.CMPSN_REVN_CMNT_TXT
                FROM
                      CMP C
            UNION
                SELECT
                      CH.EZCANCELFLAG
                    , NULL AS EZUPTIME
                    , NULL AS EZUPTIMEZONE
                    , NULL AS CMPSN_CHNG_REQ_PK
                    , CH.GLBL_CMPY_CD
                    , CH.PRNT_MDSE_CD
                    , CH.CMPSN_PK
                    , CH.MDSE_CMPSN_TP_CD
                    , CH.CHILD_MDSE_CD
                    , CH.CHILD_ORD_TAKE_MDSE_CD
                    , CH.CHILD_MDSE_QTY
                    , CH.EFF_FROM_DT
                    , CH.EFF_THRU_DT
                    , CH.CUSA_MDSE_CD
                    , CH.CMPSN_REVN_NUM
                    , CH.ACTV_FLG
                    , CH.CMPSN_REVN_CMNT_TXT
                FROM
                      HIST               H
                    , CMPSN_HIST         CH
                WHERE
                        H.EZUPTIME       = CH.EZUPTIME
                    AND H.EZUPTIMEZONE   = CH.EZUPTIMEZONE
                    AND H.CMPSN_PK       = CH.CMPSN_PK
                    AND H.CMPSN_REVN_NUM = CH.CMPSN_REVN_NUM
                    AND CH.GLBL_CMPY_CD  = #glblCmpyCd#
                    AND CH.EZCANCELFLAG  = '0'
                    AND CH.HIST_ACT_NM   = #histActNm#
                    AND CH.ACTV_FLG     = 'N'
            )
            , MDSE_ALL AS
            (
                SELECT
                      MV.GLBL_CMPY_CD 
                    , MV.EZCANCELFLAG
                    , MV.MDSE_CD
                    , MV.MDSE_DESC_SHORT_TXT 
                    , MV.MDSE_ITEM_TP_CD
                    , MV.COA_MDSE_TP_CD
                    , CP.COA_PROJ_DESC_TXT
                    , MV.COA_PROD_CD
                FROM
                      ALL_MDSE_V  MV
                    , COA_PROJ    CP
                WHERE 
                    MV.GLBL_CMPY_CD = #glblCmpyCd#
                AND MV.EZCANCELFLAG = '0'
                AND MV.GLBL_CMPY_CD   = CP.GLBL_CMPY_CD
                AND MV.COA_MDSE_TP_CD = CP.COA_PROJ_CD
                AND CP.EZCANCELFLAG   = '0'
            )        
        
        SELECT 
            *
        FROM
            (
                SELECT
                      M.MDSE_CD
                    , M.MDSE_DESC_SHORT_TXT
                    <!-- START 2018/07/12 S.Katsuma [QC#26542,MOD] -->
                    , MIT.MDSE_ITEM_TP_NM
                    <!-- END 2018/07/12 S.Katsuma [QC#26542,MOD] -->
                    , CPJ.COA_PROJ_DESC_TXT
                    , M.COA_PROD_CD || ':' || CPD.COA_PROD_NM AS COA_PROD
                    , CSA.MDSE_CD AS CSA_MDSE_CD
                    , C.ACTV_FLG
                    , C.CMPSN_REVN_NUM
                    , C.CMPSN_REVN_CMNT_TXT
                    , C.EFF_FROM_DT
                    , C.EFF_THRU_DT
                    , MV1.MDSE_CD AS MDSE_CD_PR
                    , MV1.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT_PR
                    , C.CHILD_MDSE_QTY AS CHILD_MDSE_QTY_PR
                    , MV1.COA_PROJ_DESC_TXT AS COA_PROJ_DESC_TXT_PR
                    , MV1.COA_PROD_CD AS COA_PROD_CD_PR
                    , MV1.COA_MDSE_TP_CD AS COA_MDSE_TP_CD_PR
                    , CASE WHEN C.ACTV_FLG = 'Y'
                           THEN #active#
                           ELSE #inActive#
                      END ACTIVE_PR

                    , MV2.MDSE_CD AS MDSE_CD_PR2
                    , MV2.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT_PR2
                    , MV2.COA_PROJ_DESC_TXT AS COA_PROJ_DESC_TXT_PR2
                    , MV2.COA_PROD_CD AS COA_PROD_CD_PR2
                    , MV2.COA_MDSE_TP_CD AS COA_MDSE_TP_CD_PR2

                    , CH_C.CMPSN_REVN_NUM AS CMPSN_REVN_NUM_CH
                    , CH_C.CMPSN_REVN_CMNT_TXT AS CMPSN_REVN_CMNT_TXT_CH
                    , CH_C.EFF_FROM_DT AS EFF_FROM_DT_CH
                    , CH_C.EFF_THRU_DT AS EFF_THRU_DT_CH
                    , CH_MV1.MDSE_CD AS MDSE_CD_CH
                    , CH_MV1.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT_CH
                    , CH_C.CHILD_MDSE_QTY AS CHILD_MDSE_QTY_CH
                    , CH_MV1.COA_PROJ_DESC_TXT AS COA_PROJ_DESC_TXT_CH
                    , CH_MV1.COA_PROD_CD AS COA_PROD_CD_CH
                    , CASE WHEN CH_C.ACTV_FLG = 'Y' 
                           THEN #active#
                           ELSE #inActive#
                      END ACTIVE_CH

                    , CH_MV2.MDSE_CD AS MDSE_CD_CH2
                    , CH_MV2.MDSE_DESC_SHORT_TXT AS MDSE_DESC_SHORT_TXT_CH2
                    , CH_MV2.COA_PROJ_DESC_TXT AS COA_PROJ_DESC_TXT_CH2
                    , CH_MV2.COA_PROD_CD AS COA_PROD_CD_CH2
                FROM
                      MDSE         M
                    , MDSE_ITEM_TP MIT
                    , COA_PROJ     CPJ
                    , COA_PROD     CPD
                    , $cusaMdse$   CSA
                    , CMP_ALL     C
                    , MDSE_ALL    MV1
                    , MDSE_ALL    MV2
                    , CMPSN       CH_C
                    , MDSE_ALL    CH_MV1
                    , MDSE_ALL    CH_MV2
                WHERE
                        M.GLBL_CMPY_CD = #glblCmpyCd#
                    AND M.EZCANCELFLAG = '0'
                <isNotNull property="mdseCd_BO">
                    AND M.MDSE_CD LIKE #mdseCd_BO#
                </isNotNull>
                <isNotNull property="mdseDescShortTxt_BO">
                    AND M.MDSE_DESC_SHORT_TXT LIKE #mdseDescShortTxt_BO#
                </isNotNull>
                <isNotNull property="coaProdCd_BO">
                    AND M.COA_PROD_CD  = #coaProdCd_BO#
                </isNotNull>
                    AND M.MDSE_ITEM_TP_CD   IN (#mdseItemTpCd_Set#, #mdseItemTpCd_Kit#)
                    AND M.EZCANCELFLAG      = '0'
                <isNotNull property="coaMdseTpCd_BO">
                    AND M.COA_MDSE_TP_CD    = #coaMdseTpCd_BO#
                </isNotNull>
                <isNotNull property="mdseItemTpCd_BO">
                    AND M.MDSE_ITEM_TP_CD   = #mdseItemTpCd_BO#
                </isNotNull>
                    AND M.GLBL_CMPY_CD      = MIT.GLBL_CMPY_CD
                    AND M.MDSE_ITEM_TP_CD   = MIT.MDSE_ITEM_TP_CD
                    AND MIT.EZCANCELFLAG    = '0'
                    AND M.GLBL_CMPY_CD      = CPJ.GLBL_CMPY_CD
                    AND M.COA_MDSE_TP_CD    = CPJ.COA_PROJ_CD
                    AND CPJ.EZCANCELFLAG    = '0'
                    AND M.GLBL_CMPY_CD      = CPD.GLBL_CMPY_CD
                    AND M.COA_PROD_CD       = CPD.COA_PROD_CD
                    AND CPD.EZCANCELFLAG    = '0'
                    AND CSA.GLBL_CMPY_CD (+) = #cusaGlblCmpyCd#
                    AND CSA.MDSE_TP_CD (+)   = #mdseTpCd_Set#
                    AND M.MDSE_CD            = CSA.MDSE_CD (+)
                    AND CSA.EZCANCELFLAG (+) = '0'
                    AND M.MDSE_CD            = C.PRNT_MDSE_CD (+)
                <isNotNull property="effFromDt_BO">
                    AND C.EFF_FROM_DT        = #effFromDt_BO#
                </isNotNull>
                <isNotNull property="effThruDt_BO">
                    AND NVL(C.EFF_THRU_DT,'99991231') = #effThruDt_BO#
                </isNotNull>
                <isNotNull property="cmpsnRevnNum_BO">
                    AND C.CMPSN_REVN_NUM     = #cmpsnRevnNum_BO#
                </isNotNull>
                <isNotNull property="actvFlg_BO">
                    AND C.ACTV_FLG           = #actvFlg_BO#
                </isNotNull>
                    AND C.GLBL_CMPY_CD         = MV1.GLBL_CMPY_CD (+)
                    AND C.CHILD_MDSE_CD        = MV1.MDSE_CD (+)
                    AND MV1.EZCANCELFLAG (+)   = '0'
                    AND C.GLBL_CMPY_CD           = MV2.GLBL_CMPY_CD (+)
                    AND C.CHILD_ORD_TAKE_MDSE_CD = MV2.MDSE_CD (+)
                    AND MV2.EZCANCELFLAG (+)     = '0'
                    AND MV1.GLBL_CMPY_CD        = CH_C.GLBL_CMPY_CD (+)
                    AND MV1.MDSE_CD             = CH_C.PRNT_MDSE_CD (+)
                    AND CH_C.EZCANCELFLAG (+)   = '0'
                <isNotNull property="mdseCmpsnTpCd_CO">
                    AND CH_C.MDSE_CMPSN_TP_CD  = #mdseCmpsnTpCd_CO#
                </isNotNull>
                <isNotNull property="effFromDt_CO">
                    AND CH_C.EFF_FROM_DT       = #effFromDt_CO#
                </isNotNull>
                <isNotNull property="effThruDt_CO">
                    AND NVL(CH_C.EFF_THRU_DT,'99991231') = #effThruDt_CO#
                </isNotNull>
                <isNotNull property="cmpsnRevnNum_CO">
                    AND CH_C.CMPSN_REVN_NUM    = #cmpsnRevnNum_CO#
                </isNotNull>
                <isNotNull property="actvFlg_CO">
                    AND CH_C.ACTV_FLG (+)         = #actvFlg_CO#
                </isNotNull>
                    AND CH_C.GLBL_CMPY_CD      = CH_MV1.GLBL_CMPY_CD (+)
                    AND CH_C.CHILD_MDSE_CD     = CH_MV1.MDSE_CD (+)
                    AND CH_MV1.EZCANCELFLAG (+) = '0'
                    AND CH_C.GLBL_CMPY_CD           = CH_MV2.GLBL_CMPY_CD (+)
                    AND CH_C.CHILD_ORD_TAKE_MDSE_CD = CH_MV2.MDSE_CD (+)
                    AND CH_MV2.EZCANCELFLAG (+)      = '0'
                ORDER BY
                      M.MDSE_CD
                    , C.CMPSN_REVN_NUM DESC
                    , C.CMPSN_PK
                    , CH_C.CMPSN_PK
            )
        WHERE       
             1 = 1
          <isNotNull property="mdseCd_CO">
            AND ( MDSE_CD_PR LIKE #mdseCd_CO# OR MDSE_CD_PR2 LIKE #mdseCd_CO# )
          </isNotNull>
          <isNotNull property="mdseDescShortTxt_CO">
            AND ( MDSE_DESC_SHORT_TXT_PR LIKE #mdseDescShortTxt_CO# OR MDSE_DESC_SHORT_TXT_PR2 LIKE #mdseDescShortTxt_CO# )
          </isNotNull>
          <isNotNull property="coaMdseTpCd_CO">
            AND ( COA_MDSE_TP_CD_PR = #coaMdseTpCd_CO# OR COA_MDSE_TP_CD_PR2 = #coaMdseTpCd_CO# )
          </isNotNull>
          <isNotNull property="coaProdCd_CO">
            AND ( COA_PROD_CD_PR = #coaProdCd_CO# OR COA_PROD_CD_PR2 = #coaProdCd_CO# )
          </isNotNull>
    </statement>
</sqlMap>
