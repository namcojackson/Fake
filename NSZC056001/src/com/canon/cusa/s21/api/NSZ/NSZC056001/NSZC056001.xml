<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSZC056001">
    <statement id="getTargetDsContrBllgSchdNonFleet" parameterClass="Map" resultClass="Map">
        SELECT
            <!-- START 2018/10/24 K.Kitachi [QC#28579, ADD] -->
            /*+ INDEX(A DS_CONTR_BLLG_SCHD_I1) */
            /*+ INDEX(E SVC_CONTR_BLLG_I9) */
            <!-- END 2018/10/24 K.Kitachi [QC#28579, ADD] -->
             A.BASE_ACTL_PRC_DEAL_AMT
            ,A.BASE_CHRG_FLG
            ,B.BASE_INV_UP_TO_DT
            ,A.BLLG_SCHD_FROM_DT
            ,A.BLLG_SCHD_THRU_DT
            ,A.DS_CONTR_BLLG_SCHD_PK
            ,A.INV_TP_CD
            ,B.MTR_INV_UP_TO_DT
            ,A.PRNT_DS_CONTR_DTL_PK
            ,A.SVC_CR_REBIL_PK
            ,A.SVC_CR_REBIL_DTL_PK
            ,A.USG_CHRG_FLG
            ,I.PER_BLLG_CYCLE_CD
            ,I.PER_SCHD_NUM
            ,A.BASE_PRC_ADJ_DEAL_AMT
            ,A.BASE_PRC_ADJ_FUNC_AMT
            ,A.SVC_PHYS_MTR_READ_GRP_SQ
            ,A.DS_CONTR_BLLG_SCHD_PK
            ,B.DS_CONTR_DTL_PK
            ,H.BLLG_CYCLE_MTH_AOT  AS BASE_BLLG_CYCLE_MTH_AOT
            ,B.BASE_BILL_TO_CUST_CD
            ,B.USG_BILL_TO_CUST_CD
            ,B.BASE_INV_UP_TO_DT
            ,B.BASE_BLLG_LAST_BLLG_DT
            ,E.BASE_BLLG_NEXT_BLLG_DT
            ,B.BASE_BLLG_TMG_CD
            ,B.CONTR_CLO_DAY
            ,B.DS_CONTR_DTL_TP_CD
            ,B.MTR_BLLG_TMG_CD
            ,B.MTR_CLO_DAY
            ,B.PRNT_DS_CONTR_DTL_PK
            ,B.SVC_MACH_MSTR_PK
            ,B.SVC_PGM_MDSE_CD
            ,C.CCY_CD
            ,C.DS_ACCT_NUM
            ,C.DS_CONTR_CATG_CD
            ,C.DS_CONTR_PK
            ,C.TOC_CD
            <!-- START 2019/09/04 T.Aoyagi [QC#53124,ADD] -->
            ,C.SVC_LINE_BIZ_CD
            <!-- END 2019/09/04 T.Aoyagi [QC#53124,ADD] -->
            <isNotNull property="dsContrBllgMtrPk">
            ,D.DS_CONTR_BLLG_MTR_PK
            ,D.BLLG_MTR_BILL_TO_CUST_CD
            ,NVL(D.INTG_MDSE_CD, B.SVC_PGM_MDSE_CD)  AS INTG_MDSE_CD
            ,D.XS_CHRG_TP_CD
            </isNotNull>
            <isNull property="dsContrBllgMtrPk">
            ,NULL                 AS DS_CONTR_BLLG_MTR_PK
            ,NULL                 AS BLLG_MTR_BILL_TO_CUST_CD
            ,NULL                 AS INTG_MDSE_CD
            ,NULL                 AS XS_CHRG_TP_CD
             </isNull>
            ,H.BLLG_CYCLE_MTH_AOT  AS MTR_BLLG_CYCLE_MTH_AOT
            <!-- START 2018/03/20 K.Kojima [QC#23623,ADD] -->
            ,H.PRRT_DIV_RATE
            <!-- END 2018/03/20 K.Kojima [QC#23623,ADD] -->
            ,E.SVC_CONTR_BLLG_PK
            ,E.SVC_CONTR_BLLG_GRP_SQ
            ,B.MTR_INV_UP_TO_DT
            ,B.MTR_BLLG_LAST_BLLG_DT
            ,E.MTR_BLLG_NEXT_BLLG_DT 
            ,F.ORIG_SVC_INV_NUM
            ,G.AFT_DECL_PNT_DIGIT_NUM
        FROM
             DS_CONTR_BLLG_SCHD         A
            ,DS_CONTR_DTL               B
            ,DS_CONTR                   C
            <isNotNull property="dsContrBllgMtrPk">
            ,DS_CONTR_BLLG_MTR          D
            </isNotNull>
            ,SVC_CONTR_BLLG             E
            ,SVC_CR_REBIL_DTL           F
            ,CCY                        G
            ,BLLG_CYCLE                 H
            ,DS_CONTR_BLLG_SCHD_SMRY    I
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.DS_CONTR_DTL_PK       = #dsContrDtlPk#
            AND A.NEXT_BLLG_DT          = #nextBllgDt#
            <isNotNull property="svcCrRebilDtlPk">
            AND A.SVC_CR_REBIL_DTL_PK       = #svcCrRebilDtlPk#
            </isNotNull>
            <!-- START 2018/08/29 K.Kojima [QC#28012,ADD] -->
            <isNull property="bllgSchdFromDt">
            <!-- END 2018/08/29 K.Kojima [QC#28012,ADD] -->
            <!-- START 2018/06/21 K.Kitachi [QC#22251, ADD] -->
            <isNull property="svcCrRebilDtlPk">
            AND A.SVC_CR_REBIL_DTL_PK   IS NULL
            </isNull>
            <!-- END 2018/06/21 K.Kitachi [QC#22251, ADD] -->
            <!-- START 2018/08/29 K.Kojima [QC#28012,ADD] -->
            </isNull>
            <!-- END 2018/08/29 K.Kojima [QC#28012,ADD] -->
            <!-- START 2018/08/29 K.Kojima [QC#28012,ADD] -->
            <isNotNull property="bllgSchdFromDt">
            AND A.BLLG_SCHD_FROM_DT     = #bllgSchdFromDt#
            </isNotNull>
            <!-- END 2018/08/29 K.Kojima [QC#28012,ADD] -->
            AND A.BASE_CHRG_FLG         = #baseChrgFlg#
            AND A.USG_CHRG_FLG          = #usgChrgFlg#
            <isNotNull property="dsContrBllgMtrPk">
            AND A.DS_CONTR_BLLG_MTR_PK  = #dsContrBllgMtrPk#
            </isNotNull>
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK       = B.DS_CONTR_DTL_PK
            AND B.EZCANCELFLAG          = '0'
            AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND B.DS_CONTR_PK           = C.DS_CONTR_PK
            AND C.EZCANCELFLAG          = '0'
            <isNotNull property="dsContrBllgMtrPk">
            AND A.GLBL_CMPY_CD          = D.GLBL_CMPY_CD(+)
            AND A.DS_CONTR_DTL_PK       = D.DS_CONTR_DTL_PK(+)
            AND A.DS_CONTR_BLLG_MTR_PK  = D.DS_CONTR_BLLG_MTR_PK
            AND D.EZCANCELFLAG(+)       = '0'
            </isNotNull>
            AND A.GLBL_CMPY_CD          = E.GLBL_CMPY_CD
            AND A.DS_CONTR_BLLG_SCHD_PK = E.DS_CONTR_BLLG_SCHD_PK
            AND E.ADDL_CHRG_FLG         = 'N'
            AND E.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = F.GLBL_CMPY_CD(+)
            AND A.SVC_CR_REBIL_DTL_PK   = F.SVC_CR_REBIL_DTL_PK(+)
            AND F.EZCANCELFLAG(+)       = '0'
            AND C.GLBL_CMPY_CD          = G.GLBL_CMPY_CD
            AND C.CCY_CD                = G.CCY_CD
            AND G.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = H.GLBL_CMPY_CD
            AND A.BLLG_CYCLE_CD         = H.BLLG_CYCLE_CD
            AND H.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = I.GLBL_CMPY_CD
            AND A.DS_CONTR_BLLG_SCHD_SMRY_PK    = I.DS_CONTR_BLLG_SCHD_SMRY_PK
            AND I.EZCANCELFLAG          = '0'
        ORDER BY
             A.PRNT_DS_CONTR_DTL_PK NULLS FIRST
            ,A.BASE_CHRG_FLG        DESC
            ,A.USG_CHRG_FLG         DESC
            ,A.NEXT_BLLG_DT
            ,A.DS_CONTR_DTL_PK
            ,A.DS_CONTR_BLLG_MTR_PK
    </statement>
    <statement id="getTargetDsContrBllgSchdFleetAggregateChild" parameterClass="Map" resultClass="Map">
        SELECT
             A.BASE_ACTL_PRC_DEAL_AMT
            ,A.BASE_CHRG_FLG
            ,B.BASE_INV_UP_TO_DT
            ,A.BLLG_SCHD_FROM_DT
            ,A.BLLG_SCHD_THRU_DT
            ,A.DS_CONTR_BLLG_SCHD_PK
            ,A.INV_TP_CD
            ,B.MTR_INV_UP_TO_DT
            ,A.PRNT_DS_CONTR_DTL_PK
            ,A.SVC_CR_REBIL_PK
            ,A.SVC_CR_REBIL_DTL_PK
            ,A.USG_CHRG_FLG
            ,I.PER_BLLG_CYCLE_CD
            ,I.PER_SCHD_NUM
            ,A.BASE_PRC_ADJ_DEAL_AMT
            ,A.BASE_PRC_ADJ_FUNC_AMT
            ,A.SVC_PHYS_MTR_READ_GRP_SQ
            ,B.DS_CONTR_DTL_PK
            ,H.BLLG_CYCLE_MTH_AOT  AS BASE_BLLG_CYCLE_MTH_AOT
            ,B.BASE_BILL_TO_CUST_CD
            ,B.USG_BILL_TO_CUST_CD
            ,B.BASE_INV_UP_TO_DT
            ,B.BASE_BLLG_LAST_BLLG_DT
            ,E.BASE_BLLG_NEXT_BLLG_DT
            ,B.BASE_BLLG_TMG_CD
            ,B.CONTR_CLO_DAY
            ,B.DS_CONTR_DTL_TP_CD
            ,B.MTR_BLLG_TMG_CD
            ,B.MTR_CLO_DAY
            ,B.PRNT_DS_CONTR_DTL_PK
            ,B.SVC_MACH_MSTR_PK
            ,B.SVC_PGM_MDSE_CD
            ,C.CCY_CD
            ,C.DS_ACCT_NUM
            ,C.DS_CONTR_CATG_CD
            ,C.DS_CONTR_PK
            ,C.TOC_CD
            ,D.DS_CONTR_BLLG_MTR_PK
            ,D.BLLG_MTR_BILL_TO_CUST_CD
            ,NVL(D.INTG_MDSE_CD, B.SVC_PGM_MDSE_CD)  AS INTG_MDSE_CD
            ,D.XS_CHRG_TP_CD
            ,H.BLLG_CYCLE_MTH_AOT  AS MTR_BLLG_CYCLE_MTH_AOT
            <!-- START 2018/03/20 K.Kojima [QC#23623,ADD] -->
            ,H.PRRT_DIV_RATE
            <!-- END 2018/03/20 K.Kojima [QC#23623,ADD] -->
            ,E.SVC_CONTR_BLLG_PK
            ,E.SVC_CONTR_BLLG_GRP_SQ
            ,B.MTR_INV_UP_TO_DT
            ,B.MTR_BLLG_LAST_BLLG_DT
            ,E.MTR_BLLG_NEXT_BLLG_DT 
            ,F.ORIG_SVC_INV_NUM
            ,G.AFT_DECL_PNT_DIGIT_NUM
        FROM
             DS_CONTR_BLLG_SCHD         A
            ,DS_CONTR_DTL               B
            ,DS_CONTR                   C
            ,DS_CONTR_BLLG_MTR          D
            ,SVC_CONTR_BLLG             E
            ,SVC_CR_REBIL_DTL           F
            ,CCY                        G
            ,BLLG_CYCLE                 H
            ,DS_CONTR_BLLG_SCHD         Z
            ,DS_CONTR_BLLG_SCHD_SMRY    I
        WHERE
                A.GLBL_CMPY_CD                     = #glblCmpyCd#
            AND A.EZCANCELFLAG                     = '0'
            AND A.PRNT_DS_CONTR_BLLG_SCHD_PK       = #prntDsContrBllgSchdPk#
            AND A.BASE_CHRG_FLG                    = #baseChrgFlg#
            AND A.USG_CHRG_FLG                     = #usgChrgFlg#
            AND A.GLBL_CMPY_CD                     = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK                  = B.DS_CONTR_DTL_PK
            AND B.EZCANCELFLAG                     = '0'
            AND B.GLBL_CMPY_CD                     = C.GLBL_CMPY_CD
            AND B.DS_CONTR_PK                      = C.DS_CONTR_PK
            AND C.EZCANCELFLAG                     = '0'
            AND A.GLBL_CMPY_CD                     = D.GLBL_CMPY_CD(+)
            AND A.DS_CONTR_DTL_PK                  = D.DS_CONTR_DTL_PK(+)
            AND A.DS_CONTR_BLLG_MTR_PK             = D.DS_CONTR_BLLG_MTR_PK(+)
            AND D.EZCANCELFLAG(+)                  = '0'
            AND A.GLBL_CMPY_CD                     = E.GLBL_CMPY_CD(+)
            AND A.DS_CONTR_DTL_PK                  = E.DS_CONTR_DTL_PK(+)
            AND A.DS_CONTR_BLLG_SCHD_PK            = E.DS_CONTR_BLLG_SCHD_PK(+)
            AND E.EZCANCELFLAG(+)                  = '0'
            AND A.GLBL_CMPY_CD                     = F.GLBL_CMPY_CD(+)
            AND A.SVC_CR_REBIL_DTL_PK              = F.SVC_CR_REBIL_DTL_PK(+)
            AND F.EZCANCELFLAG(+)                  = '0'
            AND C.GLBL_CMPY_CD                     = G.GLBL_CMPY_CD
            AND C.CCY_CD                           = G.CCY_CD
            AND G.EZCANCELFLAG                     = '0'
            AND A.GLBL_CMPY_CD                     = H.GLBL_CMPY_CD
            AND A.BLLG_CYCLE_CD                    = H.BLLG_CYCLE_CD
            AND H.EZCANCELFLAG                     = '0'
            AND A.GLBL_CMPY_CD                     = Z.GLBL_CMPY_CD
            AND A.PRNT_DS_CONTR_BLLG_SCHD_PK       = Z.DS_CONTR_BLLG_SCHD_PK
            AND Z.EZCANCELFLAG                     = '0'
            AND Z.GLBL_CMPY_CD                     = I.GLBL_CMPY_CD
            AND Z.DS_CONTR_BLLG_SCHD_SMRY_PK       = I.DS_CONTR_BLLG_SCHD_SMRY_PK
            AND I.EZCANCELFLAG                     = '0'
        ORDER BY
             A.BASE_CHRG_FLG        DESC
            ,A.USG_CHRG_FLG         DESC
            ,A.NEXT_BLLG_DT
            ,A.DS_CONTR_DTL_PK
            ,A.DS_CONTR_BLLG_MTR_PK
    </statement>
    <statement id="getDsContrAddlChrg" parameterClass="Map" resultClass="Map">
        SELECT
             A.EFF_FROM_DT
            ,A.EFF_THRU_DT
            ,A.TRMN_DT
            ,A.INV_UP_TO_DT
            ,A.SVC_BILL_BY_TP_CD
            ,A.CCY_CD
            ,A.ADDL_CHRG_INV_TP_CD
            ,A.ADDL_CHRG_FLAT_DEAL_PRC_AMT
            ,A.ADDL_CHRG_FLAT_FUNC_PRC_AMT
            ,A.ADDL_CHRG_APLC_PCT
            ,A.PRINT_DTL_FLG
            ,A.BLLG_CYCLE_CD
            ,A.ADDL_CHRG_TP_CD
            ,A.DS_CONTR_PK
            ,A.DS_CONTR_ADDL_CHRG_PK
            ,B.BLLG_CYCLE_MTH_AOT
            <!-- START 2017/12/21 K.Kojima [QC#18562,ADD] -->
            ,B.PRRT_DIV_RATE
            <!-- END 2017/12/21 K.Kojima [QC#18562,ADD] -->
            ,C.PCT_PRC_AVAL_FLG
            ,C.BASE_CHRG_FLG
            ,C.USG_CHRG_FLG
        FROM
             DS_CONTR_ADDL_CHRG       A
            ,BLLG_CYCLE               B
            ,SVC_BILL_BY_TP           C
        WHERE
                A.GLBL_CMPY_CD          =  #glblCmpyCd#
            AND A.EZCANCELFLAG          =  '0'
            AND A.DS_CONTR_PK           = #dsContrPk#
            <isNotNull  property="addlChrgInvTpCd">
            AND A.ADDL_CHRG_INV_TP_CD   = #addlChrgInvTpCd#
            </isNotNull>
            AND A.EFF_FROM_DT           &lt;= #fromDt#
            AND A.EFF_THRU_DT           &gt;= #thruDt#
            AND (
                 A.TRMN_DT               IS NULL
                 OR
                 A.TRMN_DT               &gt;= #thruDt#
                )
            <isNull property="dsContrDtlPk">
            AND A.DS_CONTR_DTL_PK       IS NULL
            </isNull>
            <isNotNull property="dsContrDtlPk">
            AND A.DS_CONTR_DTL_PK       =  #dsContrDtlPk#
            </isNotNull>
            <isNotNull property="svcBillByTpCd">
            AND A.SVC_BILL_BY_TP_CD      =  #svcBillByTpCd#
            </isNotNull>
            AND A.GLBL_CMPY_CD          =  B.GLBL_CMPY_CD
            AND A.BLLG_CYCLE_CD         =  B.BLLG_CYCLE_CD
            AND B.BLLG_CYCLE_ACTV_FLG   =  'Y'
            AND B.EFF_FROM_DT           &lt;= #slsDt#
            AND (
                B.EFF_THRU_DT           &gt;= #slsDt#
                OR
                B.EFF_THRU_DT           IS NULL
                )
            AND B.EZCANCELFLAG          =  '0'
            AND A.GLBL_CMPY_CD          =  C.GLBL_CMPY_CD
            AND A.SVC_BILL_BY_TP_CD     =  C.SVC_BILL_BY_TP_CD
            AND C.EZCANCELFLAG          =  '0'
    </statement>
    <statement id="getBaseAddlChrgAmt" parameterClass="Map" resultClass="Map">
        SELECT
             A.EFF_FROM_DT
            ,A.EFF_THRU_DT
            ,A.TRMN_DT
            ,A.INV_UP_TO_DT
            ,A.SVC_BILL_BY_TP_CD
            ,A.CCY_CD
            ,A.ADDL_CHRG_FLAT_DEAL_PRC_AMT
            ,A.ADDL_CHRG_APLC_PCT
            ,A.PRINT_DTL_FLG
            ,A.BLLG_CYCLE_CD
            ,B.BLLG_CYCLE_MTH_AOT
        FROM
             DS_CONTR_ADDL_CHRG       A
            ,BLLG_CYCLE               B
        WHERE
                A.GLBL_CMPY_CD          =  #glblCmpyCd#
            AND A.EZCANCELFLAG          =  '0'
            <isNull  property="TrmnDt">
            AND A.EFF_FROM_DT           &gt;= #fromDt#
            </isNull>
            AND (
                B.EFF_THRU_DT           &gt;= #slsDt#
                OR
                B.EFF_THRU_DT           IS NULL
                )
            <isNotNull  property="TrmnDt">
            AND A.TRMN_DT               &gt;= #TrmnDt#
            </isNotNull>
            AND A.DS_CONTR_DTL_PK       =  #dsContrDtlPk#
            AND A.GLBL_CMPY_CD          =  B.GLBL_CMPY_CD
            AND A.BLLG_CYCLE_CD         =  B.BLLG_CYCLE_CD
            AND B.EZCANCELFLAG          =  '0'
    </statement>
    <statement id="getStartMtrCnt" parameterClass="Map" resultClass="Map">
        SELECT
             A.CONTR_MTR_MULT_RATE
            ,B.READ_MTR_CNT
            ,B.MTR_READ_DT
        FROM
             CONTR_PHYS_BLLG_MTR_RELN A
            ,SVC_PHYS_MTR_READ        B
        WHERE
                A.GLBL_CMPY_CD              = #glblCmpyCd#
            AND A.EZCANCELFLAG              = '0'
            AND A.DS_CONTR_BLLG_MTR_PK      = #dsContrBllgMtrPk#
            AND A.BLLBL_FLG                 = 'Y'
            AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
            AND A.SVC_PHYS_MTR_PK           = B.SVC_PHYS_MTR_PK
            AND B.SVC_PHYS_MTR_READ_GRP_SQ  = #svcPhysMtrReadGrpSq#
            AND B.EZCANCELFLAG              = '0'
    </statement>
    <statement id="getMtrCnt" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_DTL_PK
            ,A.DS_CONTR_BLLG_SCHD_PK
            ,A.DS_CONTR_BLLG_MTR_PK
            ,A.BLLG_SCHD_FROM_DT
            ,A.BLLG_SCHD_THRU_DT
            ,A.BLLBL_FLG
            ,A.CCY_CD
            ,B.CONTR_MTR_MULT_RATE
            ,C.READ_MTR_CNT
            ,C.MTR_READ_DT
            ,C.SVC_PHYS_MTR_READ_PK
            ,C.SVC_PHYS_MTR_PK
        FROM
             DS_CONTR_BLLG_SCHD       A
            ,CONTR_PHYS_BLLG_MTR_RELN B
            ,SVC_PHYS_MTR_READ        C
        WHERE
                A.GLBL_CMPY_CD              =  #glblCmpyCd#
            AND A.EZCANCELFLAG              =  '0'
            AND A.DS_CONTR_BLLG_SCHD_PK     =  #dsContrBllgSchdPk#
            AND A.BLLBL_FLG                 =  'Y'
            AND A.GLBL_CMPY_CD              =  B.GLBL_CMPY_CD
            AND A.DS_CONTR_BLLG_MTR_PK      =  B.DS_CONTR_BLLG_MTR_PK
            AND B.EZCANCELFLAG              =  '0'
            AND B.GLBL_CMPY_CD              =  C.GLBL_CMPY_CD
            AND B.SVC_PHYS_MTR_PK           =  C.SVC_PHYS_MTR_PK
            AND A.SVC_PHYS_MTR_READ_GRP_SQ  =  C.SVC_PHYS_MTR_READ_GRP_SQ
            AND C.EZCANCELFLAG              =  '0'
    </statement>
    <statement id="getPrevBllgSchd" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM (
            SELECT
                 A.DS_CONTR_BLLG_SCHD_PK
            FROM
                 DS_CONTR_BLLG_SCHD       A
            WHERE
                    A.GLBL_CMPY_CD              =  #glblCmpyCd#
                AND A.EZCANCELFLAG              =  '0'
                AND A.DS_CONTR_DTL_PK           =  #dsContrDtlPk#
                AND A.DS_CONTR_BLLG_MTR_PK      =  #dsContrBllgMtrPk
                AND A.BLLG_SCHD_THRU_DT         &lt;= #bllgSchdThruDt#
                AND A.BLLBL_FLG                 =  'Y'
            ORDER BY
                A.BLLG_SCHD_THRU_DT DESC
        ) A0
        WHERE
            ROWNUM = 1
    </statement>
    <statement id="getCrRebilMtrCnt" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_BLLG_MTR_PK
            ,C.SVC_PHYS_MTR_PK
            ,A.OLD_START_READ_MTR_CNT
            ,A.OLD_END_READ_MTR_CNT
            <!-- START 2017/10/06 E.Kameishi [QC#18636,MOD] -->
            <!-- ,A.OLD_START_TEST_MTR_CNT -->
            <!-- ,A.OLD_END_TEST_MTR_CNT -->
            ,A.OLD_TEST_MTR_CNT
            <!-- END 2017/10/06 E.Kameishi [QC#18636,MOD] -->
            ,A.NEW_START_READ_MTR_CNT
            ,A.NEW_END_READ_MTR_CNT
            <!-- START 2017/10/06 E.Kameishi [QC#18636,MOD] -->
            <!-- ,A.NEW_START_TEST_MTR_CNT -->
            <!-- ,A.NEW_END_TEST_MTR_CNT -->
            ,A.NEW_TEST_MTR_CNT
            <!-- END 2017/10/06 E.Kameishi [QC#18636,MOD] -->
            ,D.CONTR_MTR_MULT_RATE
            ,A.OLD_START_MTR_READ_GRP_SQ
            ,A.OLD_END_MTR_READ_GRP_SQ
            ,A.NEW_START_MTR_READ_GRP_SQ
            ,A.NEW_END_MTR_READ_GRP_SQ
            <!-- add start 2019/08/23 QC#52934 -->
            ,A.END_SVC_PHYS_MTR_READ_PK
            <!-- add end 2019/08/23 QC#52934 -->
        FROM
             SVC_CR_REBIL_MTR_READ      A
            ,DS_CONTR_DTL               B
            ,SVC_PHYS_MTR               C
            ,CONTR_PHYS_BLLG_MTR_RELN   D
        WHERE
                A.GLBL_CMPY_CD              =  #glblCmpyCd#
            AND A.EZCANCELFLAG              =  '0'
            AND A.SVC_CR_REBIL_DTL_PK       =  #svcCrRebilDtlPk#
            AND A.DS_CONTR_BLLG_MTR_PK      =  #dsContrBllgMtrPk#
            AND A.GLBL_CMPY_CD              =  B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK           =  B.DS_CONTR_DTL_PK
            AND B.EZCANCELFLAG              =  '0'
            AND B.GLBL_CMPY_CD              =  C.GLBL_CMPY_CD
            AND B.SVC_MACH_MSTR_PK          =  C.SVC_MACH_MSTR_PK
<!-- START 2017/09/15 K.Kitachi [QC#20180, ADD] -->
            AND A.SVC_PHYS_MTR_PK           =  C.SVC_PHYS_MTR_PK
<!-- END 2017/09/15 K.Kitachi [QC#20180, ADD] -->
            AND C.EZCANCELFLAG              =  '0'
            AND C.GLBL_CMPY_CD              =  D.GLBL_CMPY_CD
            AND C.SVC_PHYS_MTR_PK           =  D.SVC_PHYS_MTR_PK
            AND D.BLLBL_FLG                 =  'Y'
            AND D.DS_CONTR_BLLG_MTR_PK      =  #dsContrBllgMtrPk#
            AND D.EZCANCELFLAG              =  '0'
        ORDER BY
             A.DS_CONTR_BLLG_MTR_PK
            ,C.SVC_PHYS_MTR_PK
    </statement>
    <statement id="getUsgChrgRate" parameterClass="Map" resultClass="Map">
        SELECT
             B.XS_MTR_FIRST_FLG
            ,B.XS_MTR_COPY_QTY
            ,B.XS_MTR_AMT_RATE
            ,B.CONTR_XS_COPY_PK
            ,C.BLLG_MIN_CNT
            ,C.BLLG_MIN_AMT_RATE
            ,C.BLLG_ROLL_OVER_RATIO
            ,C.XS_CHRG_TP_CD
            ,C.ROLL_OVER_CNT
            ,C.BLLG_FREE_COPY_CNT
            <!-- START 2019/01/17 E.Kameishi [QC#29083, ADD] -->
            ,C.CUM_COPY_CNT
            ,C.CUM_COPY_FREQ_MTH_AOT
            ,C.CUM_COPY_START_DT
            ,C.CUM_COPY_END_DT
            <!-- START 2019/01/17 E.Kameishi [QC#29083, ADD] -->
        FROM
             DS_CONTR_BLLG_SCHD         A
            ,DS_CONTR_BLLG_SCHD_MTR     B
            ,DS_CONTR_BLLG_MTR          C
        WHERE
                A.GLBL_CMPY_CD                  =  #glblCmpyCd#
            AND A.EZCANCELFLAG                  =  '0'
            AND A.DS_CONTR_BLLG_SCHD_PK         =  #dsContrBllgSchdPk#
            AND A.GLBL_CMPY_CD                  =  B.GLBL_CMPY_CD
            AND A.DS_CONTR_BLLG_SCHD_SMRY_PK    =  B.DS_CONTR_BLLG_SCHD_SMRY_PK
            AND B.EZCANCELFLAG                  =  '0'
            AND B.GLBL_CMPY_CD                  =  C.GLBL_CMPY_CD
            AND B.DS_CONTR_BLLG_MTR_PK          =  C.DS_CONTR_BLLG_MTR_PK
            AND C.EZCANCELFLAG                  =  '0'
        ORDER BY
            XS_MTR_COPY_QTY DESC
    </statement>
    <!-- START 2018/04/11 M.Naito [QC#23378, MOD] -->
    <statement id="getContrAlloc" parameterClass="Map" resultClass="Map">
        SELECT
             A.COA_CMPY_CD
            ,A.COA_AFFL_CD
            ,A.COA_BR_CD
            ,A.COA_CH_CD
            ,A.COA_CC_CD
            ,A.COA_ACCT_CD
            ,A.COA_PROD_CD
            ,A.COA_PROJ_CD
            ,A.COA_EXTN_CD
            ,A.PRC_ALLOC_RATE
            ,A.PRC_ALLOC_AMT
        FROM
             DS_CONTR_PRC_ALLOC        A
        WHERE
                A.GLBL_CMPY_CD                  =  #glblCmpyCd#
            AND A.EZCANCELFLAG                  =  '0'
            AND A.DS_CONTR_PK                   =  #dsContrPk#
            <isNotNull property="dsContrDtlPk">
            AND A.DS_CONTR_DTL_PK               =  #dsContrDtlPk#
            </isNotNull>
            <isNotNull property="svcInvChrgTpCd">
            AND A.SVC_INV_CHRG_TP_CD            =  #svcInvChrgTpCd#
            </isNotNull>
            <isNull property="svcInvChrgTpCd">
            AND A.SVC_INV_CHRG_TP_CD            IS NULL
            </isNull>
    </statement>
    <!-- END 2018/04/11 M.Naito [QC#23378, MOD] -->
    <statement  id="getdfrdAcctgRule" parameterClass="Map" resultClass="Map">
        SELECT
             B.DFRD_ACCTG_RULE_CD
            ,B.DFRD_ACCTG_RULE_DURN_AOT
        FROM
             MDSE                       A
            ,DFRD_ACCTG_RULE            B
        WHERE
                A.GLBL_CMPY_CD                  =  #glblCmpyCd#
            AND A.EZCANCELFLAG                  =  '0'
            AND A.MDSE_CD                       =  #mdseCd#
            AND A.GLBL_CMPY_CD                  =  B.GLBL_CMPY_CD
            AND A.DFRD_ACCTG_RULE_CD            =  B.DFRD_ACCTG_RULE_CD
            AND B.EZCANCELFLAG                  =  '0'
    </statement>
    <statement id="getPrevSchd" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_BLLG_SCHD_PK
            ,A.SVC_PHYS_MTR_READ_GRP_SQ
        FROM
             DS_CONTR_BLLG_SCHD         A
        WHERE
                A.GLBL_CMPY_CD                  =     #glblCmpyCd#
            AND A.EZCANCELFLAG                  =     '0'
            AND A.DS_CONTR_DTL_PK               =     #dsContrDtlPk#
            AND A.DS_CONTR_BLLG_MTR_PK          =     #dsContrBllgMtrPk#
            <!-- START 2018/03/09 K.Kojima [QC#23600,MOD] -->
            <!-- AND A.BLLG_SCHD_FROM_DT             &lt;= #targetDt# -->
            <!-- AND A.BLLG_SCHD_THRU_DT             &gt;= #targetDt# -->
            AND A.BLLG_SCHD_THRU_DT             &lt;= #targetDt#
            <!-- END 2018/03/09 K.Kojima [QC#23600,MOD] -->
            AND A.INV_TP_CD                     =     #invTpCd#
            <!-- START 2018/03/09 K.Kojima [QC#23600,ADD] -->
            AND A.BLLBL_FLG                     =     'Y'
            <!-- END 2018/03/09 K.Kojima [QC#23600,ADD] -->
        ORDER BY
             A.BLLG_SCHD_THRU_DT DESC NULLS FIRST
            ,A.SVC_INV_NUM       DESC NULLS FIRST
    </statement>
    <statement id="hasSameAddl" parameterClass="Map" resultClass="Map">
        SELECT
             *
        FROM
             SVC_CONTR_BLLG               A
        WHERE
                A.GLBL_CMPY_CD              = #glblCmpyCd#
            AND A.EZCANCELFLAG              = '0'
            AND A.DS_CONTR_PK               = #dsContrPk#
            <isNotNull  property="dsContrDtlPk">
            AND A.DS_CONTR_DTL_PK           = #dsContrDtlPk#
            </isNotNull>
            AND A.DS_CONTR_ADDL_CHRG_PK     =     #dsContrAddlChrgPk#
            AND SVC_CONTR_BLLG_FROM_DT      &lt;= #targetThruDt#
            AND SVC_CONTR_BLLG_THRU_DT      &gt;= #targetFromDt#
            <!-- START 2018/03/09 K.Kojima [QC#23600,ADD] -->
            AND A.INV_TP_CD                 = #invTpCd#
            <!-- END 2018/03/09 K.Kojima [QC#23600,ADD] -->
     </statement>
    <statement id="hasSameAddlOld" parameterClass="Map" resultClass="Map">
        SELECT
             *
        FROM
             SVC_CONTR_BLLG               A
            ,SVC_CONTR_ADDL_CHRG_BLLG     B
        WHERE
                A.GLBL_CMPY_CD              = #glblCmpyCd#
            AND A.EZCANCELFLAG              = '0'
            AND A.DS_CONTR_PK               = #dsContrPk#
            AND A.SVC_CONTR_BLLG_GRP_SQ     &lt;&gt; #svcContrBllgGrpSq#
            AND A.ADDL_CHRG_INV_UP_TO_DT    = #addlChrgInvUpToDt#
            AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
            AND A.SVC_CONTR_BLLG_PK         = B.SVC_CONTR_BLLG_PK
            AND B.EZCANCELFLAG              = '0'
            AND B.ADDL_CHRG_TP_CD           = #addlChrgTpCd#
            AND B.SVC_BILL_BY_TP_CD         = #svcBillByTpCd#
     </statement>
    <statement id="getFleetReadRollUp" parameterClass="Map" resultClass="Map">
        SELECT
             A.PRI_FLEET_READ_MTR_CNT
            ,A.CUR_FLEET_READ_MTR_CNT
            ,A.PRI_PHYS_MTR_READ_GRP_SQ
            ,A.SVC_PHYS_MTR_READ_GRP_SQ
            ,A.TEST_COPY_QTY
        FROM
             FLEET_READ_ROLL_UP         A
        WHERE
                A.GLBL_CMPY_CD                  =     #glblCmpyCd#
            AND A.EZCANCELFLAG                  =     '0'
            AND A.PRNT_DS_CONTR_BLLG_SCHD_PK    =     #prntDsContrBllgSchdPk#
    </statement>
    <statement id="getFreeCopyAndRollOverCnt" parameterClass="Map" resultClass="Map">
        SELECT
             B.FREE_COPY_CNT
            ,B.ROLL_OVER_CNT
        FROM
             SVC_CONTR_BLLG     A
            ,SVC_CONTR_MTR_BLLG B
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.DS_CONTR_BLLG_SCHD_PK = #dsContrBllgSchdPk#
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.SVC_CONTR_BLLG_PK     = B.SVC_CONTR_BLLG_PK
            AND B.EZCANCELFLAG          = '0'
    </statement>
    <!-- START 2018/06/05 K.Kojima [QC#21974,ADD] -->
    <statement id="getFreeCopyRollOverRatioUsed" parameterClass="Map" resultClass="Map">
        SELECT
             NVL(DCBMU.FREE_COPY_CNT, 0) + NVL(DCBMU.USG_FREE_COPY_CNT, 0) AS FREE_COPY_CNT
            ,DCBMU.ROLL_OVER_RATIO                                         AS ROLL_OVER_RATIO
        FROM
             DS_CONTR_BLLG_SCHD     DCBS
            ,DS_CONTR_BLLG_MTR_USED DCBMU
        WHERE
                DCBS.GLBL_CMPY_CD               = #glblCmpyCd#
            AND DCBS.DS_CONTR_BLLG_SCHD_PK      = #dsContrBllgSchdPk#
            AND DCBS.GLBL_CMPY_CD               = DCBMU.GLBL_CMPY_CD
            AND DCBS.ORIG_DS_CONTR_BLLG_SCHD_PK = DCBMU.DS_CONTR_BLLG_SCHD_PK
            AND DCBMU.EZCANCELFLAG              = '0'
    </statement>
    <statement id="getRollOverCntUsed" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            DCBMU.ROLL_OVER_CNT
        FROM
             DS_CONTR_BLLG_SCHD     DCBS
            ,DS_CONTR_BLLG_SCHD     DCBSO
            ,DS_CONTR_BLLG_SCHD     DCBSB
            ,DS_CONTR_BLLG_MTR_USED DCBMU
        WHERE
                DCBS.GLBL_CMPY_CD               = #glblCmpyCd#
            AND DCBS.DS_CONTR_BLLG_SCHD_PK      = #dsContrBllgSchdPk#
            AND DCBS.EZCANCELFLAG               = '0'
            AND DCBS.GLBL_CMPY_CD               = DCBSO.GLBL_CMPY_CD
            AND DCBS.ORIG_DS_CONTR_BLLG_SCHD_PK = DCBSO.DS_CONTR_BLLG_SCHD_PK
            AND DCBSO.EZCANCELFLAG              = '0'
            AND DCBSO.GLBL_CMPY_CD               = DCBSB.GLBL_CMPY_CD
            AND DCBSO.DS_CONTR_BLLG_MTR_PK       = DCBSB.DS_CONTR_BLLG_MTR_PK
            AND DCBSO.BLLG_SCHD_FROM_DT       &gt; DCBSB.BLLG_SCHD_FROM_DT
            AND DCBSB.INV_TP_CD                 = #invTpInvoice#
            AND DCBSB.INV_FLG                   = 'Y'
            AND DCBSB.DS_CONTR_PRC_EFF_PK       IS NOT NULL
            AND DCBSB.EZCANCELFLAG              = '0'
            AND DCBSB.GLBL_CMPY_CD              = DCBMU.GLBL_CMPY_CD(+)
            AND DCBSB.DS_CONTR_BLLG_SCHD_PK     = DCBMU.DS_CONTR_BLLG_SCHD_PK(+)
            AND DCBMU.EZCANCELFLAG(+)           = '0'
        ORDER BY
            DCBSB.BLLG_SCHD_FROM_DT DESC
    </statement>
    <!-- END 2018/06/05 K.Kojima [QC#21974,ADD] -->
    <statement id="getPreCalcAddlNextBllgDt" parameterClass="Map" resultClass="String">
        SELECT
             B.ADDL_CHRG_THRU_DT
        FROM
             SVC_CONTR_BLLG A
            ,SVC_CONTR_ADDL_CHRG_BLLG    B
        WHERE
                A.GLBL_CMPY_CD                  = #glblCmpyCd#
            AND A.DS_CONTR_ADDL_CHRG_PK         = #dsContrAddlChrgPk#
            AND A.EZCANCELFLAG                  = '0'
            AND A.ADDL_CHRG_FLG                 = 'Y'
            AND A.ADDL_CHRG_BLLG_NEXT_BLLG_DT   &lt; #effFromDt#
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.SVC_CONTR_BLLG_PK = B.SVC_CONTR_BLLG_PK
            AND B.EZCANCELFLAG      = '0'
        ORDER BY
             A.ADDL_CHRG_BLLG_NEXT_BLLG_DT  DESC
    </statement>
    <statement id="getIntgMdseCdForAddlChrgTpV" parameterClass="Map" resultClass="String">
        SELECT
            A.INTG_MDSE_CD
        FROM
             ADDL_CHRG_TP_V A
        WHERE
                A.GLBL_CMPY_CD            = #glblCmpyCd#
            AND A.ADDL_CHRG_TP_CD         = #addlChrgTpCd#
            AND A.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getTestCopyQty" parameterClass="Map" resultClass="Map">
        SELECT
             PMR.FSR_NUM
            ,PMR.FSR_VISIT_NUM
            ,PMR.SVC_PHYS_MTR_PK
            ,PMR.DS_TEST_COPY_CLS_CD
            ,NVL(PMR.TEST_MTR_CNT, 0)   AS TEST_MTR_CNT
            ,BMR.CONTR_MTR_MULT_RATE
            ,PMR.SVC_TASK_NUM
            <!-- START 2017/10/25 K.Kojima [QC#21562,ADD] -->
            ,PMR.MTR_READ_DT
            ,PMR.READ_MTR_CNT
            <!-- END 2017/10/25 K.Kojima [QC#21562,ADD] -->
        FROM
             CONTR_PHYS_BLLG_MTR_RELN   BMR
            ,SVC_PHYS_MTR_READ          PMR
        WHERE
                BMR.GLBL_CMPY_CD               = #glblCmpyCd#
            AND BMR.DS_CONTR_DTL_PK            = #dsContrDtlPk#
            AND BMR.DS_CONTR_BLLG_MTR_PK       = #dsContrBllgMtrPk#
            AND BMR.BLLBL_FLG                  = 'Y'
            AND BMR.EZCANCELFLAG               = '0'
            AND BMR.GLBL_CMPY_CD               = PMR.GLBL_CMPY_CD
            AND BMR.SVC_PHYS_MTR_PK            = PMR.SVC_PHYS_MTR_PK
            AND PMR.MTR_READ_DT            &gt;  #prevMtrReadDt#
            AND PMR.MTR_READ_DT            &lt;= #currMtrReadDt#
            AND PMR.VLD_MTR_FLG                = 'Y'
            AND PMR.DS_TEST_COPY_CLS_CD        IN (#testCopyClsCd_In#, #testCopyClsCd_Out#)
            AND (PMR.FSR_NUM                   IS NOT NULL
            OR  PMR.FSR_VISIT_NUM              IS NOT NULL
            OR  PMR.SVC_TASK_NUM               IS NOT NULL)
            AND PMR.EZCANCELFLAG               = '0'
        ORDER BY
             PMR.SVC_PHYS_MTR_PK
            ,PMR.MTR_READ_DT                   DESC
            ,PMR.SVC_PHYS_MTR_READ_GRP_SQ      DESC
            ,PMR.FSR_NUM
            ,PMR.FSR_VISIT_NUM
    </statement>

    <statement id="getSvcPhysMtrPk" parameterClass="Map" resultClass="Map">
        SELECT
             BMR.SVC_PHYS_MTR_PK
        FROM
             CONTR_PHYS_BLLG_MTR_RELN   BMR
        WHERE
                BMR.GLBL_CMPY_CD               = #glblCmpyCd#
            AND BMR.DS_CONTR_DTL_PK            = #dsContrDtlPk#
            AND BMR.DS_CONTR_BLLG_MTR_PK       = #dsContrBllgMtrPk#
            AND BMR.BLLBL_FLG                  = 'Y'
            AND BMR.EZCANCELFLAG               = '0'
    </statement>

    <!-- START 2017/10/25 K.Kojima [QC#21562,ADD] -->
    <statement id="getStartCopyQty" parameterClass="Map" resultClass="Map">
        SELECT
             PMR.SVC_PHYS_MTR_PK
            ,PMR.READ_MTR_CNT
        FROM
             CONTR_PHYS_BLLG_MTR_RELN   BMR
            ,SVC_PHYS_MTR_READ          PMR
        WHERE
                BMR.GLBL_CMPY_CD               = #glblCmpyCd#
            AND BMR.DS_CONTR_DTL_PK            = #dsContrDtlPk#
            AND BMR.DS_CONTR_BLLG_MTR_PK       = #dsContrBllgMtrPk#
            AND BMR.BLLBL_FLG                  = 'Y'
            AND BMR.EZCANCELFLAG               = '0'
            AND BMR.GLBL_CMPY_CD               = PMR.GLBL_CMPY_CD
            AND BMR.SVC_PHYS_MTR_PK            = PMR.SVC_PHYS_MTR_PK
            AND BMR.DS_CONTR_DTL_PK            = PMR.DS_CONTR_DTL_PK
            AND PMR.MTR_READ_DT                = #mtrReadDt#
            AND PMR.VLD_MTR_FLG                = 'Y'
            AND PMR.EZCANCELFLAG               = '0'
        ORDER BY
            PMR.SVC_PHYS_MTR_PK
    </statement>
    <!-- END 2017/10/25 K.Kojima [QC#21562,ADD] -->
</sqlMap>