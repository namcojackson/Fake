<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NLCL0090Query">

    <statement id="searchInvtyOrd" parameterClass="Map" resultClass="Map">
        SELECT
            IO.INVTY_ORD_NUM                                   AS INVTY_ORD_NUM
           ,IO.INVTY_ORD_TP_CD                                 AS INVTY_ORD_TP_CD
           ,RS.RTL_WH_CD                                       AS RTL_WH_CD
           ,RW.RTL_WH_NM                                       AS RTL_WH_NM
           ,RS.RTL_SWH_CD                                      AS RTL_SWH_CD
           ,RS.RTL_SWH_NM                                      AS RTL_SWH_NM
           ,IOD.LOC_STS_CD                                     AS LOC_STS_CD
           ,IOD.STK_STS_CD                                     AS STK_STS_CD
           ,IO.FIRST_INVTY_ORD_CMNT_TXT                        AS FIRST_INVTY_ORD_CMNT_TXT
           ,IO.SCD_INVTY_ORD_CMNT_TXT                          AS SCD_INVTY_ORD_CMNT_TXT
           ,IO.THIRD_INVTY_ORD_CMNT_TXT                        AS THIRD_INVTY_ORD_CMNT_TXT
           ,IOS.INVTY_ORD_STS_DESC_TXT                         AS INVTY_ORD_STS_DESC_TXT
           ,SO.SO_NUM                                          AS SO_NUM
           ,CASE WHEN LENGTH(IO.INVTY_ORD_SUBMT_TS) >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(IO.INVTY_ORD_SUBMT_TS,1,14), 'YYYYMMDDHH24MISS'), 'MM/DD/YYYY HH24:MI:SS')
                 WHEN LENGTH(IO.INVTY_ORD_SUBMT_TS) >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(IO.INVTY_ORD_SUBMT_TS,1,12), 'YYYYMMDDHH24MI'),   'MM/DD/YYYY HH24:MI')
                 WHEN LENGTH(IO.INVTY_ORD_SUBMT_TS) >=  8 THEN TO_CHAR(TO_DATE(SUBSTR(IO.INVTY_ORD_SUBMT_TS,1,8),  'YYYYMMDD'),         'MM/DD/YYYY')
            END                                                AS INVTY_ORD_SUBMT_TS
           ,CASE WHEN LENGTH(IO.INVTY_ORD_CLOSE_TS) >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(IO.INVTY_ORD_CLOSE_TS,1,14), 'YYYYMMDDHH24MISS'), 'MM/DD/YYYY HH24:MI:SS')
                 WHEN LENGTH(IO.INVTY_ORD_CLOSE_TS) >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(IO.INVTY_ORD_CLOSE_TS,1,12), 'YYYYMMDDHH24MI'),   'MM/DD/YYYY HH24:MI')
                 WHEN LENGTH(IO.INVTY_ORD_CLOSE_TS) >=  8 THEN TO_CHAR(TO_DATE(SUBSTR(IO.INVTY_ORD_CLOSE_TS,1,8),  'YYYYMMDD'),         'MM/DD/YYYY')
                 WHEN LENGTH(IO.INVTY_ORD_CANC_TS)  >= 14 THEN TO_CHAR(TO_DATE(SUBSTR(IO.INVTY_ORD_CANC_TS,1,14),  'YYYYMMDDHH24MISS'), 'MM/DD/YYYY HH24:MI:SS')
                 WHEN LENGTH(IO.INVTY_ORD_CANC_TS)  >= 12 THEN TO_CHAR(TO_DATE(SUBSTR(IO.INVTY_ORD_CANC_TS,1,12),  'YYYYMMDDHH24MI'),   'MM/DD/YYYY HH24:MI')
                 WHEN LENGTH(IO.INVTY_ORD_CANC_TS)  >=  8 THEN TO_CHAR(TO_DATE(SUBSTR(IO.INVTY_ORD_CANC_TS,1,8),   'YYYYMMDD'),         'MM/DD/YYYY')
            END                                                AS INVTY_ORD_CLOSE_OR_CANC_TS
           ,TO_CHAR(TO_NUMBER(IOD.INVTY_ORD_LINE_NUM))         AS INVTY_ORD_LINE_NUM
           ,IOD.MDSE_CD                                        AS MDSE_CD
           ,M.MDSE_DESC_SHORT_TXT                              AS MDSE_DESC_SHORT_TXT
           ,ABS(IOD.ORD_QTY)                                   AS INVTY_QTY
           ,NVL(IV.INVTY_AVAL_QTY, 0)                          AS INVTY_AVAL_QTY
           ,SER.SER_NUM                                        AS SER_NUM
           ,CASE WHEN IOD.ORD_QTY &gt; 0 THEN #flgY#
                 ELSE #flgN#
            END                                                AS FROM_LINE_FLG
        FROM
            INVTY_ORD        IO
           ,INVTY_ORD_DTL    IOD
           ,INVTY_ORD_SER    SER
           ,INVTY_ORD_STS    IOS
           ,RTL_SWH          RS
           ,RTL_WH           RW
           ,MDSE             M
           ,SHPG_ORD         SO
           ,INVTY            IV
        WHERE
            IO.GLBL_CMPY_CD        = #glblCmpyCd#
        AND IO.INVTY_ORD_NUM       = #invtyOrdNum#
        AND IO.EZCANCELFLAG        = '0'
        AND IO.GLBL_CMPY_CD        = IOD.GLBL_CMPY_CD
        AND IO.INVTY_ORD_NUM       = IOD.INVTY_ORD_NUM
        AND IOD.EZCANCELFLAG       = '0'
        AND IOD.GLBL_CMPY_CD       = SER.GLBL_CMPY_CD(+)
        AND IOD.INVTY_ORD_NUM      = SER.INVTY_ORD_NUM(+)
        AND IOD.INVTY_ORD_LINE_NUM = SER.INVTY_ORD_LINE_NUM(+)
        AND SER.EZCANCELFLAG(+)    = '0'
        AND IO.GLBL_CMPY_CD        = IOS.GLBL_CMPY_CD
        AND IO.INVTY_ORD_STS_CD    = IOS.INVTY_ORD_STS_CD
        AND IOS.EZCANCELFLAG       = '0'
        AND IOD.GLBL_CMPY_CD       = RS.GLBL_CMPY_CD
        AND IOD.INVTY_LOC_CD       = RS.INVTY_LOC_CD
        AND RS.EZCANCELFLAG        = '0'
        AND RS.GLBL_CMPY_CD        = RW.GLBL_CMPY_CD
        AND RS.RTL_WH_CD           = RW.RTL_WH_CD
        AND RW.EZCANCELFLAG        = '0'
        AND IOD.GLBL_CMPY_CD       = M.GLBL_CMPY_CD
        AND IOD.MDSE_CD            = M.MDSE_CD
        AND M.EZCANCELFLAG         = '0'
        AND IO.GLBL_CMPY_CD        = SO.GLBL_CMPY_CD(+)
        AND IO.INVTY_ORD_NUM       = SO.TRX_HDR_NUM(+)
        AND SO.EZCANCELFLAG(+)     = '0'
        AND IOD.GLBL_CMPY_CD       = IV.GLBL_CMPY_CD(+)
        AND IOD.INVTY_LOC_CD       = IV.INVTY_LOC_CD(+)
        AND IOD.MDSE_CD            = IV.MDSE_CD(+)
        AND IOD.LOC_STS_CD         = IV.LOC_STS_CD(+)
        AND IOD.STK_STS_CD         = IV.STK_STS_CD(+)
        AND IV.EZCANCELFLAG(+)     = '0'
        ORDER BY
            IO.INVTY_ORD_NUM
           ,IOD.INVTY_ORD_LINE_NUM
           ,SER.INVTY_ORD_SER_PK
    </statement>

    <statement id="getMdseInfo" parameterClass="Map" resultClass="Map">
        SELECT
            MD.MDSE_CD
           ,MD.MDSE_DESC_SHORT_TXT
           ,MD.MDSE_TP_CD
           ,MD.INVTY_CTRL_FLG
           ,MD.INVTY_VAL_FLG
           ,MD.FIRST_PROD_CTRL_CD
           ,MD.RGTN_STS_CD
           ,MD.SHPG_SER_TAKE_FLG
           ,MD.INSTL_BASE_CTRL_FLG
        FROM
            MDSE         MD
        WHERE
            MD.GLBL_CMPY_CD  = #glblCmpyCd#
        AND MD.MDSE_CD       = #mdseCd#
        AND MD.EZCANCELFLAG  = '0'
    </statement>

    <statement id="getSvcMachMstrInfo" parameterClass="Map" resultClass="Map">
        SELECT
            SVC_MACH_MSTR_PK
           ,SVC_MACH_MSTR_STS_CD
           ,CUR_LOC_NUM
           ,SVC_MACH_MSTR_LOC_STS_CD
           ,STK_STS_CD
           ,SVC_CONFIG_MSTR_PK
           ,SVC_MACH_MAINT_AVAL_FLG
           ,TRX_HDR_NUM
           ,EZUPTIME
           ,EZUPTIMEZONE
        FROM
            SVC_MACH_MSTR
        WHERE
            GLBL_CMPY_CD                = #glblCmpyCd#
        AND MDSE_CD                     = #mdseCd#
        AND SER_NUM                     = #serNum#
        AND SVC_MACH_MSTR_STS_CD &lt;&gt; #svcMachMstrStsTerm#
        AND EZCANCELFLAG                = '0'
    </statement>

    <statement id="getConfigCompCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            SVC_MACH_MSTR
        WHERE
            GLBL_CMPY_CD                = #glblCmpyCd#
        AND SVC_CONFIG_MSTR_PK          = #svcConfigMstrPk#
        AND SVC_MACH_MSTR_STS_CD &lt;&gt; #svcMachMstrStsTerm#
        AND EZCANCELFLAG                = '0'
    </statement>

    <statement id="getNonSerSvcMachMstrList" parameterClass="Map" resultClass="Map">
        SELECT
            SVC_MACH_MSTR_PK
        FROM
            (
             SELECT
                 SVC_MACH_MSTR_PK
             FROM
                 SVC_MACH_MSTR
             WHERE
                 GLBL_CMPY_CD                = #glblCmpyCd#
             AND MDSE_CD                     = #mdseCd#
             AND CUR_LOC_NUM                 = #invtyLocCd#
             AND SVC_MACH_MSTR_LOC_STS_CD    = #locStsCd#
             AND STK_STS_CD                  = #stkStsCd#
             AND SVC_MACH_MAINT_AVAL_FLG     = #flgY#
             AND SER_NUM            IS NULL
             AND SVC_CONFIG_MSTR_PK IS NULL
             AND TRX_HDR_NUM        IS NULL
             AND SVC_MACH_MSTR_STS_CD &lt;&gt; #svcMachMstrStsTerm#
             AND EZCANCELFLAG                = '0'
             ORDER BY
                 SVC_MACH_MSTR_PK
            )
        WHERE
            ROWNUM &lt;= #rownum#
    </statement>

    <statement id="searchRwsSerial" parameterClass="Map" resultClass="Map">
        SELECT
            RH.RWS_NUM
           ,RD.RWS_DTL_LINE_NUM
           ,RD.MDSE_CD
           ,IOS.SER_NUM
        FROM
            RWS_HDR       RH
           ,RWS_DTL       RD
           ,SHPG_ORD_DTL  SD
           ,INVTY_ORD_SER IOS
        WHERE
            RH.GLBL_CMPY_CD  = #glblCmpyCd#
        AND RH.RWS_NUM       = #rwsNum#
        AND RH.EZCANCELFLAG  = '0'
        AND RH.GLBL_CMPY_CD  = RD.GLBL_CMPY_CD
        AND RH.RWS_NUM       = RD.RWS_NUM
        AND RD.EZCANCELFLAG  = '0'
        AND RH.GLBL_CMPY_CD  = SD.GLBL_CMPY_CD
        AND RH.TRX_ORD_NUM   = SD.SO_NUM
        AND RD.TRX_LINE_NUM  = SD.SO_SLP_NUM
        AND SD.EZCANCELFLAG  = '0'
        AND SD.GLBL_CMPY_CD  = IOS.GLBL_CMPY_CD
        AND SD.TRX_HDR_NUM   = IOS.INVTY_ORD_NUM
        AND SD.TRX_LINE_NUM  = IOS.INVTY_ORD_LINE_NUM
        AND IOS.EZCANCELFLAG = '0'
        ORDER BY
            RH.RWS_NUM
           ,RD.RWS_DTL_LINE_NUM
           ,IOS.INVTY_ORD_SER_PK
    </statement>

</sqlMap>
