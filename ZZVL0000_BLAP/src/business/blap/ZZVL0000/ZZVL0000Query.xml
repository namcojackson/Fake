<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="ZZVL0000Query">

	<typeAlias alias="ZZVL0000_ASMsg"	type="business.blap.ZZVL0000.ZZVL0000_ASMsg"/>
	<typeAlias alias="ZZVL0000_BSMsg"	type="business.blap.ZZVL0000.ZZVL0000_BSMsg"/>
	
	<statement id="getPreferredViewList" parameterClass="Map" resultMap="result.ZZVL0000_ASMsg">
		SELECT
				SUBSTR(DBMS_LOB.SUBSTR(STCD.SCR_TBL_COL_DEF_CLOD,1000,1), INSTR(DBMS_LOB.SUBSTR(STCD.SCR_TBL_COL_DEF_CLOD,1000,1), ',', -1,1)+1)	AS USR_ID
			,	(CASE WHEN SUBSTR(DBMS_LOB.SUBSTR(STCD.SCR_TBL_COL_DEF_CLOD,1000,1), INSTR(DBMS_LOB.SUBSTR(STCD.SCR_TBL_COL_DEF_CLOD,1000,1), ',', 1,6)+1,
						INSTR(DBMS_LOB.SUBSTR(STCD.SCR_TBL_COL_DEF_CLOD,1000,1), ',', 1,7)-INSTR(DBMS_LOB.SUBSTR(STCD.SCR_TBL_COL_DEF_CLOD,1000,1), ',', 1,6)-1) = 'true' 
						THEN 'Y' ELSE 'N' END) AS SYS_DEFAULT
			,	STCD.SCR_APP_ID				AS SCR_APP_ID
			,	STCD.SCR_TBL_NM				AS SCR_TBL_NM
			,	STCD.SCR_TBL_COL_DEF_NM		AS SCR_TBL_COL_DEF_NM
			,	STCD.SCR_TBL_COL_DEF_CLOD	AS SCR_TBL_COL_DEF_CLOD
			,	UT.BIZ_APP_NM				AS BIZ_APP_NM
		FROM
				SCR_TBL_COL_DEF STCD
			,	(
					SELECT
							UT.BIZ_APP_ID		AS BIZ_APP_ID
						,	MIN(UT.BIZ_APP_NM)	AS BIZ_APP_NM
					FROM
						UP_TAB UT
					WHERE
						UT.GLBL_CMPY_CD		= #cMsg.glblCmpyCd_1#
						AND UT.EZCANCELFLAG	= '0'
					GROUP BY
						UT.BIZ_APP_ID
				) UT
		WHERE
				STCD.GLBL_CMPY_CD	= #cMsg.glblCmpyCd_1#
			AND STCD.USR_ID			= #cMsg.roleNm_1#
			AND STCD.SCR_APP_ID		= UT.BIZ_APP_ID(+)
			AND STCD.EZCANCELFLAG	= '0'
 			AND ROWNUM &lt; #rowNum#
		ORDER BY
				STCD.SCR_APP_ID
			,	STCD.SCR_TBL_NM
			,	STCD.SCR_TBL_COL_DEF_NM
	</statement>
	
	<statement id="getPreferredViewListForAdd" parameterClass="Map" resultMap="result.ZZVL0000_BSMsg">
		SELECT
				STCD.SCR_APP_ID			AS SCR_APP_ID
			,	STCD.SCR_TBL_NM			AS SCR_TBL_NM
			,	STCD.SCR_TBL_COL_DEF_NM	AS SCR_TBL_COL_DEF_NM
			,	UT.BIZ_APP_NM			AS BIZ_APP_NM
		FROM
				SCR_TBL_COL_DEF STCD
			,	(
					SELECT
							UT.BIZ_APP_ID		AS BIZ_APP_ID
						,	MIN(UT.BIZ_APP_NM)	AS BIZ_APP_NM
					FROM
						UP_TAB UT
					WHERE
						UT.GLBL_CMPY_CD		= #cMsg.glblCmpyCd_1#
						AND UT.EZCANCELFLAG	= '0'
					GROUP BY
						UT.BIZ_APP_ID
				) UT
		WHERE
				STCD.GLBL_CMPY_CD	= #cMsg.glblCmpyCd_1#
			AND	STCD.USR_ID			= #cMsg.usrId_2#
			<isNotNull property="cMsg.bizAppId_2">
			AND STCD.SCR_APP_ID = #cMsg.bizAppId_2#
			</isNotNull>
			AND	STCD.SCR_APP_ID		= UT.BIZ_APP_ID(+)
			AND	STCD.EZCANCELFLAG	= '0'
 			AND ROWNUM &lt; #rowNum#
		ORDER BY
				STCD.SCR_APP_ID
			,	STCD.SCR_TBL_NM
			,	STCD.SCR_TBL_COL_DEF_NM
	</statement>
	
	<statement id="countPreferredView" parameterClass="Map" resultClass="Integer">
		SELECT
			COUNT(*)
		FROM
			SCR_TBL_COL_DEF STCD
		WHERE
				STCD.GLBL_CMPY_CD		= #glblCmpyCd#
			AND STCD.USR_ID				= #roleNm#
			AND STCD.SCR_APP_ID			= #scrAppId#
			AND STCD.SCR_TBL_NM			= #scrTblNm#
			<isNotNull property="scrTblColDefNm">
			AND STCD.SCR_TBL_COL_DEF_NM	=	#scrTblColDefNm#
			</isNotNull>
			AND STCD.EZCANCELFLAG	= '0'
	</statement>
	
	<resultMap id="result.ZZVL0000_ASMsg" class="ZZVL0000_ASMsg">
		<result property="scrAppId_1"		column="SCR_APP_ID"			javaType="EZDSStringItem"/>
		<result property="xxChkBox_3"		column="SYS_DEFAULT"		javaType="EZDSStringItem"/>
		<result property="bizAppNm_1"		column="BIZ_APP_NM"			javaType="EZDSStringItem"/>
		<result property="scrTblNm_1"		column="SCR_TBL_NM"			javaType="EZDSStringItem"/>
		<result property="scrTblColDefNm_1"	column="SCR_TBL_COL_DEF_NM"	javaType="EZDSStringItem"/>
		<result property="usrId_1"			column="USR_ID"				javaType="EZDSStringItem"/>
	</resultMap>
	
	<resultMap id="result.ZZVL0000_BSMsg" class="ZZVL0000_BSMsg">
		<result property="bizAppId_3"		column="SCR_APP_ID"			javaType="EZDSStringItem"/>
		<result property="bizAppNm_2"		column="BIZ_APP_NM"			javaType="EZDSStringItem"/>
		<result property="scrTblNm_2"		column="SCR_TBL_NM"			javaType="EZDSStringItem"/>
		<result property="scrTblColDefNm_2"	column="SCR_TBL_COL_DEF_NM"	javaType="EZDSStringItem"/>
	</resultMap>
	
</sqlMap>