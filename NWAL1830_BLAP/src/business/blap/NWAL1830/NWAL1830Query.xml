<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWAL1830Query">

    <typeAlias alias="NWAL1830CMsg"    type="business.blap.NWAL1830.NWAL1830CMsg"/>
    <typeAlias alias="NWAL1830_ACMsg"  type="business.blap.NWAL1830.NWAL1830_ACMsg"/>
    <typeAlias alias="NWAL1830_BCMsg"  type="business.blap.NWAL1830.NWAL1830_BCMsg"/>
    <typeAlias alias="NWAL1830_MCMsg"  type="business.blap.NWAL1830.NWAL1830_MCMsg"/>

    <statement id="getActionList" parameterClass="Map" resultClass="Map">
          SELECT
                    LVS.DS_ORD_LINE_CATG_CD 
                  , LVS.FIRST_BIZ_CTX_ATTRB_TXT AS ACTION_NM_TXT
                 <!-- , LVS.THIRD_BIZ_CTX_ATTRB_TXT AS RTL_WH_CD -->
                  , CATG.DS_ORD_LINE_DRCTN_CD
          FROM 
                    ORD_LINE_VAL_SET LVS
                  , DS_ORD_LINE_CATG CATG
          WHERE 
                    LVS.GLBL_CMPY_CD        = #glblCmpyCd#
                AND LVS.ORD_LINE_CTX_TP_CD  = #ordLineCtxCd#
                AND LVS.FRTH_BIZ_CTX_ATTRB_TXT = #actionFlag# <!-- 2017/09/11 S21_NA19800 Add -->
                AND LVS.EZCANCELFLAG        = '0'
                AND LVS.GLBL_CMPY_CD        = CATG.GLBL_CMPY_CD
                AND LVS.DS_ORD_LINE_CATG_CD = CATG.DS_ORD_LINE_CATG_CD
                AND CATG.EZCANCELFLAG       = '0'
          ORDER BY 
                    LVS.SCD_BIZ_CTX_ATTRB_TXT
    </statement>
    
    <statement id="getDsOrdCatgList" parameterClass="Map" resultClass="Map">
          SELECT 
                    DISTINCT 
                    OC.DS_ORD_CATG_CD
                  , OC.DS_ORD_CATG_DESC_TXT
                  , OC.DS_ORD_CATG_SORT_NUM
          FROM 
                    DS_ORD_LINE_PROC_DFN OLP
                  , DS_ORD_TP OT
                  , DS_ORD_CATG OC

          WHERE 
                    OLP.GLBL_CMPY_CD   = #glblCmpyCd#
              <isNotNull property="dsOrdLineCatgCdList">
              AND   OLP.DS_ORD_LINE_CATG_CD IN  
              <iterate property="dsOrdLineCatgCdList" var="dsOrdLineCatgCdList[]" open="(" close=")" conjunction=",">
                            #dsOrdLineCatgCdList[]#
              </iterate>
              </isNotNull>
              AND   OLP.ACTV_FLG       = #actvFlg#
              AND   OLP.EFF_FROM_DT  &lt;= #slsDt#
              AND ( OLP.EFF_THRU_DT  &gt;= #slsDt#  OR OLP.EFF_THRU_DT  IS NULL)
              AND   OLP.EZCANCELFLAG   = '0'
              AND   OLP.GLBL_CMPY_CD   = OT.GLBL_CMPY_CD
              AND   OLP.DS_ORD_TP_CD   = OT.DS_ORD_TP_CD
              AND   OT.EZCANCELFLAG    = '0'
              AND   OT.GLBL_CMPY_CD    = OC.GLBL_CMPY_CD
              AND   OT.DS_ORD_CATG_CD  = OC.DS_ORD_CATG_CD
              AND   OC.EZCANCELFLAG    = '0'
          ORDER BY
                  OC.DS_ORD_CATG_SORT_NUM
    </statement>
    
    <statement id="getDsOrdTpList" parameterClass="Map" resultClass="Map">
          SELECT 
                    DISTINCT 
                    OT.DS_ORD_TP_CD
                  , OT.DS_ORD_TP_DESC_TXT
                  , OT.DS_ORD_TP_SORT_NUM
          FROM 
                    DS_ORD_LINE_PROC_DFN OLP
                  , DS_ORD_TP OT
                  , DS_ORD_CATG OC

          WHERE 
                    OLP.GLBL_CMPY_CD = #glblCmpyCd#
              <isNotNull property="dsOrdLineCatgCdList">
              AND   OLP.DS_ORD_LINE_CATG_CD IN  
              <iterate property="dsOrdLineCatgCdList" var="dsOrdLineCatgCdList[]" open="(" close=")" conjunction=",">
                            #dsOrdLineCatgCdList[]#
              </iterate>
              </isNotNull>
              AND OLP.ACTV_FLG       = #actvFlg#
              AND OLP.EFF_FROM_DT    &lt;= #slsDt#
              AND ( OLP.EFF_THRU_DT  &gt;= #slsDt#  OR OLP.EFF_THRU_DT  IS NULL)
              AND OLP.EZCANCELFLAG   = '0'
              AND OLP.GLBL_CMPY_CD   = OT.GLBL_CMPY_CD
              AND OLP.DS_ORD_TP_CD   = OT.DS_ORD_TP_CD
              <isNotNull property="dsOrdCatgCd">
              AND OT.DS_ORD_CATG_CD  = #dsOrdCatgCd#
              </isNotNull>
              AND OT.EZCANCELFLAG    = '0'
              AND OT.GLBL_CMPY_CD    = OC.GLBL_CMPY_CD
              AND OT.DS_ORD_CATG_CD  = OC.DS_ORD_CATG_CD
              AND OC.EZCANCELFLAG    = '0'
          ORDER BY
                  OT.DS_ORD_TP_SORT_NUM
    </statement>

    <statement id="getConfigList" parameterClass="Map" resultMap="result.getConfigList">
          SELECT *
          FROM (
                    SELECT 
                              CNFG.SVC_CONFIG_MSTR_PK
                            , CNFG.T_MDL_NM
                            , CNFG.SHIP_TO_CUST_LOC_ADDR
                            , CNFG.BILL_TO_CUST_LOC_ADDR 
                            , CNFG.DS_ORD_POSN_NUM
                            , CNFG.DS_CPO_CONFIG_PK
                            , CNFG.SHIP_TO_POST_CD <!-- 2020/05/14 QC#56509-1 Add -->
                            , CPO.EZUPTIME
                            , CPO.EZUPTIMEZONE
                            , CPO.DS_ORD_TP_CD
                            , CPO.DS_ORD_CATG_CD <!-- 2020/05/14 QC#56509-1 Add -->
                    FROM 
                              DS_CPO_CONFIG_V CNFG
                            , CPO             CPO
                    WHERE 
                              CNFG.GLBL_CMPY_CD   = #glblCmpyCd#
                          AND CNFG.CPO_ORD_NUM    = #cpoOrdNum#
                          AND CNFG.CONFIG_CATG_CD = #configCatgCd#
                          AND CNFG.EZCANCELFLAG   = '0'
                          AND CNFG.GLBL_CMPY_CD   = CPO.GLBL_CMPY_CD
                          AND CNFG.CPO_ORD_NUM    = CPO.CPO_ORD_NUM
                          AND CPO.EZCANCELFLAG   = '0'
                    ORDER BY
                              TO_NUMBER(CNFG.DS_ORD_POSN_NUM)  ASC
                )
          WHERE ROWNUM &lt;= #rowNum#
    </statement>

    <resultMap id="result.getConfigList" class="NWAL1830_ACMsg">
        <result property="svcConfigMstrPk_A1"           column="SVC_CONFIG_MSTR_PK"              javaType="EZDCBigDecimalItem"/>
        <result property="mdlNm_A1"                     column="T_MDL_NM"                        javaType="EZDCStringItem"/>
        <result property="shipToCustLocAddr_A1"         column="SHIP_TO_CUST_LOC_ADDR"           javaType="EZDCStringItem"/>
        <result property="billToCustLocAddr_A1"         column="BILL_TO_CUST_LOC_ADDR"           javaType="EZDCStringItem"/>
        <result property="dsOrdPosnNum_A1"              column="DS_ORD_POSN_NUM"                 javaType="EZDCStringItem"/>
        <result property="dsCpoConfigPk_A1"             column="DS_CPO_CONFIG_PK"                javaType="EZDCBigDecimalItem"/>
        <result property="shipToPostCd_A1"              column="SHIP_TO_POST_CD"                 javaType="EZDCStringItem"/> <!-- 2020/05/14 QC#56509-1 Add -->
        <result property="ezUpTime_OH"                  column="EZUPTIME"                        javaType="EZDCStringItem"/>
        <result property="ezUpTimeZone_OH"              column="EZUPTIMEZONE"                    javaType="EZDCStringItem"/>
        <result property="dsOrdTpCd_OH"                 column="DS_ORD_TP_CD"                    javaType="EZDCStringItem"/>
        <result property="dsOrdCatgCd_OH"               column="DS_ORD_CATG_CD"                  javaType="EZDCStringItem"/> <!-- 2020/05/14 QC#56509-1 Add -->
    </resultMap>

    <statement id="getDetailList" parameterClass="Map" resultMap="result.getDetailList">

          SELECT 
                    CASE 
                         WHEN ( ORD_LINE_STS_NM IN (#ordLineStsNmLoan#, #ordLineStsNmClose#, #ordLineStsNmPending#) OR OPEN_FLG = 'N' ) AND SET_MDSE_CD IS NULL AND SELL_CPO_ORD_NUM IS NOT NULL THEN SELL_ACTION_NM <!-- 2017/09/11 S21_NA19800 mod -->
                         WHEN ( ORD_LINE_STS_NM IN (#ordLineStsNmLoan#, #ordLineStsNmClose#, #ordLineStsNmPending#) OR OPEN_FLG = 'N' ) AND SET_MDSE_CD IS NULL AND RTRN_CPO_ORD_NUM IS NOT NULL THEN RTRN_ACTION_NM <!-- 2017/09/11 S21_NA19800 mod -->
                         WHEN ORD_LINE_STS_NM NOT IN (#ordLineStsNmLoan#, #ordLineStsNmClose#, #ordLineStsNmPending#) OR SET_MDSE_CD IS NOT NULL THEN #actionLabelNotConv# <!-- 2017/09/11 S21_NA19800 mod -->
                         <!-- WHEN ORD_LINE_STS_NM NOT IN (#ordLineStsNmLoan#, #ordLineStsNmClose#) THEN NULL  2017/09/11 S21_NA19800 del -->
                         ELSE NULL END ACT_LABEL_NM
                  , DPLY_LINE_NUM
                  , MDSE_CD
                  , MDSE_DESC_SHORT_TXT
                  <!-- START 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
                  , INSTL_BASE_CTRL_FLG
                  <!-- END 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
                  , INVTY_CTRL_FLG <!-- 2020/04/13 QC#56374 Add -->
                  , ORD_QTY
                  , SHIP_QTY
                  , CASE WHEN BASE_CMPT_FLG = #baseCmptFlg# THEN MDL_DESC_TXT
                         ELSE NULL END MDL_DESC_TXT
                  , ORD_LINE_STS_NM
                  , DS_ORD_LINE_CATG_DESC_TXT
                  , COA_MDSE_TP_DESC_TXT
                  , COA_PROD_DESC_TXT
                  , RTL_WH_NM
                  , CASE WHEN SER_NUM IS NOT NULL THEN SER_NUM
                         WHEN SELL_SER_NUM IS NOT NULL THEN SELL_SER_NUM
                         WHEN RTRN_SER_NUM IS NOT NULL THEN RTRN_SER_NUM
                         ELSE NULL END SER_NUM
                  <!-- 2017/09/11 S21_NA19800 mod start-->
                  <!--, CASE WHEN OUT_OF_WH_INVTY_PROC_FLG = 'N' THEN NULL
                         WHEN OUT_OF_WH_INVTY_PROC_FLG = 'Y' AND (SELL_CPO_ORD_NUM IS NOT NULL OR RTRN_CPO_ORD_NUM IS NOT NULL) THEN 'Y'
                         WHEN OUT_OF_WH_INVTY_PROC_FLG = 'Y' AND SELL_CPO_ORD_NUM IS NULL AND RTRN_CPO_ORD_NUM IS NULL THEN 'N'
                         WHEN ORD_LINE_STS_NM NOT IN (#ordLineStsNmLoan#, #ordLineStsNmClose#) THEN NULL -->
                  <!-- 2020/04/14 QC#56558 Mod Start -->
                  <!--, CASE WHEN ORD_LINE_STS_NM NOT IN (#ordLineStsNmLoan#, #ordLineStsNmClose#, #ordLineStsNmPending#) THEN NULL -->
                  <!--       WHEN ORD_LINE_STS_NM IN (#ordLineStsNmLoan#, #ordLineStsNmClose#, #ordLineStsNmPending#) AND (SELL_CPO_ORD_NUM IS NOT NULL OR RTRN_CPO_ORD_NUM IS NOT NULL) THEN 'Y' -->
                  <!--       WHEN ORD_LINE_STS_NM IN (#ordLineStsNmLoan#, #ordLineStsNmClose#, #ordLineStsNmPending#) AND SELL_CPO_ORD_NUM IS NULL AND RTRN_CPO_ORD_NUM IS NULL THEN 'N' -->
                  <!-- 2017/09/11 S21_NA19800 mod end-->
                 , CASE WHEN SELL_CPO_ORD_NUM IS NOT NULL OR RTRN_CPO_ORD_NUM IS NOT NULL THEN 'Y'
                        WHEN ORD_LINE_STS_NM IN (#ordLineStsNmLoan#, #ordLineStsNmClose#, #ordLineStsNmPending#) AND SELL_CPO_ORD_NUM IS NULL AND RTRN_CPO_ORD_NUM IS NULL THEN 'N'
                  <!-- 2020/04/14 QC#56558 Mod Start-->
                         ELSE NULL END PROC_FLG
                  , CASE WHEN SELL_CPO_ORD_NUM IS NOT NULL THEN SELL_CPO_ORD_NUM
                         WHEN RTRN_CPO_ORD_NUM IS NOT NULL THEN RTRN_CPO_ORD_NUM
                         ELSE NULL END CONV_CPO_ORD_NUM
                  , CASE WHEN SELL_CPO_ORD_NUM IS NOT NULL THEN SELL_DPLY_LINE_NUM
                         WHEN RTRN_CPO_ORD_NUM IS NOT NULL THEN RTRN_DPLY_LINE_NUM
                         ELSE NULL END CONV_DPLY_LINE_NUM
                  , CASE WHEN SELL_CPO_ORD_NUM IS NOT NULL THEN SELL_ORD_LINE_STS_NM
                         WHEN RTRN_CPO_ORD_NUM IS NOT NULL THEN RTRN_ORD_LINE_STS_NM
                         ELSE NULL END CONV_ORD_LINE_STS_NM
                         
                  <!-- Hidden -->
                  , CPO_ORD_NUM
                  , CPO_DTL_LINE_NUM
                  , CPO_DTL_LINE_SUB_NUM
                  , DS_CPO_CONFIG_PK
                  <!-- 2017/09/11 S21_NA19800 mod start-->
                  <!-- , CASE WHEN ORD_LINE_STS_NM NOT IN (#ordLineStsNmLoan#, #ordLineStsNmClose#) THEN 'N'
                         WHEN OUT_OF_WH_INVTY_PROC_FLG = 'N' THEN 'N'
                         WHEN OUT_OF_WH_INVTY_PROC_FLG = 'Y' AND (SELL_CPO_ORD_NUM IS NOT NULL OR RTRN_CPO_ORD_NUM IS NOT NULL) THEN 'N'
                         WHEN OUT_OF_WH_INVTY_PROC_FLG = 'Y' AND SET_MDSE_CD IS NOT NULL THEN 'N'
                         WHEN ORD_LINE_STS_NM = #ordLineStsNmLoan# AND OUT_OF_WH_INVTY_PROC_FLG = 'Y' AND SELL_CPO_ORD_NUM IS NULL AND RTRN_CPO_ORD_NUM IS NULL THEN 'Y'
                         ELSE 'N' END CONV_ACT_FLG -->
                  , CASE WHEN ORD_LINE_STS_NM NOT IN (#ordLineStsNmLoan#, #ordLineStsNmClose#, #ordLineStsNmPending#) THEN 'N'
                         WHEN ORD_LINE_STS_NM IN (#ordLineStsNmLoan#, #ordLineStsNmClose#, #ordLineStsNmPending#) AND (SELL_CPO_ORD_NUM IS NOT NULL OR RTRN_CPO_ORD_NUM IS NOT NULL) THEN 'N'
                         WHEN ORD_LINE_STS_NM IN (#ordLineStsNmLoan#, #ordLineStsNmClose#, #ordLineStsNmPending#) AND SET_MDSE_CD IS NOT NULL THEN 'N'
                         WHEN ORD_LINE_STS_NM IN (#ordLineStsNmLoan#, #ordLineStsNmClose#, #ordLineStsNmPending#) AND SELL_CPO_ORD_NUM IS NULL AND RTRN_CPO_ORD_NUM IS NULL THEN 'Y'
                         ELSE 'N' END CONV_ACT_FLG
                  <!-- 2017/09/11 S21_NA19800 mod end-->
                  , LOAN_BAL_QTY
                  , ORD_LINE_STS_CD
                  , CPO_OPEN_FLG
                  , CASE WHEN BASE_CMPT_FLG = #baseCmptFlg# THEN SVC_MACH_MAINT_AVAL_FLG
                         ELSE NULL END SVC_MACH_MAINT_AVAL_FLG
                  , CASE WHEN BASE_CMPT_FLG = #baseCmptFlg# THEN SVC_MACH_MSTR_STS_CD
                         ELSE NULL END SVC_MACH_MSTR_STS_CD
                  , DS_ORD_POSN_NUM
                  , RTL_WH_CD
                  , RTL_SWH_CD
                  , SET_MDSE_CD
                  , SVC_MACH_MSTR_PK
                  , MDSE_CD_IB
                  , BASE_CMPT_FLG
                  , EZUPTIME
                  , EZUPTIMEZONE
                  , SP_MDSE_CD <!-- 2016/09/29 S21_NA#14887 Add End -->
          FROM (
                    SELECT 
                             CONCAT (DCPOD.DS_ORD_POSN_NUM, '.') ||
                                 CONCAT (DCPOD.DS_CPO_LINE_NUM, DECODE (DCPOD.DS_CPO_LINE_SUB_NUM, NULL, '', '.')) || DCPOD.DS_CPO_LINE_SUB_NUM AS DPLY_LINE_NUM
                           , MM.SER_NUM
                           , DCPOD.LOAN_BAL_QTY
                           , DCPOD.BASE_CMPT_FLG
                           , DCPOD.DS_ORD_POSN_NUM
                           , DCPOD.RTL_WH_CD
                           , DCPOD.RTL_SWH_CD
                           , DCPOD.CPO_ORD_NUM
                           , DCPOD.CPO_DTL_LINE_NUM
                           , DCPOD.CPO_DTL_LINE_SUB_NUM
                           , DCPOD.DS_CPO_CONFIG_PK
                           <!-- 2017/11/06 S21_NA#22157 Mod Start -->
                           <!-- , CPOD.MDSE_CD  -->
                           , DECODE(DCPOD.SBST_MDSE_CD, null, NVL(OTM.ORD_TAKE_MDSE_CD, DCPOD.MDSE_CD), DCPOD.ORIG_MDSE_CD) AS MDSE_CD
                           <!-- 2017/11/06 S21_NA#22157 Mod End -->
                           , MDSE.MDSE_DESC_SHORT_TXT
                           <!-- START 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
                           , MDSE.INSTL_BASE_CTRL_FLG
                           <!-- END 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
                           , MDSE.INVTY_CTRL_FLG <!-- 2020/04/13 QC#56374 Add -->
                           , DCPOD.ORD_QTY
                           , DCPOD.SHIP_QTY
                           , DCPOD.SET_MDSE_CD
                           , DCPOD.OPEN_FLG
                           , CATG.DS_ORD_LINE_CATG_DESC_TXT
                           , COAPJ.COA_PROJ_DESC_TXT AS COA_MDSE_TP_DESC_TXT
                           , COAPD.COA_PROD_DESC_TXT
                           , RWH.RTL_WH_NM
                           , CNFG.MDL_DESC_TXT
                           , STS.ORD_LINE_STS_NM
                           , STS.ORD_LINE_STS_CD
                           , STS.CPO_OPEN_FLG
                           , PT.OUT_OF_WH_INVTY_PROC_FLG
                           , MM.SVC_MACH_MAINT_AVAL_FLG
                           , MM.SVC_MACH_MSTR_STS_CD
                           , MM.MDSE_CD AS MDSE_CD_IB
                           , MM.SVC_MACH_MSTR_PK
                           
                           , CONV_SLS.CPO_ORD_NUM  AS SELL_CPO_ORD_NUM
                           , CONCAT (CONV_SLS.DS_ORD_POSN_NUM, '.') || 
                               CONCAT (CONV_SLS.DS_CPO_LINE_NUM, DECODE (CONV_SLS.DS_CPO_LINE_SUB_NUM, NULL, '', '.')) || CONV_SLS.DS_CPO_LINE_SUB_NUM
                               AS SELL_DPLY_LINE_NUM
                           , CONV_SLS.DS_ORD_LINE_CATG_CD AS SELL_DS_ORD_LINE_CATG_CD
                           , CONV_SLS.FIRST_BIZ_CTX_ATTRB_TXT AS SELL_ACTION_NM
                           , CONV_SLS.SER_NUM AS SELL_SER_NUM
                           , CONV_SSTS.ORD_LINE_STS_NM  AS SELL_ORD_LINE_STS_NM
                           
                           , CONV_RTRN.CPO_ORD_NUM AS RTRN_CPO_ORD_NUM
                           , CONCAT (CONV_RTRN.DS_ORD_POSN_NUM, '.')|| 
                               CONCAT (CONV_RTRN.DS_CPO_LINE_NUM, DECODE (CONV_RTRN.DS_CPO_LINE_SUB_NUM, NULL, '', '.')) || CONV_RTRN.DS_CPO_LINE_SUB_NUM
                               AS RTRN_DPLY_LINE_NUM
                           , CONV_RTRN.DS_ORD_LINE_CATG_CD AS RTRN_DS_ORD_LINE_CATG_CD
                           , CONV_RTRN.FIRST_BIZ_CTX_ATTRB_TXT AS RTRN_ACTION_NM
                           , CONV_RTRN.SER_NUM AS RTRN_SER_NUM
                           , CONV_RSTS.ORD_LINE_STS_NM AS RTRN_ORD_LINE_STS_NM
                           , DCPOD.EZUPTIME
                           , DCPOD.EZUPTIMEZONE
                           , SP.SP_MDSE_CD AS SP_MDSE_CD <!-- 2016/09/29 S21_NA#14887 Add -->
                    FROM 
                             CPO_DTL              DCPOD
                           <!-- 2017/11/06 S21_NA#22157 Del Start -->
                           <!-- , CPO_DTL              CPOD -->
                           <!-- 2017/11/06 S21_NA#22157 Del End -->
                           , CPO                  DCPO
                           , DS_ORD_LINE_PROC_DFN LPD
                           , ORD_PROC_TP          PT
                           , DS_CPO_CONFIG        CNFG
                           <!-- Machine Master -->
                           , (
                               SELECT 
                                      MM.CPO_ORD_NUM
                                    , MM.CPO_DTL_LINE_NUM
                                    , MM.CPO_DTL_LINE_SUB_NUM
                                    , MM.MDSE_CD
                                    , MM.SVC_MACH_MSTR_PK
                                    , MM.SER_NUM
                                    , MM.SVC_MACH_MAINT_AVAL_FLG
                                    , MM.SVC_MACH_MSTR_STS_CD
                                    , ROW_NUMBER() OVER (PARTITION BY MM.CPO_ORD_NUM, MM.CPO_DTL_LINE_NUM, MM.CPO_DTL_LINE_SUB_NUM ORDER BY MM.SVC_MACH_MSTR_STS_CD) RANK_NUM
                               FROM   SVC_MACH_MSTR MM
                               WHERE  MM.GLBL_CMPY_CD = #glblCmpyCd# 
                                  AND MM.CPO_ORD_NUM  = #cpoOrdNum#
                                  AND MM.EZCANCELFLAG = '0'
                             )   MM
                           <!-- For Getting Description -->
                           , DS_ORD_LINE_CATG     CATG
                           , ALL_MDSE_V           MDSE
                           <!-- 2017/11/06 S21_NA#22157 Add Start -->
                           , ORD_TAKE_MDSE OTM
                           <!-- 2017/11/06 S21_NA#22157 Add End -->
                           , COA_PROJ             COAPJ
                           , COA_PROD             COAPD
                           , RTL_WH               RWH
                           <!-- Conversion Sell Order -->
                           , (
                               SELECT 
                                      DCPOD.CPO_ORD_NUM
                                    , DCPOD.CPO_DTL_LINE_NUM
                                    , DCPOD.CPO_DTL_LINE_SUB_NUM
                                    , DCPOD.DS_ORD_POSN_NUM
                                    , DCPOD.DS_CPO_LINE_NUM
                                    , DCPOD.DS_CPO_LINE_SUB_NUM
                                    , DCPOD.DS_ORD_LINE_CATG_CD
                                    , OLVS.FIRST_BIZ_CTX_ATTRB_TXT
                                    , DCPOD.ORIG_CPO_ORD_NUM
                                    , DCPOD.ORIG_CPO_DTL_LINE_NUM
                                    , DCPOD.ORIG_CPO_DTL_LINE_SUB_NUM
                                    , DCPOD.SER_NUM
                                    , ROW_NUMBER() OVER (PARTITION BY DCPOD.ORIG_CPO_ORD_NUM, DCPOD.ORIG_CPO_DTL_LINE_NUM, DCPOD.ORIG_CPO_DTL_LINE_SUB_NUM ORDER BY DCPOD.CPO_ORD_NUM, DCPOD.CPO_DTL_LINE_NUM, DCPOD.CPO_DTL_LINE_SUB_NUM) RANK_NUM
                               FROM 
                                    <!-- 2017/11/06 S21_NA#22157 Del Start -->
                                    <!--   CPO_DTL              CPOD -->
                                    <!-- 2017/11/06 S21_NA#22157 Del End -->
                                      CPO_DTL              DCPOD
                                    , ORD_LINE_VAL_SET     OLVS
                                    , DS_ORD_LINE_CATG     CATG
                                    , CPO                  C
                               WHERE 
                                     
                                      DCPOD.GLBL_CMPY_CD    = #glblCmpyCd#
                                  AND DCPOD.ORIG_CPO_ORD_NUM      = #cpoOrdNum#
                                  AND DCPOD.ORD_LINE_STS_CD       &lt;&gt; #ordLineStsCdCancel#
                                  AND DCPOD.EZCANCELFLAG   = '0'

                                    <!-- 2017/11/06 S21_NA#22157 Del Start -->
                                  <!-- AND CPOD.GLBL_CMPY_CD         = DCPOD.GLBL_CMPY_CD -->
                                  <!-- AND CPOD.CPO_ORD_NUM          = DCPOD.CPO_ORD_NUM -->
                                  <!-- AND CPOD.CPO_DTL_LINE_NUM     = DCPOD.CPO_DTL_LINE_NUM -->
                                  <!-- AND CPOD.CPO_DTL_LINE_SUB_NUM = DCPOD.CPO_DTL_LINE_SUB_NUM -->
                                  <!-- AND DCPOD.EZCANCELFLAG   = '0' -->
                                    <!-- 2017/11/06 S21_NA#22157 Del End -->

                                  AND DCPOD.GLBL_CMPY_CD          = OLVS.GLBL_CMPY_CD
                                  AND DCPOD.DS_ORD_LINE_CATG_CD   = OLVS.DS_ORD_LINE_CATG_CD
                                  AND OLVS.ORD_LINE_CTX_TP_CD     = #ordLineCtxCd#
                                  AND OLVS.EZCANCELFLAG           = '0'

                                  AND OLVS.GLBL_CMPY_CD          = CATG.GLBL_CMPY_CD
                                  AND OLVS.DS_ORD_LINE_CATG_CD   = CATG.DS_ORD_LINE_CATG_CD
                                  AND CATG.DS_ORD_LINE_DRCTN_CD  = #dsOrdLineDrctnOut#
                                  AND CATG.EZCANCELFLAG          = '0'
                                  
                                  AND DCPOD.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
                                  AND DCPOD.CPO_ORD_NUM           = C.CPO_ORD_NUM
                                  AND C.ORD_HDR_STS_CD           &lt;&gt; #ordHdrStsCdCancel#
                                  AND C.EZCANCELFLAG             = '0'
                             ) CONV_SLS
                           <!-- Conversion Retrun Order -->
                           , (
                               SELECT 
                                      RTRND.CPO_ORD_NUM
                                    , RTRND.DS_CPO_RTRN_LINE_NUM
                                    , RTRND.DS_CPO_RTRN_LINE_SUB_NUM
                                    , RTRND.DS_ORD_POSN_NUM
                                    , RTRND.DS_CPO_LINE_NUM
                                    , RTRND.DS_CPO_LINE_SUB_NUM
                                    , RTRND.DS_ORD_LINE_CATG_CD
                                    , RTRND.ORIG_CPO_ORD_NUM
                                    , RTRND.ORIG_CPO_DTL_LINE_NUM
                                    , RTRND.ORIG_CPO_DTL_LINE_SUB_NUM
                                    , OLVS.FIRST_BIZ_CTX_ATTRB_TXT
                                    , RTRND.SER_NUM
                                    , ROW_NUMBER() OVER (PARTITION BY RTRND.ORIG_CPO_ORD_NUM, RTRND.ORIG_CPO_DTL_LINE_NUM, RTRND.ORIG_CPO_DTL_LINE_SUB_NUM ORDER BY RTRND.CPO_ORD_NUM, RTRND.DS_CPO_RTRN_LINE_NUM, RTRND.DS_CPO_RTRN_LINE_SUB_NUM) RANK_NUM
                                FROM 
                                      DS_CPO_RTRN_DTL      RTRND
                                    , ORD_LINE_VAL_SET     OLVS
                                    , DS_ORD_LINE_CATG     CATG
                                    , CPO                  C
                                WHERE 
                                      RTRND.GLBL_CMPY_CD         = #glblCmpyCd#
                                  AND RTRND.ORIG_CPO_ORD_NUM     = #cpoOrdNum#
                                  AND RTRND.RTRN_LINE_STS_CD    &lt;&gt; #rtrnLineStsCdCancel#
                                  AND RTRND.EZCANCELFLAG         = '0'

                                  AND RTRND.GLBL_CMPY_CD          = OLVS.GLBL_CMPY_CD
                                  AND RTRND.DS_ORD_LINE_CATG_CD   = OLVS.DS_ORD_LINE_CATG_CD
                                  AND OLVS.ORD_LINE_CTX_TP_CD     = #ordLineCtxCd#
                                  AND OLVS.EZCANCELFLAG           = '0'

                                  AND OLVS.GLBL_CMPY_CD           = CATG.GLBL_CMPY_CD
                                  AND OLVS.DS_ORD_LINE_CATG_CD    = CATG.DS_ORD_LINE_CATG_CD
                                  AND CATG.DS_ORD_LINE_DRCTN_CD   = #dsOrdLineDrctnIn#
                                  AND CATG.EZCANCELFLAG           = '0'
                                  
                                  AND RTRND.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
                                  AND RTRND.CPO_ORD_NUM           = C.CPO_ORD_NUM
                                  AND C.ORD_HDR_STS_CD            &lt;&gt; #ordHdrStsCdCancel#
                                  AND C.EZCANCELFLAG              = '0'
                             ) CONV_RTRN

                           <!-- STATUS -->
                           , (SELECT
                                     DOS.CPO_ORD_NUM
                                   , DOS.CPO_DTL_LINE_NUM
                                   , DOS.CPO_DTL_LINE_SUB_NUM
                                   , DOS.ORD_LINE_STS_NM
                                   , DOS.ORD_LINE_STS_CD
                                   , DOS.CPO_OPEN_FLG
                                   , ROW_NUMBER() OVER (PARTITION BY DOS.CPO_ORD_NUM, DOS.CPO_DTL_LINE_NUM, DOS.CPO_DTL_LINE_SUB_NUM ORDER BY DOS.SHPG_STS_CD NULLS FIRST) RANK_NUM
                              FROM
                                     DS_ORD_STS_V DOS
                              WHERE 
                                     DOS.GLBL_CMPY_CD = #glblCmpyCd#
                                 AND DOS.CPO_ORD_NUM  = #cpoOrdNum#
                                 AND DOS.EZCANCELFLAG = '0'
                              ) STS  
                           , (SELECT
                                     DOS.CPO_ORD_NUM
                                   , DOS.CPO_DTL_LINE_NUM
                                   , DOS.CPO_DTL_LINE_SUB_NUM
                                   , DOS.ORD_LINE_STS_NM
                                   , DOS.ORD_LINE_STS_CD
                                   , DOS.CPO_OPEN_FLG
                                   , ROW_NUMBER() OVER (PARTITION BY DOS.CPO_ORD_NUM, DOS.CPO_DTL_LINE_NUM, DOS.CPO_DTL_LINE_SUB_NUM ORDER BY DOS.SHPG_STS_CD NULLS FIRST) RANK_NUM
                              FROM
                                     DS_ORD_STS_V DOS
                              WHERE 
                                     DOS.GLBL_CMPY_CD = #glblCmpyCd#
                                 AND DOS.EZCANCELFLAG = '0'
                              ) CONV_SSTS  
                           , (SELECT
                                     DOS.CPO_ORD_NUM
                                   , DOS.DS_CPO_RTRN_LINE_NUM
                                   , DOS.DS_CPO_RTRN_LINE_SUB_NUM
                                   , DOS.ORD_LINE_STS_NM
                                   , DOS.RTRN_LINE_STS_CD
                                   , DOS.CPO_OPEN_FLG
                                   , ROW_NUMBER() OVER (PARTITION BY DOS.CPO_ORD_NUM, DOS.DS_CPO_RTRN_LINE_NUM, DOS.DS_CPO_RTRN_LINE_SUB_NUM ORDER BY DOS.RTRN_LINE_STS_CD NULLS FIRST) RANK_NUM
                              FROM
                                     DS_ORD_STS_V DOS
                              WHERE 
                                     DOS.GLBL_CMPY_CD = #glblCmpyCd#
                                 AND DOS.EZCANCELFLAG = '0'
                              ) CONV_RSTS

                           <!-- 2016/09/29 S21_NA#14887 Add Start -->
                           <!-- SHPG_PLN -->
                           , (SELECT
                                     GLBL_CMPY_CD
                                   , TRX_HDR_NUM
                                   , TRX_LINE_NUM
                                   , TRX_LINE_SUB_NUM
                                   , MIN(MDSE_CD) SP_MDSE_CD
                              FROM
                                     SHPG_PLN
                              WHERE
                                     GLBL_CMPY_CD = #glblCmpyCd#
                                 AND TRX_HDR_NUM  = #cpoOrdNum#
                                 AND EZCANCELFLAG = '0'
                              GROUP BY
                                     GLBL_CMPY_CD
                                   , TRX_HDR_NUM
                                   , TRX_LINE_NUM
                                   , TRX_LINE_SUB_NUM
                              ) SP
                           <!-- 2016/09/29 S21_NA#14887 Add End -->
                    WHERE 
                             DCPOD.GLBL_CMPY_CD         = #glblCmpyCd#
                         AND DCPOD.CPO_ORD_NUM          = #cpoOrdNum#
                         AND DCPOD.EZCANCELFLAG         = '0'
                         <!-- 2017/11/06 S21_NA#22157 Del Start -->
                         <!-- AND DCPOD.GLBL_CMPY_CD         = CPOD.GLBL_CMPY_CD -->
                         <!-- AND DCPOD.CPO_ORD_NUM          = CPOD.CPO_ORD_NUM -->
                         <!-- AND DCPOD.CPO_DTL_LINE_NUM     = CPOD.CPO_DTL_LINE_NUM -->
                         <!-- AND DCPOD.CPO_DTL_LINE_SUB_NUM = CPOD.CPO_DTL_LINE_SUB_NUM -->
                         <!-- AND CPOD.EZCANCELFLAG          = '0' -->
                         <!-- 2017/11/06 S21_NA#22157 Del Start -->
                         AND DCPOD.GLBL_CMPY_CD         = DCPO.GLBL_CMPY_CD
                         AND DCPOD.CPO_ORD_NUM          = DCPO.CPO_ORD_NUM
                         AND DCPO.EZCANCELFLAG          = '0'
                         AND DCPO.GLBL_CMPY_CD          = LPD.GLBL_CMPY_CD
                         AND DCPO.DS_ORD_TP_CD          = LPD.DS_ORD_TP_CD
                         AND DCPOD.DS_ORD_LINE_CATG_CD  = LPD.DS_ORD_LINE_CATG_CD
                         AND LPD.ACTV_FLG               = #actvFlg#
                         AND LPD.EFF_FROM_DT            &lt;= #slsDt#
                         AND (LPD.EFF_THRU_DT           &gt;= #slsDt# OR LPD.EFF_THRU_DT IS NULL )
                         AND LPD.EZCANCELFLAG           = '0'
                         AND LPD.GLBL_CMPY_CD           = PT.GLBL_CMPY_CD
                         AND LPD.ORD_PROC_TP_CD         = PT.ORD_PROC_TP_CD
                         AND PT.ACTV_FLG                = #actvFlg#
                         AND PT.EFF_FROM_DT             &lt;= #slsDt#
                         AND (PT.EFF_THRU_DT            &gt;= #slsDt# OR PT.EFF_THRU_DT IS NULL )
                         AND PT.EZCANCELFLAG            = '0'
                        
                         AND DCPOD.GLBL_CMPY_CD         = CNFG.GLBL_CMPY_CD
                         AND DCPOD.DS_CPO_CONFIG_PK     = CNFG.DS_CPO_CONFIG_PK
                         AND CNFG.CONFIG_CATG_CD        = #configCatgCd#
                         AND CNFG.EZCANCELFLAG          = '0'
                         <!-- Machine Master -->
                         AND DCPOD.CPO_ORD_NUM          = MM.CPO_ORD_NUM(+)
                         AND DCPOD.CPO_DTL_LINE_NUM     = MM.CPO_DTL_LINE_NUM(+)
                         AND DCPOD.CPO_DTL_LINE_SUB_NUM = MM.CPO_DTL_LINE_SUB_NUM(+)
                         AND MM.RANK_NUM(+)               = 1

                         <!-- For Getting Description -->
                         AND DCPOD.GLBL_CMPY_CD         = CATG.GLBL_CMPY_CD(+)
                         AND DCPOD.DS_ORD_LINE_CATG_CD  = CATG.DS_ORD_LINE_CATG_CD(+)
                         AND CATG.EZCANCELFLAG(+)       = '0'
                         AND DCPOD.GLBL_CMPY_CD          = MDSE.GLBL_CMPY_CD(+)
                         AND DCPOD.MDSE_CD               = MDSE.MDSE_CD(+)
                         AND MDSE.EZCANCELFLAG(+)      = '0'
                         <!-- 2017/11/06 S21_NA#22157 Add Start -->
                         AND DCPOD.GLBL_CMPY_CD         = OTM.GLBL_CMPY_CD(+)
                         AND SUBSTR(DCPOD.MDSE_CD,1,8)  = OTM.ORD_TAKE_MDSE_CD(+)
                         AND OTM.EZCANCELFLAG(+)        = '0'
                         <!-- 2017/11/06 S21_NA#22157 Add End -->
                         AND MDSE.GLBL_CMPY_CD          = COAPJ.GLBL_CMPY_CD(+)
                         AND MDSE.COA_MDSE_TP_CD        = COAPJ.COA_PROJ_CD(+)
                         AND COAPJ.EZCANCELFLAG(+)      = '0'
                         AND DCPOD.GLBL_CMPY_CD          = COAPD.GLBL_CMPY_CD(+)
                         AND DCPOD.COA_PROD_CD           = COAPD.COA_PROD_CD(+)
                         AND COAPD.EZCANCELFLAG(+)      = '0'
                         AND DCPOD.GLBL_CMPY_CD         = RWH.GLBL_CMPY_CD(+)
                         AND DCPOD.RTL_WH_CD            = RWH.RTL_WH_CD(+)
                         AND RWH.EZCANCELFLAG(+)         = '0'
                         
                         <!-- Conversion Sell Order -->
                         AND DCPO.CPO_ORD_NUM                 = CONV_SLS.ORIG_CPO_ORD_NUM(+)
                         AND DCPOD.CPO_DTL_LINE_NUM           = CONV_SLS.ORIG_CPO_DTL_LINE_NUM(+)
                         AND DCPOD.CPO_DTL_LINE_SUB_NUM       = CONV_SLS.ORIG_CPO_DTL_LINE_SUB_NUM(+)
                         AND CONV_SLS.RANK_NUM(+)               = 1
                         
                         <!-- Conversion Retrun Order -->
                         AND DCPO.CPO_ORD_NUM                 = CONV_RTRN.ORIG_CPO_ORD_NUM(+)
                         AND DCPOD.CPO_DTL_LINE_NUM           = CONV_RTRN.ORIG_CPO_DTL_LINE_NUM(+)
                         AND DCPOD.CPO_DTL_LINE_SUB_NUM       = CONV_RTRN.ORIG_CPO_DTL_LINE_SUB_NUM(+)
                         AND CONV_RTRN.RANK_NUM(+)               = 1
                         
                         <!-- STATUS -->
                         AND DCPOD.CPO_ORD_NUM                = STS.CPO_ORD_NUM  
                         AND DCPOD.CPO_DTL_LINE_NUM           = STS.CPO_DTL_LINE_NUM 
                         AND DCPOD.CPO_DTL_LINE_SUB_NUM       = STS.CPO_DTL_LINE_SUB_NUM
                         AND STS.RANK_NUM = 1   
                                    
                         AND CONV_SLS.CPO_ORD_NUM             = CONV_SSTS.CPO_ORD_NUM(+) 
                         AND CONV_SLS.CPO_DTL_LINE_NUM        = CONV_SSTS.CPO_DTL_LINE_NUM   (+)
                         AND CONV_SLS.CPO_DTL_LINE_SUB_NUM    = CONV_SSTS.CPO_DTL_LINE_SUB_NUM(+)
                         AND CONV_SSTS.RANK_NUM (+)           = 1

                         AND CONV_RTRN.CPO_ORD_NUM               = CONV_RSTS.CPO_ORD_NUM(+) 
                         AND CONV_RTRN.DS_CPO_RTRN_LINE_NUM      = CONV_RSTS.DS_CPO_RTRN_LINE_NUM(+)
                         AND CONV_RTRN.DS_CPO_RTRN_LINE_SUB_NUM  = CONV_RSTS.DS_CPO_RTRN_LINE_SUB_NUM(+)
                         AND CONV_RSTS.RANK_NUM (+)              = 1

                         <!-- 2016/09/29 S21_NA#14887 Add Start -->
                         AND DCPOD.GLBL_CMPY_CD                = SP.GLBL_CMPY_CD
                         AND DCPOD.CPO_ORD_NUM                 = SP.TRX_HDR_NUM
                         AND DCPOD.CPO_DTL_LINE_NUM            = SP.TRX_LINE_NUM
                         AND DCPOD.CPO_DTL_LINE_SUB_NUM        = SP.TRX_LINE_SUB_NUM
                         <!-- 2016/09/29 S21_NA#14887 Add End -->

                   ORDER BY 
                             DCPOD.CPO_ORD_NUM
                           , TO_NUMBER(DCPOD.DS_ORD_POSN_NUM)
                           , DCPOD.DS_CPO_LINE_NUM
                           , DCPOD.DS_CPO_LINE_SUB_NUM NULLS FIRST
                )
          WHERE ROWNUM &lt;= #rowNum#
    </statement>

    <resultMap id="result.getDetailList" class="NWAL1830_BCMsg">
        <result property="xxScrItem50Txt_B1"         column="ACT_LABEL_NM"              javaType="EZDCStringItem"/>
        <result property="dplyLineNum_B1"            column="DPLY_LINE_NUM"             javaType="EZDCStringItem"/>
        <result property="mdseCd_B1"                 column="MDSE_CD"                   javaType="EZDCStringItem"/>
        <result property="mdseDescShortTxt_B1"       column="MDSE_DESC_SHORT_TXT"       javaType="EZDCStringItem"/>
        <result property="ordQty_B1"                 column="ORD_QTY"                   javaType="EZDCBigDecimalItem"/>
        <result property="shipQty_B1"                column="SHIP_QTY"                  javaType="EZDCBigDecimalItem"/>
        <result property="mdlNm_B1"                  column="MDL_DESC_TXT"              javaType="EZDCStringItem"/>
        <result property="ordLineStsDescTxt_B1"      column="ORD_LINE_STS_NM"           javaType="EZDCStringItem"/>
        <result property="dsOrdLineCatgDescTxt_B1"   column="DS_ORD_LINE_CATG_DESC_TXT" javaType="EZDCStringItem"/>
        <result property="coaMdseTpDescTxt_B1"       column="COA_MDSE_TP_DESC_TXT"      javaType="EZDCStringItem"/>
        <result property="coaProdDescTxt_B1"         column="COA_PROD_DESC_TXT"         javaType="EZDCStringItem"/>
        <result property="rtlWhNm_B1"                column="RTL_WH_NM"                 javaType="EZDCStringItem"/>
        <result property="serNum_B1"                 column="SER_NUM"                   javaType="EZDCStringItem"/>
        <result property="procFlg_B1"                column="PROC_FLG"                  javaType="EZDCStringItem"/>
        <result property="cpoOrdNum_B2"              column="CONV_CPO_ORD_NUM"          javaType="EZDCStringItem"/>
        <result property="dplyLineNum_B2"            column="CONV_DPLY_LINE_NUM"        javaType="EZDCStringItem"/>
        <result property="ordLineStsDescTxt_B2"      column="CONV_ORD_LINE_STS_NM"      javaType="EZDCStringItem"/>
         <!-- Hidden -->
         <result property="cpoOrdNum_B1"             column="CPO_ORD_NUM"               javaType="EZDCStringItem"/>
        <result property="cpoDtlLineNum_B1"          column="CPO_DTL_LINE_NUM"          javaType="EZDCStringItem"/>
        <result property="cpoDtlLineSubNum_B1"       column="CPO_DTL_LINE_SUB_NUM"      javaType="EZDCStringItem"/>
        <result property="dsOrdPosnNum_B1"           column="DS_ORD_POSN_NUM"           javaType="EZDCStringItem"/>
        <result property="dsCpoConfigPk_B1"          column="DS_CPO_CONFIG_PK"          javaType="EZDCBigDecimalItem"/>
        <result property="xxDplyCtrlFlg_B1"          column="CONV_ACT_FLG"              javaType="EZDCStringItem"/>
        <result property="loanBalQty_B1"             column="LOAN_BAL_QTY"              javaType="EZDCBigDecimalItem"/>
        <result property="ordLineStsCd_B1"           column="ORD_LINE_STS_CD"           javaType="EZDCStringItem"/>
        <result property="cpoOpenFlg_B1"             column="CPO_OPEN_FLG"              javaType="EZDCStringItem"/>
        <result property="svcMachMaintAvalFlg_B1"    column="SVC_MACH_MAINT_AVAL_FLG"   javaType="EZDCStringItem"/>
        <result property="svcMachMstrStsCd_B1"       column="SVC_MACH_MSTR_STS_CD"      javaType="EZDCStringItem"/>
        <result property="rtlWhCd_B1"                column="RTL_WH_CD"                 javaType="EZDCStringItem"/>
        <result property="rtlSwhCd_B1"               column="RTL_SWH_CD"                javaType="EZDCStringItem"/>
        <result property="setMdseCd_B1"              column="SET_MDSE_CD"               javaType="EZDCStringItem"/>
        <result property="svcMachMstrPk_B1"          column="SVC_MACH_MSTR_PK"          javaType="EZDCBigDecimalItem"/>
        <result property="mdseCd_BM"                 column="MDSE_CD_IB"                javaType="EZDCStringItem"/>
        <result property="baseCmptFlg_B1"            column="BASE_CMPT_FLG"             javaType="EZDCStringItem"/>
        <!-- 2020/04/13 QC#56374 Add Start -->
        <result property="instlBaseCtrlFlg_B1"       column="INSTL_BASE_CTRL_FLG"       javaType="EZDCStringItem"/>
        <result property="invtyCtrlFlg_B1"           column="INVTY_CTRL_FLG"            javaType="EZDCStringItem"/>
        <!-- 2020/04/13 QC#56374 Add End -->
        <result property="ezUpTime_B1"               column="EZUPTIME"                  javaType="EZDCStringItem"/>
        <result property="ezUpTimeZone_B1"           column="EZUPTIMEZONE"              javaType="EZDCStringItem"/>
        <result property="mdseCd_SP"                 column="SP_MDSE_CD"                javaType="EZDCStringItem"/>

    </resultMap>

    <statement id="getWhInfoWithRsn" parameterClass="Map" resultClass="Map">
        SELECT
            WH.RTL_WH_CD AS RTL_WH_CD
           ,WH.RTL_WH_NM AS RTL_WH_NM
        FROM
            DS_ORD_TP_LOC_ROLE_RELN LRR
           ,LOC_USG                 LU
           ,DS_INVTY_LOC_V          WH
        WHERE
            LRR.GLBL_CMPY_CD     = #glblCmpyCd#
            AND LRR.DS_ORD_TP_CD = #dsOrdTpCd#
            AND LRR.EZCANCELFLAG = '0'

            AND LRR.GLBL_CMPY_CD   = LU.GLBL_CMPY_CD
            AND LRR.LOC_ROLE_TP_CD = LU.LOC_ROLE_TP_CD
            AND LU.EZCANCELFLAG    = '0'

            AND LU.GLBL_CMPY_CD = WH.GLBL_CMPY_CD
            AND LU.PTY_LOC_PK   = WH.PTY_LOC_PK
            AND WH.RGTN_STS_CD  = #rgtnStsCd#
            AND WH.EFF_FROM_DT  <![CDATA[<=]]> #slsDt#
            AND NVL(WH.EFF_THRU_DT, '99991231') <![CDATA[>=]]> #slsDt#
            AND WH.EZCANCELFLAG = '0'

            AND WH.RTL_WH_NM    = #rtlWhNm#
            AND ROWNUM = 1
        GROUP BY
            WH.RTL_WH_CD
           ,WH.RTL_WH_NM
    </statement>
    
    <statement id="getSlsRep" parameterClass="Map" resultClass="Map">
          SELECT
              T.TOC_CD
             ,T.TOC_NM
          FROM
              TOC T
             ,ORG_FUNC_ROLE_TP OFRT
             ,BIZ_AREA_ORG     BA
             ,S21_ORG          SO  <!-- 2016/10/21 S21_NA#14607 Add -->
          WHERE
                  T.GLBL_CMPY_CD        = #glblCmpyCd#
              AND UPPER(T.TOC_NM)       = UPPER(#slsRepTocNm#) <!-- S21_NA#13627 MOD -->
              AND T.EZCANCELFLAG        = '0'
              AND T.GLBL_CMPY_CD        = OFRT.GLBL_CMPY_CD
              AND T.ORG_FUNC_ROLE_TP_CD = OFRT.ORG_FUNC_ROLE_TP_CD
              AND OFRT.SLS_REP_FLG      = #slsRepFlg#
              AND OFRT.EZCANCELFLAG     = '0'
              AND OFRT.GLBL_CMPY_CD     = BA.GLBL_CMPY_CD
              AND OFRT.FIRST_ORG_CD     = BA.BIZ_AREA_ORG_CD
              AND BA.SLS_FLG            = #slsFlg#
              AND BA.ORG_STRU_TP_CD     = #orgStruTpCd#
              AND BA.EZCANCELFLAG       = '0'
              <!-- 2016/10/21 S21_NA#14607 Add Start -->
              AND T.GLBL_CMPY_CD        = SO.GLBL_CMPY_CD
              AND T.TOC_CD              = SO.TOC_CD
              AND SO.RGTN_STS_CD       != #rgtnStsCd#
              <!-- 2016/10/21 S21_NA#14607 Add End -->
              AND ROWNUM = 1
    </statement>
    
    <statement id="getOrdCatgBizCtx" parameterClass="Map" resultClass="String">
        SELECT 
                #flgY#
          FROM
                ORD_CATG_BIZ_CTX OCBC
         WHERE
                OCBC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND OCBC.EZCANCELFLAG        = '0'
            AND OCBC.ORD_CATG_CTX_TP_CD  = #ordCatgCtxTpCd#
        <isNotNull property="dsOrdCatgCd">
            AND (OCBC.DS_ORD_CATG_CD = #dsOrdCatgCd# OR OCBC.DS_ORD_CATG_CD IS NULL)
        </isNotNull>
        <isNull property="dsOrdCatgCd">
            AND OCBC.DS_ORD_CATG_CD IS NULL
        </isNull>
        <isNotNull property="dsOrdTpCd">
            AND (OCBC.DS_ORD_TP_CD = #dsOrdTpCd# OR OCBC.DS_ORD_TP_CD IS NULL)
        </isNotNull>
        <isNull property="dsOrdTpCd">
            AND OCBC.DS_ORD_TP_CD IS NULL
        </isNull>
    </statement>
    
    <statement id="getOrdHdr" parameterClass="Map" resultClass="Map">
          SELECT 
              <!-- FROM CPO -->
                C.CPO_ORD_NUM
              , C.CPO_ORD_TP_CD
              , C.CUST_ISS_PO_NUM
              , C.CUST_ISS_PO_DT
              , C.SYS_SRC_CD
              , C.CPO_SRC_TP_CD
              , C.ORD_FUFL_LVL_CD
              , C.BILL_TO_CUST_CD
              , C.SELL_TO_CUST_CD
              , C.ADD_RDD_DT
              , C.ADD_SHPG_SVC_LVL_CD
              , C.ADD_DROP_SHIP_FLG
              , C.ADD_SHIP_TO_LOC_NM
              , C.ADD_SHIP_TO_CUST_CD
              , C.ADD_SHIP_TO_ADDL_LOC_NM
              , C.ADD_SHIP_TO_FIRST_LINE_ADDR
              , C.ADD_SHIP_TO_SCD_LINE_ADDR
              , C.ADD_SHIP_TO_THIRD_LINE_ADDR
              , C.ADD_SHIP_TO_FRTH_LINE_ADDR
              , C.ADD_SHIP_TO_CTY_ADDR
              , C.ADD_SHIP_TO_ST_CD
              , C.ADD_SHIP_TO_PROV_NM
              , C.ADD_SHIP_TO_POST_CD
              , C.ADD_SHIP_TO_CTRY_CD
              , C.ADD_SHIP_TO_CNTY_NM   
              , C.ADD_SHIP_TO_01_REF_CMNT_TXT
              , C.ADD_SHIP_TO_02_REF_CMNT_TXT
              , C.ADD_PMT_TERM_CASH_DISC_CD
              , C.SEND_INV_FLG
              , C.CPO_ORD_TS

              , C.DS_ORD_CATG_CD
              , C.DS_ORD_TP_CD
              , C.DS_ORD_RSN_CD
              , C.BILL_TO_CUST_ACCT_CD
              , C.SHIP_TO_CUST_ACCT_CD
              , C.SOLD_TO_CUST_LOC_CD
              , C.CARR_ACCT_NUM
              , C.ORD_SGN_DT
              , C.SLS_REP_TOC_CD
              , C.PRC_BASE_DT
              , C.PRC_CALC_DT
              , C.NEGO_DEAL_AMT
              , C.PRC_CATG_CD
              , C.FL_PRC_LIST_CD
              , C.CSMP_CONTR_NUM
              , C.PRC_CONTR_NUM
              , C.AQU_NUM
              , C.ORD_SRC_IMPT_DT
              , C.ORD_SRC_REF_NUM
              , C.LOAN_PER_DAYS_AOT
              , C.LEASE_CMPY_PO_NUM
              , C.LEASE_PRCH_OPT_CD
              , C.LEASE_TERM_MTH_AOT
              , C.LEASE_PMT_FREQ_CD
              , C.LEASE_TOT_PMT_AMT
              , C.ORD_LOG_TP_CD
              , C.CSMP_CONTR_NUM
              , C.DLR_REF_NUM
              , C.FRT_COND_CD
              , C.CARR_SVC_LVL_CD
              , C.SPCL_HDLG_TP_CD
              , C.DS_PMT_METH_CD
              , C.PRE_PMT_CHK_NUM
              , C.PRE_PMT_AMT
              , C.PRE_PMT_TP_CD
              , C.ORG_RQST_DELY_DT
          FROM
                CPO C
          WHERE
                  C.GLBL_CMPY_CD        = #glblCmpyCd#
              AND C.CPO_ORD_NUM         = #cpoOrdNum#
              AND C.EZCANCELFLAG        = '0'
    </statement>
    
    <statement id="getOrdConfig" parameterClass="Map" resultClass="Map">
          SELECT
                DS_CPO_CONFIG_PK
              , CPO_ORD_NUM
              , DS_ORD_POSN_NUM
              , CONFIG_CATG_CD
              , CONFIG_TP_CD
              , SVC_CONFIG_MSTR_PK
              , MDL_ID
              , MDL_DESC_TXT
              , BILL_TO_CUST_ACCT_CD
              , BILL_TO_CUST_LOC_CD
              , SHIP_TO_CUST_ACCT_CD
              , SHIP_TO_CUST_LOC_CD
              , DROP_SHIP_FLG
              , SHIP_TO_LOC_NM
              , SHIP_TO_ADDL_LOC_NM
              , SHIP_TO_FIRST_LINE_ADDR
              , SHIP_TO_SCD_LINE_ADDR
              , SHIP_TO_THIRD_LINE_ADDR
              , SHIP_TO_FRTH_LINE_ADDR
              , SHIP_TO_FIRST_REF_CMNT_TXT
              , SHIP_TO_SCD_REF_CMNT_TXT
              , SHIP_TO_CTY_ADDR
              , SHIP_TO_ST_CD
              , SHIP_TO_PROV_NM
              , SHIP_TO_CNTY_NM
              , SHIP_TO_POST_CD
              , SHIP_TO_CTRY_CD
              , PICK_SVC_CONFIG_MSTR_PK
          FROM
                DS_CPO_CONFIG CNFG
          WHERE
                  CNFG.GLBL_CMPY_CD        = #glblCmpyCd#
              AND CNFG.CPO_ORD_NUM         = #cpoOrdNum#
              <isNotNull property="configPkList">
              AND   CNFG.DS_CPO_CONFIG_PK IN  
                <iterate property="configPkList" var="configPkList[]" open="(" close=")" conjunction=",">
                            #configPkList[]#
                </iterate>
              </isNotNull>
              AND CNFG.EZCANCELFLAG        = '0'
          ORDER BY
                  TO_NUMBER(CNFG.DS_ORD_POSN_NUM)
    </statement>
    
    <statement id="getOrdDtl" parameterClass="Map" resultClass="Map">
          SELECT 
                #InbdOtbdOut#   AS INBD_OTBD_CD
              <!-- FROM CPO_DTL -->
              , CD.CPO_ORD_NUM
              , CD.CPO_DTL_LINE_NUM
              , CD.CPO_DTL_LINE_SUB_NUM
              , CD.CPO_ORD_TP_CD
              , CD.PMT_TERM_CASH_DISC_CD
              , CD.SLS_REP_OR_SLS_TEAM_TOC_CD
              , CD.DROP_SHIP_FLG             
              , CD.SHIP_TO_CUST_CD   
              , CD.SHIP_TO_LOC_NM
              , CD.SHIP_TO_ADDL_LOC_NM
              , CD.SHIP_TO_FIRST_LINE_ADDR
              , CD.SHIP_TO_SCD_LINE_ADDR
              , CD.SHIP_TO_THIRD_LINE_ADDR
              , CD.SHIP_TO_FRTH_LINE_ADDR
              , CD.SHIP_TO_CTY_ADDR
              , CD.SHIP_TO_ST_CD
              , CD.SHIP_TO_PROV_NM
              , CD.SHIP_TO_POST_CD
              , CD.SHIP_TO_CTRY_CD
              , CD.SHIP_TO_CNTY_NM
              , CD.SHIP_TO_FIRST_REF_CMNT_TXT
              , CD.SHIP_TO_SCD_REF_CMNT_TXT
              , CD.CUST_UOM_CD
              <!-- 2017/01/13 S21_NA#17076 Mod Start -->
              <isNull property="isReturnFlg">
              <!-- , CD.MDSE_CD               2016/09/29 S21_NA#14887 Del -->
              ,CD.MDSE_CD
              </isNull>
              <isNotNull property="isReturnFlg">
              , SP.SP_MDSE_CD AS MDSE_CD <!-- 2016/09/29 S21_NA#14887 Add -->
              </isNotNull>
              <!-- 2017/01/13 S21_NA#17076 Mod End -->
              , CD.ORIG_MDSE_CD
              , CD.ORD_QTY
              , CD.ORD_CUST_UOM_QTY
              , CD.ENT_DEAL_NET_UNIT_PRC_AMT
              , CD.PRC_CATG_CD
              , CD.RDD_DT
              , CD.STK_STS_CD
              , CD.CUST_MDSE_CD
              , CD.CUST_UOM_CD
              , CD.INVTY_LOC_CD
              , CD.ORIG_CPO_ORD_NUM

              , CD.DS_CPO_CONFIG_PK
              , CD.DS_ORD_POSN_NUM
              , TO_NUMBER(CD.DS_ORD_POSN_NUM) AS DS_ORD_POSN_NUM_DIGIT
              , CD.DS_ORD_LINE_CATG_CD
              , CD.ORD_LINE_SRC_CD
              , CD.RTL_WH_CD    
              , CD.RTL_SWH_CD
              , CD.SER_NUM
              , CD.FL_PRC_LIST_CD
              , CD.DPLY_LINE_REF_NUM
              , CD.CR_REBIL_CD
              , CD.PRC_BASE_DT
              , CD.FRT_COND_CD
              , CD.DS_CONTR_NUM
              , CD.DS_CONTR_SQ_NUM
              , CD.DS_CPO_LINE_NUM
              , CD.DS_CPO_LINE_SUB_NUM
              , CD.FUNC_PRC_LIST_PRC_AMT
              , CD.FUNC_PRC_LIST_PRC_AMT
              , CD.FUNC_SVC_REV_TRNSF_AMT
              , CD.FUNC_SVC_COST_TRNSF_AMT
              , CD.FUNC_MAN_FL_ADJ_AMT
              , CD.FUNC_MAN_REP_REV_ADJ_AMT
              , CD.DEAL_PRC_LIST_PRC_AMT
              , CD.DEAL_PRC_LIST_PRC_AMT
              , CD.DEAL_SVC_REV_TRNSF_AMT
              , CD.DEAL_SVC_COST_TRNSF_AMT
              , CD.DEAL_MAN_FL_ADJ_AMT
              , CD.DEAL_MAN_REP_REV_ADJ_AMT
              , CD.REF_CPO_DTL_LINE_NUM
              , CD.REF_CPO_DTL_LINE_SUB_NUM
              , CD.DPLY_LINE_REF_NUM
              , CD.SPLY_TP_CD
              , CD.SPLY_NM
              , CD.SPLY_FIRST_ADDR
              , CD.SPLY_CTY_ADDR
              , CD.SPLY_ST_CD
              , CD.SPLY_POST_CD
              , CD.CSMP_CONTR_NUM
              , CD.DLR_REF_NUM
              , CD.CSMP_PRC_LIST_CD
              , CD.RNTL_TRMN_DT
              , CD.BLLG_ATTRB_CUST_ACCT_CD
              , CD.FIRST_BLLG_ATTRB_NM
              , CD.FIRST_BLLG_ATTRB_VAL_TXT
              , CD.SCD_BLLG_ATTRB_NM
              , CD.SCD_BLLG_ATTRB_VAL_TXT
              , CD.THIRD_BLLG_ATTRB_NM
              , CD.THIRD_BLLG_ATTRB_VAL_TXT
              , CD.FRTH_BLLG_ATTRB_NM
              , CD.FRTH_BLLG_ATTRB_VAL_TXT
              , CD.FIFTH_BLLG_ATTRB_NM
              , CD.FIFTH_BLLG_ATTRB_VAL_TXT
              , CD.SIXTH_BLLG_ATTRB_NM
              , CD.SIXTH_BLLG_ATTRB_VAL_TXT
              , CD.SBST_MDSE_CD
              , CD.ORD_SRC_REF_LINE_NUM
              , CD.ORD_SRC_REF_LINE_SUB_NUM
              , CD.CARR_SVC_LVL_CD
              , CD.SUPD_LOCK_FLG
              , CD.PRC_LIST_EQUIP_CONFIG_NUM
              , CD.LOAN_BAL_QTY
              , CD.SHOP_ITEM_FLG
              , CD.ORD_UPLD_REF_NUM
              , CD.BASE_CMPT_FLG
              , CD.SVC_CONFIG_MSTR_PK
              , CD.UNIT_NET_WT
              , CD.PICK_SVC_CONFIG_MSTR_PK
              , CD.SVC_MACH_MSTR_PK
              , CD.ORIG_CPO_DTL_LINE_NUM
              , CD.ORIG_CPO_DTL_LINE_SUB_NUM
              <!-- Return Original -->
              , NULL            AS TAX_FLG
              , NULL            AS RTRN_RSN_CD
              , CD.FUNC_UNIT_FL_PRC_AMT  <!-- 2019/01/12 S21_NA#22372 ADD -->
              <!-- START 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
              , MDSE.INSTL_BASE_CTRL_FLG
              , STS.ORD_LINE_STS_NM
              <!-- END 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
              <!-- 2019/10/04 S21_NA#51372 Add Start -->
              , CD.PRNT_VND_NM
              <!-- 2019/10/04 S21_NA#51372 Add End -->
          FROM
                CPO_DTL CD

              <!-- 2017/01/13 S21_NA#17076 Mod Start -->
              <isNotNull property="isReturnFlg">
                  <!-- 2016/09/29 S21_NA#14887 Add Start -->
                  <!-- SHPG_PLN -->
                  , (SELECT
                            GLBL_CMPY_CD
                          , TRX_HDR_NUM
                          , TRX_LINE_NUM
                          , TRX_LINE_SUB_NUM
                          , MIN(MDSE_CD) SP_MDSE_CD
                     FROM
                            SHPG_PLN
                     WHERE
                            GLBL_CMPY_CD = #glblCmpyCd#
                        AND TRX_HDR_NUM  = #cpoOrdNum#
                        AND EZCANCELFLAG = '0'
                     GROUP BY
                            GLBL_CMPY_CD
                          , TRX_HDR_NUM
                          , TRX_LINE_NUM
                          , TRX_LINE_SUB_NUM
                     ) SP
                  <!-- 2016/09/29 S21_NA#14887 Add End -->
              </isNotNull>
              <!-- 2017/01/13 S21_NA#17076 Mod End -->
              <!-- START 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
              , ALL_MDSE_V MDSE
              , (SELECT
                        DOS.CPO_ORD_NUM
                      , DOS.CPO_DTL_LINE_NUM
                      , DOS.CPO_DTL_LINE_SUB_NUM
                      , DOS.ORD_LINE_STS_NM
                      , ROW_NUMBER() OVER (PARTITION BY DOS.CPO_ORD_NUM, DOS.CPO_DTL_LINE_NUM, DOS.CPO_DTL_LINE_SUB_NUM ORDER BY DOS.SHPG_STS_CD NULLS FIRST) RANK_NUM
                 FROM
                        DS_ORD_STS_V DOS
                 WHERE 
                        DOS.GLBL_CMPY_CD = #glblCmpyCd#
                    AND DOS.CPO_ORD_NUM  = #cpoOrdNum#
                    AND DOS.EZCANCELFLAG = '0'
                 ) STS
              <!-- END 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
          WHERE
                  CD.GLBL_CMPY_CD        = #glblCmpyCd#
              AND CD.CPO_ORD_NUM         = #cpoOrdNum#
              AND CD.EZCANCELFLAG        = '0'
              <isNotNull property="lineNumList">
              AND CD.CPO_DTL_LINE_NUM IN  
              <iterate property="lineNumList" var="lineNumList[]" open="(" close=")" conjunction=",">
                            #lineNumList[]#
              </iterate>
              </isNotNull>
              <!-- 2017/01/13 S21_NA#17076 Mod Start -->
              <isNotNull property="isReturnFlg">
                  <!-- 2016/09/29 S21_NA#14887 Add Start -->
                  AND CD.GLBL_CMPY_CD        = SP.GLBL_CMPY_CD
                  AND CD.CPO_ORD_NUM         = SP.TRX_HDR_NUM
                  AND CD.CPO_DTL_LINE_NUM    = SP.TRX_LINE_NUM
                  AND CD.CPO_DTL_LINE_SUB_NUM= SP.TRX_LINE_SUB_NUM
                  <!-- 2016/09/29 S21_NA#14887 Add End -->
              </isNotNull>
              <!-- 2017/01/13 S21_NA#17076 Mod End -->
              <!-- START 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
              AND CD.GLBL_CMPY_CD         = MDSE.GLBL_CMPY_CD(+)
              AND CD.MDSE_CD              = MDSE.MDSE_CD(+)
              AND MDSE.EZCANCELFLAG(+)    = '0'

              AND CD.CPO_ORD_NUM          = STS.CPO_ORD_NUM  
              AND CD.CPO_DTL_LINE_NUM     = STS.CPO_DTL_LINE_NUM 
              AND CD.CPO_DTL_LINE_SUB_NUM = STS.CPO_DTL_LINE_SUB_NUM
              AND STS.RANK_NUM            = 1
              <!-- END 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
         <isEqual property="existingOrder" compareValue="Y">
         UNION ALL
        
         SELECT 
                #InbdOtbdIn#   AS INBD_OTBD_CD
              , CD.CPO_ORD_NUM
              , CD.DS_CPO_RTRN_LINE_NUM     AS CPO_DTL_LINE_NUM
              , CD.DS_CPO_RTRN_LINE_SUB_NUM AS CPO_DTL_LINE_SUB_NUM
              , CD.CPO_ORD_TP_CD
              , CD.PMT_TERM_CASH_DISC_CD
              , CD.SLS_REP_OR_SLS_TEAM_TOC_CD
              , CD.DROP_SHIP_FLG             
              , CD.SHIP_TO_CUST_CD   
              , CD.SHIP_TO_LOC_NM
              , CD.SHIP_TO_ADDL_LOC_NM
              , CD.SHIP_TO_FIRST_LINE_ADDR
              , CD.SHIP_TO_SCD_LINE_ADDR
              , CD.SHIP_TO_THIRD_LINE_ADDR
              , CD.SHIP_TO_FRTH_LINE_ADDR
              , CD.SHIP_TO_CTY_ADDR
              , CD.SHIP_TO_ST_CD
              , CD.SHIP_TO_PROV_NM
              , CD.SHIP_TO_POST_CD
              , CD.SHIP_TO_CTRY_CD
              , CD.SHIP_TO_CNTY_NM
              , CD.SHIP_TO_FIRST_REF_CMNT_TXT
              , CD.SHIP_TO_SCD_REF_CMNT_TXT
              , CD.CUST_UOM_CD
              , CD.MDSE_CD
              , CD.ORIG_MDSE_CD
              , CD.ORD_QTY
              , CD.ORD_CUST_UOM_QTY
              , CD.ENT_DEAL_NET_UNIT_PRC_AMT
              , CD.PRC_CATG_CD
              , NULL AS RDD_DT
              , CD.STK_STS_CD
              , CD.CUST_MDSE_CD
              , CD.CUST_UOM_CD
              , CD.INVTY_LOC_CD
              , CD.ORIG_CPO_ORD_NUM
              
              , CD.DS_CPO_CONFIG_PK
              , CD.DS_ORD_POSN_NUM
              , TO_NUMBER(CD.DS_ORD_POSN_NUM) AS DS_ORD_POSN_NUM_DIGIT
              , CD.DS_ORD_LINE_CATG_CD
              , CD.ORD_LINE_SRC_CD
              , CD.RTL_WH_CD    
              , CD.RTL_SWH_CD
              , CD.SER_NUM
              , CD.FL_PRC_LIST_CD
              , CD.DPLY_LINE_REF_NUM
              , CD.CR_REBIL_CD
              , CD.PRC_BASE_DT
              , NULL AS FRT_COND_CD
              , CD.DS_CONTR_NUM
              , CD.DS_CONTR_SQ_NUM
              , CD.DS_CPO_LINE_NUM
              , CD.DS_CPO_LINE_SUB_NUM
              , CD.FUNC_PRC_LIST_PRC_AMT
              , CD.FUNC_PRC_LIST_PRC_AMT
              , CD.FUNC_SVC_REV_TRNSF_AMT
              , CD.FUNC_SVC_COST_TRNSF_AMT
              , CD.FUNC_MAN_FL_ADJ_AMT
              , CD.FUNC_MAN_REP_REV_ADJ_AMT
              , CD.DEAL_PRC_LIST_PRC_AMT
              , CD.DEAL_PRC_LIST_PRC_AMT
              , CD.DEAL_SVC_REV_TRNSF_AMT
              , CD.DEAL_SVC_COST_TRNSF_AMT
              , CD.DEAL_MAN_FL_ADJ_AMT
              , CD.DEAL_MAN_REP_REV_ADJ_AMT
              , CD.REF_CPO_DTL_LINE_NUM
              , CD.REF_CPO_DTL_LINE_SUB_NUM
              , CD.DPLY_LINE_REF_NUM
              , NULL AS SPLY_TP_CD
              , NULL AS SPLY_NM
              , NULL AS SPLY_FIRST_ADDR
              , NULL AS SPLY_CTY_ADDR
              , NULL AS SPLY_ST_CD
              , NULL AS SPLY_POST_CD
              , CD.CSMP_CONTR_NUM
              , CD.DLR_REF_NUM
              , CD.CSMP_PRC_LIST_CD
              , NULL AS RNTL_TRMN_DT
              , CD.BLLG_ATTRB_CUST_ACCT_CD
              , CD.FIRST_BLLG_ATTRB_NM
              , CD.FIRST_BLLG_ATTRB_VAL_TXT
              , CD.SCD_BLLG_ATTRB_NM
              , CD.SCD_BLLG_ATTRB_VAL_TXT
              , CD.THIRD_BLLG_ATTRB_NM
              , CD.THIRD_BLLG_ATTRB_VAL_TXT
              , CD.FRTH_BLLG_ATTRB_NM
              , CD.FRTH_BLLG_ATTRB_VAL_TXT
              , CD.FIFTH_BLLG_ATTRB_NM
              , CD.FIFTH_BLLG_ATTRB_VAL_TXT
              , CD.SIXTH_BLLG_ATTRB_NM
              , CD.SIXTH_BLLG_ATTRB_VAL_TXT
              , NULL AS SBST_MDSE_CD
              , CD.ORD_SRC_REF_LINE_NUM
              , CD.ORD_SRC_REF_LINE_SUB_NUM
              , NULL AS CARR_SVC_LVL_CD
              , NULL AS SUPD_LOCK_FLG
              , NULL AS PRC_LIST_EQUIP_CONFIG_NUM
              , NULL AS LOAN_BAL_QTY
              , NULL AS SHOP_ITEM_FLG
              , CD.ORD_UPLD_REF_NUM
              , CD.BASE_CMPT_FLG
              , CD.SVC_CONFIG_MSTR_PK
              , CD.UNIT_NET_WT
              , NULL AS PICK_SVC_CONFIG_MSTR_PK
              , CD.SVC_MACH_MSTR_PK
              , CD.ORIG_CPO_DTL_LINE_NUM
              , CD.ORIG_CPO_DTL_LINE_SUB_NUM
              <!-- Return Original   --> 
              , CD.TAX_FLG      AS TAX_FLG
              , CD.RTRN_RSN_CD  AS RTRN_RSN_CD
              , CD.FUNC_UNIT_FL_PRC_AMT  <!-- 2019/01/12 S21_NA#22372 ADD -->
              <!-- START 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
              , NULL AS INSTL_BASE_CTRL_FLG
              , NULL AS ORD_LINE_STS_NM
              <!-- END 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
              <!-- 2019/10/04 S21_NA#51372 Add Start -->
              , NULL AS PRNT_VND_NM
              <!-- 2019/10/04 S21_NA#51372 Add End -->
          FROM
                DS_CPO_RTRN_DTL CD
          WHERE
                  CD.GLBL_CMPY_CD        = #glblCmpyCd#
              AND CD.CPO_ORD_NUM         = #cpoOrdNum#
              AND CD.EZCANCELFLAG        = '0'
         </isEqual>
         ORDER BY
                  INBD_OTBD_CD DESC
                , DS_ORD_POSN_NUM_DIGIT
                , DS_CPO_LINE_NUM
                , DS_CPO_LINE_SUB_NUM NULLS FIRST
    </statement>
    <statement id="getOrdPrc" parameterClass="Map" resultClass="Map">
          SELECT 
                    #InbdOtbdOut# INBD_OTBD_CD
                  , PRC.ORD_PRC_CALC_BASE_PK
                  , PRC.CPO_DTL_LINE_NUM
                  , PRC.CPO_DTL_LINE_SUB_NUM
                  , PRC.PRC_COND_TP_CD
                  , PRC.PRC_DTL_GRP_CD
                  , PRC.PRC_JRNL_GRP_CD
                  , PRC.PRC_COND_MAN_ENTRY_FLG
                  , PRC.PRC_COND_MAN_ADD_FLG
                  , PRC.PRC_COND_MAN_DEL_FLG
                  , PRC.PKG_UOM_CD
                  , PRC.PRC_COND_UNIT_CD
                  , PRC.PRC_CALC_METH_CD
                  , PRC.AUTO_PRC_AMT_RATE
                  , PRC.MAX_PRC_AMT_RATE
                  , PRC.MIN_PRC_AMT_RATE
                  , PRC.MAN_PRC_AMT_RATE
                  , PRC.CALC_PRC_AMT_RATE
                  , PRC.UNIT_PRC_AMT
                  , PRC.DS_MDSE_PRC_PK
                  , PRC.SPEC_COND_PRC_PK
                  , PRC.FRT_PER_WT_PK
                  , PRC.AUTO_PRC_CCY_CD
                  , CPOD.ORD_QTY
                  <!-- START 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
                  , CPOD.LOAN_BAL_QTY
                  , MDSE.INSTL_BASE_CTRL_FLG
                  , STS.ORD_LINE_STS_NM
                  <!-- END 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
          FROM 
                    ORD_PRC_CALC_BASE PRC
                  , CPO_DTL        CPOD
                  <!-- START 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
                  , ALL_MDSE_V MDSE
                  , (SELECT
                            DOS.CPO_ORD_NUM
                          , DOS.CPO_DTL_LINE_NUM
                          , DOS.CPO_DTL_LINE_SUB_NUM
                          , DOS.ORD_LINE_STS_NM
                          , ROW_NUMBER() OVER (PARTITION BY DOS.CPO_ORD_NUM, DOS.CPO_DTL_LINE_NUM, DOS.CPO_DTL_LINE_SUB_NUM ORDER BY DOS.SHPG_STS_CD NULLS FIRST) RANK_NUM
                     FROM
                            DS_ORD_STS_V DOS
                     WHERE 
                            DOS.GLBL_CMPY_CD = #glblCmpyCd#
                        AND DOS.CPO_ORD_NUM  = #cpoOrdNum#
                        AND DOS.EZCANCELFLAG = '0'
                     ) STS
                  <!-- END 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
          WHERE
                    PRC.GLBL_CMPY_CD     = #glblCmpyCd#
                AND PRC.CPO_ORD_NUM      = #cpoOrdNum#
                <isNotNull property="lineNumList">
                AND PRC.CPO_DTL_LINE_NUM IN  
                <iterate property="lineNumList" var="lineNumList[]" open="(" close=")" conjunction=",">
                            #lineNumList[]#
                </iterate>
                </isNotNull>
                AND PRC.EZCANCELFLAG     = '0'
                AND PRC.PRC_DTL_GRP_CD = #prcdtlgrpCdBASE#  <!-- QC#50548 2019/05/28 -->
                AND PRC.GLBL_CMPY_CD     = CPOD.GLBL_CMPY_CD
                AND PRC.CPO_ORD_NUM      = CPOD.CPO_ORD_NUM
                AND PRC.CPO_DTL_LINE_NUM = CPOD.CPO_DTL_LINE_NUM
                AND PRC.CPO_DTL_LINE_SUB_NUM = CPOD.CPO_DTL_LINE_SUB_NUM
                AND CPOD.EZCANCELFLAG     = '0'

                <!-- START 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
                AND CPOD.GLBL_CMPY_CD         = MDSE.GLBL_CMPY_CD(+)
                AND CPOD.MDSE_CD              = MDSE.MDSE_CD(+)
                AND MDSE.EZCANCELFLAG(+)      = '0'

                AND CPOD.CPO_ORD_NUM          = STS.CPO_ORD_NUM  
                AND CPOD.CPO_DTL_LINE_NUM     = STS.CPO_DTL_LINE_NUM 
                AND CPOD.CPO_DTL_LINE_SUB_NUM = STS.CPO_DTL_LINE_SUB_NUM
                AND STS.RANK_NUM              = 1
                <!-- END 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
          <isEqual property="existingOrder" compareValue="Y">
          UNION ALL
          
          SELECT  
                    #InbdOtbdIn# INBD_OTBD_CD
                  , PRC.CPO_RTRN_PRC_CALC_BASE_PK   AS ORD_PRC_CALC_BASE_PK
                  , PRC.DS_CPO_RTRN_LINE_NUM        AS CPO_DTL_LINE_NUM
                  , PRC.DS_CPO_RTRN_LINE_SUB_NUM    AS CPO_DTL_LINE_SUB_NUM
                  , PRC.PRC_COND_TP_CD
                  , PRC.PRC_DTL_GRP_CD
                  , PRC.PRC_JRNL_GRP_CD
                  , PRC.PRC_COND_MAN_ENTRY_FLG
                  , PRC.PRC_COND_MAN_ADD_FLG
                  , PRC.PRC_COND_MAN_DEL_FLG
                  , PRC.PKG_UOM_CD
                  , PRC.PRC_COND_UNIT_CD
                  , PRC.PRC_CALC_METH_CD
                  , PRC.AUTO_PRC_AMT_RATE
                  , PRC.MAX_PRC_AMT_RATE
                  , PRC.MIN_PRC_AMT_RATE
                  , PRC.MAN_PRC_AMT_RATE
                  , PRC.CALC_PRC_AMT_RATE
                  , PRC.UNIT_PRC_AMT
                  , PRC.DS_MDSE_PRC_PK
                  , PRC.SPEC_COND_PRC_PK
                  , PRC.FRT_PER_WT_PK
                  , PRC.AUTO_PRC_CCY_CD
                  , 0 AS ORD_QTY
                  <!-- START 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
                  , 0 AS LOAN_BAL_QTY
                  , NULL AS INSTL_BASE_CTRL_FLG
                  , NULL AS ORD_LINE_STS_NM
                  <!-- END 2018/08/21 Hd.Sugawara [QC#27489,ADD] -->
                FROM 
                    CPO_RTRN_PRC_CALC_BASE PRC
                WHERE 
                    PRC.GLBL_CMPY_CD     = #glblCmpyCd#
                AND PRC.CPO_ORD_NUM      = #cpoOrdNum#
                AND PRC.PRC_DTL_GRP_CD   = #prcdtlgrpCdBASE#  <!-- QC#50548 2019/05/28 -->
                AND PRC.EZCANCELFLAG     = '0'
          </isEqual>
                ORDER BY 
                    INBD_OTBD_CD DESC
                  , CPO_DTL_LINE_NUM
                  , CPO_DTL_LINE_SUB_NUM
                  , PRC_COND_TP_CD

    </statement>
    
    <statement id="getOrdSlsCr" parameterClass="Map" resultClass="Map">
          SELECT  
                    SC.CPO_ORD_NUM
                  , SC.DS_ORD_POSN_NUM
                  , SC.DS_CPO_CONFIG_PK
                  , SC.SLS_REP_TOC_CD 
                  , SC.SLS_REP_ROLE_TP_CD
                  , SC.SLS_REP_CR_PCT
                  , SC.SLS_CR_QUOT_FLG
                  , SC.DS_CPO_SLS_CR_PK
                  , CNFG.CONFIG_CATG_CD
                FROM 
                    DS_CPO_SLS_CR SC
                  , DS_CPO_CONFIG CNFG
                WHERE 
                    SC.GLBL_CMPY_CD     = #glblCmpyCd#
                AND SC.CPO_ORD_NUM      = #cpoOrdNum#
                AND SC.EZCANCELFLAG     = '0'
                AND SC.GLBL_CMPY_CD     = CNFG.GLBL_CMPY_CD(+)
                AND SC.DS_CPO_CONFIG_PK = CNFG.DS_CPO_CONFIG_PK(+)
                AND CNFG.EZCANCELFLAG(+)= '0'
                ORDER BY
                    SC.DS_ORD_POSN_NUM
                    ,SC.DS_CPO_SLS_CR_PK
    </statement>
    
    <statement id="getMachMstrList" parameterClass="Map" resultMap="result.getMachMstrList">
               SELECT  
                    MM.SVC_MACH_MSTR_PK
                  , MM.SER_NUM
                  , MM.MDSE_CD
                  , MM.CPO_ORD_NUM
                  , MM.CPO_DTL_LINE_NUM
                  , MM.CPO_DTL_LINE_SUB_NUM
                FROM 
                    SVC_MACH_MSTR MM
                WHERE 
                    MM.GLBL_CMPY_CD     = #glblCmpyCd#
                AND MM.CPO_ORD_NUM      = #cpoOrdNum#
                AND MM.EZCANCELFLAG     = '0'
                ORDER BY 
                    MM.SVC_MACH_MSTR_PK
    </statement>
    <resultMap id="result.getMachMstrList" class="NWAL1830_MCMsg">
        <result property="svcMachMstrPk"           column="SVC_MACH_MSTR_PK"              javaType="EZDCBigDecimalItem"/>
        <result property="mdseCd"                  column="MDSE_CD"                       javaType="EZDCStringItem"/>
        <result property="serNum"                  column="SER_NUM"                       javaType="EZDCStringItem"/>
        <result property="cpoOrdNum"               column="CPO_ORD_NUM"                   javaType="EZDCStringItem"/>
        <result property="cpoDtlLineNum"           column="CPO_DTL_LINE_NUM"              javaType="EZDCStringItem"/>
        <result property="cpoDtlLineSubNum"        column="CPO_DTL_LINE_SUB_NUM"          javaType="EZDCStringItem"/>
    </resultMap>
    
    <statement id="getMaxPosnNum" parameterClass="Map" resultClass="String">
               SELECT  
                    MAX(CNFG.DS_ORD_POSN_NUM) AS DS_ORD_POSN_NUM
                FROM 
                    DS_CPO_CONFIG CNFG
                WHERE 
                    CNFG.GLBL_CMPY_CD     = #glblCmpyCd#
                AND CNFG.CPO_ORD_NUM      = #cpoOrdNum#
                AND CNFG.CONFIG_CATG_CD   = #configCatg#
                AND CNFG.EZCANCELFLAG     = '0'
    </statement>
    
    <statement id="getMaxLineNumOutbound" parameterClass="Map" resultClass="String">
               SELECT  
                    MAX(CPOD.CPO_DTL_LINE_NUM) AS CPO_DTL_LINE_NUM
                FROM 
                    CPO_DTL CPOD
                WHERE 
                    CPOD.GLBL_CMPY_CD     = #glblCmpyCd#
                AND CPOD.CPO_ORD_NUM      = #cpoOrdNum#
                AND CPOD.EZCANCELFLAG     = '0'
                ORDER BY 
                    CPOD.CPO_DTL_LINE_NUM
    </statement>
    
    <statement id="getMaxLineNumInbound" parameterClass="Map" resultClass="String">
               SELECT  
                    MAX(RTRN.DS_CPO_RTRN_LINE_NUM) AS DS_CPO_RTRN_LINE_NUM
                FROM 
                    DS_CPO_RTRN_DTL RTRN
                WHERE 
                    RTRN.GLBL_CMPY_CD     = #glblCmpyCd#
                AND RTRN.CPO_ORD_NUM      = #cpoOrdNum#
                AND RTRN.EZCANCELFLAG     = '0'
                ORDER BY 
                    RTRN.DS_CPO_RTRN_LINE_NUM
    </statement>
    
    <!-- 2017/09/11 S21_NA#19800 add start -->
    <statement id="getConvInfoForNotIB" parameterClass="Map" resultClass="Map">
               SELECT
                      FIRST_BIZ_CTX_ATTRB_TXT AS ACT_LABEL_NM
                    , 'Y' AS PROC_FLG
                    , CPOD.CPO_ORD_NUM
                    , CONCAT (CPOD.DS_ORD_POSN_NUM, '.') || 
                      CONCAT (CPOD.DS_CPO_LINE_NUM, DECODE (CPOD.DS_CPO_LINE_SUB_NUM, NULL, '', '.')) || CPOD.DS_CPO_LINE_SUB_NUM
                      AS DPLY_LINE_NUM
                    , 'N' AS CONV_ACT_FLG
                    , DOS.ORD_LINE_STS_NM
               FROM 
                      CPO_DTL              CPOD
                    , ORD_LINE_VAL_SET     OLVS
                    , DS_ORD_LINE_CATG     CATG
                    , CPO                  C
                    , DS_ORD_STS_V         DOS
               WHERE 
                      CPOD.GLBL_CMPY_CD    = #glblCmpyCd#
                  AND CPOD.CPO_ORD_NUM      = #cpoOrdNum#
                  AND CPOD.MDSE_CD          = #mdseCd#
                  AND CPOD.ORD_LINE_STS_CD       &lt;&gt; #ordLineStsCdCancel#
                  AND CPOD.EZCANCELFLAG   = '0'

                  AND CPOD.GLBL_CMPY_CD          = OLVS.GLBL_CMPY_CD
                  AND CPOD.DS_ORD_LINE_CATG_CD   = OLVS.DS_ORD_LINE_CATG_CD
                  AND OLVS.ORD_LINE_CTX_TP_CD    = #ordLineCtxCd#
                  AND OLVS.EZCANCELFLAG          = '0'

                  AND OLVS.GLBL_CMPY_CD          = CATG.GLBL_CMPY_CD
                  AND OLVS.DS_ORD_LINE_CATG_CD   = CATG.DS_ORD_LINE_CATG_CD
                  AND CATG.DS_ORD_LINE_DRCTN_CD  = #dsOrdLineDrctnOut#
                  AND CATG.EZCANCELFLAG          = '0'

                  AND CPOD.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
                  AND CPOD.CPO_ORD_NUM           = C.CPO_ORD_NUM
                  AND C.ORD_HDR_STS_CD           &lt;&gt; #ordHdrStsCdCancel#
                  AND C.EZCANCELFLAG             = '0'

                  AND CPOD.CPO_ORD_NUM          = DOS.CPO_ORD_NUM
                  AND CPOD.CPO_DTL_LINE_NUM     = DOS.CPO_DTL_LINE_NUM
                  AND CPOD.CPO_DTL_LINE_SUB_NUM = DOS.CPO_DTL_LINE_SUB_NUM
    </statement>

    <statement id="getDsOrdCatgListForValSet" parameterClass="Map" resultClass="Map">
          SELECT
                    LVS.DS_ORD_LINE_CATG_CD
                    , LVS.THIRD_BIZ_CTX_ATTRB_TXT AS RTL_WH_CD
                    <!-- 2024/03/14 QC#63527 Add Start -->
                    , LVS.FIFTH_BIZ_CTX_ATTRB_TXT AS OWNR
                    <!-- 2024/03/14 QC#63527 Add End -->
          FROM 
                    ORD_LINE_VAL_SET LVS
          WHERE 
                    LVS.GLBL_CMPY_CD        = #glblCmpyCd#
                AND LVS.ORD_LINE_CTX_TP_CD  = #ordLineCtxCd#
                AND LVS.FIRST_BIZ_CTX_ATTRB_TXT = #firstBizCtxAttrbTxt#
                AND LVS.EZCANCELFLAG        = '0'
          ORDER BY 
                    LVS.SCD_BIZ_CTX_ATTRB_TXT
    </statement>
     <!-- 2017/09/11 S21_NA#19800 add end -->

<!--   S21_NA#22641 -->
    <statement id="getOrdDely" parameterClass="Map" resultClass="Map">
        SELECT
                  DS_CPO_DELY_INFO_PK
                , CPO_ORD_NUM
                , DS_CPO_CONFIG_PK
                , CPO_LINE_NUM
                , CPO_LINE_SUB_NUM
                , DS_ORD_POSN_NUM
                , DS_DELY_TP_CD
                , RDD_DT
                , OPS_FROM_HOUR_MN
                , OPS_TO_HOUR_MN
                , LOAD_DOCK_AVAL_FLG
                , STAIR_CRAW_REQ_FLG
                , STAIR_CRAW_NUM
                , ELEV_AVAL_FLG
                , DELY_ADDL_CMNT_TXT
            FROM
                DS_CPO_DELY_INFO    D
            WHERE
                D.GLBL_CMPY_CD      = #glblCmpyCd#
                AND D.CPO_ORD_NUM   = #cpoOrdNum#
              <isNotNull property="configPkList">
                AND D.DS_CPO_CONFIG_PK IN  
                <iterate property="configPkList" var="configPkList[]" open="(" close=")" conjunction=",">
                            #configPkList[]#
                </iterate>
              </isNotNull>
                AND D.EZCANCELFLAG = '0'
    </statement>

    <statement id="getOrdIstl" parameterClass="Map" resultClass="Map">
        SELECT
                  DS_CPO_ISTL_INFO_PK
                , CPO_ORD_NUM
                , DS_CPO_CONFIG_PK
                , CPO_LINE_NUM
                , CPO_LINE_SUB_NUM
                , DS_ORD_POSN_NUM
                , ISTL_DIV_CD
                , ISTL_TECH_CD
                , RQST_ISTL_DT
                , RQST_ISTL_TM
                , ISTL_ADDL_CMNT_TXT
                , SVC_ISTL_RULE_NUM 
            FROM
                DS_CPO_ISTL_INFO D
            WHERE
                D.GLBL_CMPY_CD      = #glblCmpyCd#
                AND D.CPO_ORD_NUM   = #cpoOrdNum#
              <isNotNull property="configPkList">
                AND D.DS_CPO_CONFIG_PK IN  
                <iterate property="configPkList" var="configPkList[]" open="(" close=")" conjunction=",">
                            #configPkList[]#
                </iterate>
              </isNotNull>
                AND D.EZCANCELFLAG = '0'
    </statement>

    <statement id="getOrdSite" parameterClass="Map" resultClass="Map">
        SELECT
                  DS_SITE_SRVY_PK
                , CPO_ORD_NUM
                , DS_CPO_CONFIG_PK
                , CPO_DTL_LINE_NUM
                , CPO_DTL_LINE_SUB_NUM
                , SO_NUM
                , RMA_NUM
                , RMA_LINE_NUM
                , RMA_LINE_SUB_NUM
                , CMPY_INFO_APT_BLDG_NM
                , CMPY_INFO_FL_NM
                , CMPY_INFO_DEPT_NM
                , CMPY_INFO_CTAC_NM
                , CMPY_INFO_TEL_NUM
                , OTSD_STEP_NUM
                , INSD_STEP_NUM
                , STAIR_CRAW_REQ_FLG
                , FLGT_STAIR_NUM
                , ELEV_AVAL_FLG
                , ELEV_AVAL_FROM_HOUR_MN
                , ELEV_AVAL_TO_HOUR_MN
                , ELEV_APPT_REQ_FLG
                , ELEV_CTAC_TEL_NUM
                , ELEV_PROT_REQ_FLG
                , ELEV_WDT
                , ELEV_DEPTH_NUM
                , ELEV_CTAC_PSN_NM
                , ELEV_CAP_WT
                , ELEV_DOOR_HGT
                , ELEV_DOOR_WDT
                , STAIR_AND_LDG_WDT
                , CRDR_WDT
                , DOOR_WDT
                , LOAD_DOCK_AVAL_FLG
                , LOAD_DOCK_HGT
                , TRCTR_AND_TRAIL_ACCS_FLG
                , BLDG_ENT_DOOR_HGT
                , BLDG_ENT_DOOR_WDT
                , LOAD_DOCK_AVAL_FROM_HOUR_MN
                , LOAD_DOCK_AVAL_TO_HOUR_MN
                , CARR_DELY_TM_HOUR_MN
                , DELY_TRNSP_OPT_CD
                , SITE_SRVY_ADDL_CMNT_TXT
            FROM
                DS_SITE_SRVY D
            WHERE
                D.GLBL_CMPY_CD      = #glblCmpyCd#
                AND D.CPO_ORD_NUM   = #cpoOrdNum#
              <isNotNull property="configPkList">
                AND D.DS_CPO_CONFIG_PK IN  
                <iterate property="configPkList" var="configPkList[]" open="(" close=")" conjunction=",">
                            #configPkList[]#
                </iterate>
              </isNotNull>
                AND D.EZCANCELFLAG = '0'
    </statement>

    <statement id="getOrdCtac" parameterClass="Map" resultClass="Map">
        SELECT
                  DS_CPO_CTAC_PSN_PK
                , CTAC_PSN_PK
                , CPO_ORD_NUM
                , DS_CPO_CONFIG_PK
                , CPO_DTL_LINE_NUM
                , CPO_DTL_LINE_SUB_NUM
                , RMA_NUM
                , RMA_LINE_NUM
                , RMA_LINE_SUB_NUM
                , CTAC_PSN_TP_CD
                , CTAC_PSN_OVRD_FLG
                , CTAC_PSN_FIRST_NM
                , CTAC_PSN_MID_NM
                , CTAC_PSN_LAST_NM
                , CTAC_PSN_EML_ADDR
                , CTAC_PSN_EXTN_NUM
                , CTAC_PSN_TEL_NUM
                , CTAC_PSN_FAX_NUM
                , CTAC_PSN_FIRST_LINE_ADDR
                , CTAC_PSN_SCD_LINE_ADDR
                , CTAC_PSN_THIRD_LINE_ADDR
                , CTAC_PSN_FRTH_LINE_ADDR
                , CTAC_PSN_POST_CD
                , CTAC_PSN_CTY_ADDR
                , CTAC_PSN_ST_CD
                , CTAC_PSN_CTRY_CD
                , CTAC_PSN_SORT_NUM
                , CTAC_PSN_CMNT_TXT
                , CTAC_PSN_CELL_PHO_NUM
                , DS_CTAC_PNT_PK_01
                , DS_CTAC_PNT_PK_02
                , DS_CTAC_PNT_PK_03
                , DS_CTAC_PNT_PK_04
                , CTAC_CUST_REF_TP_CD
            FROM
                DS_CPO_CTAC_PSN D
            WHERE
                D.GLBL_CMPY_CD      = #glblCmpyCd#
                AND D.CPO_ORD_NUM   = #cpoOrdNum#
              <isNotNull property="configPkList">
                AND D.DS_CPO_CONFIG_PK IN  
                <iterate property="configPkList" var="configPkList[]" open="(" close=")" conjunction=",">
                            #configPkList[]#
                </iterate>
              </isNotNull>
                AND D.EZCANCELFLAG = '0'
    </statement>

    <statement id="getCountOrdCatgBizCtx" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(OCBC.ORD_CATG_BIZ_CTX_PK)
        FROM
            ORD_CATG_BIZ_CTX OCBC
        WHERE
                OCBC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND OCBC.ORD_CATG_CTX_TP_CD  = #ordCatgCtxTpCd#
            AND OCBC.EZCANCELFLAG        = '0'
            AND (
                    (
                        OCBC.DS_ORD_CATG_CD  = #dsOrdCatgCd#
                    AND OCBC.DS_ORD_TP_CD    IS NULL
                    AND OCBC.DS_ORD_RSN_CD   IS NULL
                    )
                    <isNotNull property="dsOrdTpCd">
                    OR
                    (
                        OCBC.DS_ORD_CATG_CD  = #dsOrdCatgCd#
                    AND OCBC.DS_ORD_TP_CD    = #dsOrdTpCd#
                    AND OCBC.DS_ORD_RSN_CD   IS NULL
                    )
                    </isNotNull>
                    <isNotNull property="dsOrdTpCd">
                        <isNotNull property="dsOrdRsnCd">
                    OR
                    (
                        OCBC.DS_ORD_CATG_CD  = #dsOrdCatgCd#
                    AND OCBC.DS_ORD_TP_CD    = #dsOrdTpCd#
                    AND OCBC.DS_ORD_RSN_CD   = #dsOrdRsnCd#
                    )
                        </isNotNull>
                    </isNotNull>
                )
    </statement>

    <statement id ="getDefaultInstTypeWithConfigNum" parameterClass="Map"  resultClass="Map">
        SELECT 
            DM.SVC_ISTL_RULE_NUM
            , DM.SVC_DEINS_RULE_NUM
        FROM 
            DS_CPO_CONFIG  DCC
           ,DS_MDL         DM
        WHERE 
            DCC.EZCANCELFLAG     = '0'
        AND DCC.GLBL_CMPY_CD     = #glblCmpyCd#
        AND DCC.CPO_ORD_NUM      = #cpoOrdNum#
        <!-- 2018/01/19 mod start -->
        <!-- AND DCC.DS_ORD_POSN_NUM  = #dsOrdPosnNum# -->
        AND DCC.DS_CPO_CONFIG_PK = #origDsCpoConfigPk#
        <!-- 2018/01/19 mod end -->
        AND DCC.CONFIG_CATG_CD   = #ConfigCatgCd#
        AND DCC.GLBL_CMPY_CD     = DM.GLBL_CMPY_CD
        AND DCC.MDL_ID           = DM.MDL_ID
        AND DM.EZCANCELFLAG      = '0'
    </statement>

    <statement id ="getRmaReqTpCd" parameterClass="Map"  resultClass="String">
        SELECT
                  V.RMA_REQ_TP_CD 
            FROM
                ALL_MDSE_V  V
            WHERE
                V.GLBL_CMPY_CD      = #glblCmpyCd#
                AND V.MDSE_CD       = #mdseCd#
                AND V.EZCANCELFLAG  = '0'
    </statement>

    <!-- 2021/09/22 QC#59222 Add Start -->
    <statement id ="isAllRtrnAccCheck" parameterClass="Map"  resultClass="String">
        SELECT
            SMM.CPO_ORD_NUM
        FROM
            SVC_MACH_MSTR SMM
           ,MDSE M
        WHERE
            SMM.GLBL_CMPY_CD       = #glblCmpyCd#
        AND SMM.SVC_CONFIG_MSTR_PK = #svcConfigMstrPk#
        AND SMM.SVC_MACH_MSTR_STS_CD = #install#
        AND SMM.SVC_MACH_MSTR_PK NOT IN
        <iterate property="svcMachMstrPkList" var="svcMachMstrPkList[]" open="(" close=")" conjunction=",">
            #svcMachMstrPkList[]#
        </iterate>
        AND SMM.GLBL_CMPY_CD       = M.GLBL_CMPY_CD
        AND SMM.MDSE_CD            = M.MDSE_CD
        AND M.INVTY_CTRL_FLG       = 'Y'
        AND SMM.EZCANCELFLAG       = '0'
        AND M.EZCANCELFLAG         = '0'
    </statement>
    <!-- 2021/09/22 QC#59222 Add End -->
    
    <!-- 2022/02/02 QC#59647 Add Start -->
    <statement id ="getSvcMachMstrPkList" parameterClass="Map"  resultClass="BigDecimal">
        SELECT
            SMM.SVC_MACH_MSTR_PK
        FROM
            SVC_MACH_MSTR SMM
        WHERE
            GLBL_CMPY_CD            = 'ADB'
        AND SMM.CPO_ORD_NUM         = #cpoOrdNum#
        AND SMM.CPO_DTL_LINE_NUM    = #cpoDtlLineNum#
        AND SMM.CPO_DTL_LINE_SUB_NUM = #cpoDtlLineSubNum#
        AND SMM.EZCANCELFLAG = '0'
    </statement>
    <!-- 2022/02/02 QC#59647 Add End -->
    
    <!-- 2024/03/14 QC#63527 Add Start -->
    <statement id="getInvtyOwnrCd" parameterClass="Map" resultClass="String">
        SELECT
            DISTINCT RTL_WH.INVTY_OWNR_CD  
        FROM
            RTL_SWH RTL_SWH
            ,RTL_WH RTL_WH
        WHERE
            RTL_SWH.RTL_WH_CD            = RTL_WH.RTL_WH_CD
            AND RTL_SWH.RTL_WH_CD        = #whCd#
            AND RTL_SWH.GLBL_CMPY_CD     = #glblCmpyCd#
            AND RTL_SWH.EZCANCELFLAG     = '0'
            AND RTL_WH.GLBL_CMPY_CD      = #glblCmpyCd#
            AND RTL_WH.EZCANCELFLAG      = '0'
    </statement>
    
    <statement id="getCpoDetailInvLocCd" parameterClass="Map" resultClass="String">
        SELECT
            RTL_WH.INVTY_OWNR_CD 
        FROM 
            CPO_DTL   DTL
            ,RTL_SWH  RTL_SWH
            ,RTL_WH   RTL_WH
        WHERE 
            DTL.GLBL_CMPY_CD              = #glblCmpyCd#
            AND DTL.CPO_ORD_NUM           = #cplOrdNum#
            AND DTL.CPO_DTL_LINE_NUM      = #cplDtlLineNum#
            AND DTL.CPO_DTL_LINE_SUB_NUM  = #cplDtlLineSubNum#
            AND DTL.EZCANCELFLAG          = '0'
            AND DTL.INVTY_LOC_CD          = RTL_SWH.INVTY_LOC_CD 
            AND RTL_SWH.RTL_WH_Cd         = RTL_WH.RTL_WH_CD
            AND RTL_SWH.GLBL_CMPY_CD      = #glblCmpyCd#
            AND RTL_SWH.EZCANCELFLAG      = '0'
            AND RTL_WH.GLBL_CMPY_CD       = #glblCmpyCd#
            AND RTL_WH.EZCANCELFLAG       = '0'       
    </statement>

    <statement id="getRtlWh" parameterClass="Map" resultClass="String">
        SELECT
            RTW.RTL_WH_CD
        FROM
            RTL_WH RTW
        WHERE
            RTW.GLBL_CMPY_CD        = #glblCmpyCd#
            AND RTW.PHYS_WH_CD      = #physWhCd#
            AND RTW.INVTY_OWNR_CD   = 'GMD'
            AND RTW.EZCANCELFLAG    = '0'
    </statement>
    <!-- 2024/03/14 QC#63527 Add End -->
</sqlMap>
