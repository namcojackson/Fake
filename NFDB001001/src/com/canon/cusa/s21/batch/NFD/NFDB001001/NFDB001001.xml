<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NFDB001001">

    <statement id="selectPrmsBrknList" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            CL.CLT_PRMS_DTL_PK AS CLT_PRMS_DTL_PK
        FROM
            CLT_PRMS_DTL CL
        WHERE
                CL.GLBL_CMPY_CD  = #glblCmpyCd#
            AND CL.EZCANCELFLAG  = '0'
            AND CL.CLT_PRMS_STS_CD = #cltPrmsStsCd#
            AND CL.AR_TRX_NUM IS NULL
            AND CL.CLT_PRMS_BRKN_FLG = #cltPrmsBrknFlgN#
            AND CL.CLT_PRMS_DT &lt;= #bpDt#
            AND CL.DEAL_CLT_PRMS_AMT &gt; (
                    SELECT
                        NVL (SUM(AR.DEAL_ORIG_GRS_AMT),0)
                    FROM
                         AR_TRX_BAL AR
                    WHERE
                            AR.GLBL_CMPY_CD = #glblCmpyCd#
                        AND AR.EZCANCELFLAG = '0'
                        AND AR.AR_TRX_TP_CD = #arTrxTpCd#
                        AND AR.BILL_TO_CUST_ACCT_CD = CL.CLT_ACCT_CD
                        AND AR.AR_TRX_DT &gt;= CL.CLT_PRMS_CRAT_DT
            )

        UNION

        SELECT
             CL.CLT_PRMS_DTL_PK AS CLT_PRMS_DTL_PK
        FROM
             AR_TRX_BAL AR
            ,CLT_PRMS_DTL CL
        WHERE
                AR.GLBL_CMPY_CD = #glblCmpyCd#
            AND AR.EZCANCELFLAG = '0'
            AND CL.GLBL_CMPY_CD = #glblCmpyCd#
            AND CL.EZCANCELFLAG = '0'
            AND CL.CLT_PRMS_STS_CD = #cltPrmsStsCd#
            AND CL.CLT_PRMS_BRKN_FLG =#cltPrmsBrknFlgN#
            AND CL.CLT_PRMS_DT &lt;= #bpDt#
            AND CL.CLT_ACCT_CD = AR.BILL_TO_CUST_ACCT_CD
            AND CL.AR_TRX_NUM = AR.AR_TRX_NUM
            AND CL.DEAL_RMNG_BAL_GRS_AMT - CL.DEAL_CLT_PRMS_AMT &lt; AR.DEAL_RMNG_BAL_GRS_AMT
    </statement>

    <statement id="selectPrmsCloseList" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            CL.CLT_PRMS_DTL_PK AS CLT_PRMS_DTL_PK
        FROM
            CLT_PRMS_DTL CL
        WHERE
                CL.GLBL_CMPY_CD  = #glblCmpyCd#
            AND CL.EZCANCELFLAG  = '0'
            AND CL.CLT_PRMS_STS_CD = #cltPrmsStsCd#
            AND CL.AR_TRX_NUM IS NULL
            AND CL.DEAL_CLT_PRMS_AMT &lt;= (
                    SELECT
                        NVL (SUM(AR.DEAL_ORIG_GRS_AMT),0)
                    FROM
                         AR_TRX_BAL AR
                    WHERE
                            AR.GLBL_CMPY_CD = #glblCmpyCd#
                        AND AR.EZCANCELFLAG = '0'
                        AND AR.AR_TRX_TP_CD = #arTrxTpCd#
                        AND AR.BILL_TO_CUST_ACCT_CD = CL.CLT_ACCT_CD
                        AND AR.AR_TRX_DT &gt;= CL.CLT_PRMS_CRAT_DT)

        UNION

        SELECT
             CL.CLT_PRMS_DTL_PK AS CLT_PRMS_DTL_PK
        FROM
             AR_TRX_BAL AR
            ,CLT_PRMS_DTL CL
        WHERE
                AR.GLBL_CMPY_CD = #glblCmpyCd#
            AND AR.EZCANCELFLAG = '0'
            AND CL.GLBL_CMPY_CD = #glblCmpyCd#
            AND CL.EZCANCELFLAG = '0'
            AND CL.CLT_PRMS_STS_CD = #cltPrmsStsCd#
            AND CL.CLT_ACCT_CD = AR.BILL_TO_CUST_ACCT_CD
            AND CL.AR_TRX_NUM = AR.AR_TRX_NUM
            AND CL.DEAL_RMNG_BAL_GRS_AMT - CL.DEAL_CLT_PRMS_AMT &gt;= AR.DEAL_RMNG_BAL_GRS_AMT
    </statement>
</sqlMap>