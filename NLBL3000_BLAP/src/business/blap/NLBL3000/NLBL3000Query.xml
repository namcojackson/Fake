<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NLBL3000Query">
<!-- 07/26/2013 R-OM031 Del Start -->
<!-- 
    <typeAlias alias="NLBL3000_ASMsg"    type="business.blap.NLBL3000.NLBL3000_ASMsg"/>

    <statement id="search" parameterClass="Map"  resultMap="result.search">
        WITH SM_ORD AS(
            SELECT
               ROW_NUMBER() OVER (
                   ORDER BY 
                       SM.MDSE_CD
                      ,SM.SER_NUM 
                      ,SM.SER_MSTR_STS_CD 
                      ,SM.STK_STS_CD)       AS ROW_NUM 
              ,SM.MDSE_CD                   AS MDSE_CD 
              ,SM.SER_NUM                   AS SER_NUM 
              ,(SELECT
                    SMS.SER_MSTR_STS_NM
                FROM
                    SER_MSTR_STS SMS
                WHERE
                        SMS.EZCANCELFLAG     = '0'
                    AND SMS.GLBL_CMPY_CD     = #glblCmpyCd# 
                    AND SMS.SER_MSTR_STS_CD  = SM.SER_MSTR_STS_CD
               )                            AS SER_MSTR_STS_NM 
              ,(SELECT
                    SS.STK_STS_NM
                FROM
                    STK_STS SS
                WHERE
                        SS.EZCANCELFLAG     = '0'
                    AND SS.GLBL_CMPY_CD     = #glblCmpyCd# 
                    AND SS.STK_STS_CD       = SM.STK_STS_CD
               )                            AS STK_STS_NM 
            FROM
                SER_MSTR SM
            WHERE
                    SM.EZCANCELFLAG      = '0'
                AND SM.GLBL_CMPY_CD      = #glblCmpyCd#
            <isNotNull property="mdseCd">
                AND SM.MDSE_CD           = #mdseCd#
            </isNotNull>
            <isNotNull property="stkStsCdList">
                <iterate property="stkStsCdList" var="elements[]" open=" AND SM.STK_STS_CD IN (" close=")" conjunction=",">
                    #elements[]#
                </iterate>
            </isNotNull>
            <isNotNull property="serMstrStsList">
                <iterate property="serMstrStsList" var="elements[]" open=" AND SM.SER_MSTR_STS_CD IN (" close=")" conjunction=",">
                    #elements[]#
                </iterate>
            </isNotNull>
        )
        SELECT
            SM_ORD.MDSE_CD
           ,SM_ORD.SER_NUM
           ,SM_ORD.SER_MSTR_STS_NM
           ,SM_ORD.STK_STS_NM
        FROM
            SM_ORD
        WHERE
            SM_ORD.ROW_NUM &lt;= #rowNum#
        ORDER BY
            SM_ORD.ROW_NUM
    </statement>
    <resultMap id="result.search" class="NLBL3000_ASMsg">
        <result property="mdseCd_A1"        column="MDSE_CD"          javaType="EZDSStringItem"/>
        <result property="serNum_A1"        column="SER_NUM"          javaType="EZDSStringItem"/>
        <result property="serMstrStsNm_A1"  column="SER_MSTR_STS_NM"  javaType="EZDSStringItem"/>
        <result property="stkStsNm_A1"      column="STK_STS_NM"       javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="getSerNum" parameterClass="Map"  resultClass="String">
        SELECT
            SER_NUM
        FROM
            SER_MSTR SM
        WHERE
                SM.EZCANCELFLAG      = '0'
            AND SM.GLBL_CMPY_CD      = #glblCmpyCd#
            AND SM.STK_STS_CD        = #stkStsCd_GOOD#
            AND SM.SER_NUM           = #serNum#
            <isNotNull property="mdseCd">
            AND SM.MDSE_CD           = #mdseCd#
            </isNotNull>
        <isNotNull property="serMstrStsList">
            <iterate property="serMstrStsList" var="elements[]" open=" AND SM.SER_MSTR_STS_CD IN (" close=")" conjunction=",">
                #elements[]#
            </iterate>
        </isNotNull>
    </statement>

  -->
<!-- 07/26/2013 R-OM031 Del End -->

    <!-- 11/28/2015 CSAI Y.Imazu Add CSA START -->
    <statement id="getMdseSerNumRng" parameterClass="Map" resultClass="Map">
        SELECT
            MDSE_CD
           ,FROM_SER_NUM
           ,THRU_SER_NUM
           ,LG_SER_NUM
        FROM
            MDSE_SER_NUM_RNG
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND MDSE_CD      = #mdseCd#
        AND EZCANCELFLAG = '0'
        ORDER BY
            MDSE_SER_NUM_RNG_PK
    </statement>

    <statement id="getSvcMachMstr" parameterClass="Map" resultClass="Map">
        SELECT
            SVC_MACH_MSTR_PK
           ,SVC_MACH_MSTR_STS_CD
           ,TRX_HDR_NUM
           ,CUR_LOC_NUM
           ,SVC_CONFIG_MSTR_PK
        FROM
            SVC_MACH_MSTR
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND SER_NUM      = #serNum#
        <isNotNull property="mdseCd">
        AND MDSE_CD      = #mdseCd#
        </isNotNull>
        AND SVC_MACH_MSTR_STS_CD NOT IN (#svcMachMstrStsDup#, #svcMachMstrStsTrmn#)
        AND EZCANCELFLAG = '0'
    </statement>

    <statement id="getDsAssetMstr" parameterClass="Map" resultClass="Map">
        SELECT
            DS_ASSET_MSTR_PK
           ,ASSET_TP_CD
           ,SVC_MACH_MSTR_PK
           ,SHPG_PLN_NUM
        FROM
            DS_ASSET_MSTR
        WHERE
            GLBL_CMPY_CD   = #glblCmpyCd#
        AND SER_NUM        = #serNum#
        AND MDSE_CD        = #mdseCd#
        AND ACTV_ASSET_FLG = #actvAssetFlg#
        AND EZCANCELFLAG   = '0'
    </statement>
    <!-- 11/28/2015 CSAI Y.Imazu Add CSA END -->

    <!-- 07/15/2016 CSAI Y.Imazu Add QC7334 START -->
    <statement id="getShipSerCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            SHIP_SER_NUM
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND SO_NUM       = #soNum#
        AND SER_NUM      = #serNum#
        AND EZCANCELFLAG = '0'
    </statement>

    <statement id="getRcvSerCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            RWS_PUT_AWAY_SER
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND RWS_NUM      = #rwsNum#
        AND SER_NUM      = #serNum#
        AND EZCANCELFLAG = '0'
    </statement>
    <!-- 07/15/2016 CSAI Y.Imazu Add QC7334 END -->

    <statement id="getTrxHdrNumForSO" parameterClass="Map" resultClass="Map">
        SELECT
             SO.TRX_HDR_NUM
            ,SO.SO_NUM
        FROM
            SHPG_ORD SO
        WHERE
            SO.GLBL_CMPY_CD = #glblCmpyCd#
        AND SO.SO_NUM       = #soNum#
        AND SO.EZCANCELFLAG = '0'
    </statement>

    <statement id="getTrxHdrNumForRWS" parameterClass="Map" resultClass="Map">
        SELECT
             RH.SER_ALLOC_TRX_HDR_NUM
            ,RH.RWS_NUM
            ,RH.SCE_ORD_TP_CD
        FROM
            RWS_HDR RH
        WHERE
            RH.GLBL_CMPY_CD = #glblCmpyCd#
        AND RH.RWS_NUM      = #rwsNum#
        AND RH.EZCANCELFLAG = '0'
    </statement>

    <statement id="getTrxHdrNumForRwsSubContract" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            SOD.TRX_HDR_NUM
        FROM
            RWS_HDR RH
           ,RWS_DTL RD
           ,PRCH_REQ_DTL PRD
           ,SHPG_ORD_DTL SOD
        WHERE
            RH.GLBL_CMPY_CD           = #glblCmpyCd#
        AND RH.RWS_NUM                = #rwsNum#
        AND RH.EZCANCELFLAG           = '0'
        AND RH.GLBL_CMPY_CD           = RD.GLBL_CMPY_CD
        AND RH.RWS_NUM                = RD.RWS_NUM
        AND RD.EZCANCELFLAG           = '0'
        AND RD.GLBL_CMPY_CD           = PRD.GLBL_CMPY_CD
        AND RH.PO_RCV_TRX_HDR_NUM     = PRD.PO_ORD_NUM  
        AND RD.PO_RCV_TRX_LINE_NUM    = PRD.PO_ORD_DTL_LINE_NUM
        AND PRD.EZCANCELFLAG          = '0'
        AND PRD.GLBL_CMPY_CD          = SOD.GLBL_CMPY_CD
        AND PRD.PRCH_REQ_NUM          = SOD.PRCH_REQ_NUM
        AND PRD.PRCH_REQ_LINE_NUM     = SOD.PRCH_REQ_LINE_NUM
        AND PRD.PRCH_REQ_LINE_SUB_NUM = SOD.PRCH_REQ_LINE_SUB_NUM
        AND SOD.EZCANCELFLAG          = '0'
    </statement>
</sqlMap>
