<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<sqlMap namespace="NMZC611001">

    <typeAlias alias="CarrierInfoBean"   type="com.canon.cusa.s21.api.NMZ.NMZC611001.CarrierInfoBean"/>

    <statement id="getDefaultCarrier" parameterClass="Map" resultMap="result.getCarrierInfo">
        SELECT CARR.DS_ACCT_NUM AS DS_ACCT_NUM
            , CARR.VND_CD AS VND_CD
            , CARR.DS_CARR_ACCT_NUM AS DS_CARR_ACCT_NUM
            , CARR.DEF_ACCT_CARR_FLG AS DEF_ACCT_CARR_FLG
        FROM  
            DS_ACCT_CARR CARR
            <isNotNull property="frtCondCd">
            <isNotNull property="shpgSvcLvlCd">
            , DS_CUST_SHPG_DEF DCH
            , SHPG_SVC_LVL_CARR_RELN SSL
            , FRT_COND_SVC_LVL_RELN FCS
            </isNotNull>
            </isNotNull>
        WHERE CARR.GLBL_CMPY_CD = #glblCmpyCd#
        AND   CARR.EZCANCELFLAG = '0'
        AND   CARR.EFF_FROM_DT &lt;= #slsDt#
        AND   (CARR.EFF_THRU_DT &gt;= #slsDt# OR CARR.EFF_THRU_DT IS NULL)
        <!-- 2018/12/06 QC#29315 Add Start -->
        <isNotNull property="dsAcctNum">
        AND   CARR.DS_ACCT_NUM = #dsAcctNum#
        </isNotNull>
        <isNotNull property="locNum">
        AND   CARR.LOC_NUM = #locNum#
        </isNotNull>
        AND   CARR.LINE_BIZ_TP_CD = #lineBizTpCd#
        AND   CARR.DS_BIZ_AREA_CD = #dsBizAreaCd#
        
        <isNotNull property="frtCondCd">
        <isNotNull property="shpgSvcLvlCd">
         AND  CARR.GLBL_CMPY_CD  = DCH.GLBL_CMPY_CD
         AND  CARR.DS_ACCT_CARR_PK = DCH.DS_ACCT_CARR_PK
         AND  CARR.EZCANCELFLAG    = DCH.EZCANCELFLAG
         AND  (DCH.FRT_COND_CD     = #frtCondCd#
          OR  DCH.FRT_COND_CD      IS NULL)
         AND  (DCH.SHPG_SVC_LVL_CD  = #shpgSvcLvlCd#
          OR  DCH.SHPG_SVC_LVL_CD  IS NULL)
         
         AND  CARR.GLBL_CMPY_CD  = SSL.GLBL_CMPY_CD
         AND  CARR.VND_CD        = SSL.CARR_CD
         AND  SSL.SHPG_SVC_LVL_CD= #shpgSvcLvlCd#
         AND  CARR.EZCANCELFLAG  = SSL.EZCANCELFLAG
         
         AND  SSL.GLBL_CMPY_CD    = FCS.GLBL_CMPY_CD
         AND  FCS.LINE_BIZ_TP_CD  = #lineBizTpCd#
         AND  FCS.FRT_COND_CD     = #frtCondCd#
         AND  FCS.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
         AND  SSL.CARR_SVC_LVL_CD = FCS.CARR_SVC_LVL_CD
         AND  SSL.EZCANCELFLAG    = FCS.EZCANCELFLAG
        </isNotNull>
         </isNotNull>
        <!-- 2018/12/06 QC#29315 Add End -->

        <isNull property="frtCondCd">
        <isNull property="shpgSvcLvlCd">
        AND   CARR.DEF_ACCT_CARR_FLG = 'Y'
        AND   ROWNUM = 1
        </isNull>
        </isNull>

    </statement>

    <statement id="getDefaultCarrierAccount" parameterClass="Map" resultMap="result.getCarrierInfo">
        SELECT CARR.DS_ACCT_NUM AS DS_ACCT_NUM
            , CARR.VND_CD AS VND_CD
            , CARR.DS_CARR_ACCT_NUM AS DS_CARR_ACCT_NUM
            , CARR.DEF_ACCT_CARR_FLG AS DEF_ACCT_CARR_FLG
        FROM  DS_ACCT_CARR CARR
        WHERE CARR.GLBL_CMPY_CD = #glblCmpyCd#
        AND   CARR.EZCANCELFLAG = '0'
        AND   CARR.EFF_FROM_DT &lt;= #slsDt#
        AND   (CARR.EFF_THRU_DT &gt;= #slsDt# OR CARR.EFF_THRU_DT IS NULL)
        <!-- 2018/12/06 QC#29315 Add Start -->
        <isNotNull property="dsAcctNum">
        AND   CARR.DS_ACCT_NUM = #dsAcctNum#
        </isNotNull>
        <isNotNull property="locNum">
        AND   CARR.LOC_NUM = #locNum#
        </isNotNull>
        AND   CARR.LINE_BIZ_TP_CD = #lineBizTpCd#
        AND   CARR.DS_BIZ_AREA_CD = #dsBizAreaCd#
        <!-- 2018/12/06 QC#29315 Add Start -->
        AND   CARR.VND_CD = #vndCd#
    </statement>
    
    <statement id="getDefaultCarrierAccountForMultiple" parameterClass="Map" resultMap="result.getCarrierInfo">
        SELECT CARR.DS_ACCT_NUM AS DS_ACCT_NUM
            , CARR.VND_CD AS VND_CD
            , CARR.DS_CARR_ACCT_NUM AS DS_CARR_ACCT_NUM
            , CARR.DEF_ACCT_CARR_FLG AS DEF_ACCT_CARR_FLG
        FROM  DS_ACCT_CARR CARR
        WHERE CARR.GLBL_CMPY_CD = #glblCmpyCd#
        AND   CARR.EZCANCELFLAG = '0'
        AND   CARR.EFF_FROM_DT &lt;= #slsDt#
        AND   (CARR.EFF_THRU_DT &gt;= #slsDt# OR CARR.EFF_THRU_DT IS NULL)
        <!-- 2018/12/06 QC#29315 Add Start -->
        <isNotNull property="dsAcctNum">
        AND   CARR.DS_ACCT_NUM = #dsAcctNum#
        </isNotNull>
        <isNotNull property="locNum">
        AND   CARR.LOC_NUM = #locNum#
        </isNotNull>
        AND   CARR.LINE_BIZ_TP_CD = #lineBizTpCd#
        AND   CARR.DS_BIZ_AREA_CD = #dsBizAreaCd#
        <!-- 2018/12/06 QC#29315 Add Start -->
        AND   CARR.VND_CD = #vndCd#
        AND   CARR.DEF_ACCT_CARR_FLG = 'Y'
        AND   ROWNUM = 1
    </statement>

    <resultMap id="result.getCarrierInfo"    class="CarrierInfoBean">
        <result property="dsAcctNum"               column="DS_ACCT_NUM"           javaType="String"/>
        <result property="vndCd"                   column="VND_CD"                javaType="String"/>
        <result property="dsCarrAcctNum"           column="DS_CARR_ACCT_NUM"      javaType="String"/>
        <result property="defAcctCarrFlg"          column="DEF_ACCT_CARR_FLG"     javaType="String"/>
    </resultMap>

</sqlMap>
