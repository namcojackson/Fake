<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NLCL0270Query">

    <typeAlias alias="NLCL0270_ASMsg"      type="business.blap.NLCL0270.NLCL0270_ASMsg"/>

    <!-- QC#29214 Update SQL-->
    <statement id="getSpssIvntyInfo" parameterClass="Map" resultMap="result.getSpssIvntyInfo">
           SELECT
               M.MDSE_CD              AS MDSE_CD
              ,M.MDSE_DESC_SHORT_TXT  AS MDSE_DESC_SHORT_TXT
              ,D_RWV.RTL_WH_NM        AS RTL_WH_NM
              ,D_RWV.RTL_SWH_NM       AS RTL_SWH_NM
              ,NVL( I.STK_STS_CD , '1' )     AS STK_STS_CD
              ,NVL( I.INVTY_AVAL_QTY, '0' )  AS INVTY_AVAL_QTY
              ,NVL( I.INVTY_QTY, '0' )       AS INVTY_QTY
           FROM
               DS_RTL_WH_V D_RWV
               ,ALL_MDSE_V M
               ,SWH
               , (
                    SELECT
                        INV.GLBL_CMPY_CD
                        , INV.INVTY_LOC_CD
                        , INV.MDSE_CD
                        , INV.STK_STS_CD
                        , INV.INVTY_AVAL_QTY
                        , INV.INVTY_QTY
                    FROM
                        INVTY INV
                    WHERE
                        INV.GLBL_CMPY_CD = #cMsg.glblCmpyCd_G1#
                    AND INV.LOC_STS_CD   = #locStsCd#
                    AND INV.INVTY_QTY    > 0
                    <isNotNull property="cMsg.stkStsCd_H1">
                        AND INV.STK_STS_CD = #cMsg.stkStsCd_H1#
                    </isNotNull>
                    AND INV.EZCANCELFLAG = '0'
                 ) I
           WHERE
               D_RWV.GLBL_CMPY_CD = #cMsg.glblCmpyCd_G1#
               <isNotNull property="cMsg.rtlWhNm_H1">
           AND D_RWV.RTL_WH_NM = #cMsg.rtlWhNm_H1#
               </isNotNull>
               <isNotNull property="cMsg.rtlSwhNm_H1">
           AND D_RWV.RTL_SWH_NM = #cMsg.rtlSwhNm_H1#
               </isNotNull>          
           AND D_RWV.EZCANCELFLAG = '0'
           AND M.MDSE_CD IN
               <iterate property="mdseList" var="elements[]" open="(" conjunction= ", " close=")">
                   #elements[]#
               </iterate>
           AND M.EZCANCELFLAG = '0'
           AND D_RWV.GLBL_CMPY_CD = SWH.GLBL_CMPY_CD
           AND D_RWV.RTL_SWH_CD   = SWH.RTL_SWH_CD
           AND SWH.EZCANCELFLAG   = '0'
           AND D_RWV.GLBL_CMPY_CD = I.GLBL_CMPY_CD (+)
           AND D_RWV.INVTY_LOC_CD = I.INVTY_LOC_CD (+)
           AND M.GLBL_CMPY_CD     = I.GLBL_CMPY_CD (+)
           AND M.MDSE_CD          = I.MDSE_CD      (+)
           ORDER BY
               D_RWV.RTL_WH_NM
              ,SWH.RTL_SWH_SORT_NUM
              ,I.STK_STS_CD
              ,M.MDSE_CD
    </statement>

    <resultMap id="result.getSpssIvntyInfo" class="NLCL0270_ASMsg">
        <result property="mdseCd_A1"            column="MDSE_CD"                  javaType="EZDSStringItem"/>
        <result property="mdseDescShortTxt_A1"  column="MDSE_DESC_SHORT_TXT"      javaType="EZDSStringItem"/>
        <result property="rtlWhNm_A1"           column="RTL_WH_NM"                javaType="EZDSStringItem"/>
        <result property="rtlSwhNm_A1"          column="RTL_SWH_NM"               javaType="EZDSStringItem"/>
        <result property="stkStsCd_A1"          column="STK_STS_CD"               javaType="EZDSStringItem"/>
        <result property="invtyAvalQty_A1"      column="INVTY_AVAL_QTY"           javaType="EZDSBigDecimalItem"/>
        <result property="invtyQty_A1"          column="INVTY_QTY"                javaType="EZDSBigDecimalItem"/>
    </resultMap>

    <statement id="searchSSPullDown" parameterClass="Map" resultClass="Map">
         SELECT
               SS.STK_STS_CD         AS STK_STS_CD
             , SS.STK_STS_DESC_TXT   AS STK_STS_DESC_TXT
          FROM 
               STK_STS SS
         WHERE
               SS.GLBL_CMPY_CD     = #cMsg.glblCmpyCd_G1#
           AND SS.EZCANCELFLAG     = '0'
         ORDER BY
               SS.STK_STS_CD
    </statement>
    
    <!-- QC#29214 Add SQL Start-->
    <statement id="getCompatibleItem" parameterClass="Map" resultClass="String">
        SELECT
            RELN_MDSE_CD
        FROM
            MDSE_ITEM_FLIP_SET
        WHERE
                GLBL_CMPY_CD = #GLBL_CMPY_CD#
            AND MDSE_CD = #MDSE_CD#
            AND MDSE_ITEM_RELN_TP_CD IN
            <isNotNull property="MDSE_ITEM_RELN_TP_CD">
                <iterate property="MDSE_ITEM_RELN_TP_CD" var="MDSE_ITEM_RELN_TP_CD[]" open="(" close=")" conjunction=",">
                    #MDSE_ITEM_RELN_TP_CD[]#
                </iterate>
            </isNotNull>
            AND EZCANCELFLAG = '0'
        ORDER BY
            RELN_MDSE_CD
    </statement>
</sqlMap>
