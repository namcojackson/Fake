<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NLAB060001">

    <statement id="findRws" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
            --[NLAI2020_01]
            RH.RWS_REF_NUM
            ,RH.WH_IN_ETA_DT
            ,TL.TPL_LOC_NM
            ,(
                SELECT SUM(D.RWS_QTY) CNT
                FROM RWS_DTL D
                WHERE
                    D.GLBL_CMPY_CD=RH.GLBL_CMPY_CD
                AND D.RWS_NUM=RH.RWS_NUM
                AND D.EZCANCELFLAG='0'
            ) ORIG_ORD_QTY
            --[WMS_INBD_PO_HDR]
            ,RH.GLBL_CMPY_CD
            ,RH.WH_CD
            ,CCC.S80_CMPY_CD
            --,RH.RWS_REF_NUM
            ,RH.FROM_LOC_CD
            ,SOT.S80_ORD_TP_CD
            ,SOT.S80_TRX_CD
            --,RH.WH_IN_ETA_DT
            ,RH.IMPT_INV_VESL_NM
            ,RH.IMPT_INV_BOL_NUM
            --,RH.WH_CD
            ,RH.RWS_NUM
            ,RH.SVC_CONFIG_MSTR_PK
            ,(
                SELECT
                    CASE
                        WHEN CNT<=0 THEN '1'
                        ELSE '2'
                    END
                FROM (
                    SELECT COUNT(*) CNT
                    FROM WMS_INBD_PO_HDR H
                    WHERE
                        H.GLBL_CMPY_CD=RH.GLBL_CMPY_CD
                    AND H.WMS_PO_ID=RH.RWS_REF_NUM
                    AND H.EZCANCELFLAG='0'
                )
            ) STAGE_ACT_CD
            --[WMS_INBD_PO_DTL]
            --,RH.GLBL_CMPY_CD
            --,RH.WH_CD
            --,CCC.S80_CMPY_CD
            --,RH.RWS_REF_NUM
            --,RH.WH_CD
            --[WMS_INBD_PO_VND]
            --,RH.GLBL_CMPY_CD
            --,RH.WH_CD
            --,CCC.S80_CMPY_CD
            --,RH.RWS_REF_NUM
            --,RH.FROM_LOC_CD
            ,RH.FROM_LOC_NM_01
            ,RH.FROM_LOC_NM_02
            ,RH.FROM_LOC_ADDR_01
            ,RH.FROM_LOC_ADDR_02
            ,RH.FROM_LOC_ADDR_03
            ,RH.FROM_LOC_ADDR_04
            ,RH.FROM_LOC_CTY_ADDR
            ,RH.FROM_LOC_ST_CD
            ,RH.FROM_LOC_POST_CD
            ,RH.FROM_LOC_CTRY_CD
            ,RH.FROM_LOC_PSN_NM
            ,RH.FROM_LOC_TEL_NUM
        FROM
            RWS_HDR            RH
           ,RWS_STS            RS
           ,RTL_WH             RW
           ,TPL_LOC            TL
           ,CMPY_CD_CONV       CCC
           ,SCE_ORD_TP         SOT
        WHERE
            RH.GLBL_CMPY_CD         = #GLBL_CMPY_CD#
        AND RH.WMS_DROP_STS_CD      = #WMS_DROP_STS_CD#
        AND RH.GLBL_CMPY_CD         = RS.GLBL_CMPY_CD
        AND RH.RWS_STS_CD           = RS.RWS_STS_CD
        AND (RS.RWS_OPEN_FLG = #flgY# OR RS.RCV_FLG = #flgY#)
        AND RS.EZCANCELFLAG         = '0'
        AND RH.GLBL_CMPY_CD         = RW.GLBL_CMPY_CD
        AND RH.WH_CD                = RW.RTL_WH_CD
        AND RW.WH_OWNR_CD           = #WH_OWNR_CD#
        AND RH.GLBL_CMPY_CD         = TL.GLBL_CMPY_CD(+)
        AND RH.WH_CD                = TL.TPL_LOC_CD(+)
        AND RH.GLBL_CMPY_CD         = CCC.GLBL_CMPY_CD(+)
        AND RH.GLBL_CMPY_CD         = SOT.GLBL_CMPY_CD(+)
        AND RH.SCE_ORD_TP_CD        = SOT.SCE_ORD_TP_CD(+)
        AND SOT.INBD_OTBD_CD(+)     = #INBD_OTBD_CD#
        AND RH.EZCANCELFLAG         = '0'
        AND RW.EZCANCELFLAG         = '0'
        AND TL.EZCANCELFLAG(+)      = '0'
        AND CCC.EZCANCELFLAG(+)     = '0'
        AND SOT.EZCANCELFLAG(+)     = '0'
        ORDER BY
            RH.GLBL_CMPY_CD
            ,RH.RWS_NUM
    ]]>
    </statement>
 
    <statement id="getRwsDetail" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
            --[NLAI2020_02]
            RD.RWS_QTY
            ,RD.MDSE_CD
            --[WMS_INBD_PO_DTL]
            ,RD.RWS_DTL_LINE_NUM
            --,RD.MDSE_CD
            ,SSC.S80_STK_STS_CD
            --,RD.RWS_QTY
            ,RD.WH_IN_ETA_DT
            ,RD.IMPT_INV_NUM
            ,RD.IMPT_INV_DO_NUM
            ,RD.OUT_PACK_FROM_CSE_NUM
            ,RD.OUT_PACK_TO_CSE_NUM
            --,RH.WH_CD
            ,RD.RTL_SWH_CD
            ,RD.THIRD_PTY_DSP_TP_CD
            ,RD.SER_APVL_REQ_FLG
        FROM
            RWS_DTL            RD
           ,RWS_STS            RS
           ,STK_STS_CONV       SSC
        WHERE
            RD.GLBL_CMPY_CD         = #GLBL_CMPY_CD#
        AND RD.RWS_NUM              = #RWS_NUM#
        AND RD.GLBL_CMPY_CD         = RS.GLBL_CMPY_CD
        AND RD.RWS_STS_CD           = RS.RWS_STS_CD
        AND (RS.RWS_OPEN_FLG = #flgY# OR RS.RCV_FLG = #flgY#)
        AND RS.EZCANCELFLAG         = '0'
        AND RD.GLBL_CMPY_CD         = SSC.GLBL_CMPY_CD(+)
        AND RD.INVTY_STK_STS_CD     = SSC.STK_STS_CD(+)
        ORDER BY
            RD.GLBL_CMPY_CD
            ,RD.RWS_NUM
            ,RD.RWS_DTL_LINE_NUM
    ]]>
    </statement>

</sqlMap>
