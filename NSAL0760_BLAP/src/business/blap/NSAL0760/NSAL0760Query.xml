<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL0760Query">
    <typeAlias alias="NSAL0760_BSMsg"  type="business.blap.NSAL0760.NSAL0760_BSMsg"/>

    <resultMap id="result.getSearchData"      class="NSAL0760_BSMsg">
        <result property="xxRowNum_A1"               column="ROWNUM"                 javaType="EZDSBigDecimalItem"/>
        <result property="xxRefCseNum"               column="LVL"                    javaType="EZDSBigDecimalItem"/>
        <result property="dsContrTrkTpCd"            column="DS_CONTR_TRK_TP"        javaType="EZDSStringItem"/>
        <result property="dsContrNum"                column="CONTR_NUM"              javaType="EZDSStringItem"/>
        <result property="dsContrDtlPk"              column="DS_CONTR_DTL_PK"        javaType="EZDSBigDecimalItem"/>
        <result property="dsContrBllgMtrPk"          column="DS_CONTR_BLLG_MTR_PK"   javaType="EZDSBigDecimalItem"/>
        <result property="serNum"                    column="SER_NUM"                javaType="EZDSStringItem"/>
        <result property="mdseDescShortTxt_AS"       column="MDSE_DESC_SHORT_TXT"    javaType="EZDSStringItem"/>
        <result property="xxBtnFlg_A1"               column="CHARGE_DISP"            javaType="EZDSStringItem"/>
        <result property="xxDplyByCdNmCnctTxt"       column="CHARGE_TP_TXT"          javaType="EZDSStringItem"/>
        <result property="dsContrPrcEffSqNum"        column="PRC_EFF_SQ_NUM"         javaType="EZDSBigDecimalItem"/>
        <result property="xxBtnFlg_A2"               column="EFF_DISP"               javaType="EZDSStringItem"/>
        <result property="xxBtnFlg_A3"               column="AUDIT_DISP"             javaType="EZDSStringItem"/>
        <result property="xxFromDt"                  column="FROM_DT"                javaType="EZDSDateItem"/>
        <result property="xxThruDt"                  column="THRU_DT"                javaType="EZDSDateItem"/>
        <result property="contrCloDt"                column="CLO_DT"                 javaType="EZDSDateItem"/>
        <result property="dsContrStsDescTxt"         column="STS_NM"                 javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="getSearchData" parameterClass="Map" resultMap="result.getSearchData">
        SELECT
             ROWNUM
            ,SER_NUM_SORT_NUM
            ,MDSE_CD_SORT_NUM
            ,DS_CONTR_DTL_TP_SORT_NUM
            ,MTR_LB_SORT_NUM
            ,LVL
            ,DS_CONTR_TRK_TP
            ,CONTR_NUM
            ,DS_CONTR_DTL_PK
            ,SER_NUM
            <!-- START 2023/05/15 t.aizawa [QC#59398,ADD] -->
            ,MDSE_DESC_SHORT_TXT
            <!-- END 2023/05/15 t.aizawa [QC#59398,ADD] -->
            ,CHARGE_DISP
            ,CHARGE_TP_TXT
            ,DS_CONTR_BLLG_MTR_PK
            ,EFF_DISP
            ,PRC_EFF_SQ_NUM
            ,AUDIT_DISP
            ,FROM_DT
            ,THRU_DT
            <!-- START 2018/02/22 M.Naito [QC#23179,MOD] -->
            <!-- START 2017/09/07 K.Kim [QC#20761,ADD] -->
            <!-- ,DECODE(CLO_DT, NULL, NULL, TO_CHAR(TO_DATE(CLO_DT,'YYYYMMDD') + 1, 'YYYYMMDD')) AS CLO_DT -->
            <!-- END 2017/09/07 K.Kim [QC#20761,ADD] -->
            ,CLO_DT
            <!-- END 2018/02/22 M.Naito [QC#23179,MOD] -->
            ,STS_NM
        FROM
            (
            SELECT
                 LVL
                ,SER_NUM_SORT_NUM
                ,MDSE_CD_SORT_NUM
                ,DS_CONTR_DTL_TP_SORT_NUM
                ,MTR_LB_SORT_NUM
                ,DS_CONTR_TRK_TP
                ,CONTR_NUM
                ,DS_CONTR_DTL_PK
                ,SER_NUM
                <!-- START 2023/05/15 t.aizawa [QC#59398,ADD] -->
                ,MDSE_DESC_SHORT_TXT
                <!-- END 2023/05/15 t.aizawa [QC#59398,ADD] -->
                ,CHARGE_DISP
                ,CHARGE_TP_TXT
                ,DS_CONTR_BLLG_MTR_PK
                ,EFF_DISP
                ,PRC_EFF_SQ_NUM
                ,AUDIT_DISP
                ,FROM_DT
                ,THRU_DT
                <!-- START 2017/09/07 K.Kim [QC#20761,ADD] -->
                ,CLO_DT
                <!-- END 2017/09/07 K.Kim [QC#20761,ADD] -->
                ,STS_NM
            FROM
                (
                <!-- Contract -->
                SELECT
                     10                         AS LVL
                    ,NULL                       AS SER_NUM_SORT_NUM
                    ,NULL                       AS MDSE_CD_SORT_NUM
                    ,NULL                       AS DS_CONTR_DTL_TP_SORT_NUM
                    ,NULL                       AS MTR_LB_SORT_NUM
                    ,'1'                        AS DS_CONTR_TRK_TP
                    ,A.DS_CONTR_NUM             AS CONTR_NUM
                    ,NULL                       AS DS_CONTR_DTL_PK
                    ,''                         AS SER_NUM
                    <!-- START 2023/05/15 t.aizawa [QC#59398,ADD] -->
                    ,''                         AS MDSE_DESC_SHORT_TXT
                    <!-- END 2023/05/15 t.aizawa [QC#59398,ADD] -->
                    ,'N'                        AS CHARGE_DISP
                    ,''                         AS CHARGE_TP_TXT
                    ,NULL                       AS DS_CONTR_BLLG_MTR_PK
                    ,'N'                        AS EFF_DISP
                    ,NULL                       AS PRC_EFF_SQ_NUM
                    ,'Y'                        AS AUDIT_DISP
                    ,A.CONTR_VRSN_EFF_FROM_DT   AS FROM_DT
                    ,A.CONTR_VRSN_EFF_THRU_DT   AS THRU_DT
                    <!-- START 2017/09/07 K.Kim [QC#20761,ADD] -->
                    ,NULL                       AS CLO_DT
                    <!-- END 2017/09/07 K.Kim [QC#20761,ADD] -->
                    ,B.DS_CONTR_CTRL_STS_NM     AS STS_NM
                FROM
                     DS_CONTR               A
                    ,DS_CONTR_STS_V         B
                WHERE
                        A.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND A.EZCANCELFLAG          = '0'
                    AND A.DS_CONTR_PK           = #dsContrPk#
                    AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
                    AND A.DS_CONTR_PK           = B.DS_CONTR_PK
                    AND B.EZCANCELFLAG          = '0'
                <!-- Serial# -->
                UNION
                <!-- START 2023/05/15 t.aizawa [QC#59398,ADD] -->
                SELECT
                     W2.LVL
                    ,W2.SER_NUM_SORT_NUM
                    ,W2.MDSE_CD_SORT_NUM
                    ,W2.DS_CONTR_DTL_TP_SORT_NUM
                    ,W2.MTR_LB_SORT_NUM
                    ,W2.DS_CONTR_TRK_TP
                    ,W2.CONTR_NUM
                    ,W2.DS_CONTR_DTL_PK
                    ,W2.SER_NUM
                    ,MD.MDSE_DESC_SHORT_TXT
                    ,W2.CHARGE_DISP
                    ,W2.CHARGE_TP_TXT
                    ,W2.DS_CONTR_BLLG_MTR_PK
                    ,W2.EFF_DISP
                    ,W2.PRC_EFF_SQ_NUM
                    ,W2.AUDIT_DISP
                    ,W2.FROM_DT
                    ,W2.THRU_DT
                    ,W2.CLO_DT
                    ,W2.STS_NM
                FROM
                    (
                    <!-- END 2023/05/15 t.aizawa [QC#59398,ADD] -->
                    SELECT
                         20                         AS LVL
                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN D.SER_NUM
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN D.SER_NUM
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN D.SER_NUM
                              ELSE DP.SER_NUM
                         END                        AS SER_NUM_SORT_NUM
                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN D.MDSE_CD
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN D.MDSE_CD
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN D.MDSE_CD
                              ELSE DP.MDSE_CD
                         END                        AS MDSE_CD_SORT_NUM
                        ,TP.DS_CONTR_DTL_TP_SORT_NUM  AS DS_CONTR_DTL_TP_SORT_NUM
                        ,NULL                       AS MTR_LB_SORT_NUM
                        ,NULL                       AS DS_CONTR_TRK_TP
                        ,NULL                       AS CONTR_NUM
                        ,B.DS_CONTR_DTL_PK          AS DS_CONTR_DTL_PK
                        ,CASE WHEN B.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN DC.DS_CONTR_CATG_ABBR_NM || '_' || A.DS_CONTR_NUM
                              WHEN B.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN DC.DS_CONTR_CATG_ABBR_NM || '_' || A.DS_CONTR_NUM
                              ELSE NVL(D.SER_NUM, D.SVC_MACH_MSTR_PK)
                         END                        AS SER_NUM
                        <!-- START 2023/05/15 t.aizawa [QC#59398,ADD] -->
                        ,CASE WHEN B.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN A.SVC_PGM_MDSE_CD
                              WHEN B.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN A.SVC_PGM_MDSE_CD
                              ELSE B.SVC_PGM_MDSE_CD
                         END                        AS SVC_PGM_MDSE_CD
                         <!-- END 2023/05/15 t.aizawa [QC#59398,ADD] -->
                        ,'N'                        AS CHARGE_DISP
                        ,''                         AS CHARGE_TP_TXT
                        ,NULL                       AS DS_CONTR_BLLG_MTR_PK
                        ,'N'                        AS EFF_DISP
                        ,NULL                       AS PRC_EFF_SQ_NUM
                        ,'N'                        AS AUDIT_DISP
                        ,NULL                       AS FROM_DT
                        ,NULL                       AS THRU_DT
                        <!-- START 2017/09/07 K.Kim [QC#20761,ADD] -->
                        ,NULL                       AS CLO_DT
                        <!-- END 2017/09/07 K.Kim [QC#20761,ADD] -->
                        ,NULL                       AS STS_NM
                    FROM
                         DS_CONTR               A
                        ,DS_CONTR_DTL           B
<!--                        ,DS_CONTR_DTL_STS_V     C QC#28403 del -->
                        ,SVC_MACH_MSTR          D
                        ,DS_CONTR_DTL           BP
                        ,DS_CONTR_DTL_TP        TP
                        ,SVC_MACH_MSTR          DP
                        ,DS_CONTR_CATG          DC
                    WHERE
                            A.GLBL_CMPY_CD              = #glblCmpyCd#
                        AND A.EZCANCELFLAG              = '0'
                        AND A.DS_CONTR_PK               = #dsContrPk#
                        AND A.GLBL_CMPY_CD              = DC.GLBL_CMPY_CD
                        AND A.DS_CONTR_CATG_CD          = DC.DS_CONTR_CATG_CD
                        AND DC.EZCANCELFLAG             = '0'
                        AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
                        AND A.DS_CONTR_PK               = B.DS_CONTR_PK
                        AND B.EZCANCELFLAG              = '0'
                        <isNotNull property="activeLine">
                            AND B.DS_CONTR_DTL_STS_CD       IN
                            <iterate property="dsContrDtlStsCd" var="dsContrDtlStsCd[]"  open="(" close=" )" conjunction=",">
                             #dsContrDtlStsCd[]#
                            </iterate>
                        </isNotNull>
                        AND B.GLBL_CMPY_CD              = BP.GLBL_CMPY_CD     (+)
                        AND B.DS_CONTR_PK               = BP.DS_CONTR_PK      (+)
                        AND B.PRNT_DS_CONTR_DTL_PK      = BP.DS_CONTR_DTL_PK  (+)
                        AND BP.EZCANCELFLAG (+)         = '0'
                        AND BP.GLBL_CMPY_CD             = DP.GLBL_CMPY_CD     (+)
                        AND BP.SVC_MACH_MSTR_PK         = DP.SVC_MACH_MSTR_PK (+)
                        AND DP.EZCANCELFLAG (+)         = '0'
                        AND B.GLBL_CMPY_CD              = TP.GLBL_CMPY_CD
                        AND B.DS_CONTR_DTL_TP_CD        = TP.DS_CONTR_DTL_TP_CD
                        AND TP.EZCANCELFLAG             = '0'
                        <!-- QC#28403 del
                        AND B.GLBL_CMPY_CD              = C.GLBL_CMPY_CD
                        AND B.DS_CONTR_DTL_PK           = C.DS_CONTR_DTL_PK
                        AND C.EZCANCELFLAG              = '0'
                        -->
                        AND B.GLBL_CMPY_CD              = D.GLBL_CMPY_CD     (+)
                        AND B.SVC_MACH_MSTR_PK          = D.SVC_MACH_MSTR_PK (+)
                        AND D.EZCANCELFLAG(+)           = '0'
                        AND (
                                (
                                    B.DS_CONTR_DTL_TP_CD            = #dsContrDtlTpCdFlt#
                                )
                            OR
                                (
                                    B.DS_CONTR_DTL_TP_CD            = #dsContrDtlTpCdAgg#
                                )
                            OR
                                EXISTS  (
                                    SELECT
                                        *
                                    FROM
                                        DS_CONTR_DTL_TP Z
                                    WHERE
                                            Z.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
                                        AND Z.DS_CONTR_DTL_TP_CD    = B.DS_CONTR_DTL_TP_CD
                                        AND Z.EZCANCELFLAG          = '0'
                                        AND Z.MAIN_UNIT_LINE_FLG    = 'Y'
                                )
                        <isNotNull property="inclAcc">
                            OR
                                (
                                    B.DS_CONTR_DTL_TP_CD            = #dsContrDtlTpCdAcc#
                                )
                        </isNotNull>
                        )
                    <!-- START 2023/05/15 t.aizawa [QC#59398,ADD] -->
                    ) W2
                    ,MDSE MD
                WHERE
                        MD.GLBL_CMPY_CD (+)         = #glblCmpyCd#
                    AND MD.MDSE_CD      (+)         = W2.SVC_PGM_MDSE_CD
                    AND MD.EZCANCELFLAG (+)         = '0'
                <!-- END 2023/05/15 t.aizawa [QC#59398,ADD] -->
                UNION
<!--            QC#28403 mod 1-->
                SELECT
                <!-- QC#28403 -->
                    W.*
                    ,V.DS_CONTR_CTRL_STS_NM             AS STS_NM
                FROM
                    (
                    <!-- QC#28403 -->
                    <!-- Base Charge -->
                    SELECT
                         31                         AS LVL
                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN D.SER_NUM
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN D.SER_NUM
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN D.SER_NUM
                              ELSE DP.SER_NUM
                         END                        AS SER_NUM_SORT_NUM
                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN D.MDSE_CD
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN D.MDSE_CD
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN D.MDSE_CD
                              ELSE DP.MDSE_CD
                         END                        AS MDSE_CD_SORT_NUM
                        ,TP.DS_CONTR_DTL_TP_SORT_NUM  AS DS_CONTR_DTL_TP_SORT_NUM
                        ,NULL                       AS MTR_LB_SORT_NUM
                        ,'2'                        AS DS_CONTR_TRK_TP
                        ,NULL                       AS CONTR_NUM
                        ,B.DS_CONTR_DTL_PK          AS DS_CONTR_DTL_PK
                        ,''                         AS SER_NUM
                        <!-- START 2023/05/15 t.aizawa [QC#59398,ADD] -->
                        ,''                         AS MDSE_DESC_SHORT_TXT
                        <!-- END 2023/05/15 t.aizawa [QC#59398,ADD] -->
                        ,'N'                        AS CHARGE_DISP
                        ,#base#                     AS CHARGE_TP_TXT
                        ,NULL                       AS DS_CONTR_BLLG_MTR_PK
                        ,'N'                        AS EFF_DISP
                        ,NULL                       AS PRC_EFF_SQ_NUM
                        ,'Y'                        AS AUDIT_DISP
                        ,B.CONTR_EFF_FROM_DT        AS FROM_DT
                        ,B.CONTR_EFF_THRU_DT        AS THRU_DT
                        <!-- START 2017/09/07 K.Kim [QC#20761,ADD] -->
                        ,B.CONTR_CLO_DT             AS CLO_DT
                        <!-- END 2017/09/07 K.Kim [QC#20761,ADD] -->
<!--                        ,C.DS_CONTR_CTRL_STS_NM     AS STS_NM   QC#28403 -->
                    FROM
                         DS_CONTR               A
                        ,DS_CONTR_DTL           B
<!--                        ,DS_CONTR_DTL_STS_V     C QC#28403 -->
                        ,SVC_MACH_MSTR          D
                        ,DS_CONTR_DTL           BP
                        ,DS_CONTR_DTL_TP        TP
                        ,SVC_MACH_MSTR          DP
                    WHERE
                            A.GLBL_CMPY_CD              = #glblCmpyCd#
                        AND A.EZCANCELFLAG              = '0'
                        AND A.DS_CONTR_PK               = #dsContrPk#
                        AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
                        AND A.DS_CONTR_PK               = B.DS_CONTR_PK
                        AND B.EZCANCELFLAG              = '0'
                        <isNotNull property="activeLine">
                            AND B.DS_CONTR_DTL_STS_CD       IN
                            <iterate property="dsContrDtlStsCd" var="dsContrDtlStsCd[]"  open="(" close=" )" conjunction=",">
                                #dsContrDtlStsCd[]#
                            </iterate>
                        </isNotNull>
                        AND B.GLBL_CMPY_CD              = BP.GLBL_CMPY_CD     (+)
                        AND B.DS_CONTR_PK               = BP.DS_CONTR_PK      (+)
                        AND B.PRNT_DS_CONTR_DTL_PK      = BP.DS_CONTR_DTL_PK  (+)
                        AND BP.EZCANCELFLAG (+)         = '0'
                        AND BP.GLBL_CMPY_CD             = DP.GLBL_CMPY_CD     (+)
                        AND BP.SVC_MACH_MSTR_PK         = DP.SVC_MACH_MSTR_PK (+)
                        AND DP.EZCANCELFLAG (+)         = '0'
                        AND B.GLBL_CMPY_CD              = TP.GLBL_CMPY_CD
                        AND B.DS_CONTR_DTL_TP_CD        = TP.DS_CONTR_DTL_TP_CD
                        AND TP.EZCANCELFLAG             = '0'
<!--                        AND B.GLBL_CMPY_CD              = C.GLBL_CMPY_CD    QC#28403 -->
<!--                        AND B.DS_CONTR_DTL_PK           = C.DS_CONTR_DTL_PK QC#28403 -->
<!--                        AND C.EZCANCELFLAG              = '0'               QC#28403 -->
                        AND B.GLBL_CMPY_CD              = D.GLBL_CMPY_CD     (+)
                        AND B.SVC_MACH_MSTR_PK          = D.SVC_MACH_MSTR_PK (+)
                        AND D.EZCANCELFLAG(+)           = '0'
                        AND (
                                (
                                    B.DS_CONTR_DTL_TP_CD            = #dsContrDtlTpCdFlt#
                                )
                            OR
                                (
                                    B.DS_CONTR_DTL_TP_CD            = #dsContrDtlTpCdAgg#
                                )
                            OR
                                EXISTS  (
                                    SELECT
                                        *
                                    FROM
                                        DS_CONTR_DTL_TP Z
                                    WHERE
                                            Z.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
                                        AND Z.DS_CONTR_DTL_TP_CD    = B.DS_CONTR_DTL_TP_CD
                                        AND Z.EZCANCELFLAG          = '0'
                                        AND Z.MAIN_UNIT_LINE_FLG    = 'Y'
                                )
                        )
                    <!-- Usage Charge -->
                    UNION
                    SELECT
                         32                                 AS LVL
                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN F.SER_NUM
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN F.SER_NUM
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN F.SER_NUM
                              ELSE FP.SER_NUM
                         END                                AS SER_NUM_SORT_NUM
                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN F.MDSE_CD
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN F.MDSE_CD
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN F.MDSE_CD
                              ELSE FP.MDSE_CD
                         END                                AS MDSE_CD_SORT_NUM
                        ,TP.DS_CONTR_DTL_TP_SORT_NUM        AS DS_CONTR_DTL_TP_SORT_NUM
                        ,E.MTR_LB_SORT_NUM                  AS MTR_LB_SORT_NUM
                        ,'3'                                AS DS_CONTR_TRK_TP
                        ,''                                 AS CONTR_NUM
                        ,B.DS_CONTR_DTL_PK                  AS DS_CONTR_DTL_PK
                        ,''                                 AS SER_NUM
                        <!-- START 2023/05/15 t.aizawa [QC#59398,ADD] -->
                        ,''                                 AS MDSE_DESC_SHORT_TXT
                        <!-- END 2023/05/15 t.aizawa [QC#59398,ADD] -->
                        ,'N'                                AS CHARGE_DISP
                        ,#overage# || E.MTR_LB_DESC_TXT     AS CHARGE_TP_TXT
                        ,C.DS_CONTR_BLLG_MTR_PK             AS DS_CONTR_BLLG_MTR_PK
                        ,'N'                                AS EFF_DISP
                        ,NULL                               AS PRC_EFF_SQ_NUM
                        ,'Y'                                AS AUDIT_DISP
                        ,B.CONTR_EFF_FROM_DT                AS FROM_DT
                        ,B.CONTR_EFF_THRU_DT                AS THRU_DT
                        <!-- START 2017/09/07 K.Kim [QC#20761,ADD] -->
                        ,B.CONTR_CLO_DT                     AS CLO_DT
                        <!-- END 2017/09/07 K.Kim [QC#20761,ADD] -->
<!--                        ,D.DS_CONTR_CTRL_STS_NM             AS STS_NM QC#28403 -->
                    FROM
                         DS_CONTR                   A
                        ,DS_CONTR_DTL               B
                        ,DS_CONTR_BLLG_MTR          C
<!--                        ,DS_CONTR_DTL_STS_V         D   QC#28403 -->
                        ,MTR_LB                     E
                        ,SVC_MACH_MSTR              F
                        ,DS_CONTR_DTL               BP
                        ,DS_CONTR_DTL_TP            TP
                        ,SVC_MACH_MSTR              FP
                    WHERE
                            A.GLBL_CMPY_CD              = #glblCmpyCd#
                        AND A.EZCANCELFLAG              = '0'
                        AND A.DS_CONTR_PK               = #dsContrPk#
                        AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
                        AND A.DS_CONTR_PK               = B.DS_CONTR_PK
                        <isNotNull property="activeLine">
                            AND B.DS_CONTR_DTL_STS_CD       IN
                            <iterate property="dsContrDtlStsCd" var="dsContrDtlStsCd[]"  open="(" close=" )" conjunction=",">
                                #dsContrDtlStsCd[]#
                           </iterate>
                        </isNotNull>
                        AND B.EZCANCELFLAG              = '0'
                        AND B.GLBL_CMPY_CD              = BP.GLBL_CMPY_CD     (+)
                        AND B.DS_CONTR_PK               = BP.DS_CONTR_PK      (+)
                        AND B.PRNT_DS_CONTR_DTL_PK      = BP.DS_CONTR_DTL_PK  (+)
                        AND BP.EZCANCELFLAG (+)         = '0'
                        AND BP.GLBL_CMPY_CD             = FP.GLBL_CMPY_CD     (+)
                        AND BP.SVC_MACH_MSTR_PK         = FP.SVC_MACH_MSTR_PK (+)
                        AND FP.EZCANCELFLAG (+)         = '0'
                        AND B.GLBL_CMPY_CD              = TP.GLBL_CMPY_CD
                        AND B.DS_CONTR_DTL_TP_CD        = TP.DS_CONTR_DTL_TP_CD
                        AND TP.EZCANCELFLAG             = '0'
                        AND B.GLBL_CMPY_CD              = C.GLBL_CMPY_CD
                        AND B.DS_CONTR_DTL_PK           = C.DS_CONTR_DTL_PK
                        AND C.EZCANCELFLAG              = '0'
<!--                        AND B.GLBL_CMPY_CD              = D.GLBL_CMPY_CD    QC#28403 -->
<!--                        AND B.DS_CONTR_DTL_PK           = D.DS_CONTR_DTL_PK QC#28403 -->
<!--                        AND D.EZCANCELFLAG              = '0'               QC#28403 -->
                        AND C.GLBL_CMPY_CD              = E.GLBL_CMPY_CD
                        AND C.BLLG_MTR_LB_CD            = E.MTR_LB_CD
                        AND E.EZCANCELFLAG              = '0'
                        AND B.GLBL_CMPY_CD              = F.GLBL_CMPY_CD     (+)
                        AND B.SVC_MACH_MSTR_PK          = F.SVC_MACH_MSTR_PK (+)
                        AND F.EZCANCELFLAG (+)          = '0'
                        AND (
                                (
                                    B.DS_CONTR_DTL_TP_CD            = #dsContrDtlTpCdFlt#
                                )
                            OR
                                (
                                    B.DS_CONTR_DTL_TP_CD            = #dsContrDtlTpCdAgg#
                                )
                            OR
                                EXISTS  (
                                    SELECT
                                        *
                                    FROM
                                        DS_CONTR_DTL_TP Z
                                    WHERE
                                            Z.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
                                        AND Z.DS_CONTR_DTL_TP_CD    = B.DS_CONTR_DTL_TP_CD
                                        AND Z.EZCANCELFLAG          = '0'
                                        AND Z.MAIN_UNIT_LINE_FLG    = 'Y'
                                )
                        )
                    <!-- START 2023/05/15 t.aizawa [QC#59398,ADD] -->
                    <isNotNull property="inclAcc">
                    UNION
                    SELECT
                         33                                 AS LVL
                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN E.SER_NUM
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN E.SER_NUM
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN E.SER_NUM
                              ELSE EP.SER_NUM
                         END                                AS SER_NUM_SORT_NUM
                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN E.MDSE_CD
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN E.MDSE_CD
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN E.MDSE_CD
                              ELSE EP.MDSE_CD
                         END                                AS MDSE_CD_SORT_NUM
                        ,TP.DS_CONTR_DTL_TP_SORT_NUM        AS DS_CONTR_DTL_TP_SORT_NUM
                        ,NULL                               AS MTR_LB_SORT_NUM
                        ,'2'                                AS DS_CONTR_TRK_TP
                        ,''                                 AS CONTR_NUM
                        ,B.DS_CONTR_DTL_PK                  AS DS_CONTR_DTL_PK
                        ,''                                 AS SER_NUM
                        ,''                                 AS MDSE_DESC_SHORT_TXT
                        ,'N'                                AS CHARGE_DISP
                        ,#base#                             AS CHARGE_TP_TXT
                        ,NULL                               AS DS_CONTR_BLLG_MTR_PK
                        ,'N'                                AS EFF_DISP
                        ,NULL                               AS PRC_EFF_SQ_NUM
                        ,'Y'                                AS AUDIT_DISP
                        ,B.CONTR_EFF_FROM_DT                AS FROM_DT
                        ,B.CONTR_EFF_THRU_DT                AS THRU_DT
                        ,B.CONTR_CLO_DT                     AS CLO_DT
                    FROM
                         DS_CONTR                   A
                        ,DS_CONTR_DTL               B
                        ,SVC_MACH_MSTR              E
                        ,DS_CONTR_DTL               BP
                        ,DS_CONTR_DTL_TP            TP
                        ,SVC_MACH_MSTR              EP
                    WHERE
                            A.GLBL_CMPY_CD              = #glblCmpyCd#
                        AND A.EZCANCELFLAG              = '0'
                        AND A.DS_CONTR_PK               = #dsContrPk#
                        AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
                        AND A.DS_CONTR_PK               = B.DS_CONTR_PK
                        AND B.DS_CONTR_DTL_TP_CD        = #dsContrDtlTpCdAcc#
                        <isNotNull property="activeLine">
                            AND B.DS_CONTR_DTL_STS_CD       IN
                            <iterate property="dsContrDtlStsCd" var="dsContrDtlStsCd[]"  open="(" close=" )" conjunction=",">
                                #dsContrDtlStsCd[]#
                           </iterate>
                        </isNotNull>
                        AND B.EZCANCELFLAG              = '0'
                        AND B.GLBL_CMPY_CD              = BP.GLBL_CMPY_CD     (+)
                        AND B.DS_CONTR_PK               = BP.DS_CONTR_PK      (+)
                        AND B.PRNT_DS_CONTR_DTL_PK      = BP.DS_CONTR_DTL_PK  (+)
                        AND BP.EZCANCELFLAG (+)         = '0'
                        AND BP.GLBL_CMPY_CD             = EP.GLBL_CMPY_CD     (+)
                        AND BP.SVC_MACH_MSTR_PK         = EP.SVC_MACH_MSTR_PK (+)
                        AND EP.EZCANCELFLAG (+)         = '0'
                        AND B.GLBL_CMPY_CD              = TP.GLBL_CMPY_CD
                        AND B.DS_CONTR_DTL_TP_CD        = TP.DS_CONTR_DTL_TP_CD
                        AND TP.EZCANCELFLAG             = '0'
                        AND B.GLBL_CMPY_CD              = E.GLBL_CMPY_CD     (+)
                        AND B.SVC_MACH_MSTR_PK          = E.SVC_MACH_MSTR_PK (+)
                        AND E.EZCANCELFLAG (+)          = '0'
                    </isNotNull>
                    <!-- END 2023/05/15 t.aizawa [QC#59398,ADD] -->
                    <!-- QC#28403 -->
                    )   W
                    , DS_CONTR_DTL_STS_V     V
                WHERE
                        V.GLBL_CMPY_CD                  = #glblCmpyCd#
                    AND V.DS_CONTR_DTL_PK               = W.DS_CONTR_DTL_PK
                    AND V.EZCANCELFLAG                  = '0'
                    <!-- QC#28403 -->
<!--            QC#28403 mod 1 -->
                UNION
<!--            QC#28403 mod 2 -->
                SELECT
                     W.LVL
                    ,W.SER_NUM_SORT_NUM
                    ,W.MDSE_CD_SORT_NUM
                    ,W.DS_CONTR_DTL_TP_SORT_NUM
                    ,W.MTR_LB_SORT_NUM
                    ,W.DS_CONTR_TRK_TP
                    ,W.CONTR_NUM
                    ,W.DS_CONTR_DTL_PK
                    ,W.SER_NUM
                    <!-- START 2023/05/15 t.aizawa [QC#59398,ADD] -->
                    ,''                                 AS MDSE_DESC_SHORT_TXT
                    <!-- END 2023/05/15 t.aizawa [QC#59398,ADD] -->
                    ,W.CHARGE_DISP
                    ,W.CHARGE_TP_TXT
                    ,W.DS_CONTR_BLLG_MTR_PK
                    ,W.EFF_DISP
                    ,W.PRC_EFF_SQ_NUM
                    ,W.AUDIT_DISP
                    ,W.FROM_DT
                    ,W.THRU_DT
                    ,W.CLO_DT
                    ,V.DS_CONTR_CTRL_STS_NM             AS STS_NM
                FROM
                    (
                    <!-- Price Effectivity for Base Charge -->
                    SELECT
                         41                                 AS LVL
                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN E.SER_NUM
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN E.SER_NUM
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN E.SER_NUM
                              ELSE EP.SER_NUM
                         END                                AS SER_NUM_SORT_NUM
                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN E.MDSE_CD
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN E.MDSE_CD
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN E.MDSE_CD
                              ELSE EP.MDSE_CD
                         END                                AS MDSE_CD_SORT_NUM
                        ,TP.DS_CONTR_DTL_TP_SORT_NUM        AS DS_CONTR_DTL_TP_SORT_NUM
                        ,NULL                               AS MTR_LB_SORT_NUM
                        ,'4'                                AS DS_CONTR_TRK_TP
                        ,''                                 AS CONTR_NUM
                        ,B.DS_CONTR_DTL_PK                  AS DS_CONTR_DTL_PK
                        ,''                                 AS SER_NUM
                        ,'N'                                AS CHARGE_DISP
                        ,NULL                               AS CHARGE_TP_TXT
                        ,NULL                               AS DS_CONTR_BLLG_MTR_PK
                        ,'N'                                AS EFF_DISP
                        ,C.DS_CONTR_PRC_EFF_SQ_NUM          AS PRC_EFF_SQ_NUM
                        ,'Y'                                AS AUDIT_DISP
                        ,C.CONTR_PRC_EFF_FROM_DT            AS FROM_DT
                        ,C.CONTR_PRC_EFF_THRU_DT            AS THRU_DT
                        <!-- START 2017/09/07 K.Kim [QC#20761,ADD] -->
                        ,NULL                               AS CLO_DT
                        <!-- END 2017/09/07 K.Kim [QC#20761,ADD] -->
<!--                        ,D.DS_CONTR_CTRL_STS_NM             AS STS_NM   QC#28403 -->
                        ,C.DS_CONTR_PRC_EFF_PK  <!-- QC#28403 -->
                    FROM
                         DS_CONTR                   A
                        ,DS_CONTR_DTL               B
                        ,DS_CONTR_PRC_EFF           C
<!--                        ,DS_CONTR_PRC_EFF_STS_V     D   QC#28403 -->
                        ,SVC_MACH_MSTR              E
                        ,DS_CONTR_DTL               BP
                        ,DS_CONTR_DTL_TP            TP
                        ,SVC_MACH_MSTR              EP
                    WHERE
                            A.GLBL_CMPY_CD              = #glblCmpyCd#
                        AND A.EZCANCELFLAG              = '0'
                        AND A.DS_CONTR_PK               = #dsContrPk#
                        AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
                        AND A.DS_CONTR_PK               = B.DS_CONTR_PK
                        <isNotNull property="activeLine">
                            AND B.DS_CONTR_DTL_STS_CD       IN
                            <iterate property="dsContrDtlStsCd" var="dsContrDtlStsCd[]"  open="(" close=" )" conjunction=",">
                                #dsContrDtlStsCd[]#
                            </iterate>
                        </isNotNull>
                        AND B.EZCANCELFLAG              = '0'
                        AND B.GLBL_CMPY_CD              = BP.GLBL_CMPY_CD     (+)
                        AND B.DS_CONTR_PK               = BP.DS_CONTR_PK      (+)
                        AND B.PRNT_DS_CONTR_DTL_PK      = BP.DS_CONTR_DTL_PK  (+)
                        AND BP.EZCANCELFLAG (+)         = '0'
                        AND BP.GLBL_CMPY_CD             = EP.GLBL_CMPY_CD     (+)
                        AND BP.SVC_MACH_MSTR_PK         = EP.SVC_MACH_MSTR_PK (+)
                        AND EP.EZCANCELFLAG (+)         = '0'
                        AND B.GLBL_CMPY_CD              = TP.GLBL_CMPY_CD
                        AND B.DS_CONTR_DTL_TP_CD        = TP.DS_CONTR_DTL_TP_CD
                        AND TP.EZCANCELFLAG             = '0'
                        AND B.GLBL_CMPY_CD              = C.GLBL_CMPY_CD
                        AND B.DS_CONTR_DTL_PK           = C.DS_CONTR_DTL_PK
                        AND C.BASE_CHRG_FLG             = 'Y'
                        AND C.EZCANCELFLAG              = '0'
<!--                        AND C.GLBL_CMPY_CD              = D.GLBL_CMPY_CD        QC#28403 -->
<!--                        AND C.DS_CONTR_PRC_EFF_PK       = D.DS_CONTR_PRC_EFF_PK QC#28403 -->
<!--                        AND D.EZCANCELFLAG              = '0'                   QC#28403 -->
                        AND B.GLBL_CMPY_CD              = E.GLBL_CMPY_CD      (+)
                        AND B.SVC_MACH_MSTR_PK          = E.SVC_MACH_MSTR_PK  (+)
                        AND E.EZCANCELFLAG (+)          = '0'
                        AND (
                                (
                                    B.DS_CONTR_DTL_TP_CD            = #dsContrDtlTpCdFlt#
                                )
                            OR
                                (
                                    B.DS_CONTR_DTL_TP_CD            = #dsContrDtlTpCdAgg#
                                )
                            OR
                                EXISTS  (
                                    SELECT
                                        *
                                    FROM
                                        DS_CONTR_DTL_TP Z
                                    WHERE
                                            Z.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
                                        AND Z.DS_CONTR_DTL_TP_CD    = B.DS_CONTR_DTL_TP_CD
                                        AND Z.EZCANCELFLAG          = '0'
                                        AND Z.MAIN_UNIT_LINE_FLG    = 'Y'
                                )
                        )
                    <!-- Price Effectivity for Usage Charge -->
                    UNION
                    SELECT
                         42                         AS LVL
                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN F.SER_NUM
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN F.SER_NUM
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN F.SER_NUM
                              ELSE FP.SER_NUM
                         END                        AS SER_NUM_SORT_NUM
                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN F.MDSE_CD
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN F.MDSE_CD
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN F.MDSE_CD
                              ELSE FP.MDSE_CD
                         END                        AS MDSE_CD_SORT_NUM
                        ,TP.DS_CONTR_DTL_TP_SORT_NUM  AS DS_CONTR_DTL_TP_SORT_NUM
                        ,G.MTR_LB_SORT_NUM          AS MTR_LB_SORT_NUM
                        ,'5'                        AS DS_CONTR_TRK_TP
                        ,''                         AS CONTR_NUM
                        ,B.DS_CONTR_DTL_PK          AS DS_CONTR_DTL_PK
                        ,''                         AS SER_NUM
                        ,'N'                        AS CHARGE_DISP
                        ,''                         AS CHARGE_TP_TXT
                        ,C.DS_CONTR_BLLG_MTR_PK     AS DS_CONTR_BLLG_MTR_PK
                        ,'N'                        AS EFF_DISP
                        ,D.DS_CONTR_PRC_EFF_SQ_NUM  AS PRC_EFF_SQ_NUM
                        ,'Y'                        AS AUDIT_DISP
                        ,D.CONTR_PRC_EFF_FROM_DT    AS FROM_DT
                        ,D.CONTR_PRC_EFF_THRU_DT    AS THRU_DT
                        <!-- START 2017/09/07 K.Kim [QC#20761,ADD] -->
                        ,NULL                       AS CLO_DT
                        <!-- END 2017/09/07 K.Kim [QC#20761,ADD] -->
<!--                        ,E.DS_CONTR_CTRL_STS_NM     AS STS_NM   QC#28403 -->
                        ,D.DS_CONTR_PRC_EFF_PK  <!-- QC#28403 -->
                    FROM
                         DS_CONTR                   A
                        ,DS_CONTR_DTL               B
                        ,DS_CONTR_BLLG_MTR          C
                        ,DS_CONTR_PRC_EFF           D
<!--                        ,DS_CONTR_PRC_EFF_STS_V     E   QC#28403 -->
                        ,SVC_MACH_MSTR              F
                        ,MTR_LB                     G
                        ,DS_CONTR_DTL               BP
                        ,DS_CONTR_DTL_TP            TP
                        ,SVC_MACH_MSTR              FP
                    WHERE
                            A.GLBL_CMPY_CD              = #glblCmpyCd#
                        AND A.EZCANCELFLAG              = '0'
                        AND A.DS_CONTR_PK               = #dsContrPk#
                        AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
                        AND A.DS_CONTR_PK               = B.DS_CONTR_PK
                        AND B.EZCANCELFLAG              = '0'
                        AND B.GLBL_CMPY_CD              = BP.GLBL_CMPY_CD     (+)
                        AND B.DS_CONTR_PK               = BP.DS_CONTR_PK      (+)
                        AND B.PRNT_DS_CONTR_DTL_PK      = BP.DS_CONTR_DTL_PK  (+)
                        AND BP.EZCANCELFLAG (+)         = '0'
                        AND BP.GLBL_CMPY_CD             = FP.GLBL_CMPY_CD     (+)
                        AND BP.SVC_MACH_MSTR_PK         = FP.SVC_MACH_MSTR_PK (+)
                        AND FP.EZCANCELFLAG (+)         = '0'
                        AND B.GLBL_CMPY_CD              = TP.GLBL_CMPY_CD
                        AND B.DS_CONTR_DTL_TP_CD        = TP.DS_CONTR_DTL_TP_CD
                        AND TP.EZCANCELFLAG             = '0'
                        AND B.GLBL_CMPY_CD              = C.GLBL_CMPY_CD
                        AND B.DS_CONTR_DTL_PK           = C.DS_CONTR_DTL_PK
                        AND C.EZCANCELFLAG              = '0'
                        AND C.GLBL_CMPY_CD              = D.GLBL_CMPY_CD
                        AND C.DS_CONTR_DTL_PK           = D.DS_CONTR_DTL_PK
                        AND C.DS_CONTR_BLLG_MTR_PK      = D.DS_CONTR_BLLG_MTR_PK
                        <isNotNull property="activeLine">
                            <!-- START 2023/05/15 t.aizawa [QC#59398,DEL] -->
<!--                            AND D.DS_CONTR_PRC_EFF_STS_CD       IN-->
                            <!-- END 2023/05/15 t.aizawa [QC#59398,DEL] -->
                            <!-- START 2023/05/15 t.aizawa [QC#59398,ADD] -->
                            AND B.DS_CONTR_DTL_STS_CD       IN
                            <!-- END 2023/05/15 t.aizawa [QC#59398,ADD] -->
                            <iterate property="dsContrDtlStsCd" var="dsContrDtlStsCd[]"  open="(" close=" )" conjunction=",">
                                #dsContrDtlStsCd[]#
                            </iterate>
                        </isNotNull>
                        AND D.EZCANCELFLAG              = '0'
<!--                        AND D.GLBL_CMPY_CD              = E.GLBL_CMPY_CD        QC#28403 -->
<!--                        AND D.DS_CONTR_PRC_EFF_PK       = E.DS_CONTR_PRC_EFF_PK QC#28403 -->
<!--                        AND E.EZCANCELFLAG              = '0'                   QC#28403 -->
                        AND B.GLBL_CMPY_CD              = F.GLBL_CMPY_CD     (+)
                        AND B.SVC_MACH_MSTR_PK          = F.SVC_MACH_MSTR_PK (+)
                        AND F.EZCANCELFLAG (+)          = '0'
                        AND C.GLBL_CMPY_CD              = G.GLBL_CMPY_CD     (+)
                        AND C.BLLG_MTR_LB_CD            = G.MTR_LB_CD        (+)
                        AND G.EZCANCELFLAG (+)          = '0'
                    <isNotNull property="inclAcc">
                    <!-- START 2023/05/15 t.aizawa [QC#59398,DEL] -->
                    <!-- Accessory -->
<!--                    UNION-->
<!--                    SELECT-->
<!--                         33                                 AS LVL-->
<!--                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN E.SER_NUM-->
<!--                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN E.SER_NUM-->
<!--                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN E.SER_NUM-->
<!--                              ELSE EP.SER_NUM-->
<!--                         END                                AS SER_NUM_SORT_NUM-->
<!--                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN E.MDSE_CD-->
<!--                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN E.MDSE_CD-->
<!--                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN E.MDSE_CD-->
<!--                              ELSE EP.MDSE_CD-->
<!--                         END                                AS MDSE_CD_SORT_NUM-->
<!--                        ,TP.DS_CONTR_DTL_TP_SORT_NUM        AS DS_CONTR_DTL_TP_SORT_NUM-->
<!--                        ,NULL                               AS MTR_LB_SORT_NUM-->
<!--                        ,'2'                                AS DS_CONTR_TRK_TP-->
<!--                        ,''                                 AS CONTR_NUM-->
<!--                        ,B.DS_CONTR_DTL_PK                  AS DS_CONTR_DTL_PK-->
<!--                        ,''                                 AS SER_NUM-->
<!--                        ,'N'                                AS CHARGE_DISP-->
<!--                        ,#base#                             AS CHARGE_TP_TXT-->
<!--                        ,NULL                               AS DS_CONTR_BLLG_MTR_PK-->
<!--                        ,'N'                                AS EFF_DISP-->
<!--                        ,NULL                               AS PRC_EFF_SQ_NUM-->
<!--                        ,'Y'                                AS AUDIT_DISP-->
<!--                        ,B.CONTR_EFF_FROM_DT                AS FROM_DT-->
<!--                        ,B.CONTR_EFF_THRU_DT                AS THRU_DT-->
                        <!-- START 2017/09/07 K.Kim [QC#20761,ADD] -->
<!--                        ,B.CONTR_CLO_DT                     AS CLO_DT-->
                        <!-- END 2017/09/07 K.Kim [QC#20761,ADD] -->
<!--                        ,D.DS_CONTR_CTRL_STS_NM             AS STS_NM   QC#28403 -->
<!--                        ,C.DS_CONTR_PRC_EFF_PK   QC#28403 -->
<!--                    FROM-->
<!--                         DS_CONTR                   A-->
<!--                        ,DS_CONTR_DTL               B-->
<!--                        ,DS_CONTR_PRC_EFF           C-->
<!--                        ,DS_CONTR_PRC_EFF_STS_V     D   QC#28403 -->
<!--                        ,SVC_MACH_MSTR              E-->
<!--                        ,DS_CONTR_DTL               BP-->
<!--                        ,DS_CONTR_DTL_TP            TP-->
<!--                        ,SVC_MACH_MSTR              EP-->
<!--                    WHERE-->
<!--                            A.GLBL_CMPY_CD              = #glblCmpyCd#-->
<!--                        AND A.EZCANCELFLAG              = '0'-->
<!--                        AND A.DS_CONTR_PK               = #dsContrPk#-->
<!--                        AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD-->
<!--                        AND A.DS_CONTR_PK               = B.DS_CONTR_PK-->
<!--                        AND B.DS_CONTR_DTL_TP_CD        = #dsContrDtlTpCdAcc#-->
<!--                        <isNotNull property="activeLine">-->
<!--                            AND B.DS_CONTR_DTL_STS_CD       IN-->
<!--                            <iterate property="dsContrDtlStsCd" var="dsContrDtlStsCd[]"  open="(" close=" )" conjunction=",">-->
<!--                                #dsContrDtlStsCd[]#-->
<!--                           </iterate>-->
<!--                        </isNotNull>-->
<!--                        AND B.EZCANCELFLAG              = '0'-->
<!--                        AND B.GLBL_CMPY_CD              = BP.GLBL_CMPY_CD     (+)-->
<!--                        AND B.DS_CONTR_PK               = BP.DS_CONTR_PK      (+)-->
<!--                        AND B.PRNT_DS_CONTR_DTL_PK      = BP.DS_CONTR_DTL_PK  (+)-->
<!--                        AND BP.EZCANCELFLAG (+)         = '0'-->
<!--                        AND BP.GLBL_CMPY_CD             = EP.GLBL_CMPY_CD     (+)-->
<!--                        AND BP.SVC_MACH_MSTR_PK         = EP.SVC_MACH_MSTR_PK (+)-->
<!--                        AND EP.EZCANCELFLAG (+)         = '0'-->
<!--                        AND B.GLBL_CMPY_CD              = TP.GLBL_CMPY_CD-->
<!--                        AND B.DS_CONTR_DTL_TP_CD        = TP.DS_CONTR_DTL_TP_CD-->
<!--                        AND TP.EZCANCELFLAG             = '0'-->
<!--                        AND B.GLBL_CMPY_CD              = C.GLBL_CMPY_CD-->
<!--                        AND B.DS_CONTR_DTL_PK           = C.DS_CONTR_DTL_PK-->
<!--                        AND C.BASE_CHRG_FLG             = 'Y'-->
<!--                        AND C.EZCANCELFLAG              = '0'-->
<!--                        AND C.GLBL_CMPY_CD              = D.GLBL_CMPY_CD        QC#28403 -->
<!--                        AND C.DS_CONTR_PRC_EFF_PK       = D.DS_CONTR_PRC_EFF_PK QC#28403 -->
<!--                        AND D.EZCANCELFLAG              = '0'                   QC#28403 -->
<!--                        AND B.GLBL_CMPY_CD              = E.GLBL_CMPY_CD     (+)-->
<!--                        AND B.SVC_MACH_MSTR_PK          = E.SVC_MACH_MSTR_PK (+)-->
<!--                        AND E.EZCANCELFLAG (+)          = '0'-->
                    <!-- END 2023/05/15 t.aizawa [QC#59398,DEL] -->
                    <!-- Price Effectivity for Accessory -->
                    UNION
                    SELECT
                         43                                 AS LVL
                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN E.SER_NUM
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN E.SER_NUM
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN E.SER_NUM
                              ELSE EP.SER_NUM
                         END                                AS SER_NUM_SORT_NUM
                        ,CASE WHEN BP.DS_CONTR_DTL_PK IS NULL       THEN E.MDSE_CD
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdFlt#  THEN E.MDSE_CD
                              WHEN BP.DS_CONTR_DTL_TP_CD = #dsContrDtlTpCdAgg#  THEN E.MDSE_CD
                              ELSE EP.MDSE_CD
                         END                                AS MDSE_CD_SORT_NUM
                        ,TP.DS_CONTR_DTL_TP_SORT_NUM        AS DS_CONTR_DTL_TP_SORT_NUM
                        ,NULL                               AS MTR_LB_SORT_NUM
                        ,'4'                                AS DS_CONTR_TRK_TP
                        ,''                                 AS CONTR_NUM
                        ,B.DS_CONTR_DTL_PK                  AS DS_CONTR_DTL_PK
                        ,''                                 AS SER_NUM
                        ,'N'                                AS CHARGE_DISP
                        ,NULL                               AS CHARGE_TP_TXT
                        ,NULL                               AS DS_CONTR_BLLG_MTR_PK
                        ,'N'                                AS EFF_DISP
                        ,C.DS_CONTR_PRC_EFF_SQ_NUM          AS PRC_EFF_SQ_NUM
                        ,'Y'                                AS AUDIT_DISP
                        ,C.CONTR_PRC_EFF_FROM_DT            AS FROM_DT
                        ,C.CONTR_PRC_EFF_THRU_DT            AS THRU_DT
                        <!-- START 2017/09/07 K.Kim [QC#20761,ADD] -->
                        ,NULL                               AS CLO_DT
                        <!-- END 2017/09/07 K.Kim [QC#20761,ADD] -->
<!--                        ,D.DS_CONTR_CTRL_STS_NM             AS STS_NM   QC#28403 -->
                        ,C.DS_CONTR_PRC_EFF_PK  <!-- QC#28403 -->
                    FROM
                         DS_CONTR                   A
                        ,DS_CONTR_DTL               B
                        ,DS_CONTR_PRC_EFF           C
<!--                        ,DS_CONTR_PRC_EFF_STS_V     D   QC#28403 -->
                        ,SVC_MACH_MSTR              E
                        ,DS_CONTR_DTL               BP
                        ,DS_CONTR_DTL_TP            TP
                        ,SVC_MACH_MSTR              EP
                    WHERE
                            A.GLBL_CMPY_CD              = #glblCmpyCd#
                        AND A.EZCANCELFLAG              = '0'
                        AND A.DS_CONTR_PK               = #dsContrPk#
                        AND A.GLBL_CMPY_CD              = B.GLBL_CMPY_CD
                        AND A.DS_CONTR_PK               = B.DS_CONTR_PK
                        <isNotNull property="activeLine">
                            AND B.DS_CONTR_DTL_STS_CD       IN
                            <iterate property="dsContrDtlStsCd" var="dsContrDtlStsCd[]"  open="(" close=" )" conjunction=",">
                                #dsContrDtlStsCd[]#
                            </iterate>
                        </isNotNull>
                        AND B.EZCANCELFLAG              = '0'
                        AND B.DS_CONTR_DTL_TP_CD        = #dsContrDtlTpCdAcc#
                        AND B.GLBL_CMPY_CD              = BP.GLBL_CMPY_CD     (+)
                        AND B.DS_CONTR_PK               = BP.DS_CONTR_PK      (+)
                        AND B.PRNT_DS_CONTR_DTL_PK      = BP.DS_CONTR_DTL_PK  (+)
                        AND BP.EZCANCELFLAG (+)         = '0'
                        AND BP.GLBL_CMPY_CD             = EP.GLBL_CMPY_CD     (+)
                        AND BP.SVC_MACH_MSTR_PK         = EP.SVC_MACH_MSTR_PK (+)
                        AND EP.EZCANCELFLAG (+)         = '0'
                        AND B.GLBL_CMPY_CD              = TP.GLBL_CMPY_CD
                        AND B.DS_CONTR_DTL_TP_CD        = TP.DS_CONTR_DTL_TP_CD
                        AND TP.EZCANCELFLAG             = '0'
                        AND B.GLBL_CMPY_CD              = C.GLBL_CMPY_CD
                        AND B.DS_CONTR_DTL_PK           = C.DS_CONTR_DTL_PK
                        AND C.BASE_CHRG_FLG             = 'Y'
                        AND C.EZCANCELFLAG              = '0'
<!--                        AND C.GLBL_CMPY_CD              = D.GLBL_CMPY_CD        QC#28403 -->
<!--                        AND C.DS_CONTR_PRC_EFF_PK       = D.DS_CONTR_PRC_EFF_PK QC#28403 -->
<!--                        AND D.EZCANCELFLAG              = '0'                   QC#28403 -->
                        AND B.GLBL_CMPY_CD              = E.GLBL_CMPY_CD      (+)
                        AND B.SVC_MACH_MSTR_PK          = E.SVC_MACH_MSTR_PK  (+)
                        AND E.EZCANCELFLAG (+)          = '0'
                    </isNotNull>
                    <!-- QC#28403 -->
                    )   W
                    , DS_CONTR_PRC_EFF_STS_V     V
                WHERE
                        V.GLBL_CMPY_CD              = #glblCmpyCd#
                    AND V.DS_CONTR_PRC_EFF_PK       = W.DS_CONTR_PRC_EFF_PK
                    AND V.EZCANCELFLAG              = '0'
                <!-- QC#28403 -->
<!--            QC#28403 mod 2 -->
                )
            ORDER BY
                 SER_NUM_SORT_NUM           NULLS FIRST
                ,MDSE_CD_SORT_NUM           NULLS FIRST
                ,DS_CONTR_DTL_TP_SORT_NUM   NULLS FIRST
                ,MTR_LB_SORT_NUM            NULLS FIRST
                <!-- START 2023/05/15 t.aizawa [QC#59398,ADD] -->
                ,DS_CONTR_DTL_PK            NULLS FIRST
                ,DS_CONTR_BLLG_MTR_PK       NULLS FIRST
                <!-- END 2023/05/15 t.aizawa [QC#59398,ADD] -->
                ,PRC_EFF_SQ_NUM             NULLS FIRST
            )
        WHERE
            ROWNUM &lt; #maxCnt#
    </statement>
</sqlMap>
