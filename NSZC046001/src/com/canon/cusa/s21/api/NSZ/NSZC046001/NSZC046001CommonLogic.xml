<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSZC046001CommonLogic">
    <statement id="getBllgMtrLvl" parameterClass="Map" resultClass="String">
        SELECT
            BMM.BLLG_MTR_MAP_LVL_NUM
        FROM
            BLLG_MTR_MAP BMM
        WHERE
            BMM.GLBL_CMPY_CD                  =  #glblCmpyCd#
        AND BMM.EZCANCELFLAG                  =  '0'
        AND BMM.ACTV_FLG                      =  'Y'
        AND BMM.BLLG_MTR_LB_CD                =  #bllgMtrLbCd#
        AND BMM.EFF_FROM_DT               &lt;= #slsDt#
        AND NVL(BMM.EFF_THRU_DT, #endDt#) &gt;= #slsDt#
        AND EXISTS (
            SELECT
                *
            FROM
                SVC_PHYS_MTR SPM
            WHERE
                SPM.GLBL_CMPY_CD    = BMM.GLBL_CMPY_CD
            AND SPM.MDL_MTR_LB_CD   = BMM.MDL_MTR_LB_CD
            AND SPM.MTR_GRP_PK      = BMM.MTR_GRP_PK
            AND SPM.EZCANCELFLAG    = '0'
            AND SPM.SVC_PHYS_MTR_PK = #svcPhysMtrPk#
        )

    </statement>
<!-- add start 2016/09/02 CSA Defect#11243 -->
    <statement id="getCcRefNumCntForHeader" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(CC.DS_CR_CARD_PK)      AS COUNT
        FROM
            DS_CONTR        DC
           ,BILL_TO_CUST    BC
           ,DS_CR_CARD      CC
        WHERE
                DC.GLBL_CMPY_CD          = #glblCmpyCd#
            AND DC.DS_CONTR_PK           = #dsContrPk#
            AND DC.EZCANCELFLAG          = '0'
            AND DC.GLBL_CMPY_CD          = BC.GLBL_CMPY_CD
            AND DC.ALT_PAYER_CUST_CD     = BC.BILL_TO_CUST_CD
            AND BC.EZCANCELFLAG          = '0'
            AND BC.GLBL_CMPY_CD          = CC.GLBL_CMPY_CD
            AND BC.SELL_TO_CUST_CD       = CC.SELL_TO_CUST_CD
            AND CC.EZCANCELFLAG          = '0'
            AND CC.CR_CARD_CUST_REF_NUM  = #crCardCustRefNum#
            AND CC.CR_CARD_VALID_FLG     = 'Y'
    </statement>
    <statement id="getCcRefNumCntForDetail" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(CC.DS_CR_CARD_PK)      AS COUNT
        FROM
            DS_CONTR_DTL    DCD
           ,BILL_TO_CUST    BC
           ,DS_CR_CARD      CC
        WHERE
                DCD.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DCD.DS_CONTR_PK          = #dsContrPk#
            AND DCD.DS_CONTR_DTL_PK      = #dsContrDtlPk#
            AND DCD.EZCANCELFLAG         = '0'
            AND DCD.GLBL_CMPY_CD         = BC.GLBL_CMPY_CD
            AND DCD.BASE_BILL_TO_CUST_CD = BC.BILL_TO_CUST_CD
            AND BC.EZCANCELFLAG          = '0'
            AND BC.GLBL_CMPY_CD          = CC.GLBL_CMPY_CD
            AND BC.SELL_TO_CUST_CD       = CC.SELL_TO_CUST_CD
            AND CC.EZCANCELFLAG          = '0'
            AND CC.CR_CARD_CUST_REF_NUM  = #crCardCustRefNum#
            AND CC.CR_CARD_VALID_FLG     = 'Y'
    </statement>
    <statement id="getCcRefNumCntForMeter" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(CC.DS_CR_CARD_PK)      AS COUNT
        FROM
            DS_CONTR_BLLG_MTR  DM
           ,BILL_TO_CUST       BC
           ,DS_CR_CARD         CC
        WHERE
                DM.GLBL_CMPY_CD          = #glblCmpyCd#
            AND DM.DS_CONTR_DTL_PK       = #dsContrDtlPk#
            AND DM.DS_CONTR_BLLG_MTR_PK  = #dsContrBllgMtrPk#
            AND DM.EZCANCELFLAG          = '0'
            AND DM.GLBL_CMPY_CD          = BC.GLBL_CMPY_CD
            AND DM.BLLG_MTR_BILL_TO_CUST_CD
                                         = BC.BILL_TO_CUST_CD
            AND BC.EZCANCELFLAG          = '0'
            AND BC.GLBL_CMPY_CD          = CC.GLBL_CMPY_CD
            AND BC.SELL_TO_CUST_CD       = CC.SELL_TO_CUST_CD
            AND CC.EZCANCELFLAG          = '0'
            AND CC.CR_CARD_CUST_REF_NUM  = #crCardCustRefNum#
            AND CC.CR_CARD_VALID_FLG     = 'Y'
    </statement>
    <statement id="getSellToCustCdForHeader" parameterClass="Map" resultClass="String">
        SELECT
            BC.SELL_TO_CUST_CD           AS SELL_TO_CUST_CD
        FROM
            DS_CONTR        DC
           ,BILL_TO_CUST    BC
        WHERE
                DC.GLBL_CMPY_CD          = #glblCmpyCd#
            AND DC.DS_CONTR_PK           = #dsContrPk#
            AND DC.EZCANCELFLAG          = '0'
            AND DC.GLBL_CMPY_CD          = BC.GLBL_CMPY_CD
            AND DC.ALT_PAYER_CUST_CD     = BC.BILL_TO_CUST_CD
            AND BC.EZCANCELFLAG          = '0'
    </statement>
    <statement id="getSellToCustCdForDetail" parameterClass="Map" resultClass="String">
        SELECT
            BC.SELL_TO_CUST_CD           AS SELL_TO_CUST_CD
        FROM
            DS_CONTR_DTL    DCD
           ,BILL_TO_CUST    BC
        WHERE
                DCD.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DCD.DS_CONTR_PK          = #dsContrPk#
            AND DCD.DS_CONTR_DTL_PK      = #dsContrDtlPk#
            AND DCD.EZCANCELFLAG         = '0'
            AND DCD.GLBL_CMPY_CD         = BC.GLBL_CMPY_CD
            AND DCD.BASE_BILL_TO_CUST_CD = BC.BILL_TO_CUST_CD
            AND BC.EZCANCELFLAG          = '0'
    </statement>
    <statement id="getSellToCustCdForMeter" parameterClass="Map" resultClass="String">
        SELECT
            BC.SELL_TO_CUST_CD           AS SELL_TO_CUST_CD
        FROM
            DS_CONTR_BLLG_MTR  DM
           ,BILL_TO_CUST       BC
        WHERE
                DM.GLBL_CMPY_CD          = #glblCmpyCd#
            AND DM.DS_CONTR_DTL_PK       = #dsContrDtlPk#
            AND DM.DS_CONTR_BLLG_MTR_PK  = #dsContrBllgMtrPk#
            AND DM.EZCANCELFLAG          = '0'
            AND DM.GLBL_CMPY_CD          = BC.GLBL_CMPY_CD
            AND DM.BLLG_MTR_BILL_TO_CUST_CD
                                         = BC.BILL_TO_CUST_CD
            AND BC.EZCANCELFLAG          = '0'
    </statement>
    <statement id="getCrCardTrxPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            TR.CR_CARD_TRX_PK
        FROM
            CR_CARD_TRX TR
        WHERE
                TR.GLBL_CMPY_CD          = #glblCmpyCd#
            AND TR.CR_CARD_TRX_TP_CD     = #crCardTrxTp#
            AND TR.FIRST_TRX_INFO_NUM    = #firstTrxInfoNum#
            <isNotNull property="scdTrxInfoNum">
            AND TR.SCD_TRX_INFO_NUM      = #scdTrxInfoNum#
            </isNotNull>
            <isNull property="scdTrxInfoNum">
            AND TR.SCD_TRX_INFO_NUM      IS NULL
            </isNull>
            <isNotNull property="thirdTrxInfoNum">
            AND TR.THIRD_TRX_INFO_NUM    = #thirdTrxInfoNum#
            </isNotNull>
            <isNull property="thirdTrxInfoNum">
            AND TR.THIRD_TRX_INFO_NUM    IS NULL
            </isNull>
            AND TR.CR_CARD_AUTH_STS_CD   = #crCardAuthStsSaved#
            AND TR.EZCANCELFLAG          = '0'
    </statement>
<!-- add end 2016/09/02 CSA Defect#11243 -->
    <statement id="getAddlChrgTpV" parameterClass="Map" resultClass="Map">
        SELECT
             ADDL_CHRG_TP_CD
            ,ADDL_CHRG_TP_DESC_TXT
        FROM
            ADDL_CHRG_TP_V
        A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.ADDL_CHRG_TP_CD   = #addlChrgTpCd#
        ORDER BY
             ADDL_CHRG_TP_DESC_TXT
    </statement>
     <statement id="countCtacTpBillTo" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS BILL_TO_COUNT
        FROM
             CTAC_PSN         CP
            ,DS_CTAC_PSN_RELN DCPR
        WHERE
                CP.GLBL_CMPY_CD                       = #glblCmpyCd#
            AND CP.CTAC_PSN_PK                        = #ctacPsnPk#
            AND CP.GLBL_CMPY_CD                       = DCPR.GLBL_CMPY_CD
            AND CP.CTAC_PSN_PK                        = DCPR.CTAC_PSN_PK
            <!-- START 2018/04/03 U.Kim [QC#23559(Sol358), MOD] -->
            <!-- AND DCPR.CTAC_TP_CD                       = #ctacTpCdBillTo# -->
            <iterate property="ctacTpList" var="ctacTpList[]" open="AND DCPR.CTAC_TP_CD IN(" close=")" conjunction=",">
                #ctacTpList[]#
            </iterate>
            <!-- END 2018/04/03 U.Kim [QC#23559(Sol358), MOD] -->
            AND DCPR.EFF_FROM_DT                  &lt;= #slsDt#
            AND NVL(DCPR.EFF_THRU_DT, #maxEndDt#) &gt;= #slsDt#
            AND CP.EZCANCELFLAG                       = '0'
            AND DCPR.EZCANCELFLAG                     = '0'
     </statement>
</sqlMap>