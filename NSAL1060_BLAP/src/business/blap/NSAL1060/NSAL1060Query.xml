<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NSAL1060Query">
    <typeAlias alias="NSAL1060_ASMsg" type="business.blap.NSAL1060.NSAL1060_ASMsg"/>

    <statement id="getMtrReadList" parameterClass="Map" resultMap="result.searchMtrReadList">
        SELECT
            SPMR.SVC_PHYS_MTR_PK
            ,SPMR.MTR_READ_DT
            ,SPMR.READ_MTR_CNT
            ,SPMR.DS_MTR_READ_TP_CD
            ,SPMR.MTR_LB_CD
            ,SPMR.MTR_READ_SRC_TP_CD
            ,ML.MTR_LB_DESC_TXT
            ,SMM.SER_NUM
            ,SPMR.SVC_PHYS_MTR_READ_GRP_SQ
<!-- START 2017/01/04 K.Ochiai [QC#16584, ADD] -->
            ,SPMR.DS_MTR_READ_TP_GRP_CD
<!-- START 2017/01/04 K.Ochiai [QC#16584, MOD] -->
            <!-- START 2019/11/05 K.Kitachi [QC#54164, ADD] -->
            ,DCD.DS_CONTR_DTL_PK
            ,DC.DS_CONTR_NUM
            <!-- END 2019/11/05 K.Kitachi [QC#54164, ADD] -->
        FROM
            SVC_PHYS_MTR_READ       SPMR
            ,DS_MTR_READ_TP         DMRT
            ,MTR_LB                 ML
            ,SVC_MACH_MSTR          SMM
            <!-- START 2019/11/05 K.Kitachi [QC#54164, ADD] -->
            ,DS_CONTR_DTL           DCD
            ,DS_CONTR               DC
            <!-- END 2019/11/05 K.Kitachi [QC#54164, ADD] -->
        WHERE
            SPMR.GLBL_CMPY_CD               = #glblCmpyCd#
            AND SPMR.EZCANCELFLAG           = '0'
            AND DMRT.GLBL_CMPY_CD           = #glblCmpyCd#
            AND DMRT.EZCANCELFLAG           = '0'
            AND ML.GLBL_CMPY_CD             = #glblCmpyCd#
            AND ML.EZCANCELFLAG             = '0'
            AND SMM.GLBL_CMPY_CD            = #glblCmpyCd#
            AND SMM.EZCANCELFLAG            = '0'
            AND SPMR.EZCANCELFLAG           = '0'
            AND SPMR.SVC_MACH_MSTR_PK       = #svcMachMstrPk#
            AND SPMR.MTR_READ_DT   <![CDATA[>]]> #mtrReadDt#
            AND DMRT.DS_MTR_READ_TP_CD      = SPMR.DS_MTR_READ_TP_CD
<!-- START 2016/12/28 K.Ochiai [QC#16584, MOD] -->
<!--        AND SPMR.DS_MTR_READ_TP_GRP_CD     = #dsMtrReadTpGrpCd# -->
            AND SPMR.VLD_MTR_FLG            = #vldMtrFlg#
<!-- END 2016/12/28 K.Ochiai [QC#16584, MOD] -->
            AND ML.MTR_LB_CD                = SPMR.MTR_LB_CD
            AND SMM.SVC_MACH_MSTR_PK        = #svcMachMstrPk#
            <!-- START 2019/11/05 K.Kitachi [QC#54164, ADD] -->
            AND SPMR.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD    (+)
            AND SPMR.DS_CONTR_DTL_PK        = DCD.DS_CONTR_DTL_PK (+)
            AND DCD.DS_CONTR_DTL_STS_CD (+) &lt;&gt; #dsContrDtlStsCd#
            AND DCD.EZCANCELFLAG        (+) = '0'
            AND DCD.GLBL_CMPY_CD            = DC.GLBL_CMPY_CD     (+)
            AND DCD.DS_CONTR_PK             = DC.DS_CONTR_PK      (+)
            AND DC.EZCANCELFLAG         (+) = '0'
            <!-- END 2019/11/05 K.Kitachi [QC#54164, ADD] -->
        ORDER BY
            SPMR.MTR_READ_DT
            ,SPMR.SVC_PHYS_MTR_READ_GRP_SQ
            ,ML.MTR_LB_SORT_NUM
            ,SPMR.READ_MTR_CNT
    </statement>

    <resultMap id="result.searchMtrReadList" class="NSAL1060_ASMsg">
        <result property="svcPhysMtrPk_A1" column="SVC_PHYS_MTR_PK"  javaType="EZDSBigDecimalItem" />
        <result property="mtrReadDt_A1" column="MTR_READ_DT"  javaType="EZDSStringItem" />
        <result property="readMtrCnt_A1" column="READ_MTR_CNT"  javaType="EZDSStringItem" />
        <result property="dsMtrReadTpCd_A1" column="DS_MTR_READ_TP_CD"  javaType="EZDSStringItem" />
        <result property="mtrLbCd_A1" column="MTR_LB_CD"  javaType="EZDSStringItem" />
        <result property="mtrReadSrcTpCd_A1" column="MTR_READ_SRC_TP_CD"  javaType="EZDSStringItem" />
        <result property="mtrLbDescTxt_A1" column="MTR_LB_DESC_TXT"  javaType="EZDSStringItem" />
        <result property="serNum_A1" column="SER_NUM"  javaType="EZDSStringItem" />
        <result property="svcPhysMtrReadGrpSq_A1" column="SVC_PHYS_MTR_READ_GRP_SQ"  javaType="EZDSBigDecimalItem" />
        <result property="dsMtrReadTpGrpCd_A1" column="DS_MTR_READ_TP_GRP_CD"  javaType="EZDSStringItem" />
        <!-- START 2019/11/05 K.Kitachi [QC#54164, ADD] -->
        <result property="dsContrDtlPk_A1" column="DS_CONTR_DTL_PK" javaType="EZDSBigDecimalItem" />
        <result property="dsContrNum_A1" column="DS_CONTR_NUM" javaType="EZDSStringItem" />
        <!-- END 2019/11/05 K.Kitachi [QC#54164, ADD] -->
    </resultMap>
    
</sqlMap>