<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL0540Query">
    <statement id="getSvcConfigInfo" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM (
            SELECT
                 A.SVC_SLN_SQ
                ,A.SVC_SLN_NM
                ,A.SVC_CONFIG_MSTR_PK
                ,B.SER_NUM
                ,B.MDSE_CD
<!-- START 2016/09/20 N.Arai [QC#11616, MOD] -->
<!--            ,H.MDSE_NM      -->
                ,H.MDSE_DESC_SHORT_TXT
<!-- END 2016/09/20 N.Arai [QC#11616, MOD] -->
                ,CASE
                    WHEN B.SVC_MACH_MSTR_PK = C.SVC_MACH_MSTR_PK THEN G.T_MDL_NM
                    ELSE ''
                 END AS T_MDL_NM
                ,B.SVC_MACH_MSTR_PK
                ,C.SVC_MACH_MSTR_PK AS PRNT_SVC_MACH_MSTR_PK
                ,B.ISTL_DT
                ,D.LOC_NM AS BILL_TO_LOC_NM
                ,CASE 
                    WHEN B.ISTL_LOC_OVRD_FLG = 'Y' THEN B.LOC_NM
                    ELSE E.LOC_NM
                 END AS SHIP_TO_LOC_NM
                ,F.LOC_NM AS SELL_TO_LOC_NM
                ,A.EZUPTIME
                ,A.EZUPTIMEZONE
            FROM
                 SVC_CONFIG_MSTR A
                ,SVC_MACH_MSTR   B
                ,SVC_CONFIG_MSTR C
                ,BILL_TO_CUST    D
                ,SHIP_TO_CUST    E
                ,BILL_TO_CUST    F
                ,MDL_NM          G
                ,MDSE            H
            WHERE
                    A.EZCANCELFLAG       = '0'
                AND A.GLBL_CMPY_CD       = #cMsg.glblCmpyCd#
            <isNull property="svcConfigMstrPk">
                AND A.SVC_SLN_SQ         = #cMsg.svcSlnSq#
            </isNull>
            <isNotNull property="svcConfigMstrPk">
                AND A.SVC_CONFIG_MSTR_PK = #svcConfigMstrPk#
            </isNotNull>
                AND B.EZCANCELFLAG       = '0'
                AND A.GLBL_CMPY_CD       = B.GLBL_CMPY_CD
                AND A.SVC_CONFIG_MSTR_PK = B.SVC_CONFIG_MSTR_PK
                AND C.EZCANCELFLAG       = '0'
                AND B.GLBL_CMPY_CD       = C.GLBL_CMPY_CD
                AND B.SVC_CONFIG_MSTR_PK = C.SVC_CONFIG_MSTR_PK
                AND D.EZCANCELFLAG(+)    = '0'
                AND B.GLBL_CMPY_CD       = D.GLBL_CMPY_CD(+)
                AND B.OWNR_LOC_NUM       = D.BILL_TO_CUST_CD(+)
                AND E.EZCANCELFLAG(+)    = '0'
                AND B.GLBL_CMPY_CD       = E.GLBL_CMPY_CD(+)
                AND B.CUR_LOC_NUM        = E.SHIP_TO_CUST_CD(+)
                AND F.EZCANCELFLAG(+)    = '0'
                AND B.GLBL_CMPY_CD       = F.GLBL_CMPY_CD(+)
                AND B.BILL_TO_LOC_NUM    = F.BILL_TO_CUST_CD(+)
                AND G.EZCANCELFLAG       = '0'
                AND C.GLBL_CMPY_CD       = G.T_GLBL_CMPY_CD
                AND C.MDL_ID             = G.T_MDL_ID
                AND H.EZCANCELFLAG       = '0'
                AND B.GLBL_CMPY_CD       = H.GLBL_CMPY_CD
                AND B.MDSE_CD            = H.MDSE_CD
            ORDER BY
                 A.SVC_CONFIG_MSTR_PK ASC
                ,B.SVC_MACH_SQ_NUM ASC)
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getSvcMemo" parameterClass="Map" resultClass="Map">
        SELECT
             A.SVC_MEMO_PK
            ,A.SVC_CMNT_TXT
            ,A.EZUPTIME
            ,A.EZUPTIMEZONE
        FROM
            SVC_MEMO A
        WHERE
                A.EZCANCELFLAG     = '0'
            AND A.GLBL_CMPY_CD     = #cMsg.glblCmpyCd#
            AND A.SVC_MEMO_CATG_CD = #svcMemoCatgCd#
            AND A.SVC_MEMO_TP_CD   = #svcMemoTpCd#
            AND A.SVC_MEMO_TRX_NUM = #cMsg.svcSlnSq#
            AND A.SVC_MEMO_TRX_NM  = #svcMemoTrxNm#
    </statement>
</sqlMap>
