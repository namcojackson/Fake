<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NMAL2670Query">

    <typeAlias alias="NMAL2670_ASMsg"	type="business.blap.NMAL2670.NMAL2670_ASMsg"/>

    <resultMap id="result.getTrtyRule" class="NMAL2670_ASMsg">
        <result property="trtyRulePk_A1"         column="TRTY_RULE_PK"            javaType="EZDSBigDecimalItem"/>
        <result property="xxDsMsgEntryTxt_A1"    column="XX_DS_MSG_ENTRY_TXT"     javaType="EZDCStringItem"/>
    </resultMap>

    <statement id="getTrtyRule" parameterClass="Map" resultMap="result.getTrtyRule">
        WITH TRTY_RULE_V AS (
            SELECT
                 TR.TRTY_RULE_PK
                ,CASE
                 WHEN TR.TRTY_RULE_OPRD_TP_CD = '4' THEN --Between
                    TRT.TRTY_RULE_TP_NM || ' ' || TROT.TRTY_RULE_OPRD_TP_NM || ' '  || TR.TRTY_RULE_FROM_VAL_TXT || ' AND ' || TR.TRTY_RULE_THRU_VAL_TXT
                 ELSE
                    TRT.TRTY_RULE_TP_NM || ' ' || TROT.TRTY_RULE_OPRD_TP_NM || ' '  || TR.TRTY_RULE_FROM_VAL_TXT
                 END AS XX_DS_MSG_ENTRY_TXT
            FROM
                TRTY_RULE TR
               ,TRTY_RULE_TP TRT
               ,TRTY_RULE_OPRD_TP TROT
            WHERE
                TR.GLBL_CMPY_CD          = #glblCmpyCd#
            AND TR.ORG_STRU_TP_CD        = #orgStruTpCd#
            AND TR.ORG_CD                = #orgCd#
            AND TR.EFF_FROM_DT       &lt;= #slsDt#
            AND NVL(TR.EFF_THRU_DT, #maxDt#)      &gt;= #slsDt#
            AND TR.EZCANCELFLAG          = '0'
            AND TR.GLBL_CMPY_CD          = TRT.GLBL_CMPY_CD
            AND TR.TRTY_RULE_TP_CD       = TRT.TRTY_RULE_TP_CD
            AND TRT.EZCANCELFLAG         = '0'
            AND TR.GLBL_CMPY_CD          = TROT.GLBL_CMPY_CD
            AND TR.TRTY_RULE_OPRD_TP_CD  = TROT.TRTY_RULE_OPRD_TP_CD
            AND TROT.EZCANCELFLAG        = '0'
        )
        SELECT
              TRV.TRTY_RULE_PK
            , TRV.XX_DS_MSG_ENTRY_TXT
        FROM
             (
                 SELECT
                      TRTY_RULE_PK
                    , XX_DS_MSG_ENTRY_TXT
                 FROM
                     TRTY_RULE_V 
                 WHERE
                     1 = 1
                 <isNotNull property="filter">
                 AND UPPER(XX_DS_MSG_ENTRY_TXT) LIKE #filter#
                 </isNotNull>
                 ORDER BY
                    XX_DS_MSG_ENTRY_TXT
             ) TRV
        WHERE
             1 = 1
        <isNotNull property="rowNum">
         AND ROWNUM &lt;= #rowNum#
        </isNotNull>
    </statement>
</sqlMap>
