<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NLAB313001">

     <statement id="getTechMdseListWrkInfo" parameterClass="Map" resultClass="Map">
        SELECT
              TECH_MDSE_LIST_WRK_PK
             ,TECH_TOC_CD
             ,MDSE_CD
             ,MDSE_NM
             ,SUPD_TO_MDSE_CD
             ,SITE_SRVY_REQ_FLG
             <!-- START 2022/02/14 K.Kitachi [QC#59695, ADD] -->
             ,DEL_FLG
             <!-- END 2022/02/14 K.Kitachi [QC#59695, ADD] -->
<!-- START 2017/05/23 K.Kitachi [QC#18374, MOD] -->
        FROM
<!--         TECH_MDSE_LIST_WRK -->
            (
                SELECT
                     A.TECH_MDSE_LIST_WRK_PK
                    ,A.TECH_TOC_CD
                    ,A.MDSE_CD
                    ,A.MDSE_NM
                    ,A.SUPD_TO_MDSE_CD
                    ,A.SITE_SRVY_REQ_FLG
                    <!-- START 2022/02/14 K.Kitachi [QC#59695, ADD] -->
                    ,A.DEL_FLG
                    <!-- END 2022/02/14 K.Kitachi [QC#59695, ADD] -->
                    ,RANK() OVER(
                        PARTITION BY
                             A.TECH_TOC_CD
                            ,A.MDSE_CD
                            <!-- START 2022/02/14 K.Kitachi [QC#59695, ADD] -->
                            ,A.MDSE_NM
                            <!-- END 2022/02/14 K.Kitachi [QC#59695, ADD] -->
                        ORDER BY
                             A.TECH_MDSE_LIST_WRK_DT  DESC
                            ,A.TECH_MDSE_LIST_WRK_NUM DESC
                     ) RANK_NUM
                FROM
                    TECH_MDSE_LIST_WRK A
                WHERE
                        A.GLBL_CMPY_CD     = #glblCmpyCd#
                    AND A.TECH_PROC_STS_CD = #techProcStsCd#
                    AND A.EZCANCELFLAG     = '0'
            )
        WHERE
<!--         GLBL_CMPY_CD                           =    #glblCmpyCd# -->
<!--         AND TECH_MDSE_LIST_WRK_DT              =    #techMdseListDt# -->
<!--         AND TECH_PROC_STS_CD                   =    #techProcStsCd# -->
<!--         AND EZCANCELFLAG                       =    '0' -->
            RANK_NUM = 1
<!-- END 2017/05/23 K.Kitachi [QC#18374, MOD] -->
        ORDER BY 
             <!-- START 2022/02/14 K.Kitachi [QC#59695, MOD] -->
             <!-- TECH_TOC_CD -->
              DEL_FLG DESC
             ,TECH_TOC_CD
             ,MDSE_CD
             <!-- END 2022/02/14 K.Kitachi [QC#59695, MOD] -->
            ,TECH_MDSE_LIST_WRK_PK
    </statement>
</sqlMap>