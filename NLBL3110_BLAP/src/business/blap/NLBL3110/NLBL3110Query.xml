<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NLBL3110Query">

    <typeAlias alias="NLBL3110CMsg"       type="business.blap.NLBL3110.NLBL3110CMsg"/>
    <typeAlias alias="NLBL3110_ASMsg"     type="business.blap.NLBL3110.NLBL3110_ASMsg"/>

    <statement id="searchSo" parameterClass="Map" resultMap="result.NLBL3110_ASMsg">
        SELECT
            CPO_NUM
           ,TRX_HDR_NUM
           ,SHIP_TO_CUST_CD
           ,DS_ACCT_NM
           ,XX_ALL_LINE_ADDR
           ,CTY_ADDR
           ,ST_CD
           ,UPD_USR_ID
           ,UPD_TS
           ,SCHD_COORD_STS_DESC_TXT
           ,SCHD_COORD_PSN_CD
           ,SCHD_DELY_DT
           ,SCHD_DELY_TM
           ,SHPG_SVC_LVL_DESC_TXT
           ,CARR_NM
           ,TEMP_SCHD_RSN_DESC_TXT
           ,CARR_CMNT_TXT
           ,CARR_UPD_USR_NM
           ,TEMP_SCHD_CMNT_TXT
        FROM
            (
            SELECT
                SO.TRX_HDR_NUM               AS CPO_NUM
               ,SO.SO_NUM                    AS TRX_HDR_NUM
               ,SO.SHIP_TO_CUST_CD           AS SHIP_TO_CUST_CD
               ,DECODE(LT.LOC_TP_CD, #custLocTpCd#, DAC.DS_ACCT_NM, SOCD.SO_CUST_LINE_LOC_NM_01 || SOCD.SO_CUST_LINE_LOC_NM_02) AS DS_ACCT_NM
               ,SOCD.SO_CUST_LINE_ADDR_01 || SOCD.SO_CUST_LINE_ADDR_02 AS XX_ALL_LINE_ADDR
               ,SOCD.CTY_ADDR                AS CTY_ADDR
               ,SOCD.ST_CD                   AS ST_CD
               ,SOCT.UPD_USR_ID              AS UPD_USR_ID
               ,SOCT.UPD_TS                  AS UPD_TS
               ,SCS.SCHD_COORD_STS_DESC_TXT  AS SCHD_COORD_STS_DESC_TXT
               ,SOCT.SCHD_COORD_PSN_CD       AS SCHD_COORD_PSN_CD
               ,SOCT.SCHD_DELY_DT            AS SCHD_DELY_DT
               ,SOCT.SCHD_DELY_TM            AS SCHD_DELY_TM
               ,SSL.SHPG_SVC_LVL_DESC_TXT    AS SHPG_SVC_LVL_DESC_TXT
               ,V.LOC_NM                     AS CARR_NM
               ,TSR.TEMP_SCHD_RSN_DESC_TXT   AS TEMP_SCHD_RSN_DESC_TXT
               ,SOCT.CARR_CMNT_TXT           AS CARR_CMNT_TXT
               ,CASE WHEN SOCT.CARR_UPD_USR_NM IS NULL AND PSN1.PSN_FIRST_NM IS NOT NULL THEN PSN1.PSN_FIRST_NM || ' ' || PSN1.PSN_MID_NM  || ' ' || PSN1.PSN_LAST_NM
                     WHEN SOCT.CARR_UPD_USR_NM IS NULL AND PSN2.PSN_FIRST_NM IS NOT NULL THEN PSN2.PSN_FIRST_NM || ' ' || PSN2.PSN_MID_NM  || ' ' || PSN2.PSN_LAST_NM
                     WHEN SOCT.CARR_UPD_USR_NM IS NULL AND SOCT.UPD_USR_ID IS NOT NULL THEN SOCT.UPD_USR_ID
                     WHEN SOCT.CARR_UPD_USR_NM IS NULL AND SOCT.UPD_USR_ID IS NULL THEN SOCT.EZUPUSERID
                     ELSE SOCT.CARR_UPD_USR_NM
                END                          AS CARR_UPD_USR_NM
               ,SOCT.TEMP_SCHD_CMNT_TXT
            FROM
                SHPG_ORD          SO
               ,SHPG_ORD_CUST_DTL SOCD
               ,SHIP_TO_CUST      STC
               ,LOC_TP            LT
               ,SELL_TO_CUST      DAC
               ,SHPG_ORD_SCHD_TRK SOCT
               ,SCHD_COORD_STS    SCS
               ,SHPG_SVC_LVL      SSL
               ,VND               V
               ,TEMP_SCHD_RSN     TSR
               ,S21_PSN           PSN1
               ,S21_PSN           PSN2
            WHERE
                SO.GLBL_CMPY_CD            = #glblCmpyCd#
            AND SO.SO_NUM                  = #cMsg.trxHdrNum_H1#
            AND SO.EZCANCELFLAG            = '0'
            AND SOCD.GLBL_CMPY_CD(+)       = SO.GLBL_CMPY_CD
            AND SOCD.SO_NUM(+)             = SO.SO_NUM
            AND SOCD.SO_CUST_DATA_TP_CD(+) = #soCustDataTpCc#
            AND SOCD.EZCANCELFLAG(+)       = '0'
            AND STC.GLBL_CMPY_CD(+)        = SO.GLBL_CMPY_CD
            AND STC.SHIP_TO_CUST_CD(+)     = SO.SHIP_TO_CUST_CD
            AND STC.EZCANCELFLAG(+)        = '0'
            AND LT.GLBL_CMPY_CD(+)         = STC.GLBL_CMPY_CD
            AND LT.LOC_ROLE_TP_CD(+)       = STC.LOC_ROLE_TP_CD
            AND LT.LOC_GRP_CD(+)           = STC.LOC_GRP_CD
            AND LT.EZCANCELFLAG(+)         = '0'
            AND DAC.GLBL_CMPY_CD(+)        = STC.GLBL_CMPY_CD
            AND DAC.SELL_TO_CUST_CD(+)     = STC.SELL_TO_CUST_CD
            AND DAC.EZCANCELFLAG(+)        = '0'
            AND SOCT.GLBL_CMPY_CD(+)       = SO.GLBL_CMPY_CD
            AND SOCT.SO_NUM(+)             = SO.SO_NUM
            AND SOCT.EZCANCELFLAG(+)       = '0'
            AND SCS.GLBL_CMPY_CD(+)        = SOCT.GLBL_CMPY_CD
            AND SCS.SCHD_COORD_STS_CD(+)   = SOCT.SCHD_COORD_STS_CD
            AND SCS.EZCANCELFLAG(+)        = '0'
            AND SSL.GLBL_CMPY_CD(+)        = SOCT.GLBL_CMPY_CD
            AND SSL.SHPG_SVC_LVL_CD(+)     = SOCT.SHPG_SVC_LVL_CD
            AND SSL.EZCANCELFLAG(+)        = '0'
            AND V.GLBL_CMPY_CD(+)          = SOCT.GLBL_CMPY_CD
            AND V.VND_CD(+)                = SOCT.CARR_CD
            AND V.EZCANCELFLAG(+)          = '0'
            AND TSR.GLBL_CMPY_CD(+)        = SOCT.GLBL_CMPY_CD
            AND TSR.TEMP_SCHD_RSN_CD(+)    = SOCT.TEMP_SCHD_RSN_CD
            AND TSR.EZCANCELFLAG(+)        = '0'
            AND SOCT.UPD_USR_ID            = PSN1.PSN_CD(+)
            AND SOCT.EZUPUSERID            = PSN2.PSN_CD(+)
            AND SOCT.GLBL_CMPY_CD          = PSN1.GLBL_CMPY_CD(+)
            AND SOCT.GLBL_CMPY_CD          = PSN2.GLBL_CMPY_CD(+)
            AND PSN1.EZCANCELFLAG(+)       = '0'
            AND PSN2.EZCANCELFLAG(+)       = '0'
            ORDER BY
                SOCT.UPD_TS DESC
            )
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="searchRws" parameterClass="Map" resultMap="result.NLBL3110_ASMsg">
        SELECT
            CPO_NUM
           ,TRX_HDR_NUM
           ,TRX_LINE_NUM
           ,SHIP_TO_CUST_CD
           ,DS_ACCT_NM
           ,XX_ALL_LINE_ADDR
           ,CTY_ADDR
           ,ST_CD
           ,UPD_USR_ID
           ,UPD_TS
           ,SCHD_COORD_STS_DESC_TXT
           ,SCHD_COORD_PSN_CD
           ,SCHD_DELY_DT
           ,SCHD_DELY_TM
           ,SHPG_SVC_LVL_DESC_TXT
           ,CARR_NM
           ,RTRN_TRK_STS_DESC_TXT
           ,CARR_CMNT_TXT
           ,CARR_UPD_USR_NM
        FROM
            (
            SELECT
                RH.TRX_ORD_NUM               AS CPO_NUM
               ,RH.RWS_NUM                   AS TRX_HDR_NUM
               ,RD.RWS_DTL_LINE_NUM          AS TRX_LINE_NUM
               ,RH.FROM_LOC_CD               AS SHIP_TO_CUST_CD
               ,DECODE(LT.LOC_TP_CD, #custLocTpCd#, DAC.DS_ACCT_NM, RH.FROM_LOC_NM_01 || RH.FROM_LOC_NM_02) AS DS_ACCT_NM
               ,RH.FROM_LOC_ADDR_01 || RH.FROM_LOC_ADDR_02 AS XX_ALL_LINE_ADDR
               ,RH.FROM_LOC_CTY_ADDR         AS CTY_ADDR
               ,RH.FROM_LOC_ST_CD            AS ST_CD
               ,RSDT.UPD_USR_ID              AS UPD_USR_ID
               ,RSDT.UPD_TS                  AS UPD_TS
               ,SCS.SCHD_COORD_STS_DESC_TXT  AS SCHD_COORD_STS_DESC_TXT
               ,RSDT.SCHD_COORD_PSN_CD       AS SCHD_COORD_PSN_CD
               ,RSDT.SCHD_PICK_UP_DT         AS SCHD_DELY_DT
               ,NULL                         AS SCHD_DELY_TM
               ,SSL.SHPG_SVC_LVL_DESC_TXT    AS SHPG_SVC_LVL_DESC_TXT
               ,V.LOC_NM                     AS CARR_NM
               ,RTS.RTRN_TRK_STS_DESC_TXT    AS RTRN_TRK_STS_DESC_TXT
               ,RSDT.CARR_CMNT_TXT           AS CARR_CMNT_TXT
               ,CASE WHEN RSDT.CARR_UPD_USR_NM IS NULL AND RSDT.UPD_USR_ID IS NOT NULL THEN RSDT.UPD_USR_ID
                     WHEN RSDT.CARR_UPD_USR_NM IS NULL AND RSDT.UPD_USR_ID IS NULL THEN RSDT.EZUPUSERID
                     ELSE RSDT.CARR_UPD_USR_NM
                END                          AS CARR_UPD_USR_NM
            FROM
                RWS_HDR           RH
               ,RWS_DTL           RD
               ,SHIP_TO_CUST      STC
               ,LOC_TP            LT
               ,SELL_TO_CUST      DAC
               ,RWS_SCHD_DTL_TRK  RSDT
               ,SCHD_COORD_STS    SCS
               ,SHPG_SVC_LVL      SSL
               ,VND               V
               ,RTRN_TRK_STS      RTS
            WHERE
                RH.GLBL_CMPY_CD          = #glblCmpyCd#
            AND RH.RWS_NUM               = #cMsg.trxHdrNum_H1#
            AND RH.EZCANCELFLAG          = '0'
            AND RD.GLBL_CMPY_CD          = RH.GLBL_CMPY_CD
            AND RD.RWS_NUM               = RH.RWS_NUM
            AND RD.RWS_DTL_LINE_NUM      = #cMsg.trxLineNum_H1#
            AND RD.EZCANCELFLAG          = '0'
            AND STC.GLBL_CMPY_CD(+)      = RH.GLBL_CMPY_CD
            AND STC.SHIP_TO_CUST_CD(+)   = RH.FROM_LOC_CD
            AND STC.EZCANCELFLAG(+)      = '0'
            AND LT.GLBL_CMPY_CD(+)       = STC.GLBL_CMPY_CD
            AND LT.LOC_ROLE_TP_CD(+)     = STC.LOC_ROLE_TP_CD
            AND LT.LOC_GRP_CD(+)         = STC.LOC_GRP_CD
            AND LT.EZCANCELFLAG(+)       = '0'
            AND DAC.GLBL_CMPY_CD(+)      = STC.GLBL_CMPY_CD
            AND DAC.SELL_TO_CUST_CD(+)   = STC.SELL_TO_CUST_CD
            AND DAC.EZCANCELFLAG(+)      = '0'
            AND RSDT.GLBL_CMPY_CD(+)     = RH.GLBL_CMPY_CD
            AND RSDT.RWS_NUM(+)          = RH.RWS_NUM
            AND RSDT.RWS_DTL_LINE_NUM(+) = RD.RWS_DTL_LINE_NUM
            AND RSDT.EZCANCELFLAG(+)     = '0'
            AND SCS.GLBL_CMPY_CD(+)      = RSDT.GLBL_CMPY_CD
            AND SCS.SCHD_COORD_STS_CD(+) = RSDT.SCHD_COORD_STS_CD
            AND SCS.EZCANCELFLAG(+)      = '0'
            AND SSL.GLBL_CMPY_CD(+)      = RSDT.GLBL_CMPY_CD
            AND SSL.SHPG_SVC_LVL_CD(+)   = RSDT.SHPG_SVC_LVL_CD
            AND SSL.EZCANCELFLAG(+)      = '0'
            AND V.GLBL_CMPY_CD(+)        = RSDT.GLBL_CMPY_CD
            AND V.VND_CD(+)              = RSDT.CARR_CD
            AND V.EZCANCELFLAG(+)        = '0'
            AND RTS.GLBL_CMPY_CD(+)      = RSDT.GLBL_CMPY_CD
            AND RTS.RTRN_TRK_STS_CD(+)   = RSDT.RTRN_TRK_STS_CD
            AND RTS.EZCANCELFLAG(+)      = '0'
            ORDER BY
                RSDT.UPD_TS DESC
            )
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <resultMap id="result.NLBL3110_ASMsg" class="NLBL3110_ASMsg">
        <result property="cpoNum_A1"              column="CPO_NUM"                  javaType="EZDCStringItem"/>
        <result property="trxHdrNum_A1"           column="TRX_HDR_NUM"              javaType="EZDCStringItem"/>
        <result property="trxLineNum_A1"          column="TRX_LINE_NUM"             javaType="EZDCStringItem"/>
        <result property="shipToCustCd_A1"        column="SHIP_TO_CUST_CD"          javaType="EZDCStringItem"/>
        <result property="dsAcctNm_A1"            column="DS_ACCT_NM"               javaType="EZDCStringItem"/>
        <result property="xxAllLineAddr_A1"       column="XX_ALL_LINE_ADDR"         javaType="EZDCStringItem"/>
        <result property="ctyAddr_A1"             column="CTY_ADDR"                 javaType="EZDCStringItem"/>
        <result property="stCd_A1"                column="ST_CD"                    javaType="EZDCStringItem"/>
        <result property="updUsrId_A1"            column="UPD_USR_ID"               javaType="EZDCStringItem"/>
        <result property="updTs_A1"               column="UPD_TS"                   javaType="EZDCStringItem"/>
        <result property="schdCoordStsDescTxt_A1" column="SCHD_COORD_STS_DESC_TXT"  javaType="EZDCStringItem"/>
        <result property="schdCoordPsnCd_A1"      column="SCHD_COORD_PSN_CD"        javaType="EZDCStringItem"/>
        <result property="schdDelyDt_A1"          column="SCHD_DELY_DT"             javaType="EZDSDateItem"/>
        <result property="schdDelyTm_A1"          column="SCHD_DELY_TM"             javaType="EZDCStringItem"/>
        <result property="shpgSvcLvlDescTxt_A1"   column="SHPG_SVC_LVL_DESC_TXT"    javaType="EZDCStringItem"/>
        <result property="carrNm_A1"              column="CARR_NM"                  javaType="EZDCStringItem"/>
        <result property="tempSchdRsnDescTxt_A1"  column="TEMP_SCHD_RSN_DESC_TXT"   javaType="EZDCStringItem"/>
        <result property="rtrnTrkStsDescTxt_A1"   column="RTRN_TRK_STS_DESC_TXT"    javaType="EZDCStringItem"/>
        <result property="carrCmntTxt_A1"         column="CARR_CMNT_TXT"            javaType="EZDCStringItem"/>
        <result property="carrUpdUsrNm_A1"        column="CARR_UPD_USR_NM"          javaType="EZDCStringItem"/>
        <result property="tempSchdCmntTxt_A1"     column="TEMP_SCHD_CMNT_TXT"       javaType="EZDCStringItem"/>
    </resultMap>

</sqlMap>