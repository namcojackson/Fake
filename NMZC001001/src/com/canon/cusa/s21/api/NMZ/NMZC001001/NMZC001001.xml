<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<sqlMap namespace="NMZC001001">

    <statement id="cntPost" parameterClass="Map" resultClass="Integer">
       SELECT COUNT(*) FROM POST POST
       WHERE POST.GLBL_CMPY_CD = #glblCmpyCd#
         AND POST.EZCANCELFLAG = '0'
         AND POST.POST_CD = #postCd#
    </statement>

    <statement id="cntCnty" parameterClass="Map" resultClass="Integer">
       SELECT COUNT(*) FROM CNTY CNTY
       WHERE CNTY.GLBL_CMPY_CD = #glblCmpyCd#
         AND CNTY.EZCANCELFLAG = '0'
         AND CNTY.CNTY_NM = #cntyNm#
         <isNotNull property="stCd">
         AND CNTY.ST_CD = #stCd#
         </isNotNull>
    </statement>

    <statement id="getCntyPk" parameterClass="Map" resultClass="BigDecimal">
       SELECT CNTY.CNTY_PK AS CNTY_PK
       FROM CNTY CNTY
       WHERE CNTY.GLBL_CMPY_CD = #glblCmpyCd#
         AND CNTY.EZCANCELFLAG = '0'
         AND CNTY.CNTY_NM = #cntyNm#
         <isNotNull property="stCd">
         AND CNTY.ST_CD = #stCd#
         </isNotNull>
    </statement>

    <statement id="getDsAcctProsPk" parameterClass="Map" resultClass="BigDecimal">
       SELECT PROS.DS_ACCT_PROS_PK AS DS_ACCT_PROS_PK
       FROM DS_ACCT_PROS PROS
       WHERE PROS.GLBL_CMPY_CD = #glblCmpyCd#
         AND PROS.EZCANCELFLAG = '0'
         AND PROS.DS_ACCT_NUM = #dsAcctNum#
    </statement>

    <statement id="getSellToCustPkByAcctNum" parameterClass="Map" resultClass="BigDecimal">
       SELECT SELL.SELL_TO_CUST_PK
        FROM SELL_TO_CUST SELL
       WHERE SELL.GLBL_CMPY_CD = #glblCmpyCd#
         AND SELL.SELL_TO_CUST_CD = #dsAcctNum#
         AND SELL.EZCANCELFLAG = '0'
    </statement>

    <statement id="getSellToCustPk" parameterClass="Map" resultClass="BigDecimal">
       SELECT SELL.SELL_TO_CUST_PK AS SELL_TO_CUST_PK
       FROM SELL_TO_CUST SELL
       WHERE SELL.GLBL_CMPY_CD = #glblCmpyCd#
         AND SELL.EZCANCELFLAG = '0'
         AND SELL.LOC_NUM = #locNum#
    </statement>

    <statement id="getAcctLocPk" parameterClass="Map" resultClass="BigDecimal">
       SELECT LOC.ACCT_LOC_PK AS ACCT_LOC_PK
       FROM ACCT_LOC LOC
       WHERE LOC.GLBL_CMPY_CD = #glblCmpyCd#
         AND LOC.EZCANCELFLAG = '0'
         AND LOC.LOC_NUM = #locNum#
    </statement>

    <statement id="getBillToCustPk" parameterClass="Map" resultClass="BigDecimal">
       SELECT BILL.BILL_TO_CUST_PK AS BILL_TO_CUST_PK
       FROM BILL_TO_CUST BILL
       WHERE BILL.GLBL_CMPY_CD = #glblCmpyCd#
         AND BILL.EZCANCELFLAG = '0'
         AND BILL.LOC_NUM = #locNum#
    </statement>

    <statement id="getCustPk" parameterClass="Map" resultClass="BigDecimal">
       SELECT RCPNT.CUST_PK AS CUST_PK
       FROM INV_RCPNT RCPNT
       WHERE RCPNT.GLBL_CMPY_CD = #glblCmpyCd#
         AND RCPNT.EZCANCELFLAG = '0'
         AND RCPNT.LOC_NUM = #locNum#
    </statement>

    <statement id="getShipToCustPk" parameterClass="Map" resultClass="BigDecimal">
       SELECT SHIP.SHIP_TO_CUST_PK AS SHIP_TO_CUST_PK
       FROM SHIP_TO_CUST SHIP
       WHERE SHIP.GLBL_CMPY_CD = #glblCmpyCd#
         AND SHIP.EZCANCELFLAG = '0'
         AND SHIP.LOC_NUM = #locNum#
    </statement>

    <statement id="getDsXrefAcctPk" parameterClass="Map" resultClass="BigDecimal">
       SELECT XREF.DS_XREF_ACCT_PK AS DS_XREF_ACCT_PK
       FROM DS_XREF_ACCT XREF
       WHERE XREF.GLBL_CMPY_CD = #glblCmpyCd#
         AND XREF.EZCANCELFLAG = '0'
         AND XREF.LOC_NUM = #locNum#
         AND XREF.DS_XREF_ACCT_TP_CD = #dsXrefAcctTpCd#
         AND XREF.DS_XREF_ACCT_CD = #dsXrefAcctCd#
    </statement>

    <statement id="getDsCustSpclMsgPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT MSG.DS_CUST_SPCL_MSG_PK AS DS_CUST_SPCL_MSG_PK
        FROM DS_CUST_SPCL_MSG MSG
        WHERE MSG.GLBL_CMPY_CD = #glblCmpyCd#
        AND MSG.EZCANCELFLAG = '0'
        AND MSG.DS_ACCT_NUM = #dsAcctNum#
        AND MSG.LINE_BIZ_TP_CD  = #dsBizLineCd#
        AND MSG.DS_BIZ_AREA_CD = #dsBizAreaCd#
        AND MSG.DS_CUST_MSG_TP_CD = #dsCustMsgTpCd#
    </statement>
    
    <statement id="getLocInfoByAcctNum" parameterClass="Map" resultClass="Map">
       SELECT 
              LOC.PTY_LOC_PK
            , LOC.LOC_NUM
            , PRIN.PRIN_CUST_PK
            , BILL.BILL_TO_CUST_PK
            , BILL.BILL_TO_CUST_CD
            , SHIP.SHIP_TO_CUST_PK
         FROM 
              ACCT_LOC LOC
            , PRIN_CUST PRIN
            , BILL_TO_CUST BILL
            , SHIP_TO_CUST SHIP
        WHERE 
              LOC.GLBL_CMPY_CD = #glblCmpyCd#
          AND LOC.EZCANCELFLAG = '0'
          AND LOC.DS_ACCT_NUM = #dsAcctNum#

          AND LOC.PTY_LOC_PK = PRIN.PTY_LOC_PK(+)
          AND LOC.GLBL_CMPY_CD = PRIN.GLBL_CMPY_CD(+)
          AND PRIN.EZCANCELFLAG(+) = '0'

          AND LOC.PTY_LOC_PK = BILL.PTY_LOC_PK(+)
          AND LOC.GLBL_CMPY_CD = BILL.GLBL_CMPY_CD(+)
          AND BILL.EZCANCELFLAG(+) = '0'

          AND LOC.PTY_LOC_PK = SHIP.PTY_LOC_PK(+)
          AND LOC.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD(+)
          AND SHIP.EZCANCELFLAG(+) = '0'
    </statement>

    <statement id="getDsAcctPrflDefTmpl" parameterClass="Map" resultClass="Map">
        SELECT
              DCAT.CUST_CR_RTG_CD
            , DCAT.CR_LIMIT_AMT
            , DCAT.CR_CHK_REQ_TP_CD
            , DCAT.CR_RISK_CLS_CD
            , DCAT.OVRD_PMT_TERM_FLG
            , DCAT.CASH_OR_CC_REQ_FLG
            , DCAT.CUST_HARD_HLD_FLG
            , DCAT.PMT_TERM_CASH_DISC_CD
            <!-- Start 2019/10/29 H.Ikeda [QC#54311,ADD] -->
            , DCAT.CONTR_CR_RISK_CLS_CD
            , DCAT.AUTO_CASH_HRCH_CD
            <!-- End   2019/10/29 H.Ikeda [QC#54311,ADD] -->
        FROM
            DS_CUST_AR_TMPL DCAT 
        WHERE
            DCAT.GLBL_CMPY_CD = #glblCmpyCd#
        AND DCAT.DS_TMPL_ACTV_FLG = 'Y'
        AND DCAT.DS_DEF_TMPL_FLG = 'Y'
        AND DCAT.EZCANCELFLAG = '0'
        AND ROWNUM = 1
    </statement>

    <statement id="getDefRemId" parameterClass="Map" resultClass="Map">
        SELECT * FROM (
            SELECT
                SRR.REM_ID
            FROM
                ST_REM_RELN SRR
            WHERE 
                SRR.GLBL_CMPY_CD = #glblCmpyCd#
            AND SRR.EZCANCELFLAG = '0'
            AND SRR.ST_CD = #stCd#
            ORDER BY SRR.REM_ID
        )
        WHERE ROWNUM = 1
    </statement>
    
    <statement id="getDefRemIdNoState" parameterClass="Map" resultClass="Map">
        SELECT * FROM (
            SELECT
                SRR.REM_ID
            FROM
                ST_REM_RELN SRR
            WHERE 
                SRR.GLBL_CMPY_CD = #glblCmpyCd#
            AND SRR.EZCANCELFLAG = '0'
            AND (SRR.ST_CD = '*' OR SRR.ST_CD IS NULL)
            ORDER BY SRR.REM_ID
        )
        WHERE ROWNUM = 1
    </statement>

    <statement id="getPtyLocPk" parameterClass="Map" resultClass="BigDecimal">
       SELECT PLW.PTY_LOC_PK AS PTY_LOC_PK
       FROM PTY_LOC_WRK PLW
       WHERE PLW.GLBL_CMPY_CD = #glblCmpyCd#
         AND PLW.EZCANCELFLAG = '0'
         AND PLW.LOC_NUM = #locNum#
    </statement>

    <statement id="getProsPtyLocPk" parameterClass="Map" resultClass="BigDecimal">
       SELECT PLW.PTY_LOC_PK AS PTY_LOC_PK
       FROM PROS_PTY_LOC_WRK PLW
       WHERE PLW.GLBL_CMPY_CD = #glblCmpyCd#
         AND PLW.EZCANCELFLAG = '0'
         AND PLW.LOC_NUM = #locNum#
    </statement>

    <statement id="getPrinCustByAcct" parameterClass="Map" resultClass="Map">
      SELECT PC.PRIN_CUST_PK
           , PC.LOC_NUM
        FROM PRIN_CUST PC
       WHERE PC.GLBL_CMPY_CD = #glblCmpyCd#
         AND PC.EZCANCELFLAG = '0'
         AND PC.CMPY_PK IN (
              SELECT A.CMPY_PK FROM SELL_TO_CUST A 
               WHERE A.EZCANCELFLAG = '0' AND A.GLBL_CMPY_CD = #glblCmpyCd# AND A.SELL_TO_CUST_CD = #dsAcctNum#
           UNION ALL
              SELECT A.CMPY_PK FROM DS_ACCT_PROS A 
               WHERE A.EZCANCELFLAG = '0' AND A.GLBL_CMPY_CD = #glblCmpyCd# AND A.DS_ACCT_NUM = #dsAcctNum#
         )
    </statement>

    <statement id="getPtyLocWrkRgtnStsCd" parameterClass="Map" resultClass="String">
       SELECT PLW.RGTN_STS_CD
         FROM PTY_LOC_WRK PLW
        WHERE PLW.EZCANCELFLAG = '0'
          AND PLW.GLBL_CMPY_CD = #glblCmpyCd#
          AND PLW.LOC_NUM = #locNum#
    </statement>

    <statement id="getProsPtyLocWrkRgtnStsCd" parameterClass="Map" resultClass="String">
       SELECT PLW.RGTN_STS_CD
         FROM PROS_PTY_LOC_WRK PLW
        WHERE PLW.EZCANCELFLAG = '0'
          AND PLW.GLBL_CMPY_CD = #glblCmpyCd#
          AND PLW.LOC_NUM = #locNum#
    </statement>

    <statement id="cntDuplicateDsXrefAcct" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(DXA.DS_XREF_ACCT_CD)
        FROM
            DS_XREF_ACCT DXA
            , PTY_LOC_WRK PLW
            , DS_XREF_ACCT_TP DXAT
        WHERE
            DXA.GLBL_CMPY_CD = #glblCmpyCd#
        AND DXA.EZCANCELFLAG = '0'
        AND DXA.DS_XREF_ACCT_TP_CD = #dsXrefAcctTpCd#
        AND DXA.DS_XREF_ACCT_CD = #dsXrefAcctCd#

        AND DXA.GLBL_CMPY_CD = PLW.GLBL_CMPY_CD
        AND DXA.LOC_NUM = PLW.LOC_NUM
        AND PLW.EZCANCELFLAG = '0'
        AND PLW.RGTN_STS_CD = #rgtnStsCd#

        AND DXA.GLBL_CMPY_CD = DXAT.GLBL_CMPY_CD
        AND DXA.DS_XREF_ACCT_TP_CD = DXAT.DS_XREF_ACCT_TP_CD
        AND DXAT.EZCANCELFLAG = '0'
        AND DXAT.DUP_CHK_FLG = 'Y'

    </statement>

    <statement id="getShipToCustCd" parameterClass="Map" resultClass="Map">
    SELECT
    <!-- QC#29134 Mod Start -->
        SHIP.SHIP_TO_CUST_CD AS SHIP_TO_CUST_CD
     ,  SHIP.LOC_NM          AS LOC_NM
     ,  SHIP.FIRST_LINE_ADDR AS FIRST_LINE_ADDR
     ,  SHIP.SCD_LINE_ADDR   AS SCD_LINE_ADDR
     ,  SHIP.THIRD_LINE_ADDR AS THIRD_LINE_ADDR
     ,  SHIP.FRTH_LINE_ADDR  AS FRTH_LINE_ADDR
     ,  SHIP.CTY_ADDR        AS CTY_ADDR
     ,  SHIP.CNTY_PK         AS CNTY_PK
     ,  SHIP.PROV_NM         AS PROV_NM
     ,  SHIP.ST_CD           AS ST_CD
     ,  SHIP.POST_CD         AS POST_CD
     ,  SHIP.CTRY_CD         AS CTRY_CD
     ,  PLW.LOC_NUM          AS LOC_NUM_PL
     ,  PLW.PTY_LOC_PK       AS PTY_LOC_PK
    <!-- QC#29134 Mod End -->
    FROM
        SHIP_TO_CUST SHIP
    <!-- QC#29134 Add Start -->
       ,PTY_LOC_WRK  PLW
    <!-- QC#29134 Add End -->
    WHERE
        SHIP.GLBL_CMPY_CD    = #glblCmpyCd#
    AND SHIP.EZCANCELFLAG    = '0'
    AND SHIP.LOC_NUM         = #locNum#
    AND
      ( SHIP.LOC_ROLE_TP_CD  = #locRoleTp_WareHouse#
     OR SHIP.LOC_ROLE_TP_CD  = #locRoleTp_Technician#
      )
    <!-- QC#29134 Add Start -->
    AND SHIP.GLBL_CMPY_CD    = PLW.GLBL_CMPY_CD (+)
    AND SHIP.PTY_LOC_PK      = PLW.PTY_LOC_PK (+)
    AND PLW.EZCANCELFLAG (+) = '0'
    <!-- QC#29134 Add End -->
    </statement>

  <statement id="getWareHouse" parameterClass="Map" resultClass="Map">
    (    SELECT
            'WH_CD' AS WH
         ,  SWH.RTL_WH_CD
         ,  STC.SHIP_TO_CUST_CD
         ,  STC.PTY_LOC_PK
        FROM
            RTL_SWH SWH
         ,  SHIP_TO_CUST STC
        WHERE
            SWH.GLBL_CMPY_CD = #glblCmpyCd#
        AND SWH.EZCANCELFLAG = '0'

        AND ( SWH.RTL_WH_CD  = #shipToCustCd#
           OR SWH.RTL_WH_CD IN
                  ( SELECT
                        RTL_WH_CD
                    FROM
                        RTL_SWH SWH2
                    WHERE
                        SWH2.GLBL_CMPY_CD = #glblCmpyCd#
                    AND SWH2.INVTY_LOC_CD = #shipToCustCd#
                    AND SWH2.EZCANCELFLAG = '0'
                  )
            )

        AND SWH.GLBL_CMPY_CD = STC.GLBL_CMPY_CD
        AND STC.EZCANCELFLAG = '0'
        AND SWH.RTL_WH_CD    = STC.SHIP_TO_CUST_CD
    UNION
        SELECT
            'SWH_CD' AS WH
         ,  SWH.INVTY_LOC_CD
         ,  STC.SHIP_TO_CUST_CD
         ,  STC.PTY_LOC_PK
        FROM
            RTL_SWH SWH
         ,  SHIP_TO_CUST STC
        WHERE
            SWH.GLBL_CMPY_CD = #glblCmpyCd#
        AND SWH.EZCANCELFLAG = '0'

        AND ( SWH.RTL_WH_CD  = #shipToCustCd#
           OR SWH.RTL_WH_CD IN
                  ( SELECT
                        RTL_WH_CD
                    FROM
                        RTL_SWH SWH2
                    WHERE
                        SWH2.GLBL_CMPY_CD = #glblCmpyCd#
                    AND SWH2.INVTY_LOC_CD = #shipToCustCd#
                    AND SWH2.EZCANCELFLAG = '0'
                  )
            )

        AND SWH.GLBL_CMPY_CD = STC.GLBL_CMPY_CD
        AND STC.EZCANCELFLAG = '0'
        AND SWH.INVTY_LOC_CD = STC.SHIP_TO_CUST_CD
    )
  </statement>

    <!-- START 2019/04/16 Hd.Sugawara [QC#31114,ADD] -->
    <statement id="getTemplateForFinancials" parameterClass="Map" resultClass="Map">
        SELECT
              DCAT.AR_STMT_FLG
            , DCAT.AR_STMT_ISS_DAY
            , DCAT.CLT_CUST_TP_CD
            , DCAT.CLT_PTFO_PK
            , DCAT.DS_CLT_ACCT_STS_CD
            , DCAT.DS_CUST_TAX_CALC_CD
            , DCAT.DS_EXEM_EXPR_DT
            , DCAT.DS_TAX_EXEM_FLG
            , DCAT.DS_TAX_GRP_EXEM_CD
            , DCAT.DS_TAX_PRNT_TP_CD
            , DCAT.DUN_FLG
            , DCAT.LATE_FEE_AMT
            , DCAT.LATE_FEE_FLG
            , DCAT.REM_ID
            , DCAT.SEND_CR_BAL_STMT_FLG
        FROM
              DS_CUST_AR_TMPL DCAT 
        WHERE
            DCAT.GLBL_CMPY_CD     = #glblCmpyCd#
        AND DCAT.EZCANCELFLAG     = '0'
        AND DCAT.DS_TMPL_ACTV_FLG = #flgOnY#
        AND DCAT.DS_DEF_TMPL_FLG  = #flgOnY#

        AND ROWNUM                = 1
    </statement>
    <!-- END 2019/04/16 Hd.Sugawara [QC#31114,ADD] -->
</sqlMap>
