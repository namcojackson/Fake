<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NMAL6700Query">
    <typeAlias alias="NMAL6700SMsg"     type="business.blap.NMAL6700.NMAL6700SMsg"/>
    <typeAlias alias="DS_ACCT_INAC_RSNTMsg"       type="business.db.DS_ACCT_INAC_RSNTMsg"/>
    <typeAlias alias="PTY_LOC_WRKTMsg"            type="business.db.PTY_LOC_WRKTMsg"/>
    <typeAlias alias="PROS_PTY_LOC_WRKTMsg"       type="business.db.PROS_PTY_LOC_WRKTMsg"/>
    <typeAlias alias="ALT_PAYERTMsg"              type="business.db.ALT_PAYERTMsg"/>
    <typeAlias alias="DS_SPCL_HDLG_TPTMsg"        type="business.db.DS_SPCL_HDLG_TPTMsg"/>

<statement id="getDsAcctInfo" parameterClass="Map" resultClass="Map">
        SELECT ACCT.*
        ,CH.COA_CH_NM AS COA_CH_NM
        ,AFFL.COA_AFFL_NM AS COA_AFFL_NM
        ,CC.COA_CC_NM AS COA_CC_NM
        ,ISS.AR_STMT_ISS_CYCLE_CD AS AR_STMT_ISS_CYCLE_CD
        ,PTFO.CLT_PTFO_CD AS CLT_PTFO_CD
        ,PTFO.CLT_PTFO_DESC_TXT AS CLT_PTFO_DESC_TXT
        ,CCT.CLT_CUST_TP_NM AS CLT_CUST_TP_NM
         FROM 

        (SELECT

            CUST.EZUPTIME AS EZUPTIME
            ,CUST.EZUPTIMEZONE AS EZUPTIMEZONE 
            ,CUST.GLBL_CMPY_CD AS GLBL_CMPY_CD
            ,CUST.SELL_TO_CUST_PK AS DS_ACCT_PK
            ,CUST.SELL_TO_CUST_CD AS DS_ACCT_NUM
            ,CUST.DS_ACCT_NM AS DS_ACCT_NM
            ,CUST.RGTN_STS_CD AS RGTN_STS_CD
            ,CUST.DS_ACCT_INAC_RSN_CD AS DS_ACCT_INAC_RSN_CD
            ,CUST.EFF_THRU_DT AS EFF_THRU_DT
            ,CUST.DS_ACCT_TP_CD AS DS_ACCT_TP_CD
            ,CUST.DS_ACCT_ITRL_FLG AS DS_ACCT_ITRL_FLG
            ,CUST.DS_ACCT_CLS_CD AS DS_ACCT_CLS_CD
            ,CUST.COA_CH_CD AS COA_CH_CD
            ,CUST.COA_AFFL_CD AS COA_AFFL_CD
            ,CUST.DS_ACCT_DLR_CD AS DS_ACCT_DLR_CD
            ,CUST.DS_ACCT_LEGAL_NM AS DS_ACCT_LEGAL_NM
            ,CUST.DBA_NM AS DBA_NM
            ,CUST.DS_ACCT_DUNS_NM AS DS_ACCT_DUNS_NM
            ,CUST.DS_ACCT_ALT_NM AS DS_ACCT_ALT_NM
            ,CUST.DS_XTRNL_REF_TXT AS DS_XTRNL_REF_TXT
            ,CUST.DS_DATA_SRC_TXT  AS DS_DATA_SRC_TXT
            ,CUST.DS_ACCT_ACTV_CUST_FLG AS DS_ACCT_ACTV_CUST_FLG
            ,CASE WHEN EXISTS (
               SELECT 1 FROM DS_ACCT_TRX_INFO T 
                WHERE T.DS_ACCT_NUM = CUST.SELL_TO_CUST_CD
                  AND T.GLBL_CMPY_CD = CUST.GLBL_CMPY_CD 
                  AND T.EZCANCELFLAG = '0' 
                  AND T.ACCT_TRX_EXST_FLG = 'Y'
             ) THEN 'Y' ELSE 'N' END ACCT_TRX_EXST_FLG
            ,CUST.CMPY_PK AS CMPY_PK
            ,CUST.PTY_LOC_PK AS PTY_LOC_PK
            <!-- Marketing Tab items -->
            ,CUST.DS_ACCT_DUNS_NUM AS DS_ACCT_DUNS_NUM
            ,CUST.DS_ULT_DUNS_NUM AS DS_ULT_DUNS_NUM
            ,CUST.DS_LOC_EMP_NUM AS DS_LOC_EMP_NUM
            ,CUST.DS_LOC_REV_AMT AS DS_LOC_REV_AMT
            ,CUST.DS_CUST_SIC_CD AS DS_CUST_SIC_CD
            ,CUST.DS_LAST_UPD_DUNS_DT AS DS_LAST_UPD_DUNS_DT
            <!-- Credit/Collection Tab items -->
            ,CUST.AR_STMT_FLG AS AR_STMT_FLG
            ,CUST.AR_STMT_ISS_DAY AS AR_STMT_ISS_DAY
            ,CUST.DUN_FLG AS DUN_FLG
            ,CUST.CLT_CUST_TP_CD  AS CLT_CUST_TP_CD
            ,CUST.CLT_PTFO_PK AS CLT_PTFO_PK
            ,CUST.DS_CLT_ACCT_STS_CD AS DS_CLT_ACCT_STS_CD
            ,CUST.LATE_FEE_FLG  AS LATE_FEE_FLG
            ,CUST.LATE_FEE_AMT  AS LATE_FEE_AMT
            ,CUST.DS_CUST_TAX_CD AS DS_CUST_TAX_CD
            ,CUST.DS_CUST_TAX_CALC_CD AS DS_CUST_TAX_CALC_CD
            ,CUST.DS_TAX_EXEM_FLG AS DS_TAX_EXEM_FLG
            ,CUST.DS_EXEM_EXPR_DT AS DS_EXEM_EXPR_DT
            ,CUST.DS_TAX_GRP_EXEM_CD AS DS_TAX_GRP_EXEM_CD
            ,CUST.DS_TAX_PRNT_TP_CD AS DS_TAX_PRNT_TP_CD
            
            ,CUST.SEND_CR_BAL_STMT_FLG AS SEND_CR_BAL_STMT_FLG
            <!-- Invoice/Billing Tab items -->
            ,CUST.DEF_BASE_TP_CD AS DEF_BASE_TP_CD
            ,CUST.DEF_BASE_CYCLE_CD AS DEF_BASE_CYCLE_CD
            ,CUST.DEF_USG_TP_CD AS DEF_USG_TP_CD
            ,CUST.DEF_USG_CYCLE_CD AS DEF_USG_CYCLE_CD
            <!-- START 2022/03/22 [QC#59683, MOD] -->
            <!-- ,CUST.DS_BILL_TGTR_FLG AS DS_BILL_TGTR_FLG -->
            ,CUST.DS_INV_TGTR_TP_CD AS DS_INV_TGTR_TP_CD
            <!-- END   2022/03/22 [QC#59683, MOD] -->
            <!-- Transaction Tab items -->
            ,CUST.COA_CC_CD AS COA_CC_CD
            , CUST.EZINTIME             AS XX_REC_HIST_CRAT_TS
            , CUST.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
            , CUST.EZUPTIME             AS XX_REC_HIST_UPD_TS
            , CUST.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
            , 'SELL_TO_CUST'            AS XX_REC_HIST_TBL_NM
            <!-- 2023/11/06 QC#61924 Add Start -->
            , CUST.DEAC_NEW_TRX_FLG     AS DEAC_NEW_TRX_FLG
            <!-- 2023/11/06 QC#61924 Add End -->
         FROM SELL_TO_CUST CUST
        WHERE CUST.GLBL_CMPY_CD = #glblCmpyCd#
        AND CUST.EZCANCELFLAG = '0'
        AND CUST.SELL_TO_CUST_CD = #dsAcctNum#

        UNION ALL

        SELECT 

            PROS.EZUPTIME AS EZUPTIME
            ,PROS.EZUPTIMEZONE AS EZUPTIMEZONE
            ,PROS.GLBL_CMPY_CD AS GLBL_CMPY_CD
            ,PROS.DS_ACCT_PROS_PK AS DS_ACCT_PK
            ,PROS.DS_ACCT_NUM AS DS_ACCT_NUM
            ,PROS.DS_ACCT_NM AS DS_ACCT_NM
            ,PROS.RGTN_STS_CD AS RGTN_STS_CD
            ,PROS.DS_ACCT_INAC_RSN_CD AS DS_ACCT_INAC_RSN_CD
            ,PROS.EFF_THRU_DT AS EFF_THRU_DT
            ,PROS.DS_ACCT_TP_CD AS DS_ACCT_TP_CD
            ,PROS.DS_ACCT_ITRL_FLG AS DS_ACCT_ITRL_FLG
            ,PROS.DS_ACCT_CLS_CD AS DS_ACCT_CLS_CD
            ,PROS.COA_CH_CD AS COA_CH_CD
            ,PROS.COA_AFFL_CD AS COA_AFFL_CD
            ,PROS.DS_ACCT_DLR_CD AS DS_ACCT_DLR_CD
            ,PROS.DS_ACCT_LEGAL_NM AS DS_ACCT_LEGAL_NM
            ,PROS.DBA_NM AS DBA_NM
            ,PROS.DS_ACCT_DUNS_NM AS DS_ACCT_DUNS_NM
            ,PROS.DS_ACCT_ALT_NM AS DS_ACCT_ALT_NM
            ,PROS.DS_XTRNL_REF_TXT AS DS_XTRNL_REF_TXT
            ,PROS.DS_DATA_SRC_TXT  AS DS_DATA_SRC_TXT
            ,PROS.DS_ACCT_ACTV_CUST_FLG AS DS_ACCT_ACTV_CUST_FLG
            ,CASE WHEN EXISTS (
               SELECT 1 FROM DS_ACCT_TRX_INFO T 
                WHERE T.DS_ACCT_NUM = PROS.DS_ACCT_NUM
                  AND T.GLBL_CMPY_CD = PROS.GLBL_CMPY_CD 
                  AND T.EZCANCELFLAG = '0' 
                  AND T.ACCT_TRX_EXST_FLG = 'Y'
             ) THEN 'Y' ELSE 'N' END ACCT_TRX_EXST_FLG
            ,PROS.CMPY_PK AS CMPY_PK
            ,PROS.PTY_LOC_PK AS PTY_LOC_PK
            <!-- Marketing Tab items -->
            ,PROS.DS_ACCT_DUNS_NUM AS DS_ACCT_DUNS_NUM
            ,PROS.DS_ULT_DUNS_NUM AS DS_ULT_DUNS_NUM
            ,PROS.DS_LOC_EMP_NUM AS DS_LOC_EMP_NUM
            ,PROS.DS_LOC_REV_AMT AS DS_LOC_REV_AMT
            ,PROS.DS_CUST_SIC_CD AS DS_CUST_SIC_CD
            ,PROS.DS_LAST_UPD_DUNS_DT AS DS_LAST_UPD_DUNS_DT
            <!-- Credit/Collection Tab items -->
            ,PROS.AR_STMT_FLG AS AR_STMT_FLG
            ,PROS.AR_STMT_ISS_DAY AS AR_STMT_ISS_DAY
            ,PROS.DUN_FLG AS DUN_FLG
            ,PROS.CLT_CUST_TP_CD AS CLT_CUST_TP_CD
            ,PROS.CLT_PTFO_PK AS CLT_PTFO_PK
            ,PROS.DS_CLT_ACCT_STS_CD AS DS_CLT_ACCT_STS_CD
            ,PROS.LATE_FEE_FLG AS LATE_FEE_FLG
            ,PROS.LATE_FEE_AMT AS LATE_FEE_AMT
            ,PROS.DS_CUST_TAX_CD AS DS_CUST_TAX_CD
            ,PROS.DS_CUST_TAX_CALC_CD AS DS_CUST_TAX_CALC_CD
            ,PROS.DS_TAX_EXEM_FLG AS DS_TAX_EXEM_FLG
            ,PROS.DS_EXEM_EXPR_DT AS DS_EXEM_EXPR_DT
            ,PROS.DS_TAX_GRP_EXEM_CD AS DS_TAX_GRP_EXEM_CD
            ,PROS.DS_TAX_PRNT_TP_CD AS DS_TAX_PRNT_TP_CD
            
            ,PROS.SEND_CR_BAL_STMT_FLG AS SEND_CR_BAL_STMT_FLG
            <!-- Invoice/Billing Tab items -->
            ,PROS.DEF_BASE_TP_CD AS DEF_BASE_TP_CD
            ,PROS.DEF_BASE_CYCLE_CD AS DEF_BASE_CYCLE_CD
            ,PROS.DEF_USG_TP_CD AS DEF_USG_TP_CD
            ,PROS.DEF_USG_CYCLE_CD AS DEF_USG_CYCLE_CD
            <!-- START 2022/03/22 [QC#59683, MOD] -->
            <!-- ,PROS.DS_BILL_TGTR_FLG AS DS_BILL_TGTR_FLG -->
            ,PROS.DS_INV_TGTR_TP_CD AS DS_INV_TGTR_TP_CD
            <!-- END   2022/03/22 [QC#59683, MOD] -->
            <!-- Transaction Tab items -->
            ,PROS.COA_CC_CD AS COA_CC_CD
            , PROS.EZINTIME             AS XX_REC_HIST_CRAT_TS
            , PROS.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
            , PROS.EZUPTIME             AS XX_REC_HIST_UPD_TS
            , PROS.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
            , 'DS_ACCT_PROS'            AS XX_REC_HIST_TBL_NM
            <!-- 2023/11/06 QC#61924 Add Start -->
            , 'N'                       AS DEAC_NEW_TRX_FLG
            <!-- 2023/11/06 QC#61924 Add End -->

         FROM DS_ACCT_PROS PROS
        WHERE PROS.GLBL_CMPY_CD = #glblCmpyCd#
        AND PROS.EZCANCELFLAG = '0'
        AND PROS.DS_ACCT_NUM = #dsAcctNum#)  ACCT
        , COA_CH CH
        , COA_AFFL AFFL
        , COA_CC CC
        , AR_STMT_ISS_CYCLE ISS
        , CLT_PTFO PTFO
        , CLT_CUST_TP CCT
        WHERE ACCT.GLBL_CMPY_CD = CH.GLBL_CMPY_CD(+)
        AND ACCT.COA_CH_CD = CH.COA_CH_CD(+)
        AND CH.EZCANCELFLAG(+) = '0'

        AND ACCT.GLBL_CMPY_CD = AFFL.GLBL_CMPY_CD(+)
        AND ACCT.COA_AFFL_CD = AFFL.COA_AFFL_CD(+)
        AND AFFL.EZCANCELFLAG(+) = '0'

        AND ACCT.GLBL_CMPY_CD = CC.GLBL_CMPY_CD(+)
        AND ACCT.COA_CC_CD = CC.COA_CC_CD(+)
        AND CC.EZCANCELFLAG(+) = '0'

        AND ACCT.GLBL_CMPY_CD = ISS.GLBL_CMPY_CD(+)
        AND ACCT.AR_STMT_ISS_DAY = ISS.AR_STMT_ISS_DAY(+)
        AND ISS.EZCANCELFLAG(+) = '0'

        AND ACCT.GLBL_CMPY_CD = PTFO.GLBL_CMPY_CD(+)
        AND ACCT.CLT_PTFO_PK = PTFO.CLT_PTFO_PK(+)
        AND PTFO.EZCANCELFLAG(+) = '0'

        AND ACCT.GLBL_CMPY_CD = CCT.GLBL_CMPY_CD(+)
        AND ACCT.CLT_CUST_TP_CD = CCT.CLT_CUST_TP_CD(+)
        AND CCT.EZCANCELFLAG(+) = '0'
    </statement>

    <statement id="getPrinCust" parameterClass="Map" resultClass="Map">
        SELECT
            PRIN.PRIN_CUST_PK AS PRIN_CUST_PK
            ,PRIN.EZUPTIME AS EZUPTIME 
            ,PRIN.EZUPTIMEZONE AS EZUPTIMEZONE
        FROM ACCT_LOC LOC
            , PRIN_CUST PRIN
            <!-- START 2022/05/30 K.Ogino [QC#59957,ADD] -->
            , SELL_TO_CUST STC
            <!-- START 2022/06/30 K.Ogino [QC#59957,ADD] -->
        WHERE LOC.GLBL_CMPY_CD = #glblCmpyCd#
        AND LOC.EZCANCELFLAG = '0'
        AND LOC.DS_ACCT_NUM = #dsAcctNum#
        <!-- START 2020/10/02 J.Evangelista [QC#57745,ADD] -->
        AND LOC.RGTN_STS_CD != #rgtnStsCd#
        <!-- END   2020/10/02 J.Evangelista [QC#57745,ADD] -->
        
        AND LOC.GLBL_CMPY_CD = PRIN.GLBL_CMPY_CD
        AND LOC.LOC_NUM = PRIN.LOC_NUM
        AND PRIN.EZCANCELFLAG = '0'
        <!-- START 2022/05/30 K.Ogino [QC#59957,ADD] -->
        AND LOC.GLBL_CMPY_CD = STC.GLBL_CMPY_CD
        AND LOC.DS_ACCT_NUM  = STC.SELL_TO_CUST_CD
        AND LOC.LOC_NUM      = STC.LOC_NUM
        AND STC.EZCANCELFLAG = '0'
        <!-- START 2022/06/30 K.Ogino [QC#59957,ADD] -->
    </statement>

    <statement id="getPrinCustBefCreateAcctLoc" parameterClass="Map" resultClass="Map">
        SELECT
            PRIN.PRIN_CUST_PK AS PRIN_CUST_PK
            ,PRIN.EZUPTIME AS EZUPTIME 
            ,PRIN.EZUPTIMEZONE AS EZUPTIMEZONE
        FROM
            PRIN_CUST PRIN
        WHERE
            PRIN.GLBL_CMPY_CD = #glblCmpyCd#
        AND PRIN.EZCANCELFLAG = '0'
        AND PRIN.PTY_LOC_PK = #ptyLocPk#
    </statement>

    <statement id="getPrinCustAftDelPrimLocFlg" parameterClass="Map" resultClass="Map">
        SELECT
             PRIN.PRIN_CUST_PK AS PRIN_CUST_PK
            ,PRIN.EZUPTIME AS EZUPTIME 
            ,PRIN.EZUPTIMEZONE AS EZUPTIMEZONE
        FROM
            PRIN_CUST PRIN
          , (SELECT A.CMPY_PK FROM SELL_TO_CUST A WHERE A.EZCANCELFLAG = '0' AND A.GLBL_CMPY_CD = #glblCmpyCd# AND A.SELL_TO_CUST_CD = #dsAcctNum#
             UNION
             SELECT A.CMPY_PK FROM DS_ACCT_PROS A WHERE A.EZCANCELFLAG = '0' AND A.GLBL_CMPY_CD = #glblCmpyCd# AND A.DS_ACCT_NUM = #dsAcctNum#
            ) ACCT
        WHERE
            PRIN.GLBL_CMPY_CD = #glblCmpyCd#
        AND PRIN.EZCANCELFLAG = '0'
        AND PRIN.CMPY_PK = ACCT.CMPY_PK
    </statement>

    <statement id="getDsAcctNumByAcctNm" parameterClass="Map" resultClass="String">
        SELECT
                DA.SELL_TO_CUST_CD AS DS_ACCT_NUM
        FROM
                SELL_TO_CUST DA
        WHERE
                DA.GLBL_CMPY_CD         = #glblCmpyCd#
        AND     DA.DS_ACCT_NM           = #dsAcctNm#
        <isNotNull property="excludeDsAcctNum">
        AND     DA.SELL_TO_CUST_CD         != #excludeDsAcctNum#
        </isNotNull>
        AND     DA.EZCANCELFLAG         = '0'
        UNION
        SELECT
                DA.DS_ACCT_NUM
        FROM
                DS_ACCT_PROS DA
        WHERE
                DA.GLBL_CMPY_CD         = #glblCmpyCd#
        AND     DA.DS_ACCT_NM           = #dsAcctNm#
        <isNotNull property="excludeDsAcctNum">
        AND     DA.DS_ACCT_NUM         != #excludeDsAcctNum#
        </isNotNull>
        AND     DA.EZCANCELFLAG         = '0'
    </statement>
    
    <statement id="getProspectLocationList" parameterClass="Map" resultClass="Map">
        SELECT
            V.LOC_NUM
           ,V.FIRST_LINE_ADDR
           ,V.SCD_LINE_ADDR
           ,V.CTY_ADDR
           ,V.ST_CD
           ,V.POST_CD
           ,V.BILL_TO_FLG
           ,V.SHIP_TO_FLG
           ,V.PRIMARY_FLG
           ,SUBSTR (
                    (
                     SELECT
                         LISTAGG(LOC_AL.DS_ACCT_NUM, ',') WITHIN GROUP (ORDER BY LOC_AL.DS_ACCT_NUM)
                     FROM
                         ACCT_LOC LOC_AL
                     WHERE
                         LOC_AL.GLBL_CMPY_CD     = V.GLBL_CMPY_CD
                         AND LOC_AL.LOC_NUM      = V.LOC_NUM
                         AND LOC_AL.EZCANCELFLAG = '0'
                    ), 1, 400
                   ) AS XX_RELN_DS_ACCT_TXT
           ,V.EFF_FROM_DT
           ,V.EFF_THRU_DT
           ,V.RGTN_STS_CD
           ,V.DPLY_FLG
           ,V.CTRY_CD
           ,V.THIRD_LINE_ADDR
           ,V.FRTH_LINE_ADDR
           ,(
             SELECT
                 C.CNTY_NM
             FROM
                 CNTY C
             WHERE
                 C.GLBL_CMPY_CD     = V.GLBL_CMPY_CD
                 AND C.CNTY_PK      = V.CNTY_PK
                 AND C.EZCANCELFLAG = '0'
                 AND ROWNUM         = 1
            ) CNTY_NM
           ,V.PROV_NM
           ,V.BILL_TO_EFF_FROM_DT_TXT
           ,V.BILL_TO_EFF_THRU_DT_TXT
           ,V.SHIP_TO_EFF_FROM_DT_TXT
           ,V.SHIP_TO_EFF_THRU_DT_TXT
           ,V.DS_LOC_NM
           ,V.LINE_BIZ_TP_CD
           , V.XX_REC_HIST_CRAT_TS
           , V.XX_REC_HIST_CRAT_BY_NM
           , V.XX_REC_HIST_UPD_TS
           , V.XX_REC_HIST_UPD_BY_NM
           , V.XX_REC_HIST_TBL_NM
        FROM
            (
             SELECT
                 PROS.GLBL_CMPY_CD    AS GLBL_CMPY_CD
                ,PTY.LOC_NUM         AS LOC_NUM
                ,PTY.FIRST_LINE_ADDR AS FIRST_LINE_ADDR
                ,PTY.SCD_LINE_ADDR   AS SCD_LINE_ADDR
                ,PTY.CTY_ADDR        AS CTY_ADDR
                ,PTY.ST_CD           AS ST_CD
                ,PTY.POST_CD         AS POST_CD
                ,PTY.CNTY_PK         AS CNTY_PK
                ,'N'                 AS BILL_TO_FLG
                ,'N'                 AS SHIP_TO_FLG
                ,'N'                 AS PRIMARY_FLG
                ,PTY.EFF_FROM_DT     AS EFF_FROM_DT
                ,PTY.EFF_THRU_DT     AS EFF_THRU_DT
                ,PTY.RGTN_STS_CD     AS RGTN_STS_CD
                ,CASE WHEN #salesDate#  &lt;= NVL(PTY.EFF_THRU_DT, #maxEffThruDt#) THEN 'Y' ELSE 'N' END AS DPLY_FLG
                ,PTY.CTRY_CD         AS CTRY_CD
                ,PTY.THIRD_LINE_ADDR AS THIRD_LINE_ADDR
                ,PTY.FRTH_LINE_ADDR  AS FRTH_LINE_ADDR
                ,PTY.PROV_NM         AS PROV_NM
                ,''                  AS BILL_TO_EFF_FROM_DT_TXT
                ,''                  AS BILL_TO_EFF_THRU_DT_TXT
                ,''                  AS SHIP_TO_EFF_FROM_DT_TXT
                ,''                  AS SHIP_TO_EFF_THRU_DT_TXT
                ,PTY.DS_LOC_NM       AS DS_LOC_NM
                ,PTY.LINE_BIZ_TP_CD  AS LINE_BIZ_TP_CD
                , PTY.EZINTIME             AS XX_REC_HIST_CRAT_TS
                , PTY.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
                , PTY.EZUPTIME             AS XX_REC_HIST_UPD_TS
                , PTY.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
                , 'PROS_PTY_LOC_WRK'       AS XX_REC_HIST_TBL_NM
             FROM
                 DS_ACCT_PROS      PROS
                 ,PROS_PTY_LOC_WRK PTY
                ,CNTY              CNTY
                <isEqual property="showInactiveFlg" compareValue="Y">
                    ,(SELECT
                          PPTY.GLBL_CMPY_CD
                         ,PROS.DS_ACCT_NUM
                         ,PPTY.LOC_NUM
                         ,PPTY.RGTN_STS_CD
                         ,PPTY.EFF_FROM_DT
                         ,RANK() OVER(PARTITION BY PROS.DS_ACCT_NUM, PPTY.LOC_NUM, PPTY.RGTN_STS_CD ORDER BY PROS.DS_ACCT_NUM, PPTY.LOC_NUM, PPTY.RGTN_STS_CD, PPTY.EFF_FROM_DT DESC) RANK
                      FROM
                          DS_ACCT_PROS      PROS
                          ,PROS_PTY_LOC_WRK PPTY
                      WHERE
                          PROS.GLBL_CMPY_CD = #glblCmpyCd#
                      AND PROS.DS_ACCT_NUM  = #dsAcctNum#
                      AND PROS.EZCANCELFLAG = '0'
                      AND PROS.GLBL_CMPY_CD = PPTY.GLBL_CMPY_CD
                      AND PROS.PTY_LOC_PK   = PPTY.PTY_LOC_PK
                      AND PPTY.EZCANCELFLAG = '0'
                     ) AL
                </isEqual>
             WHERE
                 PROS.GLBL_CMPY_CD = #glblCmpyCd#
                 AND PROS.DS_ACCT_NUM  = #dsAcctNum#
                 AND PROS.EZCANCELFLAG = '0'

                 <isEqual property="showInactiveFlg" compareValue="Y">
                     AND PROS.GLBL_CMPY_CD = AL.GLBL_CMPY_CD
                     AND PROS.DS_ACCT_NUM  = AL.DS_ACCT_NUM
                     AND PROS.LOC_NUM      = AL.LOC_NUM
                     AND PROS.RGTN_STS_CD  = AL.RGTN_STS_CD 
                     AND PROS.EFF_FROM_DT  = AL.EFF_FROM_DT 
                     AND AL.RANK          = 1
                 </isEqual>

                 AND PROS.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD
                 AND PROS.LOC_NUM      = PTY.LOC_NUM
                 AND PTY.EZCANCELFLAG = '0'

                 AND PTY.GLBL_CMPY_CD     = CNTY.GLBL_CMPY_CD(+)
                 AND PTY.CNTY_PK          = CNTY.CNTY_PK(+)
                 AND CNTY.EZCANCELFLAG(+) = '0'

                 <isNotEqual property="showInactiveFlg" compareValue="Y">
                     AND #salesDate#  &lt;= NVL(PTY.EFF_THRU_DT, #maxEffThruDt#)
                     <iterate property="rgtnStsCdList" var="rgtnStsCdList[]" open="AND PTY.RGTN_STS_CD IN (" close=")" conjunction=",">
                         #rgtnStsCdList[]#
                     </iterate>
                 </isNotEqual>
                 <!-- Filter items -->
                 <isNotNull property="locNum">
                     AND PROS.LOC_NUM = #locNum#
                 </isNotNull>
             ORDER BY
                 FIRST_LINE_ADDR
                ,SCD_LINE_ADDR
                ,CTY_ADDR
                ,ST_CD
                ,POST_CD
            ) V
        WHERE
            ROWNUM &lt;= #limitRownum#
    </statement>
    
    <statement id="getLocationList" parameterClass="Map" resultClass="Map">
        SELECT
            V.LOC_NUM
           ,V.FIRST_LINE_ADDR
           ,V.SCD_LINE_ADDR
           ,V.CTY_ADDR
           ,V.ST_CD
           ,V.POST_CD
           ,V.BILL_TO_FLG
           ,V.SHIP_TO_FLG
           ,V.PRIMARY_FLG
           <!-- QC#25154 Del Start -->
           <!--
           ,SUBSTR (
                    (
                     SELECT
                         LISTAGG(LOC_AL.DS_ACCT_NUM, ',') WITHIN GROUP (ORDER BY LOC_AL.DS_ACCT_NUM)
                     FROM
                         ACCT_LOC LOC_AL
                     WHERE
                         LOC_AL.GLBL_CMPY_CD     = V.GLBL_CMPY_CD
                         AND LOC_AL.LOC_NUM      = V.LOC_NUM
                         AND LOC_AL.EZCANCELFLAG = '0'
                    ), 1, 400
                   ) AS XX_RELN_DS_ACCT_TXT
            -->
           <!-- QC#25154 Del End -->
           <!-- QC#25154 Add Start -->
           ,SUBSTR(AL.XX_RELN_DS_ACCT_TXT,1,400) AS XX_RELN_DS_ACCT_TXT
           <!-- QC#25154 Add End -->
           ,V.EFF_FROM_DT
           ,V.EFF_THRU_DT
           ,V.RGTN_STS_CD
           ,V.DPLY_FLG
           ,V.CTRY_CD
           ,V.THIRD_LINE_ADDR
           ,V.FRTH_LINE_ADDR
           <!-- QC#25154 Del Start -->
           <!--
           ,(
             SELECT
                 C.CNTY_NM
             FROM
                 CNTY C
             WHERE
                 C.GLBL_CMPY_CD     = V.GLBL_CMPY_CD
                 AND C.CNTY_PK      = V.CNTY_PK
                 AND C.EZCANCELFLAG = '0'
                 AND ROWNUM         = 1
            ) CNTY_NM
            -->
           <!-- QC#25154 Del End -->
           <!-- QC#25154 Add Start -->
           ,C.CNTY_NM
           <!-- QC#25154 Add End -->
           ,V.PROV_NM
           ,V.BILL_TO_EFF_FROM_DT_TXT
           ,V.BILL_TO_EFF_THRU_DT_TXT
           ,V.SHIP_TO_EFF_FROM_DT_TXT
           ,V.SHIP_TO_EFF_THRU_DT_TXT
           ,V.DS_LOC_NM
           ,V.LINE_BIZ_TP_CD
           , V.XX_REC_HIST_CRAT_TS
           , V.XX_REC_HIST_CRAT_BY_NM
           , V.XX_REC_HIST_UPD_TS
           , V.XX_REC_HIST_UPD_BY_NM
           , V.XX_REC_HIST_TBL_NM
        FROM
            (
             SELECT
                 LOC.GLBL_CMPY_CD    AS GLBL_CMPY_CD
                ,PTY.LOC_NUM         AS LOC_NUM
                ,PTY.FIRST_LINE_ADDR AS FIRST_LINE_ADDR
                ,PTY.SCD_LINE_ADDR   AS SCD_LINE_ADDR
                ,PTY.CTY_ADDR        AS CTY_ADDR
                ,PTY.ST_CD           AS ST_CD
                ,PTY.POST_CD         AS POST_CD
                ,PTY.CNTY_PK         AS CNTY_PK
                ,CASE WHEN BILL.BILL_TO_CUST_CD IS NOT NULL THEN 'Y' ELSE 'N' END AS BILL_TO_FLG
                ,CASE WHEN SHIP.SHIP_TO_CUST_CD IS NOT NULL THEN 'Y' ELSE 'N' END AS SHIP_TO_FLG
                ,CASE WHEN PRIN.PRIN_CUST_PK IS NOT NULL    THEN 'Y' ELSE 'N' END AS PRIMARY_FLG
                ,LOC.EFF_FROM_DT     AS EFF_FROM_DT
                ,LOC.EFF_THRU_DT     AS EFF_THRU_DT
                ,PTY.RGTN_STS_CD     AS RGTN_STS_CD
                ,CASE WHEN #salesDate#  &lt;= NVL(LOC.EFF_THRU_DT, #maxEffThruDt#) THEN 'Y' ELSE 'N' END AS DPLY_FLG
                ,PTY.CTRY_CD         AS CTRY_CD
                ,PTY.THIRD_LINE_ADDR AS THIRD_LINE_ADDR
                ,PTY.FRTH_LINE_ADDR  AS FRTH_LINE_ADDR
                ,PTY.PROV_NM         AS PROV_NM
                ,TO_CHAR( TO_DATE(BILL.EFF_FROM_DT, 'YYYYMMDD'), 'MM/DD/YYYY') BILL_TO_EFF_FROM_DT_TXT
                ,TO_CHAR( TO_DATE(BILL.EFF_THRU_DT, 'YYYYMMDD'), 'MM/DD/YYYY') BILL_TO_EFF_THRU_DT_TXT
                ,TO_CHAR( TO_DATE(SHIP.EFF_FROM_DT, 'YYYYMMDD'), 'MM/DD/YYYY') SHIP_TO_EFF_FROM_DT_TXT
                ,TO_CHAR( TO_DATE(SHIP.EFF_THRU_DT, 'YYYYMMDD'), 'MM/DD/YYYY') SHIP_TO_EFF_THRU_DT_TXT
                ,PTY.DS_LOC_NM       AS DS_LOC_NM
                ,PTY.LINE_BIZ_TP_CD  AS LINE_BIZ_TP_CD
                , PTY.EZINTIME             AS XX_REC_HIST_CRAT_TS
                , PTY.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
                , PTY.EZUPTIME             AS XX_REC_HIST_UPD_TS
                , PTY.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
                , 'PTY_LOC_WRK'            AS XX_REC_HIST_TBL_NM
             FROM
                 ACCT_LOC       LOC
                ,PTY_LOC_WRK    PTY
             <!-- START 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
                ,SELL_TO_CUST       SELL
             <!-- END 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
                ,BILL_TO_CUST   BILL
                ,SHIP_TO_CUST   SHIP
                ,PRIN_CUST      PRIN
                <!-- QC#25154 Del Start -->
                <!--
                ,CNTY           CNTY
                -->
                <!-- QC#25154 Del End -->
                <isEqual property="showInactiveFlg" compareValue="Y">
                    ,(SELECT
                          AL.GLBL_CMPY_CD
                         ,AL.DS_ACCT_NUM
                         ,AL.LOC_NUM
                         ,AL.RGTN_STS_CD
                         ,AL.EFF_FROM_DT
                         ,RANK() OVER(PARTITION BY AL.DS_ACCT_NUM, AL.LOC_NUM, AL.RGTN_STS_CD ORDER BY AL.DS_ACCT_NUM, AL.LOC_NUM, AL.RGTN_STS_CD, AL.EFF_FROM_DT DESC) RANK
                      FROM
                          ACCT_LOC AL 
                      WHERE
                          AL.GLBL_CMPY_CD     = #glblCmpyCd#
                          AND AL.DS_ACCT_NUM  = #dsAcctNum#
                          AND AL.EZCANCELFLAG = '0'
                     ) AL
                </isEqual>
             WHERE
                 LOC.GLBL_CMPY_CD     = #glblCmpyCd#
                 AND LOC.DS_ACCT_NUM  = #dsAcctNum#
                 AND LOC.EZCANCELFLAG = '0'

                 <isEqual property="showInactiveFlg" compareValue="Y">
                     AND LOC.GLBL_CMPY_CD = AL.GLBL_CMPY_CD
                     AND LOC.DS_ACCT_NUM  = AL.DS_ACCT_NUM
                     AND LOC.LOC_NUM      = AL.LOC_NUM
                     AND LOC.RGTN_STS_CD  = AL.RGTN_STS_CD 
                     AND LOC.EFF_FROM_DT  = AL.EFF_FROM_DT 
                     AND AL.RANK          = 1
                 </isEqual>

                 AND LOC.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD
                 AND LOC.LOC_NUM      = PTY.LOC_NUM
                 AND PTY.EZCANCELFLAG = '0'

                 <!-- START 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
                 AND LOC.GLBL_CMPY_CD     = SELL.GLBL_CMPY_CD 
                 AND LOC.DS_ACCT_NUM      = SELL.SELL_TO_CUST_CD 
                 AND SELL.EZCANCELFLAG    = '0' 
                 <!-- END 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->

                 AND LOC.GLBL_CMPY_CD     = BILL.GLBL_CMPY_CD(+)
                 AND LOC.LOC_NUM          = BILL.LOC_NUM(+)
                 AND BILL.EZCANCELFLAG(+) = '0'

                 AND LOC.GLBL_CMPY_CD     = SHIP.GLBL_CMPY_CD(+)
                 AND LOC.LOC_NUM          = SHIP.LOC_NUM(+)
                 AND SHIP.EZCANCELFLAG(+) = '0'

                 <!-- START 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
                 AND SELL.CMPY_PK         = PRIN.CMPY_PK(+)
                 <!-- END 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
                 AND LOC.GLBL_CMPY_CD     = PRIN.GLBL_CMPY_CD(+)
                 AND LOC.LOC_NUM          = PRIN.LOC_NUM(+)
                 AND PRIN.EZCANCELFLAG(+) = '0'
                 <!-- QC#25154 Del Start -->
                 <!--
                 AND PTY.GLBL_CMPY_CD     = CNTY.GLBL_CMPY_CD(+)
                 AND PTY.CNTY_PK          = CNTY.CNTY_PK(+)
                 AND CNTY.EZCANCELFLAG(+) = '0'
                 -->
                 <!-- QC#25154 Del End -->

                 <isNotEqual property="showInactiveFlg" compareValue="Y">
                     AND #salesDate#  &lt;= NVL(LOC.EFF_THRU_DT, #maxEffThruDt#)
                     <iterate property="rgtnStsCdList" var="rgtnStsCdList[]" open="AND PTY.RGTN_STS_CD IN (" close=")" conjunction=",">
                         #rgtnStsCdList[]#
                     </iterate>
                     <!-- START 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
                     <iterate property="rgtnStsCdList" var="rgtnStsCdList[]" open="AND SELL.RGTN_STS_CD IN (" close=")" conjunction=",">
                         #rgtnStsCdList[]#
                     </iterate>
                     <!-- END 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
                     <iterate property="rgtnStsCdList" var="rgtnStsCdList[]" open="AND BILL.RGTN_STS_CD(+) IN (" close=")" conjunction=",">
                         #rgtnStsCdList[]#
                     </iterate>
                     <iterate property="rgtnStsCdList" var="rgtnStsCdList[]" open="AND SHIP.RGTN_STS_CD(+) IN (" close=")" conjunction=",">
                         #rgtnStsCdList[]#
                     </iterate>
                 </isNotEqual>
                 <!-- Filter items -->
                 <isNotNull property="locNum">
                     AND LOC.LOC_NUM = #locNum#
                 </isNotNull>
             UNION ALL
             SELECT
                 LOC.GLBL_CMPY_CD    AS GLBL_CMPY_CD
                ,PTY.LOC_NUM         AS LOC_NUM
                ,PTY.FIRST_LINE_ADDR AS FIRST_LINE_ADDR
                ,PTY.SCD_LINE_ADDR   AS SCD_LINE_ADDR
                ,PTY.CTY_ADDR        AS CTY_ADDR
                ,PTY.ST_CD           AS ST_CD
                ,PTY.POST_CD         AS POST_CD
                ,PTY.CNTY_PK         AS CNTY_PK
                ,CASE WHEN BILL.BILL_TO_CUST_CD IS NOT NULL THEN 'Y' ELSE 'N' END AS BILL_TO_FLG
                ,CASE WHEN SHIP.SHIP_TO_CUST_CD IS NOT NULL THEN 'Y' ELSE 'N' END AS SHIP_TO_FLG
                ,CASE WHEN PRIN.PRIN_CUST_PK IS NOT NULL    THEN 'Y' ELSE 'N' END AS PRIMARY_FLG
                ,LOC.EFF_FROM_DT     AS EFF_FROM_DT
                ,LOC.EFF_THRU_DT     AS EFF_THRU_DT
                ,PTY.RGTN_STS_CD     AS RGTN_STS_CD
                ,CASE WHEN #salesDate#  &lt;= NVL(LOC.EFF_THRU_DT, #maxEffThruDt#) THEN 'Y' ELSE 'N' END AS DPLY_FLG
                ,PTY.CTRY_CD         AS CTRY_CD
                ,PTY.THIRD_LINE_ADDR AS THIRD_LINE_ADDR
                ,PTY.FRTH_LINE_ADDR  AS FRTH_LINE_ADDR
                ,PTY.PROV_NM         AS PROV_NM
                ,TO_CHAR( TO_DATE(BILL.EFF_FROM_DT, 'YYYYMMDD'), 'MM/DD/YYYY') BILL_TO_EFF_FROM_DT_TXT
                ,TO_CHAR( TO_DATE(BILL.EFF_THRU_DT, 'YYYYMMDD'), 'MM/DD/YYYY') BILL_TO_EFF_THRU_DT_TXT
                ,TO_CHAR( TO_DATE(SHIP.EFF_FROM_DT, 'YYYYMMDD'), 'MM/DD/YYYY') SHIP_TO_EFF_FROM_DT_TXT
                ,TO_CHAR( TO_DATE(SHIP.EFF_THRU_DT, 'YYYYMMDD'), 'MM/DD/YYYY') SHIP_TO_EFF_THRU_DT_TXT
                ,PTY.DS_LOC_NM       AS DS_LOC_NM
                ,PTY.LINE_BIZ_TP_CD  AS LINE_BIZ_TP_CD
                , PTY.EZINTIME             AS XX_REC_HIST_CRAT_TS
                , PTY.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
                , PTY.EZUPTIME             AS XX_REC_HIST_UPD_TS
                , PTY.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
                , 'PTY_LOC_WRK'            AS XX_REC_HIST_TBL_NM
             FROM
                 DS_ACCT_PROS       LOC
                ,PROS_PTY_LOC_WRK   PTY
                ,BILL_TO_CUST       BILL
                ,SHIP_TO_CUST       SHIP
                ,PRIN_CUST          PRIN
                <!-- QC#25154 Del Start -->
                <!--
                ,CNTY               CNTY
                -->
                <!-- QC#25154 Del End -->
                <isEqual property="showInactiveFlg" compareValue="Y">
                    ,(SELECT
                          AL.GLBL_CMPY_CD
                         ,AL.DS_ACCT_NUM
                         ,AL.LOC_NUM
                         ,AL.RGTN_STS_CD
                         ,AL.EFF_FROM_DT
                         ,RANK() OVER(PARTITION BY AL.DS_ACCT_NUM, AL.LOC_NUM, AL.RGTN_STS_CD ORDER BY AL.DS_ACCT_NUM, AL.LOC_NUM, AL.RGTN_STS_CD, AL.EFF_FROM_DT DESC) RANK
                      FROM
                          ACCT_LOC AL 
                      WHERE
                          AL.GLBL_CMPY_CD     = #glblCmpyCd#
                          AND AL.DS_ACCT_NUM  = #dsAcctNum#
                          AND AL.EZCANCELFLAG = '0'
                     ) AL
                </isEqual>
             WHERE
                 LOC.GLBL_CMPY_CD     = #glblCmpyCd#
                 AND LOC.DS_ACCT_NUM  = #dsAcctNum#
                 AND LOC.EZCANCELFLAG = '0'

                 <isEqual property="showInactiveFlg" compareValue="Y">
                     AND LOC.GLBL_CMPY_CD = AL.GLBL_CMPY_CD
                     AND LOC.DS_ACCT_NUM  = AL.DS_ACCT_NUM
                     AND LOC.LOC_NUM      = AL.LOC_NUM
                     AND LOC.RGTN_STS_CD  = AL.RGTN_STS_CD 
                     AND LOC.EFF_FROM_DT  = AL.EFF_FROM_DT 
                     AND AL.RANK          = 1
                 </isEqual>

                 AND LOC.GLBL_CMPY_CD = PTY.GLBL_CMPY_CD
                 AND LOC.LOC_NUM      = PTY.LOC_NUM
                 AND PTY.EZCANCELFLAG = '0'

                 AND LOC.GLBL_CMPY_CD     = BILL.GLBL_CMPY_CD(+)
                 AND LOC.LOC_NUM          = BILL.LOC_NUM(+)
                 AND BILL.EZCANCELFLAG(+) = '0'

                 AND LOC.GLBL_CMPY_CD     = SHIP.GLBL_CMPY_CD(+)
                 AND LOC.LOC_NUM          = SHIP.LOC_NUM(+)
                 AND SHIP.EZCANCELFLAG(+) = '0'

                 AND LOC.GLBL_CMPY_CD     = PRIN.GLBL_CMPY_CD(+)
                 AND LOC.LOC_NUM          = PRIN.LOC_NUM(+)
                 AND PRIN.EZCANCELFLAG(+) = '0'

                 <!-- QC#25154 Del Start -->
                 <!--
                 AND PTY.GLBL_CMPY_CD     = CNTY.GLBL_CMPY_CD(+)
                 AND PTY.CNTY_PK          = CNTY.CNTY_PK(+)
                 AND CNTY.EZCANCELFLAG(+) = '0'
                 -->
                 <!-- QC#25154 Del End -->

                 <isNotEqual property="showInactiveFlg" compareValue="Y">
                     AND #salesDate#  &lt;= NVL(LOC.EFF_THRU_DT, #maxEffThruDt#)
                     <iterate property="rgtnStsCdList" var="rgtnStsCdList[]" open="AND PTY.RGTN_STS_CD IN (" close=")" conjunction=",">
                         #rgtnStsCdList[]#
                     </iterate>
                     <iterate property="rgtnStsCdList" var="rgtnStsCdList[]" open="AND BILL.RGTN_STS_CD(+) IN (" close=")" conjunction=",">
                         #rgtnStsCdList[]#
                     </iterate>
                     <iterate property="rgtnStsCdList" var="rgtnStsCdList[]" open="AND SHIP.RGTN_STS_CD(+) IN (" close=")" conjunction=",">
                         #rgtnStsCdList[]#
                     </iterate>
                 </isNotEqual>
                 <!-- Filter items -->
                 <isNotNull property="locNum">
                     AND LOC.LOC_NUM = #locNum#
                 </isNotNull>
             ORDER BY
             <!-- START 2017/08/25 H.Sugawara [QC#20358,MOD] -->
             <!--     FIRST_LINE_ADDR -->
             <!--    ,SCD_LINE_ADDR -->
             <!--    ,CTY_ADDR -->
             <!--    ,ST_CD -->
             <!--    ,POST_CD -->
                     PRIMARY_FLG DESC
                   , LOC_NUM
             <!-- START 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
                   , EFF_FROM_DT
             <!-- END 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
             <!-- END 2017/08/25 H.Sugawara [QC#20358,MOD] -->
            ) V
            <!-- QC#25154 Add Start -->
            , (
             SELECT
                 LOC_AL.LOC_NUM
                 , LISTAGG(LOC_AL.DS_ACCT_NUM, ',') WITHIN GROUP (ORDER BY LOC_AL.DS_ACCT_NUM) AS XX_RELN_DS_ACCT_TXT
             FROM
                  ACCT_LOC LOC_AL
        WHERE
                 LOC_AL.GLBL_CMPY_CD     = #glblCmpyCd#
                 AND LOC_AL.EZCANCELFLAG = '0'
             GROUP BY
                 LOC_AL.LOC_NUM
            ) AL
            ,CNTY C
            <!-- QC#25154 Add End -->
        WHERE
            <!-- QC#25154 Add Start -->
            AL.LOC_NUM(+) = V.LOC_NUM
            AND
            C.GLBL_CMPY_CD(+) = V.GLBL_CMPY_CD
            AND
            C.CNTY_PK(+) = V.CNTY_PK
            AND
            <!-- QC#25154 Add End -->
            ROWNUM &lt;= #limitRownum#
    </statement>
    
    <statement id="getRelnshipList" parameterClass="Map" resultClass="Map">
        SELECT  * FROM
           (
            SELECT 
                RELN.DS_ACCT_RELN_TP_CD         AS DS_ACCT_RELN_TP_CD
                ,RELN.RELN_DS_ACCT_NUM          AS RELN_DS_ACCT_NUM
                ,RELN.DS_ACCT_RELN_BILL_TO_FLG  AS DS_ACCT_RELN_BILL_TO_FLG
                ,RELN.DS_ACCT_RELN_SHIP_TO_FLG  AS DS_ACCT_RELN_SHIP_TO_FLG
                ,RELN.DS_ACCT_RELN_RECIP_FLG    AS DS_ACCT_RELN_RECIP_FLG
                ,RELN.EFF_FROM_DT               AS EFF_FROM_DT
                ,RELN.EFF_THRU_DT               AS EFF_THRU_DT
                ,RELN.DS_ACCT_RELN_PK           AS DS_ACCT_RELN_PK
                ,RELN.EZUPTIME                  AS EZUPTIME
                ,RELN.EZUPTIMEZONE              AS EZUPTIMEZONE
                ,ACCT.DS_ACCT_NM                AS DS_ACCT_NM
                ,DART.DS_ACCT_RELN_TP_SORT_NUM  AS DS_ACCT_RELN_TP_SORT_NUM
                ,RELN.EZINTIME                  AS XX_REC_HIST_CRAT_TS
                ,RELN.EZINUSERID                AS XX_REC_HIST_CRAT_BY_NM
                ,RELN.EZUPTIME                  AS XX_REC_HIST_UPD_TS
                ,RELN.EZUPUSERID                AS XX_REC_HIST_UPD_BY_NM
                ,'DS_ACCT_RELN'                 AS XX_REC_HIST_TBL_NM
            FROM
                DS_ACCT_RELN RELN
               ,SELL_TO_CUST ACCT
               ,DS_ACCT_RELN_TP DART
            WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
            AND RELN.EZCANCELFLAG = '0'
            AND RELN.DS_ACCT_NUM = #dsAcctNum#
            <iterate property="rgtnStsCdList" var="rgtnStsCdList[]" open="AND RELN.RGTN_STS_CD IN (" close=")" conjunction=",">
                    #rgtnStsCdList[]#
            </iterate>

            AND RELN.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
            AND RELN.RELN_DS_ACCT_NUM = ACCT.SELL_TO_CUST_CD
            <isNotNull property="dsAcctNm_F">
            AND UPPER(ACCT.DS_ACCT_NM)              LIKE #dsAcctNm_F#
            </isNotNull>
            AND ACCT.EZCANCELFLAG = '0'
            <isNotNull property="dsAcctRelnTpCd_H">
            AND RELN.DS_ACCT_RELN_TP_CD                = #dsAcctRelnTpCd_H#
            </isNotNull>
            <isNotNull property="dsAcctNum_F">
            AND RELN.RELN_DS_ACCT_NUM                  = #dsAcctNum_F#
            </isNotNull>
            <isNotNull property="xxChkBox_FB">
            AND RELN.DS_ACCT_RELN_BILL_TO_FLG          = #xxChkBox_FB#
            </isNotNull>
            <isNotNull property="xxChkBox_FS">
            AND RELN.DS_ACCT_RELN_SHIP_TO_FLG          = #xxChkBox_FS#
            </isNotNull>
            <isNotNull property="xxChkBox_FR">
            AND RELN.DS_ACCT_RELN_RECIP_FLG            = #xxChkBox_FR#
            </isNotNull>
            <isNotNull property="effFromDt_F1">
            AND RELN.EFF_FROM_DT                   &gt;= #effFromDt_F1#
            </isNotNull>
            <isNotNull property="effFromDt_F2">
            AND RELN.EFF_FROM_DT                   &lt;= #effFromDt_F2#
            </isNotNull>
            <isNotNull property="effThruDt_F1">
            AND NVL(RELN.EFF_THRU_DT, #highValDt#) &gt;= #effThruDt_F1#
            </isNotNull>
            <isNotNull property="effThruDt_F2">
            AND NVL(RELN.EFF_THRU_DT, #highValDt#) &lt;= #effThruDt_F2#
            </isNotNull>

            AND RELN.GLBL_CMPY_CD = DART.GLBL_CMPY_CD
            AND RELN.DS_ACCT_RELN_TP_CD = DART.DS_ACCT_RELN_TP_CD
            AND DART.EZCANCELFLAG = '0'

            UNION ALL

            SELECT 
                RELN.DS_ACCT_RELN_TP_CD         AS DS_ACCT_RELN_TP_CD
                ,RELN.RELN_DS_ACCT_NUM          AS RELN_DS_ACCT_NUM
                ,RELN.DS_ACCT_RELN_BILL_TO_FLG  AS DS_ACCT_RELN_BILL_TO_FLG
                ,RELN.DS_ACCT_RELN_SHIP_TO_FLG  AS DS_ACCT_RELN_SHIP_TO_FLG
                ,RELN.DS_ACCT_RELN_RECIP_FLG    AS DS_ACCT_RELN_RECIP_FLG
                ,RELN.EFF_FROM_DT               AS EFF_FROM_DT
                ,RELN.EFF_THRU_DT               AS EFF_THRU_DT
                ,RELN.DS_ACCT_RELN_PK           AS DS_ACCT_RELN_PK
                ,RELN.EZUPTIME                  AS EZUPTIME
                ,RELN.EZUPTIMEZONE              AS EZUPTIMEZONE
                ,PROS.DS_ACCT_NM                AS DS_ACCT_NM
                ,DART.DS_ACCT_RELN_TP_SORT_NUM  AS DS_ACCT_RELN_TP_SORT_NUM
                ,RELN.EZINTIME                  AS XX_REC_HIST_CRAT_TS
                ,RELN.EZINUSERID                AS XX_REC_HIST_CRAT_BY_NM
                ,RELN.EZUPTIME                  AS XX_REC_HIST_UPD_TS
                ,RELN.EZUPUSERID                AS XX_REC_HIST_UPD_BY_NM
                ,'DS_ACCT_RELN'                 AS XX_REC_HIST_TBL_NM
            FROM
                DS_ACCT_RELN RELN
               ,DS_ACCT_PROS PROS
               ,DS_ACCT_RELN_TP DART
            WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
            AND RELN.EZCANCELFLAG = '0'
            AND RELN.DS_ACCT_NUM = #dsAcctNum#
            <iterate property="rgtnStsCdList" var="rgtnStsCdList[]" open="AND RELN.RGTN_STS_CD IN (" close=")" conjunction=",">
                    #rgtnStsCdList[]#
            </iterate>
            <isNotNull property="dsAcctRelnTpCd_H">
            AND RELN.DS_ACCT_RELN_TP_CD                = #dsAcctRelnTpCd_H#
            </isNotNull>
            <isNotNull property="dsAcctNum_F">
            AND RELN.RELN_DS_ACCT_NUM                  = #dsAcctNum_F#
            </isNotNull>
            <isNotNull property="xxChkBox_FB">
            AND RELN.DS_ACCT_RELN_BILL_TO_FLG          = #xxChkBox_FB#
            </isNotNull>
            <isNotNull property="xxChkBox_FS">
            AND RELN.DS_ACCT_RELN_SHIP_TO_FLG          = #xxChkBox_FS#
            </isNotNull>
            <isNotNull property="xxChkBox_FR">
            AND RELN.DS_ACCT_RELN_RECIP_FLG            = #xxChkBox_FR#
            </isNotNull>
            <isNotNull property="effFromDt_F1">
            AND RELN.EFF_FROM_DT                   &gt;= #effFromDt_F1#
            </isNotNull>
            <isNotNull property="effFromDt_F2">
            AND RELN.EFF_FROM_DT                   &lt;= #effFromDt_F2#
            </isNotNull>
            <isNotNull property="effThruDt_F1">
            AND NVL(RELN.EFF_THRU_DT, #highValDt#) &gt;= #effThruDt_F1#
            </isNotNull>
            <isNotNull property="effThruDt_F2">
            AND NVL(RELN.EFF_THRU_DT, #highValDt#) &lt;= #effThruDt_F2#
            </isNotNull>

            AND RELN.GLBL_CMPY_CD = PROS.GLBL_CMPY_CD
            AND RELN.RELN_DS_ACCT_NUM = PROS.DS_ACCT_NUM
            <isNotNull property="dsAcctNm_F">
            AND UPPER(PROS.DS_ACCT_NM)              LIKE #dsAcctNm_F#
            </isNotNull>
            AND PROS.EZCANCELFLAG = '0'

            AND RELN.GLBL_CMPY_CD = DART.GLBL_CMPY_CD
            AND RELN.DS_ACCT_RELN_TP_CD = DART.DS_ACCT_RELN_TP_CD
            AND DART.EZCANCELFLAG = '0'

            ORDER BY DS_ACCT_RELN_TP_SORT_NUM, RELN_DS_ACCT_NUM
           )
        WHERE ROWNUM &lt;= #rowNum#

    </statement>
    <!-- START 2023/01/20 S.Fujita [QC#61011,ADD] -->
    <statement id="getDsAcctRelnTpNm" parameterClass="Map" resultClass="String">
        SELECT
                DART.DS_ACCT_RELN_TP_NM
        FROM
                DS_ACCT_RELN_TP DART
        WHERE
                DART.GLBL_CMPY_CD         = #glblCmpyCd#
        AND     DART.DS_ACCT_RELN_TP_CD   = #dsAcctRelnTpCd#
        AND     DART.EZCANCELFLAG         = '0'
    </statement>
    <!-- END 2023/01/20 S.Fujita [QC#61011,ADD] -->
    <statement id="getDsAcctReln" parameterClass="Map" resultClass="Map">
        SELECT
                DAR.DS_ACCT_RELN_PK
               ,DAR.DS_ACCT_RELN_TP_CD
               ,DAR.EFF_FROM_DT
               ,DAR.EFF_THRU_DT
        FROM
                DS_ACCT_RELN DAR
        WHERE
                DAR.GLBL_CMPY_CD         = #glblCmpyCd#
        AND     DAR.DS_ACCT_NUM          = #dsAcctNum#
        AND     DAR.RELN_DS_ACCT_NUM     = #relnDsAcctNum#
        AND     DAR.DS_ACCT_RELN_TP_CD   = #dsAcctRelnTpCd#
        AND     DAR.EZCANCELFLAG         = '0'
    </statement>
        
    <statement id="getRepDsAcctReln" parameterClass="Map" resultClass="Map">
        SELECT
                DAR.DS_ACCT_RELN_PK
               ,DAR.DS_ACCT_RELN_TP_CD
               ,DAR.EFF_FROM_DT
               ,DAR.EFF_THRU_DT
        FROM
                DS_ACCT_RELN DAR
        WHERE
                DAR.GLBL_CMPY_CD           = #glblCmpyCd#
        AND     DAR.DS_ACCT_NUM            = #dsAcctNum#
        AND     DAR.RELN_DS_ACCT_NUM       = #relnDsAcctNum#
        AND     DAR.DS_ACCT_RELN_TP_CD     = #dsAcctRelnTpCd#
        AND     DAR.EZCANCELFLAG           = '0'
    </statement>

    <!-- START 2018/09/12 [QC#28165, ADD] -->
    <statement id="getRepDsAcctRelnByEffDt" parameterClass="Map" resultClass="Map">
        SELECT
                DAR.DS_ACCT_RELN_PK
               ,DAR.DS_ACCT_RELN_TP_CD
               ,DAR.EFF_FROM_DT
               ,DAR.EFF_THRU_DT
               ,DAR.DS_ACCT_RELN_RECIP_FLG
        FROM
                DS_ACCT_RELN DAR
        WHERE
                DAR.GLBL_CMPY_CD           = #glblCmpyCd#
        AND     DAR.DS_ACCT_NUM            = #dsAcctNum#
        AND     DAR.RELN_DS_ACCT_NUM       = #relnDsAcctNum#
        AND     DAR.DS_ACCT_RELN_TP_CD     = #dsAcctRelnTpCd#
        AND     DAR.EFF_FROM_DT        &lt;= #effThruDt#
        AND     NVL(DAR.EFF_THRU_DT, '99991231') &gt;= #effFromDt#
        AND     DAR.EZCANCELFLAG           = '0'
    </statement>
    <!-- END 2018/09/12 [QC#28165, ADD] -->

    <statement id="getParentNode"  parameterClass ="Map" resultClass="Map">
    SELECT
         STRU.P_DS_ACCT_NUM  AS P_DS_ACCT_NUM
        ,STRU.DS_ACCT_NUM    AS DS_ACCT_NUM
        ,LEVEL
    FROM
        (SELECT
             DAR1.DS_ACCT_NUM        AS DS_ACCT_NUM
            ,DAR1.RELN_DS_ACCT_NUM   AS P_DS_ACCT_NUM
            ,DAR1.DS_ACCT_RELN_TP_CD AS DS_ACCT_RELN_TP_CD
         FROM
             DS_ACCT_RELN DAR1
         WHERE
             DAR1.GLBL_CMPY_CD          = #glblCmpyCd#
         AND
             DAR1.EZCANCELFLAG          = '0'
         AND
             DAR1.DS_ACCT_RELN_TP_CD    = #dsAcctRelnTpCd#
         <isNotNull property="readyForOrderTaking">
         AND
            DAR1.RGTN_STS_CD = #readyForOrderTaking#
         </isNotNull>
         <isNotNull property="primaryOnly">
         AND EXISTS (
             SELECT
                 'OK'
             FROM
                 (SELECT
                       GLBL_CMPY_CD
                      ,PTY_LOC_PK
                  FROM
                       SELL_TO_CUST DS
                  WHERE
                       DAR1.GLBL_CMPY_CD  = DS.GLBL_CMPY_CD
                  AND
                       DS.EZCANCELFLAG    = '0'
                  AND
                       DAR1.DS_ACCT_NUM   = DS.SELL_TO_CUST_CD
                  UNION ALL
                  SELECT
                       GLBL_CMPY_CD
                      ,PTY_LOC_PK
                  FROM
                       DS_ACCT_PROS DAP
                  WHERE
                       DAR1.GLBL_CMPY_CD  = DAP.GLBL_CMPY_CD
                  AND
                       DAP.EZCANCELFLAG   = '0'
                  AND
                       DAR1.DS_ACCT_NUM   = DAP.DS_ACCT_NUM
                 ) ACCT
                 , ACCT_LOC AL
             WHERE
                 ACCT.GLBL_CMPY_CD   = AL.GLBL_CMPY_CD
             AND
                 AL.EZCANCELFLAG     = '0'
             AND
                 ACCT.PTY_LOC_PK     = AL.PTY_LOC_PK
             )
         </isNotNull>
        ) STRU
    WHERE
        LEVEL &lt;= #maxLevel#
    START WITH
        STRU.DS_ACCT_NUM = #targetDsAcctNum#
    CONNECT BY NOCYCLE PRIOR 
        STRU.P_DS_ACCT_NUM = STRU.DS_ACCT_NUM
    ORDER BY
        LEVEL DESC
    </statement>

    <!-- In case of Display Account Hierarchy -->
    <!-- Get Account Hierarchy from Root -->
    <statement id="getTreeList"  parameterClass ="Map" resultClass="Map">
    SELECT
        TREE_INFO.P_DS_ACCT_NUM       P_DS_ACCT_NUM
       ,TREE_INFO.DS_ACCT_NUM         DS_ACCT_NUM
       ,TREE_INFO.DS_ACCT_RELN_TP_CD  DS_ACCT_RELN_TP_CD
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 1) &gt; 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 2) &gt; 0 THEN 
                SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 1) + 1, INSTR(TREE_INFO.TREE_PATH,'/', 1, 2)-2)
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 1) + 1)
            END
        ELSE '' END dsAcctNum_T1
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 2) &gt; 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 3) &gt; 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 2) + 1, INSTR(TREE_INFO.TREE_PATH,'/', 1, 3) - INSTR(TREE_INFO.TREE_PATH,'/', 1, 2) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 2) + 1)
            END
        ELSE '' END dsAcctNum_T2
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 3) &gt; 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 4) &gt; 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 3) + 1, INSTR(TREE_INFO.TREE_PATH,'/', 1, 4) - INSTR(TREE_INFO.TREE_PATH,'/', 1, 3) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 3) + 1)
            END
        ELSE '' END dsAcctNum_T3
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 4) &gt; 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 5) &gt; 0 THEN 
             SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 4) + 1, INSTR(TREE_INFO.TREE_PATH,'/', 1, 5) - INSTR(TREE_INFO.TREE_PATH,'/', 1, 4) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 4) + 1)
            END
        ELSE '' END dsAcctNum_T4
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 5) &gt; 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 6) &gt; 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 5) + 1, INSTR(TREE_INFO.TREE_PATH,'/', 1, 6) - INSTR(TREE_INFO.TREE_PATH,'/', 1, 5) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 5) + 1)
            END
        ELSE '' END dsAcctNum_T5
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 6) &gt; 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 7) &gt; 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 6) + 1, INSTR(TREE_INFO.TREE_PATH,'/', 1, 7) - INSTR(TREE_INFO.TREE_PATH,'/', 1, 6) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 6) + 1)
            END
        ELSE '' END dsAcctNum_T6
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 7) &gt; 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 8) &gt; 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 7) + 1, INSTR(TREE_INFO.TREE_PATH,'/', 1, 8) - INSTR(TREE_INFO.TREE_PATH,'/', 1, 7) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 7) + 1)
            END
        ELSE '' END dsAcctNum_T7
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 8) &gt; 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 9) &gt; 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 8) + 1, INSTR(TREE_INFO.TREE_PATH,'/', 1, 9) - INSTR(TREE_INFO.TREE_PATH,'/', 1, 8) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 8) + 1)
            END
        ELSE '' END dsAcctNum_T8
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 9) &gt; 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 10) &gt; 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 9) + 1, INSTR(TREE_INFO.TREE_PATH,'/', 1, 10) - INSTR(TREE_INFO.TREE_PATH,'/', 1, 9) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 9) + 1)
            END
        ELSE '' END dsAcctNum_T9
       ,CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 10) &gt; 0 THEN 
            CASE WHEN INSTR(TREE_INFO.TREE_PATH,'/', 1, 11) &gt; 0 THEN 
                 SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 10) + 1, INSTR(TREE_INFO.TREE_PATH,'/', 1, 11) - INSTR(TREE_INFO.TREE_PATH,'/', 1, 10) - 1 )
            ELSE SUBSTR(TREE_INFO.TREE_PATH, INSTR(TREE_INFO.TREE_PATH,'/', 1, 10) + 1)
            END
        ELSE '' END dsAcctNum_TA
       ,TREE_INFO.DS_ACCT_NM   DS_ACCT_NM
       ,PLW.FIRST_LINE_ADDR ||
        DECODE(PLW.SCD_LINE_ADDR, NULL, '', ' ' || PLW.SCD_LINE_ADDR) ||
        DECODE(PLW.THIRD_LINE_ADDR, NULL, '', ' ' || PLW.THIRD_LINE_ADDR) ||
        DECODE(PLW.FRTH_LINE_ADDR, NULL, '', ' ' || PLW.FRTH_LINE_ADDR)
                               ADDRESS
       ,PLW.CTY_ADDR           CTY_ADDR
       ,PLW.ST_CD              ST_CD
       ,PLW.POST_CD            POST_CD
       ,PLW.LOC_NUM            LOC_NUM
       ,CASE
           <!-- QC#6183
           WHEN TREE_INFO.PTY_LOC_PK = AL.PTY_LOC_PK
            --> 
           WHEN TREE_INFO.PTY_LOC_PK = PC.PTY_LOC_PK
           THEN 'Y'
           ELSE 'N'
           END            PRIMARY
       ,CASE
           WHEN TREE_INFO.DS_ACCT_ACTV_CUST_FLG = 'Y'
           THEN #active#
           ELSE #inActive#
           END            DS_ACCT_STS_NM
       ,DAP.DS_ACCT_TP_NM DS_ACCT_TP_NM
    FROM (
        SELECT
            STRU.GLBL_CMPY_CD                           GLBL_CMPY_CD
           ,STRU.P_DS_ACCT_NUM                          P_DS_ACCT_NUM
           ,STRU.DS_ACCT_NUM                            DS_ACCT_NUM
           ,STRU.DS_ACCT_RELN_TP_CD                     DS_ACCT_RELN_TP_CD
           ,SYS_CONNECT_BY_PATH (STRU.DS_ACCT_NUM, '/') TREE_PATH
           ,LEVEL                                       LVL
           ,STRU.DS_ACCT_TP_CD                          DS_ACCT_TP_CD
           ,STRU.RGTN_STS_CD                            RGTN_STS_CD
           ,STRU.PTY_LOC_PK                             PTY_LOC_PK
           ,STRU.DS_ACCT_NM                             DS_ACCT_NM
           ,STRU.DS_ACCT_ACTV_CUST_FLG                  DS_ACCT_ACTV_CUST_FLG
        FROM (
            SELECT
                A.GLBL_CMPY_CD         GLBL_CMPY_CD
               ,A.DS_ACCT_NUM          DS_ACCT_NUM
               ,B.RELN_DS_ACCT_NUM     P_DS_ACCT_NUM
               ,B.DS_ACCT_RELN_TP_CD   DS_ACCT_RELN_TP_CD
               ,A.DS_ACCT_TP_CD        DS_ACCT_TP_CD
               ,A.PTY_LOC_PK           PTY_LOC_PK
               ,B.RGTN_STS_CD          RGTN_STS_CD
               ,A.DS_ACCT_NM           DS_ACCT_NM
               ,A.DS_ACCT_ACTV_CUST_FLG DS_ACCT_ACTV_CUST_FLG
            FROM 
                (SELECT CUST.GLBL_CMPY_CD
                        ,CUST.SELL_TO_CUST_CD AS DS_ACCT_NUM
                        ,CUST.EZCANCELFLAG
                        ,CUST.PTY_LOC_PK
                        ,CUST.DS_ACCT_TP_CD
                        ,CUST.DS_ACCT_NM
                        ,CUST.DS_ACCT_ACTV_CUST_FLG
                FROM    SELL_TO_CUST CUST
                UNION ALL
                SELECT PROS.GLBL_CMPY_CD
                       ,PROS.DS_ACCT_NUM
                       ,PROS.EZCANCELFLAG
                       ,PROS.PTY_LOC_PK
                       ,PROS.DS_ACCT_TP_CD
                       ,PROS.DS_ACCT_NM
                       ,PROS.DS_ACCT_ACTV_CUST_FLG
                FROM   DS_ACCT_PROS PROS) A
               ,DS_ACCT_RELN B
            WHERE
                1=1
            AND A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND B.EZCANCELFLAG(+)       = '0'
            AND B.GLBL_CMPY_CD(+)       = #glblCmpyCd#
            AND A.DS_ACCT_NUM           = b.DS_ACCT_NUM(+)
            AND B.DS_ACCT_RELN_TP_CD(+) = #dsAcctRelnTpCd# --parent
            <isNotNull property="readyForOrderTaking">
            AND  B.RGTN_STS_CD(+)       = #readyForOrderTaking#
            </isNotNull>
            <isNotNull property="primaryOnly">
            AND EXISTS (
                        SELECT
                            'OK'
                        FROM
                            ACCT_LOC AL
                        WHERE
                            A.GLBL_CMPY_CD   = AL.GLBL_CMPY_CD
                        AND
                            AL.EZCANCELFLAG  = '0'
                        AND
                            A.PTY_LOC_PK     = AL.PTY_LOC_PK
                       )
            </isNotNull>
        ) STRU
        WHERE 1=1
          AND LEVEL &lt;= #childrenMaxLevel#
        START WITH STRU.DS_ACCT_NUM = #parentDsAcctNum#
        CONNECT BY NOCYCLE
        PRIOR STRU.DS_ACCT_NUM    = STRU.P_DS_ACCT_NUM 
        AND   STRU.DS_ACCT_NUM   != STRU.P_DS_ACCT_NUM
    ) TREE_INFO
     ,ACCT_LOC     AL
     ,PTY_LOC_WRK  PLW
     ,PRIN_CUST    PC
     ,BILL_TO_CUST BTC
     ,SHIP_TO_CUST STC
     ,DS_ACCT_TP   DAP
    WHERE
        TREE_INFO.GLBL_CMPY_CD   = AL.GLBL_CMPY_CD(+)
    AND AL.EZCANCELFLAG(+)       = '0'
    AND TREE_INFO.DS_ACCT_NUM    = AL.DS_ACCT_NUM(+)
    <!-- PTY_LOC_WRK -->
    AND AL.GLBL_CMPY_CD          = PLW.GLBL_CMPY_CD
    AND PLW.EZCANCELFLAG(+)      = '0'
    AND AL.PTY_LOC_PK            = PLW.PTY_LOC_PK(+)
    <!-- PRIN_CUST -->
    AND PLW.GLBL_CMPY_CD         = PC.GLBL_CMPY_CD(+)
    AND PC.EZCANCELFLAG(+)       = '0'
    AND PLW.LOC_NUM              = PC.LOC_NUM(+)
    <!-- BILL_TO_CUST -->
    AND PLW.GLBL_CMPY_CD         = BTC.GLBL_CMPY_CD(+)
    AND BTC.EZCANCELFLAG(+)      = '0'
    AND PLW.LOC_NUM              = BTC.LOC_NUM(+)
    <!-- SHIP_TO_CUST -->
    AND PLW.GLBL_CMPY_CD         = STC.GLBL_CMPY_CD(+)
    AND STC.EZCANCELFLAG(+)      = '0'
    AND PLW.LOC_NUM              = STC.LOC_NUM(+)
    <!-- DS_ACCT_TP -->
    AND PLW.GLBL_CMPY_CD         = DAP.GLBL_CMPY_CD(+)
    AND TREE_INFO.DS_ACCT_TP_CD  = DAP.DS_ACCT_TP_CD(+)
    AND DAP.EZCANCELFLAG(+)      = '0'
    AND TREE_INFO.PTY_LOC_PK = AL.PTY_LOC_PK
    
    <isNotNull property="inActiveFlag">
    AND
        TREE_INFO.DS_ACCT_ACTV_CUST_FLG = #dsAcctActvCustFlg# 
    </isNotNull>
    ORDER BY TREE_INFO.TREE_PATH
    </statement>
    
    <!-- In case of Display Account Hierarchy -->
    <!-- Get Related Information from Account# -->
    <statement id="getRelatedTreeList"  parameterClass ="Map" resultClass="Map">
    select 
        tree_info.DS_ACCT_NUM
       ,tree_info.DS_ACCT_RELN_TP_CD
    from (
            --RELATED ACCOUNT
            select 
                b.RELN_DS_ACCT_NUM DS_ACCT_NUM
               ,a.DS_ACCT_NUM P_DS_ACCT_NUM
               ,b.DS_ACCT_RELN_TP_CD
            from 
                (select CUST.EZCANCELFLAG
                        ,CUST.GLBL_CMPY_CD
                        ,CUST.SELL_TO_CUST_CD AS DS_ACCT_NUM 
                from    SELL_TO_CUST CUST
                union all
                select PROS.EZCANCELFLAG
                       ,PROS.GLBL_CMPY_CD
                       ,PROS.SELL_TO_CUST_CD AS DS_ACCT_NUM 
                from   DS_ACCT_PROS PROS) a
               ,DS_ACCT_RELN b 
            where 
                1=1
            and a.EZCANCELFLAG = '0'
            and a.GLBL_CMPY_CD = #glblCmpyCd#
            and b.EZCANCELFLAG = '0'
            and b.GLBL_CMPY_CD = #glblCmpyCd#
            and a.DS_ACCT_NUM = b.DS_ACCT_NUM
            <iterate property="dsAcctRelnTpCdList" var="dsAcctRelnTpCd[]" open="and b.DS_ACCT_RELN_TP_CD IN (" close=")" conjunction=",">
                #dsAcctRelnTpCd[]#
            </iterate>
            and a.DS_ACCT_NUM = #targetDsAcctNum#
    ) tree_info
    where 1=1
    order by tree_info.DS_ACCT_NUM
    </statement>
    
    <!-- In case of Display Account Hierarchy -->
    <!-- Get Location Information from Account# -->
    <statement id="getLeefList"  parameterClass ="Map" resultClass="Map">
    select 
        a.DS_ACCT_NUM
       ,a.DS_ACCT_NM
       
       ,max(case when c.PRIN_CUST_PK is not null then 
             c.FIRST_LINE_ADDR ||
             DECODE(c.SCD_LINE_ADDR, NULL, '', ' ' || c.SCD_LINE_ADDR) ||
             DECODE(c.THIRD_LINE_ADDR, NULL, '', ' ' || c.THIRD_LINE_ADDR) ||
             DECODE(c.FRTH_LINE_ADDR, NULL, '', ' ' || c.FRTH_LINE_ADDR)

            when d.BILL_TO_CUST_PK is not null then
            d.FIRST_LINE_ADDR ||
             DECODE(d.SCD_LINE_ADDR, NULL, '', ' ' || d.SCD_LINE_ADDR) ||
             DECODE(d.THIRD_LINE_ADDR, NULL, '', ' ' || d.THIRD_LINE_ADDR) ||
             DECODE(d.FRTH_LINE_ADDR, NULL, '', ' ' || d.FRTH_LINE_ADDR)

            when e.SHIP_TO_CUST_PK is not null then
            e.FIRST_LINE_ADDR || ' ' || e.SCD_LINE_ADDR || ' ' || e.THIRD_LINE_ADDR || ' ' || e.FRTH_LINE_ADDR
            e.FIRST_LINE_ADDR ||
             DECODE(e.SCD_LINE_ADDR, NULL, '', ' ' || e.SCD_LINE_ADDR) ||
             DECODE(e.THIRD_LINE_ADDR, NULL, '', ' ' || e.THIRD_LINE_ADDR) ||
             DECODE(e.FRTH_LINE_ADDR, NULL, '', ' ' || e.FRTH_LINE_ADDR)
        end) ADDRESS
       ,max(case when c.PRIN_CUST_PK is not null then 
            c.CTY_ADDR
            when d.BILL_TO_CUST_PK is not null then
            d.CTY_ADDR
            when e.SHIP_TO_CUST_PK is not null then
            e.CTY_ADDR
        end) CTY_ADDR
       ,max(case when c.PRIN_CUST_PK is not null then 
            c.ST_CD
            when d.BILL_TO_CUST_PK is not null then
            d.ST_CD
            when e.SHIP_TO_CUST_PK is not null then
            e.ST_CD
        end) ST_CD
       ,max(case when c.PRIN_CUST_PK is not null then 
            c.POST_CD
            when d.BILL_TO_CUST_PK is not null then
            d.POST_CD
            when e.SHIP_TO_CUST_PK is not null then
            e.POST_CD
        end) POST_CD
       ,nvl(c.LOC_NUM, nvl(d.LOC_NUM, e.LOC_NUM)) LOC_NUM
       ,case when count(c.PRIN_CUST_PK) >= 1 then 'Y' else 'N' end PRIMARY
       ,f.DS_ACCT_TP_NM
       ,count(c.PRIN_CUST_PK) PRIN_CONT
       ,count(d.BILL_TO_CUST_PK) BILL_CONT
       ,count(e.SHIP_TO_CUST_PK) SHIP_CONT
    from 
        (select CUST.EZCANCELFLAG
                ,CUST.GLBL_CMPY_CD
                ,CUST.SELL_TO_CUST_CD AS DS_ACCT_NUM
                ,CUST.DS_ACCT_TP_CD
                ,CUST.DS_CLT_ACCT_STS_CD
                ,CUST.DS_ACCT_NM
         from SELL_TO_CUST CUST
         union all
         select PROS.EZCANCELFLAG
                ,PROS.GLBL_CMPY_CD
                ,PROS.SELL_TO_CUST_CD AS DS_ACCT_NUM
                ,PROS.DS_ACCT_TP_CD
                ,PROS.DS_CLT_ACCT_STS_CD
                ,PROS.DS_ACCT_NM
         from DS_ACCT_PROS PROS) a
       ,DS_ACCT_RELN b
       ,PRIN_CUST c
       ,BILL_TO_CUST d
       ,SHIP_TO_CUST e
       ,DS_ACCT_TP f
    where 
        1=1
    and a.EZCANCELFLAG = '0' and a.GLBL_CMPY_CD = #glblCmpyCd#
    and b.EZCANCELFLAG (+) = '0' and b.GLBL_CMPY_CD (+) = #glblCmpyCd#
    and c.EZCANCELFLAG (+) = '0' and c.GLBL_CMPY_CD (+) = #glblCmpyCd#
    and d.EZCANCELFLAG (+) = '0' and d.GLBL_CMPY_CD (+) = #glblCmpyCd#
    and e.EZCANCELFLAG (+) = '0' and e.GLBL_CMPY_CD (+) = #glblCmpyCd#
    and f.EZCANCELFLAG (+) = '0' and f.GLBL_CMPY_CD (+) = #glblCmpyCd#
    and a.DS_ACCT_NUM = b.DS_ACCT_NUM (+)
    and b.RELN_DS_ACCT_NUM (+) = b.DS_ACCT_NUM (+)  --same account only
    and b.PRIN_CUST_PK = c.PRIN_CUST_PK (+)
    and b.BILL_TO_CUST_PK = d.BILL_TO_CUST_PK (+)
    and b.SHIP_TO_CUST_PK = e.SHIP_TO_CUST_PK (+)
    and a.DS_ACCT_TP_CD = f.DS_ACCT_TP_CD (+)
    and a.DS_CLT_ACCT_STS_CD = g.DS_CLT_ACCT_STS_CD (+)
    and a.DS_ACCT_NUM = #dsAcctNum#
    group by a.DS_ACCT_NUM, a.DS_ACCT_NM, nvl(c.LOC_NUM, nvl(d.LOC_NUM, e.LOC_NUM)), f.DS_ACCT_TP_NM
    having 1=1
    order by 
        a.DS_ACCT_NUM
       ,a.DS_ACCT_NM
       ,PRIMARY desc
       ,LOC_NUM
    </statement>
    
    <statement id="getLeefListInvisibleAddr"  parameterClass ="Map" resultClass="Map">
    select 
        a.DS_ACCT_NUM
       ,a.DS_ACCT_NM
       ,'' ADDRESS
       ,'' CTY_ADDR
       ,'' ST_CD
       ,'' POST_CD
       ,'' LOC_NUM
       ,'' PRIMARY
       ,f.DS_ACCT_TP_NM
    from 
        (select CUST.EZCANCELFLAG
                ,CUST.GLBL_CMPY_CD
                ,CUST.SELL_TO_CUST_CD AS DS_ACCT_NUM
                ,CUST.DS_ACCT_NM
                ,CUST.DS_ACCT_TP_CD
        from SELL_TO_CUST CUST
         union all
         select PROS.EZCANCELFLAG
                ,PROS.GLBL_CMPY_CD
                ,PROS.SELL_TO_CUST_CD AS DS_ACCT_NUM
                ,PROS.DS_ACCT_NM
                ,PROS.DS_ACCT_TP_CD
        from DS_ACCT_PROS PROS) a
       ,DS_ACCT_TP f
    where 
        a.EZCANCELFLAG = '0' and a.GLBL_CMPY_CD = #glblCmpyCd#
    and f.EZCANCELFLAG (+) = '0' and f.GLBL_CMPY_CD (+) = #glblCmpyCd#
    and a.DS_ACCT_TP_CD = f.DS_ACCT_TP_CD (+)
    and a.DS_ACCT_NUM = #dsAcctNum#
    order by 
        a.DS_ACCT_NUM
       ,a.DS_ACCT_NM
    </statement>

    <statement id="getCtacPsnList" parameterClass="Map" resultClass="Map">
    <!-- START 2017/12/18 Hd.Sugawara [QC#22286,ADD] -->
    WITH ALL_CONTACTS AS ( 
    <!-- END 2017/12/18 Hd.Sugawara [QC#22286,ADD] -->
        SELECT 
            V.CTAC_PSN_PK
           ,V.CTAC_PSN_NUM
           ,V.CTAC_TP_CD
           <!-- START 2017/12/06 Hd.Sugawara [QC#21897,MOD] -->
           <!-- ,V.CTAC_TP_NM -->
           ,V.CTAC_TP_DESC_TXT
           <!-- END 2017/12/06 Hd.Sugawara [QC#21897,MOD] -->
           ,V.CTAC_PSN_FIRST_NM
           ,V.CTAC_PSN_LAST_NM
           ,V.DS_CTAC_PSN_DEPT_NM
           ,V.DS_CTAC_PSN_RELN_PK
           ,V.EFF_FROM_DT
           ,V.EFF_THRU_DT
           ,V.CTAC_PSN_ACTV_FLG
           , V.XX_REC_HIST_CRAT_TS
           , V.XX_REC_HIST_CRAT_BY_NM
           , V.XX_REC_HIST_UPD_TS
           , V.XX_REC_HIST_UPD_BY_NM
           , V.XX_REC_HIST_TBL_NM
           ,(
             SELECT
                 A.DS_CTAC_PNT_VAL_TXT
             FROM
                 (
                  SELECT
                      B.CTAC_PSN_PK
                     ,B.DS_CTAC_PNT_TP_CD
                     ,B.DS_CTAC_PNT_PK
                     ,P2.DS_CTAC_PNT_VAL_TXT
                     ,P2.DS_CTAC_PSN_EXTN_NUM
                  FROM
                      DS_CTAC_PNT P2
                     ,(
                       SELECT
                           P.GLBL_CMPY_CD
                          ,P.CTAC_PSN_PK
                          ,TP.DS_CTAC_PNT_TP_CD
                          ,MAX(P.DS_CTAC_PNT_PK) AS DS_CTAC_PNT_PK
                       FROM
                           DS_CTAC_PNT P
                          ,DS_CTAC_PNT_TP TP
                       WHERE
                           P.GLBL_CMPY_CD             = #glblCmpyCd#
                           AND P.DS_CTAC_PNT_ACTV_FLG = 'Y'
                           AND P.EZCANCELFLAG         = '0'
                           AND P.GLBL_CMPY_CD         = TP.GLBL_CMPY_CD
                           AND P.DS_CTAC_PNT_TP_CD    = TP.DS_CTAC_PNT_TP_CD
                           AND TP.EZCANCELFLAG        = '0'
                       GROUP BY
                           P.GLBL_CMPY_CD
                          ,P.CTAC_PSN_PK
                          ,TP.DS_CTAC_PNT_TP_CD
                      ) B
                  WHERE
                      P2.GLBL_CMPY_CD   = #glblCmpyCd#
                  AND P2.EZCANCELFLAG   = '0'
                  AND P2.GLBL_CMPY_CD   = B.GLBL_CMPY_CD
                  AND P2.DS_CTAC_PNT_PK = B.DS_CTAC_PNT_PK
                 ) A
             WHERE
                 A.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCd_P#
                 AND A.CTAC_PSN_PK   = V.CTAC_PSN_PK
            ) AS CTAC_PSN_TEL_NUM
           ,(
             SELECT
                 A.DS_CTAC_PSN_EXTN_NUM
             FROM
                 (
                  SELECT
                      B.CTAC_PSN_PK
                     ,B.DS_CTAC_PNT_TP_CD
                     ,B.DS_CTAC_PNT_PK
                     ,P2.DS_CTAC_PNT_VAL_TXT
                     ,P2.DS_CTAC_PSN_EXTN_NUM
                  FROM
                      DS_CTAC_PNT P2
                     ,(
                       SELECT
                           P.GLBL_CMPY_CD
                          ,P.CTAC_PSN_PK
                          ,TP.DS_CTAC_PNT_TP_CD
                          ,MAX(P.DS_CTAC_PNT_PK) AS DS_CTAC_PNT_PK
                       FROM
                           DS_CTAC_PNT P
                          ,DS_CTAC_PNT_TP TP
                       WHERE
                           P.GLBL_CMPY_CD             = #glblCmpyCd#
                           AND P.DS_CTAC_PNT_ACTV_FLG = 'Y'
                           AND P.EZCANCELFLAG         = '0'
                           AND P.GLBL_CMPY_CD         = TP.GLBL_CMPY_CD
                           AND P.DS_CTAC_PNT_TP_CD    = TP.DS_CTAC_PNT_TP_CD
                           AND TP.EZCANCELFLAG        = '0'
                       GROUP BY
                           P.GLBL_CMPY_CD
                          ,P.CTAC_PSN_PK
                          ,TP.DS_CTAC_PNT_TP_CD
                      ) B
                  WHERE
                      P2.GLBL_CMPY_CD       = #glblCmpyCd#
                      AND P2.EZCANCELFLAG   = '0'
                      AND P2.GLBL_CMPY_CD   = B.GLBL_CMPY_CD
                      AND P2.DS_CTAC_PNT_PK = B.DS_CTAC_PNT_PK
                 ) A
             WHERE
                 A.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCd_P#
                 AND A.CTAC_PSN_PK = V.CTAC_PSN_PK
            ) AS CTAC_PSN_EXTN_NUM
           ,(
             SELECT
                 A.DS_CTAC_PNT_VAL_TXT
             FROM
                 (
                  SELECT
                      B.CTAC_PSN_PK
                     ,B.DS_CTAC_PNT_TP_CD
                     ,B.DS_CTAC_PNT_PK
                     ,P2.DS_CTAC_PNT_VAL_TXT
                     ,P2.DS_CTAC_PSN_EXTN_NUM
                  FROM
                      DS_CTAC_PNT P2
                     ,(
                       SELECT
                           P.GLBL_CMPY_CD
                          ,P.CTAC_PSN_PK
                          ,TP.DS_CTAC_PNT_TP_CD
                          ,MAX(P.DS_CTAC_PNT_PK) AS DS_CTAC_PNT_PK
                       FROM
                           DS_CTAC_PNT P
                          ,DS_CTAC_PNT_TP TP
                       WHERE
                           P.GLBL_CMPY_CD             = #glblCmpyCd#
                           AND P.DS_CTAC_PNT_ACTV_FLG = 'Y'
                           AND P.EZCANCELFLAG         = '0'
                           AND P.GLBL_CMPY_CD         = TP.GLBL_CMPY_CD
                           AND P.DS_CTAC_PNT_TP_CD    = TP.DS_CTAC_PNT_TP_CD
                           AND TP.EZCANCELFLAG        = '0'
                       GROUP BY
                           P.GLBL_CMPY_CD
                          ,P.CTAC_PSN_PK
                          ,TP.DS_CTAC_PNT_TP_CD
                      ) B
                  WHERE
                      P2.GLBL_CMPY_CD       = #glblCmpyCd#
                      AND P2.EZCANCELFLAG   = '0'
                      AND P2.GLBL_CMPY_CD   = B.GLBL_CMPY_CD
                      AND P2.DS_CTAC_PNT_PK = B.DS_CTAC_PNT_PK
                 ) A
             WHERE
                 A.DS_CTAC_PNT_TP_CD = #dsCtacPntTpCd_E#
                 AND A.CTAC_PSN_PK   = V.CTAC_PSN_PK
            ) AS CTAC_PSN_EML_ADDR
           ,V.DS_PRIM_LOC_FLG
           ,V.RELN_EZUPTIME
           ,V.RELN_EZUPTIMEZONE
           ,V.SORT_NUM <!-- Add 2018/08/28 QC#27869 -->
        FROM 
            (
             SELECT
                  CP.CTAC_PSN_PK
                , CP.CTAC_PSN_NUM
                , DCPR.CTAC_TP_CD
                <!-- START 2017/12/06 Hd.Sugawara [QC#21897,MOD] -->
                <!-- , CT.CTAC_TP_NM -->
                , CT.CTAC_TP_DESC_TXT
                <!-- END 2017/12/06 Hd.Sugawara [QC#21897,MOD] -->
                , CP.CTAC_PSN_FIRST_NM
                , CP.CTAC_PSN_LAST_NM
                , DCPD.DS_CTAC_PSN_DEPT_NM
                , DCPR.DS_CTAC_PSN_RELN_PK
                , DCPR.EFF_FROM_DT
                , DCPR.EFF_THRU_DT
                , CP.CTAC_PSN_ACTV_FLG
                , REPLACE(DCPR.DS_PRIM_LOC_FLG,'N','') AS DS_PRIM_LOC_FLG
                , DCPR.EZUPTIME AS RELN_EZUPTIME
                , DCPR.EZUPTIMEZONE AS RELN_EZUPTIMEZONE
                , CP.EZINTIME             AS XX_REC_HIST_CRAT_TS
                , CP.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
                , CP.EZUPTIME             AS XX_REC_HIST_UPD_TS
                , CP.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
                , 'CTAC_PSN'              AS XX_REC_HIST_TBL_NM
                , 1  AS SORT_NUM <!-- Add 2018/08/28 QC#27869 -->
             FROM
                 DS_CTAC_PSN_RELN DCPR
                ,CTAC_PSN         CP
                ,CTAC_TP          CT
                ,DS_CTAC_PSN_DEPT DCPD
             WHERE
                 DCPR.GLBL_CMPY_CD     = #glblCmpyCd#
                 AND DCPR.DS_ACCT_NUM  = #dsAcctNum#
                 AND DCPR.EZCANCELFLAG = '0'

                 AND DCPR.GLBL_CMPY_CD = CP.GLBL_CMPY_CD
                 AND DCPR.CTAC_PSN_PK  = CP.CTAC_PSN_PK
                 <isNotNull property="ctacPsnPk">
                     AND CP.CTAC_PSN_PK = #ctacPsnPk#
                 </isNotNull>
                 <isNotNull property="ctacPsnActvFlg">
                     AND CP.CTAC_PSN_ACTV_FLG = #ctacPsnActvFlg#
                 </isNotNull>
                 AND CP.EZCANCELFLAG   = '0'

                 AND DCPR.GLBL_CMPY_CD = CT.GLBL_CMPY_CD
                 AND DCPR.CTAC_TP_CD   = CT.CTAC_TP_CD
                 AND CT.EZCANCELFLAG   = '0'

                 AND CP.GLBL_CMPY_CD        = DCPD.GLBL_CMPY_CD (+)
                 AND CP.DS_CTAC_PSN_DEPT_CD = DCPD.DS_CTAC_PSN_DEPT_CD (+)
                 AND DCPD.EZCANCELFLAG (+)  = '0'
             <!-- START 2017/12/18 Hd.Sugawara [QC#22286,DEL] -->
             <!-- ORDER BY -->
             <!--     CP.CTAC_PSN_LAST_NM -->
             <!-- END 2017/12/18 Hd.Sugawara [QC#22286,DEL] -->
            <!-- Add Start 2018/08/28 QC#27869 -->
            UNION ALL
            SELECT 
                  V.CTAC_PSN_PK           AS CTAC_PSN_PK
                , V.CTAC_PSN_NUM          AS CTAC_PSN_NUM
                , V.CTAC_TP_CD            AS CTAC_TP_CD
                , V.CTAC_TP_DESC_TXT      AS CTAC_TP_DESC_TXT
                , V.CTAC_PSN_FIRST_NM     AS CTAC_PSN_FIRST_NM
                , V.CTAC_PSN_LAST_NM      AS CTAC_PSN_LAST_NM
                , ''                      AS DS_CTAC_PSN_DEPT_NM
                , NULL                    AS DS_CTAC_PSN_RELN_PK
                , V.EFF_FROM_DT           AS EFF_FROM_DT
                , V.EFF_THRU_DT           AS EFF_THRU_DT
                , CASE WHEN V.EFF_FROM_DT &lt;= #salesDt# AND  NVL(V.EFF_THRU_DT,#maxDt#) &gt;= #salesDt#  THEN #active# ELSE #inActive# END  CTAC_PSN_ACTV_FLG
                , 'N'                     AS DS_PRIM_LOC_FLG
                , ''                      AS RELN_EZUPTIME
                , ''                      AS RELN_EZUPTIMEZONE
                , ''                      AS XX_REC_HIST_CRAT_TS
                , ''                      AS XX_REC_HIST_CRAT_BY_NM
                , ''                      AS XX_REC_HIST_UPD_TS
                , ''                      AS XX_REC_HIST_UPD_BY_NM
                , ''                      AS XX_REC_HIST_TBL_NM
                , 2                       AS SORT_NUM
            FROM (
                SELECT  
                      DCP.CTAC_PSN_PK AS CTAC_PSN_PK
                    , CP.CTAC_PSN_NUM AS CTAC_PSN_NUM
                    , CP.CTAC_PSN_FIRST_NM AS CTAC_PSN_FIRST_NM
                    , CP.CTAC_PSN_LAST_NM AS CTAC_PSN_LAST_NM
                    , SCP.SVC_CTAC_TP_CD AS CTAC_TP_CD
                    , SCP.SVC_CTAC_TP_DESC_TXT AS CTAC_TP_DESC_TXT
                    , MIN(SMCP.EFF_FROM_DT) AS EFF_FROM_DT
                    , MAX(SMCP.EFF_THRU_DT) AS EFF_THRU_DT
                FROM
                      SVC_MACH_CTAC_PSN SMCP
                    , DS_CTAC_PNT DCP
                    , SVC_CTAC_TP SCP
                    , CTAC_PSN CP
                    , DS_CTAC_PSN_RELN DCPR
                WHERE SMCP.GLBL_CMPY_CD = #glblCmpyCd#
                AND  SMCP.EZCANCELFLAG = '0'
                AND EXISTS ( SELECT
                                1
                             FROM
                                 SVC_MACH_MSTR SMM
                             WHERE
                                 SMM.CUR_LOC_ACCT_NUM LIKE #dsAcctNum#
                             AND SMM.GLBL_CMPY_CD = SMCP.GLBL_CMPY_CD
                             AND SMM.SVC_MACH_MSTR_PK = SMCP.SVC_MACH_MSTR_PK
                             AND SMM.EZCANCELFLAG = '0')

                AND SMCP.GLBL_CMPY_CD = DCP.GLBL_CMPY_CD
                AND SMCP.DS_CTAC_PNT_PK = DCP.DS_CTAC_PNT_PK
                AND DCP.EZCANCELFLAG = '0' 

                AND SMCP.GLBL_CMPY_CD = SCP.GLBL_CMPY_CD
                AND SMCP.SVC_CTAC_TP_CD = SCP.SVC_CTAC_TP_CD 
                AND SCP.EZCANCELFLAG = '0'

                AND DCP.GLBL_CMPY_CD = CP.GLBL_CMPY_CD
                AND DCP.CTAC_PSN_PK = CP.CTAC_PSN_PK
                AND CP.EZCANCELFLAG = '0'
                <isNotEqual property="showInactiveFlg" compareValue="Y">
                    AND SMCP.EFF_FROM_DT &lt;= #salesDt# AND  NVL(SMCP.EFF_THRU_DT,#maxDt#) &gt;= #salesDt#
                </isNotEqual>
                <isNotNull property="ctacPsnPk">
                    AND CP.CTAC_PSN_PK = #ctacPsnPk#
                </isNotNull>

                AND CP.GLBL_CMPY_CD = DCPR.GLBL_CMPY_CD
                AND CP.CTAC_PSN_PK = DCPR.CTAC_PSN_PK
                AND DCPR.DS_ACCT_NUM LIKE #dsAcctNum#
                AND DCPR.EZCANCELFLAG = '0'

                GROUP BY DCP.CTAC_PSN_PK, CP.CTAC_PSN_NUM, CP.CTAC_PSN_FIRST_NM, CP.CTAC_PSN_LAST_NM, SCP.SVC_CTAC_TP_CD, SCP.SVC_CTAC_TP_DESC_TXT
            ) V
        ) V
        <!-- Add End   2018/08/28 QC#27869 -->
    <!-- START 2017/12/18 Hd.Sugawara [QC#22286,ADD] -->
    )
    SELECT
        CTAC_PSN_PK
        , CTAC_PSN_NUM
        , CTAC_TP_CD
        , CTAC_TP_DESC_TXT
        , CTAC_PSN_FIRST_NM
        , CTAC_PSN_LAST_NM
        , DS_CTAC_PSN_DEPT_NM
        , DS_CTAC_PSN_RELN_PK
        , EFF_FROM_DT
        , EFF_THRU_DT
        , CTAC_PSN_ACTV_FLG
        , XX_REC_HIST_CRAT_TS
        , XX_REC_HIST_CRAT_BY_NM
        , XX_REC_HIST_UPD_TS
        , XX_REC_HIST_UPD_BY_NM
        , XX_REC_HIST_TBL_NM
        , CTAC_PSN_TEL_NUM
        , CTAC_PSN_EXTN_NUM
        , CTAC_PSN_EML_ADDR
        , DS_PRIM_LOC_FLG
        , RELN_EZUPTIME
        , RELN_EZUPTIMEZONE
    FROM
        (
            <!-- QC#25154 Del Start -->
            <!--
            SELECT
                CTAC_PSN_PK
              , CTAC_PSN_NUM
              , CTAC_TP_CD
              , CTAC_TP_DESC_TXT
              , CTAC_PSN_FIRST_NM
              , CTAC_PSN_LAST_NM
              , DS_CTAC_PSN_DEPT_NM
              , DS_CTAC_PSN_RELN_PK
              , EFF_FROM_DT
              , EFF_THRU_DT
              , CTAC_PSN_ACTV_FLG
              , XX_REC_HIST_CRAT_TS
              , XX_REC_HIST_CRAT_BY_NM
              , XX_REC_HIST_UPD_TS
              , XX_REC_HIST_UPD_BY_NM
              , XX_REC_HIST_TBL_NM
              , CTAC_PSN_TEL_NUM
              , CTAC_PSN_EXTN_NUM
              , CTAC_PSN_EML_ADDR
              , DS_PRIM_LOC_FLG
              , RELN_EZUPTIME
              , RELN_EZUPTIMEZONE
              , SORT_NUM
            FROM
                ALL_CONTACTS AC
            WHERE
                AC.CTAC_TP_CD &lt;&gt; #ctacTpCd#
            UNION ALL
            -->
            <!-- QC#25154 Del End -->
            SELECT
                CTAC_PSN_PK
              , CTAC_PSN_NUM
              , CTAC_TP_CD
              <!-- START 2018/07/20 Hd.Sugawara [QC#26970,MOD] -->
              <!-- , '' AS CTAC_TP_DESC_TXT -->
              , CASE 
                WHEN AC.CTAC_TP_CD &lt;&gt; #ctacTpCd#
                THEN AC.CTAC_TP_DESC_TXT
                ELSE ''
                END AS CTAC_TP_DESC_TXT
              <!-- END 2018/07/20 Hd.Sugawara [QC#26970,MOD] -->
              , CTAC_PSN_FIRST_NM
              , CTAC_PSN_LAST_NM
              , DS_CTAC_PSN_DEPT_NM
              , DS_CTAC_PSN_RELN_PK
              , EFF_FROM_DT
              , EFF_THRU_DT
              , CTAC_PSN_ACTV_FLG
              , XX_REC_HIST_CRAT_TS
              , XX_REC_HIST_CRAT_BY_NM
              , XX_REC_HIST_UPD_TS
              , XX_REC_HIST_UPD_BY_NM
              , XX_REC_HIST_TBL_NM
              , CTAC_PSN_TEL_NUM
              , CTAC_PSN_EXTN_NUM
              , CTAC_PSN_EML_ADDR
              , DS_PRIM_LOC_FLG
              , RELN_EZUPTIME
              , RELN_EZUPTIMEZONE
              , SUM(
                 CASE WHEN AC.CTAC_TP_CD &lt;&gt; #ctacTpCd# THEN 
                  1 ELSE 
                  0 END) 
                OVER (PARTITION BY AC.CTAC_PSN_NUM) AS CNT_NOT_DELIV_INSTALL
              , SORT_NUM <!-- Add 2018/08/28 QC#27869 -->
            FROM
                ALL_CONTACTS AC
            <!-- START 2018/07/20 Hd.Sugawara [QC#26970,DEL] -->
            <!-- WHERE -->
            <!--     AC.CTAC_TP_CD = #ctacTpCd# -->
            <!-- END 2018/07/20 Hd.Sugawara [QC#26970,DEL] -->
                <!-- QC#25154 Del Start -->
                <!--
                AND NOT EXISTS ( 
                    SELECT
                        CTAC_TP_CD
                    FROM
                        ALL_CONTACTS AC2
                    WHERE
                        AC2.CTAC_TP_CD &lt;&gt; #ctacTpCd#
                        AND AC.CTAC_PSN_NUM = AC2.CTAC_PSN_NUM
                )
                -->
                <!-- QC#25154 Del End -->
            ORDER BY
                CTAC_PSN_LAST_NM,SORT_NUM,CTAC_TP_CD
        ) 
    <!-- END 2017/12/18 Hd.Sugawara [QC#22286,ADD] -->
        WHERE
        <!-- QC#25154 Add Start -->
        (
            CTAC_TP_CD &lt;&gt; #ctacTpCd#
        OR
            (
                CTAC_TP_CD = #ctacTpCd#
            AND
                CNT_NOT_DELIV_INSTALL = 0
            )
        )
        AND
        <!-- QC#25154 Add End -->
            ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getDsAcctList" parameterClass="Map" resultClass="Map">
        SELECT
                A.DS_ACCT_DUNS_NUM          AS DS_ACCT_DUNS_NUM
               ,A.DS_ULT_DUNS_NUM           AS DS_ULT_DUNS_NUM
               ,A.DS_LOC_EMP_NUM            AS DS_LOC_EMP_NUM
               ,A.DS_LOC_REV_AMT            AS DS_LOC_REV_AMT
               ,A.INDY_TP_CD                AS INDY_TP_CD
               ,A.DS_CUST_SIC_CD            AS DS_CUST_SIC_CD
               ,A.DS_LAST_UPD_DUNS_DT       AS DS_LAST_UPD_DUNS_DT
               ,A.DS_ACCT_URL               AS DS_ACCT_URL
               ,A.BIZ_HRS_SUN_FROM_TM       AS BIZ_HRS_SUN_FROM_TM
               ,A.BIZ_HRS_SUN_TO_TM         AS BIZ_HRS_SUN_TO_TM
               ,A.BIZ_HRS_MON_FRI_FROM_TM   AS BIZ_HRS_MON_FRI_FROM_TM
               ,A.BIZ_HRS_MON_FRI_TO_TM     AS BIZ_HRS_MON_FRI_TO_TM
               ,A.BIZ_HRS_SAT_FROM_TM       AS BIZ_HRS_SAT_FROM_TM
               ,A.BIZ_HRS_SAT_TO_TM         AS BIZ_HRS_SAT_TO_TM
               ,A.DS_CUST_SIC_DESC_TXT      AS DS_CUST_SIC_DESC_TXT
               ,A.CMPY_PK                   AS CMPY_PK
               ,A.EZUPTIME                  AS EZUPTIME
               ,A.EZUPTIMEZONE              AS EZUPTIMEZONE
        FROM (
              SELECT
                      DAC.DS_ACCT_DUNS_NUM        AS DS_ACCT_DUNS_NUM
                     ,DAC.DS_ULT_DUNS_NUM         AS DS_ULT_DUNS_NUM
                     ,DAC.DS_LOC_EMP_NUM          AS DS_LOC_EMP_NUM
                     ,DAC.DS_LOC_REV_AMT          AS DS_LOC_REV_AMT
                     ,DAC.INDY_TP_CD              AS INDY_TP_CD
                     ,DAC.DS_CUST_SIC_CD          AS DS_CUST_SIC_CD
                     ,DAC.DS_LAST_UPD_DUNS_DT     AS DS_LAST_UPD_DUNS_DT
                     ,DAC.DS_ACCT_URL             AS DS_ACCT_URL
                     ,DAC.BIZ_HRS_SUN_FROM_TM     AS BIZ_HRS_SUN_FROM_TM
                     ,DAC.BIZ_HRS_SUN_TO_TM       AS BIZ_HRS_SUN_TO_TM
                     ,DAC.BIZ_HRS_MON_FRI_FROM_TM AS BIZ_HRS_MON_FRI_FROM_TM
                     ,DAC.BIZ_HRS_MON_FRI_TO_TM   AS BIZ_HRS_MON_FRI_TO_TM
                     ,DAC.BIZ_HRS_SAT_FROM_TM     AS BIZ_HRS_SAT_FROM_TM
                     ,DAC.BIZ_HRS_SAT_TO_TM       AS BIZ_HRS_SAT_TO_TM
                     ,DAC.DS_CUST_SIC_DESC_TXT    AS DS_CUST_SIC_DESC_TXT
                     ,DAC.CMPY_PK                 AS CMPY_PK
                     ,DAC.EZUPTIME                AS EZUPTIME
                     ,DAC.EZUPTIMEZONE            AS EZUPTIMEZONE
              FROM
                      SELL_TO_CUST DAC
              WHERE
                      DAC.GLBL_CMPY_CD         = #glblCmpyCd#
              AND     DAC.SELL_TO_CUST_CD      = #dsAcctNum#
              AND     DAC.EZCANCELFLAG         = '0'
              UNION ALL
              SELECT
                      DAP.DS_ACCT_DUNS_NUM        AS DS_ACCT_DUNS_NUM
                     ,DAP.DS_ULT_DUNS_NUM         AS DS_ULT_DUNS_NUM
                     ,DAP.DS_LOC_EMP_NUM          AS DS_LOC_EMP_NUM
                     ,DAP.DS_LOC_REV_AMT          AS DS_LOC_REV_AMT
                     ,DAP.INDY_TP_CD              AS INDY_TP_CD
                     ,DAP.DS_CUST_SIC_CD          AS DS_CUST_SIC_CD
                     ,DAP.DS_LAST_UPD_DUNS_DT     AS DS_LAST_UPD_DUNS_DT
                     ,DAP.DS_ACCT_URL             AS DS_ACCT_URL
                     ,DAP.BIZ_HRS_SUN_FROM_TM     AS BIZ_HRS_SUN_FROM_TM
                     ,DAP.BIZ_HRS_SUN_TO_TM       AS BIZ_HRS_SUN_TO_TM
                     ,DAP.BIZ_HRS_MON_FRI_FROM_TM AS BIZ_HRS_MON_FRI_FROM_TM
                     ,DAP.BIZ_HRS_MON_FRI_TO_TM   AS BIZ_HRS_MON_FRI_TO_TM
                     ,DAP.BIZ_HRS_SAT_FROM_TM     AS BIZ_HRS_SAT_FROM_TM
                     ,DAP.BIZ_HRS_SAT_TO_TM       AS BIZ_HRS_SAT_TO_TM
                     ,DAP.DS_CUST_SIC_DESC_TXT    AS DS_CUST_SIC_DESC_TXT
                     ,DAP.CMPY_PK                 AS CMPY_PK
                     ,DAP.EZUPTIME                AS EZUPTIME
                     ,DAP.EZUPTIMEZONE            AS EZUPTIMEZONE
              FROM
                      DS_ACCT_PROS DAP
              WHERE
                      DAP.GLBL_CMPY_CD         = #glblCmpyCd#
              AND     DAP.DS_ACCT_NUM          = #dsAcctNum#
              AND     DAP.EZCANCELFLAG         = '0'
           ) A
    </statement>

    <statement id="getDsAcctGrpAsgList" parameterClass="Map" resultClass="Map">
        SELECT * FROM (
            SELECT
                    DAGA.EZUPTIME
                   ,DAGA.EZUPTIMEZONE
                   ,DAGA.DS_ACCT_GRP_ASG_PK
                   ,DAGA.DS_BIZ_AREA_CD
                   ,DAGA.DS_ACCT_GRP_CD
                   ,DAG.DS_ACCT_GRP_DESC_TXT
                   ,DAGA.DS_ACCT_NUM
                   ,DAGA.EFF_FROM_DT
                   ,DAGA.EFF_THRU_DT
                   , DAGA.EZINTIME             AS XX_REC_HIST_CRAT_TS
                   , DAGA.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
                   , DAGA.EZUPTIME             AS XX_REC_HIST_UPD_TS
                   , DAGA.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
                   , 'DS_ACCT_GRP_ASG'         AS XX_REC_HIST_TBL_NM
            FROM
                    DS_ACCT_GRP_ASG DAGA
                   ,DS_ACCT_GRP     DAG
                   ,DS_BIZ_AREA     DBA
            WHERE
                    DAGA.GLBL_CMPY_CD         = #glblCmpyCd#
            AND     DAGA.DS_ACCT_NUM          = #dsAcctNum#
            AND     DAGA.EZCANCELFLAG         = '0'
            
            AND     DAGA.GLBL_CMPY_CD         = DAG.GLBL_CMPY_CD
            AND     DAGA.DS_ACCT_GRP_CD       = DAG.DS_ACCT_GRP_CD
            AND     DAG.EZCANCELFLAG          = '0'
            
            AND     DAGA.GLBL_CMPY_CD         = DBA.GLBL_CMPY_CD
            AND     DAGA.DS_BIZ_AREA_CD       = DBA.DS_BIZ_AREA_CD
            AND     DBA.EZCANCELFLAG          = '0'
    
            ORDER BY DBA.DS_BIZ_AREA_SORT_NUM , DAG.DS_ACCT_GRP_SORT_NUM , DAGA.EFF_FROM_DT
        )
        WHERE ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getCertificationReqList" parameterClass="Map" resultClass="Map">
        SELECT
                SAP.SVC_ACCS_PMIT_NUM          AS SVC_ACCS_PMIT_NUM
               ,SAP.EFF_FROM_DT                AS EFF_FROM_DT
               ,SAP.EFF_TO_DT                  AS EFF_TO_DT
               ,SAP.SVC_ACCS_PMIT_PK           AS SVC_ACCS_PMIT_PK
               ,SAP.EZUPTIME                   AS EZUPTIME
               ,SAP.EZUPTIMEZONE               AS EZUPTIMEZONE
               ,SAPV.SVC_ACCS_PMIT_DESC_TXT    AS SVC_ACCS_PMIT_DESC_TXT
               , SAP.EZINTIME             AS XX_REC_HIST_CRAT_TS
               , SAP.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
               , SAP.EZUPTIME             AS XX_REC_HIST_UPD_TS
               , SAP.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
               , 'SVC_ACCS_PMIT'          AS XX_REC_HIST_TBL_NM
        FROM
                SVC_ACCS_PMIT        SAP
               ,SVC_ACCS_PMIT_VAL    SAPV
        WHERE
                SAP.GLBL_CMPY_CD           = #glblCmpyCd#
        AND     SAP.SVC_PMIT_LVL_TP_CD     = #party#
        AND     SAP.SVC_PMIT_LVL_VAL_TXT   = #dsAcctNum#
        AND     SAP.EZCANCELFLAG           = '0'
        AND     SAP.GLBL_CMPY_CD           = SAPV.GLBL_CMPY_CD
        AND     SAP.SVC_ACCS_PMIT_NUM      = SAPV.SVC_ACCS_PMIT_NUM
        AND     SAPV.EZCANCELFLAG          = '0'
        ORDER BY SAPV.SVC_ACCS_PMIT_NUM , SAP.EFF_FROM_DT
    </statement>

    <statement id="getDsCustTrxRuleList" parameterClass="Map" resultClass="Map">
        SELECT
                DCTR.EZUPTIME
               ,DCTR.EZUPTIMEZONE
               ,DCTR.DS_CUST_TRX_RULE_PK
               ,DCTR.DS_TRX_RULE_TP_CD
               ,DCTR.DS_PO_REQ_FLG
               <!-- 2022/11/25 QC#60398 Add Start -->
               ,DCTR.HARD_COPY_REQ_FLG
               <!-- 2022/11/25 QC#60398 Add End -->
               ,DCTR.DS_BLKT_PO_NUM
               ,DCTR.DS_PO_EXPR_DT
               ,DCTR.DS_PO_EXPR_DT
               ,DCTR.DS_DEF_BILL_TO_CD
               ,DCTR.DS_DEF_SHIP_TO_CD
               ,DCTR.CUST_EFF_LVL_CD
               ,DCTR.DS_CR_CARD_REQ_FLG
               ,DCTR.DS_OVNGT_ALLW_FLG
               , DCTR.EZINTIME                 AS XX_REC_HIST_CRAT_TS
               , DCTR.EZINUSERID               AS XX_REC_HIST_CRAT_BY_NM
               , DCTR.EZUPTIME                 AS XX_REC_HIST_UPD_TS
               , DCTR.EZUPUSERID               AS XX_REC_HIST_UPD_BY_NM
               , 'DS_CUST_TRX_RULE'            AS XX_REC_HIST_TBL_NM
        FROM
                DS_CUST_TRX_RULE DCTR
                ,DS_TRX_RULE_TP DTRT
        WHERE
                DCTR.GLBL_CMPY_CD         = #glblCmpyCd#
        AND     DCTR.DS_ACCT_NUM          = #dsAcctNum#
        AND     DCTR.EZCANCELFLAG         = '0'
        <iterate property="custEffLvlCdList" var="custEffLvlCd[]" open="AND     DCTR.CUST_EFF_LVL_CD IN (" close=")" conjunction=",">
            #custEffLvlCd[]#
        </iterate>
        AND DCTR.GLBL_CMPY_CD      = DTRT.GLBL_CMPY_CD
        AND DCTR.DS_TRX_RULE_TP_CD = DTRT.DS_TRX_RULE_TP_CD
        AND DTRT.EZCANCELFLAG      = '0'

        ORDER BY DTRT.DS_TRX_RULE_TP_SORT_NUM
    </statement>

    <statement id="getDsCustSpclHdlgList" parameterClass="Map" resultClass="Map">
        SELECT
            HDLG.DS_SPCL_HDLG_TP_CD            AS DS_SPCL_HDLG_TP_CD
            , HDLG.DS_SPCL_HDLG_TP_VAL_CD      AS DS_SPCL_HDLG_TP_VAL_CD
            , HDLG.EFF_FROM_DT                 AS EFF_FROM_DT
            , HDLG.EFF_THRU_DT                 AS EFF_THRU_DT
            , HDLG.DS_CUST_SPCL_HDLG_PK        AS DS_CUST_SPCL_HDLG_PK
            , HDLG.EZUPTIME                    AS EZUPTIME
            , HDLG.EZUPTIMEZONE                AS EZUPTIMEZONE
            , HDLG.CUST_EFF_LVL_CD             AS CUST_EFF_LVL_CD
            , HDLG.EZINTIME             AS XX_REC_HIST_CRAT_TS
            , HDLG.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
            , HDLG.EZUPTIME             AS XX_REC_HIST_UPD_TS
            , HDLG.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
            , 'DS_CUST_SPCL_HDLG'       AS XX_REC_HIST_TBL_NM
        FROM DS_CUST_SPCL_HDLG HDLG
            , DS_SPCL_HDLG_TP DSHT
        WHERE HDLG.GLBL_CMPY_CD = #glblCmpyCd#
        AND HDLG.EZCANCELFLAG = '0'
        AND HDLG.DS_ACCT_NUM = #dsAcctNum#

        AND HDLG.GLBL_CMPY_CD = DSHT.GLBL_CMPY_CD
        AND HDLG.DS_SPCL_HDLG_TP_CD = DSHT.DS_SPCL_HDLG_TP_CD
        AND HDLG.DS_SPCL_HDLG_TP_VAL_CD = DSHT.DS_SPCL_HDLG_TP_VAL_CD
        AND DSHT.EZCANCELFLAG = '0'

        ORDER BY DSHT.DS_SPCL_HDLG_TP_NM , DSHT.DS_SPCL_HDLG_TP_VAL_NM
    </statement>

    <statement id="getDsAcctCrPrflInfo" parameterClass="Map" resultClass="Map">
        SELECT
                 DACP.EZUPTIME
               , DACP.EZUPTIMEZONE
               , DACP.CCY_CD
               , DACP.CUST_CR_RTG_CD

               , DACP.CONTR_CR_RISK_CLS_CD

               , DACP.CR_LIMIT_AMT
               , DACP.CR_CHK_REQ_TP_CD
               , DACP.CR_RISK_CLS_CD
               , DACP.PMT_TERM_CASH_DISC_CD
               , DACP.OVRD_PMT_TERM_FLG
               , DACP.CASH_OR_CC_REQ_FLG
               , DACP.CUST_HARD_HLD_FLG
               , DACP.AUTO_CASH_HRCH_CD
               , DACP.EZINTIME             AS XX_REC_HIST_CRAT_TS
               , DACP.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
               , DACP.EZUPTIME             AS XX_REC_HIST_UPD_TS
               , DACP.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
               , 'DS_ACCT_CR_PRFL'         AS XX_REC_HIST_TBL_NM
        FROM
                DS_ACCT_CR_PRFL DACP
        WHERE
                DACP.GLBL_CMPY_CD         = #glblCmpyCd#
        AND     DACP.DS_ACCT_NUM          = #dsAcctNum#
        AND     DACP.EZCANCELFLAG         = '0'
    </statement>
    
    <statement id="getDsCustInvRuleList" parameterClass="Map" resultClass="Map">
        SELECT
                 DCIR.EZUPTIME
               , DCIR.EZUPTIMEZONE
               , DCIR.DS_CUST_INV_RULE_PK
               , DCIR.CUST_INV_SRC_CD
               , DCIR.CUST_BLLG_TP_CD
               , DCIR.CUST_CONSL_TERM_CD
               , DCIR.CUST_BLLG_VCLE_CD
               , DCIR.ITRL_RVW_PSN_CD
               , DCIR.CTAC_PSN_PK
               , DCIR.CUST_EML_MSG_TXT
               , DCIR.DEF_INV_GRP_CD
               , DCIR.INV_GRP_NUM
               , DCIR.CUST_EFF_LVL_CD
               , DCIR.EZINTIME             AS XX_REC_HIST_CRAT_TS
               , DCIR.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
               , DCIR.EZUPTIME             AS XX_REC_HIST_UPD_TS
               , DCIR.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
               , 'DS_CUST_INV_RULE'        AS XX_REC_HIST_TBL_NM
        FROM
                DS_CUST_INV_RULE DCIR
               , CUST_INV_SRC CIS
        WHERE
                DCIR.GLBL_CMPY_CD         = #glblCmpyCd#
        AND     DCIR.DS_ACCT_NUM          = #dsAcctNum#
        AND     DCIR.EZCANCELFLAG         = '0'

        AND     DCIR.GLBL_CMPY_CD         = CIS.GLBL_CMPY_CD
        AND     DCIR.CUST_INV_SRC_CD      = CIS.CUST_INV_SRC_CD
        AND     CIS.EZCANCELFLAG         = '0'

        ORDER BY CIS.CUST_INV_SRC_SORT_NUM 
    </statement>
    
    <statement id="getDsAcctRefAttrbList" parameterClass="Map" resultClass="Map">
        SELECT
                 DARA.EZUPTIME
               , DARA.EZUPTIMEZONE
               , DARA.DS_ACCT_REF_ATTRB_PK
               , DARA.BLLG_ATTRB_NM
               , DARA.BLLG_ATTRB_VAL_TXT
               , DARA.BLLG_ATTRB_ENBL_FLG
               , DARA.BLLG_ATTRB_REQ_FLG
               , DARA.CUST_EFF_LVL_CD
               , DARA.DS_ACCT_REF_ATTRB_NUM
               , DARA.EZINTIME             AS XX_REC_HIST_CRAT_TS
               , DARA.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
               , DARA.EZUPTIME             AS XX_REC_HIST_UPD_TS
               , DARA.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
               , 'DS_ACCT_REF_ATTRB'       AS XX_REC_HIST_TBL_NM
        FROM
                DS_ACCT_REF_ATTRB DARA
        WHERE
                DARA.GLBL_CMPY_CD         = #glblCmpyCd#
        AND     DARA.DS_ACCT_NUM          = #dsAcctNum#
        AND     DARA.EZCANCELFLAG         = '0'
        ORDER BY 
                DARA.DS_ACCT_REF_ATTRB_NUM
               ,DARA.DS_ACCT_REF_ATTRB_PK
    </statement>
    
    <statement id="getDsCustBankAcctList" parameterClass="Map" resultClass="Map">
        SELECT
                DBA.EZUPTIME
               ,DBA.EZUPTIMEZONE
               ,DCBAR.DS_CUST_BANK_ACCT_RELN_PK
               ,DBA.EFF_FROM_DT
               ,DBA.EFF_THRU_DT
               ,DBA.DS_BANK_ACCT_PK
               ,DBA.DS_BANK_ACCT_NM
               ,CASE WHEN LENGTH(DBA.DS_BANK_ACCT_NUM) &lt;= 4 THEN
                     REGEXP_REPLACE(DBA.DS_BANK_ACCT_NUM,'.','*')
                ELSE 
                     REGEXP_REPLACE(SUBSTR(DBA.DS_BANK_ACCT_NUM, 1, LENGTH(DBA.DS_BANK_ACCT_NUM) - 4),'.','*')
                          || SUBSTR(DBA.DS_BANK_ACCT_NUM, LENGTH(DBA.DS_BANK_ACCT_NUM) - 4 + 1)
                END AS MASK_BANK_ACCT_NUM
               ,CASE WHEN LENGTH(DBA.BANK_RTE_NUM) &lt;= 4 THEN
                     REGEXP_REPLACE(DBA.BANK_RTE_NUM,'.','*')
                ELSE 
                     REGEXP_REPLACE(SUBSTR(DBA.BANK_RTE_NUM, 1, LENGTH(DBA.BANK_RTE_NUM) - 4),'.','*')
                          || SUBSTR(DBA.BANK_RTE_NUM, LENGTH(DBA.BANK_RTE_NUM) - 4 + 1) 
                END AS MASK_BANK_RTE_NUM
                ,C.CCY_NM
                , DBA.EZINTIME             AS XX_REC_HIST_CRAT_TS
                , DBA.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
                , DBA.EZUPTIME             AS XX_REC_HIST_UPD_TS
                , DBA.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
                , 'DS_BANK_ACCT'           AS XX_REC_HIST_TBL_NM
        FROM
                DS_CUST_BANK_ACCT_RELN DCBAR
               ,DS_BANK_ACCT DBA
               ,CCY C
               ,(SELECT
                       DS.EZCANCELFLAG
                      ,DS.GLBL_CMPY_CD
                      ,DS.SELL_TO_CUST_PK AS DS_ACCT_CUST_PK
                 FROM
                      SELL_TO_CUST DS
                 WHERE
                      DS.GLBL_CMPY_CD    = #glblCmpyCd#
                 AND  DS.EZCANCELFLAG    = '0'
                 AND  DS.SELL_TO_CUST_CD = #dsAcctNum#
                 UNION ALL
                 SELECT
                      DAP.EZCANCELFLAG
                     ,DAP.GLBL_CMPY_CD
                     ,DAP.DS_ACCT_PROS_PK AS DS_ACCT_CUST_PK
                 FROM
                      DS_ACCT_PROS DAP
                 WHERE
                      DAP.GLBL_CMPY_CD   = #glblCmpyCd#
                 AND  DAP.EZCANCELFLAG   = '0'
                 AND  DAP.DS_ACCT_NUM    = #dsAcctNum#
               ) ACCT
        WHERE
        <!-- DS_CUST_BANK_ACCT_RELN -->
                ACCT.GLBL_CMPY_CD           = DCBAR.GLBL_CMPY_CD
        AND     ACCT.DS_ACCT_CUST_PK        = DCBAR.DS_ACCT_CUST_PK
        AND     DCBAR.EZCANCELFLAG          = '0'
        <!-- DS_BANK_ACCT -->
        AND     DCBAR.GLBL_CMPY_CD          = DBA.GLBL_CMPY_CD
        AND     DCBAR.DS_BANK_ACCT_PK       = DBA.DS_BANK_ACCT_PK
        AND     DBA.EZCANCELFLAG            = '0'
        <!-- CCY -->
        AND     DBA.GLBL_CMPY_CD            = C.GLBL_CMPY_CD
        AND     DBA.CCY_CD                  = C.CCY_CD
        AND     C.EZCANCELFLAG              = '0'
        ORDER BY 
                DBA.DS_BANK_ACCT_NM
    </statement>
    
    <statement id="getDsAcctCarrList" parameterClass="Map" resultClass="Map">
        SELECT
                 DAC.VND_CD              VND_CD
               , DAC.DS_CARR_ACCT_NUM    DS_CARR_ACCT_NUM
               , DAC.EFF_FROM_DT         EFF_FROM_DT
               , DAC.EFF_THRU_DT         EFF_THRU_DT
               , DAC.DEF_ACCT_CARR_FLG   DEF_ACCT_CARR_FLG
               , DAC.DS_ACCT_CARR_PK     DS_ACCT_CARR_PK
               , DAC.EZUPTIME            EZUPTIME
               , DAC.EZUPTIMEZONE        EZUPTIMEZONE
               , DAC.EZINTIME             AS XX_REC_HIST_CRAT_TS
               , DAC.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
               , DAC.EZUPTIME             AS XX_REC_HIST_UPD_TS
               , DAC.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
               , 'DS_ACCT_CARR'           AS XX_REC_HIST_TBL_NM
        FROM
                DS_ACCT_CARR DAC
               , VND V
        WHERE
                DAC.GLBL_CMPY_CD           = #glblCmpyCd#
        AND     DAC.DS_ACCT_NUM            = #dsAcctNum#
        AND     DAC.EZCANCELFLAG           = '0'

        AND     DAC.GLBL_CMPY_CD           = V.GLBL_CMPY_CD
        AND     DAC.VND_CD                 = V.VND_CD
        AND     V.EZCANCELFLAG             = '0'
        ORDER BY 
                V.LOC_NM , DAC.EFF_FROM_DT
    </statement>

    <statement id="getBankAcctPulldownList" parameterClass="Map" resultClass="Map">
        SELECT
                V.VND_CD    VND_CD
               ,V.LOC_NM    LOC_NM
        FROM
                VND_TP_RELN VTR
               ,VND         V
        WHERE
                VTR.GLBL_CMPY_CD              = #glblCmpyCd#
        AND     VTR.VND_TP_CD                 = #outboundCarrier#
        AND     VTR.EZCANCELFLAG              = '0'
        AND     VTR.GLBL_CMPY_CD              = V.GLBL_CMPY_CD
        AND     VTR.VND_CD                    = V.VND_CD
        AND     V.EFF_FROM_DT                 &lt;= #salesDate#
        AND     NVL(V.EFF_THRU_DT, #maxDate#) &gt;= #salesDate#
        AND     V.EZCANCELFLAG                = '0'
        ORDER BY 
                V.LOC_NM
    </statement>

    <statement id="getDsCustSpclMsgList" parameterClass="Map" resultClass="Map">
        SELECT * FROM (
            SELECT
                    DCSM.EZUPTIME
                   ,DCSM.EZUPTIMEZONE
                   ,DCSM.DS_CUST_SPCL_MSG_PK
                   ,DCSM.LINE_BIZ_TP_CD
                   ,DCSM.DS_BIZ_AREA_CD
                   ,DCSM.DS_CUST_MSG_TP_CD
                   ,DCSM.DS_CUST_MSG_TXT
                   ,DCSM.DS_PRINT_ON_INV_FLG
                   ,DCSM.CUST_EFF_LVL_CD
                   ,DCSM.EFF_FROM_DT
                   ,DCSM.EFF_THRU_DT
                   , DCSM.EZINTIME             AS XX_REC_HIST_CRAT_TS
                   , DCSM.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
                   , DCSM.EZUPTIME             AS XX_REC_HIST_UPD_TS
                   , DCSM.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
                   , 'DS_CUST_SPCL_MSG'        AS XX_REC_HIST_TBL_NM
            FROM
                    DS_CUST_SPCL_MSG DCSM
                    , LINE_BIZ_TP LBT
                    , DS_BIZ_AREA DBA
                    , DS_CUST_MSG_TP DCMT
            WHERE
                    DCSM.GLBL_CMPY_CD          = #glblCmpyCd#
            AND     DCSM.DS_ACCT_NUM           = #dsAcctNum#
            AND     DCSM.EZCANCELFLAG          = '0' 
    
            AND     DCSM.GLBL_CMPY_CD          = LBT.GLBL_CMPY_CD
            AND     DCSM.LINE_BIZ_TP_CD        = LBT.LINE_BIZ_TP_CD 
            AND     LBT.EZCANCELFLAG           = '0' 
    
            AND     DCSM.GLBL_CMPY_CD          = DBA.GLBL_CMPY_CD
            AND     DCSM.DS_BIZ_AREA_CD        = DBA.DS_BIZ_AREA_CD 
            AND     DBA.EZCANCELFLAG           = '0' 
    
            AND     DCSM.GLBL_CMPY_CD          = DCMT.GLBL_CMPY_CD
            AND     DCSM.DS_CUST_MSG_TP_CD     = DCMT.DS_CUST_MSG_TP_CD
            AND     DCMT.EZCANCELFLAG          = '0' 
    
            ORDER BY 
                    LBT.LINE_BIZ_TP_SORT_NUM, DBA.DS_BIZ_AREA_SORT_NUM, DCMT.DS_CUST_MSG_TP_SORT_NUM, DCSM.DS_CUST_SPCL_MSG_PK DESC, NVL(DCSM.EFF_THRU_DT,#maxEffThruDt#) DESC
        )
        WHERE ROWNUM &lt;= #rowNum#
    </statement>
    
  <statement id="getTemplate" parameterClass="Map" resultMap="result.getTemplate">
       SELECT
            DCAT.CCY_CD
            , DCAT.CUST_CR_RTG_CD
            , DCAT.CR_LIMIT_AMT
            , DCAT.CR_CHK_REQ_TP_CD
            , DCAT.CR_RISK_CLS_CD
            , DCAT.CONTR_CR_RISK_CLS_CD
            , DCAT.OVRD_PMT_TERM_FLG
            , DCAT.CASH_OR_CC_REQ_FLG
            , DCAT.CUST_HARD_HLD_FLG
            , DCAT.AR_STMT_FLG
            , DCAT.DUN_FLG
            , DCAT.CLT_CUST_TP_CD
            , DCAT.DS_CLT_ACCT_STS_CD
            , DCAT.LATE_FEE_FLG
            , DCAT.LATE_FEE_AMT
            , DCAT.DS_TAX_CD
            , DCAT.DS_CUST_TAX_CALC_CD
            , DCAT.DS_TAX_EXEM_FLG
            , DCAT.DS_EXEM_EXPR_DT
            , DCAT.DS_TAX_GRP_EXEM_CD
            , DCAT.DS_TAX_PRNT_TP_CD
            , DCAT.PMT_TERM_CASH_DISC_CD
            , PTFO.CLT_PTFO_CD
            , CYCLE.AR_STMT_ISS_CYCLE_CD
            , DCAT.SEND_CR_BAL_STMT_FLG
            <!-- Add Start 2019/02/13 QC#30293 -->
            , DCAT.AUTO_CASH_HRCH_CD
            <!-- Add End 2019/02/13 QC#30293 -->
        FROM
            DS_CUST_AR_TMPL DCAT 
            , CLT_PTFO PTFO
            , AR_STMT_ISS_CYCLE CYCLE
        WHERE
            DCAT.GLBL_CMPY_CD = #glblCmpyCd#
        <isNull property="dsCustArTmplNm">
          AND DCAT.DS_DEF_TMPL_FLG = 'Y'
        </isNull>
        <isNotNull property="dsCustArTmplNm">
          AND DCAT.DS_CUST_AR_TMPL_NM = #dsCustArTmplNm#
        </isNotNull>
        AND DCAT.EZCANCELFLAG = '0'
        
        AND DCAT.GLBL_CMPY_CD = PTFO.GLBL_CMPY_CD(+)
        AND DCAT.CLT_PTFO_PK = PTFO.CLT_PTFO_PK(+)
        AND PTFO.EZCANCELFLAG(+) = '0'

        AND DCAT.GLBL_CMPY_CD = CYCLE.GLBL_CMPY_CD(+)
        AND DCAT.AR_STMT_ISS_DAY = CYCLE.AR_STMT_ISS_DAY(+)
        AND CYCLE.EZCANCELFLAG(+) = '0'

        AND ROWNUM = 1
  </statement>

  <resultMap id="result.getTemplate" class="NMAL6700SMsg">
    <result property="ccyCd_U3"               column="CCY_CD"                 javaType="EZDSStringItem" />
    <result property="custCrRtgCd_U3"         column="CUST_CR_RTG_CD"         javaType="EZDSStringItem" />
    <result property="crLimitAmt_U1"          column="CR_LIMIT_AMT"           javaType="EZDSBigDecimalItem" />
    <result property="crChkReqTpCd_U3"        column="CR_CHK_REQ_TP_CD"       javaType="EZDSStringItem" />
    <result property="crRiskClsCd_U3"         column="CR_RISK_CLS_CD"         javaType="EZDSStringItem" />
    <result property="contrCrRiskClsCd_U3"    column="CONTR_CR_RISK_CLS_CD"   javaType="EZDSStringItem" />
    <result property="ovrdPmtTermFlg_U1"      column="OVRD_PMT_TERM_FLG"      javaType="EZDSStringItem" />
    <result property="cashOrCcReqFlg_U1"      column="CASH_OR_CC_REQ_FLG"     javaType="EZDSStringItem" />
    <result property="custHardHldFlg_U1"      column="CUST_HARD_HLD_FLG"      javaType="EZDSStringItem" />
    <result property="arStmtFlg_U1"           column="AR_STMT_FLG"            javaType="EZDSStringItem" />

    <result property="sendCrBalStmtFlg_U1"    column="SEND_CR_BAL_STMT_FLG"   javaType="EZDSStringItem" />

    <result property="arStmtIssCycleCd_U3"    column="AR_STMT_ISS_CYCLE_CD"   javaType="EZDSStringItem" />
    <result property="cltCustTpCd_U1"         column="CLT_CUST_TP_CD"         javaType="EZDSStringItem" />
    <result property="dsCltAcctStsCd_U3"      column="DS_CLT_ACCT_STS_CD"     javaType="EZDSStringItem" />
    <result property="lateFeeFlg_U1"          column="LATE_FEE_FLG"           javaType="EZDSStringItem" />
    <result property="lateFeeAmt_U1"          column="LATE_FEE_AMT"           javaType="EZDSBigDecimalItem" />
    <result property="dsTaxExemFlg_U1"        column="DS_TAX_EXEM_FLG"        javaType="EZDSStringItem" />
    <result property="dsExemExprDt_U1"        column="DS_EXEM_EXPR_DT"        javaType="EZDSStringItem" />
    <result property="dsTaxGrpExemCd_U3"      column="DS_TAX_GRP_EXEM_CD"     javaType="EZDSStringItem" />
    <result property="dsTaxPrntTpCd_U3"       column="DS_TAX_PRNT_TP_CD"      javaType="EZDSStringItem" />
    <result property="pmtTermCashDiscCd_U3"   column="PMT_TERM_CASH_DISC_CD"  javaType="EZDSStringItem" />
    <result property="cltPtfoCd_U1"           column="CLT_PTFO_CD"            javaType="EZDSStringItem" />
    <!-- Add Start 2019/02/13 QC#30293 -->
    <result property="autoCashHrchCd_U3"      column="AUTO_CASH_HRCH_CD"      javaType="EZDSStringItem" />
    <!-- Add End 2019/02/13 QC#30293 -->
  </resultMap>

    <statement id="countLeaseCmpy" parameterClass="Map" resultClass="BigDecimal">
        SELECT COUNT(*) 
        FROM
            SELL_TO_CUST ACCT
            ,DS_ACCT_CLS CLS
        WHERE
            ACCT.GLBL_CMPY_CD = #glblCmpyCd#
        AND ACCT.EZCANCELFLAG = '0'
        AND ACCT.SELL_TO_CUST_CD = #dsAcctNum#
        
        AND ACCT.GLBL_CMPY_CD = CLS.GLBL_CMPY_CD
        AND ACCT.DS_ACCT_CLS_CD = CLS.DS_ACCT_CLS_CD
        AND CLS.LEASE_CMPY_FLG = 'Y'
        AND CLS.EZCANCELFLAG = '0'
    </statement>

    <statement id="countCltPtfo" parameterClass="Map" resultClass="BigDecimal">
        SELECT COUNT(*) 
        FROM
            CLT_PTFO PTFO
        WHERE
            PTFO.GLBL_CMPY_CD = #glblCmpyCd#
        AND PTFO.EZCANCELFLAG = '0'
        AND PTFO.CLT_PTFO_CD = #cltPtfoCd#
    </statement>

    <statement id="GetCltPtfoNm" parameterClass="Map" resultClass="Map">
        SELECT P.CLT_PTFO_DESC_TXT AS CLT_PTFO_DESC_TXT
            , P.CLT_PTFO_PK  AS CLT_PTFO_PK
        FROM CLT_PTFO P
        WHERE P.GLBL_CMPY_CD = #glblCmpyCd#
        AND P.EZCANCELFLAG = '0'
        AND P.CLT_PTFO_CD = #cltPtfoCd#
    </statement>

    <statement id="getPrimaryLocation" parameterClass="Map" resultClass="Map">
        SELECT
              PLW.PTY_LOC_PK       AS PTY_LOC_PK
            , PLW.FIRST_LINE_ADDR  AS FIRST_LINE_ADDR
            , PLW.SCD_LINE_ADDR    AS SCD_LINE_ADDR
            , PLW.THIRD_LINE_ADDR  AS THIRD_LINE_ADDR
            , PLW.FRTH_LINE_ADDR   AS FRTH_LINE_ADDR
            , PLW.CTY_ADDR         AS CTY_ADDR
            , PLW.CNTY_PK          AS CNTY_PK
            , PLW.PROV_NM          AS PROV_NM
            , PLW.ST_CD            AS ST_CD
            , PLW.POST_CD          AS POST_CD
            , PLW.CTRY_CD          AS CTRY_CD
            , PLW.LOC_NUM          AS LOC_NUM
            , PLW.LOC_NM           AS LOC_NM
            , PLW.DUNS_NUM         AS DUNS_NUM
            , PLW.EFF_FROM_DT      AS EFF_FROM_DT
            , PLW.EFF_THRU_DT      AS EFF_THRU_DT
            , PLW.RGTN_STS_CD      AS RGTN_STS_CD
            , PLW.TEL_NUM          AS TEL_NUM
            , PLW.GEO_CD           AS GEO_CD
            , BTC.BILL_TO_CUST_CD  AS BILL_TO_CUST_CD
        FROM
              PTY_LOC_WRK  PLW
            , BILL_TO_CUST BTC
        WHERE
            PLW.GLBL_CMPY_CD = #glblCmpyCd#
        AND PLW.LOC_NUM = #locNum#
        AND PLW.EZCANCELFLAG = '0'

        AND PLW.GLBL_CMPY_CD = BTC.GLBL_CMPY_CD (+)
        AND BTC.EZCANCELFLAG (+) = '0'
        AND PLW.LOC_NUM = BTC.LOC_NUM (+)
    </statement>

    <statement id="getLocation" parameterClass="Map" resultClass="Map">
        SELECT
              PLW.GLBL_CMPY_CD     AS GLBL_CMPY_CD
            , PLW.PTY_LOC_PK       AS PTY_LOC_PK
        FROM
              ACCT_LOC    AL
            , PTY_LOC_WRK PLW
        WHERE
        <!-- ACCT_LOC -->
            AL.GLBL_CMPY_CD   = #glblCmpyCd#
        AND AL.EZCANCELFLAG   = '0'
        AND AL.DS_ACCT_NUM    = #dsAcctNum#
        <!-- PTY_LOC_WRK -->
        AND AL.GLBL_CMPY_CD   = PLW.GLBL_CMPY_CD
        AND PLW.EZCANCELFLAG  = '0'
        AND AL.PTY_LOC_PK     = PLW.PTY_LOC_PK
        AND NOT EXISTS(
                SELECT
                    1
                FROM
                    ACCT_LOC AL2
                WHERE
                    AL2.LOC_NUM IN(
                        SELECT
                            AL.LOC_NUM
                        FROM
                            ACCT_LOC AL
                        WHERE
                            AL.GLBL_CMPY_CD = #glblCmpyCd#
                        AND AL.EZCANCELFLAG = '0'
                        AND AL.DS_ACCT_NUM = #dsAcctNum#
                    )
                AND AL2.DS_ACCT_NUM &lt;&gt; #dsAcctNum#
                AND AL2.RGTN_STS_CD = #rgtnStsCdP20#
                AND AL2.LOC_NUM = AL.LOC_NUM
            )
    </statement>

    <statement id="getProspectLocation" parameterClass="Map" resultClass="Map">
        SELECT
              PPLW.GLBL_CMPY_CD     AS GLBL_CMPY_CD
            , PPLW.PTY_LOC_PK       AS PTY_LOC_PK
        FROM
              DS_ACCT_PROS     DAP
            , PROS_PTY_LOC_WRK PPLW
        WHERE
        <!-- DS_ACCT_PROS -->
            DAP.GLBL_CMPY_CD   = #glblCmpyCd#
        AND DAP.EZCANCELFLAG   = '0'
        AND DAP.DS_ACCT_NUM    = #dsAcctNum#
        <!-- PROS_PTY_LOC_WRK -->
        AND DAP.GLBL_CMPY_CD   = PPLW.GLBL_CMPY_CD
        AND PPLW.EZCANCELFLAG  = '0'
        AND DAP.PTY_LOC_PK     = PPLW.PTY_LOC_PK
    </statement>

    <statement id="getBillToCust" parameterClass="Map" resultClass="Map">
        SELECT
              BTC.GLBL_CMPY_CD     AS GLBL_CMPY_CD
            , BTC.BILL_TO_CUST_PK  AS BILL_TO_CUST_PK
        FROM
              ACCT_LOC     AL
            , BILL_TO_CUST BTC
        WHERE
        <!-- ACCT_LOC -->
            AL.GLBL_CMPY_CD   = #glblCmpyCd#
        AND AL.EZCANCELFLAG   = '0'
        AND AL.DS_ACCT_NUM    = #dsAcctNum#
        <!-- BILL_TO_CUST -->
        AND AL.GLBL_CMPY_CD   = BTC.GLBL_CMPY_CD
        AND BTC.EZCANCELFLAG  = '0'
        AND AL.LOC_NUM        = BTC.LOC_NUM
        AND BTC.RGTN_STS_CD   = #rgtnStsCd#
    </statement>

    <statement id="getBillToCustNotLookRgtnStsCd" parameterClass="Map" resultClass="Map">
        SELECT
              BTC.GLBL_CMPY_CD     AS GLBL_CMPY_CD
            , BTC.BILL_TO_CUST_PK  AS BILL_TO_CUST_PK
        FROM
              BILL_TO_CUST        BTC
        WHERE
        <!-- BILL_TO_CUST -->
            BTC.GLBL_CMPY_CD     = #glblCmpyCd#
        AND BTC.EZCANCELFLAG     = '0'
        AND BTC.SELL_TO_CUST_CD  = #dsAcctNum#
    </statement>

    <statement id="getAcctLoc" parameterClass="Map" resultClass="Map">
        SELECT
            AL.GLBL_CMPY_CD AS GLBL_CMPY_CD
            ,AL.LOC_NUM AS LOC_NUM
            ,AL.ACCT_LOC_PK AS ACCT_LOC_PK
            ,AL.EFF_THRU_DT AS EFF_THRU_DT
        FROM
            ACCT_LOC AL
        WHERE
            AL.GLBL_CMPY_CD = #glblCmpyCd#
        AND AL.EZCANCELFLAG = '0'
        AND AL.DS_ACCT_NUM = #dsAcctNum#
        AND EXISTS(
                SELECT
                    1
                FROM
                    (
                        SELECT
                            AL.DS_ACCT_NUM
                            ,AL.LOC_NUM
                            ,AL.EFF_THRU_DT
                            ,COUNT(AL.LOC_NUM) AS COUNT
                        FROM
                            ACCT_LOC AL
                        WHERE
                            AL.GLBL_CMPY_CD = #glblCmpyCd#
                        AND AL.EZCANCELFLAG = '0'
                        AND AL.DS_ACCT_NUM = #dsAcctNum#
                        GROUP BY
                            AL.DS_ACCT_NUM
                            ,AL.LOC_NUM
                            ,AL.EFF_THRU_DT
                    ) AL2
                WHERE
                    COUNT = 1
                AND AL2.DS_ACCT_NUM = AL.DS_ACCT_NUM
                AND AL2.LOC_NUM = AL.LOC_NUM
            )
    </statement>

    <statement id="getOtherAcctLoc" parameterClass="Map" resultClass="Map">
        SELECT
            AL.ACCT_LOC_PK      AS ACCT_LOC_PK
        FROM
              ACCT_LOC     AL
        WHERE
        <!-- ACCT_LOC -->
            AL.GLBL_CMPY_CD   = #glblCmpyCd#
        AND AL.EZCANCELFLAG   = '0'
        AND AL.LOC_NUM        = #locNum#
        AND AL.RGTN_STS_CD    = #rgtnStsCdP01#
    </statement>

    <statement id="getCountActiveAcctLoc" parameterClass="Map" resultClass="Integer">
        SELECT
              COUNT(1)
        FROM
              ACCT_LOC     AL
        WHERE
            AL.GLBL_CMPY_CD                    = #glblCmpyCd#
        AND AL.EZCANCELFLAG                    = '0'
        AND AL.LOC_NUM                         = #locNum#
        AND AL.EFF_FROM_DT                 &lt;= #salesDate#
        AND NVL(AL.EFF_THRU_DT, #maxDate#) &gt;= #salesDate#
    </statement>

    <statement id="getShipToCust" parameterClass="Map" resultClass="Map">
        SELECT
              STC.GLBL_CMPY_CD      AS GLBL_CMPY_CD
            , STC.SHIP_TO_CUST_PK   AS SHIP_TO_CUST_PK
        FROM
              SHIP_TO_CUST     STC
        WHERE
        <!-- SHIP_TO_CUST -->
            STC.GLBL_CMPY_CD      = #glblCmpyCd#
        AND STC.EZCANCELFLAG      = '0'
        AND STC.SELL_TO_CUST_CD   = #dsAcctNum#
    </statement>

    <resultMap id="result.SELL_TO_CUSTTMsg" class="SELL_TO_CUSTTMsg">
        <result property="ezUpTime"                  column="EZUPTIME"                    javaType="EZDTStringItem"/>
        <result property="ezUpTimeZone"              column="EZUPTIMEZONE"                javaType="EZDTStringItem"/>
        <result property="ezUpUserID"                column="EZUPUSERID"                  javaType="EZDTStringItem"/>
        <result property="glblCmpyCd"                column="GLBL_CMPY_CD"                javaType="EZDTStringItem"/>
        <result property="sellToCustPk"              column="DS_ACCT_CUST_PK"             javaType="EZDTBigDecimalItem"/>
        <result property="sellToCustCd"              column="DS_ACCT_NUM"                 javaType="EZDTStringItem"/>
        <result property="dsAcctNm"                  column="DS_ACCT_NM"                  javaType="EZDTStringItem"/>
        <result property="dsAcctTpCd"                column="DS_ACCT_TP_CD"               javaType="EZDTStringItem"/>
        <result property="dsAcctItrlFlg"             column="DS_ACCT_ITRL_FLG"            javaType="EZDTStringItem"/>
        <result property="dsAcctClsCd"               column="DS_ACCT_CLS_CD"              javaType="EZDTStringItem"/>
        <result property="coaAfflCd"                 column="COA_AFFL_CD"                 javaType="EZDTStringItem"/>
        <result property="coaChCd"                   column="COA_CH_CD"                   javaType="EZDTStringItem"/>
        <result property="dsAcctDlrCd"               column="DS_ACCT_DLR_CD"              javaType="EZDTStringItem"/>
        <result property="dsAcctStsCd"               column="DS_ACCT_STS_CD"              javaType="EZDTStringItem"/>
        <result property="dsAcctLegalNm"             column="DS_ACCT_LEGAL_NM"            javaType="EZDTStringItem"/>
        <result property="dbaNm"                     column="DBA_NM"                      javaType="EZDTStringItem"/>
        <result property="dsAcctDunsNum"             column="DS_ACCT_DUNS_NUM"            javaType="EZDTStringItem"/>
        <result property="dsAcctDunsNm"              column="DS_ACCT_DUNS_NM"             javaType="EZDTStringItem"/>
        <result property="dsAcctAltNm"               column="DS_ACCT_ALT_NM"              javaType="EZDTStringItem"/>
        <result property="dsXtrnlRefTxt"             column="DS_XTRNL_REF_TXT"            javaType="EZDTStringItem"/>
        <result property="dsDataSrcTxt"              column="DS_DATA_SRC_TXT"             javaType="EZDTStringItem"/>
        <result property="effFromDt"                 column="EFF_FROM_DT"                 javaType="EZDTStringItem"/>
        <result property="effThruDt"                 column="EFF_THRU_DT"                 javaType="EZDTStringItem"/>
        <result property="dsAcctActvCustFlg"         column="DS_ACCT_ACTV_CUST_FLG"       javaType="EZDTStringItem"/>
        
        <result property="dsAcctDunsNum"             column="DS_ACCT_DUNS_NUM"            javaType="EZDTStringItem"/>
        <result property="dsUltDunsNum"              column="DS_ULT_DUNS_NUM"             javaType="EZDTStringItem"/>
        <result property="dsLocEmpNum"               column="DS_LOC_EMP_NUM"              javaType="EZDTBigDecimalItem"/>
        <result property="dsLocRevAmt"               column="DS_LOC_REV_AMT"              javaType="EZDTBigDecimalItem"/>
        <result property="dsCustSicCd"               column="DS_CUST_SIC_CD"              javaType="EZDTStringItem"/>
        <result property="dsLastUpdDunsDt"           column="DS_LAST_UPD_DUNS_DT"         javaType="EZDTStringItem"/>
        
        <result property="arStmtFlg"                 column="AR_STMT_FLG"                 javaType="EZDTStringItem"/>
        <result property="arStmtIssDay"              column="AR_STMT_ISS_DAY"             javaType="EZDTStringItem"/>
        <result property="cltStrgyNm"                column="CLT_STRGY_NM"                javaType="EZDTStringItem"/>
        <result property="dsCustTaxCd"               column="DS_CUST_TAX_CD"              javaType="EZDTStringItem"/>
        <result property="dsCustTaxCalcCd"           column="DS_CUST_TAX_CALC_CD"         javaType="EZDTStringItem"/>
        <result property="dsTaxPrntTpCd"             column="DS_TAX_PRNT_TP_CD"           javaType="EZDTStringItem"/>
        
        <result property="defBaseTpCd"               column="DEF_BASE_TP_CD"              javaType="EZDTStringItem"/>
        <result property="defBaseCycleCd"            column="DEF_BASE_CYCLE_CD"           javaType="EZDTStringItem"/>
        <result property="defUsgTpCd"                column="DEF_USG_TP_CD"               javaType="EZDTStringItem"/>
        <result property="defUsgCycleCd"             column="DEF_USG_CYCLE_CD"            javaType="EZDTStringItem"/>
        <!-- START 2022/03/22 [QC#59683, MOD] -->
        <!-- <result property="dsBillTgtrFlg"             column="DS_BILL_TGTR_FLG"            javaType="EZDTStringItem"/> -->
        <result property="dsInvTgtrTpCd"             column="DS_INV_TGTR_TP_CD"           javaType="EZDTStringItem"/>
        <!-- END   2022/03/22 [QC#59683, MOD] -->
    </resultMap>
               
    <resultMap id="result.DS_ACCT_PROSTMsg" class="DS_ACCT_PROSTMsg">
        <result property="ezUpTime"                  column="EZUPTIME"                    javaType="EZDTStringItem"/>
        <result property="ezUpTimeZone"              column="EZUPTIMEZONE"                javaType="EZDTStringItem"/>
        <result property="ezUpUserID"                column="EZUPUSERID"                  javaType="EZDTStringItem"/>
        <result property="glblCmpyCd"                column="GLBL_CMPY_CD"                javaType="EZDTStringItem"/>
        <result property="dsAcctProsPk"              column="DS_ACCT_PROS_PK"             javaType="EZDTBigDecimalItem"/>
        <result property="dsAcctNum"                 column="DS_ACCT_NUM"                 javaType="EZDTStringItem"/>
        <result property="dsAcctNm"                  column="DS_ACCT_NM"                  javaType="EZDTStringItem"/>
        <result property="dsAcctTpCd"                column="DS_ACCT_TP_CD"               javaType="EZDTStringItem"/>
        <result property="dsAcctItrlFlg"             column="DS_ACCT_ITRL_FLG"            javaType="EZDTStringItem"/>
        <result property="dsAcctClsCd"               column="DS_ACCT_CLS_CD"              javaType="EZDTStringItem"/>
        <result property="coaAfflCd"                 column="COA_AFFL_CD"                 javaType="EZDTStringItem"/>
        <result property="coaChCd"                   column="COA_CH_CD"                   javaType="EZDTStringItem"/>
        <result property="dsAcctDlrCd"               column="DS_ACCT_DLR_CD"              javaType="EZDTStringItem"/>
        <result property="dsAcctStsCd"               column="DS_ACCT_STS_CD"              javaType="EZDTStringItem"/>
        <result property="dsAcctLegalNm"             column="DS_ACCT_LEGAL_NM"            javaType="EZDTStringItem"/>
        <result property="dbaNm"                     column="DBA_NM"                      javaType="EZDTStringItem"/>
        <result property="dsAcctDunsNum"             column="DS_ACCT_DUNS_NUM"            javaType="EZDTStringItem"/>
        <result property="dsAcctDunsNm"              column="DS_ACCT_DUNS_NM"             javaType="EZDTStringItem"/>
        <result property="dsAcctAltNm"               column="DS_ACCT_ALT_NM"              javaType="EZDTStringItem"/>
        <result property="dsXtrnlRefTxt"             column="DS_XTRNL_REF_TXT"            javaType="EZDTStringItem"/>
        <result property="dsDataSrcTxt"              column="DS_DATA_SRC_TXT"             javaType="EZDTStringItem"/>
        <result property="effFromDt"                 column="EFF_FROM_DT"                 javaType="EZDTStringItem"/>
        <result property="effThruDt"                 column="EFF_THRU_DT"                 javaType="EZDTStringItem"/>
        <result property="dsAcctActvCustFlg"         column="DS_ACCT_ACTV_CUST_FLG"       javaType="EZDTStringItem"/>
        
        <result property="dsAcctDunsNum"             column="DS_ACCT_DUNS_NUM"            javaType="EZDTStringItem"/>
        <result property="dsUltDunsNum"              column="DS_ULT_DUNS_NUM"             javaType="EZDTStringItem"/>
        <result property="dsLocEmpNum"               column="DS_LOC_EMP_NUM"              javaType="EZDTBigDecimalItem"/>
        <result property="dsLocRevAmt"               column="DS_LOC_REV_AMT"              javaType="EZDTBigDecimalItem"/>
        <result property="dsCustSicCd"               column="DS_CUST_SIC_CD"              javaType="EZDTStringItem"/>
        <result property="dsLastUpdDunsDt"           column="DS_LAST_UPD_DUNS_DT"         javaType="EZDTStringItem"/>
        
        <result property="arStmtFlg"                 column="AR_STMT_FLG"                 javaType="EZDTStringItem"/>
        <result property="arStmtIssDay"              column="AR_STMT_ISS_DAY"             javaType="EZDTStringItem"/>
        <result property="cltStrgyNm"                column="CLT_STRGY_NM"                javaType="EZDTStringItem"/>
        <result property="defCltrCd"                 column="DEF_CLTR_CD"                 javaType="EZDTStringItem"/>
        <result property="dsCustTaxCd"               column="DS_CUST_TAX_CD"              javaType="EZDTStringItem"/>
        <result property="dsCustTaxCalcCd"           column="DS_CUST_TAX_CALC_CD"         javaType="EZDTStringItem"/>
        <result property="dsTaxPrntTpCd"             column="DS_TAX_PRNT_TP_CD"           javaType="EZDTStringItem"/>
        
        <result property="defBaseTpCd"               column="DEF_BASE_TP_CD"              javaType="EZDTStringItem"/>
        <result property="defBaseCycleCd"            column="DEF_BASE_CYCLE_CD"           javaType="EZDTStringItem"/>
        <result property="defUsgTpCd"                column="DEF_USG_TP_CD"               javaType="EZDTStringItem"/>
        <result property="defUsgCycleCd"             column="DEF_USG_CYCLE_CD"            javaType="EZDTStringItem"/>
        <!-- START 2022/03/22 [QC#59683, MOD] -->
        <!-- <result property="dsBillTgtrFlg"             column="DS_BILL_TGTR_FLG"            javaType="EZDTStringItem"/> -->
        <result property="dsInvTgtrTpCd"             column="DS_INV_TGTR_TP_CD"           javaType="EZDTStringItem"/>
        <!-- END   2022/03/22 [QC#59683, MOD] -->
    </resultMap>

    <statement id="getReasonList" parameterClass="Map" resultMap="result.DS_ACCT_INAC_RSNTMsg">
        SELECT
            DS_ACCT_INAC_RSN_CD
            , DS_ACCT_INAC_RSN_NM
        FROM
            DS_ACCT_INAC_RSN
        WHERE GLBL_CMPY_CD = #glblCmpyCd#
        AND EZCANCELFLAG = '0'
        ORDER BY DS_ACCT_INAC_RSN_SORT_NUM

    </statement>

    <resultMap id="result.DS_ACCT_INAC_RSNTMsg" class="DS_ACCT_INAC_RSNTMsg">
        <result property="dsAcctInacRsnCd"   column="DS_ACCT_INAC_RSN_CD"   javaType="EZDTStringItem"/>
        <result property="dsAcctInacRsnNm"   column="DS_ACCT_INAC_RSN_NM"   javaType="EZDTStringItem"/>
    </resultMap>

    <statement id="countContact" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
           COUNT(CTAC.CTAC_PSN_PK)
        FROM
            CTAC_PSN CTAC
            <!-- 2018/05/22 QC#26042 mod start -->
            <!-- , DS_CTAC_PSN_RELN RELN -->
            , (SELECT
                     DCPR1.EZCANCELFLAG
                    ,DCPR1.GLBL_CMPY_CD
                    ,DCPR1.CTAC_PSN_PK
                    ,DCPR1.DS_ACCT_NUM
                FROM
                    DS_CTAC_PSN_RELN    DCPR1
                WHERE
                        DCPR1.GLBL_CMPY_CD  = #glblCmpyCd#
                    AND DCPR1.DS_ACCT_NUM   = #dsAcctNum#
                    AND DCPR1.EZCANCELFLAG  = '0'
            UNION ALL 
                SELECT
                     DCPR2.EZCANCELFLAG
                    ,DCPR2.GLBL_CMPY_CD
                    ,DCPR2.CTAC_PSN_PK
                    ,AL.DS_ACCT_NUM
                FROM
                    DS_CTAC_PSN_RELN    DCPR2
                    ,ACCT_LOC            AL
                   ,SELL_TO_CUST        STC
                WHERE
                       DCPR2.GLBL_CMPY_CD = #glblCmpyCd#
                    AND DCPR2.EZCANCELFLAG  = '0'
                    AND DCPR2.GLBL_CMPY_CD = AL.GLBL_CMPY_CD
                    AND DCPR2.LOC_NUM      = AL.LOC_NUM
                    AND AL.DS_ACCT_NUM     = #dsAcctNum#
                    AND AL.EFF_FROM_DT &lt;= #salesDate#
                    AND NVL(AL.EFF_THRU_DT, '99991231') &gt;= #salesDate#
                    AND AL.EZCANCELFLAG    = '0'

                    AND AL.GLBL_CMPY_CD    = STC.GLBL_CMPY_CD
                    AND AL.DS_ACCT_NUM     = STC.SELL_TO_CUST_CD
                    AND STC.EZCANCELFLAG   = '0'
              ) RELN
              <!-- 2018/05/22 QC#26042 mod end -->
            , DS_CTAC_PNT PNT
            , DS_CTAC_PNT_TP TP
        WHERE
            CTAC.GLBL_CMPY_CD = #glblCmpyCd#
        AND CTAC.EZCANCELFLAG = '0'
        AND CTAC.CTAC_PSN_PK = #ctacPsnPk#
        AND CTAC.CTAC_PSN_ACTV_FLG = 'Y'

        AND CTAC.GLBL_CMPY_CD = RELN.GLBL_CMPY_CD
        AND CTAC.CTAC_PSN_PK = RELN.CTAC_PSN_PK
        AND RELN.EZCANCELFLAG = '0'
        AND RELN.DS_ACCT_NUM = #dsAcctNum#

        AND CTAC.GLBL_CMPY_CD = PNT.GLBL_CMPY_CD
        AND CTAC.CTAC_PSN_PK = PNT.CTAC_PSN_PK
        AND PNT.EZCANCELFLAG = '0'
        AND PNT.DS_CTAC_PNT_ACTV_FLG = 'Y'

        AND PNT.GLBL_CMPY_CD = TP.GLBL_CMPY_CD
        AND PNT.DS_CTAC_PNT_TP_CD = TP.DS_CTAC_PNT_TP_CD
        AND TP.EZCANCELFLAG = '0'
        AND TP.EML_FLG = 'Y'
    </statement>

    <statement id="countResource" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
           COUNT(PSN.PSN_CD)
        FROM
            S21_PSN PSN
        WHERE
            PSN.GLBL_CMPY_CD = #glblCmpyCd#
        AND PSN.EZCANCELFLAG = '0'
        AND PSN.PSN_CD = #psnCd#
        <isEqual property="mailCheckFlg" compareValue="Y">
          AND PSN.EML_ADDR IS NOT NULL
        </isEqual>
    </statement>

    <statement id="getNestRelationParent" parameterClass="Map" resultClass="Map">
        WITH  RELN_WRK(GLBL_CMPY_CD
              ,DS_ACCT_NUM
              , RELN_DS_ACCT_NUM
              , DS_ACCT_RELN_TP_CD) 
        AS (
            SELECT RELN.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                 , RELN.DS_ACCT_NUM              AS DS_ACCT_NUM
                 , RELN.RELN_DS_ACCT_NUM         AS RELN_DS_ACCT_NUM
                 , RELN.DS_ACCT_RELN_TP_CD       AS DS_ACCT_RELN_TP_CD
                FROM DS_ACCT_RELN RELN 
                WHERE RELN.DS_ACCT_NUM = #dsAcctNum#
                AND RELN.GLBL_CMPY_CD = #glblCmpyCd#
                AND RELN.EZCANCELFLAG = '0'
                AND RELN.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#

            UNION ALL
            SELECT RELN.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                 , RELN.DS_ACCT_NUM              AS DS_ACCT_NUM
                 , RELN.RELN_DS_ACCT_NUM         AS RELN_DS_ACCT_NUM
                 , RELN.DS_ACCT_RELN_TP_CD       AS DS_ACCT_RELN_TP_CD
                FROM DS_ACCT_RELN RELN, RELN_WRK
                WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
                AND RELN.EZCANCELFLAG = '0'
                AND RELN_WRK.RELN_DS_ACCT_NUM = RELN.DS_ACCT_NUM 
                AND RELN_WRK.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#

            )

            CYCLE DS_ACCT_NUM SET IsLoop TO 'Y' DEFAULT 'N'

        SELECT
            RELN_WRK.DS_ACCT_RELN_TP_CD AS DS_ACCT_RELN_TP_CD
            , RELN_WRK.DS_ACCT_NUM AS DS_ACCT_NUM
            , RELN_WRK.RELN_DS_ACCT_NUM AS RELN_DS_ACCT_NUM
        FROM
            RELN_WRK

        ORDER BY RELN_WRK.RELN_DS_ACCT_NUM
    </statement>

    <statement id="getNestRelationChild" parameterClass="Map" resultClass="Map">
        WITH  RELN_WRK(GLBL_CMPY_CD
              ,DS_ACCT_NUM
              , RELN_DS_ACCT_NUM
              , DS_ACCT_RELN_TP_CD) 
        AS (
            SELECT RELN.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                 , RELN.DS_ACCT_NUM              AS DS_ACCT_NUM
                 , RELN.RELN_DS_ACCT_NUM         AS RELN_DS_ACCT_NUM
                 , RELN.DS_ACCT_RELN_TP_CD       AS DS_ACCT_RELN_TP_CD
                FROM DS_ACCT_RELN RELN 
                WHERE RELN.RELN_DS_ACCT_NUM = #dsAcctNum#
                AND RELN.GLBL_CMPY_CD = #glblCmpyCd#
                AND RELN.EZCANCELFLAG = '0'
                AND RELN.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#

            UNION ALL
            SELECT RELN.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                 , RELN.DS_ACCT_NUM              AS DS_ACCT_NUM
                 , RELN.RELN_DS_ACCT_NUM         AS RELN_DS_ACCT_NUM
                 , RELN.DS_ACCT_RELN_TP_CD       AS DS_ACCT_RELN_TP_CD
                FROM DS_ACCT_RELN RELN, RELN_WRK
                WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
                AND RELN.EZCANCELFLAG = '0'
                AND RELN_WRK.DS_ACCT_NUM = RELN.RELN_DS_ACCT_NUM 
                AND RELN_WRK.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#

            )

            CYCLE DS_ACCT_NUM SET IsLoop TO 'Y' DEFAULT 'N'

        SELECT
            RELN_WRK.DS_ACCT_RELN_TP_CD AS DS_ACCT_RELN_TP_CD
            , RELN_WRK.DS_ACCT_NUM AS DS_ACCT_NUM
            , RELN_WRK.RELN_DS_ACCT_NUM AS RELN_DS_ACCT_NUM
        FROM
            RELN_WRK

        ORDER BY RELN_WRK.RELN_DS_ACCT_NUM
    </statement>

    <statement id="getPtyLocWrkList" parameterClass="Map" resultMap="result.PTY_LOC_WRKTMsg">
        SELECT
            WRK.PTY_LOC_PK AS PTY_LOC_PK
            ,WRK.EZUPTIME AS EZUPTIME
            ,WRK.EZUPTIMEZONE AS EZUPTIMEZONE
        FROM
            PTY_LOC_WRK WRK
            ,ACCT_LOC LOC
        WHERE
            LOC.GLBL_CMPY_CD = #glblCmpyCd#
        AND LOC.EZCANCELFLAG = '0'
        AND LOC.DS_ACCT_NUM = #dsAcctNum#
        AND LOC.GLBL_CMPY_CD = WRK.GLBL_CMPY_CD
        AND LOC.LOC_NUM = WRK.LOC_NUM
        AND WRK.EZCANCELFLAG = '0'
    </statement>

    <resultMap id="result.PTY_LOC_WRKTMsg" class="PTY_LOC_WRKTMsg">
        <result property="ptyLocPk"               column="PTY_LOC_PK"            javaType="EZDTBigDecimalItem"/>
        <result property="ezUpTime"               column="EZUPTIME"              javaType="EZDSStringItem" />
        <result property="ezUpTimeZone"           column="EZUPTIMEZONE"          javaType="EZDSStringItem" />
    </resultMap>

    <statement id="getProsPtyLocWrkList" parameterClass="Map" resultMap="result.PROS_PTY_LOC_WRKTMsg">
        SELECT
            WRK.PTY_LOC_PK AS PTY_LOC_PK
            ,WRK.EZUPTIME AS EZUPTIME
            ,WRK.EZUPTIMEZONE AS EZUPTIMEZONE
        FROM
            PROS_PTY_LOC_WRK WRK
            ,DS_ACCT_PROS    PROS
        WHERE
            PROS.GLBL_CMPY_CD = #glblCmpyCd#
        AND PROS.EZCANCELFLAG = '0'
        AND PROS.DS_ACCT_NUM = #dsAcctNum#
        AND PROS.GLBL_CMPY_CD = WRK.GLBL_CMPY_CD
        AND PROS.LOC_NUM = WRK.LOC_NUM
        AND WRK.EZCANCELFLAG = '0'
    </statement>

    <resultMap id="result.PROS_PTY_LOC_WRKTMsg" class="PROS_PTY_LOC_WRKTMsg">
        <result property="ptyLocPk"               column="PTY_LOC_PK"            javaType="EZDTBigDecimalItem"/>
        <result property="ezUpTime"               column="EZUPTIME"              javaType="EZDSStringItem" />
        <result property="ezUpTimeZone"           column="EZUPTIMEZONE"          javaType="EZDSStringItem" />
    </resultMap>

    <statement id="getAltPayerList" parameterClass="Map" resultMap="result.ALT_PAYERTMsg">
        SELECT
            AP.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
            ,AP.EZUPTIME AS EZUPTIME
            ,AP.EZUPTIMEZONE AS EZUPTIMEZONE
        FROM
            ALT_PAYER AP
        WHERE
            AP.GLBL_CMPY_CD = #glblCmpyCd#
        AND AP.EZCANCELFLAG = '0'
        AND AP.SELL_TO_CUST_CD = #dsAcctNum#
    </statement>

    <resultMap id="result.ALT_PAYERTMsg" class="ALT_PAYERTMsg">
        <result property="billToCustCd"           column="BILL_TO_CUST_CD"       javaType="EZDSStringItem"/>
        <result property="ezUpTime"               column="EZUPTIME"              javaType="EZDSStringItem" />
        <result property="ezUpTimeZone"           column="EZUPTIMEZONE"          javaType="EZDSStringItem" />
    </resultMap>

    <statement id="getDsSpclHdlgTpCdList" parameterClass="Map" resultMap="result.DS_SPCL_HDLG_TPTMsg">
        SELECT
            DS_SPCL_HDLG_TP_CD
            , DS_SPCL_HDLG_TP_NM
        FROM
            DS_SPCL_HDLG_TP
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND EZCANCELFLAG = '0'
        GROUP BY DS_SPCL_HDLG_TP_CD, DS_SPCL_HDLG_TP_NM
        ORDER BY DS_SPCL_HDLG_TP_CD
    </statement>

    <statement id="getDsSpclHdlgTpValList" parameterClass="Map" resultMap="result.DS_SPCL_HDLG_TPTMsg">
        SELECT
            DS_SPCL_HDLG_TP_VAL_CD
            , DS_SPCL_HDLG_TP_VAL_NM
        FROM
            DS_SPCL_HDLG_TP
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND EZCANCELFLAG = '0'
        GROUP BY DS_SPCL_HDLG_TP_VAL_CD, DS_SPCL_HDLG_TP_VAL_NM
        ORDER BY DS_SPCL_HDLG_TP_VAL_CD
    </statement>

    <resultMap id="result.DS_SPCL_HDLG_TPTMsg" class="DS_SPCL_HDLG_TPTMsg">
        <result property="dsSpclHdlgTpCd"           column="DS_SPCL_HDLG_TP_CD"       javaType="EZDSStringItem"/>
        <result property="dsSpclHdlgTpNm"           column="DS_SPCL_HDLG_TP_NM"       javaType="EZDSStringItem" />
        <result property="dsSpclHdlgTpValCd"           column="DS_SPCL_HDLG_TP_VAL_CD"       javaType="EZDSStringItem"/>
        <result property="dsSpclHdlgTpValNm"           column="DS_SPCL_HDLG_TP_VAL_NM"       javaType="EZDSStringItem" />
    </resultMap>

    <statement id="cpoOpenOrder" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(C.CPO_ORD_NUM)
        FROM
            CPO           C
           ,DS_CPO_CONFIG DCC
           ,CPO_DTL       CD
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
           ,SELL_TO_CUST  STC
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
        WHERE
            C.GLBL_CMPY_CD    = #glblCmpyCd#
        AND C.EZCANCELFLAG    = '0'
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->
        <!-- AND ( -->
        <!--     C.CPO_ORD_TS      IS NULL -->
        <!--     OR C.CPO_ORD_TS   >= #salesDate# -->
        <!--     ) -->
        AND C.CPO_ORD_TS      &gt;= #slsDtPast#
        AND C.OPEN_FLG        =  #flgOnY#
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->

        AND C.GLBL_CMPY_CD    =  DCC.GLBL_CMPY_CD
        AND DCC.EZCANCELFLAG  =  '0'
        AND C.CPO_ORD_NUM     =  DCC.CPO_ORD_NUM

        AND DCC.GLBL_CMPY_CD  =  CD.GLBL_CMPY_CD
        AND CD.EZCANCELFLAG   =  '0'
        AND DCC.CPO_ORD_NUM   =  CD.CPO_ORD_NUM
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->
        <!-- AND ( -->
        <!--     C.SELL_TO_CUST_CD            = #acctNum# -->
        <!--     OR DCC.BILL_TO_CUST_ACCT_CD  = #acctNum# -->
        <!--     OR DCC.SHIP_TO_CUST_ACCT_CD  = #acctNum# -->
        <!--     ) -->
        AND DCC.DS_CPO_CONFIG_PK  =  CD.DS_CPO_CONFIG_PK
        AND CD.OPEN_FLG           =  #flgOnY#

        AND (
                (       C.GLBL_CMPY_CD            =  STC.GLBL_CMPY_CD
                    AND C.SELL_TO_CUST_CD         =  STC.SELL_TO_CUST_CD
                ) OR (  DCC.GLBL_CMPY_CD          =  STC.GLBL_CMPY_CD
                    AND DCC.BILL_TO_CUST_ACCT_CD  =  STC.SELL_TO_CUST_CD
                ) OR (  DCC.GLBL_CMPY_CD          =  STC.GLBL_CMPY_CD
                    AND DCC.SHIP_TO_CUST_ACCT_CD  =  STC.SELL_TO_CUST_CD
                )
            )

        AND STC.RGTN_STS_CD       =  #rgtnStsCd#
        AND STC.EZCANCELFLAG      =  '0'
        AND STC.SELL_TO_CUST_CD   =  #acctNum#
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->

        AND ROWNUM = #rowNum#
    </statement>

    <statement id="openReturnOrder" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(C.CPO_ORD_NUM)
        FROM
            CPO                C
          , DS_CPO_CONFIG      DCC
          , DS_CPO_RTRN_DTL    DCRD
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
          , SELL_TO_CUST       STC
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
        WHERE
            C.GLBL_CMPY_CD    =  #glblCmpyCd#
        AND C.EZCANCELFLAG    =  '0'
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->
        <!-- AND -->
        <!--     ( -->
        <!--     C.CPO_ORD_TS      IS NULL -->
        <!--     OR  C.CPO_ORD_TS  >= #salesDate# -->
        <!--     ) -->
        AND C.CPO_ORD_TS      &gt;= #slsDtPast#
        AND C.OPEN_FLG        =  #flgOnY#
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->

        AND C.GLBL_CMPY_CD    =  DCC.GLBL_CMPY_CD
        AND DCC.EZCANCELFLAG  =  '0'
        AND C.CPO_ORD_NUM     =  DCC.CPO_ORD_NUM

        AND DCC.GLBL_CMPY_CD  =  DCRD.GLBL_CMPY_CD
        AND DCRD.EZCANCELFLAG =  '0'
        AND DCC.CPO_ORD_NUM   =  DCRD.CPO_ORD_NUM
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->
        <!-- AND -->
        <!--     ( -->
        <!--     C.SELL_TO_CUST_CD        =  #acctNum# -->
        <!--     OR DCC.BILL_TO_CUST_ACCT_CD =  #acctNum# -->
        <!--     OR DCC.SHIP_TO_CUST_ACCT_CD =  #acctNum# -->
        <!--     ) -->
        AND DCC.DS_CPO_CONFIG_PK  =  DCRD.DS_CPO_CONFIG_PK
        AND DCRD.OPEN_FLG         =  #flgOnY#

        AND (
                (       C.GLBL_CMPY_CD            =  STC.GLBL_CMPY_CD
                    AND C.SELL_TO_CUST_CD         =  STC.SELL_TO_CUST_CD
                ) OR (  DCC.GLBL_CMPY_CD          =  STC.GLBL_CMPY_CD
                    AND DCC.BILL_TO_CUST_ACCT_CD  =  STC.SELL_TO_CUST_CD
                ) OR (  DCC.GLBL_CMPY_CD          =  STC.GLBL_CMPY_CD
                    AND DCC.SHIP_TO_CUST_ACCT_CD  =  STC.SELL_TO_CUST_CD
                )
            )

        AND STC.RGTN_STS_CD       =  #rgtnStsCd#
        AND STC.EZCANCELFLAG      =  '0'
        AND STC.SELL_TO_CUST_CD   =  #acctNum#
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->

        AND ROWNUM = #rowNum#
    </statement>

    <statement id="openMachineMasterCheck" parameterClass="Map" resultClass="BigDecimal">
        SELECT
           COUNT(SMM.SVC_MACH_MSTR_PK)
        FROM
           SVC_MACH_MSTR SMM
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
          ,SELL_TO_CUST  STC
        <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
        WHERE
        <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
            STC.GLBL_CMPY_CD     = #glblCmpyCd#
        AND STC.EZCANCELFLAG     = '0'
        AND STC.SELL_TO_CUST_CD  = #acctNum#
        AND STC.RGTN_STS_CD      = #rgtnStsCd#

        AND STC.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
        AND (
             STC.SELL_TO_CUST_CD = SMM.OWNR_ACCT_NUM
          OR STC.SELL_TO_CUST_CD = SMM.BILL_TO_ACCT_NUM
          OR STC.SELL_TO_CUST_CD = SMM.CUR_LOC_ACCT_NUM
            )
       <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
       <!-- START 2018/10/09 Hd.Sugawara [QC#27598,DEL] -->
       <!--     SMM.GLBL_CMPY_CD = #glblCmpyCd# -->
       <!-- END 2018/10/09 Hd.Sugawara [QC#27598,DEL] -->
       AND SMM.EZCANCELFLAG = '0' 
       AND SMM.SVC_MACH_MSTR_STS_CD IN (#w4i#, #instl#, #w4r#, #dlrsv#)
       <!-- START 2018/10/09 Hd.Sugawara [QC#27598,DEL] -->
       <!-- AND -->
       <!--     ( -->
       <!--     SMM.EFF_THRU_DT IS NULL -->
       <!--     OR  SMM.EFF_THRU_DT >= #salesDate# -->
       <!--     ) -->
       <!-- AND -->
       <!--    ( -->
       <!--    SMM.OWNR_ACCT_NUM    = #acctNum# -->
       <!--    OR SMM.BILL_TO_ACCT_NUM = #acctNum# -->
       <!--    OR SMM.CUR_LOC_ACCT_NUM = #acctNum# -->
       <!--    ) -->
       <!-- END 2018/10/09 Hd.Sugawara [QC#27598,DEL] -->
       AND ROWNUM = #rowNum#
    </statement>

    <statement id="contractDsContrNum" parameterClass="Map" resultClass="BigDecimal">
       SELECT
          COUNT(DCSV.DS_CONTR_NUM)
       FROM
          DS_CONTR_STS_V DCSV
         ,DS_CONTR       DC
         ,DS_CONTR_DTL   DCD
       <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
         ,SELL_TO_CUST   STC
       <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
       WHERE
          DCSV.GLBL_CMPY_CD  = #glblCmpyCd#
       AND DCSV.EZCANCELFLAG  = '0'
       AND DCSV.ETTL_AVAL_FLG = #ettlAvalFlg#
       <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
       <iterate property="dsContrCtrlSts" var="elem[]" open="AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (" close=")" conjunction=",">
           #elem[]#
       </iterate>
       <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->

       AND DCSV.GLBL_CMPY_CD  = DC.GLBL_CMPY_CD
       AND DC.EZCANCELFLAG    = '0'
       AND DCSV.DS_CONTR_PK   = DC.DS_CONTR_PK
       AND DC.DS_ACCT_NUM     = #acctNum#
       AND DCSV.GLBL_CMPY_CD  = DCD.GLBL_CMPY_CD
       AND DCD.EZCANCELFLAG   = '0'
       AND DCD.DS_CONTR_PK    = DC.DS_CONTR_PK

       <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
       AND DC.GLBL_CMPY_CD    = STC.GLBL_CMPY_CD
       AND DC.DS_ACCT_NUM     = STC.SELL_TO_CUST_CD
       AND STC.RGTN_STS_CD    = #rgtnStsCd#
       AND STC.EZCANCELFLAG   = '0'
       <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
       <!-- START 2018/10/09 Hd.Sugawara [QC#27598,DEL] -->
       <!-- AND -->
       <!--    ( -->
       <!--    DCD.CONTR_EFF_THRU_DT IS NULL -->
       <!--    OR  DCD.CONTR_EFF_THRU_DT >= #salesDate# -->
       <!--    ) -->
       <!-- END 2018/10/09 Hd.Sugawara [QC#27598,DEL] -->
       AND ROWNUM = #rowNum#
    </statement>

    <statement id="serviceCall" parameterClass="Map" resultClass="BigDecimal">
       SELECT
          COUNT(ST.SVC_TASK_NUM)
       FROM
          SVC_TASK      ST
         ,FSR           F
       <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
         ,SELL_TO_CUST  STC
       <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
       WHERE
          ST.GLBL_CMPY_CD     = #glblCmpyCd#
       AND ST.EZCANCELFLAG     = '0'
       AND
          (
          ST.SVC_TASK_RCV_DT IS NULL
          <!-- START 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->
          <!-- OR  ST.SVC_TASK_RCV_DT >= #salesDate# -->
          OR  ST.SVC_TASK_RCV_DT &gt;= #slsDtPast#
          <!-- END 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->
          )
       <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
       <iterate property="svcTaskSts" var="elem[]" open="AND ST.SVC_TASK_STS_CD NOT IN (" close=")" conjunction=",">
           #elem[]#
       </iterate>
       <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->

       AND ST.GLBL_CMPY_CD     =  F.GLBL_CMPY_CD
       <!-- START 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
       AND ST.FSR_NUM          =  F.FSR_NUM
       <!-- END 2018/10/09 Hd.Sugawara [QC#27598,ADD] -->
       AND F.EZCANCELFLAG      =  '0'
       <!-- START 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->
       <!-- AND -->
       <!--     ( -->
       <!--     F.SELL_TO_CUST_CD      = #acctNum# -->
       <!--     OR F.BILL_TO_CUST_ACCT_CD = #acctNum# -->
       <!--     OR F.SHIP_TO_CUST_ACCT_CD = #acctNum# -->
       <!--     ) -->

       AND F.GLBL_CMPY_CD          = STC.GLBL_CMPY_CD
       AND 
           (
            F.SELL_TO_CUST_CD      = STC.SELL_TO_CUST_CD
         OR F.BILL_TO_CUST_ACCT_CD = STC.SELL_TO_CUST_CD
         OR F.SHIP_TO_CUST_ACCT_CD = STC.SELL_TO_CUST_CD
           )

       AND STC.RGTN_STS_CD         = #rgtnStsCd#
       AND STC.EZCANCELFLAG        =  '0'
       AND STC.SELL_TO_CUST_CD     = #acctNum#
       <!-- END 2018/10/09 Hd.Sugawara [QC#27598,MOD] -->

       AND ROWNUM = #rowNum#
    </statement>

    <statement id="getTreeListLeaseReln"  parameterClass ="Map" resultClass="Map">
    SELECT 
        RELN.DS_ACCT_NUM AS P_DS_ACCT_NUM
        , RELN.RELN_DS_ACCT_NUM AS DS_ACCT_NUM
        , RELN.DS_ACCT_RELN_TP_CD AS DS_ACCT_RELN_TP_CD
        , #parentDsAcctNum# AS DSACCTNUM_T1
        , RELN.RELN_DS_ACCT_NUM AS DSACCTNUM_T2
        , '' AS DSACCTNUM_T3
        , '' AS DSACCTNUM_T4
        , '' AS DSACCTNUM_T5
        , '' AS DSACCTNUM_T6
        , '' AS DSACCTNUM_T7
        , '' AS DSACCTNUM_T8
        , '' AS DSACCTNUM_T9
        , '' AS DSACCTNUM_TA
        , ACCT.DS_ACCT_NM   DS_ACCT_NM
        , PLW.FIRST_LINE_ADDR ||
              DECODE(PLW.SCD_LINE_ADDR, NULL, '', ' ' || PLW.SCD_LINE_ADDR) ||
              DECODE(PLW.THIRD_LINE_ADDR, NULL, '', ' ' || PLW.THIRD_LINE_ADDR) ||
              DECODE(PLW.FRTH_LINE_ADDR, NULL, '', ' ' || PLW.FRTH_LINE_ADDR) AS ADDRESS
        , PLW.CTY_ADDR
        , PLW.ST_CD
        , PLW.POST_CD
        , (SELECT
               DS_ACCT_TP_NM 
           FROM
               DS_ACCT_TP TP
           WHERE
               TP.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
           AND TP.EZCANCELFLAG = '0'
           AND TP.DS_ACCT_TP_CD = ACCT.DS_ACCT_TP_CD
           ) AS DS_ACCT_TP_NM
        , PLW.LOC_NUM AS LOC_NUM
        ,CASE
             WHEN RELN.RGTN_STS_CD = #activeCd#
             THEN #active#
             ELSE #inActive#
         END DS_ACCT_STS_NM
        ,CASE
             WHEN PC.PTY_LOC_PK = PLW.PTY_LOC_PK
             THEN 'Y'
             ELSE 'N'
         END PRIMARY
    FROM
        (
         SELECT
              PROS.GLBL_CMPY_CD
             ,PROS.DS_ACCT_NUM
             ,PROS.DS_ACCT_NM
             ,PROS.DS_ACCT_TP_CD
             ,PROS.PTY_LOC_PK
             ,PROS.DS_ACCT_ACTV_CUST_FLG
         FROM
              DS_ACCT_PROS PROS
         WHERE
              PROS.GLBL_CMPY_CD         = #glblCmpyCd#
         AND  PROS.EZCANCELFLAG         = '0'
         UNION ALL
         SELECT
              CUST.GLBL_CMPY_CD
             ,CUST.SELL_TO_CUST_CD AS DS_ACCT_NUM
             ,CUST.DS_ACCT_NM
             ,CUST.DS_ACCT_TP_CD
             ,CUST.PTY_LOC_PK
             ,CUST.DS_ACCT_ACTV_CUST_FLG
         FROM
              SELL_TO_CUST CUST
         WHERE
              CUST.GLBL_CMPY_CD         = #glblCmpyCd#
         AND  CUST.EZCANCELFLAG         = '0'
        ) ACCT
       ,PTY_LOC_WRK  PLW
       ,DS_ACCT_TP   DAP
       ,DS_ACCT_RELN RELN
       ,PRIN_CUST    PC
       ,DS_ACCT_RELN_TP DART
    WHERE
         ACCT.GLBL_CMPY_CD         = DAP.GLBL_CMPY_CD
    AND  ACCT.DS_ACCT_TP_CD        = DAP.DS_ACCT_TP_CD
    AND  DAP.EZCANCELFLAG          = '0'
    AND  ACCT.GLBL_CMPY_CD         = PLW.GLBL_CMPY_CD(+)
    AND  ACCT.PTY_LOC_PK           = PLW.PTY_LOC_PK(+)
    AND  PLW.EZCANCELFLAG(+)       = '0'
    AND  ACCT.GLBL_CMPY_CD         = RELN.GLBL_CMPY_CD
    AND  ACCT.DS_ACCT_NUM          = RELN.RELN_DS_ACCT_NUM
    AND  RELN.DS_ACCT_NUM          = #targetDsAcctNum#
    AND  RELN.EZCANCELFLAG         = '0'
    <isNotNull property="dsAcctActvCustFlg">
    AND  ACCT.DS_ACCT_ACTV_CUST_FLG = #dsAcctActvCustFlg# 
    </isNotNull> 
    <isNotNull property="rgtnStsCd">
    AND  RELN.RGTN_STS_CD = #rgtnStsCd# 
    </isNotNull>
    <iterate property="dsAcctRelnTpList" var="dsAcctRelnTpList[]" open="AND RELN.DS_ACCT_RELN_TP_CD IN (" close=")" conjunction=",">
    #dsAcctRelnTpList[]#
    </iterate>
    AND  PLW.GLBL_CMPY_CD = PC.GLBL_CMPY_CD(+)
    AND  PLW.LOC_NUM = PC.LOC_NUM(+)
    AND  PC.EZCANCELFLAG(+) = '0'
    AND  RELN.GLBL_CMPY_CD         = DART.GLBL_CMPY_CD
    AND  RELN.DS_ACCT_RELN_TP_CD   = DART.DS_ACCT_RELN_TP_CD
    AND  DART.EZCANCELFLAG         = '0'   
    ORDER BY 
         DART.DS_ACCT_RELN_TP_SORT_NUM, ACCT.DS_ACCT_NM
    </statement>

    <statement id="getParentData" parameterClass="Map" resultClass="Map">
    SELECT
        PLW.CTY_ADDR
       ,PLW.LOC_NUM
       ,PLW.ST_CD
       ,PLW.POST_CD
       ,PLW.FIRST_LINE_ADDR ||
            DECODE(PLW.SCD_LINE_ADDR, NULL, '', ' ' || PLW.SCD_LINE_ADDR) ||
            DECODE(PLW.THIRD_LINE_ADDR, NULL, '', ' ' || PLW.THIRD_LINE_ADDR) ||
            DECODE(PLW.FRTH_LINE_ADDR, NULL, '', ' ' || PLW.FRTH_LINE_ADDR) AS ADDRESS
       ,CASE WHEN PS.PTY_LOC_PK = PLW.PTY_LOC_PK 
           THEN 'Y'
           ELSE 'N'
        END PRIMARY
    FROM
        SELL_TO_CUST DAC
       ,PTY_LOC_WRK PLW
       ,PRIN_CUST PS
    WHERE
        DAC.SELL_TO_CUST_CD = #targetDsAcctNum#
    AND DAC.GLBL_CMPY_CD = #glblCmpyCd#
    AND DAC.EZCANCELFLAG = '0'
    AND DAC.PTY_LOC_PK = PLW.PTY_LOC_PK
    AND DAC.GLBL_CMPY_CD = PLW.GLBL_CMPY_CD
    AND PLW.EZCANCELFLAG = '0'
    AND PLW.GLBL_CMPY_CD = PS.GLBL_CMPY_CD (+)
    AND PS.EZCANCELFLAG(+) = '0'
    AND PLW.LOC_NUM = PS.LOC_NUM(+)
    </statement>

    <statement id="getTreeListLocation"  parameterClass ="Map" resultClass="Map">
    SELECT * FROM (
    SELECT
         ''               AS P_DS_ACCT_NUM
        ,#dsAcctNum#      AS DS_ACCT_NUM
        ,''               AS DS_ACCT_RELN_TP_CD
        ,''               AS dsAcctNum_T1
        ,''               AS dsAcctNum_T2
        ,''               AS dsAcctNum_T3
        ,''               AS dsAcctNum_T4
        ,''               AS dsAcctNum_T5
        ,''               AS dsAcctNum_T6
        ,''               AS dsAcctNum_T7
        ,''               AS dsAcctNum_T8
        ,''               AS dsAcctNum_T9
        ,''               AS dsAcctNum_TA
        ,ACCT.DS_ACCT_NM  AS DS_ACCT_NM
        ,PLW.FIRST_LINE_ADDR ||
             DECODE(PLW.SCD_LINE_ADDR, NULL, '', ' ' || PLW.SCD_LINE_ADDR) ||
             DECODE(PLW.THIRD_LINE_ADDR, NULL, '', ' ' || PLW.THIRD_LINE_ADDR) ||
             DECODE(PLW.FRTH_LINE_ADDR, NULL, '', ' ' || PLW.FRTH_LINE_ADDR) AS ADDRESS
        ,PLW.CTY_ADDR
        ,PLW.ST_CD
        ,PLW.POST_CD
        ,(SELECT
              DS_ACCT_TP_NM 
          FROM
              DS_ACCT_TP TP
          WHERE
              TP.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
          AND
              TP.EZCANCELFLAG = '0'
          AND
              TP.DS_ACCT_TP_CD = ACCT.DS_ACCT_TP_CD
         ) AS DS_ACCT_TP_NM
        , PLW.LOC_NUM AS LOC_NUM
        ,CASE
             WHEN PC.PTY_LOC_PK = PLW.PTY_LOC_PK
             THEN 'Y'
             ELSE 'N'
         END PRIMARY
        ,CASE
             WHEN AL.RGTN_STS_CD = #activeCd#
             THEN #active#
             ELSE #inActive#
         END DS_ACCT_STS_NM
    FROM
        (
         SELECT
              PROS.GLBL_CMPY_CD
             ,PROS.DS_ACCT_NUM
             ,PROS.DS_ACCT_NM
             ,PROS.DS_ACCT_TP_CD
             ,PROS.DS_ACCT_ACTV_CUST_FLG
         FROM
             DS_ACCT_PROS PROS
         WHERE
             PROS.GLBL_CMPY_CD       = #glblCmpyCd#
         AND PROS.DS_ACCT_NUM        = #dsAcctNum#
         AND PROS.EZCANCELFLAG       = '0'
         UNION ALL
         SELECT
              CUST.GLBL_CMPY_CD
             ,CUST.SELL_TO_CUST_CD AS DS_ACCT_NUM
             ,CUST.DS_ACCT_NM
             ,CUST.DS_ACCT_TP_CD
             ,CUST.DS_ACCT_ACTV_CUST_FLG 
         FROM
             SELL_TO_CUST CUST
         WHERE
             CUST.GLBL_CMPY_CD       = #glblCmpyCd#
         AND CUST.SELL_TO_CUST_CD    = #dsAcctNum#
         AND CUST.EZCANCELFLAG       = '0'
        ) ACCT
        ,ACCT_LOC     AL
        ,PTY_LOC_WRK  PLW
        ,PRIN_CUST    PC
        ,BILL_TO_CUST BTC
        ,SHIP_TO_CUST STC
    WHERE
        ACCT.GLBL_CMPY_CD       = AL.GLBL_CMPY_CD
    AND ACCT.DS_ACCT_NUM        = AL.DS_ACCT_NUM
    AND AL.EZCANCELFLAG        = '0'
    AND AL.GLBL_CMPY_CD         = PLW.GLBL_CMPY_CD
    AND AL.PTY_LOC_PK           = PLW.PTY_LOC_PK
    AND PLW.EZCANCELFLAG        = '0'
    AND PLW.GLBL_CMPY_CD        = BTC.GLBL_CMPY_CD(+)
    AND PLW.PTY_LOC_PK          = BTC.PTY_LOC_PK(+)
    AND BTC.EZCANCELFLAG(+)     = '0'
    AND PLW.GLBL_CMPY_CD        = STC.GLBL_CMPY_CD(+)
    AND PLW.PTY_LOC_PK          = STC.PTY_LOC_PK(+)
    AND STC.EZCANCELFLAG(+)     = '0'
    <isNotNull property="dsAcctActvCustFlg">
    AND ACCT.DS_ACCT_ACTV_CUST_FLG = #dsAcctActvCustFlg# 
    </isNotNull>
    <isNotNull property="rgtnStsCd">
    AND AL.RGTN_STS_CD = #rgtnStsCd#
    AND PC.RGTN_STS_CD(+) = #rgtnStsCd#
    AND BTC.RGTN_STS_CD(+) = #rgtnStsCd#
    AND STC.RGTN_STS_CD(+) = #rgtnStsCd# 
    </isNotNull>
    <isNotNull property="primaryOnly">
    AND PC.LOC_NUM = PLW.LOC_NUM
    </isNotNull>
    AND PLW.GLBL_CMPY_CD = PC.GLBL_CMPY_CD(+)
    AND PLW.LOC_NUM = PC.LOC_NUM(+)
    AND PC.EZCANCELFLAG(+) = '0'
    ) A
    ORDER BY A.PRIMARY DESC, ADDRESS
    </statement>
    
    <statement id="getDefCoa" parameterClass="Map" resultClass="Map">
       SELECT DEF.COA_CH_CD
         FROM DEF_DPLY_COA_INFO DEF
        WHERE DEF.GLBL_CMPY_CD = #glblCmpyCd#
          AND DEF.EZCANCELFLAG = '0'
          AND DEF.APP_FUNC_ID = #appFuncId_AcctMaint#
    </statement>
    
    <statement id="getInvoiceSourceListInternalReview" parameterClass="Map" resultClass="Map">
        SELECT 
            R.PSN_CD
           ,R.DS_CUST_INV_RULE_RCPNT_PK
        FROM
            DS_CUST_INV_RULE_RCPNT R
        WHERE
            R.GLBL_CMPY_CD = #glblCmpyCd#
        AND R.EZCANCELFLAG = '0'
        AND R.DS_CUST_INV_RULE_PK = #dsCustInvRulePk#
        AND R.INV_RULE_RCPNT_TP_CD = #invRuleRcpntTp_Internal#
        ORDER BY
            R.PSN_CD
    </statement>
  
    <statement id="getInvoiceSourceListExternalContact" parameterClass="Map" resultClass="Map">
        SELECT 
            R.CTAC_PSN_PK
           ,R.DS_CUST_INV_RULE_RCPNT_PK
        FROM
            DS_CUST_INV_RULE_RCPNT R
        WHERE
            R.GLBL_CMPY_CD = #glblCmpyCd#
        AND R.EZCANCELFLAG = '0'
        AND R.DS_CUST_INV_RULE_PK = #dsCustInvRulePk#
        AND R.INV_RULE_RCPNT_TP_CD = #invRuleRcpntTp_External#
        ORDER BY
            R.CTAC_PSN_PK
    </statement>
    
    <statement id="getHierarchyList"  parameterClass ="Map" resultClass="Map">
        WITH WRK_PRNT_UP AS (
            -- get tree of parent
            SELECT R.RELN_DS_ACCT_NUM, LEVEL LVL
              FROM (
                    SELECT RELN.RELN_DS_ACCT_NUM, DS_ACCT_NUM
                      FROM DS_ACCT_RELN RELN 
                     WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
                       AND RELN.EZCANCELFLAG = '0'
                       AND RELN.DS_ACCT_RELN_TP_CD = #dsAcctRelnTp_PrntAcct#
                       <isNotNull property="actvFlg">
                       AND RELN.RGTN_STS_CD = #rgtnSts_Ready#
                       </isNotNull>
             ) R
             WHERE LEVEL &lt;= #prntMaxLvl#
             START WITH R.DS_ACCT_NUM = #dsAcctNum#
             CONNECT BY NOCYCLE
             PRIOR R.RELN_DS_ACCT_NUM = R.DS_ACCT_NUM
        )
        , WRK_TOP AS (
            -- get top parent
            SELECT RELN_DS_ACCT_NUM DS_ACCT_NUM FROM WRK_PRNT_UP WHERE LVL = ( 
              SELECT MAX(LVL) FROM WRK_PRNT_UP W
            ) AND ROWNUM = 1
            -- in the case that origin account do not have parent relation, set itself as tree top
            UNION ALL
            SELECT #dsAcctNum# DS_ACCT_NUM FROM DUAL WHERE NOT EXISTS (SELECT 1 FROM WRK_PRNT_UP)
        )
        , WRK_PRNT_ALL AS (
            -- get child tree from top parent
            SELECT R.DS_ACCT_NUM, R.RELN_DS_ACCT_NUM, R.DS_ACCT_RELN_TP_CD, R.DS_ACCT_RELN_BILL_TO_FLG, R.DS_ACCT_RELN_SHIP_TO_FLG
                 , SYS_CONNECT_BY_PATH (R.RELN_DS_ACCT_NUM, '/')  || '/' || R.DS_ACCT_NUM TREE_PATH
              FROM (
                    SELECT * FROM DS_ACCT_RELN RELN 
                     WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
                       AND RELN.EZCANCELFLAG = '0'
                       AND RELN.DS_ACCT_RELN_TP_CD = #dsAcctRelnTp_PrntAcct#
                       <isNotNull property="actvFlg">
                       AND RELN.RGTN_STS_CD = #rgtnSts_Ready#
                       </isNotNull>
                   ) R
             WHERE LEVEL &lt;= #childMaxLvl#
             START WITH R.RELN_DS_ACCT_NUM = (SELECT WRK_TOP.DS_ACCT_NUM FROM WRK_TOP)
             CONNECT BY NOCYCLE
             PRIOR R.DS_ACCT_NUM = R.RELN_DS_ACCT_NUM
            --
            UNION ALL
            --
            SELECT (SELECT WRK_TOP.DS_ACCT_NUM FROM WRK_TOP) DS_ACCT_NUM
                 , '' RELN_DS_ACCT_NUM, '' DS_ACCT_RELN_TP_CD, '' DS_ACCT_RELN_BILL_TO_FLG, '' DS_ACCT_RELN_SHIP_TO_FLG
                 , '/' || (SELECT WRK_TOP.DS_ACCT_NUM FROM WRK_TOP) TREE_PATH
              FROM DUAL
        )
        , WRK AS (
            -- merge parent relation with lease/related relation
            SELECT * FROM WRK_PRNT_ALL
        )
        , ACCT_ORIG AS (
            SELECT
                  W.TREE_PATH
                , W.DS_ACCT_NUM                 AS DS_ACCT_NUM
                , W.DS_ACCT_RELN_TP_CD          AS DS_ACCT_RELN_TP_CD
                , ACCT.DS_ACCT_NM               AS DS_ACCT_NM
                , TP.DS_ACCT_TP_NM              AS DS_ACCT_TP_NM
                <!-- 2017/10/13 QC#20662 mod start -->
                <!-- , PTY.FIRST_LINE_ADDR ||
                     DECODE(PTY.SCD_LINE_ADDR,   NULL, '', ' ' || PTY.SCD_LINE_ADDR) ||
                     DECODE(PTY.THIRD_LINE_ADDR, NULL, '', ' ' || PTY.THIRD_LINE_ADDR) ||
                     DECODE(PTY.FRTH_LINE_ADDR,  NULL, '', ' ' || PTY.FRTH_LINE_ADDR) 
                                                AS ADDRESS
                , PTY.CTY_ADDR                  AS CTY_ADDR
                , PTY.ST_CD                     AS ST_CD
                , PTY.POST_CD                   AS POST_CD
                , PTY.LOC_NUM                   AS LOC_NUM
                -->
                , NVL(PTY.FIRST_LINE_ADDR ||
                     DECODE(PTY.SCD_LINE_ADDR,   NULL, '', ' ' || PTY.SCD_LINE_ADDR) ||
                     DECODE(PTY.THIRD_LINE_ADDR, NULL, '', ' ' || PTY.THIRD_LINE_ADDR) ||
                     DECODE(PTY.FRTH_LINE_ADDR,  NULL, '', ' ' || PTY.FRTH_LINE_ADDR)
                     ,PPTY.FIRST_LINE_ADDR ||
                     DECODE(PPTY.SCD_LINE_ADDR,   NULL, '', ' ' || PPTY.SCD_LINE_ADDR) ||
                     DECODE(PPTY.THIRD_LINE_ADDR, NULL, '', ' ' || PPTY.THIRD_LINE_ADDR) ||
                     DECODE(PPTY.FRTH_LINE_ADDR,  NULL, '', ' ' || PPTY.FRTH_LINE_ADDR))
                                                    AS ADDRESS
                , NVL(PTY.CTY_ADDR, PPTY.CTY_ADDR)  AS CTY_ADDR
                , NVL(PTY.ST_CD, PPTY.ST_CD)        AS ST_CD
                , NVL(PTY.POST_CD, PPTY.POST_CD)    AS POST_CD
                , NVL(PTY.LOC_NUM , PPTY.LOC_NUM)   AS LOC_NUM
                , CASE WHEN PRIN.PRIN_CUST_PK IS NOT NULL THEN 'Y' ELSE 'N' END AS PRIM_FLG
                , ACCT.DS_ACCT_ACTV_CUST_FLG    AS DS_ACCT_ACTV_CUST_FLG
                , LOC.RGTN_STS_CD               AS LOC_RGTN_STS_CD
                <!-- , PTY.RGTN_STS_CD               AS PTY_RGTN_STS_CD -->
                , NVL(PTY.RGTN_STS_CD, PPTY.RGTN_STS_CD) AS PTY_RGTN_STS_CD
            FROM
                  WRK W
                , ( 
                    SELECT CUST.EZCANCELFLAG
                          ,CUST.GLBL_CMPY_CD
                          ,CUST.SELL_TO_CUST_CD AS DS_ACCT_NUM
                          ,CUST.DS_ACCT_TP_CD
                          ,CUST.DS_ACCT_ACTV_CUST_FLG
                          ,CUST.DS_ACCT_NM
                          ,CUST.PTY_LOC_PK <!-- 2017/10/13 QC#20662 add start -->
                    FROM SELL_TO_CUST CUST
                    WHERE GLBL_CMPY_CD = #glblCmpyCd#
                    AND EZCANCELFLAG = '0'
                    UNION ALL
                    SELECT PROS.EZCANCELFLAG
                          ,PROS.GLBL_CMPY_CD
                          ,PROS.DS_ACCT_NUM
                          ,PROS.DS_ACCT_TP_CD
                          ,PROS.DS_ACCT_ACTV_CUST_FLG
                          ,PROS.DS_ACCT_NM
                          ,PROS.PTY_LOC_PK <!-- 2017/10/13 QC#20662 add start -->
                    FROM DS_ACCT_PROS PROS
                    WHERE GLBL_CMPY_CD = #glblCmpyCd#
                    AND EZCANCELFLAG = '0'
                  ) ACCT
                , DS_ACCT_TP     TP
                , ACCT_LOC       LOC
                , PTY_LOC_WRK    PTY
                , PRIN_CUST      PRIN
                <!-- 2017/10/13 QC#20662 add start -->
                , PROS_PTY_LOC_WRK PPTY
                <!-- 2017/10/13 QC#20662 add end -->
            WHERE 
                  ACCT.DS_ACCT_NUM        = W.DS_ACCT_NUM
              AND ACCT.GLBL_CMPY_CD       = #glblCmpyCd#
              AND ACCT.EZCANCELFLAG       = '0'
    
              AND TP.GLBL_CMPY_CD(+)      = ACCT.GLBL_CMPY_CD
              AND TP.DS_ACCT_TP_CD(+)     = ACCT.DS_ACCT_TP_CD
              AND TP.EZCANCELFLAG(+)      = '0'
      
              AND LOC.DS_ACCT_NUM(+)      = ACCT.DS_ACCT_NUM
              AND LOC.GLBL_CMPY_CD(+)     = ACCT.GLBL_CMPY_CD
              AND LOC.EZCANCELFLAG(+)     = '0' 
      
              AND PTY.PTY_LOC_PK(+)       = LOC.PTY_LOC_PK
              AND PTY.GLBL_CMPY_CD(+)     = LOC.GLBL_CMPY_CD
              AND PTY.EZCANCELFLAG(+)     = '0'
    
              AND PRIN.LOC_NUM(+)         = LOC.LOC_NUM
              AND PRIN.GLBL_CMPY_CD(+)    = LOC.GLBL_CMPY_CD
              AND PRIN.EZCANCELFLAG(+)    = '0'
              <!-- 2017/10/13 QC#20662 add start -->
              AND PPTY.PTY_LOC_PK(+)      = ACCT.PTY_LOC_PK
              AND PPTY.GLBL_CMPY_CD(+)    = ACCT.GLBL_CMPY_CD
              AND PPTY.EZCANCELFLAG(+)    = '0'
              <!-- 2017/10/13 QC#20662 add end -->

              <isNotNull property="actvFlg">
              AND ACCT.DS_ACCT_ACTV_CUST_FLG = 'Y'
              AND LOC.RGTN_STS_CD(+)      = #rgtnSts_Ready#
              AND PTY.RGTN_STS_CD(+)      = #rgtnSts_Ready#
              AND PPTY.RGTN_STS_CD(+)     = #rgtnSts_Ready# <!-- 2017/10/13 QC#20662 add -->
              </isNotNull>
          )
        , ACCT_FLTR AS (
            <isNotNull property="primOnlyFlg">
            SELECT TREE_PATH
                  , DS_ACCT_NUM
                  , DS_ACCT_RELN_TP_CD
                  , DS_ACCT_NM
                  , DS_ACCT_TP_NM
                  , ADDRESS
                  , CTY_ADDR
                  , ST_CD
                  , POST_CD
                  , LOC_NUM
                  , PRIM_FLG
                  , DS_ACCT_ACTV_CUST_FLG
                  , LOC_RGTN_STS_CD
                  , PTY_RGTN_STS_CD
              FROM ACCT_ORIG
             WHERE 1=1
               AND PRIM_FLG = 'Y'
            UNION
            SELECT DISTINCT TREE_PATH
                  , DS_ACCT_NUM
                  , DS_ACCT_RELN_TP_CD
                  , DS_ACCT_NM
                  , DS_ACCT_TP_NM
                  , '' ADDRESS
                  , '' CTY_ADDR
                  , '' ST_CD
                  , '' POST_CD
                  , '' LOC_NUM
                  , '' PRIM_FLG
                  , DS_ACCT_ACTV_CUST_FLG
                  , '' LOC_RGTN_STS_CD
                  , '' PTY_RGTN_STS_CD
              FROM ACCT_ORIG A1
             WHERE 1=1
               AND PRIM_FLG = 'N'
               AND NOT EXISTS (
                SELECT 1 FROM ACCT_ORIG A2 WHERE A2.DS_ACCT_NUM = A1.DS_ACCT_NUM AND A2.PRIM_FLG = 'Y'
               )
            </isNotNull>
            <isNull property="primOnlyFlg">
            SELECT *
              FROM ACCT_ORIG
             WHERE 1=1  
            </isNull>
             ORDER BY
                   TREE_PATH NULLS LAST, DS_ACCT_RELN_TP_CD, DS_ACCT_NUM, PRIM_FLG DESC, ADDRESS
          )
        SELECT * 
          FROM ACCT_FLTR
         WHERE ROWNUM &lt;= #maxRow#
    </statement>

    <statement id="getLocationWithoutLocNum" parameterClass="Map" resultClass="Map">
      SELECT DAP.LOC_NUM
        FROM DS_ACCT_PROS DAP
       WHERE DAP.EZCANCELFLAG = '0'
         AND DAP.GLBL_CMPY_CD = #glblCmpyCd#
         AND DAP.DS_ACCT_NUM = #dsAcctNum#
         AND DAP.LOC_NUM IS NOT NULL
    </statement>
    <!-- 2017/08/08 QC#8598 Add Start -->
    <statement id="getPrimaryContactForDuplicateCheck" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT RELN.DS_CTAC_PSN_RELN_PK AS DS_CTAC_PSN_RELN_PK
        FROM
            DS_CTAC_PSN_RELN RELN
            , CTAC_PSN PSN
        WHERE
            RELN.GLBL_CMPY_CD = #glblCmpyCd#
        AND RELN.EZCANCELFLAG = '0'
            
        AND RELN.GLBL_CMPY_CD = PSN.GLBL_CMPY_CD
        AND RELN.CTAC_PSN_PK = PSN.CTAC_PSN_PK
        AND RELN.EFF_FROM_DT &lt; #chkEffThruDt#
        AND NVL(RELN.EFF_THRU_DT, #maxEffThruDt#) &gt;= #chkEffFromDt#
        
        AND PSN.EZCANCELFLAG = '0'

        AND RELN.DS_ACCT_NUM = #dsAcctNum#
        AND PSN.CTAC_PSN_PK &lt;&gt; #ctacPsnPk#
        AND RELN.DS_PRIM_LOC_FLG = 'Y'
        AND PSN.CTAC_PSN_ACTV_FLG = 'Y'
        AND RELN.CTAC_TP_CD = #ctacTpCd#
    </statement>
    <!-- 2017/08/08 QC#8598 Add End -->

    <!-- 2017/10/3 QC#21198 Add Start -->
    <statement id="getRelnAcct" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            RELN.DS_ACCT_RELN_PK
        FROM
            DS_ACCT_RELN RELN
        WHERE
                RELN.GLBL_CMPY_CD           = #glblCmpyCd#
            AND RELN.DS_ACCT_NUM            = #dsAcctNum#
            AND RELN.RELN_DS_ACCT_NUM       = #relnDsAcctNum#
            AND RELN.DS_ACCT_RELN_TP_CD     = #dsAcctRelnTpCd#
            AND RELN.DS_ACCT_RELN_RECIP_FLG = #dsAcctRelnRecipFlg#
            AND RELN.EFF_FROM_DT            = #effFromDt#
            <isNotNull property="effThruDt">
            AND RELN.EFF_THRU_DT            = #effThruDt#
            </isNotNull>
            <isNull property="effThruDt">
            AND RELN.EFF_THRU_DT IS NULL
            </isNull>
            AND RELN.EZCANCELFLAG     = '0'
    </statement>
    <!-- 2017/10/3 QC#21198 Add End -->

    <statement id="getDsCustShpgDefList" parameterClass="Map" resultClass="Map">
        <!-- 2018/12/10 QC#29315 Add Start -->
        SELECT 
               TBL1.EZUPTIME               AS DCSD_EZUPTIME
              ,TBL1.EZUPTIMEZONE           AS DCSD_EZUPTIMEZONE
              ,TBL1.DS_CUST_SHPG_DEF_PK
              ,TBL1.LINE_BIZ_TP_CD
              ,TBL1.DS_BIZ_AREA_CD
              ,TBL1.FRT_COND_CD
              ,TBL1.SHPG_SVC_LVL_CD
              ,TBL1.CUST_EFF_LVL_CD
              ,TBL1.EFF_FROM_DT
              ,TBL1.EFF_THRU_DT
              ,TBL1.DEF_FLG
              ,TBL1.XX_REC_HIST_CRAT_TS
              ,TBL1.XX_REC_HIST_CRAT_BY_NM
              ,TBL1.XX_REC_HIST_UPD_TS
              ,TBL1.XX_REC_HIST_UPD_BY_NM
              ,TBL1.XX_REC_HIST_TBL_NM
              ,TBL2.VND_CD
              <!-- 2023/01/13 QC#60860 Add Start -->
              ,TBL2.VND_NM
              <!-- 2023/01/13 QC#60860 Add End -->
              ,TBL2.DS_CARR_ACCT_NUM
              ,TBL2.DEF_ACCT_CARR_FLG
              ,TBL2.DS_ACCT_CARR_PK
              ,TBL2.EZUPTIME             AS DAC_EZUPTIME
              ,TBL2.EZUPTIMEZONE         AS DAC_EZUPTIMEZONE
         FROM (
         <!-- 2018/12/10 QC#29315 Add End -->
            SELECT
                    DCSD.EZUPTIME
                   ,DCSD.EZUPTIMEZONE
                   ,DCSD.DS_CUST_SHPG_DEF_PK
                   ,DCSD.LINE_BIZ_TP_CD
                   ,DCSD.DS_BIZ_AREA_CD
                   ,DCSD.FRT_COND_CD
                   ,DCSD.SHPG_SVC_LVL_CD
                   ,DCSD.CUST_EFF_LVL_CD
                   ,DCSD.EFF_FROM_DT
                   ,DCSD.EFF_THRU_DT
                   <!-- 2018/12/10 QC#29315 Add Start -->
                   ,DCSD.DEF_FLG
                   ,DCSD.DS_ACCT_CARR_PK
                   <!-- 2018/12/10 QC#29315 Add End -->
                   , DCSD.EZINTIME             AS XX_REC_HIST_CRAT_TS
                   , DCSD.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
                   , DCSD.EZUPTIME             AS XX_REC_HIST_UPD_TS
                   , DCSD.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
                   , 'DS_CUST_SHPG_DEF'        AS XX_REC_HIST_TBL_NM
            FROM
                    DS_CUST_SHPG_DEF DCSD
                    , LINE_BIZ_TP LBT
                    , DS_BIZ_AREA DBA
                    , FRT_COND FC
                    , SHPG_SVC_LVL SSL
            WHERE
                    DCSD.GLBL_CMPY_CD          = #glblCmpyCd#
            AND     DCSD.DS_ACCT_NUM           = #dsAcctNum#
            AND     DCSD.EZCANCELFLAG          = '0' 
    
            AND     DCSD.GLBL_CMPY_CD          = LBT.GLBL_CMPY_CD
            AND     DCSD.LINE_BIZ_TP_CD        = LBT.LINE_BIZ_TP_CD 
            AND     LBT.EZCANCELFLAG           = '0' 
    
            AND     DCSD.GLBL_CMPY_CD          = DBA.GLBL_CMPY_CD
            AND     DCSD.DS_BIZ_AREA_CD        = DBA.DS_BIZ_AREA_CD 
            AND     DBA.EZCANCELFLAG           = '0' 
    
            AND     DCSD.GLBL_CMPY_CD          = FC.GLBL_CMPY_CD (+)
            AND     DCSD.FRT_COND_CD           = FC.FRT_COND_CD (+)
            AND     FC.EZCANCELFLAG (+)        = '0' 
    
            AND     DCSD.GLBL_CMPY_CD          = SSL.GLBL_CMPY_CD (+)
            AND     DCSD.SHPG_SVC_LVL_CD       = SSL.SHPG_SVC_LVL_CD (+)
            AND     SSL.EZCANCELFLAG (+)       = '0' 
    
            ORDER BY 
                    LBT.LINE_BIZ_TP_SORT_NUM, DBA.DS_BIZ_AREA_SORT_NUM, FC.FRT_COND_SORT_NUM, DCSD.DS_CUST_SHPG_DEF_PK DESC, NVL(DCSD.EFF_THRU_DT,#maxEffThruDt#) DESC
        ) TBL1,
        <!-- 2018/12/10 QC#29315 Add Start -->
        (   SELECT
                     DAC.VND_CD              VND_CD
                   , DAC.DS_CARR_ACCT_NUM    DS_CARR_ACCT_NUM
                   , DAC.EFF_FROM_DT         EFF_FROM_DT
                   , DAC.EFF_THRU_DT         EFF_THRU_DT
                   , DAC.DEF_ACCT_CARR_FLG   DEF_ACCT_CARR_FLG
                   , DAC.DS_ACCT_CARR_PK     DS_ACCT_CARR_PK
                   , DAC.EZUPTIME            EZUPTIME
                   , DAC.EZUPTIMEZONE        EZUPTIMEZONE
                   , DAC.EZINTIME             AS XX_REC_HIST_CRAT_TS
                   , DAC.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM
                   , DAC.EZUPTIME             AS XX_REC_HIST_UPD_TS
                   , DAC.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM
                   , 'DS_ACCT_CARR'           AS XX_REC_HIST_TBL_NM
                   <!-- 2023/01/13 QC#60860 Add Start -->
                   , V.CARR_NM                AS VND_NM
                   <!-- 2023/01/13 QC#60860 Add End -->
            FROM
                    DS_ACCT_CARR DAC
                    <!-- 2023/01/13 QC#60860 Add Start -->
                   ,OTBD_CARR_V  V
                    <!-- 2023/01/13 QC#60860 Add End -->
            WHERE
                    DAC.GLBL_CMPY_CD           = #glblCmpyCd#
            AND     DAC.DS_ACCT_NUM            = #dsAcctNum#
            AND     DAC.EZCANCELFLAG           = '0'
            <!-- 2023/01/13 QC#60860 Add Start -->
            AND     DAC.GLBL_CMPY_CD           = V.GLBL_CMPY_CD(+)
            AND     V.EZCANCELFLAG(+)          = '0'
            AND     DAC.VND_CD                 = V.CARR_CD(+)
            <!-- 2023/01/13 QC#60860 Add End -->

        ) TBL2
        WHERE
              ROWNUM &lt;= #rowNum#
        AND   TBL1.DS_ACCT_CARR_PK = TBL2.DS_ACCT_CARR_PK
        <!-- 2018/12/10 QC#29315 Add End -->

    </statement>
    <statement id="getFrtCondSvcReln" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            <isNotNull property="frtCondCd">
            R.SHPG_SVC_LVL_CD
            ,SSL.SHPG_SVC_LVL_NM
            ,SSL.SHPG_SVC_LVL_SORT_NUM
            </isNotNull>
            <isNull property="frtCondCd">
            R.FRT_COND_CD
            ,FC.FRT_COND_NM
            ,FC.FRT_COND_SORT_NUM
            </isNull>
        FROM
            FRT_COND_SVC_LVL_RELN R
            <isNotNull property="frtCondCd">
            ,SHPG_SVC_LVL SSL
            </isNotNull>
            <isNull property="frtCondCd">
            ,FRT_COND FC
            </isNull>
        WHERE
                R.GLBL_CMPY_CD = #glblCmpyCd#
            AND R.LINE_BIZ_TP_CD = #lineBizTpCd#
            AND R.EZCANCELFLAG = '0'
            <isNotNull property="frtCondCd">
            AND R.FRT_COND_CD = #frtCondCd#

            AND R.GLBL_CMPY_CD = SSL.GLBL_CMPY_CD
            AND R.SHPG_SVC_LVL_CD = SSL.SHPG_SVC_LVL_CD
            AND R.EZCANCELFLAG = SSL.EZCANCELFLAG
            </isNotNull>

            <isNull property="frtCondCd">
            AND R.GLBL_CMPY_CD = FC.GLBL_CMPY_CD
            AND R.FRT_COND_CD = FC.FRT_COND_CD
            AND R.EZCANCELFLAG = FC.EZCANCELFLAG
            </isNull>
        ORDER BY
            <isNotNull property="frtCondCd">
            SSL.SHPG_SVC_LVL_SORT_NUM
            </isNotNull>
            <isNull property="frtCondCd">
            FC.FRT_COND_SORT_NUM
            </isNull>
    </statement>

    <!-- START 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->
    <statement id="getCmpyPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
              PLW.CMPY_PK AS CMPY_PK
        FROM
              PTY_LOC_WRK  PLW
        WHERE
                PLW.GLBL_CMPY_CD = #glblCmpyCd#
            AND PLW.EZCANCELFLAG = '0'
            AND PLW.LOC_NUM      = #locNum#
            AND PLW.RGTN_STS_CD  = #rgtnStsCd#
    </statement>
    <!-- END 2019/05/23 Hd.Sugawara [QC#50101,ADD] -->

    <!-- START 2019/08/07 Hd.Sugawara [QC#52385,ADD] -->
    <statement id="getCustInfoForRelatedChildReln" parameterClass="Map" resultClass="Map">
    SELECT
        R_DS_ACCT_RELN_TP_CD
      , R_DS_ACCT_NUM
      , R_RELN_DS_ACCT_NUM
      , R_BILL_TO_CUST_CD
      , R_SHIP_TO_CUST_CD
      , R_DS_ACCT_RELN_BILL_TO_FLG
      , R_DS_ACCT_RELN_SHIP_TO_FLG
    FROM (
        WITH  RELN_WRK(GLBL_CMPY_CD
              ,DS_ACCT_NUM
              , RELN_DS_ACCT_NUM
              , DS_ACCT_RELN_TP_CD
              , DS_ACCT_RELN_BILL_TO_FLG
              , DS_ACCT_RELN_SHIP_TO_FLG
              , LV) 
        AS (
            SELECT RELN.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                 , RELN.DS_ACCT_NUM              AS DS_ACCT_NUM
                 , RELN.RELN_DS_ACCT_NUM         AS RELN_DS_ACCT_NUM
                 , RELN.DS_ACCT_RELN_TP_CD       AS DS_ACCT_RELN_TP_CD
                 , RELN.DS_ACCT_RELN_BILL_TO_FLG AS DS_ACCT_RELN_BILL_TO_FLG
                 , RELN.DS_ACCT_RELN_SHIP_TO_FLG AS DS_ACCT_RELN_SHIP_TO_FLG
                 , 1        AS LV
                FROM DS_ACCT_RELN RELN 
                WHERE RELN.RELN_DS_ACCT_NUM = #acctNum#
                AND RELN.GLBL_CMPY_CD = #glblCmpyCd#
                AND RELN.EZCANCELFLAG = '0'
                AND RELN.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#

            UNION ALL
            SELECT RELN.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                 , RELN.DS_ACCT_NUM              AS DS_ACCT_NUM
                 , RELN.RELN_DS_ACCT_NUM         AS RELN_DS_ACCT_NUM
                 , RELN.DS_ACCT_RELN_TP_CD       AS DS_ACCT_RELN_TP_CD
                 , RELN.DS_ACCT_RELN_BILL_TO_FLG AS DS_ACCT_RELN_BILL_TO_FLG
                 , RELN.DS_ACCT_RELN_SHIP_TO_FLG AS DS_ACCT_RELN_SHIP_TO_FLG
                 , LV + 1        AS LV
                FROM DS_ACCT_RELN RELN, RELN_WRK
                WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
                AND RELN.EZCANCELFLAG = '0'
                AND RELN_WRK.DS_ACCT_NUM = RELN.RELN_DS_ACCT_NUM
                AND RELN_WRK.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#

            )

            CYCLE DS_ACCT_NUM SET IsLoop TO 'Y' DEFAULT 'N'

        SELECT * FROM (
        SELECT
            RELN_WRK.DS_ACCT_RELN_TP_CD AS R_DS_ACCT_RELN_TP_CD
            , RELN_WRK.RELN_DS_ACCT_NUM AS R_DS_ACCT_NUM
            , RELN_WRK.DS_ACCT_NUM AS R_RELN_DS_ACCT_NUM
            , BILL.BILL_TO_CUST_CD AS R_BILL_TO_CUST_CD
            , SHIP.SHIP_TO_CUST_CD AS R_SHIP_TO_CUST_CD
            , '' AS R_DS_ACCT_RELN_BILL_TO_FLG
            , '' AS R_DS_ACCT_RELN_SHIP_TO_FLG
        FROM
            RELN_WRK
            , SHIP_TO_CUST SHIP
            , BILL_TO_CUST BILL
            , ACCT_LOC AL
        WHERE  ( RELN_WRK.DS_ACCT_NUM = #acctNum#
              OR (RELN_WRK.DS_ACCT_NUM &lt;&gt; #acctNum# AND RELN_WRK.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#))
        AND RELN_WRK.IsLoop = 'N'

        AND AL.DS_ACCT_NUM = RELN_WRK.DS_ACCT_NUM
        AND AL.LOC_NUM = SHIP.LOC_NUM (+)
        AND AL.LOC_NUM = BILL.LOC_NUM(+)
        AND AL.EZCANCELFLAG(+) = '0'
        AND AL.GLBL_CMPY_CD(+) = #glblCmpyCd#

        AND  RELN_WRK.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD(+)
        AND  RELN_WRK.DS_ACCT_NUM = SHIP.SELL_TO_CUST_CD(+)
        AND  SHIP.EZCANCELFLAG(+) = '0'
        AND  SHIP.RGTN_STS_CD(+) = #rgtnStsCd#

        AND  RELN_WRK.GLBL_CMPY_CD = BILL.GLBL_CMPY_CD(+)
        AND  RELN_WRK.DS_ACCT_NUM = BILL.SELL_TO_CUST_CD(+)
        AND  BILL.EZCANCELFLAG(+) = '0'
        AND  BILL.RGTN_STS_CD(+) = #rgtnStsCd#

       ORDER BY RELN_WRK.DS_ACCT_NUM
                , RELN_WRK.RELN_DS_ACCT_NUM
       )
    )
    WHERE 1 = 1
        <isNotNull property="defBillToList">
            AND (
        </isNotNull>
        <isNull property="defBillToList">
            <isNotNull property="defShipToList">
                AND (
            </isNotNull>
        </isNull>

        <isNotNull property="defBillToList">
            <iterate property="defBillToList" var="defBillTo[]" open=" R_BILL_TO_CUST_CD IN (" close=")" conjunction=",">
                #defBillTo[]#
            </iterate>
        </isNotNull>
        <isNotNull property="defShipToList">
            <isNotNull property="defBillToList">
                OR
            </isNotNull>
            <iterate property="defShipToList" var="defShipTo[]" open=" R_SHIP_TO_CUST_CD IN (" close=")" conjunction=",">
                #defShipTo[]#
            </iterate>
        </isNotNull>

        <isNotNull property="defBillToList">
            )
        </isNotNull>
        <isNull property="defBillToList">
            <isNotNull property="defShipToList">
                )
            </isNotNull>
        </isNull>
    </statement>

    <statement id="getCustInfoForRelatedCurrent" parameterClass="Map" resultClass="Map">
    SELECT
        R_DS_ACCT_RELN_TP_CD
      , R_DS_ACCT_NUM
      , R_RELN_DS_ACCT_NUM
      , R_BILL_TO_CUST_CD
      , R_SHIP_TO_CUST_CD
      , R_DS_ACCT_RELN_BILL_TO_FLG
      , R_DS_ACCT_RELN_SHIP_TO_FLG
    FROM (
        SELECT
            '' AS R_DS_ACCT_RELN_TP_CD
            , SELL.SELL_TO_CUST_CD AS R_DS_ACCT_NUM
            , '' AS R_RELN_DS_ACCT_NUM
            , BILL.BILL_TO_CUST_CD AS R_BILL_TO_CUST_CD
            , SHIP.SHIP_TO_CUST_CD AS R_SHIP_TO_CUST_CD
            , '' AS R_DS_ACCT_RELN_BILL_TO_FLG
            , '' AS R_DS_ACCT_RELN_SHIP_TO_FLG
        FROM
            SELL_TO_CUST SELL
            , SHIP_TO_CUST SHIP
            , BILL_TO_CUST BILL
            , ACCT_LOC AL
        WHERE
             SELL.GLBL_CMPY_CD = #glblCmpyCd#
        AND  SELL.EZCANCELFLAG = '0'
        AND  SELL.SELL_TO_CUST_CD = #acctNum#

        AND  AL.DS_ACCT_NUM = SELL.SELL_TO_CUST_CD
        AND  AL.LOC_NUM = SHIP.LOC_NUM (+)
        AND  AL.LOC_NUM = BILL.LOC_NUM (+)
        AND  AL.EZCANCELFLAG (+)= '0'
        AND  AL.GLBL_CMPY_CD (+)= #glblCmpyCd#

        AND  SELL.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD(+)
        AND  SELL.SELL_TO_CUST_CD = SHIP.SELL_TO_CUST_CD(+)
        AND  SHIP.EZCANCELFLAG(+) = '0'
        AND  SHIP.RGTN_STS_CD (+)= #rgtnStsCd#

        AND  SELL.GLBL_CMPY_CD = BILL.GLBL_CMPY_CD(+)
        AND  SELL.SELL_TO_CUST_CD = BILL.SELL_TO_CUST_CD(+)

        AND  BILL.EZCANCELFLAG (+)= '0'
        AND  BILL.RGTN_STS_CD (+)= #rgtnStsCd#
    )
    WHERE 1 = 1
        <isNotNull property="defBillToList">
            AND (
        </isNotNull>
        <isNull property="defBillToList">
            <isNotNull property="defShipToList">
                AND (
            </isNotNull>
        </isNull>

        <isNotNull property="defBillToList">
            <iterate property="defBillToList" var="defBillTo[]" open=" R_BILL_TO_CUST_CD IN (" close=")" conjunction=",">
                #defBillTo[]#
            </iterate>
        </isNotNull>
        <isNotNull property="defShipToList">
            <isNotNull property="defBillToList">
                OR
            </isNotNull>
            <iterate property="defShipToList" var="defShipTo[]" open=" R_SHIP_TO_CUST_CD IN (" close=")" conjunction=",">
                #defShipTo[]#
            </iterate>
        </isNotNull>

        <isNotNull property="defBillToList">
            )
        </isNotNull>
        <isNull property="defBillToList">
            <isNotNull property="defShipToList">
                )
            </isNotNull>
        </isNull>
    </statement>

    <statement id="getCustInfoForRelatedParentReln" parameterClass="Map" resultClass="Map">
    SELECT
        R_DS_ACCT_RELN_TP_CD
      , R_DS_ACCT_NUM
      , R_RELN_DS_ACCT_NUM
      , R_BILL_TO_CUST_CD
      , R_SHIP_TO_CUST_CD
      , R_DS_ACCT_RELN_BILL_TO_FLG
      , R_DS_ACCT_RELN_SHIP_TO_FLG
    FROM (
        WITH  RELN_WRK(GLBL_CMPY_CD
              ,DS_ACCT_NUM
              , RELN_DS_ACCT_NUM
              , DS_ACCT_RELN_TP_CD
              , DS_ACCT_RELN_BILL_TO_FLG
              , DS_ACCT_RELN_SHIP_TO_FLG
              , LV) 
        AS (
            SELECT RELN.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                 , RELN.DS_ACCT_NUM              AS DS_ACCT_NUM
                 , RELN.RELN_DS_ACCT_NUM         AS RELN_DS_ACCT_NUM
                 , RELN.DS_ACCT_RELN_TP_CD       AS DS_ACCT_RELN_TP_CD
                 , RELN.DS_ACCT_RELN_BILL_TO_FLG AS DS_ACCT_RELN_BILL_TO_FLG
                 , RELN.DS_ACCT_RELN_SHIP_TO_FLG AS DS_ACCT_RELN_SHIP_TO_FLG
                 , 1        AS LV
                FROM DS_ACCT_RELN RELN 
                WHERE RELN.DS_ACCT_NUM = #acctNum#
                AND RELN.GLBL_CMPY_CD = #glblCmpyCd#
                AND RELN.EZCANCELFLAG = '0'
                AND RELN.DS_ACCT_RELN_TP_CD != #dsAcctRelnTpCd_Exclusion#

            UNION ALL
            SELECT RELN.GLBL_CMPY_CD             AS GLBL_CMPY_CD
                 , RELN.DS_ACCT_NUM              AS DS_ACCT_NUM
                 , RELN.RELN_DS_ACCT_NUM         AS RELN_DS_ACCT_NUM
                 , RELN.DS_ACCT_RELN_TP_CD       AS DS_ACCT_RELN_TP_CD
                 , RELN.DS_ACCT_RELN_BILL_TO_FLG AS DS_ACCT_RELN_BILL_TO_FLG
                 , RELN.DS_ACCT_RELN_SHIP_TO_FLG AS DS_ACCT_RELN_SHIP_TO_FLG
                 , LV + 1        AS LV
                FROM DS_ACCT_RELN RELN, RELN_WRK
                WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
                AND RELN.EZCANCELFLAG = '0'
                AND RELN_WRK.RELN_DS_ACCT_NUM = RELN.DS_ACCT_NUM
                AND RELN_WRK.DS_ACCT_NUM &lt;&gt; RELN.RELN_DS_ACCT_NUM 
                AND RELN_WRK.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#

            )

            CYCLE DS_ACCT_NUM SET IsLoop TO 'Y' DEFAULT 'N'
        SELECT /*+ LEADING(AL2 BILL SHIP)
                   USE_NL_WITH_INDEX(BILL BILL_TO_CUST_I4)
                   USE_NL_WITH_INDEX(SHIP SHIP_TO_CUST_I6) */
              AL2.DS_ACCT_RELN_TP_CD AS R_DS_ACCT_RELN_TP_CD
            , AL2.DS_ACCT_NUM AS R_DS_ACCT_NUM
            , AL2.RELN_DS_ACCT_NUM AS R_RELN_DS_ACCT_NUM
            , BILL.BILL_TO_CUST_CD AS R_BILL_TO_CUST_CD
            , SHIP.SHIP_TO_CUST_CD AS R_SHIP_TO_CUST_CD
            , AL2.DS_ACCT_RELN_BILL_TO_FLG AS R_DS_ACCT_RELN_BILL_TO_FLG
            , AL2.DS_ACCT_RELN_SHIP_TO_FLG AS R_DS_ACCT_RELN_SHIP_TO_FLG
        FROM (SELECT /*+ LEADING(RELN_WRK2 AL)
                         USE_NL_WITH_INDEX(AL ACCT_LOC_I2) */
                      RELN_WRK2.DS_ACCT_RELN_TP_CD
                    , RELN_WRK2.DS_ACCT_NUM
                    , RELN_WRK2.RELN_DS_ACCT_NUM
                    , RELN_WRK2.DS_ACCT_RELN_BILL_TO_FLG
                    , RELN_WRK2.DS_ACCT_RELN_SHIP_TO_FLG
                    , RELN_WRK2.GLBL_CMPY_CD
                    , AL.LOC_NUM
              FROM   (SELECT  RELN_WRK.DS_ACCT_RELN_TP_CD
                            , RELN_WRK.DS_ACCT_NUM
                            , RELN_WRK.RELN_DS_ACCT_NUM
                            , RELN_WRK.DS_ACCT_RELN_BILL_TO_FLG
                            , RELN_WRK.DS_ACCT_RELN_SHIP_TO_FLG
                            , RELN_WRK.GLBL_CMPY_CD
                        FROM  RELN_WRK
                       WHERE (RELN_WRK.DS_ACCT_NUM = #acctNum#
                          OR (RELN_WRK.DS_ACCT_NUM &lt;&gt; #acctNum# AND RELN_WRK.DS_ACCT_RELN_TP_CD = #dsAcctRelnTpCd#))
                         AND  RELN_WRK.IsLoop = 'N'
                         AND (RELN_WRK.DS_ACCT_RELN_BILL_TO_FLG = 'Y' OR  RELN_WRK.DS_ACCT_RELN_SHIP_TO_FLG = 'Y')
                      ORDER BY RELN_WRK.DS_ACCT_NUM
                              ,RELN_WRK.RELN_DS_ACCT_NUM) RELN_WRK2
                    , ACCT_LOC AL
              WHERE AL.DS_ACCT_NUM = RELN_WRK2.RELN_DS_ACCT_NUM
                AND AL.EZCANCELFLAG(+) = '0'
                AND AL.GLBL_CMPY_CD(+) = #glblCmpyCd#
            ) AL2
            , SHIP_TO_CUST SHIP
            , BILL_TO_CUST BILL
        WHERE AL2.LOC_NUM = SHIP.LOC_NUM(+)
          AND AL2.LOC_NUM = BILL.LOC_NUM(+)
          AND AL2.GLBL_CMPY_CD = SHIP.GLBL_CMPY_CD(+)
          AND AL2.RELN_DS_ACCT_NUM = SHIP.SELL_TO_CUST_CD(+)
          AND SHIP.RGTN_STS_CD(+) = #rgtnStsCd#
          AND SHIP.EZCANCELFLAG(+) = '0'
          AND AL2.GLBL_CMPY_CD = BILL.GLBL_CMPY_CD(+)
          AND AL2.RELN_DS_ACCT_NUM = BILL.SELL_TO_CUST_CD(+)
          AND BILL.RGTN_STS_CD(+) = #rgtnStsCd#
          AND BILL.EZCANCELFLAG(+) = '0'
        ORDER BY AL2.DS_ACCT_NUM
                ,AL2.RELN_DS_ACCT_NUM
    )
    WHERE 1 = 1
        <isNotNull property="defBillToList">
            AND (
        </isNotNull>
        <isNull property="defBillToList">
            <isNotNull property="defShipToList">
                AND (
            </isNotNull>
        </isNull>

        <isNotNull property="defBillToList">
            <iterate property="defBillToList" var="defBillTo[]" open=" R_BILL_TO_CUST_CD IN (" close=")" conjunction=",">
                #defBillTo[]#
            </iterate>
        </isNotNull>
        <isNotNull property="defShipToList">
            <isNotNull property="defBillToList">
                OR
            </isNotNull>
            <iterate property="defShipToList" var="defShipTo[]" open=" R_SHIP_TO_CUST_CD IN (" close=")" conjunction=",">
                #defShipTo[]#
            </iterate>
        </isNotNull>

        <isNotNull property="defBillToList">
            )
        </isNotNull>
        <isNull property="defBillToList">
            <isNotNull property="defShipToList">
                )
            </isNotNull>
        </isNull>
    </statement>
    <!-- END 2019/08/07 Hd.Sugawara [QC#52385,ADD] -->

<!-- 2019/12/13 QC#54882 Add Start -->
    <statement id="countOpenTransaction" parameterClass="Map" resultClass="BigDecimal">
    <!-- 2021/07/19 QC#58743-2 Mod Start -->
    <!-- WITH CUST_INFO AS ( -->
    WITH CUST_INFO_SELF AS (
        SELECT SL.GLBL_CMPY_CD
             , SL.SELL_TO_CUST_CD
             , BL.BILL_TO_CUST_CD
             , SP.SHIP_TO_CUST_CD
         FROM SELL_TO_CUST SL
            , ACCT_LOC     AL
            , PTY_LOC_WRK  PLW
            , BILL_TO_CUST BL
            , (SELECT SH.GLBL_CMPY_CD, SH.SHIP_TO_CUST_CD, SH.LOC_NUM
                 FROM SHIP_TO_CUST SH
                WHERE SH.GLBL_CMPY_CD = #glblCmpyCd#
                  AND SH.EZCANCELFLAG = '0'
                  AND SH.RGTN_STS_CD = #rgtnStsCd#
                  AND SH.LOC_ROLE_TP_CD = #locRoleTpShip#
              ) SP
        WHERE SL.GLBL_CMPY_CD = #glblCmpyCd#
          AND SL.EZCANCELFLAG = '0'
          AND SL.RGTN_STS_CD = #rgtnStsCd#
          AND SL.SELL_TO_CUST_CD = #acctNum#
          AND SL.GLBL_CMPY_CD = AL.GLBL_CMPY_CD
          AND SL.SELL_TO_CUST_CD = AL.DS_ACCT_NUM
          AND AL.EZCANCELFLAG = '0'
          AND AL.RGTN_STS_CD = #rgtnStsCd#
          AND AL.GLBL_CMPY_CD = PLW.GLBL_CMPY_CD
          AND AL.LOC_NUM = PLW.LOC_NUM
          AND PLW.EZCANCELFLAG = '0'
          AND PLW.RGTN_STS_CD = #rgtnStsCd#
          AND PLW.GLBL_CMPY_CD = BL.GLBL_CMPY_CD(+)
          AND PLW.LOC_NUM = BL.LOC_NUM(+)
          AND BL.EZCANCELFLAG(+) = '0'
          AND BL.RGTN_STS_CD(+) = #rgtnStsCd#
          AND PLW.GLBL_CMPY_CD = SP.GLBL_CMPY_CD(+)
          AND PLW.LOC_NUM = SP.LOC_NUM(+)
    )
    , RELN_ACCT AS (
        SELECT RELN.GLBL_CMPY_CD
             , RELN.RELN_DS_ACCT_NUM
             , CIS.BILL_TO_CUST_CD
             , CIS.SHIP_TO_CUST_CD
         FROM DS_ACCT_RELN RELN
            , SELL_TO_CUST ACCT
            , DS_ACCT_RELN_TP DART
            , CUST_INFO_SELF CIS
        WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
          AND RELN.EZCANCELFLAG = '0'
          AND RELN.GLBL_CMPY_CD = CIS.GLBL_CMPY_CD
          AND RELN.DS_ACCT_NUM = CIS.SELL_TO_CUST_CD
          AND RELN.RGTN_STS_CD = #rgtnStsCd#
          AND RELN.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
          AND RELN.RELN_DS_ACCT_NUM = ACCT.SELL_TO_CUST_CD
          AND ACCT.EZCANCELFLAG = '0'
          AND RELN.GLBL_CMPY_CD = DART.GLBL_CMPY_CD
          AND RELN.DS_ACCT_RELN_TP_CD = DART.DS_ACCT_RELN_TP_CD
          AND DART.EZCANCELFLAG = '0'
        UNION ALL
        SELECT RELN.GLBL_CMPY_CD
             , RELN.RELN_DS_ACCT_NUM
             , CIS.BILL_TO_CUST_CD
             , CIS.SHIP_TO_CUST_CD
         FROM DS_ACCT_RELN RELN
            , DS_ACCT_PROS PROS
            , DS_ACCT_RELN_TP DART
            , CUST_INFO_SELF CIS
        WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
          AND RELN.EZCANCELFLAG = '0'
          AND RELN.GLBL_CMPY_CD = CIS.GLBL_CMPY_CD
          AND RELN.DS_ACCT_NUM = CIS.SELL_TO_CUST_CD
          AND RELN.RGTN_STS_CD = #rgtnStsCd#
          AND RELN.GLBL_CMPY_CD = PROS.GLBL_CMPY_CD
          AND RELN.RELN_DS_ACCT_NUM = PROS.DS_ACCT_NUM
          AND PROS.EZCANCELFLAG = '0'
          AND RELN.GLBL_CMPY_CD = DART.GLBL_CMPY_CD
          AND RELN.DS_ACCT_RELN_TP_CD = DART.DS_ACCT_RELN_TP_CD
          AND DART.EZCANCELFLAG = '0'
    )
    , CUST_INFO AS (
        SELECT *
         FROM CUST_INFO_SELF
        UNION ALL
        SELECT *
         FROM RELN_ACCT
    )
    <!-- 2021/07/19 QC#58743-2 Mod End -->
    SELECT 1
      FROM DUAL
    WHERE EXISTS (
        SELECT 1
          FROM CPO C
             , CUST_INFO CI
         WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
           AND C.EZCANCELFLAG = '0'
           AND C.OPEN_FLG = #flgY#
           AND C.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND C.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND C.BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM CPO C
             , CUST_INFO CI
         WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
           AND C.EZCANCELFLAG = '0'
           AND C.OPEN_FLG = #flgY#
           AND C.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND C.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND C.ADD_SHIP_TO_CUST_CD = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM CPO C
             , CUST_INFO CI
         WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
           AND C.EZCANCELFLAG = '0'
           AND C.OPEN_FLG = #flgY#
           AND C.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND C.SOLD_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
           AND C.SELL_TO_CUST_CD = CI.SELL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM CPO C
             , DS_CPO_CONFIG DCC
             , CPO_DTL       CD
             , CUST_INFO CI
         WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
           AND C.EZCANCELFLAG = '0'
           AND C.OPEN_FLG = #flgY#
           AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
           AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
           AND DCC.EZCANCELFLAG = '0'
           AND DCC.GLBL_CMPY_CD = CD.GLBL_CMPY_CD
           AND DCC.CPO_ORD_NUM = CD.CPO_ORD_NUM
           AND DCC.DS_CPO_CONFIG_PK = CD.DS_CPO_CONFIG_PK
           AND CD.EZCANCELFLAG = '0'
           AND CD.OPEN_FLG = #flgY#
           AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCC.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND DCC.BILL_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM CPO C
             , DS_CPO_CONFIG DCC
             , CPO_DTL       CD
             , CUST_INFO CI
         WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
           AND C.EZCANCELFLAG = '0'
           AND C.OPEN_FLG = #flgY#
           AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
           AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
           AND DCC.EZCANCELFLAG = '0'
           AND DCC.GLBL_CMPY_CD = CD.GLBL_CMPY_CD
           AND DCC.CPO_ORD_NUM = CD.CPO_ORD_NUM
           AND DCC.DS_CPO_CONFIG_PK = CD.DS_CPO_CONFIG_PK
           AND CD.EZCANCELFLAG = '0'
           AND CD.OPEN_FLG = #flgY#
           AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCC.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND DCC.SHIP_TO_CUST_LOC_CD = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM CPO C
             , DS_CPO_CONFIG   DCC
             , DS_CPO_RTRN_DTL DCRD
             , CUST_INFO CI
         WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
           AND C.EZCANCELFLAG = '0'
           AND C.OPEN_FLG = #flgY#
           AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
           AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
           AND DCC.EZCANCELFLAG = '0'
           AND DCC.DS_CPO_CONFIG_PK = DCRD.DS_CPO_CONFIG_PK
           AND DCC.GLBL_CMPY_CD = DCRD.GLBL_CMPY_CD
           AND DCC.CPO_ORD_NUM = DCRD.CPO_ORD_NUM
           AND DCRD.EZCANCELFLAG = '0'
           AND DCRD.OPEN_FLG = #flgY#
           AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCC.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND DCC.BILL_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM CPO C
             , DS_CPO_CONFIG   DCC
             , DS_CPO_RTRN_DTL DCRD
             , CUST_INFO CI
         WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
           AND C.EZCANCELFLAG = '0'
           AND C.OPEN_FLG = #flgY#
           AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
           AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
           AND DCC.EZCANCELFLAG = '0'
           AND DCC.GLBL_CMPY_CD = DCRD.GLBL_CMPY_CD
           AND DCC.CPO_ORD_NUM = DCRD.CPO_ORD_NUM
           AND DCC.DS_CPO_CONFIG_PK = DCRD.DS_CPO_CONFIG_PK
           AND DCRD.EZCANCELFLAG = '0'
           AND DCRD.OPEN_FLG = #flgY#
           AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCC.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND DCC.SHIP_TO_CUST_LOC_CD = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM SVC_MACH_MSTR SMM
             , CUST_INFO CI
         WHERE SMM.GLBL_CMPY_CD = #glblCmpyCd#
           AND SMM.EZCANCELFLAG = '0'
           AND SMM.SVC_MACH_TP_CD = #svcMachTpMachine#
           AND SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#, #svcMachStsDlrSvc#)
           AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND SMM.OWNR_ACCT_NUM = CI.SELL_TO_CUST_CD
           <!-- START 02/15/2023 A.Cullano [QC#61182, ADD] -->
           AND SMM.OWNR_ACCT_NUM = #acctNum#
           <!-- END 02/15/2023 A.Cullano [QC#61182, ADD] -->
           <!-- START 01/12/2023 A.Cullano [QC#60972, DEL] -->
           <!-- AND SMM.OWNR_LOC_NUM = CI.BILL_TO_CUST_CD -->
           <!-- END 01/12/2023 A.Cullano [QC#60972, DEL] -->
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM SVC_MACH_MSTR SMM
             , CUST_INFO CI
         WHERE SMM.GLBL_CMPY_CD = #glblCmpyCd#
           AND SMM.EZCANCELFLAG   = '0'
           AND SMM.SVC_MACH_TP_CD = #svcMachTpMachine#
           AND SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#, #svcMachStsDlrSvc#)
           AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND SMM.BILL_TO_ACCT_NUM = CI.SELL_TO_CUST_CD
           AND SMM.BILL_TO_LOC_NUM = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    <!-- 2020/01/07 QC#54882-1 Add Start -->
    OR EXISTS (
        SELECT 1
          FROM SVC_MACH_MSTR SMM
             , CUST_INFO CI
         WHERE SMM.GLBL_CMPY_CD = #glblCmpyCd#
           AND SMM.EZCANCELFLAG   = '0'
           AND SMM.SVC_MACH_TP_CD = #svcMachTpMachine#
           AND SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#, #svcMachStsDlrSvc#)
           AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND SMM.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD
           AND SMM.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    <!-- 2020/01/07 QC#54882-1 Add End -->
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR       DCR
             , DS_CONTR_STS_V DCSV 
             , DS_CONTR_DTL   DCD
             , DS_CONTR_BLLG_SCHD DCBS
             , CUST_INFO CI
         WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCR.EZCANCELFLAG  = '0'
           AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND DCR.ALT_PAYER_CUST_CD = CI.BILL_TO_CUST_CD
           AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgY#
           AND DCSV.DS_CONTR_CTRL_STS_CD  NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
           AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCD.DS_CONTR_PK
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG  = #flgN#
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR_DTL   DCD
             , DS_CONTR_STS_V DCSV
             , DS_CONTR_BLLG_SCHD DCBS
             , (
                 <!-- 2020/10/09 QC#57751 Add Start -->
                 SELECT * FROM LATERAL(
                 <!-- 2020/10/09 QC#57751 Add End -->
                    <!-- 2020/10/09 QC#57751 Edit Start -->
                    SELECT HH.GLBL_CMPY_CD
                         , HH.SVC_MACH_MSTR_PK
                         , HH.CUR_LOC_ACCT_NUM
                         , HH.CUR_LOC_NUM
                    <!-- 2020/10/09 QC#57751 Edit End -->
                         <!-- 2020/10/09 QC#57751 Add Start -->
                         , ROW_NUMBER() OVER (
                             PARTITION BY HH.SVC_MACH_MSTR_PK
                             ORDER BY HH.SVC_MACH_MSTR_PK
                                    , HH.HIST_CRAT_TS DESC
                         ) RANK_NUM
                         <!-- 2020/10/09 QC#57751 End Start -->
                    FROM SVC_MACH_MSTR_HIST H
                       <!-- 2020/10/09 QC#57751 Add Start -->
                       , CUST_INFO CI
                       , SVC_MACH_MSTR_HIST HH
                       <!-- 2020/10/09 QC#57751 Add End -->
                    WHERE H.GLBL_CMPY_CD = #glblCmpyCd#
                      AND H.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#)
                      AND H.EZCANCELFLAG = '0'
                 <!-- 2020/10/09 QC#57751 Add Start -->
                      AND H.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD
                      AND H.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
                      AND H.GLBL_CMPY_CD = HH.GLBL_CMPY_CD
                      AND H.SVC_MACH_MSTR_PK = HH.SVC_MACH_MSTR_PK
                      AND HH.EZCANCELFLAG = '0'
                 ) LH
                 WHERE LH.RANK_NUM= 1
                 <!-- 2020/10/09 QC#57751 Add End -->
             ) SMM
             , CUST_INFO CI
         WHERE DCD.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCD.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgY#
           AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG = #flgN#
           AND DCD.GLBL_CMPY_CD = SMM.GLBL_CMPY_CD
           AND DCD.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
           AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND SMM.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND SMM.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR       DCR
             , DS_CONTR_STS_V DCSV
             , DS_CONTR_DTL   DCD
             , DS_CONTR_BLLG_SCHD DCBS
             , CUST_INFO CI
         WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCR.EZCANCELFLAG  = '0'
           AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgY#
           AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
           AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG  = #flgN#
           AND DCD.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCD.BASE_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    <!-- 2021/05/20 QC#58743 Add Start -->
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR       DCR
             , DS_CONTR_STS_V DCSV
             , DS_CONTR_DTL   DCD
             , DS_CONTR_BLLG_SCHD DCBS
             , DS_CONTR_BLLG_MTR DCBM
             , CUST_INFO CI
         WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCR.EZCANCELFLAG  = '0'
           AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgY#
           AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
           AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG  = #flgN#
           AND DCD.GLBL_CMPY_CD = DCBM.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBM.DS_CONTR_DTL_PK
           AND DCBM.EZCANCELFLAG = '0'
           AND DCBM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCBM.BLLG_MTR_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR       DCR
             , DS_CONTR_STS_V DCSV 
             , DS_CONTR_DTL   DCD
             , DS_CONTR_BLLG_SCHD DCBS
             , CUST_INFO CI
         WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCR.EZCANCELFLAG  = '0'
           AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND DCR.ALT_PAYER_CUST_CD = CI.BILL_TO_CUST_CD
           AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgN#
           AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
           AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCD.DS_CONTR_PK
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG  = #flgN#
           <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
           <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR_DTL   DCD
             , DS_CONTR_STS_V DCSV
             , DS_CONTR_BLLG_SCHD DCBS
             , (
                 SELECT * FROM LATERAL(
                    SELECT HH.GLBL_CMPY_CD
                         , HH.SVC_MACH_MSTR_PK
                         , HH.CUR_LOC_ACCT_NUM
                         , HH.CUR_LOC_NUM
                         , ROW_NUMBER() OVER (
                             PARTITION BY HH.SVC_MACH_MSTR_PK
                             ORDER BY HH.SVC_MACH_MSTR_PK
                                    , HH.HIST_CRAT_TS DESC
                         ) RANK_NUM
                    FROM SVC_MACH_MSTR_HIST H
                       , CUST_INFO CI
                       , SVC_MACH_MSTR_HIST HH
                    WHERE H.GLBL_CMPY_CD = #glblCmpyCd#
                      AND H.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#)
                      AND H.EZCANCELFLAG = '0'
                      AND H.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD
                      AND H.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
                      AND H.GLBL_CMPY_CD = HH.GLBL_CMPY_CD
                      AND H.SVC_MACH_MSTR_PK = HH.SVC_MACH_MSTR_PK
                      AND HH.EZCANCELFLAG = '0'
                 ) LH
                 WHERE LH.RANK_NUM= 1
             ) SMM
             , CUST_INFO CI
         WHERE DCD.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCD.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgN#
           AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG = #flgN#
           <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
           <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND DCD.GLBL_CMPY_CD = SMM.GLBL_CMPY_CD
           AND DCD.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
           AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND SMM.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND SMM.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR       DCR
             , DS_CONTR_STS_V DCSV
             , DS_CONTR_DTL   DCD
             , DS_CONTR_BLLG_SCHD DCBS
             , CUST_INFO CI
         WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCR.EZCANCELFLAG  = '0'
           AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgN#
           AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
           AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG  = #flgN#
           <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
           <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND DCD.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCD.BASE_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM DS_CONTR       DCR
             , DS_CONTR_STS_V DCSV
             , DS_CONTR_DTL   DCD
             , DS_CONTR_BLLG_SCHD DCBS
             , DS_CONTR_BLLG_MTR DCBM
             , CUST_INFO CI
         WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
           AND DCR.EZCANCELFLAG  = '0'
           AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
           AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
           AND DCSV.EZCANCELFLAG = '0'
           AND DCSV.ETTL_AVAL_FLG = #flgN#
           AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
           AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
           AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
           AND DCD.EZCANCELFLAG = '0'
           AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
           AND DCBS.EZCANCELFLAG = '0'
           AND DCBS.INV_FLG  = #flgN#
           <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
           <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
           AND DCD.GLBL_CMPY_CD = DCBM.GLBL_CMPY_CD
           AND DCD.DS_CONTR_DTL_PK = DCBM.DS_CONTR_DTL_PK
           AND DCBM.EZCANCELFLAG = '0'
           AND DCBM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND DCBM.BLLG_MTR_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    <!-- 2021/05/20 QC#58743 Add End -->
    OR EXISTS (
        SELECT 1
          FROM SVC_TASK ST
             , FSR      F
             , CUST_INFO CI
         WHERE ST.GLBL_CMPY_CD = #glblCmpyCd#
           AND ST.EZCANCELFLAG = '0'
           AND ST.SVC_TASK_STS_CD NOT IN (#svcTaskStsClosed#, #svcTaskStsCancelled#)
           AND ST.GLBL_CMPY_CD = F.GLBL_CMPY_CD
           AND ST.FSR_NUM = F.FSR_NUM
           AND F.EZCANCELFLAG  = '0'
           AND F.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND F.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD 
           AND F.BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM SVC_TASK ST
             , FSR      F
             , CUST_INFO CI
         WHERE ST.GLBL_CMPY_CD = #glblCmpyCd#
           AND ST.EZCANCELFLAG    = '0'
           AND ST.SVC_TASK_STS_CD NOT IN (#svcTaskStsClosed#, #svcTaskStsCancelled#)
           AND ST.GLBL_CMPY_CD = F.GLBL_CMPY_CD
           AND ST.FSR_NUM = F.FSR_NUM
           AND F.EZCANCELFLAG  = '0'
           AND F.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND F.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD 
           AND F.SHIP_TO_CUST_CD = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM SCHD_AGMT SA
             , CUST_INFO CI
         WHERE SA.GLBL_CMPY_CD = #glblCmpyCd#
           AND SA.EZCANCELFLAG = '0'
           AND SA.SCHD_AGMT_VLD_FROM_DT &lt;= #salesDate#
           AND NVL(SA.SCHD_AGMT_VLD_THRU_DT, #maxThruDt#) &gt;= #salesDate#
           AND EXISTS (SELECT 1
                         FROM SCHD_AGMT_PLN SAP
                        WHERE SAP.GLBL_CMPY_CD = SA.GLBL_CMPY_CD
                          AND SAP.SCHD_AGMT_NUM = SA.SCHD_AGMT_NUM
                          AND SAP.SCHD_AGMT_PLN_CANC_FLG = #flgN#
                          AND SAP.ORD_CRAT_TS IS NULL
                      )
           AND SA.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND SA.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND SA.BILL_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    ) 
    OR EXISTS (
        SELECT 1
          FROM SCHD_AGMT SA
             , CUST_INFO CI
         WHERE SA.GLBL_CMPY_CD = #glblCmpyCd#
           AND SA.EZCANCELFLAG = '0'
           AND SA.SCHD_AGMT_VLD_FROM_DT &lt;= #salesDate#
           AND NVL(SA.SCHD_AGMT_VLD_THRU_DT, #maxThruDt#) &gt;= #salesDate#
           AND EXISTS (SELECT 1
                         FROM SCHD_AGMT_PLN SAP
                        WHERE SAP.GLBL_CMPY_CD = SA.GLBL_CMPY_CD
                          AND SAP.SCHD_AGMT_NUM = SA.SCHD_AGMT_NUM
                          AND SAP.SCHD_AGMT_PLN_CANC_FLG = #flgN#
                          AND SAP.ORD_CRAT_TS IS NULL
                      )
           AND SA.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND SA.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
           AND SA.SHIP_TO_CUST_LOC_CD = CI.SHIP_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    OR EXISTS (
        SELECT 1
          FROM SCHD_AGMT SA
             , CUST_INFO CI
         WHERE SA.GLBL_CMPY_CD = #glblCmpyCd#
           AND SA.EZCANCELFLAG = '0'
           AND SA.SCHD_AGMT_VLD_FROM_DT &lt;= #salesDate#
           AND NVL(SA.SCHD_AGMT_VLD_THRU_DT, #maxThruDt#) &gt;= #salesDate#
           AND EXISTS (SELECT 1
                         FROM SCHD_AGMT_PLN SAP
                        WHERE SAP.GLBL_CMPY_CD = SA.GLBL_CMPY_CD
                          AND SAP.SCHD_AGMT_NUM = SA.SCHD_AGMT_NUM
                          AND SAP.SCHD_AGMT_PLN_CANC_FLG = #flgN#
                          AND SAP.ORD_CRAT_TS IS NULL
                      )
           AND SA.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
           AND SA.SELL_TO_CUST_CD = CI.SELL_TO_CUST_CD
           AND SA.SOLD_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
           AND ROWNUM = #rowNum#
    )
    </statement>
<!-- 2019/12/13 QC#54882 Add End -->
<!-- 2020/07/22 QC#57316 Add Start -->
    <statement id="getOpenTransaction" parameterClass="Map" resultClass="Map">
    <!-- 2021/07/19 QC#58743-2 Mod Start -->
    <!-- WITH CUST_INFO AS ( -->
    WITH CUST_INFO_SELF AS (
        SELECT SL.GLBL_CMPY_CD
             , SL.SELL_TO_CUST_CD
             , BL.BILL_TO_CUST_CD
             , SP.SHIP_TO_CUST_CD
         FROM SELL_TO_CUST SL
            , ACCT_LOC     AL
            , PTY_LOC_WRK  PLW
            , BILL_TO_CUST BL
            , (SELECT SH.GLBL_CMPY_CD, SH.SHIP_TO_CUST_CD, SH.LOC_NUM
                 FROM SHIP_TO_CUST SH
                WHERE SH.GLBL_CMPY_CD = #glblCmpyCd#
                  AND SH.EZCANCELFLAG = '0'
                  AND SH.RGTN_STS_CD = #rgtnStsCd#
                  AND SH.LOC_ROLE_TP_CD = #locRoleTpShip#
              ) SP
        WHERE SL.GLBL_CMPY_CD = #glblCmpyCd#
          AND SL.EZCANCELFLAG = '0'
          AND SL.RGTN_STS_CD = #rgtnStsCd#
          AND SL.SELL_TO_CUST_CD = #acctNum#
          AND SL.GLBL_CMPY_CD = AL.GLBL_CMPY_CD
          AND SL.SELL_TO_CUST_CD = AL.DS_ACCT_NUM
          AND AL.EZCANCELFLAG = '0'
          AND AL.RGTN_STS_CD = #rgtnStsCd#
          AND AL.GLBL_CMPY_CD = PLW.GLBL_CMPY_CD
          AND AL.LOC_NUM = PLW.LOC_NUM
          AND PLW.EZCANCELFLAG = '0'
          AND PLW.RGTN_STS_CD = #rgtnStsCd#
          AND PLW.GLBL_CMPY_CD = BL.GLBL_CMPY_CD(+)
          AND PLW.LOC_NUM = BL.LOC_NUM(+)
          AND BL.EZCANCELFLAG(+) = '0'
          AND BL.RGTN_STS_CD(+) = #rgtnStsCd#
          AND PLW.GLBL_CMPY_CD = SP.GLBL_CMPY_CD(+)
          AND PLW.LOC_NUM = SP.LOC_NUM(+)
    )
    , RELN_ACCT AS (
        SELECT RELN.GLBL_CMPY_CD
             , RELN.RELN_DS_ACCT_NUM
             , CIS.BILL_TO_CUST_CD
             , CIS.SHIP_TO_CUST_CD
         FROM DS_ACCT_RELN RELN
            , SELL_TO_CUST ACCT
            , DS_ACCT_RELN_TP DART
            , CUST_INFO_SELF CIS
        WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
          AND RELN.EZCANCELFLAG = '0'
          AND RELN.GLBL_CMPY_CD = CIS.GLBL_CMPY_CD
          AND RELN.DS_ACCT_NUM = CIS.SELL_TO_CUST_CD
          AND RELN.RGTN_STS_CD = #rgtnStsCd#
          AND RELN.GLBL_CMPY_CD = ACCT.GLBL_CMPY_CD
          AND RELN.RELN_DS_ACCT_NUM = ACCT.SELL_TO_CUST_CD
          AND ACCT.EZCANCELFLAG = '0'
          AND RELN.GLBL_CMPY_CD = DART.GLBL_CMPY_CD
          AND RELN.DS_ACCT_RELN_TP_CD = DART.DS_ACCT_RELN_TP_CD
          AND DART.EZCANCELFLAG = '0'
        UNION ALL
        SELECT RELN.GLBL_CMPY_CD
             , RELN.RELN_DS_ACCT_NUM
             , CIS.BILL_TO_CUST_CD
             , CIS.SHIP_TO_CUST_CD
         FROM DS_ACCT_RELN RELN
            , DS_ACCT_PROS PROS
            , DS_ACCT_RELN_TP DART
            , CUST_INFO_SELF CIS
        WHERE RELN.GLBL_CMPY_CD = #glblCmpyCd#
          AND RELN.EZCANCELFLAG = '0'
          AND RELN.GLBL_CMPY_CD = CIS.GLBL_CMPY_CD
          AND RELN.DS_ACCT_NUM = CIS.SELL_TO_CUST_CD
          AND RELN.RGTN_STS_CD = #rgtnStsCd#
          AND RELN.GLBL_CMPY_CD = PROS.GLBL_CMPY_CD
          AND RELN.RELN_DS_ACCT_NUM = PROS.DS_ACCT_NUM
          AND PROS.EZCANCELFLAG = '0'
          AND RELN.GLBL_CMPY_CD = DART.GLBL_CMPY_CD
          AND RELN.DS_ACCT_RELN_TP_CD = DART.DS_ACCT_RELN_TP_CD
          AND DART.EZCANCELFLAG = '0'
    )
    , CUST_INFO AS (
        SELECT *
         FROM CUST_INFO_SELF
        UNION ALL
        SELECT *
         FROM RELN_ACCT
    )
    <!-- 2021/07/19 QC#58743-2 Mod End -->
    SELECT
        MAIN.TRX_PAT
       ,MAIN.KEY_NAME
       ,MAIN.KEY_VAL
    FROM (
        SELECT DISTINCT
            MAIN.TRX_PAT
           ,MAIN.KEY_NAME
           ,MAIN.KEY_VAL
           ,MAIN.SORT_NUM
        FROM (
            SELECT
                'CPO-BILL'         AS TRX_PAT
               ,'CPO Order Number' AS KEY_NAME
               ,C.CPO_ORD_NUM      AS KEY_VAL
               ,1                  AS SORT_NUM
            FROM
                CPO C
                ,CUST_INFO CI
            WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
            AND C.EZCANCELFLAG = '0'
            AND C.OPEN_FLG = #flgY#
            AND C.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND C.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
            AND C.BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
            UNION ALL SELECT
                'CPO-SHIP'         AS TRX_PAT
               ,'CPO Order Number' AS KEY_NAME
               ,C.CPO_ORD_NUM      AS KEY_VAL
               ,2                  AS SORT_NUM
            FROM
                CPO C
               ,CUST_INFO CI
            WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
            AND C.EZCANCELFLAG = '0'
            AND C.OPEN_FLG = #flgY#
            AND C.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND C.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
            AND C.ADD_SHIP_TO_CUST_CD = CI.SHIP_TO_CUST_CD
            UNION ALL SELECT
                'CPO-SOLD'         AS TRX_PAT
               ,'CPO Order Number' AS KEY_NAME
               ,C.CPO_ORD_NUM      AS KEY_VAL
               ,3                  AS SORT_NUM
            FROM
                CPO C
               ,CUST_INFO CI
            WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
            AND C.EZCANCELFLAG = '0'
            AND C.OPEN_FLG = #flgY#
            AND C.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND C.SOLD_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
            AND C.SELL_TO_CUST_CD = CI.SELL_TO_CUST_CD
            UNION ALL SELECT
                'CONFIG-Out-BILL'  AS TRX_PAT
               ,'CPO Order Number' AS KEY_NAME
               ,C.CPO_ORD_NUM      AS KEY_VAL
               ,4                  AS SORT_NUM
            FROM
                CPO C
               ,DS_CPO_CONFIG DCC
               ,CPO_DTL       CD
               ,CUST_INFO CI
            WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
            AND C.EZCANCELFLAG = '0'
            AND C.OPEN_FLG = #flgY#
            AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
            AND DCC.EZCANCELFLAG = '0'
            AND DCC.GLBL_CMPY_CD = CD.GLBL_CMPY_CD
            AND DCC.CPO_ORD_NUM = CD.CPO_ORD_NUM
            AND DCC.DS_CPO_CONFIG_PK = CD.DS_CPO_CONFIG_PK
            AND CD.EZCANCELFLAG = '0'
            AND CD.OPEN_FLG = #flgY#
            AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND DCC.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
            AND DCC.BILL_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
            UNION ALL SELECT
                'CONFIG-Out-SHIP'  AS TRX_PAT
               ,'CPO Order Number' AS KEY_NAME
               ,C.CPO_ORD_NUM      AS KEY_VAL
               ,5                  AS SORT_NUM
            FROM
                CPO C
               ,DS_CPO_CONFIG DCC
               ,CPO_DTL       CD
               ,CUST_INFO CI
            WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
            AND C.EZCANCELFLAG = '0'
            AND C.OPEN_FLG = #flgY#
            AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
            AND DCC.EZCANCELFLAG = '0'
            AND DCC.GLBL_CMPY_CD = CD.GLBL_CMPY_CD
            AND DCC.CPO_ORD_NUM = CD.CPO_ORD_NUM
            AND DCC.DS_CPO_CONFIG_PK = CD.DS_CPO_CONFIG_PK
            AND CD.EZCANCELFLAG = '0'
            AND CD.OPEN_FLG = #flgY#
            AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND DCC.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
            AND DCC.SHIP_TO_CUST_LOC_CD = CI.SHIP_TO_CUST_CD
            UNION ALL SELECT
                'CONFIG-In-BILL'  AS TRX_PAT
               ,'CPO Order Number' AS KEY_NAME
               ,C.CPO_ORD_NUM      AS KEY_VAL
               ,6                  AS SORT_NUM
            FROM
                CPO C
               ,DS_CPO_CONFIG   DCC
               ,DS_CPO_RTRN_DTL DCRD
               ,CUST_INFO CI
            WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
            AND C.EZCANCELFLAG = '0'
            AND C.OPEN_FLG = #flgY#
            AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
            AND DCC.EZCANCELFLAG = '0'
            AND DCC.DS_CPO_CONFIG_PK = DCRD.DS_CPO_CONFIG_PK
            AND DCC.GLBL_CMPY_CD = DCRD.GLBL_CMPY_CD
            AND DCC.CPO_ORD_NUM = DCRD.CPO_ORD_NUM
            AND DCRD.EZCANCELFLAG = '0'
            AND DCRD.OPEN_FLG = #flgY#
            AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND DCC.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
            AND DCC.BILL_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
            UNION ALL SELECT
                'CONFIG-In-SHIP'  AS TRX_PAT
               ,'CPO Order Number' AS KEY_NAME
               ,C.CPO_ORD_NUM      AS KEY_VAL
               ,7                  AS SORT_NUM
            FROM
                CPO C
               ,DS_CPO_CONFIG   DCC
               ,DS_CPO_RTRN_DTL DCRD
               ,CUST_INFO CI
            WHERE C.GLBL_CMPY_CD = #glblCmpyCd#
            AND C.EZCANCELFLAG = '0'
            AND C.OPEN_FLG = #flgY#
            AND C.GLBL_CMPY_CD = DCC.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM = DCC.CPO_ORD_NUM
            AND DCC.EZCANCELFLAG = '0'
            AND DCC.GLBL_CMPY_CD = DCRD.GLBL_CMPY_CD
            AND DCC.CPO_ORD_NUM = DCRD.CPO_ORD_NUM
            AND DCC.DS_CPO_CONFIG_PK = DCRD.DS_CPO_CONFIG_PK
            AND DCRD.EZCANCELFLAG = '0'
            AND DCRD.OPEN_FLG = #flgY#
            AND DCC.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND DCC.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
            AND DCC.SHIP_TO_CUST_LOC_CD = CI.SHIP_TO_CUST_CD
            UNION ALL SELECT
                'Machine-Owner'  AS TRX_PAT
               ,'Install Base ID' AS KEY_NAME
               ,TO_CHAR(SMM.SVC_MACH_MSTR_PK) AS KEY_VAL
               ,8                  AS SORT_NUM
            FROM
                SVC_MACH_MSTR SMM
               ,CUST_INFO CI
            WHERE SMM.GLBL_CMPY_CD = #glblCmpyCd#
            AND SMM.EZCANCELFLAG = '0'
            AND SMM.SVC_MACH_TP_CD = #svcMachTpMachine#
            AND SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#, #svcMachStsDlrSvc#)
            AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND SMM.OWNR_ACCT_NUM = CI.SELL_TO_CUST_CD
            <!-- START 02/15/2023 A.Cullano [QC#61182, ADD] -->
            AND SMM.OWNR_ACCT_NUM = #acctNum#
            <!-- END 02/15/2023 A.Cullano [QC#61182, ADD] -->
            <!-- START 01/12/2023 A.Cullano [QC#60972, DEL] -->
            <!-- AND SMM.OWNR_LOC_NUM = CI.BILL_TO_CUST_CD -->
            <!-- END 01/12/2023 A.Cullano [QC#60972, DEL] -->
            UNION ALL SELECT
                'Machine-BILL'  AS TRX_PAT
               ,'Install Base ID' AS KEY_NAME
               ,TO_CHAR(SMM.SVC_MACH_MSTR_PK) AS KEY_VAL
               ,9                  AS SORT_NUM
            FROM
                SVC_MACH_MSTR SMM
               ,CUST_INFO CI
            WHERE SMM.GLBL_CMPY_CD = #glblCmpyCd#
            AND SMM.EZCANCELFLAG   = '0'
            AND SMM.SVC_MACH_TP_CD = #svcMachTpMachine#
            AND SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#, #svcMachStsDlrSvc#)
            AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND SMM.BILL_TO_ACCT_NUM = CI.SELL_TO_CUST_CD
            AND SMM.BILL_TO_LOC_NUM = CI.BILL_TO_CUST_CD
            UNION ALL SELECT
                'Machine-Current'  AS TRX_PAT
               ,'Install Base ID' AS KEY_NAME
               ,TO_CHAR(SMM.SVC_MACH_MSTR_PK) AS KEY_VAL
               ,10                  AS SORT_NUM
            FROM
                SVC_MACH_MSTR SMM
               ,CUST_INFO CI
            WHERE SMM.GLBL_CMPY_CD = #glblCmpyCd#
            AND SMM.EZCANCELFLAG   = '0'
            AND SMM.SVC_MACH_TP_CD = #svcMachTpMachine#
            AND SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#, #svcMachStsDlrSvc#)
            AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND SMM.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD
            AND SMM.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
            UNION ALL SELECT
                'Contract-BILL'  AS TRX_PAT
               ,'Contract Number' AS KEY_NAME
               ,DCR.DS_CONTR_NUM AS KEY_VAL
               ,11                  AS SORT_NUM
            FROM
                DS_CONTR       DCR
               ,DS_CONTR_STS_V DCSV 
               ,DS_CONTR_DTL   DCD
               ,DS_CONTR_BLLG_SCHD DCBS
               ,CUST_INFO CI
            WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
            AND DCR.EZCANCELFLAG  = '0'
            AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
            AND DCR.ALT_PAYER_CUST_CD = CI.BILL_TO_CUST_CD
            AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
            AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
            AND DCSV.EZCANCELFLAG = '0'
            AND DCSV.ETTL_AVAL_FLG = #flgY#
            AND DCSV.DS_CONTR_CTRL_STS_CD  NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
            AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
            AND DCR.DS_CONTR_PK  = DCD.DS_CONTR_PK
            AND DCD.EZCANCELFLAG = '0'
            AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
            AND DCBS.EZCANCELFLAG = '0'
            AND DCBS.INV_FLG  = #flgN#
            UNION ALL SELECT
                'Contract-Detail-Install-SHIP'  AS TRX_PAT
               ,'Contract Number' AS KEY_NAME
               ,DCR.DS_CONTR_NUM AS KEY_VAL
               ,12                  AS SORT_NUM
            FROM
                DS_CONTR_DTL   DCD
               ,DS_CONTR       DCR
               ,DS_CONTR_STS_V DCSV
               ,DS_CONTR_BLLG_SCHD DCBS
               ,(
                     <!-- 2020/10/09 QC#57751 Add Start -->
                     SELECT * FROM LATERAL(
                     <!-- 2020/10/09 QC#57751 Add End -->
                        <!-- 2020/10/09 QC#57751 Edit Start -->
                        SELECT HH.GLBL_CMPY_CD
                             , HH.SVC_MACH_MSTR_PK
                             , HH.CUR_LOC_ACCT_NUM
                             , HH.CUR_LOC_NUM
                        <!-- 2020/10/09 QC#57751 Edit End -->
                             <!-- 2020/10/09 QC#57751 Add Start -->
                             , ROW_NUMBER() OVER (
                                 PARTITION BY HH.SVC_MACH_MSTR_PK
                                 ORDER BY HH.SVC_MACH_MSTR_PK
                                        , HH.HIST_CRAT_TS DESC
                             ) RANK_NUM
                             <!-- 2020/10/09 QC#57751 End Start -->
                        FROM SVC_MACH_MSTR_HIST H
                           <!-- 2020/10/09 QC#57751 Add Start -->
                           , CUST_INFO CI
                           , SVC_MACH_MSTR_HIST HH
                           <!-- 2020/10/09 QC#57751 Add End -->
                        WHERE H.GLBL_CMPY_CD = #glblCmpyCd#
                          AND H.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#)
                          AND H.EZCANCELFLAG = '0'
                     <!-- 2020/10/09 QC#57751 Add Start -->
                          AND H.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD
                          AND H.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
                          AND H.GLBL_CMPY_CD = HH.GLBL_CMPY_CD
                          AND H.SVC_MACH_MSTR_PK = HH.SVC_MACH_MSTR_PK
                          AND HH.EZCANCELFLAG = '0'
                     ) LH
                     WHERE LH.RANK_NUM= 1
                     <!-- 2020/10/09 QC#57751 Add End -->
                 ) SMM
                ,CUST_INFO CI
            WHERE DCD.GLBL_CMPY_CD = #glblCmpyCd#
            AND DCD.EZCANCELFLAG = '0'
            AND DCD.GLBL_CMPY_CD = DCR.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK  = DCR.DS_CONTR_PK
            AND DCR.EZCANCELFLAG = '0'
            AND DCD.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK  = DCSV.DS_CONTR_PK
            AND DCSV.EZCANCELFLAG = '0'
            AND DCSV.ETTL_AVAL_FLG = #flgY#
            AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
            AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
            AND DCBS.EZCANCELFLAG = '0'
            AND DCBS.INV_FLG = #flgN#
            AND DCD.GLBL_CMPY_CD = SMM.GLBL_CMPY_CD
            AND DCD.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
            AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND SMM.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD 
            AND SMM.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
            UNION ALL SELECT
                'Contract-Detail-BILL'  AS TRX_PAT
               ,'Contract Number' AS KEY_NAME
               ,DCR.DS_CONTR_NUM AS KEY_VAL
               ,13                  AS SORT_NUM
            FROM
                DS_CONTR       DCR
               ,DS_CONTR_STS_V DCSV
               ,DS_CONTR_DTL   DCD
               ,DS_CONTR_BLLG_SCHD DCBS
               ,CUST_INFO CI
            WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
            AND DCR.EZCANCELFLAG  = '0'
            AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
            AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
            AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
            AND DCSV.EZCANCELFLAG = '0'
            AND DCSV.ETTL_AVAL_FLG = #flgY#
            AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
            AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
            AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
            AND DCD.EZCANCELFLAG = '0'
            AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
            AND DCBS.EZCANCELFLAG = '0'
            AND DCBS.INV_FLG  = #flgN#
            AND DCD.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND DCD.BASE_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
            UNION ALL SELECT
                'SERVICE CALL-BILL'  AS TRX_PAT
               ,'Service Task Number' AS KEY_NAME
               ,ST.SVC_TASK_NUM AS KEY_VAL
               ,14                  AS SORT_NUM
            FROM
                SVC_TASK ST
               ,FSR      F
               ,CUST_INFO CI
            WHERE ST.GLBL_CMPY_CD = #glblCmpyCd#
            AND ST.EZCANCELFLAG = '0'
            AND ST.SVC_TASK_STS_CD NOT IN (#svcTaskStsClosed#, #svcTaskStsCancelled#)
            AND ST.GLBL_CMPY_CD = F.GLBL_CMPY_CD
            AND ST.FSR_NUM = F.FSR_NUM
            AND F.EZCANCELFLAG  = '0'
            AND F.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND F.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD 
            AND F.BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
            UNION ALL SELECT
                'SERVICE CALL-SHIP'  AS TRX_PAT
               ,'Service Task Number' AS KEY_NAME
               ,ST.SVC_TASK_NUM AS KEY_VAL
               ,15                  AS SORT_NUM
            FROM
                SVC_TASK ST
               ,FSR      F
               ,CUST_INFO CI
            WHERE ST.GLBL_CMPY_CD = #glblCmpyCd#
            AND ST.EZCANCELFLAG    = '0'
            AND ST.SVC_TASK_STS_CD NOT IN (#svcTaskStsClosed#, #svcTaskStsCancelled#)
            AND ST.GLBL_CMPY_CD = F.GLBL_CMPY_CD
            AND ST.FSR_NUM = F.FSR_NUM
            AND F.EZCANCELFLAG  = '0'
            AND F.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND F.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD 
            AND F.SHIP_TO_CUST_CD = CI.SHIP_TO_CUST_CD
            UNION ALL SELECT
                'SCHEDULE AGREEMENT-BILL'  AS TRX_PAT
               ,'Schedule Aggrement Number' AS KEY_NAME
               ,SA.SCHD_AGMT_NUM AS KEY_VAL
               ,16                  AS SORT_NUM
            FROM
                SCHD_AGMT SA
               ,CUST_INFO CI
            WHERE SA.GLBL_CMPY_CD = #glblCmpyCd#
            AND SA.EZCANCELFLAG = '0'
            AND SA.SCHD_AGMT_VLD_FROM_DT &lt;= #salesDate#
            AND NVL(SA.SCHD_AGMT_VLD_THRU_DT, #maxThruDt#) &gt;= #salesDate#
            AND EXISTS (
                SELECT
                    1
                FROM
                    SCHD_AGMT_PLN SAP
                WHERE SAP.GLBL_CMPY_CD = SA.GLBL_CMPY_CD
                AND SAP.SCHD_AGMT_NUM = SA.SCHD_AGMT_NUM
                AND SAP.SCHD_AGMT_PLN_CANC_FLG = #flgN#
                AND SAP.ORD_CRAT_TS IS NULL
            )
            AND SA.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND SA.BILL_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
            AND SA.BILL_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
            UNION ALL SELECT
                'SCHEDULE AGREEMENT-SHIP'  AS TRX_PAT
               ,'Schedule Aggrement Number' AS KEY_NAME
               ,SA.SCHD_AGMT_NUM AS KEY_VAL
               ,17                  AS SORT_NUM
            FROM
                SCHD_AGMT SA
               ,CUST_INFO CI
            WHERE SA.GLBL_CMPY_CD = #glblCmpyCd#
            AND SA.EZCANCELFLAG = '0'
            AND SA.SCHD_AGMT_VLD_FROM_DT &lt;= #salesDate#
            AND NVL(SA.SCHD_AGMT_VLD_THRU_DT, #maxThruDt#) &gt;= #salesDate#
            AND EXISTS (
                SELECT
                    1
                FROM
                    SCHD_AGMT_PLN SAP
                WHERE SAP.GLBL_CMPY_CD = SA.GLBL_CMPY_CD
                AND SAP.SCHD_AGMT_NUM = SA.SCHD_AGMT_NUM
                AND SAP.SCHD_AGMT_PLN_CANC_FLG = #flgN#
                AND SAP.ORD_CRAT_TS IS NULL
            )
            AND SA.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND SA.SHIP_TO_CUST_ACCT_CD = CI.SELL_TO_CUST_CD
            AND SA.SHIP_TO_CUST_LOC_CD = CI.SHIP_TO_CUST_CD
            UNION ALL SELECT
                'SCHEDULE AGREEMENT-SOLD'  AS TRX_PAT
               ,'Schedule Aggrement Number' AS KEY_NAME
               ,SA.SCHD_AGMT_NUM AS KEY_VAL
               ,18                  AS SORT_NUM
            FROM
                SCHD_AGMT SA
               ,CUST_INFO CI
            WHERE SA.GLBL_CMPY_CD = #glblCmpyCd#
            AND SA.EZCANCELFLAG = '0'
            AND SA.SCHD_AGMT_VLD_FROM_DT &lt;= #salesDate#
            AND NVL(SA.SCHD_AGMT_VLD_THRU_DT, #maxThruDt#) &gt;= #salesDate#
            AND EXISTS (
                SELECT
                    1
                FROM
                    SCHD_AGMT_PLN SAP
                WHERE SAP.GLBL_CMPY_CD = SA.GLBL_CMPY_CD
                AND SAP.SCHD_AGMT_NUM = SA.SCHD_AGMT_NUM
                AND SAP.SCHD_AGMT_PLN_CANC_FLG = #flgN#
                AND SAP.ORD_CRAT_TS IS NULL
            )
            AND SA.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND SA.SELL_TO_CUST_CD = CI.SELL_TO_CUST_CD
            AND SA.SOLD_TO_CUST_LOC_CD = CI.BILL_TO_CUST_CD
            <!-- 2021/05/20 QC#58743 Add Start -->
            UNION ALL SELECT
                'Contract-Detail-Overage-BILL'  AS TRX_PAT
               ,'Contract Number' AS KEY_NAME
               ,DCR.DS_CONTR_NUM AS KEY_VAL
               ,19                  AS SORT_NUM
            FROM
                DS_CONTR       DCR
               ,DS_CONTR_STS_V DCSV
               ,DS_CONTR_DTL   DCD
               ,DS_CONTR_BLLG_SCHD DCBS
               ,DS_CONTR_BLLG_MTR DCBM
               ,CUST_INFO CI
            WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
            AND DCR.EZCANCELFLAG  = '0'
            AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
            AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
            AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
            AND DCSV.EZCANCELFLAG = '0'
            AND DCSV.ETTL_AVAL_FLG = #flgY#
            AND DCSV.DS_CONTR_CTRL_STS_CD NOT IN (#dsContrCtrlStsCancelled#, #dsContrCtrlStsDraft#)
            AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
            AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
            AND DCD.EZCANCELFLAG = '0'
            AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
            AND DCBS.EZCANCELFLAG = '0'
            AND DCBS.INV_FLG  = #flgN#
            AND DCD.GLBL_CMPY_CD = DCBM.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK = DCBM.DS_CONTR_DTL_PK
            AND DCBM.EZCANCELFLAG = '0'
            AND DCBM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND DCBM.BLLG_MTR_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
            UNION ALL SELECT
                'Contract-BILL-Terminate Credit'  AS TRX_PAT
               ,'Contract Number' AS KEY_NAME
               ,DCR.DS_CONTR_NUM AS KEY_VAL
               ,20                  AS SORT_NUM
            FROM
                DS_CONTR       DCR
               ,DS_CONTR_STS_V DCSV 
               ,DS_CONTR_DTL   DCD
               ,DS_CONTR_BLLG_SCHD DCBS
               ,CUST_INFO CI
            WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
            AND DCR.EZCANCELFLAG  = '0'
            AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
            AND DCR.ALT_PAYER_CUST_CD = CI.BILL_TO_CUST_CD
            AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
            AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
            AND DCSV.EZCANCELFLAG = '0'
            AND DCSV.ETTL_AVAL_FLG = #flgN#
            AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
            AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
            AND DCR.DS_CONTR_PK  = DCD.DS_CONTR_PK
            AND DCD.EZCANCELFLAG = '0'
            AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
            AND DCBS.EZCANCELFLAG = '0'
            AND DCBS.INV_FLG  = #flgN#
            <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
            AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
            <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
            UNION ALL SELECT
                'Contract-Detail-Install-SHIP-Terminate Credit'  AS TRX_PAT
               ,'Contract Number' AS KEY_NAME
               ,DCR.DS_CONTR_NUM AS KEY_VAL
               ,21                  AS SORT_NUM
            FROM
                DS_CONTR_DTL   DCD
               ,DS_CONTR       DCR
               ,DS_CONTR_STS_V DCSV
               ,DS_CONTR_BLLG_SCHD DCBS
               ,(
                     SELECT * FROM LATERAL(
                        SELECT HH.GLBL_CMPY_CD
                             , HH.SVC_MACH_MSTR_PK
                             , HH.CUR_LOC_ACCT_NUM
                             , HH.CUR_LOC_NUM
                             , ROW_NUMBER() OVER (
                                 PARTITION BY HH.SVC_MACH_MSTR_PK
                                 ORDER BY HH.SVC_MACH_MSTR_PK
                                        , HH.HIST_CRAT_TS DESC
                             ) RANK_NUM
                        FROM SVC_MACH_MSTR_HIST H
                           , CUST_INFO CI
                           , SVC_MACH_MSTR_HIST HH
                        WHERE H.GLBL_CMPY_CD = #glblCmpyCd#
                          AND H.SVC_MACH_MSTR_STS_CD IN (#svcMachStsW4I#, #svcMachStsInstl#, #svcMachStsW4R#)
                          AND H.EZCANCELFLAG = '0'
                          AND H.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD
                          AND H.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
                          AND H.GLBL_CMPY_CD = HH.GLBL_CMPY_CD
                          AND H.SVC_MACH_MSTR_PK = HH.SVC_MACH_MSTR_PK
                          AND HH.EZCANCELFLAG = '0'
                     ) LH
                     WHERE LH.RANK_NUM= 1
                 ) SMM
                ,CUST_INFO CI
            WHERE DCD.GLBL_CMPY_CD = #glblCmpyCd#
            AND DCD.EZCANCELFLAG = '0'
            AND DCD.GLBL_CMPY_CD = DCR.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK  = DCR.DS_CONTR_PK
            AND DCR.EZCANCELFLAG = '0'
            AND DCD.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK  = DCSV.DS_CONTR_PK
            AND DCSV.EZCANCELFLAG = '0'
            AND DCSV.ETTL_AVAL_FLG = #flgN#
            AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
            AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
            AND DCBS.EZCANCELFLAG = '0'
            AND DCBS.INV_FLG = #flgN#
            <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
            AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
            <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
            AND DCD.GLBL_CMPY_CD = SMM.GLBL_CMPY_CD
            AND DCD.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
            AND SMM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND SMM.CUR_LOC_ACCT_NUM = CI.SELL_TO_CUST_CD 
            AND SMM.CUR_LOC_NUM = CI.SHIP_TO_CUST_CD
            UNION ALL SELECT
                'Contract-Detail-BILL-Terminate Credit'  AS TRX_PAT
               ,'Contract Number' AS KEY_NAME
               ,DCR.DS_CONTR_NUM AS KEY_VAL
               ,22                  AS SORT_NUM
            FROM
                DS_CONTR       DCR
               ,DS_CONTR_STS_V DCSV
               ,DS_CONTR_DTL   DCD
               ,DS_CONTR_BLLG_SCHD DCBS
               ,CUST_INFO CI
            WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
            AND DCR.EZCANCELFLAG  = '0'
            AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
            AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
            AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
            AND DCSV.EZCANCELFLAG = '0'
            AND DCSV.ETTL_AVAL_FLG = #flgN#
            AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
            AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
            AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
            AND DCD.EZCANCELFLAG = '0'
            AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
            AND DCBS.EZCANCELFLAG = '0'
            AND DCBS.INV_FLG  = #flgN#
            <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
            AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
            <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
            AND DCD.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND DCD.BASE_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
            UNION ALL SELECT
                'Contract-Detail-Overage-BILL-Terminate Credit'  AS TRX_PAT
               ,'Contract Number' AS KEY_NAME
               ,DCR.DS_CONTR_NUM AS KEY_VAL
               ,23                  AS SORT_NUM
            FROM
                DS_CONTR       DCR
               ,DS_CONTR_STS_V DCSV
               ,DS_CONTR_DTL   DCD
               ,DS_CONTR_BLLG_SCHD DCBS
               ,DS_CONTR_BLLG_MTR DCBM
               ,CUST_INFO CI
            WHERE DCR.GLBL_CMPY_CD = #glblCmpyCd#
            AND DCR.EZCANCELFLAG  = '0'
            AND DCR.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND DCR.DS_ACCT_NUM = CI.SELL_TO_CUST_CD 
            AND DCR.GLBL_CMPY_CD = DCSV.GLBL_CMPY_CD
            AND DCR.DS_CONTR_PK  = DCSV.DS_CONTR_PK
            AND DCSV.EZCANCELFLAG = '0'
            AND DCSV.ETTL_AVAL_FLG = #flgN#
            AND DCSV.DS_CONTR_CTRL_STS_CD = #dsContrCtrlStsTerminated#
            AND DCR.GLBL_CMPY_CD = DCD.GLBL_CMPY_CD
            AND DCR.DS_CONTR_PK = DCD.DS_CONTR_PK
            AND DCD.EZCANCELFLAG = '0'
            AND DCD.GLBL_CMPY_CD = DCBS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK = DCBS.DS_CONTR_DTL_PK
            AND DCBS.EZCANCELFLAG = '0'
            AND DCBS.INV_FLG  = #flgN#
            <!-- START 2022/07/28 A.Cullano [QC#60173, ADD] -->
            AND DCBS.SKIP_RECOV_TP_CD != #skipRecovTpSkip#
            <!-- END 2022/07/28 A.Cullano [QC#60173, ADD] -->
            AND DCD.GLBL_CMPY_CD = DCBM.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK = DCBM.DS_CONTR_DTL_PK
            AND DCBM.EZCANCELFLAG = '0'
            AND DCBM.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
            AND DCBM.BLLG_MTR_BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
            <!-- 2021/05/20 QC#58743 Add End -->
        ) MAIN
        ORDER BY
            SORT_NUM
    ) MAIN
    WHERE
        ROWNUM &lt;= #limitRownum#
    </statement>
<!-- 2020/07/22 QC#57316 Add End -->
    <!-- START 2022/06/30 K.Ogino [QC#59957,ADD] -->
    <statement id="getExistsPrinCust" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            PRIN.PRIN_CUST_PK AS PRIN_CUST_PK
            ,PRIN.EZUPTIME AS EZUPTIME 
            ,PRIN.EZUPTIMEZONE AS EZUPTIMEZONE
        FROM ACCT_LOC LOC
            , PRIN_CUST PRIN
        WHERE LOC.GLBL_CMPY_CD = #glblCmpyCd#
        AND LOC.EZCANCELFLAG = '0'
        AND LOC.LOC_NUM = #locNum#
        AND LOC.GLBL_CMPY_CD = PRIN.GLBL_CMPY_CD
        AND LOC.LOC_NUM = PRIN.LOC_NUM
        AND PRIN.PRIN_CUST_PK != #prinCustPk#
        AND PRIN.EZCANCELFLAG = '0'
    </statement>
    <!-- START 2022/06/30 K.Ogino [QC#59957,ADD] -->
    <!-- 2023/01/13 QC#60860 Add Start -->
    <statement id="getVndCd" parameterClass="Map" resultClass="String">
       SELECT
           A.CARR_CD
       FROM
           OTBD_CARR_V A
       WHERE
               A.GLBL_CMPY_CD      = #glblCmpyCd#
           AND A.EZCANCELFLAG      = '0'
           AND A.CARR_NM           = #vndNm#
    </statement>
    <!-- 2023/01/13 QC#60860 Add End -->
    <!-- add start 2023/07/18 QC#61421 -->
    <statement id="getDsBizArea" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_BIZ_AREA_CD
            ,A.DS_BIZ_AREA_NM
        FROM
            DS_BIZ_AREA A
        WHERE
                A.GLBL_CMPY_CD    = #glblCmpyCd#
            AND A.EZCANCELFLAG    = '0'
            <isNotNull property="spclInstnFlg">
            AND A.SPCL_INSTN_FLG  = #spclInstnFlg#
            </isNotNull>
        ORDER BY
            A.DS_BIZ_AREA_SORT_NUM
    </statement>
    <!-- add end 2023/07/18 QC#61421 -->
</sqlMap>
