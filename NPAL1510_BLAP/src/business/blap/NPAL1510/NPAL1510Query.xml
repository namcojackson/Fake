<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPAL1510Query">
    <typeAlias alias="NPAL1510_ASMsg" type="business.blap.NPAL1510.NPAL1510_ASMsg"/>

    <statement id="getSavedSearchOptionList" parameterClass="Map" resultClass="Map">
        SELECT
            SSO.SRCH_OPT_PK
            ,SSO.SRCH_OPT_NM
        FROM
            SAVE_SRCH_OPT SSO
        WHERE
                SSO.GLBL_CMPY_CD      = #glblCmpyCd#
            AND SSO.SRCH_OPT_APL_ID   = #businessApplId#
            AND SSO.SRCH_OPT_USR_ID   = #srchOptUsrId#
            AND SSO.EZCANCELFLAG = '0'
        ORDER BY
            SSO.SRCH_OPT_NM ASC
    </statement>

    <statement id="getDispLevelPoHeaderSearchList" parameterClass="Map" resultMap="result.NPAL1510_ASMsg">
        SELECT
             PO_ORD_NUM
            ,DS_PO_TP_DESC_TXT
            ,PO_HDR_STS_DESC_TXT
            ,PO_APVL_STS_DESC_TXT
            ,PO_DISP_LINE_NUM
            ,PO_LINE_TP_DESC_TXT
            ,MDSE_CD_A0
            ,MDSE_CD_A1
            ,SET_PO_ORD_DTL_LINE_NUM
            ,XX_MDSE_CD_A0
            ,XX_MDSE_CD_A1
            ,ASL_MDSE_CD
            ,MDSE_DESC_SHORT_TXT
            ,ENT_DEAL_NET_UNIT_PRC_AMT
            ,PO_DISP_QTY
            ,SUBSTRB(PO_SUBMT_TS,1,8) AS PO_SUBMT_DT
            ,SHIP_TO_CUST_CD
            ,SHIP_TO_LOC_NM
            ,DEST_RTL_WH_CD
            ,RQST_RTL_SWH_CD
            ,PO_MATCH_TP_DESC_TXT
            ,PO_LINE_STS_DESC_TXT
            ,ENT_PO_DTL_DEAL_NET_AMT
            ,PO_MDSE_CMPSN_TP_CD
            ,RCV_PO_QTY
            ,PO_INV_QTY
            ,PO_CANC_QTY
            ,SHPG_SVC_LVL_DESC_TXT
            ,PRCH_REQ_NUM
            ,PRCH_REQ_LINE_NUM
            ,TRX_REF_NUM
            ,TRX_REF_LINE_NUM
            ,ORIG_PO_ORD_NUM
            ,ORIG_DISP_PO_DTL_LINE_NUM
            ,PO_ACK_NUM
            ,SUBSTRB(PO_SEND_TS_A0,1,8) AS PO_SEND_TS_A0
            ,NULL AS PO_SEND_DT_A1
            ,VND_PO_ACK_STS_CD
            ,VND_PO_ACK_STS_DESC_TXT
            ,SUBSTRB(ORD_LAST_UPD_TS,1,8) AS ORD_LAST_UPD_TS
            ,ORD_QTY
            ,XX_TOT_AMT
            ,SUBSTRB(ETD_DT,1,8) AS ETD_DT
            ,SUBSTRB(ETA_DT,1,8) AS ETA_DT
            ,VND_OTBD_CARR_NM
            ,PRO_NUM
            ,VND_SO_NUM
            ,VND_SO_SLP_NUM
            ,VND_INVTY_LOC_CD
            ,VND_SHIP_TO_CUST_LOC_NM
            ,VND_SELL_TO_CUST_LOC_NM
            ,THIS_MTH_FOB_COST_AMT
            ,VND_CHILD_BOM_PRC_AMT
            ,VND_CPO_ORD_NUM
            ,VND_ISS_PO_ORD_NUM
            ,VND_PO_ACK_LINE_STS_TXT
            ,VND_OTBD_CARR_CD
            ,VND_CPO_DTL_LINE_NUM
            ,VND_CPO_DTL_LINE_SUB_NUM
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            ,COA_MDSE_TP_CD
            ,COA_PROD_CD
            ,PRNT_VND_CD
            ,PRNT_VND_NM
            ,VND_CD
            ,VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
            ,RCV_WO_QTY
            ,INV_WO_QTY
            <!-- add end 2022/05/19 QC#57934 -->
            <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
            ,SUBSTRB(RQST_SHIP_DT,1,8) AS RQST_SHIP_DT
            <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
        FROM (
            SELECT 
                '1' AS SORT_INDEX
                ,P.PO_ORD_NUM
                ,DPT.DS_PO_TP_DESC_TXT
                ,PHS.PO_HDR_STS_DESC_TXT
                ,PAS.PO_APVL_STS_DESC_TXT
                ,NULL AS PO_DISP_LINE_NUM
                ,NULL AS PO_LINE_TP_DESC_TXT
                ,NULL AS MDSE_CD_A0
                ,NULL AS MDSE_CD_A1
                ,NULL AS SET_PO_ORD_DTL_LINE_NUM
                ,NULL AS XX_MDSE_CD_A0
                ,NULL AS XX_MDSE_CD_A1
                ,NULL AS ASL_MDSE_CD
                ,NULL AS MDSE_DESC_SHORT_TXT
                ,NULL AS ENT_DEAL_NET_UNIT_PRC_AMT
                ,NULL AS PO_MDSE_CMPSN_TP_CD
                ,NULL AS PO_DISP_QTY
                ,NULL AS PO_SUBMT_TS
                ,PD.SHIP_TO_CUST_CD
                ,PD.SHIP_TO_LOC_NM
                ,P.DEST_RTL_WH_CD
                ,NULL AS RQST_RTL_SWH_CD
                ,NULL AS PO_MATCH_TP_DESC_TXT
                ,NULL AS PO_LINE_STS_DESC_TXT
                ,NULL AS ENT_PO_DTL_DEAL_NET_AMT
                ,NULL AS RCV_PO_QTY
                ,NULL AS PO_INV_QTY
                ,NULL AS PO_CANC_QTY
                ,SSL.SHPG_SVC_LVL_DESC_TXT
                ,NVL((SELECT
                         PRD.PRCH_REQ_NUM
                     FROM
                         PRCH_REQ_DTL PRD
                     WHERE
                         PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                     AND PRD.PO_ORD_NUM   = PD.PO_ORD_NUM
                     AND PRD.EZCANCELFLAG = '0'
                     AND ROWNUM = 1)
                    , PD.PRCH_REQ_NUM) AS PRCH_REQ_NUM
                ,NULL AS PRCH_REQ_LINE_NUM
                ,PD.TRX_REF_NUM
                ,NULL AS TRX_REF_LINE_NUM
                ,PD.ORIG_PO_ORD_NUM
                ,NULL AS ORIG_DISP_PO_DTL_LINE_NUM
                ,NULL AS PO_ACK_NUM
                ,P.PO_SEND_TS AS PO_SEND_TS_A0
                ,NULL AS PO_SEND_DT_A1
                ,NULL AS VND_PO_ACK_STS_CD
                ,NULL AS VND_PO_ACK_STS_DESC_TXT
                ,NULL AS ORD_LAST_UPD_TS
                ,NULL AS ORD_QTY
                ,NULL AS XX_TOT_AMT
                ,NULL AS ETD_DT
                ,NULL AS ETA_DT
                ,NULL AS VND_OTBD_CARR_NM
                ,NULL AS PRO_NUM
                ,NULL AS VND_SO_NUM
                ,NULL AS VND_SO_SLP_NUM
                ,NULL AS VND_INVTY_LOC_CD
                ,NULL AS VND_SHIP_TO_CUST_LOC_NM
                ,NULL AS VND_SELL_TO_CUST_LOC_NM
                ,NULL AS THIS_MTH_FOB_COST_AMT
                ,NULL AS VND_CHILD_BOM_PRC_AMT
                ,NULL AS VND_CPO_ORD_NUM
                ,NULL AS VND_ISS_PO_ORD_NUM
                ,NULL AS VND_PO_ACK_LINE_STS_TXT
                ,NULL AS VND_OTBD_CARR_CD
                ,NULL AS VND_CPO_DTL_LINE_NUM
                ,NULL AS VND_CPO_DTL_LINE_SUB_NUM
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                ,NULL AS COA_MDSE_TP_CD
                ,NULL AS COA_PROD_CD
                ,P.PRNT_VND_CD
                ,P.PRNT_VND_NM
                ,P.VND_CD
                ,P.VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                ,NULL AS RCV_WO_QTY
                ,NULL AS INV_WO_QTY
            <!-- add end 2022/05/19 QC#57934 -->
            <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
                ,PD.RQST_SHIP_DT
            <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
            FROM 
                 PO P
                ,PO_DTL PD
                ,SHPG_SVC_LVL SSL
                ,DS_PO_TP DPT
                ,PO_HDR_STS PHS
                ,PO_APVL_STS PAS
                ,AUTH_PSN AP
                ,RTL_WH RW
                ,SCE_SYS_USR_LIST SSUL
            WHERE 
                -- JOIN TO PO
                P.GLBL_CMPY_CD = #glblCmpyCd#
                AND P.EZCANCELFLAG = '0'
                <isNotNull property="msg.poOrdNum">
                AND P.PO_ORD_NUM LIKE #msg.poOrdNum#
                </isNotNull>
                <isNotNull property="msg.poOrdSrcCd_SL">
                AND P.PO_ORD_SRC_CD = #msg.poOrdSrcCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndCd">
                AND P.VND_CD = #msg.vndCd#
                </isNotNull>
                <isNotNull property="msg.vndNm">
                AND P.VND_NM LIKE #msg.vndNm#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_FR">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &gt;= #msg.poSubmtDt_FR#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_TO">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &lt;= #msg.poSubmtDt_TO#
                </isNotNull>
                <isNotNull property="msg.vndIssOrdNum">
                AND P.VND_ISS_ORD_NUM LIKE #msg.vndIssOrdNum#
                </isNotNull>
                <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
                
                -- JOIN TO DS_PO
                AND P.EZCANCELFLAG = '0'
                <isNotNull property="msg.poHdrStsCd_SL">
                AND P.PO_HDR_STS_CD = #msg.poHdrStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.poApvlStsCd_SL">
                AND P.PO_APVL_STS_CD = #msg.poApvlStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.dsPoTpCd_SL">
                AND P.DS_PO_TP_CD = #msg.dsPoTpCd_SL#
                </isNotNull>
                <isNotNull property="msg.prntVndCd">
                AND P.PRNT_VND_CD = #msg.prntVndCd#
                </isNotNull>
                <isNotNull property="msg.prntVndNm">
                AND P.PRNT_VND_NM LIKE #msg.prntVndNm#
                </isNotNull>
                <isNotNull property="msg.destRtlWhCd">
                AND P.DEST_RTL_WH_CD = #msg.destRtlWhCd#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_FR">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &gt;= #msg.xxDt10Dt_FR#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_TO">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &lt;= #msg.xxDt10Dt_TO#
                </isNotNull>
                
                -- JOIN TO PO_DTL
                AND P.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                AND PD.EZCANCELFLAG = '0'
                AND P.PO_ORD_NUM = PD.PO_ORD_NUM
                AND PD.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
                <!-- START 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isNotNull property="msg.prchReqNum">
                AND (PD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                            PRCH_REQ_DTL PRD
                        WHERE
                            PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                        AND PRD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                        AND PRD.PO_ORD_NUM   = PD.PO_ORD_NUM
                        AND PRD.EZCANCELFLAG = '0'
                    )
                )
                </isNotNull>
                <!-- END 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
                
                -- JOIN TO DS_PO_DTL
                AND P.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                
                -- LEFT JOIN TO SHPG_SVC_LVL
                AND PD.GLBL_CMPY_CD = SSL.GLBL_CMPY_CD(+)
                AND SSL.EZCANCELFLAG(+) = '0'
                AND PD.SHPG_SVC_LVL_CD = SSL.SHPG_SVC_LVL_CD(+)
                
                -- LEFT JOIN TO DS_PO_TP
                AND P.GLBL_CMPY_CD = DPT.GLBL_CMPY_CD(+)
                AND DPT.EZCANCELFLAG(+) = '0'
                AND P.DS_PO_TP_CD = DPT.DS_PO_TP_CD(+)
                
                -- LEFT JOIN TO PO_HDR_STS
                AND P.GLBL_CMPY_CD = PHS.GLBL_CMPY_CD
                AND PHS.EZCANCELFLAG(+) = '0'
                AND P.PO_HDR_STS_CD = PHS.PO_HDR_STS_CD(+)
                
                -- LEFT JOIN TO PO_APVL_STS
                AND P.GLBL_CMPY_CD = PAS.GLBL_CMPY_CD(+)
                AND PAS.EZCANCELFLAG(+) = '0'
                AND P.PO_APVL_STS_CD = PAS.PO_APVL_STS_CD(+)
                
                -- LEFT JOIN TO AUTH_PSN
                AND P.GLBL_CMPY_CD = AP.GLBL_CMPY_CD(+)
                AND AP.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = AP.USR_NM(+)
                
                -- LEFT JOIN TO SCE_SYS_USR_LIST
                AND P.GLBL_CMPY_CD = SSUL.GLBL_CMPY_CD(+)
                AND SSUL.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = SSUL.FULL_PSN_NM(+)
                
                <isNotNull property="msg.fullPsnNm">
                AND 
                    (
                    UPPER(AP.FIRST_NM || (NVL2(AP.MID_NM, ' '||AP.MID_NM||' ', ' ')) || AP.LAST_NM) LIKE UPPER(#msg.fullPsnNm#)
                    OR
                    UPPER(SSUL.FULL_PSN_NM) LIKE UPPER(#msg.fullPsnNm#)
                    )
                </isNotNull>
                
                -- LEFT JOIN TO RTL_WH
                AND P.GLBL_CMPY_CD(+) = RW.GLBL_CMPY_CD
                AND RW.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD(+) = RW.RTL_WH_CD
                <isNotNull property="msg.rtlWhNm">
                AND RW.RTL_WH_NM(+) LIKE #msg.rtlWhNm#
                </isNotNull>
                <isEqual property="searchCond1" compareValue="1">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                         PO_DTL E1_PD
                        ,RTL_SWH E1_RS
                    WHERE 
                        -- JOIN TO PO_DTL
                        P.GLBL_CMPY_CD = E1_PD.GLBL_CMPY_CD
                    AND E1_PD.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E1_PD.PO_ORD_NUM
                    <isNotNull property="msg.shpgSvcLvlCd_SL">
                    AND E1_PD.SHPG_SVC_LVL_CD = #msg.shpgSvcLvlCd_SL#
                    </isNotNull>
                    <isNotNull property="msg.shipToCustCd">
                    AND E1_PD.SHIP_TO_CUST_CD = #msg.shipToCustCd#
                    </isNotNull>
                    <isNotNull property="msg.shipToCustLocNm">
                    AND E1_PD.SHIP_TO_LOC_NM LIKE #msg.shipToCustLocNm#
                    </isNotNull>
                    <isNotNull property="msg.mdseCd">
                    AND E1_PD.ORIG_MDSE_CD LIKE #msg.mdseCd#
                    </isNotNull>
                    <isNotNull property="msg.mdseCd_SB">
                    AND E1_PD.MDSE_CD LIKE #msg.mdseCd_SB#
                    </isNotNull>
                    
                    -- JOIN TO DS_PO_DTL
                    <isNotNull property="msg.trxRefNum">
                    AND E1_PD.TRX_REF_NUM LIKE #msg.trxRefNum#
                    </isNotNull>
                    <isNotNull property="msg.destRtlSwhCd">
                    AND E1_PD.DEST_RTL_SWH_CD LIKE #msg.destRtlSwhCd#
                    </isNotNull>
                    <isNotNull property="msg.poLineStsCd_SL">
                    AND E1_PD.PO_LINE_STS_CD = #msg.poLineStsCd_SL#
                    </isNotNull>
                    <isNotNull property="msg.vndPoAckStsCd_SL">
                    AND E1_PD.VND_PO_ACK_STS_CD = #msg.vndPoAckStsCd_SL#
                    </isNotNull>
                    <isNotNull property="msg.proNum">
                    AND E1_PD.PRO_NUM LIKE #msg.proNum#
                    </isNotNull>
                    <isNotNull property="msg.vndInvtyLocCd">
                    AND E1_PD.VND_INVTY_LOC_CD LIKE #msg.vndInvtyLocCd#
                    </isNotNull>
                    <isNotNull property="msg.aslMdseCd">
                    AND E1_PD.ASL_MDSE_CD LIKE #msg.aslMdseCd#
                    </isNotNull>
                    
                    -- LEFT JOIN TO RTL_SWH
                    AND P.GLBL_CMPY_CD = E1_RS.GLBL_CMPY_CD(+)
                    AND E1_RS.EZCANCELFLAG(+) = '0'
                    AND P.DEST_RTL_WH_CD = E1_RS.RTL_WH_CD(+)
                    AND E1_PD.DEST_RTL_SWH_CD = E1_RS.RTL_SWH_CD(+)
                    <isNotNull property="msg.rtlSwhNm">
                    AND E1_RS.RTL_SWH_NM LIKE #msg.rtlSwhNm#
                    </isNotNull>
                )
                </isEqual>
                <isEqual property="searchCond2" compareValue="1">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                         PO_ACK_HDR E2_PAH
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                    ,PO_ACK_DTL E2_PAD -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                    WHERE 
                        -- JOIN TO PO_ACK_HDR
                        P.GLBL_CMPY_CD = E2_PAH.GLBL_CMPY_CD
                    AND E2_PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAH.PO_ORD_NUM
                    <isNotNull property="msg.xxOrdDt_FR">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &gt;= #msg.xxOrdDt_FR#
                    </isNotNull>
                    <isNotNull property="msg.xxOrdDt_TO">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &lt;= #msg.xxOrdDt_TO#
                    </isNotNull>
                    
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                AND E2_PAH.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD -->
<!--                AND E2_PAD.EZCANCELFLAG = '0' -->
<!--                AND E2_PAH.PO_ACK_HDR_PK = E2_PAD.PO_ACK_HDR_PK -->
<!--                <isNotNull property="msg.vndSoNum"> -->
<!--                AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum# -->
<!--                </isNotNull> -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                )
                </isEqual>
<!-- START 02/10/2020 T.Ogura [QC#55712,ADD] -->
                <isNotNull property="msg.vndSoNum">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                        PO_ACK_DTL E2_PAD
                    WHERE 
                        P.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD
                    AND E2_PAD.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAD.PO_ORD_NUM
                    AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum#
                )
                </isNotNull>
<!-- END   02/10/2020 T.Ogura [QC#55712,ADD] -->
            ORDER BY 
                P.PO_ORD_NUM ASC
                ,TO_NUMBER(PD.DISP_PO_DTL_LINE_NUM) ASC
                ,SORT_INDEX ASC
        )
        WHERE ROWNUM &lt;= #rowNum#
    </statement>
    
    <statement id="getDispLevelPoDetailSearchList" parameterClass="Map" resultMap="result.NPAL1510_ASMsg">
        <!-- add start 2022/05/19 QC#57934 -->
        WITH PO_DTL_INFO AS (
        <!-- add end 2022/05/19 QC#57934 -->
        SELECT
            PO_ORD_NUM
            ,DS_PO_TP_DESC_TXT
            ,PO_HDR_STS_DESC_TXT
            ,PO_APVL_STS_DESC_TXT
            ,DISP_PO_DTL_LINE_NUM AS PO_DISP_LINE_NUM
            ,PO_LINE_TP_DESC_TXT
            ,MDSE_CD_A0
            ,MDSE_CD_A1
            ,SET_PO_ORD_DTL_LINE_NUM
            ,XX_MDSE_CD_A0
            ,XX_MDSE_CD_A1
            ,ASL_MDSE_CD
            ,MDSE_DESC_SHORT_TXT
            ,ENT_DEAL_NET_UNIT_PRC_AMT
            ,PO_DISP_QTY
            ,SUBSTRB(PO_SUBMT_TS,1,8) AS PO_SUBMT_DT
            ,SHIP_TO_CUST_CD
            ,SHIP_TO_LOC_NM
            ,DEST_RTL_WH_CD
            ,RQST_RTL_SWH_CD
            ,PO_MATCH_TP_DESC_TXT
            ,PO_LINE_STS_DESC_TXT
            ,ENT_PO_DTL_DEAL_NET_AMT
            ,PO_MDSE_CMPSN_TP_CD
            ,RCV_PO_QTY
            ,PO_INV_QTY
            ,PO_CANC_QTY
            ,SHPG_SVC_LVL_DESC_TXT
            ,PRCH_REQ_NUM
            ,PRCH_REQ_LINE_NUM
            ,TRX_REF_NUM
            ,TRX_REF_LINE_NUM
            ,ORIG_PO_ORD_NUM
            ,ORIG_DISP_PO_DTL_LINE_NUM AS ORIG_DISP_PO_DTL_LINE_NUM
            ,PO_ACK_NUM
            ,SUBSTRB(PO_SEND_TS_A0,1,8) AS PO_SEND_TS_A0
            ,SUBSTRB(PO_SEND_DT_A1,1,8) AS PO_SEND_DT_A1
            ,VND_PO_ACK_STS_CD
            ,VND_PO_ACK_STS_DESC_TXT
            ,SUBSTRB(ORD_LAST_UPD_TS,1,8) AS ORD_LAST_UPD_TS
            ,ORD_QTY
            ,XX_TOT_AMT
            ,SUBSTRB(ETD_DT,1,8) AS ETD_DT
            ,SUBSTRB(ETA_DT,1,8) AS ETA_DT
            ,VND_OTBD_CARR_NM
            ,PRO_NUM
            ,VND_SO_NUM
            ,VND_SO_SLP_NUM
            ,VND_INVTY_LOC_CD
            ,VND_SHIP_TO_CUST_LOC_NM
            ,VND_SELL_TO_CUST_LOC_NM
            ,THIS_MTH_FOB_COST_AMT
            ,VND_CHILD_BOM_PRC_AMT
            ,VND_ISS_ORD_NUM AS VND_CPO_ORD_NUM
            ,VND_ISS_PO_ORD_NUM
            ,VND_PO_ACK_LINE_STS_TXT
            ,VND_OTBD_CARR_CD
            ,VND_CPO_DTL_LINE_NUM
            ,VND_CPO_DTL_LINE_SUB_NUM
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            ,COA_MDSE_TP_CD
            ,COA_PROD_CD
            ,PRNT_VND_CD
            ,PRNT_VND_NM
            ,VND_CD
            ,VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
            ,GLBL_CMPY_CD
            ,PO_ORD_DTL_LINE_NUM
            <!-- add end 2022/05/19 QC#57934 -->
            <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
            ,SUBSTRB(RQST_SHIP_DT,1,8) AS RQST_SHIP_DT
            <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
        FROM (
            SELECT /*+ LEADING(P PD AMV) USE_NL(P PD AMV) */
                '1' AS SORT_INDEX
                ,P.PO_ORD_NUM
                ,DPT.DS_PO_TP_DESC_TXT
                ,PHS.PO_HDR_STS_DESC_TXT
                ,PAS.PO_APVL_STS_DESC_TXT
                ,PD.DISP_PO_DTL_LINE_NUM AS DISP_PO_DTL_LINE_NUM
                ,PLT.PO_LINE_TP_DESC_TXT
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                --,PD.ORIG_MDSE_CD AS MDSE_CD_A0
                ,DECODE(
                    AMV.MDSE_ITEM_TP_CD
                   ,#mdseItemTpCdTextItem#
                   ,NULL
                   ,PD.ORIG_MDSE_CD
                 ) MDSE_CD_A0
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,PD2.MDSE_CD AS MDSE_CD_A1
                ,PD.SET_PO_ORD_DTL_LINE_NUM
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                --,PD.MDSE_CD AS XX_MDSE_CD_A0
                ,DECODE(
                    AMV.MDSE_ITEM_TP_CD
                   ,#mdseItemTpCdTextItem#
                   ,NULL
                   ,PD.MDSE_CD
                 ) XX_MDSE_CD_A0
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,CASE WHEN PD.MDSE_CD &lt;&gt; PD.ORIG_MDSE_CD THEN PD.ORIG_MDSE_CD ELSE NULL END AS XX_MDSE_CD_A1
                ,PD.ASL_MDSE_CD
                <!-- QC#53271 Update -->
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                --,AMV.MDSE_DESC_SHORT_TXT
                <!--,DECODE(
                    AMV.MDSE_ITEM_TP_CD
                   ,#mdseItemTpCdTextItem#
                   ,PD.MDSE_DESC_SHORT_TXT
                   ,AMV.MDSE_DESC_SHORT_TXT
                 ) MDSE_DESC_SHORT_TXT
                -->
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,CASE WHEN PD.PO_LINE_TP_CD IN(#poLineTpCdExpense#, #poLineTpCdExpenseWReceipt#) THEN NVL(PD.MDSE_DESC_SHORT_TXT, AMV.MDSE_DESC_SHORT_TXT)
                       ELSE AMV.MDSE_DESC_SHORT_TXT
                 END AS MDSE_DESC_SHORT_TXT
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.ENT_DEAL_NET_UNIT_PRC_AMT END AS ENT_DEAL_NET_UNIT_PRC_AMT
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_DISP_QTY END AS PO_DISP_QTY
                ,P.PO_SUBMT_TS
                ,PD.SHIP_TO_CUST_CD
                ,PD.SHIP_TO_LOC_NM
                ,P.DEST_RTL_WH_CD
                ,PD.DEST_RTL_SWH_CD AS RQST_RTL_SWH_CD
                ,PMT.PO_MATCH_TP_DESC_TXT
                ,PLS.PO_LINE_STS_DESC_TXT
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.ENT_PO_DTL_DEAL_NET_AMT END AS ENT_PO_DTL_DEAL_NET_AMT
                ,PD.PO_MDSE_CMPSN_TP_CD
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_RCV_QTY END AS RCV_PO_QTY
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_INV_QTY END AS PO_INV_QTY
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_CANC_QTY END AS PO_CANC_QTY
                ,SSL.SHPG_SVC_LVL_DESC_TXT
                ,NVL((SELECT
                         PRD.PRCH_REQ_NUM
                     FROM
                         PRCH_REQ_DTL PRD
                     WHERE
                         PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                     AND PRD.PO_ORD_NUM   = PD.PO_ORD_NUM
                     AND PRD.EZCANCELFLAG = '0'
                     AND ROWNUM = 1)
                    , PD.PRCH_REQ_NUM) AS PRCH_REQ_NUM
                ,NVL((SELECT
                         PRD.PRCH_REQ_LINE_NUM
                     FROM
                         PRCH_REQ_DTL PRD
                     WHERE
                         PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                     AND PRD.PO_ORD_NUM   = PD.PO_ORD_NUM
                     AND PRD.PO_ORD_DTL_LINE_NUM   = PD.PO_ORD_DTL_LINE_NUM
                     AND PRD.EZCANCELFLAG = '0'
                     AND ROWNUM = 1)
                    , PD.PRCH_REQ_LINE_NUM) AS PRCH_REQ_LINE_NUM
                ,PD.TRX_REF_NUM
                ,PD.TRX_REF_LINE_NUM
                ,CASE WHEN PD.PO_ORD_NUM &lt;&gt; PD.ORIG_PO_ORD_NUM THEN PD.ORIG_PO_ORD_NUM ELSE NULL END AS ORIG_PO_ORD_NUM
                ,CASE WHEN PD.DISP_PO_DTL_LINE_NUM &lt;&gt; PD.ORIG_DISP_PO_DTL_LINE_NUM THEN PD.ORIG_DISP_PO_DTL_LINE_NUM ELSE NULL END AS ORIG_DISP_PO_DTL_LINE_NUM
                ,'0' PO_ACK_NUM
                ,P.PO_SEND_TS AS PO_SEND_TS_A0
                ,PD.PO_SEND_TS AS PO_SEND_DT_A1
                ,NULL AS VND_PO_ACK_STS_CD
                ,NULL AS VND_PO_ACK_STS_DESC_TXT
                ,NULL AS ORD_LAST_UPD_TS
                ,NULL AS ORD_QTY
                ,NULL AS XX_TOT_AMT
                ,NULL AS ETD_DT
                ,NULL AS ETA_DT
                ,NULL AS VND_OTBD_CARR_NM
                ,PD.PRO_NUM
                ,NULL AS VND_SO_NUM
                ,NULL AS VND_SO_SLP_NUM
                ,PD.VND_INVTY_LOC_CD
                ,NULL AS VND_SHIP_TO_CUST_LOC_NM
                ,NULL AS VND_SELL_TO_CUST_LOC_NM
                ,NULL AS THIS_MTH_FOB_COST_AMT
                ,NULL AS VND_CHILD_BOM_PRC_AMT
                ,P.VND_ISS_ORD_NUM
                ,PD.VND_ISS_PO_ORD_NUM
                ,NULL AS VND_PO_ACK_LINE_STS_TXT
                ,NULL AS VND_OTBD_CARR_CD
                ,NULL AS VND_CPO_DTL_LINE_NUM
                ,NULL AS VND_CPO_DTL_LINE_SUB_NUM
                ,NULL AS CARR_TRK_URL
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                ,AMV.COA_MDSE_TP_CD
                ,AMV.COA_PROD_CD
                ,P.PRNT_VND_CD
                ,P.PRNT_VND_NM
                ,P.VND_CD
                ,P.VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                ,PD.GLBL_CMPY_CD
                ,PD.PO_ORD_DTL_LINE_NUM
            <!-- add end 2022/05/19 QC#57934 -->
            <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
                ,PD.RQST_SHIP_DT
            <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
            FROM 
                PO P
                ,PO_DTL PD
                ,PO_DTL PD2
                ,SHPG_SVC_LVL SSL
                ,PO_MATCH_TP PMT
                ,PO_LINE_TP PLT
                ,PO_LINE_STS PLS
                ,DS_PO_TP DPT
                ,PO_HDR_STS PHS
                ,PO_APVL_STS PAS
                ,ALL_MDSE_V AMV
                <isNotNull property="msg.rtlSwhNm">
                ,RTL_SWH RS
                </isNotNull>
                <isNotNull property="msg.rtlWhNm">
                ,RTL_WH RW
                </isNotNull>
                <isNotNull property="msg.fullPsnNm">
                ,SCE_SYS_USR_LIST SSUL
                ,AUTH_PSN AP
                </isNotNull>
            WHERE 
                -- JOIN TO PO
                P.GLBL_CMPY_CD = #glblCmpyCd#
                AND P.EZCANCELFLAG = '0'
                <isNotNull property="msg.poOrdNum">
                AND P.PO_ORD_NUM LIKE #msg.poOrdNum#
                </isNotNull>
                <isNotNull property="msg.poOrdSrcCd_SL">
                AND P.PO_ORD_SRC_CD = #msg.poOrdSrcCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndCd">
                AND P.VND_CD = #msg.vndCd#
                </isNotNull>
                <isNotNull property="msg.vndNm">
                AND P.VND_NM LIKE #msg.vndNm#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_FR">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &gt;= #msg.poSubmtDt_FR#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_TO">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &lt;= #msg.poSubmtDt_TO#
                </isNotNull>
                <isNotNull property="msg.vndIssOrdNum">
                AND P.VND_ISS_ORD_NUM LIKE #msg.vndIssOrdNum#
                </isNotNull>
                -- JOIN TO DS_PO
                <isNotNull property="msg.poHdrStsCd_SL">
                AND P.PO_HDR_STS_CD = #msg.poHdrStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.poApvlStsCd_SL">
                AND P.PO_APVL_STS_CD = #msg.poApvlStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.dsPoTpCd_SL">
                AND P.DS_PO_TP_CD = #msg.dsPoTpCd_SL#
                </isNotNull>
                <isNotNull property="msg.prntVndCd">
                AND P.PRNT_VND_CD = #msg.prntVndCd#
                </isNotNull>
                <isNotNull property="msg.prntVndNm">
                AND P.PRNT_VND_NM LIKE #msg.prntVndNm#
                </isNotNull>
                <isNotNull property="msg.destRtlWhCd">
                AND P.DEST_RTL_WH_CD = #msg.destRtlWhCd#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_FR">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &gt;= #msg.xxDt10Dt_FR#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_TO">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &lt;= #msg.xxDt10Dt_TO#
                </isNotNull>
                <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
                -- JOIN TO PO_DTL
                AND P.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                AND PD.EZCANCELFLAG = '0'
                AND P.PO_ORD_NUM = PD.PO_ORD_NUM
                <!-- START 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isNotNull property="msg.prchReqNum">
                AND (PD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                            PRCH_REQ_DTL PRD
                        WHERE
                            PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                        AND PRD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                        AND PRD.PO_ORD_NUM   = P.PO_ORD_NUM
                        AND PRD.EZCANCELFLAG = '0'
                    )
                )
                </isNotNull>
                <!-- END 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isEqual property="searchCond1" compareValue="1">
                <isNotNull property="msg.shpgSvcLvlCd_SL">
                AND PD.SHPG_SVC_LVL_CD = #msg.shpgSvcLvlCd_SL#
                </isNotNull>
                <isNotNull property="msg.shipToCustCd">
                AND PD.SHIP_TO_CUST_CD = #msg.shipToCustCd#
                </isNotNull>
                <isNotNull property="msg.shipToCustLocNm">
                AND PD.SHIP_TO_LOC_NM LIKE #msg.shipToCustLocNm#
                </isNotNull>
                <isNotNull property="msg.mdseCd">
                AND PD.ORIG_MDSE_CD LIKE #msg.mdseCd#
                </isNotNull>
                <isNotNull property="msg.mdseCd_SB">
                AND PD.MDSE_CD LIKE #msg.mdseCd_SB#
                </isNotNull>
                </isEqual>
                <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
                
                -- JOIN TO DS_PO_DTL
                AND P.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                <isEqual property="searchCond1" compareValue="1">
                <isNotNull property="msg.trxRefNum">
                AND PD.TRX_REF_NUM LIKE #msg.trxRefNum#
                </isNotNull>
                <isNotNull property="msg.destRtlSwhCd">
                AND PD.DEST_RTL_SWH_CD LIKE #msg.destRtlSwhCd#
                </isNotNull>
                <isNotNull property="msg.poLineStsCd_SL">
                AND PD.PO_LINE_STS_CD = #msg.poLineStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndPoAckStsCd_SL">
                AND PD.VND_PO_ACK_STS_CD = #msg.vndPoAckStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.proNum">
                AND PD.PRO_NUM LIKE #msg.proNum#
                </isNotNull>
                <isNotNull property="msg.vndInvtyLocCd">
                AND PD.VND_INVTY_LOC_CD LIKE #msg.vndInvtyLocCd#
                </isNotNull>
                <isNotNull property="msg.aslMdseCd">
                AND PD.ASL_MDSE_CD LIKE #msg.aslMdseCd#
                </isNotNull>
                </isEqual>
                -- LEFT JOIN TO PO_DTL 2
                AND PD.GLBL_CMPY_CD = PD2.GLBL_CMPY_CD(+)
                AND PD2.EZCANCELFLAG(+) = '0'
                AND PD.PO_ORD_NUM = PD2.PO_ORD_NUM(+)
                AND PD.SET_PO_ORD_DTL_LINE_NUM = PD2.PO_ORD_DTL_LINE_NUM(+)
                -- LEFT JOIN TO SHPG_SVC_LVL
                AND PD.GLBL_CMPY_CD = SSL.GLBL_CMPY_CD(+)
                AND SSL.EZCANCELFLAG(+) = '0'
                AND PD.SHPG_SVC_LVL_CD = SSL.SHPG_SVC_LVL_CD(+)
                -- LEFT JOIN TO PO_MATCH_TP
                AND PD.GLBL_CMPY_CD = PMT.GLBL_CMPY_CD(+)
                AND PMT.EZCANCELFLAG(+) = '0'
                AND PD.PO_MATCH_TP_CD = PMT.PO_MATCH_TP_CD(+)
                -- LEFT JOIN TO PO_LINE_TP
                AND PD.GLBL_CMPY_CD = PLT.GLBL_CMPY_CD(+)
                AND PLT.EZCANCELFLAG(+) = '0'
                AND PD.PO_LINE_TP_CD = PLT.PO_LINE_TP_CD(+)
                -- LEFT JOIN TO PO_LINE_STS
                AND PD.GLBL_CMPY_CD = PLS.GLBL_CMPY_CD(+)
                AND PLS.EZCANCELFLAG(+) = '0'
                AND PD.PO_LINE_STS_CD = PLS.PO_LINE_STS_CD(+)
                -- LEFT JOIN TO DS_PO_TP
                AND P.GLBL_CMPY_CD = DPT.GLBL_CMPY_CD(+)
                AND DPT.EZCANCELFLAG(+) = '0'
                AND P.DS_PO_TP_CD = DPT.DS_PO_TP_CD(+)
                -- LEFT JOIN TO PO_HDR_STS
                AND P.GLBL_CMPY_CD = PHS.GLBL_CMPY_CD(+)
                AND PHS.EZCANCELFLAG(+) = '0'
                AND P.PO_HDR_STS_CD = PHS.PO_HDR_STS_CD(+)
                -- LEFT JOIN TO PO_APVL_STS
                AND P.GLBL_CMPY_CD = PAS.GLBL_CMPY_CD(+)
                AND PAS.EZCANCELFLAG(+) = '0'
                AND P.PO_APVL_STS_CD = PAS.PO_APVL_STS_CD(+)
                <isNotNull property="msg.fullPsnNm">
                -- LEFT JOIN TO SCE_SYS_USR_LIST
                AND P.GLBL_CMPY_CD = SSUL.GLBL_CMPY_CD(+)
                AND SSUL.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = SSUL.FULL_PSN_NM(+)
                -- LEFT JOIN TO AUTH_PSN
                AND P.GLBL_CMPY_CD = AP.GLBL_CMPY_CD(+)
                AND AP.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = AP.USR_NM(+)
                AND
                    (
                    UPPER(AP.FIRST_NM || (NVL2(AP.MID_NM, ' '||AP.MID_NM||' ', ' ')) || AP.LAST_NM) LIKE UPPER(#msg.fullPsnNm#)
                    OR
                    UPPER(SSUL.FULL_PSN_NM) LIKE UPPER(#msg.fullPsnNm#)
                    )
                </isNotNull>
                -- LEFT JOIN TO ALL_MDSE_V
                AND PD.GLBL_CMPY_CD = AMV.GLBL_CMPY_CD(+)
                AND AMV.EZCANCELFLAG(+) = '0'
                AND PD.ORIG_MDSE_CD = AMV.MDSE_CD(+)
                <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                <isNotNull property="msg.coaMdseTpCd">
                AND AMV.COA_MDSE_TP_CD LIKE #msg.coaMdseTpCd#
                </isNotNull>
                <isNotNull property="msg.coaProdCd">
                AND AMV.COA_PROD_CD LIKE #msg.coaProdCd#
                </isNotNull>
                <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                <isNotNull property="msg.rtlWhNm">
                -- LEFT JOIN TO RTL_WH
                AND P.GLBL_CMPY_CD = RW.GLBL_CMPY_CD(+)
                AND RW.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD = RW.RTL_WH_CD(+)
                AND RW.RTL_WH_NM LIKE #msg.rtlWhNm#
                </isNotNull>
                <isEqual property="searchCond1" compareValue="1">
                <isNotNull property="msg.rtlSwhNm">
                -- LEFT JOIN TO RTL_SWH
                AND P.GLBL_CMPY_CD = RS.GLBL_CMPY_CD(+)
                AND RS.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD = RS.RTL_WH_CD(+)
                AND PD.DEST_RTL_SWH_CD = RS.RTL_SWH_CD(+)
                AND RS.RTL_SWH_NM LIKE #msg.rtlSwhNm#
                </isNotNull>
                </isEqual>
                <isEqual property="searchCond2" compareValue="1">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                         PO_ACK_HDR E2_PAH
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                    ,PO_ACK_DTL E2_PAD -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                    WHERE 
                        -- JOIN TO PO_ACK_HDR
                        P.GLBL_CMPY_CD = E2_PAH.GLBL_CMPY_CD
                    AND E2_PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAH.PO_ORD_NUM
                    <isNotNull property="msg.xxOrdDt_FR">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &gt;= #msg.xxOrdDt_FR#
                    </isNotNull>
                    <isNotNull property="msg.xxOrdDt_TO">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &lt;= #msg.xxOrdDt_TO#
                    </isNotNull>
                    
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                AND P.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD -->
<!--                AND E2_PAD.EZCANCELFLAG = '0' -->
<!--                AND E2_PAH.PO_ACK_HDR_PK = E2_PAD.PO_ACK_HDR_PK -->
<!--                <isNotNull property="msg.vndSoNum"> -->
<!--                AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum# -->
<!--                </isNotNull> -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                )
                </isEqual>
<!-- START 02/10/2020 T.Ogura [QC#55712,ADD] -->
                <isNotNull property="msg.vndSoNum">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                        PO_ACK_DTL E2_PAD
                    WHERE 
                        P.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD
                    AND E2_PAD.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAD.PO_ORD_NUM
                    AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum#
                )
                </isNotNull>
<!-- END   02/10/2020 T.Ogura [QC#55712,ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                <isNotEqual property="msg.xxChkBox_H1" compareValue="Y">
                AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            CM_ACRL_WRITE_OFF A
                        WHERE
                                PD.PO_MDSE_CMPSN_TP_CD = #poMdseCmpsnTpRegular#
                            AND A.GLBL_CMPY_CD         = PD.GLBL_CMPY_CD
                            AND A.PO_NUM               = PD.PO_ORD_NUM
                            AND A.PO_ORD_DTL_LINE_NUM  = PD.PO_ORD_DTL_LINE_NUM
                            AND A.WRT_OFF_FLG          = #flgOnY#
                            <iterate property="coaAcctCdList" var="coaAcctCd[]" open="AND A.COA_ACCT_CD IN (" close=")" conjunction= "," >
                                #coaAcctCd[]#
                            </iterate>
                            AND A.AJE_CM_INTFC_TP_CD   IS NULL
                            AND A.EZCANCELFLAG         = '0'
                            AND NOT EXISTS (
                                    SELECT
                                        1
                                    FROM
                                         RWS_HDR  B
                                        ,RWS_DTL  C
                                        ,RWS_STS  D
                                    WHERE
                                            B.GLBL_CMPY_CD        = A.GLBL_CMPY_CD
                                        AND B.PO_RCV_TRX_HDR_NUM  = A.PO_NUM
                                        AND B.EZCANCELFLAG        = '0'
                                        AND B.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
                                        AND B.RWS_NUM             = C.RWS_NUM
                                        AND C.PO_RCV_TRX_LINE_NUM = A.PO_ORD_DTL_LINE_NUM
                                        AND C.EZCANCELFLAG        = '0'
                                        AND C.GLBL_CMPY_CD        = D.GLBL_CMPY_CD
                                        AND C.RWS_STS_CD          = D.RWS_STS_CD
                                        AND D.RWS_OPEN_FLG        = #flgOnY#
                                        AND D.EZCANCELFLAG        = '0'
                                )
                    )
                </isNotEqual>
            <!-- add end 2022/05/19 QC#57934 -->
            ORDER BY 
                P.PO_ORD_NUM ASC
                ,TO_NUMBER(PD.PO_ORD_DTL_LINE_NUM) ASC
                ,SORT_INDEX ASC
        )
        WHERE ROWNUM &lt;= #rowNum#
        <!-- add start 2022/05/19 QC#57934 -->
        )
        ,WRITE_OFF_INFO AS (
            SELECT
                 E.PO_ORD_NUM
                ,E.PO_ORD_DTL_LINE_NUM
                ,SUM(E.RCV_WO_QTY) AS RCV_WO_QTY
                ,SUM(E.INV_WO_QTY) AS INV_WO_QTY
            FROM
                (
                 SELECT
                      D.PO_ORD_NUM
                     ,D.PO_ORD_DTL_LINE_NUM
                     ,D.WRT_OFF_DT
                     ,SUM(D.RCV_QTY) AS RCV_QTY
                     ,SUM(D.INV_QTY) AS INV_QTY
                     ,MAX(D.RCV_UNIT_PRC_AMT) AS RCV_UNIT_PRC_AMT
                     ,MAX(D.INV_UNIT_PRC_AMT) AS INV_UNIT_PRC_AMT
                     ,CASE WHEN SUM(D.INV_QTY) &lt; SUM(D.RCV_QTY)
                               THEN SUM(D.RCV_QTY) - SUM(D.INV_QTY)
                           <!-- mod start 2022/08/05 QC#59245 -->
                           <!-- WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND MAX(D.INV_UNIT_PRC_AMT) &lt; MAX(D.RCV_UNIT_PRC_AMT) -->
                           WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND SUM(D.INV_AMT) &lt; SUM(D.RCV_AMT)
                           <!-- mod end 2022/08/05 QC#59245 -->
                               THEN SUM(D.RCV_QTY)
                           ELSE 0
                      END AS RCV_WO_QTY
                     ,CASE WHEN SUM(D.INV_QTY) &gt; SUM(D.RCV_QTY)
                               THEN SUM(D.INV_QTY) - SUM(D.RCV_QTY)
                           <!-- mod start 2022/08/05 QC#59245 -->
                           <!-- WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND MAX(D.INV_UNIT_PRC_AMT) &gt; MAX(D.RCV_UNIT_PRC_AMT) -->
                           WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND SUM(D.INV_AMT) &gt; SUM(D.RCV_AMT)
                           <!-- mod end 2022/08/05 QC#59245 -->
                               THEN SUM(D.INV_QTY)
                           ELSE 0
                      END AS INV_WO_QTY
                 FROM
                     (
                      SELECT
                           P.PO_ORD_NUM
                          ,P.PO_ORD_DTL_LINE_NUM
                          ,A.WRT_OFF_DT
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpDr# THEN NVL(A.INV_RCV_QTY, 0) ELSE 0 END AS RCV_QTY
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr# THEN NVL(A.INV_QTY, 0) ELSE 0 END AS INV_QTY
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpDr# THEN NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0) ELSE 0 END AS RCV_UNIT_PRC_AMT
                          <!-- mod start 2022/08/05 QC#59245 -->
                          <!--
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr#
                                    THEN
                                      CASE WHEN B.ENT_DEAL_NET_UNIT_PRC_AMT = C.ENT_DEAL_NET_UNIT_PRC_AMT
                                               THEN B.ENT_DEAL_NET_UNIT_PRC_AMT
                                           ELSE NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0)
                                      END
                                ELSE 0
                           END INV_UNIT_PRC_AMT
                          -->
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr# THEN NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0) ELSE 0 END AS INV_UNIT_PRC_AMT
                          <!-- mod end 2022/08/05 QC#59245 -->
                          <!-- add start 2022/08/05 QC#59245 -->
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpDr# THEN NVL(A.INV_RCV_QTY, 0) * NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0) ELSE 0 END AS RCV_AMT
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr# THEN NVL(A.AC_INV_JRNL_COST_AMT, 0) ELSE 0 END AS INV_AMT
                          <!-- add end 2022/08/05 QC#59245 -->
                      FROM
                           PO_DTL_INFO        P
                          ,CM_ACRL_WRITE_OFF  A
                          <!-- del start 2022/08/05 QC#59245 -->
                          <!-- ,CM_AP_INV_DTL      B -->
                          <!-- ,PO_DTL             C -->
                          <!-- del end 2022/08/05 QC#59245 -->
                      WHERE
                              P.GLBL_CMPY_CD         = A.GLBL_CMPY_CD
                          AND P.PO_ORD_NUM           = A.PO_NUM
                          AND P.PO_ORD_DTL_LINE_NUM  = A.PO_ORD_DTL_LINE_NUM
                          AND A.WRT_OFF_FLG          = #flgOnY#
                          <iterate property="coaAcctCdList" var="coaAcctCd[]" open="AND A.COA_ACCT_CD IN (" close=")" conjunction= "," >
                              #coaAcctCd[]#
                          </iterate>
                          AND A.AJE_CM_INTFC_TP_CD   IS NULL
                          AND A.EZCANCELFLAG         = '0'
                          <!-- del start 2022/08/05 QC#59245 -->
                          <!--
                          AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD(+)
                          AND A.AP_VND_INV_NUM       = B.AP_VND_INV_NUM(+)
                          AND A.AP_VND_INV_LINE_NUM  = B.AP_VND_INV_LINE_NUM(+)
                          AND B.EZCANCELFLAG(+)      = '0'
                          AND A.GLBL_CMPY_CD         = C.GLBL_CMPY_CD(+)
                          AND A.PO_NUM               = C.PO_ORD_NUM(+)
                          AND A.PO_ORD_DTL_LINE_NUM  = C.PO_ORD_DTL_LINE_NUM(+)
                          AND C.EZCANCELFLAG(+)      = '0'
                          -->
                          <!-- del end 2022/08/05 QC#59245 -->
                     ) D
                 GROUP BY
                      D.PO_ORD_NUM
                     ,D.PO_ORD_DTL_LINE_NUM
                     ,D.WRT_OFF_DT
                 ) E
            GROUP BY
                 E.PO_ORD_NUM
                ,E.PO_ORD_DTL_LINE_NUM
        )        
        SELECT
             P.PO_ORD_NUM
            ,P.DS_PO_TP_DESC_TXT
            ,P.PO_HDR_STS_DESC_TXT
            ,P.PO_APVL_STS_DESC_TXT
            ,P.PO_DISP_LINE_NUM
            ,P.PO_LINE_TP_DESC_TXT
            ,P.MDSE_CD_A0
            ,P.MDSE_CD_A1
            ,P.SET_PO_ORD_DTL_LINE_NUM
            ,P.XX_MDSE_CD_A0
            ,P.XX_MDSE_CD_A1
            ,P.ASL_MDSE_CD
            ,P.MDSE_DESC_SHORT_TXT
            ,P.ENT_DEAL_NET_UNIT_PRC_AMT
            ,P.PO_DISP_QTY
            ,P.PO_SUBMT_DT
            ,P.SHIP_TO_CUST_CD
            ,P.SHIP_TO_LOC_NM
            ,P.DEST_RTL_WH_CD
            ,P.RQST_RTL_SWH_CD
            ,P.PO_MATCH_TP_DESC_TXT
            ,P.PO_LINE_STS_DESC_TXT
            ,P.ENT_PO_DTL_DEAL_NET_AMT
            ,P.PO_MDSE_CMPSN_TP_CD
            ,P.RCV_PO_QTY
            ,P.PO_INV_QTY
            ,P.PO_CANC_QTY
            ,P.SHPG_SVC_LVL_DESC_TXT
            ,P.PRCH_REQ_NUM
            ,P.PRCH_REQ_LINE_NUM
            ,P.TRX_REF_NUM
            ,P.TRX_REF_LINE_NUM
            ,P.ORIG_PO_ORD_NUM
            ,P.ORIG_DISP_PO_DTL_LINE_NUM
            ,P.PO_ACK_NUM
            ,P.PO_SEND_TS_A0
            ,P.PO_SEND_DT_A1
            ,P.VND_PO_ACK_STS_CD
            ,P.VND_PO_ACK_STS_DESC_TXT
            ,P.ORD_LAST_UPD_TS
            ,P.ORD_QTY
            ,P.XX_TOT_AMT
            ,P.ETD_DT
            ,P.ETA_DT
            ,P.VND_OTBD_CARR_NM
            ,P.PRO_NUM
            ,P.VND_SO_NUM
            ,P.VND_SO_SLP_NUM
            ,P.VND_INVTY_LOC_CD
            ,P.VND_SHIP_TO_CUST_LOC_NM
            ,P.VND_SELL_TO_CUST_LOC_NM
            ,P.THIS_MTH_FOB_COST_AMT
            ,P.VND_CHILD_BOM_PRC_AMT
            ,P.VND_CPO_ORD_NUM
            ,P.VND_ISS_PO_ORD_NUM
            ,P.VND_PO_ACK_LINE_STS_TXT
            ,P.VND_OTBD_CARR_CD
            ,P.VND_CPO_DTL_LINE_NUM
            ,P.VND_CPO_DTL_LINE_SUB_NUM
            ,P.COA_MDSE_TP_CD
            ,P.COA_PROD_CD
            ,P.PRNT_VND_CD
            ,P.PRNT_VND_NM
            ,P.VND_CD
            ,P.VND_NM
            ,CASE WHEN P.RCV_PO_QTY IS NULL THEN NULL ELSE NVL(W.RCV_WO_QTY, 0) END AS RCV_WO_QTY
            ,CASE WHEN P.PO_INV_QTY IS NULL THEN NULL ELSE NVL(W.INV_WO_QTY, 0) END AS INV_WO_QTY
            <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
            ,P.RQST_SHIP_DT
            <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
        FROM
             PO_DTL_INFO     P
            ,WRITE_OFF_INFO  W
        WHERE
                P.PO_ORD_NUM           = W.PO_ORD_NUM(+)
            AND P.PO_ORD_DTL_LINE_NUM  = W.PO_ORD_DTL_LINE_NUM(+)
        ORDER BY
             P.PO_ORD_NUM ASC
            ,TO_NUMBER(P.PO_ORD_DTL_LINE_NUM) ASC
        <!-- add end 2022/05/19 QC#57934 -->
    </statement>
    
    <statement id="getDispLevelPoAckSearchList" parameterClass="Map" resultMap="result.NPAL1510_ASMsg">
        <!-- add start 2022/05/19 QC#57934 -->
        WITH PO_DTL_INFO AS (
        <!-- add end 2022/05/19 QC#57934 -->
        SELECT
             SORT_INDEX
            ,PO_ORD_NUM
            ,DS_PO_TP_DESC_TXT
            ,PO_HDR_STS_DESC_TXT
            ,PO_APVL_STS_DESC_TXT
            ,PO_DISP_LINE_NUM
            ,PO_LINE_TP_DESC_TXT
            ,MDSE_CD_A0
            ,MDSE_CD_A1
            ,SET_PO_ORD_DTL_LINE_NUM
            ,XX_MDSE_CD_A0
            ,XX_MDSE_CD_A1
            ,ASL_MDSE_CD
            ,MDSE_DESC_SHORT_TXT
            ,ENT_DEAL_NET_UNIT_PRC_AMT
            ,PO_DISP_QTY
            ,SUBSTRB(PO_SUBMT_TS,1,8) AS PO_SUBMT_DT
            ,SHIP_TO_CUST_CD
            ,SHIP_TO_LOC_NM
            ,DEST_RTL_WH_CD
            ,RQST_RTL_SWH_CD
            ,PO_MATCH_TP_DESC_TXT
            ,PO_LINE_STS_DESC_TXT
            ,ENT_PO_DTL_DEAL_NET_AMT
            ,PO_MDSE_CMPSN_TP_CD
            ,RCV_PO_QTY
            ,PO_INV_QTY
            ,PO_CANC_QTY
            ,SHPG_SVC_LVL_DESC_TXT
            ,PRCH_REQ_NUM
            ,PRCH_REQ_LINE_NUM
            ,TRX_REF_NUM
            ,TRX_REF_LINE_NUM
            ,ORIG_PO_ORD_NUM
            ,ORIG_DISP_PO_DTL_LINE_NUM AS ORIG_DISP_PO_DTL_LINE_NUM
            ,PO_ACK_NUM
            ,SUBSTRB(PO_SEND_TS_A0,1,8) AS PO_SEND_TS_A0
            ,SUBSTRB(PO_SEND_DT_A1,1,8) AS PO_SEND_DT_A1
            ,VND_PO_ACK_STS_CD
            ,VND_PO_ACK_STS_DESC_TXT
            ,SUBSTRB(ORD_LAST_UPD_TS,1,8) AS ORD_LAST_UPD_TS
            ,ORD_QTY
            ,XX_TOT_AMT
            ,SUBSTRB(ETD_DT,1,8) AS ETD_DT
            ,SUBSTRB(ETA_DT,1,8) AS ETA_DT
            ,VND_OTBD_CARR_NM
            ,PRO_NUM
            ,VND_SO_NUM
            ,VND_SO_SLP_NUM
            ,VND_INVTY_LOC_CD
            ,VND_SHIP_TO_CUST_LOC_NM
            ,VND_SELL_TO_CUST_LOC_NM
            ,THIS_MTH_FOB_COST_AMT
            ,VND_CHILD_BOM_PRC_AMT
            ,VND_CPO_ORD_NUM
            ,VND_ISS_PO_ORD_NUM
            ,VND_PO_ACK_LINE_STS_TXT
            ,VND_OTBD_CARR_CD
            ,VND_CPO_DTL_LINE_NUM
            ,VND_CPO_DTL_LINE_SUB_NUM
            ,CARR_TRK_URL
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            ,COA_MDSE_TP_CD
            ,COA_PROD_CD
            ,PRNT_VND_CD
            ,PRNT_VND_NM
            ,VND_CD
            ,VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
            ,GLBL_CMPY_CD
            ,PO_ORD_DTL_LINE_NUM
            <!-- add end 2022/05/19 QC#57934 -->
            <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
            ,SUBSTRB(RQST_SHIP_DT,1,8) AS RQST_SHIP_DT
            <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
        FROM (
            ---------------------------------
            -- Header
            ---------------------------------
            SELECT 
                '1' AS SORT_INDEX
                ,P.PO_ORD_NUM
                ,DPT.DS_PO_TP_DESC_TXT
                ,PHS.PO_HDR_STS_DESC_TXT
                ,PAS.PO_APVL_STS_DESC_TXT
                ,NULL AS PO_DISP_LINE_NUM
                ,NULL AS PO_LINE_TP_DESC_TXT
                ,NULL AS MDSE_CD_A0
                ,NULL AS MDSE_CD_A1
                ,NULL AS SET_PO_ORD_DTL_LINE_NUM
                ,NULL AS XX_MDSE_CD_A0
                ,NULL AS XX_MDSE_CD_A1
                ,NULL AS ASL_MDSE_CD
                ,NULL AS MDSE_DESC_SHORT_TXT
                ,NULL AS ENT_DEAL_NET_UNIT_PRC_AMT
                ,NULL AS PO_DISP_QTY
                ,NULL AS PO_SUBMT_TS
                ,PD.SHIP_TO_CUST_CD
                ,PD.SHIP_TO_LOC_NM
                ,P.DEST_RTL_WH_CD
                ,NULL AS RQST_RTL_SWH_CD
                ,NULL AS PO_MATCH_TP_DESC_TXT
                ,NULL AS PO_LINE_STS_DESC_TXT
                ,NULL AS ENT_PO_DTL_DEAL_NET_AMT
                ,NULL AS PO_MDSE_CMPSN_TP_CD
                ,NULL AS RCV_PO_QTY
                ,NULL AS PO_INV_QTY
                ,NULL AS PO_CANC_QTY
                ,SSL.SHPG_SVC_LVL_DESC_TXT
                ,NVL((SELECT
                         PRD.PRCH_REQ_NUM
                     FROM
                         PRCH_REQ_DTL PRD
                     WHERE
                         PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                     AND PRD.PO_ORD_NUM   = PD.PO_ORD_NUM
                     AND PRD.EZCANCELFLAG = '0'
                     AND ROWNUM = 1)
                    , PD.PRCH_REQ_NUM) AS PRCH_REQ_NUM
                ,NULL AS PRCH_REQ_LINE_NUM
                ,PD.TRX_REF_NUM
                ,NULL AS TRX_REF_LINE_NUM
                ,PD.ORIG_PO_ORD_NUM
                ,NULL AS ORIG_DISP_PO_DTL_LINE_NUM
                ,NULL AS PO_ACK_NUM
                ,P.PO_SEND_TS AS PO_SEND_TS_A0
                ,NULL AS PO_SEND_DT_A1
                ,NULL AS VND_PO_ACK_STS_CD
                ,NULL AS VND_PO_ACK_STS_DESC_TXT
                ,NULL AS ORD_LAST_UPD_TS
                ,NULL AS ORD_QTY
                ,NULL AS XX_TOT_AMT
                ,NULL AS ETD_DT
                ,NULL AS ETA_DT
                ,NULL AS VND_OTBD_CARR_NM
                ,NULL AS PRO_NUM
                ,NULL AS VND_SO_NUM
                ,NULL AS VND_SO_SLP_NUM
                ,NULL AS VND_INVTY_LOC_CD
                ,NULL AS VND_SHIP_TO_CUST_LOC_NM
                ,NULL AS VND_SELL_TO_CUST_LOC_NM
                ,NULL AS THIS_MTH_FOB_COST_AMT
                ,NULL AS VND_CHILD_BOM_PRC_AMT
                ,NULL AS VND_CPO_ORD_NUM
                ,NULL AS VND_ISS_PO_ORD_NUM
                ,NULL AS VND_PO_ACK_LINE_STS_TXT
                ,NULL AS VND_OTBD_CARR_CD
                ,NULL AS VND_CPO_DTL_LINE_NUM
                ,NULL AS VND_CPO_DTL_LINE_SUB_NUM
                ,NULL AS CARR_TRK_URL
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                ,NULL AS COA_MDSE_TP_CD
                ,NULL AS COA_PROD_CD
                ,P.PRNT_VND_CD
                ,P.PRNT_VND_NM
                ,P.VND_CD
                ,P.VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                ,PD.GLBL_CMPY_CD
                ,NULL AS PO_ORD_DTL_LINE_NUM
            <!-- add end 2022/05/19 QC#57934 -->
            <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
                 ,PD.RQST_SHIP_DT
            <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
            FROM 
                 PO P
                ,PO_DTL PD
                ,SHPG_SVC_LVL SSL
                ,DS_PO_TP DPT
                ,PO_HDR_STS PHS
                ,PO_APVL_STS PAS
                ,AUTH_PSN AP
                ,RTL_WH RW
                ,SCE_SYS_USR_LIST SSUL
            WHERE 
                -- JOIN TO PO
                P.GLBL_CMPY_CD = #glblCmpyCd#
                AND P.EZCANCELFLAG = '0'
                <isNotNull property="msg.poOrdNum">
                AND P.PO_ORD_NUM LIKE #msg.poOrdNum#
                </isNotNull>
                <isNotNull property="msg.poOrdSrcCd_SL">
                AND P.PO_ORD_SRC_CD = #msg.poOrdSrcCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndCd">
                AND P.VND_CD = #msg.vndCd#
                </isNotNull>
                <isNotNull property="msg.vndNm">
                AND P.VND_NM LIKE #msg.vndNm#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_FR">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &gt;= #msg.poSubmtDt_FR#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_TO">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &lt;= #msg.poSubmtDt_TO#
                </isNotNull>
                <isNotNull property="msg.vndIssOrdNum">
                AND P.VND_ISS_ORD_NUM LIKE #msg.vndIssOrdNum#
                </isNotNull>
                <isNotNull property="msg.poHdrStsCd_SL">
                AND P.PO_HDR_STS_CD = #msg.poHdrStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.poApvlStsCd_SL">
                AND P.PO_APVL_STS_CD = #msg.poApvlStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.dsPoTpCd_SL">
                AND P.DS_PO_TP_CD = #msg.dsPoTpCd_SL#
                </isNotNull>
                <isNotNull property="msg.prntVndCd">
                AND P.PRNT_VND_CD = #msg.prntVndCd#
                </isNotNull>
                <isNotNull property="msg.prntVndNm">
                AND P.PRNT_VND_NM LIKE #msg.prntVndNm#
                </isNotNull>
                <isNotNull property="msg.destRtlWhCd">
                AND P.DEST_RTL_WH_CD = #msg.destRtlWhCd#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_FR">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &gt;= #msg.xxDt10Dt_FR#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_TO">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &lt;= #msg.xxDt10Dt_TO#
                </isNotNull>
                <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
                
                -- JOIN TO PO_DTL
                AND P.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                AND PD.EZCANCELFLAG = '0'
                AND P.PO_ORD_NUM = PD.PO_ORD_NUM
                AND PD.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
                <!-- START 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isNotNull property="msg.prchReqNum">
                AND (PD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                            PRCH_REQ_DTL PRD
                        WHERE
                            PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                        AND PRD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                        AND PRD.PO_ORD_NUM   = P.PO_ORD_NUM
                        AND PRD.EZCANCELFLAG = '0'
                    )
                )
                </isNotNull>
                <!-- END 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
                
                -- LEFT JOIN TO SHPG_SVC_LVL
                AND PD.GLBL_CMPY_CD = SSL.GLBL_CMPY_CD(+)
                AND SSL.EZCANCELFLAG(+) = '0'
                AND PD.SHPG_SVC_LVL_CD = SSL.SHPG_SVC_LVL_CD(+)
                
                -- LEFT JOIN TO DS_PO_TP
                AND P.GLBL_CMPY_CD = DPT.GLBL_CMPY_CD(+)
                AND DPT.EZCANCELFLAG(+) = '0'
                AND P.DS_PO_TP_CD = DPT.DS_PO_TP_CD(+)
                
                -- LEFT JOIN TO PO_HDR_STS
                AND P.GLBL_CMPY_CD = PHS.GLBL_CMPY_CD
                AND PHS.EZCANCELFLAG(+) = '0'
                AND P.PO_HDR_STS_CD = PHS.PO_HDR_STS_CD(+)
                
                -- LEFT JOIN TO PO_APVL_STS
                AND P.GLBL_CMPY_CD = PAS.GLBL_CMPY_CD(+)
                AND PAS.EZCANCELFLAG(+) = '0'
                AND P.PO_APVL_STS_CD = PAS.PO_APVL_STS_CD(+)
                
                -- LEFT JOIN TO AUTH_PSN
                AND P.GLBL_CMPY_CD = AP.GLBL_CMPY_CD(+)
                AND AP.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = AP.USR_NM(+)
                
                -- LEFT JOIN TO SCE_SYS_USR_LIST
                AND P.GLBL_CMPY_CD = SSUL.GLBL_CMPY_CD(+)
                AND SSUL.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = SSUL.FULL_PSN_NM(+)
                <isNotNull property="msg.fullPsnNm">
                AND
                    (
                    UPPER(AP.FIRST_NM || (NVL2(AP.MID_NM, ' '||AP.MID_NM||' ', ' ')) || AP.LAST_NM) LIKE UPPER(#msg.fullPsnNm#)
                    OR
                    UPPER(SSUL.FULL_PSN_NM) LIKE UPPER(#msg.fullPsnNm#)
                    )
                </isNotNull>
                
                -- LEFT JOIN TO RTL_WH
                AND P.GLBL_CMPY_CD(+) = RW.GLBL_CMPY_CD
                AND RW.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD(+) = RW.RTL_WH_CD
                <isNotNull property="msg.rtlWhNm">
                AND RW.RTL_WH_NM(+) LIKE #msg.rtlWhNm#
                </isNotNull>
                <isEqual property="searchCond1" compareValue="1">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                         PO_DTL E1_PD
                        ,RTL_SWH E1_RS
                    WHERE 
                        -- JOIN TO PO_DTL
                        P.GLBL_CMPY_CD = E1_PD.GLBL_CMPY_CD
                    AND E1_PD.EZCANCELFLAG = '0'    
                    AND P.PO_ORD_NUM = E1_PD.PO_ORD_NUM
                    <isNotNull property="msg.shpgSvcLvlCd_SL">
                    AND E1_PD.SHPG_SVC_LVL_CD = #msg.shpgSvcLvlCd_SL#
                    </isNotNull>
                    <isNotNull property="msg.shipToCustCd">
                    AND E1_PD.SHIP_TO_CUST_CD = #msg.shipToCustCd#
                    </isNotNull>
                    <isNotNull property="msg.shipToCustLocNm">
                    AND E1_PD.SHIP_TO_LOC_NM LIKE #msg.shipToCustLocNm#
                    </isNotNull>
                    <isNotNull property="msg.mdseCd">
                    AND E1_PD.ORIG_MDSE_CD LIKE #msg.mdseCd#
                    </isNotNull>
                    <isNotNull property="msg.mdseCd_SB">
                    AND E1_PD.MDSE_CD LIKE #msg.mdseCd_SB#
                    </isNotNull>
                    <isNotNull property="msg.trxRefNum">
                    AND E1_PD.TRX_REF_NUM LIKE #msg.trxRefNum#
                    </isNotNull>
                    <isNotNull property="msg.destRtlSwhCd">
                    AND E1_PD.DEST_RTL_SWH_CD LIKE #msg.destRtlSwhCd#
                    </isNotNull>
                    <isNotNull property="msg.poLineStsCd_SL">
                    AND E1_PD.PO_LINE_STS_CD = #msg.poLineStsCd_SL#
                    </isNotNull>
                    <isNotNull property="msg.vndPoAckStsCd_SL">
                    AND E1_PD.VND_PO_ACK_STS_CD = #msg.vndPoAckStsCd_SL#
                    </isNotNull>
                    <isNotNull property="msg.proNum">
                    AND E1_PD.PRO_NUM LIKE #msg.proNum#
                    </isNotNull>
                    <isNotNull property="msg.vndInvtyLocCd">
                    AND E1_PD.VND_INVTY_LOC_CD LIKE #msg.vndInvtyLocCd#
                    </isNotNull>
                    <isNotNull property="msg.aslMdseCd">
                    AND E1_PD.ASL_MDSE_CD LIKE #msg.aslMdseCd#
                    </isNotNull>
                    
                    -- LEFT JOIN TO RTL_SWH
                    AND P.GLBL_CMPY_CD = E1_RS.GLBL_CMPY_CD(+)
                    AND E1_RS.EZCANCELFLAG(+) = '0'
                    AND P.DEST_RTL_WH_CD = E1_RS.RTL_WH_CD(+)
                    AND E1_PD.DEST_RTL_SWH_CD = E1_RS.RTL_SWH_CD(+)
                    <isNotNull property="msg.rtlSwhNm">
                    AND E1_RS.RTL_SWH_NM LIKE #msg.rtlSwhNm#
                    </isNotNull>
                )
                </isEqual>
                <isEqual property="searchCond2" compareValue="1">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                         PO_ACK_HDR E2_PAH
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                    ,PO_ACK_DTL E2_PAD -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                    WHERE 
                        -- JOIN TO PO_ACK_HDR
                        P.GLBL_CMPY_CD = E2_PAH.GLBL_CMPY_CD
                    AND E2_PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAH.PO_ORD_NUM
                    <isNotNull property="msg.xxOrdDt_FR">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &gt;= #msg.xxOrdDt_FR#
                    </isNotNull>
                    <isNotNull property="msg.xxOrdDt_TO">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &lt;= #msg.xxOrdDt_TO#
                    </isNotNull>
                    
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                AND E2_PAH.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD -->
<!--                AND E2_PAD.EZCANCELFLAG = '0' -->
<!--                AND E2_PAH.PO_ACK_HDR_PK = E2_PAD.PO_ACK_HDR_PK -->
<!--                <isNotNull property="msg.vndSoNum"> -->
<!--                AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum# -->
<!--                </isNotNull> -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                )
                </isEqual>
<!-- START 02/10/2020 T.Ogura [QC#55712,ADD] -->
                <isNotNull property="msg.vndSoNum">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                        PO_ACK_DTL E2_PAD
                    WHERE 
                        P.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD
                    AND E2_PAD.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAD.PO_ORD_NUM
                    AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum#
                )
                </isNotNull>
<!-- END   02/10/2020 T.Ogura [QC#55712,ADD] -->
            ---------------------------------
            -- Detail
            ---------------------------------
            UNION ALL SELECT /*+ USE_NL(P PD) LEADING(P PD) */
                '2' AS SORT_INDEX
                ,P.PO_ORD_NUM
                ,NULL AS DS_PO_TP_DESC_TXT
                ,NULL AS PO_HDR_STS_DESC_TXT
                ,NULL AS PO_APVL_STS_DESC_TXT
                ,TO_NUMBER(PD.DISP_PO_DTL_LINE_NUM) AS PO_DISP_LINE_NUM
                ,PLT.PO_LINE_TP_DESC_TXT
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                --,PD.ORIG_MDSE_CD AS MDSE_CD_A0
                ,DECODE(
                    AMV.MDSE_ITEM_TP_CD
                   ,#mdseItemTpCdTextItem#
                   ,NULL
                   ,PD.ORIG_MDSE_CD
                 ) MDSE_CD_A0
                 ,NULL AS MDSE_CD_A1
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,PD.SET_PO_ORD_DTL_LINE_NUM
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                --,PD.MDSE_CD AS XX_MDSE_CD_A0
                ,DECODE(
                    AMV.MDSE_ITEM_TP_CD
                   ,#mdseItemTpCdTextItem#
                   ,NULL
                   ,PD.MDSE_CD
                 ) XX_MDSE_CD_A0
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,CASE WHEN PD.MDSE_CD &lt;&gt; PD.ORIG_MDSE_CD THEN PD.ORIG_MDSE_CD ELSE NULL END AS XX_MDSE_CD_A1
                ,PD.ASL_MDSE_CD
                <!-- 2019/09/23 QC#53271 Update -->
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                --,AMV.MDSE_DESC_SHORT_TXT
                <!-- ,DECODE(
                    AMV.MDSE_ITEM_TP_CD
                   ,#mdseItemTpCdTextItem#
                   ,PD.MDSE_DESC_SHORT_TXT
                   ,AMV.MDSE_DESC_SHORT_TXT
                 ) MDSE_DESC_SHORT_TXT
                -->
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,CASE WHEN PD.PO_LINE_TP_CD IN(#poLineTpCdExpense#, #poLineTpCdExpenseWReceipt#) THEN NVL(PD.MDSE_DESC_SHORT_TXT, AMV.MDSE_DESC_SHORT_TXT)
                       ELSE AMV.MDSE_DESC_SHORT_TXT
                 END AS MDSE_DESC_SHORT_TXT
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.ENT_DEAL_NET_UNIT_PRC_AMT END AS ENT_DEAL_NET_UNIT_PRC_AMT
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_DISP_QTY END AS PO_DISP_QTY
                ,P.PO_SUBMT_TS
                ,PD.SHIP_TO_CUST_CD
                ,PD.SHIP_TO_LOC_NM
                ,P.DEST_RTL_WH_CD
                ,PD.DEST_RTL_SWH_CD AS RQST_RTL_SWH_CD
                ,PMT.PO_MATCH_TP_DESC_TXT
                ,PLS.PO_LINE_STS_DESC_TXT
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.ENT_PO_DTL_DEAL_NET_AMT END AS ENT_PO_DTL_DEAL_NET_AMT
                ,PD.PO_MDSE_CMPSN_TP_CD
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_RCV_QTY END AS RCV_PO_QTY
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_INV_QTY END AS PO_INV_QTY
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_CANC_QTY END AS PO_CANC_QTY
                ,SSL.SHPG_SVC_LVL_DESC_TXT
                ,NVL((SELECT
                         PRD.PRCH_REQ_NUM
                     FROM
                         PRCH_REQ_DTL PRD
                     WHERE
                         PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                     AND PRD.PO_ORD_NUM   = PD.PO_ORD_NUM
                     AND PRD.EZCANCELFLAG = '0'
                     AND ROWNUM = 1)
                    , PD.PRCH_REQ_NUM) AS PRCH_REQ_NUM
                ,NVL((SELECT
                         PRD.PRCH_REQ_LINE_NUM
                     FROM
                         PRCH_REQ_DTL PRD
                     WHERE
                         PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                     AND PRD.PO_ORD_NUM   = PD.PO_ORD_NUM
                     AND PRD.PO_ORD_DTL_LINE_NUM   = PD.PO_ORD_DTL_LINE_NUM
                     AND PRD.EZCANCELFLAG = '0'
                     AND ROWNUM = 1)
                    , PD.PRCH_REQ_LINE_NUM) AS PRCH_REQ_LINE_NUM
                ,PD.TRX_REF_NUM
                ,PD.TRX_REF_LINE_NUM
                ,CASE WHEN PD.PO_ORD_NUM &lt;&gt; PD.ORIG_PO_ORD_NUM THEN PD.ORIG_PO_ORD_NUM ELSE NULL END AS ORIG_PO_ORD_NUM
                ,CASE WHEN PD.DISP_PO_DTL_LINE_NUM &lt;&gt; PD.ORIG_DISP_PO_DTL_LINE_NUM THEN PD.ORIG_DISP_PO_DTL_LINE_NUM ELSE NULL END AS ORIG_DISP_PO_DTL_LINE_NUM
                ,'0' PO_ACK_NUM
                ,P.PO_SEND_TS AS PO_SEND_TS_A0
                ,PD.PO_SEND_TS AS PO_SEND_DT_A1
                ,NULL AS VND_PO_ACK_STS_CD
                ,NULL AS VND_PO_ACK_STS_DESC_TXT
                ,NULL AS ORD_LAST_UPD_TS
                ,NULL AS ORD_QTY
                ,NULL AS XX_TOT_AMT
                ,NULL AS ETD_DT
                ,NULL AS ETA_DT
                ,NULL AS VND_OTBD_CARR_NM
                ,PD.PRO_NUM
                ,NULL AS VND_SO_NUM
                ,NULL AS VND_SO_SLP_NUM
                ,PD.VND_INVTY_LOC_CD
                ,NULL AS VND_SHIP_TO_CUST_LOC_NM
                ,NULL AS VND_SELL_TO_CUST_LOC_NM
                ,NULL AS THIS_MTH_FOB_COST_AMT
                ,NULL AS VND_CHILD_BOM_PRC_AMT
                ,P.VND_ISS_ORD_NUM
                ,PD.VND_ISS_PO_ORD_NUM AS VND_CPO_ORD_NUM
                ,NULL AS VND_PO_ACK_LINE_STS_TXT
                ,NULL AS VND_OTBD_CARR_CD
                ,NULL AS VND_CPO_DTL_LINE_NUM
                ,NULL AS VND_CPO_DTL_LINE_SUB_NUM
                ,NULL AS CARR_TRK_URL
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                ,AMV.COA_MDSE_TP_CD
                ,AMV.COA_PROD_CD
                ,P.PRNT_VND_CD
                ,P.PRNT_VND_NM
                ,P.VND_CD
                ,P.VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                ,PD.GLBL_CMPY_CD
                ,PD.PO_ORD_DTL_LINE_NUM
            <!-- add end 2022/05/19 QC#57934 -->
            <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
                 ,PD.RQST_SHIP_DT
            <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
            FROM 
                PO P
                ,PO_DTL PD
                ,SHPG_SVC_LVL SSL
                ,PO_MATCH_TP PMT
                ,PO_LINE_TP PLT
                ,PO_LINE_STS PLS
                ,AUTH_PSN AP
                ,RTL_WH RW
                ,MDSE AMV
                ,RTL_SWH RS
                ,SCE_SYS_USR_LIST SSUL
            WHERE 
                -- JOIN TO PO
                P.GLBL_CMPY_CD = #glblCmpyCd#
                AND P.EZCANCELFLAG = '0'
                <isNotNull property="msg.poOrdNum">
                AND P.PO_ORD_NUM LIKE #msg.poOrdNum#
                </isNotNull>
                <isNotNull property="msg.poOrdSrcCd_SL">
                AND P.PO_ORD_SRC_CD = #msg.poOrdSrcCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndCd">
                AND P.VND_CD = #msg.vndCd#
                </isNotNull>
                <isNotNull property="msg.vndNm">
                AND P.VND_NM LIKE #msg.vndNm#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_FR">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &gt;= #msg.poSubmtDt_FR#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_TO">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &lt;= #msg.poSubmtDt_TO#
                </isNotNull>
                <isNotNull property="msg.vndIssOrdNum">
                AND P.VND_ISS_ORD_NUM LIKE #msg.vndIssOrdNum#
                </isNotNull>
                <isNotNull property="msg.poHdrStsCd_SL">
                AND P.PO_HDR_STS_CD = #msg.poHdrStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.poApvlStsCd_SL">
                AND P.PO_APVL_STS_CD = #msg.poApvlStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.dsPoTpCd_SL">
                AND P.DS_PO_TP_CD = #msg.dsPoTpCd_SL#
                </isNotNull>
                <isNotNull property="msg.prntVndCd">
                AND P.PRNT_VND_CD = #msg.prntVndCd#
                </isNotNull>
                <isNotNull property="msg.prntVndNm">
                AND P.PRNT_VND_NM LIKE #msg.prntVndNm#
                </isNotNull>
                <isNotNull property="msg.destRtlWhCd">
                AND P.DEST_RTL_WH_CD = #msg.destRtlWhCd#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_FR">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &gt;= #msg.xxDt10Dt_FR#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_TO">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &lt;= #msg.xxDt10Dt_TO#
                </isNotNull>
                <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
                -- JOIN TO PO_DTL
                AND P.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                AND PD.EZCANCELFLAG = '0'
                AND P.PO_ORD_NUM = PD.PO_ORD_NUM
                <!-- START 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isNotNull property="msg.prchReqNum">
                AND (PD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                            PRCH_REQ_DTL PRD
                        WHERE
                            PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                        AND PRD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                        AND PRD.PO_ORD_NUM   = P.PO_ORD_NUM
                        AND PRD.EZCANCELFLAG = '0'
                    )
                )
                </isNotNull>
                <!-- END 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isEqual property="searchCond1" compareValue="1">
                <isNotNull property="msg.shpgSvcLvlCd_SL">
                AND PD.SHPG_SVC_LVL_CD = #msg.shpgSvcLvlCd_SL#
                </isNotNull>
                <isNotNull property="msg.shipToCustCd">
                AND PD.SHIP_TO_CUST_CD = #msg.shipToCustCd#
                </isNotNull>
                <isNotNull property="msg.shipToCustLocNm">
                AND PD.SHIP_TO_LOC_NM LIKE #msg.shipToCustLocNm#
                </isNotNull>
                <isNotNull property="msg.mdseCd">
                AND PD.ORIG_MDSE_CD LIKE #msg.mdseCd#
                </isNotNull>
                <isNotNull property="msg.mdseCd_SB">
                AND PD.MDSE_CD LIKE #msg.mdseCd_SB#
                </isNotNull>
                </isEqual>
                <isEqual property="searchCond1" compareValue="1">
                <isNotNull property="msg.trxRefNum">
                AND PD.TRX_REF_NUM LIKE #msg.trxRefNum#
                </isNotNull>
                <isNotNull property="msg.destRtlSwhCd">
                AND PD.DEST_RTL_SWH_CD LIKE #msg.destRtlSwhCd#
                </isNotNull>
                <isNotNull property="msg.poLineStsCd_SL">
                AND PD.PO_LINE_STS_CD = #msg.poLineStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndPoAckStsCd_SL">
                AND PD.VND_PO_ACK_STS_CD = #msg.vndPoAckStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.proNum">
                AND PD.PRO_NUM LIKE #msg.proNum#
                </isNotNull>
                <isNotNull property="msg.vndInvtyLocCd">
                AND PD.VND_INVTY_LOC_CD LIKE #msg.vndInvtyLocCd#
                </isNotNull>
                <isNotNull property="msg.aslMdseCd">
                AND PD.ASL_MDSE_CD LIKE #msg.aslMdseCd#
                </isNotNull>
                </isEqual>
                <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
                -- LEFT JOIN TO SHPG_SVC_LVL
                AND PD.GLBL_CMPY_CD = SSL.GLBL_CMPY_CD(+)
                AND SSL.EZCANCELFLAG(+) = '0'
                AND PD.SHPG_SVC_LVL_CD = SSL.SHPG_SVC_LVL_CD(+)
                -- LEFT JOIN TO PO_MATCH_TP
                AND PD.GLBL_CMPY_CD = PMT.GLBL_CMPY_CD(+)
                AND PMT.EZCANCELFLAG(+) = '0'
                AND PD.PO_MATCH_TP_CD = PMT.PO_MATCH_TP_CD(+)
                -- LEFT JOIN TO PO_LINE_TP
                AND PD.GLBL_CMPY_CD = PLT.GLBL_CMPY_CD(+)
                AND PLT.EZCANCELFLAG(+) = '0'
                AND PD.PO_LINE_TP_CD = PLT.PO_LINE_TP_CD(+)
                -- LEFT JOIN TO PO_LINE_STS
                AND PD.GLBL_CMPY_CD = PLS.GLBL_CMPY_CD(+)
                AND PLS.EZCANCELFLAG(+) = '0'
                AND PD.PO_LINE_STS_CD = PLS.PO_LINE_STS_CD(+)
                -- LEFT JOIN TO AUTH_PSN
                AND P.GLBL_CMPY_CD = AP.GLBL_CMPY_CD(+)
                AND AP.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = AP.USR_NM(+)
                -- LEFT JOIN TO SCE_SYS_USR_LIST
                AND P.GLBL_CMPY_CD = SSUL.GLBL_CMPY_CD(+)
                AND SSUL.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = SSUL.FULL_PSN_NM(+)
                <isNotNull property="msg.fullPsnNm">
                AND
                    (
                    UPPER(AP.FIRST_NM || (NVL2(AP.MID_NM, ' '||AP.MID_NM||' ', ' ')) || AP.LAST_NM) LIKE UPPER(#msg.fullPsnNm#)
                    OR
                    UPPER(SSUL.FULL_PSN_NM) LIKE UPPER(#msg.fullPsnNm#)
                    )
                </isNotNull>
                -- LEFT JOIN TO RTL_WH
                AND P.GLBL_CMPY_CD = RW.GLBL_CMPY_CD(+)
                AND RW.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD = RW.RTL_WH_CD(+)
                -- LEFT JOIN TO ALL_MDSE_V
                AND PD.GLBL_CMPY_CD = AMV.GLBL_CMPY_CD(+)
                AND AMV.EZCANCELFLAG(+) = '0'
                AND PD.ORIG_MDSE_CD = AMV.MDSE_CD(+)
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                <isNotNull property="msg.coaMdseTpCd">
                AND AMV.COA_MDSE_TP_CD LIKE #msg.coaMdseTpCd#
                </isNotNull>
                <isNotNull property="msg.coaProdCd">
                AND AMV.COA_PROD_CD LIKE #msg.coaProdCd#
                </isNotNull>
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                <isNotNull property="msg.rtlWhNm">
                AND RW.RTL_WH_NM LIKE #msg.rtlWhNm#
                </isNotNull>
                -- LEFT JOIN TO RTL_SWH
                AND P.GLBL_CMPY_CD = RS.GLBL_CMPY_CD(+)
                AND RS.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD = RS.RTL_WH_CD(+)
                AND PD.DEST_RTL_SWH_CD = RS.RTL_SWH_CD(+)
                <isEqual property="searchCond1" compareValue="1">
                <isNotNull property="msg.rtlSwhNm">
                AND RS.RTL_SWH_NM LIKE #msg.rtlSwhNm#
                </isNotNull>
                </isEqual>
                <isEqual property="searchCond2" compareValue="1">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                         PO_ACK_HDR E2_PAH
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                    ,PO_ACK_DTL E2_PAD -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                    WHERE 
                        -- JOIN TO PO_ACK_HDR
                        P.GLBL_CMPY_CD = E2_PAH.GLBL_CMPY_CD
                    AND E2_PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAH.PO_ORD_NUM
                    <isNotNull property="msg.xxOrdDt_FR">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &gt;= #msg.xxOrdDt_FR#
                    </isNotNull>
                    <isNotNull property="msg.xxOrdDt_TO">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &lt;= #msg.xxOrdDt_TO#
                    </isNotNull>
                    
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                AND P.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD -->
<!--                AND E2_PAD.EZCANCELFLAG = '0' -->
<!--                AND E2_PAH.PO_ACK_HDR_PK = E2_PAD.PO_ACK_HDR_PK -->
<!--                <isNotNull property="msg.vndSoNum"> -->
<!--                AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum# -->
<!--                </isNotNull> -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                )
                </isEqual>
<!-- START 02/10/2020 T.Ogura [QC#55712,ADD] -->
                <isNotNull property="msg.vndSoNum">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                        PO_ACK_DTL E2_PAD
                    WHERE 
                        P.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD
                    AND E2_PAD.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAD.PO_ORD_NUM
                    AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum#
                )
                </isNotNull>
<!-- END   02/10/2020 T.Ogura [QC#55712,ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                <isNotEqual property="msg.xxChkBox_H1" compareValue="Y">
                AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            CM_ACRL_WRITE_OFF A
                        WHERE
                                PD.PO_MDSE_CMPSN_TP_CD = #poMdseCmpsnTpRegular#
                            AND A.GLBL_CMPY_CD         = PD.GLBL_CMPY_CD
                            AND A.PO_NUM               = PD.PO_ORD_NUM
                            AND A.PO_ORD_DTL_LINE_NUM  = PD.PO_ORD_DTL_LINE_NUM
                            AND A.WRT_OFF_FLG          = #flgOnY#
                            <iterate property="coaAcctCdList" var="coaAcctCd[]" open="AND A.COA_ACCT_CD IN (" close=")" conjunction= "," >
                                #coaAcctCd[]#
                            </iterate>
                            AND A.AJE_CM_INTFC_TP_CD   IS NULL
                            AND A.EZCANCELFLAG         = '0'
                            AND NOT EXISTS (
                                    SELECT
                                        1
                                    FROM
                                         RWS_HDR  B
                                        ,RWS_DTL  C
                                        ,RWS_STS  D
                                    WHERE
                                            B.GLBL_CMPY_CD        = A.GLBL_CMPY_CD
                                        AND B.PO_RCV_TRX_HDR_NUM  = A.PO_NUM
                                        AND B.EZCANCELFLAG        = '0'
                                        AND B.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
                                        AND B.RWS_NUM             = C.RWS_NUM
                                        AND C.PO_RCV_TRX_LINE_NUM = A.PO_ORD_DTL_LINE_NUM
                                        AND C.EZCANCELFLAG        = '0'
                                        AND C.GLBL_CMPY_CD        = D.GLBL_CMPY_CD
                                        AND C.RWS_STS_CD          = D.RWS_STS_CD
                                        AND D.RWS_OPEN_FLG        = #flgOnY#
                                        AND D.EZCANCELFLAG        = '0'
                                )
                    )
                </isNotEqual>
            <!-- add end 2022/05/19 QC#57934 -->
            ---------------------------------
            -- ACK
            ---------------------------------
            UNION ALL SELECT /*+ USE_NL(P PD PAD PAH) LEADING(P PD PAD PAH) */
                '3' AS SORT_INDEX
                ,P.PO_ORD_NUM
                ,NULL AS DS_PO_TP_DESC_TXT
                ,NULL AS PO_HDR_STS_DESC_TXT
                ,NULL AS PO_APVL_STS_DESC_TXT
                ,TO_NUMBER(PD.DISP_PO_DTL_LINE_NUM) AS PO_DISP_LINE_NUM
                ,NULL AS PO_LINE_TP_DESC_TXT
                ,NULL AS MDSE_CD_A0
                ,NULL AS MDSE_CD_A1
                ,NULL AS SET_PO_ORD_DTL_LINE_NUM
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                --,PAD.MDSE_CD AS XX_MDSE_CD_A0
                ,DECODE(
                    AMV.MDSE_ITEM_TP_CD
                   ,#mdseItemTpCdTextItem#
                   ,NULL
                   ,PAD.MDSE_CD
                 ) XX_MDSE_CD_A0
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,NULL AS XX_MDSE_CD_A1
                ,NULL AS ASL_MDSE_CD
                ,NULL AS MDSE_DESC_SHORT_TXT
                ,NULL AS ENT_DEAL_NET_UNIT_PRC_AMT
                ,NULL AS PO_MDSE_CMPSN_TP_CD
                ,NULL AS PO_DISP_QTY
                ,NULL AS PO_SUBMT_TS
                ,NULL AS SHIP_TO_CUST_CD
                ,NULL AS SHIP_TO_LOC_NM
                ,NULL AS DEST_RTL_WH_CD
                ,NULL AS RQST_RTL_SWH_CD
                ,NULL AS PO_MATCH_TP_DESC_TXT
                ,NULL AS PO_LINE_STS_DESC_TXT
                ,NULL AS ENT_PO_DTL_DEAL_NET_AMT
                ,NULL AS RCV_PO_QTY
                ,NULL AS PO_INV_QTY
                ,NULL AS PO_CANC_QTY
                ,NULL AS SHPG_SVC_LVL_DESC_TXT
                ,NULL AS PRCH_REQ_NUM
                ,NULL AS PRCH_REQ_LINE_NUM
                ,NULL AS TRX_REF_NUM
                ,NULL AS TRX_REF_LINE_NUM
                ,NULL AS ORIG_PO_ORD_NUM
                ,NULL AS ORIG_DISP_PO_DTL_LINE_NUM
                ,PAH.PO_ACK_NUM
                ,NULL AS PO_SEND_TS_A0
                ,NULL AS PO_SEND_DT_A1
                ,PAD.VND_PO_ACK_STS_CD
                ,VPAC.VND_PO_ACK_STS_DESC_TXT
                ,PAH.ORD_LAST_UPD_TS
                ,PAD.ORD_QTY
                ,(PAD.THIS_MTH_FOB_COST_AMT * PAD.ORD_QTY) AS XX_TOT_AMT
                ,PAD.ETD_DT
                ,PAD.ETA_DT
                ,PAD.VND_OTBD_CARR_NM
                ,PAD.PRO_NUM
                ,PAD.VND_SO_NUM
                ,PAD.VND_SO_SLP_NUM
                ,PAD.VND_INVTY_LOC_CD
                ,PAD.VND_SHIP_TO_CUST_LOC_NM
                ,PAD.VND_SELL_TO_CUST_LOC_NM
                ,PAD.THIS_MTH_FOB_COST_AMT
                ,PAD.VND_CHILD_BOM_PRC_AMT
                ,PAD.VND_CPO_ORD_NUM
                ,PAD.VND_ISS_PO_ORD_NUM AS VND_CPO_ORD_NUM
                ,PAD.VND_PO_ACK_LINE_STS_TXT
                ,PAD.VND_OTBD_CARR_CD
                ,PAD.VND_CPO_DTL_LINE_NUM
                ,PAD.VND_CPO_DTL_LINE_SUB_NUM
                ,CU.CARR_TRK_URL
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                ,AMV.COA_MDSE_TP_CD
                ,AMV.COA_PROD_CD
                ,P.PRNT_VND_CD
                ,P.PRNT_VND_NM
                ,P.VND_CD
                ,P.VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                ,PD.GLBL_CMPY_CD
                ,NULL AS PO_ORD_DTL_LINE_NUM
            <!-- add end 2022/05/19 QC#57934 -->
             <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
                 ,PD.RQST_SHIP_DT
            <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
            FROM
                PO P
                ,PO_DTL PD
                ,PO_ACK_HDR PAH
                ,PO_ACK_DTL PAD
                ,VND_PO_ACK_STS VPAC
                ,RTL_SWH RS
                ,AUTH_PSN AP
                ,RTL_WH RW
                ,CARR_URL CU
                ,SCE_SYS_USR_LIST SSUL
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,MDSE AMV
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
            WHERE
                -- JOIN TO PO
                P.GLBL_CMPY_CD = #glblCmpyCd#
                AND P.EZCANCELFLAG = '0'
                <isNotNull property="msg.poOrdNum">
                AND P.PO_ORD_NUM LIKE #msg.poOrdNum#
                </isNotNull>
                <isNotNull property="msg.poOrdSrcCd_SL">
                AND P.PO_ORD_SRC_CD = #msg.poOrdSrcCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndCd">
                AND P.VND_CD = #msg.vndCd#
                </isNotNull>
                <isNotNull property="msg.vndNm">
                AND P.VND_NM LIKE #msg.vndNm#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_FR">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &gt;= #msg.poSubmtDt_FR#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_TO">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &lt;= #msg.poSubmtDt_TO#
                </isNotNull>
                <isNotNull property="msg.vndIssOrdNum">
                AND P.VND_ISS_ORD_NUM LIKE #msg.vndIssOrdNum#
                </isNotNull>
                <isNotNull property="msg.poHdrStsCd_SL">
                AND P.PO_HDR_STS_CD = #msg.poHdrStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.poApvlStsCd_SL">
                AND P.PO_APVL_STS_CD = #msg.poApvlStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.dsPoTpCd_SL">
                AND P.DS_PO_TP_CD = #msg.dsPoTpCd_SL#
                </isNotNull>
                <isNotNull property="msg.prntVndCd">
                AND P.PRNT_VND_CD = #msg.prntVndCd#
                </isNotNull>
                <isNotNull property="msg.prntVndNm">
                AND P.PRNT_VND_NM LIKE #msg.prntVndNm#
                </isNotNull>
                <isNotNull property="msg.destRtlWhCd">
                AND P.DEST_RTL_WH_CD = #msg.destRtlWhCd#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_FR">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &gt;= #msg.xxDt10Dt_FR#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_TO">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &lt;= #msg.xxDt10Dt_TO#
                </isNotNull>
                <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
                
                -- JOIN TO PO_DTL
                AND P.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                AND PD.EZCANCELFLAG = '0'
                AND P.PO_ORD_NUM = PD.PO_ORD_NUM
                <!-- START 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isNotNull property="msg.prchReqNum">
                AND (PD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                            PRCH_REQ_DTL PRD
                        WHERE
                            PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                        AND PRD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                        AND PRD.PO_ORD_NUM   = P.PO_ORD_NUM
                        AND PRD.EZCANCELFLAG = '0'
                    )
                )
                </isNotNull>
                <!-- END 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isNotNull property="msg.shpgSvcLvlCd_SL">
                AND PD.SHPG_SVC_LVL_CD = #msg.shpgSvcLvlCd_SL#
                </isNotNull>
                <isNotNull property="msg.shipToCustCd">
                AND PD.SHIP_TO_CUST_CD = #msg.shipToCustCd#
                </isNotNull>
                <isNotNull property="msg.shipToCustLocNm">
                AND PD.SHIP_TO_LOC_NM LIKE #msg.shipToCustLocNm#
                </isNotNull>
                <isNotNull property="msg.mdseCd_SB">
                AND PD.MDSE_CD LIKE #msg.mdseCd_SB#
                </isNotNull>
                <isNotNull property="msg.trxRefNum">
                AND PD.TRX_REF_NUM LIKE #msg.trxRefNum#
                </isNotNull>
                <isNotNull property="msg.destRtlSwhCd">
                AND PD.DEST_RTL_SWH_CD = #msg.destRtlSwhCd#
                </isNotNull>
                <isNotNull property="msg.poLineStsCd_SL">
                AND PD.PO_LINE_STS_CD = #msg.poLineStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.aslMdseCd">
                AND PD.ASL_MDSE_CD LIKE #msg.aslMdseCd#
                </isNotNull>
                <isNotNull property="msg.mdseCd">
                AND PD.ORIG_MDSE_CD LIKE #msg.mdseCd#
                </isNotNull>
                <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
                
                -- JOIN TO PO_ACK_HDR
                AND P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                AND PAH.EZCANCELFLAG = '0'
                AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                <isNotNull property="msg.xxOrdDt_FR">
                AND SUBSTRB(PAH.ORD_LAST_UPD_TS,1,8) &gt;= #msg.xxOrdDt_FR#
                </isNotNull>
                <isNotNull property="msg.xxOrdDt_TO">
                AND SUBSTRB(PAH.ORD_LAST_UPD_TS,1,8) &lt;= #msg.xxOrdDt_TO#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_FR">
                AND SUBSTRB(PAH.PO_SEND_TS,1,8) &gt;= #msg.xxDt10Dt_FR#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_TO">
                AND SUBSTRB(PAH.PO_SEND_TS,1,8) &lt;= #msg.xxDt10Dt_TO#
                </isNotNull>
                <isNotNull property="msg.poAckNum">
                AND PAH.PO_ACK_NUM LIKE #msg.poAckNum#
                </isNotNull>
                
                -- JOIN TO PO_ACK_DTL
                AND P.GLBL_CMPY_CD = PAD.GLBL_CMPY_CD
                AND PAD.EZCANCELFLAG = '0'
                AND PAH.PO_ACK_HDR_PK = PAD.PO_ACK_HDR_PK
                AND PD.PO_ORD_NUM = PAD.PO_ORD_NUM
                AND PD.PO_ORD_DTL_LINE_NUM = PAD.PO_ORD_DTL_LINE_NUM
                <isNotNull property="msg.proNum">
                AND PAD.PRO_NUM LIKE #msg.proNum#
                </isNotNull>
                <isNotNull property="msg.vndSoNum">
                AND PAD.VND_SO_NUM LIKE #msg.vndSoNum#
                </isNotNull>
                <isNotNull property="msg.vndPoAckStsCd_SL">
                AND PAD.VND_PO_ACK_STS_CD = #msg.vndPoAckStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndInvtyLocCd">
                AND PAD.VND_INVTY_LOC_CD LIKE #msg.vndInvtyLocCd#
                </isNotNull>
                
                -- LEFT JOIN TO VND_PO_ACK_STS
                AND P.GLBL_CMPY_CD = VPAC.GLBL_CMPY_CD(+)
                AND VPAC.EZCANCELFLAG(+) = '0'
                AND PAD.VND_PO_ACK_STS_CD = VPAC.VND_PO_ACK_STS_CD(+)
                
                -- LEFT JOIN TO RTL_SWH
                AND P.GLBL_CMPY_CD = RS.GLBL_CMPY_CD(+)
                AND RS.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD = RS.RTL_WH_CD(+)
                AND PD.DEST_RTL_SWH_CD = RS.RTL_SWH_CD(+)
                <isNotNull property="msg.rtlSwhNm">
                AND RS.RTL_SWH_NM LIKE #msg.rtlSwhNm#
                </isNotNull>
                
                -- LEFT JOIN TO AUTH_PSN
                AND P.GLBL_CMPY_CD = AP.GLBL_CMPY_CD(+)
                AND AP.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = AP.USR_NM(+)
                -- LEFT JOIN TO SCE_SYS_USR_LIST
                AND P.GLBL_CMPY_CD = SSUL.GLBL_CMPY_CD(+)
                AND SSUL.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = SSUL.FULL_PSN_NM(+)
                <isNotNull property="msg.fullPsnNm">
                AND
                    (
                    UPPER(AP.FIRST_NM || (NVL2(AP.MID_NM, ' '||AP.MID_NM||' ', ' ')) || AP.LAST_NM) LIKE UPPER(#msg.fullPsnNm#)
                    OR
                    UPPER(SSUL.FULL_PSN_NM) LIKE UPPER(#msg.fullPsnNm#)
                    )
                </isNotNull>
                
                -- LEFT JOIN TO RTL_WH
                AND P.GLBL_CMPY_CD = RW.GLBL_CMPY_CD(+)
                AND RW.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD = RW.RTL_WH_CD(+)
                <isNotNull property="msg.rtlWhNm">
                AND RW.RTL_WH_NM LIKE #msg.rtlWhNm#
                </isNotNull>
                
                -- LEFT JOIN TO CUAA_URL
                AND PAD.GLBL_CMPY_CD = CU.GLBL_CMPY_CD(+)
                AND CU.EZCANCELFLAG(+) = '0'
                AND PAD.VND_OTBD_CARR_CD = CU.VND_CD(+)
                
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                -- LEFT JOIN TO ALL_MDSE_V
                AND PAD.GLBL_CMPY_CD = AMV.GLBL_CMPY_CD(+)
                AND AMV.EZCANCELFLAG(+) = '0'
                AND PAD.MDSE_CD = AMV.MDSE_CD(+)
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                <isNotNull property="msg.coaMdseTpCd">
                AND AMV.COA_MDSE_TP_CD LIKE #msg.coaMdseTpCd#
                </isNotNull>
                <isNotNull property="msg.coaProdCd">
                AND AMV.COA_PROD_CD LIKE #msg.coaProdCd#
                </isNotNull>
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                <isNotEqual property="msg.xxChkBox_H1" compareValue="Y">
                AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            CM_ACRL_WRITE_OFF A
                        WHERE
                                PD.PO_MDSE_CMPSN_TP_CD = #poMdseCmpsnTpRegular#
                            AND A.GLBL_CMPY_CD         = PD.GLBL_CMPY_CD
                            AND A.PO_NUM               = PD.PO_ORD_NUM
                            AND A.PO_ORD_DTL_LINE_NUM  = PD.PO_ORD_DTL_LINE_NUM
                            AND A.WRT_OFF_FLG          = #flgOnY#
                            <iterate property="coaAcctCdList" var="coaAcctCd[]" open="AND A.COA_ACCT_CD IN (" close=")" conjunction= "," >
                                #coaAcctCd[]#
                            </iterate>
                            AND A.AJE_CM_INTFC_TP_CD   IS NULL
                            AND A.EZCANCELFLAG         = '0'
                            AND NOT EXISTS (
                                    SELECT
                                        1
                                    FROM
                                         RWS_HDR  B
                                        ,RWS_DTL  C
                                        ,RWS_STS  D
                                    WHERE
                                            B.GLBL_CMPY_CD        = A.GLBL_CMPY_CD
                                        AND B.PO_RCV_TRX_HDR_NUM  = A.PO_NUM
                                        AND B.EZCANCELFLAG        = '0'
                                        AND B.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
                                        AND B.RWS_NUM             = C.RWS_NUM
                                        AND C.PO_RCV_TRX_LINE_NUM = A.PO_ORD_DTL_LINE_NUM
                                        AND C.EZCANCELFLAG        = '0'
                                        AND C.GLBL_CMPY_CD        = D.GLBL_CMPY_CD
                                        AND C.RWS_STS_CD          = D.RWS_STS_CD
                                        AND D.RWS_OPEN_FLG        = #flgOnY#
                                        AND D.EZCANCELFLAG        = '0'
                                )
                    )
                </isNotEqual>
            <!-- add end 2022/05/19 QC#57934 -->
            ORDER BY
                 PO_ORD_NUM ASC
                ,PO_DISP_LINE_NUM ASC NULLS FIRST
                ,SORT_INDEX ASC
                ,PO_ACK_NUM ASC
        )
        WHERE ROWNUM &lt;= #rowNum#
        <!-- add start 2022/05/16 QC#57934 -->
        )
        ,WRITE_OFF_INFO AS (
            SELECT
                 E.PO_ORD_NUM
                ,E.PO_ORD_DTL_LINE_NUM
                ,SUM(E.RCV_WO_QTY) AS RCV_WO_QTY
                ,SUM(E.INV_WO_QTY) AS INV_WO_QTY
            FROM
                (
                 SELECT
                      D.PO_ORD_NUM
                     ,D.PO_ORD_DTL_LINE_NUM
                     ,D.WRT_OFF_DT
                     ,SUM(D.RCV_QTY) AS RCV_QTY
                     ,SUM(D.INV_QTY) AS INV_QTY
                     ,MAX(D.RCV_UNIT_PRC_AMT) AS RCV_UNIT_PRC_AMT
                     ,MAX(D.INV_UNIT_PRC_AMT) AS INV_UNIT_PRC_AMT
                     ,CASE WHEN SUM(D.INV_QTY) &lt; SUM(D.RCV_QTY)
                               THEN SUM(D.RCV_QTY) - SUM(D.INV_QTY)
                           <!-- mod start 2022/08/05 QC#59245 -->
                           <!-- WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND MAX(D.INV_UNIT_PRC_AMT) &lt; MAX(D.RCV_UNIT_PRC_AMT) -->
                           WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND SUM(D.INV_AMT) &lt; SUM(D.RCV_AMT)
                           <!-- mod end 2022/08/05 QC#59245 -->
                               THEN SUM(D.RCV_QTY)
                           ELSE 0
                      END AS RCV_WO_QTY
                     ,CASE WHEN SUM(D.INV_QTY) &gt; SUM(D.RCV_QTY)
                               THEN SUM(D.INV_QTY) - SUM(D.RCV_QTY)
                           <!-- mod start 2022/08/05 QC#59245 -->
                           <!-- WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND MAX(D.INV_UNIT_PRC_AMT) &gt; MAX(D.RCV_UNIT_PRC_AMT) -->
                           WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND SUM(D.INV_AMT) &gt; SUM(D.RCV_AMT)
                           <!-- mod end 2022/08/05 QC#59245 -->
                               THEN SUM(D.INV_QTY)
                           ELSE 0
                      END AS INV_WO_QTY
                 FROM
                     (
                      SELECT
                           P.PO_ORD_NUM
                          ,P.PO_ORD_DTL_LINE_NUM
                          ,A.WRT_OFF_DT
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpDr# THEN NVL(A.INV_RCV_QTY, 0) ELSE 0 END AS RCV_QTY
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr# THEN NVL(A.INV_QTY, 0) ELSE 0 END AS INV_QTY
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpDr# THEN NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0) ELSE 0 END AS RCV_UNIT_PRC_AMT
                          <!-- mod start 2022/08/05 QC#59245 -->
                          <!--
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr#
                                    THEN
                                      CASE WHEN B.ENT_DEAL_NET_UNIT_PRC_AMT = C.ENT_DEAL_NET_UNIT_PRC_AMT
                                               THEN B.ENT_DEAL_NET_UNIT_PRC_AMT
                                           ELSE NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0)
                                      END
                                ELSE 0
                           END INV_UNIT_PRC_AMT
                          -->
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr# THEN NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0) ELSE 0 END AS INV_UNIT_PRC_AMT
                          <!-- mod end 2022/08/05 QC#59245 -->
                          <!-- add start 2022/08/05 QC#59245 -->
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpDr# THEN NVL(A.INV_RCV_QTY, 0) * NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0) ELSE 0 END AS RCV_AMT
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr# THEN NVL(A.AC_INV_JRNL_COST_AMT, 0) ELSE 0 END AS INV_AMT
                          <!-- add end 2022/08/05 QC#59245 -->
                      FROM
                           PO_DTL_INFO        P
                          ,CM_ACRL_WRITE_OFF  A
                          <!-- del start 2022/08/05 QC#59245 -->
                          <!-- ,CM_AP_INV_DTL      B -->
                          <!-- ,PO_DTL             C -->
                          <!-- del end 2022/08/05 QC#59245 -->
                      WHERE
                              P.SORT_INDEX           = '2'
                          AND P.GLBL_CMPY_CD         = A.GLBL_CMPY_CD
                          AND P.PO_ORD_NUM           = A.PO_NUM
                          AND P.PO_ORD_DTL_LINE_NUM  = A.PO_ORD_DTL_LINE_NUM
                          AND A.WRT_OFF_FLG          = #flgOnY#
                          <iterate property="coaAcctCdList" var="coaAcctCd[]" open="AND A.COA_ACCT_CD IN (" close=")" conjunction= "," >
                              #coaAcctCd[]#
                          </iterate>
                          AND A.AJE_CM_INTFC_TP_CD   IS NULL
                          AND A.EZCANCELFLAG         = '0'
                          <!-- del start 2022/08/05 QC#59245 -->
                          <!--
                          AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD(+)
                          AND A.AP_VND_INV_NUM       = B.AP_VND_INV_NUM(+)
                          AND A.AP_VND_INV_LINE_NUM  = B.AP_VND_INV_LINE_NUM(+)
                          AND B.EZCANCELFLAG(+)      = '0'
                          AND A.GLBL_CMPY_CD         = C.GLBL_CMPY_CD(+)
                          AND A.PO_NUM               = C.PO_ORD_NUM(+)
                          AND A.PO_ORD_DTL_LINE_NUM  = C.PO_ORD_DTL_LINE_NUM(+)
                          AND C.EZCANCELFLAG(+)      = '0'
                          -->
                          <!-- del end 2022/08/05 QC#59245 -->
                     ) D
                 GROUP BY
                      D.PO_ORD_NUM
                     ,D.PO_ORD_DTL_LINE_NUM
                     ,D.WRT_OFF_DT
                 ) E
            GROUP BY
                 E.PO_ORD_NUM
                ,E.PO_ORD_DTL_LINE_NUM
        )        
        SELECT
             P.PO_ORD_NUM
            ,P.DS_PO_TP_DESC_TXT
            ,P.PO_HDR_STS_DESC_TXT
            ,P.PO_APVL_STS_DESC_TXT
            ,P.PO_DISP_LINE_NUM
            ,P.PO_LINE_TP_DESC_TXT
            ,P.MDSE_CD_A0
            ,P.MDSE_CD_A1
            ,P.SET_PO_ORD_DTL_LINE_NUM
            ,P.XX_MDSE_CD_A0
            ,P.XX_MDSE_CD_A1
            ,P.ASL_MDSE_CD
            ,P.MDSE_DESC_SHORT_TXT
            ,P.ENT_DEAL_NET_UNIT_PRC_AMT
            ,P.PO_DISP_QTY
            ,P.PO_SUBMT_DT
            ,P.SHIP_TO_CUST_CD
            ,P.SHIP_TO_LOC_NM
            ,P.DEST_RTL_WH_CD
            ,P.RQST_RTL_SWH_CD
            ,P.PO_MATCH_TP_DESC_TXT
            ,P.PO_LINE_STS_DESC_TXT
            ,P.ENT_PO_DTL_DEAL_NET_AMT
            ,P.PO_MDSE_CMPSN_TP_CD
            ,P.RCV_PO_QTY
            ,P.PO_INV_QTY
            ,P.PO_CANC_QTY
            ,P.SHPG_SVC_LVL_DESC_TXT
            ,P.PRCH_REQ_NUM
            ,P.PRCH_REQ_LINE_NUM
            ,P.TRX_REF_NUM
            ,P.TRX_REF_LINE_NUM
            ,P.ORIG_PO_ORD_NUM
            ,P.ORIG_DISP_PO_DTL_LINE_NUM
            ,P.PO_ACK_NUM
            ,P.PO_SEND_TS_A0
            ,P.PO_SEND_DT_A1
            ,P.VND_PO_ACK_STS_CD
            ,P.VND_PO_ACK_STS_DESC_TXT
            ,P.ORD_LAST_UPD_TS
            ,P.ORD_QTY
            ,P.XX_TOT_AMT
            ,P.ETD_DT
            ,P.ETA_DT
            ,P.VND_OTBD_CARR_NM
            ,P.PRO_NUM
            ,P.VND_SO_NUM
            ,P.VND_SO_SLP_NUM
            ,P.VND_INVTY_LOC_CD
            ,P.VND_SHIP_TO_CUST_LOC_NM
            ,P.VND_SELL_TO_CUST_LOC_NM
            ,P.THIS_MTH_FOB_COST_AMT
            ,P.VND_CHILD_BOM_PRC_AMT
            ,P.VND_CPO_ORD_NUM
            ,P.VND_ISS_PO_ORD_NUM
            ,P.VND_PO_ACK_LINE_STS_TXT
            ,P.VND_OTBD_CARR_CD
            ,P.VND_CPO_DTL_LINE_NUM
            ,P.VND_CPO_DTL_LINE_SUB_NUM
            ,P.CARR_TRK_URL
            ,P.COA_MDSE_TP_CD
            ,P.COA_PROD_CD
            ,P.PRNT_VND_CD
            ,P.PRNT_VND_NM
            ,P.VND_CD
            ,P.VND_NM
            ,CASE WHEN P.RCV_PO_QTY IS NULL THEN NULL ELSE NVL(W.RCV_WO_QTY, 0) END AS RCV_WO_QTY
            ,CASE WHEN P.PO_INV_QTY IS NULL THEN NULL ELSE NVL(W.INV_WO_QTY, 0) END AS INV_WO_QTY
            <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
            ,P.RQST_SHIP_DT
            <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
        FROM
             PO_DTL_INFO     P
            ,WRITE_OFF_INFO  W
        WHERE
                P.PO_ORD_NUM           = W.PO_ORD_NUM(+)
            AND P.PO_ORD_DTL_LINE_NUM  = W.PO_ORD_DTL_LINE_NUM(+)
        ORDER BY
             P.PO_ORD_NUM ASC
            ,P.PO_DISP_LINE_NUM ASC NULLS FIRST
            ,P.SORT_INDEX ASC
            ,P.PO_ACK_NUM ASC
        <!-- add end 2022/05/16 QC#57934 -->
    </statement>
    
    <resultMap id="result.NPAL1510_ASMsg" class="NPAL1510_ASMsg">
        <result property="poOrdNum_A1"    column="PO_ORD_NUM"    javaType="EZDSStringItem"/>
        <result property="dsPoTpDescTxt_A1"    column="DS_PO_TP_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="poHdrStsDescTxt_A1"    column="PO_HDR_STS_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="poApvlStsDescTxt_A1"    column="PO_APVL_STS_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="dispPoDtlLineNum_A1"    column="PO_DISP_LINE_NUM"    javaType="EZDSStringItem"/>
        <result property="poLineTpDescTxt_A1"    column="PO_LINE_TP_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="mdseCd_A0"    column="MDSE_CD_A0"    javaType="EZDSStringItem"/>
        <result property="mdseCd_A1"    column="MDSE_CD_A1"    javaType="EZDSStringItem"/>
        <result property="xxMdseCd_A0"    column="XX_MDSE_CD_A0"    javaType="EZDSStringItem"/>
        <result property="xxMdseCd_A1"    column="XX_MDSE_CD_A1"    javaType="EZDSStringItem"/>
        <result property="aslMdseCd_A1"    column="ASL_MDSE_CD"    javaType="EZDSStringItem"/>
        <result property="mdseDescShortTxt_A1"    column="MDSE_DESC_SHORT_TXT"    javaType="EZDSStringItem"/>
        <result property="entDealNetUnitPrcAmt_A1"    column="ENT_DEAL_NET_UNIT_PRC_AMT"    javaType="EZDSBigDecimalItem"/>
        <result property="poDispQty_A1"    column="PO_DISP_QTY"    javaType="EZDSBigDecimalItem"/>
        <result property="poSubmtDt_A1"    column="PO_SUBMT_DT"    javaType="EZDSDateItem"/>
        <result property="shipToCustCd_A1"    column="SHIP_TO_CUST_CD"    javaType="EZDSStringItem"/>
        <result property="shipToCustLocNm_A1"    column="SHIP_TO_LOC_NM"    javaType="EZDSStringItem"/>
        <result property="destRtlWhCd_A1"    column="DEST_RTL_WH_CD"    javaType="EZDSStringItem"/>
        <result property="destRtlSwhCd_A1"    column="RQST_RTL_SWH_CD"    javaType="EZDSStringItem"/>
        <result property="poMatchTpDescTxt_A1"    column="PO_MATCH_TP_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="poLineStsDescTxt_A1"    column="PO_LINE_STS_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="entPoDtlDealNetAmt_A1"    column="ENT_PO_DTL_DEAL_NET_AMT"    javaType="EZDSBigDecimalItem"/>
        <result property="poRcvQty_A1"    column="RCV_PO_QTY"    javaType="EZDSBigDecimalItem"/>
        <result property="poInvQty_A1"    column="PO_INV_QTY"    javaType="EZDSBigDecimalItem"/>
        <result property="poCancQty_A1"    column="PO_CANC_QTY"    javaType="EZDSBigDecimalItem"/>
        <result property="shpgSvcLvlDescTxt_A1"    column="SHPG_SVC_LVL_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="prchReqNum_A1"    column="PRCH_REQ_NUM"    javaType="EZDSStringItem"/>
        <result property="prchReqLineNum_A1"    column="PRCH_REQ_LINE_NUM"    javaType="EZDSStringItem"/>
        <result property="trxRefNum_A1"    column="TRX_REF_NUM"    javaType="EZDSStringItem"/>
        <result property="trxRefLineNum_A1"    column="TRX_REF_LINE_NUM"    javaType="EZDSStringItem"/>
        <result property="origPoOrdNum_A1"    column="ORIG_PO_ORD_NUM"    javaType="EZDSStringItem"/>
        <result property="origDispPoDtlLineNum_A1"    column="ORIG_DISP_PO_DTL_LINE_NUM"    javaType="EZDSStringItem"/>
        <result property="poAckNum_A1"    column="PO_ACK_NUM"    javaType="EZDSStringItem"/>
        <result property="poSendTs_A0"    column="PO_SEND_TS_A0"    javaType="EZDSDateItem"/>
        <result property="poSendDt_A1"    column="PO_SEND_DT_A1"    javaType="EZDSDateItem"/>
        <result property="vndPoAckStsCd_A1"    column="VND_PO_ACK_STS_CD"    javaType="EZDSStringItem"/>
        <result property="vndPoAckStsDescTxt_A1"    column="VND_PO_ACK_STS_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="xxDt10Dt_A1"    column="ORD_LAST_UPD_TS"    javaType="EZDSDateItem"/>
        <result property="ordQty_A1"    column="ORD_QTY"    javaType="EZDSBigDecimalItem"/>
        <result property="xxTotAmt_A1"    column="XX_TOT_AMT"    javaType="EZDSBigDecimalItem"/>
        <result property="etdDt_A1"    column="ETD_DT"    javaType="EZDSDateItem"/>
        <result property="etaDt_A1"    column="ETA_DT"    javaType="EZDSDateItem"/>
        <result property="vndOtbdCarrNm_A1"    column="VND_OTBD_CARR_NM"    javaType="EZDSStringItem"/>
        <result property="proNum_A1"    column="PRO_NUM"    javaType="EZDSStringItem"/>
        <result property="vndSoNum_A1"    column="VND_SO_NUM"    javaType="EZDSStringItem"/>
        <result property="vndSoSlpNum_A1"    column="VND_SO_SLP_NUM"    javaType="EZDSStringItem"/>
        <result property="vndInvtyLocCd_A1"    column="VND_INVTY_LOC_CD"    javaType="EZDSStringItem"/>
        <result property="vndShipToCustLocNm_A1"    column="VND_SHIP_TO_CUST_LOC_NM"    javaType="EZDSStringItem"/>
        <result property="vndSellToCustLocNm_A1"    column="VND_SELL_TO_CUST_LOC_NM"    javaType="EZDSStringItem"/>
        <result property="thisMthFobCostAmt_A1"    column="THIS_MTH_FOB_COST_AMT"    javaType="EZDSBigDecimalItem"/>
        <result property="vndChildBomPrcAmt_A1"    column="VND_CHILD_BOM_PRC_AMT"    javaType="EZDSBigDecimalItem"/>
        <result property="vndCpoOrdNum_A1"    column="VND_CPO_ORD_NUM"    javaType="EZDSStringItem"/>
        <result property="vndIssPoOrdNum_A1"    column="VND_ISS_PO_ORD_NUM"    javaType="EZDSStringItem"/>
        <result property="vndPoAckLineStsTxt_A1"    column="VND_PO_ACK_LINE_STS_TXT"    javaType="EZDSStringItem"/>
        <result property="vndOtbdCarrCd_A1"    column="VND_OTBD_CARR_CD"    javaType="EZDSStringItem"/>
        <result property="vndCpoDtlLineNum_A1"    column="VND_CPO_DTL_LINE_NUM"    javaType="EZDSStringItem"/>
        <result property="vndCpoDtlLineSubNum_A1"    column="VND_CPO_DTL_LINE_SUB_NUM"    javaType="EZDSStringItem"/>
        <result property="poMdseCmpsnTpCd_A1"    column="PO_MDSE_CMPSN_TP_C"    javaType="EZDSStringItem"/>
        <result property="setPoOrdDtlLineNum_A1"    column="SET_PO_ORD_DTL_LINE_NUM"    javaType="EZDSStringItem"/>
        <result property="carrTrkUrl_A1"    column="CARR_TRK_URL"    javaType="EZDSStringItem"/>
<!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
        <result property="coaMdseTpCd_A1"    column="COA_MDSE_TP_CD"    javaType="EZDSStringItem"/>
        <result property="coaProdCd_A1"    column="COA_PROD_CD"    javaType="EZDSStringItem"/>
        <result property="prntVndCd_A1"    column="PRNT_VND_CD"    javaType="EZDSStringItem"/>
        <result property="prntVndNm_A1"    column="PRNT_VND_NM"    javaType="EZDSStringItem"/>
        <result property="vndCd_A1"    column="VND_CD"    javaType="EZDSStringItem"/>
        <result property="vndNm_A1"    column="VND_NM"    javaType="EZDSStringItem"/>
<!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
        <!-- START 2023/02/09 TZ.Win [QC#60966, ADD] -->
        <result property="rqstShipDt_A1"     column="RQST_SHIP_DT"    javaType="EZDSDateItem"/>
        <!-- END 2023/02/09 TZ.Win [QC#60966, ADD] -->
        <!-- add start 2022/05/19 QC#57934 -->
        <result property="poRcvQty_WO"    column="RCV_WO_QTY"    javaType="EZDSBigDecimalItem"/>
        <result property="poInvQty_WO"    column="INV_WO_QTY"    javaType="EZDSBigDecimalItem"/>
         <!-- add start 2022/05/19 QC#57934 -->
    </resultMap>

    <statement id="getDispLevelPoHeaderSearchForCsv" parameterClass="Map">
        SELECT
             PO_ORD_NUM
            ,DS_PO_TP_DESC_TXT
            ,PO_HDR_STS_DESC_TXT
            ,PO_APVL_STS_DESC_TXT
            ,PO_DISP_LINE_NUM
            ,PO_LINE_TP_DESC_TXT
            ,MDSE_CD_A0
            ,MDSE_CD_A1
            ,SET_PO_ORD_DTL_LINE_NUM
            ,XX_MDSE_CD_A0
            ,XX_MDSE_CD_A1
            ,ASL_MDSE_CD
            ,MDSE_DESC_SHORT_TXT
            ,ENT_DEAL_NET_UNIT_PRC_AMT
            ,PO_MDSE_CMPSN_TP_CD
            ,PO_DISP_QTY
            ,SUBSTRB(PO_SUBMT_TS,1,8) AS PO_SUBMT_DT
            ,SHIP_TO_CUST_CD
            ,SHIP_TO_LOC_NM
            ,DEST_RTL_WH_CD
            ,RQST_RTL_SWH_CD
            ,PO_MATCH_TP_DESC_TXT
            ,PO_LINE_STS_DESC_TXT
            ,ENT_PO_DTL_DEAL_NET_AMT
            ,RCV_PO_QTY
            ,PO_INV_QTY
            ,PO_CANC_QTY
            ,SHPG_SVC_LVL_DESC_TXT
            ,PRCH_REQ_NUM
            ,PRCH_REQ_LINE_NUM
            ,TRX_REF_NUM
            ,TRX_REF_LINE_NUM
            ,ORIG_PO_ORD_NUM
            ,ORIG_DISP_PO_DTL_LINE_NUM
            ,PO_ACK_NUM
            ,SUBSTRB(PO_SEND_TS_A0,1,8) AS PO_SEND_TS_A0
            ,NULL AS PO_SEND_DT_A1
            ,VND_PO_ACK_STS_CD
            ,VND_PO_ACK_STS_DESC_TXT
            ,SUBSTRB(ORD_LAST_UPD_TS,1,8) AS ORD_LAST_UPD_TS
            ,ORD_QTY
            ,XX_TOT_AMT
            ,SUBSTRB(ETD_DT,1,8) AS ETD_DT
            ,SUBSTRB(ETA_DT,1,8) AS ETA_DT
            ,VND_OTBD_CARR_NM
            ,PRO_NUM
            ,VND_SO_NUM
            ,VND_SO_SLP_NUM
            ,VND_INVTY_LOC_CD
            ,VND_SHIP_TO_CUST_LOC_NM
            ,VND_SELL_TO_CUST_LOC_NM
            ,THIS_MTH_FOB_COST_AMT
            ,VND_CHILD_BOM_PRC_AMT
            ,VND_CPO_ORD_NUM
            ,VND_ISS_PO_ORD_NUM
            ,VND_PO_ACK_LINE_STS_TXT
            ,VND_OTBD_CARR_CD
            ,VND_CPO_DTL_LINE_NUM
            ,VND_CPO_DTL_LINE_SUB_NUM
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            ,COA_MDSE_TP_CD
            ,COA_PROD_CD
            ,PRNT_VND_CD
            ,PRNT_VND_NM
            ,VND_CD
            ,VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
            ,RCV_WO_QTY
            ,INV_WO_QTY
            <!-- add end 2022/05/19 QC#57934 -->
            <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
            ,SUBSTRB(RQST_SHIP_DT,1,8) AS RQST_SHIP_DT
            <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
        FROM (
            SELECT 
                '1' AS SORT_INDEX
                ,P.PO_ORD_NUM
                ,DPT.DS_PO_TP_DESC_TXT
                ,PHS.PO_HDR_STS_DESC_TXT
                ,PAS.PO_APVL_STS_DESC_TXT
                ,NULL AS PO_DISP_LINE_NUM
                ,NULL AS PO_LINE_TP_DESC_TXT
                ,NULL AS MDSE_CD_A0
                ,NULL AS MDSE_CD_A1
                ,NULL AS SET_PO_ORD_DTL_LINE_NUM
                ,NULL AS XX_MDSE_CD_A0
                ,NULL AS XX_MDSE_CD_A1
                ,NULL AS ASL_MDSE_CD
                ,NULL AS MDSE_DESC_SHORT_TXT
                ,NULL AS ENT_DEAL_NET_UNIT_PRC_AMT
                ,NULL AS PO_MDSE_CMPSN_TP_CD
                ,NULL AS PO_DISP_QTY
                ,NULL AS PO_SUBMT_TS
                ,PD.SHIP_TO_CUST_CD
                ,PD.SHIP_TO_LOC_NM
                ,P.DEST_RTL_WH_CD
                ,NULL AS RQST_RTL_SWH_CD
                ,NULL AS PO_MATCH_TP_DESC_TXT
                ,NULL AS PO_LINE_STS_DESC_TXT
                ,NULL AS ENT_PO_DTL_DEAL_NET_AMT
                ,NULL AS RCV_PO_QTY
                ,NULL AS PO_INV_QTY
                ,NULL AS PO_CANC_QTY
                ,SSL.SHPG_SVC_LVL_DESC_TXT
                ,NVL((SELECT
                         PRD.PRCH_REQ_NUM
                     FROM
                         PRCH_REQ_DTL PRD
                     WHERE
                         PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                     AND PRD.PO_ORD_NUM   = PD.PO_ORD_NUM
                     AND PRD.EZCANCELFLAG = '0'
                     AND ROWNUM = 1)
                    , PD.PRCH_REQ_NUM) AS PRCH_REQ_NUM
                ,NULL AS PRCH_REQ_LINE_NUM
                ,PD.TRX_REF_NUM
                ,NULL AS TRX_REF_LINE_NUM
                ,PD.ORIG_PO_ORD_NUM
                ,NULL AS ORIG_DISP_PO_DTL_LINE_NUM
                ,NULL AS PO_ACK_NUM
                ,P.PO_SEND_TS AS PO_SEND_TS_A0
                ,NULL AS PO_SEND_DT_A1
                ,NULL AS VND_PO_ACK_STS_CD
                ,NULL AS VND_PO_ACK_STS_DESC_TXT
                ,NULL AS ORD_LAST_UPD_TS
                ,NULL AS ORD_QTY
                ,NULL AS XX_TOT_AMT
                ,NULL AS ETD_DT
                ,NULL AS ETA_DT
                ,NULL AS VND_OTBD_CARR_NM
                ,NULL AS PRO_NUM
                ,NULL AS VND_SO_NUM
                ,NULL AS VND_SO_SLP_NUM
                ,NULL AS VND_INVTY_LOC_CD
                ,NULL AS VND_SHIP_TO_CUST_LOC_NM
                ,NULL AS VND_SELL_TO_CUST_LOC_NM
                ,NULL AS THIS_MTH_FOB_COST_AMT
                ,NULL AS VND_CHILD_BOM_PRC_AMT
                ,NULL AS VND_CPO_ORD_NUM
                ,NULL AS VND_ISS_PO_ORD_NUM
                ,NULL AS VND_PO_ACK_LINE_STS_TXT
                ,NULL AS VND_OTBD_CARR_CD
                ,NULL AS VND_CPO_DTL_LINE_NUM
                ,NULL AS VND_CPO_DTL_LINE_SUB_NUM
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                ,NULL AS COA_MDSE_TP_CD
                ,NULL AS COA_PROD_CD
                ,P.PRNT_VND_CD
                ,P.PRNT_VND_NM
                ,P.VND_CD
                ,P.VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                ,NULL AS RCV_WO_QTY
                ,NULL AS INV_WO_QTY
            <!-- add end 2022/05/19 QC#57934 -->
            <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
                ,PD.RQST_SHIP_DT
            <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
            FROM 
                 PO P
                ,PO_DTL PD
                ,SHPG_SVC_LVL SSL
                ,DS_PO_TP DPT
                ,PO_HDR_STS PHS
                ,PO_APVL_STS PAS
                ,AUTH_PSN AP
                ,RTL_WH RW
                ,SCE_SYS_USR_LIST SSUL
            WHERE 
                -- JOIN TO PO
                P.GLBL_CMPY_CD = #glblCmpyCd#
                AND P.EZCANCELFLAG = '0'
                <isNotNull property="msg.poOrdNum">
                AND P.PO_ORD_NUM LIKE #msg.poOrdNum#
                </isNotNull>
                <isNotNull property="msg.poOrdSrcCd_SL">
                AND P.PO_ORD_SRC_CD = #msg.poOrdSrcCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndCd">
                AND P.VND_CD = #msg.vndCd#
                </isNotNull>
                <isNotNull property="msg.vndNm">
                AND P.VND_NM LIKE #msg.vndNm#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_FR">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &gt;= #msg.poSubmtDt_FR#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_TO">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &lt;= #msg.poSubmtDt_TO#
                </isNotNull>
                <isNotNull property="msg.vndIssOrdNum">
                AND P.VND_ISS_ORD_NUM LIKE #msg.vndIssOrdNum#
                </isNotNull>
                <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
                
                -- JOIN TO DS_PO
                AND P.EZCANCELFLAG = '0'
                <isNotNull property="msg.poHdrStsCd_SL">
                AND P.PO_HDR_STS_CD = #msg.poHdrStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.poApvlStsCd_SL">
                AND P.PO_APVL_STS_CD = #msg.poApvlStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.dsPoTpCd_SL">
                AND P.DS_PO_TP_CD = #msg.dsPoTpCd_SL#
                </isNotNull>
                <isNotNull property="msg.prntVndCd">
                AND P.PRNT_VND_CD = #msg.prntVndCd#
                </isNotNull>
                <isNotNull property="msg.prntVndNm">
                AND P.PRNT_VND_NM LIKE #msg.prntVndNm#
                </isNotNull>
                <isNotNull property="msg.destRtlWhCd">
                AND P.DEST_RTL_WH_CD = #msg.destRtlWhCd#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_FR">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &gt;= #msg.xxDt10Dt_FR#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_TO">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &lt;= #msg.xxDt10Dt_TO#
                </isNotNull>
                
                -- JOIN TO PO_DTL
                AND P.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                AND PD.EZCANCELFLAG = '0'
                AND P.PO_ORD_NUM = PD.PO_ORD_NUM
                AND PD.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
                <!-- START 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isNotNull property="msg.prchReqNum">
                AND (PD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                            PRCH_REQ_DTL PRD
                        WHERE
                            PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                        AND PRD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                        AND PRD.PO_ORD_NUM   = P.PO_ORD_NUM
                        AND PRD.EZCANCELFLAG = '0'
                    )
                )
                </isNotNull>
                <!-- END 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
                
                -- JOIN TO DS_PO_DTL
                AND P.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                
                -- LEFT JOIN TO SHPG_SVC_LVL
                AND PD.GLBL_CMPY_CD = SSL.GLBL_CMPY_CD(+)
                AND SSL.EZCANCELFLAG(+) = '0'
                AND PD.SHPG_SVC_LVL_CD = SSL.SHPG_SVC_LVL_CD(+)
                
                -- LEFT JOIN TO DS_PO_TP
                AND P.GLBL_CMPY_CD = DPT.GLBL_CMPY_CD(+)
                AND DPT.EZCANCELFLAG(+) = '0'
                AND P.DS_PO_TP_CD = DPT.DS_PO_TP_CD(+)
                
                -- LEFT JOIN TO PO_HDR_STS
                AND P.GLBL_CMPY_CD = PHS.GLBL_CMPY_CD
                AND PHS.EZCANCELFLAG(+) = '0'
                AND P.PO_HDR_STS_CD = PHS.PO_HDR_STS_CD(+)
                
                -- LEFT JOIN TO PO_APVL_STS
                AND P.GLBL_CMPY_CD = PAS.GLBL_CMPY_CD(+)
                AND PAS.EZCANCELFLAG(+) = '0'
                AND P.PO_APVL_STS_CD = PAS.PO_APVL_STS_CD(+)
                
                -- LEFT JOIN TO AUTH_PSN
                AND P.GLBL_CMPY_CD = AP.GLBL_CMPY_CD(+)
                AND AP.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = AP.USR_NM(+)
                
                -- LEFT JOIN TO SCE_SYS_USR_LIST
                AND P.GLBL_CMPY_CD = SSUL.GLBL_CMPY_CD(+)
                AND SSUL.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = SSUL.FULL_PSN_NM(+)
                
                <isNotNull property="msg.fullPsnNm">
                AND 
                    (
                    UPPER(AP.FIRST_NM || (NVL2(AP.MID_NM, ' '||AP.MID_NM||' ', ' ')) || AP.LAST_NM) LIKE UPPER(#msg.fullPsnNm#)
                    OR
                    UPPER(SSUL.FULL_PSN_NM) LIKE UPPER(#msg.fullPsnNm#)
                    )
                </isNotNull>
                
                -- LEFT JOIN TO RTL_WH
                AND P.GLBL_CMPY_CD(+) = RW.GLBL_CMPY_CD
                AND RW.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD(+) = RW.RTL_WH_CD
                <isNotNull property="msg.rtlWhNm">
                AND RW.RTL_WH_NM(+) LIKE #msg.rtlWhNm#
                </isNotNull>
                <isEqual property="searchCond1" compareValue="1">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                         PO_DTL E1_PD
                        ,RTL_SWH E1_RS
                    WHERE 
                        -- JOIN TO PO_DTL
                        P.GLBL_CMPY_CD = E1_PD.GLBL_CMPY_CD
                    AND E1_PD.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E1_PD.PO_ORD_NUM
                    <isNotNull property="msg.shpgSvcLvlCd_SL">
                    AND E1_PD.SHPG_SVC_LVL_CD = #msg.shpgSvcLvlCd_SL#
                    </isNotNull>
                    <isNotNull property="msg.shipToCustCd">
                    AND E1_PD.SHIP_TO_CUST_CD = #msg.shipToCustCd#
                    </isNotNull>
                    <isNotNull property="msg.shipToCustLocNm">
                    AND E1_PD.SHIP_TO_LOC_NM LIKE #msg.shipToCustLocNm#
                    </isNotNull>
                    <isNotNull property="msg.mdseCd">
                    AND E1_PD.ORIG_MDSE_CD LIKE #msg.mdseCd#
                    </isNotNull>
                    <isNotNull property="msg.mdseCd_SB">
                    AND E1_PD.MDSE_CD LIKE #msg.mdseCd_SB#
                    </isNotNull>
                    
                    -- JOIN TO DS_PO_DTL
                    <isNotNull property="msg.trxRefNum">
                    AND E1_PD.TRX_REF_NUM LIKE #msg.trxRefNum#
                    </isNotNull>
                    <isNotNull property="msg.destRtlSwhCd">
                    AND E1_PD.DEST_RTL_SWH_CD LIKE #msg.destRtlSwhCd#
                    </isNotNull>
                    <isNotNull property="msg.poLineStsCd_SL">
                    AND E1_PD.PO_LINE_STS_CD = #msg.poLineStsCd_SL#
                    </isNotNull>
                    <isNotNull property="msg.vndPoAckStsCd_SL">
                    AND E1_PD.VND_PO_ACK_STS_CD = #msg.vndPoAckStsCd_SL#
                    </isNotNull>
                    <isNotNull property="msg.proNum">
                    AND E1_PD.PRO_NUM LIKE #msg.proNum#
                    </isNotNull>
                    <isNotNull property="msg.vndInvtyLocCd">
                    AND E1_PD.VND_INVTY_LOC_CD LIKE #msg.vndInvtyLocCd#
                    </isNotNull>
                    <isNotNull property="msg.aslMdseCd">
                    AND E1_PD.ASL_MDSE_CD LIKE #msg.aslMdseCd#
                    </isNotNull>
                    
                    -- LEFT JOIN TO RTL_SWH
                    AND P.GLBL_CMPY_CD = E1_RS.GLBL_CMPY_CD(+)
                    AND E1_RS.EZCANCELFLAG(+) = '0'
                    AND P.DEST_RTL_WH_CD = E1_RS.RTL_WH_CD(+)
                    AND E1_PD.DEST_RTL_SWH_CD = E1_RS.RTL_SWH_CD(+)
                    <isNotNull property="msg.rtlSwhNm">
                    AND E1_RS.RTL_SWH_NM LIKE #msg.rtlSwhNm#
                    </isNotNull>
                )
                </isEqual>
                <isEqual property="searchCond2" compareValue="1">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                         PO_ACK_HDR E2_PAH
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                    ,PO_ACK_DTL E2_PAD -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                    WHERE 
                        -- JOIN TO PO_ACK_HDR
                        P.GLBL_CMPY_CD = E2_PAH.GLBL_CMPY_CD
                    AND E2_PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAH.PO_ORD_NUM
                    <isNotNull property="msg.xxOrdDt_FR">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &gt;= #msg.xxOrdDt_FR#
                    </isNotNull>
                    <isNotNull property="msg.xxOrdDt_TO">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &lt;= #msg.xxOrdDt_TO#
                    </isNotNull>
                    
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                AND E2_PAH.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD -->
<!--                AND E2_PAD.EZCANCELFLAG = '0' -->
<!--                AND E2_PAH.PO_ACK_HDR_PK = E2_PAD.PO_ACK_HDR_PK -->
<!--                <isNotNull property="msg.vndSoNum"> -->
<!--                AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum# -->
<!--                </isNotNull> -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                )
                </isEqual>
<!-- START 02/10/2020 T.Ogura [QC#55712,ADD] -->
                <isNotNull property="msg.vndSoNum">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                        PO_ACK_DTL E2_PAD
                    WHERE 
                        P.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD
                    AND E2_PAD.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAD.PO_ORD_NUM
                    AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum#
                )
                </isNotNull>
<!-- END   02/10/2020 T.Ogura [QC#55712,ADD] -->
            ORDER BY 
                P.PO_ORD_NUM ASC
                ,TO_NUMBER(PD.DISP_PO_DTL_LINE_NUM) ASC
                ,SORT_INDEX ASC
        )
        WHERE ROWNUM &lt;= #rowNum#
    </statement>
    
    <statement id="getDispLevelPoDetailSearchForCsv" parameterClass="Map">
        <!-- add start 2022/05/19 QC#57934 -->
        WITH PO_DTL_INFO AS (
        <!-- add end 2022/05/19 QC#57934 -->
        SELECT
             PO_ORD_NUM
            ,DS_PO_TP_DESC_TXT
            ,PO_HDR_STS_DESC_TXT
            ,PO_APVL_STS_DESC_TXT
            ,DISP_PO_DTL_LINE_NUM AS PO_DISP_LINE_NUM
            ,PO_LINE_TP_DESC_TXT
            ,MDSE_CD_A0
            ,MDSE_CD_A1
            ,SET_PO_ORD_DTL_LINE_NUM
            ,XX_MDSE_CD_A0
            ,XX_MDSE_CD_A1
            ,ASL_MDSE_CD
            ,MDSE_DESC_SHORT_TXT
            ,ENT_DEAL_NET_UNIT_PRC_AMT
            ,PO_DISP_QTY
            ,SUBSTRB(PO_SUBMT_TS,1,8) AS PO_SUBMT_DT
            ,SHIP_TO_CUST_CD
            ,SHIP_TO_LOC_NM
            ,DEST_RTL_WH_CD
            ,RQST_RTL_SWH_CD
            ,PO_MATCH_TP_DESC_TXT
            ,PO_LINE_STS_DESC_TXT
            ,ENT_PO_DTL_DEAL_NET_AMT
            ,PO_MDSE_CMPSN_TP_CD
            ,RCV_PO_QTY
            ,PO_INV_QTY
            ,PO_CANC_QTY
            ,SHPG_SVC_LVL_DESC_TXT
            ,PRCH_REQ_NUM
            ,PRCH_REQ_LINE_NUM
            ,TRX_REF_NUM
            ,TRX_REF_LINE_NUM
            ,ORIG_PO_ORD_NUM
            ,ORIG_DISP_PO_DTL_LINE_NUM AS ORIG_DISP_PO_DTL_LINE_NUM
            ,PO_ACK_NUM
            ,SUBSTRB(PO_SEND_TS_A0,1,8) AS PO_SEND_TS_A0
            ,SUBSTRB(PO_SEND_DT_A1,1,8) AS PO_SEND_DT_A1
            ,VND_PO_ACK_STS_CD
            ,VND_PO_ACK_STS_DESC_TXT
            ,SUBSTRB(ORD_LAST_UPD_TS,1,8) AS ORD_LAST_UPD_TS
            ,ORD_QTY
            ,XX_TOT_AMT
            ,SUBSTRB(ETD_DT,1,8) AS ETD_DT
            ,SUBSTRB(ETA_DT,1,8) AS ETA_DT
            ,VND_OTBD_CARR_NM
            ,PRO_NUM
            ,VND_SO_NUM
            ,VND_SO_SLP_NUM
            ,VND_INVTY_LOC_CD
            ,VND_SHIP_TO_CUST_LOC_NM
            ,VND_SELL_TO_CUST_LOC_NM
            ,THIS_MTH_FOB_COST_AMT
            ,VND_CHILD_BOM_PRC_AMT
            ,VND_ISS_ORD_NUM AS VND_CPO_ORD_NUM
            ,VND_ISS_PO_ORD_NUM
            ,VND_PO_ACK_LINE_STS_TXT
            ,VND_OTBD_CARR_CD
            ,VND_CPO_DTL_LINE_NUM
            ,VND_CPO_DTL_LINE_SUB_NUM
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            ,COA_MDSE_TP_CD
            ,COA_PROD_CD
            ,PRNT_VND_CD
            ,PRNT_VND_NM
            ,VND_CD
            ,VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
            ,GLBL_CMPY_CD
            ,PO_ORD_DTL_LINE_NUM
            <!-- add end 2022/05/19 QC#57934 -->
            <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
            ,SUBSTRB(RQST_SHIP_DT,1,8) AS RQST_SHIP_DT
            <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
        FROM (
            SELECT /*+ LEADING(P PD AMV) USE_NL(P PD AMV) */
                '1' AS SORT_INDEX
                ,P.PO_ORD_NUM
                ,DPT.DS_PO_TP_DESC_TXT
                ,PHS.PO_HDR_STS_DESC_TXT
                ,PAS.PO_APVL_STS_DESC_TXT
                ,TO_NUMBER(PD.DISP_PO_DTL_LINE_NUM) AS DISP_PO_DTL_LINE_NUM
                ,PLT.PO_LINE_TP_DESC_TXT
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                --,PD.ORIG_MDSE_CD AS MDSE_CD_A0
                ,DECODE(
                    AMV.MDSE_ITEM_TP_CD
                   ,#mdseItemTpCdTextItem#
                   ,NULL
                   ,PD.ORIG_MDSE_CD
                 ) MDSE_CD_A0
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,PD2.MDSE_CD AS MDSE_CD_A1
                ,PD.SET_PO_ORD_DTL_LINE_NUM
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                --,PD.MDSE_CD AS XX_MDSE_CD_A0
                ,DECODE(
                    AMV.MDSE_ITEM_TP_CD
                   ,#mdseItemTpCdTextItem#
                   ,NULL
                   ,PD.MDSE_CD
                 ) XX_MDSE_CD_A0
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,CASE WHEN PD.MDSE_CD &lt;&gt; PD.ORIG_MDSE_CD THEN PD.ORIG_MDSE_CD ELSE NULL END AS XX_MDSE_CD_A1
                ,PD.ASL_MDSE_CD
                <!-- QC#53271 Update -->
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                --,AMV.MDSE_DESC_SHORT_TXT
                <!--,DECODE(
                    AMV.MDSE_ITEM_TP_CD
                   ,#mdseItemTpCdTextItem#
                   ,PD.MDSE_DESC_SHORT_TXT
                   ,AMV.MDSE_DESC_SHORT_TXT
                 ) MDSE_DESC_SHORT_TXT
                -->
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,CASE WHEN PD.PO_LINE_TP_CD IN(#poLineTpCdExpense#, #poLineTpCdExpenseWReceipt#) THEN NVL(PD.MDSE_DESC_SHORT_TXT, AMV.MDSE_DESC_SHORT_TXT)
                       ELSE AMV.MDSE_DESC_SHORT_TXT
                 END AS MDSE_DESC_SHORT_TXT
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.ENT_DEAL_NET_UNIT_PRC_AMT END AS ENT_DEAL_NET_UNIT_PRC_AMT
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_DISP_QTY END AS PO_DISP_QTY
                ,P.PO_SUBMT_TS
                ,PD.SHIP_TO_CUST_CD
                ,PD.SHIP_TO_LOC_NM
                ,P.DEST_RTL_WH_CD
                ,PD.DEST_RTL_SWH_CD AS RQST_RTL_SWH_CD
                ,PMT.PO_MATCH_TP_DESC_TXT
                ,PLS.PO_LINE_STS_DESC_TXT
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.ENT_PO_DTL_DEAL_NET_AMT END AS ENT_PO_DTL_DEAL_NET_AMT
                ,PD.PO_MDSE_CMPSN_TP_CD
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_RCV_QTY END AS RCV_PO_QTY
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_INV_QTY END AS PO_INV_QTY
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_CANC_QTY END AS PO_CANC_QTY
                ,SSL.SHPG_SVC_LVL_DESC_TXT
                ,NVL((SELECT
                         PRD.PRCH_REQ_NUM
                     FROM
                         PRCH_REQ_DTL PRD
                     WHERE
                         PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                     AND PRD.PO_ORD_NUM   = PD.PO_ORD_NUM
                     AND PRD.EZCANCELFLAG = '0'
                     AND ROWNUM = 1)
                    , PD.PRCH_REQ_NUM) AS PRCH_REQ_NUM
                ,NVL((SELECT
                         PRD.PRCH_REQ_LINE_NUM
                     FROM
                         PRCH_REQ_DTL PRD
                     WHERE
                         PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                     AND PRD.PO_ORD_NUM   = PD.PO_ORD_NUM
                     AND PRD.PO_ORD_DTL_LINE_NUM   = PD.PO_ORD_DTL_LINE_NUM
                     AND PRD.EZCANCELFLAG = '0'
                     AND ROWNUM = 1)
                    , PD.PRCH_REQ_LINE_NUM) AS PRCH_REQ_LINE_NUM
                ,PD.TRX_REF_NUM
                ,PD.TRX_REF_LINE_NUM
                ,CASE WHEN PD.PO_ORD_NUM &lt;&gt; PD.ORIG_PO_ORD_NUM THEN PD.ORIG_PO_ORD_NUM ELSE NULL END AS ORIG_PO_ORD_NUM
                ,CASE WHEN PD.DISP_PO_DTL_LINE_NUM &lt;&gt; PD.ORIG_DISP_PO_DTL_LINE_NUM THEN PD.ORIG_DISP_PO_DTL_LINE_NUM ELSE NULL END AS ORIG_DISP_PO_DTL_LINE_NUM
                ,'0' PO_ACK_NUM
                ,P.PO_SEND_TS AS PO_SEND_TS_A0
                ,PD.PO_SEND_TS AS PO_SEND_DT_A1
                ,NULL AS VND_PO_ACK_STS_CD
                ,NULL AS VND_PO_ACK_STS_DESC_TXT
                ,NULL AS ORD_LAST_UPD_TS
                ,NULL AS ORD_QTY
                ,NULL AS XX_TOT_AMT
                ,NULL AS ETD_DT
                ,NULL AS ETA_DT
                ,NULL AS VND_OTBD_CARR_NM
                ,PD.PRO_NUM
                ,NULL AS VND_SO_NUM
                ,NULL AS VND_SO_SLP_NUM
                ,PD.VND_INVTY_LOC_CD
                ,NULL AS VND_SHIP_TO_CUST_LOC_NM
                ,NULL AS VND_SELL_TO_CUST_LOC_NM
                ,NULL AS THIS_MTH_FOB_COST_AMT
                ,NULL AS VND_CHILD_BOM_PRC_AMT
                ,P.VND_ISS_ORD_NUM
                ,PD.VND_ISS_PO_ORD_NUM
                ,NULL AS VND_PO_ACK_LINE_STS_TXT
                ,NULL AS VND_OTBD_CARR_CD
                ,NULL AS VND_CPO_DTL_LINE_NUM
                ,NULL AS VND_CPO_DTL_LINE_SUB_NUM
                ,NULL AS CARR_TRK_URL
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                ,AMV.COA_MDSE_TP_CD
                ,AMV.COA_PROD_CD
                ,P.PRNT_VND_CD
                ,P.PRNT_VND_NM
                ,P.VND_CD
                ,P.VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                ,PD.GLBL_CMPY_CD
                ,PD.PO_ORD_DTL_LINE_NUM
            <!-- add end 2022/05/19 QC#57934 -->
            <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
                ,PD.RQST_SHIP_DT
            <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
            FROM 
                 PO P
                ,PO_DTL PD
                ,PO_DTL PD2
                ,SHPG_SVC_LVL SSL
                ,PO_MATCH_TP PMT
                ,PO_LINE_TP PLT
                ,PO_LINE_STS PLS
                ,DS_PO_TP DPT
                ,PO_HDR_STS PHS
                ,PO_APVL_STS PAS
                ,ALL_MDSE_V AMV
                <isNotNull property="msg.rtlSwhNm">
                ,RTL_SWH RS
                </isNotNull>
                <isNotNull property="msg.rtlWhNm">
                ,RTL_WH RW
                </isNotNull>
                <isNotNull property="msg.fullPsnNm">
                ,SCE_SYS_USR_LIST SSUL
                ,AUTH_PSN AP
                </isNotNull>
            WHERE 
                -- JOIN TO PO
                P.GLBL_CMPY_CD = #glblCmpyCd#
                AND P.EZCANCELFLAG = '0'
                <isNotNull property="msg.poOrdNum">
                AND P.PO_ORD_NUM LIKE #msg.poOrdNum#
                </isNotNull>
                <isNotNull property="msg.poOrdSrcCd_SL">
                AND P.PO_ORD_SRC_CD = #msg.poOrdSrcCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndCd">
                AND P.VND_CD = #msg.vndCd#
                </isNotNull>
                <isNotNull property="msg.vndNm">
                AND P.VND_NM LIKE #msg.vndNm#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_FR">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &gt;= #msg.poSubmtDt_FR#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_TO">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &lt;= #msg.poSubmtDt_TO#
                </isNotNull>
                <isNotNull property="msg.vndIssOrdNum">
                AND P.VND_ISS_ORD_NUM LIKE #msg.vndIssOrdNum#
                </isNotNull>
                -- JOIN TO DS_PO
                <isNotNull property="msg.poHdrStsCd_SL">
                AND P.PO_HDR_STS_CD = #msg.poHdrStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.poApvlStsCd_SL">
                AND P.PO_APVL_STS_CD = #msg.poApvlStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.dsPoTpCd_SL">
                AND P.DS_PO_TP_CD = #msg.dsPoTpCd_SL#
                </isNotNull>
                <isNotNull property="msg.prntVndCd">
                AND P.PRNT_VND_CD = #msg.prntVndCd#
                </isNotNull>
                <isNotNull property="msg.prntVndNm">
                AND P.PRNT_VND_NM LIKE #msg.prntVndNm#
                </isNotNull>
                <isNotNull property="msg.destRtlWhCd">
                AND P.DEST_RTL_WH_CD = #msg.destRtlWhCd#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_FR">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &gt;= #msg.xxDt10Dt_FR#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_TO">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &lt;= #msg.xxDt10Dt_TO#
                </isNotNull>
                <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
                -- JOIN TO PO_DTL
                AND P.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                AND PD.EZCANCELFLAG = '0'
                AND P.PO_ORD_NUM = PD.PO_ORD_NUM
                <!-- START 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isNotNull property="msg.prchReqNum">
                AND (PD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                            PRCH_REQ_DTL PRD
                        WHERE
                            PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                        AND PRD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                        AND PRD.PO_ORD_NUM   = P.PO_ORD_NUM
                        AND PRD.EZCANCELFLAG = '0'
                    )
                )
                </isNotNull>
                <!-- END 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isEqual property="searchCond1" compareValue="1">
                <isNotNull property="msg.shpgSvcLvlCd_SL">
                AND PD.SHPG_SVC_LVL_CD = #msg.shpgSvcLvlCd_SL#
                </isNotNull>
                <isNotNull property="msg.shipToCustCd">
                AND PD.SHIP_TO_CUST_CD = #msg.shipToCustCd#
                </isNotNull>
                <isNotNull property="msg.shipToCustLocNm">
                AND PD.SHIP_TO_LOC_NM LIKE #msg.shipToCustLocNm#
                </isNotNull>
                <isNotNull property="msg.mdseCd">
                AND PD.ORIG_MDSE_CD LIKE #msg.mdseCd#
                </isNotNull>
                <isNotNull property="msg.mdseCd_SB">
                AND PD.MDSE_CD LIKE #msg.mdseCd_SB#
                </isNotNull>
                </isEqual>
                <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
                -- JOIN TO DS_PO_DTL
                AND P.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                <isEqual property="searchCond1" compareValue="1">
                <isNotNull property="msg.trxRefNum">
                AND PD.TRX_REF_NUM LIKE #msg.trxRefNum#
                </isNotNull>
                <isNotNull property="msg.destRtlSwhCd">
                AND PD.DEST_RTL_SWH_CD LIKE #msg.destRtlSwhCd#
                </isNotNull>
                <isNotNull property="msg.poLineStsCd_SL">
                AND PD.PO_LINE_STS_CD = #msg.poLineStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndPoAckStsCd_SL">
                AND PD.VND_PO_ACK_STS_CD = #msg.vndPoAckStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.proNum">
                AND PD.PRO_NUM LIKE #msg.proNum#
                </isNotNull>
                <isNotNull property="msg.vndInvtyLocCd">
                AND PD.VND_INVTY_LOC_CD LIKE #msg.vndInvtyLocCd#
                </isNotNull>
                <isNotNull property="msg.aslMdseCd">
                AND PD.ASL_MDSE_CD LIKE #msg.aslMdseCd#
                </isNotNull>
                </isEqual>
                -- LEFT JOIN TO PO_DTL 2
                AND PD.GLBL_CMPY_CD = PD2.GLBL_CMPY_CD(+)
                AND PD2.EZCANCELFLAG(+) = '0'
                AND PD.PO_ORD_NUM = PD2.PO_ORD_NUM(+)
                AND PD.SET_PO_ORD_DTL_LINE_NUM = PD2.PO_ORD_DTL_LINE_NUM(+)
                -- LEFT JOIN TO SHPG_SVC_LVL
                AND PD.GLBL_CMPY_CD = SSL.GLBL_CMPY_CD(+)
                AND SSL.EZCANCELFLAG(+) = '0'
                AND PD.SHPG_SVC_LVL_CD = SSL.SHPG_SVC_LVL_CD(+)
                -- LEFT JOIN TO PO_MATCH_TP
                AND PD.GLBL_CMPY_CD = PMT.GLBL_CMPY_CD(+)
                AND PMT.EZCANCELFLAG(+) = '0'
                AND PD.PO_MATCH_TP_CD = PMT.PO_MATCH_TP_CD(+)
                -- LEFT JOIN TO PO_LINE_TP
                AND PD.GLBL_CMPY_CD = PLT.GLBL_CMPY_CD(+)
                AND PLT.EZCANCELFLAG(+) = '0'
                AND PD.PO_LINE_TP_CD = PLT.PO_LINE_TP_CD(+)
                -- LEFT JOIN TO PO_LINE_STS
                AND PD.GLBL_CMPY_CD = PLS.GLBL_CMPY_CD(+)
                AND PLS.EZCANCELFLAG(+) = '0'
                AND PD.PO_LINE_STS_CD = PLS.PO_LINE_STS_CD(+)
                -- LEFT JOIN TO DS_PO_TP
                AND P.GLBL_CMPY_CD = DPT.GLBL_CMPY_CD(+)
                AND DPT.EZCANCELFLAG(+) = '0'
                AND P.DS_PO_TP_CD = DPT.DS_PO_TP_CD(+)
                -- LEFT JOIN TO PO_HDR_STS
                AND P.GLBL_CMPY_CD = PHS.GLBL_CMPY_CD(+)
                AND PHS.EZCANCELFLAG(+) = '0'
                AND P.PO_HDR_STS_CD = PHS.PO_HDR_STS_CD(+)
                -- LEFT JOIN TO PO_APVL_STS
                AND P.GLBL_CMPY_CD = PAS.GLBL_CMPY_CD(+)
                AND PAS.EZCANCELFLAG(+) = '0'
                AND P.PO_APVL_STS_CD = PAS.PO_APVL_STS_CD(+)
                <isNotNull property="msg.fullPsnNm">
                -- LEFT JOIN TO SCE_SYS_USR_LIST
                AND P.GLBL_CMPY_CD = SSUL.GLBL_CMPY_CD(+)
                AND SSUL.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = SSUL.FULL_PSN_NM(+)
                -- LEFT JOIN TO AUTH_PSN
                AND P.GLBL_CMPY_CD = AP.GLBL_CMPY_CD(+)
                AND AP.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = AP.USR_NM(+)
                AND
                    (
                    UPPER(AP.FIRST_NM || (NVL2(AP.MID_NM, ' '||AP.MID_NM||' ', ' ')) || AP.LAST_NM) LIKE UPPER(#msg.fullPsnNm#)
                    OR
                    UPPER(SSUL.FULL_PSN_NM) LIKE UPPER(#msg.fullPsnNm#)
                    )
                </isNotNull>
                -- LEFT JOIN TO ALL_MDSE_V
                AND PD.GLBL_CMPY_CD = AMV.GLBL_CMPY_CD(+)
                AND AMV.EZCANCELFLAG(+) = '0'
                AND PD.ORIG_MDSE_CD = AMV.MDSE_CD(+)
                <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                <isNotNull property="msg.coaMdseTpCd">
                AND AMV.COA_MDSE_TP_CD LIKE #msg.coaMdseTpCd#
                </isNotNull>
                <isNotNull property="msg.coaProdCd">
                AND AMV.COA_PROD_CD LIKE #msg.coaProdCd#
                </isNotNull>
                <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                <isNotNull property="msg.rtlWhNm">
                -- LEFT JOIN TO RTL_WH
                AND P.GLBL_CMPY_CD = RW.GLBL_CMPY_CD(+)
                AND RW.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD = RW.RTL_WH_CD(+)
                AND RW.RTL_WH_NM LIKE #msg.rtlWhNm#
                </isNotNull>
                <isEqual property="searchCond1" compareValue="1">
                <isNotNull property="msg.rtlSwhNm">
                -- LEFT JOIN TO RTL_SWH
                AND P.GLBL_CMPY_CD = RS.GLBL_CMPY_CD(+)
                AND RS.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD = RS.RTL_WH_CD(+)
                AND PD.DEST_RTL_SWH_CD = RS.RTL_SWH_CD(+)
                AND RS.RTL_SWH_NM LIKE #msg.rtlSwhNm#
                </isNotNull>
                </isEqual>
                <isEqual property="searchCond2" compareValue="1">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                         PO_ACK_HDR E2_PAH
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                    ,PO_ACK_DTL E2_PAD -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                    WHERE 
                        -- JOIN TO PO_ACK_HDR
                        P.GLBL_CMPY_CD = E2_PAH.GLBL_CMPY_CD
                    AND E2_PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAH.PO_ORD_NUM
                    <isNotNull property="msg.xxOrdDt_FR">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &gt;= #msg.xxOrdDt_FR#
                    </isNotNull>
                    <isNotNull property="msg.xxOrdDt_TO">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &lt;= #msg.xxOrdDt_TO#
                    </isNotNull>
                    
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                AND P.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD -->
<!--                AND E2_PAD.EZCANCELFLAG = '0' -->
<!--                AND E2_PAH.PO_ACK_HDR_PK = E2_PAD.PO_ACK_HDR_PK -->
<!--                <isNotNull property="msg.vndSoNum"> -->
<!--                AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum# -->
<!--                </isNotNull> -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                )
                </isEqual>
<!-- START 02/10/2020 T.Ogura [QC#55712,ADD] -->
                <isNotNull property="msg.vndSoNum">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                        PO_ACK_DTL E2_PAD
                    WHERE 
                        P.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD
                    AND E2_PAD.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAD.PO_ORD_NUM
                    AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum#
                )
                </isNotNull>
<!-- END   02/10/2020 T.Ogura [QC#55712,ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                <isNotEqual property="msg.xxChkBox_H1" compareValue="Y">
                AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            CM_ACRL_WRITE_OFF A
                        WHERE
                                PD.PO_MDSE_CMPSN_TP_CD = #poMdseCmpsnTpRegular#
                            AND A.GLBL_CMPY_CD         = PD.GLBL_CMPY_CD
                            AND A.PO_NUM               = PD.PO_ORD_NUM
                            AND A.PO_ORD_DTL_LINE_NUM  = PD.PO_ORD_DTL_LINE_NUM
                            AND A.WRT_OFF_FLG          = #flgOnY#
                            <iterate property="coaAcctCdList" var="coaAcctCd[]" open="AND A.COA_ACCT_CD IN (" close=")" conjunction= "," >
                                #coaAcctCd[]#
                            </iterate>
                            AND A.AJE_CM_INTFC_TP_CD   IS NULL
                            AND A.EZCANCELFLAG         = '0'
                            AND NOT EXISTS (
                                    SELECT
                                        1
                                    FROM
                                         RWS_HDR  B
                                        ,RWS_DTL  C
                                        ,RWS_STS  D
                                    WHERE
                                            B.GLBL_CMPY_CD        = A.GLBL_CMPY_CD
                                        AND B.PO_RCV_TRX_HDR_NUM  = A.PO_NUM
                                        AND B.EZCANCELFLAG        = '0'
                                        AND B.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
                                        AND B.RWS_NUM             = C.RWS_NUM
                                        AND C.PO_RCV_TRX_LINE_NUM = A.PO_ORD_DTL_LINE_NUM
                                        AND C.EZCANCELFLAG        = '0'
                                        AND C.GLBL_CMPY_CD        = D.GLBL_CMPY_CD
                                        AND C.RWS_STS_CD          = D.RWS_STS_CD
                                        AND D.RWS_OPEN_FLG        = #flgOnY#
                                        AND D.EZCANCELFLAG        = '0'
                                )
                    )
                </isNotEqual>
            <!-- add end 2022/05/19 QC#57934 -->
            ORDER BY 
                P.PO_ORD_NUM ASC
                ,DISP_PO_DTL_LINE_NUM ASC
                ,SORT_INDEX ASC
        )
        WHERE ROWNUM &lt;= #rowNum#
        <!-- add start 2022/05/19 QC#57934 -->
        )
        ,WRITE_OFF_INFO AS (
            SELECT
                 E.PO_ORD_NUM
                ,E.PO_ORD_DTL_LINE_NUM
                ,SUM(E.RCV_WO_QTY) AS RCV_WO_QTY
                ,SUM(E.INV_WO_QTY) AS INV_WO_QTY
            FROM
                (
                 SELECT
                      D.PO_ORD_NUM
                     ,D.PO_ORD_DTL_LINE_NUM
                     ,D.WRT_OFF_DT
                     ,SUM(D.RCV_QTY) AS RCV_QTY
                     ,SUM(D.INV_QTY) AS INV_QTY
                     ,MAX(D.RCV_UNIT_PRC_AMT) AS RCV_UNIT_PRC_AMT
                     ,MAX(D.INV_UNIT_PRC_AMT) AS INV_UNIT_PRC_AMT
                     ,CASE WHEN SUM(D.INV_QTY) &lt; SUM(D.RCV_QTY)
                               THEN SUM(D.RCV_QTY) - SUM(D.INV_QTY)
                           <!-- mod start 2022/08/05 QC#59245 -->
                           <!-- WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND MAX(D.INV_UNIT_PRC_AMT) &lt; MAX(D.RCV_UNIT_PRC_AMT) -->
                           WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND SUM(D.INV_AMT) &lt; SUM(D.RCV_AMT)
                           <!-- mod end 2022/08/05 QC#59245 -->
                               THEN SUM(D.RCV_QTY)
                           ELSE 0
                      END AS RCV_WO_QTY
                     ,CASE WHEN SUM(D.INV_QTY) &gt; SUM(D.RCV_QTY)
                               THEN SUM(D.INV_QTY) - SUM(D.RCV_QTY)
                           <!-- mod start 2022/08/05 QC#59245 -->
                           <!-- WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND MAX(D.INV_UNIT_PRC_AMT) &gt; MAX(D.RCV_UNIT_PRC_AMT) -->
                           WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND SUM(D.INV_AMT) &gt; SUM(D.RCV_AMT)
                           <!-- mod end 2022/08/05 QC#59245 -->
                               THEN SUM(D.INV_QTY)
                           ELSE 0
                      END AS INV_WO_QTY
                 FROM
                     (
                      SELECT
                           P.PO_ORD_NUM
                          ,P.PO_ORD_DTL_LINE_NUM
                          ,A.WRT_OFF_DT
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpDr# THEN NVL(A.INV_RCV_QTY, 0) ELSE 0 END AS RCV_QTY
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr# THEN NVL(A.INV_QTY, 0) ELSE 0 END AS INV_QTY
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpDr# THEN NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0) ELSE 0 END AS RCV_UNIT_PRC_AMT
                          <!-- mod start 2022/08/05 QC#59245 -->
                          <!--
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr#
                                    THEN
                                      CASE WHEN B.ENT_DEAL_NET_UNIT_PRC_AMT = C.ENT_DEAL_NET_UNIT_PRC_AMT
                                               THEN B.ENT_DEAL_NET_UNIT_PRC_AMT
                                           ELSE NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0)
                                      END
                                ELSE 0
                           END INV_UNIT_PRC_AMT
                          -->
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr# THEN NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0) ELSE 0 END AS INV_UNIT_PRC_AMT
                          <!-- mod end 2022/08/05 QC#59245 -->
                          <!-- add start 2022/08/05 QC#59245 -->
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpDr# THEN NVL(A.INV_RCV_QTY, 0) * NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0) ELSE 0 END AS RCV_AMT
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr# THEN NVL(A.AC_INV_JRNL_COST_AMT, 0) ELSE 0 END AS INV_AMT
                          <!-- add end 2022/08/05 QC#59245 -->
                      FROM
                           PO_DTL_INFO        P
                          ,CM_ACRL_WRITE_OFF  A
                          <!-- del start 2022/08/05 QC#59245 -->
                          <!-- ,CM_AP_INV_DTL      B -->
                          <!-- ,PO_DTL             C -->
                          <!-- del end 2022/08/05 QC#59245 -->
                      WHERE
                              P.GLBL_CMPY_CD         = A.GLBL_CMPY_CD
                          AND P.PO_ORD_NUM           = A.PO_NUM
                          AND P.PO_ORD_DTL_LINE_NUM  = A.PO_ORD_DTL_LINE_NUM
                          AND A.WRT_OFF_FLG          = #flgOnY#
                          <iterate property="coaAcctCdList" var="coaAcctCd[]" open="AND A.COA_ACCT_CD IN (" close=")" conjunction= "," >
                              #coaAcctCd[]#
                          </iterate>
                          AND A.AJE_CM_INTFC_TP_CD   IS NULL
                          AND A.EZCANCELFLAG         = '0'
                          <!-- del start 2022/08/05 QC#59245 -->
                          <!--
                          AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD(+)
                          AND A.AP_VND_INV_NUM       = B.AP_VND_INV_NUM(+)
                          AND A.AP_VND_INV_LINE_NUM  = B.AP_VND_INV_LINE_NUM(+)
                          AND B.EZCANCELFLAG(+)      = '0'
                          AND A.GLBL_CMPY_CD         = C.GLBL_CMPY_CD(+)
                          AND A.PO_NUM               = C.PO_ORD_NUM(+)
                          AND A.PO_ORD_DTL_LINE_NUM  = C.PO_ORD_DTL_LINE_NUM(+)
                          AND C.EZCANCELFLAG(+)      = '0'
                          -->
                          <!-- del end 2022/08/05 QC#59245 -->
                     ) D
                 GROUP BY
                      D.PO_ORD_NUM
                     ,D.PO_ORD_DTL_LINE_NUM
                     ,D.WRT_OFF_DT
                 ) E
            GROUP BY
                 E.PO_ORD_NUM
                ,E.PO_ORD_DTL_LINE_NUM
        )        
        SELECT
             P.PO_ORD_NUM
            ,P.DS_PO_TP_DESC_TXT
            ,P.PO_HDR_STS_DESC_TXT
            ,P.PO_APVL_STS_DESC_TXT
            ,P.PO_DISP_LINE_NUM
            ,P.PO_LINE_TP_DESC_TXT
            ,P.MDSE_CD_A0
            ,P.MDSE_CD_A1
            ,P.SET_PO_ORD_DTL_LINE_NUM
            ,P.XX_MDSE_CD_A0
            ,P.XX_MDSE_CD_A1
            ,P.ASL_MDSE_CD
            ,P.MDSE_DESC_SHORT_TXT
            ,P.ENT_DEAL_NET_UNIT_PRC_AMT
            ,P.PO_DISP_QTY
            ,P.PO_SUBMT_DT
            ,P.SHIP_TO_CUST_CD
            ,P.SHIP_TO_LOC_NM
            ,P.DEST_RTL_WH_CD
            ,P.RQST_RTL_SWH_CD
            ,P.PO_MATCH_TP_DESC_TXT
            ,P.PO_LINE_STS_DESC_TXT
            ,P.ENT_PO_DTL_DEAL_NET_AMT
            ,P.PO_MDSE_CMPSN_TP_CD
            ,P.RCV_PO_QTY
            ,P.PO_INV_QTY
            ,P.PO_CANC_QTY
            ,P.SHPG_SVC_LVL_DESC_TXT
            ,P.PRCH_REQ_NUM
            ,P.PRCH_REQ_LINE_NUM
            ,P.TRX_REF_NUM
            ,P.TRX_REF_LINE_NUM
            ,P.ORIG_PO_ORD_NUM
            ,P.ORIG_DISP_PO_DTL_LINE_NUM
            ,P.PO_ACK_NUM
            ,P.PO_SEND_TS_A0
            ,P.PO_SEND_DT_A1
            ,P.VND_PO_ACK_STS_CD
            ,P.VND_PO_ACK_STS_DESC_TXT
            ,P.ORD_LAST_UPD_TS
            ,P.ORD_QTY
            ,P.XX_TOT_AMT
            ,P.ETD_DT
            ,P.ETA_DT
            ,P.VND_OTBD_CARR_NM
            ,P.PRO_NUM
            ,P.VND_SO_NUM
            ,P.VND_SO_SLP_NUM
            ,P.VND_INVTY_LOC_CD
            ,P.VND_SHIP_TO_CUST_LOC_NM
            ,P.VND_SELL_TO_CUST_LOC_NM
            ,P.THIS_MTH_FOB_COST_AMT
            ,P.VND_CHILD_BOM_PRC_AMT
            ,P.VND_CPO_ORD_NUM
            ,P.VND_ISS_PO_ORD_NUM
            ,P.VND_PO_ACK_LINE_STS_TXT
            ,P.VND_OTBD_CARR_CD
            ,P.VND_CPO_DTL_LINE_NUM
            ,P.VND_CPO_DTL_LINE_SUB_NUM
            ,P.COA_MDSE_TP_CD
            ,P.COA_PROD_CD
            ,P.PRNT_VND_CD
            ,P.PRNT_VND_NM
            ,P.VND_CD
            ,P.VND_NM
            ,CASE WHEN P.RCV_PO_QTY IS NULL THEN NULL ELSE NVL(W.RCV_WO_QTY, 0) END AS RCV_WO_QTY
            ,CASE WHEN P.PO_INV_QTY IS NULL THEN NULL ELSE NVL(W.INV_WO_QTY, 0) END AS INV_WO_QTY
            <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
            ,P.RQST_SHIP_DT
            <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
        FROM
             PO_DTL_INFO     P
            ,WRITE_OFF_INFO  W
        WHERE
                P.PO_ORD_NUM           = W.PO_ORD_NUM(+)
            AND P.PO_ORD_DTL_LINE_NUM  = W.PO_ORD_DTL_LINE_NUM(+)
        ORDER BY
             P.PO_ORD_NUM ASC
            ,TO_NUMBER(P.PO_ORD_DTL_LINE_NUM) ASC
        <!-- add end 2022/05/19 QC#57934 -->

    </statement>
    
    <statement id="getDispLevelPoAckSearchForCsv" parameterClass="Map">
        <!-- add start 2022/05/19 QC#57934 -->
        WITH PO_DTL_INFO AS (
        <!-- add end 2022/05/19 QC#57934 -->
        SELECT
             SORT_INDEX
            ,PO_ORD_NUM
            ,DS_PO_TP_DESC_TXT
            ,PO_HDR_STS_DESC_TXT
            ,PO_APVL_STS_DESC_TXT
            ,PO_DISP_LINE_NUM
            ,PO_LINE_TP_DESC_TXT
            ,MDSE_CD_A0
            ,MDSE_CD_A1
            ,SET_PO_ORD_DTL_LINE_NUM
            ,XX_MDSE_CD_A0
            ,XX_MDSE_CD_A1
            ,ASL_MDSE_CD
            ,MDSE_DESC_SHORT_TXT
            ,ENT_DEAL_NET_UNIT_PRC_AMT
            ,PO_DISP_QTY
            ,SUBSTRB(PO_SUBMT_TS,1,8) AS PO_SUBMT_DT
            ,SHIP_TO_CUST_CD
            ,SHIP_TO_LOC_NM
            ,DEST_RTL_WH_CD
            ,RQST_RTL_SWH_CD
            ,PO_MATCH_TP_DESC_TXT
            ,PO_LINE_STS_DESC_TXT
            ,ENT_PO_DTL_DEAL_NET_AMT
            ,PO_MDSE_CMPSN_TP_CD
            ,RCV_PO_QTY
            ,PO_INV_QTY
            ,PO_CANC_QTY
            ,SHPG_SVC_LVL_DESC_TXT
            ,PRCH_REQ_NUM
            ,PRCH_REQ_LINE_NUM
            ,TRX_REF_NUM
            ,TRX_REF_LINE_NUM
            ,ORIG_PO_ORD_NUM
            ,ORIG_DISP_PO_DTL_LINE_NUM AS ORIG_DISP_PO_DTL_LINE_NUM
            ,PO_ACK_NUM
            ,SUBSTRB(PO_SEND_TS_A0,1,8) AS PO_SEND_TS_A0
            ,SUBSTRB(PO_SEND_DT_A1,1,8) AS PO_SEND_DT_A1
            ,VND_PO_ACK_STS_CD
            ,VND_PO_ACK_STS_DESC_TXT
            ,SUBSTRB(ORD_LAST_UPD_TS,1,8) AS ORD_LAST_UPD_TS
            ,ORD_QTY
            ,XX_TOT_AMT
            ,SUBSTRB(ETD_DT,1,8) AS ETD_DT
            ,SUBSTRB(ETA_DT,1,8) AS ETA_DT
            ,VND_OTBD_CARR_NM
            ,PRO_NUM
            ,VND_SO_NUM
            ,VND_SO_SLP_NUM
            ,VND_INVTY_LOC_CD
            ,VND_SHIP_TO_CUST_LOC_NM
            ,VND_SELL_TO_CUST_LOC_NM
            ,THIS_MTH_FOB_COST_AMT
            ,VND_CHILD_BOM_PRC_AMT
            ,VND_CPO_ORD_NUM
            ,VND_ISS_PO_ORD_NUM
            ,VND_PO_ACK_LINE_STS_TXT
            ,VND_OTBD_CARR_CD
            ,VND_CPO_DTL_LINE_NUM
            ,VND_CPO_DTL_LINE_SUB_NUM
            ,CARR_TRK_URL
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            ,COA_MDSE_TP_CD
            ,COA_PROD_CD
            ,PRNT_VND_CD
            ,PRNT_VND_NM
            ,VND_CD
            ,VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
            ,GLBL_CMPY_CD
            ,PO_ORD_DTL_LINE_NUM
            <!-- add end 2022/05/19 QC#57934 -->
            <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
            ,SUBSTRB(RQST_SHIP_DT,1,8) AS RQST_SHIP_DT
            <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
        FROM (
            ---------------------------------
            -- Header
            ---------------------------------
            SELECT 
                '1' AS SORT_INDEX
                ,P.PO_ORD_NUM
                ,DPT.DS_PO_TP_DESC_TXT
                ,PHS.PO_HDR_STS_DESC_TXT
                ,PAS.PO_APVL_STS_DESC_TXT
                ,NULL AS PO_DISP_LINE_NUM
                ,NULL AS PO_LINE_TP_DESC_TXT
                ,NULL AS MDSE_CD_A0
                ,NULL AS MDSE_CD_A1
                ,NULL AS SET_PO_ORD_DTL_LINE_NUM
                ,NULL AS XX_MDSE_CD_A0
                ,NULL AS XX_MDSE_CD_A1
                ,NULL AS ASL_MDSE_CD
                ,NULL AS MDSE_DESC_SHORT_TXT
                ,NULL AS ENT_DEAL_NET_UNIT_PRC_AMT
                ,NULL AS PO_DISP_QTY
                ,NULL AS PO_SUBMT_TS
                ,PD.SHIP_TO_CUST_CD
                ,PD.SHIP_TO_LOC_NM
                ,P.DEST_RTL_WH_CD
                ,NULL AS RQST_RTL_SWH_CD
                ,NULL AS PO_MATCH_TP_DESC_TXT
                ,NULL AS PO_LINE_STS_DESC_TXT
                ,NULL AS ENT_PO_DTL_DEAL_NET_AMT
                ,NULL AS PO_MDSE_CMPSN_TP_CD
                ,NULL AS RCV_PO_QTY
                ,NULL AS PO_INV_QTY
                ,NULL AS PO_CANC_QTY
                ,SSL.SHPG_SVC_LVL_DESC_TXT
                ,NVL((SELECT
                         PRD.PRCH_REQ_NUM
                     FROM
                         PRCH_REQ_DTL PRD
                     WHERE
                         PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                     AND PRD.PO_ORD_NUM   = PD.PO_ORD_NUM
                     AND PRD.EZCANCELFLAG = '0'
                     AND ROWNUM = 1)
                    , PD.PRCH_REQ_NUM) AS PRCH_REQ_NUM
                ,NULL AS PRCH_REQ_LINE_NUM
                ,PD.TRX_REF_NUM
                ,NULL AS TRX_REF_LINE_NUM
                ,PD.ORIG_PO_ORD_NUM
                ,NULL AS ORIG_DISP_PO_DTL_LINE_NUM
                ,NULL AS PO_ACK_NUM
                ,P.PO_SEND_TS AS PO_SEND_TS_A0
                ,NULL AS PO_SEND_DT_A1
                ,NULL AS VND_PO_ACK_STS_CD
                ,NULL AS VND_PO_ACK_STS_DESC_TXT
                ,NULL AS ORD_LAST_UPD_TS
                ,NULL AS ORD_QTY
                ,NULL AS XX_TOT_AMT
                ,NULL AS ETD_DT
                ,NULL AS ETA_DT
                ,NULL AS VND_OTBD_CARR_NM
                ,NULL AS PRO_NUM
                ,NULL AS VND_SO_NUM
                ,NULL AS VND_SO_SLP_NUM
                ,NULL AS VND_INVTY_LOC_CD
                ,NULL AS VND_SHIP_TO_CUST_LOC_NM
                ,NULL AS VND_SELL_TO_CUST_LOC_NM
                ,NULL AS THIS_MTH_FOB_COST_AMT
                ,NULL AS VND_CHILD_BOM_PRC_AMT
                ,NULL AS VND_CPO_ORD_NUM
                ,NULL AS VND_ISS_PO_ORD_NUM
                ,NULL AS VND_PO_ACK_LINE_STS_TXT
                ,NULL AS VND_OTBD_CARR_CD
                ,NULL AS VND_CPO_DTL_LINE_NUM
                ,NULL AS VND_CPO_DTL_LINE_SUB_NUM
                ,NULL AS CARR_TRK_URL
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                ,NULL AS COA_MDSE_TP_CD
                ,NULL AS COA_PROD_CD
                ,P.PRNT_VND_CD
                ,P.PRNT_VND_NM
                ,P.VND_CD
                ,P.VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                ,P.GLBL_CMPY_CD
                ,NULL AS PO_ORD_DTL_LINE_NUM
            <!-- add end 2022/05/19 QC#57934 -->
            <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
                ,PD.RQST_SHIP_DT
            <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
            FROM 
                 PO P
                ,PO_DTL PD
                ,SHPG_SVC_LVL SSL
                ,DS_PO_TP DPT
                ,PO_HDR_STS PHS
                ,PO_APVL_STS PAS
                ,AUTH_PSN AP
                ,RTL_WH RW
                ,SCE_SYS_USR_LIST SSUL
            WHERE 
                -- JOIN TO PO
                P.GLBL_CMPY_CD = #glblCmpyCd#
                AND P.EZCANCELFLAG = '0'
                <isNotNull property="msg.poOrdNum">
                AND P.PO_ORD_NUM LIKE #msg.poOrdNum#
                </isNotNull>
                <isNotNull property="msg.poOrdSrcCd_SL">
                AND P.PO_ORD_SRC_CD = #msg.poOrdSrcCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndCd">
                AND P.VND_CD = #msg.vndCd#
                </isNotNull>
                <isNotNull property="msg.vndNm">
                AND P.VND_NM LIKE #msg.vndNm#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_FR">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &gt;= #msg.poSubmtDt_FR#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_TO">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &lt;= #msg.poSubmtDt_TO#
                </isNotNull>
                <isNotNull property="msg.vndIssOrdNum">
                AND P.VND_ISS_ORD_NUM LIKE #msg.vndIssOrdNum#
                </isNotNull>
                <isNotNull property="msg.poHdrStsCd_SL">
                AND P.PO_HDR_STS_CD = #msg.poHdrStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.poApvlStsCd_SL">
                AND P.PO_APVL_STS_CD = #msg.poApvlStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.dsPoTpCd_SL">
                AND P.DS_PO_TP_CD = #msg.dsPoTpCd_SL#
                </isNotNull>
                <isNotNull property="msg.prntVndCd">
                AND P.PRNT_VND_CD = #msg.prntVndCd#
                </isNotNull>
                <isNotNull property="msg.prntVndNm">
                AND P.PRNT_VND_NM LIKE #msg.prntVndNm#
                </isNotNull>
                <isNotNull property="msg.destRtlWhCd">
                AND P.DEST_RTL_WH_CD = #msg.destRtlWhCd#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_FR">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &gt;= #msg.xxDt10Dt_FR#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_TO">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &lt;= #msg.xxDt10Dt_TO#
                </isNotNull>
                <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
                
                -- JOIN TO PO_DTL
                AND P.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                AND PD.EZCANCELFLAG = '0'
                AND P.PO_ORD_NUM = PD.PO_ORD_NUM
                AND PD.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
                <!-- START 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isNotNull property="msg.prchReqNum">
                AND (PD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                            PRCH_REQ_DTL PRD
                        WHERE
                            PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                        AND PRD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                        AND PRD.PO_ORD_NUM   = P.PO_ORD_NUM
                        AND PRD.EZCANCELFLAG = '0'
                    )
                )
                </isNotNull>
                <!-- END 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
                
                -- LEFT JOIN TO SHPG_SVC_LVL
                AND PD.GLBL_CMPY_CD = SSL.GLBL_CMPY_CD(+)
                AND SSL.EZCANCELFLAG(+) = '0'
                AND PD.SHPG_SVC_LVL_CD = SSL.SHPG_SVC_LVL_CD(+)
                
                -- LEFT JOIN TO DS_PO_TP
                AND P.GLBL_CMPY_CD = DPT.GLBL_CMPY_CD(+)
                AND DPT.EZCANCELFLAG(+) = '0'
                AND P.DS_PO_TP_CD = DPT.DS_PO_TP_CD(+)
                
                -- LEFT JOIN TO PO_HDR_STS
                AND P.GLBL_CMPY_CD = PHS.GLBL_CMPY_CD
                AND PHS.EZCANCELFLAG(+) = '0'
                AND P.PO_HDR_STS_CD = PHS.PO_HDR_STS_CD(+)
                
                -- LEFT JOIN TO PO_APVL_STS
                AND P.GLBL_CMPY_CD = PAS.GLBL_CMPY_CD(+)
                AND PAS.EZCANCELFLAG(+) = '0'
                AND P.PO_APVL_STS_CD = PAS.PO_APVL_STS_CD(+)
                
                -- LEFT JOIN TO AUTH_PSN
                AND P.GLBL_CMPY_CD = AP.GLBL_CMPY_CD(+)
                AND AP.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = AP.USR_NM(+)
                
                -- LEFT JOIN TO SCE_SYS_USR_LIST
                AND P.GLBL_CMPY_CD = SSUL.GLBL_CMPY_CD(+)
                AND SSUL.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = SSUL.FULL_PSN_NM(+)
                <isNotNull property="msg.fullPsnNm">
                AND
                    (
                    UPPER(AP.FIRST_NM || (NVL2(AP.MID_NM, ' '||AP.MID_NM||' ', ' ')) || AP.LAST_NM) LIKE UPPER(#msg.fullPsnNm#)
                    OR
                    UPPER(SSUL.FULL_PSN_NM) LIKE UPPER(#msg.fullPsnNm#)
                    )
                </isNotNull>
                
                -- LEFT JOIN TO RTL_WH
                AND P.GLBL_CMPY_CD(+) = RW.GLBL_CMPY_CD
                AND RW.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD(+) = RW.RTL_WH_CD
                <isNotNull property="msg.rtlWhNm">
                AND RW.RTL_WH_NM(+) LIKE #msg.rtlWhNm#
                </isNotNull>
                <isEqual property="searchCond1" compareValue="1">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                         PO_DTL E1_PD
                        ,RTL_SWH E1_RS
                    WHERE 
                        -- JOIN TO PO_DTL
                        P.GLBL_CMPY_CD = E1_PD.GLBL_CMPY_CD
                    AND E1_PD.EZCANCELFLAG = '0'    
                    AND P.PO_ORD_NUM = E1_PD.PO_ORD_NUM
                    <isNotNull property="msg.shpgSvcLvlCd_SL">
                    AND E1_PD.SHPG_SVC_LVL_CD = #msg.shpgSvcLvlCd_SL#
                    </isNotNull>
                    <isNotNull property="msg.shipToCustCd">
                    AND E1_PD.SHIP_TO_CUST_CD = #msg.shipToCustCd#
                    </isNotNull>
                    <isNotNull property="msg.shipToCustLocNm">
                    AND E1_PD.SHIP_TO_LOC_NM LIKE #msg.shipToCustLocNm#
                    </isNotNull>
                    <isNotNull property="msg.mdseCd">
                    AND E1_PD.ORIG_MDSE_CD LIKE #msg.mdseCd#
                    </isNotNull>
                    <isNotNull property="msg.mdseCd_SB">
                    AND E1_PD.MDSE_CD LIKE #msg.mdseCd_SB#
                    </isNotNull>
                    <isNotNull property="msg.trxRefNum">
                    AND E1_PD.TRX_REF_NUM LIKE #msg.trxRefNum#
                    </isNotNull>
                    <isNotNull property="msg.destRtlSwhCd">
                    AND E1_PD.DEST_RTL_SWH_CD LIKE #msg.destRtlSwhCd#
                    </isNotNull>
                    <isNotNull property="msg.poLineStsCd_SL">
                    AND E1_PD.PO_LINE_STS_CD = #msg.poLineStsCd_SL#
                    </isNotNull>
                    <isNotNull property="msg.vndPoAckStsCd_SL">
                    AND E1_PD.VND_PO_ACK_STS_CD = #msg.vndPoAckStsCd_SL#
                    </isNotNull>
                    <isNotNull property="msg.proNum">
                    AND E1_PD.PRO_NUM LIKE #msg.proNum#
                    </isNotNull>
                    <isNotNull property="msg.vndInvtyLocCd">
                    AND E1_PD.VND_INVTY_LOC_CD LIKE #msg.vndInvtyLocCd#
                    </isNotNull>
                    <isNotNull property="msg.aslMdseCd">
                    AND E1_PD.ASL_MDSE_CD LIKE #msg.aslMdseCd#
                    </isNotNull>
                    
                    -- LEFT JOIN TO RTL_SWH
                    AND P.GLBL_CMPY_CD = E1_RS.GLBL_CMPY_CD(+)
                    AND E1_RS.EZCANCELFLAG(+) = '0'
                    AND P.DEST_RTL_WH_CD = E1_RS.RTL_WH_CD(+)
                    AND E1_PD.DEST_RTL_SWH_CD = E1_RS.RTL_SWH_CD(+)
                    <isNotNull property="msg.rtlSwhNm">
                    AND E1_RS.RTL_SWH_NM LIKE #msg.rtlSwhNm#
                    </isNotNull>
                )
                </isEqual>
                <isEqual property="searchCond2" compareValue="1">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                         PO_ACK_HDR E2_PAH
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                    ,PO_ACK_DTL E2_PAD -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                    WHERE 
                        -- JOIN TO PO_ACK_HDR
                        P.GLBL_CMPY_CD = E2_PAH.GLBL_CMPY_CD
                    AND E2_PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAH.PO_ORD_NUM
                    <isNotNull property="msg.xxOrdDt_FR">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &gt;= #msg.xxOrdDt_FR#
                    </isNotNull>
                    <isNotNull property="msg.xxOrdDt_TO">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &lt;= #msg.xxOrdDt_TO#
                    </isNotNull>
                    
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                AND E2_PAH.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD -->
<!--                AND E2_PAD.EZCANCELFLAG = '0' -->
<!--                AND E2_PAH.PO_ACK_HDR_PK = E2_PAD.PO_ACK_HDR_PK -->
<!--                <isNotNull property="msg.vndSoNum"> -->
<!--                AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum# -->
<!--                </isNotNull> -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                )
                </isEqual>
<!-- START 02/10/2020 T.Ogura [QC#55712,ADD] -->
                <isNotNull property="msg.vndSoNum">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                        PO_ACK_DTL E2_PAD
                    WHERE 
                        P.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD
                    AND E2_PAD.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAD.PO_ORD_NUM
                    AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum#
                )
                </isNotNull>
<!-- END   02/10/2020 T.Ogura [QC#55712,ADD] -->
            ---------------------------------
            -- Detail
            ---------------------------------
            UNION SELECT /*+ LEADING(P PD AMV) USE_NL(P PD AMV) */
                '2' AS SORT_INDEX
                ,P.PO_ORD_NUM
                ,DPT.DS_PO_TP_DESC_TXT
                ,PHS.PO_HDR_STS_DESC_TXT
                ,PAS.PO_APVL_STS_DESC_TXT
                ,TO_NUMBER(PD.DISP_PO_DTL_LINE_NUM) AS PO_DISP_LINE_NUM
                ,PLT.PO_LINE_TP_DESC_TXT
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                --,PD.ORIG_MDSE_CD AS MDSE_CD_A0
                ,DECODE(
                    AMV.MDSE_ITEM_TP_CD
                   ,#mdseItemTpCdTextItem#
                   ,NULL
                   ,PD.ORIG_MDSE_CD
                 ) MDSE_CD_A0
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,PD2.MDSE_CD AS MDSE_CD_A1
                ,PD.SET_PO_ORD_DTL_LINE_NUM
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                --,PD.MDSE_CD AS XX_MDSE_CD_A0
                ,DECODE(
                    AMV.MDSE_ITEM_TP_CD
                   ,#mdseItemTpCdTextItem#
                   ,NULL
                   ,PD.MDSE_CD
                 ) XX_MDSE_CD_A0
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,CASE WHEN PD.MDSE_CD &lt;&gt; PD.ORIG_MDSE_CD THEN PD.ORIG_MDSE_CD ELSE NULL END AS XX_MDSE_CD_A1
                ,PD.ASL_MDSE_CD
                <!-- QC#53271 Update -->
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                --,AMV.MDSE_DESC_SHORT_TXT
                <!--,DECODE(
                    AMV.MDSE_ITEM_TP_CD
                   ,#mdseItemTpCdTextItem#
                   ,PD.MDSE_DESC_SHORT_TXT
                   ,AMV.MDSE_DESC_SHORT_TXT
                 ) MDSE_DESC_SHORT_TXT
                -->
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,CASE WHEN PD.PO_LINE_TP_CD IN(#poLineTpCdExpense#, #poLineTpCdExpenseWReceipt#) THEN NVL(PD.MDSE_DESC_SHORT_TXT, AMV.MDSE_DESC_SHORT_TXT)
                       ELSE AMV.MDSE_DESC_SHORT_TXT
                 END AS MDSE_DESC_SHORT_TXT
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.ENT_DEAL_NET_UNIT_PRC_AMT END AS ENT_DEAL_NET_UNIT_PRC_AMT
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_DISP_QTY END AS PO_DISP_QTY
                ,P.PO_SUBMT_TS
                ,PD.SHIP_TO_CUST_CD
                ,PD.SHIP_TO_LOC_NM
                ,P.DEST_RTL_WH_CD
                ,PD.DEST_RTL_SWH_CD AS RQST_RTL_SWH_CD
                ,PMT.PO_MATCH_TP_DESC_TXT
                ,PLS.PO_LINE_STS_DESC_TXT
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.ENT_PO_DTL_DEAL_NET_AMT END AS ENT_PO_DTL_DEAL_NET_AMT
                ,PD.PO_MDSE_CMPSN_TP_CD
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_RCV_QTY END AS RCV_PO_QTY
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_INV_QTY END AS PO_INV_QTY
                ,CASE WHEN (
                    SELECT 
                        COUNT(PAH.PO_ORD_NUM)
                    FROM 
                        PO_ACK_HDR PAH
                    WHERE 
                        P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                ) &lt; 0 THEN NULL ELSE PD.PO_CANC_QTY END AS PO_CANC_QTY
                ,SSL.SHPG_SVC_LVL_DESC_TXT
                ,NVL((SELECT
                         PRD.PRCH_REQ_NUM
                     FROM
                         PRCH_REQ_DTL PRD
                     WHERE
                         PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                     AND PRD.PO_ORD_NUM   = PD.PO_ORD_NUM
                     AND PRD.EZCANCELFLAG = '0'
                     AND ROWNUM = 1)
                    , PD.PRCH_REQ_NUM) AS PRCH_REQ_NUM
                ,NVL((SELECT
                         PRD.PRCH_REQ_LINE_NUM
                     FROM
                         PRCH_REQ_DTL PRD
                     WHERE
                         PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                     AND PRD.PO_ORD_NUM   = PD.PO_ORD_NUM
                     AND PRD.PO_ORD_DTL_LINE_NUM   = PD.PO_ORD_DTL_LINE_NUM
                     AND PRD.EZCANCELFLAG = '0'
                     AND ROWNUM = 1)
                    , PD.PRCH_REQ_LINE_NUM) AS PRCH_REQ_LINE_NUM
                ,PD.TRX_REF_NUM
                ,PD.TRX_REF_LINE_NUM
                ,CASE WHEN PD.PO_ORD_NUM &lt;&gt; PD.ORIG_PO_ORD_NUM THEN PD.ORIG_PO_ORD_NUM ELSE NULL END AS ORIG_PO_ORD_NUM
                ,CASE WHEN PD.DISP_PO_DTL_LINE_NUM &lt;&gt; PD.ORIG_DISP_PO_DTL_LINE_NUM THEN PD.ORIG_DISP_PO_DTL_LINE_NUM ELSE NULL END AS ORIG_DISP_PO_DTL_LINE_NUM
                ,'0' PO_ACK_NUM
                ,P.PO_SEND_TS AS PO_SEND_TS_A0
                ,PD.PO_SEND_TS AS PO_SEND_DT_A1
                ,NULL AS VND_PO_ACK_STS_CD
                ,NULL AS VND_PO_ACK_STS_DESC_TXT
                ,NULL AS ORD_LAST_UPD_TS
                ,NULL AS ORD_QTY
                ,NULL AS XX_TOT_AMT
                ,NULL AS ETD_DT
                ,NULL AS ETA_DT
                ,NULL AS VND_OTBD_CARR_NM
                ,PD.PRO_NUM
                ,NULL AS VND_SO_NUM
                ,NULL AS VND_SO_SLP_NUM
                ,PD.VND_INVTY_LOC_CD
                ,NULL AS VND_SHIP_TO_CUST_LOC_NM
                ,NULL AS VND_SELL_TO_CUST_LOC_NM
                ,NULL AS THIS_MTH_FOB_COST_AMT
                ,NULL AS VND_CHILD_BOM_PRC_AMT
                ,P.VND_ISS_ORD_NUM
                ,PD.VND_ISS_PO_ORD_NUM AS VND_CPO_ORD_NUM
                ,NULL AS VND_PO_ACK_LINE_STS_TXT
                ,NULL AS VND_OTBD_CARR_CD
                ,NULL AS VND_CPO_DTL_LINE_NUM
                ,NULL AS VND_CPO_DTL_LINE_SUB_NUM
                ,NULL AS CARR_TRK_URL
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                ,AMV.COA_MDSE_TP_CD
                ,AMV.COA_PROD_CD
                ,P.PRNT_VND_CD
                ,P.PRNT_VND_NM
                ,P.VND_CD
                ,P.VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                ,PD.GLBL_CMPY_CD
                ,PD.PO_ORD_DTL_LINE_NUM
            <!-- add end 2022/05/19 QC#57934 -->
            <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
                ,PD.RQST_SHIP_DT
            <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
            FROM 
                PO P
                ,PO_DTL PD
                ,PO_DTL PD2
                ,SHPG_SVC_LVL SSL
                ,PO_MATCH_TP PMT
                ,PO_LINE_TP PLT
                ,PO_LINE_STS PLS
                ,DS_PO_TP DPT
                ,PO_HDR_STS PHS
                ,PO_APVL_STS PAS
                ,AUTH_PSN AP
                ,RTL_WH RW
                ,ALL_MDSE_V AMV
                ,RTL_SWH RS
                ,SCE_SYS_USR_LIST SSUL
            WHERE 
                -- JOIN TO PO
                P.GLBL_CMPY_CD = #glblCmpyCd#
                AND P.EZCANCELFLAG = '0'
                <isNotNull property="msg.poOrdNum">
                AND P.PO_ORD_NUM LIKE #msg.poOrdNum#
                </isNotNull>
                <isNotNull property="msg.poOrdSrcCd_SL">
                AND P.PO_ORD_SRC_CD = #msg.poOrdSrcCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndCd">
                AND P.VND_CD = #msg.vndCd#
                </isNotNull>
                <isNotNull property="msg.vndNm">
                AND P.VND_NM LIKE #msg.vndNm#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_FR">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &gt;= #msg.poSubmtDt_FR#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_TO">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &lt;= #msg.poSubmtDt_TO#
                </isNotNull>
                <isNotNull property="msg.vndIssOrdNum">
                AND P.VND_ISS_ORD_NUM LIKE #msg.vndIssOrdNum#
                </isNotNull>
                <isNotNull property="msg.poHdrStsCd_SL">
                AND P.PO_HDR_STS_CD = #msg.poHdrStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.poApvlStsCd_SL">
                AND P.PO_APVL_STS_CD = #msg.poApvlStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.dsPoTpCd_SL">
                AND P.DS_PO_TP_CD = #msg.dsPoTpCd_SL#
                </isNotNull>
                <isNotNull property="msg.prntVndCd">
                AND P.PRNT_VND_CD = #msg.prntVndCd#
                </isNotNull>
                <isNotNull property="msg.prntVndNm">
                AND P.PRNT_VND_NM LIKE #msg.prntVndNm#
                </isNotNull>
                <isNotNull property="msg.destRtlWhCd">
                AND P.DEST_RTL_WH_CD = #msg.destRtlWhCd#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_FR">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &gt;= #msg.xxDt10Dt_FR#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_TO">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &lt;= #msg.xxDt10Dt_TO#
                </isNotNull>
                <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
                -- JOIN TO PO_DTL
                AND P.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                AND PD.EZCANCELFLAG = '0'
                AND P.PO_ORD_NUM = PD.PO_ORD_NUM
                <!-- START 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isNotNull property="msg.prchReqNum">
                AND (PD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                            PRCH_REQ_DTL PRD
                        WHERE
                            PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                        AND PRD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                        AND PRD.PO_ORD_NUM   = P.PO_ORD_NUM
                        AND PRD.EZCANCELFLAG = '0'
                    )
                )
                </isNotNull>
                <!-- END 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isEqual property="searchCond1" compareValue="1">
                <isNotNull property="msg.shpgSvcLvlCd_SL">
                AND PD.SHPG_SVC_LVL_CD = #msg.shpgSvcLvlCd_SL#
                </isNotNull>
                <isNotNull property="msg.shipToCustCd">
                AND PD.SHIP_TO_CUST_CD = #msg.shipToCustCd#
                </isNotNull>
                <isNotNull property="msg.shipToCustLocNm">
                AND PD.SHIP_TO_LOC_NM LIKE #msg.shipToCustLocNm#
                </isNotNull>
                <isNotNull property="msg.mdseCd">
                AND PD.ORIG_MDSE_CD LIKE #msg.mdseCd#
                </isNotNull>
                <isNotNull property="msg.mdseCd_SB">
                AND PD.MDSE_CD LIKE #msg.mdseCd_SB#
                </isNotNull>
                </isEqual>
                <isEqual property="searchCond1" compareValue="1">
                <isNotNull property="msg.trxRefNum">
                AND PD.TRX_REF_NUM LIKE #msg.trxRefNum#
                </isNotNull>
                <isNotNull property="msg.destRtlSwhCd">
                AND PD.DEST_RTL_SWH_CD LIKE #msg.destRtlSwhCd#
                </isNotNull>
                <isNotNull property="msg.poLineStsCd_SL">
                AND PD.PO_LINE_STS_CD = #msg.poLineStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndPoAckStsCd_SL">
                AND PD.VND_PO_ACK_STS_CD = #msg.vndPoAckStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.proNum">
                AND PD.PRO_NUM LIKE #msg.proNum#
                </isNotNull>
                <isNotNull property="msg.vndInvtyLocCd">
                AND PD.VND_INVTY_LOC_CD LIKE #msg.vndInvtyLocCd#
                </isNotNull>
                <isNotNull property="msg.aslMdseCd">
                AND PD.ASL_MDSE_CD LIKE #msg.aslMdseCd#
                </isNotNull>
                </isEqual>
                <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
                -- LEFT JOIN TO PO_DTL 2
                AND PD.GLBL_CMPY_CD = PD2.GLBL_CMPY_CD(+)
                AND PD2.EZCANCELFLAG(+) = '0'
                AND PD.PO_ORD_NUM = PD2.PO_ORD_NUM(+)
                AND PD.SET_PO_ORD_DTL_LINE_NUM = PD2.PO_ORD_DTL_LINE_NUM(+)
                -- LEFT JOIN TO SHPG_SVC_LVL
                AND PD.GLBL_CMPY_CD = SSL.GLBL_CMPY_CD(+)
                AND SSL.EZCANCELFLAG(+) = '0'
                AND PD.SHPG_SVC_LVL_CD = SSL.SHPG_SVC_LVL_CD(+)
                -- LEFT JOIN TO PO_MATCH_TP
                AND PD.GLBL_CMPY_CD = PMT.GLBL_CMPY_CD(+)
                AND PMT.EZCANCELFLAG(+) = '0'
                AND PD.PO_MATCH_TP_CD = PMT.PO_MATCH_TP_CD(+)
                -- LEFT JOIN TO PO_LINE_TP
                AND PD.GLBL_CMPY_CD = PLT.GLBL_CMPY_CD(+)
                AND PLT.EZCANCELFLAG(+) = '0'
                AND PD.PO_LINE_TP_CD = PLT.PO_LINE_TP_CD(+)
                -- LEFT JOIN TO PO_LINE_STS
                AND PD.GLBL_CMPY_CD = PLS.GLBL_CMPY_CD(+)
                AND PLS.EZCANCELFLAG(+) = '0'
                AND PD.PO_LINE_STS_CD = PLS.PO_LINE_STS_CD(+)
                -- LEFT JOIN TO DS_PO_TP
                AND P.GLBL_CMPY_CD = DPT.GLBL_CMPY_CD(+)
                AND DPT.EZCANCELFLAG(+) = '0'
                AND P.DS_PO_TP_CD = DPT.DS_PO_TP_CD(+)
                -- LEFT JOIN TO PO_HDR_STS
                AND P.GLBL_CMPY_CD = PHS.GLBL_CMPY_CD(+)
                AND PHS.EZCANCELFLAG(+) = '0'
                AND P.PO_HDR_STS_CD = PHS.PO_HDR_STS_CD(+)
                -- LEFT JOIN TO PO_APVL_STS
                AND P.GLBL_CMPY_CD = PAS.GLBL_CMPY_CD(+)
                AND PAS.EZCANCELFLAG(+) = '0'
                AND P.PO_APVL_STS_CD = PAS.PO_APVL_STS_CD(+)
                -- LEFT JOIN TO AUTH_PSN
                AND P.GLBL_CMPY_CD = AP.GLBL_CMPY_CD(+)
                AND AP.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = AP.USR_NM(+)
                -- LEFT JOIN TO SCE_SYS_USR_LIST
                AND P.GLBL_CMPY_CD = SSUL.GLBL_CMPY_CD(+)
                AND SSUL.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = SSUL.FULL_PSN_NM(+)
                <isNotNull property="msg.fullPsnNm">
                AND
                    (
                    UPPER(AP.FIRST_NM || (NVL2(AP.MID_NM, ' '||AP.MID_NM||' ', ' ')) || AP.LAST_NM) LIKE UPPER(#msg.fullPsnNm#)
                    OR
                    UPPER(SSUL.FULL_PSN_NM) LIKE UPPER(#msg.fullPsnNm#)
                    )
                </isNotNull>
                -- LEFT JOIN TO RTL_WH
                AND P.GLBL_CMPY_CD = RW.GLBL_CMPY_CD(+)
                AND RW.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD = RW.RTL_WH_CD(+)
                -- LEFT JOIN TO ALL_MDSE_V
                AND PD.GLBL_CMPY_CD = AMV.GLBL_CMPY_CD(+)
                AND AMV.EZCANCELFLAG(+) = '0'
                AND PD.ORIG_MDSE_CD = AMV.MDSE_CD(+)
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                <isNotNull property="msg.coaMdseTpCd">
                AND AMV.COA_MDSE_TP_CD LIKE #msg.coaMdseTpCd#
                </isNotNull>
                <isNotNull property="msg.coaProdCd">
                AND AMV.COA_PROD_CD LIKE #msg.coaProdCd#
                </isNotNull>
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                <isNotNull property="msg.rtlWhNm">
                AND RW.RTL_WH_NM LIKE #msg.rtlWhNm#
                </isNotNull>
                -- LEFT JOIN TO RTL_SWH
                AND P.GLBL_CMPY_CD = RS.GLBL_CMPY_CD(+)
                AND RS.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD = RS.RTL_WH_CD(+)
                AND PD.DEST_RTL_SWH_CD = RS.RTL_SWH_CD(+)
                <isEqual property="searchCond1" compareValue="1">
                <isNotNull property="msg.rtlSwhNm">
                AND RS.RTL_SWH_NM LIKE #msg.rtlSwhNm#
                </isNotNull>
                </isEqual>
                <isEqual property="searchCond2" compareValue="1">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                         PO_ACK_HDR E2_PAH
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                    ,PO_ACK_DTL E2_PAD -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                    WHERE 
                        -- JOIN TO PO_ACK_HDR
                        P.GLBL_CMPY_CD = E2_PAH.GLBL_CMPY_CD
                    AND E2_PAH.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAH.PO_ORD_NUM
                    <isNotNull property="msg.xxOrdDt_FR">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &gt;= #msg.xxOrdDt_FR#
                    </isNotNull>
                    <isNotNull property="msg.xxOrdDt_TO">
                    AND SUBSTRB(E2_PAH.ORD_LAST_UPD_TS,1,8) &lt;= #msg.xxOrdDt_TO#
                    </isNotNull>
                    
<!-- START 02/10/2020 T.Ogura [QC#55712,DEL] -->
<!--                AND P.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD -->
<!--                AND E2_PAD.EZCANCELFLAG = '0' -->
<!--                AND E2_PAH.PO_ACK_HDR_PK = E2_PAD.PO_ACK_HDR_PK -->
<!--                <isNotNull property="msg.vndSoNum"> -->
<!--                AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum# -->
<!--                </isNotNull> -->
<!-- END   02/10/2020 T.Ogura [QC#55712,DEL] -->
                )
                </isEqual>
<!-- START 02/10/2020 T.Ogura [QC#55712,ADD] -->
                <isNotNull property="msg.vndSoNum">
                AND EXISTS(
                    SELECT 
                        *
                    FROM 
                        PO_ACK_DTL E2_PAD
                    WHERE 
                        P.GLBL_CMPY_CD = E2_PAD.GLBL_CMPY_CD
                    AND E2_PAD.EZCANCELFLAG = '0'
                    AND P.PO_ORD_NUM = E2_PAD.PO_ORD_NUM
                    AND E2_PAD.VND_SO_NUM LIKE #msg.vndSoNum#
                )
                </isNotNull>
<!-- END   02/10/2020 T.Ogura [QC#55712,ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                <isNotEqual property="msg.xxChkBox_H1" compareValue="Y">
                AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            CM_ACRL_WRITE_OFF A
                        WHERE
                                PD.PO_MDSE_CMPSN_TP_CD = #poMdseCmpsnTpRegular#
                            AND A.GLBL_CMPY_CD         = PD.GLBL_CMPY_CD
                            AND A.PO_NUM               = PD.PO_ORD_NUM
                            AND A.PO_ORD_DTL_LINE_NUM  = PD.PO_ORD_DTL_LINE_NUM
                            AND A.WRT_OFF_FLG          = #flgOnY#
                            <iterate property="coaAcctCdList" var="coaAcctCd[]" open="AND A.COA_ACCT_CD IN (" close=")" conjunction= "," >
                                #coaAcctCd[]#
                            </iterate>
                            AND A.AJE_CM_INTFC_TP_CD   IS NULL
                            AND A.EZCANCELFLAG         = '0'
                            AND NOT EXISTS (
                                    SELECT
                                        1
                                    FROM
                                         RWS_HDR  B
                                        ,RWS_DTL  C
                                        ,RWS_STS  D
                                    WHERE
                                            B.GLBL_CMPY_CD        = A.GLBL_CMPY_CD
                                        AND B.PO_RCV_TRX_HDR_NUM  = A.PO_NUM
                                        AND B.EZCANCELFLAG        = '0'
                                        AND B.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
                                        AND B.RWS_NUM             = C.RWS_NUM
                                        AND C.PO_RCV_TRX_LINE_NUM = A.PO_ORD_DTL_LINE_NUM
                                        AND C.EZCANCELFLAG        = '0'
                                        AND C.GLBL_CMPY_CD        = D.GLBL_CMPY_CD
                                        AND C.RWS_STS_CD          = D.RWS_STS_CD
                                        AND D.RWS_OPEN_FLG        = #flgOnY#
                                        AND D.EZCANCELFLAG        = '0'
                                )
                    )
                </isNotEqual>
            <!-- add end 2022/05/19 QC#57934 -->
            ---------------------------------
            -- ACK
            ---------------------------------
            UNION SELECT 
                '3' AS SORT_INDEX
                ,P.PO_ORD_NUM
                ,NULL AS DS_PO_TP_DESC_TXT
                ,NULL AS PO_HDR_STS_DESC_TXT
                ,NULL AS PO_APVL_STS_DESC_TXT
                ,TO_NUMBER(PD.DISP_PO_DTL_LINE_NUM) AS PO_DISP_LINE_NUM
                ,NULL AS PO_LINE_TP_DESC_TXT
                ,NULL AS MDSE_CD_A0
                ,NULL AS MDSE_CD_A1
                ,NULL AS SET_PO_ORD_DTL_LINE_NUM
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                --,PAD.MDSE_CD AS XX_MDSE_CD_A0
                ,DECODE(
                    AMV.MDSE_ITEM_TP_CD
                   ,#mdseItemTpCdTextItem#
                   ,NULL
                   ,PAD.MDSE_CD
                 ) XX_MDSE_CD_A0
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,NULL AS XX_MDSE_CD_A1
                ,NULL AS ASL_MDSE_CD
                ,NULL AS MDSE_DESC_SHORT_TXT
                ,NULL AS ENT_DEAL_NET_UNIT_PRC_AMT
                ,NULL AS PO_MDSE_CMPSN_TP_CD
                ,NULL AS PO_DISP_QTY
                ,NULL AS PO_SUBMT_TS
                ,NULL AS SHIP_TO_CUST_CD
                ,NULL AS SHIP_TO_LOC_NM
                ,NULL AS DEST_RTL_WH_CD
                ,NULL AS RQST_RTL_SWH_CD
                ,NULL AS PO_MATCH_TP_DESC_TXT
                ,NULL AS PO_LINE_STS_DESC_TXT
                ,NULL AS ENT_PO_DTL_DEAL_NET_AMT
                ,NULL AS RCV_PO_QTY
                ,NULL AS PO_INV_QTY
                ,NULL AS PO_CANC_QTY
                ,NULL AS SHPG_SVC_LVL_DESC_TXT
                ,NULL AS PRCH_REQ_NUM
                ,NULL AS PRCH_REQ_LINE_NUM
                ,NULL AS TRX_REF_NUM
                ,NULL AS TRX_REF_LINE_NUM
                ,NULL AS ORIG_PO_ORD_NUM
                ,NULL AS ORIG_DISP_PO_DTL_LINE_NUM
                ,PAH.PO_ACK_NUM
                ,NULL AS PO_SEND_TS_A0
                ,NULL AS PO_SEND_DT_A1
                ,PAD.VND_PO_ACK_STS_CD
                ,VPAC.VND_PO_ACK_STS_DESC_TXT
                ,PAH.ORD_LAST_UPD_TS
                ,PAD.ORD_QTY
                ,(PAD.THIS_MTH_FOB_COST_AMT * PAD.ORD_QTY) AS XX_TOT_AMT
                ,PAD.ETD_DT
                ,PAD.ETA_DT
                ,PAD.VND_OTBD_CARR_NM
                ,PAD.PRO_NUM
                ,PAD.VND_SO_NUM
                ,PAD.VND_SO_SLP_NUM
                ,PAD.VND_INVTY_LOC_CD
                ,PAD.VND_SHIP_TO_CUST_LOC_NM
                ,PAD.VND_SELL_TO_CUST_LOC_NM
                ,PAD.THIS_MTH_FOB_COST_AMT
                ,PAD.VND_CHILD_BOM_PRC_AMT
                ,PAD.VND_CPO_ORD_NUM
                ,PAD.VND_ISS_PO_ORD_NUM AS VND_CPO_ORD_NUM
                ,PAD.VND_PO_ACK_LINE_STS_TXT
                ,PAD.VND_OTBD_CARR_CD
                ,PAD.VND_CPO_DTL_LINE_NUM
                ,PAD.VND_CPO_DTL_LINE_SUB_NUM
                ,CU.CARR_TRK_URL
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                ,AMV.COA_MDSE_TP_CD
                ,AMV.COA_PROD_CD
                ,P.PRNT_VND_CD
                ,P.PRNT_VND_NM
                ,P.VND_CD
                ,P.VND_NM
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                ,PD.GLBL_CMPY_CD
                ,NULL AS PO_ORD_DTL_LINE_NUM
            <!-- add end 2022/05/19 QC#57934 -->
            <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
                ,PD.RQST_SHIP_DT
            <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
            FROM
                PO P
                ,PO_DTL PD
                ,PO_ACK_HDR PAH
                ,PO_ACK_DTL PAD
                ,SHPG_SVC_LVL SSL
                ,PO_MATCH_TP PMT
                ,PO_LINE_TP PLT
                ,PO_LINE_STS PLS
                ,DS_PO_TP DPT
                ,PO_HDR_STS PHS
                ,PO_APVL_STS PAS
                ,VND_PO_ACK_STS VPAC
                ,RTL_SWH RS
                ,AUTH_PSN AP
                ,RTL_WH RW
                ,CARR_URL CU
                ,SCE_SYS_USR_LIST SSUL
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                ,ALL_MDSE_V AMV
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
            WHERE
                -- JOIN TO PO
                P.GLBL_CMPY_CD = #glblCmpyCd#
                AND P.EZCANCELFLAG = '0'
                <isNotNull property="msg.poOrdNum">
                AND P.PO_ORD_NUM LIKE #msg.poOrdNum#
                </isNotNull>
                <isNotNull property="msg.poOrdSrcCd_SL">
                AND P.PO_ORD_SRC_CD = #msg.poOrdSrcCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndCd">
                AND P.VND_CD = #msg.vndCd#
                </isNotNull>
                <isNotNull property="msg.vndNm">
                AND P.VND_NM LIKE #msg.vndNm#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_FR">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &gt;= #msg.poSubmtDt_FR#
                </isNotNull>
                <isNotNull property="msg.poSubmtDt_TO">
                AND SUBSTRB(P.PO_SUBMT_TS, 1, 8) &lt;= #msg.poSubmtDt_TO#
                </isNotNull>
                <isNotNull property="msg.vndIssOrdNum">
                AND P.VND_ISS_ORD_NUM LIKE #msg.vndIssOrdNum#
                </isNotNull>
                <isNotNull property="msg.poHdrStsCd_SL">
                AND P.PO_HDR_STS_CD = #msg.poHdrStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.poApvlStsCd_SL">
                AND P.PO_APVL_STS_CD = #msg.poApvlStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.dsPoTpCd_SL">
                AND P.DS_PO_TP_CD = #msg.dsPoTpCd_SL#
                </isNotNull>
                <isNotNull property="msg.prntVndCd">
                AND P.PRNT_VND_CD = #msg.prntVndCd#
                </isNotNull>
                <isNotNull property="msg.prntVndNm">
                AND P.PRNT_VND_NM LIKE #msg.prntVndNm#
                </isNotNull>
                <isNotNull property="msg.destRtlWhCd">
                AND P.DEST_RTL_WH_CD = #msg.destRtlWhCd#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_FR">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &gt;= #msg.xxDt10Dt_FR#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_TO">
                AND SUBSTRB(P.PO_SEND_TS,1,8) &lt;= #msg.xxDt10Dt_TO#
                </isNotNull>
                <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(P.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
                
                -- JOIN TO PO_DTL
                AND P.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                AND PD.EZCANCELFLAG = '0'
                AND P.PO_ORD_NUM = PD.PO_ORD_NUM
                <!-- START 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isNotNull property="msg.prchReqNum">
                AND (PD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                            PRCH_REQ_DTL PRD
                        WHERE
                            PRD.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
                        AND PRD.PRCH_REQ_NUM LIKE #msg.prchReqNum#
                        AND PRD.PO_ORD_NUM   = P.PO_ORD_NUM
                        AND PRD.EZCANCELFLAG = '0'
                    )
                )
                </isNotNull>
                <!-- END 2017/08/24 S.Katsuma [QC#20678,ADD] -->
                <isNotNull property="msg.shpgSvcLvlCd_SL">
                AND PD.SHPG_SVC_LVL_CD = #msg.shpgSvcLvlCd_SL#
                </isNotNull>
                <isNotNull property="msg.shipToCustCd">
                AND PD.SHIP_TO_CUST_CD = #msg.shipToCustCd#
                </isNotNull>
                <isNotNull property="msg.shipToCustLocNm">
                AND PD.SHIP_TO_LOC_NM LIKE #msg.shipToCustLocNm#
                </isNotNull>
                <isNotNull property="msg.mdseCd_SB">
                AND PD.MDSE_CD LIKE #msg.mdseCd_SB#
                </isNotNull>
                <isNotNull property="msg.trxRefNum">
                AND PD.TRX_REF_NUM LIKE #msg.trxRefNum#
                </isNotNull>
                <isNotNull property="msg.destRtlSwhCd">
                AND PD.DEST_RTL_SWH_CD = #msg.destRtlSwhCd#
                </isNotNull>
                <isNotNull property="msg.poLineStsCd_SL">
                AND PD.PO_LINE_STS_CD = #msg.poLineStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.aslMdseCd">
                AND PD.ASL_MDSE_CD LIKE #msg.aslMdseCd#
                </isNotNull>
                <isNotNull property="msg.mdseCd">
                AND PD.ORIG_MDSE_CD LIKE #msg.mdseCd#
                </isNotNull>
                <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
                <isNotNull property="msg.rqstShipDt_FR">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &gt;= #msg.rqstShipDt_FR#
                </isNotNull>
                <isNotNull property="msg.rqstShipDt_TO">
                AND SUBSTRB(PD.RQST_SHIP_DT, 1, 8) &lt;= #msg.rqstShipDt_TO#
                </isNotNull>
                <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
                
                -- JOIN TO PO_ACK_HDR
                AND P.GLBL_CMPY_CD = PAH.GLBL_CMPY_CD
                AND PAH.EZCANCELFLAG = '0'
                AND P.PO_ORD_NUM = PAH.PO_ORD_NUM
                <isNotNull property="msg.xxOrdDt_FR">
                AND SUBSTRB(PAH.ORD_LAST_UPD_TS,1,8) &gt;= #msg.xxOrdDt_FR#
                </isNotNull>
                <isNotNull property="msg.xxOrdDt_TO">
                AND SUBSTRB(PAH.ORD_LAST_UPD_TS,1,8) &lt;= #msg.xxOrdDt_TO#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_FR">
                AND SUBSTRB(PAH.PO_SEND_TS,1,8) &gt;= #msg.xxDt10Dt_FR#
                </isNotNull>
                <isNotNull property="msg.xxDt10Dt_TO">
                AND SUBSTRB(PAH.PO_SEND_TS,1,8) &lt;= #msg.xxDt10Dt_TO#
                </isNotNull>
                <isNotNull property="msg.poAckNum">
                AND PAH.PO_ACK_NUM LIKE #msg.poAckNum#
                </isNotNull>
                
                -- JOIN TO PO_ACK_DTL
                AND P.GLBL_CMPY_CD = PAD.GLBL_CMPY_CD
                AND PAD.EZCANCELFLAG = '0'
                AND PAH.PO_ACK_HDR_PK = PAD.PO_ACK_HDR_PK
                AND PD.PO_ORD_NUM = PAD.PO_ORD_NUM
                AND PD.PO_ORD_DTL_LINE_NUM = PAD.PO_ORD_DTL_LINE_NUM
                <isNotNull property="msg.proNum">
                AND PAD.PRO_NUM LIKE #msg.proNum#
                </isNotNull>
                <isNotNull property="msg.vndSoNum">
                AND PAD.VND_SO_NUM LIKE #msg.vndSoNum#
                </isNotNull>
                <isNotNull property="msg.vndPoAckStsCd_SL">
                AND PAD.VND_PO_ACK_STS_CD = #msg.vndPoAckStsCd_SL#
                </isNotNull>
                <isNotNull property="msg.vndInvtyLocCd">
                AND PAD.VND_INVTY_LOC_CD LIKE #msg.vndInvtyLocCd#
                </isNotNull>
                
                -- LEFT JOIN TO SHPG_SVC_LVL
                AND PD.GLBL_CMPY_CD = SSL.GLBL_CMPY_CD(+)
                AND SSL.EZCANCELFLAG(+) = '0'
                AND PD.SHPG_SVC_LVL_CD = SSL.SHPG_SVC_LVL_CD(+)
                
                -- LEFT JOIN TO PO_MATCH_TP
                AND PD.GLBL_CMPY_CD = PMT.GLBL_CMPY_CD(+)
                AND PMT.EZCANCELFLAG(+) = '0'
                AND PD.PO_MATCH_TP_CD = PMT.PO_MATCH_TP_CD(+)
                
                -- LEFT JOIN TO PO_LINE_TP
                AND PD.GLBL_CMPY_CD = PLT.GLBL_CMPY_CD(+)
                AND PLT.EZCANCELFLAG(+) = '0'
                AND PD.PO_LINE_TP_CD = PLT.PO_LINE_TP_CD(+)
                
                -- LEFT JOIN TO PO_LINE_STS
                AND PD.GLBL_CMPY_CD = PLS.GLBL_CMPY_CD(+)
                AND PLS.EZCANCELFLAG(+) = '0'
                AND PD.PO_LINE_STS_CD = PLS.PO_LINE_STS_CD(+)
                
                -- LEFT JOIN TO DS_PO_TP
                AND P.GLBL_CMPY_CD = DPT.GLBL_CMPY_CD(+)
                AND DPT.EZCANCELFLAG(+) = '0'
                AND P.DS_PO_TP_CD = DPT.DS_PO_TP_CD(+)
                
                -- LEFT JOIN TO PO_HDR_STS
                AND P.GLBL_CMPY_CD = PHS.GLBL_CMPY_CD(+)
                AND PHS.EZCANCELFLAG(+) = '0'
                AND P.PO_HDR_STS_CD = PHS.PO_HDR_STS_CD(+)
                
                -- LEFT JOIN TO PO_APVL_STS
                AND P.GLBL_CMPY_CD = PAS.GLBL_CMPY_CD(+)
                AND PAS.EZCANCELFLAG(+) = '0'
                AND P.PO_APVL_STS_CD = PAS.PO_APVL_STS_CD(+)
                
                -- LEFT JOIN TO VND_PO_ACK_STS
                AND P.GLBL_CMPY_CD = VPAC.GLBL_CMPY_CD(+)
                AND VPAC.EZCANCELFLAG(+) = '0'
                AND PAD.VND_PO_ACK_STS_CD = VPAC.VND_PO_ACK_STS_CD(+)
                
                -- LEFT JOIN TO RTL_SWH
                AND P.GLBL_CMPY_CD = RS.GLBL_CMPY_CD(+)
                AND RS.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD = RS.RTL_WH_CD(+)
                AND PD.DEST_RTL_SWH_CD = RS.RTL_SWH_CD(+)
                <isNotNull property="msg.rtlSwhNm">
                AND RS.RTL_SWH_NM LIKE #msg.rtlSwhNm#
                </isNotNull>
                
                -- LEFT JOIN TO AUTH_PSN
                AND P.GLBL_CMPY_CD = AP.GLBL_CMPY_CD(+)
                AND AP.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = AP.USR_NM(+)
                -- LEFT JOIN TO SCE_SYS_USR_LIST
                AND P.GLBL_CMPY_CD = SSUL.GLBL_CMPY_CD(+)
                AND SSUL.EZCANCELFLAG(+) = '0'
                AND P.PO_SUBMT_PSN_CD = SSUL.FULL_PSN_NM(+)
                <isNotNull property="msg.fullPsnNm">
                AND
                    (
                    UPPER(AP.FIRST_NM || (NVL2(AP.MID_NM, ' '||AP.MID_NM||' ', ' ')) || AP.LAST_NM) LIKE UPPER(#msg.fullPsnNm#)
                    OR
                    UPPER(SSUL.FULL_PSN_NM) LIKE UPPER(#msg.fullPsnNm#)
                    )
                </isNotNull>
                
                -- LEFT JOIN TO RTL_WH
                AND P.GLBL_CMPY_CD = RW.GLBL_CMPY_CD(+)
                AND RW.EZCANCELFLAG(+) = '0'
                AND P.DEST_RTL_WH_CD = RW.RTL_WH_CD(+)
                <isNotNull property="msg.rtlWhNm">
                AND RW.RTL_WH_NM LIKE #msg.rtlWhNm#
                </isNotNull>
                
                -- LEFT JOIN TO CUAA_URL
                AND PAD.GLBL_CMPY_CD = CU.GLBL_CMPY_CD(+)
                AND CU.EZCANCELFLAG(+) = '0'
                AND PAD.VND_OTBD_CARR_CD = CU.VND_CD(+)
                
                <!-- START 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
                -- LEFT JOIN TO ALL_MDSE_V
                AND PAD.GLBL_CMPY_CD = AMV.GLBL_CMPY_CD(+)
                AND AMV.EZCANCELFLAG(+) = '0'
                AND PAD.MDSE_CD = AMV.MDSE_CD(+)
                <!-- END 2017/12/08 S.Katsuma [SOL#060(QC#14858),ADD] -->
            <!-- START 2018/01/29 K.Mishiro [QC#22521),ADD] -->
                <isNotNull property="msg.coaMdseTpCd">
                AND AMV.COA_MDSE_TP_CD LIKE #msg.coaMdseTpCd#
                </isNotNull>
                <isNotNull property="msg.coaProdCd">
                AND AMV.COA_PROD_CD LIKE #msg.coaProdCd#
                </isNotNull>
            <!-- END 2018/01/29 K.Mishiro [QC#22521),ADD] -->
            <!-- add start 2022/05/19 QC#57934 -->
                <isNotEqual property="msg.xxChkBox_H1" compareValue="Y">
                AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            CM_ACRL_WRITE_OFF A
                        WHERE
                                PD.PO_MDSE_CMPSN_TP_CD = #poMdseCmpsnTpRegular#
                            AND A.GLBL_CMPY_CD         = PD.GLBL_CMPY_CD
                            AND A.PO_NUM               = PD.PO_ORD_NUM
                            AND A.PO_ORD_DTL_LINE_NUM  = PD.PO_ORD_DTL_LINE_NUM
                            AND A.WRT_OFF_FLG          = #flgOnY#
                            <iterate property="coaAcctCdList" var="coaAcctCd[]" open="AND A.COA_ACCT_CD IN (" close=")" conjunction= "," >
                                #coaAcctCd[]#
                            </iterate>
                            AND A.AJE_CM_INTFC_TP_CD   IS NULL
                            AND A.EZCANCELFLAG         = '0'
                            AND NOT EXISTS (
                                    SELECT
                                        1
                                    FROM
                                         RWS_HDR  B
                                        ,RWS_DTL  C
                                        ,RWS_STS  D
                                    WHERE
                                            B.GLBL_CMPY_CD        = A.GLBL_CMPY_CD
                                        AND B.PO_RCV_TRX_HDR_NUM  = A.PO_NUM
                                        AND B.EZCANCELFLAG        = '0'
                                        AND B.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
                                        AND B.RWS_NUM             = C.RWS_NUM
                                        AND C.PO_RCV_TRX_LINE_NUM = A.PO_ORD_DTL_LINE_NUM
                                        AND C.EZCANCELFLAG        = '0'
                                        AND C.GLBL_CMPY_CD        = D.GLBL_CMPY_CD
                                        AND C.RWS_STS_CD          = D.RWS_STS_CD
                                        AND D.RWS_OPEN_FLG        = #flgOnY#
                                        AND D.EZCANCELFLAG        = '0'
                                )
                    )
                </isNotEqual>
            <!-- add end 2022/05/19 QC#57934 -->
            ORDER BY
                 PO_ORD_NUM ASC
                ,PO_DISP_LINE_NUM ASC NULLS FIRST
                ,SORT_INDEX ASC
                ,PO_ACK_NUM ASC
        )
        WHERE ROWNUM &lt;= #rowNum#
        )
        ,WRITE_OFF_INFO AS (
            SELECT
                 E.PO_ORD_NUM
                ,E.PO_ORD_DTL_LINE_NUM
                ,SUM(E.RCV_WO_QTY) AS RCV_WO_QTY
                ,SUM(E.INV_WO_QTY) AS INV_WO_QTY
            FROM
                (
                 SELECT
                      D.PO_ORD_NUM
                     ,D.PO_ORD_DTL_LINE_NUM
                     ,D.WRT_OFF_DT
                     ,SUM(D.RCV_QTY) AS RCV_QTY
                     ,SUM(D.INV_QTY) AS INV_QTY
                     ,MAX(D.RCV_UNIT_PRC_AMT) AS RCV_UNIT_PRC_AMT
                     ,MAX(D.INV_UNIT_PRC_AMT) AS INV_UNIT_PRC_AMT
                     ,CASE WHEN SUM(D.INV_QTY) &lt; SUM(D.RCV_QTY)
                               THEN SUM(D.RCV_QTY) - SUM(D.INV_QTY)
                           <!-- mod start 2022/08/05 QC#59245 -->
                           <!-- WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND MAX(D.INV_UNIT_PRC_AMT) &lt; MAX(D.RCV_UNIT_PRC_AMT) -->
                           WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND SUM(D.INV_AMT) &lt; SUM(D.RCV_AMT)
                           <!-- mod end 2022/08/05 QC#59245 -->
                               THEN SUM(D.RCV_QTY)
                           ELSE 0
                      END AS RCV_WO_QTY
                     ,CASE WHEN SUM(D.INV_QTY) &gt; SUM(D.RCV_QTY)
                               THEN SUM(D.INV_QTY) - SUM(D.RCV_QTY)
                           <!-- mod start 2022/08/05 QC#59245 -->
                           <!-- WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND MAX(D.INV_UNIT_PRC_AMT) &gt; MAX(D.RCV_UNIT_PRC_AMT) -->
                           WHEN SUM(D.INV_QTY) = SUM(D.RCV_QTY) AND SUM(D.INV_AMT) &gt; SUM(D.RCV_AMT)
                           <!-- mod end 2022/08/05 QC#59245 -->
                               THEN SUM(D.INV_QTY)
                           ELSE 0
                      END AS INV_WO_QTY
                 FROM
                     (
                      SELECT
                           P.PO_ORD_NUM
                          ,P.PO_ORD_DTL_LINE_NUM
                          ,A.WRT_OFF_DT
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpDr# THEN NVL(A.INV_RCV_QTY, 0) ELSE 0 END AS RCV_QTY
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr# THEN NVL(A.INV_QTY, 0) ELSE 0 END AS INV_QTY
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpDr# THEN NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0) ELSE 0 END AS RCV_UNIT_PRC_AMT
                          <!-- mod start 2022/08/05 QC#59245 -->
                          <!--
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr#
                                    THEN
                                      CASE WHEN B.ENT_DEAL_NET_UNIT_PRC_AMT = C.ENT_DEAL_NET_UNIT_PRC_AMT
                                               THEN B.ENT_DEAL_NET_UNIT_PRC_AMT
                                           ELSE NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0)
                                      END
                                ELSE 0
                           END INV_UNIT_PRC_AMT
                          -->
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr# THEN NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0) ELSE 0 END AS INV_UNIT_PRC_AMT
                          <!-- mod end 2022/08/05 QC#59245 -->
                          <!-- add start 2022/08/05 QC#59245 -->
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpDr# THEN NVL(A.INV_RCV_QTY, 0) * NVL(A.ENT_DEAL_NET_UNIT_PRC_AMT, 0) ELSE 0 END AS RCV_AMT
                          ,CASE WHEN A.DR_CR_TP_CD = #drCrTpCr# THEN NVL(A.AC_INV_JRNL_COST_AMT, 0) ELSE 0 END AS INV_AMT
                          <!-- add end 2022/08/05 QC#59245 -->
                      FROM
                           PO_DTL_INFO        P
                          ,CM_ACRL_WRITE_OFF  A
                          <!-- del start 2022/08/05 QC#59245 -->
                          <!-- ,CM_AP_INV_DTL      B -->
                          <!-- ,PO_DTL             C -->
                          <!-- del end 2022/08/05 QC#59245 -->
                      WHERE
                              P.SORT_INDEX           = '2'
                          AND P.GLBL_CMPY_CD         = A.GLBL_CMPY_CD
                          AND P.PO_ORD_NUM           = A.PO_NUM
                          AND P.PO_ORD_DTL_LINE_NUM  = A.PO_ORD_DTL_LINE_NUM
                          AND A.WRT_OFF_FLG          = #flgOnY#
                          <iterate property="coaAcctCdList" var="coaAcctCd[]" open="AND A.COA_ACCT_CD IN (" close=")" conjunction= "," >
                              #coaAcctCd[]#
                          </iterate>
                          AND A.AJE_CM_INTFC_TP_CD   IS NULL
                          AND A.EZCANCELFLAG         = '0'
                          <!-- del start 2022/08/05 QC#59245 -->
                          <!--
                          AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD(+)
                          AND A.AP_VND_INV_NUM       = B.AP_VND_INV_NUM(+)
                          AND A.AP_VND_INV_LINE_NUM  = B.AP_VND_INV_LINE_NUM(+)
                          AND B.EZCANCELFLAG(+)      = '0'
                          AND A.GLBL_CMPY_CD         = C.GLBL_CMPY_CD(+)
                          AND A.PO_NUM               = C.PO_ORD_NUM(+)
                          AND A.PO_ORD_DTL_LINE_NUM  = C.PO_ORD_DTL_LINE_NUM(+)
                          AND C.EZCANCELFLAG(+)      = '0'
                          -->
                          <!-- del end 2022/08/05 QC#59245 -->
                     ) D
                 GROUP BY
                      D.PO_ORD_NUM
                     ,D.PO_ORD_DTL_LINE_NUM
                     ,D.WRT_OFF_DT
                 ) E
            GROUP BY
                 E.PO_ORD_NUM
                ,E.PO_ORD_DTL_LINE_NUM
        )        
        SELECT
             P.PO_ORD_NUM
            ,P.DS_PO_TP_DESC_TXT
            ,P.PO_HDR_STS_DESC_TXT
            ,P.PO_APVL_STS_DESC_TXT
            ,P.PO_DISP_LINE_NUM
            ,P.PO_LINE_TP_DESC_TXT
            ,P.MDSE_CD_A0
            ,P.MDSE_CD_A1
            ,P.SET_PO_ORD_DTL_LINE_NUM
            ,P.XX_MDSE_CD_A0
            ,P.XX_MDSE_CD_A1
            ,P.ASL_MDSE_CD
            ,P.MDSE_DESC_SHORT_TXT
            ,P.ENT_DEAL_NET_UNIT_PRC_AMT
            ,P.PO_DISP_QTY
            ,P.PO_SUBMT_DT
            ,P.SHIP_TO_CUST_CD
            ,P.SHIP_TO_LOC_NM
            ,P.DEST_RTL_WH_CD
            ,P.RQST_RTL_SWH_CD
            ,P.PO_MATCH_TP_DESC_TXT
            ,P.PO_LINE_STS_DESC_TXT
            ,P.ENT_PO_DTL_DEAL_NET_AMT
            ,P.PO_MDSE_CMPSN_TP_CD
            ,P.RCV_PO_QTY
            ,P.PO_INV_QTY
            ,P.PO_CANC_QTY
            ,P.SHPG_SVC_LVL_DESC_TXT
            ,P.PRCH_REQ_NUM
            ,P.PRCH_REQ_LINE_NUM
            ,P.TRX_REF_NUM
            ,P.TRX_REF_LINE_NUM
            ,P.ORIG_PO_ORD_NUM
            ,P.ORIG_DISP_PO_DTL_LINE_NUM
            ,P.PO_ACK_NUM
            ,P.PO_SEND_TS_A0
            ,P.PO_SEND_DT_A1
            ,P.VND_PO_ACK_STS_CD
            ,P.VND_PO_ACK_STS_DESC_TXT
            ,P.ORD_LAST_UPD_TS
            ,P.ORD_QTY
            ,P.XX_TOT_AMT
            ,P.ETD_DT
            ,P.ETA_DT
            ,P.VND_OTBD_CARR_NM
            ,P.PRO_NUM
            ,P.VND_SO_NUM
            ,P.VND_SO_SLP_NUM
            ,P.VND_INVTY_LOC_CD
            ,P.VND_SHIP_TO_CUST_LOC_NM
            ,P.VND_SELL_TO_CUST_LOC_NM
            ,P.THIS_MTH_FOB_COST_AMT
            ,P.VND_CHILD_BOM_PRC_AMT
            ,P.VND_CPO_ORD_NUM
            ,P.VND_ISS_PO_ORD_NUM
            ,P.VND_PO_ACK_LINE_STS_TXT
            ,P.VND_OTBD_CARR_CD
            ,P.VND_CPO_DTL_LINE_NUM
            ,P.VND_CPO_DTL_LINE_SUB_NUM
            ,P.CARR_TRK_URL
            ,P.COA_MDSE_TP_CD
            ,P.COA_PROD_CD
            ,P.PRNT_VND_CD
            ,P.PRNT_VND_NM
            ,P.VND_CD
            ,P.VND_NM
            ,CASE WHEN P.RCV_PO_QTY IS NULL THEN NULL ELSE NVL(W.RCV_WO_QTY, 0) END AS RCV_WO_QTY
            ,CASE WHEN P.PO_INV_QTY IS NULL THEN NULL ELSE NVL(W.INV_WO_QTY, 0) END AS INV_WO_QTY
            <!-- START 2023/02/13 TZ.Win [QC#60966, ADD] -->
            ,P.RQST_SHIP_DT
            <!-- END 2023/02/13 TZ.Win [QC#60966, ADD] -->
        FROM
             PO_DTL_INFO     P
            ,WRITE_OFF_INFO  W
        WHERE
                P.PO_ORD_NUM           = W.PO_ORD_NUM(+)
            AND P.PO_ORD_DTL_LINE_NUM  = W.PO_ORD_DTL_LINE_NUM(+)
        ORDER BY
             P.PO_ORD_NUM ASC
            ,P.PO_DISP_LINE_NUM ASC NULLS FIRST
            ,P.SORT_INDEX ASC
            ,P.PO_ACK_NUM ASC
        <!-- add end 2022/05/16 QC#57934 -->
    </statement>

</sqlMap>