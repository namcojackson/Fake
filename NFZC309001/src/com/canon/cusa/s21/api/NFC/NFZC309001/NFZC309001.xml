<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NFZC309001">

    <statement id="getDueDate" parameterClass="Map" resultClass="Map">
        SELECT
             A.PMT_TERM_CASH_DISC_CD
            ,(CASE  
                WHEN A.PMT_TERM_CONSL_LAST_DOM_FLG='Y' THEN TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#trxDt#,'YYYYMMDD'),A.PMT_TERM_CONSL_ADD_MTH_NUM)),'YYYYMMDD')
                ELSE
                    CASE
                        WHEN SUBSTRB(#trxDt#, 7, 2) &lt; A.PMT_TERM_CONSL_DUE_DAY
                        THEN SUBSTRB(TO_CHAR(ADD_MONTHS(TO_DATE(#trxDt#,'YYYYMMDD'),A.PMT_TERM_CONSL_ADD_MTH_NUM),'YYYYMMDD'), 1, 6) || A.PMT_TERM_CONSL_DUE_DAY
                        ELSE SUBSTRB(TO_CHAR(ADD_MONTHS(TO_DATE(#trxDt#,'YYYYMMDD'),A.PMT_TERM_CONSL_ADD_MTH_NUM + 1),'YYYYMMDD'), 1, 6) || A.PMT_TERM_CONSL_DUE_DAY
                    END
             END) AS DUE_DT
        FROM
            PMT_TERM_CASH_DISC  A
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.PMT_TERM_CASH_DISC_CD = #pmtTermCashDiscCd#
            AND A.PMT_TERM_CONSL_FLG    = 'Y'
            AND A.EZCANCELFLAG          = '0'
        UNION
        SELECT
              A.PMT_TERM_CASH_DISC_CD
            <isNotNull property="startDt">
             ,TO_CHAR(TO_DATE(#startDt#,'YYYYMMDD') + B.PMT_TERM_AOT,'YYYYMMDD') AS DUE_DT
            </isNotNull>
            <isNull property="startDt">
             ,TO_CHAR(TO_DATE(#trxDt#,'YYYYMMDD') + B.PMT_TERM_AOT,'YYYYMMDD') AS DUE_DT
            </isNull>
            
        FROM
             PMT_TERM_CASH_DISC A
            ,PMT_TERM           B
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND B.GLBL_CMPY_CD          = A.GLBL_CMPY_CD
            AND A.PMT_TERM_CASH_DISC_CD = #pmtTermCashDiscCd#
            AND A.PMT_TERM_CONSL_FLG    = 'N'
            AND A.PMT_TERM_CD           = B.PMT_TERM_CD
            AND A.EZCANCELFLAG          = '0'
            AND B.EZCANCELFLAG          = '0'
    </statement>

</sqlMap>
