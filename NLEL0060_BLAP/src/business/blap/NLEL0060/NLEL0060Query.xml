<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLEL0060Query">

    <typeAlias alias="NLEL0060SMsg"    type="business.blap.NLEL0060.NLEL0060SMsg"/>
    <typeAlias alias="NLEL0060_ASMsg"  type="business.blap.NLEL0060.NLEL0060_ASMsg"/>
    <typeAlias alias="NLEL0060_BSMsg"  type="business.blap.NLEL0060.NLEL0060_BSMsg"/>
    <typeAlias alias="NLEL0060_CSMsg"  type="business.blap.NLEL0060.NLEL0060_CSMsg"/>
    <typeAlias alias="NLEL0060_DSMsg"  type="business.blap.NLEL0060.NLEL0060_DSMsg"/>
    <typeAlias alias="NLEL0060_ESMsg"  type="business.blap.NLEL0060.NLEL0060_ESMsg"/>
    <typeAlias alias="NLEL0060_FSMsg"  type="business.blap.NLEL0060.NLEL0060_FSMsg"/>

    <statement id="getAvalAssetStsList" parameterClass="Map" resultClass="Map">
        SELECT
            DS_COND_CONST_CD
           ,DS_COND_CONST_DESC_TXT
        FROM
            DS_COND_CONST
        WHERE
            GLBL_CMPY_CD         = #glblCmpyCd#
        AND DS_COND_CONST_GRP_ID = #dsCondConstGrpId#
        AND EZCANCELFLAG         = '0'
        ORDER BY
            DS_COND_CONST_SORT_NUM
    </statement>

    <statement id="searchDetail" parameterClass="Map" resultMap="result.searchDetail">
        WITH TARGET_ASSET_MSTR AS (
            SELECT
                A.*
            FROM
                 DS_ASSET_MSTR A
                <isEqual property="sellToCustSearchFlag" compareValue="Y">
                ,SELL_TO_CUST  STC3
                </isEqual>
                <isNotNull property="depcCoaAcctCdFlg">
                ,ASSET_BOOK_CTRL BC
                </isNotNull>
            WHERE
                    A.GLBL_CMPY_CD         = #glblCmpyCd#
                AND A.DS_ASSET_MSTR_PK     = A.PRNT_DS_ASSET_MSTR_PK
                AND A.EZCANCELFLAG         = '0'
                <isEqual property="sellToCustSearchFlag" compareValue="Y">
                AND A.GLBL_CMPY_CD         = STC3.GLBL_CMPY_CD(+)
                AND A.SELL_TO_CUST_CD      = STC3.SELL_TO_CUST_CD(+)
                AND STC3.EZCANCELFLAG(+)   = '0'
                </isEqual>
                <isNotNull property="depcCoaAcctCdFlg">
                AND A.GLBL_CMPY_CD         = BC.GLBL_CMPY_CD
                AND A.ASSET_TP_CD          = BC.ASSET_TP_CD
                AND BC.EFF_FROM_DT     &lt;= #slsDt#
                AND (
                        BC.EFF_THRU_DT &gt;= #slsDt#
                     OR BC.EFF_THRU_DT IS NULL
                )
                AND BC.EZCANCELFLAG = '0'
                </isNotNull>
                <isNotNull property="bizMsg.dsAssetMstrPk_S1">
                AND A.DS_ASSET_MSTR_PK     = #bizMsg.dsAssetMstrPk_S1#
                </isNotNull>
                <isNotNull property="bizMsg.assetTpCd_S1">
                AND A.ASSET_TP_CD          = #bizMsg.assetTpCd_S1#
                </isNotNull>
                <isNotNull property="bizMsg.depcStartDt_S1">
                AND A.DEPC_START_DT    &gt;= #bizMsg.depcStartDt_S1#
                </isNotNull>
                <isNotNull property="bizMsg.depcStartDt_S2">
                AND A.DEPC_START_DT    &lt;= #bizMsg.depcStartDt_S2#
                </isNotNull>
                <isNotNull property="bizMsg.serNum_S1">
                AND EXISTS(
                    SELECT NULL
                    FROM DS_ASSET_MSTR A2
                    WHERE
                        A2.GLBL_CMPY_CD             = A.GLBL_CMPY_CD
                    AND A2.PRNT_DS_ASSET_MSTR_PK    = A.DS_ASSET_MSTR_PK
                    AND A2.SER_NUM                  = #bizMsg.serNum_S1#
                    AND A2.EZCANCELFLAG             = '0'
                )
                </isNotNull>
                <isNotNull property="bizMsg.mdseCd_S1">
                AND EXISTS(
                    SELECT NULL
                    FROM DS_ASSET_MSTR A2
                    WHERE
                        A2.GLBL_CMPY_CD             = A.GLBL_CMPY_CD
                    AND A2.PRNT_DS_ASSET_MSTR_PK    = A.DS_ASSET_MSTR_PK
                    AND A2.MDSE_CD                  = #bizMsg.mdseCd_S1#
                    AND A2.EZCANCELFLAG             = '0'
                )
                </isNotNull>
                <isNotNull property="bizMsg.assetStsCd_S1">
                AND A.ASSET_STS_CD         = #bizMsg.assetStsCd_S1#
                </isNotNull>
                <isNotNull property="bizMsg.assetTagNum_S1">
                AND A.ASSET_TAG_NUM        = #bizMsg.assetTagNum_S1#
                </isNotNull>
                <isNotNull property="bizMsg.custIssPoNum_S1">
                AND (
                              A.PO_ORD_NUM              = #bizMsg.custIssPoNum_S1#
                    OR UPPER( A.CUST_ISS_PO_NUM )       = UPPER(#bizMsg.custIssPoNum_S1#) <!-- 2019/03/28 QC#30758 Add 'UPPER' to the parameter -->
                )
                </isNotNull>
                <isNotNull property="bizMsg.vndCd_S1">
                AND A.VND_CD               = #bizMsg.vndCd_S1#
                </isNotNull>
                <isNotNull property="bizMsg.dsAssetDescTxt_S1">
                AND (
                    UPPER( A.DS_ASSET_DESC_TXT ) LIKE #bizMsg.dsAssetDescTxt_S1#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                            MDSE MD
                        WHERE
                                A.GLBL_CMPY_CD                     = MD.GLBL_CMPY_CD
                            AND A.MDSE_CD                          = MD.MDSE_CD
                            AND MD.EZCANCELFLAG                    =  '0'
                            AND UPPER( MD.MDSE_DESC_SHORT_TXT ) LIKE #bizMsg.dsAssetDescTxt_S1#
                    )
                     OR EXISTS(
                         SELECT
                             1
                         FROM
                              SVC_MACH_MSTR   SMM
                             ,SVC_CONFIG_MSTR SCM
                             ,MDL_NM          MN
                         WHERE
                                 A.GLBL_CMPY_CD            = SMM.GLBL_CMPY_CD
                             AND A.SVC_MACH_MSTR_PK        = SMM.SVC_MACH_MSTR_PK
                             AND SMM.EZCANCELFLAG          = '0'
                             AND SMM.GLBL_CMPY_CD          = SCM.GLBL_CMPY_CD
                             AND SMM.SVC_CONFIG_MSTR_PK    = SCM.SVC_CONFIG_MSTR_PK
                             AND SCM.EZCANCELFLAG          = '0'
                             AND SCM.GLBL_CMPY_CD          = MN.T_GLBL_CMPY_CD
                             AND SCM.MDL_ID                = MN.T_MDL_ID
                             AND MN.EZCANCELFLAG           = '0'
                             AND UPPER( MN.T_MDL_NM )   LIKE #bizMsg.dsAssetDescTxt_S1#
                     )
                     OR EXISTS(
                         SELECT
                             1
                         FROM
                              SVC_CONFIG_MSTR SCM2
                             ,MDL_NM          MN2
                         WHERE
                                  A.GLBL_CMPY_CD          = SCM2.GLBL_CMPY_CD(+)
                              AND A.SVC_CONFIG_MSTR_PK    = SCM2.SVC_CONFIG_MSTR_PK(+)
                              AND SCM2.EZCANCELFLAG(+)    = '0'
                              AND SCM2.GLBL_CMPY_CD       = MN2.T_GLBL_CMPY_CD(+)
                              AND SCM2.MDL_ID             = MN2.T_MDL_ID(+)
                              AND MN2.EZCANCELFLAG(+)     = '0'
                             AND UPPER( MN2.T_MDL_NM ) LIKE #bizMsg.dsAssetDescTxt_S1#
                     )
                )
                </isNotNull>
                <isNotNull property="bizMsg.svcConfigMstrPk_S1">
                AND (
                    A.SVC_CONFIG_MSTR_PK = #bizMsg.svcConfigMstrPk_S1#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                             SVC_MACH_MSTR   SMM
                        WHERE
                               A.GLBL_CMPY_CD      = SMM.GLBL_CMPY_CD
                            AND A.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                            AND SMM.EZCANCELFLAG   = '0'
                            AND SMM.SVC_CONFIG_MSTR_PK = #bizMsg.svcConfigMstrPk_S1#
                    )
                )
                </isNotNull>
                <isNotNull property="bizMsg.cpoOrdNum_S1">
                AND EXISTS(
                    SELECT NULL
                    FROM (
                        SELECT
                            A2.CPO_ORD_NUM AS ASSET_CPO_ORD_NUM
                            ,SMM.CPO_ORD_NUM AS MACH_CPO_ORD_NUM
                        FROM DS_ASSET_MSTR A2
                            ,SVC_MACH_MSTR SMM
                        WHERE
                            A2.GLBL_CMPY_CD            = A.GLBL_CMPY_CD
                        AND A2.PRNT_DS_ASSET_MSTR_PK   = A.DS_ASSET_MSTR_PK
                        AND A2.EZCANCELFLAG            = '0'
                        AND SMM.GLBL_CMPY_CD(+)        = A2.GLBL_CMPY_CD
                        AND SMM.SVC_MACH_MSTR_PK(+)    = A2.SVC_MACH_MSTR_PK
                        AND SMM.EZCANCELFLAG(+)        = '0'
                    )
                    WHERE (
                        ASSET_CPO_ORD_NUM          = #bizMsg.cpoOrdNum_S1#
                        OR MACH_CPO_ORD_NUM        = #bizMsg.cpoOrdNum_S1#
                    )
                )
                </isNotNull>
                <isNotNull property="bizMsg.xxChkBox_H1">
                <isNull property="bizMsg.xxChkBox_H2">
                AND (
                    (
                            A.RTRN_WH_CD       IS NULL
                        AND A.SVC_MACH_MSTR_PK IS NULL
                    )
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                             SVC_MACH_MSTR   SMM
                        WHERE
                                A.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
                            AND A.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                            AND SMM.EZCANCELFLAG   = '0'
                            AND SMM.SVC_MACH_MSTR_STS_CD NOT IN (#svcMachStsCRAT#, #svcMachStsRMV#)
                    )
                )
                </isNull>
                </isNotNull>
                <isNotNull property="bizMsg.xxChkBox_H2">
                <isNull property="bizMsg.xxChkBox_H1">
                AND (
                    (
                        A.RTRN_WH_CD IS NOT NULL
                    )
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                             SVC_MACH_MSTR   SMM
                        WHERE
                                A.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
                            AND A.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                            AND SMM.EZCANCELFLAG   = '0'
                            AND SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsCRAT#, #svcMachStsRMV#)
                    )
                )
                </isNull>
                </isNotNull>
                <isNotNull property="bizMsg.rtnWhCd_S1">
                AND (
                    A.RTRN_WH_CD = #bizMsg.rtnWhCd_S1#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                             SVC_MACH_MSTR   SMM
                            ,RTL_SWH         RS
                        WHERE
                                A.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD
                            AND A.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK
                            AND SMM.EZCANCELFLAG       = '0'
                            AND SMM.GLBL_CMPY_CD       = RS.GLBL_CMPY_CD
                            AND SMM.CUR_LOC_NUM        = RS.INVTY_LOC_CD
                            AND RS.RTL_WH_CD           = #bizMsg.rtnWhCd_S1#
                            AND RS.EZCANCELFLAG        = '0'
                    )
                )
                </isNotNull>
                <isNotNull property="bizMsg.shipToCustAcctCd_S1">
                AND (
                         A.SHIP_TO_CUST_ACCT_CD = #bizMsg.shipToCustAcctCd_S1#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                             SVC_MACH_MSTR   SMM
                        WHERE
                                A.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
                            AND A.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                            AND SMM.EZCANCELFLAG   = '0'
                            AND SMM.CUR_LOC_ACCT_NUM = #bizMsg.shipToCustAcctCd_S1#
                    )
                )
                </isNotNull>
                <isNotNull property        = "bizMsg.depcCoaAcctCd_S1">
                AND (CASE WHEN A.PROC_MODE_CD        = #procMode# AND A.EXP_COA_ACCT_CD IS NULL THEN STC3.COA_ACCT_CD
                          WHEN A.PROC_MODE_CD &lt;&gt; #procMode# AND A.EXP_COA_ACCT_CD IS NULL THEN BC.DEPC_COA_ACCT_CD ELSE A.EXP_COA_ACCT_CD END ) &gt;= #bizMsg.depcCoaAcctCd_S1#
                </isNotNull>
                <isNotNull property        = "bizMsg.depcCoaAcctCd_S2">
                AND (CASE WHEN A.PROC_MODE_CD        = #procMode# AND A.EXP_COA_ACCT_CD IS NULL THEN STC3.COA_ACCT_CD
                          WHEN A.PROC_MODE_CD &lt;&gt; #procMode# AND A.EXP_COA_ACCT_CD IS NULL THEN BC.DEPC_COA_ACCT_CD ELSE A.EXP_COA_ACCT_CD END ) &lt;= #bizMsg.depcCoaAcctCd_S2#
                </isNotNull>
                <isNotNull property        = "bizMsg.expCoaBrCd_S1">
                AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_BR_CD IS NULL THEN STC3.COA_BR_CD ELSE A.EXP_COA_BR_CD END ) &gt;= #bizMsg.expCoaBrCd_S1#
                </isNotNull>
                <isNotNull property        = "bizMsg.expCoaBrCd_S2">
                AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_BR_CD IS NULL THEN STC3.COA_BR_CD ELSE A.EXP_COA_BR_CD END ) &lt;= #bizMsg.expCoaBrCd_S2#
                </isNotNull>
                <isNotNull property        = "bizMsg.expCoaCcCd_S1">
                AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_CC_CD IS NULL THEN STC3.COA_CC_CD ELSE A.EXP_COA_CC_CD END ) &gt;= #bizMsg.expCoaCcCd_S1#
                </isNotNull>
                <isNotNull property        = "bizMsg.expCoaCcCd_S2">
                AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_CC_CD IS NULL THEN STC3.COA_CC_CD ELSE A.EXP_COA_CC_CD END ) &lt;= #bizMsg.expCoaCcCd_S2#
                </isNotNull>
                <isNotNull property        = "bizMsg.expCoaExtnCd_S1">
                AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_EXTN_CD IS NULL THEN STC3.COA_EXTN_CD ELSE A.EXP_COA_EXTN_CD END ) &gt;= #bizMsg.expCoaExtnCd_S1#
                </isNotNull>
                <isNotNull property        = "bizMsg.expCoaExtnCd_S2">
                AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_EXTN_CD IS NULL THEN STC3.COA_EXTN_CD ELSE A.EXP_COA_EXTN_CD END ) &lt;= #bizMsg.expCoaExtnCd_S2#
                </isNotNull>
        )
        ,SVC_MACH_MSTR_TMP AS (
            SELECT
                *
            FROM
                SVC_MACH_MSTR   SMM
            WHERE
                    SMM.GLBL_CMPY_CD = #glblCmpyCd#
                AND SMM.EZCANCELFLAG = '0'
                AND EXISTS(SELECT 1 FROM TARGET_ASSET_MSTR TAM WHERE TAM.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK)
        )
        ,SELL_TO_CUST_TMP AS (
            SELECT /*+ STC SELL_TO_CUST_I1 */
                *
            FROM
                SELL_TO_CUST STC
            WHERE
                    STC.GLBL_CMPY_CD = #glblCmpyCd#
                AND STC.EZCANCELFLAG = '0'
                AND EXISTS(SELECT 1 FROM SVC_MACH_MSTR_TMP SMMT WHERE SMMT.CUR_LOC_ACCT_NUM    = STC.SELL_TO_CUST_CD)
            UNION
            SELECT /*+ STC SELL_TO_CUST_I1 */
                *
            FROM
                SELL_TO_CUST STC
            WHERE
                    STC.GLBL_CMPY_CD = #glblCmpyCd#
                AND STC.EZCANCELFLAG = '0'
                AND EXISTS(SELECT 1 FROM TARGET_ASSET_MSTR TAM  WHERE TAM.SHIP_TO_CUST_ACCT_CD = STC.SELL_TO_CUST_CD)
            UNION
            SELECT /*+ STC SELL_TO_CUST_I1 */
                *
            FROM
                SELL_TO_CUST STC
            WHERE
                    STC.GLBL_CMPY_CD = #glblCmpyCd#
                AND STC.EZCANCELFLAG = '0'
                AND EXISTS(SELECT 1 FROM TARGET_ASSET_MSTR TAM  WHERE TAM.SELL_TO_CUST_CD      = STC.SELL_TO_CUST_CD)
        )
        SELECT
             AM.DS_ASSET_MSTR_PK
            ,AM.DS_ASSET_DESC_TXT
            ,AM.ASSET_TP_CD
            ,AM.ASSET_TP_DESC_TXT
            ,AM.ASSET_STS_CD
            ,AM.ASSET_STS_DESC_TXT
            ,AM.DEPC_MTH_NUM
            ,AM.TOT_ASSET_QTY
            ,AM.DEPC_START_DT
            ,AM.SVC_CONFIG_MSTR_PK
            ,AM.SER_NUM
            ,AM.MDSE_CD
            ,AM.COA_MDSE_TP_CD
            <!-- START 2018/08/09 S.Katsuma [QC22812,ADD] -->
            ,AM.COA_PROD_CD
            <!-- END 2018/08/09 S.Katsuma [QC22812,ADD] -->
            ,AM.ASSET_TAG_NUM
            ,CASE WHEN AM.ASSET_STS_CD = #assetStsCd# THEN 0
                  WHEN AM.PRNT_DS_ASSET_MSTR_PK IS NOT NULL THEN AM.INIT_BOOK_AMT
                  ELSE (SELECT SUM(DAM.INIT_BOOK_AMT) FROM DS_ASSET_MSTR DAM WHERE DAM.GLBL_CMPY_CD = AM.GLBL_CMPY_CD AND DAM.PRNT_DS_ASSET_MSTR_PK = AM.DS_ASSET_MSTR_PK AND DAM.ASSET_TP_CD = AM.ASSET_TP_CD AND DAM.EZCANCELFLAG = '0')
             END AS DS_ASSET_GRP_INIT_BOOK_AMT
            ,CASE WHEN AM.PRNT_DS_ASSET_MSTR_PK IS NOT NULL THEN AM.CUR_VAL_AMT
                  ELSE (SELECT SUM(DAM.CUR_VAL_AMT) FROM DS_ASSET_MSTR DAM WHERE DAM.GLBL_CMPY_CD = AM.GLBL_CMPY_CD AND DAM.PRNT_DS_ASSET_MSTR_PK = AM.DS_ASSET_MSTR_PK AND DAM.ASSET_TP_CD = AM.ASSET_TP_CD AND DAM.EZCANCELFLAG = '0')
             END AS CUR_VAL_AMT
            ,AM.DS_ACCT_NM
            ,AM.PRNT_DS_ASSET_MSTR_PK
            ,AM.CPO_ORD_NUM
            ,CASE WHEN CD.CPO_ORD_NUM IS NULL THEN NULL
                  ELSE CONCAT(CD.DS_ORD_POSN_NUM, '.') || CONCAT(CD.DS_CPO_LINE_NUM, DECODE(CD.DS_CPO_LINE_SUB_NUM, NULL, '', '.')) || CD.DS_CPO_LINE_SUB_NUM
             END  AS DPLY_LINE_NUM
            ,AM.DS_CONTR_NUM
            ,AM.CONTR_EFF_FROM_DT
            ,AM.CONTR_EFF_THRU_DT
            ,AM.PO_ORD_NUM
            ,AM.INV_NUM
            ,AM.VND_CD
            ,AM.VND_NM
            ,CASE WHEN AM.BLLG_INV_NUM IS NOT NULL THEN AM.BLLG_INV_NUM
                  WHEN AM.SVC_MACH_MSTR_PK IS NULL THEN AM.BLLG_INV_NUM
                  ELSE (SELECT MAX(SVC_INV_NUM) FROM SVC_INV SV WHERE SV.GLBL_CMPY_CD = AM.GLBL_CMPY_CD AND SV.SVC_MACH_MSTR_PK = AM.SVC_MACH_MSTR_PK AND SV.EZCANCELFLAG = '0')
             END AS SVC_INV_NUM
            ,CASE WHEN AM.LAST_BILL_DT IS NOT NULL THEN AM.LAST_BILL_DT
                  WHEN AM.SVC_MACH_MSTR_PK IS NULL THEN AM.LAST_BILL_DT
                  ELSE (SELECT MAX(INV_DT) FROM SVC_INV SV WHERE SV.GLBL_CMPY_CD = AM.GLBL_CMPY_CD AND SV.SVC_MACH_MSTR_PK = AM.SVC_MACH_MSTR_PK AND SV.EZCANCELFLAG = '0')
             END AS INV_DT
            ,AM.LAST_DEPC_YR_MTH
            ,AM.SVC_MACH_MSTR_PK
            ,AM.MAN_ENTRY_FLG
            ,AM.SHIP_TO_CUST_ACCT_CD
            ,AM.DEPC_CNT
            ,AM.INIT_BOOK_AMT
            ,AM.RSDL_VAL_AMT
            ,AM.DTL_CMNT_TXT
            ,AM.AMT_CHNG_RSN_TP_CD
            ,AM.EZUPTIME
            ,AM.EZUPTIMEZONE
        FROM
        (
            SELECT
                 A.GLBL_CMPY_CD
                ,A.DS_ASSET_MSTR_PK
                ,CASE WHEN A.DS_ASSET_DESC_TXT IS NOT NULL THEN A.DS_ASSET_DESC_TXT
                <!-- START 2018/08/09 S.Katsuma [QC22812,DEL] -->
                      <!-- WHEN MN2.T_MDL_NM        IS NOT NULL THEN MN2.T_MDL_NM
                      WHEN MN.T_MDL_NM         IS NOT NULL THEN MN.T_MDL_NM -->
                <!-- END 2018/08/09 S.Katsuma [QC22812,DEL] -->
                      ELSE SUBSTR(MD.MDSE_DESC_SHORT_TXT, 1, 50)
                 END  AS DS_ASSET_DESC_TXT
                ,AT.ASSET_TP_CD
                ,AT.ASSET_TP_DESC_TXT
                ,ST.ASSET_STS_CD
                ,ST.ASSET_STS_DESC_TXT
                ,A.DEPC_MTH_NUM
                ,A.TOT_ASSET_QTY
                ,A.DEPC_START_DT
                ,NVL(A.SVC_CONFIG_MSTR_PK, SMM.SVC_CONFIG_MSTR_PK) AS SVC_CONFIG_MSTR_PK
                ,A.SER_NUM
                ,CASE WHEN A.PROC_MODE_CD = #procMode# AND MD.MDSE_ITEM_TP_CD = #mdseItemTp# THEN NULL
                      WHEN A.PROC_MODE_CD = #procMode# AND MD.MDSE_ITEM_TP_CD IS NULL        THEN NULL
                      ELSE A.MDSE_CD
                 END  AS MDSE_CD
                ,NVL(A.COA_MDSE_TP_CD, MD.COA_MDSE_TP_CD) AS COA_MDSE_TP_CD
                <!-- START 2018/08/09 S.Katsuma [QC22812,ADD] -->
                ,MD.COA_PROD_CD
                <!-- END 2018/08/09 S.Katsuma [QC22812,ADD] -->
                ,A.ASSET_TAG_NUM
                ,CASE WHEN A.RTRN_WH_CD IS NOT NULL                                        THEN STC3.DS_ACCT_NM
                      WHEN SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsCRAT#, #svcMachStsRMV#) THEN NULL
                      WHEN A.SHIP_TO_CUST_ACCT_CD IS NOT NULL                              THEN STC2.DS_ACCT_NM
                      ELSE STC.DS_ACCT_NM
                 END  AS DS_ACCT_NM
                ,CASE WHEN A.DS_ASSET_MSTR_PK = A.PRNT_DS_ASSET_MSTR_PK THEN NULL
                      ELSE A.PRNT_DS_ASSET_MSTR_PK
                 END AS PRNT_DS_ASSET_MSTR_PK
                ,CASE WHEN A.ASSET_TP_CD = #assetTpCd# AND A.RTRN_WH_CD IS NOT NULL THEN NULL
                      WHEN A.CPO_ORD_NUM IS NOT NULL THEN A.CPO_ORD_NUM
                      ELSE SMM.CPO_ORD_NUM
                 END  AS CPO_ORD_NUM
                ,CASE WHEN A.CPO_ORD_NUM IS NOT NULL THEN A.CPO_DTL_LINE_NUM
                      ELSE SMM.CPO_DTL_LINE_NUM
                 END  AS CPO_DTL_LINE_NUM
                ,CASE WHEN A.CPO_ORD_NUM IS NOT NULL THEN A.CPO_DTL_LINE_SUB_NUM
                      ELSE SMM.CPO_DTL_LINE_SUB_NUM
                 END  AS CPO_DTL_LINE_SUB_NUM
                ,A.DS_CONTR_NUM
                ,A.CONTR_EFF_FROM_DT
                ,A.CONTR_EFF_THRU_DT
                ,CASE WHEN A.PROC_MODE_CD = #procMode#                                  THEN A.PO_ORD_NUM     ELSE A.CUST_ISS_PO_NUM END AS PO_ORD_NUM
                ,CASE WHEN A.PROC_MODE_CD = #procMode# OR A.PROC_MODE_CD = #procMode11# THEN A.AP_VND_INV_NUM ELSE NULL END AS INV_NUM
                ,A.VND_CD
                ,PV.PRNT_VND_NM AS VND_NM
                ,A.LAST_DEPC_YR_MTH
                ,A.SVC_MACH_MSTR_PK
                ,A.MAN_ENTRY_FLG
                ,CASE WHEN A.RTRN_WH_CD IS NOT NULL                                        THEN NULL
                      WHEN SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsCRAT#, #svcMachStsRMV#) THEN NULL
                      WHEN A.SHIP_TO_CUST_ACCT_CD IS NOT NULL                              THEN A.SHIP_TO_CUST_ACCT_CD
                      ELSE SMM.CUR_LOC_ACCT_NUM
                 END AS SHIP_TO_CUST_ACCT_CD
                ,A.DEPC_CNT
                ,A.INIT_BOOK_AMT
                ,A.CUR_VAL_AMT
                ,A.RSDL_VAL_AMT
                ,A.BLLG_INV_NUM
                ,A.LAST_BILL_DT
                ,A.EZUPTIME
                ,A.EZUPTIMEZONE
                ,A.DTL_CMNT_TXT
                ,A.AMT_CHNG_RSN_TP_CD
                <isNotNull property="bizMsg.rtnWhCd_S1">
                ,CASE WHEN A.RTRN_WH_CD IS NOT NULL THEN A.RTRN_WH_CD
                      ELSE RS.RTL_WH_CD
                 END AS RTRN_WH_CD
                </isNotNull>
                ,ROW_NUMBER() OVER(PARTITION BY A.GLBL_CMPY_CD ORDER BY A.BASE_CMPT_FLG DESC, A.DS_ASSET_MSTR_PK) AS ROW_NUM
            FROM
                 TARGET_ASSET_MSTR A
                ,ASSET_TP          AT
                ,ASSET_STS         ST
                ,MDSE              MD
                ,PRNT_VND          PV
                ,SVC_MACH_MSTR_TMP SMM
                <!-- START 2018/08/09 S.Katsuma [QC22812,DEL] -->
                <!--
                ,SVC_CONFIG_MSTR   SCM
                ,MDL_NM            MN
                ,SVC_CONFIG_MSTR   SCM2
                ,MDL_NM            MN2
                 -->
                <!-- END 2018/08/09 S.Katsuma [QC22812,DEL] -->
                ,SELL_TO_CUST_TMP  STC
                ,SELL_TO_CUST_TMP  STC2
                ,SELL_TO_CUST_TMP  STC3
                <isNotNull property="bizMsg.rtnWhCd_S1">
                ,RTL_SWH           RS
                </isNotNull>
                ,DS_COND_CONST     DCC
            WHERE
                A.GLBL_CMPY_CD         = AT.GLBL_CMPY_CD
            AND A.ASSET_TP_CD          = AT.ASSET_TP_CD
            AND AT.EZCANCELFLAG        = '0'
            AND A.GLBL_CMPY_CD         = ST.GLBL_CMPY_CD
            AND A.ASSET_STS_CD         = ST.ASSET_STS_CD
            AND ST.EZCANCELFLAG        = '0'
            AND ST.GLBL_CMPY_CD        = DCC.GLBL_CMPY_CD
            AND ST.ASSET_STS_CD        = DCC.DS_COND_CONST_CD
            AND DCC.DS_COND_CONST_GRP_ID = #dsCondConstGrpId#
            AND DCC.EZCANCELFLAG       = '0'
            AND A.GLBL_CMPY_CD         = MD.GLBL_CMPY_CD(+)
            AND A.MDSE_CD              = MD.MDSE_CD(+)
            AND MD.EZCANCELFLAG(+)     = '0'
            AND A.GLBL_CMPY_CD         = PV.GLBL_CMPY_CD(+)
            AND A.VND_CD               = PV.PRNT_VND_CD(+)
            AND PV.EZCANCELFLAG(+)     = '0'
            AND A.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD(+)
            AND A.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK(+)
            AND SMM.EZCANCELFLAG(+)    = '0'
            <!-- START 2018/08/09 S.Katsuma [QC22812,DEL] -->
            <!-- 
            AND SMM.GLBL_CMPY_CD       = SCM.GLBL_CMPY_CD(+)
            AND SMM.SVC_CONFIG_MSTR_PK = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.EZCANCELFLAG(+)    = '0'
            AND SCM.GLBL_CMPY_CD       = MN.T_GLBL_CMPY_CD(+)
            AND SCM.MDL_ID             = MN.T_MDL_ID(+)
            AND MN.EZCANCELFLAG(+)     = '0'
            AND A.GLBL_CMPY_CD         = SCM2.GLBL_CMPY_CD(+)
            AND A.SVC_CONFIG_MSTR_PK   = SCM2.SVC_CONFIG_MSTR_PK(+)
            AND SCM2.EZCANCELFLAG(+)   = '0'
            AND SCM2.GLBL_CMPY_CD      = MN2.T_GLBL_CMPY_CD(+)
            AND SCM2.MDL_ID            = MN2.T_MDL_ID(+)
            AND MN2.EZCANCELFLAG(+)    = '0'
             -->
            <!-- END 2018/08/09 S.Katsuma [QC22812,DEL] -->
            AND SMM.GLBL_CMPY_CD       = STC.GLBL_CMPY_CD(+)
            AND SMM.CUR_LOC_ACCT_NUM   = STC.SELL_TO_CUST_CD(+)
            AND STC.EZCANCELFLAG(+)    = '0'
            AND A.GLBL_CMPY_CD         = STC2.GLBL_CMPY_CD(+)
            AND A.SHIP_TO_CUST_ACCT_CD = STC2.SELL_TO_CUST_CD(+)
            AND STC2.EZCANCELFLAG(+)   = '0'
            <isNotNull property="bizMsg.rtnWhCd_S1">
            AND SMM.GLBL_CMPY_CD       = RS.GLBL_CMPY_CD(+)
            AND SMM.CUR_LOC_NUM        = RS.INVTY_LOC_CD(+)
            AND RS.EZCANCELFLAG(+)     = '0'
            </isNotNull>
            AND A.GLBL_CMPY_CD         = STC3.GLBL_CMPY_CD(+)
            AND A.SELL_TO_CUST_CD      = STC3.SELL_TO_CUST_CD(+)
            AND STC3.EZCANCELFLAG(+)   = '0'
        ) AM
        ,CPO_DTL CD
    WHERE
        ROW_NUM             &lt;= #rowNum#
    AND AM.GLBL_CMPY_CD         = CD.GLBL_CMPY_CD(+)
    AND AM.CPO_ORD_NUM          = CD.CPO_ORD_NUM(+)
    AND AM.CPO_DTL_LINE_NUM     = CD.CPO_DTL_LINE_NUM(+)
    AND AM.CPO_DTL_LINE_SUB_NUM = CD.CPO_DTL_LINE_SUB_NUM(+)
    AND CD.EZCANCELFLAG(+)      = '0'
    <isNotNull property="bizMsg.svcConfigMstrPk_S1">
    AND AM.SVC_CONFIG_MSTR_PK   = #bizMsg.svcConfigMstrPk_S1#
    </isNotNull>
    <isNotNull property="bizMsg.cpoOrdNum_S1">
    AND EXISTS(
        SELECT NULL
        FROM (
            SELECT
                A2.CPO_ORD_NUM AS ASSET_CPO_ORD_NUM
                ,SMM.CPO_ORD_NUM AS MACH_CPO_ORD_NUM
            FROM DS_ASSET_MSTR A2
                ,SVC_MACH_MSTR SMM
            WHERE
                A2.GLBL_CMPY_CD            = AM.GLBL_CMPY_CD
            AND A2.PRNT_DS_ASSET_MSTR_PK   = AM.DS_ASSET_MSTR_PK
            AND A2.EZCANCELFLAG            = '0'
            AND SMM.GLBL_CMPY_CD(+)        = A2.GLBL_CMPY_CD
            AND SMM.SVC_MACH_MSTR_PK(+)    = A2.SVC_MACH_MSTR_PK
            AND SMM.EZCANCELFLAG(+)        = '0'
        )
        WHERE (
            ASSET_CPO_ORD_NUM          = #bizMsg.cpoOrdNum_S1#
            OR MACH_CPO_ORD_NUM        = #bizMsg.cpoOrdNum_S1#
        )
    )
    </isNotNull>
    <isNotNull property="bizMsg.rtnWhCd_S1">
    AND AM.RTRN_WH_CD           = #bizMsg.rtnWhCd_S1#
    </isNotNull>
    <isNotNull property="bizMsg.shipToCustAcctCd_S1">
    AND AM.SHIP_TO_CUST_ACCT_CD = #bizMsg.shipToCustAcctCd_S1#
    </isNotNull>
    <isNotNull property="bizMsg.dsAssetDescTxt_S1">
    AND UPPER( AM.DS_ASSET_DESC_TXT ) LIKE #bizMsg.dsAssetDescTxt_S1#
    </isNotNull>
    ORDER BY
        ROW_NUM
    </statement>

    <resultMap id="result.searchDetail" class="NLEL0060_ASMsg">
        <result property="dsAssetMstrPk_A1"          column="DS_ASSET_MSTR_PK"            javaType="EZDSBigDecimalItem"/>
        <result property="dsAssetDescTxt_A1"         column="DS_ASSET_DESC_TXT"           javaType="EZDSStringItem"/>
        <result property="assetTpDescTxt_A1"         column="ASSET_TP_DESC_TXT"           javaType="EZDSStringItem"/>
        <result property="assetStsCd_A1"             column="ASSET_STS_CD"                javaType="EZDSStringItem"/>
        <result property="assetStsDescTxt_A1"        column="ASSET_STS_DESC_TXT"          javaType="EZDSStringItem"/>
        <result property="depcMthNum_A1"             column="DEPC_MTH_NUM"                javaType="EZDSStringItem"/>
        <result property="totAssetQty_A1"            column="TOT_ASSET_QTY"               javaType="EZDSBigDecimalItem"/>
        <result property="depcStartDt_A1"            column="DEPC_START_DT"               javaType="EZDSDateItem"/>
        <result property="svcConfigMstrPk_A1"        column="SVC_CONFIG_MSTR_PK"          javaType="EZDSBigDecimalItem"/>
        <result property="serNum_A1"                 column="SER_NUM"                     javaType="EZDSStringItem"/>
        <result property="mdseCd_A1"                 column="MDSE_CD"                     javaType="EZDSStringItem"/>
        <result property="coaMdseTpCd_A1"            column="COA_MDSE_TP_CD"              javaType="EZDSStringItem"/>
        <!-- START 2018/08/09 S.Katsuma [QC22812,ADD] -->
        <result property="coaProdCd_A1"              column="COA_PROD_CD"                 javaType="EZDSStringItem"/>
        <!-- END 2018/08/09 S.Katsuma [QC22812,ADD] -->
        <result property="assetTagNum_A1"            column="ASSET_TAG_NUM"               javaType="EZDSStringItem"/>
        <result property="dsAssetGrpInitBookAmt_A1"  column="DS_ASSET_GRP_INIT_BOOK_AMT"  javaType="EZDSBigDecimalItem"/>
        <result property="curValAmt_A1"              column="CUR_VAL_AMT"                 javaType="EZDSBigDecimalItem"/>
        <result property="prntDsAssetMstrPk_A1"      column="PRNT_DS_ASSET_MSTR_PK"       javaType="EZDSBigDecimalItem"/>
        <result property="dsAcctNm_A1"               column="DS_ACCT_NM"                  javaType="EZDSStringItem"/>
        <result property="cpoOrdNum_A1"              column="CPO_ORD_NUM"                 javaType="EZDSStringItem"/>
        <result property="dplyLineNum_A1"            column="DPLY_LINE_NUM"               javaType="EZDSStringItem"/>
        <result property="dsContrNum_A1"             column="DS_CONTR_NUM"                javaType="EZDSStringItem"/>
        <result property="contrEffFromDt_A1"         column="CONTR_EFF_FROM_DT"           javaType="EZDSDateItem"/>
        <result property="contrEffThruDt_A1"         column="CONTR_EFF_THRU_DT"           javaType="EZDSDateItem"/>
        <result property="custIssPoNum_A1"           column="PO_ORD_NUM"                  javaType="EZDSStringItem"/>
        <result property="invNum_A1"                 column="INV_NUM"                     javaType="EZDSStringItem"/>
        <result property="vndCd_A1"                  column="VND_CD"                      javaType="EZDSStringItem"/>
        <result property="prntVndNm_A1"              column="VND_NM"                      javaType="EZDSStringItem"/>
        <result property="svcInvNum_A1"              column="SVC_INV_NUM"                 javaType="EZDSStringItem"/>
        <result property="invDt_A1"                  column="INV_DT"                      javaType="EZDSDateItem"/>
        <result property="lastDepcYrMth_A1"          column="LAST_DEPC_YR_MTH"            javaType="EZDSDateItem"/>
        <result property="svcMachMstrPk_A1"          column="SVC_MACH_MSTR_PK"            javaType="EZDSBigDecimalItem"/>
        <result property="manEntryFlg_A1"            column="MAN_ENTRY_FLG"               javaType="EZDSStringItem"/>
        <result property="shipToCustAcctCd_A1"       column="SHIP_TO_CUST_ACCT_CD"        javaType="EZDSStringItem"/>
        <result property="depcCnt_A1"                column="DEPC_CNT"                    javaType="EZDSBigDecimalItem"/>
        <result property="initBookAmt_A1"            column="INIT_BOOK_AMT"               javaType="EZDSBigDecimalItem"/>
        <result property="rsdlValAmt_A1"             column="RSDL_VAL_AMT"                javaType="EZDSBigDecimalItem"/>
        <result property="dsAssetGrpInitBookAmt_AB"  column="DS_ASSET_GRP_INIT_BOOK_AMT"  javaType="EZDSBigDecimalItem"/>
        <result property="dsAssetDescTxt_AB"         column="DS_ASSET_DESC_TXT"           javaType="EZDSDateItem"/>
        <result property="depcMthNum_AB"             column="DEPC_MTH_NUM"                javaType="EZDSDateItem"/>
        <result property="totAssetQty_AB"            column="TOT_ASSET_QTY"               javaType="EZDSBigDecimalItem"/>
        <result property="assetTagNum_AB"            column="ASSET_TAG_NUM"               javaType="EZDSDateItem"/>
        <result property="curValAmt_AB"              column="CUR_VAL_AMT"                 javaType="EZDSBigDecimalItem"/>
        <result property="dsContrNum_AB"             column="DS_CONTR_NUM"                javaType="EZDSStringItem"/>
        <result property="dsAcctNm_AB"               column="DS_ACCT_NM"                  javaType="EZDSStringItem"/>
        <result property="contrEffFromDt_AB"         column="CONTR_EFF_FROM_DT"           javaType="EZDSDateItem"/>
        <result property="contrEffThruDt_AB"         column="CONTR_EFF_THRU_DT"           javaType="EZDSDateItem"/>
        <result property="depcStartDt_AB"            column="DEPC_START_DT"               javaType="EZDSDateItem"/>
        <result property="serNum_AB"                 column="SER_NUM"                     javaType="EZDSStringItem"/>
        <result property="coaMdseTpCd_AB"            column="COA_MDSE_TP_CD"              javaType="EZDSStringItem"/>
        <result property="cpoOrdNum_AB"              column="CPO_ORD_NUM"                 javaType="EZDSStringItem"/>
        <result property="dplyLineNum_AB"            column="CPO_DTL_LINE_NUM"            javaType="EZDSStringItem"/>
        <result property="custIssPoNum_A1"           column="PO_ORD_NUM"                  javaType="EZDSStringItem"/>
        <result property="invNum_AB"                 column="INV_NUM"                     javaType="EZDSStringItem"/>
        <result property="vndCd_AB"                  column="VND_CD"                      javaType="EZDSStringItem"/>
        <result property="shipToCustAcctCd_AB"       column="SHIP_TO_CUST_ACCT_CD"        javaType="EZDSStringItem"/>
        <result property="ezUpTime_A1"               column="EZUPTIME"                    javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_A1"           column="EZUPTIMEZONE"                javaType="EZDSStringItem"/>
        <result property="dtlCmntTxt_A1"             column="DTL_CMNT_TXT"                javaType="EZDSStringItem"/>
        <result property="dtlCmntTxt_AB"             column="DTL_CMNT_TXT"                javaType="EZDSStringItem"/>
        <result property="amtChngRsnTpCd_A1"         column="AMT_CHNG_RSN_TP_CD"          javaType="EZDSStringItem"/>
        <result property="amtChngRsnTpCd_AB"         column="AMT_CHNG_RSN_TP_CD"          javaType="EZDSStringItem"/>
    </resultMap>
    <statement id="searchAssignment" parameterClass="Map" resultMap="result.searchAssignment">
        WITH TARGET_ASSET_MSTR AS (
            SELECT
                A.*
            FROM
                 DS_ASSET_MSTR A
            WHERE
                    A.GLBL_CMPY_CD         = #glblCmpyCd#
                <iterate property="dsAssetMstrPkList" var="dsAssetMstrPkList[]" open="AND A.DS_ASSET_MSTR_PK IN (" close=")" conjunction=",">
                #dsAssetMstrPkList[]#
                </iterate>
                AND A.DS_ASSET_MSTR_PK     = A.PRNT_DS_ASSET_MSTR_PK
                AND A.EZCANCELFLAG         = '0'
        )
        SELECT
            AM.DS_ASSET_MSTR_PK AS PRNT_DS_ASSET_MSTR_PK
           ,AM.ASSET_TP_CD
           ,AM.ASSET_TP_DESC_TXT
           ,AM.AJE_COA_BR_CD
           ,AM.AJE_COA_CC_CD
           ,AM.AJE_COA_BU_CD
           ,AM.ASSET_COA_CMPY_CD
           ,AM.ASSET_COA_BR_CD
           ,AM.ASSET_COA_CC_CD
           ,AM.ASSET_COA_ACCT_CD
           ,AM.ASSET_COA_PROD_CD
           ,AM.ASSET_COA_CH_CD
           ,AM.ASSET_COA_AFFL_CD
           ,AM.ASSET_COA_PROJ_CD
           ,AM.ASSET_COA_EXTN_CD
           ,AM.EXP_COA_CMPY_CD
           ,AM.EXP_COA_BR_CD
           ,AM.EXP_COA_CC_CD
           ,AM.EXP_COA_ACCT_CD
           ,AM.EXP_COA_PROD_CD
           ,AM.EXP_COA_CH_CD
           ,AM.EXP_COA_AFFL_CD
           ,AM.EXP_COA_PROJ_CD
           ,AM.EXP_COA_EXTN_CD
           ,AM.RTRN_WH_CD
           ,AM.FIRST_LINE_ADDR
           ,AM.SCD_LINE_ADDR
           ,AM.THIRD_LINE_ADDR
           ,AM.FRTH_LINE_ADDR
           ,AM.CTY_ADDR
           ,AM.ST_CD
           ,AM.POST_CD
           ,AM.ASG_DTL_CMNT_TXT
           ,AM.SHIP_TO_CUST_CD
           ,AM.SVC_MACH_MSTR_PK
           ,AM.EZUPTIME
           ,AM.EZUPTIMEZONE
           ,AM.ASSET_STS_CD
           ,AM.ASSET_TP_CD
           ,AM.DEF_ASSET_COA_ACCT_CD
           ,AM.DEF_EXP_COA_ACCT_CD
           ,AM.DEF_COA_PROJ_CD
           ,AM.DEF_COA_PROD_CD
           ,AM.DEF_ASSET_COA_BR_CD
           ,AM.DEF_ASSET_COA_CC_CD
           ,AM.DEF_EXP_COA_EXTN_CD
           ,AM.DEF_EXP_COA_BR_CD
           ,AM.DEF_EXP_COA_CC_CD
           ,AM.DEF_COA_CH_CD
           ,AM.DEF_COA_AFFL_CD
           ,AM.PSN_NUM
           ,AM.PROC_MODE_CD
        FROM
            (
             SELECT
                 A.GLBL_CMPY_CD
                ,A.DS_ASSET_MSTR_PK
                ,AT.ASSET_TP_CD
                ,AT.ASSET_TP_DESC_TXT
                ,AT.AJE_COA_BR_CD
                ,AT.AJE_COA_CC_CD
                ,AT.AJE_COA_BU_CD
                ,A.ASSET_COA_CMPY_CD
                ,A.ASSET_COA_BR_CD
                ,A.ASSET_COA_CC_CD
                ,A.ASSET_COA_ACCT_CD
                ,A.ASSET_COA_PROD_CD
                ,A.ASSET_COA_CH_CD
                ,A.ASSET_COA_AFFL_CD
                ,A.ASSET_COA_PROJ_CD
                ,A.ASSET_COA_EXTN_CD
                ,A.EXP_COA_CMPY_CD
                ,A.EXP_COA_BR_CD
                ,A.EXP_COA_CC_CD
                ,A.EXP_COA_ACCT_CD
                ,A.EXP_COA_PROD_CD
                ,A.EXP_COA_CH_CD
                ,A.EXP_COA_AFFL_CD
                ,A.EXP_COA_PROJ_CD
                ,A.EXP_COA_EXTN_CD
                ,A.PROC_MODE_CD
                ,CASE WHEN A.PROC_MODE_CD = #procMode11# AND A.ASSET_STS_CD = #assetStsRe# THEN #locationSold#
                      WHEN A.RTRN_WH_CD IS NOT NULL                                        THEN A.RTRN_WH_CD
                      WHEN SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsCRAT#, #svcMachStsRMV#) THEN RS.RTL_WH_CD
                      ELSE #rtrnWhCd#
                 END                  AS RTRN_WH_CD
                 --FIRST_LINE_ADDR
                ,CASE WHEN A.RTRN_WH_CD           IS NOT NULL THEN A.FIRST_LINE_ADDR
                      WHEN    A.FIRST_LINE_ADDR   IS NOT NULL
                           OR A.CTY_ADDR          IS NOT NULL
                           OR A.ST_CD             IS NOT NULL
                           OR A.POST_CD           IS NOT NULL THEN A.FIRST_LINE_ADDR
                      WHEN A.SHIP_TO_CUST_CD      IS NOT NULL THEN SC3.FIRST_LINE_ADDR
                      <!-- START 2023/07/10 S.Moriai [QC#61524, DEL] -->
                      <!-- WHEN    SMM.FIRST_LINE_ADDR IS NOT NULL -->
                       <!-- OR SMM.CTY_ADDR        IS NOT NULL -->
                       <!-- OR SMM.ST_CD           IS NOT NULL -->
                       <!-- OR SMM.POST_CD         IS NOT NULL THEN SMM.FIRST_LINE_ADDR -->
                      <!-- END 2023/07/10 S.Moriai [QC#61524, DEL] -->
                      ELSE                                         SC.FIRST_LINE_ADDR
                 END                  AS FIRST_LINE_ADDR
                 --SCD_LINE_ADDR
                ,CASE WHEN A.RTRN_WH_CD           IS NOT NULL THEN A.SCD_LINE_ADDR
                      WHEN    A.FIRST_LINE_ADDR   IS NOT NULL
                           OR A.CTY_ADDR          IS NOT NULL
                           OR A.ST_CD             IS NOT NULL
                           OR A.POST_CD           IS NOT NULL THEN A.SCD_LINE_ADDR
                      WHEN A.SHIP_TO_CUST_CD      IS NOT NULL THEN SC3.SCD_LINE_ADDR
                      <!-- START 2023/07/10 S.Moriai [QC#61524, DEL] -->
                      <!-- WHEN    SMM.FIRST_LINE_ADDR IS NOT NULL -->
                       <!-- OR SMM.CTY_ADDR        IS NOT NULL -->
                       <!-- OR SMM.ST_CD           IS NOT NULL -->
                       <!-- OR SMM.POST_CD         IS NOT NULL THEN SMM.SCD_LINE_ADDR -->
                      <!-- END 2023/07/10 S.Moriai [QC#61524, DEL] -->
                      ELSE                                         SC.SCD_LINE_ADDR
                 END                  AS SCD_LINE_ADDR
                 --THIRD_LINE_ADDR
                ,CASE WHEN A.RTRN_WH_CD           IS NOT NULL THEN A.THIRD_LINE_ADDR
                      WHEN    A.FIRST_LINE_ADDR   IS NOT NULL
                           OR A.CTY_ADDR          IS NOT NULL
                           OR A.ST_CD             IS NOT NULL
                           OR A.POST_CD           IS NOT NULL THEN A.THIRD_LINE_ADDR
                      WHEN A.SHIP_TO_CUST_CD      IS NOT NULL THEN SC3.THIRD_LINE_ADDR
                      <!-- START 2023/07/10 S.Moriai [QC#61524, DEL] -->
                      <!-- WHEN    SMM.FIRST_LINE_ADDR IS NOT NULL -->
                       <!-- OR SMM.CTY_ADDR        IS NOT NULL -->
                       <!-- OR SMM.ST_CD           IS NOT NULL -->
                       <!-- OR SMM.POST_CD         IS NOT NULL THEN SMM.THIRD_LINE_ADDR -->
                      <!-- END 2023/07/10 S.Moriai [QC#61524, DEL] -->
                      ELSE                                         SC.THIRD_LINE_ADDR
                 END                  AS THIRD_LINE_ADDR
                 --FRTH_LINE_ADDR
                ,CASE WHEN A.RTRN_WH_CD           IS NOT NULL THEN A.FRTH_LINE_ADDR
                      WHEN    A.FIRST_LINE_ADDR   IS NOT NULL
                           OR A.CTY_ADDR          IS NOT NULL
                           OR A.ST_CD             IS NOT NULL
                           OR A.POST_CD           IS NOT NULL THEN A.FRTH_LINE_ADDR
                      WHEN A.SHIP_TO_CUST_CD      IS NOT NULL THEN SC3.FRTH_LINE_ADDR
                      <!-- START 2023/07/10 S.Moriai [QC#61524, DEL] -->
                      <!-- WHEN    SMM.FIRST_LINE_ADDR IS NOT NULL -->
                       <!-- OR SMM.CTY_ADDR        IS NOT NULL -->
                       <!-- OR SMM.ST_CD           IS NOT NULL -->
                       <!-- OR SMM.POST_CD         IS NOT NULL THEN SMM.FRTH_LINE_ADDR -->
                      <!-- END 2023/07/10 S.Moriai [QC#61524, DEL] -->
                      ELSE                                         SC.FRTH_LINE_ADDR
                 END                  AS FRTH_LINE_ADDR
                 --CTY_ADDR
                ,CASE WHEN A.RTRN_WH_CD           IS NOT NULL THEN A.CTY_ADDR
                      WHEN    A.FIRST_LINE_ADDR   IS NOT NULL
                           OR A.CTY_ADDR          IS NOT NULL
                           OR A.ST_CD             IS NOT NULL
                           OR A.POST_CD           IS NOT NULL THEN A.CTY_ADDR
                      WHEN A.SHIP_TO_CUST_CD      IS NOT NULL THEN SC3.CTY_ADDR
                      <!-- START 2023/07/10 S.Moriai [QC#61524, DEL] -->
                      <!-- WHEN    SMM.FIRST_LINE_ADDR IS NOT NULL -->
                       <!-- OR SMM.CTY_ADDR        IS NOT NULL -->
                       <!-- OR SMM.ST_CD           IS NOT NULL -->
                       <!-- OR SMM.POST_CD         IS NOT NULL THEN SMM.CTY_ADDR -->
                      <!-- END 2023/07/10 S.Moriai [QC#61524, DEL] -->
                      ELSE                                         SC.CTY_ADDR
                 END                  AS CTY_ADDR
                 --ST_CD
                ,CASE WHEN A.RTRN_WH_CD           IS NOT NULL THEN A.ST_CD
                      WHEN    A.FIRST_LINE_ADDR   IS NOT NULL
                           OR A.CTY_ADDR          IS NOT NULL
                           OR A.ST_CD             IS NOT NULL
                           OR A.POST_CD           IS NOT NULL THEN A.ST_CD
                      WHEN A.SHIP_TO_CUST_CD      IS NOT NULL THEN SC3.ST_CD
                      <!-- START 2023/07/10 S.Moriai [QC#61524, DEL] -->
                      <!-- WHEN    SMM.FIRST_LINE_ADDR IS NOT NULL -->
                       <!-- OR SMM.CTY_ADDR        IS NOT NULL -->
                       <!-- OR SMM.ST_CD           IS NOT NULL -->
                       <!-- OR SMM.POST_CD         IS NOT NULL THEN SMM.ST_CD -->
                      <!-- END 2023/07/10 S.Moriai [QC#61524, DEL] -->
                      ELSE                                         SC.ST_CD
                 END                  AS ST_CD
                 --POST_CD
                ,CASE WHEN A.RTRN_WH_CD           IS NOT NULL THEN A.POST_CD
                      WHEN    A.FIRST_LINE_ADDR   IS NOT NULL
                           OR A.CTY_ADDR          IS NOT NULL
                           OR A.ST_CD             IS NOT NULL
                           OR A.POST_CD           IS NOT NULL THEN A.POST_CD
                      WHEN A.SHIP_TO_CUST_CD      IS NOT NULL THEN SC3.POST_CD
                      <!-- START 2023/07/10 S.Moriai [QC#61524, DEL] -->
                      <!-- WHEN    SMM.FIRST_LINE_ADDR IS NOT NULL -->
                       <!-- OR SMM.CTY_ADDR        IS NOT NULL -->
                       <!-- OR SMM.ST_CD           IS NOT NULL -->
                       <!-- OR SMM.POST_CD         IS NOT NULL THEN SMM.POST_CD -->
                      <!-- END 2023/07/10 S.Moriai [QC#61524, DEL] -->
                      ELSE                                         SC.POST_CD
                 END                  AS POST_CD
                ,A.ASG_DTL_CMNT_TXT
                ,CASE WHEN A.RTRN_WH_CD IS NOT NULL                                        THEN NULL
                      WHEN SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsCRAT#, #svcMachStsRMV#) THEN NULL
                      WHEN A.SHIP_TO_CUST_CD IS NOT NULL                                   THEN A.SHIP_TO_CUST_CD
                      ELSE SMM.CUR_LOC_NUM
                 END                  AS SHIP_TO_CUST_CD
                ,A.SVC_MACH_MSTR_PK
                ,A.EZUPTIME
                ,A.EZUPTIMEZONE
                ,A.ASSET_STS_CD
                ,BC.ASSET_COA_ACCT_CD AS DEF_ASSET_COA_ACCT_CD
                ,BC.DEPC_COA_ACCT_CD  AS DEF_EXP_COA_ACCT_CD
                ,MD.COA_MDSE_TP_CD    AS DEF_COA_PROJ_CD
                ,MD.COA_PROD_CD       AS DEF_COA_PROD_CD
                ,CASE WHEN CB.COA_BR_TP_CD = #newcore# THEN T.COA_BR_CD
                      ELSE #defBrNewcore# 
                 END                  AS DEF_ASSET_COA_BR_CD
                ,CASE WHEN CB.COA_BR_TP_CD = #newcore# THEN T.COA_CC_CD
                      ELSE #defCcNewcore# 
                 END                  AS DEF_ASSET_COA_CC_CD
                ,T.COA_EXTN_CD        AS DEF_EXP_COA_EXTN_CD
                ,T.COA_BR_CD          AS DEF_EXP_COA_BR_CD
                ,T.COA_CC_CD          AS DEF_EXP_COA_CC_CD
                ,SP.PSN_NUM           AS PSN_NUM
                ,CASE WHEN A.RTRN_WH_CD IS NOT NULL                                        THEN #defBrNewcore#
                      WHEN SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsCRAT#, #svcMachStsRMV#) THEN #defBrNewcore#
                      WHEN A.SHIP_TO_CUST_ACCT_CD IS NOT NULL                              THEN NVL(STC2.COA_CH_CD, #defBrNewcore#)
                      ELSE NVL(STC.COA_CH_CD, #defBrNewcore#)
                 END                  AS DEF_COA_CH_CD
                ,CASE WHEN A.RTRN_WH_CD IS NOT NULL                                        THEN #defBrNewcore#
                      WHEN SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsCRAT#, #svcMachStsRMV#) THEN #defBrNewcore#
                      WHEN A.SHIP_TO_CUST_ACCT_CD IS NOT NULL                              THEN NVL(STC2.COA_AFFL_CD, #defBrNewcore#)
                      ELSE NVL(STC.COA_AFFL_CD, #defBrNewcore#)
                 END                  AS DEF_COA_AFFL_CD
                ,NVL(A.SVC_CONFIG_MSTR_PK, SMM.SVC_CONFIG_MSTR_PK) AS SVC_CONFIG_MSTR_PK
                ,CASE WHEN A.CPO_ORD_NUM IS NOT NULL THEN A.CPO_ORD_NUM
                      ELSE SMM.CPO_ORD_NUM
                 END                  AS CPO_ORD_NUM
                ,CASE WHEN A.RTRN_WH_CD IS NOT NULL                                        THEN NULL
                      WHEN SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsCRAT#, #svcMachStsRMV#) THEN NULL
                      WHEN A.SHIP_TO_CUST_ACCT_CD IS NOT NULL                              THEN A.SHIP_TO_CUST_ACCT_CD
                      ELSE SMM.CUR_LOC_ACCT_NUM
                 END                  AS SHIP_TO_CUST_ACCT_CD
                <isNotNull property="bizMsg.dsAssetDescTxt_S1">
                ,CASE WHEN A.DS_ASSET_DESC_TXT IS NOT NULL THEN A.DS_ASSET_DESC_TXT
                      WHEN MN2.T_MDL_NM        IS NOT NULL THEN MN2.T_MDL_NM
                      WHEN MN.T_MDL_NM         IS NOT NULL THEN MN.T_MDL_NM
                      ELSE SUBSTR(MD.MDSE_DESC_SHORT_TXT, 1, 50)
                 END                  AS DS_ASSET_DESC_TXT
                </isNotNull>
                ,ROW_NUMBER() OVER(PARTITION BY A.GLBL_CMPY_CD ORDER BY A.BASE_CMPT_FLG DESC, A.DS_ASSET_MSTR_PK) AS ROW_NUM
             FROM
                 TARGET_ASSET_MSTR A
                ,ASSET_TP          AT
                ,MDSE              MD
                ,TOC_DLY_SNAP_SHOT T
                ,COA_BR            CB
                ,SVC_MACH_MSTR     SMM
                ,SELL_TO_CUST      STC
                ,SELL_TO_CUST      STC2
                ,SHIP_TO_CUST      SC
                ,SHIP_TO_CUST      SC3
                ,RTL_SWH           RS
                ,ASSET_BOOK_CTRL   BC
                <isNotNull property="bizMsg.dsAssetDescTxt_S1">
                ,SVC_CONFIG_MSTR   SCM
                ,MDL_NM            MN
                ,SVC_CONFIG_MSTR   SCM2
                ,MDL_NM            MN2
                </isNotNull>
                ,DS_COND_CONST     DCC
                ,S21_PSN           SP
                ,ORG_FUNC_ASG      OFA
             WHERE
                 A.GLBL_CMPY_CD         = DCC.GLBL_CMPY_CD
             AND A.ASSET_STS_CD         = DCC.DS_COND_CONST_CD
             AND DCC.DS_COND_CONST_GRP_ID = #dsCondConstGrpId#
             AND DCC.EZCANCELFLAG       = '0'
             AND A.GLBL_CMPY_CD         = AT.GLBL_CMPY_CD
             AND A.ASSET_TP_CD          = AT.ASSET_TP_CD
             AND AT.EZCANCELFLAG        = '0'
             AND A.GLBL_CMPY_CD         = MD.GLBL_CMPY_CD(+)
             AND A.MDSE_CD              = MD.MDSE_CD(+)
             AND MD.EZCANCELFLAG(+)     = '0'
             AND A.GLBL_CMPY_CD         = T.GLBL_CMPY_CD(+)
             AND A.SLS_REP_TOC_CD       = T.TOC_CD(+)
             AND T.EZCANCELFLAG(+)      = '0'
             AND T.GLBL_CMPY_CD         = CB.GLBL_CMPY_CD(+)
             AND T.COA_BR_CD            = CB.COA_BR_CD(+)
             AND CB.EZCANCELFLAG(+)     = '0'
             AND T.GLBL_CMPY_CD         = OFA.GLBL_CMPY_CD(+)
             AND T.TOC_CD               = OFA.TOC_CD(+)
             AND OFA.EZCANCELFLAG(+)    = '0'
             AND OFA.GLBL_CMPY_CD       = SP.GLBL_CMPY_CD(+)
             AND OFA.PSN_CD             = SP.PSN_CD(+)
             AND OFA.EZCANCELFLAG(+)    = '0'
             AND A.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD(+)
             AND A.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK(+)
             AND SMM.EZCANCELFLAG(+)    = '0'
             AND SMM.GLBL_CMPY_CD       = STC.GLBL_CMPY_CD(+)
             AND SMM.CUR_LOC_ACCT_NUM   = STC.SELL_TO_CUST_CD(+)
             AND STC.EZCANCELFLAG(+)    = '0'
             AND A.GLBL_CMPY_CD         = STC2.GLBL_CMPY_CD(+)
             AND A.SHIP_TO_CUST_ACCT_CD = STC2.SELL_TO_CUST_CD(+)
             AND STC2.EZCANCELFLAG(+)   = '0'
             AND SMM.GLBL_CMPY_CD       = SC.GLBL_CMPY_CD(+)
             AND SMM.CUR_LOC_NUM        = SC.SHIP_TO_CUST_CD(+)
             AND SC.EZCANCELFLAG(+)     = '0'
             AND A.GLBL_CMPY_CD         = SC3.GLBL_CMPY_CD(+)
             AND A.SHIP_TO_CUST_CD      = SC3.SHIP_TO_CUST_CD(+)
             AND SC3.EZCANCELFLAG(+)    = '0'
             AND SMM.GLBL_CMPY_CD       = RS.GLBL_CMPY_CD(+)
             AND SMM.CUR_LOC_NUM        = RS.INVTY_LOC_CD(+)
             AND RS.EZCANCELFLAG(+)     = '0'
             AND A.GLBL_CMPY_CD         = BC.GLBL_CMPY_CD
             AND A.ASSET_TP_CD          = BC.ASSET_TP_CD
             AND BC.EFF_FROM_DT     &lt;= #slsDt#
             AND (
                     BC.EFF_THRU_DT &gt;= #slsDt#
                  OR BC.EFF_THRU_DT IS NULL
                 )
             AND BC.EZCANCELFLAG = '0'
             <isNotNull property="bizMsg.dsAssetDescTxt_S1">
             AND SMM.GLBL_CMPY_CD       = SCM.GLBL_CMPY_CD(+)
             AND SMM.SVC_CONFIG_MSTR_PK = SCM.SVC_CONFIG_MSTR_PK(+)
             AND SCM.EZCANCELFLAG(+)    = '0'
             AND SCM.GLBL_CMPY_CD       = MN.T_GLBL_CMPY_CD(+)
             AND SCM.MDL_ID             = MN.T_MDL_ID(+)
             AND MN.EZCANCELFLAG(+)     = '0'
             AND A.GLBL_CMPY_CD         = SCM2.GLBL_CMPY_CD(+)
             AND A.SVC_CONFIG_MSTR_PK   = SCM2.SVC_CONFIG_MSTR_PK(+)
             AND SCM2.EZCANCELFLAG(+)   = '0'
             AND SCM2.GLBL_CMPY_CD      = MN2.T_GLBL_CMPY_CD(+)
             AND SCM2.MDL_ID            = MN2.T_MDL_ID(+)
             AND MN2.EZCANCELFLAG(+)    = '0'
             </isNotNull>
            ) AM
        WHERE
            AM.ROW_NUM          &lt;= #rowNum#
        <isNotNull property="bizMsg.svcConfigMstrPk_S1">
        AND AM.SVC_CONFIG_MSTR_PK   = #bizMsg.svcConfigMstrPk_S1#
        </isNotNull>
        <isNotNull property="bizMsg.cpoOrdNum_S1">
        AND EXISTS(
            SELECT NULL
            FROM (
                SELECT
                    A2.CPO_ORD_NUM AS ASSET_CPO_ORD_NUM
                    ,SMM.CPO_ORD_NUM AS MACH_CPO_ORD_NUM
                FROM DS_ASSET_MSTR A2
                    ,SVC_MACH_MSTR SMM
                WHERE
                    A2.GLBL_CMPY_CD            = AM.GLBL_CMPY_CD
                AND A2.PRNT_DS_ASSET_MSTR_PK   = AM.DS_ASSET_MSTR_PK
                AND A2.EZCANCELFLAG            = '0'
                AND SMM.GLBL_CMPY_CD(+)        = A2.GLBL_CMPY_CD
                AND SMM.SVC_MACH_MSTR_PK(+)    = A2.SVC_MACH_MSTR_PK
                AND SMM.EZCANCELFLAG(+)        = '0'
            )
            WHERE (
                ASSET_CPO_ORD_NUM          = #bizMsg.cpoOrdNum_S1#
                OR MACH_CPO_ORD_NUM        = #bizMsg.cpoOrdNum_S1#
            )
        )
        </isNotNull>
        <isNotNull property="bizMsg.rtnWhCd_S1">
        AND AM.RTRN_WH_CD           = #bizMsg.rtnWhCd_S1#
        </isNotNull>
        <isNotNull property="bizMsg.shipToCustAcctCd_S1">
        AND AM.SHIP_TO_CUST_ACCT_CD = #bizMsg.shipToCustAcctCd_S1#
        </isNotNull>
        <isNotNull property="bizMsg.dsAssetDescTxt_S1">
        AND UPPER ( AM.DS_ASSET_DESC_TXT ) LIKE #bizMsg.dsAssetDescTxt_S1#
        </isNotNull>
        <isNotNull property="bizMsg.rtnWhCd_S1">
        AND AM.RTRN_WH_CD           = #bizMsg.rtnWhCd_S1#
        </isNotNull>
        <isNotNull property="bizMsg.shipToCustAcctCd_S1">
        AND AM.SHIP_TO_CUST_ACCT_CD = #bizMsg.shipToCustAcctCd_S1#
        </isNotNull>
        <isNotNull property="bizMsg.dsAssetDescTxt_S1">
        AND UPPER ( AM.DS_ASSET_DESC_TXT ) LIKE #bizMsg.dsAssetDescTxt_S1#
        </isNotNull>
        ORDER BY
            AM.ROW_NUM
    </statement>

    <resultMap id="result.searchAssignment" class="NLEL0060_BSMsg">
        <result property="prntDsAssetMstrPk_B1"  column="PRNT_DS_ASSET_MSTR_PK"   javaType="EZDSBigDecimalItem"/>
        <result property="assetTpDescTxt_B1"     column="ASSET_TP_DESC_TXT"       javaType="EZDSStringItem"/>
        <result property="assetCoaCmpyCd_B1"     column="ASSET_COA_CMPY_CD"       javaType="EZDSStringItem"/>
        <result property="assetCoaBrCd_B1"       column="ASSET_COA_BR_CD"         javaType="EZDSStringItem"/>
        <result property="assetCoaCcCd_B1"       column="ASSET_COA_CC_CD"         javaType="EZDSStringItem"/>
        <result property="assetCoaAcctCd_B1"     column="ASSET_COA_ACCT_CD"       javaType="EZDSStringItem"/>
        <result property="assetCoaProdCd_B1"     column="ASSET_COA_PROD_CD"       javaType="EZDSStringItem"/>
        <result property="assetCoaChCd_B1"       column="ASSET_COA_CH_CD"         javaType="EZDSStringItem"/>
        <result property="assetCoaAfflCd_B1"     column="ASSET_COA_AFFL_CD"        javaType="EZDSStringItem"/>
        <result property="assetCoaProjCd_B1"     column="ASSET_COA_PROJ_CD"       javaType="EZDSStringItem"/>
        <result property="assetCoaExtnCd_B1"     column="ASSET_COA_EXTN_CD"       javaType="EZDSStringItem"/>
        <result property="expCoaCmpyCd_B1"       column="EXP_COA_CMPY_CD"         javaType="EZDSStringItem"/>
        <result property="expCoaBrCd_B1"         column="EXP_COA_BR_CD"           javaType="EZDSStringItem"/>
        <result property="expCoaCcCd_B1"         column="EXP_COA_CC_CD"           javaType="EZDSStringItem"/>
        <result property="expCoaAcctCd_B1"       column="EXP_COA_ACCT_CD"         javaType="EZDSStringItem"/>
        <result property="expCoaProdCd_B1"       column="EXP_COA_PROD_CD"         javaType="EZDSStringItem"/>
        <result property="expCoaChCd_B1"         column="EXP_COA_CH_CD"           javaType="EZDSStringItem"/>
        <result property="expCoaAfflCd_B1"       column="EXP_COA_AFFL_CD"          javaType="EZDSStringItem"/>
        <result property="expCoaProjCd_B1"       column="EXP_COA_PROJ_CD"         javaType="EZDSStringItem"/>
        <result property="expCoaExtnCd_B1"       column="EXP_COA_EXTN_CD"         javaType="EZDSStringItem"/>
        <result property="procModeCd_B1"         column="PROC_MODE_CD"            javaType="EZDSStringItem"/>
        <result property="xxScrItem10Txt_B1"     column="RTRN_WH_CD"              javaType="EZDSStringItem"/>
        <result property="firstLineAddr_B1"      column="FIRST_LINE_ADDR"         javaType="EZDSStringItem"/>
        <result property="scdLineAddr_B1"        column="SCD_LINE_ADDR"           javaType="EZDSStringItem"/>
        <result property="thirdLineAddr_B1"      column="THIRD_LINE_ADDR"         javaType="EZDSStringItem"/>
        <result property="frthLineAddr_B1"       column="FRTH_LINE_ADDR"          javaType="EZDSStringItem"/>
        <result property="ctyAddr_B1"            column="CTY_ADDR"                javaType="EZDSStringItem"/>
        <result property="stCd_B1"               column="ST_CD"                   javaType="EZDSStringItem"/>
        <result property="postCd_B1"             column="POST_CD"                 javaType="EZDSStringItem"/>
        <result property="asgDtlCmntTxt_B1"      column="ASG_DTL_CMNT_TXT"        javaType="EZDSStringItem"/>
        <result property="xxScrItem10Txt_BB"     column="RTRN_WH_CD"              javaType="EZDSStringItem"/>
        <result property="firstLineAddr_BB"      column="FIRST_LINE_ADDR"         javaType="EZDSStringItem"/>
        <result property="ctyAddr_BB"            column="CTY_ADDR"                javaType="EZDSStringItem"/>
        <result property="stCd_BB"               column="ST_CD"                   javaType="EZDSStringItem"/>
        <result property="postCd_BB"             column="POST_CD"                 javaType="EZDSStringItem"/>
        <result property="asgDtlCmntTxt_BB"      column="ASG_DTL_CMNT_TXT"        javaType="EZDSStringItem"/>
        <result property="shipToCustCd_B1"       column="SHIP_TO_CUST_CD"         javaType="EZDSStringItem"/>
        <result property="svcMachMstrPk_B1"      column="SVC_MACH_MSTR_PK"        javaType="EZDSBigDecimalItem"/>
        <result property="assetCoaAcctCd_B2"     column="DEF_ASSET_COA_ACCT_CD"   javaType="EZDSStringItem"/>
        <result property="depcCoaAcctCd_B2"      column="DEF_EXP_COA_ACCT_CD"     javaType="EZDSStringItem"/>
        <result property="ezUpTime_B1"           column="EZUPTIME"                javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_B1"       column="EZUPTIMEZONE"            javaType="EZDSStringItem"/>
        <result property="assetStsCd_B1"         column="ASSET_STS_CD"            javaType="EZDSStringItem"/>
        <result property="assetTpCd_B1"          column="ASSET_TP_CD"             javaType="EZDSStringItem"/>
        <result property="coaProjCd_B1"          column="DEF_COA_PROJ_CD"         javaType="EZDSStringItem"/>
        <result property="coaProdCd_B1"          column="DEF_COA_PROD_CD"         javaType="EZDSStringItem"/>
        <result property="coaBrCd_B1"            column="DEF_ASSET_COA_BR_CD"     javaType="EZDSStringItem"/>
        <result property="coaCcCd_B1"            column="DEF_ASSET_COA_CC_CD"     javaType="EZDSStringItem"/>
        <result property="coaExtnCd_B1"          column="DEF_EXP_COA_EXTN_CD"     javaType="EZDSStringItem"/>
        <result property="coaExtnCd_B2"          column="DEF_EXP_COA_EXTN_CD"     javaType="EZDSStringItem"/>
        <result property="coaBrCd_B2"            column="DEF_EXP_COA_BR_CD"       javaType="EZDSStringItem"/>
        <result property="coaCcCd_B2"            column="DEF_EXP_COA_CC_CD"       javaType="EZDSStringItem"/>
        <result property="coaChCd_B1"            column="DEF_COA_CH_CD"           javaType="EZDSStringItem"/>
        <result property="coaAfflCd_B1"          column="DEF_COA_AFFL_CD"         javaType="EZDSStringItem"/>
        <result property="ajeCoaBrCd_B1"         column="AJE_COA_BR_CD"           javaType="EZDSStringItem"/>
        <result property="ajeCoaCcCd_B1"         column="AJE_COA_CC_CD"           javaType="EZDSStringItem"/>
        <result property="ajeCoaBuCd_B1"         column="AJE_COA_BU_CD"           javaType="EZDSStringItem"/>
        <result property="psnNum_B"              column="PSN_NUM"                 javaType="EZDSStringItem"/>
        <result property="psnNum_BB"             column="PSN_NUM"                 javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="searchFinancial" parameterClass="Map" resultMap="result.searchFinancial">
        WITH TARGET_ASSET_MSTR AS (
            SELECT
                A.*
            FROM
                 DS_ASSET_MSTR A
            WHERE
                    A.GLBL_CMPY_CD         = #glblCmpyCd#
                <iterate property="dsAssetMstrPkList" var="dsAssetMstrPkList[]" open="AND A.DS_ASSET_MSTR_PK IN (" close=")" conjunction=",">
                #dsAssetMstrPkList[]#
                </iterate>
                AND A.DS_ASSET_MSTR_PK     = A.PRNT_DS_ASSET_MSTR_PK
                AND A.EZCANCELFLAG         = '0'
        )
        ,SVC_MACH_MSTR_TMP AS (
            SELECT
                *
            FROM
                SVC_MACH_MSTR   SMM
            WHERE
                    SMM.GLBL_CMPY_CD = #glblCmpyCd#
                AND SMM.EZCANCELFLAG = '0'
                AND EXISTS(SELECT 1 FROM TARGET_ASSET_MSTR TAM WHERE TAM.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK)
        )
        SELECT
            AM.DS_ASSET_MSTR_PK
           ,AM.ASSET_TP_CD
           ,AM.ASSET_TP_DESC_TXT
           ,AM.ASSET_STS_CD
           ,AM.ASSET_STS_DESC_TXT
           ,CASE WHEN AM.ASSET_STS_CD = #assetStsRe# THEN 0
                 WHEN AM.PRNT_DS_ASSET_MSTR_PK IS NOT NULL THEN AM.INIT_BOOK_AMT
                 ELSE (SELECT SUM(DAM.INIT_BOOK_AMT) FROM DS_ASSET_MSTR DAM WHERE DAM.GLBL_CMPY_CD = AM.GLBL_CMPY_CD AND DAM.PRNT_DS_ASSET_MSTR_PK = AM.DS_ASSET_MSTR_PK AND DAM.ASSET_TP_CD = AM.ASSET_TP_CD AND DAM.EZCANCELFLAG = '0')
            END AS DS_ASSET_GRP_INIT_BOOK_AMT
           ,CASE WHEN AM.PRNT_DS_ASSET_MSTR_PK IS NOT NULL THEN AM.CUR_VAL_AMT
                 ELSE (SELECT SUM(DAM.CUR_VAL_AMT) FROM DS_ASSET_MSTR DAM WHERE DAM.GLBL_CMPY_CD = AM.GLBL_CMPY_CD AND DAM.PRNT_DS_ASSET_MSTR_PK = AM.DS_ASSET_MSTR_PK AND DAM.ASSET_TP_CD = AM.ASSET_TP_CD AND DAM.EZCANCELFLAG = '0')
            END AS CUR_VAL_AMT
           ,CASE WHEN AM.ASSET_STS_CD = #assetStsRe# THEN 0
                 WHEN AM.PRNT_DS_ASSET_MSTR_PK IS NOT NULL THEN AM.INIT_BOOK_AMT - AM.CUR_VAL_AMT
                 ELSE (SELECT NVL(SUM(DAM.INIT_BOOK_AMT) - SUM(DAM.CUR_VAL_AMT), 0) FROM DS_ASSET_MSTR DAM WHERE DAM.GLBL_CMPY_CD = AM.GLBL_CMPY_CD AND DAM.PRNT_DS_ASSET_MSTR_PK = AM.DS_ASSET_MSTR_PK AND DAM.ASSET_TP_CD = AM.ASSET_TP_CD AND DAM.EZCANCELFLAG = '0')
            END AS CALC_AMT
           ,AM.FIRST_DEPC_YR_MTH
           ,AM.LAST_DEPC_YR_MTH
           ,AM.CUR_VAL_AMT2
           ,AM.PRNT_DS_ASSET_MSTR_PK
           ,AM.FIN_DTL_CMNT_TXT
           ,AM.MAN_ENTRY_FLG
           ,AM.EZUPTIME
           ,AM.EZUPTIMEZONE
           ,AM.PROC_MODE_CD
           ,AM.SVC_CONFIG_MSTR_PK
           ,NVL((
                 SELECT
                     SUM(DAT.DEPC_VAL_AMT)
                 FROM
                     DS_ASSET_TRX  DAT
                   , DS_ASSET_MSTR DAM
                 WHERE
                         DAT.GLBL_CMPY_CD          = AM.GLBL_CMPY_CD
                     AND DAT.TRX_CD                = #deprnTrx#
                     AND DAT.TRX_RSN_CD            = #deprnTrxRsn#
                     AND DAT.ASSET_TRX_DT LIKE #slsDtYyyy# || #percent#
                     AND DAT.EZCANCELFLAG          = '0'
                     AND DAT.GLBL_CMPY_CD          = DAM.GLBL_CMPY_CD
                     AND DAT.DS_ASSET_MSTR_PK      = DAM.DS_ASSET_MSTR_PK
                     AND DAM.PRNT_DS_ASSET_MSTR_PK = AM.DS_ASSET_MSTR_PK
                     AND DAM.EZCANCELFLAG          = '0'
                 GROUP BY
                     DAM.PRNT_DS_ASSET_MSTR_PK
                ), 0) SUM_DEPC_VAL_AMT
        FROM
            (
             SELECT
                 A.GLBL_CMPY_CD
                ,A.DS_ASSET_MSTR_PK
                ,AT.ASSET_TP_CD
                ,AT.ASSET_TP_DESC_TXT
                ,ST.ASSET_STS_CD
                ,ST.ASSET_STS_DESC_TXT
                ,A.FIRST_DEPC_YR_MTH
                ,A.LAST_DEPC_YR_MTH
                ,A.INIT_BOOK_AMT
                ,A.CUR_VAL_AMT
                ,(A.DEPC_MTH_NUM - A.DEPC_CNT) AS CUR_VAL_AMT2
                ,CASE WHEN A.DS_ASSET_MSTR_PK = A.PRNT_DS_ASSET_MSTR_PK THEN NULL
                      ELSE A.PRNT_DS_ASSET_MSTR_PK
                 END AS PRNT_DS_ASSET_MSTR_PK
                ,A.FIN_DTL_CMNT_TXT
                ,A.EZUPTIME
                ,A.EZUPTIMEZONE
                ,A.MAN_ENTRY_FLG
                ,A.PROC_MODE_CD
                ,NVL(A.SVC_CONFIG_MSTR_PK, SMM.SVC_CONFIG_MSTR_PK) AS SVC_CONFIG_MSTR_PK
                ,CASE WHEN A.CPO_ORD_NUM IS NOT NULL THEN A.CPO_ORD_NUM
                      ELSE SMM.CPO_ORD_NUM
                 END AS CPO_ORD_NUM
                ,CASE WHEN A.RTRN_WH_CD IS NOT NULL                                        THEN NULL
                      WHEN SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsCRAT#, #svcMachStsRMV#) THEN NULL
                      WHEN A.SHIP_TO_CUST_ACCT_CD IS NOT NULL                              THEN A.SHIP_TO_CUST_ACCT_CD
                      ELSE SMM.CUR_LOC_ACCT_NUM
                 END AS SHIP_TO_CUST_ACCT_CD
                <isNotNull property="bizMsg.rtnWhCd_S1">
                ,CASE WHEN A.RTRN_WH_CD IS NOT NULL THEN A.RTRN_WH_CD
                      ELSE RS.RTL_WH_CD
                 END AS RTRN_WH_CD
                </isNotNull>
                <isNotNull property="bizMsg.dsAssetDescTxt_S1">
                ,CASE WHEN A.DS_ASSET_DESC_TXT IS NOT NULL THEN A.DS_ASSET_DESC_TXT
                      WHEN MN2.T_MDL_NM        IS NOT NULL THEN MN2.T_MDL_NM
                      WHEN MN.T_MDL_NM         IS NOT NULL THEN MN.T_MDL_NM
                      ELSE SUBSTR(MD.MDSE_DESC_SHORT_TXT, 1, 50)
                 END AS DS_ASSET_DESC_TXT
                </isNotNull>
                ,ROW_NUMBER() OVER(PARTITION BY A.GLBL_CMPY_CD ORDER BY A.BASE_CMPT_FLG DESC, A.DS_ASSET_MSTR_PK) AS ROW_NUM
             FROM
                 TARGET_ASSET_MSTR A
                ,ASSET_TP          AT
                ,ASSET_STS         ST
                ,SVC_MACH_MSTR_TMP SMM
                <isNotNull property="bizMsg.dsAssetDescTxt_S1">
                ,MDSE              MD
                ,SVC_CONFIG_MSTR   SCM
                ,MDL_NM            MN
                ,SVC_CONFIG_MSTR   SCM2
                ,MDL_NM            MN2
                </isNotNull>
                <isNotNull property="bizMsg.rtnWhCd_S1">
                ,RTL_SWH           RS
                </isNotNull>
                ,DS_COND_CONST     DCC
             WHERE
                 A.GLBL_CMPY_CD         = AT.GLBL_CMPY_CD
             AND A.ASSET_TP_CD          = AT.ASSET_TP_CD
             AND AT.EZCANCELFLAG        = '0'
             AND A.GLBL_CMPY_CD         = ST.GLBL_CMPY_CD
             AND A.ASSET_STS_CD         = ST.ASSET_STS_CD
             AND ST.EZCANCELFLAG        = '0'
             AND ST.GLBL_CMPY_CD        = DCC.GLBL_CMPY_CD
             AND ST.ASSET_STS_CD        = DCC.DS_COND_CONST_CD
             AND DCC.DS_COND_CONST_GRP_ID = #dsCondConstGrpId#
             AND DCC.EZCANCELFLAG       = '0'
             AND A.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD(+)
             AND A.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK(+)
             AND SMM.EZCANCELFLAG(+)    = '0'
             <isNotNull property="bizMsg.dsAssetDescTxt_S1">
             AND A.GLBL_CMPY_CD         = MD.GLBL_CMPY_CD(+)
             AND A.MDSE_CD              = MD.MDSE_CD(+)
             AND MD.EZCANCELFLAG(+)     = '0'
             AND SMM.GLBL_CMPY_CD       = SCM.GLBL_CMPY_CD(+)
             AND SMM.SVC_CONFIG_MSTR_PK = SCM.SVC_CONFIG_MSTR_PK(+)
             AND SCM.EZCANCELFLAG(+)    = '0'
             AND SCM.GLBL_CMPY_CD       = MN.T_GLBL_CMPY_CD(+)
             AND SCM.MDL_ID             = MN.T_MDL_ID(+)
             AND MN.EZCANCELFLAG(+)     = '0'
             AND A.GLBL_CMPY_CD         = SCM2.GLBL_CMPY_CD(+)
             AND A.SVC_CONFIG_MSTR_PK   = SCM2.SVC_CONFIG_MSTR_PK(+)
             AND SCM2.EZCANCELFLAG(+)   = '0'
             AND SCM2.GLBL_CMPY_CD      = MN2.T_GLBL_CMPY_CD(+)
             AND SCM2.MDL_ID            = MN2.T_MDL_ID(+)
             AND MN2.EZCANCELFLAG(+)    = '0'
             </isNotNull>
             <isNotNull property="bizMsg.rtnWhCd_S1">
             AND SMM.GLBL_CMPY_CD       = RS.GLBL_CMPY_CD(+)
             AND SMM.CUR_LOC_NUM        = RS.INVTY_LOC_CD(+)
             AND RS.EZCANCELFLAG(+)     = '0'
             </isNotNull>
            ) AM
        WHERE
            ROW_NUM             &lt;= #rowNum#
        <isNotNull property="bizMsg.svcConfigMstrPk_S1">
        AND AM.SVC_CONFIG_MSTR_PK   = #bizMsg.svcConfigMstrPk_S1#
        </isNotNull>
        <isNotNull property="bizMsg.cpoOrdNum_S1">
        AND EXISTS(
            SELECT NULL
            FROM (
                SELECT
                    A2.CPO_ORD_NUM AS ASSET_CPO_ORD_NUM
                    ,SMM.CPO_ORD_NUM AS MACH_CPO_ORD_NUM
                FROM DS_ASSET_MSTR A2
                    ,SVC_MACH_MSTR SMM
                WHERE
                    A2.GLBL_CMPY_CD            = AM.GLBL_CMPY_CD
                AND A2.PRNT_DS_ASSET_MSTR_PK   = AM.DS_ASSET_MSTR_PK
                AND A2.EZCANCELFLAG            = '0'
                AND SMM.GLBL_CMPY_CD(+)        = A2.GLBL_CMPY_CD
                AND SMM.SVC_MACH_MSTR_PK(+)    = A2.SVC_MACH_MSTR_PK
                AND SMM.EZCANCELFLAG(+)        = '0'
            )
            WHERE (
                ASSET_CPO_ORD_NUM          = #bizMsg.cpoOrdNum_S1#
                OR MACH_CPO_ORD_NUM        = #bizMsg.cpoOrdNum_S1#
            )
        )
        </isNotNull>
        <isNotNull property="bizMsg.rtnWhCd_S1">
        AND AM.RTRN_WH_CD           = #bizMsg.rtnWhCd_S1#
        </isNotNull>
        <isNotNull property="bizMsg.shipToCustAcctCd_S1">
        AND AM.SHIP_TO_CUST_ACCT_CD = #bizMsg.shipToCustAcctCd_S1#
        </isNotNull>
        <isNotNull property="bizMsg.dsAssetDescTxt_S1">
        AND UPPER ( AM.DS_ASSET_DESC_TXT ) LIKE #bizMsg.dsAssetDescTxt_S1#
        </isNotNull>

    </statement>

    <resultMap id="result.searchFinancial" class="NLEL0060_CSMsg">
        <result property="dsAssetMstrPk_C1"          column="DS_ASSET_MSTR_PK"             javaType="EZDSBigDecimalItem"/>
        <result property="assetTpDescTxt_C1"         column="ASSET_TP_DESC_TXT"            javaType="EZDSStringItem"/>
        <result property="assetStsCd_C1"             column="ASSET_STS_CD"                 javaType="EZDSStringItem"/>
        <result property="assetStsDescTxt_C1"        column="ASSET_STS_DESC_TXT"           javaType="EZDSStringItem"/>
        <result property="dsAssetGrpInitBookAmt_C1"  column="DS_ASSET_GRP_INIT_BOOK_AMT"   javaType="EZDSBigDecimalItem"/>
        <result property="curValAmt_C1"              column="CUR_VAL_AMT"                  javaType="EZDSBigDecimalItem"/>
        <result property="xxRteActlFrtAmt_C1"        column="CALC_AMT"                     javaType="EZDSStringItem"/>
        <result property="xxTotPrcAmt_C1"            column="SUM_DEPC_VAL_AMT"             javaType="EZDSBigDecimalItem"/>
        <result property="lastDepcYrMth_C1"          column="LAST_DEPC_YR_MTH"             javaType="EZDSDateItem"/>
        <result property="curValAmt_C2"              column="CUR_VAL_AMT2"                 javaType="EZDSBigDecimalItem"/>
        <result property="prntDsAssetMstrPk_C1"      column="PRNT_DS_ASSET_MSTR_PK"        javaType="EZDSBigDecimalItem"/>
        <result property="finDtlCmntTxt_C1"          column="FIN_DTL_CMNT_TXT"             javaType="EZDSStringItem"/>
        <result property="manEntryFlg_C1"            column="MAN_ENTRY_FLG"                javaType="EZDSStringItem"/>
        <result property="procModeCd_C1"             column="PROC_MODE_CD"                 javaType="EZDSStringItem"/>
        <result property="curValAmt_CC"              column="CUR_VAL_AMT"                  javaType="EZDSBigDecimalItem"/>
        <result property="curValAmt_CB"              column="CUR_VAL_AMT2"                 javaType="EZDSBigDecimalItem"/>
        <result property="finDtlCmntTxt_CB"          column="FIN_DTL_CMNT_TXT"             javaType="EZDSStringItem"/>
        <result property="prntDsAssetMstrPk_CB"      column="PRNT_DS_ASSET_MSTR_PK"        javaType="EZDSBigDecimalItem"/>
        <result property="ezUpTime_C1"               column="EZUPTIME"                     javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_C1"           column="EZUPTIMEZONE"                 javaType="EZDSStringItem"/>
        <result property="svcConfigMstrPk_C1"        column="SVC_CONFIG_MSTR_PK"           javaType="EZDSBigDecimalItem"/>
    </resultMap>

    <statement id="searchTransaction" parameterClass="Map" resultMap="result.searchTransaction">
        WITH TARGET_ASSET_MSTR AS (
            SELECT
                A.*
            FROM
                 DS_ASSET_MSTR A
                <isEqual property="sellToCustSearchFlag" compareValue="Y">
                ,SELL_TO_CUST  STC3
                </isEqual>
                <isNotNull property="depcCoaAcctCdFlg">
                ,ASSET_BOOK_CTRL BC
                </isNotNull>
            WHERE
                    A.GLBL_CMPY_CD         = #glblCmpyCd#
                AND A.DS_ASSET_MSTR_PK     = A.PRNT_DS_ASSET_MSTR_PK
                AND A.EZCANCELFLAG         = '0'
                <isEqual property="sellToCustSearchFlag" compareValue="Y">
                AND A.GLBL_CMPY_CD         = STC3.GLBL_CMPY_CD(+)
                AND A.SELL_TO_CUST_CD      = STC3.SELL_TO_CUST_CD(+)
                AND STC3.EZCANCELFLAG(+)   = '0'
                </isEqual>
                <isNotNull property="depcCoaAcctCdFlg">
                AND A.GLBL_CMPY_CD         = BC.GLBL_CMPY_CD
                AND A.ASSET_TP_CD          = BC.ASSET_TP_CD
                AND BC.EFF_FROM_DT     &lt;= #slsDt#
                AND (
                        BC.EFF_THRU_DT &gt;= #slsDt#
                     OR BC.EFF_THRU_DT IS NULL
                )
                AND BC.EZCANCELFLAG = '0'
                </isNotNull>
                <isNotNull property="bizMsg.dsAssetMstrPk_S1">
                AND A.DS_ASSET_MSTR_PK     = #bizMsg.dsAssetMstrPk_S1#
                </isNotNull>
                <isNotNull property="bizMsg.assetTpCd_S1">
                AND A.ASSET_TP_CD          = #bizMsg.assetTpCd_S1#
                </isNotNull>
                <isNotNull property="bizMsg.depcStartDt_S1">
                AND A.DEPC_START_DT    &gt;= #bizMsg.depcStartDt_S1#
                </isNotNull>
                <isNotNull property="bizMsg.depcStartDt_S2">
                AND A.DEPC_START_DT    &lt;= #bizMsg.depcStartDt_S2#
                </isNotNull>
                <isNotNull property="bizMsg.serNum_S1">
                AND EXISTS(
                    SELECT NULL
                    FROM DS_ASSET_MSTR A2
                    WHERE
                        A2.GLBL_CMPY_CD             = A.GLBL_CMPY_CD
                    AND A2.PRNT_DS_ASSET_MSTR_PK    = A.DS_ASSET_MSTR_PK
                    AND A2.SER_NUM                  = #bizMsg.serNum_S1#
                    AND A2.EZCANCELFLAG             = '0'
                )
                </isNotNull>
                <isNotNull property="bizMsg.mdseCd_S1">
                AND EXISTS(
                    SELECT NULL
                    FROM DS_ASSET_MSTR A2
                    WHERE
                        A2.GLBL_CMPY_CD             = A.GLBL_CMPY_CD
                    AND A2.PRNT_DS_ASSET_MSTR_PK    = A.DS_ASSET_MSTR_PK
                    AND A2.MDSE_CD                  = #bizMsg.mdseCd_S1#
                    AND A2.EZCANCELFLAG             = '0'
                )
                </isNotNull>
                <isNotNull property="bizMsg.assetStsCd_S1">
                AND A.ASSET_STS_CD         = #bizMsg.assetStsCd_S1#
                </isNotNull>
                <isNotNull property="bizMsg.assetTagNum_S1">
                AND A.ASSET_TAG_NUM        = #bizMsg.assetTagNum_S1#
                </isNotNull>
                <isNotNull property="bizMsg.custIssPoNum_S1">
                AND (
                              A.PO_ORD_NUM              = #bizMsg.custIssPoNum_S1#
                    OR UPPER( A.CUST_ISS_PO_NUM )       = UPPER(#bizMsg.custIssPoNum_S1#) <!-- 2019/03/28 QC#30758 Add 'UPPER' to the parameter -->
                )
                </isNotNull>
                <isNotNull property="bizMsg.vndCd_S1">
                AND A.VND_CD               = #bizMsg.vndCd_S1#
                </isNotNull>
                <isNotNull property="bizMsg.dsAssetDescTxt_S1">
                AND (
                    UPPER( A.DS_ASSET_DESC_TXT ) LIKE #bizMsg.dsAssetDescTxt_S1#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                            MDSE MD
                        WHERE
                                A.GLBL_CMPY_CD                     = MD.GLBL_CMPY_CD
                            AND A.MDSE_CD                          = MD.MDSE_CD
                            AND MD.EZCANCELFLAG                    =  '0'
                            AND UPPER( MD.MDSE_DESC_SHORT_TXT ) LIKE #bizMsg.dsAssetDescTxt_S1#
                    )
                     OR EXISTS(
                         SELECT
                             1
                         FROM
                              SVC_MACH_MSTR   SMM
                             ,SVC_CONFIG_MSTR SCM
                             ,MDL_NM          MN
                         WHERE
                                 A.GLBL_CMPY_CD            = SMM.GLBL_CMPY_CD
                             AND A.SVC_MACH_MSTR_PK        = SMM.SVC_MACH_MSTR_PK
                             AND SMM.EZCANCELFLAG          = '0'
                             AND SMM.GLBL_CMPY_CD          = SCM.GLBL_CMPY_CD
                             AND SMM.SVC_CONFIG_MSTR_PK    = SCM.SVC_CONFIG_MSTR_PK
                             AND SCM.EZCANCELFLAG          = '0'
                             AND SCM.GLBL_CMPY_CD          = MN.T_GLBL_CMPY_CD
                             AND SCM.MDL_ID                = MN.T_MDL_ID
                             AND MN.EZCANCELFLAG           = '0'
                             AND UPPER( MN.T_MDL_NM )   LIKE #bizMsg.dsAssetDescTxt_S1#
                     )
                     OR EXISTS(
                         SELECT
                             1
                         FROM
                              SVC_CONFIG_MSTR SCM2
                             ,MDL_NM          MN2
                         WHERE
                                  A.GLBL_CMPY_CD          = SCM2.GLBL_CMPY_CD(+)
                              AND A.SVC_CONFIG_MSTR_PK    = SCM2.SVC_CONFIG_MSTR_PK(+)
                              AND SCM2.EZCANCELFLAG(+)    = '0'
                              AND SCM2.GLBL_CMPY_CD       = MN2.T_GLBL_CMPY_CD(+)
                              AND SCM2.MDL_ID             = MN2.T_MDL_ID(+)
                              AND MN2.EZCANCELFLAG(+)     = '0'
                             AND UPPER( MN2.T_MDL_NM ) LIKE #bizMsg.dsAssetDescTxt_S1#
                     )
                )
                </isNotNull>
                <isNotNull property="bizMsg.svcConfigMstrPk_S1">
                AND (
                    A.SVC_CONFIG_MSTR_PK = #bizMsg.svcConfigMstrPk_S1#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                             SVC_MACH_MSTR   SMM
                        WHERE
                               A.GLBL_CMPY_CD      = SMM.GLBL_CMPY_CD
                            AND A.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                            AND SMM.EZCANCELFLAG   = '0'
                            AND SMM.SVC_CONFIG_MSTR_PK = #bizMsg.svcConfigMstrPk_S1#
                    )
                )
                </isNotNull>
                <isNotNull property="bizMsg.cpoOrdNum_S1">
                AND EXISTS(
                    SELECT NULL
                    FROM (
                        SELECT
                            A2.CPO_ORD_NUM AS ASSET_CPO_ORD_NUM
                            ,SMM.CPO_ORD_NUM AS MACH_CPO_ORD_NUM
                        FROM DS_ASSET_MSTR A2
                            ,SVC_MACH_MSTR SMM
                        WHERE
                            A2.GLBL_CMPY_CD            = A.GLBL_CMPY_CD
                        AND A2.PRNT_DS_ASSET_MSTR_PK   = A.DS_ASSET_MSTR_PK
                        AND A2.EZCANCELFLAG            = '0'
                        AND SMM.GLBL_CMPY_CD(+)        = A2.GLBL_CMPY_CD
                        AND SMM.SVC_MACH_MSTR_PK(+)    = A2.SVC_MACH_MSTR_PK
                        AND SMM.EZCANCELFLAG(+)        = '0'
                    )
                    WHERE (
                        ASSET_CPO_ORD_NUM          = #bizMsg.cpoOrdNum_S1#
                        OR MACH_CPO_ORD_NUM        = #bizMsg.cpoOrdNum_S1#
                    )
                )
                </isNotNull>
                <isNotNull property="bizMsg.xxChkBox_H1">
                <isNull property="bizMsg.xxChkBox_H2">
                AND (
                    (
                            A.RTRN_WH_CD       IS NULL
                        AND A.SVC_MACH_MSTR_PK IS NULL
                    )
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                             SVC_MACH_MSTR   SMM
                        WHERE
                                A.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
                            AND A.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                            AND SMM.EZCANCELFLAG   = '0'
                            AND SMM.SVC_MACH_MSTR_STS_CD NOT IN (#svcMachStsCRAT#, #svcMachStsRMV#)
                    )
                )
                </isNull>
                </isNotNull>
                <isNotNull property="bizMsg.xxChkBox_H2">
                <isNull property="bizMsg.xxChkBox_H1">
                AND (
                    (
                        A.RTRN_WH_CD IS NOT NULL
                    )
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                             SVC_MACH_MSTR   SMM
                        WHERE
                                A.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
                            AND A.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                            AND SMM.EZCANCELFLAG   = '0'
                            AND SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsCRAT#, #svcMachStsRMV#)
                    )
                )
                </isNull>
                </isNotNull>
                <isNotNull property="bizMsg.rtnWhCd_S1">
                AND (
                    A.RTRN_WH_CD = #bizMsg.rtnWhCd_S1#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                             SVC_MACH_MSTR   SMM
                            ,RTL_SWH         RS
                        WHERE
                                A.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD
                            AND A.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK
                            AND SMM.EZCANCELFLAG       = '0'
                            AND SMM.GLBL_CMPY_CD       = RS.GLBL_CMPY_CD
                            AND SMM.CUR_LOC_NUM        = RS.INVTY_LOC_CD
                            AND RS.RTL_WH_CD           = #bizMsg.rtnWhCd_S1#
                            AND RS.EZCANCELFLAG        = '0'
                    )
                )
                </isNotNull>
                <isNotNull property="bizMsg.shipToCustAcctCd_S1">
                AND (
                         A.SHIP_TO_CUST_ACCT_CD = #bizMsg.shipToCustAcctCd_S1#
                    OR EXISTS(
                        SELECT
                            1
                        FROM
                             SVC_MACH_MSTR   SMM
                        WHERE
                                A.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
                            AND A.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                            AND SMM.EZCANCELFLAG   = '0'
                            AND SMM.CUR_LOC_ACCT_NUM = #bizMsg.shipToCustAcctCd_S1#
                    )
                )
                </isNotNull>
                <isNotNull property        = "bizMsg.depcCoaAcctCd_S1">
                AND (CASE WHEN A.PROC_MODE_CD        = #procMode# AND A.EXP_COA_ACCT_CD IS NULL THEN STC3.COA_ACCT_CD
                          WHEN A.PROC_MODE_CD &lt;&gt; #procMode# AND A.EXP_COA_ACCT_CD IS NULL THEN BC.DEPC_COA_ACCT_CD ELSE A.EXP_COA_ACCT_CD END ) &gt;= #bizMsg.depcCoaAcctCd_S1#
                </isNotNull>
                <isNotNull property        = "bizMsg.depcCoaAcctCd_S2">
                AND (CASE WHEN A.PROC_MODE_CD        = #procMode# AND A.EXP_COA_ACCT_CD IS NULL THEN STC3.COA_ACCT_CD
                          WHEN A.PROC_MODE_CD &lt;&gt; #procMode# AND A.EXP_COA_ACCT_CD IS NULL THEN BC.DEPC_COA_ACCT_CD ELSE A.EXP_COA_ACCT_CD END ) &lt;= #bizMsg.depcCoaAcctCd_S2#
                </isNotNull>
                <isNotNull property        = "bizMsg.expCoaBrCd_S1">
                AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_BR_CD IS NULL THEN STC3.COA_BR_CD ELSE A.EXP_COA_BR_CD END ) &gt;= #bizMsg.expCoaBrCd_S1#
                </isNotNull>
                <isNotNull property        = "bizMsg.expCoaBrCd_S2">
                AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_BR_CD IS NULL THEN STC3.COA_BR_CD ELSE A.EXP_COA_BR_CD END ) &lt;= #bizMsg.expCoaBrCd_S2#
                </isNotNull>
                <isNotNull property        = "bizMsg.expCoaCcCd_S1">
                AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_CC_CD IS NULL THEN STC3.COA_CC_CD ELSE A.EXP_COA_CC_CD END ) &gt;= #bizMsg.expCoaCcCd_S1#
                </isNotNull>
                <isNotNull property        = "bizMsg.expCoaCcCd_S2">
                AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_CC_CD IS NULL THEN STC3.COA_CC_CD ELSE A.EXP_COA_CC_CD END ) &lt;= #bizMsg.expCoaCcCd_S2#
                </isNotNull>
                <isNotNull property        = "bizMsg.expCoaExtnCd_S1">
                AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_EXTN_CD IS NULL THEN STC3.COA_EXTN_CD ELSE A.EXP_COA_EXTN_CD END ) &gt;= #bizMsg.expCoaExtnCd_S1#
                </isNotNull>
                <isNotNull property        = "bizMsg.expCoaExtnCd_S2">
                AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_EXTN_CD IS NULL THEN STC3.COA_EXTN_CD ELSE A.EXP_COA_EXTN_CD END ) &lt;= #bizMsg.expCoaExtnCd_S2#
                </isNotNull>
        )
        SELECT
            PRNT_DS_ASSET_MSTR_PK
           ,ASSET_TP_DESC_TXT
           ,TRX_RSN_NM
           ,ASSET_TRX_DT
           ,DEPC_VAL_AMT
           ,COA_ACCT_NM1
           ,TXT1
           ,COA_ACCT_NM2
           ,TXT2
           ,FIN_DTL_CMNT_TXT
           ,CNT
           ,EZTIME
        FROM
            (
             SELECT
                 AM.DS_ASSET_MSTR_PK  AS PRNT_DS_ASSET_MSTR_PK
                ,AM.ASSET_TP_DESC_TXT
                ,AM.TRX_RSN_NM
                ,AM.ASSET_TRX_DT
                ,SUM(AM.DEPC_VAL_AMT) AS DEPC_VAL_AMT
                ,AM.COA_ACCT_NM1
                ,AM.TXT1
                ,AM.COA_ACCT_NM2
                ,AM.TXT2
                ,AM.FIN_DTL_CMNT_TXT
                ,AM.CNT
                ,AM.EZTIME
             FROM
                 (
                  SELECT
                      A.GLBL_CMPY_CD
                     ,A.DS_ASSET_MSTR_PK
                     ,AT.ASSET_TP_CD
                     ,AT.ASSET_TP_DESC_TXT
                     ,TR.TRX_RSN_NM
                     ,ATX.ASSET_TRX_DT
                     ,CASE WHEN JE.JRNL_ENTRY_PK IS NOT NULL THEN JE.JRNL_DEAL_DR_AMT
                           WHEN ATX.TRX_CD = #trxCdIsRentalShip# AND ATX.TRX_RSN_CD = #trxRsnCdIsRentalAssetImport#      THEN ATX.INIT_BOOK_AMT
                           WHEN ATX.TRX_CD = #trxCdIsRentalShip# AND ATX.TRX_RSN_CD = #trxRsnCdIsRentalManualAsset#      THEN ATX.INIT_BOOK_AMT
                           WHEN ATX.TRX_CD = #trxCdIsEMSDShip#   AND ATX.TRX_RSN_CD = #trxRsnCdIsEMSDAssetImport#        THEN ATX.INIT_BOOK_AMT
                           WHEN ATX.TRX_CD = #trxCdIsEMSDShip#   AND ATX.TRX_RSN_CD = #trxRsnCdIsEMSDManualAsset#        THEN ATX.INIT_BOOK_AMT
                           WHEN ATX.TRX_CD = #trxCdIsAdjustment# AND ATX.TRX_RSN_CD = #trxRsnCdIsAssetInitialCostChange# THEN ATX.INIT_BOOK_AMT
                           ELSE ATX.DEPC_VAL_AMT
                      END AS DEPC_VAL_AMT
                     ,CA1.COA_ACCT_NM AS COA_ACCT_NM1
                     ,CASE WHEN JE.JRNL_ENTRY_PK IS NOT NULL THEN JE.DR_COA_CMPY_CD || '.' || JE.DR_COA_BR_CD || '.' || JE.DR_COA_CC_CD || '.' || JE.DR_COA_ACCT_CD  || '.' || JE.DR_COA_PROD_CD || '.' || JE.DR_COA_CH_CD || '.' || JE.DR_COA_AFFL_CD || '.' || JE.DR_COA_PROJ_CD || '.' || JE.DR_COA_EXTN_CD
                           ELSE ''
                      END AS TXT1
                     ,CA2.COA_ACCT_NM AS COA_ACCT_NM2
                     ,CASE WHEN JE.JRNL_ENTRY_PK IS NOT NULL THEN JE.CR_COA_CMPY_CD || '.' || JE.CR_COA_BR_CD || '.' || JE.CR_COA_CC_CD || '.' || JE.CR_COA_ACCT_CD  || '.' || JE.CR_COA_PROD_CD || '.' || JE.CR_COA_CH_CD || '.' || JE.CR_COA_AFFL_CD || '.' || JE.CR_COA_PROJ_CD || '.' || JE.CR_COA_EXTN_CD
                           ELSE ''
                      END AS TXT2
                     ,A.FIN_DTL_CMNT_TXT
                     ,(NVL(ATX.DEPC_MTH_NUM, 0) - NVL(ATX.DEPC_CNT, 0)) AS CNT
                     ,CASE WHEN (ATX.TRX_CD = #trxCdIsAdjustment# AND ATX.TRX_RSN_CD = #trxRsnCdIsAssetInitialCostChange#) OR (ATX.TRX_CD = #trxCdIsDep# AND ATX.TRX_RSN_CD = #trxRsnCdIsDep#) THEN ATX.EZINTIME
                           ELSE NULL
                      END AS EZTIME
                     ,NVL(A.SVC_CONFIG_MSTR_PK, SMM.SVC_CONFIG_MSTR_PK) AS SVC_CONFIG_MSTR_PK
                     ,CASE WHEN A.CPO_ORD_NUM IS NOT NULL THEN A.CPO_ORD_NUM
                           ELSE SMM.CPO_ORD_NUM
                      END AS CPO_ORD_NUM
                     ,CASE WHEN A.RTRN_WH_CD IS NOT NULL                                        THEN NULL
                           WHEN SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsCRAT#, #svcMachStsRMV#) THEN NULL
                           WHEN A.SHIP_TO_CUST_ACCT_CD IS NOT NULL                              THEN A.SHIP_TO_CUST_ACCT_CD
                           ELSE SMM.CUR_LOC_ACCT_NUM
                      END AS SHIP_TO_CUST_ACCT_CD
                     <isNotNull property="bizMsg.rtnWhCd_S1">
                     ,CASE WHEN A.RTRN_WH_CD IS NOT NULL THEN A.RTRN_WH_CD
                           ELSE RS.RTL_WH_CD
                      END AS RTRN_WH_CD
                     </isNotNull>
                     <isNotNull property="bizMsg.dsAssetDescTxt_S1">
                     ,CASE WHEN A.DS_ASSET_DESC_TXT IS NOT NULL THEN A.DS_ASSET_DESC_TXT
                           WHEN MN2.T_MDL_NM        IS NOT NULL THEN MN2.T_MDL_NM
                           WHEN MN.T_MDL_NM         IS NOT NULL THEN MN.T_MDL_NM
                           ELSE SUBSTR(MD.MDSE_DESC_SHORT_TXT, 1, 50)
                      END AS DS_ASSET_DESC_TXT
                     </isNotNull>
                  FROM
                      TARGET_ASSET_MSTR A
                     ,DS_ASSET_MSTR     AC
                     ,DS_ASSET_TRX      ATX
                     ,TRX_RSN           TR
                     ,JRNL_ENTRY        JE
                     ,COA_ACCT          CA1
                     ,COA_ACCT          CA2
                     ,ASSET_TP          AT
                     ,SVC_MACH_MSTR     SMM
                     <isNotNull property="bizMsg.dsAssetDescTxt_S1">
                     ,MDSE              MD
                     ,SVC_CONFIG_MSTR   SCM
                     ,MDL_NM            MN
                     ,SVC_CONFIG_MSTR   SCM2
                     ,MDL_NM            MN2
                     </isNotNull>
                     <isNotNull property="bizMsg.rtnWhCd_S1">
                     ,RTL_SWH           RS
                     </isNotNull>
                     ,DS_COND_CONST     DCC
                  WHERE
                      A.GLBL_CMPY_CD               = DCC.GLBL_CMPY_CD
                  AND A.ASSET_STS_CD               = DCC.DS_COND_CONST_CD
                  AND DCC.DS_COND_CONST_GRP_ID     = #dsCondConstGrpId#
                  AND DCC.EZCANCELFLAG             = '0'
                  AND A.GLBL_CMPY_CD               = AT.GLBL_CMPY_CD
                  AND A.ASSET_TP_CD                = AT.ASSET_TP_CD
                  AND AT.EZCANCELFLAG              = '0'
                  AND A.GLBL_CMPY_CD               = AC.GLBL_CMPY_CD
                  AND A.DS_ASSET_MSTR_PK           = AC.PRNT_DS_ASSET_MSTR_PK
                  AND AC.EZCANCELFLAG              = '0'
                  AND AC.GLBL_CMPY_CD              = ATX.GLBL_CMPY_CD
                  AND AC.DS_ASSET_MSTR_PK          = ATX.DS_ASSET_MSTR_PK
                  AND ATX.EZCANCELFLAG             = '0'
                  AND ATX.GLBL_CMPY_CD             = TR.GLBL_CMPY_CD
                  AND ATX.TRX_CD                   = TR.TRX_CD
                  AND ATX.TRX_RSN_CD               = TR.TRX_RSN_CD
                  AND TR.EZCANCELFLAG              = '0'
                  AND ATX.GLBL_CMPY_CD             = JE.GLBL_CMPY_CD(+)
                  AND TO_CHAR(ATX.DS_ASSET_TRX_PK) = JE.JRNL_ENTRY_FIFTH_REF_TXT(+)
                  AND JE.AJE_INTFC_TP_CD(+)        = #ajeIntfcTpAssetTrx#
                  AND JE.EZCANCELFLAG(+)           = '0'
                  AND JE.GLBL_CMPY_CD              = CA1.GLBL_CMPY_CD(+)
                  AND JE.DR_COA_ACCT_CD            = CA1.COA_ACCT_CD(+)
                  AND CA1.EZCANCELFLAG(+)          = '0'
                  AND JE.GLBL_CMPY_CD              = CA2.GLBL_CMPY_CD(+)
                  AND JE.CR_COA_ACCT_CD            = CA2.COA_ACCT_CD(+)
                  AND CA2.EZCANCELFLAG(+)          = '0'
                  AND A.GLBL_CMPY_CD               = SMM.GLBL_CMPY_CD(+)
                  AND A.SVC_MACH_MSTR_PK           = SMM.SVC_MACH_MSTR_PK(+)
                  AND SMM.EZCANCELFLAG(+)          = '0'
                  <isNotNull property="bizMsg.dsAssetDescTxt_S1">
                  AND A.GLBL_CMPY_CD               = MD.GLBL_CMPY_CD(+)
                  AND A.MDSE_CD                    = MD.MDSE_CD(+)
                  AND MD.EZCANCELFLAG(+)           = '0'
                  AND SMM.GLBL_CMPY_CD             = SCM.GLBL_CMPY_CD(+)
                  AND SMM.SVC_CONFIG_MSTR_PK       = SCM.SVC_CONFIG_MSTR_PK(+)
                  AND SCM.EZCANCELFLAG(+)          = '0'
                  AND SCM.GLBL_CMPY_CD             = MN.T_GLBL_CMPY_CD(+)
                  AND SCM.MDL_ID                   = MN.T_MDL_ID(+)
                  AND MN.EZCANCELFLAG(+)           = '0'
                  AND A.GLBL_CMPY_CD               = SCM2.GLBL_CMPY_CD(+)
                  AND A.SVC_CONFIG_MSTR_PK         = SCM2.SVC_CONFIG_MSTR_PK(+)
                  AND SCM2.EZCANCELFLAG(+)         = '0'
                  AND SCM2.GLBL_CMPY_CD            = MN2.T_GLBL_CMPY_CD(+)
                  AND SCM2.MDL_ID                  = MN2.T_MDL_ID(+)
                  AND MN2.EZCANCELFLAG(+)          = '0'
                  </isNotNull>
                  <isNotNull property="bizMsg.rtnWhCd_S1">
                  AND SMM.GLBL_CMPY_CD             = RS.GLBL_CMPY_CD(+)
                  AND SMM.CUR_LOC_NUM              = RS.INVTY_LOC_CD(+)
                  AND RS.EZCANCELFLAG(+)           = '0'
                  </isNotNull>
                 ) AM
             WHERE
                 1                       = 1
             <isNotNull property="bizMsg.svcConfigMstrPk_S1">
             AND AM.SVC_CONFIG_MSTR_PK   = #bizMsg.svcConfigMstrPk_S1#
             </isNotNull>
             <isNotNull property="bizMsg.cpoOrdNum_S1">
             AND EXISTS(
                 SELECT NULL
                 FROM (
                     SELECT
                         A2.CPO_ORD_NUM AS ASSET_CPO_ORD_NUM
                         ,SMM.CPO_ORD_NUM AS MACH_CPO_ORD_NUM
                     FROM DS_ASSET_MSTR A2
                         ,SVC_MACH_MSTR SMM
                     WHERE
                         A2.GLBL_CMPY_CD            = AM.GLBL_CMPY_CD
                     AND A2.PRNT_DS_ASSET_MSTR_PK   = AM.DS_ASSET_MSTR_PK
                     AND A2.EZCANCELFLAG            = '0'
                     AND SMM.GLBL_CMPY_CD(+)        = A2.GLBL_CMPY_CD
                     AND SMM.SVC_MACH_MSTR_PK(+)    = A2.SVC_MACH_MSTR_PK
                     AND SMM.EZCANCELFLAG(+)        = '0'
                 )
                 WHERE (
                     ASSET_CPO_ORD_NUM          = #bizMsg.cpoOrdNum_S1#
                     OR MACH_CPO_ORD_NUM        = #bizMsg.cpoOrdNum_S1#
                 )
             )
             </isNotNull>
             <isNotNull property="bizMsg.rtnWhCd_S1">
             AND AM.RTRN_WH_CD           = #bizMsg.rtnWhCd_S1#
             </isNotNull>
             <isNotNull property="bizMsg.shipToCustAcctCd_S1">
             AND AM.SHIP_TO_CUST_ACCT_CD = #bizMsg.shipToCustAcctCd_S1#
             </isNotNull>
             <isNotNull property="bizMsg.dsAssetDescTxt_S1">
             AND UPPER ( AM.DS_ASSET_DESC_TXT ) LIKE #bizMsg.dsAssetDescTxt_S1#
             </isNotNull>
             GROUP BY
                 AM.DS_ASSET_MSTR_PK
                ,AM.ASSET_TP_DESC_TXT
                ,AM.TRX_RSN_NM
                ,AM.ASSET_TRX_DT
                ,AM.COA_ACCT_NM1
                ,AM.TXT1
                ,AM.COA_ACCT_NM2
                ,AM.TXT2
                ,AM.FIN_DTL_CMNT_TXT
                ,AM.CNT
                ,AM.EZTIME
             ORDER BY
                 AM.DS_ASSET_MSTR_PK
                ,AM.ASSET_TRX_DT     DESC
                ,AM.EZTIME           DESC
                ,AM.TRX_RSN_NM
            )
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>

    <resultMap id="result.searchTransaction" class="NLEL0060_DSMsg">
        <result property="prntDsAssetMstrPk_D1"  column="PRNT_DS_ASSET_MSTR_PK"  javaType="EZDSBigDecimalItem"/>
        <result property="assetTpDescTxt_D1"     column="ASSET_TP_DESC_TXT"      javaType="EZDSStringItem"/>
        <result property="trxRsnNm_D1"           column="TRX_RSN_NM"             javaType="EZDSStringItem"/>
        <result property="assetTrxDt_D1"         column="ASSET_TRX_DT"           javaType="EZDSDateItem"/>
        <result property="depcValAmt_D1"         column="DEPC_VAL_AMT"           javaType="EZDSBigDecimalItem"/>
        <result property="coaAcctNm_D1"          column="COA_ACCT_NM1"           javaType="EZDSStringItem"/>
        <result property="xxScrItem50Txt_D1"     column="TXT1"                   javaType="EZDSStringItem"/>
        <result property="coaAcctNm_D2"          column="COA_ACCT_NM2"           javaType="EZDSStringItem"/>
        <result property="xxScrItem50Txt_D2"     column="TXT2"                   javaType="EZDSStringItem"/>
        <result property="finDtlCmntTxt_D1"      column="FIN_DTL_CMNT_TXT"       javaType="EZDSStringItem"/>
        <result property="depcMthNum_D1"         column="CNT"                    javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="searchDepSim" parameterClass="Map" resultMap="result.searchDepSim">
        SELECT
              PRNT_DS_ASSET_MSTR_PK
            , ASSET_TP_NM
            , ASSET_TRX_DT
            , DEPC_VAL_AMT1
            , DR_COA_ACCT_CD
            , DEPC_VAL_AMT2
            , CR_COA_ACCT_CD
        FROM
            (
                SELECT
                      ADS.PRNT_DS_ASSET_MSTR_PK
                    , AT.ASSET_TP_NM
                    , ADS.ASSET_TRX_DT
                    , SUM(ADS.DEPC_VAL_AMT) AS DEPC_VAL_AMT1
                    , MAX(DR_COA_ACCT_CD)   AS DR_COA_ACCT_CD
                    , SUM(ADS.DEPC_VAL_AMT) AS DEPC_VAL_AMT2
                    , MAX(CR_COA_ACCT_CD)   AS CR_COA_ACCT_CD
                FROM
                      DS_ASSET_DEPC_SMLTN ADS
                    , ASSET_TP            AT
                    ,(
                        SELECT
                              SMLTN.DEPC_SMLTN_RQST_DT_TM_TS
                            , SMLTN.PRNT_DS_ASSET_MSTR_PK
                            , SMLTN.ASSET_TRX_DT
                            , ROW_NUMBER() OVER(PARTITION BY SMLTN.PRNT_DS_ASSET_MSTR_PK ORDER BY SMLTN.DEPC_SMLTN_RQST_DT_TM_TS DESC) AS CNT
                        FROM
                            DS_ASSET_DEPC_SMLTN SMLTN
                        WHERE
                                SMLTN.GLBL_CMPY_CD = #glblCmpyCd#
                            AND SMLTN.EZCANCELFLAG = '0'
                      ) SMLTN_LATST
                    ,DS_ASSET_MSTR        AM
                    ,MDSE                 MD
                    ,SVC_MACH_MSTR        SMM
                    <isNotNull property="bizMsg.dsAssetDescTxt_S1">
                    ,SVC_CONFIG_MSTR      SCM
                    ,MDL_NM               MN
                    ,SVC_CONFIG_MSTR      SCM2
                    ,MDL_NM               MN2
                    </isNotNull>
                    <isNotNull property="bizMsg.rtnWhCd_S1">
                    ,RTL_SWH              RS
                    </isNotNull>
                    <isNotNull property="depcCoaAcctCdFlg">
                    ,ASSET_BOOK_CTRL      BC
                    </isNotNull>
                    ,DS_COND_CONST        DCC
                    <isNotNull property = "existCoaFlg">
                    ,SELL_TO_CUST         STC3
                    </isNotNull>
                WHERE
                        ADS.GLBL_CMPY_CD = #glblCmpyCd#
                    <!-- QC#22267-->
                    <isNotNull property="bizMsg.dsAssetMstrPk_S1">
                        AND ADS.PRNT_DS_ASSET_MSTR_PK = #bizMsg.dsAssetMstrPk_S1#
                    </isNotNull>
                    <isNotNull property="bizMsg.assetTpCd_S1">
                        AND ADS.ASSET_TP_CD        = #bizMsg.assetTpCd_S1#
                    </isNotNull>
                    <isNotNull property="bizMsg.xxDt10Dt_T1">
                        AND ADS.ASSET_TRX_DT       = #bizMsg.xxDt10Dt_T1#
                    </isNotNull>
                    <!-- AND AM.CUR_VAL_AMT &gt; 0 -->
                    <isNotNull property="bizMsg.depcStartDt_S1">
                        AND AM.DEPC_START_DT    &gt;= #bizMsg.depcStartDt_S1#
                    </isNotNull>
                    <isNotNull property="bizMsg.depcStartDt_S2">
                        AND AM.DEPC_START_DT    &lt;= #bizMsg.depcStartDt_S2#
                    </isNotNull>
                    <isNotNull property="bizMsg.serNum_S1">
                        AND EXISTS(
                            SELECT NULL
                            FROM DS_ASSET_MSTR A2
                            WHERE
                                A2.GLBL_CMPY_CD             = AM.GLBL_CMPY_CD
                            AND A2.PRNT_DS_ASSET_MSTR_PK    = AM.DS_ASSET_MSTR_PK
                            AND A2.SER_NUM                  = #bizMsg.serNum_S1#
                            AND A2.EZCANCELFLAG             = '0'
                        )
                    </isNotNull>
                    <isNotNull property="bizMsg.mdseCd_S1">
                        AND EXISTS(
                            SELECT NULL
                            FROM DS_ASSET_MSTR A2
                            WHERE
                                A2.GLBL_CMPY_CD             = AM.GLBL_CMPY_CD
                            AND A2.PRNT_DS_ASSET_MSTR_PK    = AM.DS_ASSET_MSTR_PK
                            AND A2.MDSE_CD                  = #bizMsg.mdseCd_S1#
                            AND A2.EZCANCELFLAG             = '0'
                        )
                    </isNotNull>
                    <isNotNull property="bizMsg.assetStsCd_S1">
                        AND AM.ASSET_STS_CD         = #bizMsg.assetStsCd_S1#
                    </isNotNull>
                    <isNotNull property="bizMsg.assetTagNum_S1">
                        AND AM.ASSET_TAG_NUM        = #bizMsg.assetTagNum_S1#
                    </isNotNull>
                    <isNotNull property="bizMsg.custIssPoNum_S1">
                        AND (
                                       AM.PO_ORD_NUM        = #bizMsg.custIssPoNum_S1#
                             OR UPPER( AM.CUST_ISS_PO_NUM ) = UPPER(#bizMsg.custIssPoNum_S1#) <!-- 2019/03/28 QC#30758 Add 'UPPER' to the parameter -->
                            )
                    </isNotNull>
                    <isNotNull property="bizMsg.vndCd_S1">
                        AND AM.VND_CD               = #bizMsg.vndCd_S1#
                    </isNotNull>
                    <isNotNull property="bizMsg.dsAssetDescTxt_S1">
                        AND (    UPPER( AM.DS_ASSET_DESC_TXT )   LIKE #bizMsg.dsAssetDescTxt_S1#
                              OR UPPER( MN2.T_MDL_NM )           LIKE #bizMsg.dsAssetDescTxt_S1#
                              OR UPPER( MN.T_MDL_NM )            LIKE #bizMsg.dsAssetDescTxt_S1#
                              OR UPPER( MD.MDSE_DESC_SHORT_TXT ) LIKE #bizMsg.dsAssetDescTxt_S1#
                             )
                    </isNotNull>
                    <isNotNull property="bizMsg.svcConfigMstrPk_S1">
                        AND (     AM.SVC_CONFIG_MSTR_PK   = #bizMsg.svcConfigMstrPk_S1#
                              OR SMM.SVC_CONFIG_MSTR_PK   = #bizMsg.svcConfigMstrPk_S1#
                            )
                    </isNotNull>
                    <isNotNull property="bizMsg.cpoOrdNum_S1">
                        AND EXISTS(
                            SELECT NULL
                            FROM (
                                SELECT
                                    A2.CPO_ORD_NUM AS ASSET_CPO_ORD_NUM
                                    ,SMM2.CPO_ORD_NUM AS MACH_CPO_ORD_NUM
                                FROM DS_ASSET_MSTR A2
                                    ,SVC_MACH_MSTR SMM2
                                WHERE
                                    A2.GLBL_CMPY_CD            = AM.GLBL_CMPY_CD
                                AND A2.PRNT_DS_ASSET_MSTR_PK   = AM.DS_ASSET_MSTR_PK
                                AND A2.EZCANCELFLAG            = '0'
                                AND SMM2.GLBL_CMPY_CD(+)        = A2.GLBL_CMPY_CD
                                AND SMM2.SVC_MACH_MSTR_PK(+)    = A2.SVC_MACH_MSTR_PK
                                AND SMM2.EZCANCELFLAG(+)        = '0'
                            )
                            WHERE (
                                ASSET_CPO_ORD_NUM          = #bizMsg.cpoOrdNum_S1#
                                OR MACH_CPO_ORD_NUM        = #bizMsg.cpoOrdNum_S1#
                            )
                        )
                    </isNotNull>
                    <isNotNull property="bizMsg.xxChkBox_H1">
                       <isNull property="bizMsg.xxChkBox_H2">
                        AND (
                               (     AM.RTRN_WH_CD       IS NULL
                                 AND AM.SVC_MACH_MSTR_PK IS NULL
                               )
                              OR SMM.SVC_MACH_MSTR_STS_CD NOT IN (#svcMachStsCRAT#, #svcMachStsRMV#)
                            )
                       </isNull>
                    </isNotNull>
                    <isNotNull property="bizMsg.xxChkBox_H2">
                       <isNull property="bizMsg.xxChkBox_H1">
                        AND (
                               (    AM.RTRN_WH_CD IS NOT NULL
                               )
                                OR SMM.SVC_MACH_MSTR_STS_CD IN (#svcMachStsCRAT#, #svcMachStsRMV#)
                            )
                       </isNull>
                    </isNotNull>
                    <isNotNull property="bizMsg.rtnWhCd_S1">
                         AND SMM.GLBL_CMPY_CD              = RS.GLBL_CMPY_CD(+)
                         AND SMM.CUR_LOC_NUM               = RS.INVTY_LOC_CD(+)
                         AND RS.EZCANCELFLAG(+)            = '0'
                         AND (    AM.RTRN_WH_CD            = #bizMsg.rtnWhCd_S1#
                               OR RS.RTL_WH_CD             = #bizMsg.rtnWhCd_S1#
                            )
                    </isNotNull>
                    <isNotNull property="bizMsg.shipToCustAcctCd_S1">
                         AND (     AM.SHIP_TO_CUST_ACCT_CD = #bizMsg.shipToCustAcctCd_S1#
                               OR SMM.CUR_LOC_ACCT_NUM     = #bizMsg.shipToCustAcctCd_S1#
                             )
                    </isNotNull>
                         AND ADS.EZCANCELFLAG              = '0'
                         AND ADS.PRNT_DS_ASSET_MSTR_PK     = SMLTN_LATST.PRNT_DS_ASSET_MSTR_PK
                         AND ADS.DEPC_SMLTN_RQST_DT_TM_TS  = SMLTN_LATST.DEPC_SMLTN_RQST_DT_TM_TS
                         AND ADS.ASSET_TRX_DT              = SMLTN_LATST.ASSET_TRX_DT
                         AND SMLTN_LATST.CNT               = 1
                         AND ADS.GLBL_CMPY_CD              = AT.GLBL_CMPY_CD
                         AND ADS.ASSET_TP_CD               = AT.ASSET_TP_CD
                         AND AT.EZCANCELFLAG               = '0'
                         AND ADS.GLBL_CMPY_CD              = AM.GLBL_CMPY_CD
                         AND ADS.PRNT_DS_ASSET_MSTR_PK     = AM.DS_ASSET_MSTR_PK
                         AND AM.EZCANCELFLAG               = '0'
                         AND AM.GLBL_CMPY_CD               = DCC.GLBL_CMPY_CD
                         AND AM.ASSET_STS_CD               = DCC.DS_COND_CONST_CD
                         AND DCC.DS_COND_CONST_GRP_ID      = #dsCondConstGrpId#
                         AND DCC.EZCANCELFLAG              = '0'
                         AND AM.GLBL_CMPY_CD               = MD.GLBL_CMPY_CD(+)
                         AND AM.MDSE_CD                    = MD.MDSE_CD(+)
                         AND MD.EZCANCELFLAG(+)            = '0'
                         AND AM.GLBL_CMPY_CD               = SMM.GLBL_CMPY_CD(+)
                         AND AM.SVC_MACH_MSTR_PK           = SMM.SVC_MACH_MSTR_PK(+)
                         AND SMM.EZCANCELFLAG(+)           = '0'
                         AND EXISTS
                         (
                            SELECT 1 FROM DS_ASSET_MSTR DAM
                            WHERE 
                                DAM.GLBL_CMPY_CD           = AM.GLBL_CMPY_CD
                            AND DAM.EZCANCELFLAG           = '0' 
                            AND DAM.PRNT_DS_ASSET_MSTR_PK  = AM.PRNT_DS_ASSET_MSTR_PK
                            HAVING SUM(DAM.CUR_VAL_AMT) &gt;  0
                         ) 
                    <isNotNull property="depcCoaAcctCdFlg">
                         AND AM.GLBL_CMPY_CD               = BC.GLBL_CMPY_CD
                         AND AM.ASSET_TP_CD                = BC.ASSET_TP_CD
                         AND BC.EFF_FROM_DT            &lt;= #slsDt#
                         AND (
                                  BC.EFF_THRU_DT       &gt;= #slsDt#
                               OR BC.EFF_THRU_DT IS NULL
                         )
                         AND BC.EZCANCELFLAG               = '0'
                    </isNotNull>
                    <isNotNull property = "existCoaFlg">
                         AND AM.GLBL_CMPY_CD         = STC3.GLBL_CMPY_CD(+)
                         AND AM.SELL_TO_CUST_CD      = STC3.SELL_TO_CUST_CD(+)
                    <isNotNull property        = "bizMsg.depcCoaAcctCd_S1">
                         AND (CASE WHEN AM.PROC_MODE_CD        = #procMode# AND AM.EXP_COA_ACCT_CD IS NULL THEN STC3.COA_ACCT_CD
                                   WHEN AM.PROC_MODE_CD &lt;&gt; #procMode# AND AM.EXP_COA_ACCT_CD IS NULL THEN BC.DEPC_COA_ACCT_CD ELSE AM.EXP_COA_ACCT_CD END ) &gt;= #bizMsg.depcCoaAcctCd_S1#
                    </isNotNull>
                    <isNotNull property        = "bizMsg.depcCoaAcctCd_S2">
                         AND (CASE WHEN AM.PROC_MODE_CD        = #procMode# AND AM.EXP_COA_ACCT_CD IS NULL THEN STC3.COA_ACCT_CD
                                   WHEN AM.PROC_MODE_CD &lt;&gt; #procMode# AND AM.EXP_COA_ACCT_CD IS NULL THEN BC.DEPC_COA_ACCT_CD ELSE AM.EXP_COA_ACCT_CD END ) &lt;= #bizMsg.depcCoaAcctCd_S2#
                    </isNotNull>
                    <isNotNull property        = "bizMsg.expCoaBrCd_S1">
                         AND (CASE WHEN AM.PROC_MODE_CD = #procMode# AND AM.EXP_COA_BR_CD IS NULL THEN STC3.COA_BR_CD ELSE AM.EXP_COA_BR_CD END ) &gt;= #bizMsg.expCoaBrCd_S1#
                    </isNotNull>
                    <isNotNull property        = "bizMsg.expCoaBrCd_S2">
                         AND (CASE WHEN AM.PROC_MODE_CD = #procMode# AND AM.EXP_COA_BR_CD IS NULL THEN STC3.COA_BR_CD ELSE AM.EXP_COA_BR_CD END ) &lt;= #bizMsg.expCoaBrCd_S2#
                    </isNotNull>
                    <isNotNull property        = "bizMsg.expCoaCcCd_S1">
                         AND (CASE WHEN AM.PROC_MODE_CD = #procMode# AND AM.EXP_COA_CC_CD IS NULL THEN STC3.COA_CC_CD ELSE AM.EXP_COA_CC_CD END ) &gt;= #bizMsg.expCoaCcCd_S1#
                    </isNotNull>
                    <isNotNull property        = "bizMsg.expCoaCcCd_S2">
                         AND (CASE WHEN AM.PROC_MODE_CD = #procMode# AND AM.EXP_COA_CC_CD IS NULL THEN STC3.COA_CC_CD ELSE AM.EXP_COA_CC_CD END ) &lt;= #bizMsg.expCoaCcCd_S2#
                    </isNotNull>
                    <isNotNull property        = "bizMsg.expCoaExtnCd_S1">
                         AND (CASE WHEN AM.PROC_MODE_CD = #procMode# AND AM.EXP_COA_EXTN_CD IS NULL THEN STC3.COA_EXTN_CD ELSE AM.EXP_COA_EXTN_CD END ) &gt;= #bizMsg.expCoaExtnCd_S1#
                    </isNotNull>
                    <isNotNull property        = "bizMsg.expCoaExtnCd_S2">
                         AND (CASE WHEN AM.PROC_MODE_CD = #procMode# AND AM.EXP_COA_EXTN_CD IS NULL THEN STC3.COA_EXTN_CD ELSE AM.EXP_COA_EXTN_CD END ) &lt;= #bizMsg.expCoaExtnCd_S2#
                    </isNotNull>
                         AND STC3.EZCANCELFLAG(+)   = '0'
                    </isNotNull>
                    <isNotNull property="bizMsg.dsAssetDescTxt_S1">
                         AND SMM.GLBL_CMPY_CD              = SCM.GLBL_CMPY_CD(+)
                         AND SMM.SVC_CONFIG_MSTR_PK        = SCM.SVC_CONFIG_MSTR_PK(+)
                         AND SCM.EZCANCELFLAG(+)           = '0'
                         AND SCM.GLBL_CMPY_CD              = MN.T_GLBL_CMPY_CD(+)
                         AND SCM.MDL_ID                    = MN.T_MDL_ID(+)
                         AND MN.EZCANCELFLAG(+)            = '0'
                         AND AM.GLBL_CMPY_CD               = SCM2.GLBL_CMPY_CD(+)
                         AND AM.SVC_CONFIG_MSTR_PK         = SCM2.SVC_CONFIG_MSTR_PK(+)
                         AND SCM2.EZCANCELFLAG(+)          = '0'
                         AND SCM2.GLBL_CMPY_CD             = MN2.T_GLBL_CMPY_CD(+)
                         AND SCM2.MDL_ID                   = MN2.T_MDL_ID(+)
                         AND MN2.EZCANCELFLAG(+)           = '0'
                         </isNotNull>
                GROUP BY
                      ADS.PRNT_DS_ASSET_MSTR_PK
                    , AT.ASSET_TP_NM
                    , ADS.ASSET_TRX_DT
                ORDER BY
                    PRNT_DS_ASSET_MSTR_PK
            )
        WHERE 
            ROWNUM &lt;= #rowNum#
    </statement>

    <resultMap id="result.searchDepSim" class="NLEL0060_ESMsg">
        <result property="prntDsAssetMstrPk_E1"  column="PRNT_DS_ASSET_MSTR_PK"    javaType="EZDSBigDecimalItem"/>
        <result property="assetTpNm_E1"          column="ASSET_TP_NM"              javaType="EZDSStringItem"/>
        <result property="assetTrxDt_E1"         column="ASSET_TRX_DT"             javaType="EZDSDateItem"/>
        <result property="depcValAmt_E1"         column="DEPC_VAL_AMT1"            javaType="EZDSBigDecimalItem"/>
        <result property="drCoaAcctCd_E1"        column="DR_COA_ACCT_CD"           javaType="EZDSStringItem"/>
        <result property="depcValAmt_E2"         column="DEPC_VAL_AMT2"            javaType="EZDSBigDecimalItem"/>
        <result property="crCoaAcctCd_E1"        column="CR_COA_ACCT_CD"           javaType="EZDSStringItem"/>
   </resultMap>

   <statement id="searchAssetHistory" parameterClass="Map" resultMap="result.searchAssetHistory">
       SELECT
              ASSET_TRK.DS_ASSET_MSTR_PK
            , ASSET_TRK.PROC_MODE_NM
            , ASSET_TRK.TRX_RGTN_TS
            , ASSET_TRK.UPD_FLD_TXT
            , ASSET_TRK.OLD_VAL_TXT
            , ASSET_TRK.NEW_VAL_TXT
            , ASSET_TRK.UPD_USR_ID

        FROM
            (
                SELECT
                      A.DS_ASSET_MSTR_PK
                    , CASE WHEN TRK.PRNT_DS_ASSET_MSTR_PK = A.DS_ASSET_MSTR_PK THEN NULL ELSE TRK.PRNT_DS_ASSET_MSTR_PK END AS PRNT_DS_ASSET_MSTR_PK
                    , TRK.PROC_MODE_NM
                    , TRK.TRX_RGTN_TS
                    , TRK.UPD_FLD_TXT
                    , TRK.OLD_VAL_TXT
                    , TRK.NEW_VAL_TXT
                    , TRK.UPD_USR_ID
                FROM
                    DS_ASSET_MSTR_TRK TRK
                    <!-- START 2016/12/16 ADD QC#15901-->
                   ,DS_ASSET_MSTR     A
                   ,ASSET_BOOK_CTRL   BC
                    <!-- END 2016/12/16 ADD QC#15901-->
                   , SVC_MACH_MSTR    SMM
                   ,DS_COND_CONST     DCC
                   , (
                      SELECT
                        RSW.GLBL_CMPY_CD, RSW.INVTY_LOC_CD AS RTRN_WH_CD
                      FROM RTL_SWH RSW
                      WHERE
                        RSW.GLBL_CMPY_CD         = #glblCmpyCd#
                        AND RSW.RTL_SWH_DSBL_FLG = 'N'
                        AND RSW.EZCANCELFLAG     = '0'
                   ) RTL_SWH
                   <isNotNull property = "existCoaFlg">
                   ,SELL_TO_CUST      STC3
                   </isNotNull>
                WHERE
                    <!-- START 2016/12/16 MOD QC#15901-->
                    TRK.GLBL_CMPY_CD            = #glblCmpyCd#
                   <isNotNull property="bizMsg.dsAssetMstrPk_S1">
                    AND A.PRNT_DS_ASSET_MSTR_PK = #bizMsg.dsAssetMstrPk_S1#
                   </isNotNull>
                    AND TRK.PRNT_DS_ASSET_MSTR_PK       = TRK.DS_ASSET_MSTR_PK
                    AND TRK.EZCANCELFLAG                = '0'
                    AND TRK.GLBL_CMPY_CD                = A.GLBL_CMPY_CD
                    AND A.EZCANCELFLAG                  = '0'
                    AND A.DS_ASSET_MSTR_PK              = TRK.PRNT_DS_ASSET_MSTR_PK
                   <isNotNull property="bizMsg.assetTpCd_S1">
                    AND A.ASSET_TP_CD           = #bizMsg.assetTpCd_S1#
                   </isNotNull>
                   <isNotNull property="bizMsg.depcStartDt_S1">
                    AND A.DEPC_START_DT     &gt;= #bizMsg.depcStartDt_S1#
                   </isNotNull>
                   <isNotNull property="bizMsg.depcStartDt_S2">
                    AND A.DEPC_START_DT     &lt;= #bizMsg.depcStartDt_S2#
                   </isNotNull>
                   <isNotNull property="bizMsg.serNum_S1">
                    AND EXISTS(
                        SELECT NULL
                        FROM DS_ASSET_MSTR A2
                        WHERE
                            A2.GLBL_CMPY_CD             = A.GLBL_CMPY_CD
                        AND A2.PRNT_DS_ASSET_MSTR_PK    = A.DS_ASSET_MSTR_PK
                        AND A2.SER_NUM                  = #bizMsg.serNum_S1#
                        AND A2.EZCANCELFLAG             = '0'
                    )
                   </isNotNull>
                   <isNotNull property="bizMsg.mdseCd_S1">
                    AND EXISTS(
                        SELECT NULL
                        FROM DS_ASSET_MSTR A2
                        WHERE
                            A2.GLBL_CMPY_CD             = A.GLBL_CMPY_CD
                        AND A2.PRNT_DS_ASSET_MSTR_PK    = A.DS_ASSET_MSTR_PK
                        AND A2.MDSE_CD                  = #bizMsg.mdseCd_S1#
                        AND A2.EZCANCELFLAG             = '0'
                    )
                   </isNotNull>
                   <isNotNull property="bizMsg.assetTagNum_S1">
                    AND A.ASSET_TAG_NUM        = #bizMsg.assetTagNum_S1#
                   </isNotNull>
                   <isNotNull property="bizMsg.svcConfigMstrPk_S1">
                    AND A.SVC_CONFIG_MSTR_PK   = #bizMsg.svcConfigMstrPk_S1#
                   </isNotNull>
                   <isNotNull property="bizMsg.cpoOrdNum_S1">
                   AND EXISTS(
                       SELECT NULL
                       FROM (
                           SELECT
                               A2.CPO_ORD_NUM AS ASSET_CPO_ORD_NUM
                               ,SMM.CPO_ORD_NUM AS MACH_CPO_ORD_NUM
                           FROM DS_ASSET_MSTR A2
                               ,SVC_MACH_MSTR SMM
                           WHERE
                               A2.GLBL_CMPY_CD            = A.GLBL_CMPY_CD
                           AND A2.PRNT_DS_ASSET_MSTR_PK   = A.DS_ASSET_MSTR_PK
                           AND A2.EZCANCELFLAG            = '0'
                           AND SMM.GLBL_CMPY_CD(+)        = A2.GLBL_CMPY_CD
                           AND SMM.SVC_MACH_MSTR_PK(+)    = A2.SVC_MACH_MSTR_PK
                           AND SMM.EZCANCELFLAG(+)        = '0'
                       )
                       WHERE (
                           ASSET_CPO_ORD_NUM          = #bizMsg.cpoOrdNum_S1#
                           OR MACH_CPO_ORD_NUM        = #bizMsg.cpoOrdNum_S1#
                       )
                   )
                   </isNotNull>
                   <isNotNull property="bizMsg.xxChkBox_H1">
                       <isNull property="bizMsg.xxChkBox_H2">
                        AND RTL_SWH.RTRN_WH_CD IS NULL
                       </isNull>
                   </isNotNull>
                   <isNotNull property="bizMsg.xxChkBox_H2">
                       <isNull property="bizMsg.xxChkBox_H1">
                        AND RTL_SWH.RTRN_WH_CD IS NOT NULL
                       </isNull>
                   </isNotNull>
                   <isNotNull property="bizMsg.rtnWhCd_S1">
                    AND RTL_SWH.RTRN_WH_CD           = #bizMsg.rtnWhCd_S1#
                   </isNotNull>
                   <isNotNull property="bizMsg.shipToCustAcctCd_S1">
                    AND A.SHIP_TO_CUST_ACCT_CD = #bizMsg.shipToCustAcctCd_S1#
                   </isNotNull>
                   <isNotNull property="bizMsg.custIssPoNum_S1">
                    AND (   A.PO_ORD_NUM               = #bizMsg.custIssPoNum_S1#
                            OR UPPER( A.CUST_ISS_PO_NUM ) = UPPER(#bizMsg.custIssPoNum_S1#) <!-- 2019/03/28 QC#30758 Add 'UPPER' to the parameter -->
                         )
                   </isNotNull>
                   <isNotNull property="bizMsg.vndCd_S1">
                    AND A.VND_CD               = #bizMsg.vndCd_S1#
                   </isNotNull>
                   <isNotNull property="bizMsg.dsAssetDescTxt_S1">
                    AND UPPER ( A.DS_ASSET_DESC_TXT ) LIKE #bizMsg.dsAssetDescTxt_S1#
                   </isNotNull>
                    AND A.GLBL_CMPY_CD          = BC.GLBL_CMPY_CD
                    AND A.ASSET_TP_CD           = BC.ASSET_TP_CD
                    AND BC.EFF_FROM_DT      &lt;= #slsDt#
                    AND (
                          BC.EFF_THRU_DT    &gt;= #slsDt#
                          OR BC.EFF_THRU_DT IS NULL
                         )
                    AND BC.EZCANCELFLAG = '0'
                    <isNotNull property = "existCoaFlg">
                    AND A.GLBL_CMPY_CD         = STC3.GLBL_CMPY_CD(+)
                    AND A.SELL_TO_CUST_CD      = STC3.SELL_TO_CUST_CD(+)
                    <isNotNull property        = "bizMsg.depcCoaAcctCd_S1">
                    AND (CASE WHEN A.PROC_MODE_CD        = #procMode# AND A.EXP_COA_ACCT_CD IS NULL THEN STC3.COA_ACCT_CD
                              WHEN A.PROC_MODE_CD &lt;&gt; #procMode# AND A.EXP_COA_ACCT_CD IS NULL THEN BC.DEPC_COA_ACCT_CD ELSE A.EXP_COA_ACCT_CD END ) &gt;= #bizMsg.depcCoaAcctCd_S1#
                    </isNotNull>
                    <isNotNull property        = "bizMsg.depcCoaAcctCd_S2">
                    AND (CASE WHEN A.PROC_MODE_CD        = #procMode# AND A.EXP_COA_ACCT_CD IS NULL THEN STC3.COA_ACCT_CD
                              WHEN A.PROC_MODE_CD &lt;&gt; #procMode# AND A.EXP_COA_ACCT_CD IS NULL THEN BC.DEPC_COA_ACCT_CD ELSE A.EXP_COA_ACCT_CD END ) &lt;= #bizMsg.depcCoaAcctCd_S2#
                    </isNotNull>
                    <isNotNull property        = "bizMsg.expCoaBrCd_S1">
                    AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_BR_CD IS NULL THEN STC3.COA_BR_CD ELSE A.EXP_COA_BR_CD END ) &gt;= #bizMsg.expCoaBrCd_S1#
                    </isNotNull>
                    <isNotNull property        = "bizMsg.expCoaBrCd_S2">
                    AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_BR_CD IS NULL THEN STC3.COA_BR_CD ELSE A.EXP_COA_BR_CD END ) &lt;= #bizMsg.expCoaBrCd_S2#
                    </isNotNull>
                    <isNotNull property        = "bizMsg.expCoaCcCd_S1">
                    AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_CC_CD IS NULL THEN STC3.COA_CC_CD ELSE A.EXP_COA_CC_CD END ) &gt;= #bizMsg.expCoaCcCd_S1#
                    </isNotNull>
                    <isNotNull property        = "bizMsg.expCoaCcCd_S2">
                    AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_CC_CD IS NULL THEN STC3.COA_CC_CD ELSE A.EXP_COA_CC_CD END ) &lt;= #bizMsg.expCoaCcCd_S2#
                    </isNotNull>
                    <isNotNull property        = "bizMsg.expCoaExtnCd_S1">
                    AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_EXTN_CD IS NULL THEN STC3.COA_EXTN_CD ELSE A.EXP_COA_EXTN_CD END ) &gt;= #bizMsg.expCoaExtnCd_S1#
                    </isNotNull>
                    <isNotNull property        = "bizMsg.expCoaExtnCd_S2">
                    AND (CASE WHEN A.PROC_MODE_CD = #procMode# AND A.EXP_COA_EXTN_CD IS NULL THEN STC3.COA_EXTN_CD ELSE A.EXP_COA_EXTN_CD END ) &lt;= #bizMsg.expCoaExtnCd_S2#
                    </isNotNull>
                    AND STC3.EZCANCELFLAG(+)   = '0'
                    </isNotNull>
                   <!-- END 2016/12/16 MOD QC#15901-->
                    AND A.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD (+)
                    AND A.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK (+)
                    AND SMM.EZCANCELFLAG (+)    = '0'
                    AND SMM.GLBL_CMPY_CD        = RTL_SWH.GLBL_CMPY_CD (+)
                    AND SMM.IND_CUR_LOC_NUM     = RTL_SWH.RTRN_WH_CD (+)
                    AND A.GLBL_CMPY_CD          = DCC.GLBL_CMPY_CD
                    AND A.ASSET_STS_CD          = DCC.DS_COND_CONST_CD
                    AND DCC.DS_COND_CONST_GRP_ID = #dsCondConstGrpId#
                    AND DCC.EZCANCELFLAG        = '0'

                ORDER BY
                    TRK.TRX_RGTN_TS   DESC
                  , TRK.UPD_FLD_TXT   ASC
            ) ASSET_TRK
        WHERE 
            ROWNUM &lt;= #rowNum#
   </statement>

   <resultMap id="result.searchAssetHistory"     class="NLEL0060_FSMsg">
        <result property="dsAssetMstrPk_F1"      column="DS_ASSET_MSTR_PK"       javaType="EZDSBigDecimalItem"/>
        <result property="prntDsAssetMstrPk_F1"  column="PRNT_DS_ASSET_MSTR_PK"  javaType="EZDSBigDecimalItem"/>
        <result property="procModeNm_F1"         column="PROC_MODE_NM"           javaType="EZDSStringItem"/>
        <result property="xxDtTm_F1"             column="TRX_RGTN_TS"            javaType="EZDSStringItem"/>
        <result property="updFldTxt_F1"          column="UPD_FLD_TXT"            javaType="EZDSStringItem"/>
        <result property="oldValTxt_F1"          column="OLD_VAL_TXT"            javaType="EZDSStringItem"/>
        <result property="newValTxt_F1"          column="NEW_VAL_TXT"            javaType="EZDSStringItem"/>
        <result property="updUsrId_F1"           column="UPD_USR_ID"             javaType="EZDSStringItem"/>
   </resultMap>

    <statement id="getDepcSmltnRqstDtTmTs" parameterClass="Map" resultClass="Map">
        SELECT
            MAX(ASSET_TRX_DT) AS ASSET_TRX_DT
        FROM
            DS_ASSET_DEPC_SMLTN ADS
        WHERE
                ADS.GLBL_CMPY_CD = #glblCmpyCd#
            AND ADS.ASSET_TP_CD = #assetTpCd#
            AND ADS.EZCANCELFLAG = '0' 
    </statement>

    <statement id="getAssetForDepriciation" parameterClass="Map" resultClass="Map">
        SELECT
              A.PRNT_DS_ASSET_MSTR_PK
            , A.DS_ASSET_MSTR_PK
            , A.CUR_VAL_AMT
            , A.DEPC_CNT
            , A.LAST_DEPC_YR_MTH
        FROM
              DS_ASSET_MSTR     A
        WHERE
                A.GLBL_CMPY_CD   = #glblCmpyCd#
            AND A.ASSET_TP_CD    = #assetTpCd#
            AND A.ACTV_ASSET_FLG = 'Y'
            AND A.CUR_VAL_AMT &gt;  0
            AND A.EZCANCELFLAG   = '0'
            AND A.ASSET_STS_CD &lt;&gt; #assetStsCd#
    </statement>

    <statement id="getWhNm" parameterClass="Map" resultClass="Map">
        SELECT
              RW.RTL_WH_CD
            , RW.RTL_WH_NM
        FROM
              RTL_WH RW
        WHERE
                RW.GLBL_CMPY_CD  = #glblCmpyCd#
            AND RW.EZCANCELFLAG  = '0'
            AND RW.RTL_WH_CD= #rtnWhCd#
    </statement>

    <statement id="existCoaMdseTpCd"  parameterClass="Map" resultClass="Map">
        SELECT
            CP.COA_PROJ_CD
        FROM
              COA_PROJ        CP
        WHERE
            CP.GLBL_CMPY_CD = #glblCmpyCd#
        AND CP.COA_PROJ_CD  = #coaProjCd#
        AND CP.EZCANCELFLAG = '0'
     </statement>

     <statement id="existRtrnWhCd"  parameterClass="Map" resultClass="Map">
        SELECT 
            RW.RTL_WH_CD
        FROM
            RTL_WH RW
        WHERE 
            RW.GLBL_CMPY_CD     = #glblCmpyCd#
        AND RW.RTL_WH_CD        = #rtrnWhCd#
        AND RW.EZCANCELFLAG     = '0'
     </statement>

     <statement id="getDsAcctNum"  parameterClass="Map" resultClass="Map">
        SELECT
            A.SELL_TO_CUST_CD
        FROM
            SELL_TO_CUST A
        WHERE
            A.GLBL_CMPY_CD = #glblCmpyCd#
        AND A.DS_ACCT_NM   = #dsAcctNm#
        AND A.RGTN_STS_CD &lt;&gt; #rgtnStsCd_P99#
        AND A.EZCANCELFLAG = '0'
     </statement>

     <statement id="isSameBookType"  parameterClass="Map" resultClass="Map">
        SELECT
            A.DS_ASSET_MSTR_PK
        FROM
              DS_ASSET_MSTR     A
            , ASSET_TP          AT
        WHERE
            A.GLBL_CMPY_CD     = #glblCmpyCd#
        AND A.DS_ASSET_MSTR_PK = #dsAssetMstrPk#
        AND A.EZCANCELFLAG     = '0'
        AND A.GLBL_CMPY_CD  = AT.GLBL_CMPY_CD
        AND A.ASSET_TP_CD   = AT.ASSET_TP_CD
        AND AT.ASSET_TP_NM  = #assetTpNm# 
        AND AT.EZCANCELFLAG = '0'
     </statement>

     <statement id="getDsAssetMstrPkCurrentAsset" parameterClass="Map"  resultClass="BigDecimal">
        SELECT
                DTL.DS_ASSET_MSTR_PK
        FROM
                DS_ASSET_MSTR DTL
        WHERE
                DTL.GLBL_CMPY_CD                     = #glblCmpyCd#
                AND DTL.PRNT_DS_ASSET_MSTR_PK        = #dsAssetMstrPk#
                AND DTL.DS_ASSET_MSTR_PK      &lt;&gt; #dsAssetMstrPk#
                AND DTL.EZCANCELFLAG                 = '0'
    </statement>

    <statement id="getAssetMstrInfo" parameterClass="Map" resultClass="Map">
        SELECT
                DAM.DS_ASSET_MSTR_PK
               ,DAM.CUR_VAL_AMT
               ,DAM.INIT_BOOK_AMT
               ,DAM.DEPC_CNT
               ,DAM.LAST_DEPC_YR_MTH
               ,DAM.DEPC_MTH_NUM
               ,DAM.RSDL_VAL_AMT
        FROM
                DS_ASSET_MSTR     DAM
        WHERE
                DAM.GLBL_CMPY_CD          = #glblCmpyCd#
        AND     DAM.PRNT_DS_ASSET_MSTR_PK = #prntDsAssetMstrPk#
        AND     DAM.EZCANCELFLAG          = '0'
        ORDER BY
                DAM.CUR_VAL_AMT
    </statement>

    <statement id="getCpoLineNum" parameterClass="Map" resultClass="Map">
        SELECT
             CPO_DTL_LINE_NUM
            ,CPO_DTL_LINE_SUB_NUM
        FROM
            CPO_DTL  CD
        WHERE
            CD.GLBL_CMPY_CD        = #glblCmpyCd#
        AND CD.CPO_ORD_NUM         = #cpoOrdNum#
        <isNotNull property="dsOrdPosnNum">
        AND CD.DS_ORD_POSN_NUM     = #dsOrdPosnNum#
        </isNotNull>
        <isNotNull property="dsCpoLineNum">
        AND CD.DS_CPO_LINE_NUM     = #dsCpoLineNum#
        </isNotNull>
        <isNotNull property="dsCpoLineSubNum">
        AND CD.DS_CPO_LINE_SUB_NUM = #dsCpoLineSubNum#
        </isNotNull>
        AND CD.EZCANCELFLAG        = '0'
    </statement>

    <statement id="getDefaultCoaList" parameterClass="Map" resultClass="Map">
        SELECT 
              AM.DS_ASSET_MSTR_PK
             -- LINK
            , ISC.COA_CMPY_CD                      AS "LINK_CMPY_CD"
            , ISC.COA_ACCT_CD                      AS "LINK_ACCT_CD"
            , ISC.COA_BR_CD                        AS "LINK_BR_CD"
            , ISC.COA_CC_CD                        AS "LINK_CC_CD"
            , ISC.COA_PROD_CD                      AS "LINK_PROD_CD"
            , ISC.COA_CH_CD                        AS "LINK_CH_CD"
            , ISC.COA_AFFL_CD                      AS "LINK_AFFL_CD"
            , ISC.COA_PROJ_CD                      AS "LINK_PROJ_CD"
            , ISC.COA_EXTN_CD                      AS "LINK_EXTN_CD"
               -- at TOC
            , ORG.COA_CMPY_CD                      AS "TOC_CMPY_CD"
            , ORG.COA_BR_CD                        AS "TOC_BR_CD"
            , ORG.COA_CC_CD                        AS "TOC_CC_CD"
            , ORG.COA_CH_CD                        AS "TOC_CH_CD"
            , ORG.COA_EXTN_CD                      AS "TOC_EXTN_CD"
            , ORG.COA_PROD_CD                      AS "TOC_PROD_CD"
               -- at ITEM
            , MDSE.COA_PROD_CD                     AS "ITEM_PROD_CD"
            , MDSE.REV_COA_ACCT_CD                 AS "ITEM-REV_ACCT_CD"
            , MDSE.COGS_COA_ACCT_CD                AS "ITEM-COS_ACCT_CD"
            , MDSE.EXP_COA_ACCT_CD                 AS "ITEM-EXP_ACCT_CD"
            , MDSE.COA_MDSE_TP_CD                  AS "ITEM_PROJ_CD"
            , MDSE.COA_CC_CD                       AS "ITEM_CC_CD"
            , MDSE.INVTY_COA_ACCT_CD               AS "ITEM-INV_ACCT_CD"
            , MDSE.ACRL_COA_ACCT_CD                AS "ITEM-ACRL_ACCT_CD"
            , MDSE.COA_PROD_CD                     AS "MACH_PROD_CD"
            , MDSE.COA_MDSE_TP_CD                  AS "MACH_PROJ_CD"
            , MDSE.COA_CC_CD                       AS "MACH_CC_CD"
              -- at CUST-ACCT
            , AC.COA_CMPY_CD                       AS "CUST-ACCT_CMPY_CD"
            , AC.COA_BR_CD                         AS "CUST-ACCT_BR_CD"
            , AC.COA_CC_CD                         AS "CUST-ACCT_CC_CD"
            , AC.COA_ACCT_CD                       AS "CUST-ACCT_ACCT_CD"
            , AC.COA_CH_CD                         AS "CUST-ACCT_CH_CD"
            , AC.COA_PROD_CD                       AS "CUST-ACCT_PROD_CD"
            , AC.COA_AFFL_CD                       AS "CUST-ACCT_AFFL_CD"
            , AC.COA_PROJ_CD                       AS "CUST-ACCT_PROJ_CD"
            , AC.COA_EXTN_CD                       AS "CUST-ACCT_EXTN_CD"
              -- at CUST-SITE
            , NVL(BTC.COA_CMPY_CD, AC.COA_CMPY_CD) AS "CUST-SITE_CMPY_CD"
            , NVL(BTC.COA_BR_CD, AC.COA_BR_CD)     AS "CUST-SITE_BR_CD"
            , NVL(BTC.COA_CC_CD, AC.COA_CC_CD)     AS "CUST-SITE_CC_CD"
            , NVL(BTC.COA_ACCT_CD, AC.COA_ACCT_CD) AS "CUST-SITE_ACCT_CD"
            , NVL(BTC.COA_CH_CD, AC.COA_CH_CD)     AS "CUST-SITE_CH_CD"
            , NVL(BTC.COA_PROD_CD, AC.COA_PROD_CD) AS "CUST-SITE_PROD_CD"
            , NVL(BTC.COA_AFFL_CD, AC.COA_AFFL_CD) AS "CUST-SITE_AFFL_CD"
            , NVL(BTC.COA_PROJ_CD, AC.COA_PROJ_CD) AS "CUST-SITE_PROJ_CD"
            , NVL(BTC.COA_EXTN_CD, AC.COA_EXTN_CD) AS "CUST-SITE_EXTN_CD"
              -- at AT
            , ABC.ASSET_COA_ACCT_CD                AS "AT-ASSET_ACCT_CD"
            , ABC.DEPC_COA_ACCT_CD                 AS "AT-DEPR_EXP_ACCT_CD"
            , ABC.ACCUM_DEPC_COA_ACCT_CD           AS "AT-ACCUM_DEPR_ACCT_CD"
            , ABC.DEPC_ADJ_COA_ACCT_CD             AS "AT-DEPR_ADJ_ACCT_CD"
            , ABC.SLS_PRCD_COA_ACCT_CD             AS "AT-SLS_PROC_ACCT_CD"
            , ABC.RMV_COST_COA_ACCT_CD             AS "AT-RMV_COST_ACCT_CD"
            , ABC.GAIN_LOSS_COA_ACCT_CD            AS "AT-GAIN_LOSS_ACCT_CD"
            , ABC.CLING_COA_ACCT_CD                AS "AT-CLING_ACCT_CD"
            , ABC.ADJ_COA_ACCT_CD                  AS "AT-ADJ_ACCT_CD"
              -- at NEWCORE
            , (CASE WHEN CB.COA_BR_TP_CD = #newcore# THEN ORG.COA_BR_CD
                     ELSE #defBrNewcore# END)      AS "NEWCORE_BR_CD"
            , (CASE WHEN CB.COA_BR_TP_CD = #newcore# THEN ORG.COA_CC_CD
                     ELSE #defCcNewcore# END)      AS "NEWCORE_CC_CD"

          FROM 
               DS_ASSET_MSTR        AM
             , DS_INV_SLS_CR        ISC
             , MDSE_DLY_SNAP_SHOT   MDSE
             , TOC_DLY_SNAP_SHOT    ORG
             , SELL_TO_CUST         AC
             , ASSET_BOOK_CTRL      ABC
             , COA_BR               CB
             , INV                  IV
             , BILL_TO_CUST         BTC

         WHERE 
           AM.GLBL_CMPY_CD          = #glblCmpyCd#
           AND AM.DS_ASSET_MSTR_PK  = #dsAssetMstrpk#
           AND AM.EZCANCELFLAG      = '0'

           AND AM.GLBL_CMPY_CD      = ISC.GLBL_CMPY_CD(+)
           AND AM.AP_VND_INV_NUM    = ISC.INV_NUM(+)
           AND AM.EZCANCELFLAG      = ISC.EZCANCELFLAG(+)

           AND AM.GLBL_CMPY_CD      = MDSE.GLBL_CMPY_CD(+)
           AND AM.MDSE_CD           = MDSE.MDSE_CD(+)
           AND MDSE.LTST_REC_FLG(+) = #flgY#
           AND AM.EZCANCELFLAG      = MDSE.EZCANCELFLAG(+)

           AND AM.GLBL_CMPY_CD      = ORG.GLBL_CMPY_CD(+)
           AND AM.SLS_REP_TOC_CD    = ORG.TOC_CD(+)
           AND AM.EZCANCELFLAG      = ORG.EZCANCELFLAG(+)

           AND AM.GLBL_CMPY_CD      = AC.GLBL_CMPY_CD(+)
           AND AM.SELL_TO_CUST_CD   = AC.SELL_TO_CUST_CD(+)
           AND AM.EZCANCELFLAG      = AC.EZCANCELFLAG (+)

           AND AM.GLBL_CMPY_CD      = ABC.GLBL_CMPY_CD(+)
           AND AM.ASSET_TP_CD       = ABC.ASSET_TP_CD(+)
           AND ABC.EFF_FROM_DT(+)   &lt;= #slsDt#
           AND NVL(ABC.EFF_THRU_DT (+), '99991231') &gt;= #slsDt#
           AND AM.EZCANCELFLAG      = ABC.EZCANCELFLAG(+)

           AND ORG.GLBL_CMPY_CD     = CB.GLBL_CMPY_CD(+)
           AND ORG.COA_BR_CD        = CB.COA_BR_CD(+)
           AND ORG.EZCANCELFLAG     = CB.EZCANCELFLAG(+)

           AND AM.GLBL_CMPY_CD      = IV.GLBL_CMPY_CD(+)
           AND AM.AP_VND_INV_NUM    = IV.INV_NUM(+)
           AND AM.EZCANCELFLAG      = IV.EZCANCELFLAG(+)

           AND IV.GLBL_CMPY_CD      = BTC.GLBL_CMPY_CD(+)
           AND IV.BILL_TO_CUST_CD   = BTC.BILL_TO_CUST_CD(+)
           AND IV.EZCANCELFLAG      = BTC.EZCANCELFLAG(+)
           AND ROWNUM = 1
    </statement>

    <statement id="getSalesRep" parameterClass="Map" resultClass="Map">
        SELECT
            TDSS.TOC_CD
           ,TDSS.COA_BR_CD
           ,TDSS.COA_CC_CD
           ,TDSS.COA_EXTN_CD
        FROM
            TOC_DLY_SNAP_SHOT TDSS
           ,ORG_FUNC_ASG      OFA
           ,S21_PSN           SP
           ,S21_ORG           SO
        WHERE
                TDSS.GLBL_CMPY_CD     = #glblCmpyCd#
            AND TDSS.EZCANCELFLAG     = '0'
            AND TDSS.GLBL_CMPY_CD     = OFA.GLBL_CMPY_CD
            AND TDSS.TOC_CD           = OFA.TOC_CD
            AND OFA.EZCANCELFLAG      = '0'
            AND TDSS.GLBL_CMPY_CD     = SO.GLBL_CMPY_CD 
            AND TDSS.TOC_CD           = SO.TOC_CD
            AND SO.EZCANCELFLAG       = '0'
            AND OFA.GLBL_CMPY_CD      = SP.GLBL_CMPY_CD
            AND OFA.PSN_CD            = SP.PSN_CD
            AND SP.PSN_NUM            = #slsRepTocCd#
            AND SP.EFF_FROM_DT        &lt;= #slsDt#
            AND (SP.EFF_THRU_DT       &gt;= #slsDt#
                 OR SP.EFF_THRU_DT IS NULL)
            AND SP.EZCANCELFLAG       = '0'
    </statement>

</sqlMap>
