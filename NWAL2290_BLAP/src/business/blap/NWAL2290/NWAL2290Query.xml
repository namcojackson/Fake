<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWAL2290Query">

    <statement id="getEopsCpoList" parameterClass="Map" resultClass="Map">
        SELECT
              C.CPO_ORD_NUM
            , DIO.ORD_SRC_REF_NUM
              || '-'
              || DIOC.DS_ORD_POSN_NUM
              || '('
              || DIOC.EOPS_CONFIG_LTR_TXT
              || ')' ORD_SRC_REF_NUM
            , STS.IMPT_STS_DESC_TXT
            , NVL(DIOE_H.DS_IMPT_ORD_ERR_TXT, DIOE_D.DS_IMPT_ORD_ERR_TXT) DS_IMPT_ORD_ERR_TXT
        FROM
              DS_IMPT_ORD          DIO
            , DS_IMPT_ORD_CONFIG   DIOC
            , IMPT_STS             STS
            , CONFIG_CATG          CC
            , (
                SELECT
                      C.CPO_ORD_NUM
                    , C.ORD_SRC_REF_NUM
                    , DCC.CONFIG_CATG_CD
                FROM
                      CPO           C
                    , DS_CPO_CONFIG DCC
                WHERE
                      C.GLBL_CMPY_CD     = #glblCmpyCd#
                  AND C.ORD_SRC_REF_NUM  LIKE #ordSrcRefNum# || '%'
                  AND C.EZCANCELFLAG     = '0'
                  AND C.GLBL_CMPY_CD     = DCC.GLBL_CMPY_CD
                  AND C.CPO_ORD_NUM      = DCC.CPO_ORD_NUM
                  AND DCC.CONFIG_CATG_CD = #configCatgCd_O#
                  AND DCC.EZCANCELFLAG   = '0'
              ) C
            , (
                SELECT
                      DIO.DS_IMPT_ORD_PK
                    , DIOC.DS_IMPT_ORD_CONFIG_PK
                    , DIOE.DS_IMPT_ORD_ERR_TXT
                    , ROW_NUMBER () OVER (
                        ORDER BY
                              DIOE.DS_IMPT_ORD_PK
                            , DIOE.DS_IMPT_ORD_ERR_PK
                      ) ROW_NUM
                FROM
                      DS_IMPT_ORD        DIO
                    , DS_IMPT_ORD_CONFIG DIOC
                    , DS_IMPT_ORD_ERR    DIOE
                WHERE
                      DIO.GLBL_CMPY_CD            = #glblCmpyCd#
                  AND DIO.ORD_SRC_REF_NUM         = #ordSrcRefNum#
                  AND DIO.EZCANCELFLAG            = '0'
                  AND DIO.GLBL_CMPY_CD            = DIOC.GLBL_CMPY_CD
                  AND DIO.DS_IMPT_ORD_PK          = DIOC.DS_IMPT_ORD_PK
                  AND DIOC.CONFIG_CATG_Cd         = #configCatgCd_O#
                  AND DIOC.EMSD_IMPT_STS_CD       = #imptSts_Err#
                  AND DIOC.EZCANCELFLAG           = '0'
                  AND DIO.GLBL_CMPY_CD            = DIOE.GLBL_CMPY_CD
                  AND DIO.DS_IMPT_ORD_PK          = DIOE.DS_IMPT_ORD_PK
                  AND DIOE.DS_IMPT_ORD_CONFIG_PK  IS NULL
                  AND DIOE.EZCANCELFLAG           = '0'
              ) DIOE_H
            , (
                SELECT
                      DIO.DS_IMPT_ORD_PK
                    , DIOC.DS_IMPT_ORD_CONFIG_PK
                    , DIOE.DS_IMPT_ORD_ERR_TXT
                    , ROW_NUMBER () OVER (
                        ORDER BY
                              DIOE.DS_IMPT_ORD_PK
                            , DIOE.DS_IMPT_ORD_CONFIG_PK
                            , DIOE.DS_IMPT_ORD_DTL_PK NULLS FIRST
                            , DIOE.DS_IMPT_ORD_RTRN_DTL_PK NULLS FIRST
                            , DIOE.DS_IMPT_ORD_ERR_PK
                      ) ROW_NUM
                FROM
                      DS_IMPT_ORD        DIO
                    , DS_IMPT_ORD_CONFIG DIOC
                    , DS_IMPT_ORD_ERR    DIOE
                WHERE
                      DIO.GLBL_CMPY_CD              = #glblCmpyCd#
                  AND DIO.ORD_SRC_REF_NUM           = #ordSrcRefNum#
                  AND DIO.EZCANCELFLAG              = '0'
                  AND DIO.GLBL_CMPY_CD              = DIOC.GLBL_CMPY_CD
                  AND DIO.DS_IMPT_ORD_PK            = DIOC.DS_IMPT_ORD_PK
                  AND DIOC.EMSD_IMPT_STS_CD         = #imptSts_Err#
                  AND DIOC.EZCANCELFLAG             = '0'
                  AND DIO.GLBL_CMPY_CD              = DIOE.GLBL_CMPY_CD
                  AND DIO.DS_IMPT_ORD_PK            = DIOE.DS_IMPT_ORD_PK
                  AND DIOE.DS_IMPT_ORD_CONFIG_PK    IS NOT NULL
                  AND DIOE.EZCANCELFLAG             = '0'
              ) DIOE_D
        WHERE
              DIO.GLBL_CMPY_CD            = #glblCmpyCd#
          AND DIO.ORD_SRC_REF_NUM         = #ordSrcRefNum#
          AND DIO.EZCANCELFLAG            = '0'

          AND DIO.GLBL_CMPY_CD            = DIOC.GLBL_CMPY_CD
          AND DIO.DS_IMPT_ORD_PK          = DIOC.DS_IMPT_ORD_PK
          AND DIOC.CONFIG_CATG_CD         = #configCatgCd_O#
          AND DIOC.EZCANCELFLAG           = '0'

          AND DIOC.GLBL_CMPY_CD           = STS.GLBL_CMPY_CD(+)
          AND DIOC.EMSD_IMPT_STS_CD       = STS.IMPT_STS_CD(+)
          AND STS.EZCANCELFLAG(+)         = '0'

          AND DIOC.GLBL_CMPY_CD           = CC.GLBL_CMPY_CD
          AND DIOC.CONFIG_CATG_CD         = CC.CONFIG_CATG_CD
          AND CC.EZCANCELFLAG             = '0'

          AND DIO.ORD_SRC_REF_NUM
              || '-'
              || DIOC.DS_ORD_POSN_NUM
              || '('
              || DIOC.EOPS_CONFIG_LTR_TXT
              || ')'                      = C.ORD_SRC_REF_NUM(+)

          AND DIO.DS_IMPT_ORD_PK          = DIOE_H.DS_IMPT_ORD_PK(+)
          AND DIOC.DS_IMPT_ORD_CONFIG_PK  = DIOE_H.DS_IMPT_ORD_CONFIG_PK(+)
          AND DIOE_H.ROW_NUM(+)           = #rankNum#

          AND DIO.DS_IMPT_ORD_PK          = DIOE_D.DS_IMPT_ORD_PK(+)
          AND DIOC.DS_IMPT_ORD_CONFIG_PK  = DIOE_D.DS_IMPT_ORD_CONFIG_PK(+)
          AND DIOE_D.ROW_NUM(+)           = #rankNum#

        ORDER BY
              CC.CONFIG_CATG_SORT_NUM
            , ORD_SRC_REF_NUM
    </statement>
    
    <!-- 2019/03/27 S21_NA#30765 Add Start -->
    <statement id="getDealConfigCpoList" parameterClass="Map" resultClass="Map">
        SELECT
              C.CPO_ORD_NUM
            , DIO.ORD_SRC_REF_NUM
            , STS.IMPT_STS_DESC_TXT
            , NULL DS_IMPT_ORD_ERR_TXT
        FROM
              CPO                  C
            , DS_IMPT_ORD          DIO
            , IMPT_STS             STS
        WHERE 
            DIO.GLBL_CMPY_CD = #glblCmpyCd#
        AND DIO.ORD_SRC_REF_NUM = #ordSrcRefNum#
        AND DIO.EZCANCELFLAG = '0'

        AND DIO.GLBL_CMPY_CD = C.GLBL_CMPY_CD
        AND DIO.DS_IMPT_ORD_PK = C.DS_IMPT_ORD_PK
        AND C.EZCANCELFLAG = '0'

        AND DIO.GLBL_CMPY_CD = STS.GLBL_CMPY_CD
        AND DIO.IMPT_STS_CD = STS.IMPT_STS_CD
        AND STS.EZCANCELFLAG = '0'
    </statement>
    <!-- 2019/03/27 S21_NA#30765 Add End -->

</sqlMap>