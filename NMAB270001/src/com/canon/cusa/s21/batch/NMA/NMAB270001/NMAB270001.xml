<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAB270001">
    <statement id="getDunsInfoWrk" parameterClass="Map" resultClass="Map">
    SELECT
              DRIW.UPLD_CSV_RQST_PK            AS UPLD_CSV_RQST_PK
            , DRIW.UPLD_CSV_RQST_ROW_NUM       AS UPLD_CSV_RQST_ROW_NUM
            , DRIW.DS_ACCT_NM                  AS DS_ACCT_NM
            , DRIW.LOC_NUM                     AS LOC_NUM
            , DRIW.DUNS_NUM                    AS DUNS_NUM
            , DRIW.DS_PRNT_DUNS_NUM            AS DS_PRNT_DUNS_NUM
            , DRIW.GLN_NUM                     AS GLN_NUM
            , DRIW.DS_ULT_DUNS_NUM             AS DS_ULT_DUNS_NUM
            , DRIW.DS_LOC_REV_AMT              AS DS_LOC_REV_AMT
            , DRIW.DS_LOC_EMP_NUM              AS DS_LOC_EMP_NUM
            , DRIW.DS_CUST_SIC_CD              AS DS_CUST_SIC_CD
            , DRIW.DS_CUST_SIC_DESC_TXT        AS DS_CUST_SIC_DESC_TXT
            , DRIW.DS_CMPY_SIC_CD              AS DS_CMPY_SIC_CD
            , DRIW.DS_ACCT_DUNS_NM             AS DS_ACCT_DUNS_NM
            , PLW.HQ_DUNS_NUM                  AS HQ_DUNS_NUM
            , PLW.DUNS_ACTV_CD                 AS DUNS_ACTV_CD
            , PLW.DUNS_BIZ_NM                  AS DUNS_BIZ_NM
            , PLW.DUNS_TRADE_STYLE_NM          AS DUNS_TRADE_STYLE_NM
            
            , DAP.EFF_FROM_DT                  AS EFF_FROM_DT
            , DAP.EFF_THRU_DT                  AS EFF_THRU_DT
          <!-- ADD CSA-QC#14694 2016/09/21 Start -->
            , DAP.LOC_NUM                      AS ORG_LOC_NUM
          <!-- ADD CSA-QC#14694 2016/09/21 End -->

            , DAP.DS_CUST_SIC_DESC_TXT         AS ACCT_DS_CUST_SIC_DESC_TXT
            , DAP.DS_ACCT_NUM                  AS ORG_DS_ACCT_NUM
            , DAP.DS_ACCT_NM                   AS ORG_DS_ACCT_NM
          <!-- DELETE CSA-QC#14694 2016/09/21 
            , DAP.LOC_NUM                      AS ORG_LOC_NUM
           -->
            , DAP.DS_ACCT_DUNS_NUM             AS DS_ACCT_DUNS_NUM
            , DAP.DS_ACCT_ALT_NM               AS DS_ACCT_ALT_NM
            , DAP.DS_ACCT_DLR_CD               AS DS_ACCT_DLR_CD
            , DAP.DS_ACCT_LEGAL_NM             AS DS_ACCT_LEGAL_NM
            , DAP.DBA_NM                       AS DBA_NM
            , DAP.RGTN_STS_CD                  AS RGTN_STS_CD
            , DAP.DS_ACCT_URL                  AS DS_ACCT_URL
            , DAP.DS_ACCT_CLS_CD               AS DS_ACCT_CLS_CD
            , DAP.COA_CH_CD                    AS COA_CH_CD
            , DAP.COA_AFFL_CD                  AS COA_AFFL_CD
            , DAP.DS_XTRNL_REF_TXT             AS DS_XTRNL_REF_TXT
            , DAP.DS_DATA_SRC_TXT              AS DS_DATA_SRC_TXT
            , DAP.FIRST_REF_CMNT_TXT           AS FIRST_REF_CMNT_TXT
            , DAP.SCD_REF_CMNT_TXT             AS SCD_REF_CMNT_TXT
            , DAP.DS_ACCT_ITRL_FLG             AS DS_ACCT_ITRL_FLG
            , DAP.DS_ULT_DUNS_NUM              AS ACCT_DS_ULT_DUNS_NUM
            , DAP.DS_LOC_REV_AMT               AS ACCT_DS_LOC_REV_AMT
            , DAP.DS_LOC_EMP_NUM               AS ACCT_DS_LOC_EMP_NUM
            , DAP.DS_ULT_DUNS_NUM              AS ACCT_DS_ULT_DUNS_NUM
            
            , NVL(PLW.DUNS_SEND_CNT, 0)        AS DUNS_SEND_CNT
            , PLW.DS_LAST_RCV_DUNS_DT          AS DS_LAST_RCV_DUNS_DT
            , PLW.DS_LAST_RCV_DUNS_TXT         AS DS_LAST_RCV_DUNS_TXT
            , PLW.LINE_BIZ_TP_CD               AS LINE_BIZ_TP_CD
            , PLW.DS_INSD_CTY_LIMIT_FLG        AS DS_INSD_CTY_LIMIT_FLG
            , PLW.DS_LOC_NM                    AS DS_LOC_NM
            , PLW.DUNS_LINE_ADDR               AS DUNS_LINE_ADDR
            
            , PLW.FIRST_LINE_ADDR              AS FIRST_LINE_ADDR
            , PLW.SCD_LINE_ADDR                AS SCD_LINE_ADDR
            , PLW.THIRD_LINE_ADDR              AS THIRD_LINE_ADDR
            , PLW.FRTH_LINE_ADDR               AS FRTH_LINE_ADDR
            , PLW.CTY_ADDR                     AS CTY_ADDR
            , PLW.ST_CD                        AS ST_CD
            , PLW.POST_CD                      AS POST_CD
            , PLW.CTRY_CD                      AS CTRY_CD
            , PLW.ADDL_LOC_NM                  AS ADDL_LOC_NM
            , PLW.GLN_NUM                      AS GLN_NUM
            , PLW.TEL_NUM                      AS TEL_NUM
            , PLW.FAX_NUM                      AS FAX_NUM
            , PLW.PROV_NM                      AS PROV_NM
            , PLW.GEO_CD                       AS GEO_CD
           
            , CNTY.CNTY_NM                     AS CNTY_NM 
        FROM
            PROS_DUNS_RVW_INFO_WRK DRIW
            , DS_ACCT_PROS         DAP
            , PROS_PTY_LOC_WRK     PLW
            , CNTY 
        WHERE
            DRIW.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DRIW.EZCANCELFLAG     = '0' 
            AND DRIW.UPLD_CSV_RQST_PK = #upldCsvRqstPk# 

            AND DRIW.LOC_NUM                 = DAP.LOC_NUM(+)
            AND DRIW.GLBL_CMPY_CD            = DAP.GLBL_CMPY_CD(+)
            AND DRIW.EZCANCELFLAG            = DAP.EZCANCELFLAG(+)
            AND DAP.RGTN_STS_CD(+)          != #rgtnStsCdP99#
            AND DAP.DS_ACCT_ACTV_CUST_FLG(+) = 'Y' 

            AND DAP.GLBL_CMPY_CD    = PLW.GLBL_CMPY_CD(+)
            AND DAP.EZCANCELFLAG    = PLW.EZCANCELFLAG(+)
            AND DAP.LOC_NUM         = PLW.LOC_NUM(+)
            AND PLW.RGTN_STS_CD(+) = #rgtnStsCdP20#

            AND PLW.GLBL_CMPY_CD = CNTY.GLBL_CMPY_CD(+)
            AND PLW.EZCANCELFLAG = CNTY.EZCANCELFLAG(+)
            AND PLW.CNTY_PK      = CNTY.CNTY_PK(+) 
        ORDER BY
            DRIW.UPLD_CSV_RQST_PK ASC
            , DAP.DS_ACCT_NUM ASC
            , DRIW.LOC_NUM ASC
            , DRIW.UPLD_CSV_RQST_ROW_NUM ASC
    </statement>
</sqlMap>
