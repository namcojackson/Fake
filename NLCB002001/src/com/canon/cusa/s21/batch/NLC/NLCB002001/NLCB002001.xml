<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLCB002001">
    <statement id="getAdjustmentData" parameterClass="Map">
     SELECT
         NL.INVTY_LOC_CD              INVTY_LOC_CD
        ,NL.CODE_ITEM_IF              CODE_ITEM_IF
        ,NL.CODE_STAT_STOCK_IF        CODE_STAT_STOCK_IF
        ,NL.SIGN_IF                   SIGN_IF
        ,TO_NUMBER(NL.QTY_ADJUST_IF)  QTY_ADJUST_IF
        ,NL.PHYS_INVTY_NUM            PHYS_INVTY_NUM
        ,NL.SEGMENT_ID                SEGMENT_ID
        ,NL.UNIT_ID                   UNIT_ID
        ,NL.SEQ_NUMBER                SEQ_NUMBER
        ,NL.SER_NUM                   SER_NUM
        ,NL.PHYS_INVTY_ADJ_NM         PHYS_INVTY_ADJ_NM
        ,NL.CONFIG_MSTR_NUM           CONFIG_MSTR_NUM
        ,PIC.PHYS_INVTY_CTRL_PK       PHYS_INVTY_CTRL_PK
        ,PIC.PHYS_INVTY_CTRL_NM       PHYS_INVTY_CTRL_NM
        ,PIC.PHYS_INVTY_DT            PHYS_INVTY_DT
        ,PIC.RTL_WH_CD                RTL_WH_CD
        ,PIC.RTL_SWH_CD               RTL_SWH_CD
        ,PIC.PHYS_INVTY_STS_CD        PHYS_INVTY_STS_CD
        ,PIC.PHYS_INVTY_STS_NM        PHYS_INVTY_STS_NM
        ,MD.FIRST_PROD_CTRL_CD        FIRST_PROD_CTRL_CD
        ,NVL(INV.INVTY_QTY,0)         INVTY_QTY
        ,MD.RCV_SER_TAKE_FLG          RCV_SER_TAKE_FLG
        ,RW.WMS_WH_CD                 WMS_WH_CD
     FROM
         NLCI0330_01     NL
        ,PHYS_INVTY_CTRL PIC
        ,MDSE            MD
        ,INVTY           INV
        ,RTL_SWH         RS
        ,RTL_WH          RW
     WHERE
         NL.INTERFACE_ID       =  #interfaceId#
     AND NL.TRANSACTION_ID     =  #transactionId#
     AND NL.CODE_ITEM_IF       =  MD.MDSE_CD (+)
     AND MD.GLBL_CMPY_CD (+)   =  #glblCmpyCd#
     AND NL.PHYS_INVTY_NUM     =  PIC.PHYS_INVTY_NUM (+)
     AND NL.INVTY_LOC_CD       =  PIC.WH_CD (+)
     AND PIC.GLBL_CMPY_CD (+)  =  #glblCmpyCd#
     AND NL.CODE_ITEM_IF       =  INV.MDSE_CD (+)
     AND NL.CODE_STAT_STOCK_IF =  INV.STK_STS_CD (+)
     AND NL.INVTY_LOC_CD       =  INV.INVTY_LOC_CD (+)
     AND INV.GLBL_CMPY_CD (+)  =  #glblCmpyCd#
     AND INV.LOC_STS_CD (+)    =  #locStsCd#
     AND NL.INVTY_LOC_CD       =  RS.INVTY_LOC_CD (+)
     AND RS.GLBL_CMPY_CD (+)   =  #glblCmpyCd#
     AND RS.GLBL_CMPY_CD       =  RW.GLBL_CMPY_CD (+)
     AND RS.RTL_WH_CD          =  RW.RTL_WH_CD (+)
     AND NL.EZCANCELFLAG       =  '0'
     AND PIC.EZCANCELFLAG (+)  =  '0'
     AND MD.EZCANCELFLAG (+)   =  '0'
     AND INV.EZCANCELFLAG (+)  =  '0'
     AND RS.EZCANCELFLAG (+)   =  '0'
     AND RW.EZCANCELFLAG (+)   =  '0'
     ORDER BY
         NL.PHYS_INVTY_NUM
        ,NL.INVTY_LOC_CD
        ,MD.FIRST_PROD_CTRL_CD
        ,NL.CODE_ITEM_IF
        ,NL.CODE_STAT_STOCK_IF
        ,NL.SIGN_IF
        ,NL.SER_NUM
    </statement>

    <statement id="getAvailDcStock" parameterClass="Map">
     SELECT
            AV.STK_STS_CD       STK_STS_CD
     FROM
            AVAL_INVTY_APP_ID   AV
     WHERE
            AV.GLBL_CMPY_CD  =  #glblCmpyCd#
       AND  AV.LOC_STS_CD    =  #locStsCd#
       AND  AV.BIZ_APP_ID    =  #bizAppId#
       AND  AV.EZCANCELFLAG  =  '0'
    </statement>
    <statement id ="getPhysInvtyCtrlPk" parameterClass="Map" resultClass="BigDecimal">
         SELECT
             PIC.PHYS_INVTY_CTRL_PK
         FROM
             PHYS_INVTY_CTRL PIC
         WHERE
             PIC.PHYS_INVTY_NUM = #physInvtyNum#
         AND PIC.GLBL_CMPY_CD   = #glblCmpyCd#
         AND PIC.EZCANCELFLAG   = '0'
    </statement>
    <statement id ="getConfigId" parameterClass="Map" resultClass="BigDecimal">
         SELECT
             COUNT(SMM.SVC_MACH_MSTR_PK)
         FROM
             SVC_MACH_MSTR SMM
         WHERE
             SMM.SVC_CONFIG_MSTR_PK = #configMstrPk#
         AND SMM.CUR_LOC_NUM        = #curlocNum#
         AND SMM.GLBL_CMPY_CD       = #glblCmpyCd#
         AND SMM.EZCANCELFLAG       = '0'
    </statement>
    <statement id ="getAdjustmentPhysInvtyNum" parameterClass="Map" resultClass="BigDecimal">
        SELECT DISTINCT
             NL.PHYS_INVTY_NUM
        FROM
            NLCI0330_01     NL
        WHERE
            NL.INTERFACE_ID       =  #interfaceId#
        AND NL.TRANSACTION_ID     =  #transactionId#
        AND NL.EZCANCELFLAG       =  '0'
    </statement>
    <statement id ="getNoDataWH" parameterClass="Map" resultClass="Map">
        SELECT
             PIC.PHYS_INVTY_CTRL_PK
            ,PIC.PHYS_INVTY_CTRL_NM
            ,PIC.PHYS_INVTY_DT
            ,PIC.WH_CD AS INVTY_LOC_CD
            ,PIC.RTL_WH_CD
            ,PIC.RTL_SWH_CD
        FROM (
            SELECT
                 PIC.WH_CD
                ,PIC.PHYS_INVTY_CTRL_PK
                ,COUNT(NL.INVTY_LOC_CD) CNT 
            FROM
                 PHYS_INVTY_CTRL PIC
                ,NLCI0330_01     NL
            WHERE
                PIC.GLBL_CMPY_CD   = #glblCmpyCd#
            AND PIC.PHYS_INVTY_NUM = #physInvtyNum#
            AND PIC.PHYS_INVTY_NUM = NL.PHYS_INVTY_NUM(+)
            AND PIC.WH_CD          = NL.INVTY_LOC_CD(+)
            AND PIC.EZCANCELFLAG   = '0'
            AND NL.EZCANCELFLAG(+) = '0'
            GROUP BY
                 PIC.PHYS_INVTY_CTRL_PK
                ,PIC.WH_CD
        )                MAIN
        ,PHYS_INVTY_CTRL PIC
        WHERE MAIN.CNT = 0
        AND PIC.GLBL_CMPY_CD       = #glblCmpyCd#
        AND PIC.PHYS_INVTY_CTRL_PK = MAIN.PHYS_INVTY_CTRL_PK
        AND PIC.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getPIControlsFromPINumer" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            PIC.PHYS_INVTY_CTRL_PK
        FROM
            PHYS_INVTY_CTRL PIC
        WHERE
                PIC.GLBL_CMPY_CD                        =    #glblCmpyCd#
            AND PIC.PHYS_INVTY_NUM                      =    #physInvtyNum#
            AND PIC.EZCANCELFLAG                        =    '0'
    </statement>

<!-- START 2019/05/22 T.Ogura [QC#50055,ADD] -->
    <statement id="getPhysInvtyCtrlCancelCnt" parameterClass="Map" resultClass="BigDecimal">
     SELECT
         COUNT(1)
     FROM
         NLCI0330_01     NL
        ,PHYS_INVTY_CTRL PIC
     WHERE
         NL.INTERFACE_ID       =  #interfaceId#
     AND NL.TRANSACTION_ID     =  #transactionId#
     AND NL.PHYS_INVTY_NUM     =  PIC.PHYS_INVTY_NUM
     AND NL.INVTY_LOC_CD       =  PIC.WH_CD
     AND PIC.GLBL_CMPY_CD      =  #glblCmpyCd#
     AND PIC.PHYS_INVTY_STS_CD =  #physInvtyStsCd_Cancel#
     AND NL.EZCANCELFLAG       =  '0'
     AND PIC.EZCANCELFLAG      =  '0'
    </statement>
<!-- END   2019/05/22 T.Ogura [QC#50055,ADD] -->

</sqlMap>
