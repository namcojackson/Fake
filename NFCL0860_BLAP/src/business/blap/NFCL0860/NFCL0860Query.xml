<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NFCL0860Query">

    <typeAlias alias="NFCL0860SMsg"		type="business.blap.NFCL0860.NFCL0860SMsg"/>
    <typeAlias alias="NFCL0860_ASMsg"  type="business.blap.NFCL0860.NFCL0860_ASMsg"/>

     <statement id="getInvHead" parameterClass="Map" resultMap="result.getInvHead">
         SELECT
              AB.BILL_TO_CUST_ACCT_CD          AB_BILL_TO_CUST_ACCT_CD
             ,AB.BILL_TO_CUST_CD               AB_BILL_TO_CUST_CD
             ,AB.AR_TRX_NUM                    AB_AR_TRX_NUM
             ,AB.AR_TRX_BAL_PK                 AB_AR_TRX_BAL_PK
             ,AB.EZUPTIME                      AB_LAST_UPD_TS
             ,AB.EZUPTIMEZONE                  AB_TZ
             ,AB.DEAL_CCY_CD                   AB_DEAL_CCY_CD
             <!-- START 2021/11/11 G.Delgado [QC#55788, ADD] -->
             ,AB.AR_TRX_TP_CD                  AB_AR_TRX_TP_CD
             <!-- END 2021/11/11 G.Delgado [QC#55788, ADD] -->
         FROM
              AR_TRX_BAL AB
         WHERE
                  AB.GLBL_CMPY_CD                  = #glblCmpyCd#
              AND AB.AR_TRX_NUM                    = #invNum#
              AND AB.EZCANCELFLAG                  = '0'
    </statement>

    <resultMap id="result.getInvHead" class="NFCL0860SMsg">
        <result property="billToCustAcctCd_AB"                column="AB_BILL_TO_CUST_ACCT_CD"      javaType="EZDSStringItem"/>
        <result property="billToCustCd_AB"                    column="AB_BILL_TO_CUST_CD"           javaType="EZDSStringItem"/>
        <result property="arTrxNum_AB"                        column="AB_AR_TRX_NUM"                javaType="EZDSStringItem"/>
        <result property="arTrxBalPk_AB"                      column="AB_AR_TRX_BAL_PK"             javaType="EZDSBigDecimalItem"/>
        <result property="ezUpTime_AB"                        column="AB_LAST_UPD_TS"               javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_AB"                    column="AB_TZ"                        javaType="EZDSStringItem"/>
        <result property="dealCcyCd_AB"                       column="AB_DEAL_CCY_CD"               javaType="EZDSStringItem"/>
        <!-- START 2021/11/11 G.Delgado [QC#55788, ADD] -->
        <result property="arTrxTpCd_AB"                       column="AB_AR_TRX_TP_CD"              javaType="EZDSStringItem"/>
        <!-- END 2021/11/11 G.Delgado [QC#55788, ADD] -->
    </resultMap>

    <statement id="getInvList" parameterClass="Map" resultMap="result.getInvList">
        SELECT
             X.AA1_LAST_UPD_TS
            ,X.AA1_TZ
            ,X.AA1_AR_CASH_APP_PK
            ,X.AA1_AR_CASH_APP_SQ_NUM
            ,X.AA1_AR_TRX_NUM
            ,X.AR_TRX_TP_DESC_TXT
            ,X.AR_SCR_CANC_FLG
            ,X.AR_ADJ_TP_DESC_TXT
            ,X.AR_TRX_NUM
            ,X.DEAL_APPLY_AMT
            ,X.CASH_APP_DT
            ,X.GL_DT
            ,X.AA2_LAST_UPD_TS
            ,X.AA2_TZ
            ,X.AA2_AR_CASH_APP_PK
            ,X.AA2_AR_CASH_APP_SQ_NUM
            ,X.AB1_AR_TRX_BAL_PK
            ,X.AR_TRX_DT
            ,X.DEAL_ORIG_GRS_AMT
            ,X.ADJ_CMNT_TXT
            ,X.AR_WRT_OFF_NOTE_TXT
            ,X.AB1_AR_TRX_NUM
            ,X.AB1_BILL_TO_CUST_ACCT_CD
            ,X.AB1_BILL_TO_CUST_CD
            ,X.AB1_LAST_UPD_TS
            ,X.AB1_TZ
            ,X.AB1_AR_TRX_TP_CD
            ,X.AB1_DEAL_CCY_CD
            ,X.AB2_DEAL_CCY_CD
            ,X.AR_RCPT_NUM
            ,X.AR_LAST_UPD_TS
            ,X.AR_TZ
            ,X.AB2_AR_TRX_BAL_PK
            ,X.AB2_LAST_UPD_TS
            ,X.AB2_TZ
            ,X.AB2_GL_DT
            ,X.ACCT_DT
            ,X.PG_NUM
            ,X.AR_ADJ_STS_NM
            <!-- START 2019/10/04 QC#53891,ADD] -->
            ,X.AR_CUST_REF_NUM    
            ,X.ORIG_AR_TRX_NUM    
            <!-- END 2019/10/04 QC#53891,ADD] -->
        <!-- START 2022/04/22 K.Suzuki [QC#59333, ADD] -->
            ,X.AR_ADJ_TP_CD
        <!-- END   2022/04/22 K.Suzuki [QC#59333, ADD] -->
        FROM
            (SELECT
                 ''                              AA1_LAST_UPD_TS
                ,''                              AA1_TZ
                ,AA.AR_CASH_APP_PK               AA1_AR_CASH_APP_PK
                ,AA.AR_CASH_APP_SQ_NUM           AA1_AR_CASH_APP_SQ_NUM
                ,''                              AA1_AR_TRX_NUM
                ,'Payment'                       AR_TRX_TP_DESC_TXT
                ,AA.AR_SCR_CANC_FLG              AR_SCR_CANC_FLG
                <!-- START 2016/05/17 S.Fujita [QC#7988,MOD] -->
                ,RS.AR_RCPT_SRC_NM               AR_ADJ_TP_DESC_TXT
                <!-- END 2016/05/17 S.Fujita [QC#7988,MOD] -->
                ,AA.RCPT_NUM                     AR_TRX_NUM
                ,AA.DEAL_APPLY_AMT * -1          DEAL_APPLY_AMT
                ,AA.CASH_APP_DT                  CASH_APP_DT
                ,AA.GL_DT                        GL_DT
                ,''                              AA2_LAST_UPD_TS
                ,''                              AA2_TZ
                ,AA.AR_CASH_APP_PK               AA2_AR_CASH_APP_PK
                ,AA.AR_CASH_APP_SQ_NUM           AA2_AR_CASH_APP_SQ_NUM
                ,AA.AR_CASH_APP_PK               AB1_AR_TRX_BAL_PK
                ,AR.RCPT_DT                      AR_TRX_DT
                <!-- start 2016/05/16 match sign with amount applied -->
                ,(CASE WHEN (AA.DEAL_APPLY_AMT * -1) &lt; 0 
                       THEN ABS(AR.DEAL_RCPT_AMT) * -1
                       ELSE ABS(AR.DEAL_RCPT_AMT) END) DEAL_ORIG_GRS_AMT
                <!-- end 2016/05/16 -->
                ,''                              ADJ_CMNT_TXT
                ,''                              AR_WRT_OFF_NOTE_TXT
                ,''                              AB1_AR_TRX_NUM
                ,''                              AB1_BILL_TO_CUST_ACCT_CD
                ,''                              AB1_BILL_TO_CUST_CD
                ,''                              AB1_LAST_UPD_TS
                ,''                              AB1_TZ
                ,''                              AB1_AR_TRX_TP_CD
                ,''                              AB1_DEAL_CCY_CD
                ,''                              AB2_DEAL_CCY_CD
                ,''                              AR_RCPT_NUM
                ,''                              AR_LAST_UPD_TS
                ,''                              AR_TZ
                ,AA.AR_CASH_APP_PK               AB2_AR_TRX_BAL_PK
                ,''                              AB2_LAST_UPD_TS
                ,''                              AB2_TZ
                ,''                              AB2_GL_DT
                ,AD.ACCT_DT                      ACCT_DT
                ,'1'                             PG_NUM
                ,'Applied'                       AR_ADJ_STS_NM
                <!-- START 2019/10/04 QC#53891,ADD] -->
                ,AR.RCPT_CHK_NUM                 AR_CUST_REF_NUM
                ,''                              ORIG_AR_TRX_NUM
                <!-- END 2019/10/04 QC#53891,ADD] -->
        <!-- START 2022/04/22 K.Suzuki [QC#59333, ADD] -->
                ,''                              AR_ADJ_TP_CD
        <!-- END   2022/04/22 K.Suzuki [QC#59333, ADD] -->
            FROM
                AR_CASH_APP AA
               ,AR_RCPT     AR
               ,AR_ACCT_DT  AD
               <!-- START 2016/05/17 S.Fujita [QC#7988,MOD] -->
               ,AR_RCPT_SRC RS
               <!-- END 2016/05/17 S.Fujita [QC#7988,MOD] -->
            WHERE
                    AA.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AA.AR_TRX_NUM                = #invNum#
                <!-- 2016/05/13 deleted cancel flag condition.-->
                <!-- add 2016/04/08 missing -->
                <!-- AND AA.AR_SCR_CANC_FLG           = 'N'-->
                <!-- end 2016/04/08 -->
                <!-- end 2016/05/13 -->
                AND AR.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AR.RCPT_NUM                  = AA.RCPT_NUM
                AND AR.AR_RCPT_TRX_TP_CD        != #offset#
                AND AD.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AD.SUB_SYS_CD                = #nfc#
                AND AD.ONL_BAT_TP_CD             = '1'
                <!-- START 2016/05/17 S.Fujita [QC#7988,MOD] -->
                AND AR.GLBL_CMPY_CD              = RS.GLBL_CMPY_CD(+)
                AND AR.AR_RCPT_SRC_CD            = RS.AR_RCPT_SRC_CD(+)
                <!-- END 2016/05/17 S.Fujita [QC#7988,MOD] -->
                AND AA.EZCANCELFLAG              = '0'
                AND AR.EZCANCELFLAG              = '0'
                AND AD.EZCANCELFLAG              = '0'
                <!-- START 2016/05/17 S.Fujita [QC#7988,MOD] -->
                AND RS.EZCANCELFLAG(+)          = '0'
                <!-- END 2016/05/17 S.Fujita [QC#7988,MOD] -->
            <!-- START 2018/12/05 Y.Matsui [QC#29527,ADD] -->
            UNION ALL
            SELECT
                 ''                              AA1_LAST_UPD_TS
                ,''                              AA1_TZ
                ,AA.AR_CASH_APP_PK               AA1_AR_CASH_APP_PK
                ,AA.AR_CASH_APP_SQ_NUM           AA1_AR_CASH_APP_SQ_NUM
                ,''                              AA1_AR_TRX_NUM
                ,'Offset'                        AR_TRX_TP_DESC_TXT
                ,AA.AR_SCR_CANC_FLG              AR_SCR_CANC_FLG
                ,''                              AR_ADJ_TP_DESC_TXT
                ,AA.RCPT_NUM                     AR_TRX_NUM
                ,AA.DEAL_APPLY_AMT * -1          DEAL_APPLY_AMT
                ,AA.CASH_APP_DT                  CASH_APP_DT
                ,AA.GL_DT                        GL_DT
                ,''                              AA2_LAST_UPD_TS
                ,''                              AA2_TZ
                ,AA.AR_CASH_APP_PK               AA2_AR_CASH_APP_PK
                ,AA.AR_CASH_APP_SQ_NUM           AA2_AR_CASH_APP_SQ_NUM
                ,AA.AR_CASH_APP_PK               AB1_AR_TRX_BAL_PK
                ,AR.RCPT_DT                      AR_TRX_DT
                ,(CASE WHEN (AA.DEAL_APPLY_AMT * -1) &lt; 0
                       THEN ABS(AR.DEAL_RCPT_AMT) * -1
                       ELSE ABS(AR.DEAL_RCPT_AMT) END) DEAL_ORIG_GRS_AMT
                ,''                              ADJ_CMNT_TXT
                ,''                              AR_WRT_OFF_NOTE_TXT
                ,''                              AB1_AR_TRX_NUM
                ,''                              AB1_BILL_TO_CUST_ACCT_CD
                ,''                              AB1_BILL_TO_CUST_CD
                ,''                              AB1_LAST_UPD_TS
                ,''                              AB1_TZ
                ,''                              AB1_AR_TRX_TP_CD
                ,''                              AB1_DEAL_CCY_CD
                ,''                              AB2_DEAL_CCY_CD
                ,''                              AR_RCPT_NUM
                ,''                              AR_LAST_UPD_TS
                ,''                              AR_TZ
                ,AA.AR_CASH_APP_PK               AB2_AR_TRX_BAL_PK
                ,''                              AB2_LAST_UPD_TS
                ,''                              AB2_TZ
                ,''                              AB2_GL_DT
                ,AD.ACCT_DT                      ACCT_DT
                ,'1'                             PG_NUM
                ,'Applied'                       AR_ADJ_STS_NM
                <!-- START 2019/10/04 QC#53891,ADD] -->
                ,AR.RCPT_CHK_NUM                 AR_CUST_REF_NUM
                ,''                              ORIG_AR_TRX_NUM
                <!-- END 2019/10/04 QC#53891,ADD] -->
        <!-- START 2022/04/22 K.Suzuki [QC#59333, ADD] -->
                ,''                              AR_ADJ_TP_CD
        <!-- END   2022/04/22 K.Suzuki [QC#59333, ADD] -->
            FROM
                AR_CASH_APP AA
               ,AR_RCPT     AR
               ,AR_ACCT_DT  AD
            WHERE
                    AA.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AA.AR_TRX_NUM                = #invNum#
                AND AR.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AR.RCPT_NUM                  = AA.RCPT_NUM
                AND AR.AR_RCPT_TRX_TP_CD         = #offset#
                AND EXISTS (
                    SELECT
                        1
                    FROM
                        AR_CASH_APP ACA
                    WHERE
                        ACA.RCPT_NUM         = AR.RCPT_NUM
                    AND ACA.GLBL_CMPY_CD     = AR.GLBL_CMPY_CD
                    AND ACA.EZCANCELFLAG     = '0'
                    GROUP BY
                        ACA.AR_CASH_APP_PK
                    HAVING
                        COUNT(ACA.AR_TRX_NUM) > 2
                     OR COUNT(ACA.AR_ADJ_NUM) > 0
                )
                AND AD.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AD.SUB_SYS_CD                = #nfc#
                AND AD.ONL_BAT_TP_CD             = '1'
                AND AA.EZCANCELFLAG              = '0'
                AND AR.EZCANCELFLAG              = '0'
                AND AD.EZCANCELFLAG              = '0'
            <!-- END 2018/12/05 Y.Matsui [QC#29527,ADD] -->
                UNION ALL
            SELECT
                 AA1.EZUPTIME                    AA1_LAST_UPD_TS
                ,AA1.EZUPTIMEZONE                AA1_TZ
                ,AA1.AR_CASH_APP_PK              AA1_AR_CASH_APP_PK
                ,AA1.AR_CASH_APP_SQ_NUM          AA1_AR_CASH_APP_SQ_NUM
                ,AA1.AR_TRX_NUM                  AA1_AR_TRX_NUM
                ,(CASE
                    WHEN AB1.AR_TRX_TP_CD  = #inv#
                        THEN 'Invoice'
                    WHEN AB1.AR_TRX_TP_CD  = #crm#
                        THEN 'Credit Memo'
                    WHEN AB1.AR_TRX_TP_CD  = #dem#
                        THEN 'Debit Memo'
                    WHEN AB1.AR_TRX_TP_CD  = #acc#
                        THEN 'On Account'
                    WHEN AB1.AR_TRX_TP_CD  = #ded#
                        THEN 'Late Fee'
                    END
                 ) AS AR_TRX_TP_DESC_TXT
                ,AA2.AR_SCR_CANC_FLG             AR_SCR_CANC_FLG
                ,''                              AR_ADJ_TP_DESC_TXT
                ,AA2.AR_TRX_NUM                  AR_TRX_NUM
                ,AA2.DEAL_APPLY_AMT              DEAL_APPLY_AMT
                ,AA2.CASH_APP_DT                 CASH_APP_DT
                ,AA2.GL_DT                       GL_DT
                ,AA2.EZUPTIME                    AA2_LAST_UPD_TS
                ,AA2.EZUPTIMEZONE                AA2_TZ
                ,AA2.AR_CASH_APP_PK              AA2_AR_CASH_APP_PK
                ,AA2.AR_CASH_APP_SQ_NUM          AA2_AR_CASH_APP_SQ_NUM
                ,AB1.AR_TRX_BAL_PK               AB1_AR_TRX_BAL_PK
                ,AB1.AR_TRX_DT                   AR_TRX_DT
                <!-- start 2016/05/16 match sign with amount applied -->
                ,(CASE WHEN AA2.DEAL_APPLY_AMT &lt; 0
                       THEN ABS(AB1.DEAL_ORIG_GRS_AMT) * -1 
                       ELSE ABS(AB1.DEAL_ORIG_GRS_AMT) END) DEAL_ORIG_GRS_AMT
                <!-- end 2016/05/16 -->
                ,''                              ADJ_CMNT_TXT
                <!-- START 2020/01/31 [QC#54826, MOD] -->
                ,AR.AR_RCPT_MISC_CMNT_TXT       AR_WRT_OFF_NOTE_TXT
                <!-- END   2020/01/31 [QC#54826, MOD] -->
                ,AB1.AR_TRX_NUM                  AB1_AR_TRX_NUM
                ,AB1.BILL_TO_CUST_ACCT_CD        AB1_BILL_TO_CUST_ACCT_CD
                ,AB1.BILL_TO_CUST_CD             AB1_BILL_TO_CUST_CD
                ,AB1.EZUPTIME                    AB1_LAST_UPD_TS
                ,AB1.EZUPTIMEZONE                AB1_TZ
                ,AB1.AR_TRX_TP_CD                AB1_AR_TRX_TP_CD
                ,AB1.DEAL_CCY_CD                 AB1_DEAL_CCY_CD
                ,AB2.DEAL_CCY_CD                 AB2_DEAL_CCY_CD
                ,AR.RCPT_NUM                     AR_RCPT_NUM
                ,AR.EZUPTIME                     AR_LAST_UPD_TS
                ,AR.EZUPTIMEZONE                 AR_TZ
                ,AB2.AR_TRX_BAL_PK               AB2_AR_TRX_BAL_PK
                ,AB2.EZUPTIME                    AB2_LAST_UPD_TS
                ,AB2.EZUPTIMEZONE                AB2_TZ
                ,AB2.GL_DT                       AB2_GL_DT
                ,AD.ACCT_DT                      ACCT_DT
                ,'2'                             PG_NUM
                ,'Applied'                       AR_ADJ_STS_NM
                <!-- START 2019/10/04 QC#53891,ADD] -->
                ,AB3.AR_CUST_REF_NUM             AR_CUST_REF_NUM
                ,AB4.AR_TRX_NUM                  ORIG_AR_TRX_NUM
                <!-- END 2019/10/04 QC#53891,ADD] -->
        <!-- START 2022/04/22 K.Suzuki [QC#59333, ADD] -->
                ,''                              AR_ADJ_TP_CD
        <!-- END   2022/04/22 K.Suzuki [QC#59333, ADD] -->
            FROM
                AR_CASH_APP AA1
               ,AR_CASH_APP AA2
               ,AR_TRX_BAL  AB1
               ,AR_RCPT     AR
               ,AR_TRX_BAL  AB2
               ,AR_ACCT_DT  AD
                <!-- START 2019/10/04 QC#53891,ADD] -->
               ,AR_TRX_BAL  AB3
               ,AR_ADJ      ADJ
               ,AR_TRX_BAL  AB4
                <!-- END 2019/10/04 QC#53891,ADD] -->
            WHERE
                    AA1.GLBL_CMPY_CD             = #glblCmpyCd#
                AND AA1.AR_TRX_NUM               = #invNum#
                <!-- 2016/05/13 deleted cancel flag condition.-->
                <!-- AND AA1.AR_SCR_CANC_FLG          = 'N' -->
                <!-- end 2016/05/13 -->
                AND AA2.GLBL_CMPY_CD             = #glblCmpyCd#
                AND AA2.AR_CASH_APP_PK           = AA1.AR_CASH_APP_PK
                AND AA2.AR_TRX_NUM              != AA1.AR_TRX_NUM 
                <!-- 2016/05/13 deleted cancel flag condition.-->
                <!-- AND AA2.AR_SCR_CANC_FLG          = 'N' -->
                <!-- end 2016/05/13 -->
                AND AA2.AR_ADJ_NUM               IS NULL
                AND AB1.GLBL_CMPY_CD             = #glblCmpyCd#
                AND AB1.AR_TRX_BAL_PK            = AA2.AR_TRX_BAL_PK
                AND AR.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AR.RCPT_NUM                  = AA2.RCPT_NUM
                <!-- add 2016/04/08 QC#6750 -->
                AND AR.AR_RCPT_TRX_TP_CD         = #offset#
                <!-- end 2016/04/08 -->
                <!-- START 2018/12/05 Y.Matsui [QC#29527,ADD] -->
                AND NOT EXISTS (
                    SELECT
                        1
                    FROM
                        AR_CASH_APP ACA
                    WHERE
                        ACA.RCPT_NUM         = AR.RCPT_NUM
                    AND ACA.GLBL_CMPY_CD     = AR.GLBL_CMPY_CD
                    AND ACA.EZCANCELFLAG     = '0'
                    GROUP BY
                        ACA.AR_CASH_APP_PK
                    HAVING
                        COUNT(ACA.AR_TRX_NUM) > 2
                     OR COUNT(ACA.AR_ADJ_NUM) > 0
                )
                <!-- END 2018/12/05 Y.Matsui [QC#29527,ADD] -->
                AND AB2.GLBL_CMPY_CD             = #glblCmpyCd#
                AND AB2.AR_TRX_NUM               = AR.RCPT_NUM
                AND AD.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AD.SUB_SYS_CD                = #nfc#
                AND AD.ONL_BAT_TP_CD             = '1'
                AND AA1.EZCANCELFLAG             = '0'
                AND AA2.EZCANCELFLAG             = '0'
                AND AB1.EZCANCELFLAG             = '0'
                AND AR.EZCANCELFLAG              = '0'
                AND AB2.EZCANCELFLAG             = '0'
                AND AD.EZCANCELFLAG              = '0'
                <!-- START 2019/10/04 QC#53891,ADD] -->
                AND AB3.GLBL_CMPY_CD             = AA2.GLBL_CMPY_CD(+)
                AND AB3.AR_TRX_NUM               = AA2.AR_TRX_NUM(+)
                AND AB3.EZCANCELFLAG          (+)= '0'
                AND AB3.GLBL_CMPY_CD             = ADJ.GLBL_CMPY_CD(+)
                AND AB3.ATT_ADJ_NUM              = ADJ.AR_ADJ_NUM(+)
                AND ADJ.EZCANCELFLAG          (+)= '0'
                AND ADJ.GLBL_CMPY_CD             = AB4.GLBL_CMPY_CD(+)
                AND ADJ.ORIG_AR_TRX_BAL_PK       = AB4.AR_TRX_BAL_PK(+)
                AND AB4.EZCANCELFLAG          (+)= '0'
                <!-- END 2019/10/04 QC#53891,ADD] -->
          UNION ALL
         SELECT
                 ''                              AA1_LAST_UPD_TS
                ,''                              AA1_TZ
                ,AA.AR_CASH_APP_PK               AA1_AR_CASH_APP_PK
                ,AA.AR_CASH_APP_SQ_NUM           AA1_AR_CASH_APP_SQ_NUM
                ,''                              AA1_AR_TRX_NUM
                ,'Adjustment'                    AR_TRX_TP_DESC_TXT
                ,AA.AR_SCR_CANC_FLG              AR_SCR_CANC_FLG
                ,AT.AR_ADJ_TP_DESC_TXT           AR_ADJ_TP_DESC_TXT
                ,AJ.AR_ADJ_NUM                   AR_TRX_NUM
                ,AA.DEAL_APPLY_AMT * -1          DEAL_APPLY_AMT
                ,AA.CASH_APP_DT                  CASH_APP_DT
                ,AA.GL_DT                        GL_DT
                ,''                              AA2_LAST_UPD_TS
                ,''                              AA2_TZ
                ,AA.AR_CASH_APP_PK               AA2_AR_CASH_APP_PK
                ,AA.AR_CASH_APP_SQ_NUM           AA2_AR_CASH_APP_SQ_NUM
                ,AA.AR_CASH_APP_PK               B1_AR_TRX_BAL_PK
                ,AA.CASH_APP_DT                  AR_TRX_DT
                ,0                               DEAL_ORIG_GRS_AMT
                ,AJ.ADJ_CMNT_TXT                 ADJ_CMNT_TXT
                ,AJ.AR_WRT_OFF_NOTE_TXT          AR_WRT_OFF_NOTE_TXT
                ,''                              AB1_AR_TRX_NUM
                ,''                              AB1_BILL_TO_CUST_ACCT_CD
                ,''                              AB1_BILL_TO_CUST_CD
                ,''                              AB1_LAST_UPD_TS
                ,''                              AB1_TZ
                ,''                              AB1_AR_TRX_TP_CD
                ,''                              AB1_DEAL_CCY_CD
                ,''                              AB2_DEAL_CCY_CD
                ,''                              AR_RCPT_NUM
                ,''                              AR_LAST_UPD_TS
                ,''                              AR_TZ
                ,AA.AR_CASH_APP_PK               AB2_AR_TRX_BAL_PK
                ,''                              AB2_LAST_UPD_TS
                ,''                              AB2_TZ
                ,''                              AB2_GL_DT
                ,AD.ACCT_DT                      ACCT_DT
                ,'3'                             PG_NUM
                ,'Applied'                       AR_ADJ_STS_NM
                <!-- START 2019/10/04 QC#53891,ADD] -->
                ,''                              AR_CUST_REF_NUM
                ,''                              ORIG_AR_TRX_NUM
                <!-- END 2019/10/04 QC#53891,ADD] -->
        <!-- START 2022/04/22 K.Suzuki [QC#59333, ADD] -->
                ,''                              AR_ADJ_TP_CD
        <!-- END   2022/04/22 K.Suzuki [QC#59333, ADD] -->
            FROM
                AR_ADJ          AJ
               ,AR_CASH_APP     AA
               ,AR_ADJ_TP       AT
               ,AR_ACCT_DT      AD
            WHERE
                    AA.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AA.AR_TRX_NUM                = #invNum#
                <!-- 2016/05/13 deleted cancel flag condition.-->
                <!-- AND AA.AR_SCR_CANC_FLG           = 'N' -->
                <!-- end 2016/05/13 -->
                AND AA.AR_APPLY_TP_CD            = #adj#
                AND AJ.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AJ.AR_ADJ_NUM                = AA.AR_ADJ_NUM
                AND AT.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AT.AR_ADJ_TP_CD              = AJ.AR_ADJ_TP_CD
                AND AD.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AD.SUB_SYS_CD                = #nfc#
                AND AD.ONL_BAT_TP_CD             = '1'
                AND AJ.EZCANCELFLAG              = '0'
                AND AA.EZCANCELFLAG              = '0'
                AND AT.EZCANCELFLAG              = '0'
                AND AD.EZCANCELFLAG              = '0'
        <!-- START 2022/04/22 K.Suzuki [QC#59333, ADD] -->
                AND AT.AR_ADJ_TP_CD              &lt;&gt; #arAdjTpCd#
        <!-- END   2022/04/22 K.Suzuki [QC#59333, ADD] -->
       <!-- Add pattern 4,5 2016/05/13 -->
           UNION ALL
            SELECT
                 ''                              AA1_LAST_UPD_TS
                ,''                              AA1_TZ
                ,NULL                            AA1_AR_CASH_APP_PK
                ,''                              AA1_AR_CASH_APP_SQ_NUM
                ,''                              AA1_AR_TRX_NUM
                ,'Adjustment'                    AR_TRX_TP_DESC_TXT
                ,''                              AR_SCR_CANC_FLG
                ,MAX(AAT.AR_ADJ_TP_DESC_TXT)     AR_ADJ_TP_DESC_TXT
                ,''                              AR_TRX_NUM
                ,0                               DEAL_APPLY_AMT
                ,''                              CASH_APP_DT
                ,''                              GL_DT
                ,''                              AA2_LAST_UPD_TS
                ,''                              AA2_TZ
                ,NULL                            AA2_AR_CASH_APP_PK
                ,''                              AA2_AR_CASH_APP_SQ_NUM
                ,NULL                            B1_AR_TRX_BAL_PK
                ,SUBSTR(MAX(AWOR.EZINTIME), 1, 8)   AR_TRX_DT
                ,MAX(AWOR.WRT_OFF_APPLY_AMT)     DEAL_ORIG_GRS_AMT
                ,MAX(AWON.AR_WRT_OFF_NOTE_DESC_TXT)   ADJ_CMNT_TXT
                ,MAX(AWOR.AR_WRT_OFF_NOTE_TXT)   AR_WRT_OFF_NOTE_TXT
                ,''                              AB1_AR_TRX_NUM
                ,''                              AB1_BILL_TO_CUST_ACCT_CD
                ,''                              AB1_BILL_TO_CUST_CD
                ,''                              AB1_LAST_UPD_TS
                ,''                              AB1_TZ
                ,''                              AB1_AR_TRX_TP_CD
                ,''                              AB1_DEAL_CCY_CD
                ,''                              AB2_DEAL_CCY_CD
                ,''                              AR_RCPT_NUM
                ,''                              AR_LAST_UPD_TS
                ,''                              AR_TZ
                ,NULL                            AB2_AR_TRX_BAL_PK
                ,''                              AB2_LAST_UPD_TS
                ,''                              AB2_TZ
                ,''                              AB2_GL_DT
                ,''                              ACCT_DT
                ,'4'                             PG_NUM
                ,( CASE WHEN MAX(AWOR.AR_DS_WF_STS_CD) = #wfStsCdPending#
                        THEN 'Pending Approval'
                        WHEN MAX(AWOR.AR_DS_WF_STS_CD) = #wfStsCdApproved#
                        THEN 'Approved'
                        ELSE 'Rejected' END) AS AR_ADJ_STS_NM
                <!-- START 2019/10/04 QC#53891,ADD] -->
                ,''                              AR_CUST_REF_NUM
                ,''                              ORIG_AR_TRX_NUM
                <!-- END 2019/10/04 QC#53891,ADD] -->
        <!-- START 2022/04/22 K.Suzuki [QC#59333, ADD] -->
                ,''                              AR_ADJ_TP_CD
        <!-- END   2022/04/22 K.Suzuki [QC#59333, ADD] -->
            FROM AR_WRT_OFF_RQST   AWOR
                ,AR_WRT_OFF_NOTE   AWON
                ,AR_ADJ_TP         AAT
           WHERE AWOR.GLBL_CMPY_CD              = #glblCmpyCd#
             AND AWOR.EZCANCELFLAG              = '0'
             AND AWOR.AR_WRT_OFF_RQST_TP_CD     = #wrtOffScrn#
             AND AWOR.LOW_INV_NUM               = #invNum#
             AND AWOR.PROC_STS_CD               = '0'
             AND AWOR.GLBL_CMPY_CD              = AWON.GLBL_CMPY_CD
             AND AWOR.AR_WRT_OFF_NOTE_CD        = AWON.AR_WRT_OFF_NOTE_CD
             AND AWON.EZCANCELFLAG              = '0'
             AND AWOR.GLBL_CMPY_CD              = AAT.GLBL_CMPY_CD
             AND AWOR.EZCANCELFLAG              = AAT.EZCANCELFLAG
             AND AWOR.AR_ADJ_TP_CD              = AAT.AR_ADJ_TP_CD
             AND AAT.EZCANCELFLAG               = '0'
             
           GROUP BY LOW_INV_NUM
       <!-- end 2016/05/13 -->
        <!-- START 2022/04/22 K.Suzuki [QC#59333, ADD] -->
          UNION ALL
           SELECT
                 AA.EZUPTIME                     AA1_LAST_UPD_TS
                ,AA.EZUPTIMEZONE                 AA1_TZ
                ,AA.AR_CASH_APP_PK               AA1_AR_CASH_APP_PK
                ,AA.AR_CASH_APP_SQ_NUM           AA1_AR_CASH_APP_SQ_NUM
                ,AA.AR_TRX_NUM                   AA1_AR_TRX_NUM
                ,'Adjustment'                    AR_TRX_TP_DESC_TXT
                ,AA.AR_SCR_CANC_FLG              AR_SCR_CANC_FLG
                ,AT.AR_ADJ_TP_DESC_TXT           AR_ADJ_TP_DESC_TXT
                ,AJ.AR_ADJ_NUM                   AR_TRX_NUM
                ,AA.DEAL_APPLY_AMT * -1          DEAL_APPLY_AMT
                ,AA.CASH_APP_DT                  CASH_APP_DT
                ,AA.GL_DT                        GL_DT
                ,AA2.EZUPTIME                    AA2_LAST_UPD_TS
                ,AA2.EZUPTIMEZONE                AA2_TZ
                ,AA2.AR_CASH_APP_PK              AA2_AR_CASH_APP_PK
                ,AA2.AR_CASH_APP_SQ_NUM          AA2_AR_CASH_APP_SQ_NUM
                ,AB.AR_TRX_BAL_PK                B1_AR_TRX_BAL_PK
                ,AA.CASH_APP_DT                  AR_TRX_DT
                ,0                               DEAL_ORIG_GRS_AMT
                ,AJ.ADJ_CMNT_TXT                 ADJ_CMNT_TXT
                ,AJ.AR_WRT_OFF_NOTE_TXT          AR_WRT_OFF_NOTE_TXT
                ,AB.AR_TRX_NUM                   AB1_AR_TRX_NUM
                ,AB.BILL_TO_CUST_ACCT_CD         AB1_BILL_TO_CUST_ACCT_CD
                ,AB.BILL_TO_CUST_CD              AB1_BILL_TO_CUST_CD
                ,AB.EZUPTIME                     AB1_LAST_UPD_TS
                ,AB.EZUPTIMEZONE                 AB1_TZ
                ,AB.AR_TRX_TP_CD                 AB1_AR_TRX_TP_CD
                ,AB.DEAL_CCY_CD                  AB1_DEAL_CCY_CD
                ,AB.DEAL_CCY_CD                  AB2_DEAL_CCY_CD
                ,AR.RCPT_NUM                     AR_RCPT_NUM
                ,AR.EZUPTIME                     AR_LAST_UPD_TS
                ,AR.EZUPTIMEZONE                 AR_TZ
                ,AB2.AR_TRX_BAL_PK               AB2_AR_TRX_BAL_PK
                ,AB2.EZUPTIME                    AB2_LAST_UPD_TS
                ,AB2.EZUPTIMEZONE                AB2_TZ
                ,AB2.GL_DT                       AB2_GL_DT
                ,AD.ACCT_DT                      ACCT_DT
                ,'3'                             PG_NUM
                ,'Applied'                       AR_ADJ_STS_NM
                ,''                              AR_CUST_REF_NUM
                ,''                              ORIG_AR_TRX_NUM
                ,AT.AR_ADJ_TP_CD                 AR_ADJ_TP_CD
            FROM
                AR_ADJ          AJ
               ,AR_CASH_APP     AA
               ,AR_ADJ_TP       AT
               ,AR_ACCT_DT      AD
               ,AR_TRX_BAL      AB
               ,AR_RCPT         AR
               ,AR_CASH_APP     AA2
               ,AR_TRX_BAL      AB2
            WHERE
                    AA.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AA.AR_TRX_NUM                = #invNum#
                AND AA.AR_APPLY_TP_CD            = #adj#
                AND AJ.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AJ.AR_ADJ_NUM                = AA.AR_ADJ_NUM
                AND AT.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AT.AR_ADJ_TP_CD              = AJ.AR_ADJ_TP_CD
                AND AD.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AD.SUB_SYS_CD                = #nfc#
                AND AD.ONL_BAT_TP_CD             = '1'
                AND AJ.EZCANCELFLAG              = '0'
                AND AA.EZCANCELFLAG              = '0'
                AND AT.EZCANCELFLAG              = '0'
                AND AD.EZCANCELFLAG              = '0'
                AND AB.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AB.EZCANCELFLAG              = '0'
                AND AR.GLBL_CMPY_CD              = #glblCmpyCd#
                AND AR.EZCANCELFLAG              = '0'
                AND AA2.GLBL_CMPY_CD             = #glblCmpyCd#
                AND AA2.EZCANCELFLAG             = '0'
                AND AB2.GLBL_CMPY_CD             = #glblCmpyCd#
                AND AB2.EZCANCELFLAG             = '0'
                AND AB.AR_TRX_NUM                = AA.AR_TRX_NUM
                AND AT.AR_ADJ_TP_CD              = #arAdjTpCd#
                AND AB.AR_TRX_NUM                = AA.AR_TRX_NUM
                AND AA.AR_TRX_NUM                = AA2.AR_TRX_NUM
                AND AR.RCPT_NUM                  = AA2.RCPT_NUM
                AND AB2.AR_TRX_NUM               = AA2.RCPT_NUM
        <!-- END   2022/04/22 K.Suzuki [QC#59333, ADD] -->
        <!-- START 2022/06/04 K.Suzuki [QC#59333-1, ADD] -->
                AND AB2.AR_CUST_REF_NUM          = #arCustRefNum#
                AND AB2.UPPER_CUST_ISS_PO_NUM    = #arCustRefNum#
        <!-- END   2022/06/04 K.Suzuki [QC#59333-1, ADD] -->
        <!-- START 2022/06/09 D.Mamaril [QC#59333-2, ADD] -->
                AND AA.AR_CASH_APP_PK            = AA2.AR_CASH_APP_PK
        <!-- END 2022/06/09 D.Mamaril [QC#59333-2, ADD] -->
            ORDER BY
                CASH_APP_DT DESC
               ,AR_TRX_NUM ASC
                 ) X
      WHERE
        ROWNUM &lt;= #rowNum#
    </statement>

    <resultMap id="result.getInvList" class="NFCL0860_ASMsg">
        <result property="arTrxTpDescTxt_A"                   column="AR_TRX_TP_DESC_TXT"                      javaType="EZDSStringItem"/>
        <result property="arScrCancFlg_A"                     column="AR_SCR_CANC_FLG"                         javaType="EZDSStringItem"/>
        <result property="arAdjTpDescTxt_A"                   column="AR_ADJ_TP_DESC_TXT"                      javaType="EZDSStringItem"/>
        <result property="arTrxNum_A"                         column="AR_TRX_NUM"                              javaType="EZDSStringItem"/>
        <result property="arTrxDt_A"                          column="AR_TRX_DT"                               javaType="EZDSDateItem"/>
        <result property="dealOrigGrsAmt_A"                   column="DEAL_ORIG_GRS_AMT"                       javaType="EZDTBigDecimalItem"/>
        <result property="dealApplyAmt_A"                     column="DEAL_APPLY_AMT"                          javaType="EZDTBigDecimalItem"/>
        <result property="cashAppDt_A"                        column="CASH_APP_DT"                             javaType="EZDSDateItem"/>
        <result property="glDt_A"                             column="GL_DT"                                   javaType="EZDSDateItem"/>
        <result property="adjCmntTxt_A"                       column="ADJ_CMNT_TXT"                            javaType="EZDSStringItem"/>
        <result property="arWrtOffNoteTxt_A"                  column="AR_WRT_OFF_NOTE_TXT"                     javaType="EZDSStringItem"/>
        <result property="ezUpTime_A1"                        column="AA1_LAST_UPD_TS"                         javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_A1"                    column="AA1_TZ"                                  javaType="EZDSStringItem"/>
        <result property="ezUpTime_A2"                        column="AA2_LAST_UPD_TS"                         javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_A2"                    column="AA2_TZ"                                  javaType="EZDSStringItem"/>
        <result property="ezUpTime_B1"                        column="AB1_LAST_UPD_TS"                         javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_B1"                    column="AB1_TZ"                                  javaType="EZDSStringItem"/>
        <result property="ezUpTime_B2"                        column="AB2_LAST_UPD_TS"                         javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_B2"                    column="AB2_TZ"                                  javaType="EZDSStringItem"/>
        <result property="ezUpTime_R1"                        column="AR_LAST_UPD_TS"                          javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_R1"                    column="AR_TZ"                                   javaType="EZDSStringItem"/>
        <result property="arTrxBalPk_B1"                      column="AB1_AR_TRX_BAL_PK"                       javaType="EZDTBigDecimalItem"/>
        <result property="arTrxBalPk_B2"                      column="AB2_AR_TRX_BAL_PK"                       javaType="EZDTBigDecimalItem"/>
        <result property="rcptNum_R1"                         column="AR_RCPT_NUM"                             javaType="EZDSStringItem"/>
        <result property="arTrxNum_B1"                        column="AB1_AR_TRX_NUM"                          javaType="EZDSStringItem"/>
        <result property="billToCustAcctCd_B1"                column="AB1_BILL_TO_CUST_ACCT_CD"                javaType="EZDSStringItem"/>
        <result property="billToCustCd_B1"                    column="AB1_BILL_TO_CUST_CD"                     javaType="EZDSStringItem"/>
        <result property="acctDt_AD"                          column="ACCT_DT"                                 javaType="EZDSDateItem"/>
        <result property="xxNum_A"                            column="PG_NUM"                                  javaType="EZDTBigDecimalItem"/>
        <result property="glDt_B2"                            column="AB2_GL_DT"                               javaType="EZDSDateItem"/>
        <result property="arTrxTpCd_B1"                       column="AB1_AR_TRX_TP_CD"                        javaType="EZDSStringItem"/>
        <result property="dealCcyCd_B1"                       column="AB1_DEAL_CCY_CD"                         javaType="EZDSStringItem"/>
        <result property="dealCcyCd_B2"                       column="AB2_DEAL_CCY_CD"                         javaType="EZDSStringItem"/>
        <result property="arCashAppPk_A1"                     column="AA1_AR_CASH_APP_PK"                      javaType="EZDTBigDecimalItem"/>
        <result property="arCashAppSqNum_A1"                  column="AA1_AR_CASH_APP_SQ_NUM"                  javaType="EZDSStringItem"/>
        <result property="arTrxNum_A1"                        column="AA1_AR_TRX_NUM"                          javaType="EZDSStringItem"/>
        <result property="arCashAppPk_A2"                     column="AA2_AR_CASH_APP_PK"                      javaType="EZDTBigDecimalItem"/>
        <result property="arCashAppSqNum_A2"                  column="AA2_AR_CASH_APP_SQ_NUM"                  javaType="EZDSStringItem"/>
        <result property="arAdjStsNm_A"                       column="AR_ADJ_STS_NM"                           javaType="EZDSStringItem"/>
        <!-- START 2019/10/04 QC#53891,ADD] -->
        <result property="arCustRefNum_A"                     column="AR_CUST_REF_NUM"                         javaType="EZDSStringItem"/>
        <result property="arTrxNum_A3"                        column="ORIG_AR_TRX_NUM"                         javaType="EZDSStringItem"/>
        <!-- END 2019/10/04 QC#53891,ADD] -->
        <!-- START 2022/04/22 K.Suzuki [QC#59333, ADD] -->
        <result property="arAdjTpCd_A"                        column="AR_ADJ_TP_CD"                            javaType="EZDSStringItem"/>
        <!-- END   2022/04/22 K.Suzuki [QC#59333, ADD] -->
    </resultMap>
    <!-- START 2021/11/11 G.Delgado [QC#55788, ADD] -->
    <statement id="getInvListForRcp" parameterClass="Map" resultMap="result.getInvList">
        SELECT
              X.AA1_LAST_UPD_TS
            , X.AA1_TZ
            , X.AA1_AR_CASH_APP_PK
            , X.AA1_AR_CASH_APP_SQ_NUM
            , X.AA1_AR_TRX_NUM
            , X.AR_TRX_TP_DESC_TXT
            , X.AR_SCR_CANC_FLG
            , X.AR_ADJ_TP_DESC_TXT
            , X.AR_TRX_NUM
            , X.DEAL_APPLY_AMT
            , X.CASH_APP_DT
            , X.GL_DT
            , X.AA2_LAST_UPD_TS
            , X.AA2_TZ
            , X.AA2_AR_CASH_APP_PK
            , X.AA2_AR_CASH_APP_SQ_NUM
            , X.AB1_AR_TRX_BAL_PK
            , X.AR_TRX_DT
            , X.DEAL_ORIG_GRS_AMT
            , X.ADJ_CMNT_TXT
            , X.AR_WRT_OFF_NOTE_TXT
            , X.AB1_AR_TRX_NUM
            , X.AB1_BILL_TO_CUST_ACCT_CD
            , X.AB1_BILL_TO_CUST_CD
            , X.AB1_LAST_UPD_TS
            , X.AB1_TZ
            , X.AB1_AR_TRX_TP_CD
            , X.AB1_DEAL_CCY_CD
            , X.AB2_DEAL_CCY_CD
            , X.AR_RCPT_NUM
            , X.AR_LAST_UPD_TS
            , X.AR_TZ
            , X.AB2_AR_TRX_BAL_PK
            , X.AB2_LAST_UPD_TS
            , X.AB2_TZ
            , X.AB2_GL_DT
            , X.ACCT_DT
            , X.PG_NUM
            , X.AR_ADJ_STS_NM
            , X.AR_CUST_REF_NUM
            , X.ORIG_AR_TRX_NUM
        FROM
            (
                -- Applied Invoice, Late Fee etc...
                SELECT
                      ACA1.EZUPTIME                  AS AA1_LAST_UPD_TS
                    , ACA1.EZUPTIMEZONE              AS AA1_TZ
                    , ACA1.AR_CASH_APP_PK            AS AA1_AR_CASH_APP_PK
                    , ACA1.AR_CASH_APP_SQ_NUM        AS AA1_AR_CASH_APP_SQ_NUM
                    , ATB1.AR_TRX_NUM                AS AA1_AR_TRX_NUM
                    , (CASE
                        WHEN ATB1.AR_TRX_TP_CD  = #inv#
                            THEN 'Invoice'
                        WHEN ATB1.AR_TRX_TP_CD  = #crm#
                            THEN 'Credit Memo'
                        WHEN ATB1.AR_TRX_TP_CD  = #dem#
                            THEN 'Debit Memo'
                        WHEN ATB1.AR_TRX_TP_CD  = #acc#
                            THEN 'On Account'
                        WHEN ATB1.AR_TRX_TP_CD  = #ded#
                            THEN 'Late Fee'
                        END
                      )                              AS AR_TRX_TP_DESC_TXT
                    , ACA1.AR_SCR_CANC_FLG           AS AR_SCR_CANC_FLG
                    , ARS.AR_RCPT_SRC_NM             AS AR_ADJ_TP_DESC_TXT
                    , ATB1.AR_TRX_NUM                AS AR_TRX_NUM
                    , ACA1.DEAL_APPLY_AMT            AS DEAL_APPLY_AMT
                    , ACA1.CASH_APP_DT               AS CASH_APP_DT
                    , ACA1.GL_DT                     AS GL_DT
                    , ACA1.EZUPTIME                  AS AA2_LAST_UPD_TS
                    , ACA1.EZUPTIMEZONE              AS AA2_TZ
                    , ACA1.AR_CASH_APP_PK            AS AA2_AR_CASH_APP_PK
                    , ACA1.AR_CASH_APP_SQ_NUM        AS AA2_AR_CASH_APP_SQ_NUM
                    , ATB1.AR_TRX_BAL_PK             AS AB1_AR_TRX_BAL_PK
                    , ATB1.AR_TRX_DT                 AS AR_TRX_DT
                    , ATB1.DEAL_ORIG_GRS_AMT         AS DEAL_ORIG_GRS_AMT
                    , ''                             AS ADJ_CMNT_TXT
                    , ''                             AS AR_WRT_OFF_NOTE_TXT
                    , ATB1.AR_TRX_NUM                AS AB1_AR_TRX_NUM
                    , ATB1.BILL_TO_CUST_ACCT_CD      AS AB1_BILL_TO_CUST_ACCT_CD
                    , ATB1.BILL_TO_CUST_CD           AS AB1_BILL_TO_CUST_CD
                    , ATB1.EZUPTIME                  AS AB1_LAST_UPD_TS
                    , ATB1.EZUPTIMEZONE              AS AB1_TZ
                    , ATB1.AR_TRX_TP_CD              AS AB1_AR_TRX_TP_CD
                    , ATB1.DEAL_CCY_CD               AS AB1_DEAL_CCY_CD
                    , ATB1.DEAL_CCY_CD               AS AB2_DEAL_CCY_CD
                    , AR1.RCPT_NUM                   AS AR_RCPT_NUM
                    , AR1.EZUPTIME                   AS AR_LAST_UPD_TS
                    , AR1.EZUPTIMEZONE               AS AR_TZ
                    , ATB1.AR_TRX_BAL_PK             AS AB2_AR_TRX_BAL_PK
                    , ATB1.EZUPTIME                  AS AB2_LAST_UPD_TS
                    , ATB1.EZUPTIMEZONE              AS AB2_TZ
                    , ATB1.GL_DT                     AS AB2_GL_DT
                    , AAD.ACCT_DT                    AS ACCT_DT
                    , '2'                            AS PG_NUM
                    , 'Applied'                      AS AR_ADJ_STS_NM
                    , ATB1.AR_CUST_REF_NUM           AS AR_CUST_REF_NUM
                    , ATB1.AR_TRX_NUM                AS ORIG_AR_TRX_NUM
                FROM
                      AR_CASH_APP           ACA1
                     ,AR_TRX_BAL            ATB1
                     ,AR_RCPT               AR1
                     ,AR_RCPT_SRC           ARS
                     ,AR_ACCT_DT            AAD
                WHERE 1=1
                 AND  ACA1.GLBL_CMPY_CD     = #glblCmpyCd#
                 AND  ACA1.EZCANCELFLAG     = '0'
                 AND  ATB1.GLBL_CMPY_CD     = ACA1.GLBL_CMPY_CD
                 AND  ATB1.EZCANCELFLAG     = '0'
                 AND  AR1.GLBL_CMPY_CD      = ACA1.GLBL_CMPY_CD
                 AND  AR1.EZCANCELFLAG      = '0'
                 AND  ARS.GLBL_CMPY_CD      = ACA1.GLBL_CMPY_CD
                 AND  ARS.EZCANCELFLAG      = '0'
                 AND  AAD.GLBL_CMPY_CD      = ACA1.GLBL_CMPY_CD
                 AND  AAD.EZCANCELFLAG      = '0'
                 AND  AR1.RCPT_NUM          = #receiptNum#
                 AND  ACA1.RCPT_NUM         = AR1.RCPT_NUM
                 AND  ARS.AR_RCPT_SRC_CD    = AR1.AR_RCPT_SRC_CD
                 AND  ACA1.AR_TRX_NUM       IS NOT NULL
                 AND  ACA1.AR_SCR_CANC_FLG  = 'N'
                 AND  ACA1.GLBL_CMPY_CD     = ATB1.GLBL_CMPY_CD
                 AND  ACA1.AR_TRX_BAL_PK    = ATB1.AR_TRX_BAL_PK
                 AND  AAD.SUB_SYS_CD        = #nfc#
                 AND  AAD.ONL_BAT_TP_CD     = #onlBatTpCd#
                 AND  ATB1.AR_TRX_TP_CD NOT IN (#acc#)
           UNION ALL
                -- AR Refund by On Account
                SELECT
                      ''                             AS AA1_LAST_UPD_TS
                    , ''                             AS AA1_TZ
                    , ACA1.AR_CASH_APP_PK            AS AA1_AR_CASH_APP_PK
                    , ACA1.AR_CASH_APP_SQ_NUM        AS AA1_AR_CASH_APP_SQ_NUM
                    , ''                             AS AA1_AR_TRX_NUM
                    ,'Adjustment'                    AR_TRX_TP_DESC_TXT
                    , ACA1.AR_SCR_CANC_FLG           AS AR_SCR_CANC_FLG
                    , AAT.AR_ADJ_TP_DESC_TXT         AS AR_ADJ_TP_DESC_TXT
                    , ACA2.AR_ADJ_NUM                AS AR_TRX_NUM
                    , ARRD.DEAL_RF_AMT * -1          AS DEAL_APPLY_AMT
                    , ATB1.CASH_APP_DT               AS CASH_APP_DT
                    , ATB1.GL_DT                     AS GL_DT
                    , ''                             AS AA2_LAST_UPD_TS
                    , ''                             AS AA2_TZ
                    , ACA1.AR_CASH_APP_PK            AS AA2_AR_CASH_APP_PK
                    , ACA1.AR_CASH_APP_SQ_NUM        AS AA2_AR_CASH_APP_SQ_NUM
                    , ATB1.AR_TRX_BAL_PK             AS AB1_AR_TRX_BAL_PK
                    , ATB1.AR_TRX_DT                 AS AR_TRX_DT
                    , 0                              AS DEAL_ORIG_GRS_AMT
                    , AA.ADJ_CMNT_TXT                AS ADJ_CMNT_TXT
                    , AA.AR_WRT_OFF_NOTE_TXT         AS AR_WRT_OFF_NOTE_TXT
                    , ''                             AS AR_TRX_NUM
                    , ''                             AS AB1_BILL_TO_CUST_ACCT_CD
                    , ''                             AS AB1_BILL_TO_CUST_CD
                    , ''                             AS AB1_LAST_UPD_TS
                    , ''                             AS AB1_TZ
                    , ''                             AS AB1_AR_TRX_TP_CD
                    , ''                             AS AB1_DEAL_CCY_CD
                    , ''                             AS AB2_DEAL_CCY_CD
                    , ''                             AS AR_RCPT_NUM
                    , ''                             AS AR_LAST_UPD_TS
                    , ''                             AS AR_TZ
                    , ACA1.AR_CASH_APP_PK            AS AB2_AR_TRX_BAL_PK
                    , ''                             AS AB2_LAST_UPD_TS
                    , ''                             AS AB2_TZ
                    , ''                             AS AB2_GL_DT
                    , AAD.ACCT_DT                    AS ACCT_DT
                    , '3'                            AS PG_NUM
                    , 'Applied'                      AS AR_ADJ_STS_NM
                    , ''                             AS AR_CUST_REF_NUM
                    , ''                             AS ORIG_AR_TRX_NUM
                FROM
                      AR_CASH_APP           ACA1
                     ,AR_CASH_APP           ACA2
                     ,AR_RCPT               AR1
                     ,AR_TRX_BAL            ATB1
                     ,AR_ACCT_DT            AAD
                     ,AR_RF_RQST_DTL        ARRD
                     ,AR_ADJ                AA
                     ,AR_ADJ_TP             AAT
                WHERE 1=1
                 AND  ACA1.GLBL_CMPY_CD     = #glblCmpyCd#
                 AND  ACA1.EZCANCELFLAG     = '0'
                 AND  AR1.GLBL_CMPY_CD      = ACA1.GLBL_CMPY_CD
                 AND  AR1.EZCANCELFLAG      = '0'
                 AND  AAD.GLBL_CMPY_CD      = ACA1.GLBL_CMPY_CD
                 AND  AAD.EZCANCELFLAG      = '0'
                 AND  ATB1.GLBL_CMPY_CD     = ACA1.GLBL_CMPY_CD
                 AND  ATB1.EZCANCELFLAG     = '0'
                 AND  ARRD.GLBL_CMPY_CD     = ACA1.GLBL_CMPY_CD
                 AND  ARRD.EZCANCELFLAG     = '0'
                 AND  AAT.GLBL_CMPY_CD      = ACA1.GLBL_CMPY_CD
                 AND  AAT.EZCANCELFLAG      = '0'
                 AND  ACA2.GLBL_CMPY_CD     = ACA1.GLBL_CMPY_CD
                 AND  ACA2.EZCANCELFLAG     = '0'
                 AND  AA.GLBL_CMPY_CD       = ACA1.GLBL_CMPY_CD
                 AND  AA.EZCANCELFLAG       = '0'
                 AND  AAD.SUB_SYS_CD        = #nfc#
                 AND  AAD.ONL_BAT_TP_CD     = #onlBatTpCd#
                 AND  ACA1.RCPT_NUM         = #receiptNum#
                 AND  AR1.RCPT_NUM          = ACA1.RCPT_NUM
                 AND  ACA1.AR_TRX_NUM       IS NOT NULL
                 AND  ATB1.AR_TRX_NUM       = ACA1.AR_TRX_NUM
                 AND  ARRD.AR_TRX_NUM       = ACA1.AR_TRX_NUM
                 AND  ACA2.AR_TRX_NUM       = ACA1.AR_TRX_NUM
                 AND  ACA2.AR_APPLY_TP_CD   = 'ADJ'
                 AND  AAT.AR_ADJ_TP_CD      = AA.AR_ADJ_TP_CD
                 AND  AA.AR_ADJ_NUM         = ACA2.AR_ADJ_NUM
           UNION ALL
                -- AR Refund by Receipt
                SELECT
                      ''                             AS AA1_LAST_UPD_TS
                    , ''                             AS AA1_TZ
                    , ACA1.AR_CASH_APP_PK            AS AA1_AR_CASH_APP_PK
                    , ACA1.AR_CASH_APP_SQ_NUM        AS AA1_AR_CASH_APP_SQ_NUM
                    , ''                             AS AA1_AR_TRX_NUM
                    ,'Adjustment'                    AS AR_TRX_TP_DESC_TXT
                    , ACA1.AR_SCR_CANC_FLG           AS AR_SCR_CANC_FLG
                    , AAT.AR_ADJ_TP_DESC_TXT         AS AR_ADJ_TP_DESC_TXT
                    , ACA1.AR_ADJ_NUM                AS AR_TRX_NUM
                    , ARRD.DEAL_RF_AMT * -1          AS DEAL_APPLY_AMT
                    , ATB1.CASH_APP_DT               AS CASH_APP_DT
                    , ATB1.GL_DT                     AS GL_DT
                    , ''                             AS AA2_LAST_UPD_TS
                    , ''                             AS AA2_TZ
                    , ACA1.AR_CASH_APP_PK            AS AA2_AR_CASH_APP_PK
                    , ACA1.AR_CASH_APP_SQ_NUM        AS AA2_AR_CASH_APP_SQ_NUM
                    , ATB1.AR_TRX_BAL_PK             AS AB1_AR_TRX_BAL_PK
                    , ATB1.AR_TRX_DT                 AS AR_TRX_DT
                    , 0                              AS DEAL_ORIG_GRS_AMT
                    , AA.ADJ_CMNT_TXT                AS ADJ_CMNT_TXT
                    , AA.AR_WRT_OFF_NOTE_TXT         AS AR_WRT_OFF_NOTE_TXT
                    , ''                             AS AB1_AR_TRX_NUM
                    , ''                             AS AB1_BILL_TO_CUST_ACCT_CD
                    , ''                             AS AB1_BILL_TO_CUST_CD
                    , ''                             AS AB1_LAST_UPD_TS
                    , ''                             AS AB1_TZ
                    , ''                             AS AB1_AR_TRX_TP_CD
                    , ''                             AS AB1_DEAL_CCY_CD
                    , ''                             AS AB2_DEAL_CCY_CD
                    , ''                             AS AR_RCPT_NUM
                    , ''                             AS AR_LAST_UPD_TS
                    , ''                             AS AR_TZ
                    , ACA1.AR_CASH_APP_PK            AS AB2_AR_TRX_BAL_PK
                    , ''                             AS AB2_LAST_UPD_TS
                    , ''                             AS AB2_TZ
                    , ''                             AS AB2_GL_DT
                    , AAD.ACCT_DT                    AS ACCT_DT
                    , '3'                            AS PG_NUM
                    , 'Applied'                      AS AR_ADJ_STS_NM
                    , ''                             AS AR_CUST_REF_NUM
                    , ''                             AS ORIG_AR_TRX_NUM
                FROM
                      AR_CASH_APP           ACA1
                     ,AR_RCPT               AR1
                     ,AR_TRX_BAL            ATB1
                     ,AR_ACCT_DT            AAD
                     ,AR_RF_RQST_DTL        ARRD
                     ,AR_ADJ                AA
                     ,AR_ADJ_TP             AAT
                WHERE 1=1
                 AND  ACA1.GLBL_CMPY_CD     = #glblCmpyCd#
                 AND  ACA1.EZCANCELFLAG     = '0'
                 AND  AR1.GLBL_CMPY_CD      = ACA1.GLBL_CMPY_CD
                 AND  AR1.EZCANCELFLAG      = '0'
                 AND  AAD.GLBL_CMPY_CD      = ACA1.GLBL_CMPY_CD
                 AND  AAD.EZCANCELFLAG      = '0'
                 AND  ATB1.GLBL_CMPY_CD     = ACA1.GLBL_CMPY_CD
                 AND  ATB1.EZCANCELFLAG     = '0'
                 AND  ARRD.GLBL_CMPY_CD     = ACA1.GLBL_CMPY_CD
                 AND  ARRD.EZCANCELFLAG     = '0'
                 AND  AA.GLBL_CMPY_CD       = ACA1.GLBL_CMPY_CD
                 AND  AA.EZCANCELFLAG       = '0'
                 AND  AAT.GLBL_CMPY_CD      = ACA1.GLBL_CMPY_CD
                 AND  AAT.EZCANCELFLAG      = '0'
                 AND  AAD.SUB_SYS_CD        = #nfc#
                 AND  AAD.ONL_BAT_TP_CD     = #onlBatTpCd#
                 AND  ACA1.RCPT_NUM         = #receiptNum#
                 AND  AR1.RCPT_NUM          = ACA1.RCPT_NUM
                 AND  ATB1.AR_TRX_NUM       = ACA1.RCPT_NUM
                 AND  ARRD.AR_TRX_NUM       = ACA1.RCPT_NUM
                 AND  AA.AR_ADJ_NUM         = ACA1.AR_ADJ_NUM
                 AND  AAT.AR_ADJ_TP_CD      = AA.AR_ADJ_TP_CD
            ) X
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>
    <!-- END 2021/11/11 G.Delgado [QC#55788, ADD] -->

    <!-- START 2022/01/08 K.Suzuki [QC#55788-1, ADD] -->
    <statement id="getReceiptNumFromOnAccount" parameterClass="Map" resultClass="String">
        SELECT
    <!-- START 2022/01/22 K.Suzuki [QC#55788-2, MOD] -->
            <!-- ATB2.AR_TRX_NUM -->
            NVL(ATB2.AR_CUST_REF_NUM,ATB2.AR_TRX_NUM) AR_TRX_NUM
    <!-- END   2022/01/22 K.Suzuki [QC#55788-2, MOD] -->
        FROM
            AR_TRX_BAL    ATB1
           ,AR_TRX_BAL    ATB2
        WHERE
            ATB1.GLBL_CMPY_CD         = #glblCmpyCd#
        AND ATB1.EZCANCELFLAG         = '0'
        AND ATB2.GLBL_CMPY_CD         = #glblCmpyCd#
        AND ATB2.EZCANCELFLAG         = '0'
        AND ATB1.BILL_TO_CUST_ACCT_CD = #billToCustAcctCd#
        AND ATB2.BILL_TO_CUST_ACCT_CD = ATB1.BILL_TO_CUST_ACCT_CD
        AND ATB1.AR_CUST_REF_NUM      = ATB2.AR_CUST_REF_NUM
        AND ATB1.AR_TRX_NUM           = #OnAccountNum#
        AND ATB1.AR_TRX_TP_CD         = #acc#
        AND ATB2.AR_TRX_TP_CD         = #rcp#
        AND ROWNUM                    &lt;= 1
    </statement>
    <!-- END   2022/01/08 K.Suzuki [QC#55788-1, ADD] -->

        <!-- START 2022/04/22 K.Suzuki [QC#59333, ADD] -->
    <statement id="findCancelArApplyIntfcWrk" parameterClass="Map" resultClass="Map">
    SELECT AAIW.APPLY_GRP_KEY
         , AAIW.APPLY_GRP_SUB_PK
      FROM AR_APPLY_INTFC_WRK AAIW
     WHERE AAIW.GLBL_CMPY_CD     = #glblCmpyCd#
       AND AAIW.EZCANCELFLAG     = '0'
       AND AAIW.RCPT_NUM         = #rcptNum#
       AND AAIW.INV_NUM          = #invNum#
    </statement>

    <statement id="findArRfRqst" parameterClass="Map" resultClass="Map">
    SELECT
        ARR.AR_RF_RQST_PK
    FROM
        AR_RF_RQST ARR
    WHERE
        ARR.GLBL_CMPY_CD  = #glblCmpyCd#
    AND ARR.EZCANCELFLAG  = '0'
    AND ARR.AR_RF_RQST_PK IN (
            SELECT
                ARRD.AR_RF_RQST_PK
            FROM
                AR_RF_RQST_DTL ARRD
            WHERE
                ARRD.GLBL_CMPY_CD = #glblCmpyCd#
            AND ARRD.EZCANCELFLAG = '0'
            AND ARRD.AR_TRX_NUM   = #arTrxNum#
            )
    ORDER BY
        ARR.AR_RF_RQST_PK
        <!-- END   2022/04/22 K.Suzuki [QC#59333, ADD] -->
    </statement>
</sqlMap>
