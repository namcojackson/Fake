<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NFBL2080Query">

    <!-- *********************************************************** -->
    <!-- ********** Bean Definition ******************************** -->
    <!-- *********************************************************** -->
    <typeAlias alias="NFBL2080CMsg"      type="business.blap.NFBL2080.NFBL2080CMsg"/>
    
    <statement id="findInvArProcStsList" parameterClass="Map" resultClass="Map">
        SELECT
            INV_AR_PROC_STS_CD
        ,   INV_AR_PROC_STS_CD || ':' || INV_AR_PROC_STS_NM INV_AR_PROC_STS_DESC_TXT
        FROM
            INV_AR_PROC_STS
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND EZCANCELFLAG = '0'
        ORDER BY
            INV_AR_PROC_STS_SORT_NUM ASC
    </statement>
    <statement id="findVndInvList" parameterClass="Map" resultClass="Map">
<!-- START 2019/10/10 [QC#54067,MOD] -->
    SELECT 
        W.VND_INV_NUM
       ,W.VND_INV_BOL_LINE_NUM
       ,W.VND_CD
       ,W.LOC_NM
       ,W.VND_INV_PROC_STS_CD
       ,W.INV_AR_PROC_STS_CD
       ,W.EDI_PO_ORD_NUM
       ,W.PO_ORD_NUM
       ,CASE
            WHEN W.INV_TP_CD = #invTpCd# AND W.ITRL_INTFC_ID = #itrlIntfcId# THEN
                W.INV_TOT_DEAL_NET_AMT * -1
            ELSE
                W.INV_TOT_DEAL_NET_AMT
        END                                     AS INV_TOT_DEAL_NET_AMT
      ,W.CRAT_DT
    FROM
         ( 
         SELECT
                INLINE1.VND_INV_NUM
               ,MAX(INLINE2.VND_INV_BOL_LINE_NUM) VND_INV_BOL_LINE_NUM
               ,MAX(INLINE1.VND_CD)               VND_CD
    <!-- Mod Start QC#12555 -->
               ,MAX(INLINE3.LOC_NM)               LOC_NM
    <!-- Mod End   QC#12555 -->
               ,MAX(INLINE1.VND_INV_PROC_STS_CD)  VND_INV_PROC_STS_CD
               ,MAX(INLINE1.INV_AR_PROC_STS_CD)   INV_AR_PROC_STS_CD
               ,MAX(INLINE2.EDI_PO_ORD_NUM)       EDI_PO_ORD_NUM
    <!-- Mod Start QC#12575 -->
               ,MAX(INLINE2.PO_ORD_NUM)           PO_ORD_NUM
    <!-- Mod End   QC#12575 -->
               ,MAX(NVL(INLINE1.INV_TOT_DEAL_NET_AMT,0))
                                                  INV_TOT_DEAL_NET_AMT
               ,MAX(INLINE1.INV_TP_CD)            INV_TP_CD
               ,MAX(INLINE1.ITRL_INTFC_ID)        ITRL_INTFC_ID
               ,SUBSTR(INLINE1.EZINTIME,0,8)      CRAT_DT
           FROM
                VND_INV_WRK INLINE1
                ,VND_INV_BOL_WRK INLINE2
                ,VND INLINE3
    <!-- Mod Start QC#12632 -->
                 <isNotNull property="cMsg.batErrMsgTxt">
                ,(
                   SELECT
                          INLINE41.VND_INV_NUM
                         ,INLINE41.VND_INV_BOL_LINE_NUM
                     FROM
                          VND_INV_ERR_WRK INLINE41
                    WHERE
                          INLINE41.EZCANCELFLAG = '0'
                      AND INLINE41.GLBL_CMPY_CD = #glblCmpyCd#
                      AND INLINE41.BAT_ERR_MSG_TXT = #cMsg.batErrMsgTxt#
                 GROUP BY
                          INLINE41.VND_INV_NUM, INLINE41.VND_INV_BOL_LINE_NUM
                ) INLINE4
                </isNotNull>
    <!-- Mod End QC#12632 -->
          WHERE
                INLINE1.EZCANCELFLAG         = '0'
            AND INLINE1.GLBL_CMPY_CD         = #glblCmpyCd#
            AND INLINE2.EZCANCELFLAG         = '0'
            AND INLINE1.GLBL_CMPY_CD         = INLINE2.GLBL_CMPY_CD
            AND INLINE1.VND_INV_NUM          = INLINE2.VND_INV_NUM
            AND INLINE3.EZCANCELFLAG(+)      = '0'
            AND INLINE1.GLBL_CMPY_CD         = INLINE3.GLBL_CMPY_CD(+)
            AND INLINE1.VND_CD               = INLINE3.VND_CD(+)
    <!-- Mod Start QC#12632 -->
            <isNotNull property="cMsg.batErrMsgTxt">
            AND INLINE2.VND_INV_NUM          = INLINE4.VND_INV_NUM
            </isNotNull>
    <!-- Mod End QC#12632 -->
            <isNotNull property="cMsg.vndCd">
            AND INLINE1.VND_CD               = #cMsg.vndCd#
            </isNotNull>
            <isNotNull property="cMsg.vndInvProcStsCd_P1">
            AND INLINE1.VND_INV_PROC_STS_CD  = #cMsg.vndInvProcStsCd_P1#
            </isNotNull>
    <!-- Mod End   QC#12760 -->
            <isNotNull property="blankFlg">
            AND INLINE1.INV_AR_PROC_STS_CD IS NULL
            </isNotNull>
            <isNull property="blankFlg">
                <isNotNull property="cMsg.invArProcStsCd_P1">
                AND INLINE1.INV_AR_PROC_STS_CD   = #cMsg.invArProcStsCd_P1#
                </isNotNull>
            </isNull>
    <!-- Mod End   QC#12760 -->
            <isNotNull property="cMsg.vndInvNum">
            AND INLINE1.VND_INV_NUM          = #cMsg.vndInvNum#
            </isNotNull>
            <isNotNull property="cMsg.soNum">
            AND INLINE2.ASN_SO_NUM           = #cMsg.soNum#
            </isNotNull>
    <!-- Mod Start QC#12555 -->
            <isNotNull property="fromDt">
            AND INLINE1.EZINTIME <![CDATA[>=]]> #fromDt#
            </isNotNull>
            <isNotNull property="toDt">
            AND INLINE1.EZINTIME <![CDATA[<=]]> #toDt#
            </isNotNull>
    <!-- Mod End   QC#12555 -->
    <!-- Mod Start QC#12575 -->
            <isNotNull property="cMsg.poOrdNum">
            AND INLINE2.PO_ORD_NUM          = #cMsg.poOrdNum#
            </isNotNull>
            <isNotNull property="cMsg.ediPoOrdNum">
            AND INLINE2.EDI_PO_ORD_NUM      = #cMsg.ediPoOrdNum#
            </isNotNull>
    <!-- Mod End   QC#12575 -->
         GROUP BY
                INLINE1.VND_INV_NUM
               ,SUBSTR(INLINE1.EZINTIME,0,8)
        ) W
<!-- END   2019/10/10 [QC#54067,MOD] -->
    </statement>
    <statement id="findVndInvErrInfo" parameterClass="Map" resultClass="Map">
     SELECT
            INLINE1.VND_INV_NUM
           ,INLINE1.VND_INV_BOL_LINE_NUM
           ,INLINE1.BAT_ERR_MSG_TXT
           ,INLINE1.VND_INV_ERR_MSG_ID
       FROM
            VND_INV_ERR_WRK INLINE1
      WHERE
            INLINE1.EZCANCELFLAG         = '0'
        AND INLINE1.GLBL_CMPY_CD         = #glblCmpyCd#
        AND INLINE1.VND_INV_NUM          = #vndInvNum#
<!-- Mod Start QC#12608 -->
        AND (INLINE1.VND_INV_BOL_LINE_NUM = #vndInvBolLineNum#
         OR  INLINE1.VND_INV_BOL_LINE_NUM IS NULL)
<!-- Mod End   QC#12608 -->
        <isNotNull property="vndInvLineNum">
       AND INLINE1.VND_INV_LINE_NUM         = #vndInvLineNum#
       </isNotNull>
       <isNotNull property="vndInvLineSubNum">
       AND INLINE1.VND_INV_LINE_SUB_NUM     = #vndInvLineSubNum#
       </isNotNull>
       <isNotNull property="vndInvLineSubTrxNum">
       AND INLINE1.VND_INV_LINE_SUB_TRX_NUM = #vndInvLineSubTrxNum#
       </isNotNull>
      ORDER BY
          INLINE1.EZINTIME DESC
    </statement>
    <statement id="findVndInvHeadInfo" parameterClass="Map" resultClass="Map">
    SELECT
           INLINE3.VND_CD
          ,INLINE3.LOC_NM
          ,INLINE1.VND_INV_NUM
          ,INLINE1.CUST_ISS_PO_NUM
          ,INLINE2.ASN_SO_NUM
          ,INLINE1.VND_INV_PROC_STS_CD
<!-- Add Start QC#12575 -->
           ,INLINE2.PO_ORD_NUM
<!-- Add End   QC#12575 -->
          ,INLINE2.EDI_PO_ORD_NUM
          ,INLINE2.VND_INV_BOL_LINE_NUM
<!-- Add Start QC#12555 -->
          ,SUBSTR(INLINE1.EZINTIME,0,8) CRAT_DT
<!-- Add End   QC#12555 -->
<!-- START 2019/05/20 H.Umeda [QC#50204,50205,ADD] -->
          ,INLINE1.INV_TP_CD
          ,INLINE1.ITRL_INTFC_ID
          ,INLINE1.CR_DR_RSN_CD
<!-- END   2019/05/20 H.Umeda [QC#50204,50205,ADD] -->
      FROM
           VND_INV_WRK INLINE1
          ,VND_INV_BOL_WRK INLINE2
          ,VND INLINE3
     WHERE
           INLINE1.EZCANCELFLAG         = '0'
       AND INLINE1.GLBL_CMPY_CD         = #glblCmpyCd#
       AND INLINE2.EZCANCELFLAG         = '0'
       AND INLINE1.GLBL_CMPY_CD         = INLINE2.GLBL_CMPY_CD
       AND INLINE1.VND_INV_NUM          = INLINE2.VND_INV_NUM
       AND INLINE3.EZCANCELFLAG(+)      = '0'
       AND INLINE1.GLBL_CMPY_CD         = INLINE3.GLBL_CMPY_CD(+)
       AND INLINE1.VND_CD               = INLINE3.VND_CD(+)
       AND INLINE1.VND_INV_NUM          = #vndInvNum#
       AND INLINE2.VND_INV_BOL_LINE_NUM = #vndInvBolLineNum#
<!-- Mod Start QC#12575 -->
        <isNull property="poOrdNum">
       AND INLINE2.PO_ORD_NUM       IS NULL
       </isNull>
        <isNotNull property="poOrdNum">
       AND INLINE2.PO_ORD_NUM       = #poOrdNum#
       </isNotNull>
        <isNull property="ediPoOrdNum">
       AND INLINE2.EDI_PO_ORD_NUM       IS NULL
       </isNull>
        <isNotNull property="ediPoOrdNum">
       AND INLINE2.EDI_PO_ORD_NUM       = #ediPoOrdNum#
       </isNotNull>
<!-- Mod End   QC#12575 -->
    </statement>
    <statement id="findVndInvDtlInfo" parameterClass="Map" resultClass="Map">
    SELECT
           INLINE1.VND_CD
          ,INLINE1.VND_INV_NUM
          ,INLINE2.VND_INV_BOL_LINE_NUM
          ,INLINE3.VND_INV_LINE_NUM
          ,INLINE3.VND_INV_LINE_SUB_NUM
          ,INLINE3.VND_INV_LINE_SUB_TRX_NUM
<!-- Add Start QC#12575 -->
          ,INLINE2.PO_ORD_NUM
<!-- Add End   QC#12575 -->
          ,INLINE2.EDI_PO_ORD_NUM
<!-- START 2020/05/26 [QC#56007,MOD] -->
<!--      ,INLINE3.EDI_PO_ORD_DTL_LINE_NUM -->
          ,'' AS EDI_PO_ORD_DTL_LINE_NUM
<!-- END   2020/05/26 [QC#56007,MOD] -->
          ,INLINE2.ASN_SO_NUM
          ,INLINE3.MDSE_CD
          ,INLINE3.MDSE_NM
<!-- START 2019/10/10 [QC#54067,MOD] -->
          ,CASE
              WHEN INLINE1.INV_TP_CD = #invTpCd# AND INLINE1.ITRL_INTFC_ID = #itrlIntfcId# THEN
                  INLINE3.SHIP_QTY * -1
              ELSE
                  INLINE3.SHIP_QTY
           END                           AS SHIP_QTY
          ,CASE
              WHEN INLINE1.INV_TP_CD = #invTpCd# AND INLINE1.ITRL_INTFC_ID = #itrlIntfcId# THEN
                  NVL(INLINE3.VND_INV_LINE_DEAL_NET_AMT,0) * -1
              ELSE
                  NVL(INLINE3.VND_INV_LINE_DEAL_NET_AMT,0)
           END                           AS VND_INV_LINE_DEAL_NET_AMT
<!-- END   2019/10/10 [QC#54067,MOD] -->
<!-- Mod Start QC#16106 -->
          ,1                             AS SORT_NUM
<!-- Mod End QC#16106 -->
      FROM
           VND_INV_WRK INLINE1
          ,VND_INV_BOL_WRK INLINE2
          ,VND_INV_LINE_WRK INLINE3
     WHERE
           INLINE1.EZCANCELFLAG             = '0'
       AND INLINE1.GLBL_CMPY_CD             = #glblCmpyCd#
       AND INLINE1.VND_INV_NUM              = #vndInvNum#
       AND INLINE2.EZCANCELFLAG             = '0'
       AND INLINE1.GLBL_CMPY_CD             = INLINE2.GLBL_CMPY_CD
       AND INLINE1.VND_INV_NUM              = INLINE2.VND_INV_NUM
       AND INLINE3.EZCANCELFLAG             = '0'
       AND INLINE2.GLBL_CMPY_CD             = INLINE3.GLBL_CMPY_CD
       AND INLINE2.VND_INV_NUM              = INLINE3.VND_INV_NUM
       AND INLINE2.VND_INV_BOL_LINE_NUM     = INLINE3.VND_INV_BOL_LINE_NUM
<!-- Mod Start QC#12575 -->
        <isNull property="poOrdNum">
       AND INLINE2.PO_ORD_NUM          IS NULL
        </isNull>
        <isNotNull property="poOrdNum">
       AND INLINE2.PO_ORD_NUM          = #poOrdNum#
       </isNotNull>
        <isNull property="ediPoOrdNum">
       AND INLINE2.EDI_PO_ORD_NUM          IS NULL
        </isNull>
        <isNotNull property="ediPoOrdNum">
       AND INLINE2.EDI_PO_ORD_NUM          = #ediPoOrdNum#
       </isNotNull>
<!-- Mod End   QC#12575 -->
<!-- Add Start QC#16106 -->
    UNION ALL
    --Freight
    SELECT
           INLINE1.VND_CD
          ,INLINE1.VND_INV_NUM
          ,INLINE2.VND_INV_BOL_LINE_NUM
          ,' '                           AS VND_INV_LINE_NUM
          ,' '                           AS VND_INV_LINE_SUB_NUM
          ,' '                           AS VND_INV_LINE_SUB_TRX_NUM
          ,INLINE2.PO_ORD_NUM
          ,INLINE2.EDI_PO_ORD_NUM
          ,' '                           AS EDI_PO_ORD_DTL_LINE_NUM
          ,INLINE2.ASN_SO_NUM
          ,#freight#                     AS MDSE_CD
          ,''                            AS MDSE_NM
          ,0                             AS SHIP_QTY
<!-- START 2019/10/10 [QC#54067,MOD] -->
          ,CASE
              WHEN INLINE1.INV_TP_CD = #invTpCd# AND INLINE1.ITRL_INTFC_ID = #itrlIntfcId# THEN
                  INLINE1.INV_TOT_DEAL_FRT_AMT * -1
              ELSE
                  INLINE1.INV_TOT_DEAL_FRT_AMT
           END                           AS VND_INV_LINE_DEAL_NET_AMT
<!-- END   2019/10/10 [QC#54067,MOD] -->
          ,2                             AS SORT_NUM
      FROM
           VND_INV_WRK INLINE1
          ,VND_INV_BOL_WRK INLINE2
     WHERE
           INLINE1.EZCANCELFLAG             = '0'
       AND INLINE1.GLBL_CMPY_CD             = #glblCmpyCd#
       AND INLINE1.VND_INV_NUM              = #vndInvNum#
<!-- START 2019/10/10 [QC#54067,MOD] -->
       AND INLINE1.INV_TOT_DEAL_FRT_AMT     &lt;&gt; 0
<!-- END   2019/10/10 [QC#54067,MOD] -->
       AND INLINE2.EZCANCELFLAG             = '0'
       AND INLINE1.GLBL_CMPY_CD             = INLINE2.GLBL_CMPY_CD
       AND INLINE1.VND_INV_NUM              = INLINE2.VND_INV_NUM
       <isNull property="poOrdNum">
       AND INLINE2.PO_ORD_NUM          IS NULL
       </isNull>
       <isNotNull property="poOrdNum">
       AND INLINE2.PO_ORD_NUM          = #poOrdNum#
       </isNotNull>
       <isNull property="ediPoOrdNum">
       AND INLINE2.EDI_PO_ORD_NUM          IS NULL
       </isNull>
       <isNotNull property="ediPoOrdNum">
       AND INLINE2.EDI_PO_ORD_NUM          = #ediPoOrdNum#
       </isNotNull>
       AND INLINE2.VND_INV_BOL_LINE_NUM     = #vndInvBolLineNum#
    UNION ALL
    --Tax
    SELECT
           INLINE1.VND_CD
          ,INLINE1.VND_INV_NUM
          ,INLINE2.VND_INV_BOL_LINE_NUM
          ,'  '                          AS VND_INV_LINE_NUM
          ,'  '                          AS VND_INV_LINE_SUB_NUM
          ,'  '                          AS VND_INV_LINE_SUB_TRX_NUM
          ,INLINE2.PO_ORD_NUM
          ,INLINE2.EDI_PO_ORD_NUM
          ,'  '                          AS EDI_PO_ORD_DTL_LINE_NUM
          ,INLINE2.ASN_SO_NUM
          ,#tax#                         AS MDSE_CD
          ,''                            AS MDSE_NM
          ,0                             AS SHIP_QTY
<!-- START 2019/10/10 [QC#54067,MOD] -->
          ,CASE
              WHEN INLINE1.INV_TP_CD = #invTpCd# AND INLINE1.ITRL_INTFC_ID = #itrlIntfcId# THEN
                  INLINE1.INV_TOT_DEAL_TAX_AMT * -1
              ELSE
                  INLINE1.INV_TOT_DEAL_TAX_AMT
           END                           AS VND_INV_LINE_DEAL_NET_AMT
<!-- END   2019/10/10 [QC#54067,MOD] -->
          ,3                             AS SORT_NUM
      FROM
           VND_INV_WRK INLINE1
          ,VND_INV_BOL_WRK INLINE2
     WHERE
           INLINE1.EZCANCELFLAG             = '0'
       AND INLINE1.GLBL_CMPY_CD             = #glblCmpyCd#
       AND INLINE1.VND_INV_NUM              = #vndInvNum#
<!-- START 2019/10/10 [QC#54067,MOD] -->
       AND INLINE1.INV_TOT_DEAL_TAX_AMT     &lt;&gt; 0
<!-- END   2019/10/10 [QC#54067,MOD] -->
       AND INLINE2.EZCANCELFLAG             = '0'
       AND INLINE1.GLBL_CMPY_CD             = INLINE2.GLBL_CMPY_CD
       AND INLINE1.VND_INV_NUM              = INLINE2.VND_INV_NUM
       <isNull property="poOrdNum">
       AND INLINE2.PO_ORD_NUM          IS NULL
       </isNull>
       <isNotNull property="poOrdNum">
       AND INLINE2.PO_ORD_NUM          = #poOrdNum#
       </isNotNull>
       <isNull property="ediPoOrdNum">
       AND INLINE2.EDI_PO_ORD_NUM          IS NULL
       </isNull>
       <isNotNull property="ediPoOrdNum">
       AND INLINE2.EDI_PO_ORD_NUM          = #ediPoOrdNum#
       </isNotNull>
       AND INLINE2.VND_INV_BOL_LINE_NUM     = #vndInvBolLineNum#
<!-- START 2023/10/04 M.Kobayashi [QC#61880,ADD] -->
    UNION ALL
    --Misc
    SELECT
           INLINE1.VND_CD
          ,INLINE1.VND_INV_NUM
          ,INLINE2.VND_INV_BOL_LINE_NUM
          ,' '                           AS VND_INV_LINE_NUM
          ,' '                           AS VND_INV_LINE_SUB_NUM
          ,' '                           AS VND_INV_LINE_SUB_TRX_NUM
          ,INLINE2.PO_ORD_NUM
          ,INLINE2.EDI_PO_ORD_NUM
          ,' '                           AS EDI_PO_ORD_DTL_LINE_NUM
          ,INLINE2.ASN_SO_NUM
          ,#misc#                        AS MDSE_CD
          ,''                            AS MDSE_NM
          ,0                             AS SHIP_QTY
          ,CASE
              WHEN INLINE1.INV_TP_CD = #invTpCd# AND INLINE1.ITRL_INTFC_ID = #itrlIntfcId# THEN
                  INLINE1.INV_TOT_DEAL_HDLG_COST_AMT * -1
              ELSE
                  INLINE1.INV_TOT_DEAL_HDLG_COST_AMT
           END                           AS VND_INV_LINE_DEAL_NET_AMT
          ,4                             AS SORT_NUM
      FROM
           VND_INV_WRK INLINE1
          ,VND_INV_BOL_WRK INLINE2
     WHERE
           INLINE1.EZCANCELFLAG               = '0'
       AND INLINE1.GLBL_CMPY_CD               = #glblCmpyCd#
       AND INLINE1.VND_INV_NUM                = #vndInvNum#
       AND INLINE1.INV_TOT_DEAL_HDLG_COST_AMT &lt;&gt; 0
       AND INLINE2.EZCANCELFLAG               = '0'
       AND INLINE1.GLBL_CMPY_CD               = INLINE2.GLBL_CMPY_CD
       AND INLINE1.VND_INV_NUM                = INLINE2.VND_INV_NUM
       <isNull property="poOrdNum">
       AND INLINE2.PO_ORD_NUM                 IS NULL
       </isNull>
       <isNotNull property="poOrdNum">
       AND INLINE2.PO_ORD_NUM                 = #poOrdNum#
       </isNotNull>
       <isNull property="ediPoOrdNum">
       AND INLINE2.EDI_PO_ORD_NUM             IS NULL
       </isNull>
       <isNotNull property="ediPoOrdNum">
       AND INLINE2.EDI_PO_ORD_NUM             = #ediPoOrdNum#
       </isNotNull>
       AND INLINE2.VND_INV_BOL_LINE_NUM       = #vndInvBolLineNum#
<!-- END 2023/10/04 M.Kobayashi [QC#61880,ADD] -->
    ORDER BY
          SORT_NUM
         ,EDI_PO_ORD_DTL_LINE_NUM
<!-- Add End QC#16106 -->
    </statement>
<!-- START 2020/05/26 [QC#56007,ADD] -->
    <statement id="findVndInvDtlInfoAndPoDtl" parameterClass="Map" resultClass="Map">
    SELECT
           INLINE1.VND_CD
          ,INLINE1.VND_INV_NUM
          ,INLINE2.VND_INV_BOL_LINE_NUM
          ,INLINE3.VND_INV_LINE_NUM
          ,INLINE3.VND_INV_LINE_SUB_NUM
          ,INLINE3.VND_INV_LINE_SUB_TRX_NUM
          ,INLINE2.PO_ORD_NUM
          ,INLINE2.EDI_PO_ORD_NUM
          ,PD.DISP_PO_DTL_LINE_NUM AS EDI_PO_ORD_DTL_LINE_NUM
          ,INLINE2.ASN_SO_NUM
          ,INLINE3.MDSE_CD
          ,INLINE3.MDSE_NM
          ,CASE
              WHEN INLINE1.INV_TP_CD = #invTpCd# AND INLINE1.ITRL_INTFC_ID = #itrlIntfcId# THEN
                  INLINE3.SHIP_QTY * -1
              ELSE
                  INLINE3.SHIP_QTY
           END                           AS SHIP_QTY
          ,CASE
              WHEN INLINE1.INV_TP_CD = #invTpCd# AND INLINE1.ITRL_INTFC_ID = #itrlIntfcId# THEN
                  NVL(INLINE3.VND_INV_LINE_DEAL_NET_AMT,0) * -1
              ELSE
                  NVL(INLINE3.VND_INV_LINE_DEAL_NET_AMT,0)
           END                           AS VND_INV_LINE_DEAL_NET_AMT
          ,1                             AS SORT_NUM
      FROM
           VND_INV_WRK INLINE1
          ,VND_INV_BOL_WRK INLINE2
          ,VND_INV_LINE_WRK INLINE3
          ,PO_DTL PD
     WHERE
           INLINE1.EZCANCELFLAG             = '0'
       AND INLINE1.GLBL_CMPY_CD             = #glblCmpyCd#
       AND INLINE1.VND_INV_NUM              = #vndInvNum#
       AND INLINE2.EZCANCELFLAG             = '0'
       AND INLINE1.GLBL_CMPY_CD             = INLINE2.GLBL_CMPY_CD
       AND INLINE1.VND_INV_NUM              = INLINE2.VND_INV_NUM
       AND INLINE3.EZCANCELFLAG             = '0'
       AND INLINE2.GLBL_CMPY_CD             = INLINE3.GLBL_CMPY_CD
       AND INLINE2.VND_INV_NUM              = INLINE3.VND_INV_NUM
       AND INLINE2.VND_INV_BOL_LINE_NUM     = INLINE3.VND_INV_BOL_LINE_NUM
       AND INLINE2.PO_ORD_NUM          = #poOrdNum#
       AND INLINE2.EDI_PO_ORD_NUM          = #ediPoOrdNum#
       AND INLINE2.GLBL_CMPY_CD             = PD.GLBL_CMPY_CD
       AND INLINE2.PO_ORD_NUM           = PD.PO_ORD_NUM(+)
       AND TO_NUMBER(INLINE3.EDI_PO_ORD_DTL_LINE_NUM) = TO_NUMBER(PD.PO_ORD_DTL_LINE_NUM(+))
       AND PD.EZCANCELFLAG                  = '0'
    UNION ALL
    --Freight
    SELECT
           INLINE1.VND_CD
          ,INLINE1.VND_INV_NUM
          ,INLINE2.VND_INV_BOL_LINE_NUM
          ,' '                           AS VND_INV_LINE_NUM
          ,' '                           AS VND_INV_LINE_SUB_NUM
          ,' '                           AS VND_INV_LINE_SUB_TRX_NUM
          ,INLINE2.PO_ORD_NUM
          ,INLINE2.EDI_PO_ORD_NUM
          ,' '                           AS EDI_PO_ORD_DTL_LINE_NUM
          ,INLINE2.ASN_SO_NUM
          ,#freight#                     AS MDSE_CD
          ,''                            AS MDSE_NM
          ,0                             AS SHIP_QTY
          ,CASE
              WHEN INLINE1.INV_TP_CD = #invTpCd# AND INLINE1.ITRL_INTFC_ID = #itrlIntfcId# THEN
                  INLINE1.INV_TOT_DEAL_FRT_AMT * -1
              ELSE
                  INLINE1.INV_TOT_DEAL_FRT_AMT
           END                           AS VND_INV_LINE_DEAL_NET_AMT
          ,2                             AS SORT_NUM
      FROM
           VND_INV_WRK INLINE1
          ,VND_INV_BOL_WRK INLINE2
     WHERE
           INLINE1.EZCANCELFLAG             = '0'
       AND INLINE1.GLBL_CMPY_CD             = #glblCmpyCd#
       AND INLINE1.VND_INV_NUM              = #vndInvNum#
       AND INLINE1.INV_TOT_DEAL_FRT_AMT     &lt;&gt; 0
       AND INLINE2.EZCANCELFLAG             = '0'
       AND INLINE1.GLBL_CMPY_CD             = INLINE2.GLBL_CMPY_CD
       AND INLINE1.VND_INV_NUM              = INLINE2.VND_INV_NUM
       AND INLINE2.PO_ORD_NUM          = #poOrdNum#
       AND INLINE2.EDI_PO_ORD_NUM          = #ediPoOrdNum#
       AND INLINE2.VND_INV_BOL_LINE_NUM     = #vndInvBolLineNum#
    UNION ALL
    --Tax
    SELECT
           INLINE1.VND_CD
          ,INLINE1.VND_INV_NUM
          ,INLINE2.VND_INV_BOL_LINE_NUM
          ,'  '                          AS VND_INV_LINE_NUM
          ,'  '                          AS VND_INV_LINE_SUB_NUM
          ,'  '                          AS VND_INV_LINE_SUB_TRX_NUM
          ,INLINE2.PO_ORD_NUM
          ,INLINE2.EDI_PO_ORD_NUM
          ,'  '                          AS EDI_PO_ORD_DTL_LINE_NUM
          ,INLINE2.ASN_SO_NUM
          ,#tax#                         AS MDSE_CD
          ,''                            AS MDSE_NM
          ,0                             AS SHIP_QTY
          ,CASE
              WHEN INLINE1.INV_TP_CD = #invTpCd# AND INLINE1.ITRL_INTFC_ID = #itrlIntfcId# THEN
                  INLINE1.INV_TOT_DEAL_TAX_AMT * -1
              ELSE
                  INLINE1.INV_TOT_DEAL_TAX_AMT
           END                           AS VND_INV_LINE_DEAL_NET_AMT
          ,3                             AS SORT_NUM
      FROM
           VND_INV_WRK INLINE1
          ,VND_INV_BOL_WRK INLINE2
     WHERE
           INLINE1.EZCANCELFLAG             = '0'
       AND INLINE1.GLBL_CMPY_CD             = #glblCmpyCd#
       AND INLINE1.VND_INV_NUM              = #vndInvNum#
       AND INLINE1.INV_TOT_DEAL_TAX_AMT     &lt;&gt; 0
       AND INLINE2.EZCANCELFLAG             = '0'
       AND INLINE1.GLBL_CMPY_CD             = INLINE2.GLBL_CMPY_CD
       AND INLINE1.VND_INV_NUM              = INLINE2.VND_INV_NUM
       AND INLINE2.PO_ORD_NUM          = #poOrdNum#
       AND INLINE2.EDI_PO_ORD_NUM          = #ediPoOrdNum#
       AND INLINE2.VND_INV_BOL_LINE_NUM     = #vndInvBolLineNum#
<!-- START 2023/10/04 M.Kobayashi [QC#61880,ADD] -->
    UNION ALL
    --Misc
    SELECT
           INLINE1.VND_CD
          ,INLINE1.VND_INV_NUM
          ,INLINE2.VND_INV_BOL_LINE_NUM
          ,' '                           AS VND_INV_LINE_NUM
          ,' '                           AS VND_INV_LINE_SUB_NUM
          ,' '                           AS VND_INV_LINE_SUB_TRX_NUM
          ,INLINE2.PO_ORD_NUM
          ,INLINE2.EDI_PO_ORD_NUM
          ,' '                           AS EDI_PO_ORD_DTL_LINE_NUM
          ,INLINE2.ASN_SO_NUM
          ,#misc#                        AS MDSE_CD
          ,''                            AS MDSE_NM
          ,0                             AS SHIP_QTY
          ,CASE
              WHEN INLINE1.INV_TP_CD = #invTpCd# AND INLINE1.ITRL_INTFC_ID = #itrlIntfcId# THEN
                  INLINE1.INV_TOT_DEAL_HDLG_COST_AMT * -1
              ELSE
                  INLINE1.INV_TOT_DEAL_HDLG_COST_AMT
           END                           AS VND_INV_LINE_DEAL_NET_AMT
          ,4                             AS SORT_NUM
      FROM
           VND_INV_WRK INLINE1
          ,VND_INV_BOL_WRK INLINE2
     WHERE
           INLINE1.EZCANCELFLAG               = '0'
       AND INLINE1.GLBL_CMPY_CD               = #glblCmpyCd#
       AND INLINE1.VND_INV_NUM                = #vndInvNum#
       AND INLINE1.INV_TOT_DEAL_HDLG_COST_AMT &lt;&gt; 0
       AND INLINE2.EZCANCELFLAG               = '0'
       AND INLINE1.GLBL_CMPY_CD               = INLINE2.GLBL_CMPY_CD
       AND INLINE1.VND_INV_NUM                = INLINE2.VND_INV_NUM
       AND INLINE2.PO_ORD_NUM                 = #poOrdNum#
       AND INLINE2.EDI_PO_ORD_NUM             = #ediPoOrdNum#
       AND INLINE2.VND_INV_BOL_LINE_NUM       = #vndInvBolLineNum#
<!-- END 2023/10/04 M.Kobayashi [QC#61880,ADD] -->
    ORDER BY
          SORT_NUM
         ,EDI_PO_ORD_DTL_LINE_NUM
    </statement>
    <statement id="getPoOrdDtlLineNum" parameterClass="Map" resultClass="Map">
        SELECT
            PD.PO_ORD_DTL_LINE_NUM
        FROM
            PO_DTL PD
        WHERE
            PD.GLBL_CMPY_CD = #glblCmpyCd#
        AND PD.PO_ORD_NUM   = #poOrdNum#
        AND PD.DISP_PO_DTL_LINE_NUM = #dispPoDtlLineNum#
        AND PD.EZCANCELFLAG = '0'
    </statement>
<!-- END   2020/05/26 [QC#56007,ADD] -->
</sqlMap>