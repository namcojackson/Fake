<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLBB080001">

    <statement id="findSo" parameterClass="Map">
        SELECT
            SO.SO_NUM
            ,SO.SCE_ORD_TP_CD
        FROM
            SHPG_ORD SO
        WHERE
            SO.GLBL_CMPY_CD         = #GLBL_CMPY_CD#
        AND SO.WMS_DROP_RQST_FLG    = 'Y'
        AND SO.WMS_DROP_FLG         = 'N'
        AND SO.EZCANCELFLAG         = '0'
        AND EXISTS (
            SELECT
               1
            FROM
                SHPG_ORD_DTL SOD
               ,RTL_WH RW
            WHERE
                SOD.GLBL_CMPY_CD   = SO.GLBL_CMPY_CD
            AND SOD.SO_NUM         = SO.SO_NUM
            AND SOD.GLBL_CMPY_CD   = RW.GLBL_CMPY_CD
            AND SOD.RTL_WH_CD      = RW.RTL_WH_CD
            AND RW.WH_OWNR_CD      = #WH_OWNR_CD#
            AND SOD.EZCANCELFLAG   = '0'
            AND RW.EZCANCELFLAG    = '0')
        UNION
        SELECT
            SO.SO_NUM
            ,SO.SCE_ORD_TP_CD
        FROM
            SHPG_ORD SO
        WHERE
            SO.GLBL_CMPY_CD = #GLBL_CMPY_CD#
        AND SO.DELY_REQ_FLG = 'Y'
        AND SO.EZCANCELFLAG = '0'
        AND EXISTS (
            SELECT
               1
            FROM
                 VND VN
                ,CARR_TP CT
            WHERE
                VN.GLBL_CMPY_CD  = SO.GLBL_CMPY_CD
            AND VN.VND_CD        = NVL(SO.CARR_CD, SO.VND_CD)
            AND VN.GLBL_CMPY_CD  = CT.GLBL_CMPY_CD
            AND VN.CARR_TP_CD    = CT.CARR_TP_CD
            AND CT.CARR_TP_NM    = #CARR_TP_NM#
            AND VN.EZCANCELFLAG  = '0'
            AND CT.EZCANCELFLAG  = '0'
        )
        ORDER BY
            SO_NUM
    </statement>

    <statement id="existSoSti" parameterClass="Map" resultClass="String">
        SELECT
            SO.SO_NUM
        FROM
            SHPG_ORD SO
        WHERE
            SO.GLBL_CMPY_CD         = #GLBL_CMPY_CD#
        AND SO.SO_NUM               = #SO_NUM#
        AND SO.WMS_DROP_RQST_FLG    = 'Y'
        AND SO.WMS_DROP_FLG         = 'N'
        AND SO.EZCANCELFLAG         = '0'
        AND 
            EXISTS (
                SELECT
                   1
                FROM
                    SHPG_ORD_DTL SOD
                   ,RTL_WH RW
                WHERE
                    SOD.GLBL_CMPY_CD   = SO.GLBL_CMPY_CD
                AND SOD.SO_NUM         = SO.SO_NUM
                AND SOD.GLBL_CMPY_CD   = RW.GLBL_CMPY_CD
                AND SOD.RTL_WH_CD      = RW.RTL_WH_CD
                AND RW.WH_OWNR_CD      = #WH_OWNR_CD#
                AND SOD.EZCANCELFLAG   = '0'
                AND RW.EZCANCELFLAG    = '0'
            )
    </statement>

    <statement id="findSoHeader" parameterClass="Map" resultClass="Map">
        SELECT
            SO.SO_NUM
           ,(
               CASE
               WHEN EXISTS(
                   SELECT
                       NULL
                   FROM
                       NLBI1110_01 I01
                   WHERE
                       I01.ORD_ID_TXT      = SO.SO_NUM
                   AND I01.EZCANCELFLAG    = '0'
               ) THEN #change#
               ELSE #newOrder#
               END
           ) TPL_CTRL_ID
           ,SO.CARR_CD
           ,SO.SHPG_SVC_LVL_CD
           ,NVL(SO.SCHD_DELY_DT, SO.RDD_DT) DELY_DT
           ,SO.PSD_DT
           ,SO.RDD_DT
           ,SOCD.CTAC_PTNR_PSN_NM
           ,SOCD.CTAC_PTNR_PSN_TEL_NUM
           ,SO.SHIP_TO_CUST_CD
           ,SOCD.SO_CUST_LINE_LOC_NM_01
           ,SOCD.SO_CUST_LINE_LOC_NM_02
           ,SOCD.SO_CUST_LINE_ADDR_01
           ,SOCD.SO_CUST_LINE_ADDR_02
           ,SOCD.POST_CD
           ,SOCD.CTY_ADDR
           ,SOCD.CTRY_CD
           ,SOCD.ST_CD
           ,SO.WH_CD AS RTL_WH_CD
           ,SO.SHIP_TO_CUST_CD AS SHIP_TO_RTL_WH_CD
           ,SO.TRX_HDR_NUM
           ,SO.PICK_TKT_NUM
           ,SUBSTR(SO.CUST_ISS_PO_NUM,0 , #lgCustIssPoNum#) AS CUST_ISS_PO_NUM
           ,SO.SELL_TO_CUST_CD
           ,SO.BILL_TO_CUST_CD
           ,CASE WHEN SO.DROP_SHIP_FLG = 'Y' THEN #shipToCustCd# ELSE SO.SHIP_TO_CUST_CD END AS SHIP_TO_CUST_CD
           ,CASE WHEN SO.EXPT_SHPG_METH_CD IS NULL THEN SV.S80_SHIP_VIA_CD ELSE SO.EXPT_SHPG_METH_CD END AS EXPT_SHPG_METH_CD
           ,CASE WHEN SO.EXPT_SHPG_METH_CD IS NULL THEN S8.S80_SHIP_VIA_NM ELSE SM.SHPG_METH_NM END AS SHPG_METH_NM
           ,CASE WHEN LENGTH(SO.SO_CRAT_TS) &gt; #lgSoCratTs# THEN SUBSTR(SO.SO_CRAT_TS, 0, #lgSoCratTs#) ELSE SO.SO_CRAT_TS END AS SO_CRAT_TS
           ,CASE WHEN SO.PSD_DT IS NOT NULL THEN SO.PSD_DT || #valTs# END AS PSD_DT_TM
           ,CASE WHEN SO.RDD_DT IS NOT NULL THEN SO.RDD_DT || #valTs# END AS RDD_DT_TM
           ,SO.DNLD_TM_TS
           ,SO.DROP_SHIP_FLG
           ,SO.PRINT_SCC_LB_FLG
           ,SO.PRINT_UCC_LB_FLG
           ,SO.MIX_PLT_ALLW_FLG
           ,SO.PRINT_PLT_UCC_LB_FLG
           ,SO.PRINT_NON_ASN_UCC_LB_FLG
           ,SO.ASN_REQ_FLG
           ,NVL(SO.UCC_NUM_CD, #val1#) AS UCC_NUM_CD
           ,SO.EDI_TP_CD
           ,SO.CUST_STORE_NUM
           ,SO.SO_DEPT_NUM
           ,CASE WHEN TRUNC(SO.TOT_SHIP_AMT, #val2#) &gt; #maxTotShipAmt# THEN #maxTotShipAmt# ELSE TRUNC(SO.TOT_SHIP_AMT, #val2#) END AS TOT_SHIP_AMT
           ,SO.RTRN_LB_CD
           ,SO.SO_CONFIG_FLG
           ,SO.CARR_ACCT_NUM
           ,NVL(SO.SCHD_DELY_DT, SO.RDD_DT) AS SCHD_DELY_DT
           ,SO.SCHD_DELY_DT || SO.SCHD_DELY_TM AS REQ_DT_TM_TS_TXT
           ,SO.SCHD_DELY_TM
           ,SO.CARR_CD
           ,SO.VND_CD
           ,SO.SHPG_SVC_LVL_CD
           ,SO.SVC_CONFIG_MSTR_PK
           ,SO.PRE_ISTL_SHOP_RQST_FLG
           ,SO.WMS_RTE_PATH_CD
           ,SO.SRC_ORD_NUM
           ,SO.SCE_ORD_TP_CD
           ,SO.TRX_SRC_TP_CD
           ,CM.S80_CMPY_CD
           ,SC.S80_ORD_TP_CD
           ,SC.S80_TRX_CD
           ,SC.SCE_ORD_TP_NM
           ,OS.S80_ORD_SRC_CD
           ,SV.S80_SHIP_VIA_CD
           ,S8.S80_SHIP_VIA_NM
           ,ST.S80_SHPG_TERM_CD
           ,SS.S80_SHPG_TERM_NM
           ,SUBSTR(OC.DS_ORD_CATG_DESC_TXT, 0, #lgOtbdSrcOrdTpTxt#) AS OTBD_SRC_ORD_TP_TXT
           ,SP.LOC_GRP_CD
           ,SUBSTR(CP_PSN.PSN_FIRST_NM || ' ' || CP_PSN.PSN_LAST_NM, 0, #lgPsnNm#) AS CPO_PSN_NM
           ,SUBSTR(PO_PSN.PSN_FIRST_NM || ' ' || PO_PSN.PSN_LAST_NM, 0, #lgPsnNm#) AS PO_PSN_NM
           ,SUBSTR(SR_PSN.PSN_FIRST_NM || ' ' || SR_PSN.PSN_LAST_NM, 0, #lgPsnNm#) AS SR_PSN_NM
        FROM
            SHPG_ORD          SO
           ,SHPG_ORD_CUST_DTL SOCD
           ,CMPY_CD_CONV      CM
           ,SCE_ORD_TP        SC
           ,ORD_SRC_CONV      OS
           ,SHIP_VIA_CONV     SV
           ,SHPG_METH         SM
           ,S80_SHIP_VIA      S8
           ,SHPG_TERM_CONV    ST
           ,S80_SHPG_TERM     SS
           ,CPO               CP
           ,PO                PO
           ,DS_ORD_CATG       OC
           ,SHIP_TO_CUST      SP
           ,S21_PSN           CP_PSN
           ,S21_PSN           PO_PSN
           ,S21_PSN           SR_PSN
           ,ORG_FUNC_ASG      OG
        WHERE
            SO.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND SO.SO_NUM                   = #SO_NUM#
        AND SO.GLBL_CMPY_CD             = SOCD.GLBL_CMPY_CD(+)
        AND SO.SO_NUM                   = SOCD.SO_NUM (+)
        AND SOCD.SO_CUST_DATA_TP_CD(+)  = #SO_CUST_DATA_TP_CD#
        AND SO.EZCANCELFLAG             = '0'
        AND SOCD.EZCANCELFLAG(+)        = '0'
        AND SO.GLBL_CMPY_CD             = CM.GLBL_CMPY_CD(+)
        AND SO.GLBL_CMPY_CD             = SC.GLBL_CMPY_CD(+)
        AND SO.SCE_ORD_TP_CD            = SC.SCE_ORD_TP_CD(+)
        AND SC.INBD_OTBD_CD(+)          = #outbound#
        AND SO.GLBL_CMPY_CD             = OS.GLBL_CMPY_CD(+)
        AND SO.TRX_SRC_TP_CD            = OS.TRX_SRC_TP_CD(+)
        AND SO.GLBL_CMPY_CD             = SV.GLBL_CMPY_CD(+)
        AND SO.SHPG_SVC_LVL_CD          = SV.SHPG_SVC_LVL_CD(+)
        AND SO.GLBL_CMPY_CD             = SM.GLBL_CMPY_CD(+)
        AND SO.EXPT_SHPG_METH_CD        = SM.SHPG_METH_CD(+)
        AND SV.GLBL_CMPY_CD             = S8.GLBL_CMPY_CD(+)
        AND SV.S80_SHIP_VIA_CD          = S8.S80_SHIP_VIA_CD(+)
        AND SO.GLBL_CMPY_CD             = ST.GLBL_CMPY_CD(+)
        AND SO.FRT_CHRG_TO_CD           = ST.FRT_CHRG_TO_CD(+)
        AND SO.FRT_CHRG_METH_CD         = ST.FRT_CHRG_METH_CD(+)
        AND ST.GLBL_CMPY_CD             = SS.GLBL_CMPY_CD(+)
        AND ST.S80_SHPG_TERM_CD         = SS.S80_SHPG_TERM_CD(+)
        AND SO.GLBL_CMPY_CD             = CP.GLBL_CMPY_CD(+)
        AND SO.TRX_HDR_NUM              = CP.CPO_ORD_NUM(+)
        AND CP.GLBL_CMPY_CD             = OC.GLBL_CMPY_CD(+)
        AND CP.DS_ORD_CATG_CD           = OC.DS_ORD_CATG_CD(+)
        AND SO.GLBL_CMPY_CD             = SP.GLBL_CMPY_CD(+)
        AND SO.SHIP_TO_CUST_CD          = SP.SHIP_TO_CUST_CD(+)
        AND CP.GLBL_CMPY_CD             = CP_PSN.GLBL_CMPY_CD(+)
        AND CP.ADMIN_PSN_CD             = CP_PSN.PSN_CD(+)
        AND SO.GLBL_CMPY_CD             = PO.GLBL_CMPY_CD(+)
        AND SO.TRX_HDR_NUM              = PO.PO_ORD_NUM(+)
        AND PO.GLBL_CMPY_CD             = PO_PSN.GLBL_CMPY_CD(+)
        AND PO.PO_SUBMT_PSN_CD          = PO_PSN.PSN_CD(+)
        AND CP.GLBL_CMPY_CD             = OG.GLBL_CMPY_CD(+)
        AND CP.SLS_REP_TOC_CD           = OG.TOC_CD(+)
        AND NVL(OG.EFF_FROM_DT(+), #minDt#) &lt;= #slsDt#
        AND NVL(OG.EFF_THRU_DT(+), #maxDt#) &gt;= #slsDt#
        AND OG.GLBL_CMPY_CD             = SR_PSN.GLBL_CMPY_CD(+)
        AND OG.PSN_CD                   = SR_PSN.PSN_CD(+)
        AND CM.EZCANCELFLAG(+)          = '0'
        AND SC.EZCANCELFLAG(+)          = '0'
        AND OS.EZCANCELFLAG(+)          = '0'
        AND SV.EZCANCELFLAG(+)          = '0'
        AND SM.EZCANCELFLAG(+)          = '0'
        AND S8.EZCANCELFLAG(+)          = '0'
        AND ST.EZCANCELFLAG(+)          = '0'
        AND SS.EZCANCELFLAG(+)          = '0'
        AND CP.EZCANCELFLAG(+)          = '0'
        AND OC.EZCANCELFLAG(+)          = '0'
        AND SP.EZCANCELFLAG(+)          = '0'
        AND OG.EZCANCELFLAG(+)          = '0'
        AND CP_PSN.EZCANCELFLAG(+)      = '0'
        AND PO_PSN.EZCANCELFLAG(+)      = '0'
        AND SR_PSN.EZCANCELFLAG(+)      = '0'
        ORDER BY
            SO.SO_NUM
    </statement>

    <statement id="getReturn" parameterClass="Map" resultClass="Map">
        SELECT
               RTRN.WMS_RTRN_TO_NM_01
              ,RTRN.WMS_RTRN_TO_NM_02
              ,RTRN.RTRN_TO_FIRST_LINE_ADDR
              ,RTRN.RTRN_TO_SCD_LINE_ADDR
              ,RTRN.RTRN_TO_THIRD_LINE_ADDR
              ,RTRN.RTRN_TO_FRTH_LINE_ADDR
              ,RTRN.RTRN_TO_CTY_ADDR
              ,RTRN.RTRN_TO_ST_CD
              ,RTRN.RTRN_TO_POST_CD
              ,RTRN.RTRN_TO_CTRY_CD
              ,RTRN.WMS_RTRN_TO_CTAC_NM
              ,RTRN.RTRN_TO_CTAC_NUM
          FROM
               (
                   SELECT
                          WWRA.WMS_RTRN_TO_NM_01
                         ,WWRA.WMS_RTRN_TO_NM_02
                         ,WWRA.RTRN_TO_FIRST_LINE_ADDR
                         ,WWRA.RTRN_TO_SCD_LINE_ADDR
                         ,WWRA.RTRN_TO_THIRD_LINE_ADDR
                         ,WWRA.RTRN_TO_FRTH_LINE_ADDR
                         ,WWRA.RTRN_TO_CTY_ADDR
                         ,WWRA.RTRN_TO_ST_CD
                         ,WWRA.RTRN_TO_POST_CD
                         ,WWRA.RTRN_TO_CTRY_CD
                         ,WWRA.WMS_RTRN_TO_CTAC_NM
                         ,WWRA.RTRN_TO_CTAC_NUM
                     FROM
                           WMS_WH_RTRN_ADDR WWRA
                          ,RTL_WH           RWH
                    WHERE
                          WWRA.GLBL_CMPY_CD   =  #glblCmpyCd#
                    <isNotNull property="rtrnLblCd">
                      AND WWRA.WMS_RTRN_LB_CD =  #rtrnLblCd#
                    </isNotNull>
                      AND (WWRA.WH_CD = #whCdAll# OR WWRA.WH_CD = RWH.WMS_WH_CD)
                      AND TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') BETWEEN WWRA.EFF_FROM_DT_TM_TS AND WWRA.EFF_TO_DT_TM_TS
                      AND WWRA.GLBL_CMPY_CD   =  RWH.GLBL_CMPY_CD
                    <isNull property="rtrnLblCd">
                      AND WWRA.WMS_RTRN_LB_CD =  RWH.WMS_WH_CD
                    </isNull>
                      AND RWH.RTL_WH_CD       = #rtlWhCd#
                      AND WWRA.EZCANCELFLAG   =  '0'
                      AND RWH.EZCANCELFLAG    =  '0'
                    ORDER BY
                          DECODE(WWRA.WH_CD, #whCdAll#, 2, 1) ASC
                         ,WWRA.EFF_FROM_DT_TM_TS DESC
               ) RTRN
         WHERE
               ROWNUM &lt;= 1
    </statement>
    
    <statement id="findSoDetail" parameterClass="Map" resultClass="Map">
        SELECT
            SOD.SO_NUM
           ,SOD.SO_SLP_NUM
           ,SOD.MDSE_CD
           ,SOD.SHPG_QTY
           ,SOD.TRX_HDR_NUM
           ,SOD.TRX_LINE_NUM
           ,SOD.TRX_LINE_SUB_NUM
           ,SOD.RTL_WH_CD
           ,SOD.RTL_SWH_CD
           ,SOD.SHIP_TO_RTL_WH_CD
           ,SOD.SHIP_TO_RTL_SWH_CD
           ,SOD.CUST_MDSE_CD
           ,SOD.RQST_ORD_QTY
           ,SOD.SHPG_BAL_QTY
           ,CASE WHEN TRUNC(SOD.UNIT_PRC_AMT, #val2#) &gt; #maxQty# THEN #maxQty# ELSE TRUNC(SOD.UNIT_PRC_AMT, #val2#) END AS UNIT_PRC_AMT
           ,CASE WHEN TRUNC(SOD.DISC_PRC_AMT, #val2#) &gt; #maxQty# THEN #maxQty# ELSE TRUNC(SOD.DISC_PRC_AMT, #val2#) END AS DISC_PRC_AMT
           ,CASE WHEN TRUNC(SOD.DISC_UNIT_PRC_AMT, #val2#) &gt; #maxQty# THEN #maxQty# ELSE TRUNC(SOD.DISC_UNIT_PRC_AMT, #val2#) END AS DISC_UNIT_PRC_AMT
           ,SOD.SER_NUM_TAKE_FLG
           ,SOD.SET_MDSE_CD
           ,SOD.SET_MDSE_NM
           ,SOD.SET_SHPG_QTY
           ,SOD.IN_EACH_QTY
           ,SOD.TOT_SHPG_WT
           ,SOD.TOT_SHPG_VOL
           ,SOD.BAT_NUM_TAKE_FLG
           ,SOD.CONFIG_ITEM_FLG
           ,SOD.PICK_SVC_CONFIG_MSTR_PK
           ,SOD.BACK_ORD_IMPCT_TP_CD
           ,SOD.CONFIG_ITEM_FLG
           ,SOD.RMV_CONFIG_FLG
           ,SOD.PRE_ISTL_SHOP_RQST_FLG
           ,STK.S80_STK_STS_CD
           ,MDS.RTRN_REQ_PRT_FLG
           ,MDS.MDSE_ITEM_TP_CD
           ,TL.PLANT_CD
           ,TL.TPL_LOC_NM
<!-- START 2021/06/15 [QC#56495,ADD] -->
           ,SO.SVC_CONFIG_MSTR_PK
           ,MDS.ITRL_ITEM_FLG
<!-- END 2021/06/15 [QC#56495,ADD] -->
        FROM
            SHPG_ORD_DTL SOD
<!-- START 2021/06/15 [QC#56495,ADD] -->
           ,SHPG_ORD SO
<!-- END 2021/06/15 [QC#56495,ADD] -->
           ,TPL_LOC TL
           ,STK_STS_CONV             STK
           ,MDSE                     MDS
        WHERE
            SOD.GLBL_CMPY_CD    = #GLBL_CMPY_CD#
        AND SOD.SO_NUM          = #SO_NUM#
<!-- START 2021/06/15 [QC#56495,ADD] -->
        AND SOD.GLBL_CMPY_CD    = SO.GLBL_CMPY_CD
        AND SOD.SO_NUM          = SO.SO_NUM
<!-- END 2021/06/15 [QC#56495,ADD] -->
        AND SOD.GLBL_CMPY_CD    = TL.GLBL_CMPY_CD(+)
        AND SOD.RTL_WH_CD       = TL.TPL_LOC_CD(+)
        AND SOD.FROM_STK_STS_CD = TL.TPL_STK_STS_CD(+)
        AND SOD.GLBL_CMPY_CD    = STK.GLBL_CMPY_CD(+)
        AND SOD.FROM_STK_STS_CD = STK.STK_STS_CD(+)
        AND SOD.GLBL_CMPY_CD    = MDS.GLBL_CMPY_CD(+)
        AND SOD.MDSE_CD         = MDS.MDSE_CD(+)
        AND SOD.EZCANCELFLAG    = '0'
<!-- START 2021/06/15 [QC#56495,ADD] -->
        AND SO.EZCANCELFLAG     = '0'
<!-- END 2021/06/15 [QC#56495,ADD] -->
        AND TL.EZCANCELFLAG(+)  = '0'
        AND STK.EZCANCELFLAG(+) = '0'
        AND MDS.EZCANCELFLAG(+) = '0'
        ORDER BY
            SOD.SO_SLP_NUM
    </statement>

    <statement id="findSoText" parameterClass="Map" resultClass="Map">
        SELECT
            SOM.SO_NUM
           ,SOM.SO_MSG_TP_CD
           ,SOM.TXT_SQ_NUM
           ,SOM.SO_MSG_DESC_TXT
        FROM
            SHPG_ORD_MSG SOM
        WHERE
            SOM.GLBL_CMPY_CD    = #GLBL_CMPY_CD#
        AND SOM.SO_NUM          = #SO_NUM#
        AND SOM.SO_MSG_TP_CD    = #SO_MSG_TP_CD#
        AND SOM.EZCANCELFLAG    = '0'
        ORDER BY
            SOM.SO_NUM
           ,SOM.TXT_SQ_NUM
    </statement>

    <statement id="findSoSiteSurvey" parameterClass="Map" resultClass="Map">
        SELECT
            SO.SO_NUM
            ,COALESCE(DSS1.CPO_ORD_NUM, DSS2.CPO_ORD_NUM) CPO_ORD_NUM
            ,COALESCE(DSS1.CPO_DTL_LINE_NUM, DSS2.CPO_DTL_LINE_NUM) CPO_DTL_LINE_NUM
            ,COALESCE(DSS1.CPO_DTL_LINE_SUB_NUM, DSS2.CPO_DTL_LINE_SUB_NUM) CPO_DTL_LINE_SUB_NUM
            ,SOCD.SO_CUST_LINE_LOC_NM_01
            ,SO.SHIP_TO_CUST_CD
            ,SOCD.SO_CUST_LINE_ADDR_01
            ,SOCD.CTY_ADDR
            ,COALESCE(DSS1.CMPY_INFO_APT_BLDG_NM, DSS2.CMPY_INFO_APT_BLDG_NM) CMPY_INFO_APT_BLDG_NM
            ,SOCD.ST_CD
            ,COALESCE(SODI.CMPY_INFO_FL_NM, DSS1.CMPY_INFO_FL_NM, DSS2.CMPY_INFO_FL_NM) CMPY_INFO_FL_NM
            ,SOCD.POST_CD
            ,COALESCE(DSS1.CMPY_INFO_DEPT_NM, DSS2.CMPY_INFO_DEPT_NM) CMPY_INFO_DEPT_NM
            ,COALESCE(DSS1.ELEV_PROT_REQ_FLG, DSS2.ELEV_PROT_REQ_FLG) ELEV_PROT_REQ_FLG
            ,COALESCE(SODI.DELY_INSTN_ADDL_CMNT_TXT, DSS1.SITE_SRVY_ADDL_CMNT_TXT, DSS2.SITE_SRVY_ADDL_CMNT_TXT) SITE_SRVY_ADDL_CMNT_TXT
            ,COALESCE(SODI.OTSD_STEP_NUM, DSS1.OTSD_STEP_NUM, DSS2.OTSD_STEP_NUM) OTSD_STEP_NUM
            ,COALESCE(SODI.INSD_STEP_NUM, DSS1.INSD_STEP_NUM, DSS2.INSD_STEP_NUM) INSD_STEP_NUM
            ,COALESCE(SODI.STAIR_CRAW_REQ_FLG, DSS1.STAIR_CRAW_REQ_FLG, DSS2.STAIR_CRAW_REQ_FLG) STAIR_CRAW_REQ_FLG
            ,COALESCE(DSS1.FLGT_STAIR_NUM, DSS2.FLGT_STAIR_NUM) FLGT_STAIR_NUM
            ,COALESCE(SODI.STAIR_AND_LDG_WDT, DSS1.STAIR_AND_LDG_WDT, DSS2.STAIR_AND_LDG_WDT) STAIR_AND_LDG_WDT
            ,COALESCE(SODI.LOAD_DOCK_AVAL_TXT, DSS1.LOAD_DOCK_AVAL_FLG, DSS2.LOAD_DOCK_AVAL_FLG) LOAD_DOCK_AVAL_FLG
            ,COALESCE(SODI.LOAD_DOCK_HGT, DSS1.LOAD_DOCK_HGT, DSS2.LOAD_DOCK_HGT) LOAD_DOCK_HGT
            ,COALESCE(SODI.OPS_FROM_HOUR_MN, DSS1.LOAD_DOCK_AVAL_FROM_HOUR_MN, DSS2.LOAD_DOCK_AVAL_FROM_HOUR_MN) LOAD_DOCK_AVAL_FROM_HOUR_MN
            ,COALESCE(SODI.OPS_TO_HOUR_MN, DSS1.LOAD_DOCK_AVAL_TO_HOUR_MN, DSS2.LOAD_DOCK_AVAL_TO_HOUR_MN) LOAD_DOCK_AVAL_TO_HOUR_MN
            ,COALESCE(SODI.TRCTR_AND_TRAIL_ACCS_TXT, DSS1.TRCTR_AND_TRAIL_ACCS_FLG, DSS2.TRCTR_AND_TRAIL_ACCS_FLG) TRCTR_AND_TRAIL_ACCS_FLG
            ,NVL(SO.SCHD_DELY_TM ,DCII.RQST_ISTL_TM) CARR_DELY_TM_HOUR_MN
            ,COALESCE(SODI.DELY_TRNSP_OPT_CD, DSS1.DELY_TRNSP_OPT_CD, DSS2.DELY_TRNSP_OPT_CD) DELY_TRNSP_OPT_CD
            ,SODI.SEC_CLNC_REQ_TXT
            ,SODI.INS_CERT_REQ_TXT
            ,SODI.FL_COV_TXT
            ,SODI.RAMP_AVAL_TXT
            ,SODI.STEP_AVAL_TXT
            ,SODI.FRONT_DOOR_AVAL_TXT
            ,SODI.BACK_DOOR_AVAL_TXT
            ,SODI.PWR_OTLT_CONFIG_TXT
            ,SODI.SGN_ON_BLDG_RDSD_TXT
            ,SODI.BLDG_STRY_NUM
            ,SODI.BLDG_GURD_NTFY_TXT
            ,SODI.INDL_PARK_TXT
            ,SODI.BIZ_PARK_TXT
            ,SODI.PRO_BLDG_TXT
            ,SODI.SHPNG_CTR_TXT
            ,SODI.PVT_RES_TXT
            ,COALESCE(SODI.ELEV_AVAL_TXT, DSS1.ELEV_AVAL_FLG, DSS2.ELEV_AVAL_FLG) ELEV_AVAL_FLG
            ,COALESCE(SODI.ELEV_AVAL_FROM_HOUR_MN, DSS1.ELEV_AVAL_FROM_HOUR_MN, DSS2.ELEV_AVAL_FROM_HOUR_MN) ELEV_AVAL_FROM_HOUR_MN
            ,COALESCE(SODI.ELEV_AVAL_TO_HOUR_MN, DSS1.ELEV_AVAL_TO_HOUR_MN, DSS2.ELEV_AVAL_TO_HOUR_MN) ELEV_AVAL_TO_HOUR_MN
            ,COALESCE(SODI.ELEV_APPT_REQ_TXT, DSS1.ELEV_APPT_REQ_FLG, DSS2.ELEV_APPT_REQ_FLG) ELEV_APPT_REQ_FLG
            ,COALESCE(SODI.ELEV_CTAC_PSN_NM, DSS1.ELEV_CTAC_PSN_NM, DSS2.ELEV_CTAC_PSN_NM) ELEV_CTAC_PSN_NM
            ,COALESCE(SODI.ELEV_CTAC_TEL_NUM, DSS1.ELEV_CTAC_TEL_NUM, DSS2.ELEV_CTAC_TEL_NUM) ELEV_CTAC_TEL_NUM
            ,COALESCE(SODI.BLDG_ENT_DOOR_HGT, DSS1.BLDG_ENT_DOOR_HGT, DSS2.BLDG_ENT_DOOR_HGT) BLDG_ENT_DOOR_HGT
            ,COALESCE(SODI.BLDG_ENT_DOOR_WDT, DSS1.BLDG_ENT_DOOR_WDT, DSS2.BLDG_ENT_DOOR_WDT) BLDG_ENT_DOOR_WDT
            ,COALESCE(SODI.CRDR_WDT, DSS1.CRDR_WDT, DSS2.CRDR_WDT) CRDR_WDT
            ,COALESCE(SODI.DOOR_WDT, DSS1.DOOR_WDT, DSS2.DOOR_WDT) DOOR_WDT
            ,COALESCE(SODI.ELEV_WDT, DSS1.ELEV_WDT, DSS2.ELEV_WDT) ELEV_WDT
            ,COALESCE(SODI.ELEV_DEPTH_NUM, DSS1.ELEV_DEPTH_NUM, DSS2.ELEV_DEPTH_NUM) ELEV_DEPTH_NUM
            ,COALESCE(SODI.ELEV_CAP_WT, DSS1.ELEV_CAP_WT, DSS2.ELEV_CAP_WT) ELEV_CAP_WT
            ,COALESCE(SODI.ELEV_DOOR_HGT, DSS1.ELEV_DOOR_HGT, DSS2.ELEV_DOOR_HGT) ELEV_DOOR_HGT
            ,COALESCE(SODI.ELEV_DOOR_WDT, DSS1.ELEV_DOOR_WDT, DSS2.ELEV_DOOR_WDT) ELEV_DOOR_WDT
            ,COALESCE(SODI.CUST_INFO_BO_FLG, 'N') CUST_INFO_BO_FLG
            ,COALESCE(SODI.PICK_UP_XTR_TONER_FLG, 'N') PICK_UP_XTR_TONER_FLG
            ,COALESCE(SODI.PICK_UP_AT_SAME_TM_FLG, 'N') PICK_UP_AT_SAME_TM_FLG
        FROM
            SHPG_ORD SO
           ,SHPG_ORD_CUST_DTL SOCD
           ,SHPG_ORD_DELY_INSTN SODI
           ,DS_SITE_SRVY DSS1
           ,DS_SITE_SRVY DSS2
           ,DS_CPO_ISTL_INFO DCII
        WHERE
            SO.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND SO.SO_NUM                   = #SO_NUM#
        AND SO.GLBL_CMPY_CD             = SOCD.GLBL_CMPY_CD(+)
        AND SO.SO_NUM                   = SOCD.SO_NUM(+)
        AND SOCD.SO_CUST_DATA_TP_CD(+)  = #SO_CUST_DATA_TP_CD#
        AND SO.GLBL_CMPY_CD             = SODI.GLBL_CMPY_CD(+)
        AND SO.SO_NUM                   = SODI.SO_NUM(+)
        AND SO.GLBL_CMPY_CD             = DSS1.GLBL_CMPY_CD(+)
        AND SO.TRX_HDR_NUM              = DSS1.CPO_ORD_NUM(+)
        AND SO.DS_CPO_CONFIG_PK         = DSS1.DS_CPO_CONFIG_PK(+)
        AND SO.GLBL_CMPY_CD             = DSS2.GLBL_CMPY_CD(+)
        AND SO.TRX_HDR_NUM              = DSS2.CPO_ORD_NUM(+)
        AND SO.GLBL_CMPY_CD             = DCII.GLBL_CMPY_CD(+)
        AND SO.TRX_HDR_NUM              = DCII.CPO_ORD_NUM(+)
        AND SO.EZCANCELFLAG             = '0'
        AND SOCD.EZCANCELFLAG(+)        = '0'
        AND SODI.EZCANCELFLAG(+)        = '0'
        AND DSS1.EZCANCELFLAG(+)        = '0'
        AND DSS2.EZCANCELFLAG(+)        = '0'
        AND DCII.EZCANCELFLAG(+)        = '0'
        ORDER BY
            SO.SO_NUM
    </statement>

    <statement id="findSoMdseSurvey" parameterClass="Map" resultClass="Map">
        SELECT
            SOD.SO_NUM
           ,SOD.SO_SLP_NUM
           ,MD.MDSE_CD
           ,MD.MDSE_NM
           ,MSP.IN_POUND_WT
           ,MSP.IN_INCH_LG
           ,MSP.IN_INCH_WDT
           ,MSP.IN_INCH_HGT
           ,ROUND(
             SQRT(
                 POWER(MSP.IN_INCH_LG,  2)
               + POWER(MSP.IN_INCH_WDT, 2)
               + POWER(MSP.IN_INCH_HGT, 2)
             ), 4) IN_INCH_DG
        FROM
            SHPG_ORD_DTL SOD
           ,MDSE MD
           ,MDSE_STORE_PKG MSP
        WHERE
            SOD.GLBL_CMPY_CD    = #GLBL_CMPY_CD#
        AND SOD.SO_NUM          = #SO_NUM#
        AND SOD.GLBL_CMPY_CD    = MD.GLBL_CMPY_CD(+)
        AND SOD.MDSE_CD         = MD.MDSE_CD(+)
        AND SOD.GLBL_CMPY_CD    = MSP.GLBL_CMPY_CD(+)
        AND SOD.MDSE_CD         = MSP.MDSE_CD(+)
        AND SOD.EZCANCELFLAG    = '0'
        AND MD.EZCANCELFLAG(+)  = '0'
        AND MSP.EZCANCELFLAG(+) = '0'
        ORDER BY
            SOD.SO_NUM
           ,SOD.SO_SLP_NUM
    </statement>

    <statement id="findSoSerial" parameterClass="Map" resultClass="Map">
        SELECT
            SS.SER_NUM
        FROM
            (
            SELECT
                SS.SER_NUM
            FROM
                SO_SER SS
            WHERE
                SS.GLBL_CMPY_CD = #GLBL_CMPY_CD#
            AND SS.SO_NUM       = #SO_NUM#
            AND SS.SO_SLP_NUM   = #SO_SLP_NUM#
            AND SS.EZCANCELFLAG = '0'
            ORDER BY
                SS.WH_PICK_FLG DESC NULLS LAST
               ,SS.ORD_ASG_FLG DESC NULLS LAST
               ,SS.EZUPTIME DESC
               ,SS.EZINTIME DESC
           ) SS
       WHERE
           ROWNUM &lt;= #rowNum#
    </statement>

    <statement id="getTplCarrSvcLvlBySo" parameterClass="Map" resultClass="Map">
        SELECT
            TPL_CARR_CD
           ,TPL_SVC_LVL_CD
        FROM (
            SELECT
                TC.TPL_CARR_CD
               ,TC.TPL_SVC_LVL_CD
            FROM
                TPL_CARR_SVC_LVL TC
            WHERE
                TC.GLBL_CMPY_CD         = #GLBL_CMPY_CD#
            AND TC.WH_OWNR_CD           = #WH_OWNR_CD#
        <isNotNull property="CARR_CD">
            AND TC.CARR_CD              = #CARR_CD#
        </isNotNull>
        <isNull property="CARR_CD">
            AND TC.CARR_CD              IS NULL
        </isNull>
        <isNotNull property="SHPG_SVC_LVL_CD">
            AND TC.SHPG_SVC_LVL_CD      = #SHPG_SVC_LVL_CD#
        </isNotNull>
        <isNull property="SHPG_SVC_LVL_CD">
            AND TC.SHPG_SVC_LVL_CD      IS NULL
        </isNull>
            AND TC.EZCANCELFLAG         = '0'
            ORDER BY
                TC.TPL_CARR_SVC_LVL_SORT_NUM ASC
        )
        WHERE
            ROWNUM&lt;=1
    </statement>

    <statement id="countWmsInbdSo" parameterClass="Map" resultClass="BigDecimal">
        SELECT
               COUNT(*)
          FROM
               WMS_INBD_SO_HDR WISH
         WHERE
               WISH.GLBL_CMPY_CD = #glblCmpyCd#
           AND WISH.WMS_SO_ID    = #wmsSoId#
           AND WISH.EZCANCELFLAG = '0'
    </statement>

    <statement id="getSoCustDtl" parameterClass="Map" resultClass="Map">
        SELECT
            SUBSTR(SC.SO_CUST_LINE_LOC_NM_01, 0, #lgLineColNm#) AS SO_CUST_LINE_LOC_NM_01
           ,SUBSTR(SC.SO_CUST_LINE_LOC_NM_02, 0, #lgLineColNm#) AS SO_CUST_LINE_LOC_NM_02
           ,SC.SO_CUST_LINE_ADDR_01
           ,SC.SO_CUST_LINE_ADDR_02
           ,SC.SO_CUST_LINE_ADDR_03
           ,SC.SO_CUST_LINE_ADDR_04
           ,SC.CTY_ADDR
           ,SC.ST_CD
           ,SC.POST_CD
           ,SC.CTRY_CD
           ,SC.CTAC_PTNR_PSN_NM
           ,SUBSTR(SC.CTAC_PTNR_PSN_TEL_NUM, 0, #lgCtacTelNum#) AS CTAC_PTNR_PSN_TEL_NUM
          FROM
               SHPG_ORD_CUST_DTL SC
         WHERE
               SC.GLBL_CMPY_CD        = #glblCmpyCd#
           AND SC.SO_NUM              = #soNum#
           AND SC.SO_CUST_DATA_TP_CD  = #soCustDataTpCd#
           AND SC.EZCANCELFLAG        = '0'
    </statement>

    <statement id="findRws" parameterClass="Map">
        SELECT
            RH.RWS_NUM
        FROM
            RWS_HDR RH
           ,RWS_STS RS
        WHERE
            RH.GLBL_CMPY_CD     = #GLBL_CMPY_CD#
        AND RH.PICK_UP_RQST_FLG = #flgY#
        AND RH.EZCANCELFLAG     = '0'
        AND RH.GLBL_CMPY_CD     = RS.GLBL_CMPY_CD
        AND RH.RWS_STS_CD       = RS.RWS_STS_CD
        AND (RS.RWS_OPEN_FLG = #flgY# OR RS.RCV_FLG = #flgY#)
        AND RS.EZCANCELFLAG     = '0'
        <!-- START 2022/06/21 [QC#60022,MOD] -->
        <!-- START 2023/01/26 [QC#61118,MOD] -->
	    AND (EXISTS(
	            SELECT
	                1
	            FROM
	                RWS_DTL RD
	               ,RWS_STS RSD
	               ,VND     V
	               ,CARR_TP CT
	            WHERE
	                RD.GLBL_CMPY_CD     = RH.GLBL_CMPY_CD
	            AND RD.RWS_NUM          = RH.RWS_NUM
	            AND RD.EZCANCELFLAG     = '0'
	            AND RD.GLBL_CMPY_CD     = RSD.GLBL_CMPY_CD
	            AND RD.RWS_STS_CD       = RSD.RWS_STS_CD
	            AND (RSD.RWS_OPEN_FLG = #flgY# OR RSD.RCV_FLG = #flgY#)
	            AND RSD.EZCANCELFLAG    = '0'
	            AND RD.GLBL_CMPY_CD     = V.GLBL_CMPY_CD
	            AND RD.CARR_CD          = V.VND_CD
	            AND V.EZCANCELFLAG      = '0'
	            AND V.GLBL_CMPY_CD      = CT.GLBL_CMPY_CD
	            AND V.CARR_TP_CD        = CT.CARR_TP_CD
	            AND CT.CARR_TP_NM       = #CARR_TP_NM#
	            AND CT.EZCANCELFLAG     = '0'
	        )
	        OR EXISTS (
	            SELECT
	                1
	            FROM
	                RWS_DTL RD
	               ,RTL_WH  RW
	            WHERE
	                RD.GLBL_CMPY_CD     = RH.GLBL_CMPY_CD
	            AND RD.RWS_NUM          = RH.RWS_NUM
	            AND RD.GLBL_CMPY_CD     = RW.GLBL_CMPY_CD
	            AND RD.RTL_WH_CD        = RW.RTL_WH_CD
	            AND RW.WH_OWNR_CD       = #WH_OWNR_CD#
	            AND RD.EZCANCELFLAG     = '0'
	            AND RW.EZCANCELFLAG     = '0'
	        )
        )
        <!-- END 2022/06/21 [QC#60022,MOD] -->
        <!-- END 2023/01/26 [QC#61118,MOD] -->
        ORDER BY
            RWS_NUM
    </statement>

    <statement id="existRwsSti" parameterClass="Map" resultClass="Map">
        SELECT
            RH.RWS_NUM
        FROM
            RWS_HDR RH
        WHERE
            RH.GLBL_CMPY_CD         = #GLBL_CMPY_CD#
        AND RH.RWS_NUM              = #RWS_NUM#
        AND RH.WMS_DROP_STS_CD      = '0'
        AND RH.EZCANCELFLAG         = '0'
        AND EXISTS (
            SELECT
                1
            FROM
                RWS_DTL RD
               ,RTL_WH  RW
            WHERE
                RD.GLBL_CMPY_CD     = RH.GLBL_CMPY_CD
            AND RD.RWS_NUM          = RH.RWS_NUM
            AND RD.GLBL_CMPY_CD     = RW.GLBL_CMPY_CD
            AND RD.RTL_WH_CD        = RW.RTL_WH_CD
            AND RW.WH_OWNR_CD       = #WH_OWNR_CD#
            AND RD.EZCANCELFLAG     = '0'
            AND RW.EZCANCELFLAG     = '0'
        )
    </statement>

    <statement id="findRwsHeader" parameterClass="Map" resultClass="Map">
        SELECT
            MAIN.*
           ,NVL(
              (
                  SELECT
                      MAX(RD.SCHD_PICK_UP_TM) AS WH_IN_ETA_TM
                  FROM
                      RWS_DTL RD
                  WHERE
                      RD.GLBL_CMPY_CD    = #GLBL_CMPY_CD#
                  AND RD.RWS_NUM         = MAIN.RWS_NUM
                  AND RD.SCHD_PICK_UP_DT = MAIN.WH_IN_ETA_DT
                  AND RD.EZCANCELFLAG    = '0'
              )
              ,
              ''
            ) AS WH_IN_ETA_TM
        FROM (
            SELECT
                RH.RWS_NUM
               ,RH.RWS_REF_NUM
               ,(
                   CASE
                   WHEN RH.SCE_ORD_TP_CD IN (#return#, #rossReturn#)
                       THEN #lr#
                   <!-- START 2022/06/15 [QC#60022,ADD] -->
                   <isNotNull property="sceOrdTpList">
                   WHEN 
                         <iterate property="sceOrdTpList" var="sceOrdTp[]" open="RH.SCE_ORD_TP_CD IN (" close=")" conjunction=",">
                         #sceOrdTp[]#
                         </iterate>
                         AND MAP.ORD_TP_TXT IS NOT NULL
                       THEN MAP.ORD_TP_TXT
                   </isNotNull>
                   <!-- END 2022/06/15 [QC#60022,ADD] -->
                   ELSE #lf#
                   END
               ) ORD_TP_TXT
               ,(
                   CASE
                   WHEN EXISTS(
                       SELECT
                           NULL
                       FROM
                           NLBI1110_01 I01
                       WHERE
                           I01.ORD_ID_TXT      = RH.RWS_REF_NUM
                       AND I01.EZCANCELFLAG    = '0'
                   ) THEN #change#
                   ELSE #newOrder#
                   END
               ) TPL_CTRL_ID
               ,NVL(
                  (
                      SELECT
                          MAX(RD.SCHD_PICK_UP_DT) AS WH_IN_ETA_DT
                      FROM
                          RWS_DTL RD
                      WHERE
                          RD.GLBL_CMPY_CD = RH.GLBL_CMPY_CD
                      AND RD.RWS_NUM      = RH.RWS_NUM
                      AND RD.EZCANCELFLAG = '0'
                  )
                  ,
                  RH.WH_IN_ETA_DT
                ) AS WH_IN_ETA_DT
               ,RH.FROM_LOC_PSN_NM
               ,RH.FROM_LOC_CD
               ,RH.FROM_LOC_NM_01
               ,RH.FROM_LOC_NM_02
               ,RH.FROM_LOC_ADDR_01
               ,RH.FROM_LOC_ADDR_02
               ,RH.FROM_LOC_ADDR_03
               ,RH.FROM_LOC_ADDR_04
               ,RH.FROM_LOC_POST_CD
               ,RH.FROM_LOC_CTY_ADDR
               ,RH.FROM_LOC_CTRY_CD
               ,RH.FROM_LOC_ST_CD
               ,RH.FROM_LOC_TEL_NUM
               ,RH.IMPT_INV_VESL_NM
               ,RH.IMPT_INV_BOL_NUM
               ,RH.WH_CD
               ,RH.SVC_CONFIG_MSTR_PK
               ,CM.S80_CMPY_CD
               ,RH.SCE_ORD_TP_CD
               ,SC.S80_ORD_TP_CD
               ,SC.S80_TRX_CD
            FROM
                RWS_HDR           RH
               ,CMPY_CD_CONV      CM
               ,SCE_ORD_TP        SC
               <!-- START 2022/06/15 [QC#60022,ADD] -->
               ,SCE_ORD_TP_MAP    MAP
               <!-- END 2022/06/15 [QC#60022,ADD] -->
            WHERE
                RH.GLBL_CMPY_CD     = #GLBL_CMPY_CD#
            AND RH.RWS_NUM          = #RWS_NUM#
            AND RH.GLBL_CMPY_CD     = CM.GLBL_CMPY_CD(+)
            AND RH.GLBL_CMPY_CD     = SC.GLBL_CMPY_CD(+)
            AND RH.SCE_ORD_TP_CD    = SC.SCE_ORD_TP_CD(+)
            AND RH.EZCANCELFLAG     = '0'
            AND CM.EZCANCELFLAG(+)  = '0'
            AND SC.EZCANCELFLAG(+)  = '0'
            <!-- START 2022/06/15 [QC#60022,ADD] -->
            AND RH.GLBL_CMPY_CD     = MAP.GLBL_CMPY_CD(+)
            AND RH.SCE_ORD_TP_CD    = MAP.SCE_ORD_TP_CD(+)
            AND MAP.EZCANCELFLAG(+) = '0'
            <!-- END 2022/06/15 [QC#60022,ADD] -->
        ) MAIN
    </statement>

    <statement id="findRwsDetail" parameterClass="Map" resultClass="Map">
        SELECT
            RD.RWS_NUM
           ,RD.RWS_DTL_LINE_NUM
           ,RD.MDSE_CD
           ,RD.RWS_QTY
           ,RH.RWS_REF_NUM
           ,RH.TRX_ORD_NUM
           ,RD.TRX_LINE_NUM
           ,RD.RTL_SWH_CD
           ,RD.INVTY_STK_STS_CD
           ,RD.WH_IN_ETA_DT
           ,RD.IMPT_INV_NUM
           ,RD.IMPT_INV_DO_NUM
           ,RD.OUT_PACK_FROM_CSE_NUM
           ,RD.OUT_PACK_TO_CSE_NUM
           ,RD.THIRD_PTY_DSP_TP_CD
           ,RD.SER_APVL_REQ_FLG
           ,TL.PLANT_CD
           ,TL.TPL_LOC_NM
           ,ST.S80_STK_STS_CD
           ,RD.SCHD_PICK_UP_TM
<!-- START 2021/06/15 [QC#56495,ADD] -->
           ,RH.SVC_CONFIG_MSTR_PK
           ,MDS.ITRL_ITEM_FLG
<!-- END 2021/06/15 [QC#56495,ADD] -->
        FROM
            RWS_HDR             RH
           ,RWS_DTL             RD
           ,RWS_STS             RSD
           ,TPL_LOC             TL
           ,STK_STS_CONV        ST
<!-- START 2021/06/15 [QC#56495,ADD] -->
           ,MDSE                MDS
<!-- END 2021/06/15 [QC#56495,ADD] -->
        WHERE
            RH.GLBL_CMPY_CD     = #GLBL_CMPY_CD#
        AND RH.RWS_NUM          = #RWS_NUM#
        AND RH.EZCANCELFLAG     = '0'
        AND RH.GLBL_CMPY_CD     = RD.GLBL_CMPY_CD
        AND RH.RWS_NUM          = RD.RWS_NUM
        AND RD.EZCANCELFLAG     = '0'
        AND RD.GLBL_CMPY_CD     = RSD.GLBL_CMPY_CD
        AND RD.RWS_STS_CD       = RSD.RWS_STS_CD
        AND (RSD.RWS_OPEN_FLG = #flgY# OR RSD.RCV_FLG = #flgY#)
        AND RSD.EZCANCELFLAG    = '0'
        AND RD.GLBL_CMPY_CD     = TL.GLBL_CMPY_CD(+)
        AND RD.RTL_WH_CD        = TL.TPL_LOC_CD(+)
        AND RD.INVTY_STK_STS_CD = TL.TPL_STK_STS_CD(+)
        AND TL.EZCANCELFLAG(+)  = '0'
        AND RD.GLBL_CMPY_CD     = ST.GLBL_CMPY_CD(+)
        AND RD.INVTY_STK_STS_CD = ST.STK_STS_CD(+)
        AND ST.EZCANCELFLAG(+)  = '0'
<!-- START 2021/06/15 [QC#56495,ADD] -->
        AND RD.GLBL_CMPY_CD     = MDS.GLBL_CMPY_CD(+)
        AND RD.MDSE_CD          = MDS.MDSE_CD(+)
        AND MDS.EZCANCELFLAG(+) = '0'
<!-- END 2021/06/15 [QC#56495,ADD] -->
        ORDER BY
            RD.RWS_DTL_LINE_NUM
    </statement>

    <statement id="findRwsText" parameterClass="Map" resultClass="Map">
        SELECT
            RM.RWS_NUM
           ,RM.RWS_MSG_SQ_NUM
           ,RM.RWS_MSG_TXT
        FROM
            RWS_MSG RM
        WHERE
            RM.GLBL_CMPY_CD = #GLBL_CMPY_CD#
        AND RM.RWS_NUM      = #RWS_NUM#
        AND RM.EZCANCELFLAG = '0'
        ORDER BY
            RM.RWS_MSG_SQ_NUM
    </statement>

    <statement id="findRwsSiteSurvey" parameterClass="Map" resultClass="Map">
        SELECT
            RH.RWS_NUM
            ,COALESCE(DSS1.CPO_ORD_NUM, DSS2.CPO_ORD_NUM) CPO_ORD_NUM
            ,COALESCE(DSS1.CPO_DTL_LINE_NUM, DSS2.CPO_DTL_LINE_NUM) CPO_DTL_LINE_NUM
            ,COALESCE(DSS1.CPO_DTL_LINE_SUB_NUM, DSS2.CPO_DTL_LINE_SUB_NUM) CPO_DTL_LINE_SUB_NUM
            ,RH.FROM_LOC_NM_01
            ,RH.FROM_LOC_CD
            ,RH.FROM_LOC_ADDR_01
            ,RH.FROM_LOC_CTY_ADDR
            ,COALESCE(DSS1.CMPY_INFO_APT_BLDG_NM, DSS2.CMPY_INFO_APT_BLDG_NM) CMPY_INFO_APT_BLDG_NM
            ,RH.FROM_LOC_ST_CD
            ,COALESCE(RDI.CMPY_INFO_FL_NM, DSS1.CMPY_INFO_FL_NM, DSS2.CMPY_INFO_FL_NM) CMPY_INFO_FL_NM
            ,RH.FROM_LOC_POST_CD
            ,COALESCE(DSS1.CMPY_INFO_DEPT_NM, DSS2.CMPY_INFO_DEPT_NM) CMPY_INFO_DEPT_NM
            ,COALESCE(DSS1.ELEV_PROT_REQ_FLG, DSS2.ELEV_PROT_REQ_FLG) ELEV_PROT_REQ_FLG
            ,COALESCE(RDI.DELY_INSTN_ADDL_CMNT_TXT, DSS1.SITE_SRVY_ADDL_CMNT_TXT, DSS2.SITE_SRVY_ADDL_CMNT_TXT) SITE_SRVY_ADDL_CMNT_TXT
            ,COALESCE(RDI.OTSD_STEP_NUM, DSS1.OTSD_STEP_NUM, DSS2.OTSD_STEP_NUM) OTSD_STEP_NUM
            ,COALESCE(RDI.INSD_STEP_NUM, DSS1.INSD_STEP_NUM, DSS2.INSD_STEP_NUM) INSD_STEP_NUM
            ,COALESCE(RDI.STAIR_CRAW_REQ_FLG, DSS1.STAIR_CRAW_REQ_FLG, DSS2.STAIR_CRAW_REQ_FLG) STAIR_CRAW_REQ_FLG
            ,COALESCE(DSS1.FLGT_STAIR_NUM, DSS2.FLGT_STAIR_NUM) FLGT_STAIR_NUM
            ,COALESCE(RDI.STAIR_AND_LDG_WDT, DSS1.STAIR_AND_LDG_WDT, DSS2.STAIR_AND_LDG_WDT) STAIR_AND_LDG_WDT
            ,COALESCE(RDI.LOAD_DOCK_AVAL_TXT, DSS1.LOAD_DOCK_AVAL_FLG, DSS2.LOAD_DOCK_AVAL_FLG) LOAD_DOCK_AVAL_FLG
            ,COALESCE(RDI.LOAD_DOCK_HGT, DSS1.LOAD_DOCK_HGT, DSS2.LOAD_DOCK_HGT) LOAD_DOCK_HGT
            ,COALESCE(RDI.OPS_FROM_HOUR_MN, DSS1.LOAD_DOCK_AVAL_FROM_HOUR_MN, DSS2.LOAD_DOCK_AVAL_FROM_HOUR_MN) LOAD_DOCK_AVAL_FROM_HOUR_MN
            ,COALESCE(RDI.OPS_TO_HOUR_MN, DSS1.LOAD_DOCK_AVAL_TO_HOUR_MN, DSS2.LOAD_DOCK_AVAL_TO_HOUR_MN) LOAD_DOCK_AVAL_TO_HOUR_MN
            ,COALESCE(RDI.TRCTR_AND_TRAIL_ACCS_TXT, DSS1.TRCTR_AND_TRAIL_ACCS_FLG, DSS2.TRCTR_AND_TRAIL_ACCS_FLG) TRCTR_AND_TRAIL_ACCS_FLG
            ,DCII.RQST_ISTL_TM CARR_DELY_TM_HOUR_MN
            ,COALESCE(RDI.DELY_TRNSP_OPT_CD, DSS1.DELY_TRNSP_OPT_CD, DSS2.DELY_TRNSP_OPT_CD) DELY_TRNSP_OPT_CD
            ,RDI.SEC_CLNC_REQ_TXT
            ,RDI.INS_CERT_REQ_TXT
            ,RDI.FL_COV_TXT
            ,RDI.RAMP_AVAL_TXT
            ,RDI.STEP_AVAL_TXT
            ,RDI.FRONT_DOOR_AVAL_TXT
            ,RDI.BACK_DOOR_AVAL_TXT
            ,RDI.PWR_OTLT_CONFIG_TXT
            ,RDI.SGN_ON_BLDG_RDSD_TXT
            ,RDI.BLDG_STRY_NUM
            ,RDI.BLDG_GURD_NTFY_TXT
            ,RDI.INDL_PARK_TXT
            ,RDI.BIZ_PARK_TXT
            ,RDI.PRO_BLDG_TXT
            ,RDI.SHPNG_CTR_TXT
            ,RDI.PVT_RES_TXT
            ,COALESCE(RDI.ELEV_AVAL_TXT, DSS1.ELEV_AVAL_FLG, DSS2.ELEV_AVAL_FLG) ELEV_AVAL_FLG
            ,COALESCE(RDI.ELEV_AVAL_FROM_HOUR_MN, DSS1.ELEV_AVAL_FROM_HOUR_MN, DSS2.ELEV_AVAL_FROM_HOUR_MN) ELEV_AVAL_FROM_HOUR_MN
            ,COALESCE(RDI.ELEV_AVAL_TO_HOUR_MN, DSS1.ELEV_AVAL_TO_HOUR_MN, DSS2.ELEV_AVAL_TO_HOUR_MN) ELEV_AVAL_TO_HOUR_MN
            ,COALESCE(RDI.ELEV_APPT_REQ_TXT, DSS1.ELEV_APPT_REQ_FLG, DSS2.ELEV_APPT_REQ_FLG) ELEV_APPT_REQ_FLG
            ,COALESCE(RDI.ELEV_CTAC_PSN_NM, DSS1.ELEV_CTAC_PSN_NM, DSS2.ELEV_CTAC_PSN_NM) ELEV_CTAC_PSN_NM
            ,COALESCE(RDI.ELEV_CTAC_TEL_NUM, DSS1.ELEV_CTAC_TEL_NUM, DSS2.ELEV_CTAC_TEL_NUM) ELEV_CTAC_TEL_NUM
            ,COALESCE(RDI.BLDG_ENT_DOOR_HGT, DSS1.BLDG_ENT_DOOR_HGT, DSS2.BLDG_ENT_DOOR_HGT) BLDG_ENT_DOOR_HGT
            ,COALESCE(RDI.BLDG_ENT_DOOR_WDT, DSS1.BLDG_ENT_DOOR_WDT, DSS2.BLDG_ENT_DOOR_WDT) BLDG_ENT_DOOR_WDT
            ,COALESCE(RDI.CRDR_WDT, DSS1.CRDR_WDT, DSS2.CRDR_WDT) CRDR_WDT
            ,COALESCE(RDI.DOOR_WDT, DSS1.DOOR_WDT, DSS2.DOOR_WDT) DOOR_WDT
            ,COALESCE(RDI.ELEV_WDT, DSS1.ELEV_WDT, DSS2.ELEV_WDT) ELEV_WDT
            ,COALESCE(RDI.ELEV_DEPTH_NUM, DSS1.ELEV_DEPTH_NUM, DSS2.ELEV_DEPTH_NUM) ELEV_DEPTH_NUM
            ,COALESCE(RDI.ELEV_CAP_WT, DSS1.ELEV_CAP_WT, DSS2.ELEV_CAP_WT) ELEV_CAP_WT
            ,COALESCE(RDI.ELEV_DOOR_HGT, DSS1.ELEV_DOOR_HGT, DSS2.ELEV_DOOR_HGT) ELEV_DOOR_HGT
            ,COALESCE(RDI.ELEV_DOOR_WDT, DSS1.ELEV_DOOR_WDT, DSS2.ELEV_DOOR_WDT) ELEV_DOOR_WDT
            ,COALESCE(RDI.CUST_INFO_BO_FLG, 'N') CUST_INFO_BO_FLG
            ,COALESCE(RDI.PICK_UP_XTR_TONER_FLG, 'N') PICK_UP_XTR_TONER_FLG
            ,COALESCE(RDI.PICK_UP_AT_SAME_TM_FLG, 'N') PICK_UP_AT_SAME_TM_FLG
        FROM
            RWS_HDR RH
           ,RWS_DELY_INSTN RDI
           ,DS_SITE_SRVY DSS1
           ,DS_SITE_SRVY DSS2
           ,DS_CPO_ISTL_INFO DCII
        WHERE
            RH.GLBL_CMPY_CD         = #GLBL_CMPY_CD#
        AND RH.RWS_NUM              = #RWS_NUM#
        AND RH.SCE_ORD_TP_CD        = #SCE_ORD_TP_CD#
        AND RH.GLBL_CMPY_CD         = RDI.GLBL_CMPY_CD(+)
        AND RH.RWS_NUM              = RDI.RWS_NUM(+)
        AND RH.GLBL_CMPY_CD         = DSS1.GLBL_CMPY_CD(+)
        AND RH.TRX_ORD_NUM          = DSS1.CPO_ORD_NUM(+)
        AND RH.DS_CPO_CONFIG_PK     = DSS1.DS_CPO_CONFIG_PK(+)
        AND RH.GLBL_CMPY_CD         = DSS2.GLBL_CMPY_CD(+)
        AND RH.TRX_ORD_NUM          = DSS2.CPO_ORD_NUM(+)
        AND RH.GLBL_CMPY_CD         = DCII.GLBL_CMPY_CD(+)
        AND RH.TRX_ORD_NUM          = DCII.CPO_ORD_NUM(+)
        AND RH.EZCANCELFLAG         = '0'
        AND RDI.EZCANCELFLAG(+)     = '0'
        AND DSS1.EZCANCELFLAG(+)    = '0'
        AND DSS2.EZCANCELFLAG(+)    = '0'
        AND DCII.EZCANCELFLAG(+)    = '0'
    </statement>

    <statement id="findRwsMdseSurvey" parameterClass="Map" resultClass="Map">
        SELECT
            RD.RWS_NUM
           ,RD.RWS_DTL_LINE_NUM
           ,MD.MDSE_CD
           ,MD.MDSE_NM
           ,MSP.IN_POUND_WT
           ,MSP.IN_INCH_LG
           ,MSP.IN_INCH_WDT
           ,MSP.IN_INCH_HGT
           ,ROUND(
             SQRT(
                 POWER(MSP.IN_INCH_LG,  2)
               + POWER(MSP.IN_INCH_WDT, 2)
               + POWER(MSP.IN_INCH_HGT, 2)
             ), 4) IN_INCH_DG
        FROM
            RWS_DTL RD
           ,MDSE MD
           ,MDSE_STORE_PKG MSP
        WHERE
            RD.GLBL_CMPY_CD     = #GLBL_CMPY_CD#
        AND RD.RWS_NUM          = #RWS_NUM#
        AND RD.GLBL_CMPY_CD     = MD.GLBL_CMPY_CD(+)
        AND RD.MDSE_CD          = MD.MDSE_CD(+)
        AND RD.GLBL_CMPY_CD     = MSP.GLBL_CMPY_CD(+)
        AND RD.MDSE_CD          = MSP.MDSE_CD(+)
        AND RD.EZCANCELFLAG     = '0'
        AND MD.EZCANCELFLAG(+)  = '0'
        AND MSP.EZCANCELFLAG(+) = '0'
        ORDER BY
            RD.RWS_DTL_LINE_NUM
    </statement>

    <statement id="findRwsSerial" parameterClass="Map" resultClass="Map">
        SELECT
            RS.SER_NUM
        FROM
            RWS_SER RS
        WHERE
            RS.GLBL_CMPY_CD = #GLBL_CMPY_CD#
        AND RS.RWS_NUM      = #RWS_NUM#
        AND RS.RWS_LINE_NUM = #RWS_LINE_NUM#
        AND RS.EZCANCELFLAG = '0'
        ORDER BY
            RS.SER_NUM
    </statement>
    
    <statement id="getTplCarrSvcLvlByRws" parameterClass="Map" resultClass="Map">
        WITH SELECTED_TPL_CARR_SVC_LVL AS (
            SELECT
                TPL_CARR_CD
               ,TPL_SVC_LVL_CD
               ,TPL_CARR_SVC_LVL_SORT_NUM
            FROM
                TPL_CARR_SVC_LVL TC
               ,RWS_DTL RSD
            WHERE
                TC.GLBL_CMPY_CD     = #GLBL_CMPY_CD#
            AND TC.WH_OWNR_CD       = #WH_OWNR_CD#
            AND TC.GLBL_CMPY_CD     = RSD.GLBL_CMPY_CD
            AND TC.CARR_CD          = RSD.CARR_CD
            AND TC.SHPG_SVC_LVL_CD  = RSD.SHPG_SVC_LVL_CD
            AND RSD.RWS_NUM         = #RWS_NUM#
            AND TC.EZCANCELFLAG     = '0'
            AND RSD.EZCANCELFLAG    = '0'
            UNION
            SELECT
                TPL_CARR_CD
               ,TPL_SVC_LVL_CD
               ,TPL_CARR_SVC_LVL_SORT_NUM
            FROM
                TPL_CARR_SVC_LVL TC
                ,RWS_DTL RSD
            WHERE
                TC.GLBL_CMPY_CD     = #GLBL_CMPY_CD#
            AND TC.WH_OWNR_CD       = #WH_OWNR_CD#
            AND TC.GLBL_CMPY_CD     = RSD.GLBL_CMPY_CD
            AND TC.CARR_CD          = RSD.CARR_CD
            AND RSD.RWS_NUM         = #RWS_NUM#
            AND RSD.SHPG_SVC_LVL_CD IS NULL
            AND TC.EZCANCELFLAG     = '0'
            AND RSD.EZCANCELFLAG    = '0'
            UNION
            SELECT
                TPL_CARR_CD
                ,TPL_SVC_LVL_CD
                ,TPL_CARR_SVC_LVL_SORT_NUM
            FROM
                TPL_CARR_SVC_LVL TC
                ,RWS_DTL RSD
            WHERE
                TC.GLBL_CMPY_CD     = #GLBL_CMPY_CD#
            AND TC.WH_OWNR_CD       = #WH_OWNR_CD#
            AND TC.GLBL_CMPY_CD     = RSD.GLBL_CMPY_CD
            AND TC.SHPG_SVC_LVL_CD  = RSD.SHPG_SVC_LVL_CD
            AND RSD.RWS_NUM         = #RWS_NUM#
            AND RSD.CARR_CD         IS NULL
            AND TC.EZCANCELFLAG     = '0'
            AND RSD.EZCANCELFLAG    = '0'
        )
        SELECT
            TPL_CARR_CD
           ,TPL_SVC_LVL_CD
        FROM (
            SELECT
                STC.TPL_CARR_CD
               ,STC.TPL_SVC_LVL_CD
            FROM
                SELECTED_TPL_CARR_SVC_LVL STC
            ORDER BY
                STC.TPL_CARR_SVC_LVL_SORT_NUM
        )
        WHERE
            ROWNUM &lt;= 1
    </statement>

    <statement id="countWmsInbdPo" parameterClass="Map" resultClass="BigDecimal">
        SELECT
               COUNT(*)
          FROM
               WMS_INBD_PO_HDR WIPH
         WHERE
               WIPH.GLBL_CMPY_CD = #glblCmpyCd#
           AND WIPH.WMS_PO_ID    = #wmsPoId#
           AND WIPH.EZCANCELFLAG = '0'
    </statement>

    <statement id="findIFHeader" parameterClass="Map" resultClass="Map">
        SELECT
            I.EZTABLEID
            ,I.EZCANCELFLAG
            ,I.EZINTIME
            ,I.EZINTIMEZONE
            ,I.EZINCOMPANYCODE
            ,I.EZINUSERID
            ,I.EZINAPLID
            ,I.EZUPTIME
            ,I.EZUPTIMEZONE
            ,I.EZUPCOMPANYCODE
            ,I.EZUPUSERID
            ,I.EZUPAPLID
            ,I.INTERFACE_ID
            ,I.TRANSACTION_ID
            ,I.SEGMENT_ID
            ,I.UNIT_ID
            ,I.SEQ_NUMBER
            ,I.WMS_REC_ID
            ,I.TPL_FROM_PTNR_ID
            ,I.TPL_TO_PTNR_ID
            ,I.ORD_DT_TM_TS_TXT
            ,I.ORD_ID_TXT
            ,I.TPL_REF_NM
            ,I.TPL_LOC_TXT
            ,I.TPL_COND_TXT
            ,I.ORD_TP_TXT
            ,I.TPL_ORG_TXT
            ,I.TPL_CTRL_ID
            ,I.CARR_CD
            ,I.REQ_DT_TM_TS_TXT
            ,I.RQST_SHIP_DT_TM_TS_TXT
            ,I.SHIP_CTAC_NM_TXT
            ,I.SHIP_CTAC_PHO_NUM
            ,I.TPL_PTNR_TXT
            ,I.SHIP_CUST_TXT
            ,I.SHIP_FIRST_LINE_NM
            ,I.SHIP_SCD_LINE_NM
            ,I.SHIP_THIRD_LINE_NM
            ,I.SHIP_FRTH_LINE_NM
            ,I.SHIP_FIRST_LINE_ADDR_TXT
            ,I.SHIP_SCD_LINE_ADDR_TXT
            ,I.SHIP_ZIP_OR_POST_CD_TXT
            ,I.SHIP_CTY_TXT
            ,I.SHIP_CTRY_TXT
            ,I.SHIP_ST_OR_PROV_TXT
            ,I.SHIP_PHO_NUM_TXT
        FROM
            NLBI1110_01 I
        WHERE
            I.INTERFACE_ID      = #interfaceId#
        AND I.TRANSACTION_ID    = #transactionId#
        AND I.EZCANCELFLAG      = '0'
        ORDER BY
            I.INTERFACE_ID
            ,I.TRANSACTION_ID
            ,I.SEGMENT_ID
            ,I.UNIT_ID
            ,I.SEQ_NUMBER
    </statement>

    <statement id="findIFComment" parameterClass="Map" resultClass="Map">
        SELECT
            I.EZTABLEID
            ,I.EZCANCELFLAG
            ,I.EZINTIME
            ,I.EZINTIMEZONE
            ,I.EZINCOMPANYCODE
            ,I.EZINUSERID
            ,I.EZINAPLID
            ,I.EZUPTIME
            ,I.EZUPTIMEZONE
            ,I.EZUPCOMPANYCODE
            ,I.EZUPUSERID
            ,I.EZUPAPLID
            ,I.INTERFACE_ID
            ,I.TRANSACTION_ID
            ,I.SEGMENT_ID
            ,I.UNIT_ID
            ,I.SEQ_NUMBER
            ,I.WMS_REC_ID
            ,I.SO_MSG_DESC_TXT
        FROM
            NLBI1110_03 I
        WHERE
            I.INTERFACE_ID      = #interfaceId#
        AND I.TRANSACTION_ID    = #transactionId#
        AND I.SEGMENT_ID        = #segmentId#
        AND I.EZCANCELFLAG      = '0'
        ORDER BY
            I.INTERFACE_ID
            ,I.TRANSACTION_ID
            ,I.SEGMENT_ID
            ,I.UNIT_ID
            ,I.SEQ_NUMBER
    </statement>

    <statement id="findIFDetail" parameterClass="Map" resultClass="Map">
        SELECT
            I.EZTABLEID
            ,I.EZCANCELFLAG
            ,I.EZINTIME
            ,I.EZINTIMEZONE
            ,I.EZINCOMPANYCODE
            ,I.EZINUSERID
            ,I.EZINAPLID
            ,I.EZUPTIME
            ,I.EZUPTIMEZONE
            ,I.EZUPCOMPANYCODE
            ,I.EZUPUSERID
            ,I.EZUPAPLID
            ,I.INTERFACE_ID
            ,I.TRANSACTION_ID
            ,I.SEGMENT_ID
            ,I.UNIT_ID
            ,I.SEQ_NUMBER
            ,I.WMS_REC_ID
            ,I.ITEM_CD_TXT
            ,I.QTY_ORD_TXT
            ,I.ORD_LINE_TXT
            ,I.TPL_ITEM_TP_CD
            ,I.CUST_PO_TP_TXT
            ,I.CUST_PO_LINE_TXT
            ,I.TPL_LOC_TXT
            ,I.TPL_SWH_CD
<!-- START 2021/06/15 [QC#56495,ADD] -->
            ,I.SVC_CONFIG_MSTR_PK
            ,I.ITRL_ITEM_FLG
<!-- END 2021/06/15 [QC#56495,ADD] -->
        FROM
            NLBI1110_02 I
        WHERE
            I.INTERFACE_ID      = #interfaceId#
        AND I.TRANSACTION_ID    = #transactionId#
        AND I.SEGMENT_ID        = #segmentId#
        AND I.EZCANCELFLAG      = '0'
        ORDER BY
            I.INTERFACE_ID
            ,I.TRANSACTION_ID
            ,I.SEGMENT_ID
            ,I.UNIT_ID
            ,I.SEQ_NUMBER
    </statement>

    <statement id="findIFSerial" parameterClass="Map" resultClass="Map">
        SELECT
            I.EZTABLEID
            ,I.EZCANCELFLAG
            ,I.EZINTIME
            ,I.EZINTIMEZONE
            ,I.EZINCOMPANYCODE
            ,I.EZINUSERID
            ,I.EZINAPLID
            ,I.EZUPTIME
            ,I.EZUPTIMEZONE
            ,I.EZUPCOMPANYCODE
            ,I.EZUPUSERID
            ,I.EZUPAPLID
            ,I.INTERFACE_ID
            ,I.TRANSACTION_ID
            ,I.SEGMENT_ID
            ,I.UNIT_ID
            ,I.SEQ_NUMBER
            ,I.WMS_REC_ID
            ,I.TPL_SER_NUM
        FROM
            NLBI1110_05 I
        WHERE
            I.INTERFACE_ID      = #interfaceId#
        AND I.TRANSACTION_ID    = #transactionId#
        AND I.SEGMENT_ID        = #segmentId#
        AND I.UNIT_ID           = #unitId#
        AND I.EZCANCELFLAG      = '0'
        ORDER BY
            I.INTERFACE_ID
            ,I.TRANSACTION_ID
            ,I.SEGMENT_ID
            ,I.UNIT_ID
            ,I.SEQ_NUMBER
    </statement>

    <statement id="findIFSiteSurvey" parameterClass="Map" resultClass="Map">
        SELECT
            I.EZTABLEID
            ,I.EZCANCELFLAG
            ,I.EZINTIME
            ,I.EZINTIMEZONE
            ,I.EZINCOMPANYCODE
            ,I.EZINUSERID
            ,I.EZINAPLID
            ,I.EZUPTIME
            ,I.EZUPTIMEZONE
            ,I.EZUPCOMPANYCODE
            ,I.EZUPUSERID
            ,I.EZUPAPLID
            ,I.INTERFACE_ID
            ,I.TRANSACTION_ID
            ,I.SEGMENT_ID
            ,I.UNIT_ID
            ,I.SEQ_NUMBER
            ,I.WMS_REC_ID
            ,I.TPL_SITE_SRVY_TXT
        FROM
            NLBI1110_04 I
        WHERE
            I.INTERFACE_ID      = #interfaceId#
        AND I.TRANSACTION_ID    = #transactionId#
        AND I.SEGMENT_ID        = #segmentId#
        AND I.UNIT_ID           = #unitId#
        AND I.EZCANCELFLAG      = '0'
        ORDER BY
            I.INTERFACE_ID
            ,I.TRANSACTION_ID
            ,I.SEGMENT_ID
            ,I.UNIT_ID
            ,I.SEQ_NUMBER
    </statement>

    <statement id="getShpgPntCd" parameterClass="Map" resultClass="String">
        SELECT
            TL.SHPG_PNT_CD
        FROM
            TPL_LOC TL
        WHERE
            TL.GLBL_CMPY_CD = #GLBL_CMPY_CD#
        AND TL.TPL_LOC_CD   = #RTL_WH_CD#
        AND TL.EZCANCELFLAG = '0'
        AND ROWNUM          = 1
    </statement>

    <statement id="getRcvPntCd" parameterClass="Map" resultClass="String">
        SELECT
            TL.RCV_PNT_CD
        FROM
            TPL_LOC TL
        WHERE
            TL.GLBL_CMPY_CD = #GLBL_CMPY_CD#
        AND TL.TPL_LOC_CD   = #RTL_WH_CD#
        AND TL.EZCANCELFLAG = '0'
        AND ROWNUM          = 1
    </statement>
    <statement id="getShipPhoNumTxtFromDsCpoCtacPsn" parameterClass="Map" resultClass="Map">
        SELECT
             CTAC_PSN_TEL_NUM
            ,CTAC_PSN_NM
        FROM
        (
            SELECT 
                 DPCP.CTAC_PSN_TEL_NUM    AS CTAC_PSN_TEL_NUM
                ,DPCP.CTAC_PSN_FIRST_NM ||' '|| CTAC_PSN_LAST_NM    AS CTAC_PSN_NM
            FROM 
                SHPG_ORD SO
                ,DS_CPO_CTAC_PSN DPCP
            WHERE
                SO.GLBL_CMPY_CD   = #GLBL_CMPY_CD#
            AND SO.SO_NUM         = #SO_NUM#
            AND SO.EZCANCELFLAG   = '0'
            AND SO.GLBL_CMPY_CD   = DPCP.GLBL_CMPY_CD
            AND SO.TRX_HDR_NUM    = DPCP.CPO_ORD_NUM
            AND DPCP.EZCANCELFLAG = '0'
        )
        WHERE ROWNUM = 1
    </statement>
    <statement id="getShipCtacPhoNumFromDsCpoCtacPsn" parameterClass="Map" resultClass="Map">
        SELECT
             CTAC_PSN_TEL_NUM
            ,CTAC_PSN_NM
        FROM
        (
            SELECT 
                 DPCP.CTAC_PSN_TEL_NUM    AS CTAC_PSN_TEL_NUM
                ,DPCP.CTAC_PSN_FIRST_NM ||' '|| CTAC_PSN_LAST_NM    AS CTAC_PSN_NM
            FROM 
                RWS_HDR RWS
                ,DS_CPO_CTAC_PSN DPCP
            WHERE
                RWS.GLBL_CMPY_CD  = #GLBL_CMPY_CD#
            AND RWS.RWS_NUM       = #RWS_NUM#
            AND RWS.EZCANCELFLAG  = '0'
            AND RWS.GLBL_CMPY_CD  = DPCP.GLBL_CMPY_CD
            AND RWS.TRX_ORD_NUM   = DPCP.CPO_ORD_NUM
            AND DPCP.EZCANCELFLAG = '0'
        )
        WHERE ROWNUM            = 1
    </statement>

    <statement id="chkToWhSTIandCarrSTI" parameterClass="Map" resultClass="String">
        SELECT
            SO.SO_NUM
        FROM
            SHPG_ORD SO
        WHERE
            SO.GLBL_CMPY_CD         = #GLBL_CMPY_CD#
        AND SO.SO_NUM               = #SO_NUM#
        AND SO.EZCANCELFLAG         = '0'
        AND EXISTS (
                SELECT
                   1
                FROM
                     SHPG_ORD_DTL SOD
                    ,RTL_WH RW
                    ,VND VN
                    ,CARR_TP CT
                WHERE
                    SOD.GLBL_CMPY_CD      = SO.GLBL_CMPY_CD
                AND SOD.SO_NUM            = SO.SO_NUM
                AND SOD.GLBL_CMPY_CD      = RW.GLBL_CMPY_CD
                AND SOD.SHIP_TO_RTL_WH_CD = RW.RTL_WH_CD
                AND RW.WH_OWNR_CD         = #WH_OWNR_CD#
                AND VN.GLBL_CMPY_CD       = SO.GLBL_CMPY_CD
                AND VN.VND_CD             = NVL(SO.CARR_CD, SO.VND_CD)
                AND VN.GLBL_CMPY_CD       = CT.GLBL_CMPY_CD
                AND VN.CARR_TP_CD         = CT.CARR_TP_CD
                AND CT.CARR_TP_NM         = #CARR_TP_NM#
                AND SOD.EZCANCELFLAG      = '0'
                AND RW.EZCANCELFLAG       = '0'
                AND VN.EZCANCELFLAG       = '0'
                AND CT.EZCANCELFLAG       = '0'
            )
    </statement>
</sqlMap>
