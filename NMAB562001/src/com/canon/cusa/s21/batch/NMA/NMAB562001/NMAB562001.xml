<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAB562001">
    <statement id="getTergetCustomerInfo" parameterClass="Map" resultClass="Map">
        SELECT
             C.CPO_ORD_NUM
            ,C.ADD_SHIP_TO_CUST_CD
            ,C.AQU_NUM
        FROM
             CPO C
            ,(SELECT DISTINCT
                   DRDI.DS_ORD_CATG_CD
                  ,DRDI.DS_ORD_TP_CD
              FROM
                  DS_RTL_DLR_INFO DRDI
              WHERE
                  DRDI.EZCANCELFLAG        = '0'
                  AND DRDI.GLBL_CMPY_CD    = #glblCmpyCd#
                  AND DRDI.EFF_FROM_DT &lt;= #procDt#
                  AND (DRDI.EFF_THRU_DT    IS NULL
                  OR DRDI.EFF_THRU_DT  &gt;= #procDt#)
            ) ORD_TP
        WHERE
                C.GLBL_CMPY_CD          = #glblCmpyCd#
            AND C.EZCANCELFLAG          = '0'
            AND C.ORD_HDR_STS_CD &lt;&gt; #ordHdrStsCanc#
            AND C.AQU_NUM IS NOT NULL
            AND C.ORD_BOOK_FLG          = 'Y'
            AND C.DS_ORD_CATG_CD        = ORD_TP.DS_ORD_CATG_CD
            AND C.DS_ORD_TP_CD          = ORD_TP.DS_ORD_TP_CD
            AND TO_DATE(SUBSTR(C.ORD_BOOK_TS,1,8),'YYYYMMDD') &gt; ( TO_DATE(#procDt#,'YYYYMMDD') - #befDay# )
        ORDER BY 
                C.ORD_BOOK_TS ASC
               ,C.CPO_ORD_NUM ASC
    </statement>

    <statement id="getXrefAcctCd" parameterClass="Map" resultClass="Map">
        SELECT
            DXA.DS_XREF_ACCT_CD
        FROM
            DS_XREF_ACCT DXA
        WHERE
            DXA.GLBL_CMPY_CD           = #glblCmpyCd#
            AND DXA.EZCANCELFLAG       = '0'
            AND DXA.DS_XREF_ACCT_TP_CD = #dsXrefAcctTpCusa#
            AND DXA.DS_XREF_ACCT_CD    = #rtlInstlCd#
    </statement>

    <statement id="getCustomerUpdateInfo" parameterClass="Map" resultClass="Map">
        SELECT
             SEC.SELL_TO_CUST_PK        SELL_TO_CUST_PK
            ,SEC.DS_ACCT_NM             DS_ACCT_NM
            ,SEC.SELL_TO_CUST_CD        SELL_TO_CUST_CD
            ,SEC.DS_ACCT_ITRL_FLG       DS_ACCT_ITRL_FLG
            ,SEC.FIRST_REF_CMNT_TXT     FIRST_REF_CMNT_TXT
            ,SEC.SCD_REF_CMNT_TXT       SCD_REF_CMNT_TXT
            ,AL.EFF_THRU_DT             EFF_THRU_DT
            ,PLW.PTY_LOC_PK             PTY_LOC_PK
            ,PLW.LOC_NUM                LOC_NUM
            ,PLW.FIRST_LINE_ADDR        FIRST_LINE_ADDR
            ,PLW.SCD_LINE_ADDR          SCD_LINE_ADDR
            ,PLW.THIRD_LINE_ADDR        THIRD_LINE_ADDR
            ,PLW.FRTH_LINE_ADDR         FRTH_LINE_ADDR
            ,PLW.CTY_ADDR               CTY_ADDR
            ,C.CNTY_NM                  CNTY_NM
            ,PLW.ST_CD                  ST_CD
            ,PLW.POST_CD                POST_CD
            ,PLW.TEL_NUM                TEL_NUM
            ,PLW.EFF_FROM_DT            EFF_FROM_DT
            ,SEC.DS_ACCT_TP_CD          DS_ACCT_TP_CD
            ,SEC.DS_ACCT_CLS_CD         DS_ACCT_CLS_CD
            ,SEC.COA_CH_CD              COA_CH_CD
            ,SEC.COA_AFFL_CD            COA_AFFL_CD
            ,SEC.DS_ACCT_DLR_CD         DS_ACCT_DLR_CD
            ,SEC.DS_ACCT_LEGAL_NM       DS_ACCT_LEGAL_NM
            ,SEC.DBA_NM                 DBA_NM
            ,SEC.RGTN_STS_CD            RGTN_STS_CD
            ,SEC.DS_ACCT_URL            DS_ACCT_URL
            ,PLW.CTRY_CD                CTRY_CD
            ,PLW.DS_LOC_NM              DS_LOC_NM
            ,PLW.ADDL_LOC_NM            ADDL_LOC_NM
            ,PLW.GLN_NUM                GLN_NUM
            ,PLW.FAX_NUM                FAX_NUM
            ,PLW.PROV_NM                PROV_NM
            ,PLW.LINE_BIZ_TP_CD         LINE_BIZ_TP_CD
            ,PLW.GEO_CD                 GEO_CD
            ,PLW.DS_INSD_CTY_LIMIT_FLG  DS_INSD_CTY_LIMIT_FLG
            ,STC.SHIP_TO_CUST_CD        SHIP_TO_CUST_CD
        FROM
             SELL_TO_CUST SEC
            ,ACCT_LOC AL
            ,PTY_LOC_WRK PLW
            ,SHIP_TO_CUST STC
            ,CNTY C
        WHERE
                SEC.GLBL_CMPY_CD            = #glblCmpyCd#
            AND SEC.DS_ACCT_ACTV_CUST_FLG   = 'Y'
            AND SEC.EFF_FROM_DT         &lt;= #procDt#
            AND (SEC.EFF_THRU_DT IS NULL
            OR SEC.EFF_THRU_DT          &gt;= #procDt#)
            AND SEC.EZCANCELFLAG            = '0'
            AND SEC.GLBL_CMPY_CD            = AL.GLBL_CMPY_CD
            AND SEC.SELL_TO_CUST_CD         = AL.DS_ACCT_NUM
            AND AL.RGTN_STS_CD              = #rgtnStsP20#
            AND AL.EFF_FROM_DT          &lt;= #procDt#
            AND (AL.EFF_THRU_DT IS NULL
            OR AL.EFF_THRU_DT           &gt;= #procDt#)
            AND AL.EZCANCELFLAG             = '0'

            AND AL.GLBL_CMPY_CD             = PLW.GLBL_CMPY_CD
            AND AL.LOC_NUM                  = PLW.LOC_NUM
            AND AL.RGTN_STS_CD              = #rgtnStsP20#
            AND AL.EFF_FROM_DT          &lt;= #procDt#
            AND (AL.EFF_THRU_DT IS NULL
            OR AL.EFF_THRU_DT           &gt;= #procDt#)
            AND PLW.CTRY_CD                 = #ctryCdUS#
            AND PLW.EZCANCELFLAG            = '0'

            AND PLW.GLBL_CMPY_CD            = STC.GLBL_CMPY_CD
            AND PLW.PTY_LOC_PK              = STC.PTY_LOC_PK
            AND STC.RGTN_STS_CD             = #rgtnStsP20#
            AND STC.EZCANCELFLAG            = '0'
<!-- 2018/11/22 QC#29220 Mod Start -->
<!--        AND PLW.GLBL_CMPY_CD            = C.GLBL_CMPY_CD -->
<!--        AND PLW.CNTY_PK                 = C.CNTY_PK -->
<!--        AND C.EZCANCELFLAG              = '0' -->
            AND PLW.GLBL_CMPY_CD            = C.GLBL_CMPY_CD (+)
            AND PLW.CNTY_PK                 = C.CNTY_PK (+)
            AND C.EZCANCELFLAG (+)          = '0'
<!-- 2018/11/22 QC#29220 Mod End -->
            AND STC.SHIP_TO_CUST_CD         = #shipToCustCd#
    </statement>
</sqlMap>