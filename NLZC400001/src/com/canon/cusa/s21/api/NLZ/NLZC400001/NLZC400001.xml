<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NLZC400001">

    <statement id="getSo" parameterClass="Map" resultClass="Map">
    <!-- QC#22613 T.Hakodate MOD START -->
        SELECT
       <!-- CASE WHEN #dsSoLineStsCd# &gt;= NVL(SD.DS_SO_LINE_STS_CD,'00') THEN #dsSoLineStsCd#
                 ELSE SD.DS_SO_LINE_STS_CD
            END  DS_SO_LINE_STS_CD -->
            #dsSoLineStsCd#  DS_SO_LINE_STS_CD
    <!-- QC#22613 T.Hakodate MOD   END -->
           ,SD.PICK_CONF_QTY
           ,SD.SHPG_PLN_NUM
           ,SD.SHPG_QTY
           ,SS.SHIP_FLG
           ,SO.SCE_ORD_TP_CD
        FROM
            SHPG_ORD SO
           ,SHPG_ORD_DTL SD
           ,SHPG_STS SS
        WHERE
                SO.GLBL_CMPY_CD        = #glblCmpyCd#
            AND SO.SO_NUM              = #soNum#
            AND SD.GLBL_CMPY_CD        = SO.GLBL_CMPY_CD
            AND SD.SO_NUM              = SO.SO_NUM
            AND SD.SO_SLP_NUM          = #soSlpNum#
            AND SD.GLBL_CMPY_CD        = SS.GLBL_CMPY_CD
            AND SD.SHPG_STS_CD         = SS.SHPG_STS_CD
            AND SD.EZCANCELFLAG        = '0'
            AND SO.EZCANCELFLAG        = '0'
            AND SD.EZCANCELFLAG        = '0'
    </statement>

    <statement id="getPktSts" parameterClass="Map" resultClass="Map">
           SELECT
                  PS.PKT_STS_CD
                 ,PS.SHPG_STS_CD

           FROM   PKT_STS PS

           WHERE  PS.GLBL_CMPY_CD      = #glblCmpyCd#
           AND    PS.DS_SO_LINE_STS_CD = #dsSoLineStsCd#
           AND    PS.EZCANCELFLAG      = '0'
           AND    ROWNUM               = 1
    </statement>

    <statement id="getDetailPktSts" parameterClass="Map" resultClass="Map">
        SELECT  MIN(SD.SHPG_STS_CD) MIN_SHPG_STS_CD
               ,MAX(SD.SHPG_STS_CD) MAX_SHPG_STS_CD
        FROM   SHPG_ORD_DTL SD
        WHERE  SD.GLBL_CMPY_CD  = #glblCmpyCd#
        AND    SD.SO_NUM        = #soNum#
        AND    SD.EZCANCELFLAG  = '0'
    </statement>

    <statement id="getMaxPktSqNum" parameterClass="Map" resultClass="String">
        SELECT
               LPAD(NVL(MAX(PKT.PKT_SQ_NUM),'0') + 1, 3, '0') PKT_SQ_NUM
        FROM   PKT PKT
        WHERE  PKT.GLBL_CMPY_CD  = #glblCmpyCd#
        AND    PKT.SO_NUM        = #soNum#
        <!-- Add Start 2020/03/10 QC# -->
        AND    PKT.SO_SLP_NUM    = #soSlpNum#
        <!-- Add End 2020/03/10 QC# -->
        AND    PKT.EZCANCELFLAG  = '0'
    </statement>

    <statement id="getSoDtlIC" parameterClass="Map" resultClass="Map">
        SELECT
            SD.SO_NUM
           ,SD.SO_SLP_NUM
        FROM
            SHPG_ORD SO
           ,SHPG_ORD_DTL SD
        WHERE
                SO.GLBL_CMPY_CD        = #glblCmpyCd#
            AND SO.SO_NUM              = #soNum#
            AND SO.SCE_ORD_TP_CD       = #sceOrdTpCd#
            AND SD.GLBL_CMPY_CD        = SO.GLBL_CMPY_CD
            AND SD.SO_NUM              = SO.SO_NUM
            AND SD.SHPG_PLN_NUM        IS NULL
            AND SD.EZCANCELFLAG        = '0'
            AND SO.EZCANCELFLAG        = '0'
            AND SD.EZCANCELFLAG        = '0'
    </statement>

</sqlMap>
