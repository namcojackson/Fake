<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NLAB302001">

    <statement id="getCusaVndInvWrk" parameterClass="Map"  resultClass="Map">
        SELECT
            CI.INV_NUM
           ,CI.ORIG_INV_NUM
           ,CI.INV_DT
           ,CI.INV_TP_CD
           ,CI.NET_DUE_DT
           ,CI.CPO_ORD_NUM
           ,CI.ORD_DT
           ,CI.CPO_ORD_TP_CD
           ,CI.OFC_NM
           ,CI.OFC_BR_CD
           ,CI.OFC_FIRST_LINE_ADDR
           ,CI.OFC_SCD_LINE_ADDR
           ,CI.OFC_THIRD_LINE_ADDR
           ,CI.OFC_FRTH_LINE_ADDR
           ,CI.OFC_CTY_ADDR
           ,CI.OFC_ST_CD
           ,CI.OFC_PROV_NM
           ,CI.OFC_CNTY_NM
           ,CI.OFC_POST_CD
           ,CI.OFC_CTRY_CD
           ,CI.OFC_TEL_NUM
           ,CI.OFC_FAX_NUM
           ,CI.OFC_LOC_NM
           ,CI.OFC_ADDL_LOC_NM
           ,CI.REMIT_TO_LOC_NM
           ,CI.REMIT_TO_ADDL_LOC_NM
           ,CI.REM_ID
           ,CI.DUNS_NUM
           ,CI.BILL_TO_CUST_CD
           ,CI.SELL_TO_CUST_CD
           ,CI.SELL_TO_LOC_NM
           ,CI.SELL_TO_ADDL_LOC_NM
           ,CI.SELL_TO_FIRST_LINE_ADDR
           ,CI.SELL_TO_SCD_LINE_ADDR
           ,CI.SELL_TO_THIRD_LINE_ADDR
           ,CI.SELL_TO_FRTH_LINE_ADDR
           ,CI.SELL_TO_CTY_ADDR
           ,CI.SELL_TO_ST_CD
           ,CI.SELL_TO_PROV_NM
           ,CI.SELL_TO_CNTY_NM
           ,CI.SELL_TO_POST_CD
           ,CI.SELL_TO_CTRY_CD
           ,CI.SELL_TO_FIRST_REF_CMNT_TXT
           ,CI.SELL_TO_SCD_REF_CMNT_TXT
           ,CI.RCPNT_FIRST_LINE_ADDR
           ,CI.RCPNT_SCD_LINE_ADDR
           ,CI.RCPNT_THIRD_LINE_ADDR
           ,CI.RCPNT_FRTH_LINE_ADDR
           ,CI.RCPNT_CTY_ADDR
           ,CI.RCPNT_ST_CD
           ,CI.RCPNT_PROV_NM
           ,CI.RCPNT_CNTY_NM
           ,CI.RCPNT_POST_CD
           ,CI.RCPNT_CTRY_CD
           ,CI.RCPNT_LOC_NM
           ,CI.RCPNT_ADDL_LOC_NM
           ,CI.INV_RCPNT_FAX_NUM
           ,CI.PMT_TERM_START_DT
           ,CI.PMT_TERM_CD
           ,CI.PMT_TERM_NM
           ,CI.CASH_DISC_TERM_CD
           ,CI.SLS_ADMIN_PSN_CD
           ,CI.CR_ANLST_PSN_CD
           ,CI.CR_ANLST_PSN_NM
           ,CI.INV_TOT_DEAL_NET_AMT
           ,CI.INV_TOT_DEAL_SLS_AMT
           ,CI.INV_TOT_DEAL_FRT_AMT
           ,CI.INV_TOT_DEAL_TAX_AMT
           ,CI.INV_TOT_DEAL_DISC_AMT
           ,CI.INV_TOT_DEAL_INS_AMT
           ,CI.DEAL_CCY_CD
           ,CI.PAYER_CUST_CD
           ,CI.INV_FIRST_CMNT_TXT
           ,CI.INV_SCD_CMNT_TXT
           ,CI.INV_THIRD_CMNT_TXT
           ,CI.INV_FRTH_CMNT_TXT
           ,CI.ACCT_DT
           ,CI.CUST_ISS_PO_NUM
           ,CI.CR_DR_RSN_CD
           ,CI.PMT_TERM_CASH_DISC_CD
        FROM
            CSA_INV_V          CI
           ,CSA_CPO_V          CC
           ,CSA_CUST_INV_REQ_V CCIR
        WHERE
            CI.GLBL_CMPY_CD                     =     #cusaGlblCmpCd#
        <!--START 2020/01/10 M.Ishii [QC#55137, MOD]-->
        <!--AND CI.ACCT_DT                          =     #salesDate#-->
        AND CI.ACCT_DT &gt;= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#salesDate#, 'YYYYMMDD'), #twoMonthBefore#)) +1, 'YYYYMMDD')
        AND CI.ACCT_DT &lt;= #salesDate#
        <!--END 2020/01/10 M.Ishii [QC#55137, MOD]-->
        <iterate property="sysSrcCd" var="cusaExcludedSystemSourceCdList[]" open="AND CI.SYS_SRC_CD &lt;&gt; ALL (" conjunction= ", " close=")">
            #cusaExcludedSystemSourceCdList[]#
        </iterate>
        AND CI.FNLZ_INV_FLG                     =     #fnlzInvFlg#
        AND (
                EXISTS (
                        SELECT
                            1
                        FROM
                            CSA_SELL_TO_CUST_V       CSETC
                           ,CSA_TRD_PTNR_LOC_X_REF_V CTPLXR
                        WHERE
                            CSETC.GLBL_CMPY_CD    = CI.GLBL_CMPY_CD
                        AND CSETC.BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
                        AND CSETC.EZCANCELFLAG    = '0'
                        AND CSETC.GLBL_CMPY_CD    = CTPLXR.GLBL_CMPY_CD
                        AND CSETC.SELL_TO_CUST_CD = CTPLXR.SELL_TO_SHIP_TO_CUST_CD
                        AND CTPLXR.EDI_CUST_TP_CD = #ediCustTpCdSell#
                        <iterate property="ediTrdPtnrCd" var="cusaEdiTrdPtnrCdList[]" open="AND CTPLXR.EDI_TRD_PTNR_CD IN (" conjunction= ", " close=")">
                            #cusaEdiTrdPtnrCdList[]#
                        </iterate>
                        AND (   CTPLXR.CRS_REF_ACTV_FLG = #crsRefActvFlg#
                             OR CTPLXR.CRS_REF_ACTV_FLG IS NULL
                            )
                        AND (
                                CTPLXR.EFF_FROM_DT &lt;= #salesDate#
                             OR CTPLXR.EFF_FROM_DT IS NULL
                            )
                        AND NVL(CTPLXR.EFF_THRU_DT, #effThruDtDefault#) &gt;= #salesDate#
                        AND CTPLXR.EZCANCELFLAG   = '0'
                       )
             OR EXISTS (
                        SELECT
                            1
                        FROM
                            CSA_SHIP_TO_CUST_V       CSHTC
                           ,CSA_TRD_PTNR_LOC_X_REF_V CTPLXR
                        WHERE
                            CSHTC.GLBL_CMPY_CD    = CI.GLBL_CMPY_CD
                        AND CSHTC.BILL_TO_CUST_CD = CI.BILL_TO_CUST_CD
                        AND CSHTC.EZCANCELFLAG    = '0'
                        AND CSHTC.GLBL_CMPY_CD    = CTPLXR.GLBL_CMPY_CD
                        AND CSHTC.SHIP_TO_CUST_CD = CTPLXR.SELL_TO_SHIP_TO_CUST_CD
                        AND CTPLXR.EDI_CUST_TP_CD = #ediCustTpCdShip#
                        <iterate property="ediTrdPtnrCd" var="cusaEdiTrdPtnrCdList[]" open="AND CTPLXR.EDI_TRD_PTNR_CD IN (" conjunction= ", " close=")">
                            #cusaEdiTrdPtnrCdList[]#
                        </iterate>
                        AND (   CTPLXR.CRS_REF_ACTV_FLG = #crsRefActvFlg#
                             OR CTPLXR.CRS_REF_ACTV_FLG IS NULL
                            )
                        AND (   CTPLXR.EFF_FROM_DT &lt;= #salesDate#
                             OR CTPLXR.EFF_FROM_DT IS NULL
                            )
                        AND NVL(CTPLXR.EFF_THRU_DT, #effThruDtDefault#) &gt;= #salesDate#
                        AND CTPLXR.EZCANCELFLAG   = '0'
                       )
            )
        --CSA_CPO_V JOIN
        AND CI.GLBL_CMPY_CD                     =     CC.GLBL_CMPY_CD(+)
        AND CI.CPO_ORD_NUM                      =     CC.CPO_ORD_NUM(+)
        --CSA_CUST_INV_REQ_V JOIN
        AND CI.GLBL_CMPY_CD                     =     CCIR.GLBL_CMPY_CD
        AND CCIR.SEND_INV_VIA_GRP_FLG           =     #sendInvViaGrpFlg#
        AND CCIR.CUST_CD = (CASE
                                WHEN CI.FL_PLN_FLG             =        #flPlnFlgN# THEN CI.SELL_TO_CUST_CD
                                WHEN CI.FL_PLN_FLG             =        #flPlnFlgY# THEN CI.PAYER_CUST_CD
                          END)
        AND CCIR.BILL_TP_CD = (CASE
                                   WHEN CC.CPO_SRC_TP_CD       =        #cpoSrcTpCdCreditRE# THEN #cpoSrcTpCdCreditR#
                                   WHEN CC.CPO_SRC_TP_CD       =        #cpoSrcTpCdPairOE# THEN
                                    CASE
                                       WHEN CC.RE_BILL_PAIR_CPO_ORD_NUM IS NULL THEN
                                         CASE
                                            WHEN CI.INV_TP_CD  =        #invTpCdCreditMemo# THEN #invTpCdCreditInvoice#
                                            ELSE #invTpCdReqularInvoice#
                                          END
                                       WHEN CC.RE_BILL_PAIR_CPO_ORD_NUM IS NOT NULL THEN #cpoSrcTpCdCreditR#
                                     END
                                   ELSE
                                     CASE
                                         WHEN CI.INV_TP_CD     =         #invTpCdCreditMemo# THEN #invTpCdCreditInvoice#
                                         ELSE #invTpCdReqularInvoice#
                                      END
                               END)
        AND CI.EZCANCELFLAG                     =     '0'
        AND CC.EZCANCELFLAG(+)                  =     '0'
        AND CCIR.EZCANCELFLAG                   =     '0'
        AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            VND_INV_WRK VIW
                        WHERE
                            VIW.GLBL_CMPY_CD = #glblCmpCd#
                        AND VIW.VND_INV_NUM  = CI.INV_NUM
                        AND VIW.ACCT_DT      = CI.ACCT_DT
                        AND VIW.EZCANCELFLAG = '0'
                       )
    </statement>

    <statement id="getCusaVndInvBolWrk" parameterClass="Map"  resultClass="Map">
        SELECT
            CIB.INV_NUM
           ,CIB.INV_BOL_LINE_NUM
           ,CIB.SO_NUM
           ,CIB.BOL_NUM
           ,CIB.CARR_CD
           ,CIB.CARR_NM
           ,CIB.PRO_NUM
           ,CIB.SHIP_FROM_INVTY_LOC_CD
           ,CIB.SHIP_TO_CUST_CD
           ,CIB.DROP_SHIP_FLG
           ,CIB.SHIP_TO_LOC_NM
           ,CIB.SHIP_TO_ADDL_LOC_NM
           ,CIB.SHIP_TO_FIRST_LINE_ADDR
           ,CIB.SHIP_TO_SCD_LINE_ADDR
           ,CIB.SHIP_TO_THIRD_LINE_ADDR
           ,CIB.SHIP_TO_FRTH_LINE_ADDR
           ,CIB.SHIP_TO_ST_CD
           ,CIB.SHIP_TO_PROV_NM
           ,CIB.SHIP_TO_CNTY_NM
           ,CIB.SHIP_TO_FIRST_REF_CMNT_TXT
           ,CIB.SHIP_TO_SCD_REF_CMNT_TXT
           ,CIB.SHIP_TO_POST_CD
           ,CIB.SHIP_TO_CTY_ADDR
           ,CIB.SHIP_TO_CTRY_CD
           ,CIB.SHIP_DEAL_SLS_AMT
           ,CIB.SHIP_DEAL_NET_AMT
           ,CIB.SHIP_DEAL_FRT_AMT
           ,CIB.SHIP_DEAL_DISC_AMT
           ,CIB.SHIP_DEAL_HDLG_CHRG_AMT
           ,CIB.SHIP_DT
           ,CIB.ARV_DT
           ,CIB.TOT_BOL_DEAL_TAX_AMT
           ,CIB.SHPG_SVC_LVL_CD
           ,CIB.SHPG_SVC_LVL_NM
           ,CIB.FRT_CHRG_TO_CD
           ,CIB.FRT_CHRG_TO_NM
           ,CIB.FRT_CHRG_METH_CD
           ,CIB.FRT_CHRG_METH_NM
           ,CIB.FRT_TAX_PCT
           ,CIB.FRT_DEAL_TAX_AMT
           ,CI.CUST_ISS_PO_NUM
        FROM
            CSA_INV_V          CI
           ,CSA_INV_BOL_V      CIB
        WHERE
            CI.GLBL_CMPY_CD  = #cusaGlblCmpCd#
        AND CI.INV_NUM       = #parentInvNum#
        AND CI.EZCANCELFLAG  = '0'
        AND CI.GLBL_CMPY_CD  = CIB.GLBL_CMPY_CD
        AND CI.INV_NUM       = CIB.INV_NUM
        AND CIB.EZCANCELFLAG = '0'
        AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            VND_INV_WRK     VIW
                           ,VND_INV_BOL_WRK VIBW
                        WHERE
                            VIW.GLBL_CMPY_CD  = #glblCmpCd#
                        AND VIW.VND_INV_NUM   = CI.INV_NUM
                        AND VIW.ACCT_DT       = CI.ACCT_DT
                        AND VIW.GLBL_CMPY_CD  = VIBW.GLBL_CMPY_CD
                        AND VIW.VND_INV_NUM   = VIBW.VND_INV_NUM
                        AND VIW.EZCANCELFLAG  = '0'
                        AND VIBW.EZCANCELFLAG = '0'
                       )
    </statement>

    <statement id="getCusaVndInvLineWrk" parameterClass="Map"  resultClass="Map">
        SELECT
            CI.CUST_ISS_PO_NUM
           ,CIL.INV_NUM
           ,CIL.INV_BOL_LINE_NUM
           ,CIL.INV_LINE_SUB_NUM
           ,CIL.INV_LINE_SUB_TRX_NUM
           ,CIL.CPO_ORD_NUM
           ,CIL.CPO_DTL_LINE_NUM
           ,CIL.CPO_DTL_LINE_SUB_NUM
           ,CIL.STK_STS_CD
           ,CIL.MDSE_CD
           ,CIL.MDSE_NM
           ,CIL.ORD_QTY
           ,CIL.SHIP_QTY
           ,CIL.BO_QTY
           ,CIL.MAN_PRC_FLG
           ,CIL.DEAL_NET_UNIT_PRC_AMT
           ,CIL.INV_LINE_DEAL_TAX_AMT
           ,CIL.INV_LINE_DEAL_NET_AMT
           ,CIL.DEAL_DISC_UNIT_PRC_AMT
           ,CIL.TAX_PCT
           ,CIL.MERC_STMT_ON_INV_TXT
           ,CIL.ORIG_INV_NUM
           ,CIL.SET_MDSE_CD
           ,CIL.DEAL_GRS_UNIT_PRC_AMT
           ,CIL.DEAL_GRS_TOT_PRC_AMT
           ,CIL.ZEROTH_PROD_CTRL_CD
           ,CIL.ZEROTH_PROD_CTRL_NM
           ,CIL.FIRST_PROD_CTRL_CD
           ,CIL.FIRST_PROD_CTRL_NM
           ,CIL.SCD_PROD_CTRL_CD
           ,CIL.SCD_PROD_CTRL_NM
           ,CIL.THIRD_PROD_CTRL_CD
           ,CIL.THIRD_PROD_CTRL_NM
           ,CIL.FRTH_PROD_CTRL_CD
           ,CIL.FRTH_PROD_CTRL_NM
           ,CIL.FIFTH_PROD_CTRL_CD
           ,CIL.FIFTH_PROD_CTRL_NM
           ,CIL.SIXTH_PROD_CTRL_CD
           ,CIL.SIXTH_PROD_CTRL_NM
           ,CIL.SVNTH_PROD_CTRL_CD
           ,CIL.SVNTH_PROD_CTRL_NM
           ,CIL.INV_LINE_NUM
           ,CCD.EDI_NUM
           ,CCD.CUST_UOM_CD
           ,CCD.CUST_MDSE_CD
           ,CMI.INVTY_CTRL_FLG
           ,CSP.PO_REQ_FLG
           ,CSP.SO_NUM
        FROM
            CSA_INV_V       CI
           ,CSA_INV_LINE_V  CIL
           ,CSA_MDSE_ITEM_V CMI
           ,CSA_SHPG_PLN_V  CSP
           ,CSA_CPO_DTL_V   CCD
        WHERE
            CI.GLBL_CMPY_CD          = #cusaGlblCmpCd#
        AND CI.INV_NUM               = #parentInvNum#
        AND CI.EZCANCELFLAG          = '0'
        AND CI.GLBL_CMPY_CD          = CIL.GLBL_CMPY_CD
        AND CI.INV_NUM               = CIL.INV_NUM
        AND CIL.EZCANCELFLAG         = '0'
        AND CIL.GLBL_CMPY_CD         = CMI.GLBL_CMPY_CD(+)
        AND CIL.MDSE_CD              = CMI.MDSE_CD(+)
        AND CMI.EZCANCELFLAG(+)      = '0'
        AND CIL.GLBL_CMPY_CD         = CSP.GLBL_CMPY_CD(+)
        AND CIL.SHPG_PLN_NUM         = CSP.SHPG_PLN_NUM(+)
        AND CSP.EZCANCELFLAG(+)      = '0'
        AND CIL.GLBL_CMPY_CD         = CCD.GLBL_CMPY_CD(+)
        AND CIL.CPO_ORD_NUM          = CCD.CPO_ORD_NUM(+)
        AND CIL.CPO_DTL_LINE_NUM     = CCD.CPO_DTL_LINE_NUM(+)
        AND CIL.CPO_DTL_LINE_SUB_NUM = CCD.CPO_DTL_LINE_SUB_NUM(+)
        AND CCD.EZCANCELFLAG(+)      = '0'
        AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            VND_INV_WRK VIW
                           ,VND_INV_LINE_WRK VILW
                        WHERE
                            VIW.GLBL_CMPY_CD  = #glblCmpCd#
                        AND VIW.VND_INV_NUM   = CI.INV_NUM
                        AND VIW.ACCT_DT       = CI.ACCT_DT
                        AND VIW.GLBL_CMPY_CD  = VILW.GLBL_CMPY_CD
                        AND VIW.VND_INV_NUM   = VILW.VND_INV_NUM
                        AND VIW.EZCANCELFLAG  = '0'
                        AND VILW.EZCANCELFLAG = '0'
                       )
    </statement>

    <statement id="getCusaVndInvDiscTeamWrk" parameterClass="Map"  resultClass="Map">
        SELECT
            CICDT.INV_NUM
           ,CICDT.INV_CASH_DISC_TERM_DTL_NUM
           ,CICDT.INV_CASH_DISC_DUE_DT
           ,CICDT.INV_CASH_DISC_RATIO_PCT
           ,CICDT.INV_CASH_DISC_AMT
        FROM
            CSA_INV_V                CI
           ,CSA_INV_CASH_DISC_TERM_V CICDT
        WHERE
            CI.GLBL_CMPY_CD    = #cusaGlblCmpCd#
        AND CI.INV_NUM         = #parentInvNum#
        AND CI.EZCANCELFLAG    = '0'
        AND CICDT.GLBL_CMPY_CD = CI.GLBL_CMPY_CD
        AND CICDT.INV_NUM      = CI.INV_NUM
        AND CICDT.EZCANCELFLAG = '0'
        AND NOT EXISTS (
                        SELECT
                            1
                        FROM
                            VND_INV_WRK           VIW
                           ,VND_INV_DISC_TERM_WRK VIDTW
                        WHERE
                            VIW.GLBL_CMPY_CD   = #glblCmpCd#
                        AND VIW.VND_INV_NUM    = CI.INV_NUM
                        AND VIW.ACCT_DT        = CI.ACCT_DT
                        AND VIW.GLBL_CMPY_CD   = VIDTW.GLBL_CMPY_CD
                        AND VIW.VND_INV_NUM    = VIDTW.VND_INV_NUM
                        AND VIW.EZCANCELFLAG   = '0'
                        AND VIDTW.EZCANCELFLAG = '0'
                       )
    </statement>

    <statement id="getCusaVndInvLicAccsWrk" parameterClass="Map"  resultClass="Map">
        SELECT
            CIL.INV_NUM
           ,CIL.INV_BOL_LINE_NUM
           ,CIL.INV_LINE_NUM
           ,CIL.INV_LINE_SUB_NUM
           ,CIL.INV_LINE_SUB_TRX_NUM
           ,CLR.MDSE_CD
           ,CLR.LIC_ACCS_NUM
           ,CLR.CPO_ORD_NUM
           ,CLR.CPO_DTL_LINE_NUM
           ,CLR.CPO_DTL_LINE_SUB_NUM
           ,CLR.ILMS_LIC_ACCS_NUM
        FROM
            CSA_INV_V      CI
           ,CSA_INV_LINE_V CIL
           ,CSA_LAK_RPST_V CLR
        WHERE
            CI.GLBL_CMPY_CD          = #cusaGlblCmpCd#
        AND CI.INV_NUM               = #parentInvNum#
        AND CI.EZCANCELFLAG          = '0'
        AND CI.GLBL_CMPY_CD          = CIL.GLBL_CMPY_CD
        AND CI.INV_NUM               = CIL.INV_NUM
        AND CIL.EZCANCELFLAG         = '0'
        AND CIL.GLBL_CMPY_CD         = CLR.GLBL_CMPY_CD
        AND CIL.CPO_ORD_NUM          = CLR.CPO_ORD_NUM
        AND CIL.CPO_DTL_LINE_NUM     = CLR.CPO_DTL_LINE_NUM
        AND CIL.CPO_DTL_LINE_SUB_NUM = CLR.CPO_DTL_LINE_SUB_NUM
        AND CIL.MDSE_CD              = CLR.MDSE_CD
        AND CLR.LAK_STS_CD           = #lakStsCd#
        AND CLR.EZCANCELFLAG         = '0'
        AND NOT EXISTS (
                          SELECT
                                1
                          FROM
                                VND_INV_WRK VIW
                                ,VND_INV_LIC_ACCS_WRK VILAW
                          WHERE
                                VIW.GLBL_CMPY_CD       = #glblCmpCd#
                                AND VIW.VND_INV_NUM    = CI.INV_NUM
                                AND VIW.ACCT_DT        = CI.ACCT_DT
                                AND VIW.GLBL_CMPY_CD   = VILAW.GLBL_CMPY_CD
                                AND VIW.VND_INV_NUM    = VILAW.VND_INV_NUM
                                AND VIW.EZCANCELFLAG   = '0'
                                AND VILAW.EZCANCELFLAG = '0'
                        )
    </statement>

    <statement id="getCusaPartsInvoice" parameterClass="Map"  resultClass="Map">
        SELECT
            CPI.P_NUM_INVOICE             AS        P_NUM_INVOICE_CPI
           ,CPI.P_DATE_INVO
           ,CPI.P_AMT_INVO_TOT            AS        P_AMT_INVO_TOT_CPI
           ,CPI.P_AMT_SHIP                AS        P_AMT_SHIP_CPI
           ,CPI.P_AMT_INVO_FRT            AS        P_AMT_INVO_FRT_CPI
           ,CPI.P_AMT_SO_TAX              AS        P_AMT_SO_TAX_CPI
           ,CPI.P_AMT_DISCOUNT            AS        P_AMT_DISCOUNT_CPI
           ,CPSH.P_CODE_ORDR_TYPE_PART
           ,CPSH.P_CODE_CUST_CHRG_TO
           ,CPSH.P_CODE_CUST_SOLD_TO
           ,CPSH.P_MSG_SO_1
           ,CPSH.P_MSG_SO_2
           ,CPSH.P_NUM_INVOICE             AS        P_NUM_INVOICE_CPSH
           ,CPSH.P_NUM_SO
           ,CPSH.P_CODE_WH_SHIP
           ,CPSH.P_CODE_CUST_SHIP_TO
           ,CPSH.P_AMT_SHIP                AS        P_AMT_SHIP_CPSH
           ,CPSH.P_AMT_INVO_TOT            AS        P_AMT_INVO_TOT_CPSH
           ,CPSH.P_AMT_INVO_FRT            AS        P_AMT_INVO_FRT_CPSH
           ,CPSH.P_AMT_DISCOUNT            AS        P_AMT_DISCOUNT_CPSH
           ,CPSH.P_AMT_HANDLG_CHRG
           ,CPSH.P_DATE_SHIP_PRSS
           ,CPSH.P_AMT_SO_TAX              AS        P_AMT_SO_TAX_CPSH
           ,CPPT.P_NET_DAYS
           ,CPPT.P_CODE_TERM_S80
           ,CRSD.P_NUM_ORDR
           ,CRSD.P_NUM_CUST_PO
<!-- START 2019/08/28 T.Ogura [QC#52931,MOD] -->
<!--       ,CRSD.P_PARTS_NUM               AS        P_PARTS_NUM_SO -->
           ,TRIM(CRSD.P_PARTS_NUM)         AS        P_PARTS_NUM_SO
<!-- END   2019/08/28 T.Ogura [QC#52931,MOD] -->
           ,CRSD.P_QTY_SHIP_SCHED
           ,CRSD.P_QTY_SHIP
           ,CRSD.P_PRC_SALE
           ,CRSD.P_PRC_DISCOUNT
           ,CRSD.P_DESC_PART
           ,CPCC.P_DATE_ORDR_RCV
           ,CPCC.P_NAME_CUST_SHIP_TO_1
           ,CPCC.P_NAME_CUST_SHIP_TO_2
           ,CPCC.P_SHIP_TO_EXT_ADDR_01
           ,CPCC.P_SHIP_TO_EXT_ADDR_02
           ,CPCC.P_SHIP_TO_EXT_ADDR_03
           ,CPCC.P_SHIP_TO_EXT_ADDR_04
           ,CPCC.P_CODE_SHIP_TO_STA
           ,CPCC.P_ADDR_SHIP_TO_ZIP
           ,CPCC.P_ADDR_SHIP_TO_CITY
<!-- START 2019/08/28 T.Ogura [QC#52931,MOD] -->
<!--       ,CASE WHEN CPCD.P_NUM_ORDR IS NULL AND CPCD.P_PARTS_NUM IS NULL THEN CRSD.P_PARTS_NUM -->
<!--             ELSE CPCD.P_PARTS_NUM_ORIG -->
           ,CASE WHEN CPCD.P_NUM_ORDR IS NULL AND CPCD.P_PARTS_NUM IS NULL THEN TRIM(CRSD.P_PARTS_NUM)
                 ELSE TRIM(CPCD.P_PARTS_NUM_ORIG) 
<!-- END   2019/08/28 T.Ogura [QC#52931,MOD] -->
            END                                                   AS P_PARTS_NUM_ORIG
<!-- START 2019/08/28 T.Ogura [QC#52931,MOD] -->
<!--       ,CPF.P_PARTS_NUM                                       AS P_PARTS_NUM_FLIP -->
           ,TRIM(CPF.P_PARTS_NUM)                                 AS P_PARTS_NUM_FLIP
<!-- END   2019/08/28 T.Ogura [QC#52931,MOD] -->
           ,NVL(CPCCD_A.P_NUM_LINE, CPCCD_B.P_NUM_LINE)           AS P_NUM_LINE
<!-- START 2019/08/28 T.Ogura [QC#52931,MOD] -->
<!--       ,NVL(CPCCD_A.P_CUST_PART_NUM, CPCCD_B.P_CUST_PART_NUM) AS P_CUST_PART_NUM -->
           ,TRIM(NVL(CPCCD_A.P_CUST_PART_NUM, CPCCD_B.P_CUST_PART_NUM)) AS P_CUST_PART_NUM
<!-- END   2019/08/28 T.Ogura [QC#52931,MOD] -->
        FROM
            CSA_PRT_INV_V          CPI
           ,CSA_PRT_EDI_TRD_PTNR_V CPETP
           ,CSA_PRT_SO_HDR_V       CPSH
           ,CSA_PRT_PMT_TERM_V     CPPT
           ,CSA_PRT_SO_DTL_V       CRSD
           ,CSA_PRT_CUST_CPO_V     CPCC
           ,CSA_PRT_CPO_DTL_V      CPCD
           ,CSA_PRT_FLIP_V         CPF
           ,CSA_PRT_CUST_CPO_DTL_V CPCCD_A
           ,CSA_PRT_CUST_CPO_DTL_V CPCCD_B
        WHERE
        <!--START 2020/01/10 M.Ishii [QC#55137, MOD]-->
        <!--CPI.P_DATE_INVO                            =            #salesDate#-->
            CPI.P_DATE_INVO &gt;= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#salesDate#, 'YYYYMMDD'), #twoMonthBefore#)) +1, 'YYYYMMDD')
        AND CPI.P_DATE_INVO &lt;= #salesDate#
        <!--END 2020/01/10 M.Ishii [QC#55137, MOD]-->
        --CSA_PRT_EDI_TRD_PTNR_V JOIN
        AND CPI.P_CODE_CUST_SOLD_TO                    =            CPETP.P_CODE_CUST_SOLD_TO
        <iterate property="cusaPrtEdiTrdPtnrCd" var="cusaPrtEdiTrdPtnrCdList[]" open="AND CPETP.P_CODE_TP IN (" conjunction= ", " close=")">
            #cusaPrtEdiTrdPtnrCdList[]#
        </iterate>
        --CSA_PRT_SO_HDR_V JOIN
        AND CPI.P_NUM_INVOICE                          =            CPSH.P_NUM_INVOICE
        --CSA_PRT_PMT_TERM_V JOIN
        AND CPSH.P_CODE_TERM                           =            CPPT.P_CODE_TERM(+)
        --CSA_PRT_SO_DTL_V JOIN
        AND CPSH.P_NUM_SO                              =            CRSD.P_NUM_SO
        AND CRSD.P_QTY_SHIP                           &lt;&gt;      #shipQty#
        --CSA_PRT_CUST_CPO_V JOIN
        AND CRSD.P_NUM_CUST_PO                         =            CPCC.P_NUM_CUST_PO(+)
        AND CRSD.P_CODE_CUST_SHIP_TO                   =            CPCC.P_CODE_CUST_SHIP_TO(+)
        --CSA_PRT_CPO_DTL_V_A JOIN
        AND CRSD.P_NUM_ORDR                            =            CPCD.P_NUM_ORDR(+)
        AND CRSD.P_PARTS_NUM                           =            CPCD.P_PARTS_NUM(+)
        AND CPCD.P_NUM_CUST_PO                         =            CPCCD_A.P_NUM_CUST_PO(+)
        AND CPCD.P_PARTS_NUM_ORIG                      =            CPCCD_A.P_PARTS_NUM(+)
        AND CPCD.P_CODE_CUST_SHIP_TO                   =            CPCCD_A.P_CODE_CUST_SHIP_TO(+)
        --CSA_PRT_CPO_DTL_V_B JOIN
        AND CRSD.P_PARTS_NUM                           =            CPCCD_B.P_PARTS_NUM(+)
        AND CRSD.P_NUM_CUST_PO                         =            CPCCD_B.P_NUM_CUST_PO(+)
        AND CRSD.P_CODE_CUST_SHIP_TO                   =            CPCCD_B.P_CODE_CUST_SHIP_TO(+)
        --CSA_PRT_FLIP_V JOIN
        AND NOT EXISTS (
                    SELECT
                            1
                    FROM
                            VND_INV_WRK VIW
                    WHERE
                            VIW.GLBL_CMPY_CD       =            #glblCmpCd#
                            AND VIW.VND_INV_NUM    =            CPI.P_NUM_INVOICE
                            AND VIW.ACCT_DT        =            CPI.P_DATE_INVO
                    )
        AND CRSD.P_PARTS_NUM                           =            CPF.P_PARTS_NUM_FLIP(+)
        AND CPI.EZCANCELFLAG                           =            '0'
        AND CPETP.EZCANCELFLAG                         =            '0'
        AND CPSH.EZCANCELFLAG                          =            '0'
        AND CPPT.EZCANCELFLAG(+)                       =            '0'
        AND CRSD.EZCANCELFLAG                          =            '0'
        AND CPCC.EZCANCELFLAG(+)                       =            '0'
        AND CPCD.EZCANCELFLAG(+)                       =            '0'
        AND CPF.EZCANCELFLAG(+)                        =            '0'
        AND CPCCD_A.EZCANCELFLAG(+)                    =            '0'
        AND CPCCD_B.EZCANCELFLAG(+)                    =            '0'
        ORDER BY
            CPI.P_NUM_INVOICE ASC
    </statement>

    <statement id="selectSetPoLineNum" parameterClass="Map"  resultClass="Map">
        SELECT
            PD.PO_ORD_DTL_LINE_NUM
        FROM
            (SELECT
                 PD.GLBL_CMPY_CD
                ,PD.PO_ORD_NUM
                ,PD.PO_ORD_DTL_LINE_NUM
            FROM
                PO_DTL PD
            WHERE
                PD.GLBL_CMPY_CD            = #glblCmpyCd#
                AND PD.PO_ORD_NUM          = #custIssPoNum#
                AND PD.PO_ORD_DTL_LINE_NUM = #ediNum#
                AND PD.EZCANCELFLAG        = '0'
            ) PDSUB
            ,PO_DTL PD
        WHERE
            PDSUB.GLBL_CMPY_CD            = PD.GLBL_CMPY_CD(+)
            AND PDSUB.PO_ORD_NUM          = PD.PO_ORD_NUM(+)
            AND PDSUB.PO_ORD_DTL_LINE_NUM = PD.SET_PO_ORD_DTL_LINE_NUM(+)
            AND PD.ASL_MDSE_CD(+)      = #mdseCd#
            AND PD.EZCANCELFLAG(+)     = '0'
    </statement>

</sqlMap>
