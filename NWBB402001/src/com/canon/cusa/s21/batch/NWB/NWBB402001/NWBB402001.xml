<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWBB402001">
    <statement id="getRtrnDtl" parameterClass="Map" resultClass="Map">
            SELECT
                C.CPO_ORD_NUM
                ,RD.DS_CPO_RTRN_LINE_NUM
                ,RD.DS_CPO_RTRN_LINE_SUB_NUM
                ,C.CPO_SRC_TP_CD
                ,HI.HLD_RSN_CD
                ,HI.HLD_RSN_NM 
                ,HI.HLD_LVL_CD
                ,HI.EX_REQ_FLG
                <!-- QC#17941 -->
                , RD.EZUPTIME                       EZUPTIME_RD
                , RD.EZUPTIMEZONE                   EZUPTIMEZONE_RD
                , C.EZUPTIME                        EZUPTIME_C
                , C.EZUPTIMEZONE                    EZUPTIMEZONE_C
            FROM
                 CPO C
                ,DS_CPO_RTRN_DTL RD
                ,(SELECT
                            HR.HLD_RSN_CD              AS HLD_RSN_CD
                        ,   HR.HLD_RSN_NM              AS HLD_RSN_NM
                        ,   HR.HLD_LVL_CD              AS HLD_LVL_CD
                        ,   HOS.APPLY_ORD_SRC_TP_CD    AS APPLY_ORD_SRC_TP_CD
                        ,   HOT.APPLY_ORD_TP_CD        AS APPLY_ORD_TP_CD
                        ,   HR.EX_REQ_FLG              AS EX_REQ_FLG
                        ,   DHOT.APPLY_DS_ORD_TP_CD    AS APPLY_DS_ORD_TP_CD
                        ,   HR.GLBL_CMPY_CD
                        ,   HR.EZCANCELFLAG
                    FROM
                            HLD_RSN             HR
                        ,   HLD_CTRL_ORD_SRC    HOS
                        ,   HLD_CTRL_ORD_TP     HOT
                        ,   DS_HLD_CTRL_ORD_TP  DHOT
                    WHERE
                            HR.GLBL_CMPY_CD     = #glblCmpyCd#
                        AND HR.GLBL_CMPY_CD     = HOS.GLBL_CMPY_CD
                        AND HOS.GLBL_CMPY_CD    = HOT.GLBL_CMPY_CD
                        AND HR.HLD_RSN_CD       = HOS.HLD_RSN_CD
                        AND HOS.HLD_RSN_CD      = HOT.HLD_RSN_CD
                        AND HR.DTM_BAT_FLG      = 'Y'
                        AND HR.EZCANCELFLAG     = '0'
                        AND HOS.EZCANCELFLAG    = '0'
                        AND HOT.EZCANCELFLAG    = '0'
                        AND HR.GLBL_CMPY_CD     = DHOT.GLBL_CMPY_CD
                        AND HR.HLD_RSN_CD       = DHOT.HLD_RSN_CD
                        AND DHOT.EZCANCELFLAG   = '0'
                ) HI
            WHERE
                    C.GLBL_CMPY_CD = #glblCmpyCd#
                AND C.EZCANCELFLAG = '0'
                AND C.ORD_BOOK_FLG = 'Y'

                AND C.GLBL_CMPY_CD = RD.GLBL_CMPY_CD
                AND C.EZCANCELFLAG = RD.EZCANCELFLAG
                AND C.CPO_ORD_NUM  = RD.CPO_ORD_NUM
                AND RD.CPO_DTL_CANC_FLG = 'N'
                AND RD.RTRN_LINE_STS_CD = #rtrnLineStsCd#

                AND C.GLBL_CMPY_CD  = HI.GLBL_CMPY_CD
                AND C.EZCANCELFLAG  = HI.EZCANCELFLAG
                AND C.CPO_ORD_TP_CD = HI.APPLY_ORD_TP_CD
                AND C.CPO_SRC_TP_CD = HI.APPLY_ORD_SRC_TP_CD
                AND C.DS_ORD_TP_CD = HI.APPLY_DS_ORD_TP_CD

                ORDER BY
                        C.CPO_ORD_NUM
                        ,RD.DS_CPO_RTRN_LINE_NUM
                        ,RD.DS_CPO_RTRN_LINE_SUB_NUM
<!--                FOR UPDATE QC#17941 -->
    </statement>
</sqlMap>
