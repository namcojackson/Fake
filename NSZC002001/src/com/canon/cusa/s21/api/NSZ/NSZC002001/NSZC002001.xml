<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSZC002001">

    <statement id="getSoNum" parameterClass="Map" resultClass="String">
      SELECT
        DISTINCT SO.SO_NUM
      FROM
          SHPG_ORD SO
        , SHPG_ORD_DTL SOD
        , MDSE M
        , SHIP_TO_CUST S 
      WHERE
            SO.GLBL_CMPY_CD    = #glblCmpyCd#
        AND SO.SO_NUM          = #soNum#
        AND SO.GLBL_CMPY_CD    = S.GLBL_CMPY_CD
        AND SO.SHIP_TO_CUST_CD = S.SHIP_TO_CUST_CD
        AND SO.GLBL_CMPY_CD    = SOD.GLBL_CMPY_CD
        AND SO.SO_NUM          = SOD.SO_NUM 
        AND SOD.GLBL_CMPY_CD   = M.GLBL_CMPY_CD
        AND SOD.MDSE_CD        = M.MDSE_CD
        AND M.MDSE_CD          = #mdseCd#
        AND M.RGTN_STS_CD      = #rgtnStsCd#
        AND SO.EZCANCELFLAG    = '0'
        AND S.EZCANCELFLAG     = '0'
        AND SOD.EZCANCELFLAG   = '0'
        AND M.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getSvcMemoPk" parameterClass="Map" resultClass="String">
      SELECT
        SM.SVC_MEMO_PK
      FROM
        SVC_MEMO SM 
      WHERE
            SM.GLBL_CMPY_CD     = #glblCmpyCd#
        AND SM.SVC_TASK_NUM     = #svcTaskNum#
        AND SM.SVC_MEMO_CATG_CD = #svcMemoCatgCd#
        AND SM.SVC_MEMO_TP_CD   = #svcMemoTpCd#
        AND SM.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getSvcMemoList" parameterClass="Map" resultClass="String">
      SELECT
        SM.SVC_MEMO_PK
      FROM
        SVC_MEMO SM 
      WHERE
            SM.GLBL_CMPY_CD = #glblCmpyCd#
        AND SM.SVC_TASK_NUM = #svcTaskNum#
        AND SM.EZCANCELFLAG = '0'
    </statement>

    <statement id="getSvcMemoData" parameterClass="Map" resultClass="Map">
      SELECT
          GLBL_CMPY_CD
        , SVC_MEMO_PK
        , SVC_MEMO_CATG_CD
        , SVC_MEMO_TP_CD
        , SVC_CMNT_TXT
        , SVC_TASK_NUM
        , FSR_NUM
        , SVC_MACH_MSTR_PK 
      FROM
        SVC_MEMO SM 
      WHERE
            SM.SVC_MEMO_TP_CD   = #svcMemoTpCd#
        AND SM.SVC_TASK_NUM     = #svcTask# 
        AND SM.SVC_MEMO_CATG_CD = #svcMemoCatgCd# 
        AND SM.GLBL_CMPY_CD     = #glblCmpyCd# 
        AND SM.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getFirstProdCtrlCd" parameterClass="Map" resultClass="String">
      SELECT
        FPCV.FIRST_PROD_CTRL_CD
      FROM
        FIRST_PROD_CTRL_V FPCV 
      WHERE
            FPCV.GLBL_CMPY_CD       = #glblCmpyCd#
        AND FPCV.EZCANCELFLAG       = '0'
        AND FPCV.FIRST_PROD_CTRL_CD = #firstProdCtrlCd#
    </statement>

    <statement id="getSvcCallPrtyCd" parameterClass="Map" resultClass="Map">
      SELECT
          ST.ORIG_SVC_CALL_PRTY_CD 
        , ST.SVC_CALL_PRTY_CD 
      FROM
        SVC_TASK ST 
      WHERE
            ST.EZCANCELFLAG = '0'
        AND ST.SVC_TASK_NUM = #svcTaskNum#
        AND ST.GLBL_CMPY_CD = #glblCmpyCd#
    </statement>

    <statement id="getSvcMachMstrPk" parameterClass="Map" resultClass="String">
      SELECT
        SMM.SVC_MACH_MSTR_PK
      FROM
          SVC_MACH_MSTR SMM
        , MDSE          M
        , SHIP_TO_CUST  S
      WHERE
            SMM.GLBL_CMPY_CD       = #glblCmpyCd#
        AND SMM.GLBL_CMPY_CD       = M.GLBL_CMPY_CD
        AND SMM.GLBL_CMPY_CD       = S.GLBL_CMPY_CD
        AND SMM.SVC_MACH_MSTR_PK   = #svcMachMstrPk#
        AND SMM.CUST_MACH_CTRL_NUM = #custMachCtrlNum#
        AND SMM.SER_NUM            = #serNum#
        AND SMM.MDSE_CD            = M.MDSE_CD
<!-- NA#ASCC CLICK MOD Start -->
<!--
        AND SMM.SHIP_TO_CUST_CD    = S.SHIP_TO_CUST_CD
-->
        AND SMM.CUR_LOC_NUM        = S.SHIP_TO_CUST_CD
<!-- NA#ASCC CLICK MOD End -->
        <isNotNull property="mdseCd">
        AND M.MDSE_CD              = #mdseCd#
        </isNotNull>
        AND M.RGTN_STS_CD          = #rgtnStsCd#
        AND SMM.EZCANCELFLAG       = '0'
        AND M.EZCANCELFLAG         = '0'
        AND S.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getMdlNm" parameterClass="Map" resultClass="String">
      SELECT
        *
      FROM
        MDL_NM MN
      WHERE
            MN.T_GLBL_CMPY_CD = #glblCmpyCd#
        AND MN.T_MDL_NM       = #mdlNm#
        AND MN.EZCANCELFLAG   = '0'
    </statement>

    <statement id="getShipToCustCd" parameterClass="Map" resultClass="String">
      SELECT
        DISTINCT S.SHIP_TO_CUST_CD 
      FROM
        SHIP_TO_CUST S 
      WHERE
            S.GLBL_CMPY_CD    = #glblCmpyCd#
        AND S.SHIP_TO_CUST_CD = #shipToCustCd#
        AND S.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getTechCd" parameterClass="Map" resultClass="String">
      SELECT
        DISTINCT TM.TECH_TOC_CD 
      FROM
        TECH_MSTR TM 
      WHERE
            TM.GLBL_CMPY_CD = #glblCmpyCd#
        AND TM.TECH_TOC_CD  = #techCd#
        AND TM.EZCANCELFLAG = '0'
        <!-- START 2016/12/16 K.Kojima [QC#15653,ADD] -->
        AND EXISTS(
                SELECT
                    1
                FROM
                     ORG_FUNC_ASG     OFA
                    ,TOC              T
                    ,ORG_FUNC_ROLE_TP OFRT
                WHERE
                        OFA.GLBL_CMPY_CD                  = TM.GLBL_CMPY_CD
                    AND OFA.PSN_CD                        = TM.TECH_TOC_CD
                    AND OFA.EFF_FROM_DT               &lt;= #effDt#
                    AND NVL(OFA.EFF_THRU_DT, #effDt#) &gt;= #effDt#
                    AND OFA.GLBL_CMPY_CD                  = T.GLBL_CMPY_CD
                    AND OFA.TOC_CD                        = T.TOC_CD
                    AND T.GLBL_CMPY_CD                    = OFRT.GLBL_CMPY_CD
                    AND T.ORG_FUNC_ROLE_TP_CD             = OFRT.ORG_FUNC_ROLE_TP_CD
                    AND OFRT.TECH_MSTR_REQ_FLG            = #flgY#
                    AND OFRT.ACTV_FLG                     = #flgY#
                    AND OFA.EZCANCELFLAG                  = '0'
                    AND T.EZCANCELFLAG                    = '0'
                    AND OFRT.EZCANCELFLAG                 = '0'
            )
        <!-- END 2016/12/16 K.Kojima [QC#15653,ADD] -->
    </statement>
<!--NA#ASCC CLICK DEL Start-->
<!--
    <statement id="getRecallInfo" parameterClass="Map" resultClass="Map">
      SELECT
          MM.SVC_MACH_MSTR_PK
        , (
          SELECT
            MAX(ST2.SVC_TASK_CPLT_DT) 
          FROM
            SVC_TASK ST2 
          WHERE
                ST2.GLBL_CMPY_CD     = #glblCmpyCd#
            AND ST2.SVC_MACH_MSTR_PK = #machMstrPk#
            AND ST2.EZCANCELFLAG     = '0'
        ) PREVIOUS_TASK_DT
        , DM.RCLL_INTVL_DAYS_AOT
        , ( 
          SELECT
            COUNT(*) 
          FROM
            SVC_TASK ST 
          WHERE
                ST.GLBL_CMPY_CD     = #glblCmpyCd#
            AND ST.SVC_MACH_MSTR_PK = #machMstrPk# 
            AND ST.SVC_TASK_STS_CD IN ( 
              SELECT
                STS.SVC_TASK_STS_CD 
              FROM
                SVC_TASK_STS STS 
              WHERE
                    STS.GLBL_CMPY_CD = #glblCmpyCd#
                    <iterate property="svcCallStsList" var="svcCallStsCd[]" open="AND STS.SVC_TASK_STS_CD NOT IN (" conjunction= "," close=")">
                      #svcCallStsCd[]#
                    </iterate>
            ) 
            AND ST.EZCANCELFLAG     = '0'
        ) PROCESSING_TASK_CNT 
      FROM
          SVC_MACH_MSTR MM
        , MDL_ITEM      MI
        , MDL_NM        MN
        , DS_MDL        DM
      WHERE
            MM.GLBL_CMPY_CD     = #glblCmpyCd# 
        AND MM.SVC_MACH_MSTR_PK = #machMstrPk# 
        AND MM.GLBL_CMPY_CD     = MI.T_GLBL_CMPY_CD(+)
        AND MM.MDSE_CD          = MI.T_ITEM_CD(+)
        AND MI.T_GLBL_CMPY_CD     = MN.T_GLBL_CMPY_CD(+)
        AND MI.T_MDL_ID         = MN.T_MDL_ID(+) 
        AND MN.T_GLBL_CMPY_CD     = DM.GLBL_CMPY_CD(+)
        AND MN.T_MDL_NM         = DM.MDL_NM(+)
        AND MM.EZCANCELFLAG     = '0'
        AND MI.EZCANCELFLAG(+)  = '0'
        AND MN.EZCANCELFLAG(+)  = '0'
        AND DM.EZCANCELFLAG(+)  = '0'
    </statement>
-->
<!--NA#ASCC CLICK DEL End-->

    <statement id="getBillToCustCd" parameterClass="Map" resultClass="String">
        SELECT
          SH.BILL_TO_CUST_CD
        FROM
          SHIP_TO_CUST SH
        WHERE
              SH.GLBL_CMPY_CD    = #glblCmpyCd#
          AND SH.SHIP_TO_CUST_CD = #shipTo#
          AND SH.EZCANCELFLAG    = '0'
        GROUP BY
          SH.BILL_TO_CUST_CD
    </statement>
    <statement id="getSvcTaskHld" parameterClass="Map" resultClass="BigDecimal">
        SELECT
          STH.SVC_TASK_HLD_PK
        FROM
          SVC_TASK_HLD STH 
        WHERE
              STH.SVC_TASK_NUM = #svcTaskNum#
          AND STH.GLBL_CMPY_CD = #glblCmpyCd#
          AND STH.EZCANCELFLAG = '0'
    </statement>
<!--NA#ASCC CLICK ADD Start-->

    <statement id="getRecallInfo" parameterClass="Map" resultClass="Map">
      SELECT
          ST.GLBL_CMPY_CD
        , ST.MDL_NM
        , ST.SVC_TASK_CPLT_DT AS PREVIOUS_TASK_DT
        , ST.SVC_MACH_MSTR_PK
        <!-- START 2019/11/18 K.Fujimoto [QC#54391, MOD] -->
        <!-- , DM.RCLL_INTVL_DAYS_AOT -->
        , DM.RCLL_GLBL_INTVL_DAYS_AOT
        <!-- END   2019/11/18 K.Fujimoto [QC#54391, MOD] -->
        , DM.RCLL_COPY_VOL_CNT
        , ( 
          SELECT
            COUNT(*) 
          FROM
            SVC_TASK ST 
          WHERE
                ST.GLBL_CMPY_CD     = #glblCmpyCd#
            AND ST.SVC_MACH_MSTR_PK = #svcMachMstrPk# 
            AND ST.SVC_TASK_STS_CD IN ( 
              SELECT
                STS.SVC_TASK_STS_CD 
              FROM
                SVC_TASK_STS STS 
              WHERE
                    STS.GLBL_CMPY_CD = #glblCmpyCd#
                    <iterate property="svcCallStsList" var="svcCallStsCd[]" open="AND STS.SVC_TASK_STS_CD NOT IN (" conjunction= "," close=")">
                      #svcCallStsCd[]#
                    </iterate>
            )
            <isNotNull property="svcTaskNum">
              AND ST.SVC_TASK_NUM     != #svcTaskNum#
            </isNotNull>
            AND ST.EZCANCELFLAG     = '0'
            <!-- START 2019/11/18 K.Fujimoto [QC#54391, ADD] -->
            AND EXISTS(
                        SELECT
                              1
                         FROM
                              DS_SVC_CALL_TP CALL
                        WHERE
                              CALL.GLBL_CMPY_CD      = #glblCmpyCd#
                          AND CALL.EZCANCELFLAG      = '0'
                          AND CALL.DS_SVC_CALL_TP_CD = ST.DS_SVC_CALL_TP_CD
                          AND CALL.ONS_SPRT_CALL_FLG = 'N'
                      )
            <!-- END   2019/11/18 K.Fujimoto [QC#54391, ADD] -->
        ) PROCESSING_TASK_CNT 
      FROM
        ( 
          SELECT
              S2.GLBL_CMPY_CD
            , S2.MDL_NM
            , S2.SVC_TASK_CPLT_DT
            , S2.SVC_MACH_MSTR_PK 
          FROM
            ( 
              SELECT
                  S.GLBL_CMPY_CD
                , S.MDL_NM
                , S.SVC_TASK_CPLT_DT
                , S.SVC_MACH_MSTR_PK 
              FROM
                  SVC_TASK       S
                , DS_SVC_CALL_TP CT 
              WHERE
                    S.GLBL_CMPY_CD       = #glblCmpyCd#
                AND S.SVC_MACH_MSTR_PK   = #svcMachMstrPk# 
                AND S.GLBL_CMPY_CD       = CT.GLBL_CMPY_CD 
                AND S.DS_SVC_CALL_TP_CD  = CT.DS_SVC_CALL_TP_CD 
                AND CT.SVC_RCLL_TRGT_FLG = #rcllTrgtFlg#
                AND S.SVC_TASK_CPLT_DT   IS NOT NULL 
                AND S.EZCANCELFLAG       = '0'
                AND CT.EZCANCELFLAG      = '0'
              ORDER BY
                S.SVC_TASK_CPLT_DT DESC
            ) S2 
          WHERE
            ROWNUM = 1
        ) ST
        , MDL_NM MN
        , DS_MDL DM
      WHERE
            ST.GLBL_CMPY_CD = DM.GLBL_CMPY_CD 
        AND ST.MDL_NM       = MN.T_MDL_NM
        AND MN.T_MDL_ID     = DM.MDL_ID 
        AND MN.EZCANCELFLAG = '0'
        AND DM.EZCANCELFLAG = '0'
        AND ROWNUM = 1
    </statement>

    <statement id="getNonWrkDays" parameterClass="Map" resultClass="BigDecimal">
        WITH TMP_WKE AS (
            SELECT
                CAL_DT
            FROM
                CAL
            WHERE
                EZCANCELFLAG       = '0'
            AND GLBL_CMPY_CD       = #glblCmpyCd#
            AND CAL_TP_CD          = #calTpGeneral#
            AND DT_ATTRB_CD        = #dtAttrbBiz#
            AND DT_ATTRB_VAL_CD    = #constOff#
            AND CAL_DT       BETWEEN #fromDt# AND #thruDt#
        ), TMP_HOL AS (
            SELECT
                CAL_DT
            FROM
                CAL
            WHERE
                EZCANCELFLAG       = '0'
            AND GLBL_CMPY_CD       = #glblCmpyCd#
            AND CAL_TP_CD          = #calTpHoliday#
            AND DT_ATTRB_CD        = #dtAttrbBiz#
            AND DT_ATTRB_VAL_CD    = #constOn#
            AND CAL_DT       BETWEEN #fromDt# AND #thruDt#
        ), TMP_NOT_WRK_DT AS (
            SELECT CAL_DT FROM TMP_WKE
            UNION
            SELECT CAL_DT FROM TMP_HOL
        )
        SELECT
            COUNT(1)
        FROM
            TMP_NOT_WRK_DT
    </statement>

    <statement id="getRcllCallTp" parameterClass="Map" resultClass="Map">
        SELECT
            SCTT.DS_SVC_CALL_TP_CD
        FROM
            DS_SVC_CALL_TP SCTF
           ,DS_SVC_CALL_TP SCTT
        WHERE
            SCTF.EZCANCELFLAG       = '0'
        AND SCTT.EZCANCELFLAG       = '0'
        AND SCTF.GLBL_CMPY_CD       = #glblCmpyCd#
        AND SCTF.GLBL_CMPY_CD       = SCTT.GLBL_CMPY_CD
        AND SCTF.AFT_HRS_FLG        = SCTT.AFT_HRS_FLG
        AND SCTF.SVC_RCLL_TRGT_FLG  = #svcRcllTrgtFlg#
        AND SCTF.DS_SVC_CALL_TP_CD  = #fromSvcCallTpCd#
        AND SCTT.SVC_RCLL_FLG       = #svcRcllFlg#
    </statement>
<!--NA#ASCC CLICK ADD End-->
<!-- START 2017/09/05 K.Kitachi [QC#19971, ADD] -->
    <statement id="countOpenPrchReq" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             FSR_VISIT    FV1
            ,FSR_VISIT    FV2
            ,PRCH_REQ     PRQ
            ,PRCH_REQ_STS PRS
        WHERE
                FV1.GLBL_CMPY_CD    = #glblCmpyCd#
            AND FV1.FSR_NUM         = #fsrNum#
            AND FV1.SVC_TASK_NUM    = #svcTaskNum#
            AND FV1.EZCANCELFLAG    = '0'
            AND FV1.GLBL_CMPY_CD    = FV2.GLBL_CMPY_CD
            AND FV1.FSR_NUM         = FV2.FSR_NUM
            AND FV1.FSR_VISIT_NUM   = FV2.NEXT_FSR_VISIT_NUM
            AND FV2.EZCANCELFLAG    = '0'
            AND FV2.GLBL_CMPY_CD    = PRQ.GLBL_CMPY_CD
            AND FV2.FSR_NUM         = PRQ.FSR_NUM
            AND FV2.SVC_TASK_NUM    = PRQ.SVC_TASK_NUM
            AND PRQ.EZCANCELFLAG    = '0'
            AND PRQ.GLBL_CMPY_CD    = PRS.GLBL_CMPY_CD
            AND PRQ.PRCH_REQ_STS_CD = PRS.PRCH_REQ_STS_CD
            AND PRS.OPEN_STS_FLG    = 'Y'
            AND PRS.EZCANCELFLAG    = '0'
    </statement>
<!-- END 2017/09/05 K.Kitachi [QC#19971, ADD] -->
<!-- add start 2019/10/24 QC#53441 -->
    <statement id="getSvcPhysMtrReadGrpSq" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            DISTINCT A.SVC_PHYS_MTR_READ_GRP_SQ
        FROM 
            SVC_PHYS_MTR_READ A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.SVC_MACH_MSTR_PK  = #svcMachMstrPk#
            AND A.SVC_TASK_NUM      = #svcTaskNum#
            AND A.VLD_MTR_FLG       = #vldMtrFlgY#
        ORDER BY
            A.SVC_PHYS_MTR_READ_GRP_SQ ASC
    </statement>
<!-- add end 2019/10/24 QC#53441 -->
</sqlMap>
