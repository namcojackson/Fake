<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAB320001">
    <statement id="getMktgMap" parameterClass="Map" resultClass="Map">
        SELECT
            MMQ.MKTG_MAP_RQST_PK
            ,MMQ.EXACT_COND_FLG
            ,MMQ.PRTL_COND_FLG
            ,MMQ.DUNS_COND_FLG
            ,MMQ.GLN_COND_FLG
            ,MMQ.OVRD_VLD_FLG
            ,MMQ.CONTR_ASSN_TRGT_TP_CD
            ,MMW.MKTG_MAP_WRK_PK
            ,MMW.MKTG_MAP_RQST_PK
            ,MMW.DS_ACCT_NM
            ,MMW.FIRST_LINE_ADDR
            ,MMW.SCD_LINE_ADDR
            ,MMW.THIRD_LINE_ADDR
            ,MMW.FRTH_LINE_ADDR
            ,MMW.CTY_ADDR
            ,MMW.CNTY_PK
            ,MMW.ST_CD
            ,MMW.POST_CD
            ,MMW.CTRY_CD
            ,MMW.DUNS_NUM
            ,MMW.GLN_NUM
            ,MMW.HIN_NUM
            ,MMW.MKTG_MAP_ATTRB_TXT_01
            ,MMW.MKTG_MAP_ATTRB_TXT_02
            ,MMW.MKTG_MAP_ATTRB_TXT_03
            ,MMW.MKTG_MAP_ATTRB_TXT_04
            ,MMW.MKTG_MAP_ATTRB_TXT_05
            ,MMW.MKTG_MAP_ATTRB_TXT_06
            ,MMW.MKTG_MAP_ATTRB_TXT_07
            ,MMW.MKTG_MAP_ATTRB_TXT_08
            ,MMW.MKTG_MAP_ATTRB_TXT_09
            ,MMW.MKTG_MAP_ATTRB_TXT_10
            ,MMW.MKTG_MAP_ATTRB_TXT_11
            ,MMW.MKTG_MAP_ATTRB_TXT_12
            ,MMW.MKTG_MAP_ATTRB_TXT_13
            ,MMW.MKTG_MAP_ATTRB_TXT_14
            ,MMW.MKTG_MAP_ATTRB_TXT_15
            ,MMW.MKTG_MAP_ATTRB_TXT_16
            ,MMW.MKTG_MAP_ATTRB_TXT_17
            ,MMW.MKTG_MAP_ATTRB_TXT_18
            ,MMW.MKTG_MAP_ATTRB_TXT_19
            ,MMW.MKTG_MAP_ATTRB_TXT_20
        FROM
            MKTG_MAP_RQST MMQ
            ,MKTG_FLD_MAP MFM
            ,MKTG_MAP_WRK MMW
        WHERE
                MMQ.GLBL_CMPY_CD = #glblCmpyCd#
            AND MMQ.EZCANCELFLAG = '0'
            AND MMQ.UPLD_ERR_FLG = 'N'
            AND MMQ.MKTG_MAP_RQST_PROC_FLG = 'N'
        
            AND MMQ.GLBL_CMPY_CD = MFM.GLBL_CMPY_CD
            AND MMQ.EZCANCELFLAG = MFM.EZCANCELFLAG
            AND MMQ.MKTG_FLD_MAP_PK = MFM.MKTG_FLD_MAP_PK
        
            AND MMQ.GLBL_CMPY_CD = MMW.GLBL_CMPY_CD
            AND MMQ.EZCANCELFLAG = MMW.EZCANCELFLAG
            AND MMQ.MKTG_MAP_RQST_PK = MMW.MKTG_MAP_RQST_PK
            
        ORDER BY
            MMQ.MKTG_MAP_RQST_PK
            ,MMW.MKTG_MAP_WRK_PK

    </statement>
    <statement id="getDupLoc" parameterClass="Map" resultClass="Map">
        SELECT
             PLW.LOC_NUM
            ,AL.DS_ACCT_NUM
            ,TO_CHAR(MMW.MKTG_MAP_WRK_PK) MKTG_MAP_WRK_PK_STR
        FROM
             PTY_LOC_WRK PLW
            ,ACCT_LOC AL
            ,SELL_TO_CUST STC
            ,MKTG_MAP_WRK MMW
        WHERE
                PLW.GLBL_CMPY_CD  = #glblCmpyCd#
            AND PLW.EZCANCELFLAG  = '0'
            AND PLW.RGTN_STS_CD   = #rgtnStsCd#
            AND MMW.EZCANCELFLAG  = '0'
            AND MMW.GLBL_CMPY_CD  = #glblCmpyCd#
            AND MMW.MKTG_MAP_RQST_PK = #mktgMapRqstPk#
        <isNotNull property="matchAddrFlg">
          <isEqual property="exactFlg" compareValue="Y">
            AND UPPER(PLW.FIRST_LINE_ADDR) = UPPER(MMW.FIRST_LINE_ADDR)
          </isEqual>
          <isEqual property="exactFlg" compareValue="N">
            AND UPPER(PLW.FIRST_LINE_ADDR) LIKE SUBSTR(UPPER(MMW.FIRST_LINE_ADDR), 1, #lineSubstrLength#) || '%'
          </isEqual>
            AND UPPER(PLW.CTY_ADDR)   = UPPER(MMW.CTY_ADDR)
            AND NVL(PLW.ST_CD, ' ')   = NVL(MMW.ST_CD, ' ')
            AND PLW.POST_CD           = MMW.POST_CD
            AND NVL(PLW.CTRY_CD, ' ') = NVL(MMW.CTRY_CD, ' ')
        </isNotNull>
        <isNotNull property="matchDunsFlg">
            AND PLW.DUNS_NUM          = MMW.DUNS_NUM
        </isNotNull>
        <isNotNull property="matchGlnFlg">
            AND PLW.GLN_NUM           = MMW.GLN_NUM
        </isNotNull>
            AND PLW.GLBL_CMPY_CD = AL.GLBL_CMPY_CD
            AND PLW.EZCANCELFLAG = AL.EZCANCELFLAG
            AND PLW.LOC_NUM      = AL.LOC_NUM
            AND AL.RGTN_STS_CD   = #rgtnStsCd#
            AND AL.GLBL_CMPY_CD  = STC.GLBL_CMPY_CD
            AND AL.EZCANCELFLAG  = STC.EZCANCELFLAG
            AND AL.DS_ACCT_NUM   = STC.SELL_TO_CUST_CD
            AND STC.DS_ACCT_ACTV_CUST_FLG = 'Y'
        <isNotNull property="matchAddrFlg">
          <isEqual property="exactFlg" compareValue="Y">
            AND UPPER(STC.DS_ACCT_NM) = UPPER(MMW.DS_ACCT_NM)
          </isEqual>
          <isEqual property="exactFlg" compareValue="N">
            AND UPPER(STC.DS_ACCT_NM) LIKE SUBSTR(UPPER(MMW.DS_ACCT_NM), 1, #nmSubstrLength#) || '%'
          </isEqual>
        </isNotNull>
      UNION ALL
        SELECT
             PLW.LOC_NUM
            ,DAC.DS_ACCT_NUM
            ,TO_CHAR(MMW.MKTG_MAP_WRK_PK) MKTG_MAP_WRK_PK_STR
        FROM
             PROS_PTY_LOC_WRK PLW
            ,DS_ACCT_PROS     DAC
            ,MKTG_MAP_WRK     MMW
        WHERE
                PLW.GLBL_CMPY_CD  = #glblCmpyCd#
            AND PLW.EZCANCELFLAG  = '0'
            AND PLW.RGTN_STS_CD   = #rgtnStsCd#
            AND MMW.EZCANCELFLAG  = '0'
            AND MMW.GLBL_CMPY_CD  = #glblCmpyCd#
            AND MMW.MKTG_MAP_RQST_PK = #mktgMapRqstPk#
        <isNotNull property="matchAddrFlg">
          <isEqual property="exactFlg" compareValue="Y">
            AND UPPER(PLW.FIRST_LINE_ADDR) = UPPER(MMW.FIRST_LINE_ADDR)
          </isEqual>
          <isEqual property="exactFlg" compareValue="N">
            AND UPPER(PLW.FIRST_LINE_ADDR) LIKE SUBSTR(UPPER(MMW.FIRST_LINE_ADDR), 1, #lineSubstrLength#) || '%'
          </isEqual>
            AND UPPER(PLW.CTY_ADDR)   = UPPER(MMW.CTY_ADDR)
            AND NVL(PLW.ST_CD, ' ')   = NVL(MMW.ST_CD, ' ')
            AND PLW.POST_CD           = MMW.POST_CD
            AND NVL(PLW.CTRY_CD, ' ') = NVL(MMW.CTRY_CD, ' ')
        </isNotNull>
        <isNotNull property="matchDunsFlg">
            AND PLW.DUNS_NUM          = MMW.DUNS_NUM
        </isNotNull>
        <isNotNull property="matchGlnFlg">
            AND PLW.GLN_NUM           = MMW.GLN_NUM
        </isNotNull>
            AND DAC.RGTN_STS_CD  = #rgtnStsCd#
            AND PLW.GLBL_CMPY_CD = DAC.GLBL_CMPY_CD
            AND PLW.EZCANCELFLAG = DAC.EZCANCELFLAG
            AND PLW.LOC_NUM      = DAC.LOC_NUM
            AND DAC.DS_ACCT_ACTV_CUST_FLG = 'Y'
        <isNotNull property="matchAddrFlg">
          <isEqual property="exactFlg" compareValue="Y">
            AND UPPER(DAC.DS_ACCT_NM) = UPPER(MMW.DS_ACCT_NM)
          </isEqual>
          <isEqual property="exactFlg" compareValue="N">
            AND UPPER(DAC.DS_ACCT_NM) LIKE SUBSTR(UPPER(MMW.DS_ACCT_NM), 1, #nmSubstrLength#) || '%'
          </isEqual>
        </isNotNull>        
    </statement>
    
    <statement id="getMktgMapWrkByRqstPk" parameterClass="Map" resultClass="Map">
        SELECT
            TO_CHAR(MMW.MKTG_MAP_WRK_PK) MKTG_MAP_WRK_PK_STR
          , MMW.ST_CD
          , MMW.POST_CD
          , MMW.DS_ACCT_NM
          , TO_CHAR(MKTG_MAP_SQ.NEXTVAL) MKTG_MAP_PK_STR
        FROM
            MKTG_MAP_WRK MMW
        WHERE
            MMW.GLBL_CMPY_CD = #glblCmpyCd#
        AND MMW.EZCANCELFLAG = '0'
        AND MMW.MKTG_MAP_RQST_PK = #mktgMapRqstPk# 
    </statement>

    <statement id="getSfAcctId" parameterClass="Map" resultClass="String">
        SELECT
            CANON.SF_ACCOUNT_ID
        FROM
            CANON_E404_SF_ACCT_MAPPING_TBL CANON
        WHERE
            CANON.PARTY_SITE_NUMBER = #partySiteNumber#
    </statement>
</sqlMap>
