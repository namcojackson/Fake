<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NMAB274001">
    <statement id="getWrkInfo" parameterClass="Map" resultClass="Map">
        SELECT
            ATRRW.UPLD_CSV_RQST_PK
            ,ATRRW.UPLD_CSV_RQST_ROW_NUM
            ,ATRRW.LOC_NUM
            ,ATRRW.DS_ACCT_NUM
            ,ATRRW.DS_ACCT_NM
            ,ATRRW.TRTY_GRP_TP_CD
            ,ATRRW.ACCT_TRTY_ORG_CD
            ,ATRRW.ACCT_TRTY_ORG_NM
            ,ATRRW.UPLD_CSV_RQST_CMNT_TXT
        FROM
            ACCT_TRTY_RESRC_RQST_WRK ATRRW
        WHERE
                ATRRW.GLBL_CMPY_CD = #glblCmpyCd#
            AND ATRRW.EZCANCELFLAG = '0'
            AND ATRRW.UPLD_CSV_RQST_PK = #upldCsvRqstPk#
        ORDER BY
            ATRRW.DS_ACCT_NUM
            ,ATRRW.LOC_NUM
            ,ATRRW.TRTY_GRP_TP_CD
    </statement>

    <statement id="getOrgCd" parameterClass="Map" resultClass="Map">
        SELECT
            DOU.ORG_CD
            ,DOU.ORG_NM
            ,DOU.TRTY_GRP_TP_CD
        FROM
            DS_ORG_UNIT DOU
            ,ORG_STRU_TP OST
        WHERE
                DOU.GLBL_CMPY_CD = #glblCmpyCd#
            AND DOU.EZCANCELFLAG = '0'
            <isNotNull property="orgNm">
            AND DOU.ORG_NM = #orgNm#
            </isNotNull>
            <isNotNull property="orgCd">
            AND DOU.ORG_CD = #orgCd#
            </isNotNull>
            AND DOU.ORG_STRU_TP_CD = #orgStruTpCd#
            AND DOU.GNRN_TP_CD IN (#gnrnTpCd2#, #gnrnTpCd3#)

            AND DOU.GLBL_CMPY_CD = OST.GLBL_CMPY_CD
            AND DOU.EZCANCELFLAG = OST.EZCANCELFLAG
            AND OST.TRTY_STRU_FLG = 'Y'
            AND DOU.ORG_STRU_TP_CD = OST.ORG_STRU_TP_CD
    </statement>

    <statement id="getManualFlag" parameterClass="Map" resultClass="String">
        SELECT
            ASG.MAN_ENTRY_FLG
        FROM
            ACCT_TRTY_RESRC_ASG   ASG
        WHERE
                ASG.GLBL_CMPY_CD  = #glblCmpyCd#
            AND ASG.EZCANCELFLAG  = '0'
            AND ASG.DS_ACCT_NUM   = #dsAcctNum#
            AND ASG.LOC_NUM       = #locNum#

        UNION ALL

        SELECT
            PASG.MAN_ENTRY_FLG
        FROM
            PROS_TRTY_RESRC_ASG   PASG
        WHERE
                PASG.GLBL_CMPY_CD  = #glblCmpyCd#
            AND PASG.EZCANCELFLAG  = '0'
            AND PASG.DS_ACCT_NUM   = #dsAcctNum#
            AND PASG.LOC_NUM       = #locNum#
     </statement>

     <statement id="csvDupChk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            ATRRW.UPLD_CSV_RQST_ROW_NUM
        FROM
            ACCT_TRTY_RESRC_RQST_WRK ATRRW
        WHERE
                ATRRW.GLBL_CMPY_CD   = #glblCmpyCd#
            AND ATRRW.EZCANCELFLAG   = '0'
            AND ATRRW.UPLD_CSV_RQST_PK = #upldCsvRqstPk#
            AND ATRRW.DS_ACCT_NUM    = #dsAcctNum#
            AND ATRRW.LOC_NUM        = #locNum#
            AND ATRRW.TRTY_GRP_TP_CD = #trtyGrpTpCd#
    </statement>

    <statement id="getAcct" parameterClass="Map" resultClass="Map">
        SELECT
             SELL.SELL_TO_CUST_CD   DS_ACCT_NUM
            ,SELL.DS_ACCT_TP_CD
            ,SELL.RGTN_STS_CD
        FROM
            SELL_TO_CUST SELL
        WHERE
                SELL.GLBL_CMPY_CD = #glblCmpyCd#
            AND SELL.EZCANCELFLAG = '0'
            AND SELL.SELL_TO_CUST_CD = #dsAcctNum#
            AND SELL.RGTN_STS_CD = #rgtnStsCdP20#

        UNION ALL

        SELECT
             DAP.DS_ACCT_NUM
            ,DAP.DS_ACCT_TP_CD
            ,DAP.RGTN_STS_CD
        FROM
            DS_ACCT_PROS DAP
        WHERE
                DAP.GLBL_CMPY_CD = #glblCmpyCd#
            AND DAP.EZCANCELFLAG = '0'
            AND DAP.DS_ACCT_NUM = #dsAcctNum#
            AND DAP.DS_ACCT_ACTV_CUST_FLG = 'Y'
            AND DAP.RGTN_STS_CD = #rgtnStsCdP01#
    </statement>

    <statement id="getLoc" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            PLW.PTY_LOC_PK
        FROM
            PTY_LOC_WRK PLW
        WHERE
                PLW.GLBL_CMPY_CD = #glblCmpyCd#
            AND PLW.EZCANCELFLAG = '0'
            AND PLW.LOC_NUM = #locNum#
            AND PLW.RGTN_STS_CD  = #rgtnStsCdP20#
        UNION ALL
        SELECT
            PPLW.PTY_LOC_PK
        FROM
            PROS_PTY_LOC_WRK PPLW
        WHERE
                PPLW.GLBL_CMPY_CD = #glblCmpyCd#
            AND PPLW.EZCANCELFLAG = '0'
            AND PPLW.LOC_NUM = #locNum#
            AND PPLW.RGTN_STS_CD  = #rgtnStsCdP20#
     </statement>

     <statement id="getAcctLoc" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            AL.ACCT_LOC_PK
        FROM
            ACCT_LOC AL
        WHERE
                AL.GLBL_CMPY_CD = #glblCmpyCd#
            AND AL.EZCANCELFLAG = '0'
            AND AL.DS_ACCT_NUM  = #dsAcctNum#
            AND AL.LOC_NUM      = #locNum#
            AND AL.EFF_FROM_DT  &lt;= #procDt#
            AND NVL(AL.EFF_THRU_DT , #maxDt#) &gt;= #procDt#
            AND AL.RGTN_STS_CD  = #rgtnStsCdP20#

        UNION ALL

        SELECT
            DAP.DS_ACCT_PROS_PK ACCT_LOC_PK
        FROM
            DS_ACCT_PROS DAP
        WHERE
                DAP.GLBL_CMPY_CD = #glblCmpyCd#
            AND DAP.EZCANCELFLAG = '0'
            AND DAP.DS_ACCT_NUM  = #dsAcctNum#
            AND DAP.LOC_NUM      = #locNum#
            AND DAP.EFF_FROM_DT  &lt;= #procDt#
            AND NVL(DAP.EFF_THRU_DT , #maxDt#) &gt;= #procDt#
            AND DAP.DS_ACCT_ACTV_CUST_FLG = 'Y'
            AND DAP.RGTN_STS_CD = #rgtnStsCdP01#
    </statement>

    <statement id="lobChk" parameterClass="Map" resultClass="String">
        SELECT
            ATRRW.TRTY_GRP_TP_CD
        FROM
            ACCT_TRTY_RESRC_RQST_WRK ATRRW
        WHERE
                ATRRW.GLBL_CMPY_CD = #glblCmpyCd#
            AND ATRRW.EZCANCELFLAG = '0'
            AND ATRRW.TRTY_GRP_TP_CD = #trtyGrpTpCd#
    </statement>

    <statement id="getOrgUnitDt" parameterClass="Map" resultClass="Map">
        SELECT
            DOU.EFF_FROM_DT
            ,DOU.EFF_THRU_DT
            ,DOU.TRTY_GRP_TP_CD
            ,DOU.ORG_CD
        FROM
            DS_ORG_UNIT DOU
            ,ORG_STRU_TP OST
        WHERE
                DOU.GLBL_CMPY_CD   = #glblCmpyCd#
            AND DOU.EZCANCELFLAG   = '0'
            AND DOU.ORG_CD         = #orgCd#
            AND DOU.ORG_STRU_TP_CD = #orgStruTpCd#
            AND DOU.GNRN_TP_CD IN (#gnrnTpCd2#, #gnrnTpCd3#)

            AND DOU.GLBL_CMPY_CD   = OST.GLBL_CMPY_CD
            AND DOU.EZCANCELFLAG   = OST.EZCANCELFLAG
            AND OST.TRTY_STRU_FLG  = 'Y'
            AND DOU.ORG_STRU_TP_CD = OST.ORG_STRU_TP_CD
    </statement>

    <statement id="getAftOrgUnitDt" parameterClass="Map" resultClass="Map">
        SELECT
            DOU.EFF_FROM_DT
            ,DOU.EFF_THRU_DT
            ,DOU.TRTY_GRP_TP_CD
            ,DOU.ORG_CD
        FROM
            DS_ORG_UNIT DOU
            ,ORG_STRU_TP OST
        WHERE
                DOU.GLBL_CMPY_CD   = #glblCmpyCd#
            AND DOU.EZCANCELFLAG   = '0'
            <isNotNull property="orgNm">
            AND DOU.ORG_NM = #orgNm#
            </isNotNull>
            AND DOU.ORG_STRU_TP_CD = #orgStruTpCd#
            AND DOU.GNRN_TP_CD IN (#gnrnTpCd2#, #gnrnTpCd3#)

            AND DOU.GLBL_CMPY_CD   = OST.GLBL_CMPY_CD
            AND DOU.EZCANCELFLAG   = OST.EZCANCELFLAG
            AND OST.TRTY_STRU_FLG  = 'Y'
            AND DOU.ORG_STRU_TP_CD = OST.ORG_STRU_TP_CD
    </statement>

    <statement id="getAcctTrtyResrc" parameterClass="Map" resultClass="String">
        SELECT
            ATRA.GLBL_CMPY_CD
        FROM
            ACCT_TRTY_RESRC_ASG ATRA
        WHERE
                ATRA.GLBL_CMPY_CD  = #glblCmpyCd#
            AND ATRA.EZCANCELFLAG  = '0' 
            AND ATRA.DS_ACCT_NUM   = #dsAcctNum#
            AND ATRA.LOC_NUM       = #locNum#
            AND ATRA.DS_ACCT_TP_CD = #dsAcctTpCd#
    </statement>

    <statement id="getProsTrtyResrc" parameterClass="Map" resultClass="String">
        SELECT
            PTRA.GLBL_CMPY_CD
        FROM
            PROS_TRTY_RESRC_ASG PTRA
        WHERE
                PTRA.GLBL_CMPY_CD  = #glblCmpyCd#
            AND PTRA.EZCANCELFLAG  = '0' 
            AND PTRA.DS_ACCT_NUM   = #dsAcctNum#
            AND PTRA.LOC_NUM       = #locNum#
            AND PTRA.DS_ACCT_TP_CD = #dsAcctTpCd#
    </statement>

    <statement id="getAcctTrtyRole" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            DISTINCT ATRA.ACCT_TRTY_ROLE_ASG_PK
        FROM
            ACCT_TRTY_ROLE_ASG ATRA
        WHERE
                ATRA.GLBL_CMPY_CD = #glblCmpyCd#
            AND ATRA.EZCANCELFLAG = '0'
            AND ATRA.DS_ACCT_NUM  = #dsAcctNum#
            AND ATRA.LOC_NUM      = #locNum#
            AND ATRA.ORG_CD       = #orgCd#
    </statement>

    <statement id="getProsTrtyRole" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            DISTINCT PTRA.ACCT_TRTY_ROLE_ASG_PK
        FROM
            PROS_TRTY_ROLE_ASG PTRA
        WHERE
                PTRA.GLBL_CMPY_CD = #glblCmpyCd#
            AND PTRA.EZCANCELFLAG = '0'
            AND PTRA.DS_ACCT_NUM  = #dsAcctNum#
            AND PTRA.LOC_NUM      = #locNum#
            AND PTRA.ORG_CD       = #orgCd#
    </statement>

    <statement id="getLineBizRankNum" parameterClass="Map" resultClass="String">
        SELECT 
            DECN.LINE_BIZ_RANK_NUM
        FROM
            LINE_BIZ_ROLE_RANK_DECN DECN
        WHERE
            DECN.ASG_TRTY_ATTRB_CD  = #asgTrtyAttrb#
        AND DECN.TRTY_GRP_TP_CD     = #trtyGrpTp#
        AND DECN.DS_ACCT_TP_CD      = #dsAcctTp#
        AND DECN.GLBL_CMPY_CD       = #glblCmpyCd#
        AND DECN.EZCANCELFLAG       = '0'
    </statement>

    <statement id="checkActiveResorce" parameterClass="Map" resultClass="Integer">
        SELECT 
            COUNT(*)
        FROM
            DS_ORG_UNIT        UNIT
          , ORG_STRU_TP        STRU
          , BIZ_AREA_ORG       BAO
          , DS_ORG_RESRC_RELN  RELN
          , S21_PSN            PSN
        WHERE 
            UNIT.GLBL_CMPY_CD          =  #glblCmpyCd#
        AND UNIT.ORG_CD                =  #trtyCd#

        AND UNIT.GLBL_CMPY_CD          =  STRU.GLBL_CMPY_CD
        AND UNIT.ORG_STRU_TP_CD        =  STRU.ORG_STRU_TP_CD
        AND STRU.TRTY_STRU_FLG         =  #flgOnY#

        AND UNIT.GLBL_CMPY_CD          =  BAO.GLBL_CMPY_CD
        AND UNIT.FIRST_ORG_CD          =  BAO.BIZ_AREA_ORG_CD

        AND UNIT.GLBL_CMPY_CD          =  RELN.GLBL_CMPY_CD
        AND UNIT.ORG_CD                =  RELN.ORG_CD
        <isNotNull property="salesRepRoleFlg">
        AND RELN.ACCT_TEAM_ROLE_TP_CD IS NULL
        </isNotNull>
        AND RELN.EFF_FROM_DT       &lt;=  #procDt#
        AND NVL(RELN.EFF_THRU_DT, #maxDt#) &gt;=  #procDt#
        AND RELN.GNRN_TP_CD            =  #gnrnTp_Current#

        AND RELN.GLBL_CMPY_CD          =  PSN.GLBL_CMPY_CD
        AND RELN.PSN_CD                =  PSN.PSN_CD
        AND PSN.EFF_FROM_DT        &lt;=  #procDt#
        AND NVL(RELN.EFF_THRU_DT, #maxDt#) &gt;=  #procDt#

        AND UNIT.EZCANCELFLAG          =  '0'
        AND STRU.EZCANCELFLAG          =  '0'
        AND BAO.EZCANCELFLAG           =  '0'
        AND RELN.EZCANCELFLAG          =  '0'
        AND PSN.EZCANCELFLAG           =  '0'
    </statement>

    <statement id="getTrtyRule" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            TR.TRTY_RULE_PK
        FROM
            TRTY_RULE TR
        WHERE
                TR.GLBL_CMPY_CD = #glblCmpyCd#
            AND TR.EZCANCELFLAG = '0'
            AND TR.ORG_CD = #orgCd#
            AND TR.TRTY_RULE_TP_CD = #ruleTpCd#
            AND TR.TRTY_RULE_FROM_VAL_TXT = #fromValTxt#
            AND TR.TRTY_RULE_OPRD_TP_CD = #oprdTpCd#
            AND TR.TRTY_RULE_LOGIC_TP_CD = #logicTpCd#
            AND TR.EFF_FROM_DT &lt;= #procDt#
            AND NVL(TR.EFF_THRU_DT, #maxDt#) &gt;= #procDt#
    </statement>
    <!-- 2024/02/21 QC#61970 K.Ikeda START -->
    <statement id="getFutureTrtyRule" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            TR.TRTY_RULE_PK
        FROM
            TRTY_RULE TR
        WHERE
                TR.GLBL_CMPY_CD = #glblCmpyCd#
            AND TR.EZCANCELFLAG = '0'
            AND TR.ORG_CD = #orgCd#
            AND TR.TRTY_RULE_TP_CD = #ruleTpCd#
            AND TR.TRTY_RULE_FROM_VAL_TXT = #fromValTxt#
            AND TR.TRTY_RULE_OPRD_TP_CD = #oprdTpCd#
            AND TR.TRTY_RULE_LOGIC_TP_CD = #logicTpCd#
            AND TR.EFF_FROM_DT &gt; #procDt#
    </statement>

    <!-- 2024/02/21 QC#61970 K.Iked END -->
    
    <!-- 2023/10/23 QC#61970 K.Ikeda START-->
    <statement id="getActiveTrtyRule" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            TR.TRTY_RULE_PK
        FROM
            TRTY_RULE TR
        WHERE
                TR.GLBL_CMPY_CD = #glblCmpyCd#
            AND TR.EZCANCELFLAG = '0'
            AND TR.TRTY_RULE_FROM_VAL_TXT = #fromValTxt#
            AND TR.EFF_FROM_DT &lt;= #procDt#
            AND NVL(TR.EFF_THRU_DT, #maxDt#) &gt;= #procDt#
    </statement>
    <!-- 2023/10/23 QC#61970 K.Ikeda -->

    <statement id="getAcctTrtyRoleAgs" parameterClass="Map" resultClass="Map">
       SELECT
            ATRA.ACCT_TRTY_ROLE_ASG_PK 
            ,ATRA.DS_ACCT_NM
            ,ATRA.DS_ACCT_NUM
            ,ATRA.LOC_NUM
            ,ATRA.BILL_TO_CUST_CD
            ,ATRA.SHIP_TO_CUST_CD
            ,ATRA.DS_ACCT_TP_CD
            ,ATRA.DS_ACCT_CLS_CD
            ,ATRA.FIRST_DS_ACCT_GRP_TP_CD
            ,ATRA.SCD_DS_ACCT_GRP_TP_CD
            ,ATRA.THIRD_DS_ACCT_GRP_TP_CD
            ,ATRA.FRTH_DS_ACCT_GRP_TP_CD
            ,ATRA.FIFTH_DS_ACCT_GRP_TP_CD
            ,ATRA.INDY_TP_CD
            ,ATRA.FIRST_LINE_ADDR
            ,ATRA.SCD_LINE_ADDR
            ,ATRA.THIRD_LINE_ADDR
            ,ATRA.FRTH_LINE_ADDR
            ,ATRA.CTY_ADDR
            ,ATRA.ST_CD
            ,ATRA.PROV_NM
            ,ATRA.CNTY_NM
            ,ATRA.POST_CD
            ,ATRA.LINE_BIZ_TP_CD
            ,ATRA.DS_CUST_SIC_CD
            ,RC.ASG_TRTY_ATTRB_CD
            ,RC.LINE_BIZ_ROLE_TP_CD
        FROM
            ACCT_TRTY_ROLE_ASG ATRA
            ,(SELECT DISTINCT
                RRD.LINE_BIZ_ROLE_TP_CD
                ,RT.LINE_BIZ_ROLE_TP_NM
                ,RRD.ASG_TRTY_ATTRB_CD
            FROM
                LINE_BIZ_ROLE_RANK_DECN RRD
                ,LINE_BIZ_ROLE_TP RT
            WHERE
                    RRD.GLBL_CMPY_CD = #glblCmpyCd#
                AND RRD.EZCANCELFLAG = '0'

                AND RRD.GLBL_CMPY_CD = RT.GLBL_CMPY_CD
                AND RRD.EZCANCELFLAG = RT.EZCANCELFLAG
                AND RRD.LINE_BIZ_ROLE_TP_CD = RT.LINE_BIZ_ROLE_TP_CD
            ORDER BY
                RRD.ASG_TRTY_ATTRB_CD
            ) RC
        WHERE
                ATRA.GLBL_CMPY_CD = #glblCmpyCd#
            AND ATRA.EZCANCELFLAG = '0'
            AND ATRA.DS_ACCT_NUM  = #dsAcctNum#
            AND ATRA.LOC_NUM      = #locNum#
            AND ATRA.ORG_CD       = #orgCd#
            AND ATRA.LINE_BIZ_ROLE_TP_CD = RC.LINE_BIZ_ROLE_TP_CD
    </statement>

    <statement id="getInsertData" parameterClass="Map" resultClass="Map">
        SELECT
            DOU.ORG_NM
            ,OFA.TOC_CD
            ,SP.PSN_CD
            ,TT.TRTY_TP_CD
            ,TGT.TRTY_GRP_TP_CD
            <isEqual property="isSlsRepFlg" compareValue="Y">
            ,'N' AS NON_SLS_REP_FLG
            </isEqual>
            <isNotEqual property="isSlsRepFlg" compareValue="Y">
            ,'Y' AS NON_SLS_REP_FLG
            </isNotEqual>
        FROM
            DS_ORG_UNIT DOU
            ,ORG_STRU_TP OST
            ,TRTY_TP TT
            ,TRTY_GRP_TP TGT
            ,DS_ORG_RESRC_RELN DORR
            ,S21_PSN SP
            ,ORG_FUNC_ASG OFA
            ,TOC T
            ,ORG_FUNC_ROLE_TP OFRT
        WHERE
                DOU.GLBL_CMPY_CD = #glblCmpyCd#
            AND DOU.EZCANCELFLAG = '0'
            AND DOU.ORG_CD       = #orgCd#

            AND DOU.GLBL_CMPY_CD = OST.GLBL_CMPY_CD
            AND DOU.EZCANCELFLAG = OST.EZCANCELFLAG
            AND DOU.ORG_STRU_TP_CD = OST.ORG_STRU_TP_CD
            AND OST.TRTY_STRU_FLG  = 'Y'

            AND DOU.GLBL_CMPY_CD = TT.GLBL_CMPY_CD
            AND DOU.EZCANCELFLAG = TT.EZCANCELFLAG
            AND DOU.TRTY_TP_CD   = TT.TRTY_TP_CD

            AND DOU.GLBL_CMPY_CD = TGT.GLBL_CMPY_CD
            AND DOU.EZCANCELFLAG = TGT.EZCANCELFLAG
            AND DOU.TRTY_GRP_TP_CD = TGT.TRTY_GRP_TP_CD

            AND DOU.GLBL_CMPY_CD = DORR.GLBL_CMPY_CD
            AND DOU.EZCANCELFLAG = DORR.EZCANCELFLAG
            AND DOU.ORG_CD       = DORR.ORG_CD
            <isEqual property="isSlsRepFlg" compareValue="Y">
            AND DORR.ACCT_TEAM_ROLE_TP_CD IS NULL
            </isEqual>
            <isNotEqual property="isSlsRepFlg" compareValue="Y">
            AND DORR.ACCT_TEAM_ROLE_TP_CD IS NOT NULL
            </isNotEqual>
            AND DORR.EFF_FROM_DT &lt;= #procDt#
            AND NVL(DORR.EFF_THRU_DT,#maxDt#) &gt;= #procDt#
            AND DORR.GNRN_TP_CD   = #gnrnTpCd2#

            AND DORR.GLBL_CMPY_CD = SP.GLBL_CMPY_CD
            AND DORR.EZCANCELFLAG = SP.EZCANCELFLAG
            AND DORR.PSN_CD       = SP.PSN_CD

            AND SP.GLBL_CMPY_CD   = OFA.GLBL_CMPY_CD
            AND SP.EZCANCELFLAG   = OFA.EZCANCELFLAG
            AND SP.PSN_CD         = OFA.PSN_CD
            AND OFA.EFF_FROM_DT &lt;= #procDt#
            AND NVL(OFA.EFF_THRU_DT,#maxDt#) &gt;= #procDt#
            AND OFA.GNRN_TP_CD   = #gnrnTpCd2#

            AND OFA.GLBL_CMPY_CD = T.GLBL_CMPY_CD
            AND OFA.EZCANCELFLAG = T.EZCANCELFLAG
            AND OFA.TOC_CD       = T.TOC_CD

            AND T.GLBL_CMPY_CD   = OFRT.GLBL_CMPY_CD
            AND T.EZCANCELFLAG   = OFRT.EZCANCELFLAG
            AND T.ORG_FUNC_ROLE_TP_CD  = OFRT.ORG_FUNC_ROLE_TP_CD
            AND OFRT.ACTV_FLG    = 'Y'
            <isNotNull property="firstOrgCd">
            AND OFRT.FIRST_ORG_CD     = #firstOrgCd#
            </isNotNull>
            <isEqual property="isSlsRepFlg" compareValue="Y">
            AND OFRT.SLS_REP_FLG = 'Y'
            </isEqual>
    </statement>

    <statement id="getProcTrtyRoleAgs" parameterClass="Map" resultClass="Map">
        SELECT
            PTRA.ACCT_TRTY_ROLE_ASG_PK
            ,PTRA.DS_ACCT_NM
            ,PTRA.DS_ACCT_NUM
            ,PTRA.LOC_NUM
            ,PTRA.BILL_TO_CUST_CD
            ,PTRA.SHIP_TO_CUST_CD
            ,PTRA.DS_ACCT_TP_CD
            ,PTRA.DS_ACCT_CLS_CD
            ,PTRA.FIRST_DS_ACCT_GRP_TP_CD
            ,PTRA.SCD_DS_ACCT_GRP_TP_CD
            ,PTRA.THIRD_DS_ACCT_GRP_TP_CD
            ,PTRA.FRTH_DS_ACCT_GRP_TP_CD
            ,PTRA.FIFTH_DS_ACCT_GRP_TP_CD
            ,PTRA.INDY_TP_CD
            ,PTRA.FIRST_LINE_ADDR
            ,PTRA.SCD_LINE_ADDR
            ,PTRA.THIRD_LINE_ADDR
            ,PTRA.FRTH_LINE_ADDR
            ,PTRA.CTY_ADDR
            ,PTRA.ST_CD
            ,PTRA.PROV_NM
            ,PTRA.CNTY_NM
            ,PTRA.POST_CD
            ,PTRA.LINE_BIZ_TP_CD
            ,PTRA.DS_CUST_SIC_CD
            ,RC.ASG_TRTY_ATTRB_CD
            ,RC.LINE_BIZ_ROLE_TP_CD
        FROM
            PROS_TRTY_ROLE_ASG PTRA
            ,(SELECT DISTINCT
                RRD.LINE_BIZ_ROLE_TP_CD
                ,RT.LINE_BIZ_ROLE_TP_NM
                ,RRD.ASG_TRTY_ATTRB_CD
            FROM
                LINE_BIZ_ROLE_RANK_DECN RRD
                ,LINE_BIZ_ROLE_TP RT
            WHERE
                    RRD.GLBL_CMPY_CD = #glblCmpyCd#
                AND RRD.EZCANCELFLAG = '0'
                AND RRD.ASG_TRTY_ATTRB_CD = #attrbCd#

                AND RRD.GLBL_CMPY_CD = RT.GLBL_CMPY_CD
                AND RRD.EZCANCELFLAG = RT.EZCANCELFLAG
                AND RRD.LINE_BIZ_ROLE_TP_CD = RT.LINE_BIZ_ROLE_TP_CD
            ORDER BY
                RRD.ASG_TRTY_ATTRB_CD
            ) RC
        WHERE
                PTRA.GLBL_CMPY_CD = #glblCmpyCd#
            AND PTRA.EZCANCELFLAG = '0'
            AND PTRA.DS_ACCT_NUM  = #dsAcctNum#
            AND PTRA.LOC_NUM      = #locNum#
            AND PTRA.ORG_CD       = #orgCd#
            AND PTRA.LINE_BIZ_ROLE_TP_CD = RC.LINE_BIZ_ROLE_TP_CD
    </statement>

    <statement id="getAcctForNewMode" parameterClass="Map" resultClass="Map">
        WITH ACCT_GRP AS (
               SELECT 
                ROWNUMBER
              , CASE AG.ROWNUMBER WHEN #rowNum_1# THEN AG.DS_ACCT_GRP_CD ELSE NULL END AS FIRST_DS_ACCT_GRP_TP
              , CASE AG.ROWNUMBER WHEN #rowNum_2# THEN AG.DS_ACCT_GRP_CD ELSE NULL END AS SCD_DS_ACCT_GRP_TP
              , CASE AG.ROWNUMBER WHEN #rowNum_3# THEN AG.DS_ACCT_GRP_CD ELSE NULL END AS THIRD_DS_ACCT_GRP_TP
              , CASE AG.ROWNUMBER WHEN #rowNum_4# THEN AG.DS_ACCT_GRP_CD ELSE NULL END AS FRTH_DS_ACCT_GRP_TP
              , CASE AG.ROWNUMBER WHEN #rowNum_5# THEN AG.DS_ACCT_GRP_CD ELSE NULL END AS FIFTH_DS_ACCT_GRP_TP
               FROM
                 (
                    SELECT 
                       ROW_NUMBER() OVER (ORDER BY ASG.DS_ACCT_GRP_ASG_PK) AS ROWNUMBER
                     , ASG.DS_ACCT_GRP_CD
                    FROM
                       DS_ACCT_GRP_ASG ASG
                    WHERE
                         ASG.GLBL_CMPY_CD                  =   #glblCmpyCd#
                    AND  ASG.DS_ACCT_NUM                   =   #dsAcctNum#
                    AND  ASG.EFF_FROM_DT               &lt;=   #slsDt#
                    AND  NVL(ASG.EFF_THRU_DT, #maxDt#) &gt;=   #slsDt#
                    AND  ASG.EZCANCELFLAG                  =   0
                    ORDER BY
                        ASG.DS_ACCT_GRP_ASG_PK
                  )  AG
        )

        SELECT
            <isEqual property="acctFlag" compareValue="Y">
              CUST.SELL_TO_CUST_CD DS_ACCT_NUM
            , LOC.LOC_NUM
            </isEqual>
            <isNotEqual property="acctFlag" compareValue="Y">
              CUST.DS_ACCT_NUM
            , CUST.LOC_NUM
            </isNotEqual>
            , CUST.DS_ACCT_NM
            , BTC.BILL_TO_CUST_CD
            , STC.SHIP_TO_CUST_CD
            , CUST.DS_ACCT_TP_CD
            , CUST.DS_ACCT_CLS_CD
            , PTY.INDY_TP_CD
            , PTY.FIRST_LINE_ADDR
            , PTY.SCD_LINE_ADDR
            , PTY.THIRD_LINE_ADDR
            , PTY.FRTH_LINE_ADDR
            , PTY.CTY_ADDR
            , PTY.ST_CD
            , PTY.PROV_NM
            , CN.CNTY_NM
            , PTY.POST_CD
            , PTY.DS_CUST_SIC_CD
            , BIZ_TP.LINE_BIZ_TP_CD
            , DECN.LINE_BIZ_ROLE_TP_CD
            , (SELECT AG.FIRST_DS_ACCT_GRP_TP FROM ACCT_GRP AG WHERE ROWNUMBER = #rowNum_1#)  AS  FIRST_DS_ACCT_GRP_TP
            , (SELECT AG.SCD_DS_ACCT_GRP_TP   FROM ACCT_GRP AG WHERE ROWNUMBER = #rowNum_2#)  AS  SCD_DS_ACCT_GRP_TP
            , (SELECT AG.THIRD_DS_ACCT_GRP_TP FROM ACCT_GRP AG WHERE ROWNUMBER = #rowNum_3#)  AS  THIRD_DS_ACCT_GRP_TP
            , (SELECT AG.FRTH_DS_ACCT_GRP_TP  FROM ACCT_GRP AG WHERE ROWNUMBER = #rowNum_4#)  AS  FRTH_DS_ACCT_GRP_TP
            , (SELECT AG.FIFTH_DS_ACCT_GRP_TP FROM ACCT_GRP AG WHERE ROWNUMBER = #rowNum_5#)  AS  FIFTH_DS_ACCT_GRP_TP
        FROM
            <isEqual property="acctFlag" compareValue="Y">
              SELL_TO_CUST CUST
            , ACCT_LOC LOC
            , PTY_LOC_WRK PTY
            </isEqual>
            <isNotEqual property="acctFlag" compareValue="Y">
              DS_ACCT_PROS CUST
            , PROS_PTY_LOC_WRK PTY
            </isNotEqual>
            , CNTY CN
            , BILL_TO_CUST BTC
            , SHIP_TO_CUST STC
            , LINE_BIZ_ROLE_RANK_DECN DECN
            , LINE_BIZ_ROLE_TP BIZ_TP

        WHERE
            CUST.GLBL_CMPY_CD          = #glblCmpyCd#
        <isEqual property="acctFlag" compareValue="Y">
        AND CUST.SELL_TO_CUST_CD       = #dsAcctNum#
        AND CUST.GLBL_CMPY_CD          = LOC.GLBL_CMPY_CD
        AND CUST.SELL_TO_CUST_CD       = LOC.DS_ACCT_NUM
        AND LOC.LOC_NUM                = #locNum#
        AND LOC.RGTN_STS_CD            = #rgtnStsCd_P20#
        AND LOC.GLBL_CMPY_CD           = PTY.GLBL_CMPY_CD
        AND LOC.PTY_LOC_PK             = PTY.PTY_LOC_PK
        AND LOC.EZCANCELFLAG           = '0'
        </isEqual>
        <isNotEqual property="acctFlag" compareValue="Y">
        AND CUST.DS_ACCT_NUM           = #dsAcctNum#
        AND CUST.LOC_NUM               = #locNum#
        AND CUST.RGTN_STS_CD           = #rgtnStsCd_P01#
        AND CUST.GLBL_CMPY_CD          = PTY.GLBL_CMPY_CD
        AND CUST.PTY_LOC_PK            = PTY.PTY_LOC_PK
        </isNotEqual>
        AND CUST.DS_ACCT_ACTV_CUST_FLG = #flgOnY#

        AND PTY.RGTN_STS_CD            = #rgtnStsCd_P20#
        AND PTY.GLBL_CMPY_CD           = CN.GLBL_CMPY_CD(+)
        AND PTY.CNTY_PK                = CN.CNTY_PK(+)

        AND PTY.GLBL_CMPY_CD           = BTC.GLBL_CMPY_CD(+)
        AND PTY.LOC_NUM                = BTC.LOC_NUM(+)
        AND BTC.RGTN_STS_CD(+)         = #rgtnStsCd_P20#

        AND PTY.GLBL_CMPY_CD           = STC.GLBL_CMPY_CD(+)
        AND PTY.LOC_NUM                = STC.LOC_NUM(+)
        AND STC.RGTN_STS_CD(+)         = #rgtnStsCd_P20#

        AND PTY.GLBL_CMPY_CD           = DECN.GLBL_CMPY_CD(+)
        AND PTY.LINE_BIZ_TP_CD         = DECN.SRC_LINE_BIZ_TP_CD(+)
        AND CUST.DS_ACCT_TP_CD         = DECN.DS_ACCT_TP_CD(+)
        AND DECN.ASG_TRTY_ATTRB_CD(+)  = #attrbCd#
        AND DECN.TRTY_GRP_TP_CD(+)     = #trtyGrpTpCd#

        AND DECN.GLBL_CMPY_CD          = BIZ_TP.GLBL_CMPY_CD(+)
        AND DECN.LINE_BIZ_ROLE_TP_CD   = BIZ_TP.LINE_BIZ_ROLE_TP_CD(+)

        AND CUST.EZCANCELFLAG          = '0'
        AND PTY.EZCANCELFLAG           = '0'
        AND CN.EZCANCELFLAG(+)         = '0'
        AND STC.EZCANCELFLAG(+)        = '0'
        AND DECN.EZCANCELFLAG(+)       = '0'
        AND BIZ_TP.EZCANCELFLAG(+)     = '0'
    </statement>

    <statement id="getCountTerritoryRule" parameterClass="Map" resultClass="Integer">
        SELECT
                  COUNT(TR.GLBL_CMPY_CD)    CNT
            FROM
                TRTY_RULE TR
            WHERE
                TR.GLBL_CMPY_CD             = #glblCmpyCd#
                AND TR.TRTY_RULE_TP_CD      = #trtyRuleTpCd#
                AND TR.ORG_STRU_TP_CD       = #orgStruTpCd#
                AND TR.EFF_FROM_DT         &lt;= #slsDt#
                AND (
                    TR.EFF_THRU_DT         &gt;= #slsDt#
                    OR TR.EFF_THRU_DT      IS NULL
                )
                AND TR.TRTY_RULE_FROM_VAL_TXT = #trtyRuleFromValTxt#    -- locNum
                AND TR.ORG_CD                 = #orgCd#
                AND TR.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getCountTerritoryRuleLogicNotOR" parameterClass="Map" resultClass="Integer">
        SELECT
                  COUNT(TR.GLBL_CMPY_CD)    CNT
            FROM
                TRTY_RULE TR 
            WHERE
                TR.GLBL_CMPY_CD                 = #glblCmpyCd#
                AND TR.ORG_CD                   = #orgCd#
                AND TR.ORG_STRU_TP_CD           = #orgStruTpCd#
                AND TR.EFF_FROM_DT             &lt;= #slsDt#
                AND ( 
                    TR.EFF_THRU_DT             &gt;= #slsDt#
                    OR TR.EFF_THRU_DT          IS NULL
                ) 
                AND (
                    TR.TRTY_RULE_TP_CD          != #trtyRuleTpCd#
                    OR TR.TRTY_RULE_LOGIC_TP_CD != #trtyRuleLogicTpCd#
                )
                AND TR.EZCANCELFLAG             = '0'
    </statement>

    <statement id="getOverlapPostalCode" parameterClass="Map" resultClass="Integer">
        SELECT
               COUNT(TR.TRTY_RULE_PK) CNT
        FROM
               TRTY_RULE TR
        WHERE
               TR.GLBL_CMPY_CD          = #glblCmpyCd#
           AND TR.EFF_FROM_DT       &lt;= #slsDt#
           AND (
               TR.EFF_THRU_DT       &gt;= #slsDt#
            OR TR.EFF_THRU_DT          IS NULL
           )
           AND TR.EZCANCELFLAG          = '0'

           AND TR.ORG_CD                = #orgCd#
           AND TR.ORG_STRU_TP_CD        = #orgStruTpCd#
           AND TR.TRTY_RULE_TP_CD       = #trtyRuleTpCd#
           AND TR.TRTY_RULE_LOGIC_TP_CD = #trtyRuleLogicTpCd#

           AND (
               (TR.TRTY_RULE_OPRD_TP_CD = #trtyRuleOprdTpCd_Eq#
                  AND TR.TRTY_RULE_FROM_VAL_TXT = #postCd#)

            OR (TR.TRTY_RULE_OPRD_TP_CD = #trtyRuleOprdTpCd_Bw#
                  AND #postCd# BETWEEN TR.TRTY_RULE_FROM_VAL_TXT AND TR.TRTY_RULE_THRU_VAL_TXT)
           )
    </statement>

    <statement id="countProsTrtyRoleAsg" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(PTRA.ACCT_TRTY_ROLE_ASG_PK)
        FROM
            PROS_TRTY_ROLE_ASG PTRA
        WHERE
                PTRA.GLBL_CMPY_CD = #glblCmpyCd#
            AND PTRA.EZCANCELFLAG = '0'
            AND PTRA.DS_ACCT_NUM  = #dsAcctNum#
            AND PTRA.LOC_NUM      = #locNum#
            AND PTRA.ORG_CD       = #orgCd#
            AND PTRA.DS_ACCT_NM   = #dsAcctNm#
    </statement>
</sqlMap>
