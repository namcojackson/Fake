<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NPAL1530Query">
    <typeAlias alias="NPAL1070CMsg" type="business.blap.NPAL1070.NPAL1070CMsg" />
    <typeAlias alias="NPAL1070SMsg" type="business.blap.NPAL1070.NPAL1070SMsg" />

    <statement id="getPlanName" parameterClass="Map"
        resultClass="String">
        SELECT MRP_PLN_NM
        FROM   MRP_INFO
        WHERE  GLBL_CMPY_CD         = #cMsg.glblCmpyCd#
        AND    EZCANCELFLAG         = '0'
        AND    MRP_PLN_NM           = #cMsg.mrpPlnNm#
        AND    MRP_INFO_RGTN_STS_CD = #rgtnStsCd#
        AND    MRP_ENBL_FLG         = #mrpEnblFlg#
        AND    ROWNUM               = 1
    </statement>
    
    <statement id="getWarehouseAndSubWarehouse" parameterClass="Map"
        resultClass="String">
        SELECT RTL_WH_CD,RTL_SWH_CD
        FROM   MRP_INFO
        WHERE  GLBL_CMPY_CD         = #cMsg.glblCmpyCd#
        AND    EZCANCELFLAG         = '0'
        AND    RTL_WH_CD            = #cMsg.rtlWhCd#
        AND    RTL_SWH_CD           = #cMsg.rtlSwhCd#
        AND    MRP_INFO_RGTN_STS_CD = #rgtnStsCd#
        AND    MRP_ENBL_FLG         = #mrpEnblFlg#
        AND    ROWNUM               = 1 
    </statement>

    <statement id="getMrpRunStatus" parameterClass="Map"
        resultClass="String">
        SELECT MI.MRP_PLN_NM
        FROM   MRP_INFO    MI
              ,MRP_RUN_PRM MR
        WHERE  MI.GLBL_CMPY_CD   = MR.GLBL_CMPY_CD
        AND    MI.MRP_RUN_PRM_PK = MR.MRP_RUN_PRM_PK
        AND    MI.EZCANCELFLAG   = '0'
        AND    MR.EZCANCELFLAG   = '0'
        AND    MI.GLBL_CMPY_CD   = #cMsg.glblCmpyCd#
        <isNotNull property="cMsg.mrpPlnNm">
        AND    MI.MRP_PLN_NM        = #cMsg.mrpPlnNm#
        </isNotNull>
        <isNotNull property="cMsg.rtlWhCd">
        AND    MI.RTL_WH_CD      = #cMsg.rtlWhCd#
        </isNotNull>
        <isNotNull property="cMsg.rtlSwhCd">
        AND    MI.RTL_SWH_CD     = #cMsg.rtlSwhCd#
        </isNotNull>
        AND    MI.MRP_ENBL_FLG   = #mrpEnblFlg#
        AND    MI.MRP_INFO_RGTN_STS_CD = #rgtnStsCd#
        AND    MR.MRP_RUN_STS_CD IN
            <iterate property="mrpRunStsCdList" var="mrpRunStsCd[]" open="(" close=")" conjunction=",">
               #mrpRunStsCd[]#
            </iterate>
    </statement>

    <statement id="getMrpInfoPlanWhSwh" parameterClass="Map" resultClass="Map">
        SELECT  DISTINCT
            MI.MRP_PLN_NM
           ,MI.RTL_WH_CD
           ,MI.RTL_SWH_CD
        FROM
            MRP_INFO MI
        WHERE
            MI.GLBL_CMPY_CD   = #cMsg.glblCmpyCd#
        AND MI.MRP_ENBL_FLG   = #mrpEnblFlg#
        AND MI.MRP_INFO_RGTN_STS_CD = #rgtnStsCd#
        <isNotNull property="cMsg.mrpPlnNm">
        AND MI.MRP_PLN_NM = #cMsg.mrpPlnNm#
        </isNotNull>
        <isNotNull property="cMsg.rtlWhCd">
        AND MI.RTL_WH_CD  = #cMsg.rtlWhCd#
        </isNotNull>
        <isNotNull property="cMsg.rtlSwhCd">
        AND MI.RTL_SWH_CD = #cMsg.rtlSwhCd# 
        </isNotNull>
        AND MI.EZCANCELFLAG = '0'
        ORDER BY
            MI.RTL_WH_CD
           ,MI.RTL_SWH_CD
           ,MI.MRP_PLN_NM
    </statement>
</sqlMap>