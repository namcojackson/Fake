<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NWAL1770QueryForSalesCredit">

    <statement id="getSlsRepInfo" parameterClass="Map" resultClass="Map">
        SELECT
            TOC.TOC_NM           AS TOC_NM
           ,CB.COA_BR_CD         AS COA_BR_CD
           ,CB.COA_BR_DESC_TXT   AS COA_BR_DESC_TXT
           ,CE.COA_EXTN_CD       AS COA_EXTN_CD
           ,CE.COA_EXTN_DESC_TXT AS COA_EXTN_DESC_TXT
           ,(CASE
                 WHEN CB.COA_BR_CD IS NOT NULL
                 THEN CB.COA_BR_CD || ':' || CB.COA_BR_DESC_TXT
             END) AS COA_BR_ITEM
           ,(CASE
                 WHEN CE.COA_EXTN_CD IS NOT NULL
                 THEN CE.COA_EXTN_CD || ':' || CE.COA_EXTN_DESC_TXT
             END) AS COA_EXTN_ITEM
            ,SP.PSN_NUM         AS PSN_NUM
        FROM
            TOC      TOC
           ,COA_BR   CB
           ,COA_EXTN CE
           ,ORG_FUNC_ASG OFA
           ,S21_PSN  SP
           ,S21_ORG          SO  <!-- 2016/10/24 S21_NA#14607 Add -->
        WHERE
            TOC.GLBL_CMPY_CD     = #glblCmpyCd#
            AND TOC.TOC_CD       = #slsRepTocCd#
            AND TOC.EZCANCELFLAG = '0'

            AND TOC.GLBL_CMPY_CD    = CB.GLBL_CMPY_CD (+)
            AND TOC.COA_BR_CD       = CB.COA_BR_CD (+)
            AND CB.EZCANCELFLAG (+) = '0'

            AND TOC.GLBL_CMPY_CD    = CE.GLBL_CMPY_CD (+)
            AND TOC.COA_EXTN_CD     = CE.COA_EXTN_CD (+)
            AND CE.EZCANCELFLAG (+) = '0'

            AND TOC.GLBL_CMPY_CD    = OFA.GLBL_CMPY_CD (+)
            AND TOC.TOC_CD          = OFA.TOC_CD (+)
            AND OFA.EZCANCELFLAG (+) = '0'

            AND OFA.GLBL_CMPY_CD    = SP.GLBL_CMPY_CD (+)
            AND OFA.PSN_CD          = SP.PSN_CD (+)
            AND SP.EZCANCELFLAG (+) = '0'

            <!-- 2016/10/24 S21_NA#14607 Add Start -->
            AND TOC.GLBL_CMPY_CD    = SO.GLBL_CMPY_CD
            AND TOC.TOC_CD          = SO.TOC_CD
            AND SO.RGTN_STS_CD     != #rgtnStsCd#
            AND SO.EZCANCELFLAG     = '0'
            <!-- 2016/10/24 S21_NA#14607 Add Endt -->
    </statement>

    <statement id="getSlsRepInfoList" parameterClass="Map" resultClass="Map">
        SELECT 
            SP.PSN_NUM           AS PSN_NUM
           ,TOC.TOC_CD           AS TOC_CD
           ,TOC.TOC_NM           AS TOC_NM
           ,CB.COA_BR_CD         AS COA_BR_CD
           ,CB.COA_BR_DESC_TXT   AS COA_BR_DESC_TXT
           ,CE.COA_EXTN_CD       AS COA_EXTN_CD
           ,CE.COA_EXTN_DESC_TXT AS COA_EXTN_DESC_TXT
           ,(CASE
                  WHEN CB.COA_BR_CD IS NOT NULL
                  THEN CB.COA_BR_CD || ':' || CB.COA_BR_DESC_TXT
             END) AS COA_BR_ITEM
           ,(CASE
                  WHEN CE.COA_EXTN_CD IS NOT NULL
                  THEN CE.COA_EXTN_CD || ':' || CE.COA_EXTN_DESC_TXT
             END) AS COA_EXTN_ITEM
        FROM 
            TOC              TOC
           ,ORG_FUNC_ROLE_TP OFRT
           ,BIZ_AREA_ORG     BA
           ,ORG_FUNC_ASG     OFA
           ,S21_PSN          SP
           ,COA_BR           CB
           ,COA_EXTN         CE
           ,S21_ORG          SO  <!-- 2016/10/24 S21_NA#14607 Add -->
        WHERE 
            TOC.GLBL_CMPY_CD     = #glblCmpyCd#
            <isNotNull property="slsRepTocNm">
                AND UPPER(TOC.TOC_NM)   LIKE UPPER(#slsRepTocNm#) <!-- S21_NA#13627 MOD -->
            </isNotNull>
            AND TOC.EZCANCELFLAG = '0'

            AND TOC.GLBL_CMPY_CD        = OFRT.GLBL_CMPY_CD
            AND TOC.ORG_FUNC_ROLE_TP_CD = OFRT.ORG_FUNC_ROLE_TP_CD
            AND OFRT.SLS_REP_FLG        = #slsRepFlg#
            AND OFRT.EZCANCELFLAG       = '0'

            AND OFRT.GLBL_CMPY_CD = BA.GLBL_CMPY_CD
            AND OFRT.FIRST_ORG_CD = BA.BIZ_AREA_ORG_CD
            AND BA.SLS_FLG        = #slsRepFlg#
            AND BA.ORG_STRU_TP_CD = #orgStruTpCd#
            AND BA.EZCANCELFLAG   = '0'

            AND TOC.GLBL_CMPY_CD = OFA.GLBL_CMPY_CD
            AND TOC.TOC_CD       = OFA.TOC_CD
            AND OFA.EZCANCELFLAG = '0'

            AND OFA.GLBL_CMPY_CD = SP.GLBL_CMPY_CD
            AND OFA.PSN_CD       = SP.PSN_CD
            <isNotNull property="psnNum">
                AND SP.PSN_NUM    LIKE #psnNum#
            </isNotNull>
            AND SP.EFF_FROM_DT   &lt;= #slsDt#
            AND (SP.EFF_THRU_DT  &gt;= #slsDt# OR SP.EFF_THRU_DT IS NULL)
            AND SP.EZCANCELFLAG       = '0'

            AND TOC.GLBL_CMPY_CD    = CB.GLBL_CMPY_CD (+)
            AND TOC.COA_BR_CD       = CB.COA_BR_CD (+)
            AND CB.EZCANCELFLAG (+) = '0'

            AND TOC.GLBL_CMPY_CD    = CE.GLBL_CMPY_CD (+)
            AND TOC.COA_EXTN_CD     = CE.COA_EXTN_CD (+)
            AND CE.EZCANCELFLAG (+) = '0'

            <!-- 2016/10/24 S21_NA#14607 Add Start -->
            AND TOC.GLBL_CMPY_CD    = SO.GLBL_CMPY_CD
            AND TOC.TOC_CD          = SO.TOC_CD
            AND SO.RGTN_STS_CD     != #rgtnStsCd#
            AND SO.EZCANCELFLAG     = '0'
            <!-- 2016/10/24 S21_NA#14607 Add Endt -->
            AND ROWNUM          &lt;= 2  <!-- 2018/10/26 QC#28870 Add -->
    </statement>

</sqlMap>
