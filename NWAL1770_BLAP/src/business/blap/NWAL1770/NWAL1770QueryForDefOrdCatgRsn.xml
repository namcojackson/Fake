<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NWAL1770QueryForDefOrdCatgRsn">

    <statement id="getDefOrdCatgRsn" parameterClass="Map" resultClass="Map">
        SELECT
            CASE USR_ID
                WHEN '*' THEN NULL
                ELSE USR_ID
            END USR_ID
           ,CASE ROLE_NM
                WHEN '*' THEN NULL
                ELSE ROLE_NM
            END ROLE_NM
           ,DEF_CATG_CD
           ,DEF_RSN_CD
        FROM
            DEF_ORD_CATG_RSN
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND EZCANCELFLAG = '0'
            AND USR_ID = #usrId1#
            <iterate property="roleIdList1" var="roleId[]" open="AND ROLE_NM IN (" close=")" conjunction=",">
                #roleId[]#
            </iterate>
            AND SCR_ID = #scrId#
        UNION ALL
        SELECT
            CASE USR_ID
                WHEN '*' THEN NULL
                ELSE USR_ID
            END USR_ID
           ,CASE ROLE_NM
                WHEN '*' THEN NULL
                ELSE ROLE_NM
            END ROLE_NM
           ,DEF_CATG_CD
           ,DEF_RSN_CD
        FROM
            DEF_ORD_CATG_RSN
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND EZCANCELFLAG = '0'
            AND USR_ID = #usrId2#
            <iterate property="roleIdList2" var="roleId[]" open="AND ROLE_NM IN (" close=")" conjunction=",">
                #roleId[]#
            </iterate>
            AND SCR_ID = #scrId#
        ORDER BY
            USR_ID  ASC
           ,ROLE_NM ASC
    </statement>

    <statement id="getDsOrdCatg" parameterClass="Map" resultClass="Map">
        SELECT
            DOC.DS_ORD_CATG_CD       AS DS_ORD_CATG_CD
           ,DOC.DS_ORD_CATG_DESC_TXT AS DS_ORD_CATG_DESC_TXT
        FROM
            DS_ORD_CATG DOC
        WHERE
            DOC.DS_ORD_CATG_CD IN
            (
            SELECT
                DOT.DS_ORD_CATG_CD AS DS_ORD_CATG_CD
            FROM
                AVAL_DS_ORD_TP_APP_ID AD
               ,DS_ORD_TP             DOT
               ,DS_ORD_TP_PROC_DFN    DOTPD
            WHERE
                    AD.GLBL_CMPY_CD    = #glblCmpyCd#
                AND AD.BIZ_APP_ID      = #scrId#
                AND AD.EZCANCELFLAG    = '0'
                AND AD.GLBL_CMPY_CD    = DOT.GLBL_CMPY_CD
                AND AD.DS_ORD_TP_CD    = DOT.DS_ORD_TP_CD
                AND DOT.EZCANCELFLAG   = '0'
                AND DOT.GLBL_CMPY_CD   = DOTPD.GLBL_CMPY_CD
                AND DOT.DS_ORD_TP_CD   = DOTPD.DS_ORD_TP_CD
                AND DOTPD.ACTV_FLG     = 'Y'
                AND DOTPD.EZCANCELFLAG = '0'
            GROUP BY
                DOT.DS_ORD_CATG_CD
            ) 
            AND DOC.GLBL_CMPY_CD   = #glblCmpyCd#
            AND DOC.DS_ORD_CATG_CD = #catgCd#
            AND DOC.EZCANCELFLAG   = '0'
    </statement>

</sqlMap>
