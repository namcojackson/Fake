<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWAL1550Query">

    <typeAlias alias="NWAL1550CMsg"    type="business.blap.NWAL1550.NWAL1550CMsg"/>
    <typeAlias alias="NWAL1550_ACMsg"  type="business.blap.NWAL1550.NWAL1550_ACMsg"/>

    <statement id="getOrderInfoAndPricingSummary" parameterClass="Map" resultMap="result.getOrderInfoAndPricingSummary">
        SELECT
             DCV.ORD_HDR_STS_CD            ORD_HDR_STS_CD
            ,DCV.DS_ORD_CATG_DESC_TXT      DS_ORD_CATG_DESC_TXT
            ,DCV.DS_ORD_TP_CD              DS_ORD_TP_CD
            ,DCV.DS_ORD_RSN_CD             DS_ORD_RSN_CD
            ,DCV.CPO_ORD_TS                CPO_ORD_TS
            ,DCV.LINE_DEAL_NET_AMT         LINE_DEAL_NET_AMT
            ,DCV.LINE_DEAL_TAX_AMT         LINE_DEAL_TAX_AMT
            ,DCV.LINE_DEAL_CHRG_AMT        LINE_DEAL_CHRG_AMT
            ,DCV.LINE_DEAL_SUB_TOT_AMT     LINE_DEAL_SUB_TOT_AMT
            ,DCV.CPO_SVC_DEAL_NET_AMT      CPO_SVC_DEAL_NET_AMT
            ,DCV.CPO_SVC_DEAL_TAX_AMT      CPO_SVC_DEAL_TAX_AMT
            ,DCV.CPO_SVC_DEAL_CHRG_AMT     CPO_SVC_DEAL_CHRG_AMT
            ,DCV.CPO_SVC_DEAL_SUB_TOT_AMT  CPO_SVC_DEAL_SUB_TOT_AMT
            ,DCV.RMA_DEAL_NET_AMT          RMA_DEAL_NET_AMT
            ,DCV.RMA_DEAL_TAX_AMT          RMA_DEAL_TAX_AMT
            ,DCV.RMA_DEAL_CHRG_AMT         RMA_DEAL_CHRG_AMT
            ,DCV.RMA_DEAL_SUB_TOT_AMT      RMA_DEAL_SUB_TOT_AMT
            ,DCV.ORD_TOT_DEAL_NET_AMT      ORD_TOT_DEAL_NET_AMT
            ,DCV.ORD_TOT_DEAL_TAX_AMT      ORD_TOT_DEAL_TAX_AMT
            ,DCV.ORD_TOT_DEAL_CHRG_AMT     ORD_TOT_DEAL_CHRG_AMT
            ,DCV.ORD_TOT_DEAL_SUB_TOT_AMT  ORD_TOT_DEAL_SUB_TOT_AMT
            ,DCV.INV_TOT_DEAL_NET_AMT      INV_TOT_DEAL_NET_AMT
            ,DCV.INV_AMT_SLS_PCT           INV_AMT_SLS_PCT
            ,DOT.DS_ORD_TP_NM              DS_ORD_TP_NM
            ,DOR.DS_ORD_RSN_DESC_TXT       DS_ORD_RSN_DESC_TXT
            ,DOS.ORD_HDR_STS_NM            ORD_HDR_STS_DESC_TXT
        FROM 
             CPO_V       DCV
            ,DS_ORD_TP      DOT
            ,DS_ORD_RSN     DOR
            ,DS_ORD_STS_V   DOS
        WHERE
                DCV.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DCV.CPO_ORD_NUM         = #msg.cpoOrdNum#
            AND DCV.EZCANCELFLAG        = '0'
            AND DOT.GLBL_CMPY_CD        = DCV.GLBL_CMPY_CD
            AND DOT.DS_ORD_TP_CD        = DCV.DS_ORD_TP_CD
            AND DOT.EZCANCELFLAG        = '0'
            AND DOR.GLBL_CMPY_CD(+)     = DCV.GLBL_CMPY_CD
            AND DOR.DS_ORD_RSN_CD(+)    = DCV.DS_ORD_RSN_CD
            AND DOR.EZCANCELFLAG(+)     = '0'
            AND DOS.GLBL_CMPY_CD        = DCV.GLBL_CMPY_CD
            AND DOS.CPO_ORD_NUM         = DCV.CPO_ORD_NUM
            AND DOS.EZCANCELFLAG        = '0'
    </statement>
    <resultMap id="result.getOrderInfoAndPricingSummary" class="NWAL1550CMsg">
        <result property="ordHdrStsNm"            column="ORD_HDR_STS_NM"              javaType="EZDCStringItem"/>
        <result property="ordHdrStsDescTxt"       column="ORD_HDR_STS_DESC_TXT"        javaType="EZDCStringItem"/>
        <result property="dsOrdCatgDescTxt"       column="DS_ORD_CATG_DESC_TXT"        javaType="EZDCStringItem"/>
        <result property="dsOrdTpNm"              column="DS_ORD_TP_NM"                javaType="EZDCStringItem"/>
        <result property="dsOrdTpCd"              column="DS_ORD_TP_CD"                javaType="EZDCStringItem"/>
        <result property="dsOrdRsnDescTxt"        column="DS_ORD_RSN_DESC_TXT"         javaType="EZDCStringItem"/>
        <result property="ordDt"                  column="CPO_ORD_TS"                  javaType="EZDCStringItem"/>
        <result property="dsOrdRsnNm"             column="DS_ORD_RSN_NM"               javaType="EZDCStringItem"/>
        <result property="lineDealNetAmt"         column="LINE_DEAL_NET_AMT"           javaType="EZDCBigDecimalItem"/>
        <result property="lineDealTaxAmt"         column="LINE_DEAL_TAX_AMT"           javaType="EZDCBigDecimalItem"/>
        <result property="lineDealChrgAmt"        column="LINE_DEAL_CHRG_AMT"          javaType="EZDCBigDecimalItem"/>
        <result property="lineDealSubTotAmt"      column="LINE_DEAL_SUB_TOT_AMT"       javaType="EZDCBigDecimalItem"/>
        <result property="cpoSvcDealNetAmt"       column="CPO_SVC_DEAL_NET_AMT"        javaType="EZDCBigDecimalItem"/>
        <result property="cpoSvcDealTaxAmt"       column="CPO_SVC_DEAL_TAX_AMT"        javaType="EZDCBigDecimalItem"/>
        <result property="cpoSvcDealChrgAmt"      column="CPO_SVC_DEAL_CHRG_AMT"       javaType="EZDCBigDecimalItem"/>
        <result property="cpoSvcDealSubTotAmt"    column="CPO_SVC_DEAL_SUB_TOT_AMT"    javaType="EZDCBigDecimalItem"/>
        <result property="rmaDealNetAmt"          column="RMA_DEAL_NET_AMT"            javaType="EZDCBigDecimalItem"/>
        <result property="rmaDealTaxAmt"          column="RMA_DEAL_TAX_AMT"            javaType="EZDCBigDecimalItem"/>
        <result property="rmaDealChrgAmt"         column="RMA_DEAL_CHRG_AMT"           javaType="EZDCBigDecimalItem"/>
        <result property="rmaDealSubTotAmt"       column="RMA_DEAL_SUB_TOT_AMT"        javaType="EZDCBigDecimalItem"/>
        <result property="ordTotDealNetAmt"       column="ORD_TOT_DEAL_NET_AMT"        javaType="EZDCBigDecimalItem"/>
        <result property="ordTotDealTaxAmt"       column="ORD_TOT_DEAL_TAX_AMT"        javaType="EZDCBigDecimalItem"/>
        <result property="ordTotDealChrgAmt"      column="ORD_TOT_DEAL_CHRG_AMT"       javaType="EZDCBigDecimalItem"/>
        <result property="ordTotDealSubTotAmt"    column="ORD_TOT_DEAL_SUB_TOT_AMT"    javaType="EZDCBigDecimalItem"/>
        <result property="invTotDealNetAmt"       column="INV_TOT_DEAL_NET_AMT"        javaType="EZDCBigDecimalItem"/>
        <result property="invAmtSlsPct"           column="INV_AMT_SLS_PCT"             javaType="EZDCBigDecimalItem"/>
    </resultMap>
 
    <statement id="getVersionNum" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            DC.DI_CHK_VRSN_NUM         DI_CHK_VRSN_NUM
        FROM
            DS_CPO_DI_CHK_RSLT_HDR DC
        WHERE
                DC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DC.CPO_ORD_NUM         = #msg.cpoOrdNum#
            AND DC.EZCANCELFLAG        = '0'
        ORDER BY
            DI_CHK_VRSN_NUM DESC
    </statement>
    
    <statement id="getDataIntegrityCheckInfo" parameterClass="Map" resultMap="result.getDataIntegrityCheckInfo">
        SELECT
             TO_CHAR(TO_TIMESTAMP( DC.DI_CHK_TS, 'YYYYMMDDHH24MISS') ,'MM/DD/YYYY HH24:MI:SS') AS DI_CHK_TS
            ,DC.DI_CHK_SUBMT_PSN_CD                                    DI_CHK_SUBMT_PSN_CD
            ,DC.DI_JOB_ID                                              DI_JOB_ID
            ,DC.DI_JOB_STS_CD                                          DI_JOB_STS_CD
            ,DC.DS_CPO_DI_CHK_RSLT_HDR_PK                              DS_CPO_DI_CHK_RSLT_HDR_PK
            ,DECODE(PSN.USR_NM, NULL, DC.DI_CHK_SUBMT_PSN_CD, PSN.USR_NM || ':' ||  PSN.FIRST_NM || ' ' || PSN.LAST_NM)  PSN_NM
        FROM
             DS_CPO_DI_CHK_RSLT_HDR  DC
            ,AUTH_PSN                PSN
        WHERE
                DC.GLBL_CMPY_CD     = #glblCmpyCd#
            AND DC.CPO_ORD_NUM      = #msg.cpoOrdNum#
            AND DC.DI_CHK_VRSN_NUM  = #verNum#
            AND PSN.GLBL_CMPY_CD(+) = DC.GLBL_CMPY_CD
            AND PSN.USR_NM(+)       = DC.DI_CHK_SUBMT_PSN_CD
            AND PSN.EZCANCELFLAG(+) = '0'
    </statement>
    <resultMap id="result.getDataIntegrityCheckInfo" class="NWAL1550CMsg">
        <result property="xxDtTm"               column="DI_CHK_TS"                  javaType="EZDCStringItem"/>
        <result property="psnCd"                column="DI_CHK_SUBMT_PSN_CD"        javaType="EZDCStringItem"/>
        <result property="xxPsnNm"              column="PSN_NM"                     javaType="EZDCStringItem"/>
        <result property="diJobId"              column="DI_JOB_ID"                  javaType="EZDCStringItem"/>
        <result property="dsCpoDiChkRsltHdrPk"  column="DS_CPO_DI_CHK_RSLT_HDR_PK"  javaType="EZDCBigDecimalItem"/>
    </resultMap>
    
    <statement id="getDataIntegrityResult" parameterClass="Map" resultMap="result.NWAL1550_ACMsg">
    <!-- MOD Start QC#23263 2017/12/27 ADD DISTINCT -->
        SELECT
              DS_CPO_DI_CHK_RSLT_DTL_PK
            , DI_CHK_CD
            , DI_CHK_LVL_CD
            , DI_CHK_ERR_TXT
            , DI_ERR_ORD_POSN_NUM
            , DI_ERR_CPO_LINE_NUM
            , DI_ERR_CPO_LINE_SUB_NUM
            , DI_CHK_DTL_STS_CD
            , EZUPTIME
            , EZUPTIMEZONE
            , DI_CHK_NM
            , DI_CHK_DTL_STS_NM
            , DI_CHK_LVL_NM
        FROM
            (
                SELECT
                     DISTINCT
                     DTL.DS_CPO_DI_CHK_RSLT_DTL_PK                  DS_CPO_DI_CHK_RSLT_DTL_PK
                    ,DTL.DI_CHK_CD                                  DI_CHK_CD
                    ,DTL.DI_CHK_LVL_CD                              DI_CHK_LVL_CD
                    ,DTL.DI_CHK_ERR_TXT                             DI_CHK_ERR_TXT
                    ,DTL.DI_ERR_ORD_POSN_NUM                        DI_ERR_ORD_POSN_NUM
                    ,DTL.DI_ERR_CPO_LINE_NUM                        DI_ERR_CPO_LINE_NUM
                    ,DTL.DI_ERR_CPO_LINE_SUB_NUM                    DI_ERR_CPO_LINE_SUB_NUM
                    ,DTL.DI_CHK_DTL_STS_CD                          DI_CHK_DTL_STS_CD
                    ,DTL.EZUPTIME                                   EZUPTIME
                    ,DTL.EZUPTIMEZONE                               EZUPTIMEZONE
                    ,MTR.DI_CHK_NM                                  DI_CHK_NM
                    ,STS.DI_CHK_DTL_STS_NM                          DI_CHK_DTL_STS_NM
                    <!-- 2022/09/20 QC#54883 Mod START -->
                    <!--,CASE      DTL.DI_ERR_CONFIG_CATG_CD                                 -->
                    <!--     WHEN  #configCatgCd# THEN  'RMA'                                -->
                    <!--     ELSE  LVL.DI_CHK_LVL_NM     END            DI_CHK_LVL_NM        -->
                    <!-- START 2022/10/24 T.Doi [QC#54883, MOD] -->
                    <!-- ,LVL.DI_CHK_LVL_NM -->
                    ,CASE WHEN DTL.DI_ERR_CONFIG_CATG_CD = 'I' AND DTL.DI_CHK_LVL_CD ='L'
                        THEN 'Line(RMA)'
                    WHEN DTL.DI_ERR_CONFIG_CATG_CD = 'I' AND DTL.DI_CHK_LVL_CD ='C'
                        THEN 'Config(RMA)'
                    ELSE
                        LVL.DI_CHK_LVL_NM     END          DI_CHK_LVL_NM
                    <!-- END 2022/10/24 T.Doi [QC#54883, MOD] -->
                    <!-- 2022/09/20 QC#54883 Mod END -->
                    ,DTL.DI_ERR_CONFIG_CATG_CD
                FROM
                     DS_CPO_DI_CHK_RSLT_DTL  DTL
                    ,DS_CPO_DI_CHK_MSTR      MTR
                    ,DI_CHK_DTL_STS          STS
                    ,DI_CHK_LVL              LVL
                WHERE 
                        DTL.GLBL_CMPY_CD               = #glblCmpyCd#
                    AND DTL.DS_CPO_DI_CHK_RSLT_HDR_PK  = #chkRsltHdrPk#
                    AND DTL.EZCANCELFLAG               = '0'
                    AND MTR.GLBL_CMPY_CD               = DTL.GLBL_CMPY_CD
                    AND MTR.DI_CHK_CD                  = DTL.DI_CHK_CD
                    AND MTR.EZCANCELFLAG               = '0'
                    AND STS.GLBL_CMPY_CD               = DTL.GLBL_CMPY_CD
                    AND STS.DI_CHK_DTL_STS_CD          = DTL.DI_CHK_DTL_STS_CD
                    AND STS.EZCANCELFLAG               = '0'
                    AND LVL.GLBL_CMPY_CD               = DTL.GLBL_CMPY_CD
                    AND LVL.DI_CHK_LVL_CD              = DTL.DI_CHK_LVL_CD
                    AND LVL.EZCANCELFLAG               = '0'
                )
        ORDER BY 
             DI_CHK_DTL_STS_CD        DESC
            ,DI_CHK_LVL_CD            ASC
            ,DI_ERR_CONFIG_CATG_CD    ASC
            <!-- MOD Start QC#8500 2016/05/24 -->
            ,TO_NUMBER(DI_ERR_ORD_POSN_NUM)      ASC
            ,TO_NUMBER(DI_ERR_CPO_LINE_NUM)      ASC
            ,TO_NUMBER(DI_ERR_CPO_LINE_SUB_NUM)  ASC
            <!-- MOD End   QC#8500 2016/05/24 -->
            <!-- 2017/07/24 S21_NA#20041-3 Add Start -->
            ,DI_CHK_CD
            ,DI_CHK_ERR_TXT
            <!-- 2017/07/24 S21_NA#20041-3 Add End -->

    </statement>
    <resultMap id="result.NWAL1550_ACMsg" class="NWAL1550_ACMsg">
        <result property="dsCpoDiChkRsltDtlPk_A"   column="DS_CPO_DI_CHK_RSLT_DTL_PK"   javaType="EZDCBigDecimalItem"/>
        <result property="diChkNm_A"               column="DI_CHK_NM"                   javaType="EZDCStringItem"/>
        <result property="diChkCd_A"               column="DI_CHK_CD"                   javaType="EZDCStringItem"/>
        <result property="diChkLvlCd_A"            column="DI_CHK_LVL_CD"               javaType="EZDCStringItem"/>
        <result property="diChkLvlNm_A"            column="DI_CHK_LVL_NM"               javaType="EZDCStringItem"/>
        <result property="diErrOrdPosnNum_A"       column="DI_ERR_ORD_POSN_NUM"         javaType="EZDCStringItem"/>
        <result property="diErrCpoLineNum_A"       column="DI_ERR_CPO_LINE_NUM"         javaType="EZDCStringItem"/>
        <result property="diErrCpoLineSubNum_A"    column="DI_ERR_CPO_LINE_SUB_NUM"     javaType="EZDCStringItem"/>
        <result property="diChkErrTxt_A"           column="DI_CHK_ERR_TXT"              javaType="EZDCStringItem"/>
        <result property="diChkDtlStsCd_A"         column="DI_CHK_DTL_STS_CD"           javaType="EZDCStringItem"/>
        <result property="diChkDtlStsNm_A"         column="DI_CHK_DTL_STS_NM"           javaType="EZDCStringItem"/>
        <result property="ezUpTime_A"              column="EZUPTIME"                    javaType="EZDCStringItem"/>
        <result property="ezUpTimeZone_A"          column="EZUPTIMEZONE"                javaType="EZDCStringItem"/>
    </resultMap>
    
    <statement id="getCpoDtlV" parameterClass="Map" resultClass="String">
        SELECT
            CPO_ORD_TS            CPO_ORD_TS
        FROM 
            CPO_V              DCV
        WHERE
            DCV.GLBL_CMPY_CD      = #glblCmpyCd#
            AND DCV.CPO_ORD_NUM   = #msg.cpoOrdNum#
           <isNotNull property="openFlg">
            AND DCV.OPEN_FLG      &lt;&gt; #openFlg#
           </isNotNull>
            AND DCV.EZCANCELFLAG  = '0'
    </statement>
    
    <statement id="getRsltHdrByVerNum" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)                  COUNT
        FROM 
             CPO                   DC
            ,DS_CPO_DI_CHK_RSLT_HDR   HDR
        WHERE
                DC.GLBL_CMPY_CD      = #glblCmpyCd#
            AND DC.CPO_ORD_NUM       = #msg.cpoOrdNum#
            AND DC.EZCANCELFLAG      = '0'
            AND HDR.GLBL_CMPY_CD     = DC.GLBL_CMPY_CD
            AND HDR.CPO_ORD_NUM      = DC.CPO_ORD_NUM
            AND HDR.CPO_UPD_VRSN_NUM = DC.CPO_UPD_VRSN_NUM
            AND HDR.EZCANCELFLAG     = '0'
    </statement>
    
    <statement id="getRsltHdrMaxVerNum" parameterClass="Map" resultClass="Map">
        SELECT 
             DS_CPO_DI_CHK_RSLT_HDR_PK  DS_CPO_DI_CHK_RSLT_HDR_PK
            ,MAX_NUM                    MAX_NUM
        FROM 
             DS_CPO_DI_CHK_RSLT_HDR     HDR
            ,(
            SELECT
                MAX(DI_CHK_VRSN_NUM)    MAX_NUM
            FROM 
                DS_CPO_DI_CHK_RSLT_HDR  HDR
            WHERE
                    HDR.GLBL_CMPY_CD   = #glblCmpyCd#
                AND HDR.CPO_ORD_NUM    = #msg.cpoOrdNum#
                AND HDR.EZCANCELFLAG   = '0'
            ) MN
        WHERE 
            HDR.GLBL_CMPY_CD         = #glblCmpyCd#
            AND HDR.CPO_ORD_NUM      = #msg.cpoOrdNum#
            AND HDR.EZCANCELFLAG     = '0'
            AND HDR.DI_CHK_VRSN_NUM  = MN.MAX_NUM
    </statement>
    
    <statement id="getRsltDtlStsCd" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(*)                          COUNT
        FROM
            DS_CPO_DI_CHK_RSLT_DTL            DTL
        WHERE
                DTL.GLBL_CMPY_CD              = #glblCmpyCd#
            AND DTL.DS_CPO_DI_CHK_RSLT_HDR_PK = #dsCpoDiChkRsltHdrPk#
            AND DTL.DI_CHK_DTL_STS_CD         &lt;&gt; #diChkDtlStsCd#
            AND DTL.EZCANCELFLAG              = '0'
    </statement>
    
    <statement id="getHldPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            H.HLD_PK             HLD_PK
        FROM 
            HLD H
        WHERE 
                H.GLBL_CMPY_CD = #glblCmpyCd#
            AND H.CPO_ORD_NUM  = #msg.cpoOrdNum#
            AND H.HLD_RSN_CD   = #hldRsnCd#
            AND H.REL_FLG      = #relFlg#
            AND H.EZCANCELFLAG = '0'
    </statement>
</sqlMap>
