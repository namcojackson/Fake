<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSBB039001">
    <statement id="getTargetData" parameterClass="Map" resultClass="Map">
        SELECT
             CPO_ORD_NUM
             ,SVC_MACH_MSTR_PK
        FROM
            (
        <!-- Serialize Item -->
        SELECT
             DCD.CPO_ORD_NUM                    AS CPO_ORD_NUM
             ,SMM.SVC_MACH_MSTR_PK               AS SVC_MACH_MSTR_PK
             ,ROW_NUMBER() OVER (PARTITION BY SMM.SVC_MACH_MSTR_PK ORDER BY SCMD.RGTN_CONFIG_DT DESC, SCMD.EZINTIME DESC) AS CONFIG_ROW_NUMBER
        FROM
                 SHPG_PLN            SP
                ,SHPG_ORD_DTL        SOD
                ,SVC_MACH_MSTR       SMM
                ,SVC_CONFIG_MSTR     SCM
                ,DS_MDL              DM
                ,CPO                 CPO
                ,CPO_DTL             DCD
                ,MDSE                MDSE
                ,SHPG_ORD            SOS
                ,DS_CPO_ISTL_INFO    DCII1
                ,SVC_ISTL_RULE       SIR1
                ,DS_CPO_ISTL_INFO    DCII2
                ,SVC_ISTL_RULE       SIR2
                ,SVC_ISTL_RULE       SIR
<!-- START 2019/06/17 W.Honda [QC#50842,DEL] -->
                <!-- ,ORD_CATG_BIZ_CTX    OCBCS -->
<!-- END 2019/06/17 W.Honda [QC#50842,DEL] -->
                ,SVC_CONFIG_MSTR_DTL SCMD
                ,ORD_LINE_SRC        OLS
                ,SHIP_TO_CUST        STC
        WHERE
                 SP.GLBL_CMPY_CD                 = #glblCmpyCd#
                 AND (
                          (    SP.SHPG_STS_CD    = #shpgStsCdArv#
                           AND SP.ACTL_ARV_DT   &lt;= #actlArvDt#
                      )
                      OR  (     SP.SHPG_STS_CD    = #shpgStsCdShip#
                            AND SP.ACTL_SHIP_DT  &lt;= #actlShipDt#
                      )
                 )
                 AND SP.EZCANCELFLAG             = '0'
                 AND SP.GLBL_CMPY_CD             = SOD.GLBL_CMPY_CD
                 AND SP.SHPG_PLN_NUM             = SOD.SHPG_PLN_NUM
                 AND SOD.EZCANCELFLAG            = '0'
                 AND SOD.GLBL_CMPY_CD            = SMM.GLBL_CMPY_CD
                 AND SOD.SHPG_PLN_NUM            = SMM.SHPG_PLN_NUM
                 AND SOD.SO_NUM                  = SMM.SO_NUM
                 AND SOD.SO_SLP_NUM              = SMM.SO_SLP_NUM
                 AND SMM.SVC_MACH_MSTR_STS_CD    = #svcMachMstrSts#
                 AND SMM.SVC_MACH_TP_CD          = #svcMachTpCd#
                 AND SMM.EZCANCELFLAG            = '0'
                 AND SMM.GLBL_CMPY_CD            = SCM.GLBL_CMPY_CD (+)
                 AND SMM.SVC_CONFIG_MSTR_PK      = SCM.SVC_CONFIG_MSTR_PK (+)
                 AND SCM.EZCANCELFLAG (+)        = '0'
                 AND SCM.GLBL_CMPY_CD            = DM.GLBL_CMPY_CD (+)
                 AND SCM.MDL_ID                  = DM.MDL_ID (+)
                 AND DM.SVC_ISTL_CALL_GRP_NUM(+) IS NOT NULL
                 AND DM.EZCANCELFLAG (+)         = '0'
                 AND SP.GLBL_CMPY_CD             = CPO.GLBL_CMPY_CD
                 AND SP.TRX_HDR_NUM              = CPO.CPO_ORD_NUM
                 AND CPO.EZCANCELFLAG            = '0'
                 AND SP.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
                 AND SP.TRX_HDR_NUM              = DCD.CPO_ORD_NUM
                 AND SP.TRX_LINE_NUM             = DCD.CPO_DTL_LINE_NUM
                 AND SP.TRX_LINE_SUB_NUM         = DCD.CPO_DTL_LINE_SUB_NUM
                 AND DCD.EZCANCELFLAG            = '0'
                 AND SMM.GLBL_CMPY_CD            = MDSE.GLBL_CMPY_CD
                 AND SMM.MDSE_CD                 = MDSE.MDSE_CD
                 AND MDSE.RGTN_STS_CD            = #rgtnStsCd#
                 AND MDSE.INVTY_CTRL_FLG         = 'Y'
                 AND MDSE.EZCANCELFLAG           = '0'
                 AND SOD.GLBL_CMPY_CD            = SOS.GLBL_CMPY_CD (+)
                 AND SOD.SO_NUM                  = SOS.SO_NUM (+)
                 AND SOS.EZCANCELFLAG (+)        = '0'
                 AND DCD.GLBL_CMPY_CD            = DCII1.GLBL_CMPY_CD (+)
                 AND DCD.CPO_ORD_NUM             = DCII1.CPO_ORD_NUM (+)
                 AND DCD.DS_CPO_CONFIG_PK        = DCII1.DS_CPO_CONFIG_PK (+)
                 AND DCII1.EZCANCELFLAG (+)      = '0'
                 AND DCII1.GLBL_CMPY_CD          = SIR1.GLBL_CMPY_CD (+)
                 AND DCII1.SVC_ISTL_RULE_NUM     = SIR1.SVC_ISTL_RULE_NUM (+)
                 AND SIR1.EZCANCELFLAG (+)       = '0'
                 AND DCD.GLBL_CMPY_CD            = DCII2.GLBL_CMPY_CD (+)
                 AND DCD.CPO_ORD_NUM             = DCII2.CPO_ORD_NUM (+)
                 AND DCII2.DS_CPO_CONFIG_PK (+) IS NULL
                 AND DCII2.EZCANCELFLAG  (+)     = '0'
                 AND DCII2.GLBL_CMPY_CD          = SIR2.GLBL_CMPY_CD (+)
                 AND DCII2.SVC_ISTL_RULE_NUM     = SIR2.SVC_ISTL_RULE_NUM (+)
                 AND SIR2.EZCANCELFLAG (+)       = '0'
                 AND DM.GLBL_CMPY_CD             = SIR.GLBL_CMPY_CD (+)
                 AND DM.SVC_ISTL_RULE_NUM        = SIR.SVC_ISTL_RULE_NUM (+)
                 AND SIR.EZCANCELFLAG (+)        = '0'
                 AND NVL(SIR1.AUTO_ISTL_CALL_FLG, NVL(SIR2.AUTO_ISTL_CALL_FLG, NVL(SIR.AUTO_ISTL_CALL_FLG, 'Y'))) = 'Y'
                 AND NOT EXISTS (
                         SELECT * FROM ORD_CATG_BIZ_CTX OCBC
                         WHERE
                         OCBC.GLBL_CMPY_CD           = CPO.GLBL_CMPY_CD
                         AND OCBC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTp#
                         AND OCBC.DS_ORD_CATG_CD     = CPO.DS_ORD_CATG_CD
<!-- START 2019/06/17 W.Honda [QC#50842,MOD] -->
                         <!-- AND OCBC.DS_ORD_TP_CD       = CPO.DS_ORD_TP_CD -->
                         AND (OCBC.DS_ORD_TP_CD      = CPO.DS_ORD_TP_CD
                             OR  OCBC.DS_ORD_TP_CD   IS NULL)
<!-- END 2019/06/17 W.Honda [QC#50842,MOD] -->
                         AND OCBC.EZCANCELFLAG       = '0'
                 )
                 AND NOT EXISTS (
                         SELECT * FROM SVC_TASK ST
                         WHERE
                         ST.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD
                         AND ST.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                         AND ST.SO_NUM           = SMM.SO_NUM
                         AND ST.EZCANCELFLAG     = '0'
                 )
<!-- START 2019/06/17 W.Honda [QC#50842,DEL] -->
                 <!-- AND CPO.GLBL_CMPY_CD            = OCBCS.GLBL_CMPY_CD (+) -->
                 <!-- AND CPO.DS_ORD_CATG_CD          = OCBCS.DS_ORD_CATG_CD (+) -->
                 <!-- AND OCBCS.ORD_CATG_CTX_TP_CD (+)= #ordCatgCtxTpSvcExch# -->
                 <!-- AND OCBCS.EZCANCELFLAG (+)      = '0' -->
<!-- END 2019/06/17 W.Honda [QC#50842,DEL] -->
                 AND SMM.GLBL_CMPY_CD            = SCMD.GLBL_CMPY_CD
                 AND SMM.SVC_MACH_MSTR_PK        = SCMD.SVC_MACH_MSTR_PK
                 AND SCMD.EZCANCELFLAG           = '0'
                 AND SCMD.SVC_MACH_RMV_DT       IS NULL
                 AND DCD.GLBL_CMPY_CD            = OLS.GLBL_CMPY_CD
                 AND DCD.ORD_LINE_SRC_CD         = OLS.ORD_LINE_SRC_CD
                 AND OLS.EZCANCELFLAG            = '0'
                 AND OLS.AUTO_SVC_CALL_OPEN_FLG  = 'Y'
                 AND SMM.GLBL_CMPY_CD            = STC.GLBL_CMPY_CD
                 AND SMM.CUR_LOC_NUM             = STC.SHIP_TO_CUST_CD
                 AND STC.EZCANCELFLAG            = '0'
                AND NOT EXISTS (
                     SELECT * FROM SVC_ISTL_CALL_MACH_INFO SICM
                     WHERE
                         SICM.GLBL_CMPY_CD       = DCD.GLBL_CMPY_CD
                     AND SICM.CPO_ORD_NUM        = DCD.CPO_ORD_NUM
                     AND SICM.SVC_MACH_MSTR_PK   = SMM.SVC_MACH_MSTR_PK
                     AND SICM.EZCANCELFLAG       = '0'
                )
        UNION ALL
        <!-- Non Serialize Item -->
        SELECT
             DCD.CPO_ORD_NUM                    AS CPO_ORD_NUM
             ,SMM.SVC_MACH_MSTR_PK               AS SVC_MACH_MSTR_PK
             ,ROW_NUMBER() OVER (PARTITION BY SMM.SVC_MACH_MSTR_PK ORDER BY SCMD.RGTN_CONFIG_DT DESC, SCMD.EZINTIME DESC) AS CONFIG_ROW_NUMBER
        FROM
                 SHPG_PLN            SP
                ,SHPG_ORD_DTL        SOD
                ,CPO                 CPO
                ,CPO_DTL             DCD
                ,SVC_MACH_MSTR       SMM
                ,SVC_CONFIG_MSTR     SCM
                ,DS_MDL              DM
                ,MDSE                MDSE
                ,SHPG_ORD            SOS
                ,DS_CPO_ISTL_INFO    DCII1
                ,SVC_ISTL_RULE       SIR1
                ,DS_CPO_ISTL_INFO    DCII2
                ,SVC_ISTL_RULE       SIR2
                ,SVC_ISTL_RULE       SIR
<!-- START 2019/06/17 W.Honda [QC#50842,DEL] -->
                <!-- ,ORD_CATG_BIZ_CTX    OCBCS -->
<!-- END 2019/06/17 W.Honda [QC#50842,DEL] -->
                ,SVC_CONFIG_MSTR_DTL SCMD
                ,ORD_LINE_SRC        OLS
                ,SHIP_TO_CUST        STC
        WHERE
                 SP.GLBL_CMPY_CD                 = #glblCmpyCd#
                 AND (
                          SP.SHPG_STS_CD   =  #shpgStsCdArv#
                      OR  SP.SHPG_STS_CD   =  #shpgStsCdShip#
                 )
                 AND SP.EZCANCELFLAG             = '0'
                 AND SP.GLBL_CMPY_CD             = SOD.GLBL_CMPY_CD (+)
                 AND SP.SHPG_PLN_NUM             = SOD.SHPG_PLN_NUM (+)
                 AND SOD.EZCANCELFLAG        (+) = '0'
                 AND SP.GLBL_CMPY_CD             = CPO.GLBL_CMPY_CD
                 AND SP.TRX_HDR_NUM              = CPO.CPO_ORD_NUM
                 AND CPO.EZCANCELFLAG            = '0'
                 AND SP.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
                 AND SP.TRX_HDR_NUM              = DCD.CPO_ORD_NUM
                 AND SP.TRX_LINE_NUM             = DCD.CPO_DTL_LINE_NUM
                 AND SP.TRX_LINE_SUB_NUM         = DCD.CPO_DTL_LINE_SUB_NUM
                 AND DCD.EZCANCELFLAG            = '0'
                 AND DCD.GLBL_CMPY_CD            = SMM.GLBL_CMPY_CD
                 AND DCD.CPO_ORD_NUM             = SMM.CPO_ORD_NUM
                 AND DCD.CPO_DTL_LINE_NUM        = SMM.CPO_DTL_LINE_NUM
                 AND DCD.CPO_DTL_LINE_SUB_NUM    = SMM.CPO_DTL_LINE_SUB_NUM
                 AND SMM.SVC_MACH_MSTR_STS_CD    = #svcMachMstrSts#
                 AND SMM.SVC_MACH_TP_CD          = #svcMachTpCd#
                 AND SMM.EZCANCELFLAG            = '0'
                 AND SMM.GLBL_CMPY_CD            = SCM.GLBL_CMPY_CD (+)
                 AND SMM.SVC_CONFIG_MSTR_PK      = SCM.SVC_CONFIG_MSTR_PK (+)
                 AND SCM.EZCANCELFLAG (+)        = '0'
                 AND SCM.GLBL_CMPY_CD            = DM.GLBL_CMPY_CD (+)
                 AND SCM.MDL_ID                  = DM.MDL_ID (+)
                 AND DM.SVC_ISTL_CALL_GRP_NUM(+) IS NOT NULL
                 AND DM.EZCANCELFLAG (+)         = '0'
                 AND SMM.GLBL_CMPY_CD            = MDSE.GLBL_CMPY_CD
                 AND SMM.MDSE_CD                 = MDSE.MDSE_CD
                 AND MDSE.RGTN_STS_CD            = #rgtnStsCd#
                 AND MDSE.INVTY_CTRL_FLG         = 'N'
                 AND MDSE.EZCANCELFLAG           = '0'
                 AND SOD.GLBL_CMPY_CD            = SOS.GLBL_CMPY_CD (+)
                 AND SOD.SO_NUM                  = SOS.SO_NUM (+)
                 AND SOS.EZCANCELFLAG (+)        = '0'
                 AND DCD.GLBL_CMPY_CD            = DCII1.GLBL_CMPY_CD (+)
                 AND DCD.CPO_ORD_NUM             = DCII1.CPO_ORD_NUM (+)
                 AND DCD.DS_CPO_CONFIG_PK        = DCII1.DS_CPO_CONFIG_PK (+)
                 AND DCII1.EZCANCELFLAG (+)      = '0'
                 AND DCII1.GLBL_CMPY_CD          = SIR1.GLBL_CMPY_CD (+)
                 AND DCII1.SVC_ISTL_RULE_NUM     = SIR1.SVC_ISTL_RULE_NUM (+)
                 AND SIR1.EZCANCELFLAG (+)       = '0'
                 AND DCD.GLBL_CMPY_CD            = DCII2.GLBL_CMPY_CD (+)
                 AND DCD.CPO_ORD_NUM             = DCII2.CPO_ORD_NUM (+)
                 AND DCII2.DS_CPO_CONFIG_PK (+) IS NULL
                 AND DCII2.EZCANCELFLAG  (+)     = '0'
                 AND DCII2.GLBL_CMPY_CD          = SIR2.GLBL_CMPY_CD (+)
                 AND DCII2.SVC_ISTL_RULE_NUM     = SIR2.SVC_ISTL_RULE_NUM (+)
                 AND SIR2.EZCANCELFLAG (+)       = '0'
                 AND DM.GLBL_CMPY_CD             = SIR.GLBL_CMPY_CD (+)
                 AND DM.SVC_ISTL_RULE_NUM        = SIR.SVC_ISTL_RULE_NUM (+)
                 AND SIR.EZCANCELFLAG (+)        = '0'
                 AND NVL(SIR1.AUTO_ISTL_CALL_FLG, NVL(SIR2.AUTO_ISTL_CALL_FLG, NVL(SIR.AUTO_ISTL_CALL_FLG, 'Y'))) = 'Y'
                 AND NOT EXISTS (
                         SELECT * FROM ORD_CATG_BIZ_CTX OCBC
                         WHERE
                         OCBC.GLBL_CMPY_CD           = CPO.GLBL_CMPY_CD
                         AND OCBC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTp#
                         AND OCBC.DS_ORD_CATG_CD     = CPO.DS_ORD_CATG_CD
<!-- START 2019/06/17 W.Honda [QC#50842,MOD] -->
                         <!-- AND OCBC.DS_ORD_TP_CD       = CPO.DS_ORD_TP_CD -->
                         AND (OCBC.DS_ORD_TP_CD      = CPO.DS_ORD_TP_CD
                             OR  OCBC.DS_ORD_TP_CD   IS NULL)
<!-- END 2019/06/17 W.Honda [QC#50842,MOD] -->
                         AND OCBC.EZCANCELFLAG       = '0'
                 )
                 AND NOT EXISTS (
                         SELECT
                             *
                         FROM
                             SVC_TASK ST
                         WHERE
                             ST.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
                         AND ST.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                         AND SUBSTR(ST.SVC_TASK_RCV_DT || ST.SVC_TASK_RCV_TM || '00000000000000000', 0, 17) >= CPO.ORD_BOOK_REQ_TS
                         AND ST.EZCANCELFLAG     = '0'
                 )
<!-- START 2019/06/17 W.Honda [QC#50842,DEL] -->
                 <!-- AND CPO.GLBL_CMPY_CD            = OCBCS.GLBL_CMPY_CD (+) -->
                 <!-- AND CPO.DS_ORD_CATG_CD          = OCBCS.DS_ORD_CATG_CD (+) -->
                 <!-- AND OCBCS.ORD_CATG_CTX_TP_CD (+)= #ordCatgCtxTpSvcExch# -->
                 <!-- AND OCBCS.EZCANCELFLAG (+)      = '0' -->
<!-- END 2019/06/17 W.Honda [QC#50842,DEL] -->
                 AND SMM.GLBL_CMPY_CD            = SCMD.GLBL_CMPY_CD
                 AND SMM.SVC_MACH_MSTR_PK        = SCMD.SVC_MACH_MSTR_PK
                 AND SCMD.EZCANCELFLAG           = '0'
                 AND SCMD.SVC_MACH_RMV_DT       IS NULL
                 AND DCD.GLBL_CMPY_CD            = OLS.GLBL_CMPY_CD
                 AND DCD.ORD_LINE_SRC_CD         = OLS.ORD_LINE_SRC_CD
                 AND OLS.EZCANCELFLAG            = '0'
                 AND OLS.AUTO_SVC_CALL_OPEN_FLG  = 'Y'
                 AND SMM.GLBL_CMPY_CD            = STC.GLBL_CMPY_CD
                 AND SMM.CUR_LOC_NUM             = STC.SHIP_TO_CUST_CD
                 AND STC.EZCANCELFLAG            = '0'
                AND NOT EXISTS (
                     SELECT * FROM SVC_ISTL_CALL_MACH_INFO SICM
                     WHERE
                         SICM.GLBL_CMPY_CD       = DCD.GLBL_CMPY_CD
                     AND SICM.CPO_ORD_NUM        = DCD.CPO_ORD_NUM
                     AND SICM.SVC_MACH_MSTR_PK   = SMM.SVC_MACH_MSTR_PK
                     AND SICM.EZCANCELFLAG       = '0'
                )
        <!-- START 2023/09/05 K.Watanabe [QC#53408,ADD] -->
        UNION ALL
        <!-- Accessory Serialize Item -->
        SELECT
             DCD.CPO_ORD_NUM                    AS CPO_ORD_NUM
             ,SMM2.SVC_MACH_MSTR_PK             AS SVC_MACH_MSTR_PK
             ,ROW_NUMBER() OVER (PARTITION BY SMM2.SVC_MACH_MSTR_PK ORDER BY SCMD.RGTN_CONFIG_DT DESC, SCMD.EZINTIME DESC) AS CONFIG_ROW_NUMBER
        FROM
                 SHPG_PLN            SP
                ,SHPG_ORD_DTL        SOD
                ,SVC_MACH_MSTR       SMM1
                ,CPO                 CPO
                ,DS_CPO_CONFIG       DCC
                ,CPO_DTL             DCD
                ,MDSE                MDSE
                ,SHPG_ORD            SOS
                ,DS_CPO_ISTL_INFO    DCII1
                ,SVC_ISTL_RULE       SIR1
                ,DS_CPO_ISTL_INFO    DCII2
                ,SVC_ISTL_RULE       SIR2
                ,SVC_ISTL_RULE       SIR
                ,SVC_CONFIG_MSTR_DTL SCMD
                ,SVC_MACH_MSTR       SMM2
                ,ORD_LINE_SRC        OLS
                ,SHIP_TO_CUST        STC
        WHERE
                 SP.GLBL_CMPY_CD                 = #glblCmpyCd#
                 AND (
                          (    SP.SHPG_STS_CD    = #shpgStsCdArv#
                           AND SP.ACTL_ARV_DT   &lt;= #actlArvDt#
                      )
                      OR  (     SP.SHPG_STS_CD    = #shpgStsCdShip#
                            AND SP.ACTL_SHIP_DT  &lt;= #actlShipDt#
                      )
                 )
                 AND SP.EZCANCELFLAG               = '0'
                 AND SP.GLBL_CMPY_CD               = SOD.GLBL_CMPY_CD
                 AND SP.SHPG_PLN_NUM               = SOD.SHPG_PLN_NUM
                 AND SOD.EZCANCELFLAG              = '0'
                 AND SOD.GLBL_CMPY_CD              = SMM1.GLBL_CMPY_CD
                 AND SOD.SHPG_PLN_NUM              = SMM1.SHPG_PLN_NUM
                 AND SOD.SO_NUM                    = SMM1.SO_NUM
                 AND SOD.SO_SLP_NUM                = SMM1.SO_SLP_NUM
                 AND SMM1.SVC_MACH_MSTR_STS_CD     = #svcMachMstrSts#
                 AND SMM1.SVC_MACH_TP_CD           = #svcMachTpCdAcc#
                 AND SMM1.EZCANCELFLAG             = '0'
                 AND SP.GLBL_CMPY_CD               = CPO.GLBL_CMPY_CD
                 AND SP.TRX_HDR_NUM                = CPO.CPO_ORD_NUM
                 AND CPO.EZCANCELFLAG              = '0'
                 AND SP.GLBL_CMPY_CD               = DCD.GLBL_CMPY_CD
                 AND SP.TRX_HDR_NUM                = DCD.CPO_ORD_NUM
                 AND SP.TRX_LINE_NUM               = DCD.CPO_DTL_LINE_NUM
                 AND SP.TRX_LINE_SUB_NUM           = DCD.CPO_DTL_LINE_SUB_NUM
                 AND DCD.EZCANCELFLAG              = '0'
                 AND NOT EXISTS (
                    SELECT
                        1
                    FROM
                        CPO_DTL                DCD
                    WHERE
                        DCC.CONFIG_TP_CD           = 'O02'
                    AND DCC.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
                    AND DCC.DS_CPO_CONFIG_PK       = DCD.DS_CPO_CONFIG_PK
                    AND DCD.EZCANCELFLAG           = '0'
                    AND DCD.BASE_CMPT_FLG          = #baseCmptFlg#
                    AND ROWNUM                     = 1
                 )
                 AND DCD.GLBL_CMPY_CD              = DCC.GLBL_CMPY_CD
                 AND DCD.DS_CPO_CONFIG_PK          = DCC.DS_CPO_CONFIG_PK
                 <iterate property="configTpCdList" var="configTpCd[]" open="AND DCC.CONFIG_TP_CD IN (" close=")" conjunction=",">
                     #configTpCd[]#
                 </iterate>
                 AND DCC.EZCANCELFLAG              = '0'
                 AND SMM1.GLBL_CMPY_CD             = MDSE.GLBL_CMPY_CD
                 AND SMM1.MDSE_CD                  = MDSE.MDSE_CD
                 AND MDSE.SVC_ISTL_CALL_GRP_NUM(+) IS NOT NULL
                 AND MDSE.RGTN_STS_CD              = #rgtnStsCd#
                 AND MDSE.INVTY_CTRL_FLG           = 'Y'
                 AND MDSE.EZCANCELFLAG             = '0'
                 AND NOT EXISTS (
                     SELECT
                         1
                     FROM
                         CPO_DTL                CPOD
                        ,MDSE                   MDSE
                        ,SVC_MACH_MSTR          SMM
                     WHERE
                         DCC.CONFIG_TP_CD       = 'O06'
                     AND DCC.GLBL_CMPY_CD       = CPOD.GLBL_CMPY_CD
                     AND DCC.DS_CPO_CONFIG_PK   = CPOD.DS_CPO_CONFIG_PK
                     AND CPOD.EZCANCELFLAG      = '0'
                     AND CPOD.GLBL_CMPY_CD      = MDSE.GLBL_CMPY_CD
                     AND (
                         CPOD.MDSE_CD = MDSE.MDSE_CD
                             OR EXISTS (
                                 SELECT
                                     MDSE.MDSE_CD
                                 FROM
                                     ORD_TAKE_MDSE OTM
                                 WHERE
                                     CPOD.GLBL_CMPY_CD = OTM.GLBL_CMPY_CD
                                 AND CPOD.MDSE_CD      = OTM.ORD_TAKE_MDSE_CD
                                 AND OTM.MDSE_CD       = MDSE.MDSE_CD
                                 AND OTM.EZCANCELFLAG  = '0'
                             )
                         )
                     AND MDSE.EZCANCELFLAG      = '0'
                     AND MDSE.GLBL_CMPY_CD      = SMM.GLBL_CMPY_CD
                     AND MDSE.MDSE_CD           = SMM.MDSE_CD
                     AND SMM.EZCANCELFLAG       = '0'
                     AND SMM.SVC_MACH_TP_CD     = #svcMachTpCd#
                     AND ROWNUM                 = '1'
                 )
                 AND SOD.GLBL_CMPY_CD              = SOS.GLBL_CMPY_CD (+)
                 AND SOD.SO_NUM                    = SOS.SO_NUM (+)
                 AND SOS.EZCANCELFLAG (+)          = '0'
                 AND DCD.GLBL_CMPY_CD              = DCII1.GLBL_CMPY_CD (+)
                 AND DCD.CPO_ORD_NUM               = DCII1.CPO_ORD_NUM (+)
                 AND DCD.DS_CPO_CONFIG_PK          = DCII1.DS_CPO_CONFIG_PK (+)
                 AND DCII1.EZCANCELFLAG (+)        = '0'
                 AND DCII1.GLBL_CMPY_CD            = SIR1.GLBL_CMPY_CD (+)
                 AND DCII1.SVC_ISTL_RULE_NUM       = SIR1.SVC_ISTL_RULE_NUM (+)
                 AND SIR1.EZCANCELFLAG (+)         = '0'
                 AND DCD.GLBL_CMPY_CD              = DCII2.GLBL_CMPY_CD (+)
                 AND DCD.CPO_ORD_NUM               = DCII2.CPO_ORD_NUM (+)
                 AND DCII2.DS_CPO_CONFIG_PK (+)    IS NULL
                 AND DCII2.EZCANCELFLAG  (+)       = '0'
                 AND DCII2.GLBL_CMPY_CD            = SIR2.GLBL_CMPY_CD (+)
                 AND DCII2.SVC_ISTL_RULE_NUM       = SIR2.SVC_ISTL_RULE_NUM (+)
                 AND SIR2.EZCANCELFLAG (+)         = '0'
                 AND MDSE.GLBL_CMPY_CD             = SIR.GLBL_CMPY_CD (+)
                 AND MDSE.SVC_ISTL_RULE_NUM        = SIR.SVC_ISTL_RULE_NUM (+)
                 AND SIR.EZCANCELFLAG (+)          = '0'
                 AND NVL(SIR1.AUTO_ISTL_CALL_FLG, NVL(SIR2.AUTO_ISTL_CALL_FLG, NVL(SIR.AUTO_ISTL_CALL_FLG, 'Y'))) = 'Y'
                 AND NOT EXISTS (
                         SELECT * FROM ORD_CATG_BIZ_CTX OCBC
                         WHERE
                         OCBC.GLBL_CMPY_CD           = CPO.GLBL_CMPY_CD
                         AND OCBC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTp#
                         AND OCBC.DS_ORD_CATG_CD     = CPO.DS_ORD_CATG_CD
                         AND (OCBC.DS_ORD_TP_CD      = CPO.DS_ORD_TP_CD
                             OR  OCBC.DS_ORD_TP_CD   IS NULL)
                         AND OCBC.EZCANCELFLAG       = '0'
                 )
                 AND SMM1.GLBL_CMPY_CD           = SCMD.GLBL_CMPY_CD
                 AND SMM1.SVC_MACH_MSTR_PK       = SCMD.SVC_MACH_MSTR_PK
                 AND SCMD.EZCANCELFLAG           = '0'
                 AND SCMD.SVC_MACH_RMV_DT        IS NULL
                 AND SCMD.GLBL_CMPY_CD           = SMM2.GLBL_CMPY_CD
                 AND SCMD.PRNT_SVC_MACH_MSTR_PK  = SMM2.SVC_MACH_MSTR_PK
                 AND SMM2.EZCANCELFLAG           = '0'
                 AND DCD.GLBL_CMPY_CD            = OLS.GLBL_CMPY_CD
                 AND DCD.ORD_LINE_SRC_CD         = OLS.ORD_LINE_SRC_CD
                 AND OLS.EZCANCELFLAG            = '0'
                 AND OLS.AUTO_SVC_CALL_OPEN_FLG  = 'Y'
                 AND SMM2.GLBL_CMPY_CD           = STC.GLBL_CMPY_CD
                 AND SMM2.CUR_LOC_NUM            = STC.SHIP_TO_CUST_CD
                 AND STC.EZCANCELFLAG            = '0'
                 AND NOT EXISTS (
                         SELECT * FROM SVC_TASK ST
                         WHERE
                         ST.GLBL_CMPY_CD         = SMM2.GLBL_CMPY_CD
                         AND ST.SVC_MACH_MSTR_PK = SMM2.SVC_MACH_MSTR_PK
                         AND ST.SO_NUM           = SMM1.SO_NUM
                         AND ST.EZCANCELFLAG     = '0'
                 )
                 AND NOT EXISTS (
                     SELECT * FROM SVC_ISTL_CALL_MACH_INFO SICM
                     WHERE
                         SICM.GLBL_CMPY_CD       = DCD.GLBL_CMPY_CD
                     AND SICM.CPO_ORD_NUM        = DCD.CPO_ORD_NUM
                     AND SICM.SVC_MACH_MSTR_PK   = SMM2.SVC_MACH_MSTR_PK
                     AND SICM.EZCANCELFLAG       = '0'
                 )
        <!-- END 2023/09/05 K.Watanabe [QC#53408,ADD] -->
            )
        WHERE
            CONFIG_ROW_NUMBER = 1
    </statement>

    <statement id="getSvcInstallCallMachineInfo" parameterClass="Map" resultClass="Map">
        <!-- START 2018/01/19 K.Kojima [QC#23606,ADD] -->
        SELECT
              SO_NUM
             ,CPO_CTAC_GLBL_CMPY_CD
             ,CPO_CTAC_ORD_NUM
             ,CPO_CTAC_CONFIG_PK
             ,CPO_CTAC_DTL_LINE_NUM
             ,CPO_CTAC_DTL_LINE_SUB_NUM
             ,FIRST_PROD_CTRL_CD
             ,CUST_ISS_PO_NUM
             ,CUST_ISS_PO_DT
             ,ACTL_DELY_DT
             ,ACTL_DELY_TM
             ,SVC_MACH_MSTR_PK
             ,CUST_MACH_CTRL_NUM
             ,SER_NUM
             ,BILL_TO_ACCT_NUM
             ,SVC_ISTL_CALL_GRP_NUM
             ,DSOD_ACTL_DELY_DT
             ,DSOD_ACTL_DELY_TM
             ,ISTL_ADDL_CMNT_TXT1
             ,RQST_ISTL_DT1
             ,RQST_ISTL_TM1
             ,ISTL_TECH_CD1
             ,EZUPUSERID1
             ,ISTL_ADDL_CMNT_TXT2
             ,RQST_ISTL_DT2
             ,RQST_ISTL_TM2
             ,ISTL_TECH_CD2
             ,EZUPUSERID2
             ,SOS_EZUPUSERID
             ,SCHD_DURN_TM_NUM
             ,SHPG_STS_CD
             ,SVC_EXCH_FLG
             ,PRE_SVC_CONFIG_MSTR_PK
             ,MACH_MDSE_CD
             ,DS_CPO_ISTL_INFO_PK1
             ,DS_CPO_ISTL_INFO_PK2
             ,TECH_MEET_TRUCK_FLG
             ,SVC_BY_LINE_BIZ_TP_CD
             ,SCHD_DELY_DT
             ,SCHD_DELY_TM
             <!-- START 2018/01/19 K.Ochiai [QC#18889, ADD] -->
             ,CTRY_CD
             ,POST_CD
             <!-- END 2018/01/19 K.Ochiai [QC#18889, ADD] -->
             <!-- START 2023/09/05 K.Watanabe [QC#53408,ADD] -->
             ,ADD_ASRY_FLG
             <!-- END 2023/09/05 K.Watanabe [QC#53408,ADD] -->
        FROM
            (
        <!-- END 2018/01/19 K.Kojima [QC#23606,ADD] -->
        <!-- Serialize Item -->
        SELECT
              SOD.SO_NUM                         AS SO_NUM
             ,DCD.GLBL_CMPY_CD                   AS CPO_CTAC_GLBL_CMPY_CD
             ,DCD.CPO_ORD_NUM                    AS CPO_CTAC_ORD_NUM
             ,DCD.DS_CPO_CONFIG_PK               AS CPO_CTAC_CONFIG_PK
             ,DCD.CPO_DTL_LINE_NUM               AS CPO_CTAC_DTL_LINE_NUM
             ,DCD.CPO_DTL_LINE_SUB_NUM           AS CPO_CTAC_DTL_LINE_SUB_NUM
             ,MDSE.FIRST_PROD_CTRL_CD            AS FIRST_PROD_CTRL_CD
             ,CPO.CUST_ISS_PO_NUM                AS CUST_ISS_PO_NUM
             ,CPO.CUST_ISS_PO_DT                 AS CUST_ISS_PO_DT
             ,SOD.ACTL_DELY_DT                   AS ACTL_DELY_DT
             ,SOD.ACTL_DELY_TM                   AS ACTL_DELY_TM
             ,SMM.SVC_MACH_MSTR_PK               AS SVC_MACH_MSTR_PK
             ,SMM.CUST_MACH_CTRL_NUM             AS CUST_MACH_CTRL_NUM
             ,SMM.SER_NUM                        AS SER_NUM
             ,SMM.BILL_TO_ACCT_NUM               AS BILL_TO_ACCT_NUM
             ,DM.SVC_ISTL_CALL_GRP_NUM           AS SVC_ISTL_CALL_GRP_NUM
             ,SOD.ACTL_DELY_DT                   AS DSOD_ACTL_DELY_DT
             ,SOD.ACTL_DELY_TM                   AS DSOD_ACTL_DELY_TM
             ,DCII1.ISTL_ADDL_CMNT_TXT           AS ISTL_ADDL_CMNT_TXT1
             ,DCII1.RQST_ISTL_DT                 AS RQST_ISTL_DT1
             ,DCII1.RQST_ISTL_TM                 AS RQST_ISTL_TM1
             ,DCII1.ISTL_TECH_CD                 AS ISTL_TECH_CD1
             ,DCII1.EZUPUSERID                   AS EZUPUSERID1
             ,DCII2.ISTL_ADDL_CMNT_TXT           AS ISTL_ADDL_CMNT_TXT2
             ,DCII2.RQST_ISTL_DT                 AS RQST_ISTL_DT2
             ,DCII2.RQST_ISTL_TM                 AS RQST_ISTL_TM2
             ,DCII2.ISTL_TECH_CD                 AS ISTL_TECH_CD2
             ,DCII2.EZUPUSERID                   AS EZUPUSERID2
             ,SOS.EZUPUSERID                     AS SOS_EZUPUSERID
             ,SOS.SCHD_DURN_TM_NUM               AS SCHD_DURN_TM_NUM
             ,SP.SHPG_STS_CD                     AS SHPG_STS_CD
             ,CASE
<!-- START 2019/06/17 W.Honda [QC#50842, MOD] -->
                <!-- WHEN OCBCS.DS_ORD_CATG_CD IS NOT NULL THEN 'Y' -->
                WHEN (OCBCS.DS_ORD_CATG_CD IS NOT NULL
                     OR  OCBCS2.DS_ORD_CATG_CD IS NOT NULL) THEN 'Y'
<!-- START 2019/06/17 W.Honda [QC#50842, MOD] -->
                ELSE 'N'
              END                                AS SVC_EXCH_FLG
             ,SCMD.SVC_CONFIG_MSTR_PK            AS PRE_SVC_CONFIG_MSTR_PK
             ,SMM.MDSE_CD                        AS MACH_MDSE_CD
             ,DCII1.DS_CPO_ISTL_INFO_PK          AS DS_CPO_ISTL_INFO_PK1
             ,DCII2.DS_CPO_ISTL_INFO_PK          AS DS_CPO_ISTL_INFO_PK2
<!-- START 2018/01/10 M.Naito [QC#18889, ADD] -->
             ,SOS.TECH_MEET_TRUCK_FLG            AS TECH_MEET_TRUCK_FLG
             ,SMM.SVC_BY_LINE_BIZ_TP_CD          AS SVC_BY_LINE_BIZ_TP_CD
             ,SOS.SCHD_DELY_DT                   AS SCHD_DELY_DT
             ,SOS.SCHD_DELY_TM                   AS SCHD_DELY_TM
<!-- END 2018/01/10 M.Naito [QC#18889, ADD] -->
             <!-- START 2018/01/19 K.Kojima [QC#23606,ADD] -->
             ,ROW_NUMBER() OVER (PARTITION BY SMM.SVC_MACH_MSTR_PK ORDER BY SCMD.RGTN_CONFIG_DT DESC, SCMD.EZINTIME DESC) AS CONFIG_ROW_NUMBER
             <!-- END 2018/01/19 K.Kojima [QC#23606,ADD] -->
             <!-- START 2018/01/19 K.Ochiai [QC#18889, ADD] -->
             ,STC.CTRY_CD                        AS CTRY_CD
             ,STC.POST_CD                        AS POST_CD
             <!-- END 2018/01/19 K.Ochiai [QC#18889, ADD] -->
             <!-- START 2023/09/05 K.Watanabe [QC#53408,ADD] -->
             ,'N'                                AS ADD_ASRY_FLG
             <!-- END 2023/09/05 K.Watanabe [QC#53408,ADD] -->
        FROM
                 SHPG_PLN            SP
                ,SVC_ISTL_CALL_MACH_INFO  SICM
                ,SHPG_ORD_DTL        SOD
                ,SVC_MACH_MSTR       SMM
                ,SVC_CONFIG_MSTR     SCM
                ,DS_MDL              DM
                ,CPO                 CPO
                ,CPO_DTL             DCD
                ,MDSE                MDSE
                ,SHPG_ORD            SOS
                ,DS_CPO_ISTL_INFO    DCII1
                ,SVC_ISTL_RULE       SIR1
                ,DS_CPO_ISTL_INFO    DCII2
                ,SVC_ISTL_RULE       SIR2
                ,SVC_ISTL_RULE       SIR
                ,ORD_CATG_BIZ_CTX    OCBCS
<!-- START 2019/06/17 W.Honda [QC#50842, ADD] -->
                ,ORD_CATG_BIZ_CTX    OCBCS2
<!-- END 2019/06/17 W.Honda [QC#50842, ADD] -->
                ,SVC_CONFIG_MSTR_DTL SCMD
<!-- START 2017/01/06 K.Kitachi [QC#14617, ADD] -->
                ,ORD_LINE_SRC        OLS
<!-- END 2017/01/06 K.Kitachi [QC#14617, ADD] -->
                <!-- START 2018/01/19 K.Ochiai [QC#18889, ADD] -->
                ,SHIP_TO_CUST        STC
                <!-- END 2018/01/19 K.Ochiai [QC#18889, ADD] -->
        WHERE
                 SP.GLBL_CMPY_CD                 = #glblCmpyCd#
<!-- START 2018/09/14 T.Wada [QC#19598, DEL] -->
<!--
                  AND (
                          (    SP.SHPG_STS_CD    = #shpgStsCdArv#
                           AND SP.ACTL_ARV_DT   &lt;= #actlArvDt#
                      )
                      OR  (     SP.SHPG_STS_CD    = #shpgStsCdShip#
                            AND SP.ACTL_SHIP_DT  &lt;= #actlShipDt#
                      )
                 )
 -->
<!-- END 2018/09/14 T.Wada [QC#19598, DEL] -->
                 AND SP.EZCANCELFLAG             = '0'

<!-- START 2018/09/14 T.Wada [QC#19598, ADD] -->
                 AND SP.GLBL_CMPY_CD             = SICM.GLBL_CMPY_CD
                 AND SP.TRX_HDR_NUM              = SICM.CPO_ORD_NUM
                 AND SICM.EZCANCELFLAG            = '0'
<!-- END   2018/09/14 T.Wada [QC#19598, ADD] -->
                 AND SP.GLBL_CMPY_CD             = SOD.GLBL_CMPY_CD
                 AND SP.SHPG_PLN_NUM             = SOD.SHPG_PLN_NUM
                 AND SOD.EZCANCELFLAG            = '0'
                 AND SOD.GLBL_CMPY_CD            = SMM.GLBL_CMPY_CD
                 AND SOD.SHPG_PLN_NUM            = SMM.SHPG_PLN_NUM
                 AND SOD.SO_NUM                  = SMM.SO_NUM
                 AND SOD.SO_SLP_NUM              = SMM.SO_SLP_NUM
                 AND SMM.SVC_MACH_MSTR_STS_CD    = #svcMachMstrSts#
                 AND SMM.SVC_MACH_TP_CD          = #svcMachTpCd#
                 AND SMM.EZCANCELFLAG            = '0'

<!-- START 2018/09/14 T.Wada [QC#19598, ADD] -->
                 AND SMM.GLBL_CMPY_CD            = SICM.GLBL_CMPY_CD
                 AND SMM.SVC_MACH_MSTR_PK        = SICM.SVC_MACH_MSTR_PK
<!-- END 2018/09/14 T.Wada [QC#19598, ADD] -->

                 AND SMM.GLBL_CMPY_CD            = SCM.GLBL_CMPY_CD (+)
                 AND SMM.SVC_CONFIG_MSTR_PK      = SCM.SVC_CONFIG_MSTR_PK (+)
                 AND SCM.EZCANCELFLAG (+)        = '0'
                 AND SCM.GLBL_CMPY_CD            = DM.GLBL_CMPY_CD (+)
                 AND SCM.MDL_ID                  = DM.MDL_ID (+)
                 AND DM.SVC_ISTL_CALL_GRP_NUM(+) IS NOT NULL
                 AND DM.EZCANCELFLAG (+)         = '0'

                 AND SP.GLBL_CMPY_CD             = CPO.GLBL_CMPY_CD
                 AND SP.TRX_HDR_NUM              = CPO.CPO_ORD_NUM
                 AND CPO.EZCANCELFLAG            = '0'
                 AND SP.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
                 AND SP.TRX_HDR_NUM              = DCD.CPO_ORD_NUM
                 AND SP.TRX_LINE_NUM             = DCD.CPO_DTL_LINE_NUM
                 AND SP.TRX_LINE_SUB_NUM         = DCD.CPO_DTL_LINE_SUB_NUM
                 AND DCD.EZCANCELFLAG            = '0'
                 AND SMM.GLBL_CMPY_CD            = MDSE.GLBL_CMPY_CD
                 AND SMM.MDSE_CD                 = MDSE.MDSE_CD
                 AND MDSE.RGTN_STS_CD            = #rgtnStsCd#
<!-- START 2018/02/28 T.Tomita [QC#24359, ADD] -->
                 AND MDSE.INVTY_CTRL_FLG         = 'Y'
<!-- END 2018/02/28 T.Tomita [QC#24359, ADD] -->
                 AND MDSE.EZCANCELFLAG           = '0'
                 AND SOD.GLBL_CMPY_CD            = SOS.GLBL_CMPY_CD (+)
                 AND SOD.SO_NUM                  = SOS.SO_NUM (+)
                 AND SOS.EZCANCELFLAG (+)        = '0'
                 AND DCD.GLBL_CMPY_CD            = DCII1.GLBL_CMPY_CD (+)
                 AND DCD.CPO_ORD_NUM             = DCII1.CPO_ORD_NUM (+)
                 AND DCD.DS_CPO_CONFIG_PK        = DCII1.DS_CPO_CONFIG_PK (+)
                 AND DCII1.EZCANCELFLAG (+)      = '0'
                 AND DCII1.GLBL_CMPY_CD          = SIR1.GLBL_CMPY_CD (+)
                 AND DCII1.SVC_ISTL_RULE_NUM     = SIR1.SVC_ISTL_RULE_NUM (+)
                 AND SIR1.EZCANCELFLAG (+)       = '0'
                 AND DCD.GLBL_CMPY_CD            = DCII2.GLBL_CMPY_CD (+)
                 AND DCD.CPO_ORD_NUM             = DCII2.CPO_ORD_NUM (+)
                 AND DCII2.DS_CPO_CONFIG_PK (+) IS NULL
                 AND DCII2.EZCANCELFLAG  (+)     = '0'
                 AND DCII2.GLBL_CMPY_CD          = SIR2.GLBL_CMPY_CD (+)
                 AND DCII2.SVC_ISTL_RULE_NUM     = SIR2.SVC_ISTL_RULE_NUM (+)
                 AND SIR2.EZCANCELFLAG (+)       = '0'
                 AND DM.GLBL_CMPY_CD             = SIR.GLBL_CMPY_CD (+)
                 AND DM.SVC_ISTL_RULE_NUM        = SIR.SVC_ISTL_RULE_NUM (+)
                 AND SIR.EZCANCELFLAG (+)        = '0'
                 AND NVL(SIR1.AUTO_ISTL_CALL_FLG, NVL(SIR2.AUTO_ISTL_CALL_FLG, NVL(SIR.AUTO_ISTL_CALL_FLG, 'Y'))) = 'Y'
                 AND NOT EXISTS (
                         SELECT * FROM ORD_CATG_BIZ_CTX OCBC
                         WHERE
                         OCBC.GLBL_CMPY_CD           = CPO.GLBL_CMPY_CD
                         AND OCBC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTp#
                         AND OCBC.DS_ORD_CATG_CD     = CPO.DS_ORD_CATG_CD
<!-- START 2019/06/17 W.Honda [QC#50842, MOD] -->
                         <!-- AND OCBC.DS_ORD_TP_CD       = CPO.DS_ORD_TP_CD -->
                         AND (OCBC.DS_ORD_TP_CD      = CPO.DS_ORD_TP_CD
                             OR  OCBC.DS_ORD_TP_CD   IS NULL)
<!-- START 2019/06/17 W.Honda [QC#50842, MOD] -->
                         AND OCBC.EZCANCELFLAG       = '0'
                 )
                 AND NOT EXISTS (
                         SELECT * FROM SVC_TASK ST
                         WHERE
                         ST.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD
                         AND ST.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                         AND ST.SO_NUM           = SMM.SO_NUM
                         AND ST.EZCANCELFLAG     = '0'
                 )
                 AND CPO.GLBL_CMPY_CD            = OCBCS.GLBL_CMPY_CD (+)
                 AND CPO.DS_ORD_CATG_CD          = OCBCS.DS_ORD_CATG_CD (+)
<!-- START 2019/06/17 W.Honda [QC#50842, ADD] -->
                 AND CPO.DS_ORD_TP_CD            = OCBCS.DS_ORD_TP_CD (+)
<!-- END 2019/06/17 W.Honda [QC#50842, ADD] -->
                 AND OCBCS.ORD_CATG_CTX_TP_CD (+)= #ordCatgCtxTpSvcExch#
                 AND OCBCS.EZCANCELFLAG (+)      = '0'
<!-- START 2019/06/17 W.Honda [QC#50842, ADD] -->
                 AND CPO.GLBL_CMPY_CD            = OCBCS2.GLBL_CMPY_CD (+)
                 AND CPO.DS_ORD_CATG_CD          = OCBCS2.DS_ORD_CATG_CD (+)
                 AND OCBCS2.DS_ORD_TP_CD (+)     IS NULL
                 AND OCBCS2.ORD_CATG_CTX_TP_CD (+)= #ordCatgCtxTpSvcExch#
                 AND OCBCS2.EZCANCELFLAG (+)      = '0'
<!-- END 2019/06/17 W.Honda [QC#50842, ADD] -->
                 AND SMM.GLBL_CMPY_CD            = SCMD.GLBL_CMPY_CD
                 AND SMM.SVC_MACH_MSTR_PK        = SCMD.SVC_MACH_MSTR_PK
                 AND SCMD.EZCANCELFLAG           = '0'
                 AND SCMD.SVC_MACH_RMV_DT       IS NULL
<!-- START 2017/01/06 K.Kitachi [QC#14617, ADD] -->
                 AND DCD.GLBL_CMPY_CD            = OLS.GLBL_CMPY_CD
                 AND DCD.ORD_LINE_SRC_CD         = OLS.ORD_LINE_SRC_CD
                 AND OLS.EZCANCELFLAG            = '0'
                 AND OLS.AUTO_SVC_CALL_OPEN_FLG  = 'Y'
<!-- END 2017/01/06 K.Kitachi [QC#14617, ADD] -->
                 <!-- START 2018/01/19 K.Ochiai [QC#18889, ADD] -->
                 AND SMM.GLBL_CMPY_CD            = STC.GLBL_CMPY_CD
                 AND SMM.CUR_LOC_NUM             = STC.SHIP_TO_CUST_CD
                 AND STC.EZCANCELFLAG            = '0'
                 <!-- END 2018/01/19 K.Ochiai [QC#18889, ADD] -->
<!-- START 2018/01/19 K.Kojima [QC#23606, ADD] -->
<!-- START 2018/02/28 T.Tomita [QC#24359, ADD] -->
        UNION ALL
        <!-- Non Serialize Item -->
        SELECT
              SOD.SO_NUM                         AS SO_NUM
             ,DCD.GLBL_CMPY_CD                   AS CPO_CTAC_GLBL_CMPY_CD
             ,DCD.CPO_ORD_NUM                    AS CPO_CTAC_ORD_NUM
             ,DCD.DS_CPO_CONFIG_PK               AS CPO_CTAC_CONFIG_PK
             ,DCD.CPO_DTL_LINE_NUM               AS CPO_CTAC_DTL_LINE_NUM
             ,DCD.CPO_DTL_LINE_SUB_NUM           AS CPO_CTAC_DTL_LINE_SUB_NUM
             ,MDSE.FIRST_PROD_CTRL_CD            AS FIRST_PROD_CTRL_CD
             ,CPO.CUST_ISS_PO_NUM                AS CUST_ISS_PO_NUM
             ,CPO.CUST_ISS_PO_DT                 AS CUST_ISS_PO_DT
             ,SOD.ACTL_DELY_DT                   AS ACTL_DELY_DT
             ,SOD.ACTL_DELY_TM                   AS ACTL_DELY_TM
             ,SMM.SVC_MACH_MSTR_PK               AS SVC_MACH_MSTR_PK
             ,SMM.CUST_MACH_CTRL_NUM             AS CUST_MACH_CTRL_NUM
             ,SMM.SER_NUM                        AS SER_NUM
             ,SMM.BILL_TO_ACCT_NUM               AS BILL_TO_ACCT_NUM
             ,DM.SVC_ISTL_CALL_GRP_NUM           AS SVC_ISTL_CALL_GRP_NUM
             ,SOD.ACTL_DELY_DT                   AS DSOD_ACTL_DELY_DT
             ,SOD.ACTL_DELY_TM                   AS DSOD_ACTL_DELY_TM
             ,DCII1.ISTL_ADDL_CMNT_TXT           AS ISTL_ADDL_CMNT_TXT1
             ,DCII1.RQST_ISTL_DT                 AS RQST_ISTL_DT1
             ,DCII1.RQST_ISTL_TM                 AS RQST_ISTL_TM1
             ,DCII1.ISTL_TECH_CD                 AS ISTL_TECH_CD1
             ,DCII1.EZUPUSERID                   AS EZUPUSERID1
             ,DCII2.ISTL_ADDL_CMNT_TXT           AS ISTL_ADDL_CMNT_TXT2
             ,DCII2.RQST_ISTL_DT                 AS RQST_ISTL_DT2
             ,DCII2.RQST_ISTL_TM                 AS RQST_ISTL_TM2
             ,DCII2.ISTL_TECH_CD                 AS ISTL_TECH_CD2
             ,DCII2.EZUPUSERID                   AS EZUPUSERID2
             ,SOS.EZUPUSERID                     AS SOS_EZUPUSERID
             ,SOS.SCHD_DURN_TM_NUM               AS SCHD_DURN_TM_NUM
             ,SP.SHPG_STS_CD                     AS SHPG_STS_CD
             ,CASE
<!-- START 2019/06/17 W.Honda [QC#50842, MOD] -->
                <!-- WHEN OCBCS.DS_ORD_CATG_CD IS NOT NULL THEN 'Y' -->
                WHEN (OCBCS.DS_ORD_CATG_CD IS NOT NULL
                     OR  OCBCS2.DS_ORD_CATG_CD IS NOT NULL) THEN 'Y'
<!-- END 2019/06/17 W.Honda [QC#50842, MOD] -->
                ELSE 'N'
              END                                AS SVC_EXCH_FLG
             ,SCMD.SVC_CONFIG_MSTR_PK            AS PRE_SVC_CONFIG_MSTR_PK
             ,SMM.MDSE_CD                        AS MACH_MDSE_CD
             ,DCII1.DS_CPO_ISTL_INFO_PK          AS DS_CPO_ISTL_INFO_PK1
             ,DCII2.DS_CPO_ISTL_INFO_PK          AS DS_CPO_ISTL_INFO_PK2
             ,SOS.TECH_MEET_TRUCK_FLG            AS TECH_MEET_TRUCK_FLG
             ,SMM.SVC_BY_LINE_BIZ_TP_CD          AS SVC_BY_LINE_BIZ_TP_CD
             ,SOS.SCHD_DELY_DT                   AS SCHD_DELY_DT
             ,SOS.SCHD_DELY_TM                   AS SCHD_DELY_TM
             ,ROW_NUMBER() OVER (PARTITION BY SMM.SVC_MACH_MSTR_PK ORDER BY SCMD.RGTN_CONFIG_DT DESC, SCMD.EZINTIME DESC) AS CONFIG_ROW_NUMBER
             ,STC.CTRY_CD                        AS CTRY_CD
             ,STC.POST_CD                        AS POST_CD
             <!-- START 2023/09/05 K.Watanabe [QC#53408,ADD] -->
             ,'N'                                AS ADD_ASRY_FLG
             <!-- END 2023/09/05 K.Watanabe [QC#53408,ADD] -->
        FROM
                 SHPG_PLN            SP
                ,SVC_ISTL_CALL_MACH_INFO  SICM
                ,SHPG_ORD_DTL        SOD
                ,CPO                 CPO
                ,CPO_DTL             DCD
                ,SVC_MACH_MSTR       SMM
                ,SVC_CONFIG_MSTR     SCM
                ,DS_MDL              DM
                ,MDSE                MDSE
                ,SHPG_ORD            SOS
                ,DS_CPO_ISTL_INFO    DCII1
                ,SVC_ISTL_RULE       SIR1
                ,DS_CPO_ISTL_INFO    DCII2
                ,SVC_ISTL_RULE       SIR2
                ,SVC_ISTL_RULE       SIR
                ,ORD_CATG_BIZ_CTX    OCBCS
<!-- START 2019/06/17 W.Honda [QC#50842, ADD] -->
                ,ORD_CATG_BIZ_CTX    OCBCS2
<!-- END 2019/06/17 W.Honda [QC#50842, ADD] -->
                ,SVC_CONFIG_MSTR_DTL SCMD
                ,ORD_LINE_SRC        OLS
                ,SHIP_TO_CUST        STC
        WHERE
                 SP.GLBL_CMPY_CD                 = #glblCmpyCd#
<!-- START 2018/09/14 T.Wada [QC#19598, DEL] -->
<!--
                  AND (
                          SP.SHPG_STS_CD   =  #shpgStsCdArv#
                      OR  SP.SHPG_STS_CD   =  #shpgStsCdShip#
                 )
 -->
<!-- END 2018/09/14 T.Wada [QC#19598, DEL] -->
                 AND SP.EZCANCELFLAG             = '0'
<!-- START 2018/09/14 T.Wada [QC#19598, ADD] -->
                 AND SP.GLBL_CMPY_CD             = SICM.GLBL_CMPY_CD
                 AND SP.TRX_HDR_NUM              = SICM.CPO_ORD_NUM
                 AND SICM.EZCANCELFLAG            = '0'
<!-- END   2018/09/14 T.Wada [QC#19598, ADD] -->

                 AND SP.GLBL_CMPY_CD             = SOD.GLBL_CMPY_CD (+)
                 AND SP.SHPG_PLN_NUM             = SOD.SHPG_PLN_NUM (+)
                 AND SOD.EZCANCELFLAG        (+) = '0'
                 AND SP.GLBL_CMPY_CD             = CPO.GLBL_CMPY_CD
                 AND SP.TRX_HDR_NUM              = CPO.CPO_ORD_NUM
                 AND CPO.EZCANCELFLAG            = '0'
                 AND SP.GLBL_CMPY_CD             = DCD.GLBL_CMPY_CD
                 AND SP.TRX_HDR_NUM              = DCD.CPO_ORD_NUM
                 AND SP.TRX_LINE_NUM             = DCD.CPO_DTL_LINE_NUM
                 AND SP.TRX_LINE_SUB_NUM         = DCD.CPO_DTL_LINE_SUB_NUM
                 AND DCD.EZCANCELFLAG            = '0'
                 AND DCD.GLBL_CMPY_CD            = SMM.GLBL_CMPY_CD
                 AND DCD.CPO_ORD_NUM             = SMM.CPO_ORD_NUM
                 AND DCD.CPO_DTL_LINE_NUM        = SMM.CPO_DTL_LINE_NUM
                 AND DCD.CPO_DTL_LINE_SUB_NUM    = SMM.CPO_DTL_LINE_SUB_NUM
                 AND SMM.SVC_MACH_MSTR_STS_CD    = #svcMachMstrSts#
                 AND SMM.SVC_MACH_TP_CD          = #svcMachTpCd#
                 AND SMM.EZCANCELFLAG            = '0'
<!-- START 2018/09/14 T.Wada [QC#19598, ADD] -->
                 AND SMM.GLBL_CMPY_CD            = SICM.GLBL_CMPY_CD
                 AND SMM.SVC_MACH_MSTR_PK        = SICM.SVC_MACH_MSTR_PK
<!-- END 2018/09/14 T.Wada [QC#19598, ADD] -->
                 AND SMM.GLBL_CMPY_CD            = SCM.GLBL_CMPY_CD (+)
                 AND SMM.SVC_CONFIG_MSTR_PK      = SCM.SVC_CONFIG_MSTR_PK (+)
                 AND SCM.EZCANCELFLAG (+)        = '0'

                 AND SCM.GLBL_CMPY_CD            = DM.GLBL_CMPY_CD (+)
                 AND SCM.MDL_ID                  = DM.MDL_ID (+)
                 AND DM.SVC_ISTL_CALL_GRP_NUM(+) IS NOT NULL
                 AND DM.EZCANCELFLAG (+)         = '0'
                 AND SMM.GLBL_CMPY_CD            = MDSE.GLBL_CMPY_CD
                 AND SMM.MDSE_CD                 = MDSE.MDSE_CD
                 AND MDSE.RGTN_STS_CD            = #rgtnStsCd#
                 AND MDSE.INVTY_CTRL_FLG         = 'N'
                 AND MDSE.EZCANCELFLAG           = '0'
                 AND SOD.GLBL_CMPY_CD            = SOS.GLBL_CMPY_CD (+)
                 AND SOD.SO_NUM                  = SOS.SO_NUM (+)
                 AND SOS.EZCANCELFLAG (+)        = '0'
                 AND DCD.GLBL_CMPY_CD            = DCII1.GLBL_CMPY_CD (+)
                 AND DCD.CPO_ORD_NUM             = DCII1.CPO_ORD_NUM (+)
                 AND DCD.DS_CPO_CONFIG_PK        = DCII1.DS_CPO_CONFIG_PK (+)
                 AND DCII1.EZCANCELFLAG (+)      = '0'
                 AND DCII1.GLBL_CMPY_CD          = SIR1.GLBL_CMPY_CD (+)
                 AND DCII1.SVC_ISTL_RULE_NUM     = SIR1.SVC_ISTL_RULE_NUM (+)
                 AND SIR1.EZCANCELFLAG (+)       = '0'
                 AND DCD.GLBL_CMPY_CD            = DCII2.GLBL_CMPY_CD (+)
                 AND DCD.CPO_ORD_NUM             = DCII2.CPO_ORD_NUM (+)
                 AND DCII2.DS_CPO_CONFIG_PK (+) IS NULL
                 AND DCII2.EZCANCELFLAG  (+)     = '0'
                 AND DCII2.GLBL_CMPY_CD          = SIR2.GLBL_CMPY_CD (+)
                 AND DCII2.SVC_ISTL_RULE_NUM     = SIR2.SVC_ISTL_RULE_NUM (+)
                 AND SIR2.EZCANCELFLAG (+)       = '0'
                 AND DM.GLBL_CMPY_CD             = SIR.GLBL_CMPY_CD (+)
                 AND DM.SVC_ISTL_RULE_NUM        = SIR.SVC_ISTL_RULE_NUM (+)
                 AND SIR.EZCANCELFLAG (+)        = '0'
                 AND NVL(SIR1.AUTO_ISTL_CALL_FLG, NVL(SIR2.AUTO_ISTL_CALL_FLG, NVL(SIR.AUTO_ISTL_CALL_FLG, 'Y'))) = 'Y'
                 AND NOT EXISTS (
                         SELECT * FROM ORD_CATG_BIZ_CTX OCBC
                         WHERE
                         OCBC.GLBL_CMPY_CD           = CPO.GLBL_CMPY_CD
                         AND OCBC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTp#
                         AND OCBC.DS_ORD_CATG_CD     = CPO.DS_ORD_CATG_CD
<!-- START 2019/06/17 W.Honda [QC#50842, MOD] -->
                         <!-- AND OCBC.DS_ORD_TP_CD       = CPO.DS_ORD_TP_CD -->
                         AND (OCBC.DS_ORD_TP_CD      = CPO.DS_ORD_TP_CD
                             OR  OCBC.DS_ORD_TP_CD   IS NULL)
<!-- END 2019/06/17 W.Honda [QC#50842, MOD] -->
                         AND OCBC.EZCANCELFLAG       = '0'
                 )
                 AND NOT EXISTS (
                         SELECT
                             *
                         FROM
                             SVC_TASK ST
                         WHERE
                             ST.GLBL_CMPY_CD     = SMM.GLBL_CMPY_CD
                         AND ST.SVC_MACH_MSTR_PK = SMM.SVC_MACH_MSTR_PK
                         AND SUBSTR(ST.SVC_TASK_RCV_DT || ST.SVC_TASK_RCV_TM || '00000000000000000', 0, 17) >= CPO.ORD_BOOK_REQ_TS
                         AND ST.EZCANCELFLAG     = '0'
                 )
                 AND CPO.GLBL_CMPY_CD            = OCBCS.GLBL_CMPY_CD (+)
                 AND CPO.DS_ORD_CATG_CD          = OCBCS.DS_ORD_CATG_CD (+)
<!-- START 2019/06/17 W.Honda [QC#50842, ADD] -->
                 AND CPO.DS_ORD_TP_CD            = OCBCS.DS_ORD_TP_CD (+)
<!-- END 2019/06/17 W.Honda [QC#50842, ADD] -->
                 AND OCBCS.ORD_CATG_CTX_TP_CD (+)= #ordCatgCtxTpSvcExch#
                 AND OCBCS.EZCANCELFLAG (+)      = '0'
<!-- START 2019/06/17 W.Honda [QC#50842, ADD] -->
                 AND CPO.GLBL_CMPY_CD            = OCBCS2.GLBL_CMPY_CD (+)
                 AND CPO.DS_ORD_CATG_CD          = OCBCS2.DS_ORD_CATG_CD (+)
                 AND OCBCS2.DS_ORD_TP_CD (+)     IS NULL
                 AND OCBCS2.ORD_CATG_CTX_TP_CD (+)= #ordCatgCtxTpSvcExch#
                 AND OCBCS2.EZCANCELFLAG (+)      = '0'
<!-- END 2019/06/17 W.Honda [QC#50842, ADD] -->
                 AND SMM.GLBL_CMPY_CD            = SCMD.GLBL_CMPY_CD
                 AND SMM.SVC_MACH_MSTR_PK        = SCMD.SVC_MACH_MSTR_PK
                 AND SCMD.EZCANCELFLAG           = '0'
                 AND SCMD.SVC_MACH_RMV_DT       IS NULL
                 AND DCD.GLBL_CMPY_CD            = OLS.GLBL_CMPY_CD
                 AND DCD.ORD_LINE_SRC_CD         = OLS.ORD_LINE_SRC_CD
                 AND OLS.EZCANCELFLAG            = '0'
                 AND OLS.AUTO_SVC_CALL_OPEN_FLG  = 'Y'
                 AND SMM.GLBL_CMPY_CD            = STC.GLBL_CMPY_CD
                 AND SMM.CUR_LOC_NUM             = STC.SHIP_TO_CUST_CD
                 AND STC.EZCANCELFLAG            = '0'
<!-- END 2018/02/28 T.Tomita [QC#24359, ADD] -->
        <!-- START 2023/09/05 K.Watanabe [QC#53408,ADD] -->
        UNION ALL
        <!-- Accessory Serialize Item -->
        SELECT
              SOD.SO_NUM                         AS SO_NUM
             ,DCD.GLBL_CMPY_CD                   AS CPO_CTAC_GLBL_CMPY_CD
             ,DCD.CPO_ORD_NUM                    AS CPO_CTAC_ORD_NUM
             ,DCD.DS_CPO_CONFIG_PK               AS CPO_CTAC_CONFIG_PK
             ,DCD.CPO_DTL_LINE_NUM               AS CPO_CTAC_DTL_LINE_NUM
             ,DCD.CPO_DTL_LINE_SUB_NUM           AS CPO_CTAC_DTL_LINE_SUB_NUM
             ,MDSE.FIRST_PROD_CTRL_CD            AS FIRST_PROD_CTRL_CD
             ,CPO.CUST_ISS_PO_NUM                AS CUST_ISS_PO_NUM
             ,CPO.CUST_ISS_PO_DT                 AS CUST_ISS_PO_DT
             ,SOD.ACTL_DELY_DT                   AS ACTL_DELY_DT
             ,SOD.ACTL_DELY_TM                   AS ACTL_DELY_TM
             ,SMM2.SVC_MACH_MSTR_PK              AS SVC_MACH_MSTR_PK
             ,SMM2.CUST_MACH_CTRL_NUM            AS CUST_MACH_CTRL_NUM
             ,SMM2.SER_NUM                       AS SER_NUM
             ,SMM2.BILL_TO_ACCT_NUM              AS BILL_TO_ACCT_NUM
             ,MDSE.SVC_ISTL_CALL_GRP_NUM         AS SVC_ISTL_CALL_GRP_NUM
             ,SOD.ACTL_DELY_DT                   AS DSOD_ACTL_DELY_DT
             ,SOD.ACTL_DELY_TM                   AS DSOD_ACTL_DELY_TM
             ,DCII1.ISTL_ADDL_CMNT_TXT           AS ISTL_ADDL_CMNT_TXT1
             ,DCII1.RQST_ISTL_DT                 AS RQST_ISTL_DT1
             ,DCII1.RQST_ISTL_TM                 AS RQST_ISTL_TM1
             ,DCII1.ISTL_TECH_CD                 AS ISTL_TECH_CD1
             ,DCII1.EZUPUSERID                   AS EZUPUSERID1
             ,DCII2.ISTL_ADDL_CMNT_TXT           AS ISTL_ADDL_CMNT_TXT2
             ,DCII2.RQST_ISTL_DT                 AS RQST_ISTL_DT2
             ,DCII2.RQST_ISTL_TM                 AS RQST_ISTL_TM2
             ,DCII2.ISTL_TECH_CD                 AS ISTL_TECH_CD2
             ,DCII2.EZUPUSERID                   AS EZUPUSERID2
             ,SOS.EZUPUSERID                     AS SOS_EZUPUSERID
             ,SOS.SCHD_DURN_TM_NUM               AS SCHD_DURN_TM_NUM
             ,SP.SHPG_STS_CD                     AS SHPG_STS_CD
             ,CASE
                WHEN (OCBCS.DS_ORD_CATG_CD IS NOT NULL
                     OR  OCBCS2.DS_ORD_CATG_CD IS NOT NULL) THEN 'Y'
                ELSE 'N'
              END                                AS SVC_EXCH_FLG
             ,SCMD.SVC_CONFIG_MSTR_PK            AS PRE_SVC_CONFIG_MSTR_PK
             ,SMM2.MDSE_CD                       AS MACH_MDSE_CD
             ,DCII1.DS_CPO_ISTL_INFO_PK          AS DS_CPO_ISTL_INFO_PK1
             ,DCII2.DS_CPO_ISTL_INFO_PK          AS DS_CPO_ISTL_INFO_PK2
             ,SOS.TECH_MEET_TRUCK_FLG            AS TECH_MEET_TRUCK_FLG
             ,SMM2.SVC_BY_LINE_BIZ_TP_CD         AS SVC_BY_LINE_BIZ_TP_CD
             ,SOS.SCHD_DELY_DT                   AS SCHD_DELY_DT
             ,SOS.SCHD_DELY_TM                   AS SCHD_DELY_TM
             ,ROW_NUMBER() OVER (PARTITION BY SMM2.SVC_MACH_MSTR_PK ORDER BY SCMD.RGTN_CONFIG_DT DESC, SCMD.EZINTIME DESC) AS CONFIG_ROW_NUMBER
             ,STC.CTRY_CD                        AS CTRY_CD
             ,STC.POST_CD                        AS POST_CD
             ,'Y'                                AS ADD_ASRY_FLG
        FROM
                 SHPG_PLN                        SP
                ,SVC_ISTL_CALL_MACH_INFO         SICM
                ,SHPG_ORD_DTL                    SOD
                ,SVC_MACH_MSTR                   SMM1
                ,SVC_CONFIG_MSTR                 SCM
                ,CPO                             CPO
                ,DS_CPO_CONFIG                   DCC
                ,CPO_DTL                         DCD
                ,MDSE                            MDSE
                ,SHPG_ORD                        SOS
                ,DS_CPO_ISTL_INFO                DCII1
                ,SVC_ISTL_RULE                   SIR1
                ,DS_CPO_ISTL_INFO                DCII2
                ,SVC_ISTL_RULE                   SIR2
                ,SVC_ISTL_RULE                   SIR
                ,ORD_CATG_BIZ_CTX                OCBCS
                ,ORD_CATG_BIZ_CTX                OCBCS2
                ,SVC_CONFIG_MSTR_DTL             SCMD
                ,SVC_MACH_MSTR                   SMM2
                ,ORD_LINE_SRC                    OLS
                ,SHIP_TO_CUST                    STC
        WHERE
                 SP.GLBL_CMPY_CD                   = #glblCmpyCd#
                 AND SP.EZCANCELFLAG               = '0'
                 AND SP.GLBL_CMPY_CD               = SICM.GLBL_CMPY_CD
                 AND SP.TRX_HDR_NUM                = SICM.CPO_ORD_NUM
                 AND SICM.EZCANCELFLAG             = '0'
                 AND SP.GLBL_CMPY_CD               = SOD.GLBL_CMPY_CD
                 AND SP.SHPG_PLN_NUM               = SOD.SHPG_PLN_NUM
                 AND SOD.EZCANCELFLAG              = '0'
                 AND SOD.GLBL_CMPY_CD              = SMM1.GLBL_CMPY_CD
                 AND SOD.SHPG_PLN_NUM              = SMM1.SHPG_PLN_NUM
                 AND SOD.SO_NUM                    = SMM1.SO_NUM
                 AND SOD.SO_SLP_NUM                = SMM1.SO_SLP_NUM
                 AND SMM1.SVC_MACH_MSTR_STS_CD     = #svcMachMstrSts#
                 AND SMM1.SVC_MACH_TP_CD           = #svcMachTpCdAcc#
                 AND SMM1.EZCANCELFLAG             = '0'
                 AND SMM1.GLBL_CMPY_CD             = SCM.GLBL_CMPY_CD (+)
                 AND SMM1.SVC_CONFIG_MSTR_PK       = SCM.SVC_CONFIG_MSTR_PK (+)
                 AND SCM.EZCANCELFLAG (+)          = '0'
                 AND SP.GLBL_CMPY_CD               = CPO.GLBL_CMPY_CD
                 AND SP.TRX_HDR_NUM                = CPO.CPO_ORD_NUM
                 AND CPO.EZCANCELFLAG              = '0'
                 AND SP.GLBL_CMPY_CD               = DCD.GLBL_CMPY_CD
                 AND SP.TRX_HDR_NUM                = DCD.CPO_ORD_NUM
                 AND SP.TRX_LINE_NUM               = DCD.CPO_DTL_LINE_NUM
                 AND SP.TRX_LINE_SUB_NUM           = DCD.CPO_DTL_LINE_SUB_NUM
                 AND DCD.EZCANCELFLAG              = '0'
                 AND NOT EXISTS (
                         SELECT * FROM ORD_CATG_BIZ_CTX OCBC
                         WHERE
                         OCBC.GLBL_CMPY_CD           = CPO.GLBL_CMPY_CD
                         AND OCBC.ORD_CATG_CTX_TP_CD = 'ISTL_CALL_EXCL_ORD_TP'
                         AND OCBC.DS_ORD_CATG_CD     = CPO.DS_ORD_CATG_CD
                         AND (OCBC.DS_ORD_TP_CD      = CPO.DS_ORD_TP_CD
                             OR  OCBC.DS_ORD_TP_CD   IS NULL)
                         AND OCBC.EZCANCELFLAG       = '0'
                 )
                 AND NOT EXISTS (
                     SELECT
                         1
                     FROM
                         CPO_DTL                   DCD
                     WHERE
                         DCC.CONFIG_TP_CD          = 'O02'
                     AND DCC.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD
                     AND DCC.DS_CPO_CONFIG_PK      = DCD.DS_CPO_CONFIG_PK
                     AND DCD.EZCANCELFLAG          = '0'
                     AND DCD.BASE_CMPT_FLG         = #baseCmptFlg#
                     AND ROWNUM                    = 1
                 )
                 AND DCD.GLBL_CMPY_CD              = DCC.GLBL_CMPY_CD
                 AND DCD.DS_CPO_CONFIG_PK          = DCC.DS_CPO_CONFIG_PK
                 <iterate property="configTpCdList" var="configTpCd[]" open="AND DCC.CONFIG_TP_CD IN (" close=")" conjunction=",">
                     #configTpCd[]#
                 </iterate>
                 AND DCC.EZCANCELFLAG              = '0'
                 AND SMM1.GLBL_CMPY_CD             = MDSE.GLBL_CMPY_CD
                 AND SMM1.MDSE_CD                  = MDSE.MDSE_CD
                 AND MDSE.RGTN_STS_CD              = #rgtnStsCd#
                 AND MDSE.INVTY_CTRL_FLG           = 'Y'
                 AND MDSE.SVC_ISTL_CALL_GRP_NUM(+) IS NOT NULL
                 AND MDSE.EZCANCELFLAG             = '0'
                 AND NOT EXISTS (
                     SELECT
                         1
                     FROM
                         CPO_DTL                CPOD
                        ,MDSE                   MDSE
                        ,SVC_MACH_MSTR          SMM
                     WHERE
                         DCC.CONFIG_TP_CD       = 'O06'
                     AND DCC.GLBL_CMPY_CD       = CPOD.GLBL_CMPY_CD
                     AND DCC.DS_CPO_CONFIG_PK   = CPOD.DS_CPO_CONFIG_PK
                     AND CPOD.EZCANCELFLAG      = '0'
                     AND CPOD.GLBL_CMPY_CD      = MDSE.GLBL_CMPY_CD
                     AND (
                         CPOD.MDSE_CD = MDSE.MDSE_CD
                             OR EXISTS (
                                 SELECT
                                     MDSE.MDSE_CD
                                 FROM
                                     ORD_TAKE_MDSE OTM
                                 WHERE
                                     CPOD.GLBL_CMPY_CD = OTM.GLBL_CMPY_CD
                                 AND CPOD.MDSE_CD      = OTM.ORD_TAKE_MDSE_CD
                                 AND OTM.MDSE_CD       = MDSE.MDSE_CD
                                 AND OTM.EZCANCELFLAG  = '0'
                             )
                         )
                     AND MDSE.EZCANCELFLAG      = '0'
                     AND MDSE.GLBL_CMPY_CD      = SMM.GLBL_CMPY_CD
                     AND MDSE.MDSE_CD           = SMM.MDSE_CD
                     AND SMM.EZCANCELFLAG       = '0'
                     AND SMM.SVC_MACH_TP_CD     = #svcMachTpCd#
                     AND ROWNUM                 = '1'
                 )
                 AND SOD.GLBL_CMPY_CD              = SOS.GLBL_CMPY_CD (+)
                 AND SOD.SO_NUM                    = SOS.SO_NUM (+)
                 AND SOS.EZCANCELFLAG (+)          = '0'
                 AND DCD.GLBL_CMPY_CD              = DCII1.GLBL_CMPY_CD (+)
                 AND DCD.CPO_ORD_NUM               = DCII1.CPO_ORD_NUM (+)
                 AND DCD.DS_CPO_CONFIG_PK          = DCII1.DS_CPO_CONFIG_PK (+)
                 AND DCII1.EZCANCELFLAG (+)        = '0'
                 AND DCII1.GLBL_CMPY_CD            = SIR1.GLBL_CMPY_CD (+)
                 AND DCII1.SVC_ISTL_RULE_NUM       = SIR1.SVC_ISTL_RULE_NUM (+)
                 AND SIR1.EZCANCELFLAG (+)         = '0'
                 AND DCD.GLBL_CMPY_CD              = DCII2.GLBL_CMPY_CD (+)
                 AND DCD.CPO_ORD_NUM               = DCII2.CPO_ORD_NUM (+)
                 AND DCII2.DS_CPO_CONFIG_PK (+)    IS NULL
                 AND DCII2.EZCANCELFLAG  (+)       = '0'
                 AND DCII2.GLBL_CMPY_CD            = SIR2.GLBL_CMPY_CD (+)
                 AND DCII2.SVC_ISTL_RULE_NUM       = SIR2.SVC_ISTL_RULE_NUM (+)
                 AND SIR2.EZCANCELFLAG (+)         = '0'
                 AND MDSE.GLBL_CMPY_CD             = SIR.GLBL_CMPY_CD (+)
                 AND MDSE.SVC_ISTL_RULE_NUM        = SIR.SVC_ISTL_RULE_NUM (+)
                 AND SIR.EZCANCELFLAG (+)          = '0'
                 AND NVL(SIR1.AUTO_ISTL_CALL_FLG, NVL(SIR2.AUTO_ISTL_CALL_FLG, NVL(SIR.AUTO_ISTL_CALL_FLG, 'Y'))) = 'Y'
                 AND NOT EXISTS (
                         SELECT * FROM ORD_CATG_BIZ_CTX OCBC
                         WHERE
                         OCBC.GLBL_CMPY_CD           = CPO.GLBL_CMPY_CD
                         AND OCBC.ORD_CATG_CTX_TP_CD = #ordCatgCtxTp#
                         AND OCBC.DS_ORD_CATG_CD     = CPO.DS_ORD_CATG_CD
                         AND (OCBC.DS_ORD_TP_CD      = CPO.DS_ORD_TP_CD
                             OR  OCBC.DS_ORD_TP_CD   IS NULL)
                         AND OCBC.EZCANCELFLAG       = '0'
                 )
                 AND CPO.GLBL_CMPY_CD              = OCBCS.GLBL_CMPY_CD (+)
                 AND CPO.DS_ORD_CATG_CD            = OCBCS.DS_ORD_CATG_CD (+)
                 AND CPO.DS_ORD_TP_CD              = OCBCS.DS_ORD_TP_CD (+)
                 AND OCBCS.ORD_CATG_CTX_TP_CD (+)  = #ordCatgCtxTpSvcExch#
                 AND OCBCS.EZCANCELFLAG (+)        = '0'
                 AND CPO.GLBL_CMPY_CD              = OCBCS2.GLBL_CMPY_CD (+)
                 AND CPO.DS_ORD_CATG_CD            = OCBCS2.DS_ORD_CATG_CD (+)
                 AND OCBCS2.DS_ORD_TP_CD (+)       IS NULL
                 AND OCBCS2.ORD_CATG_CTX_TP_CD (+) = #ordCatgCtxTpSvcExch#
                 AND OCBCS2.EZCANCELFLAG (+)       = '0'
                 AND SMM1.GLBL_CMPY_CD             = SCMD.GLBL_CMPY_CD
                 AND SMM1.SVC_MACH_MSTR_PK         = SCMD.SVC_MACH_MSTR_PK
                 AND SCMD.EZCANCELFLAG             = '0'
                 AND SCMD.SVC_MACH_RMV_DT          IS NULL
                 AND SCMD.GLBL_CMPY_CD             = SMM2.GLBL_CMPY_CD
                 AND SCMD.PRNT_SVC_MACH_MSTR_PK    = SMM2.SVC_MACH_MSTR_PK
                 AND SMM2.EZCANCELFLAG             = '0'
                 AND SMM2.GLBL_CMPY_CD             = SICM.GLBL_CMPY_CD
                 AND SMM2.SVC_MACH_MSTR_PK         = SICM.SVC_MACH_MSTR_PK
                 AND NOT EXISTS (
                         SELECT * FROM SVC_TASK ST
                         WHERE
                         ST.GLBL_CMPY_CD           = SMM2.GLBL_CMPY_CD
                         AND ST.SVC_MACH_MSTR_PK   = SMM2.SVC_MACH_MSTR_PK
                         AND ST.SO_NUM             = SMM1.SO_NUM
                         AND ST.EZCANCELFLAG       = '0'
                 )
                 AND DCD.GLBL_CMPY_CD              = OLS.GLBL_CMPY_CD
                 AND DCD.ORD_LINE_SRC_CD           = OLS.ORD_LINE_SRC_CD
                 AND OLS.EZCANCELFLAG              = '0'
                 AND OLS.AUTO_SVC_CALL_OPEN_FLG    = 'Y'
                 AND SMM2.GLBL_CMPY_CD             = STC.GLBL_CMPY_CD
                 AND SMM2.CUR_LOC_NUM              = STC.SHIP_TO_CUST_CD
                 AND STC.EZCANCELFLAG              = '0'
        <!-- END 2023/09/05 K.Watanabe [QC#53408,ADD] -->
            )
        WHERE
            CONFIG_ROW_NUMBER = 1
<!-- END 2018/01/19 K.Kojima [QC#23606, ADD] -->
        ORDER BY
<!-- START 2018/02/28 T.Tomita [QC#24359, MOD] -->
<!--            SO_NUM -->
             CPO_CTAC_ORD_NUM
            ,CPO_CTAC_CONFIG_PK
            ,CPO_CTAC_DTL_LINE_NUM
            ,CPO_CTAC_DTL_LINE_SUB_NUM
<!-- END 2018/02/28 T.Tomita [QC#24359, MOD] -->
    </statement>

    <statement id="getDsSvcCallTpInfo" parameterClass="Map" resultClass="Map">
        SELECT
                  SICGD.DS_SVC_CALL_TP_CD        AS DS_SVC_CALL_TP_CD_DTL
                 ,DSCT.SVC_CALL_PRTY_CD          AS SVC_CALL_PRTY_CD
                 ,DSCT.BYPS_PRF_TECH_FLG         AS BYPS_PRF_TECH_FLG
                 ,SBT.LBOR_CHRG_FLG              AS LBOR_CHRG_FLG
                 ,SBT.PRT_CHRG_FLG               AS PRT_CHRG_FLG

        FROM
                 SVC_ISTL_CALL_GRP     SICG
                ,SVC_ISTL_CALL_GRP_DTL SICGD
                ,DS_SVC_CALL_TP        DSCT
                ,SVC_BILL_TP           SBT
        WHERE
                SICG.GLBL_CMPY_CD                = #glblCmpyCd#
                AND SICG.SVC_ISTL_CALL_GRP_NUM   = #svcIstlCallGrpNum#
                AND SICG.SVC_ISTL_CALL_GRP_FLG   = #svcIstlCallGrpFlg#
                AND SICG.EZCANCELFLAG            = '0'
                AND SICG.GLBL_CMPY_CD            = SICGD.GLBL_CMPY_CD
                AND SICG.SVC_ISTL_CALL_GRP_NUM   = SICGD.SVC_ISTL_CALL_GRP_NUM
                AND SICGD.EZCANCELFLAG           = '0'
                AND SICGD.GLBL_CMPY_CD           = DSCT.GLBL_CMPY_CD
                AND SICGD.DS_SVC_CALL_TP_CD      = DSCT.DS_SVC_CALL_TP_CD
                AND DSCT.EZCANCELFLAG            = '0'
                AND DSCT.GLBL_CMPY_CD            = SBT.GLBL_CMPY_CD
                AND DSCT.SVC_BILL_TP_CD          = SBT.SVC_BILL_TP_CD
                AND SBT.EZCANCELFLAG             = '0'
    </statement>
    <statement id="getCpoCtacPsnInfo" parameterClass="Map" resultClass="Map">
<!-- START 2016/12/19 T.Tomita [QC#16679, MOD] -->
        SELECT
             '1'                        AS SORT_TXT
            ,DCCP.CTAC_PSN_SORT_NUM     AS SORT_NUM
            ,DCCP.DS_CPO_CTAC_PSN_PK    AS DS_CPO_CTAC_PSN_PK
            ,DCCP.CTAC_PSN_TEL_NUM      AS CTAC_PSN_TEL_NUM
            ,DCCP.CTAC_PSN_EXTN_NUM     AS CTAC_PSN_EXTN_NUM
            ,DCCP.CTAC_PSN_EML_ADDR     AS CTAC_PSN_EML_ADDR
<!-- START 2019/08/23 K.Kitachi [QC#52626, MOD] -->
<!--        ,DACC.DS_ACCT_NM            AS SVC_CUST_ATTN_TXT -->
<!--        ,DACC.DS_ACCT_NM            AS SVC_CUST_CLLR_TXT -->
            ,SUBSTR(DCCP.CTAC_PSN_FIRST_NM || ' ' || DCCP.CTAC_PSN_LAST_NM, 1, #len60#)
                                        AS SVC_CUST_ATTN_TXT
            ,SUBSTR(DCCP.CTAC_PSN_FIRST_NM || ' ' || DCCP.CTAC_PSN_LAST_NM, 1, #len60#)
                                        AS SVC_CUST_CLLR_TXT
<!-- END 2019/08/23 K.Kitachi [QC#52626, MOD] -->
            ,DCCP.CTAC_PSN_TEL_NUM      AS SVC_CUST_CLLR_TEL_NUM
            ,DCCP.CTAC_PSN_EXTN_NUM     AS SVC_CUST_CLLR_TEL_EXTN_NUM
        FROM
             CPO             DCPO
<!-- START 2019/08/23 K.Kitachi [QC#52626, DEL] -->
<!--        ,SELL_TO_CUST    DACC -->
<!-- END 2019/08/23 K.Kitachi [QC#52626, DEL] -->
            ,DS_CPO_CTAC_PSN DCCP
        WHERE
                DCPO.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DCPO.CPO_ORD_NUM          = #cpoOrdNum#
            AND DCPO.EZCANCELFLAG         = '0'
<!-- START 2019/08/23 K.Kitachi [QC#52626, DEL] -->
<!--        AND DCPO.GLBL_CMPY_CD         = DACC.GLBL_CMPY_CD -->
<!--        AND DCPO.SHIP_TO_CUST_ACCT_CD = DACC.SELL_TO_CUST_CD -->
<!--        AND DACC.EZCANCELFLAG         = '0' -->
<!-- END 2019/08/23 K.Kitachi [QC#52626, DEL] -->
            AND DCPO.GLBL_CMPY_CD         = DCCP.GLBL_CMPY_CD (+)
            AND DCPO.CPO_ORD_NUM          = DCCP.CPO_ORD_NUM  (+)
            AND DCCP.DS_CPO_CONFIG_PK (+) = #dsCpoConfigPk#
            AND DCCP.CTAC_PSN_TP_CD   (+) = #ctacPsnTpCd#
            AND DCCP.EZCANCELFLAG     (+) = '0'
        UNION ALL
        SELECT
             '2'                        AS SORT_TXT
            ,DCCP.CTAC_PSN_SORT_NUM     AS SORT_NUM
            ,DCCP.DS_CPO_CTAC_PSN_PK    AS DS_CPO_CTAC_PSN_PK
            ,DCCP.CTAC_PSN_TEL_NUM      AS CTAC_PSN_TEL_NUM
            ,DCCP.CTAC_PSN_EXTN_NUM     AS CTAC_PSN_EXTN_NUM
            ,DCCP.CTAC_PSN_EML_ADDR     AS CTAC_PSN_EML_ADDR
<!-- START 2019/08/23 K.Kitachi [QC#52626, MOD] -->
<!--        ,DACC.DS_ACCT_NM            AS SVC_CUST_ATTN_TXT -->
<!--        ,DACC.DS_ACCT_NM            AS SVC_CUST_CLLR_TXT -->
            ,SUBSTR(DCCP.CTAC_PSN_FIRST_NM || ' ' || DCCP.CTAC_PSN_LAST_NM, 1, #len60#)
                                        AS SVC_CUST_ATTN_TXT
            ,SUBSTR(DCCP.CTAC_PSN_FIRST_NM || ' ' || DCCP.CTAC_PSN_LAST_NM, 1, #len60#)
                                        AS SVC_CUST_CLLR_TXT
<!-- END 2019/08/23 K.Kitachi [QC#52626, MOD] -->
            ,DCCP.CTAC_PSN_TEL_NUM      AS SVC_CUST_CLLR_TEL_NUM
            ,DCCP.CTAC_PSN_EXTN_NUM     AS SVC_CUST_CLLR_TEL_EXTN_NUM
        FROM
             CPO             DCPO
<!-- START 2019/08/23 K.Kitachi [QC#52626, DEL] -->
<!--        ,SELL_TO_CUST    DACC -->
<!-- END 2019/08/23 K.Kitachi [QC#52626, DEL] -->
            ,DS_CPO_CTAC_PSN DCCP
        WHERE
                DCPO.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DCPO.CPO_ORD_NUM          = #cpoOrdNum#
            AND DCPO.EZCANCELFLAG         = '0'
<!-- START 2019/08/23 K.Kitachi [QC#52626, DEL] -->
<!--        AND DCPO.GLBL_CMPY_CD         = DACC.GLBL_CMPY_CD -->
<!--        AND DCPO.SHIP_TO_CUST_ACCT_CD = DACC.SELL_TO_CUST_CD -->
<!--        AND DACC.EZCANCELFLAG         = '0' -->
<!-- END 2019/08/23 K.Kitachi [QC#52626, DEL] -->
            AND DCPO.GLBL_CMPY_CD         = DCCP.GLBL_CMPY_CD (+)
            AND DCPO.CPO_ORD_NUM          = DCCP.CPO_ORD_NUM  (+)
            AND DCCP.CTAC_PSN_TP_CD   (+) = #ctacPsnTpCd#
            AND DCCP.EZCANCELFLAG     (+) = '0'
        ORDER BY
             SORT_TXT           ASC
            ,SORT_NUM           ASC
            ,DS_CPO_CTAC_PSN_PK ASC
<!-- END 2016/12/19 T.Tomita [QC#16679, MOD] -->
    </statement>
    <statement id="cntAutoIstlCallForMdl" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)     AS CNT
        FROM
             DS_MDL           DM
            ,SVC_ISTL_RULE    SIR
        WHERE
            DM.GLBL_CMPY_CD        = #glblCmpyCd#
        AND DM.MDL_ID              = #mdlId#
        AND DM.EZCANCELFLAG        = '0'
        AND DM.GLBL_CMPY_CD        = SIR.GLBL_CMPY_CD
        AND DM.SVC_ISTL_RULE_NUM   = SIR.SVC_ISTL_RULE_NUM
        AND SIR.EZCANCELFLAG       = '0'
        AND SIR.AUTO_ISTL_CALL_FLG = 'Y'
    </statement>
    <statement id="getRmvCallForSvcExch" parameterClass="Map" resultClass="Map">
        SELECT
             A.CPO_ORD_NUM              AS CPO_ORD_NUM
            ,C.DS_CPO_CONFIG_PK         AS DS_CPO_CONFIG_PK
            ,G.BYPS_PRF_TECH_FLG        AS BYPS_PRF_TECH_FLG
            ,K.FIRST_PROD_CTRL_CD       AS FIRST_PROD_CTRL_CD
            ,J.SVC_MACH_MSTR_PK         AS SVC_MACH_MSTR_PK
            ,J.CUST_MACH_CTRL_NUM       AS CUST_MACH_CTRL_NUM
            ,J.SER_NUM                  AS SER_NUM
            ,A.CUST_ISS_PO_NUM          AS CUST_ISS_PO_NUM
            ,A.CUST_ISS_PO_DT           AS CUST_ISS_PO_DT
            ,G.DS_SVC_CALL_TP_CD        AS DS_SVC_CALL_TP_CD
            ,H.PRT_CHRG_FLG             AS PRT_CHRG_FLG
            ,H.LBOR_CHRG_FLG            AS LBOR_CHRG_FLG
            ,L.PMT_TERM_CASH_DISC_CD    AS PMT_TERM_CASH_DISC_CD
            ,G.SVC_CALL_PRTY_CD         AS SVC_CALL_PRTY_CD
        FROM
             CPO              A
            ,DS_CPO_CONFIG    C
            ,DS_CPO_RTRN_DTL  D
            ,HLD              E
            ,HDD_RMV          F
            ,DS_SVC_CALL_TP   G
            ,SVC_BILL_TP      H
            ,SELL_TO_CUST     I
            ,SVC_MACH_MSTR    J
            ,MDSE             K
            ,DS_ACCT_CR_PRFL  L
        WHERE
            A.GLBL_CMPY_CD             = #glblCmpyCd#
        AND A.CPO_ORD_NUM              = #cpoOrdNum#
        AND A.EZCANCELFLAG             = '0'
        AND A.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
        AND A.CPO_ORD_NUM              = C.CPO_ORD_NUM
        AND C.SVC_CONFIG_MSTR_PK       = #svcConfigMstrPk#
        AND C.CONFIG_CATG_CD           = #configCatgCdIn#
        AND C.EZCANCELFLAG             = '0'
        AND C.GLBL_CMPY_CD             = D.GLBL_CMPY_CD
        AND C.CPO_ORD_NUM              = D.CPO_ORD_NUM
        AND C.DS_CPO_CONFIG_PK         = D.DS_CPO_CONFIG_PK
        AND D.EZCANCELFLAG             = '0'
        AND D.GLBL_CMPY_CD             = E.GLBL_CMPY_CD
        AND D.CPO_ORD_NUM              = E.CPO_ORD_NUM
        AND D.DS_CPO_RTRN_LINE_NUM     = E.CPO_DTL_LINE_NUM
        AND D.DS_CPO_RTRN_LINE_SUB_NUM = E.CPO_DTL_LINE_SUB_NUM
        AND E.REL_FLG                  = 'N'
        AND E.EZCANCELFLAG             = '0'
        AND D.GLBL_CMPY_CD             = F.GLBL_CMPY_CD
        AND D.HDD_RMV_CD               = F.HDD_RMV_CD
        AND F.EZCANCELFLAG             = '0'
        AND F.GLBL_CMPY_CD             = G.GLBL_CMPY_CD
        AND F.WITH_ISTL_CALL_TP_CD     = G.DS_SVC_CALL_TP_CD
        AND G.EZCANCELFLAG             = '0'
        AND G.GLBL_CMPY_CD             = H.GLBL_CMPY_CD
        AND G.SVC_BILL_TP_CD           = H.SVC_BILL_TP_CD
        AND H.EZCANCELFLAG             = '0'
        AND A.GLBL_CMPY_CD             = I.GLBL_CMPY_CD
        AND A.SHIP_TO_CUST_ACCT_CD     = I.SELL_TO_CUST_CD
        AND I.EZCANCELFLAG             = '0'
        AND D.GLBL_CMPY_CD             = J.GLBL_CMPY_CD
        AND D.SVC_MACH_MSTR_PK         = J.SVC_MACH_MSTR_PK
        AND J.EZCANCELFLAG             = '0'
        AND J.GLBL_CMPY_CD             = K.GLBL_CMPY_CD
        AND J.MDSE_CD                  = K.MDSE_CD
        AND K.EZCANCELFLAG             = '0'
        AND J.GLBL_CMPY_CD             = L.GLBL_CMPY_CD (+)
        AND J.BILL_TO_ACCT_NUM         = L.DS_ACCT_NUM (+)
        AND L.EZCANCELFLAG (+)         = '0'
        AND EXISTS (
            SELECT
                *
            FROM
                 DS_CPO_CONFIG    M
                ,CPO_DTL          N
            WHERE
                M.GLBL_CMPY_CD       = C.GLBL_CMPY_CD
            AND M.CPO_ORD_NUM        = C.CPO_ORD_NUM
            AND M.SVC_CONFIG_MSTR_PK = C.SVC_CONFIG_MSTR_PK
            AND M.CONFIG_CATG_CD     = #configCatgCdOut#
            AND M.EZCANCELFLAG       = '0'
            AND M.GLBL_CMPY_CD       = N.GLBL_CMPY_CD
            AND M.CPO_ORD_NUM        = N.CPO_ORD_NUM
            AND M.DS_CPO_CONFIG_PK   = N.DS_CPO_CONFIG_PK
            AND N.EZCANCELFLAG       = '0'
            )

    </statement>
    <statement id="getRmvCallForStandAlone" parameterClass="Map" resultClass="Map">
        SELECT
             A.CPO_ORD_NUM              AS CPO_ORD_NUM
            ,C.DS_CPO_CONFIG_PK         AS DS_CPO_CONFIG_PK
            ,G.BYPS_PRF_TECH_FLG        AS BYPS_PRF_TECH_FLG
            ,K.FIRST_PROD_CTRL_CD       AS FIRST_PROD_CTRL_CD
            ,J.SVC_MACH_MSTR_PK         AS SVC_MACH_MSTR_PK
            ,J.CUST_MACH_CTRL_NUM       AS CUST_MACH_CTRL_NUM
            ,J.SER_NUM                  AS SER_NUM
            ,A.CUST_ISS_PO_NUM          AS CUST_ISS_PO_NUM
            ,A.CUST_ISS_PO_DT           AS CUST_ISS_PO_DT
            ,G.DS_SVC_CALL_TP_CD        AS DS_SVC_CALL_TP_CD
            ,H.PRT_CHRG_FLG             AS PRT_CHRG_FLG
            ,H.LBOR_CHRG_FLG            AS LBOR_CHRG_FLG
            ,L.PMT_TERM_CASH_DISC_CD    AS PMT_TERM_CASH_DISC_CD
            ,G.SVC_CALL_PRTY_CD         AS SVC_CALL_PRTY_CD
        FROM
             CPO              A
            ,DS_CPO_CONFIG    C
            ,DS_CPO_RTRN_DTL  D
            ,HLD              E
            ,HDD_RMV          F
            ,DS_SVC_CALL_TP   G
            ,SVC_BILL_TP      H
            ,SELL_TO_CUST     I
            ,SVC_MACH_MSTR    J
            ,MDSE             K
            ,DS_ACCT_CR_PRFL  L
        WHERE
            A.GLBL_CMPY_CD             = #glblCmpyCd#
        AND A.CPO_ORD_TS           &lt;= #slsDt#
        AND A.EZCANCELFLAG             = '0'
        AND A.GLBL_CMPY_CD             = C.GLBL_CMPY_CD
        AND A.CPO_ORD_NUM              = C.CPO_ORD_NUM
        AND C.CONFIG_CATG_CD           = #configCatgCdIn#
        AND C.EZCANCELFLAG             = '0'
        AND C.GLBL_CMPY_CD             = D.GLBL_CMPY_CD
        AND C.CPO_ORD_NUM              = D.CPO_ORD_NUM
        AND C.DS_CPO_CONFIG_PK         = D.DS_CPO_CONFIG_PK
        AND D.RTRN_LINE_STS_CD         = #rtrnLineStsCd#
        AND D.EZCANCELFLAG             = '0'
        AND D.GLBL_CMPY_CD             = E.GLBL_CMPY_CD
        AND D.CPO_ORD_NUM              = E.CPO_ORD_NUM
        AND D.DS_CPO_RTRN_LINE_NUM     = E.CPO_DTL_LINE_NUM
        AND D.DS_CPO_RTRN_LINE_SUB_NUM = E.CPO_DTL_LINE_SUB_NUM
        AND E.REL_FLG                  = 'N'
        AND E.EZCANCELFLAG             = '0'
        AND D.GLBL_CMPY_CD             = F.GLBL_CMPY_CD
        AND D.HDD_RMV_CD               = F.HDD_RMV_CD
        AND F.EZCANCELFLAG             = '0'
        AND F.GLBL_CMPY_CD             = G.GLBL_CMPY_CD
        AND F.STAND_ALONE_CALL_TP_CD   = G.DS_SVC_CALL_TP_CD
        AND G.EZCANCELFLAG             = '0'
        AND G.GLBL_CMPY_CD             = H.GLBL_CMPY_CD
        AND G.SVC_BILL_TP_CD           = H.SVC_BILL_TP_CD
        AND H.EZCANCELFLAG             = '0'
        AND A.GLBL_CMPY_CD             = I.GLBL_CMPY_CD
        AND A.SHIP_TO_CUST_ACCT_CD     = I.SELL_TO_CUST_CD
        AND I.EZCANCELFLAG             = '0'
        AND D.GLBL_CMPY_CD             = J.GLBL_CMPY_CD
        AND D.SVC_MACH_MSTR_PK         = J.SVC_MACH_MSTR_PK
        AND J.EZCANCELFLAG             = '0'
        AND J.GLBL_CMPY_CD             = K.GLBL_CMPY_CD
        AND J.MDSE_CD                  = K.MDSE_CD
        AND K.EZCANCELFLAG             = '0'
        AND J.GLBL_CMPY_CD             = L.GLBL_CMPY_CD (+)
        AND J.BILL_TO_ACCT_NUM         = L.DS_ACCT_NUM (+)
        AND L.EZCANCELFLAG (+)         = '0'
        AND NOT EXISTS (
            SELECT
                *
            FROM
                 DS_CPO_CONFIG    M
                ,CPO_DTL          N
            WHERE
                M.GLBL_CMPY_CD       = C.GLBL_CMPY_CD
            AND M.CPO_ORD_NUM        = C.CPO_ORD_NUM
            AND M.SVC_CONFIG_MSTR_PK = C.SVC_CONFIG_MSTR_PK
            AND M.CONFIG_CATG_CD     = #configCatgCdOut#
            AND M.EZCANCELFLAG       = '0'
            AND M.GLBL_CMPY_CD       = N.GLBL_CMPY_CD
            AND M.CPO_ORD_NUM        = N.CPO_ORD_NUM
            AND M.DS_CPO_CONFIG_PK   = N.DS_CPO_CONFIG_PK
            AND N.EZCANCELFLAG       = '0'
            )
        AND NOT EXISTS (
            SELECT
                *
            FROM
                SVC_TASK S
            WHERE
                S.GLBL_CMPY_CD      =  J.GLBL_CMPY_CD
            AND S.SVC_MACH_MSTR_PK  =  J.SVC_MACH_MSTR_PK
            <iterate property="dsSvcCallTpCdList" var="dsSvcCallTpCd[]" open=" AND S.DS_SVC_CALL_TP_CD IN (" close=")" conjunction=",">
                #dsSvcCallTpCd[]#
            </iterate>
            <iterate property="svcTaskStsCdList" var="svcTaskStsCd[]" open=" AND S.SVC_TASK_STS_CD   NOT IN (" close=")" conjunction=",">
                #svcTaskStsCd[]#
            </iterate>
            AND S.EZCANCELFLAG      =  '0'
            )
        ORDER BY
             D.CPO_ORD_NUM
            ,D.DS_CPO_CONFIG_PK
            ,D.DS_CPO_RTRN_LINE_NUM
            ,D.DS_CPO_RTRN_LINE_SUB_NUM

    </statement>

<!-- START 2017/07/04 K.Kitachi [QC#19698, ADD] -->
    <statement id="getFsrTaskList" parameterClass="Map" resultClass="Map">
        WITH FSR_LST AS (
            SELECT
                 E.GLBL_CMPY_CD
                ,E.TRX_HDR_NUM
                ,E.DS_CPO_CONFIG_PK
                ,B.FSR_NUM
                ,B.SVC_TASK_NUM
                ,C.SVC_MACH_MSTR_PK
                ,C.SER_NUM
                ,C.CUST_MACH_CTRL_NUM
                ,RPAD(D.ACTL_DELY_DT || D.ACTL_DELY_TM, 17, '0') ACTL_DELY_TS
<!-- add start 2018/08/07 QC#27566 -->
                ,A.FSR_VISIT_NUM
<!-- add end 2018/08/07 QC#27566 -->
                <!-- START 2019/02/15 K.Kitachi [QC#30165, ADD] -->
                ,B.DS_SVC_CALL_TP_CD
                <!-- END 2019/02/15 K.Kitachi [QC#30165, ADD] -->
            FROM
                 FSR_VISIT     A
                ,SVC_TASK      B
                ,SVC_MACH_MSTR C
                ,SHPG_ORD_DTL  D
                ,SHPG_ORD      E
                ,SHPG_PLN      F
            WHERE
                    A.GLBL_CMPY_CD      = #glblCmpyCd#
                AND A.FSR_VISIT_STS_CD  = #svcTaskStsPendIstl#
                AND A.EZCANCELFLAG      = '0'
                AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
                AND A.SVC_TASK_NUM      = B.SVC_TASK_NUM
                AND B.EZCANCELFLAG      = '0'
                AND B.GLBL_CMPY_CD      = C.GLBL_CMPY_CD
                AND B.SVC_MACH_MSTR_PK  = C.SVC_MACH_MSTR_PK
                AND C.EZCANCELFLAG      = '0'
                AND C.GLBL_CMPY_CD      = D.GLBL_CMPY_CD
                AND C.SO_NUM            = D.SO_NUM
                AND C.SO_SLP_NUM        = D.SO_SLP_NUM
                AND D.EZCANCELFLAG      = '0'
                AND D.GLBL_CMPY_CD      = E.GLBL_CMPY_CD
                AND D.SO_NUM            = E.SO_NUM
                AND E.EZCANCELFLAG      = '0'
                AND D.GLBL_CMPY_CD      = F.GLBL_CMPY_CD
                AND D.SHPG_PLN_NUM      = F.SHPG_PLN_NUM
                AND F.SHPG_STS_CD       = #shpgStsArv#
                AND F.EZCANCELFLAG      = '0'
        )
        ,CONFIG_TECH AS (
            SELECT
                 DCII.CPO_ORD_NUM
                ,DCII.DS_CPO_CONFIG_PK
                ,DCII.ISTL_TECH_CD
                ,ROW_NUMBER() OVER(PARTITION BY DCII.CPO_ORD_NUM, DCII.DS_CPO_CONFIG_PK ORDER BY DCII.DS_CPO_ISTL_INFO_PK) AS ROW_NUM
            FROM
                 FSR_LST          FL
                ,DS_CPO_ISTL_INFO DCII
            WHERE
                    FL.GLBL_CMPY_CD     = DCII.GLBL_CMPY_CD
                AND FL.TRX_HDR_NUM      = DCII.CPO_ORD_NUM
                AND FL.DS_CPO_CONFIG_PK = DCII.DS_CPO_CONFIG_PK
                AND DCII.EZCANCELFLAG   = '0'
        )
        ,CPO_TECH AS (
            SELECT
                 DCII.CPO_ORD_NUM
                ,DCII.ISTL_TECH_CD
                ,ROW_NUMBER() OVER(PARTITION BY DCII.CPO_ORD_NUM ORDER BY DCII.DS_CPO_ISTL_INFO_PK) AS ROW_NUM
            FROM
                 FSR_LST          FL
                ,DS_CPO_ISTL_INFO DCII
            WHERE
                    FL.GLBL_CMPY_CD     = DCII.GLBL_CMPY_CD
                AND FL.TRX_HDR_NUM      = DCII.CPO_ORD_NUM
                AND DCII.EZCANCELFLAG   = '0'
        )
        SELECT
             FSRL.FSR_NUM
            ,FSRL.SVC_TASK_NUM
            ,FSRL.SVC_MACH_MSTR_PK
            ,FSRL.SER_NUM
            ,FSRL.CUST_MACH_CTRL_NUM
            ,NVL(CONT.ISTL_TECH_CD, CPOT.ISTL_TECH_CD) AS ISTL_TECH_CD
            ,FSRL.ACTL_DELY_TS
<!-- add start 2018/08/07 QC#27566 -->
            ,FSRL.FSR_VISIT_NUM
<!-- add end 2018/08/07 QC#27566 -->
            <!-- START 2019/02/15 K.Kitachi [QC#30165, ADD] -->
            ,FSRL.DS_SVC_CALL_TP_CD
            <!-- END 2019/02/15 K.Kitachi [QC#30165, ADD] -->
        FROM
             FSR_LST     FSRL
            ,CONFIG_TECH CONT
            ,CPO_TECH    CPOT
        WHERE
                FSRL.TRX_HDR_NUM          = CONT.CPO_ORD_NUM      (+)
            AND FSRL.DS_CPO_CONFIG_PK     = CONT.DS_CPO_CONFIG_PK (+)
            AND CONT.ROW_NUM          (+) = 1
            AND FSRL.TRX_HDR_NUM          = CPOT.CPO_ORD_NUM      (+)
            AND CPOT.ROW_NUM          (+) = 1
        ORDER BY
            FSRL.FSR_NUM
    </statement>
<!-- END 2017/07/04 K.Kitachi [QC#19698, ADD] -->
<!-- START 2018/03/12 T.Tomita [QC#23424, ADD] -->
    <statement id="getStartTsForSvcExchng" parameterClass="Map" resultClass="Map">
        SELECT
             A.FSR_NUM
            ,A.SVC_TASK_NUM
            ,ERL_START_TS
            ,LATE_START_TS
        FROM
            SVC_TASK A
        WHERE
            A.GLBL_CMPY_CD    =  #glblCmpyCd#
        AND A.EZCANCELFLAG    =  '0'
        AND A.SO_NUM          =  #soNum#
        AND A.SVC_TASK_NUM    &lt;&gt; #svcTaskNum#
        AND EXISTS (
            SELECT
                *
            FROM
                FSR_VISIT B
            WHERE
                B.GLBL_CMPY_CD     = A.GLBL_CMPY_CD
            AND B.FSR_NUM          = A.FSR_NUM
            AND B.SVC_TASK_NUM     = A.SVC_TASK_NUM
            AND B.EZCANCELFLAG     = '0'
            AND B.FSR_VISIT_STS_CD = #fsrVisitStsCd#
        )
        ORDER BY
             A.FSR_NUM
            ,A.SVC_TASK_NUM
    </statement>
<!-- END 2018/03/12 T.Tomita [QC#23424, ADD] -->
<!-- add start 2018/08/07 QC#27566 -->
    <statement id="getTechInfo" parameterClass="Map" resultClass="Map">
        SELECT
             B.PSN_CD
            ,B.PSN_TP_CD
        FROM
             FSR_VISIT A
            ,S21_PSN   B
        WHERE
            A.GLBL_CMPY_CD   = #glblCmpyCd#
        AND A.FSR_NUM        = #fsrNum#
        AND A.FSR_VISIT_NUM  = #fsrVisitNum#
        AND A.EZCANCELFLAG   = '0'
        AND A.GLBL_CMPY_CD   = B.GLBL_CMPY_CD
        AND A.TECH_CD        = B.PSN_CD
        AND B.DEL_FLG        = 'N'
        AND B.EZCANCELFLAG   = '0'
    </statement>
<!-- add end 2018/08/07 QC#27566 -->
</sqlMap>
