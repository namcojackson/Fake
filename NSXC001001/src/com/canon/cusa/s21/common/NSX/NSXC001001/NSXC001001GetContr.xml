<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSXC001001GetContr">
    <statement id="getContrDtlByMachMstrPk" parameterClass="Map" resultClass="Map">
        SELECT
             DCD.GLBL_CMPY_CD                   AS GLBL_CMPY_CD
            ,DCD.DS_CONTR_DTL_PK                AS DS_CONTR_DTL_PK
            ,CNT.DS_CONTR_PK                    AS DS_CONTR_PK
        FROM
             DS_CONTR_DTL    DCD
            ,DS_CONTR        CNT
        WHERE
                DCD.GLBL_CMPY_CD       = #glblCmpyCd#
            AND DCD.SVC_MACH_MSTR_PK   = #svcMachMstrPk#
            AND DCD.CONTR_EFF_FROM_DT  &lt;= #contrEffFromDt#
            <!-- START 2017/08/29 K.Yamada [QC#20811,MOD] -->
            <!-- AND DCD.CONTR_EFF_THRU_DT  &gt;= #contrEffThruDt# -->
            AND NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT)  &gt;= #contrEffThruDt#
            <!-- END 2017/08/29 K.Yamada [QC#20811,MOD] -->
            AND DCD.EZCANCELFLAG       = '0'
            AND DCD.GLBL_CMPY_CD       = CNT.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK        = CNT.DS_CONTR_PK
            <isNotNull property="dsContrCatgCd">
            AND CNT.DS_CONTR_CATG_CD   &lt;&gt; #dsContrCatgCd#
            </isNotNull>
            AND CNT.EZCANCELFLAG       = '0'
            AND ROWNUM                 = 1
    </statement>
    <!-- START 2018/05/25 K.Kim [QC#15410(Sol#246),ADD] -->
    <statement id="getContrDtlByMachMstrPkList" parameterClass="Map" resultClass="Map">
        SELECT
             DCD.GLBL_CMPY_CD                   AS GLBL_CMPY_CD
            ,DCD.DS_CONTR_DTL_PK                AS DS_CONTR_DTL_PK
            ,CNT.DS_CONTR_PK                    AS DS_CONTR_PK
        FROM
             DS_CONTR_DTL    DCD
            ,DS_CONTR        CNT
        WHERE
                DCD.GLBL_CMPY_CD       = #glblCmpyCd#
            AND DCD.SVC_MACH_MSTR_PK   = #svcMachMstrPk#
            AND DCD.CONTR_EFF_FROM_DT  &lt;= #contrEffFromDt#
            AND NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT)  &gt;= #contrEffThruDt#
            <!-- START 2024/04/01 T.Fukuta [QC#63548,ADD] -->
            AND (DCD.MAN_TRMN_TP_CD IS NULL OR DCD.MAN_TRMN_TP_CD &lt;&gt; #manTrmnTpCd#)
            <!-- END 2024/04/01 T.Fukuta [QC#63548,ADD] -->
            AND DCD.EZCANCELFLAG       = '0'
            AND DCD.GLBL_CMPY_CD       = CNT.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK        = CNT.DS_CONTR_PK
            <isNotNull property="dsContrCatgCd">
            AND CNT.DS_CONTR_CATG_CD   &lt;&gt; #dsContrCatgCd#
            </isNotNull>
            AND CNT.EZCANCELFLAG       = '0'
    </statement>
    <!-- END   2018/05/25 K.Kim [QC#15410(Sol#246),ADD] -->
<!-- mod start 2016/12/08 CSA Defect#15200 -->
<!-- add start 2016/09/20 CSA Defect#12898 -->
    <statement id="getContrDtlInclWarrantyForSplyOrd" parameterClass="Map" resultClass="Map">
        SELECT
             DCD.GLBL_CMPY_CD                   AS GLBL_CMPY_CD
            ,NVL(PRNT.DS_CONTR_DTL_PK, DCD.DS_CONTR_DTL_PK)
                                                AS DS_CONTR_DTL_PK
            ,CNT.DS_CONTR_PK                    AS DS_CONTR_PK
        FROM
             DS_CONTR_DTL    DCD
            ,DS_CONTR        CNT
            ,DS_CONTR_DTL    PRNT
        WHERE
                DCD.GLBL_CMPY_CD       = #glblCmpyCd#
            AND DCD.DS_CONTR_DTL_PK    = #dsContrDtlPk#
            <!-- START 2024/04/01 T.Fukuta [QC#63548,ADD] -->
            AND (DCD.MAN_TRMN_TP_CD IS NULL OR DCD.MAN_TRMN_TP_CD &lt;&gt; #manTrmnTpCd#)
            <!-- END 2024/04/01 T.Fukuta [QC#63548,ADD] -->
            AND DCD.EZCANCELFLAG       = '0'
            AND DCD.GLBL_CMPY_CD       = CNT.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK        = CNT.DS_CONTR_PK
            AND CNT.EZCANCELFLAG       = '0'
            AND DCD.GLBL_CMPY_CD       = PRNT.GLBL_CMPY_CD (+)
            AND DCD.PRNT_DS_CONTR_DTL_PK
                                       = PRNT.DS_CONTR_DTL_PK (+)
            AND PRNT.EZCANCELFLAG (+)  = '0'
            AND PRNT.DS_CONTR_DTL_TP_CD (+)
                                       = #dsContrDtlTpFleet#
            AND ROWNUM                 = 1
    </statement>
<!-- add end 2016/09/20 CSA Defect#12898 -->
<!-- mod end 2016/12/08 CSA Defect#15200 -->
    <statement id="getContrDtlBySerNum" parameterClass="Map" resultClass="Map">
        SELECT
             DCD.GLBL_CMPY_CD                   AS GLBL_CMPY_CD
            ,DCD.DS_CONTR_DTL_PK                AS DS_CONTR_DTL_PK
        FROM
             SVC_MACH_MSTR   MAC
            ,DS_CONTR_DTL    DCD
            ,DS_CONTR        CNT
        WHERE
                MAC.GLBL_CMPY_CD       = #glblCmpyCd#
            AND MAC.EZCANCELFLAG       = '0'
            AND MAC.SER_NUM            = #serNum#
            AND MAC.GLBL_CMPY_CD       = DCD.GLBL_CMPY_CD 
            AND MAC.SVC_MACH_MSTR_PK   = DCD.SVC_MACH_MSTR_PK
            AND DCD.CONTR_EFF_FROM_DT  &lt;= #contrEffFromDt#
            <!-- START 2017/08/29 K.Yamada [QC#20811,MOD] -->
            <!-- AND DCD.CONTR_EFF_THRU_DT  &gt;= #contrEffThruDt# -->
            AND NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT)  &gt;= #contrEffThruDt#
            <!-- END 2017/08/29 K.Yamada [QC#20811,MOD] -->
            AND DCD.EZCANCELFLAG       = '0'
            AND DCD.GLBL_CMPY_CD       = CNT.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK        = CNT.DS_CONTR_PK
            AND CNT.DS_CONTR_CATG_CD   &lt;&gt; #dsContrCatgCd#
            AND CNT.EZCANCELFLAG       = '0'
            AND ROWNUM                 = 1
    </statement>
<!-- add start 2016/08/25 CSA Defect#13301 -->
    <statement id="getEttlAvalContrDtlByMachMstrPk" parameterClass="Map" resultClass="Map">
        SELECT
             DCD.GLBL_CMPY_CD                   AS GLBL_CMPY_CD
            ,DCD.DS_CONTR_DTL_PK                AS DS_CONTR_DTL_PK
            ,CNT.DS_CONTR_PK                    AS DS_CONTR_PK
        FROM
             DS_CONTR_DTL        DCD
            ,DS_CONTR            CNT
            ,DS_CONTR_DTL_STS_V  STS
        WHERE
                DCD.GLBL_CMPY_CD       = #glblCmpyCd#
            AND DCD.SVC_MACH_MSTR_PK   = #svcMachMstrPk#
            AND DCD.CONTR_EFF_FROM_DT  &lt;= #contrEffFromDt#
            <!-- START 2017/01/04 K.Kojima [QC#16513,MOD] -->
            <!-- AND DCD.CONTR_EFF_THRU_DT  &gt;= #contrEffThruDt# -->
            AND NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT)  &gt;= #contrEffThruDt#
            <!-- END 2017/01/04 K.Kojima [QC#16513,MOD] -->
            <!-- START 2024/04/01 T.Fukuta [QC#63548,ADD] -->
            AND (DCD.MAN_TRMN_TP_CD IS NULL OR DCD.MAN_TRMN_TP_CD &lt;&gt; #manTrmnTpCd#)
            <!-- END 2024/04/01 T.Fukuta [QC#63548,ADD] -->
            AND DCD.EZCANCELFLAG       = '0'
            AND DCD.GLBL_CMPY_CD       = CNT.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK        = CNT.DS_CONTR_PK
            <!-- START 2017/01/04 K.Kojima [QC#16513,DEL] -->
            <!-- <isNotNull property="dsContrCatgCd"> -->
            <!-- AND CNT.DS_CONTR_CATG_CD   &lt;&gt; #dsContrCatgCd# -->
            <!-- </isNotNull> -->
            <!-- END 2017/01/04 K.Kojima [QC#16513,DEL] -->
            AND CNT.EZCANCELFLAG       = '0'
            AND DCD.GLBL_CMPY_CD       = STS.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_PK    = STS.DS_CONTR_DTL_PK
            AND STS.ETTL_AVAL_FLG      = 'Y'
            AND STS.EZCANCELFLAG       = '0'
            <!-- START 2017/01/04 K.Kojima [QC#16513,DEL] -->
            <!-- AND ROWNUM                 = 1 -->
            <!-- END 2017/01/04 K.Kojima [QC#16513,DEL] -->
    </statement>
<!-- add end 2016/08/25 CSA Defect#13301 -->
</sqlMap>
