<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSXC001001ContrValidation">
    <statement id="getDuplicateContr" parameterClass="Map" resultClass="java.math.BigDecimal">
        SELECT
            A.DS_CONTR_DTL_PK
        FROM
            DS_CONTR_DTL A
            ,DS_CONTR B
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.SVC_MACH_MSTR_PK  = #svcMachMstrPk#
            <isNotNull property="dsContrDtlPk">
            AND A.DS_CONTR_DTL_PK   &lt;&gt; #dsContrDtlPk#
            </isNotNull>
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK       = B.DS_CONTR_PK
            AND B.EZCANCELFLAG      = '0'
            <isEqual property="wtyFlg" compareValue="N">
            AND B.DS_CONTR_CATG_CD  &lt;&gt; #warranty#
            </isEqual>
            <isEqual property="wtyFlg" compareValue="Y">
            AND B.DS_CONTR_CATG_CD  = #warranty#
            </isEqual>
            AND A.CONTR_EFF_FROM_DT &lt;= #thruDate#
<!-- [QC#6391,MOD]START -->
            AND NVL(A.CONTR_CLO_DT, A.CONTR_EFF_THRU_DT) &gt;= #fromDate#
<!-- [QC#6391,MOD]END -->
            AND A.DS_CONTR_DTL_STS_CD &lt;&gt; #dsContrDtlStsCd_Cancelled#
            <!-- START 2022/02/04 K.Kitachi [QC#59684, ADD] -->
            AND (A.MAN_TRMN_TP_CD IS NULL OR A.MAN_TRMN_TP_CD &lt;&gt; #manTrmnTpCd#)
            <!-- END 2022/02/04 K.Kitachi [QC#59684, ADD] -->
    </statement>

<!-- [QC#18534,ADD]START -->
<!-- mod start 2017/10/06 QC#21639 -->
    <statement id="getMachineNotInstalledCount" parameterClass="Map" resultClass="java.math.BigDecimal">
        SELECT
            COUNT(*)
        FROM
             SVC_MACH_MSTR  SMM
        WHERE
                SMM.GLBL_CMPY_CD         = #glblCmpyCd#
            AND SMM.SVC_MACH_MSTR_PK     = #svcMachMstrPk#
            AND SMM.SVC_MACH_MSTR_STS_CD &lt;&gt; #installed#
            AND SMM.EZCANCELFLAG         = '0'
    </statement>
<!-- mod end 2017/10/06 QC#21639 -->
<!-- [QC#18534,ADD]END -->

    <!-- START 2019/01/09 K.Kitachi [QC#26928, ADD] -->
    <statement id="countDupPoDt" parameterClass="Map" resultClass="java.math.BigDecimal">
        SELECT
            COUNT(1)
        FROM
            DS_CONTR_CR_CARD_PO A
        WHERE
                A.GLBL_CMPY_CD           = #glblCmpyCd#
            <isNotNull property="dsContrCrCardPoPk">
            AND (
                    A.DS_CONTR_CR_CARD_PO_PK &lt;&gt; #dsContrCrCardPoPk#
                 OR (
                         A.CUST_PO_NUM &lt;&gt; #poNum#
                     AND (A.PO_FROM_DT &lt;&gt; #fromDt# OR A.PO_DT &lt;&gt; #thruDt#)
                )
            )
            </isNotNull>
            AND A.DS_CONTR_PK            = #dsContrPk#
            <isNotNull property="dsContrDtlPk">
            AND A.DS_CONTR_DTL_PK        = #dsContrDtlPk#
            </isNotNull>
            <isNull property="dsContrDtlPk">
            AND A.DS_CONTR_DTL_PK        IS NULL
            </isNull>
            <isNotNull property="dsContrBllgMtrPk">
            AND A.DS_CONTR_BLLG_MTR_PK   = #dsContrBllgMtrPk#
            </isNotNull>
            <isNull property="dsContrBllgMtrPk">
            AND A.DS_CONTR_BLLG_MTR_PK   IS NULL
            </isNull>
            AND A.DS_CONTR_MACH_LVL_NUM  = #dsContrMachLvlNum#
            AND A.PO_DT                  &gt;= #fromDt#
            AND A.PO_FROM_DT             &lt;= #thruDt#
            AND A.CR_CARD_FLG            = 'N'
            AND A.EZCANCELFLAG           = '0'
            AND ROWNUM                   = 1
    </statement>
    <!-- END 2019/01/09 K.Kitachi [QC#26928, ADD] -->
</sqlMap>
