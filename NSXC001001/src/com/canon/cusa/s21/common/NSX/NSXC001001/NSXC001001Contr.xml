<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSXC001001Contr">
    <statement id="getContrList" parameterClass="Map" resultClass="Map">
        SELECT
            CNT.DS_CONTR_PK
           ,CNT.DS_CONTR_NUM
           ,CNT.DS_CONTR_SQ_NUM
           ,CNT.DS_CONTR_NM
           ,CNT.CONTR_VRSN_EFF_FROM_DT
           ,CNT.CONTR_VRSN_EFF_THRU_DT
           ,CNT.CUST_PO_NUM
           ,CNT.PO_DT
           ,CNT.PMT_TERM_CASH_DISC_CD
           ,CNT.CCY_CD
           ,DCD.CONTR_EFF_FROM_DT
           ,DCD.CONTR_EFF_THRU_DT
           ,DCD.SVC_MACH_MSTR_PK
           ,DCD.SVC_CONFIG_MSTR_PK
           ,DCD.PRNT_DS_CONTR_DTL_PK
           ,DCD.RSP_TM_UP_MN_AOT
           ,DCD.RSP_TM_DOWN_MN_AOT
           ,DCD.DS_CONTR_DTL_PK
           ,DCD.SVC_LBOR_CHRG_TP_CD
           ,DTP.DS_CONTR_TP_NM
        FROM
            DS_CONTR        CNT
           ,DS_CONTR_DTL    DCD
           ,DS_CONTR_TP     DTP
           ,DS_CONTR_DTL_TP DDTP
        WHERE
            CNT.GLBL_CMPY_CD       = #glblCmpyCd#
        <isNull property="dsContrDtlPk">
        <isNotNull property="svcMachMstrPk">
        AND DCD.SVC_MACH_MSTR_PK   = #svcMachMstrPk#
        </isNotNull>
        </isNull>
        <isNotNull property="dsContrDtlPk">
        AND DCD.DS_CONTR_DTL_PK    = #dsContrDtlPk#
        </isNotNull>
        <isEqual property="warranty" compareValue="Y">
        AND CNT.DS_CONTR_TP_CD   = #dsContrTpCd#
        </isEqual>
        <isEqual property="warranty" compareValue="N">
        AND CNT.DS_CONTR_TP_CD   != #dsContrTpCd#
        </isEqual>
        <isNotNull property="svcConfigMstrPk">
        AND DCD.SVC_CONFIG_MSTR_PK = #svcConfigMstrPk#
        </isNotNull>
        AND #svcDt# BETWEEN DCD.CONTR_EFF_FROM_DT AND DCD.CONTR_EFF_THRU_DT
        AND DCD.GLBL_CMPY_CD       = CNT.GLBL_CMPY_CD
        <isNotNull property="dsContrPk">
        AND DCD.DS_CONTR_PK        = #dsContrPk#
        </isNotNull>
        AND DCD.DS_CONTR_PK        = CNT.DS_CONTR_PK
        <isNotNull property="dsContrNum">
        AND CNT.DS_CONTR_NUM       = #dsContrNum#
        </isNotNull>
        AND DTP.GLBL_CMPY_CD           = CNT.GLBL_CMPY_CD
        AND DTP.DS_CONTR_TP_CD         = CNT.DS_CONTR_TP_CD
        AND DDTP.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD
        AND DDTP.DS_CONTR_DTL_TP_CD    = DCD.DS_CONTR_DTL_TP_CD
        AND DCD.EZCANCELFLAG           = '0'
        AND CNT.EZCANCELFLAG           = '0'
        <isNotNull property="mainUnitLineFlg">
        AND DDTP.MAIN_UNIT_LINE_FLG     = #mainUnitLineFlg#
        </isNotNull>
        <isNotNull property="splyLineFlg">
        AND DDTP.SPLY_LINE_FLG          = #splyLineFlg#
        </isNotNull>
        <isNotNull property="fleetLineFlg">
        AND DDTP.FLEET_LINE_FLG         = #fleetLineFlg#
        </isNotNull>
        ORDER BY
            CNT.DS_CONTR_SQ_NUM
    </statement>
    <statement id="getCovList" parameterClass="Map" resultClass="Map">
        SELECT
            CNT.CCY_CD
           ,DCD.CONTR_EFF_FROM_DT
           ,DCD.CONTR_EFF_THRU_DT
           ,DCD.PRNT_DS_CONTR_DTL_PK
           ,DCD.SVC_LBOR_CHRG_TP_CD
           ,CCS.DS_COV_SVC_TP_CD
           ,CCS.DS_COV_SVC_RATE
           ,SCT.SVC_COV_TM_TP_NM
           ,SCT.SVC_COV_FROM_HOUR_MN
           ,SCT.SVC_COV_TO_HOUR_MN
           ,SCT.SVC_COV_SUN_FLG
           ,SCT.SVC_COV_MON_FLG
           ,SCT.SVC_COV_TUE_FLG
           ,SCT.SVC_COV_WED_FLG
           ,SCT.SVC_COV_THU_FLG
           ,SCT.SVC_COV_FRI_FLG
           ,SCT.SVC_COV_SAT_FLG
        FROM
            DS_CONTR        CNT
           ,DS_CONTR_DTL    DCD
           ,CONTR_COV_SVC   CCS
           ,DS_CONTR_DTL_TP DTP
           ,SVC_COV_TM_TP   SCT
        WHERE
            CNT.GLBL_CMPY_CD       = #glblCmpyCd#
    <isNull property="dsContrDtlPk">
        <isNotNull property="svcMachMstrPk">
        AND DCD.SVC_MACH_MSTR_PK   = #svcMachMstrPk#
        </isNotNull>
        <isNotNull property="svcConfigMstrPk">
        AND DCD.SVC_CONFIG_MSTR_PK = #svcConfigMstrPk#
        </isNotNull>
    </isNull>
    <isNotNull property="dsContrDtlPk">
        AND DCD.DS_CONTR_DTL_PK    = #dsContrDtlPk#
    </isNotNull>
        <isEqual property="warranty" compareValue="Y">
        AND CNT.DS_CONTR_TP_CD   = #dsContrTpCd#
        </isEqual>
        <isEqual property="warranty" compareValue="N">
        AND CNT.DS_CONTR_TP_CD   != #dsContrTpCd#
        </isEqual>
        AND #svcDt# BETWEEN DCD.CONTR_EFF_FROM_DT AND DCD.CONTR_EFF_THRU_DT
        AND DCD.GLBL_CMPY_CD       = CNT.GLBL_CMPY_CD
        <isNotNull property="dsContrPk">
        AND DCD.DS_CONTR_PK        = #dsContrPk#
        </isNotNull>
        AND DCD.DS_CONTR_PK        = CNT.DS_CONTR_PK
        <isNotNull property="dsContrNum">
        AND CNT.DS_CONTR_NUM       = #dsContrNum#
        </isNotNull>
        AND CCS.GLBL_CMPY_CD(+)        = DCD.GLBL_CMPY_CD
        AND CCS.DS_CONTR_DTL_PK(+)     = DCD.DS_CONTR_DTL_PK
        AND DTP.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
        AND DTP.DS_CONTR_DTL_TP_CD     = DCD.DS_CONTR_DTL_TP_CD
        AND SCT.GLBL_CMPY_CD(+)        = DCD.GLBL_CMPY_CD
        AND SCT.SVC_COV_TM_TP_CD(+)    = DCD.SVC_COV_TM_TP_CD
        AND DCD.EZCANCELFLAG           = '0'
        AND CNT.EZCANCELFLAG           = '0'
        AND SCT.EZCANCELFLAG(+)        = '0'
        AND CCS.EZCANCELFLAG(+)        = '0'
        <isNotNull property="mainUnitLineFlg">
        AND DTP.MAIN_UNIT_LINE_FLG(+)  = #mainUnitLineFlg#
        </isNotNull>
        <isNotNull property="splyLineFlg">
        AND DTP.SPLY_LINE_FLG(+)       = #splyLineFlg#
        </isNotNull>
        <isNotNull property="fleetLineFlg">
        AND DTP.FLEET_LINE_FLG(+)      = #fleetLineFlg#
        </isNotNull>
        <isNotNull property="sunday">
        AND SCT.SVC_COV_SUN_FLG(+)     = #sunday#
        </isNotNull>
        <isNotNull property="monday">
        AND SCT.SVC_COV_MON_FLG(+)     = #monday#
        </isNotNull>
        <isNotNull property="tuesday">
        AND SCT.SVC_COV_TUE_FLG(+)     = #tuesday#
        </isNotNull>
        <isNotNull property="wednesday">
        AND SCT.SVC_COV_WED_FLG(+)     = #wednesday#
        </isNotNull>
        <isNotNull property="thursday">
        AND SCT.SVC_COV_THU_FLG(+)     = #thursday#
        </isNotNull>
        <isNotNull property="friday">
        AND SCT.SVC_COV_FRI_FLG(+)     = #friday#
        </isNotNull>
        <isNotNull property="saturday">
        AND SCT.SVC_COV_SAT_FLG(+)     = #saturday#
        </isNotNull>
        ORDER BY
            CNT.DS_CONTR_SQ_NUM
    </statement>
    <statement id="getMachMstrPkList" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            A.SVC_MACH_MSTR_PK
        FROM
            (
                SELECT
                    DCD.SVC_MACH_MSTR_PK
                FROM
                    DS_CONTR        DCR
                   ,DS_CONTR_DTL    DCD
                WHERE
                    DCR.GLBL_CMPY_CD    = #glblCmpyCd#
                AND DCR.DS_CONTR_NUM LIKE #dsContrNum#
                AND DCD.SVC_MACH_MSTR_PK IS NOT NULL
                AND DCD.GLBL_CMPY_CD    = DCR.GLBL_CMPY_CD
                AND DCD.DS_CONTR_PK     = DCR.DS_CONTR_PK
                AND DCR.EZCANCELFLAG    = '0'
                AND DCD.EZCANCELFLAG    = '0'
                GROUP BY
                    DCD.SVC_MACH_MSTR_PK
                ORDER BY
                    DCD.SVC_MACH_MSTR_PK
             ) A
         WHERE
             ROWNUM &lt;= #limitCount#
    </statement>

    <statement id="getSvcBillTpCd" parameterClass="Map" resultClass="String">
        WITH BILL_TP_V AS (
            SELECT
                BT.SVC_BILL_TP_CD
            FROM
                SVC_BILL_TP BT
               ,SVC_CHRG_TP CT
            WHERE
                BT.GLBL_CMPY_CD   = #glblCmpyCd#
            AND BT.GLBL_CMPY_CD   = CT.GLBL_CMPY_CD
            AND BT.SVC_CHRG_TP_CD = CT.SVC_CHRG_TP_CD
            AND CT.LBOR_CHRG_FLG  = #lborChrgFlg#
            AND CT.TRVL_CHRG_FLG  = #trvlChrgFlg#
            AND CT.PRT_CHRG_FLG   = #prtChrgFlg#
            <isNotNull property="wtyFlg">
            AND BT.WTY_FLG        = #wtyFlg#
            </isNotNull>
            AND BT.EZCANCELFLAG   = '0'
            AND CT.EZCANCELFLAG   = '0'
            ORDER BY
                BT.SVC_BILL_TP_SORT_NUM
        )
        SELECT
            SVC_BILL_TP_CD
        FROM
            BILL_TP_V
        WHERE
            ROWNUM = 1
    </statement>
</sqlMap>
