<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSXC001001ContractTracking">
    <statement id="getDsContrDtl" parameterClass="Map" resultClass="Map">
        SELECT 
             A.DS_CONTR_DTL_PK
            ,B.BASE_CHRG_FLG
            ,B.USG_CHRG_FLG
        FROM 
             DS_CONTR_DTL    A
            ,DS_CONTR_DTL_TP B
        WHERE 
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        AND A.EZCANCELFLAG          = '0'
        AND A.DS_CONTR_PK           = #dsContrPk#
        <!-- START 2017/09/11 K.Kojima [QC#18435,ADD] -->
        <isNotNull property="slsDt">
        <!-- END 2017/09/11 K.Kojima [QC#18435,ADD] -->
        AND A.CONTR_EFF_FROM_DT &lt;= #slsDt#
        AND A.CONTR_EFF_THRU_DT &gt;= #slsDt#
        <!-- START 2017/09/11 K.Kojima [QC#18435,ADD] -->
        </isNotNull>
        <!-- END 2017/09/11 K.Kojima [QC#18435,ADD] -->
        <!-- START 2017/06/19 T.Mizuki [QC#19256,ADD] -->
        AND A.DS_CONTR_DTL_STS_CD  &lt;&gt;    #dsContrDtlStsOrdr#
        <!-- END 2017/06/19 T.Mizuki [QC#19256,ADD] -->
        AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
        AND A.DS_CONTR_DTL_TP_CD    = B.DS_CONTR_DTL_TP_CD
        AND B.SVC_PRC_FLG           = #svcPrcFlg#
        AND B.EZCANCELFLAG          = '0'
        ORDER BY 
            A.DS_CONTR_DTL_PK
    </statement>

    <statement id="getDsContrBllgMtr" parameterClass="Map" resultClass="BigDecimal">
        SELECT 
            A.DS_CONTR_BLLG_MTR_PK
        FROM 
            DS_CONTR_BLLG_MTR A
        WHERE 
            A.GLBL_CMPY_CD      = #glblCmpyCd#
        AND A.EZCANCELFLAG      = '0'
        AND A.DS_CONTR_DTL_PK   = #dsContrDtlPk#
        ORDER BY 
            A.DS_CONTR_BLLG_MTR_PK
    </statement>

    <statement id="getDsContrPrcEff" parameterClass="Map" resultClass="Map">
        SELECT 
             A.DS_CONTR_PRC_EFF_PK
            ,A.CONTR_PRC_EFF_FROM_DT
            ,A.CONTR_PRC_EFF_THRU_DT
        FROM 
            DS_CONTR_PRC_EFF A
        WHERE 
            A.GLBL_CMPY_CD         =  #glblCmpyCd#
        AND A.EZCANCELFLAG         =  '0'
        AND A.DS_CONTR_DTL_PK      =  #dsContrDtlPk#
        <isNull property="dsContrBllgMtrPk">
        AND A.DS_CONTR_BLLG_MTR_PK IS NULL
        AND A.BASE_CHRG_FLG        =  'Y'
        </isNull>
        <isNotNull property="dsContrBllgMtrPk">
        AND A.DS_CONTR_BLLG_MTR_PK = #dsContrBllgMtrPk#
        AND A.USG_CHRG_FLG         =  'Y'
        </isNotNull>
        ORDER BY 
            A.DS_CONTR_PRC_EFF_PK
    </statement>
</sqlMap>
