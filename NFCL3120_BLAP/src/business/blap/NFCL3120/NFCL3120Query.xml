<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NFCL3120Query">

    <!-- *********************************************************** -->
    <!-- ********** Bean Definition ******************************** -->
    <!-- *********************************************************** -->
    <typeAlias alias="NFCL3120_ASMsg"   type="business.blap.NFCL3120.NFCL3120_ASMsg"/>

    <statement id="searchBankAcct_Customer_Identified" parameterClass="Map" resultMap="result.searchBankAcct_Customer_Identified">
        SELECT
             DS_BANK_ACCT_NUM_A1
            ,DS_BANK_ACCT_NM_A1
            ,DS_BANK_ACCT_PK_A1
            ,DS_ACCT_NUM_A1
            ,DS_ACCT_NM_A1
            ,DS_BANK_CD_A1
            ,DS_BANK_NM_A1
            ,BANK_RTE_NUM_A1
            ,DS_BANK_BR_NM_A1
            ,EFF_FROM_DT_A1
            ,EFF_THRU_DT_A1
            ,XX_NUM_A1
        FROM
            (
        SELECT
             XX.DS_BANK_ACCT_NUM_A1
            ,XX.DS_BANK_ACCT_NM_A1
            ,XX.DS_BANK_ACCT_PK_A1
            ,XX.DS_ACCT_NUM_A1
            ,XX.DS_ACCT_NM_A1
            ,XX.DS_BANK_CD_A1
            ,XX.DS_BANK_NM_A1
            ,XX.BANK_RTE_NUM_A1
            ,XX.DS_BANK_BR_NM_A1
            ,XX.EFF_FROM_DT_A1
            ,XX.EFF_THRU_DT_A1
            ,XX.XX_NUM_A1
        FROM
            (
                SELECT 
                     A.DS_BANK_ACCT_NUM AS DS_BANK_ACCT_NUM_A1
                    ,A.DS_BANK_ACCT_NM  AS DS_BANK_ACCT_NM_A1
                    ,A.DS_BANK_ACCT_PK  AS DS_BANK_ACCT_PK_A1
                    ,(CASE WHEN D.COUNT &gt; 1 THEN '*' ELSE E.SELL_TO_CUST_CD END)     AS DS_ACCT_NUM_A1
                    ,(CASE WHEN D.COUNT &gt; 1 THEN '*' ELSE E.DS_ACCT_NM END)      AS DS_ACCT_NM_A1
                    ,B.DS_BANK_CD       AS DS_BANK_CD_A1
                    ,B.DS_BANK_NM       AS DS_BANK_NM_A1
                    ,C.BANK_RTE_NUM     AS BANK_RTE_NUM_A1
                    ,C.DS_BANK_BR_NM    AS DS_BANK_BR_NM_A1
                    ,MAX(A.EFF_FROM_DT) AS EFF_FROM_DT_A1
                    ,MAX(A.EFF_THRU_DT) AS EFF_THRU_DT_A1
                    ,COUNT(*)           AS XX_NUM_A1
                FROM
                     DS_BANK_ACCT             A
                    ,DS_BANK                  B
                    ,DS_BANK_BR               C
                    ,(
                        SELECT
                             X.DS_BANK_ACCT_PK
                            ,MAX(X.DS_ACCT_CUST_PK) AS DS_ACCT_CUST_PK
                            ,COUNT(*)               AS COUNT
                        FROM
                            DS_CUST_BANK_ACCT_RELN X
                        WHERE
                                X.GLBL_CMPY_CD  = #glblCmpyCd#
                            AND X.EZCANCELFLAG  = '0'
                        GROUP BY
                            X.DS_BANK_ACCT_PK
                     ) D
                    ,SELL_TO_CUST             E
                WHERE
                        A.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
                    AND A.GLBL_CMPY_CD      = C.GLBL_CMPY_CD
                    AND A.GLBL_CMPY_CD      = E.GLBL_CMPY_CD

                    AND A.DS_BANK_CD        = B.DS_BANK_CD
                    AND A.DS_BANK_ACCT_TP_CD= #dsBankAcctTpCd#
                    AND (
                         (A.BANK_RTE_NUM      = C.BANK_RTE_NUM)
                        OR
                         (A.BANK_RTE_NUM IS NULL AND C.BANK_RTE_NUM IS NULL)
                    )
                    AND A.DS_BANK_BR_PK     = C.DS_BANK_BR_PK
                    AND A.DS_BANK_ACCT_PK   = D.DS_BANK_ACCT_PK
<!--
                <isNotNull property="dsBankAcctNum">
                    AND A.DS_BANK_ACCT_NUM  = #dsBankAcctNum#
                </isNotNull>
                <isNotNull property="dsBankCd">
                    AND B.DS_BANK_CD        = #dsBankCd#
                </isNotNull>
                <isNotNull property="bankRteNum">
                    AND C.BANK_RTE_NUM      = #bankRteNum#
                </isNotNull>
-->
<!--
                    AND D.EFF_FROM_DT   &lt;= #procDt#
                    AND (CASE WHEN D.EFF_THRU_DT IS NULL THEN '99991231' ELSE D.EFF_THRU_DT END) &gt;= #procDt#
-->
<!-- QC#13480
                    AND A.EFF_FROM_DT   &lt;= #procDt#
                    AND (CASE WHEN A.EFF_THRU_DT IS NULL THEN '99991231' ELSE A.EFF_THRU_DT END) &gt;= #procDt#
-->
                    AND D.DS_ACCT_CUST_PK   = E.SELL_TO_CUST_PK

                <isNotNull property="dsAcctNm">
                    AND E.DS_ACCT_NM        LIKE #dsAcctNm#
                </isNotNull>
                <isNotNull property="dsBankAcctNm">
                    AND A.DS_BANK_ACCT_NM   LIKE #dsBankAcctNm#
                </isNotNull>
                <isNotNull property="dsBankBrNm">
                    AND C.DS_BANK_BR_NM     LIKE #dsBankBrNm#
                </isNotNull>
                <isNotNull property="bankRteNum">
                    AND C.BANK_RTE_NUM      = #bankRteNum#
                </isNotNull>
                
                    AND A.EZCANCELFLAG      = '0'
                    AND B.EZCANCELFLAG      = '0'
                    AND C.EZCANCELFLAG      = '0'
                    AND E.EZCANCELFLAG      = '0'

                GROUP BY
                     A.DS_BANK_ACCT_NUM
                    ,A.DS_BANK_ACCT_NM
                    ,A.DS_BANK_ACCT_PK
                    ,D.COUNT
                    ,E.SELL_TO_CUST_CD
                    ,E.DS_ACCT_NM
                    ,B.DS_BANK_CD
                    ,B.DS_BANK_NM
                    ,C.BANK_RTE_NUM
                    ,C.DS_BANK_BR_NM
                UNION
                SELECT 
                     A.DS_BANK_ACCT_NUM AS DS_BANK_ACCT_NUM_A1
                    ,A.DS_BANK_ACCT_NM  AS DS_BANK_ACCT_NM_A1
                    ,A.DS_BANK_ACCT_PK  AS DS_BANK_ACCT_PK_A1
                    ,''                 AS DS_ACCT_NUM_A1
                    ,''                 AS DS_ACCT_NM_A1
                    ,B.DS_BANK_CD       AS DS_BANK_CD_A1
                    ,B.DS_BANK_NM       AS DS_BANK_NM_A1
                    ,C.BANK_RTE_NUM     AS BANK_RTE_NUM_A1
                    ,C.DS_BANK_BR_NM    AS DS_BANK_BR_NM_A1
                    ,MAX(A.EFF_FROM_DT) AS EFF_FROM_DT_A1
                    ,MAX(A.EFF_THRU_DT) AS EFF_THRU_DT_A1
                    ,COUNT(*)           AS XX_NUM_A1
                FROM
                     DS_BANK_ACCT             A
                    ,DS_BANK                  B
                    ,DS_BANK_BR               C
                WHERE
                        A.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
                    AND A.GLBL_CMPY_CD      = C.GLBL_CMPY_CD

                    AND A.DS_BANK_CD        = B.DS_BANK_CD
                    AND A.DS_BANK_ACCT_TP_CD= #dsBankAcctTpCd#
                    AND (
                         (A.BANK_RTE_NUM      = C.BANK_RTE_NUM)
                        OR
                         (A.BANK_RTE_NUM IS NULL AND C.BANK_RTE_NUM IS NULL)
                    )
                    AND A.DS_BANK_BR_PK     = C.DS_BANK_BR_PK
<!--
                <isNotNull property="dsBankAcctNum">
                    AND A.DS_BANK_ACCT_NUM  = #dsBankAcctNum#
                </isNotNull>
                <isNotNull property="dsBankCd">
                    AND B.DS_BANK_CD        = #dsBankCd#
                </isNotNull>
                <isNotNull property="bankRteNum">
                    AND C.BANK_RTE_NUM      = #bankRteNum#
                </isNotNull>
-->
                <isNotNull property="dsBankAcctNm">
                    AND A.DS_BANK_ACCT_NM   LIKE #dsBankAcctNm#
                </isNotNull>
                <isNotNull property="dsBankBrNm">
                    AND C.DS_BANK_BR_NM     LIKE #dsBankBrNm#
                </isNotNull>
                <isNotNull property="bankRteNum">
                    AND C.BANK_RTE_NUM      = #bankRteNum#
                </isNotNull>

                    AND A.EZCANCELFLAG      = '0'
                    AND B.EZCANCELFLAG      = '0'
                    AND C.EZCANCELFLAG      = '0'
                    AND NOT EXISTS(
                        SELECT
                            'X'
                        FROM
                             DS_CUST_BANK_ACCT_RELN   X
                        WHERE
                                X.GLBL_CMPY_CD      = A.GLBL_CMPY_CD
                            AND X.DS_BANK_ACCT_PK   = A.DS_BANK_ACCT_PK
                            AND X.EZCANCELFLAG      = '0'
                    )
                    AND #dsAcctNm#         IS NULL
                GROUP BY
                     A.DS_BANK_ACCT_NUM
                    ,A.DS_BANK_ACCT_NM
                    ,A.DS_BANK_ACCT_PK
                    ,B.DS_BANK_CD
                    ,B.DS_BANK_NM
                    ,C.BANK_RTE_NUM
                    ,C.DS_BANK_BR_NM
            )XX
        ORDER BY
             XX.DS_BANK_ACCT_NUM_A1
            ,XX.DS_ACCT_NUM_A1
            )
        WHERE
            ROWNUM          &lt;= #rowNum#
    </statement>

    <resultMap id="result.searchBankAcct_Customer_Identified" class="NFCL3120_ASMsg">
        <result property="dsBankAcctNum_A1" column="DS_BANK_ACCT_NUM_A1"    javaType="EZDSStringItem" />
        <result property="dsBankAcctNm_A1"  column="DS_BANK_ACCT_NM_A1"     javaType="EZDSStringItem" />
        <result property="dsBankAcctPk_A1"  column="DS_BANK_ACCT_PK_A1"     javaType="EZDSBigDecimalItem" />
        <result property="dsAcctNum_A1"     column="DS_ACCT_NUM_A1"         javaType="EZDSStringItem" />
        <result property="dsAcctNm_A1"      column="DS_ACCT_NM_A1"          javaType="EZDSStringItem" />
        <result property="dsBankCd_A1"      column="DS_BANK_CD_A1"          javaType="EZDSStringItem" />
        <result property="dsBankNm_A1"      column="DS_BANK_NM_A1"          javaType="EZDSStringItem" />
        <result property="bankRteNum_A1"    column="BANK_RTE_NUM_A1"        javaType="EZDSStringItem" />
        <result property="dsBankBrNm_A1"    column="DS_BANK_BR_NM_A1"       javaType="EZDSStringItem" />
        <result property="effFromDt_A1"     column="EFF_FROM_DT_A1"         javaType="EZDSStringItem" />
        <result property="effThruDt_A1"     column="EFF_THRU_DT_A1"         javaType="EZDSStringItem" />
        <result property="xxNum_A1"         column="XX_NUM_A1"              javaType="EZDSBigDecimalItem" />
    </resultMap>

    <statement id="searchBankAcct_Customer_Unidentified" parameterClass="Map" resultMap="result.searchBankAcct_Customer_Unidentified">
        SELECT 
             DS_BANK_ACCT_NUM_A1
            ,DS_BANK_ACCT_NM_A1
            ,DS_BANK_ACCT_PK_A1
            ,DS_ACCT_NUM_A1
            ,DS_ACCT_NM_A1
            ,DS_BANK_CD_A1
            ,DS_BANK_NM_A1
            ,BANK_RTE_NUM_A1
            ,DS_BANK_BR_NM_A1
            ,EFF_FROM_DT_A1
            ,EFF_THRU_DT_A1
            ,XX_NUM_A1
        FROM
            (
        SELECT 
             A.DS_BANK_ACCT_NUM AS DS_BANK_ACCT_NUM_A1
            ,A.DS_BANK_ACCT_NM  AS DS_BANK_ACCT_NM_A1
            ,A.DS_BANK_ACCT_PK  AS DS_BANK_ACCT_PK_A1
            ,''                 AS DS_ACCT_NUM_A1
            ,''                 AS DS_ACCT_NM_A1
            ,B.DS_BANK_CD       AS DS_BANK_CD_A1
            ,B.DS_BANK_NM       AS DS_BANK_NM_A1
            ,C.BANK_RTE_NUM     AS BANK_RTE_NUM_A1
            ,C.DS_BANK_BR_NM    AS DS_BANK_BR_NM_A1
            ,MAX(A.EFF_FROM_DT) AS EFF_FROM_DT_A1
            ,MAX(A.EFF_THRU_DT) AS EFF_THRU_DT_A1
            ,COUNT(*)           AS XX_NUM_A1
        FROM
             DS_BANK_ACCT             A
            ,DS_BANK                  B
            ,DS_BANK_BR               C
            ,(
                SELECT
                  X.GLBL_CMPY_CD
                , X.DS_BANK_ACCT_PK
                FROM
                  DS_CUST_BANK_ACCT_RELN   X
                , SELL_TO_CUST             Y
                WHERE
                        X.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND X.GLBL_CMPY_CD      = Y.GLBL_CMPY_CD
                    AND X.DS_ACCT_CUST_PK   = Y.SELL_TO_CUST_PK
                    AND X.EZCANCELFLAG      = '0'
                    AND Y.EZCANCELFLAG      = '0'
            ) CB
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.GLBL_CMPY_CD      = C.GLBL_CMPY_CD

            AND A.DS_BANK_CD        = B.DS_BANK_CD
            AND A.DS_BANK_ACCT_TP_CD= #dsBankAcctTpCd#
            AND (
                 (A.BANK_RTE_NUM      = C.BANK_RTE_NUM)
                OR
                 (A.BANK_RTE_NUM IS NULL AND C.BANK_RTE_NUM IS NULL)
            )
            AND A.DS_BANK_BR_PK     = C.DS_BANK_BR_PK

<!-- QC#13480
            AND A.EFF_FROM_DT   &lt;= #procDt#
            AND (CASE WHEN A.EFF_THRU_DT IS NULL THEN '99991231' ELSE A.EFF_THRU_DT END) &gt;= #procDt#
-->
<!--
        <isNotNull property="dsBankAcctNum">
            AND A.DS_BANK_ACCT_NUM  = #dsBankAcctNum#
        </isNotNull>
        <isNotNull property="dsBankCd">
            AND B.DS_BANK_CD        = #dsBankCd#
        </isNotNull>
        <isNotNull property="bankRteNum">
            AND C.BANK_RTE_NUM      = #bankRteNum#
        </isNotNull>
-->
        <isNotNull property="dsBankAcctNm">
            AND A.DS_BANK_ACCT_NM    LIKE #dsBankAcctNm#
        </isNotNull>
        <isNotNull property="dsBankBrNm">
            AND C.DS_BANK_BR_NM      LIKE #dsBankBrNm#
        </isNotNull>
        <isNotNull property="bankRteNum">
            AND C.BANK_RTE_NUM      = #bankRteNum#
        </isNotNull>

            AND A.GLBL_CMPY_CD      = CB.GLBL_CMPY_CD (+)
            AND A.DS_BANK_ACCT_PK   = CB.DS_BANK_ACCT_PK (+)
            AND CB.DS_BANK_ACCT_PK(+) IS NULL
            AND A.EZCANCELFLAG      = '0'
            AND B.EZCANCELFLAG      = '0'
            AND C.EZCANCELFLAG      = '0'
        GROUP BY
             A.DS_BANK_ACCT_NUM
            ,A.DS_BANK_ACCT_NM
            ,A.DS_BANK_ACCT_PK
            ,B.DS_BANK_CD
            ,B.DS_BANK_NM
            ,C.BANK_RTE_NUM
            ,C.DS_BANK_BR_NM
        ORDER BY
             A.DS_BANK_ACCT_NUM
            )
        WHERE
            ROWNUM          &lt;= #rowNum#
    </statement>

    <resultMap id="result.searchBankAcct_Customer_Unidentified" class="NFCL3120_ASMsg">
        <result property="dsBankAcctNum_A1" column="DS_BANK_ACCT_NUM_A1"    javaType="EZDSStringItem" />
        <result property="dsBankAcctNm_A1"  column="DS_BANK_ACCT_NM_A1"     javaType="EZDSStringItem" />
        <result property="dsBankAcctPk_A1"  column="DS_BANK_ACCT_PK_A1"     javaType="EZDSBigDecimalItem" />
        <result property="dsAcctNum_A1"     column="DS_ACCT_NUM_A1"         javaType="EZDSStringItem" />
        <result property="dsAcctNm_A1"      column="DS_ACCT_NM_A1"          javaType="EZDSStringItem" />
        <result property="dsBankCd_A1"      column="DS_BANK_CD_A1"          javaType="EZDSStringItem" />
        <result property="dsBankNm_A1"      column="DS_BANK_NM_A1"          javaType="EZDSStringItem" />
        <result property="bankRteNum_A1"    column="BANK_RTE_NUM_A1"        javaType="EZDSStringItem" />
        <result property="dsBankBrNm_A1"    column="DS_BANK_BR_NM_A1"       javaType="EZDSStringItem" />
        <result property="effFromDt_A1"     column="EFF_FROM_DT_A1"         javaType="EZDSStringItem" />
        <result property="effThruDt_A1"     column="EFF_THRU_DT_A1"         javaType="EZDSStringItem" />
        <result property="xxNum_A1"         column="XX_NUM_A1"              javaType="EZDSBigDecimalItem" />
    </resultMap>

</sqlMap>
