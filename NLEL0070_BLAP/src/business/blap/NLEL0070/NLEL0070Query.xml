<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NLEL0070Query">

    <typeAlias alias="NLEL0070CMsg" type="business.blap.NLEL0070.NLEL0070CMsg"/>

    <statement id="getAssetBookCtrl" parameterClass="Map" resultMap="result.getAssetBookCtrl">
        SELECT
               C.EZUPTIME
             , C.EZUPTIMEZONE
             , C.ASSET_TP_CD
             , C.EFF_FROM_DT
             , C.EFF_THRU_DT
             , C.ASSET_COA_ACCT_CD
             , C.DEPC_COA_ACCT_CD
             , C.ACCUM_DEPC_COA_ACCT_CD
             , C.DEPC_ADJ_COA_ACCT_CD
             , C.SLS_PRCD_COA_ACCT_CD
             , C.RMV_COST_COA_ACCT_CD
             , C.GAIN_LOSS_COA_ACCT_CD
             , C.CLING_COA_ACCT_CD
             , C.ADJ_COA_ACCT_CD
             , C.DEF_DEPC_MTH_NUM
             , C.ASSET_BOOK_CTRL_DESC_TXT
        FROM
               ASSET_BOOK_CTRL C
        WHERE
               C.GLBL_CMPY_CD        = #glblCmpyCd#
           AND C.ASSET_TP_CD         = #assetTpCd#
           <isNotNull property="effFromDt">
           AND C.EFF_FROM_DT         = #effFromDt#
           </isNotNull>
           <isNull property="effFromDt">
           AND C.EFF_FROM_DT     &lt;= #slsDt#
           AND (
                    C.EFF_THRU_DT  IS NULL
                 OR C.EFF_THRU_DT  &gt;= #slsDt#
           ) 
           </isNull>
           AND C.EZCANCELFLAG        = '0'
    </statement>

    <resultMap id="result.getAssetBookCtrl" class="NLEL0070CMsg">
        <result property="ezUpTime_M1"              column="EZUPTIME"                   javaType="EZDCStringItem"/>
        <result property="ezUpTimeZone_M1"          column="EZUPTIMEZONE"               javaType="EZDCStringItem"/>
        <result property="assetTpCd_M1"             column="ASSET_TP_CD"                javaType="EZDCStringItem"/>
        <result property="effFromDt_M1"             column="EFF_FROM_DT"                javaType="EZDCStringItem"/>
        <result property="effThruDt_M1"             column="EFF_THRU_DT"                javaType="EZDCStringItem"/>
        <result property="assetCoaAcctCd_M1"        column="ASSET_COA_ACCT_CD"          javaType="EZDCStringItem"/>
        <result property="depcCoaAcctCd_M1"         column="DEPC_COA_ACCT_CD"           javaType="EZDCStringItem"/>
        <result property="accumDepcCoaAcctCd_M1"    column="ACCUM_DEPC_COA_ACCT_CD"     javaType="EZDCStringItem"/>
        <result property="depcAdjCoaAcctCd_M1"      column="DEPC_ADJ_COA_ACCT_CD"       javaType="EZDCStringItem"/>
        <result property="slsPrcdCoaAcctCd_M1"      column="SLS_PRCD_COA_ACCT_CD"       javaType="EZDCStringItem"/>
        <result property="rmvCostCoaAcctCd_M1"      column="RMV_COST_COA_ACCT_CD"       javaType="EZDCStringItem"/>
        <result property="gainLossCoaAcctCd_M1"     column="GAIN_LOSS_COA_ACCT_CD"      javaType="EZDCStringItem"/>
        <result property="clingCoaAcctCd_M1"        column="CLING_COA_ACCT_CD"          javaType="EZDCStringItem"/>
        <result property="adjCoaAcctCd_M1"          column="ADJ_COA_ACCT_CD"            javaType="EZDCStringItem"/>
        <result property="defDepcMthNum_M1"         column="DEF_DEPC_MTH_NUM"           javaType="EZDCStringItem"/>
        <result property="assetBookCtrlDescTxt_M1"  column="ASSET_BOOK_CTRL_DESC_TXT"   javaType="EZDCStringItem"/>
    </resultMap>

    <statement id="getEffFrom" parameterClass="Map" resultClass="Map">
        SELECT
               C.EFF_FROM_DT
        FROM
               ASSET_BOOK_CTRL C
        WHERE
               C.GLBL_CMPY_CD        = #glblCmpyCd#
           AND C.ASSET_TP_CD         = #assetTpCd#
           AND C.EZCANCELFLAG        = '0'
        ORDER BY C.EFF_FROM_DT
    </statement>

    <statement id="getLastDepcPeriod" parameterClass="Map" resultClass="String">
        SELECT
            MAX(SUBSTR(DAT.ASSET_TRX_DT, 1, 6)) AS MAX_DT
        FROM
            DS_ASSET_TRX DAT
        WHERE
                DAT.GLBL_CMPY_CD = #glblCmpyCd#
            AND DAT.ASSET_TP_CD  = #assetTpCd#
            AND DAT.TRX_CD       = #trxCd#
            AND DAT.TRX_RSN_CD   = #trxRsnCd#
            AND DAT.EZCANCELFLAG = '0'
    </statement>
</sqlMap>
