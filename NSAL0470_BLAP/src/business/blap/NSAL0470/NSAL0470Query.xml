<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSAL0470Query">

    <typeAlias alias="NSAL0470_BSMsg" type="business.blap.NSAL0470.NSAL0470_BSMsg"/>

    <statement id="findContrVldRslt" parameterClass="Map" resultMap="result.findContrVldRslt">
        SELECT
            DS_CONTR_PK
            ,DS_CONTR_NUM
            ,SER_NUM
            ,SVC_MACH_MSTR_PK
            ,DS_CONTR_VLD_PK
            ,DS_CONTR_VLD_NM
            ,DS_CONTR_VLD_STS_CD
            ,DS_CONTR_VLD_STS_DESC_TXT
            ,DS_CONTR_VLD_RSLT_MSG_TXT
            ,EZUPTIME
            ,EZUPTIMEZONE
        FROM (
                <!-- START 2018/04/04 K.Kitachi [QC#21074, ADD] -->
                SELECT
                    B.DS_CONTR_PK
                    ,A.DS_CONTR_NUM
                    ,F.SER_NUM
                    ,-1 SVC_MACH_MSTR_PK
                    ,B.DS_CONTR_VLD_PK
                    ,C.DS_CONTR_VLD_NM
                    ,B.DS_CONTR_VLD_STS_CD
                    ,G.DS_CONTR_VLD_STS_DESC_TXT
                    ,B.DS_CONTR_VLD_RSLT_MSG_TXT
                    ,A.EZUPTIME
                    ,A.EZUPTIMEZONE
                    ,B.DS_CONTR_DTL_PK
                    ,C.PRIM_VLD_FLG
                    ,D.VLD_SORT_NUM
                    ,'Y' ERR_WARN_ONLY_FLG
                FROM
                    DS_CONTR A
                    ,DS_CONTR_VLD_RSLT_WRK B
                    ,DS_CONTR_VLD C
                    ,DS_CONTR_VLD_RELN D
                    ,DS_CONTR_DTL E
                    ,SVC_MACH_MSTR F
                    ,DS_CONTR_VLD_STS G
                WHERE
                    A.GLBL_CMPY_CD          = #glblCmpyCd#
                AND A.DS_CONTR_NUM          = #dsContrNum#
                AND A.EZCANCELFLAG          = '0'
                AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
                AND A.DS_CONTR_PK           = B.DS_CONTR_PK
                <isNotNull property="dsContrVldPk">
                AND B.DS_CONTR_VLD_PK       = #dsContrVldPk#
                </isNotNull>
                <iterate property="dsContrVldStsCd" var="elem[]" open="AND B.DS_CONTR_VLD_STS_CD IN (" close=")" conjunction=",">
                                #elem[]#
                </iterate>
                <iterate property="dsContrVldStsCdIsErrWarn" var="elem[]" open="AND B.DS_CONTR_VLD_STS_CD IN (" close=")" conjunction=",">
                                #elem[]#
                </iterate>
                AND B.EZCANCELFLAG          = '0'
                AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
                AND B.DS_CONTR_VLD_PK       = C.DS_CONTR_VLD_PK
                AND C.EZCANCELFLAG          = '0'
                AND B.GLBL_CMPY_CD          = D.GLBL_CMPY_CD
                AND B.DS_CONTR_VLD_PK       = D.DS_CONTR_VLD_PK
                AND B.DS_CONTR_VLD_LIST_PK  = D.DS_CONTR_VLD_LIST_PK
                AND D.EZCANCELFLAG          = '0'
                AND B.GLBL_CMPY_CD          = E.GLBL_CMPY_CD(+)
                AND B.DS_CONTR_DTL_PK       = E.DS_CONTR_DTL_PK(+)
                AND E.EZCANCELFLAG(+)       = '0'
                AND E.GLBL_CMPY_CD          = F.GLBL_CMPY_CD(+)
                AND E.SVC_MACH_MSTR_PK      = F.SVC_MACH_MSTR_PK(+)
                AND F.EZCANCELFLAG(+)       = '0'
                <isNotNull property="serNum">
                AND F.SER_NUM               LIKE #serNum#
                </isNotNull>
                AND B.GLBL_CMPY_CD          = G.GLBL_CMPY_CD
                AND B.DS_CONTR_VLD_STS_CD   = G.DS_CONTR_VLD_STS_CD
                AND G.EZCANCELFLAG          = '0'
                UNION ALL
                <!-- END 2018/04/04 K.Kitachi [QC#21074, ADD] -->
                SELECT
                    B.DS_CONTR_PK
                    ,A.DS_CONTR_NUM
                    ,F.SER_NUM
                    ,F.SVC_MACH_MSTR_PK
                    ,B.DS_CONTR_VLD_PK
                    ,C.DS_CONTR_VLD_NM
                    ,B.DS_CONTR_VLD_STS_CD
                    ,G.DS_CONTR_VLD_STS_DESC_TXT
                    ,B.DS_CONTR_VLD_RSLT_MSG_TXT
                    ,A.EZUPTIME
                    ,A.EZUPTIMEZONE
                    <!-- START 2018/04/04 K.Kitachi [QC#21074, ADD] -->
                    ,B.DS_CONTR_DTL_PK
                    ,C.PRIM_VLD_FLG
                    ,D.VLD_SORT_NUM
                    ,'N' ERR_WARN_ONLY_FLG
                    <!-- END 2018/04/04 K.Kitachi [QC#21074, ADD] -->
                FROM
                    DS_CONTR A
                    ,DS_CONTR_VLD_RSLT_WRK B
                    ,DS_CONTR_VLD C
                    ,DS_CONTR_VLD_RELN D
                    ,DS_CONTR_DTL E
                    ,SVC_MACH_MSTR F
                    ,DS_CONTR_VLD_STS G
                WHERE
                    A.GLBL_CMPY_CD          = #glblCmpyCd#
                AND A.DS_CONTR_NUM          = #dsContrNum#
                AND A.EZCANCELFLAG          = '0'
                AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
                AND A.DS_CONTR_PK           = B.DS_CONTR_PK
                <isNotNull property="dsContrVldPk">
                AND B.DS_CONTR_VLD_PK       = #dsContrVldPk#
                </isNotNull>
                <iterate property="dsContrVldStsCd" var="elem[]" open="AND B.DS_CONTR_VLD_STS_CD IN (" close=")" conjunction=",">
                                #elem[]#
                </iterate>
                AND B.EZCANCELFLAG          = '0'
                AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
                AND B.DS_CONTR_VLD_PK       = C.DS_CONTR_VLD_PK
                AND C.EZCANCELFLAG          = '0'
                AND B.GLBL_CMPY_CD          = D.GLBL_CMPY_CD
                AND B.DS_CONTR_VLD_PK       = D.DS_CONTR_VLD_PK
                AND B.DS_CONTR_VLD_LIST_PK  = D.DS_CONTR_VLD_LIST_PK
                AND D.EZCANCELFLAG          = '0'
                AND B.GLBL_CMPY_CD          = E.GLBL_CMPY_CD(+)
                AND B.DS_CONTR_DTL_PK       = E.DS_CONTR_DTL_PK(+)
                AND E.EZCANCELFLAG(+)       = '0'
                AND E.GLBL_CMPY_CD          = F.GLBL_CMPY_CD(+)
                AND E.SVC_MACH_MSTR_PK      = F.SVC_MACH_MSTR_PK(+)
                AND F.EZCANCELFLAG(+)       = '0'
                <isNotNull property="serNum">
                AND F.SER_NUM               LIKE #serNum#
                </isNotNull>
                AND B.GLBL_CMPY_CD          = G.GLBL_CMPY_CD
                AND B.DS_CONTR_VLD_STS_CD   = G.DS_CONTR_VLD_STS_CD
                AND G.EZCANCELFLAG          = '0'
                ORDER BY
                    <!-- START 2018/04/04 K.Kitachi [QC#21074, MOD] -->
                    ERR_WARN_ONLY_FLG DESC
                    ,DS_CONTR_DTL_PK  ASC NULLS FIRST
                    ,PRIM_VLD_FLG     DESC
                    ,VLD_SORT_NUM     ASC
                    <!-- END 2018/04/04 K.Kitachi [QC#21074, MOD] -->
        ) VLD_RSLT
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>
    <resultMap id="result.findContrVldRslt" class="NSAL0470_BSMsg">
        <result property="dsContrPk_B" column="DS_CONTR_PK"  javaType="EZDSBigDecimalItem" />
        <result property="dsContrNum_B" column="DS_CONTR_NUM" javaType="EZDSStringItem"/>
        <result property="serNum_B" column="SER_NUM" javaType="EZDSStringItem"/>
        <result property="svcMachMstrPk_B" column="SVC_MACH_MSTR_PK"  javaType="EZDSBigDecimalItem" />
        <result property="dsContrVldPk_B" column="DS_CONTR_VLD_PK"  javaType="EZDSBigDecimalItem" />
        <result property="dsContrVldNm_B" column="DS_CONTR_VLD_NM"  javaType="EZDSStringItem"/>
        <result property="dsContrVldStsCd_B" column="DS_CONTR_VLD_STS_CD"  javaType="EZDSStringItem"/>
        <result property="dsContrVldStsDescTxt_B" column="DS_CONTR_VLD_STS_DESC_TXT"  javaType="EZDSStringItem"/>
        <result property="dsContrVldRsltMsgTxt_B" column="DS_CONTR_VLD_RSLT_MSG_TXT"  javaType="EZDSStringItem"/>
        <result property="ezUpTime_B" column="EZUPTIME"  javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_B" column="EZUPTIMEZONE"  javaType="EZDSStringItem"/>
    </resultMap>
    <statement id="countErrResult" parameterClass="Map" resultClass="java.math.BigDecimal">
        SELECT
            B.DS_CONTR_VLD_RSLT_WRK_PK
        FROM
            DS_CONTR A
            ,DS_CONTR_VLD_RSLT_WRK B
        WHERE
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        AND A.EZCANCELFLAG          = '0'
        AND A.DS_CONTR_NUM          = #dsContrNum#
        AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
        AND A.DS_CONTR_PK           = B.DS_CONTR_PK
        AND B.DS_CONTR_VLD_STS_CD   IN (#error#, #notValidated#)
        AND B.EZCANCELFLAG          = '0'
    </statement>
    <statement id="getContrVld" parameterClass="Map" resultClass="Map">
        SELECT
            A.DS_CONTR_VLD_PK
            ,A.DS_CONTR_VLD_NM
            ,A.VLD_REG_FLG
            ,A.VLD_FLEET_FLG
            ,A.VLD_AGGR_FLG
            ,A.VLD_WTY_FLG
        FROM
            DS_CONTR_VLD A
        WHERE
            A.GLBL_CMPY_CD  = #glblCmpyCd#
        AND A.EZCANCELFLAG  = '0'
        AND A.EFF_FROM_DT   &lt;= #slsDt#
        AND NVL(A.EFF_TO_DT, #slsDt#) &gt;= #slsDt#
    </statement>
    <statement id="getUpdDsContrDtl" parameterClass="Map" resultClass="Map">
        SELECT 
            RSLT.DS_CONTR_DTL_PK        AS DS_CONTR_DTL_PK
            <!-- START 2022/09/27 E.Sanchez [QC#60455, ADD] -->
            ,RSLT.DS_CONTR_DTL_STS_CD   AS DS_CONTR_DTL_STS_CD
            <!-- END 2022/09/27 E.Sanchez [QC#60455, ADD] -->
            ,RSLT.DS_CONTR_CTRL_STS_CD  AS DS_CONTR_CTRL_STS_CD
            ,RSLT.SORT_NUM              AS SORT_NUM
<!-- START 2018/05/24 T.Tomita [QC#24989, ADD] -->
            ,RSLT.SVC_MACH_MSTR_STS_CD  AS SVC_MACH_MSTR_STS_CD
<!-- END 2018/05/24 T.Tomita [QC#24989, ADD] -->
        FROM
        (
            SELECT
                A.DS_CONTR_DTL_PK
                <!-- START 2022/09/27 E.Sanchez [QC#60455, ADD] -->
                ,A.DS_CONTR_DTL_STS_CD
                <!-- END 2022/09/27 E.Sanchez [QC#60455, ADD] -->
                ,B.DS_CONTR_CTRL_STS_CD
                ,'1'                        AS SORT_NUM
<!-- START 2018/05/24 T.Tomita [QC#24989, ADD] -->
                ,C.SVC_MACH_MSTR_STS_CD     AS SVC_MACH_MSTR_STS_CD
<!-- END 2018/05/24 T.Tomita [QC#24989, ADD] -->
            FROM
                DS_CONTR_DTL A,
                DS_CONTR_DTL_STS_V B
                ,SVC_MACH_MSTR C
            WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.DS_CONTR_PK           = #dsContrPk#
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK       = B.DS_CONTR_DTL_PK
            AND B.DS_CONTR_CTRL_STS_CD  IN (#draft#, #entered#, #qaHold#, #signed#)
            AND B.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
            AND A.SVC_MACH_MSTR_PK      = C.SVC_MACH_MSTR_PK
<!-- START 2018/05/24 T.Tomita [QC#24989, DEL] -->
<!--        AND C.SVC_MACH_MSTR_STS_CD  IN (#instl#, #w4r#) -->
<!-- END 2018/05/24 T.Tomita [QC#24989, DEL] -->
            AND C.EZCANCELFLAG          = '0'
            UNION ALL
            SELECT
                A.DS_CONTR_DTL_PK
                <!-- START 2022/09/27 E.Sanchez [QC#60455, ADD] -->
                ,A.DS_CONTR_DTL_STS_CD
                <!-- END 2022/09/27 E.Sanchez [QC#60455, ADD] -->
                ,B.DS_CONTR_CTRL_STS_CD
                ,'2'                        AS SORT_NUM
<!-- START 2018/05/24 T.Tomita [QC#24989, ADD] -->
                ,NULL                       AS SVC_MACH_MSTR_STS_CD
<!-- END 2018/05/24 T.Tomita [QC#24989, ADD] -->
            FROM
            DS_CONTR_DTL A,
            DS_CONTR_DTL_STS_V B
            WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.EZCANCELFLAG          = '0'
            AND A.DS_CONTR_PK           = #dsContrPk#
            AND A.DS_CONTR_DTL_TP_CD    IN (#fleet#, #agg#)
            AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
            AND A.DS_CONTR_DTL_PK       = B.DS_CONTR_DTL_PK
            AND B.EZCANCELFLAG          = '0'
        ) RSLT
        ORDER BY RSLT.SORT_NUM
    </statement>
    <statement id="getUpdDsContrBllgMtr" parameterClass="Map" resultClass="Map">
        SELECT
            A.DS_CONTR_BLLG_MTR_PK
            ,B.DS_CONTR_CTRL_STS_CD
        FROM
            DS_CONTR_BLLG_MTR A,
            DS_CONTR_BLLG_MTR_STS_V B
        WHERE
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        AND A.EZCANCELFLAG          = '0'
        AND A.DS_CONTR_DTL_PK       = #dsContrDtlPk#
        AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
        AND A.DS_CONTR_BLLG_MTR_PK  = B.DS_CONTR_BLLG_MTR_PK
        AND B.DS_CONTR_CTRL_STS_CD  IN (#draft#, #entered#, #qaHold#, #signed#)
    </statement>
    <statement id="getUpdDsContrPrcEffBase" parameterClass="Map" resultClass="Map">
        SELECT
            A.DS_CONTR_PRC_EFF_PK
            ,B.DS_CONTR_CTRL_STS_CD
<!-- START 2017/08/15 K.Kim [QC#20525, ADD] -->
            ,A.CONTR_PRC_EFF_FROM_DT
<!-- END 2017/08/15 K.Kim [QC#20525, ADD] -->
        FROM
            DS_CONTR_PRC_EFF A,
            DS_CONTR_PRC_EFF_STS_V B
        WHERE
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        AND A.EZCANCELFLAG          = '0'
        AND A.DS_CONTR_DTL_PK       = #dsContrDtlPk#
        AND A.BASE_CHRG_FLG         = 'Y'
        AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
        AND A.DS_CONTR_PRC_EFF_PK   = B.DS_CONTR_PRC_EFF_PK
        AND B.DS_CONTR_CTRL_STS_CD  IN (#draft#, #entered#, #qaHold#, #signed#)
    </statement>
    <statement id="getUpdDsContrPrcEffUsg" parameterClass="Map" resultClass="Map">
        SELECT
            A.DS_CONTR_PRC_EFF_PK
            ,B.DS_CONTR_CTRL_STS_CD
<!-- START 2017/08/15 K.Kim [QC#20525, ADD] -->
            ,A.CONTR_PRC_EFF_FROM_DT
<!-- END 2017/08/15 K.Kim [QC#20525, ADD] -->
        FROM
            DS_CONTR_PRC_EFF A,
            DS_CONTR_PRC_EFF_STS_V B
        WHERE
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        AND A.EZCANCELFLAG          = '0'
        AND A.DS_CONTR_BLLG_MTR_PK  = #dsContrBllgMtrPk#
        AND A.USG_CHRG_FLG          = 'Y'
        AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
        AND A.DS_CONTR_PRC_EFF_PK   = B.DS_CONTR_PRC_EFF_PK
        AND B.DS_CONTR_CTRL_STS_CD  IN (#draft#, #entered#, #qaHold#, #signed#)
    </statement>
    <statement id="findErrContrVldRslt" parameterClass="Map" resultClass="Map">
        SELECT
            SER_NUM
            ,DS_CONTR_VLD_NM
            ,DS_CONTR_VLD_STS_DESC_TXT
        FROM (
                SELECT
                    B.DS_CONTR_PK
                    ,A.DS_CONTR_NUM
                    ,F.SER_NUM
                    ,F.SVC_MACH_MSTR_PK
                    ,B.DS_CONTR_VLD_PK
                    ,C.DS_CONTR_VLD_NM
                    ,B.DS_CONTR_VLD_STS_CD
                    ,G.DS_CONTR_VLD_STS_DESC_TXT
                    ,B.DS_CONTR_VLD_RSLT_MSG_TXT
                FROM
                    DS_CONTR A
                    ,DS_CONTR_VLD_RSLT_WRK B
                    ,DS_CONTR_VLD C
                    ,DS_CONTR_VLD_RELN D
                    ,DS_CONTR_DTL E
                    ,SVC_MACH_MSTR F
                    ,DS_CONTR_VLD_STS G
                WHERE
                    A.GLBL_CMPY_CD          = #glblCmpyCd#
                AND A.DS_CONTR_NUM          = #dsContrNum#
                AND A.EZCANCELFLAG          = '0'
                AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
                AND A.DS_CONTR_PK           = B.DS_CONTR_PK
                <iterate property="dsContrVldStsCd" var="elem[]" open="AND B.DS_CONTR_VLD_STS_CD IN (" close=")" conjunction=",">
                                #elem[]#
                </iterate>
                AND B.EZCANCELFLAG          = '0'
                AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
                AND B.DS_CONTR_VLD_PK       = C.DS_CONTR_VLD_PK
                AND C.EZCANCELFLAG          = '0'
                AND B.GLBL_CMPY_CD          = D.GLBL_CMPY_CD
                AND B.DS_CONTR_VLD_PK       = D.DS_CONTR_VLD_PK
                AND B.DS_CONTR_VLD_LIST_PK  = D.DS_CONTR_VLD_LIST_PK
                AND D.EZCANCELFLAG          = '0'
                AND B.GLBL_CMPY_CD          = E.GLBL_CMPY_CD(+)
                AND B.DS_CONTR_DTL_PK       = E.DS_CONTR_DTL_PK(+)
                AND E.EZCANCELFLAG(+)       = '0'
                AND E.GLBL_CMPY_CD          = F.GLBL_CMPY_CD(+)
                AND E.SVC_MACH_MSTR_PK      = F.SVC_MACH_MSTR_PK(+)
                AND F.EZCANCELFLAG(+)       = '0'
                AND B.GLBL_CMPY_CD          = G.GLBL_CMPY_CD
                AND B.DS_CONTR_VLD_STS_CD   = G.DS_CONTR_VLD_STS_CD
                AND G.EZCANCELFLAG          = '0'
                ORDER BY
                    B.DS_CONTR_DTL_PK   ASC NULLS FIRST
                    ,C.PRIM_VLD_FLG     DESC
                    ,D.VLD_SORT_NUM     ASC
        ) VLD_RSLT
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>
    <statement id="getContrVldRsltForRemove" parameterClass="Map" resultClass="java.math.BigDecimal">
        SELECT
            A.DS_CONTR_VLD_RSLT_WRK_PK
        FROM
            DS_CONTR_VLD_RSLT_WRK A
        WHERE
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        AND A.EZCANCELFLAG          = '0'
        AND A.DS_CONTR_PK           = #dsContrPk#
    </statement>
    <statement id="getDoNotOverrideVld" parameterClass="Map" resultClass="String">
        SELECT
            C.DS_CONTR_VLD_NM
        FROM
            DS_CONTR A
            ,DS_CONTR_VLD_RSLT_WRK B
            ,DS_CONTR_VLD C
        WHERE
            A.GLBL_CMPY_CD           = #glblCmpyCd#
        AND A.DS_CONTR_NUM           = #dsContrNum#
        AND A.EZCANCELFLAG           = '0'
        AND A.GLBL_CMPY_CD           = B.GLBL_CMPY_CD
        AND A.DS_CONTR_PK            = B.DS_CONTR_PK
        AND B.DS_CONTR_VLD_STS_CD    IN (#error#, #notValidated#)
        AND B.EZCANCELFLAG           = '0'
        AND B.GLBL_CMPY_CD           = C.GLBL_CMPY_CD
        AND B.DS_CONTR_VLD_PK        = C.DS_CONTR_VLD_PK
        AND C.OVRD_VLD_RSLT_AVAL_FLG = 'N'
        AND C.EZCANCELFLAG           = '0'
    </statement>
    <statement id="getDsContr" parameterClass="Map" resultClass="Map">
        SELECT
             A.QLTY_ASRN_HLD_PEND_APVL_FLG
            ,A.CONTR_ADMIN_PSN_CD
            ,A.DS_CONTR_CATG_CD
        FROM
            DS_CONTR A
        WHERE
            A.GLBL_CMPY_CD               = #glblCmpyCd#
        AND A.DS_CONTR_NUM               = #dsContrNum#
        AND A.EZCANCELFLAG               = '0'
    </statement>
    <statement id="getContrRepCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)  AS CNT
        FROM
             SVC_BR_RESRC_RELN  REP
            ,SVC_BR_RESRC_RELN  SV
        WHERE
            REP.GLBL_CMPY_CD             =  #glblCmpyCd#
        AND REP.EZCANCELFLAG             =  '0'
        AND REP.PSN_CD                   =  #psnCd#
        AND REP.SVC_ORG_FUNC_ROLE_TP_CD  =  #svcOrgFuncRoleTpCdRep#
        AND REP.SVC_BR_RESRC_ACTV_FLG    =  'Y'
        AND REP.EFF_FROM_DT              &lt;= #slsDt#
        AND NVL(REP.EFF_THRU_DT, #maxDate#) 
                                         &gt;= #slsDt#
        AND REP.GLBL_CMPY_CD             =  SV.GLBL_CMPY_CD
        AND REP.SVC_CONTR_BR_CD          =  SV.SVC_CONTR_BR_CD
        AND SV.EZCANCELFLAG              =  '0'
        AND SV.SVC_ORG_FUNC_ROLE_TP_CD   =  #svcOrgFuncRoleTpCdSupv#
        AND SV.SVC_BR_RESRC_ACTV_FLG     =  'Y'
        AND SV.EFF_FROM_DT               &lt;= #slsDt#
        AND NVL(SV.EFF_THRU_DT, #maxDate#)
                                         &gt;= #slsDt#
    </statement>
    <statement id="getDsContrForWf" parameterClass="Map" resultClass="Map">
        SELECT
             E.SVC_CONTR_BR_CD
            ,E.SVC_RG_PK
            ,A.DS_CONTR_PK
            ,A.DS_ACCT_NUM
            ,F.DS_ACCT_NM
            ,G.DS_CONTR_CATG_DESC_TXT
        FROM
             DS_CONTR       A
            ,SVC_CONTR_BR   B
            ,(
              SELECT
                   SVC_CONTR_BR_CD
                  ,SVC_RG_PK
              FROM (
                    SELECT
                         C.SVC_CONTR_BR_CD
                        ,D.SVC_RG_PK
                        ,ROW_NUMBER() OVER(PARTITION BY C.SVC_CONTR_BR_CD ORDER BY C.SVC_RG_PK) AS RANK
                    FROM
                         SVC_RG_BR_RELN C
                        ,SVC_RG         D
                    WHERE
                        C.GLBL_CMPY_CD           = #glblCmpyCd#
                    AND C.EZCANCELFLAG           = '0'
                    AND C.GLBL_CMPY_CD           = D.GLBL_CMPY_CD
                    AND C.SVC_RG_PK              = D.SVC_RG_PK
                    AND D.EZCANCELFLAG           = '0'
                    AND D.SVC_RG_ACTV_FLG        = 'Y'
                    AND D.EFF_FROM_DT            &lt;= #slsDt#
                    AND NVL(D.EFF_THRU_DT, #maxDate#) 
                                                 &gt;= #slsDt#
                   )
              WHERE
                  RANK = 1
             ) E
            ,SELL_TO_CUST   F
            ,DS_CONTR_CATG  G
        WHERE
            A.GLBL_CMPY_CD           = #glblCmpyCd#
        AND A.DS_CONTR_NUM           = #dsContrNum#
        AND A.EZCANCELFLAG           = '0'
        AND A.GLBL_CMPY_CD           = B.GLBL_CMPY_CD
        AND A.SVC_CONTR_BR_CD        = B.SVC_CONTR_BR_CD
        AND B.EZCANCELFLAG           = '0'
        AND B.SVC_CONTR_BR_ACTV_FLG  = 'Y'
        AND B.EFF_FROM_DT            &lt;= #slsDt#
        AND NVL(B.EFF_THRU_DT, #maxDate#) 
                                     &gt;= #slsDt#
        AND B.SVC_CONTR_BR_CD        = E.SVC_CONTR_BR_CD
        AND A.GLBL_CMPY_CD           = F.GLBL_CMPY_CD
        AND A.DS_ACCT_NUM            = F.SELL_TO_CUST_CD
        AND F.EZCANCELFLAG           = '0'
        AND A.GLBL_CMPY_CD           = G.GLBL_CMPY_CD
        AND A.DS_CONTR_CATG_CD       = G.DS_CONTR_CATG_CD
        AND G.EZCANCELFLAG           = '0'
     </statement>
    <statement id="getContrVldRsltForWf" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_VLD_ERR_TRX_NM || ' ' || A.DS_CONTR_VLD_ERR_TRX_NUM  AS DS_CONTR_VLD_ERR_TRX
            ,A.DS_CONTR_VLD_RSLT_MSG_TXT
            ,B.DS_CONTR_VLD_STS_DESC_TXT
        FROM
             DS_CONTR_VLD_RSLT_WRK A
            ,DS_CONTR_VLD_STS      B
        WHERE
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        AND A.EZCANCELFLAG          = '0'
        AND A.DS_CONTR_PK           = #dsContrPk#
        AND A.DS_CONTR_VLD_STS_CD   IN (#error#, #notValidated#)
        AND A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
        AND A.DS_CONTR_VLD_STS_CD   = B.DS_CONTR_VLD_STS_CD
        AND A.EZCANCELFLAG          = '0'
    </statement>
<!-- START 2017/10/24 U.Kim [QC#21865, ADD] -->

    <statement id="getOrdSchInfo" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_PK
            ,A.DS_CONTR_NUM
            ,A.DS_CONTR_SQ_NUM
            ,B.DS_CONTR_DTL_PK
            ,B.CONTR_EFF_FROM_DT
            ,B.CONTR_EFF_THRU_DT
            ,B.CPO_ORD_NUM
            ,C.SVC_MACH_MSTR_PK
            ,C.SER_NUM
            ,C.MDSE_CD
            ,D.SVC_CONFIG_MSTR_PK
            ,D.MDL_ID
        FROM
             DS_CONTR         A
            ,DS_CONTR_DTL     B
            ,SVC_MACH_MSTR    C
            ,SVC_CONFIG_MSTR  D
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.DS_CONTR_PK          = #dsContrPk#
            AND A.EZCANCELFLAG         = '0'
            AND A.GLBL_CMPY_CD         = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK          = B.DS_CONTR_PK
            AND A.DS_CONTR_CATG_CD     &lt;&gt; #dsContrCatgCdWty#
            AND B.EZCANCELFLAG         = '0'
            AND B.GLBL_CMPY_CD         = C.GLBL_CMPY_CD
            AND B.SVC_MACH_MSTR_PK     = C.SVC_MACH_MSTR_PK
            AND B.CPO_ORD_NUM          IS NOT NULL
            AND C.SVC_MACH_TP_CD       = #machine#
            AND C.SVC_MACH_MSTR_STS_CD = #installed#
            AND C.EZCANCELFLAG         = '0'
            AND C.GLBL_CMPY_CD         = D.GLBL_CMPY_CD
            AND C.SVC_CONFIG_MSTR_PK   = D.SVC_CONFIG_MSTR_PK
            AND D.EZCANCELFLAG        = '0'
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                    SCHD_AGMT E
                WHERE
                    E.GLBL_CMPY_CD       = A.GLBL_CMPY_CD
                AND E.DS_CONTR_NUM       = A.DS_CONTR_NUM
                AND E.SVC_CONFIG_MSTR_PK = D.SVC_CONFIG_MSTR_PK
                AND E.EZCANCELFLAG       = '0'
            )
       ORDER BY
            B.DS_CONTR_DTL_PK
    </statement>
<!-- END 2017/10/24 U.Kim [QC#21865, ADD] -->
<!-- START 2018/05/10 U.Kim [QC#25482, ADD] -->
    <statement id="getSvcContrBllg" parameterClass="Map" resultClass="Map">
        SELECT
             SCB.SVC_CONTR_BLLG_PK
            ,SCB.DS_CONTR_BLLG_SCHD_PK
        FROM
            SVC_CONTR_BLLG SCB
        WHERE
            SCB.GLBL_CMPY_CD      = #glblCmpyCd#
        AND SCB.DS_CONTR_DTL_PK   = #dsContrDtlPk#
        AND SCB.SVC_CR_REBIL_PK     IS NULL
        AND SCB.SVC_CR_REBIL_DTL_PK IS NULL
        AND SCB.INV_TP_CD         &lt;&gt; #invTpCd#
        AND SCB.EZCANCELFLAG      = '0'
    </statement>
<!-- END 2018/05/10 U.Kim [QC#25482, ADD] -->

    <!-- START 2019/01/25 K.Kitachi [QC#30080, ADD] -->
    <statement id="getDsContrRnwEscl" parameterClass="Map" resultClass="Map">
        SELECT
             A.DS_CONTR_RNW_ESCL_PK
            ,A.UPLFT_PCY_DT
            ,B.CONTR_VRSN_EFF_FROM_DT AS CONTR_EFF_FROM_DT
            ,B.CONTR_VRSN_EFF_THRU_DT AS CONTR_EFF_THRU_DT
        FROM
             DS_CONTR_RNW_ESCL A
            ,DS_CONTR          B
        WHERE
                A.GLBL_CMPY_CD                 = #glblCmpyCd#
            AND A.DS_CONTR_PK                  = #dsContrPk#
            AND A.CONTR_UPLFT_TP_CD     &lt;&gt; #contrUplftTpCd#
            AND A.DS_CONTR_MACH_LVL_NUM        = #dsContrMachLvlNum#
            AND A.EZCANCELFLAG                 = '0'
            AND A.GLBL_CMPY_CD                 = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK                  = B.DS_CONTR_PK
            AND B.EZCANCELFLAG                 = '0'
        UNION
        SELECT
             A.DS_CONTR_RNW_ESCL_PK
            ,A.UPLFT_PCY_DT
            ,B.CONTR_EFF_FROM_DT
            ,B.CONTR_EFF_THRU_DT
        FROM
             DS_CONTR_RNW_ESCL A
            ,DS_CONTR_DTL B
        WHERE
                A.GLBL_CMPY_CD                 = #glblCmpyCd#
            AND A.DS_CONTR_PK                  = #dsContrPk#
            AND A.CONTR_UPLFT_TP_CD     &lt;&gt; #contrUplftTpCd#
            AND A.DS_CONTR_MACH_LVL_NUM &lt;&gt; #dsContrMachLvlNum#
            AND A.EZCANCELFLAG                 = '0'
            AND A.GLBL_CMPY_CD                 = B.GLBL_CMPY_CD
            AND A.DS_CONTR_PK                  = B.DS_CONTR_PK
            <!-- START 2019/07/25 K.Kitachi [QC#52070, ADD] -->
            AND A.DS_CONTR_DTL_PK              = B.DS_CONTR_DTL_PK
            <!-- END 2019/07/25 K.Kitachi [QC#52070, ADD] -->
            AND B.EZCANCELFLAG                 = '0'
    </statement>
    <!-- END 2019/01/25 K.Kitachi [QC#30080, ADD] -->
</sqlMap>
