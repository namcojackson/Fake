<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NFZC500001">

    <!-- START 2018/11/19 S.Takami [QC#29333, DEL] -->
<!--     <statement id="WF_FINACE_SQL" parameterClass="Map" resultClass="Map"> -->
<!--     WITH LIST_DATA AS ( -->
<!--         SELECT -->
<!--               SP.PSN_NUM                        AS  COND_STR_1 -->
<!--             , AL.APVL_LIMIT_TO_AMT              AS  COND_NUM_1 -->
<!--             , SP.PSN_NUM                        AS  VAL_STR_1 -->
<!--             , SP.HR_SUPV_ID -->
<!--             , SP.PSN_CD -->
<!--             , SP.PSN_NUM -->
<!--         FROM -->
<!--               S21_PSN                           SP -->
<!--             , AR_ADJ_APVL_LIMIT                 AL -->

<!--         WHERE -->
<!--                 SP.EZCANCELFLAG                 = '0' -->
<!--             AND SP.GLBL_CMPY_CD                 = #glblCmpyCd# -->
<!--             AND AL.GLBL_CMPY_CD                 = SP.GLBL_CMPY_CD -->
<!--             AND AL.EZCANCELFLAG                 = SP.EZCANCELFLAG -->
<!--             AND AL.AR_ADJ_APVL_USR_ID           = SP.PSN_NUM -->
<!--             AND AL.AR_ADJ_CATG_CD               = 'WRT' -->

<!--     ) -->
<!--         SELECT -->
<!--                 COND_STR_1 -->
<!--               , COND_NUM_1 -->
<!--               , VAL_STR_1 -->
<!--         FROM -->
<!--             LIST_DATA      SP -->
<!--             START WITH SP.PSN_NUM               = #psnNum# -->
<!--             CONNECT BY PRIOR SP.HR_SUPV_ID      = SP.PSN_CD -->
<!--     </statement> -->

<!--     <statement id="WF_GRP_APVL_SUB_PSN" parameterClass="Map" resultClass="Map"> -->
<!--         SELECT -->
<!--               #glblCmpyCd#                              AS GLBL_CMPY_CD -->
<!--             , 'NFDL0090'                                AS BIZ_ID -->
<!--             , 'GRP_APVL_SUB_PSN'                        AS USER_GROUP_NAME -->
<!--             , RPAD('00',3, A.LV)                        AS USER_GROUP_LEVEL -->
<!--             , P.PSN_NUM                                 AS WF_USR_ID -->
<!--             ,( -->
<!--                 SELECT -->
<!--                     AL.APVL_LIMIT_TO_AMT -->
<!--                 FROM  -->
<!--                     AR_ADJ_APVL_LIMIT AL -->
<!--                 WHERE -->
<!--                     AL.GLBL_CMPY_CD                     = #glblCmpyCd# -->
<!--                 AND AL.AR_ADJ_CATG_CD                   = 'WRT' -->
<!--                 AND AL.EZCANCELFLAG                     = '0' -->
<!--                 AND AL.AR_ADJ_APVL_USR_ID               = P.PSN_NUM -->
<!--             )   AS SUB_APVL_LIMIT -->
<!--             , A.APVL_LIMIT                              AS MAIN_APVL_LIMIT -->
<!--         FROM -->
<!--             S21_PSN P -->
<!--          , ( -->
<!--             SELECT -->
<!--                 SP.PSN_NUM                              AS PSN_NUM -->
<!--               , LEVEL                                   AS LV -->
<!--               ,( -->
<!--                 SELECT AL.APVL_LIMIT_TO_AMT FROM AR_ADJ_APVL_LIMIT AL  -->
<!--                 WHERE  AL.AR_ADJ_APVL_USR_ID  = SP.PSN_NUM  -->
<!--                    AND AL.AR_ADJ_CATG_CD      = 'WRT')  AS APVL_LIMIT -->
<!--             FROM -->
<!--                 S21_PSN SP -->
<!--             WHERE -->
<!--                 SP.GLBL_CMPY_CD                         = #glblCmpyCd# -->
<!--             AND SP.EZCANCELFLAG                         = '0' -->
<!--             START WITH SP.PSN_NUM                       = #psnNum# -->
<!--             CONNECT BY PRIOR SP.HR_SUPV_ID              = SP.PSN_CD -->
<!--             AND EXISTS (    SELECT -->
<!--                                   1 -->
<!--                             FROM -->
<!--                                   AR_ADJ_APVL_LIMIT     AL -->
<!--                             WHERE -->
<!--                                   AL.GLBL_CMPY_CD       = #glblCmpyCd# -->
<!--                               AND AL.AR_ADJ_CATG_CD     = 'WRT' -->
<!--                               AND AL.EZCANCELFLAG       = '0'  -->
<!--                               AND AL.AR_ADJ_APVL_USR_ID = SP.PSN_NUM ) -->
<!--           ) A -->
<!--         WHERE -->
<!--              P.GLBL_CMPY_CD                             = #glblCmpyCd# -->
<!--              AND P.EZCANCELFLAG                         = '0' -->
<!--              AND EXISTS (SELECT -->
<!--                               1 -->
<!--                          FROM -->
<!--                               AR_ADJ_APVL_LIMIT         AL1 -->
<!--                              ,AR_ADJ_APVL_LIMIT         AL2 -->
<!--                          WHERE -->
<!--                               AL1.GLBL_CMPY_CD          = #glblCmpyCd# -->
<!--                          AND AL1.EZCANCELFLAG           = '0' -->
<!--                          AND AL1.AR_ADJ_APVL_USR_ID     = A.PSN_NUM -->
<!--                          AND AL1.APVL_LIMIT_TO_AMT  &lt;= AL2.APVL_LIMIT_TO_AMT -->
<!--                          AND AL1.AR_ADJ_CATG_CD         = AL2.AR_ADJ_CATG_CD -->
<!--                          AND AL1.AR_ADJ_CATG_CD         = 'WRT' -->
<!--                          AND AL1.GLBL_CMPY_CD           = AL2.GLBL_CMPY_CD -->
<!--                          AND AL1.EZCANCELFLAG           = AL2.EZCANCELFLAG -->
<!--                          AND AL2.AR_ADJ_APVL_USR_ID     = P.PSN_NUM) -->
<!--              AND P.PSN_NUM                      &lt;&gt; #psnNum# -->
<!--         ORDER BY A.LV, P.PSN_NUM -->
<!--     </statement> -->
    <!-- END   2018/11/19 S.Takami [QC#29333, DEL] -->

    <!-- START 2018/11/19 S.Takami [QC#29333, ADD] -->
    <statement id="WF_FINACE_SQL" parameterClass="Map" resultClass="Map">
        SELECT
                #psnNum#                COND_STR_1
               <!-- START 2023/07/03 S.Fujita [QC#60397, ADD] -->
              , NVL(HL.APVL_LIMIT_AMT, AL.APVL_LIMIT_TO_AMT) COND_NUM_1
               <!-- END 2023/07/03 S.Fujita [QC#60397, ADD] -->
              , LD.PSN_NUM              VAL_STR_1
        FROM
            (
                SELECT
                      SP.GLBL_CMPY_CD   GLBL_CMPY_CD
                    , SP.PSN_NUM        PSN_NUM
                     <!-- START 2023/07/03 S.Fujita [QC#60397, ADD] -->
                    , SP.HR_TTL_NM
                     <!-- END 2023/07/03 S.Fujita [QC#60397, ADD] -->
                    , LEVEL             LV
                FROM
                <!-- START 2021/11/25 G.Delgado [QC#59332, MOD] -->
<!--                      S21_PSN           SP-->
<!--                WHERE-->
<!--                        SP.EZCANCELFLAG = '0'-->
<!--                    AND SP.GLBL_CMPY_CD = #glblCmpyCd#-->
                    (
                        SELECT
                              SP.GLBL_CMPY_CD
                            , SP.EZCANCELFLAG
                            , SP.PSN_CD
                            , SP.PSN_NUM
                            , SP.HR_SUPV_ID
                            <!-- START 2023/07/03 S.Fujita [QC#60397, ADD] -->
                             , SP.HR_TTL_NM
                            <!-- END 2023/07/03 S.Fujita [QC#60397, ADD] -->
                        FROM
                              S21_PSN           SP
                            , VAR_CHAR_CONST    VCC
                        WHERE
                                SP.GLBL_CMPY_CD       = #glblCmpyCd#
                            AND (
                                EXISTS (
                                    SELECT
                                        1
                                    FROM
                                        S21_PSN     W
                                    WHERE
                                           W.GLBL_CMPY_CD = SP.GLBL_CMPY_CD
                                       AND W.PSN_CD       = SP.HR_SUPV_ID
                                       AND W.EZCANCELFLAG = '0'
                                )
                                OR SP.PSN_CD = VCC.VAR_CHAR_CONST_VAL
                                OR SP.HR_SUPV_ID IS NULL
                            )
                            AND VCC.GLBL_CMPY_CD      = SP.GLBL_CMPY_CD
                            AND VCC.VAR_CHAR_CONST_NM = 'NFZC5000_HR_SUPV_ID'
                            AND SP.EZCANCELFLAG       = '0'
                            AND VCC.EZCANCELFLAG      = '0'
                        UNION ALL
                        SELECT
                              P.GLBL_CMPY_CD
                            , P.EZCANCELFLAG
                            , P.PSN_CD
                            , P.PSN_NUM
                            , VCC2.VAR_CHAR_CONST_VAL    AS HR_SUPV_ID
                            <!-- START 2023/07/03 S.Fujita [QC#60397, ADD] -->
                            , P.HR_TTL_NM
                            <!-- END 2023/07/03 S.Fujita [QC#60397, ADD] -->
                        FROM
                              S21_PSN           P
                            , VAR_CHAR_CONST    VCC1
                            , VAR_CHAR_CONST    VCC2
                        WHERE
                                P.GLBL_CMPY_CD            = #glblCmpyCd#
                            AND P.PSN_CD                  = VCC1.VAR_CHAR_CONST_VAL
                            AND P.HR_SUPV_ID              &lt;&gt; VCC2.VAR_CHAR_CONST_VAL
                            AND VCC1.GLBL_CMPY_CD         = P.GLBL_CMPY_CD
                            AND VCC1.VAR_CHAR_CONST_NM    = 'NFZC5000_PSN_CD'
                            AND VCC2.GLBL_CMPY_CD         = P.GLBL_CMPY_CD
                            AND VCC2.VAR_CHAR_CONST_NM    = 'NFZC5000_HR_SUPV_ID'
                            AND P.EZCANCELFLAG            = '0'
                            AND VCC1.EZCANCELFLAG         = '0'
                            AND VCC2.EZCANCELFLAG         = '0'
                    ) SP
                <!-- END 2021/11/25 G.Delgado [QC#59332, MOD] -->
                START WITH
                    SP.PSN_NUM          = #psnNum#
                CONNECT BY
                    PRIOR SP.HR_SUPV_ID = SP.PSN_CD
            ) LD
            , AR_ADJ_APVL_LIMIT         AL
           <!-- START 2023/07/03 S.Fujita [QC#60397, ADD] -->
        ,( 
                SELECT
                      HL.HR_TTL_NM
                    , MIN(HL.APVL_LIMIT_AMT) APVL_LIMIT_AMT
                FROM
                    HR_TTL_APVL_LIMIT HL
                WHERE
                        HL.GLBL_CMPY_CD        = #glblCmpyCd#
                    AND HL.APVL_LIMIT_ACTV_FLG = 'Y'
                    AND HL.AR_ADJ_CATG_CD      = 'ADJ'
                    AND HL.APVL_LIMIT_AMT      &gt; 0
                    AND HL.EZCANCELFLAG        = '0'
                GROUP BY
                    HL.HR_TTL_NM
            ) HL
           <!-- END 2023/07/03 S.Fujita [QC#60397, ADD] -->
        WHERE
            <!-- START 2023/07/03 S.Fujita [QC#60397, MOD] -->
            <!-- LD.GLBL_CMPY_CD             = AL.GLBL_CMPY_CD -->
            LD.GLBL_CMPY_CD             = AL.GLBL_CMPY_CD(+)          
            <!-- AND LD.PSN_NUM              = AL.AR_ADJ_APVL_USR_ID -->
            AND LD.PSN_NUM              = AL.AR_ADJ_APVL_USR_ID(+)
            <!-- AND AL.APVL_LIMIT_ACTV_FLG  = 'Y' -->
            AND AL.APVL_LIMIT_ACTV_FLG(+)  = 'Y'
            <!-- AND AL.AR_ADJ_CATG_CD       = 'ADJ' -->
            AND AL.AR_ADJ_CATG_CD(+)       = 'ADJ' 
            <!-- AND AL.APVL_LIMIT_TO_AMT &gt; 0 -->
            AND AL.APVL_LIMIT_TO_AMT(+)    &gt; 0
            <!-- AND AL.EZCANCELFLAG         = '0' -->
            AND AL.EZCANCELFLAG(+)         = '0'
            AND LD.HR_TTL_NM               = HL.HR_TTL_NM(+)
            AND NVL(HL.APVL_LIMIT_AMT, AL.APVL_LIMIT_TO_AMT) &gt; 0
            <!-- END 2023/07/03 S.Fujita [QC#60397, MOD] -->
        ORDER BY
            LD.LV
    </statement>

    <statement id="WF_GRP_APVL_SUB_PSN" parameterClass="Map" resultClass="Map">
        <!-- START 2023/07/03 S.Fujita [QC#60397, ADD] -->
        WITH TMP_HR_TTL_APVL_LIMIT AS
             (
                SELECT
                      HL.HR_TTL_NM
                    , MIN(HL.APVL_LIMIT_AMT) APVL_LIMIT_AMT
                FROM
                    HR_TTL_APVL_LIMIT HL
                WHERE
                        HL.GLBL_CMPY_CD        = #glblCmpyCd#
                    AND HL.APVL_LIMIT_ACTV_FLG = 'Y'
                    AND HL.AR_ADJ_CATG_CD      = 'ADJ'
                    AND HL.APVL_LIMIT_AMT      &gt; 0
                    AND HL.EZCANCELFLAG        = '0'
                GROUP BY
                    HL.HR_TTL_NM
            )
       <!-- END 2023/07/03 S.Fujita [QC#60397, ADD] -->
        SELECT
              #glblCmpyCd#                              AS GLBL_CMPY_CD
            , 'NFDL0090'                                AS BIZ_ID
            , 'GRP_APVL_SUB_PSN'                        AS USER_GROUP_NAME
            , RPAD('00',3, A.LV)                        AS USER_GROUP_LEVEL
            , P.PSN_NUM                                 AS WF_USR_ID
       <!-- START 2023/07/03 S.Fujita [QC#60397, ADD] -->
            , NVL(HL1.APVL_LIMIT_AMT, AL1.APVL_LIMIT_TO_AMT) AS SUB_APVL_LIMIT
            , A.APVL_LIMIT                              AS MAIN_APVL_LIMIT
       <!-- END 2023/07/03 S.Fujita [QC#60397, ADD] -->
        FROM
            S21_PSN P
         ,  AR_ADJ_APVL_LIMIT AL1
       <!-- START 2023/07/03 S.Fujita [QC#60397, ADD] -->
         ,  TMP_HR_TTL_APVL_LIMIT HL1
       <!-- END 2023/07/03 S.Fujita [QC#60397, ADD] -->
         , (
            SELECT
                SP.PSN_NUM                              AS PSN_NUM
                <!-- START 2019/11/22 H.Ikeda [QC#54758, MOD] -->
               , CASE WHEN EXISTS(
               <!-- START 2023/07/03 S.Fujita [QC#60397, ADD] -->
                                  SELECT
                                      1
                                  FROM
                                      TMP_HR_TTL_APVL_LIMIT HL
                                  WHERE
                                            HL.HR_TTL_NM  = 
                                            (
					              	SELECT
					                    SPS.HR_TTL_NM
					                FROM
					                    S21_PSN SPS
					                WHERE
					                        SPS.GLBL_CMPY_CD            = #glblCmpyCd#
					                    AND SPS.EZCANCELFLAG            = '0'
					                    AND SPS.PSN_NUM                 = #psnNum#                                            )
					                                 )
					  THEN SP.LV
					  WHEN EXISTS(
               <!-- END 2023/07/03 S.Fujita [QC#60397, ADD] -->
                                  SELECT
                                      1
                                  FROM
                                      AR_ADJ_APVL_LIMIT AAAL
                                  WHERE
                                            AAAL.GLBL_CMPY_CD        = #glblCmpyCd#
                                      AND   AAAL.APVL_LIMIT_ACTV_FLG = 'Y'
                                      AND   AAAL.AR_ADJ_CATG_CD      = 'ADJ'
                                      AND   AAAL.EZCANCELFLAG        = '0'
                                      AND   AAAL.AR_ADJ_APVL_USR_ID  = #psnNum#
                                      AND   AAAL.APVL_LIMIT_TO_AMT &gt; 0
                                 )
                     THEN SP.LV
                     ELSE SP.LV - 1
                END LV
                <!-- START 2023/07/03 S.Fujita [QC#60397, MOD] -->
                <!-- , AL2.APVL_LIMIT_TO_AMT                   AS APVL_LIMIT-->
              , NVL(HL2.APVL_LIMIT_AMT, AL2.APVL_LIMIT_TO_AMT) APVL_LIMIT
                <!-- END 2023/07/03 S.Fujita [QC#60397, MOD] -->
                <!-- END   2019/11/22 H.Ikeda [QC#54758, MOD] -->
            FROM
                (
                    SELECT
                        SPS.GLBL_CMPY_CD                GLBL_CMPY_CD
                      , SPS.PSN_NUM                     PSN_NUM
                      <!-- START 2023/07/03 S.Fujita [QC#60397, ADD] -->
                      , SPS.HR_TTL_NM                   HR_TTL_NM
                      <!-- END 2023/07/03 S.Fujita [QC#60397, ADD] -->
                      , LEVEL                           LV
                    FROM
                        S21_PSN SPS
                    WHERE
                            SPS.GLBL_CMPY_CD            = #glblCmpyCd#
                        AND SPS.EZCANCELFLAG            = '0'
                    START WITH
                        SPS.PSN_NUM                     = #psnNum#
                    CONNECT BY PRIOR
                        SPS.HR_SUPV_ID                  = SPS.PSN_CD
                ) SP
                , AR_ADJ_APVL_LIMIT AL2
                <!-- START 2023/07/03 S.Fujita [QC#60397, ADD] -->
                , TMP_HR_TTL_APVL_LIMIT HL2
                <!-- END 2023/07/03 S.Fujita [QC#60397, ADD] -->
            WHERE
                <!-- START 2019/11/22 H.Ikeda [QC#54758, MOD] -->
                    SP.GLBL_CMPY_CD                     = AL2.GLBL_CMPY_CD
                AND SP.PSN_NUM                          = AL2.AR_ADJ_APVL_USR_ID
                AND AL2.APVL_LIMIT_ACTV_FLG             = 'Y'
                AND AL2.AR_ADJ_CATG_CD                  = 'ADJ'
                AND AL2.EZCANCELFLAG                    = '0'
                AND SP.PSN_NUM                   &lt;&gt; #psnNum#
                AND AL2.APVL_LIMIT_TO_AMT            &gt; 0
                <!-- START 2023/07/03 S.Fujita [QC#60397, ADD] -->
                AND SP.HR_TTL_NM               = HL2.HR_TTL_NM(+)
                AND NVL(HL2.APVL_LIMIT_AMT, AL2.APVL_LIMIT_TO_AMT) &gt; 0
                <!-- END 2023/07/03 S.Fujita [QC#60397, ADD] -->
                <!-- END   2019/11/22 H.Ikeda [QC#54758, MOD] -->
          ) A
        WHERE
             P.GLBL_CMPY_CD                             = #glblCmpyCd#
             AND P.PSN_NUM                      &lt;&gt; #psnNum#
             AND P.EZCANCELFLAG                         = '0'
            <!-- START 2023/07/03 S.Fujita [QC#60397, MOD] -->
            <!-- AND P.GLBL_CMPY_CD                         = AL1.GLBL_CMPY_CD-->
             AND P.GLBL_CMPY_CD                         = AL1.GLBL_CMPY_CD(+)
            <!-- AND P.PSN_NUM                              = AL1.AR_ADJ_APVL_USR_ID-->
             AND P.PSN_NUM                              = AL1.AR_ADJ_APVL_USR_ID(+)
            <!-- AND AL1.APVL_LIMIT_ACTV_FLG                = 'Y'-->
             AND AL1.APVL_LIMIT_ACTV_FLG (+)               = 'Y'
            <!-- AND AL1.AR_ADJ_CATG_CD                     = 'ADJ'-->
             AND AL1.AR_ADJ_CATG_CD(+)                     = 'ADJ'
            <!-- AND AL1.EZCANCELFLAG                       = '0'-->
             AND AL1.EZCANCELFLAG(+)                       = '0'
            <!-- AND AL1.APVL_LIMIT_TO_AMT              &gt;= A.APVL_LIMIT--> <!-- 2019/11/05 H.Ikeda [QC#54429, MOD] -->
             AND P.HR_TTL_NM               = HL1.HR_TTL_NM(+)
             AND NVL(HL1.APVL_LIMIT_AMT, AL1.APVL_LIMIT_TO_AMT)    &gt;= A.APVL_LIMIT
            <!-- END 2023/07/03 S.Fujita [QC#60397, MOD] -->
        ORDER BY
             A.LV
             , P.PSN_NUM
    </statement>
    <!-- END   2018/11/19 S.Takami [QC#29333, ADD] -->

    <!-- START 2020/02/07 [QC#55637, ADD] -->
    <statement id="WF_WRITEOFF_REASSIGN" parameterClass="Map" resultClass="Map">
        SELECT
              #glblCmpyCd#        AS GLBL_CMPY_CD
            , 'NFDL0090'          AS BIZ_ID
            , 'WRTOFF_REASSIGN'   AS USER_GROUP_NAME
            , '000'               AS USER_GROUP_LEVEL
            , PS.PSN_NUM          AS WF_USR_ID
        FROM
              S21_PSN             PS
            , AUTH_PSN            AP
            <!-- START 2023/07/03 S.Fujita [QC#60397, MOD] -->
            , AR_ADJ_APVL_LIMIT   AL
            
            
        WHERE
                PS.GLBL_CMPY_CD     = 'ADB'
            AND PS.EZCANCELFLAG     = '0'
            AND PS.GLBL_CMPY_CD     = AP.GLBL_CMPY_CD
            AND PS.PSN_CD           = AP.USR_NM
            AND AP.EZCANCELFLAG     = '0'
            AND PS.GLBL_CMPY_CD     = AL.GLBL_CMPY_CD
            AND PS.PSN_CD           = AL.AR_ADJ_APVL_USR_ID
            AND AL.EZCANCELFLAG     = '0'
            AND AL.AR_ADJ_CATG_CD   = 'ADJ'
            AND AL.APVL_LIMIT_ACTV_FLG = 'Y'
            AND AL.APVL_LIMIT_TO_AMT &gt; 0
        <!-- START 2023/07/03 S.Fujita [QC#60397, ADD] -->
        UNION
        SELECT
              #glblCmpyCd#        AS GLBL_CMPY_CD
            , 'NFDL0090'          AS BIZ_ID
            , 'WRTOFF_REASSIGN'   AS USER_GROUP_NAME
            , '000'               AS USER_GROUP_LEVEL
            , PS.PSN_NUM          AS WF_USR_ID
        FROM
              S21_PSN             PS
            , AUTH_PSN            AP
            , HR_TTL_APVL_LIMIT   HL
        WHERE
                PS.GLBL_CMPY_CD        = #glblCmpyCd#
            AND PS.EZCANCELFLAG        = '0'
            AND PS.GLBL_CMPY_CD        = AP.GLBL_CMPY_CD
            AND PS.PSN_CD              = AP.USR_NM
            AND AP.EZCANCELFLAG        = '0'
            AND PS.GLBL_CMPY_CD        = HL.GLBL_CMPY_CD
            AND PS.HR_TTL_NM           = HL.HR_TTL_NM
            AND HL.EZCANCELFLAG        = '0'
            AND HL.AR_ADJ_CATG_CD      = 'ADJ'
            AND HL.APVL_LIMIT_ACTV_FLG = 'Y'
            AND HL.APVL_LIMIT_AMT      &gt; 0
      <!-- END 2023/07/03 S.Fujita [QC#60397, ADD] -->
    </statement>
    <!-- END   2020/02/07 [QC#55637, ADD] -->

</sqlMap>