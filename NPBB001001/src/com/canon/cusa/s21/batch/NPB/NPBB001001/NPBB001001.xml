<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPBB001001">
    <statement id="getInventoryRequestRelease" parameterClass="Map" resultClass="Map">
        SELECT
            P.PRCH_REQ_NUM
           ,P.PRCH_REQ_REC_TP_CD
           ,P.PRCH_REQ_TP_CD
           ,P.PRCH_REQ_STS_CD
           ,P.PRCH_REQ_CRAT_DT
           ,P.PRCH_REQ_CRAT_TM
           ,P.PRCH_REQ_CRAT_TZ
           ,P.PRCH_REQ_CRAT_DISP_DT_TM_TS
           ,P.PRCH_REQ_CRAT_BY_PSN_CD
           ,P.PRCH_REQ_CRAT_BY_NM
           ,P.PRCH_REQ_RQST_BY_PSN_CD
           ,P.PRCH_REQ_SRC_TP_CD
           ,P.PRCH_GRP_CD
           ,P.FSR_NUM
           ,P.SVC_TASK_NUM
           ,P.SVC_MACH_SER_NUM
           ,P.TRX_REF_NUM
           ,P.CPO_ORD_NUM
           ,P.CUST_ISS_PO_NUM
           ,P.CUST_ISS_PO_DT
           ,P.CPO_ORD_TP_CD
           ,P.CTAC_PSN_NM
           ,P.ADMIN_PSN_CD
           ,P.PRCH_REQ_APVL_STS_CD
           ,P.PRCH_REQ_APVL_DT
           ,P.PRCH_REQ_APVL_BY_PSN_CD
           ,P.PRCH_REQ_APVL_BY_NM
           ,P.RQST_TECH_TOC_CD
           ,P.SHIP_TO_CUST_CD
           ,P.SHIP_TO_LOC_NM
           ,P.SHIP_TO_ADDL_LOC_NM
           ,P.SHIP_TO_FIRST_LINE_ADDR
           ,P.SHIP_TO_SCD_LINE_ADDR
           ,P.SHIP_TO_THIRD_LINE_ADDR
           ,P.SHIP_TO_FRTH_LINE_ADDR
           ,P.SHIP_TO_FIRST_REF_CMNT_TXT
           ,P.SHIP_TO_SCD_REF_CMNT_TXT
           ,P.SHIP_TO_CTY_ADDR
           ,P.SHIP_TO_ST_CD
           ,P.SHIP_TO_PROV_NM
           ,P.SHIP_TO_CNTY_NM
           ,P.SHIP_TO_POST_CD
           ,P.SHIP_TO_CTRY_CD
           ,P.BILL_TO_CUST_CD
           ,P.SELL_TO_CUST_CD
           ,P.ASL_SHIP_TO_CUST_CD
           ,P.LINE_BIZ_TP_CD
           ,P.PO_QLFY_CD
           ,P.VND_DROP_SHIP_FLG
           ,P.PRCH_REQ_CMNT_TXT
           ,P.DELY_ADDL_CMNT_TXT
           ,P.RCV_ADDL_CMNT_TXT
           ,P.BAT_ERR_MSG_TXT
           ,D.PRCH_REQ_LINE_NUM
           ,D.PRCH_REQ_LINE_SUB_NUM
           ,D.PRCH_REQ_INTFC_PK
           ,D.ORIG_PRCH_REQ_LINE_NUM
           ,D.ORIG_PRCH_REQ_LINE_SUB_NUM
           ,D.PRCH_REQ_LINE_TP_CD
           ,D.PRCH_REQ_LINE_STS_CD
           ,D.PRCH_REQ_CRAT_DT          DTL_PRCH_REQ_CRAT_DT
           ,D.PRCH_REQ_CRAT_TM          DTL_PRCH_REQ_CRAT_TM
           ,D.RQST_RCV_DT
           ,D.RQST_RCV_TM
           ,D.RQST_RCV_TZ
           ,D.RQST_RCV_DISP_DT_TM_TS
           ,D.PO_SCHD_REL_DT
           ,D.PRCH_REQ_REL_STS_CD
           ,D.PRCH_REQ_REL_DT_TM_TS
           ,D.PRCH_REQ_REL_ERR_MSG_TXT
           ,D.PRCH_REQ_FRZ_FLG
           ,D.SHPG_PLN_NUM
           ,D.SHIP_FROM_SO_NUM
           ,D.PROCR_TP_CD
           ,D.DEST_INVTY_LOC_CD
           ,D.DEST_RTL_WH_CD
           ,D.DEST_RTL_SWH_CD
           ,D.SRC_INVTY_LOC_CD
           ,D.SRC_RTL_WH_CD
           ,D.SRC_RTL_SWH_CD
           ,D.PRNT_VND_CD
           ,D.VND_CD
           ,D.VND_INVTY_LOC_CD
           ,NVL(D.SHPG_SVC_LVL_CD, #INVTY_REQ_DEF_SHPG_SVC_LVL_CD#) SHPG_SVC_LVL_CD
           ,D.CARR_CD
           ,D.CARR_ACCT_NUM
           ,D.CONFIG_TP_CD
           ,D.SVC_CONFIG_MSTR_PK
           ,D.MDSE_CD
           ,D.PO_MDSE_CMPSN_TP_CD
           ,D.ORIG_RQST_MDSE_CD
           ,D.ASL_MDSE_CD
           ,D.PRCH_REQ_QTY
           ,D.ORD_QTY
           ,D.CUST_UOM_CD
           ,D.PRCH_REQ_DISP_QTY
           ,D.PRCH_REQ_DSPL_UOM_CD
           ,D.PRCH_REQ_REL_QTY
           ,D.PRCH_REQ_BAL_QTY
           ,D.PRCH_REQ_INSRC_QTY
           ,D.PRCH_REQ_CANC_QTY
           ,D.ROP_QTY
           ,D.MIN_ORD_QTY
           ,D.INCR_ORD_QTY
           ,D.MAX_INVTY_QTY
           ,D.CUR_INVTY_QTY
           ,D.CUR_INVTY_AVAL_QTY
           ,D.SCHD_INBD_QTY
           ,D.SCHD_OTBD_QTY
           ,D.INSRC_FLG
           ,D.PO_CRAT_FLG
           ,D.REL_RQST_TO_PO_ORD_NUM
           ,D.PO_ORD_NUM
           ,D.PO_ORD_DTL_LINE_NUM
           ,D.INVTY_ORD_NUM
           ,D.INVTY_ORD_LINE_NUM
           ,D.WRK_ORD_NUM
           ,D.WRK_ORD_DTL_LINE_NUM
           ,D.TRX_REF_NUM               DTL_TRX_REF_NUM
           ,D.TRX_REF_LINE_NUM
           ,D.TRX_REF_LINE_SUB_NUM
           ,D.PRCH_REQ_LINE_CMNT_TXT
           ,D.BO_EML_PROC_STS_CD
           ,D.SO_NUM
           ,D.PRO_NUM
           ,D.SHIP_DT_TM_TS
           ,D.SHIP_QTY
           ,D.RWS_NUM
           ,D.RWS_CLO_DT_TM_TS
           ,D.RWS_PUT_AWAY_QTY
           ,D.BACK_TO_TECH_QTY
           ,D.FROM_STK_STS_CD
           ,D.TO_STK_STS_CD
           ,D.THIS_MTH_FOB_COST_AMT
           ,D.ASL_DTL_PK
           ,D.ASL_UNIT_PRC_AMT
           ,D.ENT_DEAL_NET_UNIT_PRC_AMT
           ,D.ENT_PO_DTL_DEAL_NET_AMT
           ,D.ENT_FUNC_NET_UNIT_PRC_AMT
           ,D.ENT_PO_DTL_FUNC_NET_AMT
           ,D.CCY_CD
           ,D.EXCH_RATE
           ,D.FRT_CHRG_TO_CD
           ,D.FRT_CHRG_METH_CD
           ,D.FRT_COND_CD
           ,D.VND_PMT_TERM_CD
           ,D.VND_PMT_TERM_DESC_TXT
           ,D.COA_CMPY_CD
           ,D.COA_AFFL_CD
           ,D.COA_BR_CD
           ,D.COA_CH_CD
           ,D.COA_CC_CD
           ,D.COA_ACCT_CD
           ,D.COA_PROJ_CD
           ,D.COA_EXTN_CD
           ,D.COA_PROD_CD
           ,D.TECH_RQST_NTC_ML_PROC_CD
           ,D.TECH_RTN_NTC_ML_PROC_CD
           ,D.VND_RTRN_RSN_CD
           ,D.BAT_ERR_MSG_TXT           DTL_BAT_ERR_MSG_TXT
           ,T.TRX_SRC_TP_CD
           ,T.SCE_ORD_TP_CD
           ,T.INVTY_ORD_TP_CD
           ,MDSE.MDSE_NM
           ,MDSE.FIRST_PROD_CTRL_CD
           ,MDSE.INSTL_BASE_CTRL_FLG
           ,MTVS.MDSE_TP_CTX_TP_CD
           ,CASE
                WHEN D.CONFIG_TP_CD IS NULL THEN 'N'
                ELSE 'Y'
            END AS CONFIG_FLG
           ,NVL(MSI.HAZ_MAT_FLG, #DEF_HAZ_MAT_FLG#)    HAZ_MAT_FLG
           <!-- QC#18365(L3) ADD START -->
           ,MDSE.DROP_RTRN_VND_CD
           <!-- QC#18365(L3) ADD END -->
           <!-- START 2018/02/02  [QC#21703,ADD] -->
           <!-- START 2018/05/25 S.Katsuma [QC#25893,DEL] -->
           <!-- ,MDSE.THIS_MTH_TOT_STD_COST_AMT -->
           <!-- END 2018/05/25 S.Katsuma [QC#25893,DEL] -->
           ,PUC.BASE_PKG_UOM_CD                       PKG_UOM_CD
           <!-- END   2018/02/02  [QC#21703,ADD] -->
        FROM
            PRCH_REQ                      P
           ,PRCH_REQ_DTL                  D
           ,PRCH_REQ_APVL_STS             S
           ,PRCH_REQ_TP                   T
           ,MDSE                          MDSE
           ,MDSE_TP_VAL_SET               MTVS
           ,MDSE_SFTY_INFO                MSI
           <!-- START 2018/02/02  [QC#21703,ADD] -->
           ,PKG_UOM_CLS                   PUC
           <!-- END   2018/02/02  [QC#21703,ADD] -->
        WHERE
                P.GLBL_CMPY_CD            = #GLBL_CMPY_CD#
            AND P.PRCH_REQ_REC_TP_CD      = #PRCH_REQ_REC_TP_CD#
            <iterate property="PRCH_REQ_STS_CD" var="PRCH_REQ_STS_CD[]" open="AND P.PRCH_REQ_STS_CD IN (" conjunction= ", " close=")">
            #PRCH_REQ_STS_CD[]#
            </iterate>
            AND P.GLBL_CMPY_CD            = D.GLBL_CMPY_CD
            AND P.PRCH_REQ_NUM            = D.PRCH_REQ_NUM
            AND D.PRCH_REQ_REL_STS_CD     IN (#IN_COMPLETED#, #ERROR#)
            AND P.GLBL_CMPY_CD            = S.GLBL_CMPY_CD
            AND P.PRCH_REQ_APVL_STS_CD    = S.PRCH_REQ_APVL_STS_CD
            AND S.PRCH_REQ_APVL_FLG       = #PRCH_REQ_APVL_FLG#
            AND P.GLBL_CMPY_CD            = T.GLBL_CMPY_CD
            AND P.PRCH_REQ_TP_CD          = T.PRCH_REQ_TP_CD
            AND T.TRX_SRC_TP_CD           IS NOT NULL
            AND D.GLBL_CMPY_CD            = MDSE.GLBL_CMPY_CD(+)
            AND D.MDSE_CD                 = MDSE.MDSE_CD(+)
            AND MDSE.GLBL_CMPY_CD         = MTVS.GLBL_CMPY_CD(+)
            AND MDSE.COA_MDSE_TP_CD       = MTVS.COA_MDSE_TP_CD(+)
            AND MTVS.MDSE_TP_CTX_TP_CD(+) = #MDSE_TP_CTX_TP_CD#
            AND P.EZCANCELFLAG            = 0
            AND D.EZCANCELFLAG            = 0
            AND S.EZCANCELFLAG            = 0
            AND T.EZCANCELFLAG            = 0
            AND MDSE.EZCANCELFLAG(+)      = 0
            AND MTVS.EZCANCELFLAG(+)      = 0
            <!-- QC#17395 Start. -->
            AND MDSE.GLBL_CMPY_CD            = MSI.GLBL_CMPY_CD(+)
            AND MDSE.MDSE_CD                 = MSI.MDSE_CD(+)
            AND MSI.EZCANCELFLAG(+)       = 0
           <!-- START 2018/02/02  [QC#21703,ADD] -->
            AND MDSE.GLBL_CMPY_CD         = PUC.GLBL_CMPY_CD(+)
            AND MDSE.PKG_UOM_CLS_CD       = PUC.PKG_UOM_CLS_CD(+)
            AND PUC.EZCANCELFLAG(+)       = 0
           <!-- END   2018/02/02  [QC#21703,ADD] -->
            <isNotNull property="whOwnrCdList">
            AND (EXISTS (SELECT
                                   1
                            FROM
                                 MDSE_SFTY_INFO MSI
                            WHERE
                                D.GLBL_CMPY_CD        = MSI.GLBL_CMPY_CD
                                AND D.MDSE_CD         = MSI.MDSE_CD
                                AND MSI.HAZ_MAT_FLG   = #HAZ_MAT_FLG_N#
                                AND MSI.EZCANCELFLAG  = '0'
                        )
                        OR EXISTS
                        (SELECT
                                   1
                            FROM
                                 MDSE_SFTY_INFO MSI
                                ,RTL_WH         RW
                            WHERE
                                D.GLBL_CMPY_CD        = MSI.GLBL_CMPY_CD
                                AND D.MDSE_CD         = MSI.MDSE_CD
                                AND MSI.HAZ_MAT_FLG   = #HAZ_MAT_FLG_Y#
                                AND D.GLBL_CMPY_CD    = RW.GLBL_CMPY_CD
                                AND D.SRC_RTL_WH_CD   = RW.RTL_WH_CD
                                <iterate property="whOwnrCdList" var="whOwnrCdList[]" open="AND RW.WH_OWNR_CD NOT IN (" conjunction= ", " close=")">
                                    #whOwnrCdList[]#
                                </iterate>
                                AND MSI.EZCANCELFLAG  = '0'
                                AND RW.EZCANCELFLAG   = '0'
                        )
                        OR EXISTS
                        (SELECT
                                   1
                            FROM
                                 MDSE_SFTY_INFO MSI
                                ,RTL_WH         RW
                            WHERE
                                D.GLBL_CMPY_CD        = MSI.GLBL_CMPY_CD
                                AND D.MDSE_CD         = MSI.MDSE_CD
                                AND MSI.HAZ_MAT_FLG   = #HAZ_MAT_FLG_Y#
                                AND D.GLBL_CMPY_CD    = RW.GLBL_CMPY_CD
                                AND D.SRC_RTL_WH_CD   = RW.RTL_WH_CD
                                <iterate property="whOwnrCdList" var="whOwnrCdList[]" open="AND RW.WH_OWNR_CD IN (" conjunction= ", " close=")">
                                    #whOwnrCdList[]#
                                </iterate>
                                AND D.CONFIG_TP_CD    IS NOT NULL
                                AND MSI.EZCANCELFLAG  = '0'
                                AND RW.EZCANCELFLAG   = '0'
                        )
                        OR EXISTS
                        (SELECT
                                   1
                            FROM
                                 MDSE_SFTY_INFO MSI
                            WHERE
                                D.GLBL_CMPY_CD        = MSI.GLBL_CMPY_CD
                                AND D.MDSE_CD         = MSI.MDSE_CD
                                AND MSI.HAZ_MAT_FLG   = #HAZ_MAT_FLG_Y#
                                AND T.TRX_SRC_TP_CD   = #TRX_SRC_TP_CD_WHOLE_SALES#
                                AND MSI.EZCANCELFLAG  = '0'
                        )
                        OR EXISTS
                        (SELECT
                                   1
                            FROM
                                 PRCH_REQ_DTL PRD
                            WHERE
                                D.GLBL_CMPY_CD                = PRD.GLBL_CMPY_CD
                                AND D.PRCH_REQ_NUM            = PRD.PRCH_REQ_NUM
                                AND D.PRCH_REQ_LINE_NUM       = PRD.PRCH_REQ_LINE_NUM
                                AND D.PRCH_REQ_LINE_SUB_NUM   = PRD.PRCH_REQ_LINE_SUB_NUM
                                AND PRD.MDSE_CD               IS NULL
                                AND PRD.EZCANCELFLAG          = '0'
                        )
            )
            </isNotNull>
            <!-- QC#17395 End. -->
        ORDER BY
             T.TRX_SRC_TP_CD
            ,D.PRCH_REQ_NUM
            ,D.CONFIG_TP_CD
            ,D.SRC_RTL_WH_CD
            ,D.DEST_RTL_WH_CD
            ,D.PRCH_REQ_LINE_NUM
            ,D.PRCH_REQ_LINE_SUB_NUM
            ,D.DEST_INVTY_LOC_CD
            ,D.PRNT_VND_CD
            ,D.VND_CD
            ,D.RQST_RCV_DT
            ,D.RQST_RCV_TM
    </statement>

    <statement id="getInventoryRequestReleaseForHazmat" parameterClass="Map" resultClass="Map">
        SELECT
            P.PRCH_REQ_NUM
           ,P.PRCH_REQ_REC_TP_CD
           ,P.PRCH_REQ_TP_CD
           ,P.PRCH_REQ_STS_CD
           ,P.PRCH_REQ_CRAT_DT
           ,P.PRCH_REQ_CRAT_TM
           ,P.PRCH_REQ_CRAT_TZ
           ,P.PRCH_REQ_CRAT_DISP_DT_TM_TS
           ,P.PRCH_REQ_CRAT_BY_PSN_CD
           ,P.PRCH_REQ_CRAT_BY_NM
           ,P.PRCH_REQ_RQST_BY_PSN_CD
           ,P.PRCH_REQ_SRC_TP_CD
           ,P.PRCH_GRP_CD
           ,P.FSR_NUM
           ,P.SVC_TASK_NUM
           ,P.SVC_MACH_SER_NUM
           ,P.TRX_REF_NUM
           ,P.CPO_ORD_NUM
           ,P.CUST_ISS_PO_NUM
           ,P.CUST_ISS_PO_DT
           ,P.CPO_ORD_TP_CD
           ,P.CTAC_PSN_NM
           ,P.ADMIN_PSN_CD
           ,P.PRCH_REQ_APVL_STS_CD
           ,P.PRCH_REQ_APVL_DT
           ,P.PRCH_REQ_APVL_BY_PSN_CD
           ,P.PRCH_REQ_APVL_BY_NM
           ,P.RQST_TECH_TOC_CD
           ,P.SHIP_TO_CUST_CD
           ,P.SHIP_TO_LOC_NM
           ,P.SHIP_TO_ADDL_LOC_NM
           ,P.SHIP_TO_FIRST_LINE_ADDR
           ,P.SHIP_TO_SCD_LINE_ADDR
           ,P.SHIP_TO_THIRD_LINE_ADDR
           ,P.SHIP_TO_FRTH_LINE_ADDR
           ,P.SHIP_TO_FIRST_REF_CMNT_TXT
           ,P.SHIP_TO_SCD_REF_CMNT_TXT
           ,P.SHIP_TO_CTY_ADDR
           ,P.SHIP_TO_ST_CD
           ,P.SHIP_TO_PROV_NM
           ,P.SHIP_TO_CNTY_NM
           ,P.SHIP_TO_POST_CD
           ,P.SHIP_TO_CTRY_CD
           ,P.BILL_TO_CUST_CD
           ,P.SELL_TO_CUST_CD
           ,P.ASL_SHIP_TO_CUST_CD
           ,P.LINE_BIZ_TP_CD
           ,P.PO_QLFY_CD
           ,P.VND_DROP_SHIP_FLG
           ,P.PRCH_REQ_CMNT_TXT
           ,P.DELY_ADDL_CMNT_TXT
           ,P.RCV_ADDL_CMNT_TXT
           ,P.BAT_ERR_MSG_TXT
           ,D.PRCH_REQ_LINE_NUM
           ,D.PRCH_REQ_LINE_SUB_NUM
           ,D.PRCH_REQ_INTFC_PK
           ,D.ORIG_PRCH_REQ_LINE_NUM
           ,D.ORIG_PRCH_REQ_LINE_SUB_NUM
           ,D.PRCH_REQ_LINE_TP_CD
           ,D.PRCH_REQ_LINE_STS_CD
           ,D.PRCH_REQ_CRAT_DT          DTL_PRCH_REQ_CRAT_DT
           ,D.PRCH_REQ_CRAT_TM          DTL_PRCH_REQ_CRAT_TM
           ,D.RQST_RCV_DT
           ,D.RQST_RCV_TM
           ,D.RQST_RCV_TZ
           ,D.RQST_RCV_DISP_DT_TM_TS
           ,D.PO_SCHD_REL_DT
           ,D.PRCH_REQ_REL_STS_CD
           ,D.PRCH_REQ_REL_DT_TM_TS
           ,D.PRCH_REQ_REL_ERR_MSG_TXT
           ,D.PRCH_REQ_FRZ_FLG
           ,D.SHPG_PLN_NUM
           ,D.SHIP_FROM_SO_NUM
           ,D.PROCR_TP_CD
           ,D.DEST_INVTY_LOC_CD
           ,D.DEST_RTL_WH_CD
           ,D.DEST_RTL_SWH_CD
           ,D.SRC_INVTY_LOC_CD
           ,D.SRC_RTL_WH_CD
           ,D.SRC_RTL_SWH_CD
           ,D.PRNT_VND_CD
           ,D.VND_CD
           ,D.VND_INVTY_LOC_CD
           ,NVL(D.SHPG_SVC_LVL_CD, #INVTY_REQ_DEF_SHPG_SVC_LVL_CD#) SHPG_SVC_LVL_CD
           ,D.CARR_CD
           ,D.CARR_ACCT_NUM
           ,D.CONFIG_TP_CD
           ,D.SVC_CONFIG_MSTR_PK
           ,D.MDSE_CD
           ,D.PO_MDSE_CMPSN_TP_CD
           ,D.ORIG_RQST_MDSE_CD
           ,D.ASL_MDSE_CD
           ,D.PRCH_REQ_QTY
           ,D.ORD_QTY
           ,D.CUST_UOM_CD
           ,D.PRCH_REQ_DISP_QTY
           ,D.PRCH_REQ_DSPL_UOM_CD
           ,D.PRCH_REQ_REL_QTY
           ,D.PRCH_REQ_BAL_QTY
           ,D.PRCH_REQ_INSRC_QTY
           ,D.PRCH_REQ_CANC_QTY
           ,D.ROP_QTY
           ,D.MIN_ORD_QTY
           ,D.INCR_ORD_QTY
           ,D.MAX_INVTY_QTY
           ,D.CUR_INVTY_QTY
           ,D.CUR_INVTY_AVAL_QTY
           ,D.SCHD_INBD_QTY
           ,D.SCHD_OTBD_QTY
           ,D.INSRC_FLG
           ,D.PO_CRAT_FLG
           ,D.REL_RQST_TO_PO_ORD_NUM
           ,D.PO_ORD_NUM
           ,D.PO_ORD_DTL_LINE_NUM
           ,D.INVTY_ORD_NUM
           ,D.INVTY_ORD_LINE_NUM
           ,D.WRK_ORD_NUM
           ,D.WRK_ORD_DTL_LINE_NUM
           ,D.TRX_REF_NUM               DTL_TRX_REF_NUM
           ,D.TRX_REF_LINE_NUM
           ,D.TRX_REF_LINE_SUB_NUM
           ,D.PRCH_REQ_LINE_CMNT_TXT
           ,D.BO_EML_PROC_STS_CD
           ,D.SO_NUM
           ,D.PRO_NUM
           ,D.SHIP_DT_TM_TS
           ,D.SHIP_QTY
           ,D.RWS_NUM
           ,D.RWS_CLO_DT_TM_TS
           ,D.RWS_PUT_AWAY_QTY
           ,D.BACK_TO_TECH_QTY
           ,D.FROM_STK_STS_CD
           ,D.TO_STK_STS_CD
           ,D.THIS_MTH_FOB_COST_AMT
           ,D.ASL_DTL_PK
           ,D.ASL_UNIT_PRC_AMT
           ,D.ENT_DEAL_NET_UNIT_PRC_AMT
           ,D.ENT_PO_DTL_DEAL_NET_AMT
           ,D.ENT_FUNC_NET_UNIT_PRC_AMT
           ,D.ENT_PO_DTL_FUNC_NET_AMT
           ,D.CCY_CD
           ,D.EXCH_RATE
           ,D.FRT_CHRG_TO_CD
           ,D.FRT_CHRG_METH_CD
           ,D.FRT_COND_CD
           ,D.VND_PMT_TERM_CD
           ,D.VND_PMT_TERM_DESC_TXT
           ,D.COA_CMPY_CD
           ,D.COA_AFFL_CD
           ,D.COA_BR_CD
           ,D.COA_CH_CD
           ,D.COA_CC_CD
           ,D.COA_ACCT_CD
           ,D.COA_PROJ_CD
           ,D.COA_EXTN_CD
           ,D.COA_PROD_CD
           ,D.TECH_RQST_NTC_ML_PROC_CD
           ,D.TECH_RTN_NTC_ML_PROC_CD
           ,D.VND_RTRN_RSN_CD
           ,D.BAT_ERR_MSG_TXT           DTL_BAT_ERR_MSG_TXT
           ,T.TRX_SRC_TP_CD
           ,T.SCE_ORD_TP_CD
           ,T.INVTY_ORD_TP_CD
           ,MDSE.MDSE_NM
           ,MDSE.FIRST_PROD_CTRL_CD
           ,MDSE.INSTL_BASE_CTRL_FLG
           ,MTVS.MDSE_TP_CTX_TP_CD
           ,CASE
                WHEN D.CONFIG_TP_CD IS NULL THEN 'N'
                ELSE 'Y'
            END AS CONFIG_FLG
           ,NVL(MSI.HAZ_MAT_FLG, #DEF_HAZ_MAT_FLG#)    HAZ_MAT_FLG
           <!-- QC#18365(L3) ADD START -->
           ,MDSE.DROP_RTRN_VND_CD
           <!-- QC#18365(L3) ADD END -->
           <!-- START 2018/02/02  [QC#21703,ADD] -->
           ,MDSE.THIS_MTH_TOT_STD_COST_AMT
           ,PUC.BASE_PKG_UOM_CD                        PKG_UOM_CD
           <!-- END   2018/02/02  [QC#21703,ADD] -->
        FROM
            PRCH_REQ                      P
           ,PRCH_REQ_DTL                  D
           ,PRCH_REQ_APVL_STS             S
           ,PRCH_REQ_TP                   T
           ,MDSE                          MDSE
           ,MDSE_TP_VAL_SET               MTVS
           ,MDSE_SFTY_INFO                MSI
           <!-- START 2018/02/02  [QC#21703,ADD] -->
           ,PKG_UOM_CLS                   PUC
           <!-- END   2018/02/02  [QC#21703,ADD] -->
        WHERE
                P.GLBL_CMPY_CD            = #GLBL_CMPY_CD#
            AND P.PRCH_REQ_REC_TP_CD      = #PRCH_REQ_REC_TP_CD#
            <iterate property="PRCH_REQ_STS_CD" var="PRCH_REQ_STS_CD[]" open="AND P.PRCH_REQ_STS_CD IN (" conjunction= ", " close=")">
            #PRCH_REQ_STS_CD[]#
            </iterate>
            AND P.GLBL_CMPY_CD            = D.GLBL_CMPY_CD
            AND P.PRCH_REQ_NUM            = D.PRCH_REQ_NUM
            AND D.PRCH_REQ_REL_STS_CD     IN (#IN_COMPLETED#, #ERROR#)
            AND P.GLBL_CMPY_CD            = S.GLBL_CMPY_CD
            AND P.PRCH_REQ_APVL_STS_CD    = S.PRCH_REQ_APVL_STS_CD
            AND S.PRCH_REQ_APVL_FLG       = #PRCH_REQ_APVL_FLG#
            AND P.GLBL_CMPY_CD            = T.GLBL_CMPY_CD
            AND P.PRCH_REQ_TP_CD          = T.PRCH_REQ_TP_CD
            AND T.TRX_SRC_TP_CD           IS NOT NULL
            AND D.GLBL_CMPY_CD            = MDSE.GLBL_CMPY_CD(+)
            AND D.MDSE_CD                 = MDSE.MDSE_CD(+)
            AND MDSE.GLBL_CMPY_CD         = MTVS.GLBL_CMPY_CD(+)
            AND MDSE.COA_MDSE_TP_CD       = MTVS.COA_MDSE_TP_CD(+)
            AND MTVS.MDSE_TP_CTX_TP_CD(+) = #MDSE_TP_CTX_TP_CD#
            AND P.EZCANCELFLAG            = 0
            AND D.EZCANCELFLAG            = 0
            AND S.EZCANCELFLAG            = 0
            AND T.EZCANCELFLAG            = 0
            AND MDSE.EZCANCELFLAG(+)      = 0
            AND MTVS.EZCANCELFLAG(+)      = 0
            <!-- QC#17395 Start. -->
            AND MDSE.GLBL_CMPY_CD            = MSI.GLBL_CMPY_CD(+)
            AND MDSE.MDSE_CD                 = MSI.MDSE_CD(+)
            AND MSI.EZCANCELFLAG(+)       = 0
           <!-- START 2018/02/02  [QC#21703,ADD] -->
            AND MDSE.GLBL_CMPY_CD         = PUC.GLBL_CMPY_CD(+)
            AND MDSE.PKG_UOM_CLS_CD       = PUC.PKG_UOM_CLS_CD(+)
            AND PUC.EZCANCELFLAG(+)       = 0
           <!-- END   2018/02/02  [QC#21703,ADD] -->
            <isNotNull property="whOwnrCdList">
            AND (EXISTS
                        (SELECT
                                   1
                            FROM
                                 MDSE_SFTY_INFO MSI
                                ,RTL_WH         RW
                            WHERE
                                D.GLBL_CMPY_CD        = MSI.GLBL_CMPY_CD
                                AND D.MDSE_CD         = MSI.MDSE_CD
                                AND MSI.HAZ_MAT_FLG   = #HAZ_MAT_FLG_Y#
                                AND D.GLBL_CMPY_CD    = RW.GLBL_CMPY_CD
                                AND D.SRC_RTL_WH_CD   = RW.RTL_WH_CD
                                <iterate property="whOwnrCdList" var="whOwnrCdList[]" open="AND RW.WH_OWNR_CD IN (" conjunction= ", " close=")">
                                    #whOwnrCdList[]#
                                </iterate>
                                AND T.TRX_SRC_TP_CD   &lt;&gt; #TRX_SRC_TP_CD_WHOLE_SALES#
                                AND D.CONFIG_TP_CD    IS NULL
                                AND MSI.EZCANCELFLAG  = '0'
                                AND RW.EZCANCELFLAG   = '0'
                        )
            )
            </isNotNull>
            <!-- QC#17395 End. -->
        ORDER BY
             T.TRX_SRC_TP_CD
            ,D.PRCH_REQ_NUM
            ,D.CONFIG_TP_CD
            ,D.SRC_RTL_WH_CD
            ,D.DEST_RTL_WH_CD
            ,D.PRCH_REQ_LINE_NUM
            ,D.PRCH_REQ_LINE_SUB_NUM
            ,D.DEST_INVTY_LOC_CD
            ,D.PRNT_VND_CD
            ,D.VND_CD
            ,D.RQST_RCV_DT
            ,D.RQST_RCV_TM
    </statement>

    <statement id="getMissingPartsRequest" parameterClass="Map" resultClass="Map">
        SELECT
            P.PRCH_REQ_NUM
           ,P.PRCH_REQ_REC_TP_CD
           ,P.PRCH_REQ_TP_CD
           ,P.PRCH_REQ_STS_CD
           ,P.PRCH_REQ_CRAT_DT
           ,P.PRCH_REQ_CRAT_TM
           ,P.PRCH_REQ_CRAT_TZ
           ,P.PRCH_REQ_CRAT_DISP_DT_TM_TS
           ,P.PRCH_REQ_CRAT_BY_PSN_CD
           ,P.PRCH_REQ_CRAT_BY_NM
           ,P.PRCH_REQ_RQST_BY_PSN_CD
           ,P.PRCH_REQ_SRC_TP_CD
           ,P.PRCH_GRP_CD
           ,P.FSR_NUM
           ,P.SVC_TASK_NUM
           ,P.SVC_MACH_SER_NUM
           ,P.TRX_REF_NUM
           ,P.CPO_ORD_NUM
           ,P.CUST_ISS_PO_NUM
           ,P.CUST_ISS_PO_DT
           ,P.CPO_ORD_TP_CD
           ,P.CTAC_PSN_NM
           ,P.ADMIN_PSN_CD
           ,P.PRCH_REQ_APVL_STS_CD
           ,P.PRCH_REQ_APVL_DT
           ,P.PRCH_REQ_APVL_BY_PSN_CD
           ,P.PRCH_REQ_APVL_BY_NM
           ,P.RQST_TECH_TOC_CD
           ,P.SHIP_TO_CUST_CD
           ,P.SHIP_TO_LOC_NM
           ,P.SHIP_TO_ADDL_LOC_NM
           ,P.SHIP_TO_FIRST_LINE_ADDR
           ,P.SHIP_TO_SCD_LINE_ADDR
           ,P.SHIP_TO_THIRD_LINE_ADDR
           ,P.SHIP_TO_FRTH_LINE_ADDR
           ,P.SHIP_TO_FIRST_REF_CMNT_TXT
           ,P.SHIP_TO_SCD_REF_CMNT_TXT
           ,P.SHIP_TO_CTY_ADDR
           ,P.SHIP_TO_ST_CD
           ,P.SHIP_TO_PROV_NM
           ,P.SHIP_TO_CNTY_NM
           ,P.SHIP_TO_POST_CD
           ,P.SHIP_TO_CTRY_CD
           ,P.BILL_TO_CUST_CD
           ,P.SELL_TO_CUST_CD
           ,P.ASL_SHIP_TO_CUST_CD
           ,P.LINE_BIZ_TP_CD
           ,P.PO_QLFY_CD
           ,P.VND_DROP_SHIP_FLG
           ,P.PRCH_REQ_CMNT_TXT
           ,P.DELY_ADDL_CMNT_TXT
           ,P.RCV_ADDL_CMNT_TXT
           ,P.BAT_ERR_MSG_TXT
           ,D.PRCH_REQ_LINE_NUM
           ,D.PRCH_REQ_LINE_SUB_NUM
           ,D.PRCH_REQ_INTFC_PK
           ,D.ORIG_PRCH_REQ_LINE_NUM
           ,D.ORIG_PRCH_REQ_LINE_SUB_NUM
           ,D.PRCH_REQ_LINE_TP_CD
           ,D.PRCH_REQ_LINE_STS_CD
           ,D.PRCH_REQ_CRAT_DT                DTL_PRCH_REQ_CRAT_DT
           ,D.PRCH_REQ_CRAT_TM                DTL_PRCH_REQ_CRAT_TM
           ,D.RQST_RCV_DT
           ,D.RQST_RCV_TM
           ,D.RQST_RCV_TZ
           ,D.RQST_RCV_DISP_DT_TM_TS
           ,D.PO_SCHD_REL_DT
           ,D.PRCH_REQ_REL_STS_CD
           ,D.PRCH_REQ_REL_DT_TM_TS
           ,D.PRCH_REQ_REL_ERR_MSG_TXT
           ,D.PRCH_REQ_FRZ_FLG
           ,D.SHPG_PLN_NUM
           ,D.SHIP_FROM_SO_NUM
           ,D.PROCR_TP_CD
           ,D.DEST_INVTY_LOC_CD
           ,D.DEST_RTL_WH_CD
           ,D.DEST_RTL_SWH_CD
           ,D.SRC_INVTY_LOC_CD
           ,D.SRC_RTL_WH_CD
           ,D.SRC_RTL_SWH_CD
           ,D.PRNT_VND_CD
           ,D.VND_CD
           ,D.VND_INVTY_LOC_CD
           ,NVL(D.SHPG_SVC_LVL_CD, #INVTY_REQ_DEF_SHPG_SVC_LVL_CD#) SHPG_SVC_LVL_CD
           ,D.CARR_CD
           ,D.CARR_ACCT_NUM
           ,D.CONFIG_TP_CD
           ,D.SVC_CONFIG_MSTR_PK
           ,D.MDSE_CD
           ,D.PO_MDSE_CMPSN_TP_CD
           ,D.ORIG_RQST_MDSE_CD
           ,D.ASL_MDSE_CD
           ,D.PRCH_REQ_QTY
           ,D.ORD_QTY
           ,D.CUST_UOM_CD
           ,D.PRCH_REQ_DISP_QTY
           ,D.PRCH_REQ_DSPL_UOM_CD
           ,D.PRCH_REQ_REL_QTY
           ,D.PRCH_REQ_BAL_QTY
           ,D.PRCH_REQ_INSRC_QTY
           ,D.PRCH_REQ_CANC_QTY
           ,D.ROP_QTY
           ,D.MIN_ORD_QTY
           ,D.INCR_ORD_QTY
           ,D.MAX_INVTY_QTY
           ,D.CUR_INVTY_QTY
           ,D.CUR_INVTY_AVAL_QTY
           ,D.SCHD_INBD_QTY
           ,D.SCHD_OTBD_QTY
           ,D.INSRC_FLG
           ,D.PO_CRAT_FLG
           ,D.REL_RQST_TO_PO_ORD_NUM
           ,D.PO_ORD_NUM
           ,D.PO_ORD_DTL_LINE_NUM
           ,D.INVTY_ORD_NUM
           ,D.INVTY_ORD_LINE_NUM
           ,D.WRK_ORD_NUM
           ,D.WRK_ORD_DTL_LINE_NUM
           ,D.TRX_REF_NUM                     DTL_TRX_REF_NUM
           ,D.TRX_REF_LINE_NUM
           ,D.TRX_REF_LINE_SUB_NUM
           ,D.PRCH_REQ_LINE_CMNT_TXT
           ,D.BO_EML_PROC_STS_CD
           ,D.SO_NUM
           ,D.PRO_NUM
           ,D.SHIP_DT_TM_TS
           ,D.SHIP_QTY
           ,D.RWS_NUM
           ,D.RWS_CLO_DT_TM_TS
           ,D.RWS_PUT_AWAY_QTY
           ,D.BACK_TO_TECH_QTY
           ,D.FROM_STK_STS_CD
           ,D.TO_STK_STS_CD
           ,D.THIS_MTH_FOB_COST_AMT
           ,D.ASL_DTL_PK
           ,D.ASL_UNIT_PRC_AMT
           ,D.ENT_DEAL_NET_UNIT_PRC_AMT
           ,D.ENT_PO_DTL_DEAL_NET_AMT
           ,D.ENT_FUNC_NET_UNIT_PRC_AMT
           ,D.ENT_PO_DTL_FUNC_NET_AMT
           ,D.CCY_CD
           ,D.EXCH_RATE
           ,D.FRT_CHRG_TO_CD
           ,D.FRT_CHRG_METH_CD
           ,D.FRT_COND_CD
           ,D.VND_PMT_TERM_CD
           ,D.VND_PMT_TERM_DESC_TXT
           ,D.COA_CMPY_CD
           ,D.COA_AFFL_CD
           ,D.COA_BR_CD
           ,D.COA_CH_CD
           ,D.COA_CC_CD
           ,D.COA_ACCT_CD
           ,D.COA_PROJ_CD
           ,D.COA_EXTN_CD
           ,D.COA_PROD_CD
           ,D.TECH_RQST_NTC_ML_PROC_CD
           ,D.TECH_RTN_NTC_ML_PROC_CD
           ,D.VND_RTRN_RSN_CD
           ,D.BAT_ERR_MSG_TXT                 DTL_BAT_ERR_MSG_TXT
           ,T.TRX_SRC_TP_CD
           ,T.SCE_ORD_TP_CD
           ,T.INVTY_ORD_TP_CD
        FROM
            PRCH_REQ                          P
           ,PRCH_REQ_DTL                      D
           ,PRCH_REQ_DTL                      D2
           ,PRCH_REQ_TP                       T
        WHERE
                P.GLBL_CMPY_CD                = #GLBL_CMPY_CD#
            AND P.PRCH_REQ_REC_TP_CD          = #PRCH_REQ_REC_TP_CD#
            AND P.GLBL_CMPY_CD                = D.GLBL_CMPY_CD
            AND P.PRCH_REQ_NUM                = D.PRCH_REQ_NUM
            AND D.PRCH_REQ_LINE_TP_CD         = #PRCH_REQ_LINE_TP_CD#
            AND D.PRCH_REQ_REL_STS_CD         IN (#IN_COMPLETED#, #ERROR#)
            AND D.GLBL_CMPY_CD                = D2.GLBL_CMPY_CD
            AND D.PRCH_REQ_NUM                = D2.PRCH_REQ_NUM
            AND D.ORIG_PRCH_REQ_LINE_NUM      = D2.PRCH_REQ_LINE_NUM
            AND D.ORIG_PRCH_REQ_LINE_SUB_NUM  = D2.PRCH_REQ_LINE_SUB_NUM
            AND D2.PRCH_REQ_LINE_STS_CD       = #PRCH_REQ_LINE_STS_CD#
            AND P.GLBL_CMPY_CD                = T.GLBL_CMPY_CD
            AND P.PRCH_REQ_TP_CD              = T.PRCH_REQ_TP_CD
            AND P.EZCANCELFLAG                = 0
            AND D.EZCANCELFLAG                = 0
            AND D2.EZCANCELFLAG               = 0
            AND T.EZCANCELFLAG                = 0
        ORDER BY
             D.PRCH_REQ_NUM
            ,D.DEST_RTL_WH_CD
            ,D.PRCH_REQ_LINE_NUM
            ,D.PRCH_REQ_LINE_SUB_NUM
    </statement>

    <statement id="chkAlcByConf" parameterClass="Map" resultClass="String">
        SELECT DISTINCT
            M.SVC_MACH_MAINT_AVAL_FLG
        FROM
            PRCH_REQ_DTL                      D
           ,SVC_MACH_MSTR                     M
        WHERE
                D.GLBL_CMPY_CD                = #GLBL_CMPY_CD#
            AND D.PRCH_REQ_NUM                = #PRCH_REQ_NUM#
            AND D.SVC_CONFIG_MSTR_PK          IS NOT NULL
            AND D.GLBL_CMPY_CD                = M.GLBL_CMPY_CD
            AND D.SVC_CONFIG_MSTR_PK          = M.SVC_CONFIG_MSTR_PK
            AND D.MDSE_CD                     = M.MDSE_CD
            AND D.SRC_INVTY_LOC_CD            = M.CUR_LOC_NUM
            AND D.EZCANCELFLAG                = 0
            AND M.EZCANCELFLAG                = 0
    </statement>

    <statement id="chkAlcByNoConf" parameterClass="Map" resultClass="String">
        SELECT DISTINCT
            M.SVC_MACH_MAINT_AVAL_FLG
        FROM
            PRCH_REQ_DTL                      D
           ,PRCH_REQ_SER                      S
           ,SVC_MACH_MSTR                     M
        WHERE
                D.GLBL_CMPY_CD                = #GLBL_CMPY_CD#
            AND D.PRCH_REQ_NUM                = #PRCH_REQ_NUM#
            AND D.SVC_CONFIG_MSTR_PK          IS NULL
            AND D.GLBL_CMPY_CD                = S.GLBL_CMPY_CD
            AND D.PRCH_REQ_NUM                = S.PRCH_REQ_NUM
            AND D.PRCH_REQ_LINE_NUM           = S.PRCH_REQ_LINE_NUM
            AND D.PRCH_REQ_LINE_SUB_NUM       = S.PRCH_REQ_LINE_SUB_NUM
            AND D.GLBL_CMPY_CD                = M.GLBL_CMPY_CD
            AND D.MDSE_CD                     = M.MDSE_CD
            AND D.SRC_INVTY_LOC_CD            = M.CUR_LOC_NUM
            AND S.SER_NUM                     = M.SER_NUM
            AND D.EZCANCELFLAG                = 0
            AND S.EZCANCELFLAG                = 0
            AND M.EZCANCELFLAG                = 0
    </statement>

    <statement id="getOrdInfo" parameterClass="Map" resultClass="Map">
        SELECT
               DOTPD.DS_ORD_TP_CD
             , DOTPD.DEF_PRC_CATG_CD
             , DOT.DS_ORD_CATG_CD
          FROM
               DS_COND_CONST      DCC
             , DS_ORD_TP_PROC_DFN DOTPD
             , DS_ORD_TP          DOT
         WHERE
               DCC.GLBL_CMPY_CD             = DOTPD.GLBL_CMPY_CD
           AND DCC.DS_COND_CONST_CD         = DOTPD.DS_ORD_TP_CD
           AND DOTPD.GLBL_CMPY_CD           = DOT.GLBL_CMPY_CD
           AND DOTPD.DS_ORD_TP_CD           = DOT.DS_ORD_TP_CD
           AND DCC.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
           AND DCC.DS_COND_CONST_GRP_ID     = #DS_COND_CONST_GRP_ID#
           AND DCC.DS_COND_CONST_VAL_TXT_01 = #DS_COND_CONST_VAL_TXT_01#
           <isNotNull property="DS_COND_CONST_VAL_TXT_02">
           AND DCC.DS_COND_CONST_VAL_TXT_02 = #DS_COND_CONST_VAL_TXT_02#
           </isNotNull>
           <isNull property="DS_COND_CONST_VAL_TXT_02">
           AND DCC.DS_COND_CONST_VAL_TXT_02 IS NULL
           </isNull>
           AND DCC.EZCANCELFLAG             = '0'
           AND DOTPD.EZCANCELFLAG           = '0'
           AND DOT.EZCANCELFLAG             = '0'
    </statement>

    <statement id="getShipToCustInfo" parameterClass="Map" resultClass="Map">
        SELECT
            S.SHIP_TO_CUST_CD
           ,S.ADDL_LOC_NM
           ,S.CTRY_CD
           ,S.CTY_ADDR
           ,S.FIRST_LINE_ADDR
           ,S.FIRST_REF_CMNT_TXT
           ,S.FRTH_LINE_ADDR
           ,S.LOC_NM
           ,S.POST_CD
           ,S.PROV_NM
           ,S.SCD_LINE_ADDR
           ,S.SCD_REF_CMNT_TXT
           ,S.SELL_TO_CUST_CD
           ,S.ST_CD
           ,S.THIRD_LINE_ADDR
           ,C.CNTY_NM
        FROM
            SHIP_TO_CUST                      S
           ,CNTY                              C
        WHERE
                S.GLBL_CMPY_CD                = #GLBL_CMPY_CD#
            AND S.SHIP_TO_CUST_CD             = #SHIP_TO_CUST_CD#
            AND S.GLBL_CMPY_CD                = C.GLBL_CMPY_CD(+)
            AND S.CNTY_PK                     = C.CNTY_PK(+)
            AND S.EZCANCELFLAG                = 0
            AND C.EZCANCELFLAG(+)             = 0
    </statement>

<!-- START 2019/10/03 M.Naito [QC#52809,MOD] -->
    <statement id="getShipToCustInfoForExpenseOrder" parameterClass="Map" resultClass="Map">
        SELECT
            STC.SHIP_TO_CUST_CD     AS SHIP_TO_CUST_CD
            ,(
              CASE WHEN STC.FIRST_LINE_ADDR IS NOT NULL THEN
                  STC.FIRST_LINE_ADDR || ' ' ||
                  STC.SCD_LINE_ADDR   || ' ' ||
                  STC.THIRD_LINE_ADDR || ' ' ||
                  STC.FRTH_LINE_ADDR  || ' ' ||
                  STC.CTY_ADDR        || ',' ||
                  STC.ST_CD           || ' ' ||
                  STC.POST_CD
              END)                  AS SHIP_TO_ADDR
            ,STC.ADDL_LOC_NM        AS ADDL_LOC_NM
            ,STC.FIRST_LINE_ADDR    AS FIRST_LINE_ADDR
            ,STC.SCD_LINE_ADDR      AS SCD_LINE_ADDR
            ,STC.THIRD_LINE_ADDR    AS THIRD_LINE_ADDR
            ,STC.FRTH_LINE_ADDR     AS FRTH_LINE_ADDR
            ,STC.FIRST_REF_CMNT_TXT AS FIRST_REF_CMNT_TXT
            ,STC.SCD_REF_CMNT_TXT   AS SCD_REF_CMNT_TXT
            ,STC.CTY_ADDR           AS CTY_ADDR
            ,STC.ST_CD              AS ST_CD
            ,STC.POST_CD            AS POST_CD
            ,STC.PROV_NM            AS PROV_NM
            ,STC.CTRY_CD            AS CTRY_CD
            ,DAC.SELL_TO_CUST_CD    AS SELL_TO_CUST_CD
            ,DAC.DS_ACCT_NM         AS DS_ACCT_NM
            ,CNTY.CNTY_NM           AS CNTY_NM
        FROM
            SHIP_TO_CUST STC
           ,SELL_TO_CUST DAC
           ,CNTY         CNTY
           ,ACCT_LOC     AC
           ,PTY_LOC_WRK  PLW
        WHERE
            STC.GLBL_CMPY_CD          = #GLBL_CMPY_CD#
            AND STC.SHIP_TO_CUST_CD   LIKE #SHIP_TO_CUST_CD#
            AND STC.RGTN_STS_CD       = #RGTN_STS_CD#
            AND STC.EZCANCELFLAG      = '0'
            AND PLW.GLBL_CMPY_CD      = STC.GLBL_CMPY_CD
            AND PLW.PTY_LOC_PK        = STC.PTY_LOC_PK
            AND PLW.RGTN_STS_CD       = #RGTN_STS_CD#
            AND PLW.EZCANCELFLAG      = '0'
            AND AC.GLBL_CMPY_CD       = PLW.GLBL_CMPY_CD
            AND AC.LOC_NUM            = PLW.LOC_NUM
            AND AC.RGTN_STS_CD        = #RGTN_STS_CD#
            AND AC.EZCANCELFLAG       = '0'
            AND AC.GLBL_CMPY_CD       = DAC.GLBL_CMPY_CD
            AND AC.DS_ACCT_NUM        = DAC.SELL_TO_CUST_CD
            AND DAC.RGTN_STS_CD       = #RGTN_STS_CD#
            AND DAC.EZCANCELFLAG      = '0'
            AND STC.GLBL_CMPY_CD      = CNTY.GLBL_CMPY_CD (+)
            AND STC.CNTY_PK           = CNTY.CNTY_PK (+)
            AND CNTY.EZCANCELFLAG (+) = '0'
            AND ROWNUM                = 1
    </statement>
<!-- END 2019/10/03 M.Naito [QC#52809,MOD] -->

    <statement id="getVndRtnTp" parameterClass="Map" resultClass="String">
        SELECT
            T.VND_RTRN_TP_CD
        FROM
           (SELECT
                V.VND_RTRN_TP_CD
            FROM
                PRCH_REQ_DTL                      D
               ,VND_RTRN_RSN                      V
            WHERE
                    D.GLBL_CMPY_CD                = #GLBL_CMPY_CD#
                AND D.PRCH_REQ_NUM                = #PRCH_REQ_NUM#
                AND D.GLBL_CMPY_CD                = V.GLBL_CMPY_CD
                AND D.VND_RTRN_RSN_CD             = V.VND_RTRN_RSN_CD
                AND D.EZCANCELFLAG                = 0
                AND V.EZCANCELFLAG                = 0
            ORDER BY
                D.PRCH_REQ_LINE_NUM
               ,D.PRCH_REQ_LINE_SUB_NUM
            )                                    T
        WHERE ROWNUM                             = 1
    </statement>

    <statement id="getSumEntPoDtlDealNetAmt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            SUM(NVL(ENT_PO_DTL_DEAL_NET_AMT, 0))
        FROM
            PRCH_REQ_DTL
        WHERE
                GLBL_CMPY_CD                = #GLBL_CMPY_CD#
            AND PRCH_REQ_NUM                = #PRCH_REQ_NUM#
            AND PRCH_REQ_REL_STS_CD         IN (#IN_COMPLETED#, #ERROR#)
            AND EZCANCELFLAG                = 0
    </statement>

    <statement id="getSerNum" parameterClass="Map" resultClass="String">
        SELECT DISTINCT
            S.SER_NUM
        FROM
            PRCH_REQ_DTL                      D
           ,PRCH_REQ_SER                      S
        WHERE
                D.GLBL_CMPY_CD                = #GLBL_CMPY_CD#
            AND D.PRCH_REQ_NUM                = #PRCH_REQ_NUM#
            AND D.PRCH_REQ_LINE_NUM           = #PRCH_REQ_LINE_NUM#
            AND D.PRCH_REQ_LINE_SUB_NUM       = #PRCH_REQ_LINE_SUB_NUM#
            AND D.GLBL_CMPY_CD                = S.GLBL_CMPY_CD(+)
            AND D.PRCH_REQ_NUM                = S.PRCH_REQ_NUM(+)
            AND D.PRCH_REQ_LINE_NUM           = S.PRCH_REQ_LINE_NUM(+)
            AND D.PRCH_REQ_LINE_SUB_NUM       = S.PRCH_REQ_LINE_SUB_NUM(+)
            AND D.EZCANCELFLAG                = 0
            AND S.EZCANCELFLAG(+)             = 0
    </statement>

    <statement id="getMachineMaster" parameterClass="Map" resultClass="Map">
        SELECT
            SMM.SVC_CONFIG_MSTR_PK
           ,SMM.SVC_MACH_MSTR_PK
           ,SMM.SVC_MACH_MSTR_LOC_STS_CD
           ,MDSE.INSTL_BASE_CTRL_FLG
        FROM
            PRCH_REQ_DTL   PRD
           ,PRCH_REQ_SER   PRS
           ,SVC_MACH_MSTR  SMM
           ,MDSE           MDSE
        WHERE
                PRD.GLBL_CMPY_CD                = #GLBL_CMPY_CD#
            AND PRD.PRCH_REQ_NUM                = #PRCH_REQ_NUM#
            AND PRD.PRCH_REQ_LINE_NUM           = #PRCH_REQ_LINE_NUM#
            AND PRD.PRCH_REQ_LINE_SUB_NUM       = #PRCH_REQ_LINE_SUB_NUM#
            AND PRD.GLBL_CMPY_CD                = PRS.GLBL_CMPY_CD(+)
            AND PRD.PRCH_REQ_NUM                = PRS.PRCH_REQ_NUM(+)
            AND PRD.PRCH_REQ_LINE_NUM           = PRS.PRCH_REQ_LINE_NUM(+)
            AND PRD.PRCH_REQ_LINE_SUB_NUM       = PRS.PRCH_REQ_LINE_SUB_NUM(+)
            AND PRD.GLBL_CMPY_CD                = SMM.GLBL_CMPY_CD
            AND PRD.SVC_CONFIG_MSTR_PK          = SMM.SVC_CONFIG_MSTR_PK
            AND PRD.MDSE_CD                     = SMM.MDSE_CD
            AND PRD.SRC_INVTY_LOC_CD            = SMM.CUR_LOC_NUM
            <isNotNull property="SER_NUM">
                <iterate property="SER_NUM" var="SER_NUM[]" open="AND SMM.SER_NUM IN (" close=")" conjunction=",">
                    #SER_NUM[]#
                </iterate>
            </isNotNull>
            AND PRD.GLBL_CMPY_CD                = MDSE.GLBL_CMPY_CD
            AND PRD.MDSE_CD                     = MDSE.MDSE_CD
            AND PRD.EZCANCELFLAG                = 0
            AND PRS.EZCANCELFLAG(+)             = 0
            AND SMM.EZCANCELFLAG                = 0
            AND MDSE.EZCANCELFLAG               = 0
    </statement>
    <statement id="getNonSerMachineMaster" parameterClass="Map" resultClass="Map">
        SELECT 
            A.SVC_CONFIG_MSTR_PK
            ,A.SVC_MACH_MSTR_PK
            ,A.SVC_MACH_MSTR_LOC_STS_CD
            ,A.INSTL_BASE_CTRL_FLG
        FROM 
        (
            SELECT
                SMM.SVC_CONFIG_MSTR_PK
               ,SMM.SVC_MACH_MSTR_PK
               ,SMM.SVC_MACH_MSTR_LOC_STS_CD
               ,MDSE.INSTL_BASE_CTRL_FLG
            FROM
                PRCH_REQ_DTL   PRD
               ,PRCH_REQ_SER   PRS
               ,SVC_MACH_MSTR  SMM
               ,MDSE           MDSE
            WHERE
                    PRD.GLBL_CMPY_CD                = #GLBL_CMPY_CD#
                AND PRD.PRCH_REQ_NUM                = #PRCH_REQ_NUM#
                AND PRD.PRCH_REQ_LINE_NUM           = #PRCH_REQ_LINE_NUM#
                AND PRD.PRCH_REQ_LINE_SUB_NUM       = #PRCH_REQ_LINE_SUB_NUM#
                AND PRD.GLBL_CMPY_CD                = PRS.GLBL_CMPY_CD(+)
                AND PRD.PRCH_REQ_NUM                = PRS.PRCH_REQ_NUM(+)
                AND PRD.PRCH_REQ_LINE_NUM           = PRS.PRCH_REQ_LINE_NUM(+)
                AND PRD.PRCH_REQ_LINE_SUB_NUM       = PRS.PRCH_REQ_LINE_SUB_NUM(+)
                AND PRD.GLBL_CMPY_CD                = SMM.GLBL_CMPY_CD
                AND PRD.SVC_CONFIG_MSTR_PK          = SMM.SVC_CONFIG_MSTR_PK
                AND PRD.MDSE_CD                     = SMM.MDSE_CD
                AND PRD.SRC_INVTY_LOC_CD            = SMM.CUR_LOC_NUM
                AND PRD.GLBL_CMPY_CD                = MDSE.GLBL_CMPY_CD
                AND PRD.MDSE_CD                     = MDSE.MDSE_CD
                AND SMM.TRX_HDR_NUM                 IS NULL
                AND PRD.EZCANCELFLAG                = 0
                AND PRS.EZCANCELFLAG(+)             = 0
                AND SMM.EZCANCELFLAG                = 0
                AND MDSE.EZCANCELFLAG               = 0
        ) A
        WHERE ROWNUM = 1
    </statement>
    <statement id="getAvailableMachineMaster" parameterClass="Map" resultClass="Map">
        SELECT
            SMM.SVC_CONFIG_MSTR_PK
           ,SMM.SVC_MACH_MSTR_PK
           ,SMM.SVC_MACH_MSTR_LOC_STS_CD
           ,MDSE.INSTL_BASE_CTRL_FLG
        FROM
            PRCH_REQ_DTL                    PRD
           ,PRCH_REQ_SER                    PRS
           ,SVC_MACH_MSTR                   SMM
           ,MDSE                            MDSE
        WHERE
                PRD.GLBL_CMPY_CD            = #GLBL_CMPY_CD#
            AND PRD.PRCH_REQ_NUM            = #PRCH_REQ_NUM#
            AND PRD.PRCH_REQ_LINE_NUM       = #PRCH_REQ_LINE_NUM#
            AND PRD.PRCH_REQ_LINE_SUB_NUM   = #PRCH_REQ_LINE_SUB_NUM#
            AND PRD.GLBL_CMPY_CD            = PRS.GLBL_CMPY_CD(+)
            AND PRD.PRCH_REQ_NUM            = PRS.PRCH_REQ_NUM(+)
            AND PRD.PRCH_REQ_LINE_NUM       = PRS.PRCH_REQ_LINE_NUM(+)
            AND PRD.PRCH_REQ_LINE_SUB_NUM   = PRS.PRCH_REQ_LINE_SUB_NUM(+)
            AND PRD.GLBL_CMPY_CD            = SMM.GLBL_CMPY_CD
            AND PRD.SVC_CONFIG_MSTR_PK      = SMM.SVC_CONFIG_MSTR_PK
            AND PRD.MDSE_CD                 = SMM.MDSE_CD
            AND PRD.SRC_INVTY_LOC_CD        = SMM.CUR_LOC_NUM
            <isNotNull property="SER_NUM">
                <iterate property="SER_NUM" var="SER_NUM[]" open="AND SMM.SER_NUM IN (" close=")" conjunction=",">
                    #SER_NUM[]#
                </iterate>
            </isNotNull>
            AND PRD.GLBL_CMPY_CD            = MDSE.GLBL_CMPY_CD
            AND PRD.MDSE_CD                 = MDSE.MDSE_CD
            AND PRD.EZCANCELFLAG            = 0
            AND PRS.EZCANCELFLAG(+)         = 0
            AND SMM.EZCANCELFLAG            = 0
            AND MDSE.EZCANCELFLAG           = 0
        ORDER BY
            SMM.SVC_MACH_SQ_NUM ASC
    </statement>

    <statement id="getSceOrdTp" parameterClass="Map" resultClass="Map">
        SELECT
            TRX_CD
           ,TRX_RSN_CD
        FROM
            SCE_ORD_TP
        WHERE
            GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND SCE_ORD_TP_CD            = #SCE_ORD_TP_CD#
        AND INBD_OTBD_CD             = #INBD_OTBD_CD#
        AND EZCANCELFLAG             = '0'
    </statement>

    <statement id="getShpgPln" parameterClass="Map" resultClass="Map">
        SELECT
            SHPG_PLN_NUM
          , TRX_HDR_NUM
          , TRX_LINE_NUM
          , TRX_LINE_SUB_NUM
        FROM
            SHPG_PLN
        WHERE
            GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND TRX_HDR_NUM              = #TRX_HDR_NUM#
        AND TRX_LINE_NUM             = #TRX_LINE_NUM#
        AND TRX_LINE_SUB_NUM         = #TRX_LINE_SUB_NUM#
        AND TRX_SRC_TP_CD            = #TRX_SRC_TP_CD#
        AND EZCANCELFLAG             = '0'
    </statement>

    <statement id="getSoInfoBySoNum" parameterClass="Map" resultClass="Map">
        SELECT
            DT.INVTY_LOC_CD
           ,DT.SO_SLP_NUM
           ,DT.MDSE_CD
           ,DT.FROM_STK_STS_CD
           ,PRD.PRCH_REQ_QTY
           ,PRD.PRO_NUM
        FROM
            SHPG_ORD              HD
           ,SHPG_ORD_DTL          DT
           ,SHPG_PLN              SP
           ,INVTY_ORD_DTL         IOD
           ,PRCH_REQ_DTL          PRD
        WHERE
            HD.GLBL_CMPY_CD            = #GLBL_CMPY_CD#
        AND HD.SO_NUM                  = #SO_NUM#
        AND HD.GLBL_CMPY_CD            = DT.GLBL_CMPY_CD
        AND HD.SO_NUM                  = DT.SO_NUM
        AND DT.GLBL_CMPY_CD            = SP.GLBL_CMPY_CD
        AND DT.SHPG_PLN_NUM            = SP.SHPG_PLN_NUM
        AND SP.GLBL_CMPY_CD            = IOD.GLBL_CMPY_CD
        AND SP.TRX_HDR_NUM             = IOD.INVTY_ORD_NUM
        AND SP.TRX_LINE_NUM            = IOD.INVTY_ORD_LINE_NUM
        AND SP.TRX_LINE_SUB_NUM        = '001'
        AND IOD.GLBL_CMPY_CD           = PRD.GLBL_CMPY_CD
        AND IOD.PRCH_REQ_NUM           = PRD.PRCH_REQ_NUM
        AND IOD.PRCH_REQ_LINE_NUM      = PRD.PRCH_REQ_LINE_NUM
        AND IOD.PRCH_REQ_LINE_SUB_NUM  = PRD.PRCH_REQ_LINE_SUB_NUM
        AND HD.EZCANCELFLAG            = '0'
        AND DT.EZCANCELFLAG            = '0'
        AND SP.EZCANCELFLAG            = '0'
        AND IOD.EZCANCELFLAG           = '0'
        AND PRD.EZCANCELFLAG           = '0'
        ORDER BY
            DT.INVTY_LOC_CD
           ,DT.SO_SLP_NUM
           ,DT.MDSE_CD
           ,DT.FROM_STK_STS_CD
           ,PRD.PRCH_REQ_QTY
           ,PRD.PRO_NUM
    </statement>

    <statement id="getSoSerInfoBySoNum" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            DT.INVTY_LOC_CD
           ,SE.SO_SLP_NUM
           ,SE.MDSE_CD
           ,SE.SER_NUM
        FROM
            SHPG_ORD              HD
           ,SHPG_ORD_DTL          DT
           ,SO_SER                SE
        WHERE
            HD.GLBL_CMPY_CD     = #GLBL_CMPY_CD#
        AND HD.SO_NUM           = #SO_NUM#
        AND HD.GLBL_CMPY_CD     = DT.GLBL_CMPY_CD
        AND HD.SO_NUM           = DT.SO_NUM
        AND DT.GLBL_CMPY_CD     = SE.GLBL_CMPY_CD
        AND DT.SO_NUM           = SE.SO_NUM
        AND DT.SO_SLP_NUM       = SE.SO_SLP_NUM
        AND HD.EZCANCELFLAG     = '0'
        AND DT.EZCANCELFLAG     = '0'
        AND SE.EZCANCELFLAG     = '0'
        ORDER BY
            DT.INVTY_LOC_CD
           ,SE.SO_SLP_NUM
           ,SE.MDSE_CD
           ,SE.SER_NUM
    </statement>

    <!-- QC#18365(L3) ADD START -->
    <statement id="getSoInfoByPrNum" parameterClass="Map" resultClass="Map">
        SELECT
            DT.SO_NUM
           ,DT.SO_SLP_NUM
        FROM
            SHPG_ORD_DTL          DT
        WHERE
            DT.GLBL_CMPY_CD            = #GLBL_CMPY_CD#
        AND DT.PRCH_REQ_NUM            = #PRCH_REQ_NUM#
        AND DT.PRCH_REQ_LINE_NUM       = #PRCH_REQ_LINE_NUM#
        AND DT.PRCH_REQ_LINE_SUB_NUM   = #PRCH_REQ_LINE_SUB_NUM#
        AND DT.EZCANCELFLAG            = '0'
    </statement>
    <!-- QC#18365(L3) ADD END -->

<!-- START 2019/10/03 M.Naito [QC#52809,ADD] -->    
    <statement id="getBillToCustInfo" parameterClass="Map" resultClass="Map">
        SELECT
            BTC.BILL_TO_CUST_CD AS BILL_TO_CUST_CD
            ,(
              CASE WHEN BTC.FIRST_LINE_ADDR IS NOT NULL THEN
                  BTC.FIRST_LINE_ADDR || ' ' ||
                  BTC.SCD_LINE_ADDR   || ' ' ||
                  BTC.THIRD_LINE_ADDR || ' ' ||
                  BTC.FRTH_LINE_ADDR  || ' ' ||
                  BTC.CTY_ADDR        || ',' ||
                  BTC.ST_CD           || ' ' ||
                  BTC.POST_CD
              END)               AS BILL_TO_ADDR
            ,(
              CASE WHEN BTC.FIRST_LINE_ADDR IS NOT NULL THEN
                     DECODE (BTC.FIRST_LINE_ADDR, NULL, '', CONCAT(BTC.FIRST_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (BTC.SCD_LINE_ADDR, NULL, '', CONCAT(BTC.SCD_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (BTC.THIRD_LINE_ADDR, NULL, '', CONCAT(BTC.THIRD_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (BTC.FRTH_LINE_ADDR, NULL, '', CONCAT(BTC.FRTH_LINE_ADDR, CHR(13) || CHR(10)))
                  || CONCAT (BTC.CTY_ADDR, ',')
                  || RPAD (BTC.ST_CD, LENGTH (BTC.ST_CD) + 1)
                  || BTC.POST_CD
              END)               AS ENT_BILL_TO_ADDR
            ,DAC.SELL_TO_CUST_CD AS DS_ACCT_NUM
            ,DAC.DS_ACCT_NM      AS DS_ACCT_NM
        FROM
            BILL_TO_CUST    BTC
           ,SELL_TO_CUST    DAC
           ,ACCT_LOC        AC
           ,PTY_LOC_WRK     PLW
        WHERE
            BTC.GLBL_CMPY_CD        = #GLBL_CMPY_CD#
            AND BTC.BILL_TO_CUST_CD LIKE #BILL_TO_CUST_CD#
            AND BTC.RGTN_STS_CD     = #RGTN_STS_CD#
            AND BTC.EZCANCELFLAG    = '0'
            AND PLW.GLBL_CMPY_CD    = BTC.GLBL_CMPY_CD
            AND PLW.PTY_LOC_PK      = BTC.PTY_LOC_PK
            AND PLW.RGTN_STS_CD     = #RGTN_STS_CD#
            AND PLW.EZCANCELFLAG    = '0'
            AND AC.GLBL_CMPY_CD     = PLW.GLBL_CMPY_CD
            AND AC.LOC_NUM          = PLW.LOC_NUM
            AND AC.RGTN_STS_CD      = #RGTN_STS_CD#
            AND AC.EZCANCELFLAG     = '0'
            AND AC.GLBL_CMPY_CD     = DAC.GLBL_CMPY_CD
            AND AC.DS_ACCT_NUM      = DAC.SELL_TO_CUST_CD
            AND DAC.RGTN_STS_CD     = #RGTN_STS_CD#
            AND DAC.EZCANCELFLAG    = '0'
            AND ROWNUM              = 1
    </statement>
<!-- END 2019/10/03 M.Naito [QC#52809,ADD] -->

<!-- add start 2022/03/14 QC#59780 -->
    <statement id="getShpgOrdProNumListPkList" parameterClass="Map" resultClass="BigDecimal">
        SELECT DISTINCT
            SOPNL.SHPG_ORD_PRO_NUM_LIST_PK
        FROM
            SHPG_ORD_PRO_NUM_LIST SOPNL
        WHERE
            SOPNL.GLBL_CMPY_CD           = #GLBL_CMPY_CD#
        AND SOPNL.PRCH_REQ_NUM           = #PRCH_REQ_NUM#
        AND SOPNL.PRCH_REQ_LINE_SUB_NUM  = #PRCH_REQ_LINE_SUB_NUM#
        AND SOPNL.EZCANCELFLAG           = '0'
    </statement>
<!-- add end 2022/03/14 QC#59780 -->
</sqlMap>
