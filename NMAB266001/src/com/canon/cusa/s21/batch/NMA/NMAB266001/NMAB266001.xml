<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NMAB266001">

    <statement id="getProsUpldWrk" parameterClass="Map" resultClass="Map">
        SELECT
              PUW.UPLD_CSV_RQST_PK
            , PUW.UPLD_CSV_RQST_ROW_NUM
            , PUW.ORG_NM
            , PUW.DS_ACCT_NM
            , PUW.FIRST_LINE_ADDR
            , PUW.SCD_LINE_ADDR
            , PUW.THIRD_LINE_ADDR
            , PUW.FRTH_LINE_ADDR
            , PUW.CTY_ADDR
            , PUW.ST_CD
            , PUW.POST_CD
            , PUW.CNTY_NM
            , PUW.CTRY_CD
            , PUW.TEL_NUM
            , PUW.FAX_NUM
            , PUW.DS_ACCT_URL
            , PUW.DS_CUST_SIC_DESC_TXT
            , PUW.DS_LOC_REV_AMT
            , PUW.DS_LOC_EMP_NUM
            , PUW.DS_CUST_SIC_CD
            , PUW.DS_CUST_CMPY_SIC_CD
            , PUW.DUNS_NUM
            , PUW.DS_ULT_DUNS_NUM
            , PUW.DS_PRNT_DUNS_NUM
            , PUW.DS_ACCT_DUNS_NM
            , PUW.GLN_NUM
            , PUW.ACCT_SRC_TXT
            , PUW.LINE_BIZ_TP_CD
            , PUW.DS_CTAC_PSN_SALT_DESC_TXT
            , PUW.CTAC_PSN_FIRST_NM
            , PUW.CTAC_PSN_LAST_NM
            , PUW.DS_CTAC_PSN_TTL_DESC_TXT
            , PUW.CTAC_TP_DESC_TXT
            , PUW.DS_CTAC_PNT_TP_DESC_TXT
            , PUW.PROS_CTAC_PHO_NUM
            , PUW.PROS_CTAC_FAX_NUM
            , PUW.PROS_CTAC_EML_ADDR
            , PUW.PROS_CTAC_CELL_PHO_NUM
            , PUW.UPLD_CSV_RQST_CMNT_TXT
            , SBQ.DS_ACCT_NM          AS ORIG_ACCT_NM
            , CPS.DS_CTAC_PSN_SALT_CD AS ORIG_CTAC_PSN_SALT_CD
            , CPT.DS_CTAC_PSN_TTL_CD  AS ORIG_CTAC_PSN_TTL_CD
            , CT.CTAC_TP_CD           AS ORIG_CTAC_TP_CD
            , PT.DS_CTAC_PNT_TP_CD    AS ORIG_CTAC_PNT_TP_CD
            , C.CTRY_CD               AS ORIG_CTRY_CD
            , S.ST_CD                 AS ORIG_ST_CD
            , LBT.LINE_BIZ_TP_CD      AS ORIG_LINE_BIZ_TP_CD
        FROM
              PROS_UPLD_WRK    PUW
            , DS_CTAC_PSN_SALT CPS
            , DS_CTAC_PSN_TTL  CPT
            , CTAC_TP          CT
            , DS_CTAC_PNT_TP   PT
            , CTRY             C
            , ST               S
            , LINE_BIZ_TP      LBT
            , (
                SELECT 
                      AP.DS_ACCT_NM
                FROM
                    DS_ACCT_PROS AP
                WHERE
                        AP.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND AP.DS_ACCT_ACTV_CUST_FLG = 'Y'
                    AND AP.EZCANCELFLAG          = '0'
                UNION ALL
                SELECT 
                      STC.DS_ACCT_NM
                FROM
                    SELL_TO_CUST STC
                WHERE
                        STC.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND STC.DS_ACCT_ACTV_CUST_FLG = 'Y'
                    AND STC.EZCANCELFLAG          = '0'
              ) SBQ
        WHERE
                PUW.GLBL_CMPY_CD     = #glblCmpyCd#
            AND PUW.UPLD_CSV_RQST_PK = #upldCsvRqstPk#
        <isNotNull property="cmntFlg">
            AND PUW.UPLD_CSV_RQST_CMNT_TXT IS NULL
        </isNotNull>
            AND PUW.EZCANCELFLAG     = '0'

            AND PUW.DS_ACCT_NM = SBQ.DS_ACCT_NM (+)

            AND PUW.GLBL_CMPY_CD              = CPS.GLBL_CMPY_CD (+)
            AND PUW.DS_CTAC_PSN_SALT_DESC_TXT = CPS.DS_CTAC_PSN_SALT_DESC_TXT (+)
            AND CPS.EZCANCELFLAG (+)          = '0'

            AND PUW.GLBL_CMPY_CD             = CPT.GLBL_CMPY_CD (+)
            AND PUW.DS_CTAC_PSN_TTL_DESC_TXT = CPT.DS_CTAC_PSN_TTL_DESC_TXT (+)
            AND CPT.EZCANCELFLAG (+)         = '0'

            AND PUW.GLBL_CMPY_CD     = CT.GLBL_CMPY_CD (+)
            AND PUW.CTAC_TP_DESC_TXT = CT.CTAC_TP_DESC_TXT (+)
            AND CT.ACTV_FLG (+)      = 'Y'
            AND CT.EZCANCELFLAG (+)  = '0'

            AND PUW.GLBL_CMPY_CD            = PT.GLBL_CMPY_CD (+)
            AND PUW.DS_CTAC_PNT_TP_DESC_TXT = PT.DS_CTAC_PNT_TP_DESC_TXT (+)
            AND PT.EZCANCELFLAG (+)         = '0'

            AND PUW.GLBL_CMPY_CD   = C.GLBL_CMPY_CD (+)
            AND PUW.CTRY_CD        = C.CTRY_CD (+)
            AND C.EZCANCELFLAG (+) = '0'

            AND PUW.GLBL_CMPY_CD   = S.GLBL_CMPY_CD (+)
            AND PUW.ST_CD          = S.ST_CD (+)
            AND S.EZCANCELFLAG (+) = '0'

            AND PUW.GLBL_CMPY_CD     = LBT.GLBL_CMPY_CD (+)
            AND PUW.LINE_BIZ_TP_CD   = LBT.LINE_BIZ_TP_CD (+)
            AND LBT.EZCANCELFLAG (+) = '0'
        ORDER BY 
              PUW.DS_ACCT_NM
            , PUW.FIRST_LINE_ADDR
            , PUW.UPLD_CSV_RQST_ROW_NUM
    </statement>
    <statement id="getDupProsUpldWrk" parameterClass="Map" resultClass="Map">
        SELECT
              PUW.UPLD_CSV_RQST_ROW_NUM
        FROM
              PROS_UPLD_WRK PUW
        WHERE
                PUW.GLBL_CMPY_CD     = #glblCmpyCd#
            AND PUW.UPLD_CSV_RQST_PK = #upldCsvRqstPk#
            AND PUW.EZCANCELFLAG     = '0'
            AND EXISTS
                (
                SELECT
                    1
                FROM
                    PROS_UPLD_WRK W
                WHERE
                        PUW.GLBL_CMPY_CD        = W.GLBL_CMPY_CD
                       AND PUW.UPLD_CSV_RQST_PK = W.UPLD_CSV_RQST_PK
                    AND SUBSTR(PUW.DS_ACCT_NM, 1, #acctNmLen#)    = SUBSTR(W.DS_ACCT_NM, 1, #acctNmLen#)
                    AND SUBSTR(PUW.FIRST_LINE_ADDR, 1, #addrLen#) = SUBSTR(W.FIRST_LINE_ADDR, 1, #addrLen#)
                    AND NVL(PUW.DUNS_NUM, 0)    = NVL(W.DUNS_NUM, 0)
                    AND NVL(PUW.GLN_NUM, 0)     = NVL(W.GLN_NUM, 0)
                    AND W.EZCANCELFLAG = '0'
                GROUP BY 
                      SUBSTR(W.DS_ACCT_NM, 1, #acctNmLen#)
                    , SUBSTR(W.FIRST_LINE_ADDR, 1, #addrLen#)
                    , W.DUNS_NUM
                    , W.GLN_NUM
                    , W.UPLD_CSV_RQST_PK
                HAVING 
                    COUNT(W.UPLD_CSV_RQST_PK) > 1
                  ) 
    </statement>
    <statement id="getDiffProsUpldWrk" parameterClass="Map" resultClass="Map">
        SELECT
            PUW.UPLD_CSV_RQST_ROW_NUM 
        FROM
            PROS_UPLD_WRK PUW
        WHERE
                PUW.GLBL_CMPY_CD = #glblCmpyCd#
            AND PUW.UPLD_CSV_RQST_PK = #upldCsvRqstPk#
            AND PUW.EZCANCELFLAG = '0'
            AND EXISTS 
                (
                SELECT
                    1
                FROM
                  PROS_UPLD_WRK U
                WHERE
                    PUW.GLBL_CMPY_CD     = U.GLBL_CMPY_CD
                AND PUW.UPLD_CSV_RQST_PK = U.UPLD_CSV_RQST_PK
                AND PUW.DS_ACCT_NM       = U.DS_ACCT_NM
                AND U.EZCANCELFLAG       = '0'
                GROUP BY 
                    U.DS_ACCT_NM 
                HAVING
                    COUNT(U.DS_ACCT_NM ) > 1
                )
            AND NOT EXISTS
                (
                SELECT
                    1
                FROM
                    PROS_UPLD_WRK U
                WHERE
                    PUW.GLBL_CMPY_CD     = U.GLBL_CMPY_CD
                AND PUW.UPLD_CSV_RQST_PK = U.UPLD_CSV_RQST_PK
                AND PUW.DS_ACCT_NM       = U.DS_ACCT_NM
                AND NVL(PUW.DS_ACCT_URL, '0')         = NVL(U.DS_ACCT_URL, '0')
                AND NVL(PUW.DS_CUST_CMPY_SIC_CD, '0') = NVL(U.DS_CUST_CMPY_SIC_CD, '0')
                AND NVL(PUW.DS_ACCT_DUNS_NM, '0')     = NVL(U.DS_ACCT_DUNS_NM, '0')
                AND U.EZCANCELFLAG       = '0'
                GROUP BY 
                      U.DS_ACCT_NM 
                    , U.DS_CUST_CMPY_SIC_CD
                    , U.DS_ACCT_URL
                    , U.DS_ACCT_DUNS_NM
                HAVING
                    COUNT(U.DS_ACCT_NM ) > 1
                )
    </statement>
    <statement id="getDupPtyLocWrk" parameterClass="Map" resultClass="Map">
        SELECT
            SBQ.LOC_NUM
        FROM
             (
                SELECT
                    PLW.LOC_NUM
                FROM
                      DS_ACCT_PROS AP
                    , PROS_PTY_LOC_WRK PLW
                WHERE
                        AP.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND SUBSTR(AP.DS_ACCT_NM, 1, #acctNmLen#) = #dsAcctNm#
                    AND AP.DS_ACCT_ACTV_CUST_FLG = 'Y'
                    AND AP.EZCANCELFLAG          = '0'
                    
                    AND AP.GLBL_CMPY_CD = PLW.GLBL_CMPY_CD 
                    AND AP.PTY_LOC_PK   = PLW.PTY_LOC_PK
                    AND PLW.RGTN_STS_CD  = #rgtnStsCd#
                    AND SUBSTR(PLW.FIRST_LINE_ADDR, 1, #addrLen#) = #firstLineAddr#
                    <isNotNull property="dunsNum">
                    AND PLW.DUNS_NUM     = #dunsNum#
                    </isNotNull>
                    <isNotNull property="glnNum">
                    AND PLW.GLN_NUM      = #glnNum#
                    </isNotNull>
                    AND PLW.EZCANCELFLAG = '0'
                UNION ALL
                SELECT 
                    PLW.LOC_NUM
                FROM
                      SELL_TO_CUST   STC
                    , PTY_LOC_WRK    PLW
                    , ACCT_LOC       AL
                WHERE
                        STC.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND SUBSTR(STC.DS_ACCT_NM, 1, #acctNmLen#) = #dsAcctNm#
                    AND STC.DS_ACCT_ACTV_CUST_FLG = 'Y'
                    AND STC.EZCANCELFLAG          = '0'
                     
                    AND STC.GLBL_CMPY_CD = PLW.GLBL_CMPY_CD 
                    AND PLW.RGTN_STS_CD  = #rgtnStsCd#
                    AND SUBSTR(PLW.FIRST_LINE_ADDR, 1, #addrLen#) = #firstLineAddr#
                    <isNotNull property="dunsNum">
                    AND PLW.DUNS_NUM     = #dunsNum#
                    </isNotNull>
                    <isNotNull property="glnNum">
                    AND PLW.GLN_NUM      = #glnNum#
                    </isNotNull>
                    AND PLW.EZCANCELFLAG = '0'
                    
                    AND PLW.GLBL_CMPY_CD = AL.GLBL_CMPY_CD
                    AND PLW.LOC_NUM      = AL.LOC_NUM
                    AND AL.RGTN_STS_CD  = #rgtnStsCd#
                    AND AL.EZCANCELFLAG  = '0'
                    
                    AND AL.DS_ACCT_NUM = STC.SELL_TO_CUST_CD
               ) SBQ
        WHERE
            ROWNUM   = 1
    </statement>
    <statement id="getDupContact" parameterClass="Map" resultClass="Map">
        SELECT
              PUW.UPLD_CSV_RQST_ROW_NUM
        FROM
              PROS_UPLD_WRK PUW
        WHERE
                PUW.GLBL_CMPY_CD     = #glblCmpyCd#
            AND PUW.UPLD_CSV_RQST_PK = #upldCsvRqstPk#
            AND (PUW.CTAC_PSN_FIRST_NM IS NOT NULL 
              OR PUW.CTAC_PSN_LAST_NM IS NOT NULL)
            AND PUW.EZCANCELFLAG     = '0'
            AND EXISTS
                    (
                    SELECT
                        1
                    FROM
                        PROS_UPLD_WRK    W
                    WHERE
                            PUW.GLBL_CMPY_CD     = W.GLBL_CMPY_CD
                        AND PUW.UPLD_CSV_RQST_PK = W.UPLD_CSV_RQST_PK
                        AND PUW.DS_ACCT_NM       = W.DS_ACCT_NM
                        AND NVL(PUW.CTAC_PSN_FIRST_NM, '0') = NVL(W.CTAC_PSN_FIRST_NM, '0')
                        AND NVL(PUW.CTAC_PSN_LAST_NM, '0')  = NVL(W.CTAC_PSN_LAST_NM, '0')
                        AND W.EZCANCELFLAG       = '0'
                    GROUP BY 
                          W.DS_ACCT_NM
                        , W.CTAC_PSN_FIRST_NM
                        , W.CTAC_PSN_LAST_NM
                    HAVING 
                        COUNT(W.DS_ACCT_NM) > 1
                      )
    </statement>
    <statement id="getTrtyInfo" parameterClass="Map" resultClass="Map">
        SELECT
              DOU.ORG_STRU_TP_CD
            , P.PSN_CD
            , DOU.ORG_CD
        FROM
              DS_ORG_UNIT       DOU
            , ORG_STRU_TP       OST
            , DS_ORG_RESRC_RELN DOR
            , S21_PSN           P
        WHERE
                DOU.GLBL_CMPY_CD = #glblCmpyCd#
            AND DOU.ORG_NM       = #orgNm#
        <iterate property="gnrnTpCd" var="gnrnTpCd[]" open="AND DOU.GNRN_TP_CD IN (" close=")" conjunction=",">
            #gnrnTpCd[]#
        </iterate>
            AND DOU.EZCANCELFLAG = '0'
            
            AND DOU.GLBL_CMPY_CD   = OST.GLBL_CMPY_CD
            AND DOU.ORG_STRU_TP_CD = OST.ORG_STRU_TP_CD
            AND OST.TRTY_STRU_FLG  = 'Y'
            AND OST.EZCANCELFLAG   = '0'
            
            AND DOU.GLBL_CMPY_CD     = DOR.GLBL_CMPY_CD (+)
            AND DOU.ORG_CD           = DOR.ORG_CD (+)
            AND DOU.ORG_STRU_TP_CD   = DOR.ORG_STRU_TP_CD (+)
        <iterate property="gnrnTpCd" var="gnrnTpCd[]" open="AND DOR.GNRN_TP_CD (+) IN (" close=")" conjunction=",">
            #gnrnTpCd[]#
        </iterate>
            AND DOR.ACCT_TEAM_ROLE_TP_CD (+) IS NULL
            AND DOR.EZCANCELFLAG (+) = '0'
            
            AND DOR.GLBL_CMPY_CD   = P.GLBL_CMPY_CD (+)
            AND DOR.PSN_CD         = P.PSN_CD (+)
            AND P.EZCANCELFLAG (+) = '0'
    </statement>
    <statement id="getTrtyGrpInfo" parameterClass="Map" resultClass="Map">
        SELECT
            OU.ORG_CD
        FROM
              DS_ORG_UNIT       OU
            , ORG_STRU_TP       OST
            , TRTY_GRP_TP       TGT
            , BIZ_AREA_ORG      BAO
            , DS_ORG_RESRC_RELN ORR
        WHERE
                OU.GLBL_CMPY_CD = #glblCmpyCd#
            AND OU.ORG_NM       = #orgNm#
            AND OU.GNRN_TP_CD   = #gnrnTpCd#
            AND OU.EZCANCELFLAG = '0'
            
            AND OU.GLBL_CMPY_CD   = OST.GLBL_CMPY_CD
            AND OU.ORG_STRU_TP_CD = OST.ORG_STRU_TP_CD
            AND OST.TRTY_STRU_FLG = 'Y'
            AND OST.EZCANCELFLAG  = '0'
            
            AND OU.GLBL_CMPY_CD     = TGT.GLBL_CMPY_CD
            AND OU.TRTY_GRP_TP_CD   = TGT.TRTY_GRP_TP_CD
            AND TGT.NON_SLS_REP_FLG = #nonSlsRepFlg#
            AND TGT.EZCANCELFLAG    = '0'
            
            AND OU.GLBL_CMPY_CD   = BAO.GLBL_CMPY_CD
            AND OU.FIRST_ORG_CD   = BAO.BIZ_AREA_ORG_CD
            AND OU.ORG_STRU_TP_CD = BAO.ORG_STRU_TP_CD
            AND BAO.EZCANCELFLAG  = '0'
            
            AND OU.GLBL_CMPY_CD   = ORR.GLBL_CMPY_CD
            AND OU.ORG_CD         = ORR.ORG_CD
        <isNotNull property="nonSlsRep">
            AND ORR.ACCT_TEAM_ROLE_TP_CD IS NULL
        </isNotNull>
            AND ORR.GNRN_TP_CD    = #gnrnTpCd#
            AND ORR.EZCANCELFLAG  = '0'
    </statement>
</sqlMap>
