<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NPAL1260Query">
    <typeAlias alias="NPAL1260_ASMsg" type="business.blap.NPAL1260.NPAL1260_ASMsg" />
    <typeAlias alias="NPAL1260_ACMsg" type="business.blap.NPAL1260.NPAL1260_ACMsg" />

    <statement id="getSearchOptionPulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            SSO.SRCH_OPT_PK
            ,SSO.SRCH_OPT_NM
        FROM
            SAVE_SRCH_OPT SSO
        WHERE
                SSO.GLBL_CMPY_CD = #glblCmpyCd#
            AND SSO.SRCH_OPT_APL_ID = #srchOptAplId#
            AND SSO.SRCH_OPT_USR_ID = #srchOptUsrId#
            AND SSO.EZCANCELFLAG = '0'
        ORDER BY
            SSO.SRCH_OPT_NM ASC
    </statement>
    
    <statement id="getRequisitionTypePulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            PRT.PRCH_REQ_TP_CD
            ,PRT.PRCH_REQ_TP_DESC_TXT
        FROM
            PRCH_REQ_TP PRT
        WHERE
                PRT.GLBL_CMPY_CD = #glblCmpyCd#
            AND PRT.PRCH_REQ_REC_TP_CD IN (#prchReqRecTpCdRequest#,#prchReqRecTpCdReturn#)
            AND PRT.EZCANCELFLAG = '0'
        ORDER BY
            PRT.PRCH_REQ_TP_SORT_NUM ASC
    </statement>
    
    <statement id="getLineStatusPulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            PRCH_REQ_LINE_STS_CD
            ,PRCH_REQ_LINE_STS_DESC_TXT
        FROM
            PRCH_REQ_LINE_STS
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND EZCANCELFLAG = '0'
        ORDER BY
            PRCH_REQ_LINE_STS_SORT_NUM ASC
    </statement>
    
    <statement id="getLineTypePulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            PRCH_REQ_LINE_TP_CD
            ,PRCH_REQ_LINE_TP_DESC_TXT
        FROM
            PRCH_REQ_LINE_TP
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND PRCH_REQ_REC_TP_CD IN (#prchReqRecTpCdRequest#,#prchReqRecTpCdReturn#)
            AND EZCANCELFLAG = '0'
<!-- QC#21882 -->
<!--            AND SCR_ENT_AVAL_FLG = #scrEntAvalFlg# --> 
        ORDER BY
            PRCH_REQ_LINE_TP_SORT_NUM ASC
    </statement>
        
    <statement id="getLineTypePulldownList2" parameterClass="Map"
        resultClass="Map">
        SELECT
            PRLT.PRCH_REQ_LINE_TP_CD
            ,PRLT.PRCH_REQ_LINE_TP_DESC_TXT
        FROM
            PRCH_REQ_LINE_TP PRLT
            ,PRCH_REQ_TP PRT
        WHERE
                PRLT.GLBL_CMPY_CD = #glblCmpyCd#
            AND PRLT.EZCANCELFLAG = '0'
            AND PRLT.GLBL_CMPY_CD = PRT.GLBL_CMPY_CD
            AND PRT.EZCANCELFLAG  = '0'
            AND PRLT.PRCH_REQ_REC_TP_CD = PRT.PRCH_REQ_REC_TP_CD
            AND PRT.PRCH_REQ_TP_CD = #prchReqTpCd#
        ORDER BY
            PRLT.PRCH_REQ_LINE_TP_SORT_NUM ASC
    </statement>
    
    <statement id="getTechTerritoryPulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            LINE_BIZ_TP_CD
            ,LINE_BIZ_TP_DESC_TXT
        FROM
            LINE_BIZ_TP
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND EZCANCELFLAG = '0'
            AND OTHER_RESRC_TRTY_FLG = #otherResrcTrtyFlg#
        ORDER BY
            LINE_BIZ_TP_SORT_NUM ASC
    </statement>
    
    <statement id="getDocumentSourceTypePulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            PRST.PRCH_REQ_SRC_TP_CD
            ,PRST.PRCH_REQ_SRC_TP_DESC_TXT
        FROM
            PRCH_REQ_SRC_TP_XREF PRSTX
            ,PRCH_REQ_SRC_TP     PRST
        WHERE
                PRSTX.GLBL_CMPY_CD = #glblCmpyCd#
            AND PRSTX.EZCANCELFLAG = '0'
            AND PRST.GLBL_CMPY_CD = #glblCmpyCd#
            AND PRST.EZCANCELFLAG = '0'
            AND PRSTX.PRCH_REQ_SRC_TP_CD = PRST.PRCH_REQ_SRC_TP_CD
            AND PRSTX.PRCH_REQ_REC_TP_CD = #prchReqRecTpCd#
        ORDER BY
            PRST.PRCH_REQ_SRC_TP_SORT_NUM ASC
    </statement>
    
    <statement id="getRequestedShipMethodPulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            SHPG_SVC_LVL_CD
            ,SHPG_SVC_LVL_NM
        FROM
            SHPG_SVC_LVL
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND EZCANCELFLAG = '0'
        ORDER BY
            SHPG_SVC_LVL_SORT_NUM ASC
    </statement>

    <statement id="findCustomerName" parameterClass="Map" resultClass="Map">
        SELECT
            DAC.DS_ACCT_NM
        FROM
            SHIP_TO_CUST STC
           ,SELL_TO_CUST DAC
        WHERE
                STC.EZCANCELFLAG     = '0'
            AND STC.GLBL_CMPY_CD     = #glblCmpyCd#
            AND DAC.EZCANCELFLAG     = '0'
            AND DAC.GLBL_CMPY_CD     = STC.GLBL_CMPY_CD
            AND DAC.SELL_TO_CUST_CD  = STC.SELL_TO_CUST_CD
            AND STC.SHIP_TO_CUST_CD  = #shipToCustCd#
    </statement>

    <!--Search-->
    <statement id="search" parameterClass="Map" resultClass="Map">
    <!-- Add Start 2020/03/17 QC#56104 -->
    <isNotNull property="soNum_H1">
        WITH PRCH_REQ_SO_DTL AS ( 
            SELECT
                  PRD.GLBL_CMPY_CD 
                , PRD.PRCH_REQ_NUM 
                , PRD.PRCH_REQ_LINE_NUM 
                , PRD.PRCH_REQ_LINE_SUB_NUM 
            FROM
                  PRCH_REQ_DTL PRD 
            WHERE
                    PRD.GLBL_CMPY_CD = #glblCmpyCd# 
                AND PRD.SO_NUM       = #soNum_H1# 
                AND PRD.EZCANCELFLAG = '0' 
            UNION 
            SELECT
                  PRD.GLBL_CMPY_CD 
                , PRD.TRX_REF_NUM                     AS PRCH_REQ_NUM 
                , PRD.TRX_REF_LINE_NUM                AS PRCH_REQ_LINE_NUM 
                , TO_NUMBER(PRD.TRX_REF_LINE_SUB_NUM) AS PRCH_REQ_LINE_SUB_NUM 
            FROM
                  PRCH_REQ_DTL PRD 
                , PO_ACK_DTL   PAD 
            WHERE
                    PRD.GLBL_CMPY_CD        = #glblCmpyCd# 
                AND PRD.EZCANCELFLAG        = '0' 
                AND PRD.GLBL_CMPY_CD        = PAD.GLBL_CMPY_CD 
                AND PRD.PO_ORD_NUM          = PAD.PO_ORD_NUM 
                AND PRD.PO_ORD_DTL_LINE_NUM = PAD.PO_ORD_DTL_LINE_NUM 
                AND PAD.VND_SO_NUM          = #soNum_H1# 
                AND PAD.EZCANCELFLAG        = '0' 
            UNION 
            SELECT
                  PRD.GLBL_CMPY_CD 
                , PRD.TRX_REF_NUM                     AS PRCH_REQ_NUM 
                , PRD.TRX_REF_LINE_NUM                AS PRCH_REQ_LINE_NUM 
                , TO_NUMBER(PRD.TRX_REF_LINE_SUB_NUM) AS PRCH_REQ_LINE_SUB_NUM 
            FROM
                  PRCH_REQ_DTL    PRD 
                , PO_ACK_DTL      PAD 
                , EDI_ASN_HDR_WRK EAHW 
            WHERE
                    PRD.GLBL_CMPY_CD        = #glblCmpyCd# 
                AND PRD.EZCANCELFLAG        = '0' 
                AND PRD.GLBL_CMPY_CD        = PAD.GLBL_CMPY_CD 
                AND PRD.PO_ORD_NUM          = PAD.PO_ORD_NUM 
                AND PRD.PO_ORD_DTL_LINE_NUM = PAD.PO_ORD_DTL_LINE_NUM 
                AND PAD.EZCANCELFLAG        = '0' 
                AND PAD.GLBL_CMPY_CD        = EAHW.GLBL_CMPY_CD 
                AND PAD.VND_SO_NUM          = EAHW.ASN_SO_NUM 
                AND EAHW.SHIP_FROM_SO_NUM   = #soNum_H1# 
                AND EAHW.EZCANCELFLAG       = '0' 
        )
    </isNotNull>
    <!-- Add End 2020/03/17 QC#56104 -->

    SELECT
        R.PRCH_REQ_NUM
        ,R.PRCH_REQ_LINE_NUM 
        ,R.PRCH_REQ_LINE_SUB_NUM
        ,R.PRCH_REQ_TP_CD
        ,R.PRCH_REQ_TP_DESC_TXT
        ,R.PRCH_REQ_LINE_TP_DESC_TXT
        ,R.MDSE_CD
        ,R.MDSE_DESC_SHORT_TXT
        ,R.PRCH_REQ_QTY
        ,R.PROCR_TP_DESC_TXT
        ,R.SRC_RTL_WH_CD
        ,R.RTL_WH_NM1
        ,R.SRC_RTL_SWH_CD
        ,R.RTL_SWH_NM1
        ,R.DEST_RTL_WH_CD
        ,R.RTL_WH_NM2
        ,R.DEST_RTL_SWH_CD
        ,R.RTL_SWH_NM2
        ,R.PRCH_REQ_LINE_STS_DESC_TXT
        ,R.ORD_QTY
        ,R.ROP_QTY
        ,R.RWS_PUT_AWAY_QTY
        ,R.BO_QTY
        ,R.PRCH_REQ_FRZ_FLG
        ,R.INSRC_FLG
        ,R.PO_CRAT_FLG
        ,R.PRCH_REQ_CANC_QTY
        ,R.ORIG_PRCH_REQ_LINE_NUM
        ,R.ORIG_PRCH_REQ_LINE_SUB_NUM
        ,R.PRCH_REQ_CRAT_DT
        ,R.PRCH_REQ_CRAT_TM
        ,R.RQST_RCV_DT
        ,R.RQST_RCV_TM
        ,R.SHIP_DT_TM_TS
        ,R.RWS_CLO_DT_TM_TS
        ,R.ORD_LAST_UPD_TS
        ,R.LINE_BIZ_TP_DESC_TXT
        ,R.PRCH_REQ_SRC_TP_DESC_TXT
        ,R.FSR_NUM
        ,R.SVC_TASK_NUM
        ,R.SVC_MACH_SER_NUM
        ,R.PO_ORD_NUM
        ,R.SO_NUM
    <!-- Add Start 2020/03/12 QC#56104 -->
        ,CASE WHEN R.SO_NUM = R.ALT_SO_NUM THEN NULL
              ELSE R.ALT_SO_NUM
         END AS ALT_SO_NUM
    <!-- Add End 2020/03/12 QC#56104 -->
        ,R.PRCH_REQ_NUM2
        ,R.PRNT_VND_CD
        ,R.PRNT_VND_NM
        ,R.VND_CD
        ,R.LOC_NM
        ,R.SHIP_TO_CUST_CD
        ,R.DS_ACCT_NM
        ,R.RQST_TECH_TOC_CD
        ,R.TECH_NM
        ,R.CARR_NM
        ,R.SHPG_SVC_LVL_NM
        <!-- ,R.PRO_NUM -->
        ,R.PRCH_REQ_REL_QTY
        ,R.SHIP_QTY
        ,NVL((SELECT
              SUM(PRD.SHIP_QTY)
          FROM
              PRCH_REQ_DTL PRD
          WHERE
              R.PRCH_REQ_NUM            =    PRD.PRCH_REQ_NUM
          AND R.PRCH_REQ_LINE_NUM       =    PRD.PRCH_REQ_LINE_NUM
          AND PRD.PRCH_REQ_LINE_SUB_NUM &gt; #lineSubNumParent#
          AND PRD.EZCANCELFLAG          =    '0'
        ), R.SHIP_QTY) AS SUM_SHIP_QTY
        ,NVL((SELECT
              SUM(PRD.RWS_PUT_AWAY_QTY)
          FROM
              PRCH_REQ_DTL PRD
          WHERE
              R.PRCH_REQ_NUM            =    PRD.PRCH_REQ_NUM
          AND R.PRCH_REQ_LINE_NUM       =    PRD.PRCH_REQ_LINE_NUM
          AND PRD.PRCH_REQ_LINE_SUB_NUM &gt; #lineSubNumParent#
          AND PRD.EZCANCELFLAG          =    '0'
        ), R.RWS_PUT_AWAY_QTY) AS SUM_RWS_PUT_AWAY_QTY
        ,R.PRCH_REQ_LINE_TP_CD
        <!-- START 2023/10/25 G.Quan [QC#61494, ADD] -->
        ,R.DELY_DT
        <!-- END 2023/10/25 G.Quan [QC#61494, ADD] -->
        ,R.ETA_DT
    FROM (
    SELECT DISTINCT
        PRD1.PRCH_REQ_NUM
        ,PRD1.PRCH_REQ_LINE_NUM 
        ,PRD1.PRCH_REQ_LINE_SUB_NUM
        ,PR1.PRCH_REQ_TP_CD
        ,PRT.PRCH_REQ_TP_DESC_TXT
        ,PRLT.PRCH_REQ_LINE_TP_DESC_TXT
        ,PRD1.MDSE_CD
        ,DMI.MDSE_DESC_SHORT_TXT
        ,PRD1.PRCH_REQ_QTY
        ,PT.PROCR_TP_DESC_TXT
        ,PRD1.SRC_RTL_WH_CD
        ,WH1.RTL_WH_NM AS RTL_WH_NM1
        ,PRD1.SRC_RTL_SWH_CD
        ,SWH1.RTL_SWH_NM AS RTL_SWH_NM1
        ,PRD1.DEST_RTL_WH_CD
        ,WH2.RTL_WH_NM AS RTL_WH_NM2
        ,PRD1.DEST_RTL_SWH_CD
        ,SWH2.RTL_SWH_NM AS RTL_SWH_NM2
        ,PRLS.PRCH_REQ_LINE_STS_DESC_TXT
        ,PRD1.ORD_QTY
        ,PRD1.ROP_QTY
        ,PRD1.RWS_PUT_AWAY_QTY
        ,DECODE(PRD2.PO_ORD_NUM, NULL, NULL,
            (
                SELECT
                    PAD.ORD_QTY
                FROM
                    PO_ACK_DTL PAD
                    ,PO_DTL    DPD1
                WHERE
                        PRD1.PRCH_REQ_NUM = DPD1.TRX_REF_NUM
                    AND PRD1.PRCH_REQ_LINE_NUM = DPD1.TRX_REF_LINE_NUM
                    AND PRD1.PRCH_REQ_LINE_SUB_NUM = DPD1.TRX_REF_LINE_SUB_NUM
                    AND PRD1.GLBL_CMPY_CD = DPD1.GLBL_CMPY_CD
                    AND DPD1.EZCANCELFLAG = '0'
                    AND DPD1.VND_PO_ACK_STS_CD = #vndPoAckStsCd#
                    AND PAD.PO_ACK_DTL_LTST_FLG = 'Y'
                    AND PAD.VND_PO_ACK_STS_CD = DPD1.VND_PO_ACK_STS_CD
                    AND PAD.PO_ORD_NUM = DPD1.PO_ORD_NUM
                    AND PAD.PO_ORD_DTL_LINE_NUM = DPD1.PO_ORD_DTL_LINE_NUM
                    AND PAD.GLBL_CMPY_CD = DPD1.GLBL_CMPY_CD
                    AND PAD.EZCANCELFLAG = '0'
            )
        ) AS BO_QTY
        ,PRD1.PRCH_REQ_FRZ_FLG
        ,PRD1.INSRC_FLG
        ,PRD1.PO_CRAT_FLG
        ,PRD1.PRCH_REQ_CANC_QTY
        ,PRD1.ORIG_PRCH_REQ_LINE_NUM
        ,PRD1.ORIG_PRCH_REQ_LINE_SUB_NUM
        ,PRD1.PRCH_REQ_CRAT_DT
        ,PRD1.PRCH_REQ_CRAT_TM
        ,PRD1.RQST_RCV_DT
        ,PRD1.RQST_RCV_TM
        ,CASE 
            WHEN PRD2.PO_ORD_NUM IS NULL THEN PRD1.SHIP_DT_TM_TS 
            ELSE (
            <!-- QC#29279 -->
            <!-- SELECT EAHW.ASN_SHIP_DT_TM_TS FROM EDI_ASN_HDR_WRK EAHW WHERE EAHW.GLBL_CMPY_CD = PRD2.GLBL_CMPY_CD AND EAHW.PO_ORD_NUM = PRD2.PO_ORD_NUM AND EAHW.SHIP_FROM_SO_NUM = PAD2.VND_SO_NUM AND EAHW.EZCANCELFLAG = '0') -->
                SELECT EAHW.ASN_SHIP_DT_TM_TS FROM EDI_ASN_HDR_WRK EAHW WHERE EAHW.GLBL_CMPY_CD = PRD2.GLBL_CMPY_CD AND EAHW.PO_ORD_NUM = PRD2.PO_ORD_NUM AND EAHW.ASN_SO_NUM = PAD2.VND_SO_NUM AND EAHW.EZCANCELFLAG = '0')
            <!-- QC#29279 -->
         END AS SHIP_DT_TM_TS  
        ,PRD1.RWS_CLO_DT_TM_TS
        ,DECODE(PRD2.PO_ORD_NUM, NULL, NULL,
            (
                SELECT
                    MAX(PAH.ORD_LAST_UPD_TS)
                FROM
                    PO_ACK_HDR PAH
                    ,PO_DTL    DPD2
                WHERE
                        PRD1.PRCH_REQ_NUM = DPD2.TRX_REF_NUM
                    AND PRD1.PRCH_REQ_LINE_NUM = DPD2.TRX_REF_LINE_NUM
                    AND PRD1.PRCH_REQ_LINE_SUB_NUM = DPD2.TRX_REF_LINE_SUB_NUM
                    AND PRD1.GLBL_CMPY_CD = DPD2.GLBL_CMPY_CD
                    AND DPD2.EZCANCELFLAG = '0'
                    AND DPD2.VND_PO_ACK_STS_CD = #vndPoAckStsCd#
                    AND PAH.PO_ORD_NUM = DPD2.PO_ORD_NUM
                    AND PAH.GLBL_CMPY_CD = DPD2.GLBL_CMPY_CD
                    AND PAH.EZCANCELFLAG = '0'
            )
        ) AS ORD_LAST_UPD_TS
        ,LBT.LINE_BIZ_TP_DESC_TXT
        ,PRST.PRCH_REQ_SRC_TP_DESC_TXT
        ,PR1.FSR_NUM
        ,PR1.SVC_TASK_NUM
        ,PR1.SVC_MACH_SER_NUM
        ,PRD2.PO_ORD_NUM
        ,NVL(PRD1.SO_NUM, PAD2.VND_SO_NUM) AS SO_NUM
    <!-- Add Start 2020/03/12 QC#56104 -->
        ,(SELECT EAHW.SHIP_FROM_SO_NUM FROM EDI_ASN_HDR_WRK EAHW WHERE EAHW.GLBL_CMPY_CD = 'ADB' AND EAHW.EZCANCELFLAG = '0' AND EAHW.GLBL_CMPY_CD = PAD2.GLBL_CMPY_CD AND EAHW.ASN_SO_NUM = PAD2.VND_SO_NUM) AS ALT_SO_NUM
    <!-- Add End 2020/03/12 QC#56104 -->
        ,PR2.PRCH_REQ_NUM AS PRCH_REQ_NUM2
        ,PV.PRNT_VND_CD
        ,PV.PRNT_VND_NM
        ,VND.VND_CD
        ,VND.LOC_NM
        ,PR1.SHIP_TO_CUST_CD
        ,DAC.DS_ACCT_NM
        ,PR1.RQST_TECH_TOC_CD
        ,TM.TECH_NM
        ,OCV.CARR_NM
        ,SSL.SHPG_SVC_LVL_NM
        <!--,PRD1.PRO_NUM -->
        ,PRD1.PRCH_REQ_REL_QTY
        ,PRD1.SHIP_QTY
        ,PRD1.PRCH_REQ_LINE_TP_CD
        ,CASE 
            WHEN PRD2.PO_ORD_NUM IS NULL THEN (
                NVL(
                    (SELECT
                        MAX(PSW.EDI_STS_DT)
                    FROM (
                        SELECT
                            PSW.EDI_STS_DT || PSW.EDI_STS_TM AS EDI_STS_DT
                        FROM
                            SHPG_PLN SP
                           ,POD_STS_WRK PSW
                        WHERE 
                            SP.GLBL_CMPY_CD     = PRD1.GLBL_CMPY_CD
                        AND SP.SO_NUM           = PRD1.SO_NUM
                        AND SP.TRX_HDR_NUM      = PRD1.INVTY_ORD_NUM
                        AND SP.TRX_LINE_NUM     = PRD1.INVTY_ORD_LINE_NUM
                        AND SP.GLBL_CMPY_CD     = PSW.GLBL_CMPY_CD
                        AND SP.BOL_NUM          = PSW.EDI_PRO_NUM
                        <!-- START 2023/10/25 G.Quan [QC#61494, MOD] -->
                        <!-- 
                        <iterate property="podUpdStsList" var="podUpdStsList[]" open="AND PSW.EDI_STS_CD IN (" conjunction= ", " close=")">
                            #podUpdStsList[]#
                        </iterate>
                        -->
                        <iterate property="ediStsCdList" var="ediStsCdList[]" open="AND PSW.EDI_STS_CD IN (" conjunction= ", " close=")">
                            #ediStsCdList[]#
                        </iterate>
                        <!-- END 2023/10/25 G.Quan [QC#61494, MOD] -->
                        AND SP.EZCANCELFLAG     = '0'
                        AND PSW.EZCANCELFLAG    = '0'
                        ORDER BY
                            PSW.EZUPTIME DESC
                           ,PSW.EDI_STS_DT DESC
                           ,PSW.EDI_STS_TM DESC
                    ) PSW
                    WHERE ROWNUM = 1
                )
                ,
                <!-- START 2023/10/25 G.Quan [QC#61494, ADD] -->
                    NVL(
                        (SELECT
                             MAX(TRX.WMS_SHIP_DT_TM_TS)
                         FROM
                             WMS_INBD_TRX TRX
                         WHERE
                             TRX.GLBL_CMPY_CD = PRD1.GLBL_CMPY_CD
                         AND TRX.PRO_NUM      = PRD1.PRO_NUM
                         AND TRX.WMS_CARR_CD IN (
                             SELECT
                                 A.TPL_CARR_SVC_LVL_CD
                             FROM
                                 TPL_CARR_SVC_LVL A
                             WHERE
                                 A.GLBL_CMPY_CD = PR1.GLBL_CMPY_CD
                             AND ((PR1.PRCH_REQ_TP_CD = #prchReqTpCdPremiumRush# AND A.TPL_CARR_NM LIKE #premiumRushConditionTplCarrNm#)
                                 OR
                                 (PR1.PRCH_REQ_TP_CD = #prchReqTpCdRush# AND 
                                 <iterate property="rushConditionTplCarrNmList" var="rushConditionTplCarrNmList[]" open="A.TPL_CARR_NM IN (" conjunction= ", " close=")">
                                 #rushConditionTplCarrNmList[]#
                                 </iterate>
                                 ))
                             AND A.EZCANCELFLAG = '0'
                         )
                         AND TRX.EZCANCELFLAG = '0'
                        )
                     ,
                        NVL(
                <!-- END 2023/10/25 G.Quan [QC#61494, ADD] -->
                             (SELECT
                                 MAX(SP.RDD_DT)
                             FROM
                                 SHPG_PLN SP
                             WHERE 
                                 SP.GLBL_CMPY_CD     = PRD1.GLBL_CMPY_CD
                             AND SP.SO_NUM           = PRD1.SO_NUM
                             AND SP.TRX_HDR_NUM      = PRD1.INVTY_ORD_NUM
                             AND SP.TRX_LINE_NUM     = PRD1.INVTY_ORD_LINE_NUM
                             AND SP.EZCANCELFLAG     = '0'
                             )
                <!-- START 2023/10/25 G.Quan [QC#61494, ADD] -->
                             ,
                             PRD1.RQST_RCV_DT  || PRD1.RQST_RCV_TM || '00'
                        )
                    )
                <!-- END 2023/10/25 G.Quan [QC#61494, ADD] -->
                )
            )
            WHEN EXISTS(
                    SELECT 1 FROM RCV_ASN_VND RAV WHERE RAV.GLBL_CMPY_CD = PRD2.GLBL_CMPY_CD AND RAV.RCV_ASN_VND_CD = PRD2.VND_CD AND RAV.EZCANCELFLAG = '0'
                ) THEN 
                NVL(
                    (
                        SELECT
                            MAX(PSW.EDI_STS_DT)
                        FROM (
                            SELECT
                                PSW.EDI_STS_DT || PSW.EDI_STS_TM AS EDI_STS_DT
                            FROM
                                EDI_ASN_HDR_WRK EAHW
                               ,EDI_ASN_DTL_WRK EADW
                               ,POD_STS_WRK PSW
                            WHERE
                                EAHW.GLBL_CMPY_CD        = PRD2.GLBL_CMPY_CD
                            AND EAHW.ASN_SO_NUM          = PAD2.VND_SO_NUM
                            AND EAHW.GLBL_CMPY_CD        = EADW.GLBL_CMPY_CD
                            AND EAHW.ASN_SO_NUM          = EADW.ASN_SO_NUM
                            AND EADW.PO_ORD_NUM          = PRD2.PO_ORD_NUM
                            AND EADW.PO_ORD_DTL_LINE_NUM = PRD2.PO_ORD_DTL_LINE_NUM 
                            AND EADW.GLBL_CMPY_CD        = PSW.GLBL_CMPY_CD
                            AND EADW.ASN_BOL_NUM         = PSW.EDI_PRO_NUM
                            <!-- START 2023/10/25 G.Quan [QC#61494, MOD] -->
                            <!-- 
                            <iterate property="podUpdStsList" var="podUpdStsList[]" open="AND PSW.EDI_STS_CD IN (" conjunction= ", " close=")">
                                #podUpdStsList[]#
                            </iterate>
                            -->
                            <iterate property="ediStsCdList" var="ediStsCdList[]" open="AND PSW.EDI_STS_CD IN (" conjunction= ", " close=")">
                                #ediStsCdList[]#
                            </iterate>
                            <!-- END 2023/10/25 G.Quan [QC#61494, MOD] -->
                            AND EAHW.EZCANCELFLAG        = '0'
                            AND EADW.EZCANCELFLAG        = '0'
                            AND PSW.EZCANCELFLAG         = '0'
                            ORDER BY
                                PSW.EZUPTIME DESC
                               ,PSW.EDI_STS_DT DESC
                               ,PSW.EDI_STS_TM DESC
                        ) PSW
                        WHERE ROWNUM = 1
                    )
                ,
                    NVL(
                        (
                        SELECT
                            MAX(EADW.ASN_PLN_DELY_DT)
                        FROM
                             EDI_ASN_HDR_WRK EAHW
                            ,EDI_ASN_DTL_WRK EADW
                        WHERE
                            EAHW.GLBL_CMPY_CD = PRD2.GLBL_CMPY_CD
                        AND EAHW.ASN_SO_NUM   = PAD2.VND_SO_NUM
                        AND EAHW.GLBL_CMPY_CD = EADW.GLBL_CMPY_CD
                        AND EAHW.ASN_SO_NUM = EADW.ASN_SO_NUM
                        AND EADW.PO_ORD_NUM = PRD2.PO_ORD_NUM
                        AND EADW.PO_ORD_DTL_LINE_NUM = PRD2.PO_ORD_DTL_LINE_NUM 
                        AND EAHW.EZCANCELFLAG = '0'
                        AND EADW.EZCANCELFLAG = '0'
                        )
                    ,
                        NVL(
                        (
                        SELECT
                            TO_CHAR(TO_DATE(MAX(POYO.P_DATE_STOCK_IN_EST), 'YYYYMMDD') + #days#, 'YYYYMMDD') AS ETA_DT
                        FROM
                            CSA_PRT_CUST_CPO_V PCC
                           ,CSA_PRT_CPO_V      PC
                           ,CSA_PRT_VND_XREF_V XREF
                           ,CSA_PRT_POYO_V     POYO
                           ,PO_ACK_DTL         PAD_IB
                        WHERE
                            PCC.P_NUM_CUST_PO          = PRD2.PO_ORD_NUM 
                        AND PCC.P_NUM_CUST_PO          = PC.P_NUM_CUST_PO
                        AND PC.P_NUM_CUST_PO           = XREF.P_NUM_CUST_PO
                        AND XREF.P_NUM_PO_PARTS        = POYO.P_NUM_PO_PARTS
                        AND POYO.P_DATE_STOCK_IN_EST IS NOT NULL
                        AND PRD2.PO_ORD_NUM            = PAD_IB.PO_ORD_NUM
                        AND PRD2.PO_ORD_DTL_LINE_NUM   = PAD_IB.PO_ORD_DTL_LINE_NUM
                        AND PAD_IB.PO_ACK_DTL_LTST_FLG = 'Y'
                        <iterate property="ackStsList" var="ackStsList[]" open="AND PAD_IB.VND_PO_ACK_STS_CD IN (" conjunction= ", " close=")">
                            #ackStsList[]#
                        </iterate>
                        AND POYO.P_PARTS_NUM           = PAD_IB.VND_MDSE_CD
                        AND PCC.EZCANCELFLAG           = '0'
                        AND PC.EZCANCELFLAG            = '0'
                        AND XREF.EZCANCELFLAG          = '0'
                        AND POYO.EZCANCELFLAG          = '0'
                        )
                        ,
                            NVL(PAD2.ETA_DT, 
                               <!-- START 2023/10/25 G.Quan [QC#61494, ADD] -->
                               NVL(
                               <!-- END 2023/10/25 G.Quan [QC#61494, ADD] -->
                                 (SELECT PD.RQST_RCV_DT || PD.RQST_RCV_TM || '00' FROM PO_DTL PD WHERE PD.GLBL_CMPY_CD = PRD2.GLBL_CMPY_CD AND PD.PO_ORD_NUM = PRD2.PO_ORD_NUM AND PD.PO_ORD_DTL_LINE_NUM = PRD2.PO_ORD_DTL_LINE_NUM AND PD.EZCANCELFLAG = '0' AND ROWNUM = 1)
                                 <!-- START 2023/10/25 G.Quan [QC#61494, ADD] -->
                                 ,
                                     PRD1.RQST_RCV_DT  || PRD1.RQST_RCV_TM || '00'
                                 <!-- END 2023/10/25 G.Quan [QC#61494, ADD] -->
                               )
                            )
                        )
                    )
                )
            ELSE (
         <!-- START 2023/10/25 G.Quan [QC#61494, MOD] -->
         <!-- 
                SELECT PD.RQST_RCV_DT || PD.RQST_RCV_TM || '00' FROM PO_DTL PD WHERE PD.GLBL_CMPY_CD = PRD2.GLBL_CMPY_CD AND PD.PO_ORD_NUM = PRD2.PO_ORD_NUM AND PD.PO_ORD_DTL_LINE_NUM = PRD2.PO_ORD_DTL_LINE_NUM AND PD.EZCANCELFLAG = '0'  AND ROWNUM = 1
            )
         END AS ETA_DT
         -->
               NVL(
                 (SELECT PD.RQST_RCV_DT || PD.RQST_RCV_TM || '00' FROM PO_DTL PD WHERE PD.GLBL_CMPY_CD = PRD2.GLBL_CMPY_CD AND PD.PO_ORD_NUM = PRD2.PO_ORD_NUM AND PD.PO_ORD_DTL_LINE_NUM = PRD2.PO_ORD_DTL_LINE_NUM AND PD.EZCANCELFLAG = '0'  AND ROWNUM = 1)
               ,
                 PRD1.RQST_RCV_DT  || PRD1.RQST_RCV_TM || '00'
               )
             )
            END AS DELY_DT
            ,
            PRD1.RQST_RCV_DT  || PRD1.RQST_RCV_TM || '00' AS ETA_DT
         <!-- END 2023/10/25 G.Quan [QC#61494, MOD] -->
    FROM
        PRCH_REQ_DTL PRD1
        ,PRCH_REQ_DTL PRD2
        ,PRCH_REQ_TP PRT
        ,PRCH_REQ_LINE_TP PRLT
        ,MDSE DMI
        ,RTL_WH WH1
        ,RTL_SWH SWH1
        ,RTL_WH WH2
        ,RTL_SWH SWH2
        ,PRCH_REQ_LINE_STS PRLS
        ,LINE_BIZ_TP LBT
        ,PRCH_REQ_SRC_TP PRST
        ,PRCH_REQ PR1
        ,PRCH_REQ PR2
        ,PRNT_VND PV
        ,VND
        ,SELL_TO_CUST DAC
        ,TECH_MSTR TM
        ,OTBD_CARR_V OCV
        ,SHPG_SVC_LVL SSL
        ,SHPG_ORD SO
        ,SHIP_TO_CUST STC
        ,PROCR_TP PT
        ,PO_ACK_HDR PAH2
        ,PO_ACK_DTL PAD2
    <!-- Add Start 2020/03/17 QC#56104 -->
    <isNotNull property="soNum_H1">
        ,PRCH_REQ_SO_DTL PRSD
    </isNotNull>
    <!-- Add End 2020/03/17 QC#56104 -->
    WHERE
            PRD1.PRCH_REQ_NUM = PR1.PRCH_REQ_NUM
        AND PRD1.GLBL_CMPY_CD = PR1.GLBL_CMPY_CD
        AND PRD1.EZCANCELFLAG = '0'
        AND PRD2.TRX_REF_NUM(+) = PRD1.PRCH_REQ_NUM
        AND PRD2.TRX_REF_LINE_NUM(+) = PRD1.PRCH_REQ_LINE_NUM
        AND PRD2.TRX_REF_LINE_SUB_NUM(+) = PRD1.PRCH_REQ_LINE_SUB_NUM
        AND PRD2.GLBL_CMPY_CD(+) = PR1.GLBL_CMPY_CD
        AND PRD2.EZCANCELFLAG(+) = '0'
        AND PR2.PRCH_REQ_NUM(+) = PRD2.PRCH_REQ_NUM
        AND PR2.GLBL_CMPY_CD(+) = PRD2.GLBL_CMPY_CD
        AND PR2.EZCANCELFLAG(+) = '0'
        AND SO.SO_NUM(+) = PRD1.SO_NUM
        AND SO.GLBL_CMPY_CD(+) = PRD1.GLBL_CMPY_CD
        AND SO.EZCANCELFLAG(+) = '0'
        AND SSL.SHPG_SVC_LVL_CD(+) = SO.SHPG_SVC_LVL_CD
        AND SSL.GLBL_CMPY_CD(+) = SO.GLBL_CMPY_CD
        AND SSL.EZCANCELFLAG(+) = '0'
        AND PRT.PRCH_REQ_TP_CD(+) = PR1.PRCH_REQ_TP_CD
        AND PRT.GLBL_CMPY_CD(+) = PR1.GLBL_CMPY_CD
        AND PRT.EZCANCELFLAG(+) = '0'
        AND PRLT.PRCH_REQ_LINE_TP_CD(+) = PRD1.PRCH_REQ_LINE_TP_CD
        AND PRLT.GLBL_CMPY_CD(+) = PRD1.GLBL_CMPY_CD
        AND PRLT.EZCANCELFLAG(+) = '0'
        AND PRLS.PRCH_REQ_LINE_STS_CD(+) = PRD1.PRCH_REQ_LINE_STS_CD
        AND PRLS.GLBL_CMPY_CD(+) = PRD1.GLBL_CMPY_CD
        AND PRLS.EZCANCELFLAG(+) = '0'
        AND PRST.PRCH_REQ_SRC_TP_CD(+) = PR1.PRCH_REQ_SRC_TP_CD
        AND PRST.GLBL_CMPY_CD(+) = PR1.GLBL_CMPY_CD
        AND PRST.EZCANCELFLAG(+) = '0'
        AND LBT.LINE_BIZ_TP_CD(+) = PR1.LINE_BIZ_TP_CD
        AND LBT.GLBL_CMPY_CD(+) = PR1.GLBL_CMPY_CD
        AND LBT.EZCANCELFLAG(+) = '0'
        AND TM.TECH_TOC_CD(+) = PR1.RQST_TECH_TOC_CD
        AND TM.GLBL_CMPY_CD(+) = PR1.GLBL_CMPY_CD
        AND TM.EZCANCELFLAG(+) = '0'
        AND WH1.RTL_WH_CD(+) = PRD1.SRC_RTL_WH_CD
        AND WH1.GLBL_CMPY_CD(+) = PRD1.GLBL_CMPY_CD
        AND WH1.EZCANCELFLAG(+) = '0'
        AND SWH1.RTL_WH_CD(+) = PRD1.SRC_RTL_WH_CD
        AND SWH1.RTL_SWH_CD(+) = PRD1.SRC_RTL_SWH_CD
        AND SWH1.GLBL_CMPY_CD(+) = PRD1.GLBL_CMPY_CD
        AND SWH1.EZCANCELFLAG(+) = '0'
        AND WH2.RTL_WH_CD(+) = PRD1.DEST_RTL_WH_CD
        AND WH2.GLBL_CMPY_CD(+) = PRD1.GLBL_CMPY_CD
        AND WH2.EZCANCELFLAG(+) = '0'
        AND SWH2.RTL_WH_CD(+) = PRD1.DEST_RTL_WH_CD
        AND SWH2.RTL_SWH_CD(+) = PRD1.DEST_RTL_SWH_CD
        AND SWH2.GLBL_CMPY_CD(+) = PRD1.GLBL_CMPY_CD
        AND SWH2.EZCANCELFLAG(+) = '0'
        AND STC.SHIP_TO_CUST_CD(+) = PR1.SHIP_TO_CUST_CD
        AND STC.GLBL_CMPY_CD(+) = PR1.GLBL_CMPY_CD
        AND STC.EZCANCELFLAG(+) = '0'
        AND DAC.SELL_TO_CUST_CD(+) = STC.SELL_TO_CUST_CD
        AND DAC.GLBL_CMPY_CD(+) = STC.GLBL_CMPY_CD
        AND DAC.EZCANCELFLAG(+) = '0'
        AND DMI.MDSE_CD(+) = PRD1.MDSE_CD
        AND DMI.GLBL_CMPY_CD(+) = PRD1.GLBL_CMPY_CD
        AND DMI.EZCANCELFLAG(+) = '0'
        AND PV.PRNT_VND_CD(+) = PRD1.PRNT_VND_CD
        AND PV.GLBL_CMPY_CD(+) = PRD1.GLBL_CMPY_CD
        AND PV.EZCANCELFLAG(+) = '0'
        AND VND.VND_CD(+) = PRD1.VND_CD
        AND VND.GLBL_CMPY_CD(+) = PRD1.GLBL_CMPY_CD
        AND VND.EZCANCELFLAG(+) = '0'
        AND OCV.CARR_CD(+) = PRD1.CARR_CD
        AND OCV.GLBL_CMPY_CD(+) = PRD1.GLBL_CMPY_CD
        AND OCV.EZCANCELFLAG(+) = '0'
        AND PT.PROCR_TP_CD(+) = PRD1.PROCR_TP_CD
        AND PT.GLBL_CMPY_CD(+) = PRD1.GLBL_CMPY_CD
        AND PT.EZCANCELFLAG(+) = '0'

        AND PRD2.GLBL_CMPY_CD = PAH2.GLBL_CMPY_CD(+)
        AND PRD2.PO_ORD_NUM = PAH2.PO_ORD_NUM(+)
        AND PAH2.EZCANCELFLAG(+) = '0'
        AND PRD2.GLBL_CMPY_CD = PAD2.GLBL_CMPY_CD(+)
        AND PRD2.PO_ORD_NUM = PAD2.PO_ORD_NUM(+)
        AND PRD2.PO_ORD_DTL_LINE_NUM = PAD2.PO_ORD_DTL_LINE_NUM(+)
        AND PAD2.VND_SO_NUM(+) IS NOT NULL
        AND PAD2.EZCANCELFLAG(+) = '0'

        AND PR1.GLBL_CMPY_CD = #glblCmpyCd#
        AND PR1.EZCANCELFLAG = '0'
        AND PR1.PRCH_REQ_REC_TP_CD IN (#prchReqRecTpCdRequest#,#prchReqRecTpCdReturn#)
        AND PR2.PRCH_REQ_REC_TP_CD(+) = #prchReqRecTpCdRequisition#

        <isNotNull property="prchReqNum_H1">
            AND PR1.PRCH_REQ_NUM = #prchReqNum_H1#
        </isNotNull>
        <isNotNull property="prchReqTpCd_SE">
            AND PR1.PRCH_REQ_TP_CD = #prchReqTpCd_SE#
        </isNotNull>
        <isNotNull property="lineBizTpCd_SE">
            AND PR1.LINE_BIZ_TP_CD = #lineBizTpCd_SE#
        </isNotNull>
        <isNotNull property="prchReqSrcTpCd_SE">
            AND PR1.PRCH_REQ_SRC_TP_CD = #prchReqSrcTpCd_SE#
        </isNotNull>
        <isNotNull property="fsrNum_H1">
            AND PR1.FSR_NUM = #fsrNum_H1#
        </isNotNull>
        <isNotNull property="svcTaskNum_H1">
            AND PR1.SVC_TASK_NUM = #svcTaskNum_H1#
        </isNotNull>
        <isNotNull property="svcMachSerNum_H1">
            AND PR1.SVC_MACH_SER_NUM = #svcMachSerNum_H1#
        </isNotNull>
        <isNotNull property="mdseCd_H1">
            AND PRD1.MDSE_CD = #mdseCd_H1#
        </isNotNull>
        <isNotNull property="prchReqLineTpCd_SE">
            AND PRD1.PRCH_REQ_LINE_TP_CD = #prchReqLineTpCd_SE#
        </isNotNull>
        <isNotNull property="prchReqLineStsCd_SE">
            AND PRD1.PRCH_REQ_LINE_STS_CD = #prchReqLineStsCd_SE#
        </isNotNull>
        <isNotNull property="prchReqCratDt_HF">
            AND PRD1.PRCH_REQ_CRAT_DT &gt;= #prchReqCratDt_HF#
        </isNotNull>
        <isNotNull property="prchReqCratDt_HT">
            AND PRD1.PRCH_REQ_CRAT_DT &lt;= #prchReqCratDt_HT#
        </isNotNull>
        <isNotNull property="rqstRcvDt_HF">
            AND PRD1.RQST_RCV_DT &gt;= #rqstRcvDt_HF#
        </isNotNull>
        <isNotNull property="rqstRcvDt_HT">
            AND PRD1.RQST_RCV_DT &lt;= #rqstRcvDt_HT#
        </isNotNull>
        <isNotNull property="shipDtTmTs_HF">
            AND PRD1.SHIP_DT_TM_TS &gt;= #shipDtTmTs_HF#
        </isNotNull>
        <isNotNull property="shipDtTmTs_HT">
            AND PRD1.SHIP_DT_TM_TS &lt;= #shipDtTmTs_HT#
        </isNotNull>
        <isNotNull property="xxChkBox_H2">
            AND PRD1.PRCH_REQ_FRZ_FLG = #xxChkBox_H2#
        </isNotNull>
        <!-- 2018/12/04 QC#27093 Add Start -->
        <isNotNull property="xxChkBox_H5"> <!-- Back Order Flag -->
            <isNull property="xxChkBox_H2">
                AND PRD1.PRCH_REQ_FRZ_FLG = #xxChkBox_H5#
                AND PRD1.PRCH_REQ_BAL_QTY <![CDATA[ >]]> 0
            </isNull>
        </isNotNull>
        <!-- 2018/12/04 QC#27093 Add End -->
        <isNotNull property="poOrdNum_H1">
            AND PRD2.PO_ORD_NUM = #poOrdNum_H1#
        </isNotNull>
        <isNotNull property="soNum_H1">
            <!-- Mod Start 2020/03/12 QC#56104 -->
            <!-- AND PRD1.SO_NUM = #soNum_H1# -->
            AND PRD1.GLBL_CMPY_CD = PRSD.GLBL_CMPY_CD
            AND PRD1.PRCH_REQ_NUM = PRSD.PRCH_REQ_NUM
            AND PRD1.PRCH_REQ_LINE_NUM = PRSD.PRCH_REQ_LINE_NUM 
            AND PRD1.PRCH_REQ_LINE_SUB_NUM = PRSD.PRCH_REQ_LINE_SUB_NUM
            <!-- Mod End 2020/03/12 QC#56104 -->
        </isNotNull>
        <isNotNull property="xxChkBox_H3">
            AND PRD1.INSRC_FLG = #xxChkBox_H3#
        </isNotNull>
        <isNotNull property="xxChkBox_H4">
            AND PRD1.PO_CRAT_FLG = #xxChkBox_H4#
        </isNotNull>
        <isNotNull property="destRtlWhCd_H1">
            AND PRD1.DEST_RTL_WH_CD = #destRtlWhCd_H1#
        </isNotNull>
        <isNotNull property="destRtlSwhCd_H1">
            AND PRD1.DEST_RTL_SWH_CD = #destRtlSwhCd_H1#
        </isNotNull>
        <isNotNull property="rtlWhCd_H1">
            AND PRD1.SRC_RTL_WH_CD = #rtlWhCd_H1#
        </isNotNull>
        <isNotNull property="rtlSwhCd_H1">
            AND PRD1.SRC_RTL_SWH_CD = #rtlSwhCd_H1#
        </isNotNull>
        <!-- QC#21913 Modify -->
        <isNotNull property="proNum_H1">
            AND EXISTS(
                SELECT
                    1
                FROM
                    SHPG_ORD_PRO_NUM_LIST SOPNL
                WHERE
                    SOPNL.GLBL_CMPY_CD = PRD1.GLBL_CMPY_CD
                AND SOPNL.TRX_HDR_NUM  = PRD1.SO_NUM
                AND SOPNL.PRO_NUM      = #proNum_H1#
                AND SOPNL.EZCANCELFLAG = '0'
            )
        </isNotNull>
        <isNotNull property="shpgSvcLvlCd_SE">
            AND SO.SHPG_SVC_LVL_CD = #shpgSvcLvlCd_SE#
        </isNotNull>
        <isNotNull property="techNm_H1">
            AND UPPER(TM.TECH_NM) LIKE UPPER(#techNm_H1#)
        </isNotNull>
        <isNotNull property="dsAcctNm_H1">
            AND DAC.DS_ACCT_NM LIKE #dsAcctNm_H1#
        </isNotNull>
        <isNotNull property="prntVndNm_H1">
            AND PV.PRNT_VND_NM LIKE #prntVndNm_H1#
        </isNotNull>
        <isNotNull property="locNm_H1">
            AND VND.LOC_NM LIKE #locNm_H1#
        </isNotNull>
        <isNotNull property="carrNm_H1">
            AND OCV.CARR_NM LIKE #carrNm_H1#
        </isNotNull>
        
        <isNotNull property="xxChkBox_H1">
            AND PRD1.PRCH_REQ_NUM IS NOT NULL
            <!-- START 2021/10/05 R.Azucena [QC#59216, MOD] -->
            <!-- AND PRD1.PRCH_REQ_LINE_SUB_NUM &lt;&gt; 0 -->
            <isNotNull property="shipConfirmationCdArray">
                AND (
                  (PR1.PRCH_REQ_SRC_TP_CD NOT IN
                      <iterate property="shipConfirmationCdArray" var="shipConfirmationCdArray[]" open="(" close=")" conjunction=",">
                          #shipConfirmationCdArray[]#
                      </iterate>
                    AND PRD1.PRCH_REQ_LINE_SUB_NUM &lt;&gt; 0)
                  OR (PR1.PRCH_REQ_SRC_TP_CD IN
                      <iterate property="shipConfirmationCdArray" var="shipConfirmationCdArray[]" open="(" close=")" conjunction=",">
                          #shipConfirmationCdArray[]#
                      </iterate>
                    AND PRD1.PRCH_REQ_LINE_SUB_NUM = 0)
                )
            </isNotNull>
            <!-- END 2021/10/05 R.Azucena [QC#59216, MOD] -->
        </isNotNull>
        <isNotNull property="prchReqNum_H2">
            AND PR2.PRCH_REQ_NUM = #prchReqNum_H2#
        </isNotNull>
        
    ORDER BY
        PRD1.PRCH_REQ_NUM ASC
        ,PRD1.PRCH_REQ_LINE_NUM ASC
        ,PRD1.PRCH_REQ_LINE_SUB_NUM ASC
    ) R
    WHERE
        ROWNUM &lt;= #rowNum#
    <!-- Add Start 2020/03/17 QC#56104 -->
    <isNotNull property="soNum_H1">
        AND (R.SO_NUM = #soNum_H1# 
          OR R.ALT_SO_NUM = #soNum_H1#)
    </isNotNull>
    <!-- Add End 2020/03/17 QC#56104 -->
    </statement>

    <statement id="getProNum" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            SOPNL.PRO_NUM
        FROM
            SHPG_ORD_PRO_NUM_LIST SOPNL
        WHERE
            SOPNL.GLBL_CMPY_CD     = #glblCmpyCd#
        AND SOPNL.TRX_HDR_NUM      = #rwsRefNum#
        AND SOPNL.EZCANCELFLAG     = '0'
    </statement>
</sqlMap>
