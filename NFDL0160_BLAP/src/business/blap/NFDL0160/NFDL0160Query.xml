<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NFDL0160Query">

    <typeAlias alias="NFDL0160SMsg"    type="business.blap.NFDL0160.NFDL0160SMsg"/>
    <typeAlias alias="NFDL0160_ASMsg"  type="business.blap.NFDL0160.NFDL0160_ASMsg"/>

    <statement id="getCltPtfo" parameterClass="Map" resultMap="result.getCltPtfo">
        WITH DTL_DATA AS ( 
            SELECT
                  CLT.CLT_PTFO_PK
                , CLT.CLT_PTFO_CD
                , CLT.CLT_PTFO_NM
                , CLT.CLT_PTFO_DESC_TXT
                , CLT.CLT_PTFO_COR_NM
                , CLT.CLT_PSN_CD
                , CLT.CLT_PSN_NM
                , CLT.CLT_STMT_PHO_NUM
                , CLT.CLT_STMT_FAX_NUM
                , ART.AR_ADJ_TP_DESC_TXT
                , CLT.AR_ADJ_TP_CD
                , CLT.WRITE_OFF_APVL_LIMIT_AMT
                , CLT.CLT_CR_ANLST_EQUIP_PSN_CD
                , CLT.CLT_CR_ANLST_EQUIP_PSN_NM
                , CLT.CLT_CR_ANLST_SVC_PSN_CD
                , CLT.CLT_CR_ANLST_SVC_PSN_NM
                , CLT.CLT_CR_ANLST_SPLY_PSN_CD
                , CLT.CLT_CR_ANLST_SPLY_PSN_NM
                , CLT.REL_CLT_PTFO_PK
                ,( SELECT
                            C.CLT_PTFO_NM 
                    FROM
                            CLT_PTFO C 
                    WHERE
                            C.CLT_PTFO_PK     = CLT.REL_CLT_PTFO_PK 
                        AND C.EZCANCELFLAG    = '0' 
                        AND C.GLBL_CMPY_CD    = CLT.GLBL_CMPY_CD
                ) REL_CLT_PTFO_NM
                , CLT.CLT_PTFO_STS_FLG
                , CLT.EZUPTIME
                , CLT.EZUPTIMEZONE 
            FROM
                CLT_PTFO CLT
                , AR_ADJ_TP ART 
            WHERE
                    CLT.AR_ADJ_TP_CD    = ART.AR_ADJ_TP_CD(+) 
<!-- START 2018/08/03 T.Ogura [QC#25899,ADD] -->
                <isNotNull property="cltPtfoCd">
                AND CLT.CLT_PTFO_CD LIKE #cltPtfoCd# 
                </isNotNull>
<!-- END   2018/08/03 T.Ogura [QC#25899,ADD] -->
                <isNotNull property="cltPtfoNm">
                AND UPPER(CLT.CLT_PTFO_NM) LIKE #cltPtfoNm# 
                </isNotNull>
                 <isNotNull property="cltPsnNm">
                AND UPPER(CLT.CLT_PSN_NM)  LIKE #cltPsnNm# 
                 </isNotNull>
                 <isNotNull property="cltPtfoStsFlg">
                AND CLT.CLT_PTFO_STS_FLG = #cltPtfoStsFlg# 
                 </isNotNull>
                AND CLT.GLBL_CMPY_CD     = #glblCmpyCd# 
                AND CLT.GLBL_CMPY_CD     = ART.GLBL_CMPY_CD(+) 
                AND CLT.EZCANCELFLAG     = '0' 
                AND CLT.EZCANCELFLAG     = ART.EZCANCELFLAG(+)
            ORDER BY
                CLT.CLT_PTFO_NM
        ) 
        SELECT
              CLT_PTFO_PK
            , CLT_PTFO_CD
            , CLT_PTFO_NM
            , CLT_PTFO_DESC_TXT
            , CLT_PTFO_COR_NM
            , CLT_PSN_CD
            , CLT_PSN_NM
            , CLT_STMT_PHO_NUM
            , CLT_STMT_FAX_NUM
            , AR_ADJ_TP_DESC_TXT
            , AR_ADJ_TP_CD
            , WRITE_OFF_APVL_LIMIT_AMT
            , CLT_CR_ANLST_EQUIP_PSN_CD
            , CLT_CR_ANLST_EQUIP_PSN_NM
            , CLT_CR_ANLST_SVC_PSN_CD
            , CLT_CR_ANLST_SVC_PSN_NM
            , CLT_CR_ANLST_SPLY_PSN_CD
            , CLT_CR_ANLST_SPLY_PSN_NM
            , REL_CLT_PTFO_PK
            , REL_CLT_PTFO_NM
            , CLT_PTFO_STS_FLG
            , EZUPTIME
            , EZUPTIMEZONE 
        FROM
            DTL_DATA 
        WHERE
            ROWNUM  &lt;=    #rowNum# 
    </statement>

    <resultMap id="result.getCltPtfo" class="NFDL0160_ASMsg">
        <result property="cltPtfoPk_A"              column="CLT_PTFO_PK"                   javaType="EZDSBigDecimalItem"/>
        <result property="cltPtfoCd_A"              column="CLT_PTFO_CD"                   javaType="EZDSStringItem"/>
        <result property="cltPtfoNm_A"              column="CLT_PTFO_NM"                   javaType="EZDSStringItem"/>
        <result property="cltPtfoDescTxt_A"         column="CLT_PTFO_DESC_TXT"             javaType="EZDSStringItem"/>
        <result property="cltPtfoCorNm_A"           column="CLT_PTFO_COR_NM"               javaType="EZDSStringItem"/>
        <result property="cltPsnCd_A"               column="CLT_PSN_CD"                    javaType="EZDSStringItem"/>
        <result property="cltPsnNm_A"               column="CLT_PSN_NM"                    javaType="EZDSStringItem"/>
        <result property="cltStmtPhoNum_A"          column="CLT_STMT_PHO_NUM"              javaType="EZDSStringItem"/>
        <result property="cltStmtFaxNum_A"          column="CLT_STMT_FAX_NUM"              javaType="EZDSStringItem"/>
        <result property="arAdjTpDescTxt_A"         column="AR_ADJ_TP_DESC_TXT"            javaType="EZDSStringItem"/>
        <result property="arAdjTpCd_A"              column="AR_ADJ_TP_CD"                  javaType="EZDSStringItem"/>
        <result property="cltCrAnlstEquipPsnCd_A"   column="CLT_CR_ANLST_EQUIP_PSN_CD"     javaType="EZDSStringItem"/>
        <result property="cltCrAnlstEquipPsnNm_A"   column="CLT_CR_ANLST_EQUIP_PSN_NM"     javaType="EZDSStringItem"/>
        <result property="cltCrAnlstSvcPsnCd_A"     column="CLT_CR_ANLST_SVC_PSN_CD"       javaType="EZDSStringItem"/>
        <result property="cltCrAnlstSvcPsnNm_A"     column="CLT_CR_ANLST_SVC_PSN_NM"       javaType="EZDSStringItem"/>
        <result property="cltCrAnlstSplyPsnCd_A"    column="CLT_CR_ANLST_SPLY_PSN_CD"      javaType="EZDSStringItem"/>
        <result property="cltCrAnlstSplyPsnNm_A"    column="CLT_CR_ANLST_SPLY_PSN_NM"      javaType="EZDSStringItem"/>
        <result property="relCltPtfoPk_A"           column="REL_CLT_PTFO_PK"               javaType="EZDSBigDecimalItem"/>
        <result property="cltPtfoNm_AR"             column="REL_CLT_PTFO_NM"               javaType="EZDSStringItem"/>
        <result property="cltPtfoNm_BK"             column="REL_CLT_PTFO_NM"               javaType="EZDSStringItem"/>
        <result property="cltPtfoStsFlg_A"          column="CLT_PTFO_STS_FLG"              javaType="EZDSStringItem"/>
        <result property="cltPtfoStsFlg_BK"         column="CLT_PTFO_STS_FLG"              javaType="EZDSStringItem"/>
        <result property="ezUpTime_A"               column="EZUPTIME"                      javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_A"           column="EZUPTIMEZONE"                  javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="chkCltPtfoNm" parameterClass="Map" resultClass="BigDecimal">
         SELECT
              CLT.CLT_PTFO_PK
         FROM
              CLT_PTFO CLT
         WHERE
             CLT.CLT_PTFO_NM     = #cltPtfoNm#
       <isNotNull property="cltPtfoPk">
         AND CLT.CLT_PTFO_PK     = #cltPtfoPk#
       </isNotNull>
         AND CLT.GLBL_CMPY_CD    = #glblCmpyCd#
         AND CLT.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getCountSellToCust" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS COUNT
        FROM
            SELL_TO_CUST A
        WHERE
                A.GLBL_CMPY_CD = #glblCmpyCd#
            AND A.CLT_PTFO_PK  = #cltPtfoPk#
            AND A.EZCANCELFLAG = '0'
    </statement>

    <statement id="getCountDsAcctPros" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS COUNT
        FROM
            DS_ACCT_PROS A
        WHERE
                A.GLBL_CMPY_CD = #glblCmpyCd#
            AND A.CLT_PTFO_PK  = #cltPtfoPk#
            AND A.EZCANCELFLAG = '0'
    </statement>

    <statement id="getCountBillToCust" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS COUNT
        FROM
            BILL_TO_CUST A
        WHERE
                A.GLBL_CMPY_CD = #glblCmpyCd#
            AND A.CLT_PTFO_PK  = #cltPtfoPk#
            AND A.EZCANCELFLAG = '0'
    </statement>

    <statement id="getCountCltPtfo" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*) AS COUNT
        FROM
            CLT_PTFO CP
        WHERE
                CP.GLBL_CMPY_CD     = #glblCmpyCd#
            AND CP.REL_CLT_PTFO_PK  = #relCltPtfoPk#
            <iterate property="pkList" var="pkList[]" open="AND CP.CLT_PTFO_PK NOT IN (" close=")" conjunction=",">
            #pkList[]#
            </iterate>
            AND CP.CLT_PTFO_STS_FLG = 'Y'
            AND CP.EZCANCELFLAG     = '0'
    </statement>

<!-- START 2018/08/03 T.Ogura [QC#25899,ADD] -->
    <statement id ="getCltPtfoNmInfo" parameterClass="Map"  resultClass="Map">
        SELECT
            CLT_PTFO_PK
           ,CLT_PTFO_NM
        FROM
            CLT_PTFO 
        WHERE
            GLBL_CMPY_CD = #glblCmpyCd#
        AND EZCANCELFLAG = '0'
    </statement>
<!-- END   2018/08/03 T.Ogura [QC#25899,ADD] -->
 </sqlMap>
