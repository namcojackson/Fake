<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL0350Query">

    <statement id="getDsContrDtlInfo" parameterClass="Map" resultClass="Map">
        SELECT
                DCD.EZUPTIME
               ,DCD.EZUPTIMEZONE
               ,DCD.GLBL_CMPY_CD
               ,DCD.DS_CONTR_PK
               ,DCD.DS_CONTR_DTL_PK
               ,DC.DS_CONTR_NUM
               ,SMM.SER_NUM
<!-- START 2022/10/12 T.Doi [QC#60007, ADD] -->
               ,DCD.SVC_MACH_MSTR_PK
               ,M.MDSE_DESC_SHORT_TXT
<!-- END 2022/10/12 T.Doi [QC#60007, ADD] -->
<!-- START 2015/12/07 [QC1537, MOD] -->
               ,DCV.DS_CONTR_CTRL_STS_CD
<!-- END 2015/12/07 [QC1537, MOD] -->
<!-- START 2017/09/08 U.Kim [QC#20071, ADD] -->
               ,DCD.DS_CONTR_DTL_TP_CD
<!-- END 2017/09/08 U.Kim [QC#20071, ADD] -->
        FROM
                DS_CONTR_DTL DCD
               ,DS_CONTR DC
               ,SVC_MACH_MSTR SMM
<!-- START 2015/12/07 [QC1537, ADD] -->
               ,DS_CONTR_DTL_STS_V DCV
<!-- END 2015/12/07 [QC1537, ADD] -->
<!-- START 2022/10/12 T.Doi [QC#60007, ADD] -->
               ,MDSE M
<!-- END 2022/10/12 T.Doi [QC#60007, ADD] -->
        WHERE
                DCD.GLBL_CMPY_CD         = #glblCmpyCd#
        AND     DCD.DS_CONTR_DTL_PK      = #dsContrDtlPk#
        AND     DCD.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD
        AND     DCD.DS_CONTR_PK          = DC.DS_CONTR_PK
        AND     DCD.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD(+)
        AND     DCD.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK(+)
        AND     DCD.EZCANCELFLAG         = '0'
        AND     DC.EZCANCELFLAG          = '0'
        AND     SMM.EZCANCELFLAG(+)      = '0'
<!-- START 2015/12/07 [QC1537, ADD] -->
        AND     DCD.GLBL_CMPY_CD         = DCV.GLBL_CMPY_CD
        AND     DCD.DS_CONTR_DTL_PK      = DCV.DS_CONTR_DTL_PK
        AND     DCV.EZCANCELFLAG         = '0'
<!-- END 2015/12/07 [QC1537, ADD] -->
<!-- START 2022/10/12 T.Doi [QC#60007, ADD] -->
        AND     DCD.GLBL_CMPY_CD         = M.GLBL_CMPY_CD(+)
        AND     DCD.SVC_PGM_MDSE_CD      = M.MDSE_CD(+)
        AND     M.EZCANCELFLAG(+)        = '0'
<!-- END 2022/10/12 T.Doi [QC#60007, ADD] -->
    </statement>

    <statement id="getBaseScheduleInfoList" parameterClass="Map" resultClass="Map">
    SELECT 
           * 
    FROM
    (
        SELECT
                DCBS.EZUPTIME
               ,DCBS.EZUPTIMEZONE
               ,DCBS.DS_CONTR_BLLG_SCHD_PK
               ,DCBS.DS_CONTR_BLLG_SCHD_SMRY_PK
               ,DCBS.DS_CONTR_BLLG_MTR_PK
               ,DCBS.DS_CONTR_BLLG_SCHD_SQ_NUM
               ,DCBS.DS_CONTR_BLLG_SCHD_LVL_NUM
<!-- START 2015/10/15 [N/A, ADD] -->
               ,DCBS.DS_CONTR_PRC_EFF_PK
               ,DCBS.DS_CONTR_PRC_EFF_SQ_NUM
<!-- END 2015/10/15 [N/A, ADD] -->
               ,DCBS.SKIP_RECOV_TP_CD
               ,DCBS.BLLG_SCHD_FROM_DT
               ,DCBS.BLLG_SCHD_THRU_DT
<!-- START 2016/11/08 [QC#15232, MOD] -->
<!-- START 2016/02/15 [QC2325, MOD] -->
               ,NVL(DCBS.RVS_SCHD_DT, DCBS.NEXT_BLLG_DT) AS INTF_DT
<!-- END 2016/02/15 [QC2325, MOD] -->
               ,DCBS.NEXT_BLLG_DT
               ,DCBS.RVS_SCHD_DT
<!-- END 2016/11/08 [QC#15819, MOD] -->
               ,DCBS.BASE_PRC_DEAL_AMT
               ,DCBS.MTR_ENTRY_CPLT_FLG
               ,DCBS.DS_BLLG_SCHD_STS_CD
<!-- START 2017/09/08 U.Kim [QC#20071, MOD] -->
<!--           ,DCBS.SVC_INV_NUM -->
<!--           ,DCBS.INV_DT -->
               ,CASE WHEN DCBS.INV_FLG = 'Y'
                       THEN NVL(DCBS.SVC_INV_NUM, INV.INV_NUM)
                       ELSE NULL
                END                             AS SVC_INV_NUM
               ,CASE WHEN DCBS.INV_FLG = 'Y'
                       THEN NVL(DCBS.INV_DT, INV.INV_DT)
                       ELSE NULL
                END                             AS INV_DT
<!-- END 2017/09/08 U.Kim [QC#20071, MOD] -->
<!-- mod start 2017/07/05 QC#18349 -->
               ,CASE WHEN DCBS.BASE_ACTL_PRC_DEAL_AMT IS NOT NULL AND DCBS.INV_TP_CD = #creditMemo#
                       THEN DCBS.BASE_ACTL_PRC_DEAL_AMT * -1
                       ELSE DCBS.BASE_ACTL_PRC_DEAL_AMT
                END                             AS ACTL_PRC_DEAL_AMT
               ,CASE WHEN DCBS.DEAL_TAX_AMT IS NOT NULL AND DCBS.INV_TP_CD = #creditMemo# 
                       THEN DCBS.DEAL_TAX_AMT * -1
                       ELSE DCBS.DEAL_TAX_AMT
                END                             AS DEAL_TAX_AMT
               ,DCBS.BLLBL_FLG
<!-- mod end 2017/07/05 QC#18349 -->
<!-- START 2016/02/15 [QC2325, DEL] -->
<!--           ,DCBS.RVS_SCHD_DT -->
<!-- END 2016/02/15 [QC2325, DEL] -->
<!-- START 2017/09/08 U.Kim [QC#20071, MOD] -->
<!--           ,DBSS.DS_BLLG_SCHD_STS_DESC_TXT -->
               ,CASE WHEN DCBS.INV_FLG = 'Y' AND DCBS.SVC_INV_NUM IS NULL AND INV.INV_NUM IS NOT NULL
                        THEN #billWithEq#
                        ELSE DBSS.DS_BLLG_SCHD_STS_DESC_TXT
                END AS DS_BLLG_SCHD_STS_DESC_TXT
<!-- END 2017/09/08 U.Kim [QC#20071, MOD] -->
<!-- START 2016/01/21 [QC#14204, ADD] -->
               ,DCBS.EZINTIME                   AS XX_REC_HIST_CRAT_TS
               ,DCBS.EZINUSERID                 AS XX_REC_HIST_CRAT_BY_NM
               ,DCBS.EZUPTIME                   AS XX_REC_HIST_UPD_TS
               ,DCBS.EZUPUSERID                 AS XX_REC_HIST_UPD_BY_NM
               ,DCBS.EZTABLEID                  AS XX_REC_HIST_TBL_NM
<!-- END 2016/11/30 [QC#14204, ADD] -->
<!-- START 2017/12/06 U.Kim [QC#23001, ADD] -->
               ,NVL(IPC.INV_FTP_RQST_NUM, IPC.INV_PRINT_RQST_NUM) EIP_RPT_RQST_PK
<!-- END 2017/12/06 U.Kim [QC#23001, ADD] -->
        FROM
                DS_CONTR_BLLG_SCHD DCBS
               ,DS_BLLG_SCHD_STS DBSS
<!-- START 2017/09/08 U.Kim [QC#20071, ADD] -->
               <isEqual property="aggLineFlg" compareValue="N">
               ,(SELECT
                         IL.DS_CONTR_DTL_PK
                        ,IV.INV_NUM
                        ,IV.INV_DT
                        ,ROW_NUMBER() OVER (PARTITION BY IL.DS_CONTR_DTL_PK ORDER BY IV.INV_DT DESC, IV.INV_NUM ASC) AS ROW_NUM
                 FROM
                         INV_LINE   IL
                        ,INV        IV
                 WHERE 
                         IL.GLBL_CMPY_CD          = #glblCmpyCd#
                 AND     IL.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                 AND     IL.GLBL_CMPY_CD          = IV.GLBL_CMPY_CD
                 AND     IL.INV_NUM               = IV.INV_NUM
                 AND     IV.INV_TP_CD             = #invTpCd#
                 AND     IV.SYS_SRC_CD            = #sysSrcCd#
                 AND     IV.EZCANCELFLAG          = '0'
                 AND     IL.EZCANCELFLAG          = '0'
                )INV
               </isEqual>
               <isEqual property="aggLineFlg" compareValue="Y">
               ,(SELECT
                         DCD.PRNT_DS_CONTR_DTL_PK AS DS_CONTR_DTL_PK
                        ,IV.INV_NUM
                        ,IV.INV_DT
                        ,ROW_NUMBER() OVER (ORDER BY IV.INV_DT DESC, IV.INV_NUM ASC) AS ROW_NUM
                 FROM
                         INV_LINE   IL
                        ,INV        IV
                        ,DS_CONTR_DTL DCD
                 WHERE 
                         IL.GLBL_CMPY_CD          = #glblCmpyCd#
                 AND     IL.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD
                 AND     IL.DS_CONTR_DTL_PK       = DCD.DS_CONTR_DTL_PK
                 AND     DCD.PRNT_DS_CONTR_DTL_PK = #dsContrDtlPk#
                 AND     DCD.EZCANCELFLAG = '0'
                 AND     IL.GLBL_CMPY_CD          = IV.GLBL_CMPY_CD
                 AND     IL.INV_NUM               = IV.INV_NUM
                 AND     IV.INV_TP_CD             = #invTpCd#
                 AND     IV.SYS_SRC_CD            = #sysSrcCd#
                 AND     IV.EZCANCELFLAG          = '0'
                 AND     IL.EZCANCELFLAG          = '0'
                )INV
               </isEqual>
<!-- END 2017/09/08 U.Kim [QC#20071, ADD] -->
<!-- START 2017/12/06 U.Kim [QC#23001, ADD] -->
               ,INV_PRT_CTRL IPC
<!-- END 2017/12/06 U.Kim [QC#23001, ADD] -->
        WHERE
                DCBS.GLBL_CMPY_CD                = #glblCmpyCd#
        AND     DCBS.DS_CONTR_DTL_PK             = #dsContrDtlPk#
<!-- START 2015/10/15 [N/A, ADD] -->
<!-- START 2017/07/28 [QC#20171, DEL] -->
<!--    AND     DCBS.DS_CONTR_PRC_EFF_PK         = #dsContrPrcEffPk# -->
<!-- START 2017/07/28 [QC#20171, DEL] -->
<!-- END 2015/10/15 [N/A, ADD] -->
        AND     DCBS.BASE_CHRG_FLG               = 'Y'
<!-- START 2017/08/07 K.Kitachi [QC#20048, ADD] -->
        <isNotNull property="bllgSchdFromDt">
        AND     DCBS.BLLG_SCHD_FROM_DT       &gt;= #bllgSchdFromDt#
        </isNotNull>
        <isNotNull property="bllgSchdThruDt">
        AND     DCBS.BLLG_SCHD_THRU_DT       &lt;= #bllgSchdThruDt#
        </isNotNull>
        <isNotNull property="dsBllgSchdStsCd">
        AND     DCBS.DS_BLLG_SCHD_STS_CD         = #dsBllgSchdStsCd#
        </isNotNull>
        <isNotNull property="skipRecovTpCd">
        AND     DCBS.SKIP_RECOV_TP_CD            = #skipRecovTpCd#
        </isNotNull>
<!-- END 2017/08/07 K.Kitachi [QC#20048, ADD] -->

        AND     DCBS.GLBL_CMPY_CD                = DBSS.GLBL_CMPY_CD
        AND     DCBS.DS_BLLG_SCHD_STS_CD         = DBSS.DS_BLLG_SCHD_STS_CD

        AND     DCBS.EZCANCELFLAG                = '0'
        AND     DBSS.EZCANCELFLAG                = '0'
<!-- START 2017/09/08 U.Kim [QC#20071, ADD] -->
        AND     DCBS.DS_CONTR_DTL_PK             = INV.DS_CONTR_DTL_PK(+)
        AND     INV.ROW_NUM (+)                  = 1
<!-- END 2017/09/08 U.Kim [QC#20071, ADD] -->
<!-- START 2017/10/17 U.Kim [QC#21699, ADD] -->
        <isEqual property="xxChkBox" compareValue="Y">
        AND     DCBS.DS_BLLG_SCHD_TP_CD IN (#dsBllgSchdTpCdReg#, #dsBllgSchdTpCdRebil#)
                   AND     NOT EXISTS(SELECT
                                             1
                                      FROM
                                             SVC_CR_REBIL_DTL SCRD
                                      WHERE
                                             SCRD.GLBL_CMPY_CD      = DCBS.GLBL_CMPY_CD
                                      AND    SCRD.ORIG_SVC_INV_NUM  = DCBS.SVC_INV_NUM
                                      AND    SCRD.EZCANCELFLAG      = '0'
                                      )
        </isEqual>
<!-- END 2017/10/17 U.Kim [QC#21699, ADD] -->
<!-- START 2017/12/06 U.Kim [QC#23001, ADD] -->
        AND     DCBS.GLBL_CMPY_CD                  = IPC.GLBL_CMPY_CD(+)
        AND     NVL(DCBS.SVC_INV_NUM, INV.INV_NUM) = IPC.INV_NUM(+)
        AND     IPC.EZCANCELFLAG(+)                = '0'
<!-- END 2017/12/06 U.Kim [QC#23001, ADD] -->
        ORDER BY
<!-- START 2017/10/24 [QC#21815, MOD]
                LPAD(DCBS.DS_CONTR_PRC_EFF_SQ_NUM, 3, '0')
               ,LPAD(DCBS.DS_CONTR_BLLG_SCHD_LVL_NUM, 3, '0')
               ,DCBS.BLLG_SCHD_FROM_DT
               ,LPAD(DCBS.DS_CONTR_BLLG_SCHD_SQ_NUM, 3, '0')
    END 2017/10/24 [QC#21815, MOD] -->
                DCBS.BLLG_SCHD_FROM_DT
                ,SVC_CR_REBIL_PK NULLS FIRST
<!-- START 2017/09/14 K.Kojima [QC#20835, ADD] -->
               ,DCBS.DS_BLLG_SCHD_TP_CD
<!-- END 2017/09/14 K.Kojima [QC#20835, ADD] -->
    )
    WHERE
            ROWNUM                       &lt;= #rowNum#
    </statement>
    
    <statement id="getUsageScheduleInfoList" parameterClass="Map" resultClass="Map">
    SELECT 
<!-- START 2018/08/02 K.Kojima [QC#27487,ADD] -->
<!--       *  -->
         EZUPTIME
        ,EZUPTIMEZONE
        ,DS_CONTR_BLLG_SCHD_PK
        ,DS_CONTR_BLLG_SCHD_SMRY_PK
        ,DS_CONTR_BLLG_MTR_PK
        ,DS_CONTR_BLLG_SCHD_SQ_NUM
        ,DS_CONTR_BLLG_SCHD_LVL_NUM
        ,DS_CONTR_PRC_EFF_PK
        ,DS_CONTR_PRC_EFF_SQ_NUM
        ,SKIP_RECOV_TP_CD
        ,BLLG_SCHD_FROM_DT
        ,BLLG_SCHD_THRU_DT
        ,INTF_DT
        ,NEXT_BLLG_DT
        ,RVS_SCHD_DT
        ,BASE_PRC_DEAL_AMT
        ,MTR_ENTRY_CPLT_FLG
        ,DS_BLLG_SCHD_STS_CD
        ,SVC_INV_NUM
        ,INV_DT
        ,CASE WHEN MTR_CHRG_DEAL_AMT IS NOT NULL AND INV_TP_CD = #creditMemo#
              THEN MTR_CHRG_DEAL_AMT * -1
              ELSE MTR_CHRG_DEAL_AMT
         END                             AS ACTL_PRC_DEAL_AMT
        ,CASE WHEN DEAL_TAX_AMT IS NOT NULL AND INV_TP_CD = #creditMemo#
              THEN DEAL_TAX_AMT * -1
              ELSE DEAL_TAX_AMT
         END                             AS DEAL_TAX_AMT
        ,BLLBL_FLG
        ,DS_BLLG_SCHD_STS_DESC_TXT
        ,XX_REC_HIST_CRAT_TS
        ,XX_REC_HIST_CRAT_BY_NM
        ,XX_REC_HIST_UPD_TS
        ,XX_REC_HIST_UPD_BY_NM
        ,XX_REC_HIST_TBL_NM
        ,EIP_RPT_RQST_PK
<!-- END 2018/08/02 K.Kojima [QC#27487,ADD] -->
    FROM
    (
        SELECT
                DCBS.EZUPTIME
               ,DCBS.EZUPTIMEZONE
               ,DCBS.DS_CONTR_BLLG_SCHD_PK
               ,DCBS.DS_CONTR_BLLG_SCHD_SMRY_PK
               ,DCBS.DS_CONTR_BLLG_MTR_PK
               ,DCBS.DS_CONTR_BLLG_SCHD_SQ_NUM
               ,DCBS.DS_CONTR_BLLG_SCHD_LVL_NUM
<!-- START 2015/10/15 [N/A, ADD] -->
               ,DCBS.DS_CONTR_PRC_EFF_PK
               ,DCBS.DS_CONTR_PRC_EFF_SQ_NUM
<!-- END 2015/10/15 [N/A, ADD] -->
               ,DCBS.SKIP_RECOV_TP_CD
               ,DCBS.BLLG_SCHD_FROM_DT
               ,DCBS.BLLG_SCHD_THRU_DT
<!-- START 2016/11/08 [QC#15232, MOD] -->
<!-- START 2016/02/15 [QC2325, MOD] -->
               ,NVL(DCBS.RVS_SCHD_DT, DCBS.NEXT_BLLG_DT) AS INTF_DT
<!-- END 2016/02/15 [QC2325, MOD] -->
               ,DCBS.NEXT_BLLG_DT
               ,DCBS.RVS_SCHD_DT
<!-- END 2016/11/08 [QC#15819, MOD] -->
               ,DCBS.BASE_PRC_DEAL_AMT
               ,DCBS.MTR_ENTRY_CPLT_FLG
               ,DCBS.DS_BLLG_SCHD_STS_CD
               ,DCBS.SVC_INV_NUM
               ,DCBS.INV_DT
<!-- START 2016/01/21 [QC3309, MOD] -->
<!--           ,DCBS.BASE_ACTL_PRC_DEAL_AMT -->
<!-- START 2017/09/14 K.Kojima [QC#20835, MOD] -->
<!--            ,DCBS.MTR_CHRG_DEAL_AMT          AS ACTL_PRC_DEAL_AMT -->
<!-- START 2018/08/02 K.Kojima [QC#27487,MOD] -->
<!--           ,CASE WHEN DCBS.MTR_CHRG_DEAL_AMT IS NOT NULL AND DCBS.INV_TP_CD = #creditMemo# -->
<!--                   THEN DCBS.MTR_CHRG_DEAL_AMT * -1 -->
<!--                   ELSE DCBS.MTR_CHRG_DEAL_AMT -->
<!--            END                             AS ACTL_PRC_DEAL_AMT -->
               <isEqual property="aggLineFlg" compareValue="N">
               ,DCBS.MTR_CHRG_DEAL_AMT
               </isEqual>
               <isEqual property="aggLineFlg" compareValue="Y">
               ,(
                   SELECT
                       SUM(DCBSC.MTR_CHRG_DEAL_AMT)
                   FROM
                       DS_CONTR_BLLG_SCHD DCBSC
                   WHERE
                           DCBS.GLBL_CMPY_CD          = DCBSC.GLBL_CMPY_CD
                       AND DCBS.DS_CONTR_BLLG_SCHD_PK = DCBSC.PRNT_DS_CONTR_BLLG_SCHD_PK
                       AND DCBSC.MTR_CHRG_DEAL_AMT IS NOT NULL
                       AND DCBS.EZCANCELFLAG          = '0'
                ) AS MTR_CHRG_DEAL_AMT
               </isEqual>
<!-- END 2018/08/02 K.Kojima [QC#27487,MOD] -->
<!-- END 2017/09/14 K.Kojima [QC#20835, MOD] -->
<!-- END 2016/01/21 [QC3309, MOD] -->
<!-- START 2015/10/15 [N/A, ADD] -->
<!-- START 2017/09/14 K.Kojima [QC#20835, MOD] -->
<!--           ,DCBS.DEAL_TAX_AMT -->
<!-- START 2018/08/02 K.Kojima [QC#27487,MOD] -->
<!--           ,CASE WHEN DCBS.DEAL_TAX_AMT IS NOT NULL AND DCBS.INV_TP_CD = #creditMemo#  -->
<!--                   THEN DCBS.DEAL_TAX_AMT * -1 -->
<!--                   ELSE DCBS.DEAL_TAX_AMT -->
<!--            END                             AS DEAL_TAX_AMT -->
               <isEqual property="aggLineFlg" compareValue="N">
               ,DCBS.DEAL_TAX_AMT
               </isEqual>
               <isEqual property="aggLineFlg" compareValue="Y">
               ,(
                   SELECT
                       SUM(DCBSC.DEAL_TAX_AMT)
                   FROM
                       DS_CONTR_BLLG_SCHD DCBSC
                   WHERE
                           DCBS.GLBL_CMPY_CD          = DCBSC.GLBL_CMPY_CD
                       AND DCBS.DS_CONTR_BLLG_SCHD_PK = DCBSC.PRNT_DS_CONTR_BLLG_SCHD_PK
                       AND DCBSC.DEAL_TAX_AMT IS NOT NULL
                       AND DCBS.EZCANCELFLAG          = '0'
                ) AS DEAL_TAX_AMT
               </isEqual>
<!-- END 2018/08/02 K.Kojima [QC#27487,MOD] -->
<!-- END 2017/09/14 K.Kojima [QC#20835, MOD] -->
<!-- END 2015/10/15 [N/A, ADD] -->
               ,DCBS.BLLBL_FLG
<!-- START 2016/02/15 [QC2325, DEL] -->
<!--           ,DCBS.RVS_SCHD_DT -->
<!-- END 2016/02/15 [QC2325, DEL] -->
               ,DBSS.DS_BLLG_SCHD_STS_DESC_TXT
<!-- START 2016/01/21 [QC#14204, ADD] -->
               ,DCBS.EZINTIME                   AS XX_REC_HIST_CRAT_TS
               ,DCBS.EZINUSERID                 AS XX_REC_HIST_CRAT_BY_NM
               ,DCBS.EZUPTIME                   AS XX_REC_HIST_UPD_TS
               ,DCBS.EZUPUSERID                 AS XX_REC_HIST_UPD_BY_NM
               ,DCBS.EZTABLEID                  AS XX_REC_HIST_TBL_NM
<!-- END 2016/11/30 [QC#14204, ADD] -->
<!-- START 2017/12/06 U.Kim [QC#23001, ADD] -->
               ,NVL(IPC.INV_FTP_RQST_NUM, IPC.INV_PRINT_RQST_NUM) EIP_RPT_RQST_PK
<!-- END 2017/12/06 U.Kim [QC#23001, ADD] -->
<!-- START 2018/08/02 K.Kojima [QC#27487,ADD] -->
               ,DCBS.INV_TP_CD
<!-- END 2018/08/02 K.Kojima [QC#27487,ADD] -->
        FROM
                DS_CONTR_BLLG_SCHD DCBS
               ,DS_BLLG_SCHD_STS DBSS
<!-- START 2017/12/06 U.Kim [QC#23001, ADD] -->
               ,INV_PRT_CTRL IPC
<!-- END 2017/12/06 U.Kim [QC#23001, ADD] -->
        WHERE
                DCBS.GLBL_CMPY_CD                = #glblCmpyCd#
        AND     DCBS.DS_CONTR_DTL_PK             = #dsContrDtlPk#
<!-- START 2015/12/10 [QC1718, DEL] -->
<!--    AND     DCBS.DS_CONTR_PRC_EFF_PK         = #dsContrPrcEffPk#  -->
<!-- END 2015/12/10 [QC1718, DEL] -->
        AND     DCBS.DS_CONTR_BLLG_MTR_PK        = #dsContrBllgMtrPk#
        AND     DCBS.USG_CHRG_FLG                = 'Y'
<!-- START 2017/08/07 K.Kitachi [QC#20048, ADD] -->
        <isNotNull property="bllgSchdFromDt">
        AND     DCBS.BLLG_SCHD_FROM_DT       &gt;= #bllgSchdFromDt#
        </isNotNull>
        <isNotNull property="bllgSchdThruDt">
        AND     DCBS.BLLG_SCHD_THRU_DT       &lt;= #bllgSchdThruDt#
        </isNotNull>
        <isNotNull property="dsBllgSchdStsCd">
        AND     DCBS.DS_BLLG_SCHD_STS_CD         = #dsBllgSchdStsCd#
        </isNotNull>
        <isNotNull property="skipRecovTpCd">
        AND     DCBS.SKIP_RECOV_TP_CD            = #skipRecovTpCd#
        </isNotNull>
<!-- END 2017/08/07 K.Kitachi [QC#20048, ADD] -->

        AND     DCBS.GLBL_CMPY_CD                = DBSS.GLBL_CMPY_CD
        AND     DCBS.DS_BLLG_SCHD_STS_CD         = DBSS.DS_BLLG_SCHD_STS_CD

        AND     DCBS.EZCANCELFLAG                = '0'
        AND     DBSS.EZCANCELFLAG                = '0'
<!-- START 2017/10/17 U.Kim [QC#21699, ADD] -->
        <isEqual property="xxChkBox" compareValue="Y">
        AND     DCBS.DS_BLLG_SCHD_TP_CD IN (#dsBllgSchdTpCdReg#, #dsBllgSchdTpCdRebil#)
                   AND     NOT EXISTS(SELECT
                                             1
                                      FROM
                                             SVC_CR_REBIL_DTL SCRD
                                      WHERE
                                             SCRD.GLBL_CMPY_CD      = DCBS.GLBL_CMPY_CD
                                      AND    SCRD.ORIG_SVC_INV_NUM  = DCBS.SVC_INV_NUM
                                      AND    SCRD.EZCANCELFLAG      = '0'
                                      )
        </isEqual>
<!-- END 2017/10/17 U.Kim [QC#21699, ADD] -->
<!-- START 2017/12/06 U.Kim [QC#23001, ADD] -->
        AND     DCBS.GLBL_CMPY_CD   = IPC.GLBL_CMPY_CD(+)
        AND     DCBS.SVC_INV_NUM    = IPC.INV_NUM(+)
        AND     IPC.EZCANCELFLAG(+) = '0'
<!-- END 2017/12/06 U.Kim [QC#23001, ADD] -->
        ORDER BY
<!-- START 2017/10/24 [QC#21815, MOD]
                LPAD(DCBS.DS_CONTR_PRC_EFF_SQ_NUM, 3, '0')
               ,LPAD(DCBS.DS_CONTR_BLLG_SCHD_LVL_NUM, 3, '0')
               ,LPAD(DCBS.DS_CONTR_BLLG_SCHD_SQ_NUM, 3, '0')
    END 2017/10/24 [QC#21815, MOD] -->
                DCBS.BLLG_SCHD_FROM_DT
                ,SVC_CR_REBIL_PK NULLS FIRST
<!-- START 2017/09/14 K.Kojima [QC#20835, ADD] -->
               ,DCBS.DS_BLLG_SCHD_TP_CD
<!-- END 2017/09/14 K.Kojima [QC#20835, ADD] -->
    )
    WHERE
            ROWNUM                       &lt;= #rowNum#
    </statement>

    <statement id="getMtrInfoList" parameterClass="Map" resultClass="Map">
        SELECT
                DCBM.DS_CONTR_BLLG_MTR_PK
               ,DCBM.DS_CONTR_BLLG_MTR_ID
               ,DCBM.BLLG_MTR_LB_CD
               ,DCBM.BLLG_MTR_BILL_TO_CUST_CD
               ,DCBM.BLLG_MTR_BLLG_CYCLE_CD
               ,DCBM.XS_CHRG_TP_CD
               ,ML.MTR_LB_NM
        FROM
                DS_CONTR_BLLG_MTR DCBM
               ,MTR_LB ML
        WHERE
                DCBM.GLBL_CMPY_CD                = #glblCmpyCd#
        AND     DCBM.DS_CONTR_DTL_PK             = #dsContrDtlPk#
        AND     DCBM.GLBL_CMPY_CD                = ML.GLBL_CMPY_CD(+)
        AND     DCBM.BLLG_MTR_LB_CD              = ML.MTR_LB_CD(+)
        AND     DCBM.EZCANCELFLAG                = '0'
        AND     ML.EZCANCELFLAG(+)               = '0'
        ORDER BY
                LPAD(DCBM.DS_CONTR_BLLG_MTR_ID, 2, '0')
    </statement>
</sqlMap>
