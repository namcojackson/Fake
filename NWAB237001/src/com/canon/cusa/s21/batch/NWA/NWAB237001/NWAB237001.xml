<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NWAB237001">

    <!-- [Work Order] Component / Original Stock Out, Finished Stock In -->
    <statement id="getPartsOrdDataWrkOrd" parameterClass="Map" resultClass="Map">
        WITH SCUBE_MDSE_V AS (
            SELECT
                A1.MDSE_CD
               ,A1.SPLY_ITEM_NUM
               ,A1.GLBL_CMPY_CD
               ,CPV.P_CODE_VENDR   AS CUSA_VND_CD
            FROM
                ASL_DTL A1
               ,(SELECT
                      AD.GLBL_CMPY_CD
                     ,AD.ASL_DTL_PK
                     ,ROW_NUMBER() OVER (PARTITION BY AD.MDSE_CD ORDER BY NVL(AD.EFF_FROM_DT, #effFromDtDefalut#) DESC) IDX
                FROM
                    ASL_DTL AD
                   ,PRNT_CMPY_VND PV
                WHERE
                    AD.GLBL_CMPY_CD      = PV.GLBL_CMPY_CD
                AND PV.PRNT_CMPY_VND_CD  = AD.VND_CD
                <iterate property="vndSysTpCdList" var="vndSysTpCdList[]" open="AND PV.VND_SYS_TP_CD IN (" close=")" conjunction=",">
                    #vndSysTpCdList[]#
                </iterate>
                AND AD.EZCANCELFLAG      = '0'
                AND PV.EZCANCELFLAG      = '0'
                ) A2
                ,CSA_PRT_V     CPV
                ,DS_COND_CONST DCC
            WHERE
                A1.GLBL_CMPY_CD          = A2.GLBL_CMPY_CD
            AND A1.ASL_DTL_PK            = A2.ASL_DTL_PK
            <!-- QC#30964 Add SQL. -->
            <isNotNull property="exclMdseCdList">
                <iterate property="exclMdseCdList" var="exclMdseCdList[]" open="AND A1.MDSE_CD NOT IN (" close=")" conjunction=",">
                #exclMdseCdList[]#
                </iterate> 
            </isNotNull>
            AND A2.IDX                   = #IDX_1#
            AND CPV.P_PARTS_NUM          = NVL(A1.SPLY_ITEM_NUM, A1.MDSE_CD)
            AND CPV.P_CODE_VENDR         = DCC.DS_COND_CONST_VAL_TXT_01
            AND DCC.GLBL_CMPY_CD         = A1.GLBL_CMPY_CD
            AND DCC.DS_COND_CONST_GRP_ID = #dsCondConstGrpIdCusaVndCd#
            AND A1.EZCANCELFLAG          = '0'
            AND CPV.EZCANCELFLAG         = '0'
            AND DCC.EZCANCELFLAG         = '0'
        )
       ,WRK_ORD_DATA AS (
            <!-- Work Order / Component / Original Stock Out -->
            SELECT
                WO.GLBL_CMPY_CD
               ,WO.WRK_ORD_DT
               ,WOD.WRK_ORD_NUM
               ,WOD.WRK_ORD_DTL_LINE_NUM
               ,WOD.ORIG_GOODS_MDSE_CD         AS INTFC_PRT_MDSE_CD
                <!-- QC#31174 Un-Kit Support -->
               ,NVL(SP.SELL_TO_CUST_CD, WO.RCV_INVTY_LOC_CD)  AS SELL_TO_CUST_CD
               ,(CASE
                    WHEN WO.DS_WRK_ORD_TP_CD = #dsWrkOrdTpUnKit# THEN
                        NVL(WOD.ORIG_GOODS_ORD_QTY, 0) * -1
                    ELSE
                        NVL(WOD.ORIG_GOODS_ORD_QTY, 0)
                    END
                ) AS INTFC_ORD_QTY
               ,WO.RQST_RCV_DT
               ,(CASE
                    WHEN SP.REQ_SHPG_SVC_LVL_CD IS NULL THEN #trdPtnrShpgMethCdOther#
                    WHEN SP.REQ_SHPG_SVC_LVL_CD IS NOT NULL AND TPSXR.TRD_PTNR_SHPG_METH_CD IS NULL THEN #trdPtnrShpgMethCdOther#
                    ELSE TPSXR.TRD_PTNR_SHPG_METH_CD
                END) AS TRD_PTNR_SHPG_METH_CD
               ,'WO_STK_OUT'                   AS INTFC_CATG_TXT
               ,SMV.CUSA_VND_CD
               ,(SELECT
                      CASE
                        WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        ELSE (SELECT
                                   CGWC.CINC_GLBL_WH_CD
                              FROM
                                   CINC_GLBL_WH_CONV CGWC
                              WHERE
                                  CGWC.GLBL_CMPY_CD    = #glblCmpyCd#
                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                              AND CGWC.EZCANCELFLAG    = '0')
                        END AS CINC_GLBL_WH_CD_EN
                 FROM
                    (SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                    ) A
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) B
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) C
                ) AS CINC_GLBL_WH_CD
            FROM
                WRK_ORD             WO
               ,WRK_ORD_DTL         WOD
               ,DS_INVTY_LOC_V      DIL
               ,RTL_WH              RW
               ,INVTY_OWNR          IO
               ,MDSE                M
               ,SCUBE_MDSE_V        SMV
               ,SHPG_PLN            SP
               ,TRD_PTNR_SHPG_X_REF TPSXR
            WHERE
                WO.GLBL_CMPY_CD           = #glblCmpyCd#
            <iterate property="exclLocCdList" var="exclLocCdList[]" open="AND WO.INVTY_LOC_CD NOT IN (" close=")" conjunction=",">
                #exclLocCdList[]#
            </iterate> 
            AND WO.WRK_ORD_DT          &gt; #cpoOrdTs#
            AND WO.WRK_ORD_STS_CD NOT IN (#wrkOrdStsCdSaved#, #wrkOrdStsCdCancel#)
            <!--  DS_INVTY_LOC_V JOIN -->
            AND WO.GLBL_CMPY_CD           = DIL.GLBL_CMPY_CD
            AND WO.INVTY_LOC_CD           = DIL.RTL_WH_CD
            AND DIL.INVTY_LOC_TP_CD      != #technician#
            <!-- RTL_WH JOIN -->
            AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
            AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
            <!-- INVTY_OWNR JOIN -->
            AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
            AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
            AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
            <!-- WRK_ORD JOIN -->
            AND WO.CPLT_RTL_SWH_CD        = DIL.RTL_SWH_CD
            <!-- WRK_ORD_DTL JOIN -->
            AND WO.GLBL_CMPY_CD           = WOD.GLBL_CMPY_CD
            AND WO.WRK_ORD_NUM            = WOD.WRK_ORD_NUM
            <!-- MDSE JOIN -->
            AND WOD.GLBL_CMPY_CD          = M.GLBL_CMPY_CD
            AND WOD.ORIG_GOODS_MDSE_CD    = M.MDSE_CD
            <!-- SCUBE_MDSE_V JOIN -->
            AND M.GLBL_CMPY_CD            = SMV.GLBL_CMPY_CD
            AND M.MDSE_CD                 = SMV.MDSE_CD
            AND M.INVTY_CTRL_FLG          = 'Y'
            <!-- SHPG_PLN JOIN -->
            AND WOD.GLBL_CMPY_CD          = SP.GLBL_CMPY_CD (+)
            AND WOD.WRK_ORD_NUM           = SP.TRX_HDR_NUM (+)
            AND WOD.WRK_ORD_DTL_LINE_NUM  = SP.TRX_LINE_NUM (+)
            <!-- TRD_PTNR_SHPG_X_REF JOIN -->
            AND SP.GLBL_CMPY_CD           = TPSXR.GLBL_CMPY_CD (+)
            AND SP.REQ_SHPG_SVC_LVL_CD    = TPSXR.SHPG_SVC_LCL_CD (+)
            AND TPSXR.VND_CD (+)          = #scubeIfCincVndCd#
            AND TPSXR.CARR_CD (+)         = #carrCdAst#
            AND TPSXR.FRT_COND_CD (+)     = #frtCondCdAst#
            AND WO.EZCANCELFLAG           = '0'
            AND WOD.EZCANCELFLAG          = '0'
            AND DIL.EZCANCELFLAG          = '0'
            AND RW.EZCANCELFLAG           = '0'
            AND IO.EZCANCELFLAG           = '0'
            AND M.EZCANCELFLAG            = '0'
            AND SP.EZCANCELFLAG (+)       = '0'
            AND TPSXR.EZCANCELFLAG (+)    = '0'
            <!-- Add Start 2020/02/03 QC#55572 -->
            <isNotNull property="exclSwhCdList">
            AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                #exclSwhCdList[]#
                </iterate>
            </isNotNull>
            <!-- Add End 2020/02/03 QC#55572 -->
            <!-- Work Order / Finished Stock In -->
            UNION ALL
            SELECT
                WO.GLBL_CMPY_CD
               ,WO.WRK_ORD_DT
               ,WO.WRK_ORD_NUM
               ,''                            AS WRK_ORD_DTL_LINE_NUM
               ,WO.FNSH_GOODS_MDSE_CD         AS INTFC_PRT_MDSE_CD
               <!-- QC#31174 Update.VND_CD to  -->
               ,WO.RCV_INVTY_LOC_CD           AS SELL_TO_CUST_CD
               <!-- QC#31174 Un-Kit Support -->
               ,(CASE
                    WHEN WO.DS_WRK_ORD_TP_CD = #dsWrkOrdTpUnKit# THEN
                        NVL(WO.FNSH_GOODS_ORD_QTY, 0) * -1
                    ELSE
                        NVL(WO.FNSH_GOODS_ORD_QTY, 0)
                    END
                ) AS INTFC_ORD_QTY
               ,WO.RQST_RCV_DT
               ,#trdPtnrShpgMethCdOther#      AS TRD_PTNR_SHPG_METH_CD
               ,'WO_STK_IN'                   AS INTFC_CATG_TXT
               ,SMV.CUSA_VND_CD
               ,(SELECT
                      CASE
                        WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                 RW.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        ELSE (SELECT
                                  CGWC.CINC_GLBL_WH_CD
                              FROM
                                  CINC_GLBL_WH_CONV CGWC
                              WHERE
                                  CGWC.GLBL_CMPY_CD    = #glblCmpyCd#
                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                              AND CGWC.EZCANCELFLAG    = '0')
                        END AS CINC_GLBL_WH_CD_EN
                 FROM
                    (SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                    ) A
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) B
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) C
                ) AS CINC_GLBL_WH_CD
            FROM
                WRK_ORD             WO
               ,DS_INVTY_LOC_V      DIL
               ,RTL_WH              RW
               ,INVTY_OWNR          IO
               ,MDSE                M
               ,SCUBE_MDSE_V        SMV
            WHERE
                WO.GLBL_CMPY_CD           = #glblCmpyCd#
            <iterate property="exclLocCdList" var="exclLocCdList[]" open="AND WO.RCV_INVTY_LOC_CD NOT IN (" close=")" conjunction=",">
                #exclLocCdList[]#
            </iterate> 
            AND WO.WRK_ORD_DT          &gt; #cpoOrdTs#
            AND WO.WRK_ORD_STS_CD NOT IN (#wrkOrdStsCdSaved#, #wrkOrdStsCdCancel#)
            <!--  DS_INVTY_LOC_V JOIN -->
            AND WO.GLBL_CMPY_CD           = DIL.GLBL_CMPY_CD
            AND WO.RCV_INVTY_LOC_CD       = DIL.INVTY_LOC_CD
            AND DIL.INVTY_LOC_TP_CD      != #technician#
            <!--  RTL_WH JOIN -->
            AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
            AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
            <!--  INVTY_OWNR JOIN -->
            AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
            AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
            AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
            <!--  MDSE JOIN -->
            AND WO.GLBL_CMPY_CD           = M.GLBL_CMPY_CD
            AND WO.FNSH_GOODS_MDSE_CD     = M.MDSE_CD
            <!--  SCUBE_MDSE_V JOIN -->
            AND M.GLBL_CMPY_CD            = SMV.GLBL_CMPY_CD
            AND M.MDSE_CD                 = SMV.MDSE_CD
            AND M.INVTY_CTRL_FLG          = 'Y'
            <!--  EZCANCELFLAG -->
            AND WO.EZCANCELFLAG           = '0'
            AND DIL.EZCANCELFLAG          = '0'
            AND RW.EZCANCELFLAG           = '0'
            AND IO.EZCANCELFLAG           = '0'
            AND M.EZCANCELFLAG            = '0'
            <!-- Add Start 2020/02/03 QC#55572 -->
            <isNotNull property="exclSwhCdList">
            AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                #exclSwhCdList[]#
                </iterate>
            </isNotNull>
            <!-- Add End 2020/02/03 QC#55572 -->
        )
        SELECT
             WRK_ORD_DATA_GRP.WRK_ORD_DT            AS INTFC_CPO_ORD_DT
            ,WRK_ORD_DATA_GRP.WRK_ORD_NUM           AS INTFC_CPO_ORD_NUM
            ,WRK_ORD_DATA_GRP.INTFC_PRT_MDSE_CD
            ,WRK_ORD_DATA_GRP.TRD_PTNR_SHPG_METH_CD
            ,WRK_ORD_DATA_GRP.SELL_TO_CUST_CD       AS INTFC_SELL_TO_CUST_CD
            ,WRK_ORD_DATA_GRP.INTFC_ORD_QTY
            ,WRK_ORD_DATA_GRP.RQST_RCV_DT
            ,WRK_ORD_DATA_GRP.CUSA_VND_CD
            ,WRK_ORD_DATA_GRP.CINC_GLBL_WH_CD
            ,WRK_ORD_DATA_GRP.INTFC_CATG_TXT
        FROM
            (
            SELECT
                GLBL_CMPY_CD
               ,WRK_ORD_DT
               ,WRK_ORD_NUM
               ,INTFC_PRT_MDSE_CD
               ,TRD_PTNR_SHPG_METH_CD
               ,CUSA_VND_CD
               ,RQST_RCV_DT
               ,CINC_GLBL_WH_CD
               ,INTFC_CATG_TXT
               ,MAX(SELL_TO_CUST_CD)       AS SELL_TO_CUST_CD
               ,SUM(INTFC_ORD_QTY)         AS INTFC_ORD_QTY
            FROM
                WRK_ORD_DATA
            GROUP BY
                WRK_ORD_DATA.GLBL_CMPY_CD
               ,WRK_ORD_DATA.WRK_ORD_DT
               ,WRK_ORD_DATA.WRK_ORD_NUM
               ,WRK_ORD_DATA.INTFC_PRT_MDSE_CD
               ,WRK_ORD_DATA.TRD_PTNR_SHPG_METH_CD
               ,WRK_ORD_DATA.CUSA_VND_CD
               ,WRK_ORD_DATA.RQST_RCV_DT
               ,WRK_ORD_DATA.CINC_GLBL_WH_CD
               ,WRK_ORD_DATA.INTFC_CATG_TXT
            ) WRK_ORD_DATA_GRP
        <!-- QC#30961 Add where condition -->
        WHERE
            INTFC_ORD_QTY != 0
        ORDER BY
            WRK_ORD_DT
           ,WRK_ORD_NUM
           ,INTFC_PRT_MDSE_CD
    </statement>

    <!-- [Inventory Transaction] Parts Usage,Parts Usage Return -->
    <statement id="getPartsOrdDataInvtyTrx" parameterClass="Map" resultClass="Map">
            WITH SCUBE_MDSE_V AS
            (
                    SELECT
                        A1.MDSE_CD
                       ,A1.SPLY_ITEM_NUM
                       ,A1.GLBL_CMPY_CD
                       ,CPV.P_CODE_VENDR   AS CUSA_VND_CD
                    FROM
                        ASL_DTL A1
                        ,(SELECT
                              AD.GLBL_CMPY_CD
                             ,AD.ASL_DTL_PK
                             ,ROW_NUMBER() OVER (PARTITION BY AD.MDSE_CD ORDER BY NVL(AD.EFF_FROM_DT, #effFromDtDefalut#) DESC) IDX
                        FROM
                            ASL_DTL AD
                           ,PRNT_CMPY_VND PV
                        WHERE
                            AD.GLBL_CMPY_CD      = PV.GLBL_CMPY_CD
                        AND PV.PRNT_CMPY_VND_CD  = AD.VND_CD
                        <iterate property="vndSysTpCdList" var="vndSysTpCdList[]" open="AND PV.VND_SYS_TP_CD IN (" close=")" conjunction=",">
                            #vndSysTpCdList[]#
                        </iterate>
                        AND AD.EZCANCELFLAG      = '0'
                        AND PV.EZCANCELFLAG      = '0'
                        ) A2
                        ,CSA_PRT_V     CPV
                        ,DS_COND_CONST DCC
                    WHERE
                        A1.GLBL_CMPY_CD          = A2.GLBL_CMPY_CD
                    AND A1.ASL_DTL_PK            = A2.ASL_DTL_PK
                    <!-- QC#30964 Add SQL. -->
                    <isNotNull property="exclMdseCdList">
                        <iterate property="exclMdseCdList" var="exclMdseCdList[]" open="AND A1.MDSE_CD NOT IN (" close=")" conjunction=",">
                        #exclMdseCdList[]#
                        </iterate> 
                    </isNotNull>
                    AND A2.IDX                   = #IDX_1#
                    AND CPV.P_PARTS_NUM          = NVL(A1.SPLY_ITEM_NUM, A1.MDSE_CD)
                    AND CPV.P_CODE_VENDR         = DCC.DS_COND_CONST_VAL_TXT_01
                    AND DCC.GLBL_CMPY_CD         = A1.GLBL_CMPY_CD
                    AND DCC.DS_COND_CONST_GRP_ID = #dsCondConstGrpIdCusaVndCd#
                    AND A1.EZCANCELFLAG          = '0'
                    AND CPV.EZCANCELFLAG         = '0'
                    AND DCC.EZCANCELFLAG         = '0'
            ), PARTS_USAGE_ORD AS
            (
                SELECT
                    IT.GLBL_CMPY_CD
                   ,IT.INVTY_TRX_DT
                   ,IT.INVTY_TRX_SLP_NUM
                   ,IT.MDSE_CD
                   ,NVL(IT.INVTY_TRX_QTY, 0)     AS INVTY_TRX_QTY
                   ,IT.BILL_TO_CUST_CD
                   ,SMV.CUSA_VND_CD
                    ,(SELECT
                          CASE
                            WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                        CGWC.CINC_GLBL_WH_CD
                                                  FROM
                                                        CINC_GLBL_WH_CONV CGWC
                                                  WHERE
                                                      RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                                  AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                                                  AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                                  AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                                  AND CGWC.EZCANCELFLAG    = '0')
                            WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                        CGWC.CINC_GLBL_WH_CD
                                                  FROM
                                                        CINC_GLBL_WH_CONV CGWC
                                                  WHERE
                                                      RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                                  AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                                  AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                                  AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                                  AND CGWC.EZCANCELFLAG    = '0')
                            WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                        CGWC.CINC_GLBL_WH_CD
                                                  FROM
                                                        CINC_GLBL_WH_CONV CGWC
                                                  WHERE
                                                      RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                                  AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                                                  AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                                  AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                                  AND CGWC.EZCANCELFLAG    = '0')
                            ELSE (SELECT
                                       CGWC.CINC_GLBL_WH_CD
                                  FROM
                                       CINC_GLBL_WH_CONV CGWC
                                  WHERE CGWC.GLBL_CMPY_CD  = #glblCmpyCd#
                                  AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                  AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                  AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                  AND CGWC.EZCANCELFLAG    = '0')
                            END AS CINC_GLBL_WH_CD_EN
                     FROM
                        (SELECT
                             COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                         FROM
                             CINC_GLBL_WH_CONV CGWC
                         WHERE
                             RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                         AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                         AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                         AND CGWC.LOC_TP_CD       = #locTpCdAst#
                         AND ROWNUM               = #numOne#
                         AND CGWC.EZCANCELFLAG    = '0'
                        ) A
                       ,(SELECT
                             COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                         FROM
                             CINC_GLBL_WH_CONV CGWC
                         WHERE
                             RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                         AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                         AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                         AND CGWC.LOC_TP_CD       = #locTpCdAst#
                         AND ROWNUM               = #numOne#
                         AND CGWC.EZCANCELFLAG    = '0'
                       ) B
                       ,(SELECT
                             COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                         FROM
                             CINC_GLBL_WH_CONV CGWC
                         WHERE
                             RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                         AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                         AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                         AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                         AND ROWNUM               = #numOne#
                         AND CGWC.EZCANCELFLAG    = '0'
                       ) C
                    ) AS CINC_GLBL_WH_CD
                FROM
                    INVTY_TRX       IT
                   ,DS_INVTY_LOC_V  DIL
                   ,RTL_WH          RW
                   ,INVTY_OWNR      IO
                   ,SCUBE_MDSE_V    SMV
                WHERE
                    IT.GLBL_CMPY_CD           = #glblCmpyCd#
                AND IT.TRX_CD                 = #invtyTrxCdPrtsUsg#
                AND IT.TRX_RSN_CD             IN (#invtyTrxRsnCdPrtsUsg#, #invtyTrxRsnCdPrtsUsgRtrn#)
                AND IT.INVTY_TRX_DT        &gt; #cpoOrdTs#
                <iterate property="exclLocCdList" var="exclLocCdList[]" open="AND IT.INVTY_LOC_CD NOT IN (" close=")" conjunction=",">
                    #exclLocCdList[]#
                </iterate> 
                <!-- DS_INVTY_LOC_V JOIN -->
                AND IT.GLBL_CMPY_CD           = DIL.GLBL_CMPY_CD
                AND IT.INVTY_LOC_CD           = DIL.INVTY_LOC_CD
                AND DIL.INVTY_LOC_TP_CD       = #technician#
                <!-- RTL_WH JOIN -->
                AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
                AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
                <!-- INVTY_OWNR JOIN -->
                AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
                AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
                AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
                <!-- SCUBE_MDSE_V JOIN -->
                AND IT.GLBL_CMPY_CD           = SMV.GLBL_CMPY_CD
                AND IT.MDSE_CD                = SMV.MDSE_CD
                AND IT.EZCANCELFLAG           = '0'
                AND DIL.EZCANCELFLAG          = '0'
                AND RW.EZCANCELFLAG           = '0'
                AND IO.EZCANCELFLAG           = '0'
                <!-- Add Start 2020/02/03 QC#55572 -->
                <isNotNull property="exclSwhCdList">
                AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                    #exclSwhCdList[]#
                    </iterate>
                </isNotNull>
            <!-- Add End 2020/02/03 QC#55572 -->
            )
            SELECT
                 PARTS_USAGE_ORD_GRP.INVTY_TRX_DT        AS INTFC_CPO_ORD_DT
                ,PARTS_USAGE_ORD_GRP.INVTY_TRX_SLP_NUM   AS INTFC_CPO_ORD_NUM
                ,PARTS_USAGE_ORD_GRP.MDSE_CD             AS INTFC_PRT_MDSE_CD
                ,GC.GLBL_CMPY_CD                         AS CINC_SHIP_TO_GLBL_CMPY_CD
                ,GC.GLBL_CMPY_CD                         AS CINC_BILL_TO_GLBL_CMPY_CD
                ,ST.SELL_TO_CUST_CD                      AS INTFC_SELL_TO_CUST_CD
                ,PARTS_USAGE_ORD_GRP.CUSA_VND_CD         AS CUSA_VND_CD
                ,PARTS_USAGE_ORD_GRP.CINC_GLBL_WH_CD     AS CINC_GLBL_WH_CD
                ,PARTS_USAGE_ORD_GRP.INVTY_TRX_QTY       AS INTFC_ORD_QTY
                ,#trdPtnrShpgMethCdOther#                AS TRD_PTNR_SHPG_METH_CD
            FROM
                <!-- QC#30961 Update PARTS_USAGE_ORD_GRP -->
                (
                    SELECT
                        *
                    FROM
                        (
                            SELECT
                                GLBL_CMPY_CD
                               ,INVTY_TRX_DT
                               ,INVTY_TRX_SLP_NUM
                               ,MDSE_CD
                               ,CUSA_VND_CD
                               ,CINC_GLBL_WH_CD
                               ,SUM(INVTY_TRX_QTY)            AS INVTY_TRX_QTY
                            FROM
                                PARTS_USAGE_ORD
                            GROUP BY
                                PARTS_USAGE_ORD.GLBL_CMPY_CD
                               ,PARTS_USAGE_ORD.INVTY_TRX_DT
                               ,PARTS_USAGE_ORD.INVTY_TRX_SLP_NUM
                               ,PARTS_USAGE_ORD.MDSE_CD
                               ,PARTS_USAGE_ORD.CINC_GLBL_WH_CD
                               ,PARTS_USAGE_ORD.CUSA_VND_CD
                        ) A
                     WHERE
                          A.INVTY_TRX_QTY != 0
                ) PARTS_USAGE_ORD_GRP
                ,FSR            FS
                ,SHIP_TO_CUST   ST
                ,BILL_TO_CUST   BT
                ,GLBL_CMPY      GC
            WHERE
                PARTS_USAGE_ORD_GRP.GLBL_CMPY_CD      =    FS.GLBL_CMPY_CD (+)
            AND PARTS_USAGE_ORD_GRP.INVTY_TRX_SLP_NUM =    FS.FSR_NUM (+)
            AND FS.GLBL_CMPY_CD                       =    BT.GLBL_CMPY_CD (+)
            AND FS.BILL_TO_CUST_CD                    =    BT.BILL_TO_CUST_CD (+)
            AND BT.COA_AFFL_CD                        =    GC.COA_AFFL_CD (+)
            AND FS.GLBL_CMPY_CD                       =    ST.GLBL_CMPY_CD (+)
            AND FS.SHIP_TO_CUST_CD                    =    ST.SHIP_TO_CUST_CD (+)
            AND FS.EZCANCELFLAG (+)                   =    '0'
            AND ST.EZCANCELFLAG (+)                   =    '0'
            AND BT.EZCANCELFLAG (+)                   =    '0'
            AND GC.EZCANCELFLAG (+)                   =    '0'
    </statement>

    <!-- [Inventory Transaction] Parts Usage,Parts Usage Return (Reman) -->
    <statement id="getPartsOrdDataInvtyTrxRmn" parameterClass="Map" resultClass="Map">
            WITH SCUBE_MDSE_V AS
            (
                    SELECT
                        A1.MDSE_CD
                       ,A1.SPLY_ITEM_NUM
                       ,A1.GLBL_CMPY_CD
                       ,CPV.P_CODE_VENDR   AS CUSA_VND_CD
                    FROM
                        ASL_DTL A1
                        ,(SELECT
                              AD.GLBL_CMPY_CD
                             ,AD.ASL_DTL_PK
                             ,ROW_NUMBER() OVER (PARTITION BY AD.MDSE_CD ORDER BY NVL(AD.EFF_FROM_DT, #effFromDtDefalut#) DESC) IDX
                        FROM
                            ASL_DTL AD
                           ,PRNT_CMPY_VND PV
                        WHERE
                            AD.GLBL_CMPY_CD      = PV.GLBL_CMPY_CD
                        AND AD.EZCANCELFLAG      = '0'
                        AND PV.PRNT_CMPY_VND_CD  = AD.VND_CD
                        <iterate property="vndSysTpCdList" var="vndSysTpCdList[]" open="AND PV.VND_SYS_TP_CD IN (" close=")" conjunction=",">
                            #vndSysTpCdList[]#
                        </iterate>
                        AND PV.EZCANCELFLAG      = '0'
                        ) A2
                        ,CSA_PRT_V     CPV
                        ,DS_COND_CONST DCC
                    WHERE
                        A1.GLBL_CMPY_CD          = A2.GLBL_CMPY_CD
                    AND A1.ASL_DTL_PK            = A2.ASL_DTL_PK
                    <!-- QC#30964 Add SQL. -->
                    <isNotNull property="exclMdseCdList">
                        <iterate property="exclMdseCdList" var="exclMdseCdList[]" open="AND A1.MDSE_CD NOT IN (" close=")" conjunction=",">
                        #exclMdseCdList[]#
                        </iterate> 
                    </isNotNull>
                    AND A2.IDX                   = #IDX_1#
                    AND CPV.P_PARTS_NUM          = NVL(A1.SPLY_ITEM_NUM, A1.MDSE_CD)
                    AND CPV.P_CODE_VENDR         = DCC.DS_COND_CONST_VAL_TXT_01
                    AND DCC.GLBL_CMPY_CD         = A1.GLBL_CMPY_CD
                    AND DCC.DS_COND_CONST_GRP_ID = #dsCondConstGrpIdCusaVndCd#
                    AND A1.EZCANCELFLAG          = '0'
                    AND CPV.EZCANCELFLAG         = '0'
                    AND DCC.EZCANCELFLAG         = '0'
            ), PARTS_USAGE_REMAN_ORD AS
            (
                SELECT
                    IT.INVTY_TRX_DT
                   ,IT.INVTY_TRX_SLP_NUM
                   ,IT.MDSE_CD
                   ,IT.INVTY_TRX_QTY
                   ,SMV.CUSA_VND_CD
                   ,IT.GLBL_CMPY_CD
                   ,IT.SHIP_TO_CUST_CD
                   <!-- QC#31174 Add. -->
                   ,IT.INVTY_LOC_CD
                    ,(SELECT
                          CASE
                            WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                      CGWC.CINC_GLBL_WH_CD
                                                  FROM
                                                      CINC_GLBL_WH_CONV CGWC
                                                  WHERE
                                                      INVTY_LOC_CD_FROM.GLBL_CMPY_CD = CGWC.GLBL_CMPY_CD
                                                  AND INVTY_LOC_CD_FROM.RTL_WH_CD    = CGWC.RTL_WH_CD
                                                  AND CGWC.WH_OWNR_CD                = #whOwnrCdAst#
                                                  AND CGWC.LOC_TP_CD                 = #locTpCdAst#
                                                  AND CGWC.EZCANCELFLAG              = '0')
                            WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                      CGWC.CINC_GLBL_WH_CD
                                                  FROM
                                                      CINC_GLBL_WH_CONV CGWC
                                                  WHERE
                                                      INVTY_LOC_CD_FROM.GLBL_CMPY_CD = CGWC.GLBL_CMPY_CD
                                                  AND INVTY_LOC_CD_FROM.WH_OWNR_CD   = CGWC.WH_OWNR_CD
                                                  AND CGWC.RTL_WH_CD                 = #rtlWhCdAst#
                                                  AND CGWC.LOC_TP_CD                 = #locTpCdAst#
                                                  AND CGWC.EZCANCELFLAG              = '0')
                            WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                      CGWC.CINC_GLBL_WH_CD
                                                  FROM
                                                      CINC_GLBL_WH_CONV CGWC
                                                  WHERE
                                                      INVTY_LOC_CD_FROM.GLBL_CMPY_CD     = CGWC.GLBL_CMPY_CD
                                                  AND INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD  = CGWC.LOC_TP_CD
                                                  AND CGWC.RTL_WH_CD                     = #rtlWhCdAst#
                                                  AND CGWC.WH_OWNR_CD                    = #whOwnrCdAst#
                                                  AND CGWC.EZCANCELFLAG                  = '0')
                            ELSE (SELECT
                                      CGWC.CINC_GLBL_WH_CD
                                  FROM
                                      CINC_GLBL_WH_CONV CGWC
                                  WHERE
                                      CGWC.GLBL_CMPY_CD    = #glblCmpyCd#
                                  AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                  AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                  AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                  AND CGWC.EZCANCELFLAG    = '0')
                            END AS CINC_GLBL_WH_CD_EN
                     FROM
                        (SELECT
                             COUNT(CGWC.CINC_GLBL_WH_CD) CNT_A
                         FROM
                             CINC_GLBL_WH_CONV CGWC
                         WHERE
                             INVTY_LOC_CD_FROM.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                         AND INVTY_LOC_CD_FROM.RTL_WH_CD         = CGWC.RTL_WH_CD
                         AND CGWC.WH_OWNR_CD                     = #whOwnrCdAst#
                         AND CGWC.LOC_TP_CD                      = #locTpCdAst#
                         AND ROWNUM                              = #numOne#
                         AND CGWC.EZCANCELFLAG                   = '0'
                        ) A
                       ,(SELECT
                             COUNT(CGWC.CINC_GLBL_WH_CD) CNT_B
                         FROM
                             CINC_GLBL_WH_CONV CGWC
                         WHERE
                             INVTY_LOC_CD_FROM.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                         AND INVTY_LOC_CD_FROM.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                         AND CGWC.RTL_WH_CD                      = #rtlWhCdAst#
                         AND CGWC.LOC_TP_CD                      = #locTpCdAst#
                         AND ROWNUM                              = #numOne#
                         AND CGWC.EZCANCELFLAG                   = '0'
                       ) B
                       ,(SELECT
                             COUNT(CGWC.CINC_GLBL_WH_CD) CNT_C
                         FROM
                             CINC_GLBL_WH_CONV CGWC
                         WHERE
                             INVTY_LOC_CD_FROM.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                         AND INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD   = CGWC.LOC_TP_CD
                         AND CGWC.RTL_WH_CD                      = #rtlWhCdAst#
                         AND CGWC.WH_OWNR_CD                     = #whOwnrCdAst#
                         AND ROWNUM                              = #numOne#
                         AND CGWC.EZCANCELFLAG                   = '0'
                       ) C
                    ) AS CINC_GLBL_WH_CD
                    ,(SELECT
                          CASE
                            WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                      CGWC.CINC_GLBL_WH_CD
                                                  FROM
                                                      CINC_GLBL_WH_CONV CGWC
                                                  WHERE
                                                      INVTY_LOC_CD_TO.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                                  AND INVTY_LOC_CD_TO.RTL_WH_CD       = CGWC.RTL_WH_CD
                                                  AND CGWC.WH_OWNR_CD                 = #whOwnrCdAst#
                                                  AND CGWC.LOC_TP_CD                  = #locTpCdAst#
                                                  AND CGWC.EZCANCELFLAG               = '0')
                            WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                        CGWC.CINC_GLBL_WH_CD
                                                  FROM
                                                        CINC_GLBL_WH_CONV CGWC
                                                  WHERE
                                                      INVTY_LOC_CD_TO.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                                  AND INVTY_LOC_CD_TO.WH_OWNR_CD      = CGWC.WH_OWNR_CD
                                                  AND CGWC.RTL_WH_CD                  = #rtlWhCdAst#
                                                  AND CGWC.LOC_TP_CD                  = #locTpCdAst#
                                                  AND CGWC.EZCANCELFLAG               = '0')
                            WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                        CGWC.CINC_GLBL_WH_CD
                                                  FROM
                                                        CINC_GLBL_WH_CONV CGWC
                                                  WHERE
                                                      INVTY_LOC_CD_TO.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                                  AND INVTY_LOC_CD_TO.INVTY_LOC_TP_CD = CGWC.LOC_TP_CD
                                                  AND CGWC.RTL_WH_CD                  = #rtlWhCdAst#
                                                  AND CGWC.WH_OWNR_CD                 = #whOwnrCdAst#
                                                  AND CGWC.EZCANCELFLAG               = '0')
                            ELSE (SELECT
                                      CGWC.CINC_GLBL_WH_CD
                                  FROM
                                      CINC_GLBL_WH_CONV CGWC
                                  WHERE
                                      CGWC.GLBL_CMPY_CD    = #glblCmpyCd#
                                  AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                  AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                  AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                  AND CGWC.EZCANCELFLAG    = '0')
                            END AS CINC_GLBL_WH_CD_EN
                     FROM
                        (SELECT
                             COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                         FROM
                             CINC_GLBL_WH_CONV CGWC
                         WHERE
                             INVTY_LOC_CD_TO.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                         AND INVTY_LOC_CD_TO.RTL_WH_CD         = CGWC.RTL_WH_CD
                         AND CGWC.WH_OWNR_CD                   = #whOwnrCdAst#
                         AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                         AND ROWNUM                            = #numOne#
                         AND CGWC.EZCANCELFLAG                 = '0'
                        ) A
                       ,(SELECT
                             COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                         FROM
                             CINC_GLBL_WH_CONV CGWC
                         WHERE
                             INVTY_LOC_CD_TO.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                         AND INVTY_LOC_CD_TO.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                         AND CGWC.RTL_WH_CD                    = #rtlWhCdAst#
                         AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                         AND ROWNUM                            = #numOne#
                         AND CGWC.EZCANCELFLAG                 = '0'
                       ) B
                       ,(SELECT
                             COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                         FROM
                             CINC_GLBL_WH_CONV CGWC
                         WHERE
                             INVTY_LOC_CD_TO.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                         AND INVTY_LOC_CD_TO.INVTY_LOC_TP_CD   = CGWC.LOC_TP_CD
                         AND CGWC.RTL_WH_CD                    = #rtlWhCdAst#
                         AND CGWC.WH_OWNR_CD                   = #whOwnrCdAst#
                         AND ROWNUM                            = #numOne#
                         AND CGWC.EZCANCELFLAG                 = '0'
                       ) C
                    ) AS CINC_RCV_GLBL_WH_CD
                    ,(SELECT
                        CASE
                            WHEN A1.CNT_A1 &gt; 0 THEN (SELECT
                                                         WTCCC.CINC_GLBL_CMPY_CATG_CD
                                                     FROM
                                                         WH_TRNSF_CINC_CATG_CONV WTCCC
                                                     WHERE
                                                         INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                         AND WTCCC.FROM_RTL_WH_CD       = INVTY_LOC_CD_FROM.RTL_WH_CD
                                                         AND WTCCC.FROM_WH_OWNR_CD      = #fromWhOwnrCdAst#
                                                         AND WTCCC.FROM_LOC_TP_CD       = #fromLocTpCdAst#
                                                         AND WTCCC.TO_RTL_WH_CD         = INVTY_LOC_CD_TO.RTL_WH_CD
                                                         AND WTCCC.TO_WH_OWNR_CD        = #toWhOwnrCdAst#
                                                         AND WTCCC.TO_LOC_TP_CD         = #toLocTpCdAst#
                                                         AND WTCCC.EZCANCELFLAG         = '0')
                            WHEN A2.CNT_A2 &gt; 0 THEN (SELECT
                                                         WTCCC.CINC_GLBL_CMPY_CATG_CD
                                                     FROM
                                                         WH_TRNSF_CINC_CATG_CONV WTCCC
                                                     WHERE
                                                         INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                         AND WTCCC.FROM_RTL_WH_CD       = INVTY_LOC_CD_FROM.RTL_WH_CD
                                                         AND WTCCC.FROM_WH_OWNR_CD      = #fromWhOwnrCdAst#
                                                         AND WTCCC.FROM_LOC_TP_CD       = #fromLocTpCdAst#
                                                         AND WTCCC.TO_WH_OWNR_CD        = INVTY_LOC_CD_TO.WH_OWNR_CD
                                                         AND WTCCC.TO_RTL_WH_CD         = #toRtlWhCdAst#
                                                         AND WTCCC.TO_LOC_TP_CD         = #toLocTpCdAst#
                                                         AND WTCCC.EZCANCELFLAG         = '0')
                            WHEN A3.CNT_A3 &gt; 0 THEN (SELECT
                                                         WTCCC.CINC_GLBL_CMPY_CATG_CD
                                                     FROM
                                                         WH_TRNSF_CINC_CATG_CONV WTCCC
                                                     WHERE
                                                         INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                         AND WTCCC.FROM_RTL_WH_CD       = INVTY_LOC_CD_FROM.RTL_WH_CD
                                                         AND WTCCC.FROM_WH_OWNR_CD      = #fromWhOwnrCdAst#
                                                         AND WTCCC.FROM_LOC_TP_CD       = #fromLocTpCdAst#
                                                         AND WTCCC.TO_LOC_TP_CD         = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                                         AND WTCCC.TO_RTL_WH_CD         = #toRtlWhCdAst#
                                                         AND WTCCC.TO_WH_OWNR_CD        = #toWhOwnrCdAst#
                                                         AND WTCCC.EZCANCELFLAG         = '0')
                            WHEN B1.CNT_B1 &gt; 0 THEN (SELECT
                                                         WTCCC.CINC_GLBL_CMPY_CATG_CD
                                                     FROM
                                                         WH_TRNSF_CINC_CATG_CONV WTCCC
                                                     WHERE
                                                         INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                         AND WTCCC.FROM_RTL_WH_CD       = #fromRtlWhCdAst#
                                                         AND WTCCC.FROM_WH_OWNR_CD      = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                                         AND WTCCC.FROM_LOC_TP_CD       = #fromLocTpCdAst#
                                                         AND WTCCC.TO_RTL_WH_CD         = INVTY_LOC_CD_TO.RTL_WH_CD
                                                         AND WTCCC.TO_WH_OWNR_CD        = #toWhOwnrCdAst#
                                                         AND WTCCC.TO_LOC_TP_CD         = #toLocTpCdAst#
                                                         AND WTCCC.EZCANCELFLAG         = '0')
                            WHEN B2.CNT_B2 &gt; 0 THEN (SELECT
                                                         WTCCC.CINC_GLBL_CMPY_CATG_CD
                                                     FROM
                                                         WH_TRNSF_CINC_CATG_CONV WTCCC
                                                     WHERE
                                                         INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                         AND WTCCC.FROM_RTL_WH_CD       = #fromRtlWhCdAst#
                                                         AND WTCCC.FROM_WH_OWNR_CD      = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                                         AND WTCCC.FROM_LOC_TP_CD       = #fromLocTpCdAst#
                                                         AND WTCCC.TO_RTL_WH_CD         = #toRtlWhCdAst#
                                                         AND WTCCC.TO_WH_OWNR_CD        = INVTY_LOC_CD_TO.WH_OWNR_CD
                                                         AND WTCCC.TO_LOC_TP_CD         = #toLocTpCdAst#
                                                         AND WTCCC.EZCANCELFLAG         = '0')
                            WHEN B3.CNT_B3 &gt; 0 THEN (SELECT
                                                         WTCCC.CINC_GLBL_CMPY_CATG_CD
                                                     FROM
                                                         WH_TRNSF_CINC_CATG_CONV WTCCC
                                                     WHERE
                                                         INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                         AND WTCCC.FROM_RTL_WH_CD       = #fromRtlWhCdAst#
                                                         AND WTCCC.FROM_WH_OWNR_CD      = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                                         AND WTCCC.FROM_LOC_TP_CD       = #fromLocTpCdAst#
                                                         AND WTCCC.TO_RTL_WH_CD         = #toRtlWhCdAst#
                                                         AND WTCCC.TO_WH_OWNR_CD        = #toWhOwnrCdAst#
                                                         AND WTCCC.TO_LOC_TP_CD         = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                                         AND WTCCC.EZCANCELFLAG         = '0') 
                            WHEN C1.CNT_C1 &gt; 0 THEN (SELECT
                                                         WTCCC.CINC_GLBL_CMPY_CATG_CD
                                                     FROM
                                                         WH_TRNSF_CINC_CATG_CONV WTCCC
                                                     WHERE
                                                         INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                         AND WTCCC.FROM_RTL_WH_CD       = #fromRtlWhCdAst#
                                                         AND WTCCC.FROM_WH_OWNR_CD      = #fromWhOwnrCdAst#
                                                         AND WTCCC.FROM_LOC_TP_CD       = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                                         AND WTCCC.TO_RTL_WH_CD         = INVTY_LOC_CD_TO.RTL_WH_CD
                                                         AND WTCCC.TO_WH_OWNR_CD        = #toWhOwnrCdAst#
                                                         AND WTCCC.TO_LOC_TP_CD         = #toLocTpCdAst#
                                                         AND WTCCC.EZCANCELFLAG         = '0')
                            WHEN C2.CNT_C2 &gt; 0 THEN (SELECT
                                                          WTCCC.CINC_GLBL_CMPY_CATG_CD
                                                     FROM
                                                          WH_TRNSF_CINC_CATG_CONV WTCCC
                                                     WHERE
                                                         INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                         AND WTCCC.FROM_RTL_WH_CD       = #fromRtlWhCdAst#
                                                         AND WTCCC.FROM_WH_OWNR_CD      = #fromWhOwnrCdAst#
                                                         AND WTCCC.FROM_LOC_TP_CD       = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                                         AND WTCCC.TO_RTL_WH_CD         = #toRtlWhCdAst#
                                                         AND WTCCC.TO_WH_OWNR_CD        = INVTY_LOC_CD_TO.WH_OWNR_CD
                                                         AND WTCCC.TO_LOC_TP_CD         = #toLocTpCdAst#
                                                         AND WTCCC.EZCANCELFLAG         = '0')
                            WHEN C3.CNT_C3 &gt; 0 THEN (SELECT
                                                         WTCCC.CINC_GLBL_CMPY_CATG_CD
                                                     FROM
                                                         WH_TRNSF_CINC_CATG_CONV WTCCC
                                                     WHERE
                                                         INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                         AND WTCCC.FROM_RTL_WH_CD       = #fromRtlWhCdAst#
                                                         AND WTCCC.FROM_WH_OWNR_CD      = #fromWhOwnrCdAst#
                                                         AND WTCCC.FROM_LOC_TP_CD       = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                                         AND WTCCC.TO_RTL_WH_CD         = #toRtlWhCdAst#
                                                         AND WTCCC.TO_WH_OWNR_CD        = #toWhOwnrCdAst#
                                                         AND WTCCC.TO_LOC_TP_CD         = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                                         AND WTCCC.EZCANCELFLAG         = '0')
                            ELSE (SELECT
                                      WTCCC.CINC_GLBL_CMPY_CATG_CD
                                  FROM
                                      WH_TRNSF_CINC_CATG_CONV WTCCC
                                  WHERE
                                      INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                      AND WTCCC.FROM_RTL_WH_CD       = #fromRtlWhCdAst#
                                      AND WTCCC.FROM_WH_OWNR_CD      = #fromWhOwnrCdAst#
                                      AND WTCCC.FROM_LOC_TP_CD       = #fromLocTpCdAst#
                                      AND WTCCC.TO_RTL_WH_CD         = #toRtlWhCdAst#
                                      AND WTCCC.TO_WH_OWNR_CD        = #toWhOwnrCdAst#
                                      AND WTCCC.TO_LOC_TP_CD         = #toLocTpCdAst#
                                      AND WTCCC.EZCANCELFLAG         = '0')
                            END AS CINC_GLBL_CMPY_CATG_CD
                    FROM
                        (SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_A1
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                            AND WTCCC.FROM_RTL_WH_CD       = INVTY_LOC_CD_FROM.RTL_WH_CD
                            AND WTCCC.FROM_WH_OWNR_CD      = #fromWhOwnrCdAst#
                            AND WTCCC.FROM_LOC_TP_CD       = #fromLocTpCdAst#
                            AND WTCCC.TO_RTL_WH_CD         = INVTY_LOC_CD_TO.RTL_WH_CD
                            AND WTCCC.TO_WH_OWNR_CD        = #toWhOwnrCdAst#
                            AND WTCCC.TO_LOC_TP_CD         = #toLocTpCdAst#
                            AND ROWNUM                     = #numOne#
                            AND WTCCC.EZCANCELFLAG         = '0'
                        ) A1
                        ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_A2
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                            AND WTCCC.FROM_RTL_WH_CD       = INVTY_LOC_CD_FROM.RTL_WH_CD
                            AND WTCCC.FROM_WH_OWNR_CD      = #fromWhOwnrCdAst#
                            AND WTCCC.FROM_LOC_TP_CD       = #fromLocTpCdAst#
                            AND WTCCC.TO_WH_OWNR_CD        = INVTY_LOC_CD_TO.WH_OWNR_CD
                            AND WTCCC.TO_RTL_WH_CD         = #toRtlWhCdAst#
                            AND WTCCC.TO_LOC_TP_CD         = #toLocTpCdAst#
                            AND ROWNUM                     = #numOne#
                            AND WTCCC.EZCANCELFLAG         = '0'
                        ) A2
                        ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_A3
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                          INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                          AND WTCCC.FROM_RTL_WH_CD       = INVTY_LOC_CD_FROM.RTL_WH_CD
                          AND WTCCC.FROM_WH_OWNR_CD      = #fromWhOwnrCdAst#
                          AND WTCCC.FROM_LOC_TP_CD       = #fromLocTpCdAst#
                          AND WTCCC.TO_LOC_TP_CD         = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                          AND WTCCC.TO_RTL_WH_CD         = #toRtlWhCdAst#
                          AND WTCCC.TO_WH_OWNR_CD        = #toLocTpCdAst#
                          AND ROWNUM                     = #numOne#
                          AND WTCCC.EZCANCELFLAG         = '0'
                        ) A3
                       ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_B1
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                            AND WTCCC.FROM_RTL_WH_CD       = #fromRtlWhCdAst#
                            AND WTCCC.FROM_WH_OWNR_CD      = INVTY_LOC_CD_FROM.WH_OWNR_CD
                            AND WTCCC.FROM_LOC_TP_CD       = #fromLocTpCdAst#
                            AND WTCCC.TO_RTL_WH_CD         = INVTY_LOC_CD_TO.RTL_WH_CD
                            AND WTCCC.TO_WH_OWNR_CD        = #toWhOwnrCdAst#
                            AND WTCCC.TO_LOC_TP_CD         = #toLocTpCdAst#
                            AND ROWNUM                     = #numOne#
                            AND WTCCC.EZCANCELFLAG         = '0'
                        ) B1
                        ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_B2
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                            AND WTCCC.FROM_RTL_WH_CD       = #fromRtlWhCdAst#
                            AND WTCCC.FROM_WH_OWNR_CD      = INVTY_LOC_CD_FROM.WH_OWNR_CD
                            AND WTCCC.FROM_LOC_TP_CD       = #fromLocTpCdAst#
                            AND WTCCC.TO_RTL_WH_CD         = #toRtlWhCdAst#
                            AND WTCCC.TO_WH_OWNR_CD        = INVTY_LOC_CD_TO.WH_OWNR_CD
                            AND WTCCC.TO_LOC_TP_CD         = #toLocTpCdAst#
                            AND ROWNUM                     = #numOne#
                            AND WTCCC.EZCANCELFLAG         = '0'
                        ) B2
                        ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_B3
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                            AND WTCCC.FROM_RTL_WH_CD       = #fromRtlWhCdAst#
                            AND WTCCC.FROM_WH_OWNR_CD      = INVTY_LOC_CD_FROM.WH_OWNR_CD
                            AND WTCCC.FROM_LOC_TP_CD       = #fromLocTpCdAst#
                            AND WTCCC.TO_RTL_WH_CD         = #toRtlWhCdAst#
                            AND WTCCC.TO_WH_OWNR_CD        = #toWhOwnrCdAst#
                            AND WTCCC.TO_LOC_TP_CD         = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                            AND ROWNUM                     = #numOne#
                            AND WTCCC.EZCANCELFLAG         = '0'
                        ) B3
                        ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_C1
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                            AND WTCCC.FROM_RTL_WH_CD       = #fromRtlWhCdAst#
                            AND WTCCC.FROM_WH_OWNR_CD      = #fromWhOwnrCdAst#
                            AND WTCCC.FROM_LOC_TP_CD       = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                            AND WTCCC.TO_RTL_WH_CD         = INVTY_LOC_CD_TO.RTL_WH_CD
                            AND WTCCC.TO_WH_OWNR_CD        = #toWhOwnrCdAst#
                            AND WTCCC.TO_LOC_TP_CD         = #toLocTpCdAst#
                            AND ROWNUM                     = #numOne#
                            AND WTCCC.EZCANCELFLAG         = '0'
                        ) C1
                        ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_C2
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                            AND WTCCC.FROM_RTL_WH_CD       = #fromRtlWhCdAst#
                            AND WTCCC.FROM_WH_OWNR_CD      = #fromWhOwnrCdAst#
                            AND WTCCC.FROM_LOC_TP_CD       = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                            AND WTCCC.TO_RTL_WH_CD         = #toRtlWhCdAst#
                            AND WTCCC.TO_WH_OWNR_CD        = INVTY_LOC_CD_TO.WH_OWNR_CD
                            AND WTCCC.TO_LOC_TP_CD         = #toLocTpCdAst#
                            AND ROWNUM                     = #numOne#
                            AND WTCCC.EZCANCELFLAG         = '0'
                        ) C2
                        ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_C3
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                            AND WTCCC.FROM_RTL_WH_CD       = #fromRtlWhCdAst#
                            AND WTCCC.FROM_WH_OWNR_CD      = #fromWhOwnrCdAst#
                            AND WTCCC.FROM_LOC_TP_CD       = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                            AND WTCCC.TO_RTL_WH_CD         = #toRtlWhCdAst#
                            AND WTCCC.TO_WH_OWNR_CD        = #toWhOwnrCdAst#
                            AND WTCCC.TO_LOC_TP_CD         = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                            AND ROWNUM                     = #numOne#
                            AND WTCCC.EZCANCELFLAG         = '0'
                        ) C3
                    ) AS CINC_GLBL_CMPY_CATG_CD
                FROM
                    INVTY_TRX       IT
                   ,SCUBE_MDSE_V    SMV
                    ,(SELECT DISTINCT
                          DIL.INVTY_LOC_CD
                         ,DIL.RTL_WH_CD
                         ,RW.WH_OWNR_CD
                         ,DIL.INVTY_LOC_TP_CD
                         ,DIL.GLBL_CMPY_CD
                      FROM
                          DS_INVTY_LOC_V DIL
                         ,RTL_WH RW
                         ,INVTY_OWNR IO
                      WHERE
                          DIL.GLBL_CMPY_CD       = #glblCmpyCd#
                      AND DIL.GLBL_CMPY_CD       = RW.GLBL_CMPY_CD
                      AND DIL.RTL_WH_CD          = RW.RTL_WH_CD
                      AND RW.GLBL_CMPY_CD        = IO.GLBL_CMPY_CD
                      AND RW.INVTY_OWNR_CD       = IO.INVTY_OWNR_CD
                      AND IO.CMPY_INVTY_FLG      = 'Y'
                      AND DIL.EZCANCELFLAG       = '0'
                      AND RW.EZCANCELFLAG        = '0'
                      AND IO.EZCANCELFLAG        = '0'
                      <!-- Add Start 2020/02/03 QC#55572 -->
                      <isNotNull property="exclSwhCdList">
                      AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                          #exclSwhCdList[]#
                          </iterate>
                      </isNotNull>
                      <!-- Add End 2020/02/03 QC#55572 -->
                      ) INVTY_LOC_CD_FROM
                      ,(SELECT DISTINCT
                          DIL.INVTY_LOC_CD
                         ,DIL.RTL_WH_CD
                         ,RW.WH_OWNR_CD
                         ,DIL.INVTY_LOC_TP_CD
                         ,DIL.GLBL_CMPY_CD
                      FROM
                          DS_INVTY_LOC_V DIL
                         ,RTL_WH RW
                         ,INVTY_OWNR IO
                      WHERE
                          DIL.GLBL_CMPY_CD       = #glblCmpyCd#
                      AND DIL.GLBL_CMPY_CD       = RW.GLBL_CMPY_CD
                      AND DIL.RTL_WH_CD          = RW.RTL_WH_CD
                    <!-- QC#27619 add -->
                    <iterate property="exclLocCdList" var="exclLocCdList[]" open=" AND DIL.INVTY_LOC_CD NOT IN (" close=")" conjunction=",">
                        #exclLocCdList[]#
                    </iterate> 
                      AND RW.GLBL_CMPY_CD        = IO.GLBL_CMPY_CD
                      AND RW.INVTY_OWNR_CD       = IO.INVTY_OWNR_CD
                      AND IO.CMPY_INVTY_FLG      = 'Y'
                      AND DIL.EZCANCELFLAG       = '0'
                      AND RW.EZCANCELFLAG        = '0'
                      AND IO.EZCANCELFLAG        = '0'
                      ) INVTY_LOC_CD_TO
                WHERE
                    IT.GLBL_CMPY_CD           = #glblCmpyCd#
                AND IT.TRX_CD                 = #invtyTrxCdRmn#
                AND IT.TRX_RSN_CD             IN (#invtyTrxRsnCdPrtsUsgForRmn#, #invtyTrxRsnCdPrtsUsgRtrnForRmn#)
                AND IT.INVTY_TRX_DT        &gt; #cpoOrdTs#
                AND IT.GLBL_CMPY_CD           = INVTY_LOC_CD_FROM.GLBL_CMPY_CD
                AND IT.INVTY_LOC_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_CD
                AND IT.GLBL_CMPY_CD           = INVTY_LOC_CD_TO.GLBL_CMPY_CD(+) <!-- QC#27619 mod -->
                AND IT.SHIP_TO_CUST_CD        = INVTY_LOC_CD_TO.INVTY_LOC_CD(+) <!-- QC#27619 mod -->
                <iterate property="exclLocCdList" var="exclLocCdList[]" open=" AND NOT (INVTY_LOC_CD_FROM.INVTY_LOC_CD IN (" close=") )" conjunction=",">
                    #exclLocCdList[]#
                </iterate> 
                <!-- QC#27619 del -->
<!--                <iterate property="exclLocCdList" var="exclLocCdList[]" open=" AND INVTY_LOC_CD_TO.INVTY_LOC_CD IN (" close="))" conjunction=",">-->
<!--                    #exclLocCdList[]#-->
<!--                </iterate> -->
                AND IT.GLBL_CMPY_CD           = SMV.GLBL_CMPY_CD
                AND IT.MDSE_CD                = SMV.MDSE_CD
                AND IT.EZCANCELFLAG           = '0'
            )
            SELECT
                 PARTS_USAGE_REMAN_ORD_GRP.INVTY_TRX_DT           AS INTFC_CPO_ORD_DT 
                ,PARTS_USAGE_REMAN_ORD_GRP.INVTY_TRX_SLP_NUM      AS INTFC_CPO_ORD_NUM
                <!-- QC#31174 Update. -->
                ,NVL(ST.SELL_TO_CUST_CD, PARTS_USAGE_REMAN_ORD_GRP.INVTY_LOC_CD)  AS INTFC_SELL_TO_CUST_CD
                ,PARTS_USAGE_REMAN_ORD_GRP.MDSE_CD                AS INTFC_PRT_MDSE_CD
                ,PARTS_USAGE_REMAN_ORD_GRP.INVTY_TRX_QTY          AS INTFC_ORD_QTY
                ,GC.GLBL_CMPY_CD                                  AS CINC_SHIP_TO_GLBL_CMPY_CD
                ,GC.GLBL_CMPY_CD                                  AS CINC_BILL_TO_GLBL_CMPY_CD
                ,PARTS_USAGE_REMAN_ORD_GRP.CUSA_VND_CD
                ,PARTS_USAGE_REMAN_ORD_GRP.CINC_GLBL_WH_CD
                ,PARTS_USAGE_REMAN_ORD_GRP.CINC_RCV_GLBL_WH_CD
                ,PARTS_USAGE_REMAN_ORD_GRP.CINC_GLBL_CMPY_CATG_CD
                ,#trdPtnrShpgMethCdOther#                         AS TRD_PTNR_SHPG_METH_CD
            FROM
                <!-- QC#30961 Update PARTS_USAGE_REMAN_ORD_GRP. -->
                (
                    SELECT
                        *
                    FROM
                        (
                        SELECT
                            INVTY_TRX_DT
                           ,INVTY_TRX_SLP_NUM
                           ,MDSE_CD
                           ,CINC_GLBL_WH_CD
                           ,CINC_RCV_GLBL_WH_CD
                           ,GLBL_CMPY_CD
                           <!-- QC#31174 Add. -->
                           ,MIN(INVTY_LOC_CD)            AS INVTY_LOC_CD
                           ,SUM(INVTY_TRX_QTY)           AS INVTY_TRX_QTY
                           ,MIN(CUSA_VND_CD)             AS CUSA_VND_CD
                           ,MIN(CINC_GLBL_CMPY_CATG_CD)  AS CINC_GLBL_CMPY_CATG_CD
                           ,MIN(SHIP_TO_CUST_CD)         AS SHIP_TO_CUST_CD
                        FROM
                           PARTS_USAGE_REMAN_ORD
                        GROUP BY
                            PARTS_USAGE_REMAN_ORD.INVTY_TRX_DT
                           ,PARTS_USAGE_REMAN_ORD.INVTY_TRX_SLP_NUM
                           ,PARTS_USAGE_REMAN_ORD.MDSE_CD
                           ,PARTS_USAGE_REMAN_ORD.CINC_GLBL_WH_CD
                           ,PARTS_USAGE_REMAN_ORD.CINC_RCV_GLBL_WH_CD
                           ,PARTS_USAGE_REMAN_ORD.GLBL_CMPY_CD
                        ) A
                     WHERE
                          A.INVTY_TRX_QTY != 0
                ) PARTS_USAGE_REMAN_ORD_GRP
                ,SHIP_TO_CUST   ST
                ,BILL_TO_CUST   BT
                ,GLBL_CMPY      GC
            WHERE
                PARTS_USAGE_REMAN_ORD_GRP.GLBL_CMPY_CD       =    ST.GLBL_CMPY_CD (+)
            AND PARTS_USAGE_REMAN_ORD_GRP.SHIP_TO_CUST_CD    =    ST.SHIP_TO_CUST_CD (+)
            AND ST.GLBL_CMPY_CD                              =    BT.GLBL_CMPY_CD (+)
            AND ST.BILL_TO_CUST_CD                           =    BT.BILL_TO_CUST_CD (+)
            AND BT.COA_AFFL_CD                               =    GC.COA_AFFL_CD (+)
            AND ST.EZCANCELFLAG (+)                          =    '0'
            AND BT.EZCANCELFLAG (+)                          =    '0'
            AND GC.EZCANCELFLAG (+)                          =    '0'
    </statement>

    <!-- [Inventory Transaction] Reman Item Change -->
    <statement id="getPartsOrdDataInvtyTrxRmnItmChg" parameterClass="Map" resultClass="Map">
        WITH SCUBE_MDSE_V AS
        (
            SELECT
                A1.MDSE_CD
               ,A1.SPLY_ITEM_NUM
               ,A1.GLBL_CMPY_CD
               ,CPV.P_CODE_VENDR   AS CUSA_VND_CD
            FROM
                ASL_DTL A1
                ,(SELECT
                      AD.GLBL_CMPY_CD
                     ,AD.ASL_DTL_PK
                     ,ROW_NUMBER() OVER (PARTITION BY AD.MDSE_CD ORDER BY NVL(AD.EFF_FROM_DT, #effFromDtDefalut#) DESC) IDX
                FROM
                    ASL_DTL AD
                   ,PRNT_CMPY_VND PV
                WHERE
                    AD.GLBL_CMPY_CD      = PV.GLBL_CMPY_CD
                AND AD.EZCANCELFLAG      = '0'
                AND PV.PRNT_CMPY_VND_CD  = AD.VND_CD
                <iterate property="vndSysTpCdList" var="vndSysTpCdList[]" open="AND PV.VND_SYS_TP_CD IN (" close=")" conjunction=",">
                    #vndSysTpCdList[]#
                </iterate>
                AND PV.EZCANCELFLAG      = '0'
                ) A2
                ,CSA_PRT_V     CPV
                ,DS_COND_CONST DCC
            WHERE
                A1.GLBL_CMPY_CD          = A2.GLBL_CMPY_CD
            AND A1.ASL_DTL_PK            = A2.ASL_DTL_PK
            <!-- QC#30964 Add SQL. -->
            <isNotNull property="exclMdseCdList">
                <iterate property="exclMdseCdList" var="exclMdseCdList[]" open="AND A1.MDSE_CD NOT IN (" close=")" conjunction=",">
                #exclMdseCdList[]#
                </iterate> 
            </isNotNull>
            AND A2.IDX                   = #IDX_1#
            AND CPV.P_PARTS_NUM          = NVL(A1.SPLY_ITEM_NUM, A1.MDSE_CD)
            AND CPV.P_CODE_VENDR         = DCC.DS_COND_CONST_VAL_TXT_01
            AND DCC.GLBL_CMPY_CD         = A1.GLBL_CMPY_CD
            AND DCC.DS_COND_CONST_GRP_ID = #dsCondConstGrpIdCusaVndCd#
            AND A1.EZCANCELFLAG          = '0'
            AND CPV.EZCANCELFLAG         = '0'
            AND DCC.EZCANCELFLAG         = '0'
        ), REMAN_ITEM_CHANGE_ORD AS
        (
            SELECT
                IT.INVTY_TRX_DT
               ,IT.INVTY_TRX_SLP_NUM
               ,IT.MDSE_CD
               ,IT.INVTY_TRX_QTY
               ,SMV.CUSA_VND_CD
               ,IT.GLBL_CMPY_CD
               ,IT.SHIP_TO_CUST_CD
               <!-- QC#31174 Add -->
               ,IT.INVTY_LOC_CD
                ,(SELECT
                      CASE
                        WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        ELSE (SELECT
                                  CGWC.CINC_GLBL_WH_CD
                              FROM
                                  CINC_GLBL_WH_CONV CGWC
                              WHERE
                                  CGWC.GLBL_CMPY_CD    = #glblCmpyCd#
                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                              AND CGWC.EZCANCELFLAG    = '0')
                        END AS CINC_GLBL_WH_CD_EN
                 FROM
                    (SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) CNT_A
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                    ) A
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) CNT_B
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) B
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) CNT_C
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) C
                ) AS CINC_GLBL_WH_CD
            FROM
                INVTY_TRX       IT
               ,DS_INVTY_LOC_V  DIL
               ,RTL_WH          RW
               ,INVTY_OWNR      IO
               ,MDSE            M
               ,SCUBE_MDSE_V    SMV
            WHERE
                IT.GLBL_CMPY_CD           = #glblCmpyCd#
            AND IT.TRX_CD                 = #invtyTrxCdRmn#
            AND IT.TRX_RSN_CD             IN (#invtyTrxRsnCdRmnItmChngStkOt#, #invtyTrxRsnCdRmnItmChngStkIn#)
            AND IT.INVTY_TRX_DT        &gt; #cpoOrdTs#
            <iterate property="exclLocCdList" var="exclLocCdList[]" open="AND IT.INVTY_LOC_CD NOT IN (" close=")" conjunction=",">
                #exclLocCdList[]#
            </iterate> 
            AND IT.GLBL_CMPY_CD           = DIL.GLBL_CMPY_CD
            AND IT.INVTY_LOC_CD           = DIL.INVTY_LOC_CD
            AND DIL.INVTY_LOC_TP_CD      != #technician#
            AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
            AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
            AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
            AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
            AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
            AND IT.GLBL_CMPY_CD           = M.GLBL_CMPY_CD
            AND IT.MDSE_CD                = M.MDSE_CD
            AND M.GLBL_CMPY_CD            = SMV.GLBL_CMPY_CD
            AND M.MDSE_CD                 = SMV.MDSE_CD
            AND IT.EZCANCELFLAG           = '0'
            AND DIL.EZCANCELFLAG          = '0'
            AND RW.EZCANCELFLAG           = '0'
            AND IO.EZCANCELFLAG           = '0'
            AND M.EZCANCELFLAG            = '0'
            <!-- Add Start 2020/02/03 QC#55572 -->
            <isNotNull property="exclSwhCdList">
            AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                #exclSwhCdList[]#
                </iterate>
            </isNotNull>
            <!-- Add End 2020/02/03 QC#55572 -->
        )
        SELECT
             REMAN_ITEM_CHANGE_ORD_GRP.INVTY_TRX_DT           AS INTFC_CPO_ORD_DT
            ,REMAN_ITEM_CHANGE_ORD_GRP.INVTY_TRX_SLP_NUM      AS INTFC_CPO_ORD_NUM
            ,GC.GLBL_CMPY_CD                                  AS CINC_SHIP_TO_GLBL_CMPY_CD
            ,GC.GLBL_CMPY_CD                                  AS CINC_BILL_TO_GLBL_CMPY_CD
            <!-- QC#31174 Update. -->
            ,NVL(ST.SELL_TO_CUST_CD, REMAN_ITEM_CHANGE_ORD_GRP.INVTY_LOC_CD)  AS INTFC_SELL_TO_CUST_CD
            ,REMAN_ITEM_CHANGE_ORD_GRP.MDSE_CD                AS INTFC_PRT_MDSE_CD
            ,REMAN_ITEM_CHANGE_ORD_GRP.INVTY_TRX_QTY          AS INTFC_ORD_QTY
            ,REMAN_ITEM_CHANGE_ORD_GRP.CUSA_VND_CD
            ,REMAN_ITEM_CHANGE_ORD_GRP.CINC_GLBL_WH_CD
            ,#trdPtnrShpgMethCdOther#                         AS TRD_PTNR_SHPG_METH_CD
        FROM
            <!-- QC#30961 Update REMAN_ITEM_CHANGE_ORD_GRP -->
            (
                SELECT
                    *
                FROM
                    (
                    SELECT
                        INVTY_TRX_DT
                       ,INVTY_TRX_SLP_NUM
                       ,MDSE_CD
                       ,CINC_GLBL_WH_CD
                       ,GLBL_CMPY_CD
                       <!-- QC#31174 Add -->
                       ,INVTY_LOC_CD
                       ,SUM(INVTY_TRX_QTY)     AS INVTY_TRX_QTY
                       ,MIN(CUSA_VND_CD)       AS CUSA_VND_CD
                       ,MIN(SHIP_TO_CUST_CD)   AS SHIP_TO_CUST_CD
                    FROM
                       REMAN_ITEM_CHANGE_ORD
                    GROUP BY
                        REMAN_ITEM_CHANGE_ORD.INVTY_TRX_DT
                       ,REMAN_ITEM_CHANGE_ORD.INVTY_TRX_SLP_NUM
                       ,REMAN_ITEM_CHANGE_ORD.MDSE_CD
                       ,REMAN_ITEM_CHANGE_ORD.CINC_GLBL_WH_CD
                       ,REMAN_ITEM_CHANGE_ORD.GLBL_CMPY_CD
                       ,REMAN_ITEM_CHANGE_ORD.INVTY_LOC_CD
                    ) A
                 WHERE
                    A.INVTY_TRX_QTY != 0
            ) REMAN_ITEM_CHANGE_ORD_GRP
            ,SHIP_TO_CUST   ST
            ,BILL_TO_CUST   BT
            ,GLBL_CMPY      GC
        WHERE
            REMAN_ITEM_CHANGE_ORD_GRP.GLBL_CMPY_CD     =    ST.GLBL_CMPY_CD (+)
        AND REMAN_ITEM_CHANGE_ORD_GRP.SHIP_TO_CUST_CD  =    ST.SHIP_TO_CUST_CD (+)
        AND ST.GLBL_CMPY_CD                            =    BT.GLBL_CMPY_CD (+)
        AND ST.BILL_TO_CUST_CD                         =    BT.BILL_TO_CUST_CD (+)
        AND BT.COA_AFFL_CD                             =    GC.COA_AFFL_CD (+)
        AND ST.EZCANCELFLAG (+)                        =    '0'
        AND BT.EZCANCELFLAG (+)                        =    '0'
        AND GC.EZCANCELFLAG (+)                        =    '0'
    </statement>

    <!-- [Inventory Order] Disposal/Item Change/Refurbish/SubContract -->
    <statement id="getPartsOrdDataInvtyOrd" parameterClass="Map" resultClass="Map">
        WITH SCUBE_MDSE_V AS
        (
                SELECT
                    A1.MDSE_CD
                   ,A1.SPLY_ITEM_NUM
                   ,A1.GLBL_CMPY_CD
                   ,CPV.P_CODE_VENDR   AS CUSA_VND_CD
                FROM
                    ASL_DTL A1
                    ,(SELECT
                          AD.GLBL_CMPY_CD
                         ,AD.ASL_DTL_PK
                         ,ROW_NUMBER() OVER (PARTITION BY AD.MDSE_CD ORDER BY NVL(AD.EFF_FROM_DT, #effFromDtDefalut#) DESC) IDX
                    FROM
                        ASL_DTL AD
                       ,PRNT_CMPY_VND PV
                    WHERE
                        AD.GLBL_CMPY_CD      = PV.GLBL_CMPY_CD
                    AND PV.PRNT_CMPY_VND_CD  = AD.VND_CD
                    <iterate property="vndSysTpCdList" var="vndSysTpCdList[]" open="AND PV.VND_SYS_TP_CD IN (" close=")" conjunction=",">
                        #vndSysTpCdList[]#
                    </iterate>
                    AND AD.EZCANCELFLAG      = '0'
                    AND PV.EZCANCELFLAG      = '0'
                    ) A2
                    ,CSA_PRT_V     CPV
                    ,DS_COND_CONST DCC
                WHERE
                    A1.GLBL_CMPY_CD          = A2.GLBL_CMPY_CD
                AND A1.ASL_DTL_PK            = A2.ASL_DTL_PK
                <!-- QC#30964 Add SQL. -->
                <isNotNull property="exclMdseCdList">
                    <iterate property="exclMdseCdList" var="exclMdseCdList[]" open="AND A1.MDSE_CD NOT IN (" close=")" conjunction=",">
                    #exclMdseCdList[]#
                    </iterate> 
                </isNotNull>
                AND A2.IDX                   = #IDX_1#
                AND CPV.P_PARTS_NUM          = NVL(A1.SPLY_ITEM_NUM, A1.MDSE_CD)
                AND CPV.P_CODE_VENDR         = DCC.DS_COND_CONST_VAL_TXT_01
                AND DCC.GLBL_CMPY_CD         = A1.GLBL_CMPY_CD
                AND DCC.DS_COND_CONST_GRP_ID = #dsCondConstGrpIdCusaVndCd#
                AND A1.EZCANCELFLAG          = '0'
                AND CPV.EZCANCELFLAG         = '0'
                AND DCC.EZCANCELFLAG         = '0'
        )
        ,INVTY_ORD_WH AS
        (
            SELECT
                INO.INVTY_ORD_SUBMT_TS
               ,INO.INVTY_ORD_NUM
               <!-- QC#31174 Update. Add Decode -->
               ,(CASE
                    WHEN SP.SELL_TO_CUST_CD is not null THEN
                         SP.SELL_TO_CUST_CD
                    WHEN IOD.TO_INVTY_LOC_CD is not null THEN
                         IOD.TO_INVTY_LOC_CD
                    ELSE 
                         IOD.INVTY_LOC_CD
                    END 
                )AS SELL_TO_CUST_CD
               ,IOD.MDSE_CD
               ,IOD.ORD_QTY
               ,SP.RSD_DT
               ,(SELECT
                CASE WHEN INO.SHPG_SVC_LVL_CD IS NULL THEN #trdPtnrShpgMethCdOther#
                     WHEN AA.CNT_A &gt; 0 THEN (
                         SELECT
                             TPSXR.TRD_PTNR_SHPG_METH_CD
                         FROM
                             TRD_PTNR_SHPG_X_REF TPSXR
                         WHERE
                             TPSXR.GLBL_CMPY_CD        = INO.GLBL_CMPY_CD
                         AND TPSXR.SHPG_SVC_LCL_CD     = INO.SHPG_SVC_LVL_CD
                         AND TPSXR.VND_CD (+)          = #vndCdCinc#
                         AND TPSXR.CARR_CD (+)         = #carrCdAst#
                         AND TPSXR.FRT_COND_CD (+)     = #frtCondCdAst#
                         AND TPSXR.EZCANCELFLAG (+)    = '0')
                    ELSE ''
                    END AS TRD_PTNR_SHPG_METH_CD
                FROM
                   (SELECT
                        COUNT(TPSXR.TRD_PTNR_SHPG_METH_CD) CNT_A
                    FROM
                        TRD_PTNR_SHPG_X_REF TPSXR
                    WHERE
                        TPSXR.GLBL_CMPY_CD        = INO.GLBL_CMPY_CD
                    AND TPSXR.SHPG_SVC_LCL_CD     = INO.SHPG_SVC_LVL_CD
                    AND TPSXR.VND_CD (+)          = #vndCdCinc#
                    AND TPSXR.CARR_CD (+)         = #carrCdAst#
                    AND TPSXR.FRT_COND_CD (+)     = #frtCondCdAst#
                    AND ROWNUM                    = #numOne#
                    AND TPSXR.EZCANCELFLAG (+)    = '0') AA
               ) AS TRD_PTNR_SHPG_METH_CD
               ,SMV.CUSA_VND_CD
               ,(SELECT
                      CASE
                        WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        ELSE (SELECT
                                  CGWC.CINC_GLBL_WH_CD
                              FROM
                                  CINC_GLBL_WH_CONV CGWC
                              WHERE
                                  CGWC.GLBL_CMPY_CD    = #glblCmpyCd#
                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                              AND CGWC.EZCANCELFLAG    = '0')
                        END AS CINC_GLBL_WH_CD_EN
                 FROM
                    (SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                    ) A
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) B
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) C
                ) AS CINC_GLBL_WH_CD
               ,'INVTY_ORD_NOT_TECH_REQ_RETURN' INTFC_CATG_TXT
            FROM
                INVTY_ORD        INO
               ,INVTY_ORD_DTL    IOD
               ,SHPG_PLN         SP
               ,DS_INVTY_LOC_V   DIL
               ,RTL_WH           RW
               ,INVTY_OWNR       IO
               ,MDSE             M
               ,SCUBE_MDSE_V     SMV
            WHERE
                INO.GLBL_CMPY_CD           = #glblCmpyCd#
            AND INO.INVTY_ORD_TP_CD        IN (#invOrdTpDisposal#, #invOrdTpWriteOff#, #invOrdTpItemChange#, #invOrdTpSubContract#, #invOrdTpRefurbishOut#)
            AND INO.GLBL_CMPY_CD           = IOD.GLBL_CMPY_CD
            AND INO.INVTY_ORD_NUM          = IOD.INVTY_ORD_NUM
            <!-- QC#27617 mod start -->
            AND SUBSTR(INO.INVTY_ORD_SUBMT_TS, 1, 8)
                                           &gt; SUBSTR(#cpoOrdTs#, 1, 8)
            <!-- QC#27617 mod end -->
            AND INO.INVTY_ORD_CANC_TS      IS NULL
            <iterate property="exclLocCdList" var="exclLocCdList[]" open=" AND NOT IOD.INVTY_LOC_CD IN (" close=")" conjunction=",">
                #exclLocCdList[]#
            </iterate>
            AND IOD.GLBL_CMPY_CD          = DIL.GLBL_CMPY_CD
            AND IOD.INVTY_LOC_CD          = DIL.INVTY_LOC_CD
            AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
            AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
            <isNotNull property="technician">
            AND DIL.INVTY_LOC_TP_CD     != #technician#
            </isNotNull>
            AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
            AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
            AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
            AND IOD.GLBL_CMPY_CD          = M.GLBL_CMPY_CD
            AND IOD.MDSE_CD               = M.MDSE_CD
            AND M.INVTY_CTRL_FLG          = #invtyCtrlFlg#
            AND M.GLBL_CMPY_CD            = SMV.GLBL_CMPY_CD
            AND M.MDSE_CD                 = SMV.MDSE_CD
            AND IOD.GLBL_CMPY_CD          = SP.GLBL_CMPY_CD (+)
            AND IOD.INVTY_LOC_CD          = SP.SHIP_TO_CUST_CD (+)
            AND IOD.INVTY_ORD_NUM         = SP.TRX_HDR_NUM (+)
            AND IOD.INVTY_ORD_LINE_NUM    = SP.TRX_LINE_NUM (+)
            AND INO.EZCANCELFLAG          = '0'
            AND IOD.EZCANCELFLAG          = '0'
            AND SP.EZCANCELFLAG (+)       = '0'
            AND DIL.EZCANCELFLAG          = '0'
            AND RW.EZCANCELFLAG           = '0'
            AND IO.EZCANCELFLAG           = '0'
            AND M.EZCANCELFLAG            = '0'
            <!-- Add Start 2020/02/03 QC#55572 -->
            <isNotNull property="exclSwhCdList">
            AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                #exclSwhCdList[]#
                </iterate>
            </isNotNull>
            <!-- Add End 2020/02/03 QC#55572 -->
        UNION ALL
            SELECT
                INO.INVTY_ORD_SUBMT_TS
               ,INO.INVTY_ORD_NUM
               <!-- QC#31174 Update. Add Decode -->
               ,(CASE
                    WHEN SP.SELL_TO_CUST_CD is not null THEN
                         SP.SELL_TO_CUST_CD
                    WHEN IOD.TO_INVTY_LOC_CD is not null THEN
                         IOD.TO_INVTY_LOC_CD
                    ELSE 
                         IOD.INVTY_LOC_CD
                    END 
                )AS SELL_TO_CUST_CD
               ,IOD.MDSE_CD
               ,IOD.ORD_QTY
               ,SP.RSD_DT
               ,(SELECT
                CASE WHEN INO.SHPG_SVC_LVL_CD IS NULL THEN #trdPtnrShpgMethCdOther#
                     WHEN AA.CNT_A &gt; 0 THEN (
                         SELECT
                             TPSXR.TRD_PTNR_SHPG_METH_CD
                         FROM
                             TRD_PTNR_SHPG_X_REF TPSXR
                         WHERE
                             TPSXR.GLBL_CMPY_CD        = INO.GLBL_CMPY_CD
                         AND TPSXR.SHPG_SVC_LCL_CD     = INO.SHPG_SVC_LVL_CD
                         AND TPSXR.VND_CD (+)          = #vndCdCinc#
                         AND TPSXR.CARR_CD (+)         = #carrCdAst#
                         AND TPSXR.FRT_COND_CD (+)     = #frtCondCdAst#
                         AND TPSXR.EZCANCELFLAG (+)    = '0')
                    ELSE ''
                    END AS TRD_PTNR_SHPG_METH_CD
                FROM
                   (SELECT
                        COUNT(TPSXR.TRD_PTNR_SHPG_METH_CD) AS CNT_A
                    FROM
                        TRD_PTNR_SHPG_X_REF TPSXR
                    WHERE
                        TPSXR.GLBL_CMPY_CD        = INO.GLBL_CMPY_CD
                    AND TPSXR.SHPG_SVC_LCL_CD     = INO.SHPG_SVC_LVL_CD
                    AND TPSXR.VND_CD (+)          = #vndCdCinc#
                    AND TPSXR.CARR_CD (+)         = #carrCdAst#
                    AND TPSXR.FRT_COND_CD (+)     = #frtCondCdAst#
                    AND TPSXR.EZCANCELFLAG (+)    = '0') AA
               ) AS TRD_PTNR_SHPG_METH_CD
               ,SMV.CUSA_VND_CD
               ,(SELECT
                      CASE
                        WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        ELSE (SELECT
                                  CGWC.CINC_GLBL_WH_CD
                              FROM
                                  CINC_GLBL_WH_CONV CGWC
                              WHERE
                                  CGWC.GLBL_CMPY_CD    = #glblCmpyCd#
                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                              AND CGWC.EZCANCELFLAG    = '0')
                        END AS CINC_GLBL_WH_CD_EN
                 FROM
                    (SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND CGWC.EZCANCELFLAG    = '0'
                    ) A
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) B
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) C
                ) AS CINC_GLBL_WH_CD
               ,'INVTY_ORD_NOT_TECH_REQ_RETURN_CANCEL' AS INTFC_CATG_TXT
            FROM
                INVTY_ORD        INO
               ,INVTY_ORD_DTL    IOD
               ,SHPG_PLN         SP
               ,DS_INVTY_LOC_V   DIL
               ,RTL_WH           RW
               ,INVTY_OWNR       IO
               ,MDSE             M
               ,SCUBE_MDSE_V     SMV
            WHERE
                INO.GLBL_CMPY_CD           = #glblCmpyCd#
            AND INO.INVTY_ORD_TP_CD        IN (#invOrdTpDisposal#, #invOrdTpWriteOff#, #invOrdTpItemChange#, #invOrdTpSubContract#, #invOrdTpRefurbishOut#)
            AND INO.GLBL_CMPY_CD           = IOD.GLBL_CMPY_CD
            AND INO.INVTY_ORD_NUM          = IOD.INVTY_ORD_NUM
            <!-- QC#27617 mod start -->
            AND SUBSTR(INO.INVTY_ORD_SUBMT_TS, 1, 8)
                                        &lt;= SUBSTR(#cpoOrdTs#, 1, 8)
            AND SUBSTR(INO.INVTY_ORD_CANC_TS, 1, 8)
                                        &gt;  SUBSTR(#cpoOrdTs#, 1, 8)
            <!-- QC#27617 mod end -->
            <iterate property="exclLocCdList" var="exclLocCdList[]" open=" AND NOT IOD.INVTY_LOC_CD IN (" close=")" conjunction=",">
                #exclLocCdList[]#
            </iterate>
            AND IOD.GLBL_CMPY_CD          = DIL.GLBL_CMPY_CD
            AND IOD.INVTY_LOC_CD          = DIL.INVTY_LOC_CD
            AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
            AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
            <isNotNull property="technician">
            AND DIL.INVTY_LOC_TP_CD     != #technician#
            </isNotNull>
            AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
            AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
            AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
            AND IOD.GLBL_CMPY_CD          = M.GLBL_CMPY_CD
            AND IOD.MDSE_CD               = M.MDSE_CD
            AND M.INVTY_CTRL_FLG          = #invtyCtrlFlg#
            AND M.GLBL_CMPY_CD            = SMV.GLBL_CMPY_CD
            AND M.MDSE_CD                 = SMV.MDSE_CD
            AND IOD.GLBL_CMPY_CD          = SP.GLBL_CMPY_CD (+)
            AND IOD.INVTY_LOC_CD          = SP.SHIP_TO_CUST_CD (+)
            AND IOD.INVTY_ORD_NUM         = SP.TRX_HDR_NUM (+)
            AND IOD.INVTY_ORD_LINE_NUM    = SP.TRX_LINE_NUM (+)
            AND INO.EZCANCELFLAG          = '0'
            AND IOD.EZCANCELFLAG          = '0'
            AND DIL.EZCANCELFLAG          = '0'
            AND RW.EZCANCELFLAG           = '0'
            AND IO.EZCANCELFLAG           = '0'
            AND M.EZCANCELFLAG            = '0'
            AND SP.EZCANCELFLAG (+)       = '0'
            <!-- Add Start 2020/02/03 QC#55572 -->
            <isNotNull property="exclSwhCdList">
            AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                #exclSwhCdList[]#
                </iterate>
            </isNotNull>
            <!-- Add End 2020/02/03 QC#55572 -->
        )
        SELECT
             INVTY_ORD_SUBMT_TS     AS INTFC_CPO_ORD_DT
            ,INVTY_ORD_NUM          AS INTFC_CPO_ORD_NUM
            ,SELL_TO_CUST_CD        AS INTFC_SELL_TO_CUST_CD
            ,MDSE_CD                AS INTFC_PRT_MDSE_CD
            ,ORD_QTY                AS INTFC_ORD_QTY
            ,RSD_DT                 AS INTFC_RSD_DT
            ,TRD_PTNR_SHPG_METH_CD
            ,CUSA_VND_CD
            ,CINC_GLBL_WH_CD
            ,INTFC_CATG_TXT
        FROM
            (
            SELECT
                INVTY_ORD_NUM
               ,MDSE_CD
               ,TRD_PTNR_SHPG_METH_CD
               ,SELL_TO_CUST_CD
               ,RSD_DT
               ,CUSA_VND_CD
               ,CINC_GLBL_WH_CD
               ,SUM(ORD_QTY) ORD_QTY
               ,MIN(INVTY_ORD_SUBMT_TS) AS INVTY_ORD_SUBMT_TS
               ,INTFC_CATG_TXT
            FROM
                INVTY_ORD_WH
            GROUP BY
                INVTY_ORD_WH.INVTY_ORD_NUM
               ,INVTY_ORD_WH.MDSE_CD
               ,INVTY_ORD_WH.TRD_PTNR_SHPG_METH_CD
               ,INVTY_ORD_WH.SELL_TO_CUST_CD
               ,INVTY_ORD_WH.RSD_DT
               ,INVTY_ORD_WH.CUSA_VND_CD
               ,INVTY_ORD_WH.CINC_GLBL_WH_CD
               ,INVTY_ORD_WH.INTFC_CATG_TXT
            ) INVTY_ORD_WH_GRP
         <!-- QC#30961 Update -->
         WHERE
            ORD_QTY != 0
        ORDER BY
            INVTY_ORD_WH_GRP.INVTY_ORD_SUBMT_TS
           ,INVTY_ORD_WH_GRP.INVTY_ORD_NUM
           ,INVTY_ORD_WH_GRP.MDSE_CD
    </statement>

    <!-- [Inventory Order] Tech Return, Tech Req -->
    <statement id="getPartsOrdDataInvtyOrdTechTrsfr" parameterClass="Map" resultClass="Map">
        WITH SCUBE_MDSE_V AS
        (
                SELECT
                    A1.MDSE_CD
                   ,A1.SPLY_ITEM_NUM
                   ,A1.GLBL_CMPY_CD
                   ,CPV.P_CODE_VENDR   AS CUSA_VND_CD
                FROM
                    ASL_DTL A1
                    ,(SELECT
                          AD.GLBL_CMPY_CD
                         ,AD.ASL_DTL_PK
                         ,ROW_NUMBER() OVER (PARTITION BY AD.MDSE_CD ORDER BY NVL(AD.EFF_FROM_DT, #effFromDtDefalut#) DESC) IDX
                    FROM
                        ASL_DTL AD
                       ,PRNT_CMPY_VND PV
                    WHERE
                        AD.GLBL_CMPY_CD      = PV.GLBL_CMPY_CD
                    AND PV.PRNT_CMPY_VND_CD  = AD.VND_CD
                    <iterate property="vndSysTpCdList" var="vndSysTpCdList[]" open="AND PV.VND_SYS_TP_CD IN (" close=")" conjunction=",">
                        #vndSysTpCdList[]#
                    </iterate>
                    AND AD.EZCANCELFLAG      = '0'
                    AND PV.EZCANCELFLAG      = '0'
                    ) A2
                    ,CSA_PRT_V     CPV
                    ,DS_COND_CONST DCC
                WHERE
                    A1.GLBL_CMPY_CD          = A2.GLBL_CMPY_CD
                AND A1.ASL_DTL_PK            = A2.ASL_DTL_PK
                <!-- QC#30964 Add SQL. -->
                <isNotNull property="exclMdseCdList">
                    <iterate property="exclMdseCdList" var="exclMdseCdList[]" open="AND A1.MDSE_CD NOT IN (" close=")" conjunction=",">
                    #exclMdseCdList[]#
                    </iterate> 
                </isNotNull>
                AND A2.IDX                   = #IDX_1#
                AND CPV.P_PARTS_NUM          = NVL(A1.SPLY_ITEM_NUM, A1.MDSE_CD)
                AND CPV.P_CODE_VENDR         = DCC.DS_COND_CONST_VAL_TXT_01
                AND DCC.GLBL_CMPY_CD         = A1.GLBL_CMPY_CD
                AND DCC.DS_COND_CONST_GRP_ID = #dsCondConstGrpIdCusaVndCd#
                AND A1.EZCANCELFLAG          = '0'
                AND CPV.EZCANCELFLAG         = '0'
                AND DCC.EZCANCELFLAG         = '0'
        ), INVTY_ORD_TECH AS
        (
            SELECT
                INO.INVTY_ORD_SUBMT_TS
               ,INO.INVTY_ORD_NUM
               ,SP.SELL_TO_CUST_CD
               ,IOD.MDSE_CD
               ,IOD.ORD_QTY
               ,SP.RSD_DT
               ,(SELECT
                CASE WHEN INO.SHPG_SVC_LVL_CD IS NULL THEN #trdPtnrShpgMethCdOther#
                     WHEN AA.CNT_A &gt; 0 THEN (
                         SELECT
                             TPSXR.TRD_PTNR_SHPG_METH_CD
                         FROM
                             TRD_PTNR_SHPG_X_REF TPSXR
                         WHERE
                             TPSXR.GLBL_CMPY_CD        = INO.GLBL_CMPY_CD
                         AND TPSXR.SHPG_SVC_LCL_CD     = INO.SHPG_SVC_LVL_CD
                         AND TPSXR.VND_CD (+)          = #vndCdCinc#
                         AND TPSXR.CARR_CD (+)         = #carrCdAst#
                         AND TPSXR.FRT_COND_CD (+)     = #frtCondCdAst#
                         AND TPSXR.EZCANCELFLAG (+)    = '0')
                    ELSE ''
                    END AS TRD_PTNR_SHPG_METH_CD
                FROM
                   (SELECT
                        COUNT(TPSXR.TRD_PTNR_SHPG_METH_CD) AS CNT_A
                    FROM
                        TRD_PTNR_SHPG_X_REF TPSXR
                    WHERE
                        TPSXR.GLBL_CMPY_CD        = INO.GLBL_CMPY_CD
                    AND TPSXR.SHPG_SVC_LCL_CD     = INO.SHPG_SVC_LVL_CD
                    AND TPSXR.VND_CD (+)          = #vndCdCinc#
                    AND TPSXR.CARR_CD (+)         = #carrCdAst#
                    AND TPSXR.FRT_COND_CD (+)     = #frtCondCdAst#
                    AND ROWNUM                    = #numOne#
                    AND TPSXR.EZCANCELFLAG (+)    = '0') AA
               ) AS TRD_PTNR_SHPG_METH_CD
               ,SMV.CUSA_VND_CD
                ,(SELECT
                      CASE
                        WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  INVTY_LOC_CD_FROM.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND INVTY_LOC_CD_FROM.RTL_WH_CD       = CGWC.RTL_WH_CD
                                              AND CGWC.WH_OWNR_CD                   = #whOwnrCdAst#
                                              AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG                 = '0')
                        WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  INVTY_LOC_CD_FROM.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND INVTY_LOC_CD_FROM.WH_OWNR_CD      = CGWC.WH_OWNR_CD
                                              AND CGWC.RTL_WH_CD                    = #rtlWhCdAst#
                                              AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG                 = '0')
                        WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  INVTY_LOC_CD_FROM.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD = CGWC.LOC_TP_CD
                                              AND CGWC.RTL_WH_CD                    = #rtlWhCdAst#
                                              AND CGWC.WH_OWNR_CD                   = #whOwnrCdAst#
                                              AND CGWC.EZCANCELFLAG                 = '0')
                        ELSE (SELECT
                                   CGWC.CINC_GLBL_WH_CD
                              FROM
                                   CINC_GLBL_WH_CONV CGWC
                              WHERE
                                  CGWC.GLBL_CMPY_CD    = #glblCmpyCd#
                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                              AND CGWC.EZCANCELFLAG    = '0')
                        END AS CINC_GLBL_WH_CD_EN
                 FROM
                    (SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) CNT_A
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         INVTY_LOC_CD_FROM.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND INVTY_LOC_CD_FROM.RTL_WH_CD         = CGWC.RTL_WH_CD
                     AND CGWC.WH_OWNR_CD                     = #whOwnrCdAst#
                     AND CGWC.LOC_TP_CD                      = #locTpCdAst#
                     AND ROWNUM                              = #numOne#
                     AND CGWC.EZCANCELFLAG                   = '0'
                    ) A
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) CNT_B
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         INVTY_LOC_CD_FROM.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND INVTY_LOC_CD_FROM.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                     AND CGWC.RTL_WH_CD                      = #rtlWhCdAst#
                     AND CGWC.LOC_TP_CD                      = #locTpCdAst#
                     AND ROWNUM                              = #numOne#
                     AND CGWC.EZCANCELFLAG                   = '0'
                   ) B
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) CNT_C
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         INVTY_LOC_CD_FROM.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD   = CGWC.LOC_TP_CD
                     AND CGWC.RTL_WH_CD                      = #rtlWhCdAst#
                     AND CGWC.WH_OWNR_CD                     = #whOwnrCdAst#
                     AND ROWNUM                              = #numOne#
                     AND CGWC.EZCANCELFLAG                   = '0'
                   ) C
                ) AS CINC_GLBL_WH_CD
                ,(SELECT
                      CASE
                        WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  INVTY_LOC_CD_TO.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND INVTY_LOC_CD_TO.RTL_WH_CD       = CGWC.RTL_WH_CD
                                              AND CGWC.WH_OWNR_CD                 = #whOwnrCdAst#
                                              AND CGWC.LOC_TP_CD                  = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG               = '0')
                        WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  INVTY_LOC_CD_TO.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND INVTY_LOC_CD_TO.WH_OWNR_CD      = CGWC.WH_OWNR_CD
                                              AND CGWC.RTL_WH_CD                  = #rtlWhCdAst#
                                              AND CGWC.LOC_TP_CD                  = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG               = '0')
                        WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  INVTY_LOC_CD_TO.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND INVTY_LOC_CD_TO.INVTY_LOC_TP_CD = CGWC.LOC_TP_CD
                                              AND CGWC.RTL_WH_CD                  = #rtlWhCdAst#
                                              AND CGWC.WH_OWNR_CD                 = #whOwnrCdAst#
                                              AND CGWC.EZCANCELFLAG               = '0')
                        ELSE (SELECT
                                   CGWC.CINC_GLBL_WH_CD
                              FROM
                                   CINC_GLBL_WH_CONV CGWC
                              WHERE
                                  CGWC.GLBL_CMPY_CD    = #glblCmpyCd#
                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                              AND CGWC.EZCANCELFLAG    = '0')
                        END AS CINC_GLBL_WH_CD_EN
                 FROM
                    (SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         INVTY_LOC_CD_TO.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND INVTY_LOC_CD_TO.RTL_WH_CD         = CGWC.RTL_WH_CD
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                    ) A
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         INVTY_LOC_CD_TO.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND INVTY_LOC_CD_TO.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) B
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         INVTY_LOC_CD_TO.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND INVTY_LOC_CD_TO.INVTY_LOC_TP_CD   = CGWC.LOC_TP_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) C
                ) AS CINC_RCV_GLBL_WH_CD
               ,(SELECT
                     CASE
                         WHEN A1.CNT_A1 &gt; 0 THEN (SELECT
                                                      WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                  FROM
                                                      WH_TRNSF_CINC_CATG_CONV WTCCC
                                                  WHERE
                                                      INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                  AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                                  AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                  AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                  AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                                  AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                  AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                  AND WTCCC.EZCANCELFLAG             = '0')
                         WHEN A2.CNT_A2 &gt; 0 THEN (SELECT
                                                      WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                  FROM
                                                      WH_TRNSF_CINC_CATG_CONV WTCCC
                                                  WHERE
                                                      INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                  AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                                  AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                  AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                  AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                                  AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                  AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                  AND WTCCC.EZCANCELFLAG             = '0')
                         WHEN A3.CNT_A3 &gt; 0 THEN (SELECT
                                                      WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                  FROM
                                                      WH_TRNSF_CINC_CATG_CONV WTCCC
                                                  WHERE
                                                      INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                  AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                                  AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                  AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                  AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                                  AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                  AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                  AND WTCCC.EZCANCELFLAG             = '0')
                         WHEN B1.CNT_B1 &gt; 0 THEN (SELECT
                                                      WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                  FROM
                                                      WH_TRNSF_CINC_CATG_CONV WTCCC
                                                  WHERE
                                                      INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                  AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                  AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                                  AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                  AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                                  AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                  AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                  AND WTCCC.EZCANCELFLAG             = '0')
                         WHEN B2.CNT_B2 &gt; 0 THEN (SELECT
                                                      WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                  FROM
                                                      WH_TRNSF_CINC_CATG_CONV WTCCC
                                                  WHERE
                                                      INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                  AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                  AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                                  AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                  AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                  AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                                  AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                  AND WTCCC.EZCANCELFLAG             = '0')
                         WHEN B3.CNT_B3 &gt; 0 THEN (SELECT
                                                      WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                  FROM
                                                      WH_TRNSF_CINC_CATG_CONV WTCCC
                                                  WHERE
                                                      INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                  AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                  AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                                  AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                  AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                  AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                  AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                                  AND WTCCC.EZCANCELFLAG             = '0') 
                         WHEN C1.CNT_C1 &gt; 0 THEN (SELECT
                                                      WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                  FROM
                                                      WH_TRNSF_CINC_CATG_CONV WTCCC
                                                  WHERE
                                                      INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                  AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                  AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                  AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                                  AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                                  AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                  AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                  AND WTCCC.EZCANCELFLAG             = '0')
                         WHEN C2.CNT_C2 &gt; 0 THEN (SELECT
                                                      WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                  FROM
                                                       WH_TRNSF_CINC_CATG_CONV WTCCC
                                                  WHERE
                                                      INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                  AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                  AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                  AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                                  AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                  AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                                  AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                  AND WTCCC.EZCANCELFLAG             = '0')
                         WHEN C3.CNT_C3 &gt; 0 THEN (SELECT
                                                      WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                  FROM
                                                      WH_TRNSF_CINC_CATG_CONV WTCCC
                                                  WHERE
                                                      INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                  AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                  AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                  AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                                  AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                  AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                  AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                                  AND WTCCC.EZCANCELFLAG             = '0')
                         ELSE (SELECT
                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                               FROM
                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                               WHERE
                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                               AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                               AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                               AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                               AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                               AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                               AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                               AND WTCCC.EZCANCELFLAG             = '0')
                     END AS CINC_GLBL_CMPY_CATG_CD
                 FROM
                     (SELECT
                          COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_A1
                      FROM
                          WH_TRNSF_CINC_CATG_CONV WTCCC
                      WHERE
                          INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                      AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                      AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                      AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                      AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                      AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                      AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                      AND ROWNUM                         = #numOne#
                      AND WTCCC.EZCANCELFLAG             = '0'
                     ) A1
                     ,(SELECT
                           COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_A2
                       FROM
                           WH_TRNSF_CINC_CATG_CONV WTCCC
                       WHERE
                           INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                       AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                       AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                       AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                       AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                       AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                       AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                       AND ROWNUM                         = #numOne#
                       AND WTCCC.EZCANCELFLAG             = '0'
                     ) A2
                     ,(SELECT
                           COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_A3
                       FROM
                           WH_TRNSF_CINC_CATG_CONV WTCCC
                       WHERE
                           INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                      AND WTCCC.FROM_RTL_WH_CD            = INVTY_LOC_CD_FROM.RTL_WH_CD
                      AND WTCCC.FROM_WH_OWNR_CD           = #fromWhOwnrCdAst#
                      AND WTCCC.FROM_LOC_TP_CD            = #fromLocTpCdAst#
                      AND WTCCC.TO_LOC_TP_CD              = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                      AND WTCCC.TO_RTL_WH_CD              = #toRtlWhCdAst#
                      AND WTCCC.TO_WH_OWNR_CD             = #toWhOwnrCdAst#
                      AND ROWNUM                          = #numOne#
                      AND WTCCC.EZCANCELFLAG              = '0'
                     ) A3
                     ,(SELECT
                           COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_B1
                       FROM
                           WH_TRNSF_CINC_CATG_CONV WTCCC
                       WHERE
                           INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                       AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                       AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                       AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                       AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                       AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                       AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                       AND ROWNUM                         = #numOne#
                       AND WTCCC.EZCANCELFLAG             = '0'
                     ) B1
                     ,(SELECT
                           COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_B2
                       FROM
                           WH_TRNSF_CINC_CATG_CONV WTCCC
                       WHERE
                           INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                       AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                       AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                       AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                       AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                       AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                       AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                       AND ROWNUM                         = #numOne#
                       AND WTCCC.EZCANCELFLAG             = '0'
                     ) B2
                     ,(SELECT
                           COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_B3
                       FROM
                           WH_TRNSF_CINC_CATG_CONV WTCCC
                       WHERE
                           INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                       AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                       AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                       AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                       AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                       AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                       AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                       AND ROWNUM                         = #numOne#
                       AND WTCCC.EZCANCELFLAG             = '0'
                     ) B3
                     ,(SELECT
                           COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_C1
                       FROM
                           WH_TRNSF_CINC_CATG_CONV WTCCC
                       WHERE
                           INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                       AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                       AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                       AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                       AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                       AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                       AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                       AND ROWNUM                         = #numOne#
                       AND WTCCC.EZCANCELFLAG             = '0'
                     ) C1
                     ,(SELECT
                           COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_C2
                       FROM
                           WH_TRNSF_CINC_CATG_CONV WTCCC
                       WHERE
                           INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                       AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                       AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                       AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                       AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                       AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                       AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                       AND ROWNUM                         = #numOne#
                       AND WTCCC.EZCANCELFLAG             = '0'
                     ) C2
                     ,(SELECT
                           COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_C3
                       FROM
                           WH_TRNSF_CINC_CATG_CONV WTCCC
                       WHERE
                           INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                       AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                       AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                       AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                       AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                       AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                       AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                       AND ROWNUM                         = #numOne#
                       AND WTCCC.EZCANCELFLAG             = '0'
                     ) C3
               ) AS CINC_GLBL_CMPY_CATG_CD
                ,'INVTY_ORD_TECH_REQ_RETURN' AS INTFC_CATG_TXT
            FROM
                INVTY_ORD        INO
               ,INVTY_ORD_DTL    IOD
               ,SHPG_PLN         SP
               ,MDSE             M
               ,SCUBE_MDSE_V     SMV
                ,(SELECT DISTINCT
                      DIL.INVTY_LOC_CD
                     ,DIL.RTL_WH_CD
                     ,DIL.RTL_SWH_CD
                     ,RW.WH_OWNR_CD
                     ,DIL.INVTY_LOC_TP_CD
                     ,DIL.GLBL_CMPY_CD
                  FROM
                      DS_INVTY_LOC_V DIL
                     ,RTL_WH         RW
                     ,INVTY_OWNR     IO
                  WHERE
                      DIL.GLBL_CMPY_CD          = #glblCmpyCd#
                  AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
                  AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
                  AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
                  AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
                  AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
                  AND DIL.EZCANCELFLAG          = '0'
                  AND RW.EZCANCELFLAG           = '0'
                  AND IO.EZCANCELFLAG           = '0'
                  <!-- Add Start 2020/02/03 QC#55572 -->
                  <isNotNull property="exclSwhCdList">
                  AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                      #exclSwhCdList[]#
                      </iterate>
                  </isNotNull>
                  <!-- Add End 2020/02/03 QC#55572 -->
                  ) INVTY_LOC_CD_FROM
                  ,(SELECT DISTINCT
                      DIL.INVTY_LOC_CD
                     ,DIL.RTL_WH_CD
                     ,DIL.RTL_SWH_CD
                     ,RW.WH_OWNR_CD
                     ,DIL.INVTY_LOC_TP_CD
                     ,DIL.GLBL_CMPY_CD
                  FROM
                      DS_INVTY_LOC_V DIL
                     ,RTL_WH         RW
                     ,INVTY_OWNR     IO
                  WHERE
                      DIL.GLBL_CMPY_CD          = #glblCmpyCd#
                  AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
                  AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
                  AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
                  AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
                  AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
                  AND DIL.EZCANCELFLAG          = '0'
                  AND RW.EZCANCELFLAG           = '0'
                  AND IO.EZCANCELFLAG           = '0'
                  <!-- Add Start 2020/02/03 QC#55572 -->
                  <isNotNull property="exclSwhCdList">
                  AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                      #exclSwhCdList[]#
                      </iterate>
                  </isNotNull>
                  <!-- Add End 2020/02/03 QC#55572 -->
                  ) INVTY_LOC_CD_TO
            WHERE
                INO.GLBL_CMPY_CD           = #glblCmpyCd#
            AND INO.INVTY_ORD_TP_CD        = #dcTransfer#
            AND INO.GLBL_CMPY_CD           = IOD.GLBL_CMPY_CD
            AND INO.INVTY_ORD_NUM          = IOD.INVTY_ORD_NUM
            <!-- QC#27617 mod start -->
            AND SUBSTR(INO.INVTY_ORD_SUBMT_TS, 1, 8)
                                           &gt; SUBSTR(#cpoOrdTs#, 1, 8)
            <!-- QC#27617 mod end -->
            AND INO.INVTY_ORD_CANC_TS      IS NULL
            <isNotNull property="exclLocCdList">
            AND (CASE
             <!-- From Location OK , To Location NG  -->
             WHEN INVTY_LOC_CD_FROM.INVTY_LOC_CD NOT IN
             <iterate property="exclLocCdList" var="exclLocCdList[]" open=" (" close=")" conjunction=",">
                 #exclLocCdList[]#
             </iterate>
              AND INVTY_LOC_CD_TO.INVTY_LOC_CD IN
             <iterate property="exclLocCdList" var="exclLocCdList[]" open=" (" close=")" conjunction=",">
                 #exclLocCdList[]#
             </iterate>
              THEN 1
             <!-- From Location OK , To Location OK  -->
             WHEN INVTY_LOC_CD_FROM.INVTY_LOC_CD NOT IN
             <iterate property="exclLocCdList" var="exclLocCdList[]" open=" (" close=")" conjunction=",">
                 #exclLocCdList[]#
             </iterate>
                AND INVTY_LOC_CD_TO.INVTY_LOC_CD NOT IN
             <iterate property="exclLocCdList" var="exclLocCdList[]" open=" (" close=")" conjunction=",">
                 #exclLocCdList[]#
             </iterate>
              THEN 1
              ELSE 0 END) = 1
            </isNotNull>
            AND IOD.GLBL_CMPY_CD          = M.GLBL_CMPY_CD
            AND IOD.MDSE_CD               = M.MDSE_CD
            AND M.INVTY_CTRL_FLG          = #invtyCtrlFlg#
            AND M.GLBL_CMPY_CD            = SMV.GLBL_CMPY_CD
            AND M.MDSE_CD                 = SMV.MDSE_CD
            AND IOD.GLBL_CMPY_CD          = INVTY_LOC_CD_FROM.GLBL_CMPY_CD
            AND IOD.INVTY_LOC_CD          = INVTY_LOC_CD_FROM.INVTY_LOC_CD
            AND IOD.GLBL_CMPY_CD          = INVTY_LOC_CD_TO.GLBL_CMPY_CD
            AND IOD.TO_INVTY_LOC_CD       = INVTY_LOC_CD_TO.INVTY_LOC_CD
            AND IOD.GLBL_CMPY_CD          = SP.GLBL_CMPY_CD (+)
            AND IOD.INVTY_ORD_NUM         = SP.TRX_HDR_NUM (+)
            AND IOD.INVTY_ORD_LINE_NUM    = SP.TRX_LINE_NUM (+)
            AND INO.EZCANCELFLAG          = '0'
            AND IOD.EZCANCELFLAG          = '0'
            AND M.EZCANCELFLAG            = '0'
            AND SP.EZCANCELFLAG (+)       = '0'
        UNION ALL
            SELECT
                INO.INVTY_ORD_SUBMT_TS
               ,INO.INVTY_ORD_NUM
               ,SP.SELL_TO_CUST_CD
               ,IOD.MDSE_CD
               ,IOD.ORD_QTY
               ,SP.RSD_DT
               ,(SELECT
                CASE WHEN INO.SHPG_SVC_LVL_CD IS NULL THEN #trdPtnrShpgMethCdOther#
                     WHEN AA.CNT_A &gt; 0 THEN (
                         SELECT
                             TPSXR.TRD_PTNR_SHPG_METH_CD
                         FROM
                             TRD_PTNR_SHPG_X_REF TPSXR
                         WHERE
                             TPSXR.GLBL_CMPY_CD        = INO.GLBL_CMPY_CD
                         AND TPSXR.SHPG_SVC_LCL_CD     = INO.SHPG_SVC_LVL_CD
                         AND TPSXR.VND_CD (+)          = #vndCdCinc#
                         AND TPSXR.CARR_CD (+)         = #carrCdAst#
                         AND TPSXR.FRT_COND_CD (+)     = #frtCondCdAst#
                         AND TPSXR.EZCANCELFLAG (+)    = '0')
                    ELSE ''
                    END AS TRD_PTNR_SHPG_METH_CD
                FROM
                   (SELECT
                        COUNT(TPSXR.TRD_PTNR_SHPG_METH_CD) AS CNT_A
                    FROM
                        TRD_PTNR_SHPG_X_REF TPSXR
                    WHERE
                        TPSXR.GLBL_CMPY_CD        = INO.GLBL_CMPY_CD
                    AND TPSXR.SHPG_SVC_LCL_CD     = INO.SHPG_SVC_LVL_CD
                    AND TPSXR.VND_CD (+)          = #vndCdCinc#
                    AND TPSXR.CARR_CD (+)         = #carrCdAst#
                    AND TPSXR.FRT_COND_CD (+)     = #frtCondCdAst#
                    AND ROWNUM                    = #numOne#
                    AND TPSXR.EZCANCELFLAG (+)    = '0') AA
               ) AS TRD_PTNR_SHPG_METH_CD
               ,SMV.CUSA_VND_CD
                ,(SELECT
                      CASE
                        WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE INVTY_LOC_CD_FROM.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND INVTY_LOC_CD_FROM.RTL_WH_CD         = CGWC.RTL_WH_CD
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE INVTY_LOC_CD_FROM.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND INVTY_LOC_CD_FROM.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                    CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                    CINC_GLBL_WH_CONV CGWC
                                              WHERE INVTY_LOC_CD_FROM.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD   = CGWC.LOC_TP_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        ELSE (SELECT
                                   CGWC.CINC_GLBL_WH_CD
                              FROM
                                   CINC_GLBL_WH_CONV CGWC
                              WHERE CGWC.GLBL_CMPY_CD  = #glblCmpyCd#
                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                              AND CGWC.EZCANCELFLAG    = '0')
                        END AS CINC_GLBL_WH_CD_EN
                 FROM
                    (SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         INVTY_LOC_CD_FROM.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND INVTY_LOC_CD_FROM.RTL_WH_CD         = CGWC.RTL_WH_CD
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                    ) A
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         INVTY_LOC_CD_FROM.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND INVTY_LOC_CD_FROM.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) B
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         INVTY_LOC_CD_FROM.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD         = CGWC.LOC_TP_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) C
                ) AS CINC_GLBL_WH_CD
                ,(SELECT
                      CASE
                        WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE INVTY_LOC_CD_TO.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND INVTY_LOC_CD_TO.RTL_WH_CD         = CGWC.RTL_WH_CD
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                    CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                    CINC_GLBL_WH_CONV CGWC
                                              WHERE INVTY_LOC_CD_TO.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND INVTY_LOC_CD_TO.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                    CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                    CINC_GLBL_WH_CONV CGWC
                                              WHERE INVTY_LOC_CD_TO.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND INVTY_LOC_CD_TO.INVTY_LOC_TP_CD   = CGWC.LOC_TP_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        ELSE (SELECT
                                   CGWC.CINC_GLBL_WH_CD
                              FROM
                                   CINC_GLBL_WH_CONV CGWC
                              WHERE CGWC.GLBL_CMPY_CD  = #glblCmpyCd#
                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                              AND CGWC.EZCANCELFLAG    = '0')
                        END AS CINC_GLBL_WH_CD_EN
                 FROM
                    (SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         INVTY_LOC_CD_TO.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND INVTY_LOC_CD_TO.RTL_WH_CD         = CGWC.RTL_WH_CD
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                    ) A
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         INVTY_LOC_CD_TO.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND INVTY_LOC_CD_TO.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) B
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         INVTY_LOC_CD_TO.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND INVTY_LOC_CD_TO.INVTY_LOC_TP_CD         = CGWC.LOC_TP_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) C
                ) AS CINC_RCV_GLBL_WH_CD
                ,(SELECT
                      CASE
                          WHEN A1.CNT_A1 &gt; 0 THEN (SELECT
                                                       WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                   FROM
                                                       WH_TRNSF_CINC_CATG_CONV WTCCC
                                                   WHERE
                                                       INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                   AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                                   AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                   AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                   AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                                   AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                   AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                   AND WTCCC.EZCANCELFLAG             = '0')
                          WHEN A2.CNT_A2 &gt; 0 THEN (SELECT
                                                       WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                   FROM
                                                       WH_TRNSF_CINC_CATG_CONV WTCCC
                                                   WHERE
                                                       INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                   AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                                   AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                   AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                   AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                                   AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                   AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                   AND WTCCC.EZCANCELFLAG             = '0')
                          WHEN A3.CNT_A3 &gt; 0 THEN (SELECT
                                                       WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                   FROM
                                                       WH_TRNSF_CINC_CATG_CONV WTCCC
                                                   WHERE
                                                       INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                   AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                                   AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                   AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                   AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                                   AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                   AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                   AND WTCCC.EZCANCELFLAG             = '0')
                          WHEN B1.CNT_B1 &gt; 0 THEN (SELECT
                                                       WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                   FROM
                                                       WH_TRNSF_CINC_CATG_CONV WTCCC
                                                   WHERE
                                                       INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                   AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                   AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                                   AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                   AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                                   AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                   AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                   AND WTCCC.EZCANCELFLAG             = '0')
                          WHEN B2.CNT_B2 &gt; 0 THEN (SELECT
                                                       WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                   FROM
                                                       WH_TRNSF_CINC_CATG_CONV WTCCC
                                                   WHERE
                                                       INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                   AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                   AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                                   AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                   AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                   AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                                   AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                   AND WTCCC.EZCANCELFLAG             = '0')
                          WHEN B3.CNT_B3 &gt; 0 THEN (SELECT
                                                       WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                   FROM
                                                       WH_TRNSF_CINC_CATG_CONV WTCCC
                                                   WHERE
                                                       INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                   AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                   AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                                   AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                   AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                   AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                   AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                                   AND WTCCC.EZCANCELFLAG             = '0') 
                          WHEN C1.CNT_C1 &gt; 0 THEN (SELECT
                                                       WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                   FROM
                                                       WH_TRNSF_CINC_CATG_CONV WTCCC
                                                   WHERE
                                                       INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                   AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                   AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                   AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                                   AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                                   AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                   AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                   AND WTCCC.EZCANCELFLAG             = '0')
                          WHEN C2.CNT_C2 &gt; 0 THEN (SELECT
                                                       WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                   FROM
                                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                                   WHERE
                                                       INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                   AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                   AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                   AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                                   AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                   AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                                   AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                   AND WTCCC.EZCANCELFLAG             = '0')
                          WHEN C3.CNT_C3 &gt; 0 THEN (SELECT
                                                       WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                   FROM
                                                       WH_TRNSF_CINC_CATG_CONV WTCCC
                                                   WHERE
                                                       INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                   AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                   AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                   AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                                   AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                   AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                   AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                                   AND WTCCC.EZCANCELFLAG             = '0')
                          ELSE (SELECT
                                    WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                FROM
                                    WH_TRNSF_CINC_CATG_CONV WTCCC
                                WHERE
                                    INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                AND WTCCC.EZCANCELFLAG             = '0')
                      END AS CINC_GLBL_CMPY_CATG_CD
                  FROM
                      (SELECT
                           COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_A1
                       FROM
                           WH_TRNSF_CINC_CATG_CONV WTCCC
                       WHERE
                           INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                       AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                       AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                       AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                       AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                       AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                       AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                       AND ROWNUM                         = #numOne#
                       AND WTCCC.EZCANCELFLAG             = '0'
                      ) A1
                      ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_A2
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                        AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                        AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                        AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                        AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                        AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                        AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                        AND ROWNUM                         = #numOne#
                        AND WTCCC.EZCANCELFLAG             = '0'
                      ) A2
                      ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_A3
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                       AND WTCCC.FROM_RTL_WH_CD            = INVTY_LOC_CD_FROM.RTL_WH_CD
                       AND WTCCC.FROM_WH_OWNR_CD           = #fromWhOwnrCdAst#
                       AND WTCCC.FROM_LOC_TP_CD            = #fromLocTpCdAst#
                       AND WTCCC.TO_LOC_TP_CD              = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                       AND WTCCC.TO_RTL_WH_CD              = #toRtlWhCdAst#
                       AND WTCCC.TO_WH_OWNR_CD             = #toWhOwnrCdAst#
                       AND ROWNUM                          = #numOne#
                       AND WTCCC.EZCANCELFLAG              = '0'
                      ) A3
                      ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_B1
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                        AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                        AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                        AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                        AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                        AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                        AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                        AND ROWNUM                         = #numOne#
                        AND WTCCC.EZCANCELFLAG             = '0'
                      ) B1
                      ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_B2
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                        AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                        AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                        AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                        AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                        AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                        AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                        AND ROWNUM                         = #numOne#
                        AND WTCCC.EZCANCELFLAG             = '0'
                      ) B2
                      ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_B3
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                        AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                        AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                        AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                        AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                        AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                        AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                        AND ROWNUM                         = #numOne#
                        AND WTCCC.EZCANCELFLAG             = '0'
                      ) B3
                      ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_C1
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                        AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                        AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                        AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                        AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                        AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                        AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                        AND ROWNUM                         = #numOne#
                        AND WTCCC.EZCANCELFLAG             = '0'
                      ) C1
                      ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_C2
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                        AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                        AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                        AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                        AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                        AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                        AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                        AND ROWNUM                         = #numOne#
                        AND WTCCC.EZCANCELFLAG             = '0'
                      ) C2
                      ,(SELECT
                            COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_C3
                        FROM
                            WH_TRNSF_CINC_CATG_CONV WTCCC
                        WHERE
                            INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                        AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                        AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                        AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                        AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                        AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                        AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                        AND ROWNUM                         = #numOne#
                        AND WTCCC.EZCANCELFLAG             = '0'
                      ) C3
                ) AS CINC_GLBL_CMPY_CATG_CD
                ,'INVTY_ORD_TECH_REQ_RETURN_CANCEL' AS INTFC_CATG_TXT
            FROM
                INVTY_ORD        INO
               ,INVTY_ORD_DTL    IOD
               ,SHPG_PLN         SP
               ,MDSE             M
               ,SCUBE_MDSE_V     SMV
                ,(SELECT DISTINCT
                      DIL.INVTY_LOC_CD
                     ,DIL.RTL_WH_CD
                     ,DIL.RTL_SWH_CD
                     ,RW.WH_OWNR_CD
                     ,DIL.INVTY_LOC_TP_CD
                     ,DIL.GLBL_CMPY_CD
                  FROM
                      DS_INVTY_LOC_V DIL
                     ,RTL_WH         RW
                     ,INVTY_OWNR     IO
                  WHERE
                      DIL.GLBL_CMPY_CD          = #glblCmpyCd#
                  AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
                  AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
                  AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
                  AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
                  AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
                  AND DIL.EZCANCELFLAG          = '0'
                  AND RW.EZCANCELFLAG           = '0'
                  AND IO.EZCANCELFLAG           = '0'
                  <!-- Add Start 2020/02/03 QC#55572 -->
                  <isNotNull property="exclSwhCdList">
                  AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                      #exclSwhCdList[]#
                      </iterate>
                  </isNotNull>
                  <!-- Add End 2020/02/03 QC#55572 -->
                  ) INVTY_LOC_CD_FROM
                  ,(SELECT DISTINCT
                      DIL.INVTY_LOC_CD
                     ,DIL.RTL_WH_CD
                     ,DIL.RTL_SWH_CD
                     ,RW.WH_OWNR_CD
                     ,DIL.INVTY_LOC_TP_CD
                     ,DIL.GLBL_CMPY_CD
                  FROM
                      DS_INVTY_LOC_V DIL
                     ,RTL_WH         RW
                     ,INVTY_OWNR     IO
                  WHERE
                      DIL.GLBL_CMPY_CD          = #glblCmpyCd#
                  AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
                  AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
                  AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
                  AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
                  AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
                  AND DIL.EZCANCELFLAG          = '0'
                  AND RW.EZCANCELFLAG           = '0'
                  AND IO.EZCANCELFLAG           = '0'
                  <!-- Add Start 2020/02/03 QC#55572 -->
                  <isNotNull property="exclSwhCdList">
                  AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                      #exclSwhCdList[]#
                      </iterate>
                  </isNotNull>
                  <!-- Add End 2020/02/03 QC#55572 -->
                  ) INVTY_LOC_CD_TO
            WHERE
                INO.GLBL_CMPY_CD           = #glblCmpyCd#
            AND INO.INVTY_ORD_TP_CD        = #dcTransfer#
            AND INO.GLBL_CMPY_CD           = IOD.GLBL_CMPY_CD
            AND INO.INVTY_ORD_NUM          = IOD.INVTY_ORD_NUM
            <!-- QC#27617 mod start -->
            AND SUBSTR(INO.INVTY_ORD_SUBMT_TS, 1, 8)
                                           &lt;= SUBSTR(#cpoOrdTs#, 1, 8)
            AND SUBSTR(INO.INVTY_ORD_CANC_TS, 1, 8)
                                           &gt;  SUBSTR(#cpoOrdTs#, 1, 8)
            <!-- QC#27617 mod end -->
            <isNotNull property="exclLocCdList">
            AND (CASE
             WHEN INVTY_LOC_CD_TO.INVTY_LOC_TP_CD = #technician# AND IOD.TO_INVTY_LOC_CD NOT IN
             <iterate property="exclLocCdList" var="exclLocCdList[]" open=" (" close=")" conjunction=",">
                 #exclLocCdList[]#
             </iterate>
              THEN 1
             WHEN INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD = #technician# AND IOD.INVTY_LOC_CD NOT IN
             <iterate property="exclLocCdList" var="exclLocCdList[]" open=" (" close=")" conjunction=",">
                 #exclLocCdList[]#
             </iterate>
              THEN 1
              ELSE 0 END) = 1
            </isNotNull>
            AND IOD.GLBL_CMPY_CD          = M.GLBL_CMPY_CD
            AND IOD.MDSE_CD               = M.MDSE_CD
            AND M.INVTY_CTRL_FLG          = #invtyCtrlFlg#
            AND M.GLBL_CMPY_CD            = SMV.GLBL_CMPY_CD
            AND M.MDSE_CD                 = SMV.MDSE_CD
            AND IOD.GLBL_CMPY_CD          = INVTY_LOC_CD_FROM.GLBL_CMPY_CD
            AND IOD.INVTY_LOC_CD          = INVTY_LOC_CD_FROM.INVTY_LOC_CD
            AND IOD.GLBL_CMPY_CD          = INVTY_LOC_CD_TO.GLBL_CMPY_CD
            AND IOD.TO_INVTY_LOC_CD       = INVTY_LOC_CD_TO.INVTY_LOC_CD
            AND IOD.GLBL_CMPY_CD          = SP.GLBL_CMPY_CD (+)
            AND IOD.INVTY_ORD_NUM         = SP.TRX_HDR_NUM (+)
            AND IOD.INVTY_ORD_LINE_NUM    = SP.TRX_LINE_NUM (+)
            AND INO.EZCANCELFLAG          = '0'
            AND IOD.EZCANCELFLAG          = '0'
            AND M.EZCANCELFLAG            = '0'
            AND SP.EZCANCELFLAG (+)       = '0'
        )
        SELECT
             INVTY_ORD_SUBMT_TS     AS INTFC_CPO_ORD_DT
            ,INVTY_ORD_NUM          AS INTFC_CPO_ORD_NUM
            ,SELL_TO_CUST_CD        AS INTFC_SELL_TO_CUST_CD
            ,MDSE_CD                AS INTFC_PRT_MDSE_CD
            ,ORD_QTY                AS INTFC_ORD_QTY
            ,RSD_DT                 AS INTFC_RSD_DT
            ,TRD_PTNR_SHPG_METH_CD
            ,CUSA_VND_CD
            ,CINC_GLBL_WH_CD
            ,CINC_RCV_GLBL_WH_CD
            ,CINC_GLBL_CMPY_CATG_CD
            ,INTFC_CATG_TXT
        FROM
        (
            SELECT
                INVTY_ORD_NUM
               ,MDSE_CD
               ,TRD_PTNR_SHPG_METH_CD
               ,SELL_TO_CUST_CD
               ,RSD_DT
               ,CUSA_VND_CD
               ,CINC_GLBL_WH_CD
               ,CINC_RCV_GLBL_WH_CD
               ,CINC_GLBL_CMPY_CATG_CD
               ,SUM(ORD_QTY) ORD_QTY
               ,MIN(INVTY_ORD_SUBMT_TS) AS INVTY_ORD_SUBMT_TS
               ,INTFC_CATG_TXT
            FROM
                INVTY_ORD_TECH
            GROUP BY
                INVTY_ORD_NUM
               ,MDSE_CD
               ,TRD_PTNR_SHPG_METH_CD
               ,SELL_TO_CUST_CD
               ,RSD_DT
               ,CUSA_VND_CD
               ,CINC_GLBL_WH_CD
               ,CINC_RCV_GLBL_WH_CD
               ,CINC_GLBL_CMPY_CATG_CD
               ,INTFC_CATG_TXT
        ) INVTY_ORD_TECH_GRP
        <!-- QC#30961 Update -->
        WHERE
            ORD_QTY != 0
        ORDER BY
            INVTY_ORD_TECH_GRP.INVTY_ORD_SUBMT_TS
           ,INVTY_ORD_TECH_GRP.INVTY_ORD_NUM
           ,INVTY_ORD_TECH_GRP.MDSE_CD
    </statement>

    <!-- [RMA] Return -->
    <statement id="getPartsOrdDataRma" parameterClass="Map" resultClass="Map">
        WITH SCUBE_MDSE_V AS
        (
                SELECT
                    A1.MDSE_CD
                   ,A1.SPLY_ITEM_NUM
                   ,A1.GLBL_CMPY_CD
                   ,CPV.P_CODE_VENDR   AS CUSA_VND_CD
                FROM
                    ASL_DTL A1
                    ,(SELECT
                          AD.GLBL_CMPY_CD
                         ,AD.ASL_DTL_PK
                         ,ROW_NUMBER() OVER (PARTITION BY AD.MDSE_CD ORDER BY NVL(AD.EFF_FROM_DT, #effFromDtDefalut#) DESC) IDX
                    FROM
                        ASL_DTL AD
                       ,PRNT_CMPY_VND PV
                    WHERE
                        AD.GLBL_CMPY_CD      = PV.GLBL_CMPY_CD
                    AND PV.PRNT_CMPY_VND_CD  = AD.VND_CD
                    <iterate property="vndSysTpCdList" var="vndSysTpCdList[]" open="AND PV.VND_SYS_TP_CD IN (" close=")" conjunction=",">
                        #vndSysTpCdList[]#
                    </iterate>
                    AND AD.EZCANCELFLAG      = '0'
                    AND PV.EZCANCELFLAG      = '0'
                    ) A2
                    ,CSA_PRT_V     CPV
                    ,DS_COND_CONST DCC
                WHERE
                    A1.GLBL_CMPY_CD          = A2.GLBL_CMPY_CD
                AND A1.ASL_DTL_PK            = A2.ASL_DTL_PK
                <!-- QC#30964 Add SQL. -->
                <isNotNull property="exclMdseCdList">
                    <iterate property="exclMdseCdList" var="exclMdseCdList[]" open="AND A1.MDSE_CD NOT IN (" close=")" conjunction=",">
                    #exclMdseCdList[]#
                    </iterate> 
                </isNotNull>
                AND A2.IDX                   = #IDX_1#
                AND CPV.P_PARTS_NUM          = A1.SPLY_ITEM_NUM
                AND CPV.P_CODE_VENDR         = DCC.DS_COND_CONST_VAL_TXT_01
                AND DCC.GLBL_CMPY_CD         = A1.GLBL_CMPY_CD
                AND DCC.DS_COND_CONST_GRP_ID = #dsCondConstGrpIdCusaVndCd#
                AND A1.EZCANCELFLAG          = '0'
                AND CPV.EZCANCELFLAG         = '0'
                AND DCC.EZCANCELFLAG         = '0'
        )
        ,RTRN_ORD AS
        (
        <!-- Return - NEW -->
            SELECT
                C.GLBL_CMPY_CD
               ,C.CPO_ORD_NUM
               ,DCRD.CPO_ORD_TS
               ,C.SELL_TO_CUST_CD
               ,C.BILL_TO_CUST_CD
               ,DCRD.MDSE_CD
               ,DCRD.ORD_QTY
               ,DCRD.RQST_PICK_UP_DT
               ,SMV.CUSA_VND_CD
               ,'RETURN_NEW' AS                   INTFC_CATG_TXT
                ,(SELECT
                      CASE
                        WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE RW.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE RW.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE RW.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        ELSE (SELECT
                                  CGWC.CINC_GLBL_WH_CD
                              FROM
                                  CINC_GLBL_WH_CONV CGWC
                              WHERE CGWC.GLBL_CMPY_CD  = #glblCmpyCd#
                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                              AND CGWC.EZCANCELFLAG    = '0')
                        END AS CINC_GLBL_WH_CD_EN
                 FROM
                    (SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD          = CGWC.GLBL_CMPY_CD
                     AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                    ) A
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) B
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) C
                ) AS CINC_GLBL_WH_CD
            FROM
                CPO             C
               ,DS_CPO_RTRN_DTL DCRD
               ,DS_INVTY_LOC_V  DIL
               ,RTL_WH          RW
               ,INVTY_OWNR      IO
               ,MDSE            M
               ,SCUBE_MDSE_V    SMV
            WHERE
                C.GLBL_CMPY_CD            = #glblCmpyCd#
            <!-- DS_CPO_RTRN_DTL JOIN -->
            AND C.CPO_ORD_NUM             = DCRD.CPO_ORD_NUM
            AND C.GLBL_CMPY_CD            = DCRD.GLBL_CMPY_CD
            AND DCRD.CPO_ORD_TS        &gt; #cpoOrdTs#
            AND DCRD.SUBMT_FLG            = #submitFlg#
            AND DCRD.CPO_DTL_CANC_FLG     = #cpoDtlCancFlgN#
            <iterate property="exclLocCdList" var="exclLocCdList[]" open="AND DCRD.INVTY_LOC_CD NOT IN (" close=")" conjunction=",">
                #exclLocCdList[]#
            </iterate> 
            <!-- DS_INVTY_LOC_V JOIN -->
            AND DCRD.GLBL_CMPY_CD         = DIL.GLBL_CMPY_CD
            AND DCRD.INVTY_LOC_CD         = DIL.INVTY_LOC_CD
            <isNotNull property="technician">
            AND DIL.INVTY_LOC_TP_CD     != #technician#
            </isNotNull>
            <!-- RTL_WH JOIN -->
            AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
            AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
            <!-- INVTY_OWNR JOIN -->
            AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
            AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
            AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
            <!-- MDSE JOIN -->
            AND DCRD.GLBL_CMPY_CD         = M.GLBL_CMPY_CD
            AND DCRD.MDSE_CD              = M.MDSE_CD
            AND M.INVTY_CTRL_FLG          = #invtyCtrlFlg#
            <!-- SCUBE_MDSE_V JOIN -->
            AND M.GLBL_CMPY_CD            = SMV.GLBL_CMPY_CD
            AND M.MDSE_CD                 = SMV.MDSE_CD
            AND C.EZCANCELFLAG            = '0'
            AND DCRD.EZCANCELFLAG         = '0'
            AND DIL.EZCANCELFLAG          = '0'
            AND RW.EZCANCELFLAG           = '0'
            AND IO.EZCANCELFLAG           = '0'
            AND M.EZCANCELFLAG            = '0'
            <!-- Add Start 2020/02/03 QC#55572 -->
            <isNotNull property="exclSwhCdList">
            AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                #exclSwhCdList[]#
                </iterate>
            </isNotNull>
            <!-- Add End 2020/02/03 QC#55572 -->
        <!-- Return - CANCEL -->
        UNION ALL
            SELECT
                C.GLBL_CMPY_CD
               ,C.CPO_ORD_NUM
               ,DCRD.CPO_ORD_TS
               ,C.SELL_TO_CUST_CD
               ,C.BILL_TO_CUST_CD
               ,DCRD.MDSE_CD
               ,DCRD.ORD_QTY
               ,DCRD.RQST_PICK_UP_DT
               ,SMV.CUSA_VND_CD
               ,'RETURN_CANCEL'  AS               INTFC_CATG_TXT
                ,(SELECT
                      CASE
                        WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE RW.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE RW.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE RW.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                              AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        ELSE (SELECT
                                  CGWC.CINC_GLBL_WH_CD
                              FROM
                                  CINC_GLBL_WH_CONV CGWC
                              WHERE CGWC.GLBL_CMPY_CD  = #glblCmpyCd#
                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                              AND CGWC.EZCANCELFLAG    = '0')
                        END AS CINC_GLBL_WH_CD_EN
                 FROM
                    (SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD          = CGWC.GLBL_CMPY_CD
                     AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                    ) A
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) B
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) C
                ) AS CINC_GLBL_WH_CD
            FROM
                CPO             C
               ,DS_CPO_RTRN_DTL DCRD
               ,DS_INVTY_LOC_V  DIL
               ,RTL_WH          RW
               ,INVTY_OWNR      IO
               ,MDSE            M
               ,SCUBE_MDSE_V    SMV
            WHERE
                C.GLBL_CMPY_CD            = #glblCmpyCd#
            <!-- DS_CPO_RTRN_DTL JOIN -->
            AND C.CPO_ORD_NUM             = DCRD.CPO_ORD_NUM
            AND C.GLBL_CMPY_CD            = DCRD.GLBL_CMPY_CD
            AND DCRD.CPO_ORD_TS       &lt;= #cpoOrdTs#
            AND DCRD.CPO_DTL_CANC_DT   &gt; #cpoOrdTs#
            AND DCRD.CPO_DTL_CANC_FLG     = #cpoDtlCancFlgY#
            <iterate property="exclLocCdList" var="exclLocCdList[]" open="AND DCRD.INVTY_LOC_CD NOT IN (" close=")" conjunction=",">
                #exclLocCdList[]#
            </iterate> 
            <!-- DS_INVTY_LOC_V JOIN -->
            AND DCRD.GLBL_CMPY_CD         = DIL.GLBL_CMPY_CD
            AND DCRD.INVTY_LOC_CD         = DIL.INVTY_LOC_CD
            <isNotNull property="technician">
            AND DIL.INVTY_LOC_TP_CD     != #technician#
            </isNotNull>
            <!-- RTL_WH JOIN -->
            AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
            AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
            <!-- INVTY_OWNR JOIN -->
            AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
            AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
            AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
            <!-- MDSE JOIN -->
            AND DCRD.GLBL_CMPY_CD         = M.GLBL_CMPY_CD
            AND DCRD.MDSE_CD              = M.MDSE_CD
            AND M.INVTY_CTRL_FLG          = #invtyCtrlFlg#
            <!-- SCUBE_MDSE_V JOIN -->
            AND M.GLBL_CMPY_CD            = SMV.GLBL_CMPY_CD
            AND M.MDSE_CD                 = SMV.MDSE_CD
            AND C.EZCANCELFLAG            = '0'
            AND DCRD.EZCANCELFLAG         = '0'
            AND DIL.EZCANCELFLAG          = '0'
            AND RW.EZCANCELFLAG           = '0'
            AND IO.EZCANCELFLAG           = '0'
            AND M.EZCANCELFLAG            = '0'
            <!-- Add Start 2020/02/03 QC#55572 -->
            <isNotNull property="exclSwhCdList">
            AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                #exclSwhCdList[]#
                </iterate>
            </isNotNull>
            <!-- Add End 2020/02/03 QC#55572 -->
        )
        SELECT
             RTRN_ORD_GRP.CPO_ORD_TS              AS INTFC_CPO_ORD_DT
            ,RTRN_ORD_GRP.CPO_ORD_NUM             AS INTFC_CPO_ORD_NUM
            ,RTRN_ORD_GRP.MDSE_CD                 AS INTFC_PRT_MDSE_CD
            ,RTRN_ORD_GRP.SELL_TO_CUST_CD         AS INTFC_SELL_TO_CUST_CD
            ,RTRN_ORD_GRP.ORD_QTY                 AS INTFC_ORD_QTY
            ,GC.GLBL_CMPY_CD                      AS CINC_SHIP_TO_GLBL_CMPY_CD
            ,GC.GLBL_CMPY_CD                      AS CINC_BILL_TO_GLBL_CMPY_CD
            ,RTRN_ORD_GRP.RQST_PICK_UP_DT
            ,RTRN_ORD_GRP.INTFC_CATG_TXT
            ,RTRN_ORD_GRP.CUSA_VND_CD
            ,RTRN_ORD_GRP.CINC_GLBL_WH_CD
            ,#trdPtnrShpgMethCdOther#             AS TRD_PTNR_SHPG_METH_CD
        FROM
            <!-- QC#30961 Update RTRN_ORD_GRP -->
            (
                SELECT
                    *
                FROM
                    (
                    SELECT
                        GLBL_CMPY_CD
                       ,CPO_ORD_TS
                       ,CPO_ORD_NUM
                       ,MDSE_CD
                       ,MIN(RQST_PICK_UP_DT)     AS RQST_PICK_UP_DT
                       ,MAX(SELL_TO_CUST_CD)     AS SELL_TO_CUST_CD
                       ,MAX(BILL_TO_CUST_CD)     AS BILL_TO_CUST_CD
                       ,SUM(ORD_QTY)             AS ORD_QTY
                       ,INTFC_CATG_TXT
                       ,CUSA_VND_CD
                       ,CINC_GLBL_WH_CD
                    FROM
                       RTRN_ORD
                    GROUP BY
                        RTRN_ORD.GLBL_CMPY_CD
                       ,RTRN_ORD.CPO_ORD_TS
                       ,RTRN_ORD.CPO_ORD_NUM
                       ,RTRN_ORD.MDSE_CD
                       ,RTRN_ORD.INTFC_CATG_TXT
                       ,RTRN_ORD.CUSA_VND_CD
                       ,RTRN_ORD.CINC_GLBL_WH_CD
                    ) A
                WHERE
                    A.ORD_QTY != 0
            ) RTRN_ORD_GRP
            ,BILL_TO_CUST   BT
            ,GLBL_CMPY      GC
        WHERE
            RTRN_ORD_GRP.GLBL_CMPY_CD             =    BT.GLBL_CMPY_CD (+)
        AND RTRN_ORD_GRP.BILL_TO_CUST_CD          =    BT.BILL_TO_CUST_CD (+)
        AND BT.COA_AFFL_CD                        =    GC.COA_AFFL_CD (+)
        AND BT.EZCANCELFLAG (+)                   =    '0'
        AND GC.EZCANCELFLAG (+)                   =    '0'
        ORDER BY
            CPO_ORD_TS
           ,CPO_ORD_NUM
           ,MDSE_CD
    </statement>

    <!-- [CPO] Stock Out -->
    <statement id="getPartsOrdDataCpo" parameterClass="Map" resultClass="Map">
        WITH SCUBE_MDSE_V AS
        (
            SELECT
                A1.MDSE_CD
               ,A1.SPLY_ITEM_NUM
               ,A1.GLBL_CMPY_CD
               ,CPV.P_CODE_VENDR   AS CUSA_VND_CD
            FROM
                ASL_DTL A1
                ,(SELECT
                      AD.GLBL_CMPY_CD
                     ,AD.ASL_DTL_PK
                     ,ROW_NUMBER() OVER (PARTITION BY AD.MDSE_CD ORDER BY NVL(AD.EFF_FROM_DT, #effFromDtDefalut#) DESC) IDX
                FROM
                    ASL_DTL AD
                   ,PRNT_CMPY_VND PV
                WHERE
                    AD.GLBL_CMPY_CD      = PV.GLBL_CMPY_CD
                AND PV.PRNT_CMPY_VND_CD  = AD.VND_CD
                <iterate property="vndSysTpCdList" var="vndSysTpCdList[]" open="AND PV.VND_SYS_TP_CD IN (" close=")" conjunction=",">
                    #vndSysTpCdList[]#
                </iterate>
                AND AD.EZCANCELFLAG      =    '0'
                AND PV.EZCANCELFLAG      =    '0'
                ) A2
                ,CSA_PRT_V     CPV
                ,DS_COND_CONST DCC
            WHERE
                A1.GLBL_CMPY_CD          = A2.GLBL_CMPY_CD
            AND A1.ASL_DTL_PK            = A2.ASL_DTL_PK
            <!-- QC#30964 Add SQL. -->
            <isNotNull property="exclMdseCdList">
                <iterate property="exclMdseCdList" var="exclMdseCdList[]" open="AND A1.MDSE_CD NOT IN (" close=")" conjunction=",">
                #exclMdseCdList[]#
                </iterate> 
            </isNotNull>
            AND A2.IDX                   = #IDX_1#
            AND CPV.P_PARTS_NUM          = A1.SPLY_ITEM_NUM
            AND CPV.P_CODE_VENDR         = DCC.DS_COND_CONST_VAL_TXT_01
            AND DCC.GLBL_CMPY_CD         = A1.GLBL_CMPY_CD
            AND DCC.DS_COND_CONST_GRP_ID = #dsCondConstGrpIdCusaVndCd#
            AND A1.EZCANCELFLAG          = '0'
            AND CPV.EZCANCELFLAG         = '0'
            AND DCC.EZCANCELFLAG         = '0'
        ), STKOUT_ORD AS
        (
            SELECT
                C.GLBL_CMPY_CD
               ,CD.CPO_ORD_TS
               ,C.CPO_ORD_NUM
               ,C.SELL_TO_CUST_CD
               ,CD.MDSE_CD
               ,CD.ORD_QTY
               ,CD.EXPD_SHIP_DT
               ,C.BILL_TO_CUST_CD
               ,SMV.CUSA_VND_CD
               ,CD.SHPG_SVC_LVL_CD
               ,CD.RDD_DT
               ,'NEW'                     AS INTFC_CATG_TXT
               ,(SELECT
                CASE WHEN CD.SHPG_SVC_LVL_CD IS NULL THEN #trdPtnrShpgMethCdOther#
                     WHEN AA.CNT_A &gt; 0 THEN (
                         SELECT
                             TPSXR.TRD_PTNR_SHPG_METH_CD
                         FROM
                             TRD_PTNR_SHPG_X_REF TPSXR
                         WHERE
                             TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                         AND TPSXR.VND_CD (+)          = #scubeIfCincVndCd#
                         AND TPSXR.CARR_CD             = CD.CARR_CD
                         AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                         AND TPSXR.FRT_COND_CD         = #frtCondCdAst#
                         AND TPSXR.EZCANCELFLAG        = '0')
                     WHEN BB.CNT_B &gt; 0 THEN (
                         SELECT
                            TPSXR.TRD_PTNR_SHPG_METH_CD
                         FROM
                            TRD_PTNR_SHPG_X_REF TPSXR
                         WHERE
                             TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                         AND TPSXR.VND_CD              = #scubeIfCincVndCd#
                         AND TPSXR.CARR_CD             = #carrCdAst#
                         AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                         AND TPSXR.FRT_COND_CD         = #frtCondCdAst#
                         AND TPSXR.EZCANCELFLAG        = '0')
                     ELSE #trdPtnrShpgMethCdOther#
                     END AS CINC_GLBL_WH_CD_EN
                FROM
                   (SELECT
                        COUNT(TPSXR.TRD_PTNR_SHPG_METH_CD) AS CNT_A
                    FROM
                        TRD_PTNR_SHPG_X_REF TPSXR
                    WHERE
                        TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                    AND TPSXR.VND_CD (+)          = #scubeIfCincVndCd#
                    AND TPSXR.CARR_CD             = CD.CARR_CD
                    AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                    AND TPSXR.FRT_COND_CD         = #frtCondCdAst#
                    AND ROWNUM                    = #numOne#
                    AND TPSXR.EZCANCELFLAG        = '0') AA
                  ,(SELECT
                        COUNT(TPSXR.TRD_PTNR_SHPG_METH_CD) AS CNT_B
                    FROM
                        TRD_PTNR_SHPG_X_REF TPSXR
                    WHERE
                        TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                    AND TPSXR.VND_CD              = #scubeIfCincVndCd#
                    AND TPSXR.CARR_CD             = #carrCdAst#
                    AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                    AND TPSXR.FRT_COND_CD         = #frtCondCdAst#
                    AND ROWNUM                    = #numOne#
                    AND TPSXR.EZCANCELFLAG        = '0') BB
                ) AS TRD_PTNR_SHPG_METH_CD
                ,(SELECT
                      CASE
                        WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        ELSE (SELECT
                                  CGWC.CINC_GLBL_WH_CD
                              FROM
                                  CINC_GLBL_WH_CONV CGWC
                              WHERE CGWC.GLBL_CMPY_CD  = #glblCmpyCd#
                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                              AND CGWC.EZCANCELFLAG    = '0')
                        END AS CINC_GLBL_WH_CD_EN
                 FROM
                    (SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                    ) A
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) B
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND ROWNUM               = #numOne#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) C
                ) AS CINC_GLBL_WH_CD
            FROM
                CPO            C
               ,CPO_DTL        CD
               ,DS_INVTY_LOC_V DIL
               ,RTL_WH         RW
               ,INVTY_OWNR     IO
               ,MDSE           M
               ,SCUBE_MDSE_V   SMV
            WHERE
                C.GLBL_CMPY_CD            = #glblCmpyCd#
            AND NOT EXISTS (
                SELECT 1 FROM DS_COND_CONST DCC
                WHERE
                    C.GLBL_CMPY_CD            = DCC.GLBL_CMPY_CD
                AND DCC.DS_COND_CONST_GRP_ID  = #dsCondConstGrpIdDsOrdTp#
                AND C.DS_ORD_TP_CD            = DCC.DS_COND_CONST_VAL_TXT_01
                AND DCC.EZCANCELFLAG          = '0'
            )
            AND C.GLBL_CMPY_CD            = CD.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM             = CD.CPO_ORD_NUM
            AND CD.CPO_ORD_TS          &gt; #cpoOrdTs#
            AND CD.SUBMT_FLG              = #submitFlg#
            AND CD.CPO_DTL_CANC_FLG       = #cpoDtlCancFlgN#
            <iterate property="exclLocCdList" var="exclLocCdList[]" open="AND DIL.INVTY_LOC_CD NOT IN (" close=")" conjunction=",">
                #exclLocCdList[]#
            </iterate> 
            AND CD.GLBL_CMPY_CD           = DIL.GLBL_CMPY_CD
            AND CD.RTL_WH_CD              = DIL.RTL_WH_CD
            AND NVL(CD.RTL_SWH_CD,'1')    = NVL(DIL.RTL_SWH_CD,'1')
            <isNotNull property="technician">
            AND DIL.INVTY_LOC_TP_CD     != #technician#
            </isNotNull>
            AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
            AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
            AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
            AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
            AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
            AND CD.GLBL_CMPY_CD           = M.GLBL_CMPY_CD
            AND CD.MDSE_CD                = M.MDSE_CD
            AND M.INVTY_CTRL_FLG          = #invtyCtrlFlg#
            AND CD.GLBL_CMPY_CD           = SMV.GLBL_CMPY_CD
            AND CD.MDSE_CD                = SMV.MDSE_CD
            AND C.EZCANCELFLAG            = '0'
            AND CD.EZCANCELFLAG           = '0'
            AND DIL.EZCANCELFLAG          = '0'
            AND RW.EZCANCELFLAG           = '0'
            AND IO.EZCANCELFLAG           = '0'
            AND M.EZCANCELFLAG            = '0'
            <!-- Add Start 2020/02/03 QC#55572 -->
            <isNotNull property="exclSwhCdList">
            AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                #exclSwhCdList[]#
                </iterate>
            </isNotNull>
            <!-- Add End 2020/02/03 QC#55572 -->
        UNION ALL
            SELECT
                C.GLBL_CMPY_CD
               ,CD.CPO_ORD_TS
               ,C.CPO_ORD_NUM
               ,C.SELL_TO_CUST_CD
               ,CD.MDSE_CD
               ,CD.ORD_QTY
               ,CD.EXPD_SHIP_DT
               ,C.BILL_TO_CUST_CD
               ,SMV.CUSA_VND_CD
               ,CD.SHPG_SVC_LVL_CD
               ,CD.RDD_DT
               ,'CANCEL'                     AS INTFC_CATG_TXT
               ,(SELECT
                CASE WHEN CD.SHPG_SVC_LVL_CD IS NULL THEN #trdPtnrShpgMethCdOther#
                     WHEN AA.CNT_A &gt; 0 THEN (
                         SELECT
                             TPSXR.TRD_PTNR_SHPG_METH_CD
                         FROM
                             TRD_PTNR_SHPG_X_REF TPSXR
                         WHERE
                             TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                         AND TPSXR.VND_CD (+)          = #scubeIfCincVndCd#
                         AND TPSXR.CARR_CD             = CD.CARR_CD
                         AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                         AND TPSXR.FRT_COND_CD         = #frtCondCdAst#
                         AND TPSXR.EZCANCELFLAG        = '0')
                     WHEN BB.CNT_B &gt; 0 THEN (
                         SELECT
                            TPSXR.TRD_PTNR_SHPG_METH_CD
                         FROM
                            TRD_PTNR_SHPG_X_REF TPSXR
                         WHERE
                             TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                         AND TPSXR.VND_CD              = #scubeIfCincVndCd#
                         AND TPSXR.CARR_CD             = #carrCdAst#
                         AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                         AND TPSXR.FRT_COND_CD         = #frtCondCdAst#
                         AND TPSXR.EZCANCELFLAG        = '0')
                     ELSE #trdPtnrShpgMethCdOther#
                     END AS CINC_GLBL_WH_CD_EN
                FROM
                   (SELECT
                        COUNT(TPSXR.TRD_PTNR_SHPG_METH_CD) AS CNT_A
                    FROM
                        TRD_PTNR_SHPG_X_REF TPSXR
                    WHERE
                        TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                    AND TPSXR.VND_CD (+)          = #scubeIfCincVndCd#
                    AND TPSXR.CARR_CD             = CD.CARR_CD
                    AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                    AND TPSXR.FRT_COND_CD         = #frtCondCdAst#
                    AND ROWNUM                    = #numOne#
                    AND TPSXR.EZCANCELFLAG        = '0') AA
                  ,(SELECT
                        COUNT(TPSXR.TRD_PTNR_SHPG_METH_CD) AS CNT_B
                    FROM
                        TRD_PTNR_SHPG_X_REF TPSXR
                    WHERE
                        TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                    AND TPSXR.VND_CD              = #scubeIfCincVndCd#
                    AND TPSXR.CARR_CD             = #carrCdAst#
                    AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                    AND TPSXR.FRT_COND_CD         = #frtCondCdAst#
                    AND ROWNUM                    = #numOne#
                    AND TPSXR.EZCANCELFLAG        = '0') BB
                ) AS TRD_PTNR_SHPG_METH_CD
                ,(SELECT
                      CASE
                        WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                  CGWC.CINC_GLBL_WH_CD
                                              FROM
                                                  CINC_GLBL_WH_CONV CGWC
                                              WHERE
                                                  RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                              AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                        ELSE (SELECT
                                  CGWC.CINC_GLBL_WH_CD
                              FROM
                                  CINC_GLBL_WH_CONV CGWC
                              WHERE CGWC.RTL_WH_CD       = #rtlWhCdAst#
                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                              AND CGWC.EZCANCELFLAG    = '0')
                        END AS CINC_GLBL_WH_CD_EN
                 FROM
                    (SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.RTL_WH_CD         = CGWC.RTL_WH_CD
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND CGWC.EZCANCELFLAG    = '0'
                    ) A
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.LOC_TP_CD       = #locTpCdAst#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) B
                   ,(SELECT
                         COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                     FROM
                         CINC_GLBL_WH_CONV CGWC
                     WHERE
                         RW.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                     AND RW.LOC_TP_CD         = CGWC.LOC_TP_CD
                     AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                     AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                     AND CGWC.EZCANCELFLAG    = '0'
                   ) C
                ) AS CINC_GLBL_WH_CD
            FROM
                CPO            C
               ,CPO_DTL        CD
               ,DS_INVTY_LOC_V DIL
               ,RTL_WH         RW
               ,INVTY_OWNR     IO
               ,MDSE           M
               ,SCUBE_MDSE_V   SMV
            WHERE
                C.GLBL_CMPY_CD            = #glblCmpyCd#
            AND NOT EXISTS (
                SELECT 1 FROM DS_COND_CONST DCC
                WHERE
                    C.GLBL_CMPY_CD            = DCC.GLBL_CMPY_CD
                AND DCC.DS_COND_CONST_GRP_ID  = #dsCondConstGrpIdDsOrdTp#
                AND C.DS_ORD_TP_CD            = DCC.DS_COND_CONST_VAL_TXT_01
                AND DCC.EZCANCELFLAG          = '0'
            )
            AND C.GLBL_CMPY_CD            = CD.GLBL_CMPY_CD
            AND C.CPO_ORD_NUM             = CD.CPO_ORD_NUM
            AND CD.CPO_ORD_TS         &lt;= #cpoOrdTs#
            AND CD.SUBMT_FLG              = #submitFlg#
            AND CD.CPO_DTL_CANC_DT     &gt; #cpoOrdTs#
            AND CD.CPO_DTL_CANC_FLG       = #cpoDtlCancFlgY#
            <iterate property="exclLocCdList" var="exclLocCdList[]" open="AND DIL.INVTY_LOC_CD NOT IN (" close=")" conjunction=",">
                #exclLocCdList[]#
            </iterate> 
            AND CD.GLBL_CMPY_CD           = DIL.GLBL_CMPY_CD
            AND CD.RTL_WH_CD              = DIL.RTL_WH_CD
            AND NVL(CD.RTL_SWH_CD,'1')    = NVL(DIL.RTL_SWH_CD,'1')
            <isNotNull property="technician">
            AND DIL.INVTY_LOC_TP_CD     != #technician#
            </isNotNull>
            AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
            AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
            AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
            AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
            AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
            AND CD.GLBL_CMPY_CD           = M.GLBL_CMPY_CD
            AND CD.MDSE_CD                = M.MDSE_CD
            AND M.INVTY_CTRL_FLG          = #invtyCtrlFlg#
            AND CD.GLBL_CMPY_CD           = SMV.GLBL_CMPY_CD
            AND CD.MDSE_CD                = SMV.MDSE_CD
            AND C.EZCANCELFLAG            = '0'
            AND CD.EZCANCELFLAG           = '0'
            AND DIL.EZCANCELFLAG          = '0'
            AND RW.EZCANCELFLAG           = '0'
            AND IO.EZCANCELFLAG           = '0'
            AND M.EZCANCELFLAG            = '0'
            <!-- Add Start 2020/02/03 QC#55572 -->
            <isNotNull property="exclSwhCdList">
            AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                #exclSwhCdList[]#
                </iterate>
            </isNotNull>
            <!-- Add End 2020/02/03 QC#55572 -->
        )
        SELECT
             STKOUT_ORD_GRP.CPO_ORD_TS        AS INTFC_CPO_ORD_DT
            ,STKOUT_ORD_GRP.CPO_ORD_NUM       AS INTFC_CPO_ORD_NUM
            ,STKOUT_ORD_GRP.SELL_TO_CUST_CD   AS INTFC_SELL_TO_CUST_CD
            ,STKOUT_ORD_GRP.MDSE_CD           AS INTFC_PRT_MDSE_CD
            ,STKOUT_ORD_GRP.ORD_QTY           AS INTFC_ORD_QTY
            ,STKOUT_ORD_GRP.EXPD_SHIP_DT      AS INTFC_EXPD_SHIP_DT
            ,STKOUT_ORD_GRP.RDD_DT            AS INTFC_RDD_DT
            ,GC.GLBL_CMPY_CD                  AS CINC_SHIP_TO_GLBL_CMPY_CD
            ,GC.GLBL_CMPY_CD                  AS CINC_BILL_TO_GLBL_CMPY_CD
            ,STKOUT_ORD_GRP.CUSA_VND_CD
            ,STKOUT_ORD_GRP.TRD_PTNR_SHPG_METH_CD
            ,STKOUT_ORD_GRP.CINC_GLBL_WH_CD
            ,STKOUT_ORD_GRP.SHPG_SVC_LVL_CD
            ,STKOUT_ORD_GRP.INTFC_CATG_TXT
        FROM
            <!-- QC#30961 Update STKOUT_ORD_GRP -->
            (
                SELECT
                    *
                FROM
                    (
                    SELECT
                         GLBL_CMPY_CD
                        ,CPO_ORD_NUM
                        ,MDSE_CD
                        ,TRD_PTNR_SHPG_METH_CD
                        ,CPO_ORD_TS
                        ,EXPD_SHIP_DT
                        ,CUSA_VND_CD
                        ,CINC_GLBL_WH_CD
                        ,INTFC_CATG_TXT
                        ,SUM(ORD_QTY) ORD_QTY
                        ,MAX(SELL_TO_CUST_CD) AS SELL_TO_CUST_CD
                        ,MAX(BILL_TO_CUST_CD) AS BILL_TO_CUST_CD
                        ,MAX(SHPG_SVC_LVL_CD) AS SHPG_SVC_LVL_CD
                        ,MIN(RDD_DT)          AS RDD_DT
                    FROM
                       STKOUT_ORD
                    GROUP BY
                         STKOUT_ORD.GLBL_CMPY_CD
                        ,STKOUT_ORD.CPO_ORD_NUM
                        ,STKOUT_ORD.MDSE_CD
                        ,STKOUT_ORD.TRD_PTNR_SHPG_METH_CD
                        ,STKOUT_ORD.CPO_ORD_TS
                        ,STKOUT_ORD.EXPD_SHIP_DT
                        ,STKOUT_ORD.CUSA_VND_CD
                        ,STKOUT_ORD.CINC_GLBL_WH_CD
                        ,STKOUT_ORD.INTFC_CATG_TXT
                    ) A
                 WHERE
                     A.ORD_QTY != 0
            ) STKOUT_ORD_GRP
            ,BILL_TO_CUST   BT
            ,GLBL_CMPY      GC
        WHERE
            STKOUT_ORD_GRP.GLBL_CMPY_CD           =    BT.GLBL_CMPY_CD (+)
        AND STKOUT_ORD_GRP.BILL_TO_CUST_CD        =    BT.BILL_TO_CUST_CD (+)
        AND BT.COA_AFFL_CD                        =    GC.COA_AFFL_CD (+)
        AND BT.EZCANCELFLAG (+)                   =    '0'
        AND GC.EZCANCELFLAG (+)                   =    '0'
        ORDER BY
             CPO_ORD_TS
            ,CPO_ORD_NUM
            ,MDSE_CD
    </statement>

    <!-- [CPO] WH Transfer -->
    <statement id="getPartsOrdDataCpoWhTrsfr" parameterClass="Map" resultClass="Map">
        WITH SCUBE_MDSE_V AS(
               SELECT
                   A1.MDSE_CD
                   ,A1.SPLY_ITEM_NUM
                   ,A1.GLBL_CMPY_CD
                   ,CPV.P_CODE_VENDR   AS CUSA_VND_CD
               FROM
                   ASL_DTL A1
                   ,(SELECT
                         AD.GLBL_CMPY_CD
                         ,AD.ASL_DTL_PK
                         ,ROW_NUMBER() OVER (PARTITION BY AD.MDSE_CD ORDER BY NVL(AD.EFF_FROM_DT, #effFromDtDefalut#) DESC) IDX
                     FROM
                         ASL_DTL AD
                         ,PRNT_CMPY_VND PV
                     WHERE
                         AD.GLBL_CMPY_CD      = PV.GLBL_CMPY_CD
                     AND PV.PRNT_CMPY_VND_CD  = AD.VND_CD
                     <iterate property="vndSysTpCdList" var="vndSysTpCdList[]" open="AND PV.VND_SYS_TP_CD IN (" close=")" conjunction=",">
                       #vndSysTpCdList[]#
                     </iterate>
                     AND AD.EZCANCELFLAG      =    '0'
                     AND PV.EZCANCELFLAG      =    '0'
                   ) A2
                   ,CSA_PRT_V     CPV
                   ,DS_COND_CONST DCC
               WHERE
                   A1.GLBL_CMPY_CD          = A2.GLBL_CMPY_CD
               AND A1.ASL_DTL_PK            = A2.ASL_DTL_PK
               <!-- QC#30964 Add SQL. -->
               <isNotNull property="exclMdseCdList">
                   <iterate property="exclMdseCdList" var="exclMdseCdList[]" open="AND A1.MDSE_CD NOT IN (" close=")" conjunction=",">
                   #exclMdseCdList[]#
                   </iterate> 
               </isNotNull>
               AND A2.IDX                   = #numOne#
               AND CPV.P_PARTS_NUM          = A1.SPLY_ITEM_NUM
               AND CPV.P_CODE_VENDR         = DCC.DS_COND_CONST_VAL_TXT_01
               AND DCC.GLBL_CMPY_CD         = A1.GLBL_CMPY_CD
               AND DCC.DS_COND_CONST_GRP_ID = #dsCondConstGrpId#
               AND A1.EZCANCELFLAG          = '0'
               AND CPV.EZCANCELFLAG         = '0'
               AND DCC.EZCANCELFLAG         = '0'
        )
        ,WH_TRNSFR_ORD AS (
                SELECT
                    C.GLBL_CMPY_CD
                            ,C.CPO_ORD_NUM
                            ,CD.MDSE_CD
                            ,CD.CPO_ORD_TS
                            ,C.SELL_TO_CUST_CD
                            ,C.BILL_TO_CUST_CD
                            ,CD.ORD_QTY
                            ,CD.EXPD_SHIP_DT
                            ,SMV.CUSA_VND_CD
                            ,CD.SHPG_SVC_LVL_CD      AS  SHPG_SVC_LVL_CD
                            ,CD.RDD_DT
                            ,'WHT_NEW'               AS  INTFC_CATG_TXT
                            ,(SELECT
                                  CASE WHEN CD.SHPG_SVC_LVL_CD IS NULL THEN #trdPtnrShpgMethCdOther#
                                       WHEN AA.CNT_A &gt; 0 THEN (SELECT
                                                                   TPSXR.TRD_PTNR_SHPG_METH_CD
                                                               FROM
                                                                   TRD_PTNR_SHPG_X_REF TPSXR
                                                               WHERE
                                                                   TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                                                               AND TPSXR.VND_CD (+)          = #vndCdCinc#
                                                               AND TPSXR.CARR_CD             = CD.CARR_CD
                                                               AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                                                               AND TPSXR.FRT_COND_CD         = #frtCondCd#
                                                               AND TPSXR.EZCANCELFLAG        = '0')
                                       WHEN BB.CNT_B &gt; 0 THEN (SELECT
                                                                   TPSXR.TRD_PTNR_SHPG_METH_CD
                                                               FROM
                                                                   TRD_PTNR_SHPG_X_REF TPSXR
                                                               WHERE
                                                                   TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                                                               AND TPSXR.VND_CD              = #vndCdCinc#
                                                               AND TPSXR.CARR_CD             = #carrCd#
                                                               AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                                                               AND TPSXR.FRT_COND_CD         = #frtCondCd#
                                                               AND TPSXR.EZCANCELFLAG        = '0')
                                       ELSE #trdPtnrShpgMethCdOther#
                                  END AS CINC_GLBL_WH_CD_EN
                              FROM
                                  (SELECT
                                       COUNT(TPSXR.TRD_PTNR_SHPG_METH_CD) AS CNT_A
                                   FROM
                                       TRD_PTNR_SHPG_X_REF TPSXR
                                   WHERE
                                       TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                                   AND TPSXR.VND_CD (+)          = #vndCdCinc#
                                   AND TPSXR.CARR_CD             = CD.CARR_CD
                                   AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                                   AND TPSXR.FRT_COND_CD         = #frtCondCd#
                                   AND ROWNUM                    = #numOne#
                                   AND TPSXR.EZCANCELFLAG        = '0') AA
                                  ,(SELECT
                                        COUNT(TPSXR.TRD_PTNR_SHPG_METH_CD) AS CNT_B
                                    FROM
                                        TRD_PTNR_SHPG_X_REF TPSXR
                                    WHERE
                                        TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                                    AND TPSXR.VND_CD              = #vndCdCinc#
                                    AND TPSXR.CARR_CD             = #carrCd#
                                    AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                                    AND TPSXR.FRT_COND_CD         = #frtCondCd#
                                    AND ROWNUM                    = #numOne#
                                    AND TPSXR.EZCANCELFLAG        = '0') BB
                                  ) AS TRD_PTNR_SHPG_METH_CD
                                  ,(SELECT
                                        CASE
                                            WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                                       CGWC.CINC_GLBL_WH_CD
                                                                   FROM
                                                                       CINC_GLBL_WH_CONV CGWC
                                                                   WHERE INVTY_LOC_CD_FROM.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                                                     AND INVTY_LOC_CD_FROM.RTL_WH_CD       = CGWC.RTL_WH_CD
                                                                     AND CGWC.WH_OWNR_CD                   = #whOwnrCdAst#
                                                                     AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                                                                     AND CGWC.EZCANCELFLAG                 = '0')
                                            WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                                       CGWC.CINC_GLBL_WH_CD
                                                                   FROM
                                                                       CINC_GLBL_WH_CONV CGWC
                                                                   WHERE INVTY_LOC_CD_FROM.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                                                     AND INVTY_LOC_CD_FROM.WH_OWNR_CD      = CGWC.WH_OWNR_CD
                                                                     AND CGWC.RTL_WH_CD                    = #rtlWhCdAst#
                                                                     AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                                                                     AND CGWC.EZCANCELFLAG                 = '0')
                                            WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                                       CGWC.CINC_GLBL_WH_CD
                                                                   FROM
                                                                       CINC_GLBL_WH_CONV CGWC
                                                                   WHERE INVTY_LOC_CD_FROM.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                                                   AND INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD   = CGWC.LOC_TP_CD
                                                                   AND CGWC.RTL_WH_CD                      = #rtlWhCdAst#
                                                                   AND CGWC.WH_OWNR_CD                     = #whOwnrCdAst#
                                                                   AND CGWC.EZCANCELFLAG                   = '0')
                                            ELSE (SELECT
                                                      CGWC.CINC_GLBL_WH_CD
                                                  FROM
                                                      CINC_GLBL_WH_CONV CGWC
                                                  WHERE CGWC.GLBL_CMPY_CD    = #glblCmpyCd#
                                                    AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                                    AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                                    AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                                    AND CGWC.EZCANCELFLAG    = '0')
                                        END AS CINC_GLBL_WH_CD_EN
                                    FROM(SELECT
                                             COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                                         FROM
                                             CINC_GLBL_WH_CONV CGWC
                                         WHERE
                                             INVTY_LOC_CD_FROM.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                         AND INVTY_LOC_CD_FROM.RTL_WH_CD         = CGWC.RTL_WH_CD
                                         AND CGWC.WH_OWNR_CD                     = #whOwnrCdAst#
                                         AND CGWC.LOC_TP_CD                      = #locTpCdAst#
                                         AND ROWNUM                              = #numOne#
                                         AND CGWC.EZCANCELFLAG                   = '0'
                                        ) A
                                        ,(SELECT
                                              COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                                          FROM
                                              CINC_GLBL_WH_CONV CGWC
                                          WHERE
                                              INVTY_LOC_CD_FROM.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                          AND INVTY_LOC_CD_FROM.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                          AND CGWC.RTL_WH_CD                      = #rtlWhCdAst#
                                          AND CGWC.LOC_TP_CD                      = #locTpCdAst#
                                          AND ROWNUM                              = #numOne#
                                          AND CGWC.EZCANCELFLAG                   = '0'
                                        ) B
                                        ,(SELECT
                                              COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                                          FROM
                                              CINC_GLBL_WH_CONV CGWC
                                          WHERE
                                              INVTY_LOC_CD_FROM.GLBL_CMPY_CD          = CGWC.GLBL_CMPY_CD
                                          AND INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD       = CGWC.LOC_TP_CD
                                          AND CGWC.RTL_WH_CD                          = #rtlWhCdAst#
                                          AND CGWC.WH_OWNR_CD                         = #whOwnrCdAst#
                                          AND ROWNUM                                  = #numOne#
                                          AND CGWC.EZCANCELFLAG                       = '0'
                                        ) C
                            ) AS CINC_GLBL_WH_CD
                            ,(SELECT
                                  CASE
                                      WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                                 CGWC.CINC_GLBL_WH_CD
                                                             FROM
                                                                 CINC_GLBL_WH_CONV CGWC
                                                             WHERE INVTY_LOC_CD_TO.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                                             AND INVTY_LOC_CD_TO.RTL_WH_CD         = CGWC.RTL_WH_CD
                                                             AND CGWC.WH_OWNR_CD                   = #whOwnrCdAst#
                                                             AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                                                             AND CGWC.EZCANCELFLAG                 = '0')
                                      WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                                 CGWC.CINC_GLBL_WH_CD
                                                             FROM
                                                                 CINC_GLBL_WH_CONV CGWC
                                                             WHERE INVTY_LOC_CD_TO.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                                             AND INVTY_LOC_CD_TO.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                                             AND CGWC.RTL_WH_CD                    = #rtlWhCdAst#
                                                             AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                                                             AND CGWC.EZCANCELFLAG                 = '0')
                                      WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                                 CGWC.CINC_GLBL_WH_CD
                                                             FROM
                                                                 CINC_GLBL_WH_CONV CGWC
                                                             WHERE INVTY_LOC_CD_TO.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                                             AND INVTY_LOC_CD_TO.INVTY_LOC_TP_CD   = CGWC.LOC_TP_CD
                                                             AND CGWC.RTL_WH_CD                    = #rtlWhCdAst#
                                                             AND CGWC.WH_OWNR_CD                   = #whOwnrCdAst#
                                                             AND CGWC.EZCANCELFLAG                 = '0')
                                      ELSE (SELECT
                                                CGWC.CINC_GLBL_WH_CD
                                            FROM
                                                CINC_GLBL_WH_CONV CGWC
                                            WHERE CGWC.GLBL_CMPY_CD    = #glblCmpyCd#
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                                  END AS CINC_GLBL_WH_CD_EN
                              FROM
                                  (SELECT
                                       COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                                   FROM
                                       CINC_GLBL_WH_CONV CGWC
                                   WHERE
                                       INVTY_LOC_CD_TO.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                   AND INVTY_LOC_CD_TO.RTL_WH_CD         = CGWC.RTL_WH_CD
                                   AND CGWC.WH_OWNR_CD                   = #whOwnrCdAst#
                                   AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                                   AND ROWNUM                            = #numOne#
                                   AND CGWC.EZCANCELFLAG                 = '0'
                                  ) A
                                  ,(SELECT
                                        COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                                   FROM
                                        CINC_GLBL_WH_CONV CGWC
                                   WHERE
                                        INVTY_LOC_CD_TO.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                    AND INVTY_LOC_CD_TO.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                    AND CGWC.RTL_WH_CD                    = #rtlWhCdAst#
                                    AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                                    AND ROWNUM                            = #numOne#
                                    AND CGWC.EZCANCELFLAG                 = '0'
                                  ) B
                                  ,(SELECT
                                        COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                                    FROM
                                        CINC_GLBL_WH_CONV CGWC
                                    WHERE
                                        INVTY_LOC_CD_TO.GLBL_CMPY_CD          = CGWC.GLBL_CMPY_CD
                                    AND INVTY_LOC_CD_TO.INVTY_LOC_TP_CD       = CGWC.LOC_TP_CD
                                    AND CGWC.RTL_WH_CD                        = #rtlWhCdAst#
                                    AND CGWC.WH_OWNR_CD                       = #whOwnrCdAst#
                                    AND ROWNUM                                = #numOne#
                                    AND CGWC.EZCANCELFLAG                     = '0'
                                  ) C
                            ) AS CINC_RCV_GLBL_WH_CD
                            ,(SELECT
                                  CASE
                                      WHEN A1.CNT_A1 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                                               AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                               AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                               AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                                               AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                               AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      WHEN A2.CNT_A2 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                                               AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                               AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                               AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                                               AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                               AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      WHEN A3.CNT_A3 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                                               AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                               AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                               AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                                               AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                               AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      WHEN B1.CNT_B1 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                               AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                                               AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                               AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                                               AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                               AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      WHEN B2.CNT_B2 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                               AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                                               AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                               AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                               AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                                               AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      WHEN B3.CNT_B3 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                               AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                                               AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                               AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                               AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                               AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                                               AND WTCCC.EZCANCELFLAG             = '0') 
                                      WHEN C1.CNT_C1 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                               AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                               AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                                               AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                                               AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                               AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      WHEN C2.CNT_C2 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                    WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                               AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                               AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                                               AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                               AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                                               AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      WHEN C3.CNT_C3 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                               AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                               AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                                               AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                               AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                               AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      ELSE (SELECT
                                                WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                            FROM
                                                WH_TRNSF_CINC_CATG_CONV WTCCC
                                            WHERE
                                                INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                            AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                            AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                            AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                            AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                            AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                            AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                            AND WTCCC.EZCANCELFLAG             = '0')
                                  END AS CINC_GLBL_CMPY_CATG_CD
                              FROM
                                  (SELECT
                                       COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_A1
                                   FROM
                                       WH_TRNSF_CINC_CATG_CONV WTCCC
                                   WHERE
                                       INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                   AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                   AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                   AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                   AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                   AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                   AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                   AND ROWNUM                         = #numOne#
                                   AND WTCCC.EZCANCELFLAG             = '0'
                                  ) A1
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_A2
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                    AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                    AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                    AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                    AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                    AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                    AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                    AND ROWNUM                         = #numOne#
                                    AND WTCCC.EZCANCELFLAG             = '0'
                                  ) A2
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_A3
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                   AND WTCCC.FROM_RTL_WH_CD            = INVTY_LOC_CD_FROM.RTL_WH_CD
                                   AND WTCCC.FROM_WH_OWNR_CD           = #fromWhOwnrCdAst#
                                   AND WTCCC.FROM_LOC_TP_CD            = #fromLocTpCdAst#
                                   AND WTCCC.TO_LOC_TP_CD              = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                   AND WTCCC.TO_RTL_WH_CD              = #toRtlWhCdAst#
                                   AND WTCCC.TO_WH_OWNR_CD             = #toWhOwnrCdAst#
                                   AND ROWNUM                          = #numOne#
                                   AND WTCCC.EZCANCELFLAG              = '0'
                                  ) A3
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_B1
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                    AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                    AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                    AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                    AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                    AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                    AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                    AND ROWNUM                         = #numOne#
                                    AND WTCCC.EZCANCELFLAG             = '0'
                                  ) B1
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_B2
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                    AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                    AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                    AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                    AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                    AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                    AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                    AND ROWNUM                         = #numOne#
                                    AND WTCCC.EZCANCELFLAG             = '0'
                                  ) B2
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_B3
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                    AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                    AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                    AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                    AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                    AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                    AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                    AND ROWNUM                         = #numOne#
                                    AND WTCCC.EZCANCELFLAG             = '0'
                                  ) B3
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_C1
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                    AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                    AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                    AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                    AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                    AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                    AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                    AND ROWNUM                         = #numOne#
                                    AND WTCCC.EZCANCELFLAG             = '0'
                                  ) C1
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_C2
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                    AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                    AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                    AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                    AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                    AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                    AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                    AND ROWNUM                         = #numOne#
                                    AND WTCCC.EZCANCELFLAG             = '0'
                                  ) C2
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_C3
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                    AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                    AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                    AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                    AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                    AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                    AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                    AND ROWNUM                         = #numOne#
                                    AND WTCCC.EZCANCELFLAG             = '0'
                                  ) C3
                            ) AS CINC_GLBL_CMPY_CATG_CD
                FROM
                    CPO            C
                   ,CPO_DTL        CD
                   ,DS_COND_CONST  DCC
                   ,MDSE           M
                   ,SCUBE_MDSE_V   SMV
                   ,(SELECT DISTINCT
                         DIL.INVTY_LOC_CD
                        ,DIL.RTL_WH_CD
                        ,DIL.RTL_SWH_CD
                        ,RW.WH_OWNR_CD
                        ,DIL.INVTY_LOC_TP_CD
                        ,DIL.GLBL_CMPY_CD
                     FROM
                         DS_INVTY_LOC_V DIL
                        ,RTL_WH         RW
                        ,INVTY_OWNR     IO
                     WHERE
                         DIL.GLBL_CMPY_CD          = #glblCmpyCd#
                     <isNotNull property="technician">
                     AND DIL.INVTY_LOC_TP_CD   != #technician#
                     </isNotNull>
                     AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
                     AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
                     AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
                     AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
                     AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
                     AND DIL.EZCANCELFLAG          = '0'
                     AND RW.EZCANCELFLAG           = '0'
                     AND IO.EZCANCELFLAG           = '0'
                     <!-- Add Start 2020/02/03 QC#55572 -->
                     <isNotNull property="exclSwhCdList">
                     AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                         #exclSwhCdList[]#
                         </iterate>
                     </isNotNull>
                     <!-- Add End 2020/02/03 QC#55572 -->
                   ) INVTY_LOC_CD_FROM
                   ,(SELECT DISTINCT
                         DIL.INVTY_LOC_CD
                        ,DIL.RTL_WH_CD
                        ,DIL.RTL_SWH_CD
                        ,RW.WH_OWNR_CD
                        ,DIL.INVTY_LOC_TP_CD
                        ,DIL.GLBL_CMPY_CD
                     FROM
                         DS_INVTY_LOC_V DIL
                        ,RTL_WH         RW
                        ,INVTY_OWNR     IO
                     WHERE
                         DIL.GLBL_CMPY_CD          = #glblCmpyCd#
                     <isNotNull property="technician">
                     AND DIL.INVTY_LOC_TP_CD   != #technician#
                     </isNotNull>
                     AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
                     AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
                     AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
                     AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
                     AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
                     AND DIL.EZCANCELFLAG          = '0'
                     AND RW.EZCANCELFLAG           = '0'
                     AND IO.EZCANCELFLAG           = '0'
                     <!-- Add Start 2020/02/03 QC#55572 -->
                     <isNotNull property="exclSwhCdList">
                     AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                         #exclSwhCdList[]#
                         </iterate>
                     </isNotNull>
                     <!-- Add End 2020/02/03 QC#55572 -->
                   ) INVTY_LOC_CD_TO
                WHERE
                    C.GLBL_CMPY_CD            = #glblCmpyCd#
                AND C.DS_ORD_TP_CD            = DCC.DS_COND_CONST_VAL_TXT_01
                AND DCC.DS_COND_CONST_GRP_ID  = #scubeWhtDsOrdTp#
                AND C.GLBL_CMPY_CD            = DCC.GLBL_CMPY_CD
                AND C.CPO_ORD_NUM             = CD.CPO_ORD_NUM
                AND C.GLBL_CMPY_CD            = CD.GLBL_CMPY_CD
                AND CD.CPO_ORD_TS         &gt;  #cpoOrdTs#
                AND CD.SUBMT_FLG              = #submitFlg#
                AND CD.CPO_DTL_CANC_FLG       = #cpoDtlCancFlgN#
                AND CD.GLBL_CMPY_CD           = INVTY_LOC_CD_FROM.GLBL_CMPY_CD
                AND CD.RTL_WH_CD              = INVTY_LOC_CD_FROM.RTL_WH_CD
                AND NVL(CD.RTL_SWH_CD,'*')    = NVL(INVTY_LOC_CD_FROM.RTL_SWH_CD,'*')
                AND CD.GLBL_CMPY_CD           = INVTY_LOC_CD_TO.GLBL_CMPY_CD
                AND CD.SHIP_TO_CUST_CD        = INVTY_LOC_CD_TO.INVTY_LOC_CD
                <isNotNull property="exclLocCdList">
                AND (CASE
                 <!-- From Location OK , To Location NG  -->
                 WHEN INVTY_LOC_CD_FROM.INVTY_LOC_CD NOT IN
                 <iterate property="exclLocCdList" var="exclLocCdList[]" open=" (" close=")" conjunction=",">
                    #exclLocCdList[]#
                 </iterate>
                  AND INVTY_LOC_CD_TO.INVTY_LOC_CD IN
                 <iterate property="exclLocCdList" var="exclLocCdList[]" open=" (" close=")" conjunction=",">
                    #exclLocCdList[]#
                 </iterate>
                  THEN 1
                 <!-- From Location OK , To Location OK  -->
                 WHEN INVTY_LOC_CD_FROM.INVTY_LOC_CD NOT IN
                 <iterate property="exclLocCdList" var="exclLocCdList[]" open=" (" close=")" conjunction=",">
                    #exclLocCdList[]#
                 </iterate>
                  AND INVTY_LOC_CD_TO.INVTY_LOC_CD NOT IN
                 <iterate property="exclLocCdList" var="exclLocCdList[]" open=" (" close=")" conjunction=",">
                    #exclLocCdList[]#
                 </iterate>
                  THEN 1
                  ELSE 0 END) = 1
                </isNotNull>
                AND CD.GLBL_CMPY_CD           = M.GLBL_CMPY_CD
                AND CD.MDSE_CD                = M.MDSE_CD
                AND M.INVTY_CTRL_FLG          = #invtyCtrlFlg#
                AND CD.GLBL_CMPY_CD           = SMV.GLBL_CMPY_CD
                AND CD.MDSE_CD                = SMV.MDSE_CD
                AND C.EZCANCELFLAG            = '0'
                AND CD.EZCANCELFLAG           = '0'
                AND DCC.EZCANCELFLAG          = '0'
                AND M.EZCANCELFLAG            = '0'
                UNION ALL
                SELECT
                    C.GLBL_CMPY_CD
                            ,C.CPO_ORD_NUM
                            ,CD.MDSE_CD
                            ,CD.CPO_ORD_TS
                            ,C.SELL_TO_CUST_CD
                            ,C.BILL_TO_CUST_CD
                            ,CD.ORD_QTY
                            ,CD.EXPD_SHIP_DT
                            ,SMV.CUSA_VND_CD
                            ,CD.SHPG_SVC_LVL_CD
                            ,CD.RDD_DT
                            ,'WHT_CANCEL' AS INTFC_CATG_TXT
                            ,(SELECT
                                  CASE WHEN CD.SHPG_SVC_LVL_CD IS NULL THEN #trdPtnrShpgMethCdOther#
                                       WHEN AA.CNT_A &gt; 0 THEN (SELECT
                                                                   TPSXR.TRD_PTNR_SHPG_METH_CD
                                                               FROM
                                                                   TRD_PTNR_SHPG_X_REF TPSXR
                                                               WHERE
                                                                   TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                                                               AND TPSXR.VND_CD (+)          = #vndCdCinc#
                                                               AND TPSXR.CARR_CD             = CD.CARR_CD
                                                               AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                                                               AND TPSXR.FRT_COND_CD         = #frtCondCd#
                                                               AND TPSXR.EZCANCELFLAG        = '0')
                                       WHEN BB.CNT_B &gt; 0 THEN (SELECT
                                                                   TPSXR.TRD_PTNR_SHPG_METH_CD
                                                               FROM
                                                                   TRD_PTNR_SHPG_X_REF TPSXR
                                                               WHERE
                                                                   TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                                                               AND TPSXR.VND_CD              = #vndCdCinc#
                                                               AND TPSXR.CARR_CD             = #carrCd#
                                                               AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                                                               AND TPSXR.FRT_COND_CD         = #frtCondCd#
                                                               AND TPSXR.EZCANCELFLAG        = '0')
                                       ELSE #trdPtnrShpgMethCdOther#
                                  END AS CINC_GLBL_WH_CD_EN
                              FROM
                                  (SELECT
                                       COUNT(TPSXR.TRD_PTNR_SHPG_METH_CD) AS CNT_A
                                   FROM
                                       TRD_PTNR_SHPG_X_REF TPSXR
                                   WHERE
                                       TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                                   AND TPSXR.VND_CD (+)          = #vndCdCinc#
                                   AND TPSXR.CARR_CD             = CD.CARR_CD
                                   AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                                   AND TPSXR.FRT_COND_CD         = #frtCondCd#
                                   AND ROWNUM                    = #numOne#
                                   AND TPSXR.EZCANCELFLAG        = '0') AA
                                  ,(SELECT
                                        COUNT(TPSXR.TRD_PTNR_SHPG_METH_CD) AS CNT_B
                                    FROM
                                        TRD_PTNR_SHPG_X_REF TPSXR
                                    WHERE
                                        TPSXR.GLBL_CMPY_CD        = CD.GLBL_CMPY_CD
                                    AND TPSXR.VND_CD              = #vndCdCinc#
                                    AND TPSXR.CARR_CD             = #carrCd#
                                    AND TPSXR.SHPG_SVC_LCL_CD     = CD.SHPG_SVC_LVL_CD
                                    AND TPSXR.FRT_COND_CD         = #frtCondCd#
                                    AND ROWNUM                    = #numOne#
                                    AND TPSXR.EZCANCELFLAG        = '0') BB
                                  ) AS TRD_PTNR_SHPG_METH_CD
                                  ,(SELECT
                                        CASE
                                            WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                                       CGWC.CINC_GLBL_WH_CD
                                                                   FROM
                                                                       CINC_GLBL_WH_CONV CGWC
                                                                   WHERE INVTY_LOC_CD_FROM.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                                                     AND INVTY_LOC_CD_FROM.RTL_WH_CD       = CGWC.RTL_WH_CD
                                                                     AND CGWC.WH_OWNR_CD                   = #whOwnrCdAst#
                                                                     AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                                                                     AND CGWC.EZCANCELFLAG                 = '0')
                                            WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                                       CGWC.CINC_GLBL_WH_CD
                                                                   FROM
                                                                       CINC_GLBL_WH_CONV CGWC
                                                                   WHERE INVTY_LOC_CD_FROM.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                                                     AND INVTY_LOC_CD_FROM.WH_OWNR_CD      = CGWC.WH_OWNR_CD
                                                                     AND CGWC.RTL_WH_CD                    = #rtlWhCdAst#
                                                                     AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                                                                     AND CGWC.EZCANCELFLAG                 = '0')
                                            WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                                       CGWC.CINC_GLBL_WH_CD
                                                                   FROM
                                                                       CINC_GLBL_WH_CONV CGWC
                                                                   WHERE INVTY_LOC_CD_FROM.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                                                   AND INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD   = CGWC.LOC_TP_CD
                                                                   AND CGWC.RTL_WH_CD                      = #rtlWhCdAst#
                                                                   AND CGWC.WH_OWNR_CD                     = #whOwnrCdAst#
                                                                   AND CGWC.EZCANCELFLAG                   = '0')
                                            ELSE (SELECT
                                                      CGWC.CINC_GLBL_WH_CD
                                                  FROM
                                                      CINC_GLBL_WH_CONV CGWC
                                                  WHERE CGWC.GLBL_CMPY_CD    = #glblCmpyCd#
                                                    AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                                    AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                                    AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                                    AND CGWC.EZCANCELFLAG    = '0')
                                        END AS CINC_GLBL_WH_CD_EN
                                    FROM(SELECT
                                             COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_A
                                         FROM
                                             CINC_GLBL_WH_CONV CGWC
                                         WHERE
                                             INVTY_LOC_CD_FROM.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                         AND INVTY_LOC_CD_FROM.RTL_WH_CD         = CGWC.RTL_WH_CD
                                         AND CGWC.WH_OWNR_CD                     = #whOwnrCdAst#
                                         AND CGWC.LOC_TP_CD                      = #locTpCdAst#
                                         AND ROWNUM                              = #numOne#
                                         AND CGWC.EZCANCELFLAG                   = '0'
                                        ) A
                                        ,(SELECT
                                              COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_B
                                          FROM
                                              CINC_GLBL_WH_CONV CGWC
                                          WHERE
                                              INVTY_LOC_CD_FROM.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                          AND INVTY_LOC_CD_FROM.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                          AND CGWC.RTL_WH_CD                      = #rtlWhCdAst#
                                          AND CGWC.LOC_TP_CD                      = #locTpCdAst#
                                          AND ROWNUM                              = #numOne#
                                          AND CGWC.EZCANCELFLAG                   = '0'
                                        ) B
                                        ,(SELECT
                                              COUNT(CGWC.CINC_GLBL_WH_CD) AS CNT_C
                                          FROM
                                              CINC_GLBL_WH_CONV CGWC
                                          WHERE
                                              INVTY_LOC_CD_FROM.GLBL_CMPY_CD          = CGWC.GLBL_CMPY_CD
                                          AND INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD       = CGWC.LOC_TP_CD
                                          AND CGWC.RTL_WH_CD                          = #rtlWhCdAst#
                                          AND CGWC.WH_OWNR_CD                         = #whOwnrCdAst#
                                          AND ROWNUM                                  = #numOne#
                                          AND CGWC.EZCANCELFLAG                       = '0'
                                        ) C
                            ) AS CINC_GLBL_WH_CD
                            ,(SELECT
                                  CASE
                                      WHEN A.CNT_A &gt; 0 THEN (SELECT
                                                                 CGWC.CINC_GLBL_WH_CD
                                                             FROM
                                                                 CINC_GLBL_WH_CONV CGWC
                                                             WHERE INVTY_LOC_CD_TO.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                                             AND INVTY_LOC_CD_TO.RTL_WH_CD         = CGWC.RTL_WH_CD
                                                             AND CGWC.WH_OWNR_CD                   = #whOwnrCdAst#
                                                             AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                                                             AND CGWC.EZCANCELFLAG                 = '0')
                                      WHEN B.CNT_B &gt; 0 THEN (SELECT
                                                                 CGWC.CINC_GLBL_WH_CD
                                                             FROM
                                                                 CINC_GLBL_WH_CONV CGWC
                                                             WHERE INVTY_LOC_CD_TO.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                                             AND INVTY_LOC_CD_TO.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                                             AND CGWC.RTL_WH_CD                    = #rtlWhCdAst#
                                                             AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                                                             AND CGWC.EZCANCELFLAG                 = '0')
                                      WHEN C.CNT_C &gt; 0 THEN (SELECT
                                                                 CGWC.CINC_GLBL_WH_CD
                                                             FROM
                                                                 CINC_GLBL_WH_CONV CGWC
                                                             WHERE INVTY_LOC_CD_TO.GLBL_CMPY_CD    = CGWC.GLBL_CMPY_CD
                                                             AND INVTY_LOC_CD_TO.INVTY_LOC_TP_CD   = CGWC.LOC_TP_CD
                                                             AND CGWC.RTL_WH_CD                    = #rtlWhCdAst#
                                                             AND CGWC.WH_OWNR_CD                   = #whOwnrCdAst#
                                                             AND CGWC.EZCANCELFLAG                 = '0')
                                      ELSE (SELECT
                                                CGWC.CINC_GLBL_WH_CD
                                            FROM
                                                CINC_GLBL_WH_CONV CGWC
                                            WHERE CGWC.GLBL_CMPY_CD    = #glblCmpyCd#
                                              AND CGWC.RTL_WH_CD       = #rtlWhCdAst#
                                              AND CGWC.WH_OWNR_CD      = #whOwnrCdAst#
                                              AND CGWC.LOC_TP_CD       = #locTpCdAst#
                                              AND CGWC.EZCANCELFLAG    = '0')
                                  END AS CINC_GLBL_WH_CD_EN
                              FROM
                                  (SELECT
                                       COUNT(CGWC.CINC_GLBL_WH_CD) CNT_A
                                   FROM
                                       CINC_GLBL_WH_CONV CGWC
                                   WHERE
                                       INVTY_LOC_CD_TO.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                   AND INVTY_LOC_CD_TO.RTL_WH_CD         = CGWC.RTL_WH_CD
                                   AND CGWC.WH_OWNR_CD                   = #whOwnrCdAst#
                                   AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                                   AND ROWNUM                            = #numOne#
                                   AND CGWC.EZCANCELFLAG                 = '0'
                                  ) A
                                  ,(SELECT
                                        COUNT(CGWC.CINC_GLBL_WH_CD) CNT_B
                                   FROM
                                        CINC_GLBL_WH_CONV CGWC
                                   WHERE
                                        INVTY_LOC_CD_TO.GLBL_CMPY_CD      = CGWC.GLBL_CMPY_CD
                                    AND INVTY_LOC_CD_TO.WH_OWNR_CD        = CGWC.WH_OWNR_CD
                                    AND CGWC.RTL_WH_CD                    = #rtlWhCdAst#
                                    AND CGWC.LOC_TP_CD                    = #locTpCdAst#
                                    AND ROWNUM                            = #numOne#
                                    AND CGWC.EZCANCELFLAG                 = '0'
                                  ) B
                                  ,(SELECT
                                        COUNT(CGWC.CINC_GLBL_WH_CD) CNT_C
                                    FROM
                                        CINC_GLBL_WH_CONV CGWC
                                    WHERE
                                        INVTY_LOC_CD_TO.GLBL_CMPY_CD          = CGWC.GLBL_CMPY_CD
                                    AND INVTY_LOC_CD_TO.INVTY_LOC_TP_CD       = CGWC.LOC_TP_CD
                                    AND CGWC.RTL_WH_CD                        = #rtlWhCdAst#
                                    AND CGWC.WH_OWNR_CD                       = #whOwnrCdAst#
                                    AND ROWNUM                                = #numOne#
                                    AND CGWC.EZCANCELFLAG                     = '0'
                                  ) C
                            ) AS CINC_RCV_GLBL_WH_CD
                            ,(SELECT
                                  CASE
                                      WHEN A1.CNT_A1 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                                               AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                               AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                               AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                                               AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                               AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      WHEN A2.CNT_A2 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                                               AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                               AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                               AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                                               AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                               AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      WHEN A3.CNT_A3 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                                               AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                               AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                               AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                                               AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                               AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      WHEN B1.CNT_B1 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                               AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                                               AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                               AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                                               AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                               AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      WHEN B2.CNT_B2 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                               AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                                               AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                               AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                               AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                                               AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      WHEN B3.CNT_B3 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                               AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                                               AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                                               AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                               AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                               AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                                               AND WTCCC.EZCANCELFLAG             = '0') 
                                      WHEN C1.CNT_C1 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                               AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                               AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                                               AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                                               AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                               AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      WHEN C2.CNT_C2 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                    WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                               AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                               AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                                               AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                               AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                                               AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      WHEN C3.CNT_C3 &gt; 0 THEN (SELECT
                                                                   WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                                               FROM
                                                                   WH_TRNSF_CINC_CATG_CONV WTCCC
                                                               WHERE
                                                                   INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                                               AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                                               AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                                               AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                                               AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                                               AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                                               AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                                               AND WTCCC.EZCANCELFLAG             = '0')
                                      ELSE (SELECT
                                                WTCCC.CINC_GLBL_CMPY_CATG_CD || ',' || WTCCC.CINC_GLBL_ORD_CATG_CD AS CINC_GLBL_CMPY_CATG_CD
                                            FROM
                                                WH_TRNSF_CINC_CATG_CONV WTCCC
                                            WHERE
                                                INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                            AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                            AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                            AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                            AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                            AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                            AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                            AND WTCCC.EZCANCELFLAG             = '0')
                                  END AS CINC_GLBL_CMPY_CATG_CD
                              FROM
                                  (SELECT
                                       COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_A1
                                   FROM
                                       WH_TRNSF_CINC_CATG_CONV WTCCC
                                   WHERE
                                       INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                   AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                   AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                   AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                   AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                   AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                   AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                   AND ROWNUM                         = #numOne#
                                   AND WTCCC.EZCANCELFLAG             = '0'
                                  ) A1
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_A2
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                    AND WTCCC.FROM_RTL_WH_CD           = INVTY_LOC_CD_FROM.RTL_WH_CD
                                    AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                    AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                    AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                    AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                    AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                    AND ROWNUM                         = #numOne#
                                    AND WTCCC.EZCANCELFLAG             = '0'
                                  ) A2
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_A3
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                   AND WTCCC.FROM_RTL_WH_CD            = INVTY_LOC_CD_FROM.RTL_WH_CD
                                   AND WTCCC.FROM_WH_OWNR_CD           = #fromWhOwnrCdAst#
                                   AND WTCCC.FROM_LOC_TP_CD            = #fromLocTpCdAst#
                                   AND WTCCC.TO_LOC_TP_CD              = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                   AND WTCCC.TO_RTL_WH_CD              = #toRtlWhCdAst#
                                   AND WTCCC.TO_WH_OWNR_CD             = #toWhOwnrCdAst#
                                   AND ROWNUM                          = #numOne#
                                   AND WTCCC.EZCANCELFLAG              = '0'
                                  ) A3
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_B1
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                    AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                    AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                    AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                    AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                    AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                    AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                    AND ROWNUM                         = #numOne#
                                    AND WTCCC.EZCANCELFLAG             = '0'
                                  ) B1
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_B2
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                    AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                    AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                    AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                    AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                    AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                    AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                    AND ROWNUM                         = #numOne#
                                    AND WTCCC.EZCANCELFLAG             = '0'
                                  ) B2
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_B3
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                    AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                    AND WTCCC.FROM_WH_OWNR_CD          = INVTY_LOC_CD_FROM.WH_OWNR_CD
                                    AND WTCCC.FROM_LOC_TP_CD           = #fromLocTpCdAst#
                                    AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                    AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                    AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                    AND ROWNUM                         = #numOne#
                                    AND WTCCC.EZCANCELFLAG             = '0'
                                  ) B3
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_C1
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                    AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                    AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                    AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                    AND WTCCC.TO_RTL_WH_CD             = INVTY_LOC_CD_TO.RTL_WH_CD
                                    AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                    AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                    AND ROWNUM                         = #numOne#
                                    AND WTCCC.EZCANCELFLAG             = '0'
                                  ) C1
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_C2
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                    AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                    AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                    AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                    AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                    AND WTCCC.TO_WH_OWNR_CD            = INVTY_LOC_CD_TO.WH_OWNR_CD
                                    AND WTCCC.TO_LOC_TP_CD             = #toLocTpCdAst#
                                    AND ROWNUM                         = #numOne#
                                    AND WTCCC.EZCANCELFLAG             = '0'
                                  ) C2
                                  ,(SELECT
                                        COUNT(WTCCC.CINC_GLBL_CMPY_CATG_CD) AS CNT_C3
                                    FROM
                                        WH_TRNSF_CINC_CATG_CONV WTCCC
                                    WHERE
                                        INVTY_LOC_CD_FROM.GLBL_CMPY_CD = WTCCC.GLBL_CMPY_CD
                                    AND WTCCC.FROM_RTL_WH_CD           = #fromRtlWhCdAst#
                                    AND WTCCC.FROM_WH_OWNR_CD          = #fromWhOwnrCdAst#
                                    AND WTCCC.FROM_LOC_TP_CD           = INVTY_LOC_CD_FROM.INVTY_LOC_TP_CD
                                    AND WTCCC.TO_RTL_WH_CD             = #toRtlWhCdAst#
                                    AND WTCCC.TO_WH_OWNR_CD            = #toWhOwnrCdAst#
                                    AND WTCCC.TO_LOC_TP_CD             = INVTY_LOC_CD_TO.INVTY_LOC_TP_CD
                                    AND ROWNUM                         = #numOne#
                                    AND WTCCC.EZCANCELFLAG             = '0'
                                  ) C3
                            ) AS CINC_GLBL_CMPY_CATG_CD
                FROM
                    CPO            C
                   ,CPO_DTL        CD
                   ,DS_COND_CONST  DCC
                   ,MDSE           M
                   ,SCUBE_MDSE_V   SMV
                   ,(SELECT DISTINCT
                         DIL.INVTY_LOC_CD
                        ,DIL.RTL_WH_CD
                        ,DIL.RTL_SWH_CD
                        ,RW.WH_OWNR_CD
                        ,DIL.INVTY_LOC_TP_CD
                        ,DIL.GLBL_CMPY_CD
                     FROM
                         DS_INVTY_LOC_V DIL
                        ,RTL_WH         RW
                        ,INVTY_OWNR     IO
                     WHERE
                         DIL.GLBL_CMPY_CD          = #glblCmpyCd#
                     <isNotNull property="technician">
                     AND DIL.INVTY_LOC_TP_CD   != #technician#
                     </isNotNull>
                     AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
                     AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
                     AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
                     AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
                     AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
                     AND DIL.EZCANCELFLAG          = '0'
                     AND RW.EZCANCELFLAG           = '0'
                     AND IO.EZCANCELFLAG           = '0'
                     <!-- Add Start 2020/02/03 QC#55572 -->
                     <isNotNull property="exclSwhCdList">
                     AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                         #exclSwhCdList[]#
                         </iterate>
                     </isNotNull>
                     <!-- Add End 2020/02/03 QC#55572 -->
                   ) INVTY_LOC_CD_FROM
                   ,(SELECT DISTINCT
                         DIL.INVTY_LOC_CD
                        ,DIL.RTL_WH_CD
                        ,DIL.RTL_SWH_CD
                        ,RW.WH_OWNR_CD
                        ,DIL.INVTY_LOC_TP_CD
                        ,DIL.GLBL_CMPY_CD
                     FROM
                         DS_INVTY_LOC_V DIL
                        ,RTL_WH         RW
                        ,INVTY_OWNR     IO
                     WHERE
                         DIL.GLBL_CMPY_CD          = #glblCmpyCd#
                     <isNotNull property="technician">
                     AND DIL.INVTY_LOC_TP_CD   != #technician#
                     </isNotNull>
                     AND DIL.GLBL_CMPY_CD          = RW.GLBL_CMPY_CD
                     AND DIL.RTL_WH_CD             = RW.RTL_WH_CD
                     AND RW.GLBL_CMPY_CD           = IO.GLBL_CMPY_CD
                     AND RW.INVTY_OWNR_CD          = IO.INVTY_OWNR_CD
                     AND IO.CMPY_INVTY_FLG         = #cmpyInvtyFlg#
                     AND DIL.EZCANCELFLAG          = '0'
                     AND RW.EZCANCELFLAG           = '0'
                     AND IO.EZCANCELFLAG           = '0'
                     <!-- Add Start 2020/02/03 QC#55572 -->
                     <isNotNull property="exclSwhCdList">
                     AND <iterate property="exclSwhCdList" var="exclSwhCdList[]" open="DIL.RTL_SWH_CD NOT IN (" close=")" conjunction=",">
                         #exclSwhCdList[]#
                         </iterate>
                     </isNotNull>
                     <!-- Add End 2020/02/03 QC#55572 -->
                   ) INVTY_LOC_CD_TO
                WHERE
                    C.GLBL_CMPY_CD            = #glblCmpyCd#
                AND C.DS_ORD_TP_CD            = DCC.DS_COND_CONST_VAL_TXT_01
                AND DCC.DS_COND_CONST_GRP_ID  = #scubeWhtDsOrdTp#
                AND C.GLBL_CMPY_CD            = DCC.GLBL_CMPY_CD
                AND C.CPO_ORD_NUM             = CD.CPO_ORD_NUM
                AND C.GLBL_CMPY_CD            = CD.GLBL_CMPY_CD
                AND CD.CPO_ORD_TS         &lt;= #cpoOrdTs#
                AND CD.SUBMT_FLG              = #submitFlg#
                AND CD.CPO_DTL_CANC_DT     &gt; #cpoOrdTs#
                AND CD.CPO_DTL_CANC_FLG       = #cpoDtlCancFlgY#
                AND CD.GLBL_CMPY_CD           = INVTY_LOC_CD_FROM.GLBL_CMPY_CD
                AND CD.RTL_WH_CD              = INVTY_LOC_CD_FROM.RTL_WH_CD
                AND NVL(CD.RTL_SWH_CD,'*')    = NVL(INVTY_LOC_CD_FROM.RTL_SWH_CD,'*')
                AND CD.GLBL_CMPY_CD           = INVTY_LOC_CD_TO.GLBL_CMPY_CD
                AND CD.SHIP_TO_CUST_CD        = INVTY_LOC_CD_TO.INVTY_LOC_CD
                <iterate property="exclLocCdList" var="exclLocCdList[]" open=" AND INVTY_LOC_CD_FROM.INVTY_LOC_CD NOT IN (" close=")" conjunction=",">
                    #exclLocCdList[]#
                </iterate> 
                AND CD.GLBL_CMPY_CD           = M.GLBL_CMPY_CD
                AND CD.MDSE_CD                = M.MDSE_CD
                AND M.INVTY_CTRL_FLG          = #invtyCtrlFlg#
                AND CD.GLBL_CMPY_CD           = SMV.GLBL_CMPY_CD
                AND CD.MDSE_CD                = SMV.MDSE_CD
                AND C.EZCANCELFLAG            = '0'
                AND CD.EZCANCELFLAG           = '0'
                AND DCC.EZCANCELFLAG          = '0'
                AND M.EZCANCELFLAG            = '0'
                )
                SELECT
                    WH_TRNSFR_ORD_GRP.CPO_ORD_TS              AS INTFC_CPO_ORD_DT
                   ,WH_TRNSFR_ORD_GRP.CPO_ORD_NUM             AS INTFC_CPO_ORD_NUM
                   ,WH_TRNSFR_ORD_GRP.MDSE_CD                 AS INTFC_PRT_MDSE_CD
                   ,WH_TRNSFR_ORD_GRP.SELL_TO_CUST_CD         AS INTFC_SELL_TO_CUST_CD
                   ,WH_TRNSFR_ORD_GRP.ORD_QTY                 AS INTFC_ORD_QTY
                   ,GC.GLBL_CMPY_CD                           AS CINC_SHIP_TO_GLBL_CMPY_CD
                   ,GC.GLBL_CMPY_CD                           AS CINC_BILL_TO_GLBL_CMPY_CD
                   ,WH_TRNSFR_ORD_GRP.EXPD_SHIP_DT            AS INTFC_EXPD_SHIP_DT
                   ,WH_TRNSFR_ORD_GRP.TRD_PTNR_SHPG_METH_CD
                   ,WH_TRNSFR_ORD_GRP.CINC_GLBL_WH_CD
                   ,WH_TRNSFR_ORD_GRP.CINC_RCV_GLBL_WH_CD
                   ,WH_TRNSFR_ORD_GRP.CINC_GLBL_CMPY_CATG_CD
                   ,''                                        AS CINC_GLBL_ORD_CATG_CD
                   ,WH_TRNSFR_ORD_GRP.CUSA_VND_CD
                   ,WH_TRNSFR_ORD_GRP.INTFC_CATG_TXT
                   ,WH_TRNSFR_ORD_GRP.SHPG_SVC_LVL_CD         AS SHPG_SVC_LVL_CD
                   ,WH_TRNSFR_ORD_GRP.RDD_DT                  AS INTFC_RDD_DT
                FROM
                <!-- QC#30961 Update WH_TRNSFR_ORD_GRP -->
                    (
                        SELECT
                            *
                        FROM
                            (
                            SELECT
                                CPO_ORD_NUM
                               ,MDSE_CD
                               ,TRD_PTNR_SHPG_METH_CD
                               ,CPO_ORD_TS
                               ,EXPD_SHIP_DT
                               ,CINC_GLBL_WH_CD
                               ,CINC_RCV_GLBL_WH_CD
                               ,GLBL_CMPY_CD
                               ,INTFC_CATG_TXT
                               ,SUM(ORD_QTY)                AS ORD_QTY
                               ,MIN(CINC_GLBL_CMPY_CATG_CD) AS CINC_GLBL_CMPY_CATG_CD
                               ,MIN(CUSA_VND_CD)            AS CUSA_VND_CD
                               ,MIN(SELL_TO_CUST_CD)        AS SELL_TO_CUST_CD
                               ,MIN(BILL_TO_CUST_CD)        AS BILL_TO_CUST_CD
                               ,MIN(CUSA_VND_CD)
                               ,MAX(SHPG_SVC_LVL_CD)        AS SHPG_SVC_LVL_CD
                               ,MIN(RDD_DT)                 AS RDD_DT
                            FROM
                                  WH_TRNSFR_ORD
                            GROUP BY
                                  WH_TRNSFR_ORD.CPO_ORD_NUM
                                 ,WH_TRNSFR_ORD.MDSE_CD
                                 ,WH_TRNSFR_ORD.TRD_PTNR_SHPG_METH_CD
                                 ,WH_TRNSFR_ORD.CPO_ORD_TS
                                 ,WH_TRNSFR_ORD.EXPD_SHIP_DT
                                 ,WH_TRNSFR_ORD.CINC_GLBL_WH_CD
                                 ,WH_TRNSFR_ORD.CINC_RCV_GLBL_WH_CD
                                 ,WH_TRNSFR_ORD.GLBL_CMPY_CD
                                 ,WH_TRNSFR_ORD.INTFC_CATG_TXT
                             ) A
                        WHERE
                           A.ORD_QTY != 0
                    ) WH_TRNSFR_ORD_GRP
                    , BILL_TO_CUST BT
                    , GLBL_CMPY    GC
                WHERE
                    WH_TRNSFR_ORD_GRP.CINC_GLBL_WH_CD    !=    WH_TRNSFR_ORD_GRP.CINC_RCV_GLBL_WH_CD
                AND WH_TRNSFR_ORD_GRP.GLBL_CMPY_CD        =    BT.GLBL_CMPY_CD    (+)
                AND WH_TRNSFR_ORD_GRP.BILL_TO_CUST_CD     =    BT.BILL_TO_CUST_CD (+)
                AND BT.COA_AFFL_CD                        =    GC.COA_AFFL_CD     (+)
                AND BT.EZCANCELFLAG (+)                   =    '0'
                AND GC.EZCANCELFLAG (+)                   =    '0'
                ORDER BY
                    CPO_ORD_TS
                   ,CPO_ORD_NUM
                   ,MDSE_CD
    </statement>

    <statement id="getMaxPsdDt" parameterClass="Map" resultClass="String">
        SELECT
            MIN(SP.PSD_DT)
        FROM
            CPO_DTL             CD
           ,SHPG_PLN            SP
        WHERE
            CD.GLBL_CMPY_CD            = #glblCmpyCd#
        AND CD.CPO_ORD_NUM             = #cpoOrdNum#
        AND CD.MDSE_CD                 = #mdseCd#
        <isNotNull property="shpgSvcLvlCd" >
        AND CD.SHPG_SVC_LVL_CD         = #shpgSvcLvlCd#
        </isNotNull>
        <isNull property="shpgSvcLvlCd">
        AND CD.SHPG_SVC_LVL_CD         IS NULL
        </isNull>
        AND CD.GLBL_CMPY_CD            = SP.GLBL_CMPY_CD
        AND CD.CPO_ORD_NUM             = SP.TRX_HDR_NUM
        AND CD.CPO_DTL_LINE_NUM        = SP.TRX_LINE_NUM
        AND CD.CPO_DTL_LINE_SUB_NUM    = SP.TRX_LINE_SUB_NUM
        AND CD.EZCANCELFLAG            = '0'
        AND SP.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getPreIntfcCratDt" parameterClass="Map" resultClass="String">
        SELECT
            MAX(A.INTFC_CRAT_DT)
        FROM 
            INTFC_CPO_WRK A
        WHERE
            A.GLBL_CMPY_CD     = #glblCmpyCd#
        AND A.INTFC_CRAT_DT &lt; #intfcCratDt#
        AND A.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getPastData" parameterClass="Map">
        SELECT
             A.GLBL_CMPY_CD
            ,A.CINC_GLBL_WH_CD
            ,A.INTFC_CPO_ORD_DT
            ,A.INTFC_CPO_ORD_NUM
            ,A.INTFC_PRT_MDSE_CD
            ,A.PRT_SIZE_TXT
            ,A.CINC_GLBL_SHPG_METH_CD
            ,A.INTFC_CRAT_DT
        FROM 
            INTFC_CPO_WRK A
        WHERE
            A.GLBL_CMPY_CD  =    #glblCmpyCd#
        <isNotEqual property="rerunFlg" compareValue="Y">
        AND A.INTFC_CRAT_DT &lt; #preIntfcCratDt#
        </isNotEqual>
        <isEqual property="rerunFlg" compareValue="Y">
        AND A.INTFC_CRAT_DT = #preIntfcCratDt#
        </isEqual>
        AND A.EZCANCELFLAG  =    '0'
        ORDER BY
             A.CINC_GLBL_WH_CD
            ,A.INTFC_CPO_ORD_NUM
            ,A.INTFC_PRT_MDSE_CD
            ,A.PRT_SIZE_TXT
            ,A.CINC_GLBL_SHPG_METH_CD
            ,A.INTFC_CPO_ORD_DT DESC
    </statement>

</sqlMap>
