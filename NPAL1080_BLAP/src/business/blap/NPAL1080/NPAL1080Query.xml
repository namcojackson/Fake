<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPAL1080Query">
    <typeAlias alias="NPAL1080_ASMsg" type="business.blap.NPAL1080.NPAL1080_ASMsg" />
    <typeAlias alias="NPAL1080_ACMsg" type="business.blap.NPAL1080.NPAL1080_ACMsg" />

    <statement id="getRequisitionTypePulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            PRT.PRCH_REQ_TP_CD
            ,PRT.PRCH_REQ_TP_DESC_TXT
            ,PRT.PRCH_REQ_REC_TP_CD
        FROM
            PRCH_REQ_TP PRT
        WHERE
                PRT.GLBL_CMPY_CD = #glblCmpyCd#
            AND PRT.PRCH_REQ_REC_TP_CD IN (#prchReqRecTpCdRequest#,#prchReqRecTpCdReturn#)
            <isNotNull property="scrEntAvalFlg">
            AND PRT.SCR_ENT_AVAL_FLG = #scrEntAvalFlg#
            </isNotNull>
            AND PRT.EZCANCELFLAG = '0'
        ORDER BY
            PRT.PRCH_REQ_TP_SORT_NUM ASC
    </statement>

    <statement id="getLineTypePulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            PRCH_REQ_LINE_TP_CD
            ,PRCH_REQ_LINE_TP_DESC_TXT
        FROM
            PRCH_REQ_LINE_TP
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND PRCH_REQ_REC_TP_CD IN (#prchReqRecTpCdRequest#,#prchReqRecTpCdReturn#)
            <isNotNull property="scrEntAvalFlg">
            AND SCR_ENT_AVAL_FLG = #scrEntAvalFlg#
            </isNotNull>
            AND EZCANCELFLAG = '0'
        ORDER BY
            PRCH_REQ_LINE_TP_SORT_NUM ASC
    </statement>

    <statement id="getRequestReceivingDateAndTimePulldownListByRequisitionType" parameterClass="Map"
        resultClass="Map">
        SELECT
               DCC.DS_COND_CONST_CD
              ,DCC.DS_COND_CONST_VAL_TXT_02
              ,DCC.DS_COND_CONST_VAL_TXT_03
              ,DCC.DS_COND_CONST_VAL_TXT_06
              ,DCC.DS_COND_CONST_VAL_TXT_09
          FROM DS_COND_CONST DCC
         WHERE DCC.GLBL_CMPY_CD             = #glblCmpyCd#
           AND DCC.DS_COND_CONST_GRP_ID     = #dsCondConstGrpId#
           AND DCC.DS_COND_CONST_VAL_TXT_04 = #prchReqRecTpCd#
           AND DCC.DS_COND_CONST_VAL_TXT_10 = #scrEntAvalFlg#
           AND DCC.EZCANCELFLAG             = '0'
         ORDER BY DCC.DS_COND_CONST_SORT_NUM ASC
    </statement>

    <statement id="getHeaderStatusPulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            PRS.PRCH_REQ_STS_CD
            ,PRS.PRCH_REQ_STS_DESC_TXT
        FROM
            PRCH_REQ_STS PRS
        WHERE
                PRS.GLBL_CMPY_CD = #glblCmpyCd#
            AND PRS.EZCANCELFLAG = '0'
        ORDER BY
            PRS.PRCH_REQ_STS_SORT_NUM ASC
    </statement>
    
    <statement id="getApprovalStatusPulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            PRAS.PRCH_REQ_APVL_STS_CD
            ,PRAS.PRCH_REQ_APVL_STS_DESC_TXT
        FROM
            PRCH_REQ_APVL_STS PRAS
        WHERE
                PRAS.GLBL_CMPY_CD = #glblCmpyCd#
            AND PRAS.EZCANCELFLAG = '0'
        ORDER BY
            PRAS.PRCH_REQ_APVL_STS_SORT_NUM ASC
    </statement>
    
    <statement id="getDocumentSourceTypePulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            PRST.PRCH_REQ_SRC_TP_CD
            ,PRST.PRCH_REQ_SRC_TP_DESC_TXT
        FROM
            PRCH_REQ_SRC_TP_XREF PRSTX
            ,PRCH_REQ_SRC_TP     PRST
        WHERE
                PRSTX.GLBL_CMPY_CD = #glblCmpyCd#
            AND PRSTX.EZCANCELFLAG = '0'
            AND PRST.GLBL_CMPY_CD = #glblCmpyCd#
            AND PRST.EZCANCELFLAG = '0'
            AND PRSTX.PRCH_REQ_SRC_TP_CD = PRST.PRCH_REQ_SRC_TP_CD
            AND PRSTX.PRCH_REQ_REC_TP_CD = #prchReqRecTpCd#
        ORDER BY
            PRST.PRCH_REQ_SRC_TP_SORT_NUM ASC
    </statement>
    
    <statement id="getRequestedShipMethodPulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            SSL.SHPG_SVC_LVL_CD
            ,SSL.SHPG_SVC_LVL_DESC_TXT
        FROM
            SHPG_SVC_LVL SSL
        WHERE
                SSL.GLBL_CMPY_CD = #glblCmpyCd#
            AND SSL.EZCANCELFLAG = '0'
        ORDER BY
            SSL.SHPG_SVC_LVL_SORT_NUM ASC
    </statement>
    
    <statement id="getSourceTypePulldownList" parameterClass="Map"
        resultClass="Map">
        SELECT
            PROCR_TP_CD
            ,PROCR_TP_DESC_TXT
        FROM
            PROCR_TP
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND PROCR_TP_CD IN (#procrTpCdSupplier#,#procrTpCdWarehouse#)
            AND EZCANCELFLAG = '0'
        ORDER BY
            PROCR_TP_SORT_NUM ASC
    </statement>

    <statement id="findWhCd" parameterClass="Map" resultClass="Map">
        SELECT
            RTL_WH_CD
        FROM
            RTL_WH
        WHERE
                EZCANCELFLAG    = '0'
            AND GLBL_CMPY_CD    = #glblCmpyCd#
            AND RTL_WH_NM       = #rtlWhNm#
    </statement>

    <statement id="findSwhCd" parameterClass="Map" resultClass="Map">
        SELECT
            RTL_SWH_CD
        FROM
            RTL_SWH
        WHERE
                EZCANCELFLAG    = '0'
            AND GLBL_CMPY_CD    = #glblCmpyCd#
            AND RTL_WH_CD       = #rtlWhCd#
            AND RTL_SWH_CD      = #rtlSwhCd#
    </statement>

    <statement id="findVndCd" parameterClass="Map" resultClass="Map">
        SELECT
            PRNT_VND_CD
        FROM
            PRNT_VND
        WHERE
                EZCANCELFLAG    = '0'
            AND GLBL_CMPY_CD    = #glblCmpyCd#
            AND PRNT_VND_NM     = #prntVndNm#
    </statement>

    <statement id="findSiteCd" parameterClass="Map" resultClass="Map">
        SELECT
            V.VND_CD
        FROM
            VND V
            ,PRNT_VND PV
        WHERE
                V.GLBL_CMPY_CD    = #glblCmpyCd#
            AND V.LOC_NM          = #locNm#
            AND V.EZCANCELFLAG    = '0'
            AND V.PRNT_VND_PK     = PV.PRNT_VND_PK
            AND V.GLBL_CMPY_CD    = PV.GLBL_CMPY_CD
            AND PV.PRNT_VND_CD    = #prntVndCd#
            AND PV.EZCANCELFLAG   = '0'
    </statement>

    <statement id="findPoVnd" parameterClass="Map" resultClass="Map">
        SELECT
            VND_CD
            ,VND_NM
            ,PRNT_VND_CD
            ,PRNT_VND_NM
        FROM
            PO_VND_V
        WHERE
                EZCANCELFLAG    = '0'
            AND GLBL_CMPY_CD    = #glblCmpyCd#
            AND VND_CD          = #vndCd#
            AND PRNT_VND_CD     = #prntVndCd#
    </statement>

    <statement id="checkTechnician" parameterClass="Map" resultClass="Map">
        SELECT
             PSN_CD
            ,LINE_BIZ_TP_CD
        FROM
            S21_PSN
        WHERE
            EZCANCELFLAG = '0'
            AND GLBL_CMPY_CD = #glblCmpyCd#
            AND PSN_CD = #psnCd#
            AND EFF_FROM_DT &lt;= #effFromDt#
            AND NVL(EFF_THRU_DT, '99991231') &gt;= #effThruDt#
    </statement>

    <statement id="findCarrNm" parameterClass="Map" resultClass="Map">
        SELECT
            OCV.CARR_NM
        FROM
            RTL_WH RW
            ,OTBD_CARR_V OCV
        WHERE
                RW.EZCANCELFLAG    = '0'
            AND RW.GLBL_CMPY_CD    = #glblCmpyCd#
            AND OCV.EZCANCELFLAG   = '0'
            AND OCV.GLBL_CMPY_CD   = RW.GLBL_CMPY_CD
            AND OCV.CARR_CD        = RW.PRF_CARR_CD
            AND RW.RTL_WH_CD       = #destWhCd#
    </statement>

    <statement id="findCustomerName" parameterClass="Map" resultClass="Map">
        SELECT
            DAC.DS_ACCT_NM
        FROM
            SHIP_TO_CUST STC
            ,SELL_TO_CUST DAC
        WHERE
                STC.EZCANCELFLAG     = '0'
            AND STC.GLBL_CMPY_CD     = #glblCmpyCd#
            AND DAC.EZCANCELFLAG     = '0'
            AND DAC.GLBL_CMPY_CD     = STC.GLBL_CMPY_CD
            AND DAC.SELL_TO_CUST_CD  = STC.SELL_TO_CUST_CD
            AND STC.SHIP_TO_CUST_CD  = #shipToCustCd#
    </statement>

    <statement id="findRequisitionRecordTypeCode" parameterClass="Map"
        resultClass="Map">
        SELECT
            PRCH_REQ_REC_TP_CD
        FROM
            PRCH_REQ_TP
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND PRCH_REQ_TP_CD = #prchReqTpCd#
            AND EZCANCELFLAG = '0'
    </statement>

    <statement id="findTechTocCode" parameterClass="Map" resultClass="Map">
        SELECT
            TECH_TOC_CD
        FROM
            TECH_MSTR
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND UPPER(TECH_NM) = UPPER(#techNm#)
            AND EZCANCELFLAG = '0'
    </statement>

    <statement id="findTechTocCodeAndName" parameterClass="Map" resultClass="Map">
        SELECT
            TM.TECH_TOC_CD
           ,TM.TECH_NM
           ,TM.GLBL_CMPY_CD
           ,TM.EZCANCELFLAG
          FROM 
               TECH_MSTR TM
               ,S21_PSN  PSN
         WHERE
               TM.GLBL_CMPY_CD       = #glblCmpyCd#
           AND TM.GLBL_CMPY_CD       =  PSN.GLBL_CMPY_CD
           AND TM.TECH_TOC_CD        =  PSN.PSN_CD
           AND PSN.EFF_FROM_DT       &lt;=  #salesDate#
           AND NVL(PSN.EFF_THRU_DT, #effThruDtDefalut#)   &gt;=  #salesDate#
        <isNotNull property="techTocCd">
           AND TM.TECH_TOC_CD        = #techTocCd#
        </isNotNull>
        <isNotNull property="techNm">
           AND UPPER(TM.TECH_NM)     = UPPER(#techNm#)
        </isNotNull>
           AND TM.EZCANCELFLAG       = '0'
           AND PSN.EZCANCELFLAG      = '0'
    </statement>

    <statement id="findTechWhCode" parameterClass="Map" resultClass="Map">
		SELECT RS.RTL_WH_CD
		      ,RS.RTL_SWH_CD
		  FROM RTL_WH RW
		      ,RTL_SWH RS
		 WHERE 1=1
		   AND RW.GLBL_CMPY_CD = #glblCmpyCd#
		   AND RW.LOC_TP_CD    = #locTpCd#
		   AND RW.TECH_TOC_CD  = #techTocCd#
		   AND RW.EZCANCELFLAG = '0'
		   AND RW.GLBL_CMPY_CD = RS.GLBL_CMPY_CD
		   AND RW.RTL_WH_CD    = RS.RTL_WH_CD
		   AND RS.PRTY_LOC_FLG = #prtyLocFlgY#
		   AND RS.EZCANCELFLAG = '0'
    </statement>

    <statement id="getMdse" parameterClass="Map" resultClass="Map">
        SELECT
             AMV.GLBL_CMPY_CD
            ,AMV.MDSE_CD
            ,AMV.MDSE_ITEM_STS_CD
            ,MIS.PRCH_AVAL_FLG
        FROM
             ALL_MDSE_V     AMV
            ,MDSE_ITEM_STS  MIS
        WHERE
            AMV.GLBL_CMPY_CD    = #glblCmpyCd#
        AND AMV.MDSE_CD         = #mdseCd#
        AND AMV.EZCANCELFLAG    = '0'
        AND MIS.GLBL_CMPY_CD    = AMV.GLBL_CMPY_CD
        AND MIS.MDSE_ITEM_STS_CD = AMV.MDSE_ITEM_STS_CD
        AND MIS.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getMdseNm" parameterClass="Map" resultClass="Map">
        SELECT
               AMV.MDSE_DESC_SHORT_TXT
              <!-- START 2017/10/25 S.Katsuma QC#21896 ADD -->
              ,AMV.RTRN_REQ_PRT_FLG
              ,AMV.RTRN_WH_CD
              ,RW.RTL_WH_NM
              ,AMV.RTRN_DSPL_TP_CD
              <!-- END 2017/10/25 S.Katsuma QC#21896 ADD -->
          FROM 
               ALL_MDSE_V AMV
              <!-- START 2017/10/25 S.Katsuma QC#21896 ADD -->
              ,RTL_WH RW
              <!-- END 2017/10/25 S.Katsuma QC#21896 ADD -->
         WHERE
               AMV.GLBL_CMPY_CD   = #glblCmpyCd#
           AND AMV.MDSE_CD        = #mdseCd#
           AND AMV.EZCANCELFLAG   = '0'
           <!-- START 2017/10/25 S.Katsuma QC#21896 ADD -->
           AND AMV.GLBL_CMPY_CD   = RW.GLBL_CMPY_CD(+)
           AND AMV.RTRN_WH_CD     = RW.RTL_WH_CD(+)
           AND RW.EZCANCELFLAG(+) = '0'
           <!-- END 2017/10/25 S.Katsuma QC#21896 ADD -->
    </statement>

    <statement id="getPrntVndNm" parameterClass="Map" resultClass="Map">
        SELECT
               PRNT_VND_NM
          FROM 
               PRNT_VND
         WHERE
               GLBL_CMPY_CD  = #glblCmpyCd#
           AND PRNT_VND_CD   = #prntVndCd#
           AND EZCANCELFLAG  = '0'
    </statement>

    <statement id="getWhNm" parameterClass="Map" resultClass="Map">
        SELECT
               RTL_WH_NM
              ,RTL_SWH_CD
          FROM 
               DS_RTL_WH_V
         WHERE
               GLBL_CMPY_CD  = #glblCmpyCd#
           AND RTL_WH_CD     = #whCd#
           AND PRTY_LOC_FLG  = #prtyLocFlgY#
           AND EZCANCELFLAG  = '0'
    </statement>

    <statement id="findDefaultWh" parameterClass="Map" resultClass="Map">
        SELECT
               RW.DEF_SRC_PROCR_TP_CD
              ,RW.DEF_SRC_RTL_WH_CD
              ,RW.DEF_SRC_RTL_SWH_CD
              ,CASE WHEN RW.DEF_SRC_PROCR_TP_CD = #procrTpCdSupplier#
               THEN DEF_PV.PRNT_VND_NM
               ELSE DEF_RW.RTL_WH_NM
               END AS DEF_SRC_PRNT_VND_NM
              ,RW.DEF_RTRN_TO_PROCR_TP_CD
              ,RW.DEF_RTRN_TO_RTL_WH_CD
              ,RW.DEF_RTRN_TO_RTL_SWH_CD
              ,CASE WHEN RW.DEF_RTRN_TO_PROCR_TP_CD = #procrTpCdSupplier#
               THEN DEF_RTRN_PV.PRNT_VND_NM
               ELSE DEF_RTRN_RW.RTL_WH_NM
               END AS DEF_RTRN_PRNT_VND_NM
              ,V.LOC_NM
              <!-- START 2017/10/25 S.Katsuma QC#21896 ADD -->
              <isNotNull property="destSwhCd">
              ,RSW.DEF_SRC_PROCR_TP_CD AS RSW_DEF_SRC_PROCR_TP_CD
              ,RSW.DEF_SRC_RTL_WH_CD AS RSW_DEF_SRC_RTL_WH_CD
              ,DEF_RSW.RTL_WH_NM AS RSW_DEF_SRC_PRNT_VND_NM
              ,RSW.DEF_SRC_RTL_SWH_CD AS RSW_DEF_SRC_RTL_SWH_CD
              ,RSW.DEF_RTRN_TO_PROCR_TP_CD AS RSW_DEF_RTRN_TO_PROCR_TP_CD
              ,RSW.DEF_RTRN_TO_RTL_WH_CD AS RSW_DEF_RTRN_TO_RTL_WH_CD
              ,DEF_RTRN_RSW.RTL_WH_NM AS RSW_DEF_RTRN_PRNT_VND_NM
              ,RSW.DEF_RTRN_TO_RTL_SWH_CD AS RSW_DEF_RTRN_TO_RTL_SWH_CD
              </isNotNull>
              <!-- END 2017/10/25 S.Katsuma QC#21896 ADD -->
          FROM 
               RTL_WH RW
              ,RTL_WH DEF_RW
              ,PRNT_VND DEF_PV
              ,RTL_WH DEF_RTRN_RW
              ,PRNT_VND DEF_RTRN_PV
              ,VND V
              <!-- START 2017/10/25 S.Katsuma QC#21896 ADD -->
              <isNotNull property="destSwhCd">
              ,RTL_SWH RSW
              ,RTL_WH DEF_RSW
              ,RTL_WH DEF_RTRN_RSW
              </isNotNull>
              <!-- END 2017/10/25 S.Katsuma QC#21896 ADD -->
         WHERE
               RW.GLBL_CMPY_CD  = #glblCmpyCd#
           AND RW.RTL_WH_CD     = #destWhCd#
           AND RW.EZCANCELFLAG  = '0'
           AND RW.GLBL_CMPY_CD  = DEF_RW.GLBL_CMPY_CD(+)
           AND RW.DEF_SRC_RTL_WH_CD = DEF_RW.RTL_WH_CD(+)
           AND DEF_RW.EZCANCELFLAG(+)  = '0'
           AND RW.GLBL_CMPY_CD  = DEF_PV.GLBL_CMPY_CD(+)
           AND RW.DEF_SRC_RTL_WH_CD = DEF_PV.PRNT_VND_CD(+)
           AND DEF_PV.EZCANCELFLAG(+)  = '0'
           AND RW.GLBL_CMPY_CD  = DEF_RTRN_RW.GLBL_CMPY_CD(+)
           AND RW.DEF_RTRN_TO_RTL_WH_CD = DEF_RTRN_RW.RTL_WH_CD(+)
           AND DEF_RTRN_RW.EZCANCELFLAG(+)  = '0'
           AND RW.GLBL_CMPY_CD  = DEF_RTRN_PV.GLBL_CMPY_CD(+)
           AND RW.DEF_RTRN_TO_RTL_WH_CD = DEF_RTRN_PV.PRNT_VND_CD(+)
           AND DEF_RTRN_PV.EZCANCELFLAG(+)  = '0'
           AND RW.GLBL_CMPY_CD  = V.GLBL_CMPY_CD(+)
           AND RW.DEF_SRC_RTL_WH_CD = V.VND_CD(+)
           AND V.EZCANCELFLAG(+)  = '0'
           <!-- START 2017/10/25 S.Katsuma QC#21896 ADD -->
           <isNotNull property="destSwhCd">
           AND RW.GLBL_CMPY_CD = RSW.GLBL_CMPY_CD
           AND RW.RTL_WH_CD = RSW.RTL_WH_CD
           AND RSW.RTL_SWH_CD = #destSwhCd#
           AND RSW.EZCANCELFLAG(+)  = '0'
           AND RSW.GLBL_CMPY_CD = DEF_RSW.GLBL_CMPY_CD(+)
           AND RSW.DEF_SRC_RTL_WH_CD = DEF_RSW.RTL_WH_CD(+)
           AND DEF_RSW.EZCANCELFLAG(+)  = '0'
           AND RSW.GLBL_CMPY_CD = DEF_RTRN_RSW.GLBL_CMPY_CD(+)
           AND RSW.DEF_RTRN_TO_RTL_WH_CD = DEF_RTRN_RSW.RTL_WH_CD(+)
           AND DEF_RTRN_RSW.EZCANCELFLAG(+)  = '0'
           </isNotNull>
           <!-- END 2017/10/25 S.Katsuma QC#21896 ADD -->
    </statement>
    <statement id="checkWhCode" parameterClass="Map" resultClass="Map">
        SELECT
               RW.RTL_WH_CD
          FROM 
               RTL_WH RW
         WHERE
               RW.GLBL_CMPY_CD    = #glblCmpyCd#
           AND RW.RTL_WH_CD       = #destWhCd#
           AND RW.LOC_TP_CD       = #technician#
           AND RW.EFF_FROM_DT &lt;= #salesDate#
           AND NVL(RW.EFF_THRU_DT, #effThruDtDefalut#) &gt;= #salesDate#
           AND ROWNUM         &lt;= #rowNum#
           AND RW.EZCANCELFLAG    = '0'
    </statement>

    <!--Search-->
    <statement id="search" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
             MAIN.SRC_PRCH_REQ_NUM
            ,MAIN.PRCH_REQ_TP_CD
            ,MAIN.PRCH_REQ_STS_CD
            ,MAIN.PRCH_REQ_APVL_STS_CD
            ,MAIN.PRCH_REQ_CRAT_DT
            ,MAIN.PRCH_REQ_CRAT_TM
            ,MAIN.PRCH_REQ_CRAT_TZ
            ,MAIN.PRCH_REQ_SRC_TP_CD
            ,MAIN.FSR_NUM
            ,MAIN.SVC_TASK_NUM
            ,MAIN.SVC_MACH_SER_NUM
            ,MAIN.DELY_ADDL_CMNT_TXT
            ,MAIN.RQST_TECH_TOC_CD
            ,MAIN.SHIP_TO_CUST_CD
            ,MAIN.SHIP_TO_LOC_NM
            ,MAIN.SHIP_TO_ADDL_LOC_NM
            ,MAIN.PRCH_REQ_CMNT_TXT
            ,MAIN.SHIP_TO_FIRST_LINE_ADDR
            ,MAIN.SHIP_TO_SCD_LINE_ADDR
            ,MAIN.SHIP_TO_THIRD_LINE_ADDR
            ,MAIN.SHIP_TO_FRTH_LINE_ADDR
            ,MAIN.SHIP_TO_POST_CD
            ,MAIN.SHIP_TO_CTY_ADDR
            ,MAIN.SHIP_TO_CNTY_NM
            ,MAIN.SHIP_TO_ST_CD
            ,MAIN.SHIP_TO_PROV_NM
            ,MAIN.SHIP_TO_CTRY_CD
            ,MAIN.CTAC_PSN_NM
            ,MAIN.PRCH_REQ_REC_TP_CD
            ,MAIN.PRCH_REQ_APVL_DT
            ,MAIN.PRCH_REQ_APVL_BY_PSN_CD
            ,MAIN.TECH_EXP_RQST_FLG
            ,MAIN.EZUPTIME
            ,MAIN.EZUPTIMEZONE
            -- WHO BEGIN
            ,MAIN.XX_REC_HIST_CRAT_TS_H1
            ,MAIN.XX_REC_HIST_CRAT_BY_NM_H1
            ,MAIN.XX_REC_HIST_UPD_TS_H1
            ,MAIN.XX_REC_HIST_UPD_BY_NM_H1
            ,MAIN.XX_REC_HIST_TBL_NM_H1
            -- WHO END
            ,MAIN.PRCH_REQ_BAL_QTY
            ,MAIN.DEST_INVTY_LOC_CD
            ,MAIN.ORD_QTY
            ,MAIN.RQST_RCV_DT
            ,MAIN.RQST_RCV_TM
            ,MAIN.DEST_RTL_WH_CD
            ,MAIN.DEST_RTL_SWH_CD
            ,MAIN.SHPG_SVC_LVL_CD
            ,MAIN.CARR_CD
            ,MAIN.PRCH_REQ_LINE_NUM
            ,MAIN.PRCH_REQ_LINE_SUB_NUM
            ,MAIN.PRCH_REQ_LINE_TP_CD
            ,MAIN.MDSE_CD
            ,MAIN.PRCH_REQ_QTY
            ,MAIN.PROCR_TP_CD
            ,MAIN.SRC_RTL_WH_CD
            ,MAIN.SRC_RTL_SWH_CD
            ,MAIN.PRNT_VND_CD
            ,MAIN.VND_CD
            ,MAIN.PRCH_REQ_LINE_STS_CD
            ,MAIN.ROP_QTY
            ,MAIN.RWS_PUT_AWAY_QTY
            ,MAIN.PRCH_REQ_CANC_QTY
            ,MAIN.PO_ORD_NUM
            ,MAIN.PRCH_REQ_NUM
            ,MAIN.SO_NUM
        <!-- Add Start 2020/03/12 QC#56104 -->
            ,CASE WHEN MAIN.SO_NUM = MAIN.ALT_SO_NUM THEN NULL
                  ELSE MAIN.ALT_SO_NUM
             END AS ALT_SO_NUM
        <!-- Add End 2020/03/12 QC#56104 -->
            ,MAIN.RWS_NUM
        <!-- START 2021/07/09 J.Evangelista [QC#58876,ADD] -->
            ,MAIN.TRX_REF_NUM
        <!-- END 2021/07/09 J.Evangelista [QC#58876,ADD] -->
            ,MAIN.PRCH_REQ_INSRC_QTY
            ,MAIN.INSRC_FLG
            ,MAIN.PO_CRAT_FLG
            ,MAIN.PRCH_REQ_FRZ_FLG
            ,MAIN.PRCH_REQ_LINE_CMNT_TXT
            ,MAIN.PRO_NUM
            ,MAIN.ORIG_PRCH_REQ_LINE_NUM
            ,MAIN.ORIG_PRCH_REQ_LINE_SUB_NUM
            ,MAIN.SHIP_QTY
            ,MAIN.SRC_RTL_SWH_CD AS RTL_SWH_CD_1
            ,MAIN.DEST_RTL_SWH_CD AS RTL_SWH_CD_2
            ,MAIN.PRCH_REQ_STS_DESC_TXT
            ,MAIN.OPEN_STS_FLG
            ,MAIN.PRCH_REQ_APVL_STS_DESC_TXT
            ,MAIN.PRCH_REQ_SAVED_FLG
            ,MAIN.PRCH_REQ_TP_DESC_TXT
            ,MAIN.PRCH_REQ_SRC_TP_DESC_TXT
            ,MAIN.TECH_NM
            ,MAIN.SHPG_SVC_LVL_DESC_TXT
            ,MAIN.CARR_NM
            ,MAIN.PRCH_REQ_LINE_TP_DESC_TXT
            ,MAIN.MDSE_DESC_SHORT_TXT
            ,MAIN.PROCR_TP_DESC_TXT
            ,MAIN.HAZ_MAT_FLG
            ,MAIN.PRCH_REQ_LINE_STS_DESC_TXT
            ,MAIN.RTL_WH_NM_1
            ,MAIN.RTL_WH_NM_2
            ,MAIN.PRNT_VND_NM
            ,MAIN.LOC_NM
            ,MAIN.RWS_STS_CD
            ,MAIN.RWS_STS_DESC_TXT
            ,CASE WHEN PO_ACK_LINE_STS_CD IS NOT NULL AND MAIN.SUM_SHIP_QTY > 0 THEN #S#
                  ELSE MAIN.DS_SO_LINE_STS_CD
             END AS DS_SO_LINE_STS_CD
            ,CASE WHEN PO_ACK_LINE_STS_CD IS NOT NULL AND MAIN.SUM_SHIP_QTY > 0 THEN #Shipped#
                  ELSE MAIN.DS_SO_LINE_STS_DESC_TXT
             END AS DS_SO_LINE_STS_DESC_TXT
            ,MAIN.DS_ACCT_NM
            ,MAIN.FULL_PSN_NM
            ,MAIN.SUM_SHIP_QTY
            ,MAIN.SUM_RWS_PUT_AWAY_QTY
            ,MAIN.PO_SCHD_REL_DT
            -- WHO BEGIN
            ,MAIN.XX_REC_HIST_CRAT_TS_D1
            ,MAIN.XX_REC_HIST_CRAT_BY_NM_D1
            ,MAIN.XX_REC_HIST_UPD_TS_D1
            ,MAIN.XX_REC_HIST_UPD_BY_NM_D1
            ,MAIN.XX_REC_HIST_TBL_NM_D1
            -- WHO END
        FROM (
            SELECT
                 PR.PRCH_REQ_NUM AS SRC_PRCH_REQ_NUM
                ,PR.PRCH_REQ_TP_CD
                ,PR.PRCH_REQ_STS_CD
                ,PR.PRCH_REQ_APVL_STS_CD
                ,PR.PRCH_REQ_CRAT_DT
                ,PR.PRCH_REQ_CRAT_TM
                ,PR.PRCH_REQ_CRAT_TZ
                ,PR.PRCH_REQ_SRC_TP_CD
                ,PR.FSR_NUM
                ,PR.SVC_TASK_NUM
                ,PR.SVC_MACH_SER_NUM
                ,PR.DELY_ADDL_CMNT_TXT
                ,PR.RQST_TECH_TOC_CD
                ,PR.SHIP_TO_CUST_CD
                ,PR.SHIP_TO_LOC_NM
                ,PR.SHIP_TO_ADDL_LOC_NM
                ,PR.PRCH_REQ_CMNT_TXT
                ,NVL(PR.SHIP_TO_FIRST_LINE_ADDR,'') AS SHIP_TO_FIRST_LINE_ADDR
                ,NVL(PR.SHIP_TO_SCD_LINE_ADDR,'') AS SHIP_TO_SCD_LINE_ADDR
                ,NVL(PR.SHIP_TO_THIRD_LINE_ADDR,'') AS SHIP_TO_THIRD_LINE_ADDR
                ,NVL(PR.SHIP_TO_FRTH_LINE_ADDR,'') AS SHIP_TO_FRTH_LINE_ADDR
                ,PR.SHIP_TO_POST_CD
                ,PR.SHIP_TO_CTY_ADDR
                ,PR.SHIP_TO_CNTY_NM
                ,PR.SHIP_TO_ST_CD
                ,PR.SHIP_TO_PROV_NM
                ,PR.SHIP_TO_CTRY_CD
                ,PR.CTAC_PSN_NM
                ,PR.PRCH_REQ_REC_TP_CD
                ,PR.PRCH_REQ_APVL_DT
                ,PR.PRCH_REQ_APVL_BY_PSN_CD
                ,PR.TECH_EXP_RQST_FLG
                ,PR.EZUPTIME
                ,PR.EZUPTIMEZONE
                -- WHO BEGIN
                ,PR.EZINTIME       AS XX_REC_HIST_CRAT_TS_H1
                ,PR.EZINUSERID     AS XX_REC_HIST_CRAT_BY_NM_H1
                ,PR.EZUPTIME       AS XX_REC_HIST_UPD_TS_H1
                ,PR.EZUPUSERID     AS XX_REC_HIST_UPD_BY_NM_H1
                ,PR.EZTABLEID      AS XX_REC_HIST_TBL_NM_H1
                -- WHO END
                ,PRD.PRCH_REQ_BAL_QTY
                ,PRD.DEST_INVTY_LOC_CD
                ,PRD.ORD_QTY
                ,PRD.RQST_RCV_DT
                ,PRD.RQST_RCV_TM
                ,PRD.DEST_RTL_WH_CD
                ,PRD.DEST_RTL_SWH_CD
                ,PRD.SHPG_SVC_LVL_CD
                ,PRD.CARR_CD
                ,PRD.PRCH_REQ_LINE_NUM
                ,PRD.PRCH_REQ_LINE_SUB_NUM
                ,PRD.PRCH_REQ_LINE_TP_CD
                ,PRD.MDSE_CD
                ,PRD.PRCH_REQ_QTY
                ,PRD.PROCR_TP_CD
                ,PRD.SRC_RTL_WH_CD
                ,PRD.SRC_RTL_SWH_CD
                ,PRD.PRNT_VND_CD
                ,PRD.VND_CD
                ,PRD.PRCH_REQ_LINE_STS_CD
                ,PRD.ROP_QTY
                ,PRD.RWS_PUT_AWAY_QTY
                ,PRD.PRCH_REQ_CANC_QTY
                ,PRD2.PO_ORD_NUM
                ,PRD2.PRCH_REQ_NUM
                ,CASE
                     WHEN PRD.PRCH_REQ_LINE_TP_CD = #InsourcingPO# AND RD.RWS_NUM IS NULL THEN PAD2.VND_SO_NUM
                     WHEN PRD.PRCH_REQ_LINE_TP_CD = #InsourcingPO# AND NVL(RD2.RWS_NUM, RD.RWS_NUM) IS NOT NULL THEN (SELECT ASN_SO_NUM FROM EDI_ASN_HDR_WRK EAHW WHERE EAHW.GLBL_CMPY_CD = #glblCmpyCd# AND EAHW.RWS_NUM = NVL(RD2.RWS_NUM, RD.RWS_NUM) AND EAHW.EZCANCELFLAG = '0' AND ROWNUM = 1)
                 ELSE PRD.SO_NUM
                 END AS SO_NUM
            <!-- Add Start 2020/03/12 QC#56104 -->
                ,(SELECT SHIP_FROM_SO_NUM FROM EDI_ASN_HDR_WRK EAHW WHERE EAHW.GLBL_CMPY_CD = #glblCmpyCd# AND EAHW.RWS_NUM = NVL(RD2.RWS_NUM, RD.RWS_NUM) AND EAHW.EZCANCELFLAG = '0' AND ROWNUM = 1) AS ALT_SO_NUM
            <!-- Add End 2020/03/12 QC#56104 -->
                ,CASE WHEN PRD.PRCH_REQ_LINE_TP_CD = #InsourcingPO# THEN NVL(RD2.RWS_NUM, RD.RWS_NUM)
                 ELSE PRD.RWS_NUM
                 END AS RWS_NUM
            <!-- START 2021/07/09 J.Evangelista [QC#58876,ADD] -->
                ,PRD.TRX_REF_NUM
            <!-- END 2021/07/09 J.Evangelista [QC#58876,ADD] -->
                ,PRD.PRCH_REQ_INSRC_QTY
                ,PRD.INSRC_FLG
                ,PRD.PO_CRAT_FLG
                ,PRD.PRCH_REQ_FRZ_FLG
                ,PRD.PRCH_REQ_LINE_CMNT_TXT
                ,PRD.PRO_NUM
                ,PRD.ORIG_PRCH_REQ_LINE_NUM
                ,PRD.ORIG_PRCH_REQ_LINE_SUB_NUM
                ,PRD.SHIP_QTY
                ,PRD.SRC_RTL_SWH_CD AS RTL_SWH_CD_1
                ,PRD.DEST_RTL_SWH_CD AS RTL_SWH_CD_2
                ,PRS.PRCH_REQ_STS_DESC_TXT
                ,PRS.OPEN_STS_FLG
                ,PRAS.PRCH_REQ_APVL_STS_DESC_TXT
                ,PRAS.PRCH_REQ_SAVED_FLG
                ,(SELECT PRT.PRCH_REQ_TP_DESC_TXT FROM PRCH_REQ_TP PRT WHERE PR.GLBL_CMPY_CD = PRT.GLBL_CMPY_CD AND PR.PRCH_REQ_TP_CD = PRT.PRCH_REQ_TP_CD AND PRT.EZCANCELFLAG = '0') AS PRCH_REQ_TP_DESC_TXT
                ,(SELECT PRST.PRCH_REQ_SRC_TP_DESC_TXT FROM PRCH_REQ_SRC_TP PRST WHERE PR.GLBL_CMPY_CD = PRST.GLBL_CMPY_CD AND PR.PRCH_REQ_SRC_TP_CD = PRST.PRCH_REQ_SRC_TP_CD AND PRST.EZCANCELFLAG = '0') AS PRCH_REQ_SRC_TP_DESC_TXT
                ,(SELECT TM.TECH_NM FROM TECH_MSTR TM WHERE PR.GLBL_CMPY_CD = TM.GLBL_CMPY_CD AND PR.RQST_TECH_TOC_CD = TM.TECH_TOC_CD AND TM.EZCANCELFLAG = '0') AS TECH_NM
                ,(SELECT SSL.SHPG_SVC_LVL_DESC_TXT FROM SHPG_SVC_LVL SSL WHERE PRD.GLBL_CMPY_CD = SSL.GLBL_CMPY_CD AND PRD.SHPG_SVC_LVL_CD = SSL.SHPG_SVC_LVL_CD AND SSL.EZCANCELFLAG = '0') AS SHPG_SVC_LVL_DESC_TXT
                ,(SELECT OCV.CARR_NM FROM OTBD_CARR_V OCV WHERE PRD.GLBL_CMPY_CD = OCV.GLBL_CMPY_CD AND PRD.CARR_CD = OCV.CARR_CD AND OCV.EZCANCELFLAG = '0') AS CARR_NM
                ,(SELECT PRLT.PRCH_REQ_LINE_TP_DESC_TXT FROM PRCH_REQ_LINE_TP PRLT WHERE PRD.GLBL_CMPY_CD = PRLT.GLBL_CMPY_CD AND PRD.PRCH_REQ_LINE_TP_CD = PRLT.PRCH_REQ_LINE_TP_CD AND PRLT.EZCANCELFLAG = '0') AS PRCH_REQ_LINE_TP_DESC_TXT
                ,(SELECT MDSE.MDSE_DESC_SHORT_TXT FROM ALL_MDSE_V MDSE WHERE PRD.GLBL_CMPY_CD = MDSE.GLBL_CMPY_CD AND PRD.MDSE_CD = MDSE.MDSE_CD AND MDSE.EZCANCELFLAG = '0') AS MDSE_DESC_SHORT_TXT
                ,(SELECT PT.PROCR_TP_DESC_TXT FROM PROCR_TP PT WHERE PRD.GLBL_CMPY_CD = PT.GLBL_CMPY_CD AND PRD.PROCR_TP_CD = PT.PROCR_TP_CD AND PT.EZCANCELFLAG = '0') AS PROCR_TP_DESC_TXT
                ,(SELECT MFI.HAZ_MAT_FLG FROM MDSE_SFTY_INFO MFI WHERE PRD.GLBL_CMPY_CD = MFI.GLBL_CMPY_CD AND PRD.MDSE_CD = MFI.MDSE_CD AND MFI.EZCANCELFLAG = '0') AS HAZ_MAT_FLG
                ,(SELECT PRLS.PRCH_REQ_LINE_STS_DESC_TXT FROM PRCH_REQ_LINE_STS PRLS WHERE PRD.GLBL_CMPY_CD = PRLS.GLBL_CMPY_CD AND PRD.PRCH_REQ_LINE_STS_CD = PRLS.PRCH_REQ_LINE_STS_CD AND PRLS.EZCANCELFLAG = '0') AS PRCH_REQ_LINE_STS_DESC_TXT
                ,(SELECT RWH1.RTL_WH_NM FROM RTL_WH RWH1 WHERE PRD.GLBL_CMPY_CD = RWH1.GLBL_CMPY_CD AND PRD.SRC_RTL_WH_CD = RWH1.RTL_WH_CD AND RWH1.EZCANCELFLAG = '0') AS RTL_WH_NM_1
                ,(SELECT RWH2.RTL_WH_NM FROM RTL_WH RWH2 WHERE PRD.GLBL_CMPY_CD = RWH2.GLBL_CMPY_CD AND PRD.DEST_RTL_WH_CD = RWH2.RTL_WH_CD AND RWH2.EZCANCELFLAG = '0') AS RTL_WH_NM_2
                ,(SELECT PV.PRNT_VND_NM FROM PRNT_VND PV WHERE PRD.GLBL_CMPY_CD = PV.GLBL_CMPY_CD AND PRD.PRNT_VND_CD = PV.PRNT_VND_CD AND PV.EZCANCELFLAG = '0') AS PRNT_VND_NM
                ,(SELECT VND.LOC_NM FROM VND VND WHERE PRD.GLBL_CMPY_CD = VND.GLBL_CMPY_CD AND PRD.VND_CD = VND.VND_CD AND VND.EZCANCELFLAG = '0') AS LOC_NM
                ,CASE WHEN PRD.PRCH_REQ_LINE_TP_CD = #InsourcingPO# THEN NVL(RD2.RWS_STS_CD, RD.RWS_STS_CD)
                 ELSE RD.RWS_STS_CD
                 END AS RWS_STS_CD
                ,CASE WHEN PRD.PRCH_REQ_LINE_TP_CD = #InsourcingPO# THEN NVL(RS2.RWS_STS_DESC_TXT, RS.RWS_STS_DESC_TXT)
                 ELSE RS.RWS_STS_DESC_TXT
                 END AS RWS_STS_DESC_TXT
                <!-- START 2023/03/29 R.Azucena QC#61333 MOD -->
                <!-- ,NVL(DSOD.DS_SO_LINE_STS_CD, PAD2.PO_ACK_LINE_STS_CD) AS DS_SO_LINE_STS_CD -->
                <!-- ,NVL(DSLS.DS_SO_LINE_STS_DESC_TXT, PAD2.VND_PO_ACK_LINE_STS_TXT) AS DS_SO_LINE_STS_DESC_TXT -->
                ,CASE WHEN EXISTS(
                    SELECT
                        1
                    FROM
                        PO_ACK_DTL PAD3
                    WHERE
                        PAD3.GLBL_CMPY_CD       = PAD2.GLBL_CMPY_CD
                    AND PAD3.VND_SO_NUM         = PAD2.VND_SO_NUM
                    AND PAD3.PO_ACK_LINE_STS_CD = #S#
                    AND PAD3.EZCANCELFLAG       = '0') THEN #S#
                 ELSE NVL(DSOD.DS_SO_LINE_STS_CD, PAD2.PO_ACK_LINE_STS_CD)
                 END AS DS_SO_LINE_STS_CD
                ,CASE WHEN EXISTS(
                    SELECT
                        1
                    FROM
                        PO_ACK_DTL PAD3
                    WHERE
                        PAD3.GLBL_CMPY_CD       = PAD2.GLBL_CMPY_CD
                    AND PAD3.VND_SO_NUM         = PAD2.VND_SO_NUM
                    AND PAD3.PO_ACK_LINE_STS_CD = #S#
                    AND PAD3.EZCANCELFLAG       = '0') THEN #Shipped#
                 ELSE NVL(DSLS.DS_SO_LINE_STS_DESC_TXT, PAD2.VND_PO_ACK_LINE_STS_TXT)
                 END AS DS_SO_LINE_STS_DESC_TXT -->
                <!-- END 2023/03/29 R.Azucena QC#61333 MOD -->
                ,DAC.DS_ACCT_NM
                ,NVL2(SSUL.FULL_PSN_NM,SSUL.FULL_PSN_NM,AP.FIRST_NM || (NVL2(AP.MID_NM, ' '||AP.MID_NM||' ', ' ')) || AP.LAST_NM)    FULL_PSN_NM
                ,NVL((SELECT
                          SUM(PRD2.SHIP_QTY)
                      FROM
                          PRCH_REQ_DTL PRD2
                      WHERE
                          PRD.PRCH_REQ_NUM           =    PRD2.PRCH_REQ_NUM
                      AND PRD.PRCH_REQ_LINE_NUM      =    PRD2.PRCH_REQ_LINE_NUM
                      AND PRD2.PRCH_REQ_LINE_SUB_NUM &gt; #lineSubNumParent#
                      AND PRD2.EZCANCELFLAG          =    '0'
                     ), PRD.SHIP_QTY
                ) AS SUM_SHIP_QTY
                ,NVL((SELECT
                          SUM(PRD2.RWS_PUT_AWAY_QTY)
                      FROM
                          PRCH_REQ_DTL PRD2
                      WHERE
                          PRD.PRCH_REQ_NUM           =    PRD2.PRCH_REQ_NUM
                      AND PRD.PRCH_REQ_LINE_NUM      =    PRD2.PRCH_REQ_LINE_NUM
                      AND PRD2.PRCH_REQ_LINE_SUB_NUM &gt; #lineSubNumParent#
                      AND PRD2.EZCANCELFLAG          =    '0'
                    ), PRD.RWS_PUT_AWAY_QTY
                ) AS SUM_RWS_PUT_AWAY_QTY
                ,PAD2.PO_ACK_LINE_STS_CD
                ,PRD.PO_SCHD_REL_DT
                -- WHO BEGIN
                ,PRD.EZINTIME       AS XX_REC_HIST_CRAT_TS_D1
                ,PRD.EZINUSERID     AS XX_REC_HIST_CRAT_BY_NM_D1
                ,PRD.EZUPTIME       AS XX_REC_HIST_UPD_TS_D1
                ,PRD.EZUPUSERID     AS XX_REC_HIST_UPD_BY_NM_D1
                ,PRD.EZTABLEID      AS XX_REC_HIST_TBL_NM_D1
                -- WHO END
            FROM
                 PRCH_REQ PR
                ,PRCH_REQ_DTL PRD
                ,PRCH_REQ_STS PRS
                ,PRCH_REQ_APVL_STS PRAS
                ,RWS_DTL RD
                ,RWS_STS RS
                ,SHPG_ORD_DTL DSOD
                ,DS_SO_LINE_STS DSLS
                ,AUTH_PSN AP
                ,SCE_SYS_USR_LIST SSUL
                ,SHIP_TO_CUST STC
                ,SELL_TO_CUST DAC
                ,PRCH_REQ PR2
                ,PRCH_REQ_DTL PRD2
                ,PO_ACK_HDR PAH2
                ,PO_ACK_DTL PAD2
                ,RWS_HDR RH2 
                ,RWS_DTL RD2
                ,RWS_STS RS2
            WHERE
                    PR.GLBL_CMPY_CD            = #glblCmpyCd#
                AND PR.PRCH_REQ_NUM            = #prchReqNum#
                AND PR.PRCH_REQ_REC_TP_CD      IN (#prchReqRecTpCdRequest#, #prchReqRecTpCdReturn#)
                AND PR.GLBL_CMPY_CD            = PRS.GLBL_CMPY_CD(+)
                AND PR.PRCH_REQ_STS_CD         = PRS.PRCH_REQ_STS_CD(+)
                AND PR.GLBL_CMPY_CD            = PRAS.GLBL_CMPY_CD(+)
                AND PR.PRCH_REQ_APVL_STS_CD    = PRAS.PRCH_REQ_APVL_STS_CD(+)
                AND PR.GLBL_CMPY_CD            = PRD.GLBL_CMPY_CD
                AND PR.PRCH_REQ_NUM            = PRD.PRCH_REQ_NUM
                AND PRD.GLBL_CMPY_CD           = RD.GLBL_CMPY_CD(+)
                AND PRD.PRCH_REQ_NUM           = RD.PRCH_REQ_NUM(+)
                AND PRD.PRCH_REQ_LINE_NUM      = RD.PRCH_REQ_LINE_NUM(+)
                AND PRD.PRCH_REQ_LINE_SUB_NUM  = RD.PRCH_REQ_LINE_SUB_NUM(+)
                AND PRD.PRCH_REQ_NUM           = DSOD.PRCH_REQ_NUM(+)
                AND PRD.PRCH_REQ_LINE_NUM      = DSOD.PRCH_REQ_LINE_NUM(+)
                AND PRD.PRCH_REQ_LINE_SUB_NUM  = DSOD.PRCH_REQ_LINE_SUB_NUM(+)
                AND PRD.GLBL_CMPY_CD           = DSOD.GLBL_CMPY_CD(+)
                AND RD.GLBL_CMPY_CD            = RS.GLBL_CMPY_CD(+)
                AND RD.RWS_STS_CD              = RS.RWS_STS_CD(+)
                AND DSOD.GLBL_CMPY_CD          = DSLS.GLBL_CMPY_CD(+)
                AND DSOD.DS_SO_LINE_STS_CD     = DSLS.DS_SO_LINE_STS_CD(+)
                AND PR.GLBL_CMPY_CD            = AP.GLBL_CMPY_CD(+)
                AND PR.PRCH_REQ_RQST_BY_PSN_CD = AP.USR_NM(+)
                AND PR.GLBL_CMPY_CD            = SSUL.GLBL_CMPY_CD(+)
                AND PR.PRCH_REQ_CRAT_BY_PSN_CD = SSUL.FULL_PSN_NM(+)
                AND PR.GLBL_CMPY_CD            = STC.GLBL_CMPY_CD(+)
                AND PR.SHIP_TO_CUST_CD         = STC.SHIP_TO_CUST_CD(+)
                AND STC.GLBL_CMPY_CD           = DAC.GLBL_CMPY_CD(+)
                AND STC.SELL_TO_CUST_CD        = DAC.SELL_TO_CUST_CD(+)
                AND PRD.GLBL_CMPY_CD           = PRD2.GLBL_CMPY_CD(+)
                AND PRD.PRCH_REQ_NUM           = PRD2.TRX_REF_NUM(+)
                AND PRD.PRCH_REQ_LINE_NUM      = PRD2.TRX_REF_LINE_NUM(+)
                AND PRD.PRCH_REQ_LINE_SUB_NUM  = PRD2.TRX_REF_LINE_SUB_NUM(+)
                AND PRD2.GLBL_CMPY_CD          = PR2.GLBL_CMPY_CD(+)
                AND PRD2.PRCH_REQ_NUM          = PR2.PRCH_REQ_NUM(+)
                AND PR2.PRCH_REQ_SRC_TP_CD(+)  = #prchReqSrcTpCdInsourcing#
                AND PRD2.GLBL_CMPY_CD          = PAH2.GLBL_CMPY_CD(+)
                AND PRD2.PO_ORD_NUM            = PAH2.PO_ORD_NUM(+)
                AND PRD2.GLBL_CMPY_CD          = PAD2.GLBL_CMPY_CD(+)
                AND PRD2.PO_ORD_NUM            = PAD2.PO_ORD_NUM(+)
                AND PRD2.PO_ORD_DTL_LINE_NUM   = PAD2.PO_ORD_DTL_LINE_NUM(+)
                AND PAD2.VND_SO_NUM(+)         IS NOT NULL
                AND PAD2.GLBL_CMPY_CD          = RH2.GLBL_CMPY_CD(+)
                AND PAD2.VND_SO_NUM            = RH2.RWS_REF_NUM(+)
                <!-- START 2019/08/19 R.Kurahashi QC#52758 ADD -->
                <!-- START 2023/03/29 R.Azucena QC#61333 DEL -->
                <!-- AND PAD2.PO_ACK_DTL_LTST_FLG(+) = 'Y' -->
                <!-- END 2023/03/29 R.Azucena QC#61333 DEL -->
                <!-- END 2019/08/19 R.Kurahashi QC#52758 ADD -->
                AND PRD2.GLBL_CMPY_CD           = RD2.GLBL_CMPY_CD(+)
                AND PRD2.TRX_REF_NUM            = RD2.PRCH_REQ_NUM(+)
                AND PRD2.TRX_REF_LINE_NUM       = RD2.PRCH_REQ_LINE_NUM(+)
                AND PRD2.TRX_REF_LINE_SUB_NUM   = RD2.PRCH_REQ_LINE_SUB_NUM(+)
                AND RD2.GLBL_CMPY_CD           = RS2.GLBL_CMPY_CD(+)
                AND RD2.RWS_STS_CD             = RS2.RWS_STS_CD(+)
                AND PR.EZCANCELFLAG            = '0'
                AND PRD.EZCANCELFLAG           = '0'
                AND PRS.EZCANCELFLAG(+)        = '0'
                AND PRAS.EZCANCELFLAG(+)       = '0'
                AND RD.EZCANCELFLAG(+)         = '0'
                AND RS.EZCANCELFLAG(+)         = '0'
                AND DSOD.EZCANCELFLAG(+)       = '0'
                AND DSLS.EZCANCELFLAG(+)       = '0'
                AND AP.EZCANCELFLAG(+)         = '0'
                AND SSUL.EZCANCELFLAG(+)       = '0'
                AND STC.EZCANCELFLAG(+)        = '0'
                AND DAC.EZCANCELFLAG(+)        = '0'
                AND PRD2.EZCANCELFLAG(+)       = '0'
                AND PR2.EZCANCELFLAG(+)        = '0'
                AND PAH2.EZCANCELFLAG(+)       = '0'
                AND PAD2.EZCANCELFLAG(+)       = '0'
                AND RH2.EZCANCELFLAG(+)        = '0'
                AND RD2.EZCANCELFLAG(+)        = '0'
                AND RS2.EZCANCELFLAG(+)        = '0'
        ) MAIN
        ORDER BY
             MAIN.PRCH_REQ_LINE_NUM ASC
            ,MAIN.PRCH_REQ_LINE_SUB_NUM ASC
            ,MAIN.SO_NUM
            ,MAIN.RWS_NUM
    </statement>

    <statement id="checkOpenSO" parameterClass="Map" resultClass="String">
        SELECT
               '1'
          FROM 
                SHPG_ORD_DTL DSOD
               ,SHPG_ORD SO
               ,SHPG_STS SS
         WHERE
               DSOD.GLBL_CMPY_CD    = #glblCmpyCd#
           AND DSOD.PRCH_REQ_NUM    = #prchReqNum#
           AND DSOD.GLBL_CMPY_CD    = SO.GLBL_CMPY_CD
           AND DSOD.SO_NUM          = SO.SO_NUM
           AND SO.SCE_ORD_TP_CD     = #sceOrdTpCd#
           AND SO.GLBL_CMPY_CD      = SS.GLBL_CMPY_CD
           AND SO.SHPG_STS_CD       = SS.SHPG_STS_CD
           AND SS.SO_PRINT_FLG      = #flagY#
           AND SS.SHIP_FLG          = #flagN#
           AND DSOD.EZCANCELFLAG    = '0'
           AND SO.EZCANCELFLAG      = '0'
           AND SS.EZCANCELFLAG      = '0'
    </statement>

    <statement id="checkOpenRWS" parameterClass="Map" resultClass="String">
        SELECT
               '1'
          FROM 
                RWS_DTL DRD
               ,RWS_HDR RH
               ,RWS_STS RS
         WHERE
               DRD.GLBL_CMPY_CD    = #glblCmpyCd#
           AND DRD.PRCH_REQ_NUM    = #prchReqNum#
           AND DRD.GLBL_CMPY_CD    = RH.GLBL_CMPY_CD
           AND DRD.RWS_NUM         = RH.RWS_NUM
           AND RH.SCE_ORD_TP_CD    = #sceOrdTpCd#
           AND RH.GLBL_CMPY_CD     = RS.GLBL_CMPY_CD
           AND RH.RWS_STS_CD       = RS.RWS_STS_CD
           AND RS.RWS_OPEN_FLG     = #flagY#
           AND DRD.EZCANCELFLAG    = '0'
           AND RH.EZCANCELFLAG     = '0'
           AND RS.EZCANCELFLAG     = '0'
    </statement>

    <statement id="checkOpenPR" parameterClass="Map" resultClass="String">
        SELECT
               '1'
          FROM 
                PRCH_REQ PR
               ,PRCH_REQ_STS PRS
         WHERE
               PR.GLBL_CMPY_CD       = #glblCmpyCd#
           AND PR.TRX_REF_NUM        = #prchReqNum#
           AND PR.PRCH_REQ_REC_TP_CD = #prchReqRecTpCd#
           AND PR.GLBL_CMPY_CD       = PRS.GLBL_CMPY_CD
           AND PR.PRCH_REQ_STS_CD    = PRS.PRCH_REQ_STS_CD
           AND PRS.OPEN_STS_FLG      = #flagY#
           AND PR.EZCANCELFLAG       = '0'
           AND PRS.EZCANCELFLAG      = '0'
    </statement>

    <statement id="checkOpenPO" parameterClass="Map" resultClass="String">
        SELECT
               '1'
          FROM 
                PO_DTL DPD
         <!-- Del Start 2020/03/10 QC#56178 -->
         <!--       ,PO DP -->
         <!-- Del End 2020/03/10 QC#56178 -->
         WHERE
               DPD.GLBL_CMPY_CD    = #glblCmpyCd#
           AND DPD.PRCH_REQ_NUM    = #prchReqNum#
         <!-- Mod Start 2020/03/10 QC#56178 -->
           AND DPD.PO_STS_CD       NOT IN (#poStsCdClosed#, #poStsCdCanceled#)
         <!--   AND DPD.GLBL_CMPY_CD    = DP.GLBL_CMPY_CD -->
         <!--   AND DPD.PO_ORD_NUM      = DP.PO_ORD_NUM -->
         <!--   AND DP.PO_HDR_STS_CD    = #poHdrStsCd# -->
         <!-- Mod End 2020/03/10 QC#56178 -->
           AND DPD.EZCANCELFLAG    = '0'
         <!-- Del Start 2020/03/10 QC#56178 -->
         <!--   AND DP.EZCANCELFLAG     = '0' -->
         <!-- Del End 2020/03/10 QC#56178 -->
    </statement>

    <statement id="getDocumentSourceTypeName" parameterClass="Map"
        resultClass="String">
        SELECT
            PRST.PRCH_REQ_SRC_TP_DESC_TXT
        FROM
            PRCH_REQ_SRC_TP PRST
        WHERE
                PRST.GLBL_CMPY_CD       = #glblCmpyCd#
            AND PRST.PRCH_REQ_SRC_TP_CD = #prchReqSrcTpCd#
            AND PRST.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getSplyItemNumFromAsl" parameterClass="Map" resultClass="String">
        SELECT
            AD.SPLY_ITEM_NUM
        FROM
             ASL_HDR AH
            ,ASL_DTL AD
        WHERE 1=1
        AND AH.GLBL_CMPY_CD                           = #glblCmpyCd#
        AND AH.GLBL_CMPY_CD                           = AD.GLBL_CMPY_CD
        AND AH.ASL_HDR_PK                             = AD.ASL_HDR_PK
        AND AH.ASL_START_DT                      &lt; = #salesDate#
        AND NVL(AH.ASL_END_DT   , '99991231'   ) &gt; = #salesDate#
        AND AD.VND_CD                                 = #vndCd#
        AND AD.MDSE_CD                                = #mdseCd#
        AND AD.EFF_FROM_DT                       &lt; = #salesDate#
        AND NVL(AD.EFF_THRU_DT , '99991231' )    &gt; = #salesDate#
    </statement>
    <!-- 2017/08/31 K.Kameoka Sol#369(QC#19243) ADD START -->
    <statement id="getInsrcCtrlInfo" parameterClass="Map" resultClass="String">
        SELECT
            MAIN.TECH_RQST_CRAT_FLG
        FROM (
            SELECT 
                IC.TECH_RQST_CRAT_FLG
            FROM 
                 TECH_MSTR TM
                ,S21_PSN  PSN
                ,INSRC_CTRL IC
                ,RTL_WH   WH
           WHERE
                TM.GLBL_CMPY_CD       =  #glblCmpyCd#
            AND TM.GLBL_CMPY_CD       =  PSN.GLBL_CMPY_CD
            AND TM.TECH_TOC_CD        =  PSN.PSN_CD
            AND TM.GLBL_CMPY_CD       =  IC.GLBL_CMPY_CD
            AND PSN.LINE_BIZ_TP_CD    =  IC.LINE_BIZ_TP_CD
            AND IC.PRCH_REQ_TP_CD     =  #prchReqTpCd#
            <iterate property="shpgSvcLvlCds" var="shpgSvcLvlCd[]" open="AND IC.SHPG_SVC_LVL_CD IN ( " close=" )" conjunction=",">
                #shpgSvcLvlCd[]#
            </iterate>
            AND TM.GLBL_CMPY_CD       =  WH.GLBL_CMPY_CD
            AND TM.TECH_TOC_CD        =  WH.RTL_WH_CD
            AND WH.RTL_WH_CD          =  #rtlWhCd#
            AND TM.EZCANCELFLAG       = '0'
            AND PSN.EZCANCELFLAG      = '0'
            AND IC.EZCANCELFLAG       = '0'
            AND WH.EZCANCELFLAG       = '0'
            ORDER BY 
                IC.SHPG_SVC_LVL_CD DESC
            ) MAIN
        WHERE
            ROWNUM = 1
    </statement>
    <!-- 2017/08/31 K.Kameoka Sol#369(QC#19243) ADD END -->

    <!-- START 2017/10/25 S.Katsuma QC#21896 ADD -->
    <statement id="getTechCustomerWH" parameterClass="Map" resultClass="Map">
        SELECT
            RW.DEF_RTRN_TO_PROCR_TP_CD
           ,RW.DEF_RTRN_TO_RTL_WH_CD
           ,DEF_RTRN_RW.RTL_WH_NM
           ,RW.DEF_RTRN_TO_RTL_SWH_CD
        FROM
            RTL_WH RW
           ,RTL_WH DEF_RTRN_RW
        WHERE
            RW.GLBL_CMPY_CD                       = #glblCmpyCd#
        AND RW.RTL_WH_CD                          = #destWhCd#
        AND RW.EZCANCELFLAG                       = '0'
        AND NVL(RW.WH_MGR_PSN_CD, RW.TECH_TOC_CD) = #rqstTechTocCd#
        AND RW.GLBL_CMPY_CD                       = DEF_RTRN_RW.GLBL_CMPY_CD(+)
        AND RW.DEF_RTRN_TO_RTL_WH_CD              = DEF_RTRN_RW.RTL_WH_CD(+)
        AND DEF_RTRN_RW.EZCANCELFLAG(+)           = '0'
    </statement>
    <!-- END 2017/10/25 S.Katsuma QC#21896 ADD -->
    
    <!-- 2018/12/18 T.Tokutomi QC#29299 ADD -->
    <statement id="getSourceCondition" parameterClass="Map" resultClass="String">
        SELECT
            DCC.DS_COND_CONST_VAL_TXT_05 SRC_WH
        FROM
            DS_COND_CONST DCC
        WHERE
            DCC.GLBL_CMPY_CD                       = #glblCmpyCd#
        AND DCC.DS_COND_CONST_GRP_ID               = #grpId#
        AND DCC.DS_COND_CONST_VAL_TXT_04           = #prchReqTpCd#
        AND DCC.EZCANCELFLAG                       = '0'
    </statement>

    <statement id="isPoDtlCancel" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(PD.GLBL_CMPY_CD) AS CNT
        FROM
            PO_DTL PD
        WHERE
            PD.GLBL_CMPY_CD      = #glblCmpyCd#
        AND PD.PRCH_REQ_NUM      = #prchReqNum#
        AND PD.PRCH_REQ_LINE_NUM = #prchReqLineNum#
        AND PD.PO_LINE_STS_CD NOT IN(#cancel#, #close#)
        AND PD.EZCANCELFLAG      = '0'
    </statement>

    <statement id="isPrDtlCancel" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(PRD.GLBL_CMPY_CD) AS CNT
        FROM
            PRCH_REQ_DTL PRD
        WHERE
            PRD.GLBL_CMPY_CD      = #glblCmpyCd#
        AND PRD.TRX_REF_NUM       = #prchReqNum#
        AND PRD.TRX_REF_LINE_NUM  = #prchReqLineNum#
        AND PRD.PRCH_REQ_LINE_STS_CD NOT IN(#cancel#, #close#)
        AND PRD.EZCANCELFLAG      = '0'
    </statement>

    <statement id="isRwsDtlCancel" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(RD.GLBL_CMPY_CD) AS CNT
        FROM
            RWS_DTL RD
        WHERE
            RD.GLBL_CMPY_CD       = #glblCmpyCd#
        AND RD.PRCH_REQ_NUM       = #prchReqNum#
        AND RD.PRCH_REQ_LINE_NUM  = #prchReqLineNum#
        AND RD.RWS_STS_CD NOT IN(#cancel#, #received#)
        AND RD.EZCANCELFLAG      = '0'
    </statement>

    <statement id="isSoDtlCancel" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(SOD.GLBL_CMPY_CD) AS CNT
        FROM
            SHPG_ORD_DTL SOD
        WHERE
            SOD.GLBL_CMPY_CD       = #glblCmpyCd#
        AND SOD.PRCH_REQ_NUM       = #prchReqNum#
        AND SOD.PRCH_REQ_LINE_NUM  = #prchReqLineNum#
        AND SOD.SHPG_STS_CD     &lt; #shipped#
        AND SOD.EZCANCELFLAG       = '0'
    </statement>

<!--START 2023/08/03 T.Kuroda [QC#61648, ADD]-->
    <statement id="getInvtyLocCd" parameterClass="Map" resultClass="String">
        SELECT
             EMER_SRC_RTL_WH_CD || EMER_SRC_RTL_SWH_CD AS EMER_SRC_INVTY_LOC_CD
        FROM
            RTL_WH
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND RTL_WH_CD = #destRtlWhCd#
            AND EFF_FROM_DT &lt;= #slsDt#
            AND NVL(EFF_THRU_DT, #slsDt#) &gt;= #slsDt#
            AND EZCANCELFLAG = '0'
    </statement>

    <statement id="getOpenTrOrdQty" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            NVL(SUM(PRD.PRCH_REQ_QTY), 0)
        FROM
            PRCH_REQ PR
          , PRCH_REQ_DTL PRD
          , PRCH_REQ_APVL_STS PRAS
        WHERE
            PR.GLBL_CMPY_CD = #glblCmpyCd#
        AND PR.EZCANCELFLAG = '0'
        AND PR.PRCH_REQ_STS_CD = #prchReqStsCd#
        AND PR.GLBL_CMPY_CD = PRD.GLBL_CMPY_CD
        AND PR.PRCH_REQ_NUM = PRD.PRCH_REQ_NUM
        AND PRD.EZCANCELFLAG = '0'
        AND PRD.PRCH_REQ_LINE_SUB_NUM = 0
        <iterate property="prchReqLineStsCd" var="prchReqLineStsCd[]" open="AND PRD.PRCH_REQ_LINE_STS_CD IN ( " close=" )" conjunction=",">#prchReqLineStsCd[]#</iterate>
        <iterate property="prchReqRelStsCd" var="prchReqRelStsCd[]" open="AND PRD.PRCH_REQ_REL_STS_CD IN ( " close=" )" conjunction=",">#prchReqRelStsCd[]#</iterate>
        AND PRD.MDSE_CD = #mdseCd#
        AND PRD.SRC_INVTY_LOC_CD = #srcInvtyLocCd#
        AND PR.GLBL_CMPY_CD = PRAS.GLBL_CMPY_CD
        AND PR.PRCH_REQ_APVL_STS_CD = PRAS.PRCH_REQ_APVL_STS_CD
        AND PRAS.EZCANCELFLAG = '0'
        AND PRAS.PRCH_REQ_APVL_FLG = #prchReqApvlFlg#
    </statement>

    <statement id="getAvaQty" parameterClass="Map" resultClass="BigDecimal">
    SELECT
        NVL(INVTY_AVAL_QTY, 0)
    FROM
        INVTY
    WHERE
        GLBL_CMPY_CD = #glblCmpyCd#
        AND EZCANCELFLAG = '0'
        AND MDSE_CD = #mdseCd#
        AND INVTY_LOC_CD = #invtyLocCd#
        AND LOC_STS_CD = #locStsCd#
        AND STK_STS_CD = #stkStsCd#
        AND INVTY_AVAL_QTY &gt; 0
    </statement>
<!--END 2023/08/03 T.Kuroda [QC#61648, ADD]-->
</sqlMap>
