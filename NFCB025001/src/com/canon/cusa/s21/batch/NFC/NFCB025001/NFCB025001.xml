<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NFCB025001">
    <typeAlias alias="AR_APPLY_INTFC_WRKTMsg_alias" type="business.db.AR_APPLY_INTFC_WRKTMsg"/>
    <statement id="getApplyGrpKeyByIntfcId" parameterClass="Map">
        SELECT
            A.APPLY_GRP_KEY
           ,B.RCV_HDR_NUM
           ,MAX(B.RCV_SQ_PK) AS RCV_SQ_PK
<!-- for North America(CSA) 2015/04/08 Add Start -->
           ,A.PROC_STS_CD
           ,B.AR_BAT_RCPT_NM
           ,MAX(B.AR_CUST_ID_STS_CD) AS AR_CUST_ID_STS_CD
<!-- for North America(CSA) 2015/04/08 Add End -->
        FROM
            AR_APPLY_INTFC_WRK A
        INNER JOIN
            AR_RCPT_IN_PROC_WRK  B
            ON  ( A.GLBL_CMPY_CD        =  B.GLBL_CMPY_CD
            AND   A.RCPT_IN_PROC_SQ_PK  =  B.RCPT_IN_PROC_SQ_PK
            AND   A.RCV_HDR_NUM         =  B.RCV_HDR_NUM
            <isNotNull property="lineList">
                <iterate property="lineList" var="lineList[]" open="AND B.RCPT_BAT_SQ_NUM IN (" close=")" conjunction=",">
                    #lineList[]#
                </iterate>
            </isNotNull>
            AND   A.RCV_DTL_NUM         =  B.RCV_DTL_NUM  )
        WHERE
                 A.GLBL_CMPY_CD  =  #glblCmpyCd#
            AND  A.INTFC_ID      =  #intfcId#
<!-- for North America(CSA) 2015/04/08 Mod Start -->
            AND  (A.PROC_STS_CD    =  #procStsCd1#
                  OR A.PROC_STS_CD =  #procStsCd2#)
<!-- for North America(CSA) 2015/04/08 Mod End -->
            AND  A.EZCANCELFLAG  =  '0'
        GROUP BY
                 A.APPLY_GRP_KEY
                ,B.RCV_HDR_NUM
<!-- for North America(CSA) 2015/04/08 Add Start -->
                ,A.PROC_STS_CD
                ,B.AR_BAT_RCPT_NM
<!-- for North America(CSA) 2015/04/08 Add End -->
        ORDER BY
                 A.APPLY_GRP_KEY
                ,B.RCV_HDR_NUM
    </statement>

	<statement id="getBillToCust" parameterClass="Map">
	    SELECT BILL_TO_CUST_CD
	      FROM AR_APPLY_INTFC_WRK   AIW
	          ,AR_TRX_BAL           TB
	          ,AR_RCPT_IN_PROC_WRK  RIW
	     WHERE AIW.GLBL_CMPY_CD        = #glblCmpyCd#
	       AND AIW.EZCANCELFLAG        = '0'
	       AND AIW.APPLY_GRP_KEY       = #applyGrpKey#
	       AND AIW.RCV_HDR_NUM         = #rcvHdrNum#
	       AND AIW.PROC_STS_CD         = #procStsCd#
	       AND AIW.GLBL_CMPY_CD        = TB.GLBL_CMPY_CD
	       AND AIW.EZCANCELFLAG        = TB.EZCANCELFLAG
	       AND AIW.INV_NUM             = TB.AR_TRX_NUM
	       AND AIW.GLBL_CMPY_CD        = RIW.GLBL_CMPY_CD
	       AND AIW.EZCANCELFLAG        = RIW.EZCANCELFLAG
	       AND AIW.RCPT_IN_PROC_SQ_PK  = RIW.RCPT_IN_PROC_SQ_PK
           AND AIW.RCV_HDR_NUM         = RIW.RCV_HDR_NUM
           AND AIW.RCV_DTL_NUM         = RIW.RCV_DTL_NUM
           AND RIW.AR_BAT_RCPT_NM      = #batRcptNm#
	     GROUP BY TB.BILL_TO_CUST_CD
	      
	</statement>
	
	<statement id="getTrgetApplyIntfcWrk" parameterClass="Map">
	    SELECT AIW.GLBL_CMPY_CD
	          ,AIW.APPLY_GRP_KEY
	          ,AIW.APPLY_GRP_SUB_PK
	      FROM AR_APPLY_INTFC_WRK   AIW
	          ,AR_RCPT_IN_PROC_WRK  RIW
	     WHERE AIW.GLBL_CMPY_CD        = #glblCmpyCd#
	       AND AIW.EZCANCELFLAG        = '0'
	       AND AIW.APPLY_GRP_KEY       = #applyGrpKey#
	       AND AIW.RCV_HDR_NUM         = #rcvHdrNum#
	       AND AIW.PROC_STS_CD         = #procStsCd#
	       AND AIW.GLBL_CMPY_CD        = RIW.GLBL_CMPY_CD
	       AND AIW.EZCANCELFLAG        = RIW.EZCANCELFLAG
	       AND AIW.RCPT_IN_PROC_SQ_PK  = RIW.RCPT_IN_PROC_SQ_PK
           AND AIW.RCV_HDR_NUM         = RIW.RCV_HDR_NUM
           AND AIW.RCV_DTL_NUM         = RIW.RCV_DTL_NUM
           AND RIW.AR_BAT_RCPT_NM      = #batRcptNm#
	      
	</statement>

    <statement id="getApplyGrpKeyByUpldCsvId" parameterClass="Map">
        SELECT
            A.APPLY_GRP_KEY
           ,B.RCV_HDR_NUM
           ,MAX(B.RCV_SQ_PK) AS RCV_SQ_PK
        FROM
            AR_APPLY_INTFC_WRK A
        INNER JOIN
            AR_RCPT_IN_PROC_WRK  B
            ON  ( A.GLBL_CMPY_CD        =  B.GLBL_CMPY_CD
            AND   A.RCPT_IN_PROC_SQ_PK  =  B.RCPT_IN_PROC_SQ_PK
            AND   A.RCV_HDR_NUM         =  B.RCV_HDR_NUM
            AND   A.RCV_DTL_NUM         =  B.RCV_DTL_NUM  )
        WHERE
                 A.GLBL_CMPY_CD  =  #glblCmpyCd#
            AND  A.UPLD_CSV_ID   =  #upldCsvId#
            AND  A.PROC_STS_CD   =  #procStsCd1#
            AND  A.EZCANCELFLAG  =  '0'
        GROUP BY
                 A.APPLY_GRP_KEY
                ,B.RCV_HDR_NUM
        ORDER BY
                 A.APPLY_GRP_KEY
                ,B.RCV_HDR_NUM
    </statement>
    
    <statement id="getRcvSqPk" parameterClass="Map">
        SELECT
            B.RCV_SQ_PK
        FROM
             AR_APPLY_INTFC_WRK   A
            ,AR_RCPT_IN_PROC_WRK  B
			,AR_RCPT_RCV_HIST     C
        WHERE
                 A.GLBL_CMPY_CD        =  #glblCmpyCd#
            <isNotNull property="intfcId">
           	 AND  A.INTFC_ID      =  #intfcId#
            </isNotNull>
            <isNotNull property="upldCsvId">
            	AND  A.UPLD_CSV_ID         =  #upldCsvId#
            </isNotNull>
            AND  A.PROC_STS_CD         =  #procStsCd1#
            AND  A.EZCANCELFLAG        =  '0'
			AND  A.GLBL_CMPY_CD        =  B.GLBL_CMPY_CD
            AND  A.RCPT_IN_PROC_SQ_PK  =  B.RCPT_IN_PROC_SQ_PK
            AND  A.RCV_HDR_NUM         =  B.RCV_HDR_NUM
            AND  A.RCV_DTL_NUM         =  B.RCV_DTL_NUM
			AND  C.GLBL_CMPY_CD        =  B.GLBL_CMPY_CD
            AND  C.RCV_HIST_SQ_PK      =  B.RCV_SQ_PK
			AND  C.RCV_HDR_NUM         =  B.RCV_HDR_NUM
			AND  C.RCPT_DEP_CHK_FLG    =  #rcptDepChkFlg1#
            AND  B.EZCANCELFLAG  	   =  '0'
            AND  C.EZCANCELFLAG        =  '0'
        GROUP BY
			B.RCV_SQ_PK
    </statement>    
    
    <statement id="getReceptHistIntfcId" parameterClass="Map">
        SELECT
            A.APPLY_GRP_KEY
           ,B.GLBL_CMPY_CD
           ,B.RCPT_IN_PROC_SQ_PK
           ,B.RCV_HDR_NUM
           ,B.RCV_DTL_NUM
           ,B.RCV_SQ_PK
        FROM
            AR_APPLY_INTFC_WRK A
        INNER JOIN
            AR_RCPT_IN_PROC_WRK  B
            ON  ( A.GLBL_CMPY_CD        =  B.GLBL_CMPY_CD
            AND   A.RCPT_IN_PROC_SQ_PK  =  B.RCPT_IN_PROC_SQ_PK
            AND   A.RCV_HDR_NUM         =  B.RCV_HDR_NUM
            AND   A.RCV_DTL_NUM         =  B.RCV_DTL_NUM
            AND   B.RCV_HDR_NUM         =  #rcvHdrNum#  )
        WHERE
                 A.GLBL_CMPY_CD  =  #glblCmpyCd#
            AND  A.INTFC_ID      =  #intfcId#
            AND  A.PROC_STS_CD   =  #procStsCd1#
            AND  A.APPLY_GRP_KEY =  #applyGrpKey#
            AND  A.EZCANCELFLAG  =  '0'
        GROUP BY
                 A.APPLY_GRP_KEY
                ,B.GLBL_CMPY_CD
                ,B.RCPT_IN_PROC_SQ_PK
                ,B.RCV_HDR_NUM
                ,B.RCV_DTL_NUM
                ,B.RCV_SQ_PK
        ORDER BY
                 A.APPLY_GRP_KEY
                ,B.GLBL_CMPY_CD
                ,B.RCPT_IN_PROC_SQ_PK
                ,B.RCV_HDR_NUM
                ,B.RCV_DTL_NUM
                ,B.RCV_SQ_PK
    </statement>

    <statement id="getReceptHistUpldCsvId" parameterClass="Map">
        SELECT
            A.APPLY_GRP_KEY
           ,B.GLBL_CMPY_CD
           ,B.RCPT_IN_PROC_SQ_PK
           ,B.RCV_HDR_NUM
           ,B.RCV_DTL_NUM
           ,B.RCV_SQ_PK
        FROM
            AR_APPLY_INTFC_WRK A
        INNER JOIN
            AR_RCPT_IN_PROC_WRK  B
            ON  ( A.GLBL_CMPY_CD        =  B.GLBL_CMPY_CD
            AND   A.RCPT_IN_PROC_SQ_PK  =  B.RCPT_IN_PROC_SQ_PK
            AND   A.RCV_HDR_NUM         =  B.RCV_HDR_NUM
            AND   A.RCV_DTL_NUM         =  B.RCV_DTL_NUM
            AND   B.RCV_HDR_NUM         =  #rcvHdrNum#  )
        WHERE
                 A.GLBL_CMPY_CD  =  #glblCmpyCd#
            AND  A.UPLD_CSV_ID   =  #upldCsvId#
            AND  A.PROC_STS_CD   =  #procStsCd1#
            AND  A.APPLY_GRP_KEY =  #applyGrpKey#
            AND  A.EZCANCELFLAG  =  '0'
        GROUP BY
                 A.APPLY_GRP_KEY
                ,B.GLBL_CMPY_CD
                ,B.RCPT_IN_PROC_SQ_PK
                ,B.RCV_HDR_NUM
                ,B.RCV_DTL_NUM
                ,B.RCV_SQ_PK
        ORDER BY
                 A.APPLY_GRP_KEY
                ,B.GLBL_CMPY_CD
                ,B.RCPT_IN_PROC_SQ_PK
                ,B.RCV_HDR_NUM
                ,B.RCV_DTL_NUM
                ,B.RCV_SQ_PK
    </statement>
    <statement id="getApplyIntfcWrk" parameterClass="Map">
     SELECT
               GLBL_CMPY_CD
              ,APPLY_GRP_KEY
              ,APPLY_GRP_SUB_PK
     FROM
               AR_APPLY_INTFC_WRK
     WHERE
                    GLBL_CMPY_CD   =  #glblCmpyCd#
               AND  APPLY_GRP_KEY  =  #applyGrpKey#
               AND  DEAL_SQ_NUM    =  #rcvHdrNum#
               AND (PROC_STS_CD    =  #unProc#
                    OR PROC_STS_CD =  #rcptOnly#)
               AND  EZCANCELFLAG   =  '0'
     ORDER BY
                    GLBL_CMPY_CD
                   ,APPLY_GRP_KEY
                   ,APPLY_GRP_SUB_PK
    </statement>

    <statement id="getApplySqNum" parameterClass="Map">
        SELECT
            B.RCPT_BAT_SQ_NUM
        FROM
            AR_APPLY_INTFC_WRK A
        INNER JOIN
            AR_RCPT_IN_PROC_WRK  B
            ON  ( A.GLBL_CMPY_CD        =  B.GLBL_CMPY_CD
            AND   A.RCPT_IN_PROC_SQ_PK  =  B.RCPT_IN_PROC_SQ_PK
            AND   A.RCV_HDR_NUM         =  B.RCV_HDR_NUM
            AND   A.RCV_DTL_NUM         =  B.RCV_DTL_NUM  )
        WHERE
                 A.GLBL_CMPY_CD  =  #glblCmpyCd#
            AND  A.INTFC_ID      =  #intfcId#
            AND  (A.PROC_STS_CD    =  #procStsCd1#
                  OR A.PROC_STS_CD =  #procStsCd2#)
            AND  A.EZCANCELFLAG  =  '0'
        GROUP BY
                 B.RCPT_BAT_SQ_NUM
    </statement>

    <statement id="getArBatRcptCnt" parameterClass="Map">
        SELECT
            COUNT(A.AR_BAT_RCPT_NM) AR_BAT_RCPT_CNT
        FROM
            AR_BAT_RCPT A
        WHERE
               A.GLBL_CMPY_CD   =  #glblCmpyCd#
          AND  A.AR_BAT_RCPT_NM =  #arbatRcptNm#
    </statement>
</sqlMap>
