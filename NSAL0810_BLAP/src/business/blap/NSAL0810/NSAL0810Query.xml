<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL0810Query">
    <statement id="getSvcLineBizList" parameterClass="Map" resultClass="Map">
        SELECT
             A.LINE_BIZ_TP_CD       LINE_BIZ_TP_CD
            ,A.LINE_BIZ_TP_DESC_TXT LINE_BIZ_TP_DESC_TXT
        FROM
             LINE_BIZ_TP          A
            ,AVAL_LINE_BIZ_TP_SRC B
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            AND A.LINE_BIZ_TP_CD    = B.LINE_BIZ_TP_CD
            AND B.SYS_SRC_CD        = #sysSrcCd#
            AND B.EZCANCELFLAG      = '0'
        ORDER BY
            A.LINE_BIZ_TP_SORT_NUM
    </statement>

<!-- START 2016/05/25 T.Tomita [QC#8898, DEL] -->
<!--
    <statement id="getMtrLbList" parameterClass="Map" resultClass="Map">
        SELECT
            ML.MTR_LB_CD          MTR_LB_CD
           ,ML.MTR_LB_DESC_TXT    MTR_LB_DESC_TXT
        FROM
            MTR_LB   ML
        WHERE
            ML.GLBL_CMPY_CD         = #glblCmpyCd#
            AND ML.MTR_LB_TP_CD     = #billingMeter#
            AND ML.EZCANCELFLAG     = '0'
        ORDER BY
            ML.MTR_LB_SORT_NUM
    </statement>
-->
<!-- END 2016/05/25 T.Tomita [QC#8898, DEL] -->

<!-- START 2016/05/25 T.Tomita [QC#8898, MOD] -->
    <statement id="getDsContrIntfcList" parameterClass="Map" resultClass="Map">
        SELECT
            A.GLBL_CMPY_CD                       GLBL_CMPY_CD
           ,A.DS_CONTR_INTFC_PK                  DS_CONTR_INTFC_PK
           ,A.DS_CONTR_INTFC_BAT_NUM             DS_CONTR_INTFC_BAT_NUM
           ,A.DS_CONTR_SRC_REF_NUM               DS_CONTR_SRC_REF_NUM
           ,A.CONTR_INTFC_SRC_TP_CD              CONTR_INTFC_SRC_TP_CD
           ,A.DS_CONTR_INTFC_ACT_CD              DS_CONTR_INTFC_ACT_CD
           ,A.DS_CONTR_PROC_STS_CD               DS_CONTR_PROC_STS_CD
           ,A.DS_CONTR_INTFC_STS_CD              DS_CONTR_INTFC_STS_CD
           ,A.INTFC_ERR_MSG_TXT                  INTFC_ERR_MSG_TXT
           ,A.DS_CONTR_NUM                       DS_CONTR_NUM
           ,A.SER_NUM                            SER_NUM
           ,A.SVC_MACH_MSTR_PK                   SVC_MACH_MSTR_PK
           ,A.CONTR_INTFC_DTL_TP_CD              CONTR_INTFC_DTL_TP_CD
           ,A.DS_ACCT_NUM                        DS_ACCT_NUM
           ,A.DS_ACCT_NM                         DS_ACCT_NM
           ,A.BILL_TO_CUST_CD                    BILL_TO_CUST_CD
           ,A.BILL_TO_LOC_NUM                    BILL_TO_LOC_NUM
           ,A.LEASE_CMPY_CD                      LEASE_CMPY_CD
           ,A.SVC_CONTR_BR_CD                    SVC_CONTR_BR_CD
           ,A.CONTR_ADMIN_PSN_CD                 CONTR_ADMIN_PSN_CD
           ,A.TOC_CD                             TOC_CD
           ,A.CUST_PO_NUM                        CUST_PO_NUM
           ,A.PO_DT                              PO_DT
           ,A.CR_CARD_CUST_REF_NUM               CR_CARD_CUST_REF_NUM
           ,A.CR_CARD_EXPR_YR_MTH                CR_CARD_EXPR_YR_MTH
           ,A.MTR_EST_TP_CD                      MTR_EST_TP_CD
           ,A.SVC_PGM_MDSE_CD                    SVC_PGM_MDSE_CD
           ,A.MDSE_CD                            MDSE_CD
           ,A.MDL_ID                             MDL_ID
           ,A.MDL_NM                             MDL_NM
           ,A.CONTR_FROM_DT                      CONTR_FROM_DT
           ,A.CONTR_THRU_DT                      CONTR_THRU_DT
           ,A.BLLG_CYCLE_CD                      BLLG_CYCLE_CD
           ,A.PRC_ALLOC_BY_MACH_QTY_FLG          PRC_ALLOC_BY_MACH_QTY_FLG
           ,A.CONTR_AUTO_RNW_TP_CD               CONTR_AUTO_RNW_TP_CD
           ,A.RNW_PRC_METH_CD                    RNW_PRC_METH_CD
           ,A.BEF_END_RNW_DAYS_AOT               BEF_END_RNW_DAYS_AOT
           ,A.RNW_PRC_UP_RATIO                   RNW_PRC_UP_RATIO
           ,A.CONTR_UPLFT_TP_CD                  CONTR_UPLFT_TP_CD
           ,A.UPLFT_PRC_METH_CD                  UPLFT_PRC_METH_CD
           ,A.UPLFT_PRC_UP_RATIO                 UPLFT_PRC_UP_RATIO
           ,A.MTR_READ_METH_CD                   MTR_READ_METH_CD
           ,A.BASE_PRC_DEAL_AMT                  BASE_PRC_DEAL_AMT
           ,A.CONTR_CLO_DAY                      CONTR_CLO_DAY
           ,A.CONTR_BLLG_DAY                     CONTR_BLLG_DAY
           ,A.BLLG_THRU_DT                       BLLG_THRU_DT
           ,A.BLLG_MTR_LB_CD                     BLLG_MTR_LB_CD
           ,A.MTR_LB_DESC_TXT                    MTR_LB_DESC_TXT
           ,A.START_MTR_CNT                      START_MTR_CNT
           ,A.BLLG_ROLL_OVER_RATIO               BLLG_ROLL_OVER_RATIO
           ,A.DS_CONTR_CATG_CD                   DS_CONTR_CATG_CD
           ,A.DS_CONTR_STS_CD                    DS_CONTR_STS_CD
           ,A.XS_CHRG_TP_CD                      XS_CHRG_TP_CD
           ,A.XS_MTR_COPY_QTY                    XS_MTR_COPY_QTY
           ,A.XS_MTR_AMT_RATE                    XS_MTR_AMT_RATE
           ,A.ADDL_CHRG_TP_CD                    ADDL_CHRG_TP_CD
           ,A.ADDL_CHRG_FLAT_DEAL_PRC_AMT        ADDL_CHRG_FLAT_DEAL_PRC_AMT
           ,A.ADDL_CHRG_APLC_PCT                 ADDL_CHRG_APLC_PCT
           ,A.CHRG_LVL_TP_CD                     CHRG_LVL_TP_CD
           ,A.ADDL_CHRG_INV_TP_CD                ADDL_CHRG_INV_TP_CD
           ,A.PRINT_DTL_FLG                      PRINT_DTL_FLG
           ,A.BASE_PRC_TERM_DEAL_AMT_RATE        BASE_PRC_TERM_DEAL_AMT_RATE
           ,A.DS_CONTR_CLS_CD                    DS_CONTR_CLS_CD
           ,A.CTAC_PSN_PK                        CTAC_PSN_PK
           ,A.CTAC_PSN_NM                        CTAC_PSN_NM
           ,A.INV_SEPT_BASE_USG_FLG              INV_SEPT_BASE_USG_FLG
           <!-- START 2018/02/22 M.Naito [QC#23179,MOD] -->
           <!-- ,DECODE(A.CONTR_CLO_DT, NULL, NULL, TO_CHAR(TO_DATE(A.CONTR_CLO_DT,'YYYYMMDD') + 1, 'YYYYMMDD')) CONTR_CLO_DT -->
           ,A.CONTR_CLO_DT                       CONTR_CLO_DT
           <!-- START 2018/02/22 M.Naito [QC#23179,MOD] -->
           ,A.CONTR_DURN_AOT                     CONTR_DURN_AOT
           ,A.PMT_TERM_CASH_DISC_CD              PMT_TERM_CASH_DISC_CD
           ,A.SVC_LINE_BIZ_CD                    SVC_LINE_BIZ_CD
           ,A.BLLG_TMG_TP_CD                     BLLG_TMG_TP_CD
           ,A.DS_CONTR_EDI_CD                    DS_CONTR_EDI_CD
           ,A.DS_CONTR_INTFC_DT                  DS_CONTR_INTFC_DT
           ,A.DS_CONTR_DESC_TXT                  DS_CONTR_DESC_TXT
           ,A.BASE_CHRG_TO_LEASE_CMPY_FLG        BASE_CHRG_TO_LEASE_CMPY_FLG
           ,A.USG_CHRG_TO_LEASE_CMPY_FLG         USG_CHRG_TO_LEASE_CMPY_FLG
           ,A.INTG_MDSE_CD                       INTG_MDSE_CD
           ,NULL                                 CPO_SVC_DTL_PK
           ,A.CAP_BW_ORIG_QTY                    CAP_BW_ORIG_QTY
           ,A.CAP_COLOR_ORIG_QTY                 CAP_COLOR_ORIG_QTY
           ,A.CAP_TOT_ORIG_QTY                   CAP_TOT_ORIG_QTY
           ,A.CAP_BW_RUN_QTY                     CAP_BW_RUN_QTY
           ,A.CAP_COLOR_RUN_QTY                  CAP_COLOR_RUN_QTY
           ,A.CAP_TOT_RUN_QTY                    CAP_TOT_RUN_QTY
           ,A.DS_CONTR_INTFC_BAT_SQ              DS_CONTR_INTFC_BAT_SQ
           ,A.PRC_SVC_PLN_TP_CD                  PRC_SVC_PLN_TP_CD
           ,A.MAN_CONTR_OVRD_FLG                 MAN_CONTR_OVRD_FLG
           ,A.EZUPTIME                           EZUPTIME
           ,A.EZUPTIMEZONE                       EZUPTIMEZONE
           ,ROWNUM                               XX_ROW_NUM
            <!-- START 2016/11/28 K.Kojima [QC#14204, ADD] -->
           ,A.XX_REC_HIST_CRAT_TS_A
           ,A.XX_REC_HIST_CRAT_BY_NM_A
           ,A.XX_REC_HIST_UPD_TS_A
           ,A.XX_REC_HIST_UPD_BY_NM_A
           ,A.XX_REC_HIST_TBL_NM_A
           <!-- END 2016/11/28 K.Kojima [QC#14204, ADD] -->
           <!-- START 2022/03/22 [QC#59683, ADD] -->
           ,A.DS_INV_TGTR_TP_CD
           ,A.DS_INV_TGTR_TP_DESC_TXT
           <!-- END   2022/03/22 [QC#59683, ADD] -->
        FROM(
            SELECT
                DCI.GLBL_CMPY_CD                       GLBL_CMPY_CD
               ,DCI.DS_CONTR_INTFC_PK                  DS_CONTR_INTFC_PK
               ,DCI.DS_CONTR_INTFC_BAT_NUM             DS_CONTR_INTFC_BAT_NUM
               ,DCI.DS_CONTR_SRC_REF_NUM               DS_CONTR_SRC_REF_NUM
               ,DCI.CONTR_INTFC_SRC_TP_CD              CONTR_INTFC_SRC_TP_CD
               ,DCI.DS_CONTR_INTFC_ACT_CD              DS_CONTR_INTFC_ACT_CD
               ,DCI.DS_CONTR_PROC_STS_CD               DS_CONTR_PROC_STS_CD
               ,DCI.DS_CONTR_INTFC_STS_CD              DS_CONTR_INTFC_STS_CD
               ,DCI.INTFC_ERR_MSG_TXT                  INTFC_ERR_MSG_TXT
               ,DCI.DS_CONTR_NUM                       DS_CONTR_NUM
               ,DCI.SER_NUM                            SER_NUM
               ,DCI.SVC_MACH_MSTR_PK                   SVC_MACH_MSTR_PK
               ,DCI.CONTR_INTFC_DTL_TP_CD              CONTR_INTFC_DTL_TP_CD
               ,DCI.DS_ACCT_NUM                        DS_ACCT_NUM
               ,STC.DS_ACCT_NM                         DS_ACCT_NM
               ,DCI.BILL_TO_CUST_CD                    BILL_TO_CUST_CD
               ,DCI.BILL_TO_LOC_NUM                    BILL_TO_LOC_NUM
               ,DCI.LEASE_CMPY_CD                      LEASE_CMPY_CD
               ,DCI.SVC_CONTR_BR_CD                    SVC_CONTR_BR_CD
               ,DCI.CONTR_ADMIN_PSN_CD                 CONTR_ADMIN_PSN_CD
               ,DCI.TOC_CD                             TOC_CD
               ,DCI.CUST_PO_NUM                        CUST_PO_NUM
               ,DCI.PO_DT                              PO_DT
               ,DCI.CR_CARD_CUST_REF_NUM               CR_CARD_CUST_REF_NUM
               ,DCI.CR_CARD_EXPR_YR_MTH                CR_CARD_EXPR_YR_MTH
               ,DCI.MTR_EST_TP_CD                      MTR_EST_TP_CD
               ,DCI.SVC_PGM_MDSE_CD                    SVC_PGM_MDSE_CD
               ,DCI.MDSE_CD                            MDSE_CD
               ,DCI.MDL_ID                             MDL_ID
               ,DCI.MDL_NM                             MDL_NM
               ,DCI.CONTR_FROM_DT                      CONTR_FROM_DT
               ,DCI.CONTR_THRU_DT                      CONTR_THRU_DT
               ,DCI.BLLG_CYCLE_CD                      BLLG_CYCLE_CD
               ,DCI.PRC_ALLOC_BY_MACH_QTY_FLG          PRC_ALLOC_BY_MACH_QTY_FLG
               ,DCI.CONTR_AUTO_RNW_TP_CD               CONTR_AUTO_RNW_TP_CD
               ,DCI.RNW_PRC_METH_CD                    RNW_PRC_METH_CD
               ,DCI.BEF_END_RNW_DAYS_AOT               BEF_END_RNW_DAYS_AOT
               ,DCI.RNW_PRC_UP_RATIO                   RNW_PRC_UP_RATIO
               ,DCI.CONTR_UPLFT_TP_CD                  CONTR_UPLFT_TP_CD
               ,DCI.UPLFT_PRC_METH_CD                  UPLFT_PRC_METH_CD
               ,DCI.UPLFT_PRC_UP_RATIO                 UPLFT_PRC_UP_RATIO
               ,DCI.MTR_READ_METH_CD                   MTR_READ_METH_CD
               ,DCI.BASE_PRC_DEAL_AMT                  BASE_PRC_DEAL_AMT
               ,DCI.CONTR_CLO_DAY                      CONTR_CLO_DAY
               ,DCI.CONTR_BLLG_DAY                     CONTR_BLLG_DAY
               ,DCI.BLLG_THRU_DT                       BLLG_THRU_DT
               ,DCI.BLLG_MTR_LB_CD                     BLLG_MTR_LB_CD
               ,MLB.MTR_LB_DESC_TXT                    MTR_LB_DESC_TXT
               ,DCI.START_MTR_CNT                      START_MTR_CNT
               ,DCI.BLLG_ROLL_OVER_RATIO               BLLG_ROLL_OVER_RATIO
               ,DCI.DS_CONTR_CATG_CD                   DS_CONTR_CATG_CD
               ,DCI.DS_CONTR_STS_CD                    DS_CONTR_STS_CD
               ,DCI.XS_CHRG_TP_CD                      XS_CHRG_TP_CD
               ,DCI.XS_MTR_COPY_QTY                    XS_MTR_COPY_QTY
               ,DCI.XS_MTR_AMT_RATE                    XS_MTR_AMT_RATE
               ,DCI.ADDL_CHRG_TP_CD                    ADDL_CHRG_TP_CD
               ,DCI.ADDL_CHRG_FLAT_DEAL_PRC_AMT        ADDL_CHRG_FLAT_DEAL_PRC_AMT
               ,DCI.ADDL_CHRG_APLC_PCT                 ADDL_CHRG_APLC_PCT
               ,DCI.CHRG_LVL_TP_CD                     CHRG_LVL_TP_CD
               ,DCI.ADDL_CHRG_INV_TP_CD                ADDL_CHRG_INV_TP_CD
               ,DCI.PRINT_DTL_FLG                      PRINT_DTL_FLG
               ,DCI.BASE_PRC_TERM_DEAL_AMT_RATE        BASE_PRC_TERM_DEAL_AMT_RATE
               ,DCI.DS_CONTR_CLS_CD                    DS_CONTR_CLS_CD
               ,DCI.CTAC_PSN_PK                        CTAC_PSN_PK
               ,DCI.CTAC_PSN_NM                        CTAC_PSN_NM
               ,DCI.INV_SEPT_BASE_USG_FLG              INV_SEPT_BASE_USG_FLG
               ,DCI.CONTR_CLO_DT                       CONTR_CLO_DT
               ,DCI.CONTR_DURN_AOT                     CONTR_DURN_AOT
               ,DCI.PMT_TERM_CASH_DISC_CD              PMT_TERM_CASH_DISC_CD
               ,DCI.SVC_LINE_BIZ_CD                    SVC_LINE_BIZ_CD
               ,DCI.BLLG_TMG_TP_CD                     BLLG_TMG_TP_CD
               ,DCI.DS_CONTR_EDI_CD                    DS_CONTR_EDI_CD
               ,DCI.DS_CONTR_INTFC_DT                  DS_CONTR_INTFC_DT
               ,DCI.DS_CONTR_DESC_TXT                  DS_CONTR_DESC_TXT
               ,DCI.BASE_CHRG_TO_LEASE_CMPY_FLG        BASE_CHRG_TO_LEASE_CMPY_FLG
               ,DCI.USG_CHRG_TO_LEASE_CMPY_FLG         USG_CHRG_TO_LEASE_CMPY_FLG
               ,DCI.INTG_MDSE_CD                       INTG_MDSE_CD
               ,NULL                                   CPO_SVC_DTL_PK
               ,DCI.CAP_BW_ORIG_QTY                    CAP_BW_ORIG_QTY
               ,DCI.CAP_COLOR_ORIG_QTY                 CAP_COLOR_ORIG_QTY
               ,DCI.CAP_TOT_ORIG_QTY                   CAP_TOT_ORIG_QTY
               ,DCI.CAP_BW_RUN_QTY                     CAP_BW_RUN_QTY
               ,DCI.CAP_COLOR_RUN_QTY                  CAP_COLOR_RUN_QTY
               ,DCI.CAP_TOT_RUN_QTY                    CAP_TOT_RUN_QTY
               ,DCI.DS_CONTR_INTFC_BAT_SQ              DS_CONTR_INTFC_BAT_SQ
               ,DCI.PRC_SVC_PLN_TP_CD                  PRC_SVC_PLN_TP_CD
               ,DCI.MAN_CONTR_OVRD_FLG                 MAN_CONTR_OVRD_FLG
               ,DCI.EZUPTIME                           EZUPTIME
               ,DCI.EZUPTIMEZONE                       EZUPTIMEZONE
               <!-- START 2016/11/28 K.Kojima [QC#14204, ADD] -->
               ,DCI.EZINTIME                        AS XX_REC_HIST_CRAT_TS_A
               ,DCI.EZINUSERID                      AS XX_REC_HIST_CRAT_BY_NM_A
               ,DCI.EZUPTIME                        AS XX_REC_HIST_UPD_TS_A
               ,DCI.EZUPUSERID                      AS XX_REC_HIST_UPD_BY_NM_A
               ,DCI.EZTABLEID                       AS XX_REC_HIST_TBL_NM_A
               <!-- END 2016/11/28 K.Kojima [QC#14204, ADD] -->
               <!-- START 2022/03/22 [QC#59683, ADD] -->
               ,DITT.DS_INV_TGTR_TP_CD              AS DS_INV_TGTR_TP_CD
               ,DITT.DS_INV_TGTR_TP_DESC_TXT        AS DS_INV_TGTR_TP_DESC_TXT
               <!-- END   2022/03/22 [QC#59683, ADD] -->
            FROM
                DS_CONTR_INTFC      DCI
               ,CONTR_INTFC_SRC_TP  CIST
               ,DS_CONTR_INTFC_ACT  DCIA
               ,CONTR_INTFC_DTL_TP  CIDT
               ,DS_CONTR_PROC_STS   DCPS
               ,SELL_TO_CUST        STC
               ,MTR_EST_TP          MET
               ,BLLG_CYCLE          BC
               ,CONTR_AUTO_RNW_TP   CART
               ,RNW_PRC_METH        RPM
               ,CONTR_UPLFT_TP      CUT
               ,UPLFT_PRC_METH      UPM
               ,MTR_READ_METH       MRM
               ,DS_CONTR_CATG       DCC
               ,DS_CONTR_STS        DCS
               ,XS_CHRG_TP          XCT
               ,ADDL_CHRG_TP        ACT
               ,CHRG_LVL_TP         CLT
               ,ADDL_CHRG_INV_TP    ACIT
               ,DS_CONTR_CLS        DCCL
               ,LINE_BIZ_TP         LBT
               ,BLLG_TMG_TP         BTT
               ,SVC_MACH_MSTR       MAC
               ,MTR_LB              MLB
               <!-- START 2022/03/22 [QC#59683, ADD] -->
               ,DS_INV_TGTR_TP      DITT
               <!-- END   2022/03/22 [QC#59683, ADD] -->
            WHERE
                <!-- DS_CONTR_INTFC -->
                DCI.GLBL_CMPY_CD                     = #glblCmpyCd#
                <isNotNull property="dsContrIntfcBatNum">
                AND DCI.DS_CONTR_INTFC_BAT_NUM       = #dsContrIntfcBatNum#
                </isNotNull>
                <isNotNull property="dsContrIntfcDtFrom">
                AND DCI.DS_CONTR_INTFC_DT          &gt;= #dsContrIntfcDtFrom#
                </isNotNull>
                <isNotNull property="dsContrIntfcDtThru">
                AND DCI.DS_CONTR_INTFC_DT          &lt;= #dsContrIntfcDtThru#
                </isNotNull>
                <isNotNull property="dsContrSrcRefNum">
                AND DCI.DS_CONTR_SRC_REF_NUM         = #dsContrSrcRefNum#
                </isNotNull>
                <isNotNull property="contrIntfcSrcTpCd">
                AND DCI.CONTR_INTFC_SRC_TP_CD        = #contrIntfcSrcTpCd#
                </isNotNull>
                <!-- CONTR_INTFC_SRC_TP -->
                AND CIST.GLBL_CMPY_CD(+)             = #glblCmpyCd#
                AND DCI.CONTR_INTFC_SRC_TP_CD        = CIST.CONTR_INTFC_SRC_TP_CD(+)
                <!-- DS_CONTR_INTFC_ACT -->
                AND DCIA.GLBL_CMPY_CD(+)             = #glblCmpyCd#
                AND DCI.DS_CONTR_INTFC_ACT_CD        = DCIA.DS_CONTR_INTFC_ACT_CD(+)
                <!-- CONTR_INTFC_DTL_TP -->
                AND CIDT.GLBL_CMPY_CD(+)             = #glblCmpyCd#
                AND DCI.CONTR_INTFC_DTL_TP_CD        = CIDT.CONTR_INTFC_DTL_TP_CD(+)
                <!-- DS_CONTR_PROC_STS -->
                AND DCPS.GLBL_CMPY_CD(+)             = #glblCmpyCd#
                AND DCI.DS_CONTR_PROC_STS_CD         = DCPS.DS_CONTR_PROC_STS_CD(+)
                <isNotNull property="errorFlg">
                <!-- START 2017/11/06 M.Kidokoro [QC#18612, MOD] -->
                <!-- AND DCI.DS_CONTR_PROC_STS_CD         IN(#error#, #reprocess#) -->
                AND (
                       DCI.DS_CONTR_PROC_STS_CD         IN(#error#, #reprocess#)
                    OR DCI.DS_CONTR_INTFC_STS_CD        = #contrIntfcStsError#
                )
                <!-- END 2017/11/06 M.Kidokoro [QC#18612, MOD] -->
                </isNotNull>
                <!-- SELL_TO_CUST -->
                AND STC.GLBL_CMPY_CD(+)              = #glblCmpyCd#
                AND DCI.DS_ACCT_NUM                  = STC.SELL_TO_CUST_CD(+)
                <!-- MTR_EST_TP -->
                AND MET.GLBL_CMPY_CD(+)              = #glblCmpyCd#
                AND DCI.MTR_EST_TP_CD                = MET.MTR_EST_TP_CD(+)
                <!-- BLLG_CYCLE -->
                AND BC.GLBL_CMPY_CD(+)               = #glblCmpyCd#
                AND DCI.BLLG_CYCLE_CD                = BC.BLLG_CYCLE_CD(+)
                <!-- CONTR_AUTO_RNW_TP -->
                AND CART.GLBL_CMPY_CD(+)             = #glblCmpyCd#
                AND DCI.CONTR_AUTO_RNW_TP_CD         = CART.CONTR_AUTO_RNW_TP_CD(+)
                <!-- RNW_PRC_METH -->
                AND RPM.GLBL_CMPY_CD(+)              = #glblCmpyCd#
                AND DCI.RNW_PRC_METH_CD              = RPM.RNW_PRC_METH_CD(+)
                <!-- CONTR_UPLFT_TP -->
                AND CUT.GLBL_CMPY_CD(+)              = #glblCmpyCd#
                AND DCI.CONTR_UPLFT_TP_CD            = CUT.CONTR_UPLFT_TP_CD(+)
                <!-- UPLFT_PRC_METH -->
                AND UPM.GLBL_CMPY_CD(+)              = #glblCmpyCd#
                AND DCI.UPLFT_PRC_METH_CD            = UPM.UPLFT_PRC_METH_CD(+)
                <!-- MTR_READ_METH -->
                AND MRM.GLBL_CMPY_CD(+)              = #glblCmpyCd#
                AND DCI.MTR_READ_METH_CD             = MRM.MTR_READ_METH_CD(+)
                <!-- DS_CONTR_CATG -->
                AND DCC.GLBL_CMPY_CD(+)              = #glblCmpyCd#
                AND DCI.DS_CONTR_CATG_CD             = DCC.DS_CONTR_CATG_CD(+)
                <!-- DS_CONTR_STS -->
                AND DCS.GLBL_CMPY_CD(+)              = #glblCmpyCd#
                AND DCI.DS_CONTR_STS_CD              = DCS.DS_CONTR_STS_CD(+)
                <!-- XS_CHRG_TP -->
                AND XCT.GLBL_CMPY_CD(+)              = #glblCmpyCd#
                AND DCI.XS_CHRG_TP_CD                = XCT.XS_CHRG_TP_CD(+)
                <!-- ADDL_CHRG_TP -->
                AND ACT.GLBL_CMPY_CD(+)              = #glblCmpyCd#
                AND DCI.ADDL_CHRG_TP_CD              = ACT.ADDL_CHRG_TP_CD(+)
                <!-- CHRG_LVL_TP -->
                AND CLT.GLBL_CMPY_CD(+)              = #glblCmpyCd#
                AND DCI.CHRG_LVL_TP_CD               = CLT.CHRG_LVL_TP_CD(+)
                <!-- ADDL_CHRG_INV_TP -->
                AND ACIT.GLBL_CMPY_CD(+)             = #glblCmpyCd#
                AND DCI.ADDL_CHRG_INV_TP_CD          = ACIT.ADDL_CHRG_INV_TP_CD(+)
                <!-- DS_CONTR_CLS -->
                AND DCCL.GLBL_CMPY_CD(+)             = #glblCmpyCd#
                AND DCI.DS_CONTR_CLS_CD              = DCCL.DS_CONTR_CLS_CD(+)
                <!-- LINE_BIZ_TP -->
                AND LBT.GLBL_CMPY_CD(+)              = #glblCmpyCd#
                AND DCI.SVC_LINE_BIZ_CD              = LBT.LINE_BIZ_TP_CD(+)
                <!-- BLLG_TMG_TP -->
                AND BTT.GLBL_CMPY_CD(+)              = #glblCmpyCd#
                AND DCI.BLLG_TMG_TP_CD               = BTT.BLLG_TMG_TP_CD(+)
                <!-- SVC_MACH_MSTR -->
                AND MAC.GLBL_CMPY_CD(+)              = #glblCmpyCd#
                AND DCI.SVC_MACH_MSTR_PK             = MAC.SVC_MACH_MSTR_PK(+)
                <!-- MTR_LB -->
                AND MLB.GLBL_CMPY_CD(+)              = #glblCmpyCd#
                AND DCI.BLLG_MTR_LB_CD               = MLB.MTR_LB_CD(+)
                <!-- START 2022/03/22 [QC#59683, ADD] -->
                <!-- DS_INV_TGTR_TP -->
                AND DITT.GLBL_CMPY_CD(+)             = #glblCmpyCd#
                AND DCI.DS_INV_TGTR_TP_CD            = DITT.DS_INV_TGTR_TP_CD(+)
                <!-- END   2022/03/22 [QC#59683, ADD] -->
                <!-- EZCANCELFLAG -->
                AND DCI.EZCANCELFLAG                 = '0'
                AND CIST.EZCANCELFLAG(+)             = '0'
                AND DCIA.EZCANCELFLAG(+)             = '0'
                AND CIDT.EZCANCELFLAG(+)             = '0'
                AND DCPS.EZCANCELFLAG(+)             = '0'
                AND STC.EZCANCELFLAG(+)              = '0'
                AND MET.EZCANCELFLAG(+)              = '0'
                AND BC.EZCANCELFLAG(+)               = '0'
                AND CART.EZCANCELFLAG(+)             = '0'
                AND RPM.EZCANCELFLAG(+)              = '0'
                AND CUT.EZCANCELFLAG(+)              = '0'
                AND UPM.EZCANCELFLAG(+)              = '0'
                AND MRM.EZCANCELFLAG(+)              = '0'
                AND DCC.EZCANCELFLAG(+)              = '0'
                AND DCS.EZCANCELFLAG(+)              = '0'
                AND XCT.EZCANCELFLAG(+)              = '0'
                AND ACT.EZCANCELFLAG(+)              = '0'
                AND CLT.EZCANCELFLAG(+)              = '0'
                AND ACIT.EZCANCELFLAG(+)             = '0'
                AND DCCL.EZCANCELFLAG(+)             = '0'
                AND LBT.EZCANCELFLAG(+)              = '0'
                AND BTT.EZCANCELFLAG(+)              = '0'
                AND MAC.EZCANCELFLAG(+)              = '0'
                AND MLB.EZCANCELFLAG(+)              = '0'
                <!-- START 2022/03/22 [QC#59683, ADD] -->
                AND DITT.EZCANCELFLAG(+)             = '0'
                <!-- END   2022/03/22 [QC#59683, ADD] -->
                ORDER BY
                    DCI.DS_CONTR_SRC_REF_NUM
                   ,DCI.CONTR_INTFC_SRC_TP_CD
                   ,MAC.SVC_CONFIG_MSTR_PK NULLS FIRST
                   ,MAC.SVC_MACH_TP_CD
                   ,DCI.SVC_MACH_MSTR_PK
                   ,DCI.CONTR_INTFC_DTL_TP_CD
                   ,DCI.BLLG_MTR_LB_CD
            ) A
        WHERE
            ROWNUM &lt;= #limitNum#
    </statement>
<!-- END 2016/05/25 T.Tomita [QC#8898, MOD] -->

    <statement id="getDsContrIntfcDefRule" parameterClass="Map" resultClass="Map">
        SELECT
            DCIDR.GLBL_CMPY_CD               GLBL_CMPY_CD
           ,DCIDR.CONTR_INTFC_SRC_TP_CD      CONTR_INTFC_SRC_TP_CD
           ,DCIDR.EFF_FROM_DT                EFF_FROM_DT
           ,DCIDR.ENBL_FLG                   ENBL_FLG
           ,MET.MTR_EST_TP_CD                MTR_EST_TP_CD
           ,BCB.BLLG_CYCLE_CD                BASE_BLLG_CYCLE_CD
           ,BCU.BLLG_CYCLE_CD                MTR_BLLG_CYCLE_CD
           ,DCIDR.INV_SEPT_BASE_USG_FLG      INV_SEPT_BASE_USG_FLG
           ,DCIDR.PRC_ALLOC_BY_MACH_QTY_FLG  PRC_ALLOC_BY_MACH_QTY_FLG
           ,CUT.CONTR_UPLFT_TP_CD            CONTR_UPLFT_TP_CD
           ,UPM.UPLFT_PRC_METH_CD            UPLFT_PRC_METH_CD
           ,DCIDR.UPLFT_BASE_PRC_UP_RATIO    UPLFT_BASE_PRC_UP_RATIO
           ,DCIDR.UPLFT_MTR_PRC_UP_RATIO     UPLFT_MTR_PRC_UP_RATIO
           ,DCIDR.BLLG_THRU_TP_CD            BLLG_THRU_TP_CD
           ,DCIDR.BLLG_THRU_DT               BLLG_THRU_DT
           ,DCIDR.STUB_PREP_FROM_TP_CD       STUB_PREP_FROM_TP_CD
           ,DCIDR.STUB_PREP_THRU_TP_CD       STUB_PREP_THRU_TP_CD
           ,DCIDR.AUTO_EFF_FLEET_FLG         AUTO_EFF_FLEET_FLG
           ,DCIDR.AUTO_EFF_AGGR_FLG          AUTO_EFF_AGGR_FLG
           ,BTC.BILL_TO_CUST_CD              LEASE_CMPY_CD
           ,MRM.MTR_READ_METH_CD             MTR_READ_METH_CD
           ,DCIDR.DS_CONTR_SLS_CR_TP_CD      DS_CONTR_SLS_CR_TP_CD
           ,CART.CONTR_AUTO_RNW_TP_CD        CONTR_AUTO_RNW_TP_CD
           ,RPM.RNW_PRC_METH_CD              RNW_PRC_METH_CD
           ,DCIDR.BEF_END_RNW_DAYS_AOT       BEF_END_RNW_DAYS_AOT
           ,DCIDR.BASE_PRC_UP_RATIO          BASE_PRC_UP_RATIO
           ,DCIDR.MTR_PRC_UP_RATIO           MTR_PRC_UP_RATIO
           ,DCIDR.START_READ_VLD_TP_CD       START_READ_VLD_TP_CD
           ,DCIDR.MTR_READ_WIN_DAYS_AOT      MTR_READ_WIN_DAYS_AOT
           ,DCIDR.ALLW_DATA_CRCT_FLG         ALLW_DATA_CRCT_FLG
           ,DCIDR.DS_CONTR_CLS_CD            DS_CONTR_CLS_CD
           ,DCIDR.CONTR_CLO_DAY              CONTR_CLO_DAY
           ,DCIDR.CONTR_BLLG_DAY             CONTR_BLLG_DAY
           ,DCIDR.BLLG_ROLL_OVER_RATIO       BLLG_ROLL_OVER_RATIO
           ,DCIDR.PRINT_DTL_FLG              PRINT_DTL_FLG
        FROM
            DS_CONTR_INTFC_DEF_RULE   DCIDR
           ,BILL_TO_CUST              BTC
           ,MTR_READ_METH             MRM
           ,CONTR_AUTO_RNW_TP         CART
           ,RNW_PRC_METH              RPM
           ,MTR_EST_TP                MET
           ,BLLG_CYCLE                BCB
           ,BLLG_CYCLE                BCU
           ,CONTR_UPLFT_TP            CUT
           ,UPLFT_PRC_METH            UPM
        WHERE
            <!-- DS_CONTR_INTFC_DEF_RULE -->
            DCIDR.GLBL_CMPY_CD                         = #glblCmpyCd#
            AND DCIDR.CONTR_INTFC_SRC_TP_CD            = #contrIntfcSrcTp#
<!-- add start 2017/09/15 QC#19775 -->
            AND DCIDR.DS_CONTR_CLS_CD                  = #dsContrClsCd#
            AND DCIDR.SVC_LINE_BIZ_CD                  = #svcLineBizCd#
<!-- add end 2017/09/15 QC#19775 -->
            <!-- BILL_TO_CUST -->
            AND BTC.GLBL_CMPY_CD(+)                    = #glblCmpyCd#
            AND DCIDR.LEASE_CMPY_CD                    = BTC.BILL_TO_CUST_CD(+)
            <!-- MTR_READ_METH -->
            AND MRM.GLBL_CMPY_CD(+)                    = #glblCmpyCd#
            AND DCIDR.MTR_READ_METH_CD                 = MRM.MTR_READ_METH_CD(+)
            <!-- CONTR_AUTO_RNW_TP -->
            AND CART.GLBL_CMPY_CD(+)                   = #glblCmpyCd#
            AND DCIDR.CONTR_AUTO_RNW_TP_CD             = CART.CONTR_AUTO_RNW_TP_CD(+)
            <!-- RNW_PRC_METH -->
            AND RPM.GLBL_CMPY_CD(+)                    = #glblCmpyCd#
            AND DCIDR.RNW_PRC_METH_CD                  = RPM.RNW_PRC_METH_CD(+)
            <!-- MTR_EST_TP -->
            AND MET.GLBL_CMPY_CD(+)                    = #glblCmpyCd#
            AND DCIDR.MTR_EST_TP_CD                    = MET.MTR_EST_TP_CD(+)
            <!-- BLLG_CYCLE Base -->
            AND BCB.GLBL_CMPY_CD(+)                    = #glblCmpyCd#
            AND DCIDR.BASE_BLLG_CYCLE_CD               = BCB.BLLG_CYCLE_CD(+)
            <!-- BLLG_CYCLE Usage -->
            AND BCU.GLBL_CMPY_CD(+)                    = #glblCmpyCd#
            AND DCIDR.MTR_BLLG_CYCLE_CD                = BCU.BLLG_CYCLE_CD(+)
            <!-- CONTR_UPLFT_TP -->
            AND CUT.GLBL_CMPY_CD(+)                    = #glblCmpyCd#
            AND DCIDR.CONTR_UPLFT_TP_CD                = CUT.CONTR_UPLFT_TP_CD(+)
            <!-- UPLFT_PRC_METH -->
            AND UPM.GLBL_CMPY_CD(+)                    = #glblCmpyCd#
            AND DCIDR.UPLFT_PRC_METH_CD                = UPM.UPLFT_PRC_METH_CD(+)
            <!-- EZCANCELFLAG -->
            AND DCIDR.EZCANCELFLAG                     = '0'
            AND BTC.EZCANCELFLAG(+)                    = '0'
            AND MRM.EZCANCELFLAG(+)                    = '0'
            AND CART.EZCANCELFLAG(+)                   = '0'
            AND RPM.EZCANCELFLAG(+)                    = '0'
            AND MET.EZCANCELFLAG(+)                    = '0'
            AND BCB.EZCANCELFLAG(+)                    = '0'
            AND BCU.EZCANCELFLAG(+)                    = '0'
            AND CUT.EZCANCELFLAG(+)                    = '0'
            AND UPM.EZCANCELFLAG(+)                    = '0'
    </statement>

    <statement id="getStartMtrCnt" parameterClass="Map" resultClass="Map">
        SELECT
            SRM.START_MTR_CNT         START_MTR_CNT
        FROM
            DS_CONTR_INTFC   DCI
           ,SVC_PHYS_MTR     SPM
           ,START_READ_MAP   SRM
        WHERE
            <!-- DS_CONTR_INTFC -->
            DCI.GLBL_CMPY_CD              = #glblCmpyCd#
            AND DCI.DS_CONTR_INTFC_PK     = #dsContrIntfcPk#
<!-- del start 2017/09/15 QC#19775 -->
<!--
            AND DCI.START_MTR_CNT         IS NOT NULL
-->
<!-- del end 2017/09/15 QC#19775 -->
            <!-- SVC_PHYS_MTR -->
            AND SPM.GLBL_CMPY_CD          = #glblCmpyCd#
            AND DCI.SVC_MACH_MSTR_PK      = SPM.SVC_MACH_MSTR_PK
<!-- add start 2017/09/15 QC#19775 -->
            AND DCI.BLLG_MTR_LB_CD        = SPM.BLLG_MTR_LB_CD
<!-- add end 2017/09/15 QC#19775 -->
            AND SPM.ACTV_FLG              = 'Y'
            <!-- START_READ_MAP -->
            AND SRM.GLBL_CMPY_CD          = #glblCmpyCd#
            AND SPM.MDL_MTR_LB_CD         = SRM.MTR_LB_CD
<!-- add start 2017/09/15 QC#19775 -->
            AND SPM.MTR_GRP_PK            = SRM.MTR_GRP_PK
<!-- add end 2017/09/15 QC#19775 -->
            <!-- EZCANCELFLAG -->
            AND DCI.EZCANCELFLAG          = '0'
            AND SPM.EZCANCELFLAG          = '0'
            AND SRM.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getSameDsContrDtlList" parameterClass="Map" resultClass="Map">
        SELECT
            DCD.CONTR_EFF_FROM_DT         CONTR_EFF_FROM_DT
           ,DCD.CONTR_EFF_THRU_DT         CONTR_EFF_THRU_DT
            
        FROM
            DS_CONTR_INTFC   DCI
           ,DS_CONTR         DC
           ,DS_CONTR_DTL     DCD
        WHERE
            <!-- DS_CONTR_INTFC -->
            DCI.GLBL_CMPY_CD              = #glblCmpyCd#
            AND DCI.DS_CONTR_INTFC_PK     = #dsContrIntfcPk#
            <!-- DS_CONTR -->
            AND DC.GLBL_CMPY_CD           = #glblCmpyCd#
            AND DCI.DS_CONTR_NUM          = DC.DS_CONTR_NUM
            <!-- DS_CONTR_DTL -->
            AND DCD.GLBL_CMPY_CD          = #glblCmpyCd#
            AND DC.DS_CONTR_PK            = DCD.DS_CONTR_PK
            AND DCD.DS_CONTR_DTL_STS_CD   = #active#
            <!-- EZCANCELFLAG -->
            AND DCI.EZCANCELFLAG          = '0'
            AND DC.EZCANCELFLAG           = '0'
            AND DCD.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getMaxDsContrIntfcBatNum" parameterClass="Map" resultClass="Map">
        SELECT
            MAX(DCI.DS_CONTR_INTFC_BAT_NUM)  AS DS_CONTR_INTFC_BAT_NUM
        FROM
            DS_CONTR_INTFC   DCI
        WHERE
            <!-- DS_CONTR_INTFC -->
            DCI.GLBL_CMPY_CD                = #glblCmpyCd#
            AND DCI.DS_CONTR_INTFC_DT       = #salesDate#
            AND DCI.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getMaxPlusOneSequence" parameterClass="Map" resultClass="Integer">
        SELECT
            NVL(MAX(DCI.DS_CONTR_INTFC_BAT_SQ),0)  AS DS_CONTR_INTFC_BAT_SQ
        FROM
            DS_CONTR_INTFC   DCI
        WHERE
            <!-- DS_CONTR_INTFC -->
            DCI.GLBL_CMPY_CD                = #glblCmpyCd#
            AND DCI.DS_CONTR_INTFC_DT       = #salesDate#
            AND DCI.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getDsActlCntrIntfc" parameterClass="Map" resultClass="Map">
        SELECT
            DACI.GLBL_CMPY_CD
           ,DACI.DS_ACTL_CNT_INTFC_PK
           ,DACI.DS_CONTR_INTFC_BAT_NUM
           ,DACI.DS_CONTR_SRC_REF_NUM
           ,DACI.CONTR_INTFC_SRC_TP_CD
           ,DACI.ACTL_CNT_INTFC_STS_CD
           ,DACI.INTFC_ERR_MSG_TXT
           ,DACI.SER_NUM
           ,DACI.SVC_MACH_MSTR_PK
           ,DACI.MDSE_CD
           ,DACI.PHYS_MTR_LB_CD
           ,DACI.PHYS_MTR_LB_NM
           ,DACI.BLLBL_FLG
           ,DACI.CONTR_MTR_MULT_RATE
           ,DACI.BLLG_MTR_LB_CD
           ,DACI.BLLG_MTR_LB_NM
           ,DACI.INTG_MDSE_CD
           ,NULL AS CPO_SVC_DTL_PK
        FROM
            DS_CONTR_INTFC        DCI
           ,DS_ACTL_CNT_INTFC     DACI
        WHERE
            <!-- DS_CONTR_INTFC -->
            DCI.GLBL_CMPY_CD                = #glblCmpyCd#
            AND DCI.DS_CONTR_INTFC_PK       = #dsContrIntfcPk#
            <!-- DS_ACTL_CNT_INTFC -->
            AND DACI.GLBL_CMPY_CD           = #glblCmpyCd#
            AND DCI.DS_CONTR_INTFC_BAT_NUM  = DACI.DS_CONTR_INTFC_BAT_NUM
            AND DCI.CONTR_INTFC_SRC_TP_CD   = DACI.CONTR_INTFC_SRC_TP_CD
            AND DCI.DS_CONTR_SRC_REF_NUM    = DACI.DS_CONTR_SRC_REF_NUM
       <!-- AND NVL(DCI.CPO_SVC_DTL_PK, 0)  = NVL(DACI.CPO_SVC_DTL_PK, 0) -->
            AND NVL(DCI.SVC_MACH_MSTR_PK, 0)= NVL(DACI.SVC_MACH_MSTR_PK, 0)
            AND DCI.BLLG_MTR_LB_CD          = DACI.BLLG_MTR_LB_CD
            <!-- EZCANCELFLAG -->
            AND DCI.EZCANCELFLAG            = '0'
            AND DACI.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getDsXsCopyIntfc" parameterClass="Map" resultClass="Map">
        SELECT
            DXCI.GLBL_CMPY_CD
           ,DXCI.DS_XS_COPY_INTFC_PK
           ,DXCI.DS_CONTR_INTFC_BAT_NUM
           ,DXCI.DS_CONTR_SRC_REF_NUM
           ,DXCI.CONTR_INTFC_SRC_TP_CD
           ,DXCI.XS_COPY_INTFC_STS_CD
           ,DXCI.INTFC_ERR_MSG_TXT
           ,DXCI.SER_NUM
           ,DXCI.SVC_MACH_MSTR_PK
           ,DXCI.MDSE_CD
           ,DXCI.BLLG_MTR_LB_CD
           ,DXCI.BLLG_MTR_LB_NM
           ,DXCI.XS_MTR_COPY_QTY
           ,DXCI.XS_MTR_AMT_RATE
           ,DXCI.XS_MTR_LVL_NUM
           ,NULL AS CPO_SVC_DTL_PK
        FROM
            DS_CONTR_INTFC        DCI
           ,DS_XS_COPY_INTFC      DXCI
        WHERE
            <!-- DS_CONTR_INTFC -->
            DCI.GLBL_CMPY_CD                = #glblCmpyCd#
            AND DCI.DS_CONTR_INTFC_PK       = #dsContrIntfcPk#
            <!-- DS_XS_COPY_INTFC -->
            AND DXCI.GLBL_CMPY_CD           = #glblCmpyCd#
            AND DCI.DS_CONTR_INTFC_BAT_NUM  = DXCI.DS_CONTR_INTFC_BAT_NUM
            AND DCI.CONTR_INTFC_SRC_TP_CD   = DXCI.CONTR_INTFC_SRC_TP_CD
            AND DCI.DS_CONTR_SRC_REF_NUM    = DXCI.DS_CONTR_SRC_REF_NUM
       <!-- AND NVL(DCI.CPO_SVC_DTL_PK, 0)  = NVL(DXCI.CPO_SVC_DTL_PK, 0) -->
            AND NVL(DCI.SVC_MACH_MSTR_PK, 0)= NVL(DXCI.SVC_MACH_MSTR_PK, 0)
            AND DCI.BLLG_MTR_LB_CD          = DXCI.BLLG_MTR_LB_CD
            <!-- EZCANCELFLAG -->
            AND DCI.EZCANCELFLAG            = '0'
            AND DXCI.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getDsAddlChrgIntfc" parameterClass="Map" resultClass="Map">
        SELECT
            DACI.GLBL_CMPY_CD
           ,DACI.DS_ADDL_CHRG_INTFC_PK
           ,DACI.DS_CONTR_INTFC_BAT_NUM
           ,DACI.DS_CONTR_SRC_REF_NUM
           ,DACI.CONTR_INTFC_SRC_TP_CD
           ,DACI.ADD_CHRG_INTFC_STS_CD
           ,DACI.INTFC_ERR_MSG_TXT
           ,DACI.SER_NUM
           ,DACI.SVC_MACH_MSTR_PK
           ,DACI.MDSE_CD
           ,DACI.CHRG_LVL_TP_CD
           ,DACI.ADDL_CHRG_TP_CD
           ,DACI.EFF_FROM_DT
           ,DACI.EFF_THRU_DT
           ,DACI.BLLG_CYCLE_CD
           ,DACI.ADDL_CHRG_FLAT_DEAL_PRC_AMT
           ,DACI.ADDL_CHRG_APLC_PCT
           ,DACI.ADDL_CHRG_INV_TP_CD
           ,DACI.PRINT_DTL_FLG
           ,NULL AS CPO_SVC_DTL_PK
        FROM
            DS_CONTR_INTFC        DCI
           ,DS_ADDL_CHRG_INTFC    DACI
        WHERE
            <!-- DS_CONTR_INTFC -->
            DCI.GLBL_CMPY_CD                = #glblCmpyCd#
            AND DCI.DS_CONTR_INTFC_PK       = #dsContrIntfcPk#
            <!-- DS_ADDL_CHRG_INTFC -->
            AND DACI.GLBL_CMPY_CD           = #glblCmpyCd#
            AND DCI.DS_CONTR_INTFC_BAT_NUM  = DACI.DS_CONTR_INTFC_BAT_NUM
            AND DCI.CONTR_INTFC_SRC_TP_CD   = DACI.CONTR_INTFC_SRC_TP_CD
            AND DCI.DS_CONTR_SRC_REF_NUM    = DACI.DS_CONTR_SRC_REF_NUM
       <!-- AND NVL(DCI.CPO_SVC_DTL_PK, 0)  = NVL(DACI.CPO_SVC_DTL_PK, 0) -->
            AND NVL(DCI.SVC_MACH_MSTR_PK, 0)= NVL(DACI.SVC_MACH_MSTR_PK, 0)
            <!-- EZCANCELFLAG -->
            AND DCI.EZCANCELFLAG            = '0'
            AND DACI.EZCANCELFLAG           = '0'
    </statement>


    <statement id="getPrcAllocIntfc" parameterClass="Map" resultClass="Map">
        SELECT
            PAI.GLBL_CMPY_CD
           ,PAI.PRC_ALLOC_INTFC_PK
           ,PAI.DS_CONTR_INTFC_BAT_NUM
           ,PAI.DS_CONTR_SRC_REF_NUM
           ,PAI.CONTR_INTFC_SRC_TP_CD
           ,PAI.ALLOC_INTFC_STS_CD
           ,PAI.INTFC_ERR_MSG_TXT
           ,PAI.PRC_ALLOC_INTFC_TP_CD
           ,PAI.SER_NUM
           ,PAI.SVC_MACH_MSTR_PK
           ,PAI.MDSE_CD
           ,PAI.TOC_CD
           ,PAI.TOC_NM
           ,PAI.PRC_ALLOC_RATE
           ,NULL AS CPO_SVC_DTL_PK
        FROM
            DS_CONTR_INTFC        DCI
           ,PRC_ALLOC_INTFC       PAI
        WHERE
            <!-- DS_CONTR_INTFC -->
            DCI.GLBL_CMPY_CD                = #glblCmpyCd#
            AND DCI.DS_CONTR_INTFC_PK       = #dsContrIntfcPk#
            <!-- PRC_ALLOC_INTFC -->
            AND PAI.GLBL_CMPY_CD            = #glblCmpyCd#
            AND DCI.DS_CONTR_INTFC_BAT_NUM  = PAI.DS_CONTR_INTFC_BAT_NUM
            AND DCI.CONTR_INTFC_SRC_TP_CD   = PAI.CONTR_INTFC_SRC_TP_CD
            AND DCI.DS_CONTR_SRC_REF_NUM    = PAI.DS_CONTR_SRC_REF_NUM
       <!-- AND NVL(DCI.CPO_SVC_DTL_PK, 0)  = NVL(PAI.CPO_SVC_DTL_PK, 0) -->
            AND NVL(DCI.SVC_MACH_MSTR_PK, 0)= NVL(PAI.SVC_MACH_MSTR_PK, 0)
            <!-- EZCANCELFLAG -->
            AND DCI.EZCANCELFLAG            = '0'
            AND PAI.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getDsContrIntfcForUpload" parameterClass="Map" resultClass="Map">
        SELECT
            DCI.DS_CONTR_INTFC_PK             DS_CONTR_INTFC_PK
           ,DCI.DS_CONTR_INTFC_STS_CD         DS_CONTR_INTFC_STS_CD
           ,DCPS.DS_CONTR_PROC_STS_CD         DS_CONTR_PROC_STS_CD
        FROM
            DS_CONTR_INTFC        DCI
           ,DS_CONTR_PROC_STS     DCPS
        WHERE
            <!-- DS_CONTR_INTFC -->
            DCI.GLBL_CMPY_CD               = #glblCmpyCd#
            AND DCI.CONTR_INTFC_SRC_TP_CD  = #contrIntfcSrcTpCd#
            AND DCI.DS_CONTR_SRC_REF_NUM   = #dsContrSrcRefNum#
            AND DCI.DS_CONTR_INTFC_BAT_NUM = #dsContrIntfcBatNum#
            AND DCI.SER_NUM                = #serNum#
            AND DCI.MDSE_CD                = #mdseCd#
            AND DCI.CONTR_INTFC_DTL_TP_CD  = #contrIntfcDtlTpCd#
            AND DCI.BLLG_MTR_LB_CD         = #bllgMtrLbCd#
            <!-- DS_CONTR_PROC_STS -->
            AND DCPS.GLBL_CMPY_CD         = #glblCmpyCd#
            AND DCI.DS_CONTR_PROC_STS_CD  = DCPS.DS_CONTR_PROC_STS_CD
            <!-- EZCANCELFLAG -->
            AND DCI.EZCANCELFLAG          = '0'
            AND DCPS.EZCANCELFLAG         = '0'
    </statement>

    <statement id="getCtacPsnPk" parameterClass="Map" resultClass="Map">
        SELECT
            CPN.CTAC_PSN_PK             CTAC_PSN_PK
        FROM
            (SELECT 
                 CTAC_PSN_PK                                  CTAC_PSN_PK
                ,CTAC_PSN_FIRST_NM || ' ' || CTAC_PSN_LAST_NM FULL_NAME
             FROM
                 CTAC_PSN        CP
             WHERE
                 CP.GLBL_CMPY_CD                = #glblCmpyCd#
                 AND CP.EZCANCELFLAG            = '0'
                 ) CPN
        WHERE
            CPN.FULL_NAME                = #fullName#
    </statement>

    <statement id="getCpoOrdTpCd" parameterClass="Map" resultClass="Map">
        SELECT
            CV.DS_ORD_CATG_CD  DS_ORD_CATG_CD
        FROM
            DS_CONTR_INTFC     DCI
           ,CPO_V              CV
        WHERE
            <!-- DS_CONTR_INTFC -->
                DCI.GLBL_CMPY_CD          = #glblCmpyCd#
            AND DCI.DS_CONTR_INTFC_PK     = #dsContrIntfcPk#
            AND DCI.CONTR_INTFC_SRC_TP_CD = #contrIntfcSrcTpCd#
            <!-- CPO_V -->
            AND DCI.GLBL_CMPY_CD          = CV.GLBL_CMPY_CD
            AND DCI.DS_CONTR_SRC_REF_NUM  = CV.CPO_ORD_NUM
            <!-- EZCANCELFLAG -->
            AND DCI.EZCANCELFLAG          = '0'
            AND CV.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getStatusUpdateTarget" parameterClass="Map" resultClass="Map">
        SELECT
            DCI.GLBL_CMPY_CD
           ,DCI.DS_CONTR_INTFC_PK
        FROM
            DS_CONTR_INTFC        DCI
        WHERE
            DCI.GLBL_CMPY_CD                = #glblCmpyCd#
            AND DCI.EZCANCELFLAG            = '0'
            AND DCI.DS_CONTR_PROC_STS_CD    IN(#inProcess#, #reProcess#)
            AND (EXISTS(SELECT 1 FROM DS_CONTR_INTFC DCI2
                        WHERE
                        DCI2.GLBL_CMPY_CD                = DCI.GLBL_CMPY_CD
                        AND DCI2.DS_CONTR_INTFC_BAT_NUM  = DCI.DS_CONTR_INTFC_BAT_NUM
                        AND DCI2.CONTR_INTFC_SRC_TP_CD   = DCI.CONTR_INTFC_SRC_TP_CD
                        AND DCI2.DS_CONTR_SRC_REF_NUM    = DCI.DS_CONTR_SRC_REF_NUM
                  <!-- AND NVL(DCI2.CPO_SVC_DTL_PK, 0)  = NVL(DCI.CPO_SVC_DTL_PK, 0) -->
                        <iterate property="dsCntIntfcPkList" var="dsCntIntfcPkList[]" open="                AND DCI.DS_CONTR_INTFC_PK IN (" close=")" conjunction=",">
                            #dsCntIntfcPkList[]#
                        </iterate>
                        AND DCI2.DS_CONTR_INTFC_STS_CD   = #intfcStsError#
                        AND DCI2.EZCANCELFLAG            = '0')
            OR EXISTS(SELECT 1 FROM DS_CONTR_INTFC DCI2,DS_ACTL_CNT_INTFC DACI
                        WHERE
                        DCI2.GLBL_CMPY_CD                = DCI.GLBL_CMPY_CD
                        AND DCI2.DS_CONTR_INTFC_BAT_NUM  = DCI.DS_CONTR_INTFC_BAT_NUM
                        AND DCI2.CONTR_INTFC_SRC_TP_CD   = DCI.CONTR_INTFC_SRC_TP_CD
                        AND DCI2.DS_CONTR_SRC_REF_NUM    = DCI.DS_CONTR_SRC_REF_NUM
                  <!--  AND NVL(DCI2.CPO_SVC_DTL_PK, 0)  = NVL(DCI.CPO_SVC_DTL_PK, 0) -->
                        <iterate property="dsCntIntfcPkList" var="dsCntIntfcPkList[]" open="                AND DCI.DS_CONTR_INTFC_PK IN (" close=")" conjunction=",">
                            #dsCntIntfcPkList[]#
                        </iterate>
                        AND DCI2.EZCANCELFLAG            = '0'
                        AND DCI2.GLBL_CMPY_CD            = DACI.GLBL_CMPY_CD
                        AND DCI2.DS_CONTR_INTFC_BAT_NUM  = DACI.DS_CONTR_INTFC_BAT_NUM
                        AND DCI2.CONTR_INTFC_SRC_TP_CD   = DACI.CONTR_INTFC_SRC_TP_CD
                        AND DCI2.DS_CONTR_SRC_REF_NUM    = DACI.DS_CONTR_SRC_REF_NUM
                  <!--  AND NVL(DCI2.CPO_SVC_DTL_PK, 0)  = NVL(DACI.CPO_SVC_DTL_PK, 0) -->
                        AND DACI.ACTL_CNT_INTFC_STS_CD   = #intfcStsError#
                        AND DACI.EZCANCELFLAG            = '0')
            OR EXISTS(SELECT 1 FROM DS_CONTR_INTFC DCI2,DS_XS_COPY_INTFC DXCI
                        WHERE
                        DCI2.GLBL_CMPY_CD                = DCI.GLBL_CMPY_CD
                        AND DCI2.DS_CONTR_INTFC_BAT_NUM  = DCI.DS_CONTR_INTFC_BAT_NUM
                        AND DCI2.CONTR_INTFC_SRC_TP_CD   = DCI.CONTR_INTFC_SRC_TP_CD
                        AND DCI2.DS_CONTR_SRC_REF_NUM    = DCI.DS_CONTR_SRC_REF_NUM
                  <!--  AND NVL(DCI2.CPO_SVC_DTL_PK, 0)  = NVL(DCI.CPO_SVC_DTL_PK, 0) -->
                        <iterate property="dsCntIntfcPkList" var="dsCntIntfcPkList[]" open="                AND DCI.DS_CONTR_INTFC_PK IN (" close=")" conjunction=",">
                            #dsCntIntfcPkList[]#
                        </iterate>
                        AND DCI2.EZCANCELFLAG            = '0'
                        AND DCI2.GLBL_CMPY_CD            = DXCI.GLBL_CMPY_CD
                        AND DCI2.DS_CONTR_INTFC_BAT_NUM  = DXCI.DS_CONTR_INTFC_BAT_NUM
                        AND DCI2.CONTR_INTFC_SRC_TP_CD   = DXCI.CONTR_INTFC_SRC_TP_CD
                        AND DCI2.DS_CONTR_SRC_REF_NUM    = DXCI.DS_CONTR_SRC_REF_NUM
                  <!--  AND NVL(DCI2.CPO_SVC_DTL_PK, 0)  = NVL(DXCI.CPO_SVC_DTL_PK, 0) -->
                        AND DXCI.XS_COPY_INTFC_STS_CD    = #intfcStsError#
                        AND DXCI.EZCANCELFLAG            = '0')
            OR EXISTS(SELECT 1 FROM DS_CONTR_INTFC DCI2,DS_ADDL_CHRG_INTFC DACI
                        WHERE
                        DCI2.GLBL_CMPY_CD                = DCI.GLBL_CMPY_CD
                        AND DCI2.DS_CONTR_INTFC_BAT_NUM  = DCI.DS_CONTR_INTFC_BAT_NUM
                        AND DCI2.CONTR_INTFC_SRC_TP_CD   = DCI.CONTR_INTFC_SRC_TP_CD
                        AND DCI2.DS_CONTR_SRC_REF_NUM    = DCI.DS_CONTR_SRC_REF_NUM
                  <!--  AND NVL(DCI2.CPO_SVC_DTL_PK, 0)  = NVL(DCI.CPO_SVC_DTL_PK, 0) -->
                        <iterate property="dsCntIntfcPkList" var="dsCntIntfcPkList[]" open="                AND DCI.DS_CONTR_INTFC_PK IN (" close=")" conjunction=",">
                            #dsCntIntfcPkList[]#
                        </iterate>
                        AND DCI2.EZCANCELFLAG            = '0'
                        AND DCI2.GLBL_CMPY_CD            = DACI.GLBL_CMPY_CD
                        AND DCI2.DS_CONTR_INTFC_BAT_NUM  = DACI.DS_CONTR_INTFC_BAT_NUM
                        AND DCI2.CONTR_INTFC_SRC_TP_CD   = DACI.CONTR_INTFC_SRC_TP_CD
                        AND DCI2.DS_CONTR_SRC_REF_NUM    = DACI.DS_CONTR_SRC_REF_NUM
                  <!--  AND NVL(DCI2.CPO_SVC_DTL_PK, 0)  = NVL(DACI.CPO_SVC_DTL_PK, 0) -->
                        AND DACI.ADD_CHRG_INTFC_STS_CD   = #intfcStsError#
                        AND DACI.EZCANCELFLAG            = '0')
            OR EXISTS(SELECT 1 FROM DS_CONTR_INTFC DCI2,PRC_ALLOC_INTFC PAI
                        WHERE
                        DCI2.GLBL_CMPY_CD                = DCI.GLBL_CMPY_CD
                        AND DCI2.DS_CONTR_INTFC_BAT_NUM  = DCI.DS_CONTR_INTFC_BAT_NUM
                        AND DCI2.CONTR_INTFC_SRC_TP_CD   = DCI.CONTR_INTFC_SRC_TP_CD
                        AND DCI2.DS_CONTR_SRC_REF_NUM    = DCI.DS_CONTR_SRC_REF_NUM
                  <!--  AND NVL(DCI2.CPO_SVC_DTL_PK, 0)  = NVL(DCI.CPO_SVC_DTL_PK, 0) -->
                        <iterate property="dsCntIntfcPkList" var="dsCntIntfcPkList[]" open="                AND DCI.DS_CONTR_INTFC_PK IN (" close=")" conjunction=",">
                            #dsCntIntfcPkList[]#
                        </iterate>
                        AND DCI2.EZCANCELFLAG            = '0'
                        AND DCI2.GLBL_CMPY_CD            = PAI.GLBL_CMPY_CD
                        AND DCI2.DS_CONTR_INTFC_BAT_NUM  = PAI.DS_CONTR_INTFC_BAT_NUM
                        AND DCI2.CONTR_INTFC_SRC_TP_CD   = PAI.CONTR_INTFC_SRC_TP_CD
                        AND DCI2.DS_CONTR_SRC_REF_NUM    = PAI.DS_CONTR_SRC_REF_NUM
                  <!--  AND NVL(DCI2.CPO_SVC_DTL_PK, 0)  = NVL(PAI.CPO_SVC_DTL_PK, 0) -->
                        AND PAI.ALLOC_INTFC_STS_CD       = #intfcStsError#
                        AND PAI.EZCANCELFLAG             = '0')
            )
        ORDER BY DCI.DS_CONTR_INTFC_PK
    </statement>
    <statement id="getAddlChrgTpV" parameterClass="Map" resultClass="Map">
        SELECT
             ADDL_CHRG_TP_CD
            ,ADDL_CHRG_TP_DESC_TXT
        FROM
            ADDL_CHRG_TP_V
        A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
        ORDER BY
             ADDL_CHRG_TP_DESC_TXT
    </statement>
</sqlMap>
