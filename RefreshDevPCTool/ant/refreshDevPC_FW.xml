<?xml version="1.0" encoding="UTF-8" ?>

<!--
	created by Kazuhiro Tajima.
-->
<project default="refresh.byEAR">

	<property file="refreshDevPC_FW.properties" />

	
	<!--
	**************************************************
	refresh.developmentPC
	**************************************************
	-->
	<target	name="refresh.byEAR">
		<!-- stop IJServer -->
		<antcall target="stopwu"/>

		<!-- call sub targets. -->
 		<antcall target="unjars" />
		<antcall target="move.files.to.work" />
 		<antcall target="move.fw.files.to.Interstage" />
 		<antcall target="move.files.to.Interstage" />
 		<!-- clean temporary directories. -->
  		<delete dir="${WORK.DIR}"/>

		<!-- start IJServer -->
		<antcall target="startwu"/>
	</target>

	<!--
	**************************************************
	stop IJerver
	**************************************************
	-->
	<target name="stopwu">
		<exec executable="isstopwu">
			<arg value="-c" />
			<arg value="${IJSERVER.NAME}" />
		</exec>
	</target>

	
	<!--
	**************************************************
	unjars
	**************************************************
	-->
	<target name="unjars">
		<!-- .ear -->
		<unjar src="${EAR.DIR}/${EAR}" dest="${WORK.DIR.EAR}" />
		<!-- .war -->
		<unwar dest="${WORK.DIR.WAR}">
		    <fileset dir="${WORK.DIR.EAR}">
		        <include name="*.war"/>
		    </fileset>
		</unwar>
	</target>


	<!--
	**************************************************
	move.files.to.work
	**************************************************
	-->
	<target name="move.files.to.work">
		<!-- S21Application.jar -->
		<move file="${WORK.DIR.EAR}/${JAR.S21_APPLICATION}" todir="${IS.SHARED.LIB}"/>
		<!-- ezdMsg.jar -->
		<move file="${WORK.DIR.EAR}/${JAR.EZD_MSG}" todir="${IS.SHARED.LIB}"/>
		<!-- S21CodeTableConstants.jar -->
		<move file="${WORK.DIR.EAR}/${JAR.EZD_CD}" todir="${IS.SHARED.LIB}"/>
	</target>
	
	
	<!--
	**************************************************
	move.fw.files.to.Interstage
	**************************************************
	-->
	<target name="move.fw.files.to.Interstage">
		<copy todir="${IS.SHARED.LIB}" overwrite="true">
			<filelist dir="${WORK.DIR.EAR}" files="${FW.FILES.JAR}"/>
		</copy>
		<copy todir="${IS.SHARED.CLASSES}" overwrite="true">
			<filelist dir="${WORK.DIR.EAR}" files="${FW.FILES.PROPERTIES}"/>
		</copy>
	</target>


	<!--
	**************************************************
	move.files.to.Interstage
	**************************************************
	-->
	<target name="move.files.to.Interstage">
		<!-- Add for i18n -->
		<copy file="${EAR.DIR}/${I18N_PROPERTIES_WO_ZIP}.zip" tofile="${IS.SHARED.LIB}/${I18N_PROPERTIES_WO_ZIP}.jar" overwrite="true"/>

		<!-- dvlppc : clean & move files. -->
		<delete>
			<fileset dir="${IS.DVLPPC}">
				<patternset id="dvlppc.exclude" >
					<exclude name="**/META-INF/"/>
					<exclude name="**/web.xml"/>
				</patternset>
			</fileset>
		</delete>
		<move todir="${IS.DVLPPC}">
			<fileset dir="${WORK.DIR.WAR}">
				<patternset refid="dvlppc.exclude"/>
			</fileset>
		</move>
	</target>

	<!--
	**************************************************
	start IJerver
	**************************************************
	-->
	<target name="startwu">
		<exec executable="isstartwu">
			<arg value="${IJSERVER.NAME}" />
		</exec>
	</target>

</project>
