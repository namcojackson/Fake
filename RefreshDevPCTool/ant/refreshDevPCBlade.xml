<?xml version="1.0" encoding="UTF-8" ?>

<!--
	created by Kazuhiro Tajima.
-->
<project default="refresh.byEAR">

	<property file="refreshDevPCBlade.properties" />

	
	<!--
	**************************************************
	refresh.developmentPC
	**************************************************
	-->
	<target	name="refresh.byEAR">
		<!-- call sub targets. -->
 		<antcall target="unjars" />
		<antcall target="move.files.to.work" />
 		<antcall target="move.files.to.Interstage" />
		<!-- clean temporary directories. -->
  		<delete dir="${WORK.DIR}"/>
		<delete dir="${IS.WU}/work"/>
	</target>

	
	<!--
	**************************************************
	unjars
	**************************************************
	-->
	<target name="unjars">
		<!-- .ear -->
		<unjar src="${EAR.DIR}/${EAR}" dest="${WORK.DIR.EAR}" />
		<!-- properties.zip -->
		<unjar src="${EAR.DIR}/${PROPERTIES}" dest="${WORK.DIR.EAR}"/>
		<!-- .war -->
		<unwar dest="${WORK.DIR.WAR}">
		    <fileset dir="${WORK.DIR.EAR}">
		        <include name="*.war"/>
		    </fileset>
		</unwar>

		<!-- S21Application.jar -->
		<unjar src="${WORK.DIR.EAR}/${JAR.S21_APPLICATION}" dest="${WORK.DIR.S21_APPLICATION}"/>
		<!-- ezdMsg.jar -->
		<unjar src="${WORK.DIR.EAR}/${JAR.EZD_MSG}" dest="${WORK.DIR.S21_APPLICATION}"/>
		<!-- 07/19/2012 N.Nakazawa - START -->
		<!-- S21CodeTableConstants.jar -->
		<unjar src="${WORK.DIR.EAR}/${JAR.EZD_CD}" dest="${WORK.DIR.S21_APPLICATION}"/>
		<!-- 07/19/2012 N.Nakazawa - END -->
	</target>


	<!--
	**************************************************
	move.files.to.work
	**************************************************
	-->
	<target name="move.files.to.work">
		<!-- Shared/lib -->
		<move todir="${WORK.DIR.SHARED.LIB}">
			<fileset dir="${WORK.DIR.EAR}">
				<include name="*.jar"/>
				<exclude name="${JAR.S21_APPLICATION}"/>
				<exclude name="${JAR.EZD_MSG}"/>
				<exclude name="META-INF/"/>
			</fileset>
		</move>
		<copy todir="${WORK.DIR.SHARED.LIB}" overwrite="true">
			<fileset dir="${ECLIPSE_WS.DVLPPC}/99ezf/parts/java/EXTJARS">
				<include name="*.jar"/>
			</fileset>
			<fileset dir="${ECLIPSE_WS.DVLPPC}/99ezf/parts/java/S21SecurityTestEnv">
				<include name="*.jar"/>
			</fileset>
		</copy>
		
		<!-- Shared/classes -->
		<move todir="${WORK.DIR.SHARED.CLASSES}">
			<fileset dir="${WORK.DIR.EAR}">
				<include name="*.xml"/>
				<include name="*.properties"/>
				<exclude name="META-INF/"/>
			</fileset>
			<fileset dir="${WORK.DIR.S21_APPLICATION}">
				<include name="*.xml"/>
				<include name="business/"/>	
				<include name="com/"/>
				<include name="parts/"/>
				<exclude name="META-INF/"/>
			</fileset>
			<fileset dir="${WORK.DIR.S21_APPLICATION}/dispatch">
				<include name="/*.xml"/>
			</fileset>
		</move>
		
<!-- 07/06/2010 K.Tajima - START -->			
		<copy todir="${WORK.DIR.SHARED.CLASSES}" overwrite="true">
			<fileset dir="${EAR.DIR}/_properties/">
				<include name="*.properties"/>
				<include name="*.xml"/>
			</fileset>
		</copy>
<!-- 07/06/2010 K.Tajima - E N D -->
	</target>
	
	
	<!--
	**************************************************
	move.files.to.Interstage
	**************************************************
	-->
	<target name="move.files.to.Interstage">
		<!-- Shared : clean & move files. -->
		<delete>
			<fileset dir="${IS.SHARED}">
				<patternset id="shared.exclude" >
					<!-- 04/09/2012 N.Nakazawa - START -->
					<!--
					<exclude name="**/EZDDBInfo.properties"/>
 					<exclude name="**/EZDSystem.properties"/>
 					-->
					<exclude name="**/*.properties"/>
 					<exclude name="**/*.jar"/>
					<!-- 04/09/2012 N.Nakazawa - END -->
				</patternset>
			</fileset>
		</delete>
		<move todir="${IS.SHARED}">
			<fileset dir="${WORK.DIR.SHARED}">
				<patternset refid="shared.exclude"/>
			</fileset>
		</move>

		<!-- Add for i18n -->
		<copy file="${EAR.DIR}/${I18N_PROPERTIES_WO_ZIP}.zip" tofile="${IS.SHARED.LIB}/${I18N_PROPERTIES_WO_ZIP}.jar" overwrite="true"/>

		<!-- dvlppc : clean & move files. -->
		<delete>
			<fileset dir="${IS.DVLPPC}">
				<patternset id="dvlppc.exclude" >
					<exclude name="**/META-INF/"/>
					<exclude name="**/web.xml"/>
				</patternset>
			</fileset>
		</delete>
		<move todir="${IS.DVLPPC}">
			<fileset dir="${WORK.DIR.WAR}">
				<patternset refid="dvlppc.exclude"/>
			</fileset>
		</move>
	</target>

</project>
