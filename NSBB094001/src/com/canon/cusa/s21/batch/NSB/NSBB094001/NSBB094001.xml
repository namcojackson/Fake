<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSBB094001">
    <statement id="getDsBizLastProcTs" parameterClass="Map" resultClass="Map">
        SELECT
              DS_BIZ_LAST_PROC_TS
             ,DS_BIZ_PROC_LOG_PK
        FROM
             DS_BIZ_PROC_LOG
        WHERE
             GLBL_CMPY_CD                             =   #glblCmpyCd#
             AND PROC_PGM_ID                          =   #procPgmId#
             AND EZCANCELFLAG                         =   '0'
        ORDER BY
            DS_BIZ_LAST_PROC_TS DESC
    </statement>
    <statement id="getWarehouseInfo" parameterClass="Map" resultClass="Map">
        SELECT
             CASE 
             WHEN
             A.EFF_FROM_DT &lt;= #salesDate# AND NVL(A.EFF_THRU_DT, #salesDate#) &gt;= #salesDate#
             THEN 'Y'
             WHEN A.EZCANCELFLAG = '1' or B.EZCANCELFLAG = '1'
             THEN 'N'
             ELSE 'N'
             END AS ACTV_FLG
             ,A.TECH_TOC_CD
             ,B.RTL_WH_CD
<!-- START 2021/11/17 R.Cabral [QC#59387, ADD] -->
             ,B.RTL_SWH_CD
<!-- END   2021/11/17 R.Cabral [QC#59387, ADD] -->
             ,C.RTL_WH_NM
<!-- START 2023/06/19 K.Chiba [QC#61262, ADD] -->
             ,'01' AS WH_OWNR_PSN_TP_CD 
<!-- END 2023/06/19 K.Chiba [QC#61262, ADD] -->
        FROM
            TECH_LOC A
            ,RTL_SWH B
            ,RTL_WH  C
        WHERE
            A.GLBL_CMPY_CD = #glblCmpyCd#
            AND A.GLBL_CMPY_CD = B.GLBL_CMPY_CD
            AND A.TECH_LOC_CD  = B.INVTY_LOC_CD
            AND B.GLBL_CMPY_CD = C.GLBL_CMPY_CD
            AND B.RTL_WH_CD    = C.RTL_WH_CD
<!-- START 2017/09/06 U.Kim [QC#20868, ADD] -->
            AND B.RTL_SWH_CD   = #rtlSwhCd#
<!-- END 2017/09/06 U.Kim [QC#20868, ADD] -->
            <isNotNull property="dsBizLastProcTs">
            AND (A.EZINTIME &gt; #dsBizLastProcTs#
                OR A.EZUPTIME &gt; #dsBizLastProcTs#
            )
           </isNotNull>
<!-- START 2023/06/19 K.Chiba [QC#61262, ADD] -->
        UNION
               SELECT
                 CASE 
                 WHEN
                 A.EFF_FROM_DT &lt;= #salesDate# AND NVL(A.EFF_THRU_DT, #salesDate#) &gt;= #salesDate#
                 THEN 'Y'
                 WHEN A.EZCANCELFLAG = '1' or B.EZCANCELFLAG = '1'
                 THEN 'N'
                 ELSE 'N'
                 END AS ACTV_FLG
                 ,C.ALT_PSN_CD AS TECH_TOC_CD
                 ,B.RTL_WH_CD
                 ,B.RTL_SWH_CD
                 ,C.RTL_WH_NM
                 ,'02' AS WH_OWNR_PSN_TP_CD
            FROM
                TECH_LOC A
                ,RTL_SWH B
                ,RTL_WH  C
            WHERE
                A.GLBL_CMPY_CD = #glblCmpyCd#
                AND A.GLBL_CMPY_CD = B.GLBL_CMPY_CD
                AND A.TECH_LOC_CD  = B.INVTY_LOC_CD
                AND B.GLBL_CMPY_CD = C.GLBL_CMPY_CD
                AND B.RTL_WH_CD    = C.RTL_WH_CD
                AND B.RTL_SWH_CD   = #rtlSwhCd#
                AND (A.EZINTIME &gt; #dsBizLastProcTs#
                    OR A.EZUPTIME &gt; #dsBizLastProcTs#
                )
<!-- END 2023/06/19 K.Chiba [QC#61262, ADD] -->
        ORDER BY
<!-- START 2023/06/19 K.Chiba [QC#61262, MOD] -->
<!-- A.TECH_TOC_CD -->
              TECH_TOC_CD
<!-- END 2023/06/19 K.Chiba [QC#61262, MOD] -->
    </statement>
<!-- START 2021/11/17 R.Cabral [QC#59387, ADD] -->
    <statement id="getClickTechWhWrkBackup" parameterClass="Map" resultClass="Map">
        SELECT
            A.TECH_TOC_CD
            ,B.RTL_WH_CD
            ,B.RTL_SWH_CD
<!-- START 2023/06/19 K.Chiba [QC#61262, ADD] -->
            ,'01' AS WH_OWNR_PSN_TP_CD 
<!-- END 2023/06/19 K.Chiba [QC#61262, ADD] -->
        FROM
            TECH_LOC A
            ,RTL_SWH B
        WHERE
            A.GLBL_CMPY_CD                            = #glblCmpyCd#
            AND A.GLBL_CMPY_CD                        = B.GLBL_CMPY_CD
            AND A.TECH_LOC_CD                         = B.INVTY_LOC_CD
            AND B.RTL_SWH_CD                          = #rtlSwhCd#
            AND A.EZCANCELFLAG                        = '0'
            AND B.EZCANCELFLAG                        = '0'
<!-- START 2023/06/19 K.Chiba [QC#61262, ADD] -->
        UNION
            SELECT
                C.ALT_PSN_CD AS TECH_TOC_CD
                ,B.RTL_WH_CD
                ,B.RTL_SWH_CD
                ,'02' AS WH_OWNR_PSN_TP_CD
            FROM
                TECH_LOC A
                ,RTL_SWH B
                ,RTL_WH  C
            WHERE
                A.GLBL_CMPY_CD                            = #glblCmpyCd#
                AND A.GLBL_CMPY_CD                        = B.GLBL_CMPY_CD
                AND B.GLBL_CMPY_CD                        = C.GLBL_CMPY_CD
                AND A.TECH_LOC_CD                         = B.INVTY_LOC_CD
                AND B.RTL_WH_CD                           = C.RTL_WH_CD 
                AND B.RTL_SWH_CD                          = #rtlSwhCd#
                AND A.EZCANCELFLAG                        = '0'
                AND B.EZCANCELFLAG                        = '0'
                AND C.EZCANCELFLAG                        = '0'
<!-- END 2023/06/19 K.Chiba [QC#61262, ADD] -->
    </statement>
    <statement id="getExpiredWarehouseInfo" parameterClass="Map" resultClass="Map">
        SELECT
            'N' AS ACTV_FLG
            ,A.TECH_TOC_CD
            ,B.RTL_WH_CD
            ,B.RTL_SWH_CD
            ,C.RTL_WH_NM
<!-- START 2023/06/19 K.Chiba [QC#61262, ADD] -->
            ,'01' AS WH_OWNR_PSN_TP_CD 
<!-- END 2023/06/19 K.Chiba [QC#61262, ADD] -->
        FROM
            TECH_LOC A
            ,RTL_SWH B
            ,RTL_WH  C
        WHERE
            A.GLBL_CMPY_CD                            = #glblCmpyCd#
            AND A.GLBL_CMPY_CD                        = B.GLBL_CMPY_CD
            AND A.TECH_LOC_CD                         = B.INVTY_LOC_CD
            AND B.GLBL_CMPY_CD                        = C.GLBL_CMPY_CD
            AND B.RTL_WH_CD                           = C.RTL_WH_CD
            AND B.RTL_SWH_CD                          = #rtlSwhCd#
            AND A.EZUPTIME                            &lt; NVL(A.EFF_THRU_DT, #defaultEffThruDt#) || #effThruDtExpiredConst#
            AND A.EFF_THRU_DT                         = #dsBizLastProcTs#
            AND A.EZCANCELFLAG                        = '0'
<!-- START 2023/06/19 K.Chiba [QC#61262, ADD] -->
        UNION
           SELECT
               'N' AS ACTV_FLG
               ,C.ALT_PSN_CD AS TECH_TOC_CD
               ,B.RTL_WH_CD
               ,B.RTL_SWH_CD
               ,C.RTL_WH_NM
               ,'02' AS WH_OWNR_PSN_TP_CD
           FROM
               TECH_LOC A
               ,RTL_SWH B
               ,RTL_WH  C
           WHERE
               A.GLBL_CMPY_CD                            = #glblCmpyCd#
               AND A.GLBL_CMPY_CD                        = B.GLBL_CMPY_CD
               AND A.TECH_LOC_CD                         = B.INVTY_LOC_CD
               AND B.GLBL_CMPY_CD                        = C.GLBL_CMPY_CD
               AND B.RTL_WH_CD                           = C.RTL_WH_CD
               AND B.RTL_SWH_CD                          = #rtlSwhCd#
            AND A.EZUPTIME                               &lt; NVL(A.EFF_THRU_DT, #defaultEffThruDt#) || #effThruDtExpiredConst#
               AND A.EFF_THRU_DT                         = #dsBizLastProcTs#
               AND A.EZCANCELFLAG                        = '0'
<!-- END 2023/06/19 K.Chiba [QC#61262, ADD] -->
        ORDER BY
<!-- START 2023/06/19 K.Chiba [QC#61262, MOD] -->
<!-- A.TECH_TOC_CD -->
              TECH_TOC_CD
<!-- END 2023/06/19 K.Chiba [QC#61262, MOD] -->
    </statement>
<!-- END   2021/11/17 R.Cabral [QC#59387, ADD] -->
</sqlMap>