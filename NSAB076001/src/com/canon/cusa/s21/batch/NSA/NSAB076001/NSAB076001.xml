<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NSAB076001">
    <statement id="getDeleteData" parameterClass="Map" resultClass="Map">
        SELECT
             A.GLBL_CMPY_CD
            ,A.DWH_TRGT_YR
            ,A.DS_CONTR_PK
            ,A.SVC_MACH_MSTR_PK
        FROM
            SPLY_REV_COST_YR_SMRY  A
        WHERE
                A.GLBL_CMPY_CD  = #glblCmpyCd#
            AND A.EZCANCELFLAG  = '0' 
            AND A.DWH_TRGT_YR   = #dwhTrgtYr#
    </statement>

    <statement id="getTargetYrData" parameterClass="Map" resultClass="Map">
        SELECT
             A.GLBL_CMPY_CD
            ,A.DWH_TRGT_YR
            ,A.DS_CONTR_PK
            ,NVL(A.SVC_MACH_MSTR_PK, 0) AS SVC_MACH_MSTR_PK
            ,SUM(A.BW_MTR_CHRG_DEAL_AMT) + SUM(A.CLR_MTR_CHRG_DEAL_AMT) + SUM(A.OTH_INV_LINE_DEAL_NET_AMT)  AS TOT_REV_AMT
            ,SUM(A.BW_COST_AMT) + SUM(A.CLR_COST_AMT) + SUM(A.OTH_COST_AMT)                                 AS TOT_COST_AMT
        FROM
            MLY_SPLY_REV_COST  A
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.DWH_TRGT_YR       = #dwhTrgtYr#
            AND A.DS_CONTR_PK       IS NOT NULL
        GROUP BY
             A.GLBL_CMPY_CD 
            ,A.DWH_TRGT_YR
            ,A.DS_CONTR_PK
            ,A.SVC_MACH_MSTR_PK
        ORDER BY 
             A.GLBL_CMPY_CD
            ,A.SVC_MACH_MSTR_PK
    </statement>
</sqlMap>