<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWAB003001">
    
<!-- ############################################################################ -->
<!-- ##### Validation Batch Mode : [1] = Daytime                            ##### -->
<!-- ############################################################################ -->
    <statement id="getShpgPlnListByDaytime" parameterClass="Map" resultClass="Map">
	
		-- **************************************************
		--  Target SHPG_PLN_NUM
		-- **************************************************
		WITH TRGT_SHPG_PLN_NUM AS (
	
	        <!-- reg(single) and vendor(single) -->
	        SELECT
                 SP.SHPG_PLN_NUM                SHPG_PLN_NUM
	        FROM
	                 SHPG_PLN    SP
	            ,    CPO         C
	            ,    CPO_DTL     CD
	        WHERE
	                 SP.GLBL_CMPY_CD        =    #glblCmpyCd#
	            AND  SP.GLBL_CMPY_CD        =    C.GLBL_CMPY_CD
	            AND  SP.TRX_HDR_NUM         =    C.CPO_ORD_NUM
	            AND  SP.GLBL_CMPY_CD        =    CD.GLBL_CMPY_CD  
	            AND  SP.TRX_HDR_NUM         =    CD.CPO_ORD_NUM
	            AND  SP.TRX_LINE_NUM        =    CD.CPO_DTL_LINE_NUM
	            AND  SP.TRX_LINE_SUB_NUM    =    CD.CPO_DTL_LINE_SUB_NUM
	            AND  SP.TRX_SRC_TP_CD       =    #trxSrcTpCd#
	            AND  SP.SET_MDSE_CD         IS NULL
	            AND  SP.INVTY_LOC_CD        IS NOT NULL
	            AND 
	            ((       SP.SHPG_STS_CD    =    #shpgStsCdHa#
	                AND  SP.AVAL_SO_QTY    >    0
	            )
	            OR
	            (        SP.SHPG_STS_CD    =    #shpgStsCdV#
	                AND  SP.AVAL_PO_QTY    >    0
	            ))
	            AND  SP.EZCANCELFLAG        =    '0'
	            AND  C.EZCANCELFLAG         =    '0'
	            AND  CD.EZCANCELFLAG        =    '0'
	            
	        UNION ALL
	        <!-- Set(reg only and reg + vendor) -->
	        SELECT
                 SP.SHPG_PLN_NUM                SHPG_PLN_NUM
	        FROM
	                 SHPG_PLN    SP
	            ,    CPO         C
	            ,    CPO_DTL     CD
	        WHERE
	                 SP.GLBL_CMPY_CD        =    #glblCmpyCd#
	            AND  SP.GLBL_CMPY_CD        =    C.GLBL_CMPY_CD
	            AND  SP.TRX_HDR_NUM         =    C.CPO_ORD_NUM
	            AND  SP.GLBL_CMPY_CD        =    CD.GLBL_CMPY_CD  
	            AND  SP.TRX_HDR_NUM         =    CD.CPO_ORD_NUM
	            AND  SP.TRX_LINE_NUM        =    CD.CPO_DTL_LINE_NUM
	            AND  SP.TRX_LINE_SUB_NUM    =    CD.CPO_DTL_LINE_SUB_NUM
	            AND  SP.TRX_LINE_SUB_NUM    =    #trxLineSubNum#
	            AND  SP.TRX_SRC_TP_CD       =    #trxSrcTpCd#
	            AND  SP.SHPG_STS_CD         =    #shpgStsCdV#
	            AND  SP.SET_MDSE_CD         IS NULL
	            AND  SP.INVTY_LOC_CD        IS NULL
	            AND  SP.REV_RECOG_FLG       =   'N'
	            AND EXISTS
	            (
	                SELECT * FROM SHPG_PLN SP1 
	                WHERE
	                        SP1.GLBL_CMPY_CD     = SP.GLBL_CMPY_CD
	                    AND SP1.TRX_HDR_NUM      = SP.TRX_HDR_NUM
	                    AND SP1.TRX_LINE_NUM     = SP.TRX_LINE_NUM
	                    AND SP1.SET_MDSE_CD      = SP.MDSE_CD
	                    AND SP1.INVTY_LOC_CD     IS NOT NULL
	                    AND ((        SP1.SHPG_STS_CD = #shpgStsCdHa#
	                            AND  SP1.AVAL_SO_QTY >  0
	                         )
	                         OR
	                         (       SP1.SHPG_STS_CD = #shpgStsCdV#
	                            AND  SP1.AVAL_PO_QTY >  0
	                        ))
	                    AND SP1.EZCANCELFLAG     =    '0'
	            )
	            AND NOT EXISTS
	            (
	                SELECT * FROM SHPG_PLN SP2
	                WHERE
	                        SP2.GLBL_CMPY_CD     = SP.GLBL_CMPY_CD
	                    AND SP2.TRX_HDR_NUM      = SP.TRX_HDR_NUM
	                    AND SP2.TRX_LINE_NUM     = SP.TRX_LINE_NUM
	                    AND SP2.SHPG_STS_CD      = #shpgStsCdV#
	                    AND SP2.SET_MDSE_CD      = SP.MDSE_CD
	                    AND SP2.INVTY_LOC_CD     IS NULL
	                    AND SP2.EZCANCELFLAG     = '0'
	            )
	            AND SP.EZCANCELFLAG        =    '0'
	            AND C.EZCANCELFLAG         =    '0'
	            AND CD.EZCANCELFLAG        =    '0'
	            
	        UNION ALL
	        <!-- Set comp(reg + vendor) -->
	        SELECT
                 SP.SHPG_PLN_NUM                SHPG_PLN_NUM
	        FROM
	                SHPG_PLN    SP
	            ,   CPO         C
	            ,   CPO_DTL     CD
	        WHERE
	                SP.GLBL_CMPY_CD        =    #glblCmpyCd#
	            AND SP.GLBL_CMPY_CD        =    C.GLBL_CMPY_CD
	            AND SP.TRX_HDR_NUM         =    C.CPO_ORD_NUM
	            AND SP.GLBL_CMPY_CD        =    CD.GLBL_CMPY_CD  
	            AND SP.TRX_HDR_NUM         =    CD.CPO_ORD_NUM
	            AND SP.TRX_LINE_NUM        =    CD.CPO_DTL_LINE_NUM
	            AND SP.TRX_LINE_SUB_NUM    =    CD.CPO_DTL_LINE_SUB_NUM
	            AND SP.TRX_SRC_TP_CD       =    #trxSrcTpCd#
	            AND SP.SET_MDSE_CD         IS NOT NULL
	            AND SP.INVTY_LOC_CD        IS NOT NULL
	            AND SP.REV_RECOG_FLG       =   'N'
	            AND 
	            ((       SP.SHPG_STS_CD    =    #shpgStsCdHa#
	                AND  SP.AVAL_SO_QTY    >    0
	            )
	            OR
	            (        SP.SHPG_STS_CD    =    #shpgStsCdV#
	                AND  SP.AVAL_PO_QTY    >    0
	            ))
	            AND NOT EXISTS
	            (
	                SELECT * FROM SHPG_PLN SP2
	                WHERE
	                        SP2.GLBL_CMPY_CD     = SP.GLBL_CMPY_CD
	                    AND SP2.TRX_HDR_NUM      = SP.TRX_HDR_NUM
	                    AND SP2.TRX_LINE_NUM     = SP.TRX_LINE_NUM
	                    AND SP2.SHPG_STS_CD      = #shpgStsCdV#
	                    AND SP2.SET_MDSE_CD      = SP.SET_MDSE_CD
	                    AND SP2.INVTY_LOC_CD     IS NULL
	                    AND SP2.EZCANCELFLAG     = '0'
	            )
	            AND SP.EZCANCELFLAG        =    '0'
	            AND C.EZCANCELFLAG         =    '0'
	            AND CD.EZCANCELFLAG        =    '0'
	            
	        UNION ALL
	        <!-- Set(reg + intangible) -->
	        SELECT
                 SP.SHPG_PLN_NUM                SHPG_PLN_NUM
	        FROM
	                SHPG_PLN    SP
	            ,   CPO         C
	            ,   CPO_DTL     CD
	        WHERE
	                SP.GLBL_CMPY_CD        =    #glblCmpyCd#
	            AND SP.GLBL_CMPY_CD        =    C.GLBL_CMPY_CD
	            AND SP.TRX_HDR_NUM         =    C.CPO_ORD_NUM
	            AND SP.GLBL_CMPY_CD        =    CD.GLBL_CMPY_CD  
	            AND SP.TRX_HDR_NUM         =    CD.CPO_ORD_NUM
	            AND SP.TRX_LINE_NUM        =    CD.CPO_DTL_LINE_NUM
	            AND SP.TRX_LINE_SUB_NUM    =    CD.CPO_DTL_LINE_SUB_NUM
	            AND SP.TRX_LINE_SUB_NUM    =    #trxLineSubNum#
	            AND SP.TRX_SRC_TP_CD       =    #trxSrcTpCd#
	            AND SP.SHPG_STS_CD         =    #shpgStsCdV#
	            AND SP.SET_MDSE_CD         IS NULL
	            AND SP.INVTY_LOC_CD        IS NULL
	            AND SP.REV_RECOG_FLG       =   'N'
	            AND EXISTS
	            <!-- intangible -->
	            (
	                SELECT * FROM SHPG_PLN SP1
	                WHERE
	                        SP1.GLBL_CMPY_CD     = SP.GLBL_CMPY_CD
	                    AND SP1.TRX_HDR_NUM      = SP.TRX_HDR_NUM
	                    AND SP1.TRX_LINE_NUM     = SP.TRX_LINE_NUM
	                    AND SP1.SET_MDSE_CD      = SP.MDSE_CD
	                    AND SP1.INVTY_LOC_CD     IS NULL
	                    AND SP1.SHPG_STS_CD      = #shpgStsCdV#
	                    AND SP1.REV_RECOG_FLG    = 'N'
	                    AND SP1.EZCANCELFLAG     = '0'
	            )
	            AND EXISTS
	            <!-- reg -->
	            (
	                SELECT * FROM SHPG_PLN SP1 
	                WHERE
	                        SP1.GLBL_CMPY_CD     = SP.GLBL_CMPY_CD
	                    AND SP1.TRX_HDR_NUM      = SP.TRX_HDR_NUM
	                    AND SP1.TRX_LINE_NUM     = SP.TRX_LINE_NUM
	                    AND SP1.SET_MDSE_CD      = SP.MDSE_CD
	                    AND SP1.INVTY_LOC_CD     IS NOT NULL
	                    AND ((        SP1.SHPG_STS_CD = #shpgStsCdHa#
	                            AND  SP1.AVAL_SO_QTY >  0
	                         )
	                         OR
	                         (       SP1.SHPG_STS_CD = #shpgStsCdV#
	                            AND  SP1.AVAL_PO_QTY >  0
	                        ))
	                    AND SP1.EZCANCELFLAG     =    '0'
	            )
	            AND SP.EZCANCELFLAG        =    '0'
	            AND C.EZCANCELFLAG         =    '0'
	            AND CD.EZCANCELFLAG        =    '0'
	            
	        UNION ALL
	        <!-- Set comp(reg + intangible) -->
	        SELECT
                 SP.SHPG_PLN_NUM                SHPG_PLN_NUM
	        FROM
	                SHPG_PLN    SP
	            ,   CPO         C
	            ,   CPO_DTL     CD
	        WHERE
	                SP.GLBL_CMPY_CD        =    #glblCmpyCd#
	            AND SP.GLBL_CMPY_CD        =    C.GLBL_CMPY_CD
	            AND SP.TRX_HDR_NUM         =    C.CPO_ORD_NUM
	            AND SP.GLBL_CMPY_CD        =    CD.GLBL_CMPY_CD  
	            AND SP.TRX_HDR_NUM         =    CD.CPO_ORD_NUM
	            AND SP.TRX_LINE_NUM        =    CD.CPO_DTL_LINE_NUM
	            AND SP.TRX_LINE_SUB_NUM    =    CD.CPO_DTL_LINE_SUB_NUM
	            AND SP.TRX_LINE_SUB_NUM    !=   #trxLineSubNum#
	            AND SP.TRX_SRC_TP_CD       =    #trxSrcTpCd#
	            AND EXISTS <!-- intangible -->
	            (
	                SELECT * FROM SHPG_PLN SP2
	                WHERE
	                         SP2.GLBL_CMPY_CD      = SP.GLBL_CMPY_CD
	                     AND SP2.TRX_HDR_NUM       = SP.TRX_HDR_NUM
	                     AND SP2.TRX_LINE_NUM      = SP.TRX_LINE_NUM
	                     AND SP2.SHPG_STS_CD       = #shpgStsCdV#
	                     AND SP2.SET_MDSE_CD       = SP.SET_MDSE_CD
	                     AND SP2.INVTY_LOC_CD      IS NULL
	                     AND SP2.EZCANCELFLAG      = '0'
	            )
	            AND EXISTS <!-- reg -->
	            (
	                SELECT * FROM SHPG_PLN SP2
	                WHERE
	                         SP2.GLBL_CMPY_CD     = SP.GLBL_CMPY_CD
	                     AND SP2.TRX_HDR_NUM      = SP.TRX_HDR_NUM
	                     AND SP2.TRX_LINE_NUM     = SP.TRX_LINE_NUM
	                     AND SP2.SET_MDSE_CD      = SP.SET_MDSE_CD
	                     AND SP2.INVTY_LOC_CD     IS NOT NULL
	                     AND ((        SP2.SHPG_STS_CD = #shpgStsCdHa#
	                            AND  SP2.AVAL_SO_QTY >  0
	                         )
	                         OR
	                         (       SP2.SHPG_STS_CD = #shpgStsCdV#
	                            AND  SP2.AVAL_PO_QTY >  0
	                        ))
	                     AND SP2.EZCANCELFLAG     = '0'
	            )
	            AND SP.EZCANCELFLAG        =    '0'
	            AND C.EZCANCELFLAG         =    '0'
	            AND CD.EZCANCELFLAG        =    '0'
		)
		
		SELECT
			     SP.SHPG_PLN_NUM                SHPG_PLN_NUM
			,    SP.TRX_HDR_NUM                 TRX_HDR_NUM
			,    SP.TRX_LINE_NUM                TRX_LINE_NUM
			,    SP.TRX_LINE_SUB_NUM            TRX_LINE_SUB_NUM
			,    SP.ORD_QTY                     ORD_QTY
			,    SP.INVTY_LOC_CD                INVTY_LOC_CD
			,    SP.SHPG_STS_CD                 SHPG_STS_CD
			,    SP.MDSE_CD                     MDSE_CD
			,    SP.SET_MDSE_CD                 SET_MDSE_CD
			,    SP.PO_REQ_FLG                  PO_REQ_FLG
			,    SP.CR_CHK_QTY                  CR_CHK_QTY
			,    SP.SHIP_TO_CTRY_CD             SP_SHIP_TO_CTRY_CD
			,    SP.SHIP_TO_ST_CD               SP_SHIP_TO_ST_CD 
			,    SP.CR_HLD_QTY                  CR_HLD_QTY
			
			,    CD.CPO_ORD_TP_CD               CD_CPO_ORD_TP_CD
			,    CD.CPO_ORD_NUM                 CPO_ORD_NUM
			,    CD.CPO_DTL_LINE_NUM            CPO_DTL_LINE_NUM
			,    CD.CPO_DTL_LINE_SUB_NUM        CPO_DTL_LINE_SUB_NUM
			,    CD.DROP_SHIP_FLG               DROP_SHIP_FLG
			,    CD.SHIP_TO_CUST_CD             SHIP_TO_CUST_CD
			,    CD.SHIP_TO_LOC_NM              SHIP_TO_LOC_NM
			,    CD.SHIP_TO_FIRST_LINE_ADDR     SHIP_TO_FIRST_LINE_ADDR
			,    CD.SHIP_TO_SCD_LINE_ADDR       SHIP_TO_SCD_LINE_ADDR
			,    CD.SHIP_TO_THIRD_LINE_ADDR     SHIP_TO_THIRD_LINE_ADDR
			,    CD.SHIP_TO_FRTH_LINE_ADDR      SHIP_TO_FRTH_LINE_ADDR
			,    CD.SHIP_TO_CTY_ADDR            SHIP_TO_CTY_ADDR
			,    CD.SHIP_TO_ST_CD               SHIP_TO_ST_CD
			,    CD.SHIP_TO_POST_CD             SHIP_TO_POST_CD
			,    CD.SHIP_TO_CTRY_CD             SHIP_TO_CTRY_CD
			,    CD.SHIP_TO_PROV_NM             SHIP_TO_PROV_NM
			,    CD.SHIP_TO_CNTY_NM             SHIP_TO_CNTY_NM
			,    CD.SLS_REP_OR_SLS_TEAM_TOC_CD  SLS_REP_OR_SLS_TEAM_TOC_CD
			
			,    C.CPO_ORD_TP_CD                CPO_ORD_TP_CD
			,    C.CPO_SRC_TP_CD                CPO_SRC_TP_CD
			,    C.BILL_TO_CUST_CD              BILL_TO_CUST_CD
			,    C.SELL_TO_CUST_CD              SELL_TO_CUST_CD
			<!-- START ADD M.Ohno [NA_QC#15097] -->
			,    HI.HLD_RSN_CD                  HLD_RSN_CD
            ,    HI.HLD_RSN_NM                  HLD_RSN_NM
            ,    HI.HLD_LVL_CD                  HLD_LVL_CD
            ,    HI.APPLY_ORD_SRC_TP_CD         APPLY_ORD_SRC_TP_CD
            ,    HI.APPLY_ORD_TP_CD             APPLY_ORD_TP_CD
            ,    HI.EX_REQ_FLG                  EX_REQ_FLG
            ,    HI.APPLY_DS_ORD_TP_CD          APPLY_DS_ORD_TP_CD
            <!-- END ADD M.Ohno [NA_QC#15097] -->

<!-- START ADD S.Yamamoto [OM004] -->
			,    C.DS_ORD_TP_CD                 DS_ORD_TP_CD
<!-- END   ADD S.Yamamoto [OM004] -->

            <!-- QC#17941 -->
            , SP.EZUPTIME                       EZUPTIME_SP
            , SP.EZUPTIMEZONE                   EZUPTIMEZONE_SP
            , CD.EZUPTIME                       EZUPTIME_CD
            , CD.EZUPTIMEZONE                   EZUPTIMEZONE_CD
            , C.EZUPTIME                        EZUPTIME_C
            , C.EZUPTIMEZONE                    EZUPTIMEZONE_C

		FROM
				SHPG_PLN  SP
			,	CPO_DTL   CD
			,	CPO       C
<!-- START ADD M.Ohno [NA_QC#15097] -->
			,(  SELECT
		                HR.HLD_RSN_CD              HLD_RSN_CD
		            ,   HR.HLD_RSN_NM              HLD_RSN_NM
		            ,   HR.HLD_LVL_CD              HLD_LVL_CD
		            ,   HOS.APPLY_ORD_SRC_TP_CD    APPLY_ORD_SRC_TP_CD
		            ,   HOT.APPLY_ORD_TP_CD        APPLY_ORD_TP_CD
		            ,   HR.EX_REQ_FLG              EX_REQ_FLG
		            ,   DHOT.APPLY_DS_ORD_TP_CD    APPLY_DS_ORD_TP_CD
		            ,   HR.GLBL_CMPY_CD            GLBL_CMPY_CD
		            ,   HR.EZCANCELFLAG            EZCANCELFLAG
		        FROM
		                HLD_RSN             HR
		            ,   HLD_CTRL_ORD_SRC    HOS
		            ,   HLD_CTRL_ORD_TP     HOT
		            ,   DS_HLD_CTRL_ORD_TP  DHOT
		        WHERE
		                HR.GLBL_CMPY_CD     = #glblCmpyCd#
		            AND HR.GLBL_CMPY_CD     = HOS.GLBL_CMPY_CD
		            AND HOS.GLBL_CMPY_CD    = HOT.GLBL_CMPY_CD
		            AND HR.HLD_RSN_CD       = HOS.HLD_RSN_CD
		            AND HOS.HLD_RSN_CD      = HOT.HLD_RSN_CD
		            AND HR.DTM_BAT_FLG      = 'Y'
		            AND HR.EZCANCELFLAG     = '0'
		            AND HOS.EZCANCELFLAG    = '0'
		            AND HOT.EZCANCELFLAG    = '0'
		            AND HR.GLBL_CMPY_CD     = DHOT.GLBL_CMPY_CD
		            AND HR.HLD_RSN_CD       = DHOT.HLD_RSN_CD
		            AND DHOT.EZCANCELFLAG    = '0'
		        ORDER BY 
		                HR.HLD_RSN_CD 
		            ,   HOS.APPLY_ORD_SRC_TP_CD
		            ,   HOT.APPLY_ORD_TP_CD
			) HI
<!-- END ADD M.Ohno [NA_QC#15097] -->
		WHERE
			-- ***** SHPG_PLN
			EXISTS (
				SELECT
				  *
				FROM
				  TRGT_SHPG_PLN_NUM TRGT
				WHERE
				  SP.SHPG_PLN_NUM = TRGT.SHPG_PLN_NUM
			)
			AND SP.GLBL_CMPY_CD     = #glblCmpyCd#
			AND SP.EZCANCELFLAG     = '0'
			
			-- ***** CPO_DTL
			AND SP.GLBL_CMPY_CD     = CD.GLBL_CMPY_CD
			AND SP.EZCANCELFLAG     = CD.EZCANCELFLAG
			AND SP.TRX_HDR_NUM      = CD.CPO_ORD_NUM
			AND SP.TRX_LINE_NUM     = CD.CPO_DTL_LINE_NUM
			AND SP.TRX_LINE_SUB_NUM = CD.CPO_DTL_LINE_SUB_NUM
			
			-- ***** CPO
			AND SP.GLBL_CMPY_CD     = C.GLBL_CMPY_CD
			AND SP.EZCANCELFLAG     = C.EZCANCELFLAG
			AND SP.TRX_HDR_NUM      = C.CPO_ORD_NUM

<!-- START ADD M.Ohno [NA_QC#15097] -->
			-- ***** Hold Info
			AND C.GLBL_CMPY_CD      = HI.GLBL_CMPY_CD
			AND C.EZCANCELFLAG      = HI.EZCANCELFLAG
            AND C.CPO_ORD_TP_CD     = HI.APPLY_ORD_TP_CD
            AND C.CPO_SRC_TP_CD     = HI.APPLY_ORD_SRC_TP_CD
            AND C.DS_ORD_TP_CD      = HI.APPLY_DS_ORD_TP_CD
<!-- END ADD M.Ohno [NA_QC#15097] -->
		ORDER BY
				SP.TRX_HDR_NUM
			,	SP.TRX_LINE_NUM
			,	SP.TRX_LINE_SUB_NUM
<!--        FOR UPDATE  QC#17941 -->
    </statement>
    
    
<!-- ############################################################################ -->
<!-- ##### Validation Batch Mode : [2] = Night                              ##### -->
<!-- ############################################################################ -->
    <statement id="getShpgPlnListByNight" parameterClass="Map" resultClass="Map">
        SELECT
                 SP.SHPG_PLN_NUM                SHPG_PLN_NUM
            ,    SP.TRX_HDR_NUM                 TRX_HDR_NUM
            ,    SP.TRX_LINE_NUM                TRX_LINE_NUM
            ,    SP.TRX_LINE_SUB_NUM            TRX_LINE_SUB_NUM
            ,    SP.ORD_QTY                     ORD_QTY
            ,    SP.INVTY_LOC_CD                INVTY_LOC_CD
            ,    SP.SHPG_STS_CD                 SHPG_STS_CD
            ,    SP.MDSE_CD                     MDSE_CD
            ,    SP.SET_MDSE_CD                 SET_MDSE_CD
            ,    SP.PO_REQ_FLG                  PO_REQ_FLG
            ,    SP.CR_CHK_QTY                  CR_CHK_QTY
            ,    SP.SHIP_TO_CTRY_CD             SP_SHIP_TO_CTRY_CD
            ,    SP.SHIP_TO_ST_CD               SP_SHIP_TO_ST_CD  
            ,    SP.CR_HLD_QTY                  CR_HLD_QTY
            
            ,    CD.CPO_ORD_TP_CD               CD_CPO_ORD_TP_CD
            ,    CD.CPO_ORD_NUM                 CPO_ORD_NUM
            ,    CD.CPO_DTL_LINE_NUM            CPO_DTL_LINE_NUM
            ,    CD.CPO_DTL_LINE_SUB_NUM        CPO_DTL_LINE_SUB_NUM
            ,    CD.DROP_SHIP_FLG               DROP_SHIP_FLG
            ,    CD.SHIP_TO_CUST_CD             SHIP_TO_CUST_CD
            ,    CD.SHIP_TO_LOC_NM              SHIP_TO_LOC_NM
            ,    CD.SHIP_TO_FIRST_LINE_ADDR     SHIP_TO_FIRST_LINE_ADDR
            ,    CD.SHIP_TO_SCD_LINE_ADDR       SHIP_TO_SCD_LINE_ADDR
            ,    CD.SHIP_TO_THIRD_LINE_ADDR     SHIP_TO_THIRD_LINE_ADDR
            ,    CD.SHIP_TO_FRTH_LINE_ADDR      SHIP_TO_FRTH_LINE_ADDR
            ,    CD.SHIP_TO_CTY_ADDR            SHIP_TO_CTY_ADDR
            ,    CD.SHIP_TO_ST_CD               SHIP_TO_ST_CD
            ,    CD.SHIP_TO_POST_CD             SHIP_TO_POST_CD
            ,    CD.SHIP_TO_CTRY_CD             SHIP_TO_CTRY_CD
            ,    CD.SHIP_TO_PROV_NM             SHIP_TO_PROV_NM
            ,    CD.SHIP_TO_CNTY_NM             SHIP_TO_CNTY_NM
            ,    CD.SLS_REP_OR_SLS_TEAM_TOC_CD  SLS_REP_OR_SLS_TEAM_TOC_CD

            ,    C.CPO_ORD_TP_CD                CPO_ORD_TP_CD
            ,    C.CPO_SRC_TP_CD                CPO_SRC_TP_CD
            ,    C.BILL_TO_CUST_CD              BILL_TO_CUST_CD
            ,    C.SELL_TO_CUST_CD              SELL_TO_CUST_CD

<!-- START ADD S.Yamamoto [OM004] -->
            ,    C.DS_ORD_TP_CD                 DS_ORD_TP_CD
<!-- END   ADD S.Yamamoto [OM004] -->

            <!-- START ADD M.Ohno [NA_QC#15097] -->
            ,    HI.HLD_RSN_CD                  HLD_RSN_CD
            ,    HI.HLD_RSN_NM                  HLD_RSN_NM
            ,    HI.HLD_LVL_CD                  HLD_LVL_CD
            ,    HI.APPLY_ORD_SRC_TP_CD         APPLY_ORD_SRC_TP_CD
            ,    HI.APPLY_ORD_TP_CD             APPLY_ORD_TP_CD
            ,    HI.EX_REQ_FLG                  EX_REQ_FLG
            ,    HI.APPLY_DS_ORD_TP_CD          APPLY_DS_ORD_TP_CD
            <!-- END ADD M.Ohno [NA_QC#15097] -->

            <!-- QC#17941 -->
            , SP.EZUPTIME                       EZUPTIME_SP
            , SP.EZUPTIMEZONE                   EZUPTIMEZONE_SP
            , CD.EZUPTIME                       EZUPTIME_CD
            , CD.EZUPTIMEZONE                   EZUPTIMEZONE_CD
            , C.EZUPTIME                        EZUPTIME_C
            , C.EZUPTIMEZONE                    EZUPTIMEZONE_C
        FROM
                SHPG_PLN    SP
            ,   CPO         C
            ,   CPO_DTL     CD
<!-- START ADD M.Ohno [NA_QC#15097] -->
			,(  SELECT
		                HR.HLD_RSN_CD              HLD_RSN_CD
		            ,   HR.HLD_RSN_NM              HLD_RSN_NM
		            ,   HR.HLD_LVL_CD              HLD_LVL_CD
		            ,   HOS.APPLY_ORD_SRC_TP_CD    APPLY_ORD_SRC_TP_CD
		            ,   HOT.APPLY_ORD_TP_CD        APPLY_ORD_TP_CD
		            ,   HR.EX_REQ_FLG              EX_REQ_FLG
		            ,   DHOT.APPLY_DS_ORD_TP_CD    APPLY_DS_ORD_TP_CD
		            ,   HR.GLBL_CMPY_CD            GLBL_CMPY_CD
		            ,   HR.EZCANCELFLAG            EZCANCELFLAG
		        FROM
		                HLD_RSN             HR
		            ,   HLD_CTRL_ORD_SRC    HOS
		            ,   HLD_CTRL_ORD_TP     HOT
		            ,   DS_HLD_CTRL_ORD_TP  DHOT
		        WHERE
		                HR.GLBL_CMPY_CD     = #glblCmpyCd#
		            AND HR.GLBL_CMPY_CD     = HOS.GLBL_CMPY_CD
		            AND HOS.GLBL_CMPY_CD    = HOT.GLBL_CMPY_CD
		            AND HR.HLD_RSN_CD       = HOS.HLD_RSN_CD
		            AND HOS.HLD_RSN_CD      = HOT.HLD_RSN_CD
		            AND HR.NIGHT_BAT_FLG    = 'Y'
		            AND HR.EZCANCELFLAG     = '0'
		            AND HOS.EZCANCELFLAG    = '0'
		            AND HOT.EZCANCELFLAG    = '0'
		            AND HR.GLBL_CMPY_CD     = DHOT.GLBL_CMPY_CD
		            AND HR.HLD_RSN_CD       = DHOT.HLD_RSN_CD
		            AND DHOT.EZCANCELFLAG    = '0'
		        ORDER BY 
		                HR.HLD_RSN_CD 
		            ,   HOS.APPLY_ORD_SRC_TP_CD
		            ,   HOT.APPLY_ORD_TP_CD
			) HI
<!-- END ADD M.Ohno [NA_QC#15097] -->
        WHERE
                SP.GLBL_CMPY_CD        =    #glblCmpyCd#
            AND SP.GLBL_CMPY_CD        =    C.GLBL_CMPY_CD
            AND SP.TRX_HDR_NUM         =    C.CPO_ORD_NUM
            AND SP.GLBL_CMPY_CD        =    CD.GLBL_CMPY_CD  
            AND SP.TRX_HDR_NUM         =    CD.CPO_ORD_NUM
            AND SP.TRX_LINE_NUM        =    CD.CPO_DTL_LINE_NUM
            AND SP.TRX_LINE_SUB_NUM    =    CD.CPO_DTL_LINE_SUB_NUM
            AND SP.TRX_SRC_TP_CD       =    #trxSrcTpCd#
            AND SP.SHPG_STS_CD         IN	(#shpgStsCdV#, #shpgStsCdHa#)
            AND SP.EZCANCELFLAG        =    '0'
            AND C.EZCANCELFLAG         =    '0'
            AND CD.EZCANCELFLAG        =    '0'
<!-- START ADD M.Ohno [NA_QC#15097] -->
			-- ***** Hold Info
			AND C.GLBL_CMPY_CD      = HI.GLBL_CMPY_CD
			AND C.EZCANCELFLAG      = HI.EZCANCELFLAG
            AND C.CPO_ORD_TP_CD     = HI.APPLY_ORD_TP_CD
            AND C.CPO_SRC_TP_CD     = HI.APPLY_ORD_SRC_TP_CD
            AND C.DS_ORD_TP_CD      = HI.APPLY_DS_ORD_TP_CD
<!-- END ADD M.Ohno [NA_QC#15097] -->
        ORDER BY
                TRX_HDR_NUM
            ,   TRX_LINE_NUM
            ,   TRX_LINE_SUB_NUM
<!--        FOR UPDATE QC#17941 -->
    </statement>
    
    
<!-- ############################################################################ -->
<!-- ##### Validation Batch Mode : [3] = before revenue recognition         ##### -->
<!-- ############################################################################ -->
    <statement id="getShpgPlnListByBeforeRevenueRecognition" parameterClass="Map" resultClass="Map">
    
		-- **************************************************
		--  Target SHPG_PLN_NUM
		-- **************************************************
		WITH TRGT_SHPG_PLN_NUM AS (
		
	        SELECT
                 SP.SHPG_PLN_NUM                SHPG_PLN_NUM

	        FROM
	                SHPG_PLN    SP
	            ,   CPO         C
	            ,   CPO_DTL     CD
	            ,   MDSE        M
	        WHERE
	                SP.GLBL_CMPY_CD        =    #glblCmpyCd#
	            AND SP.GLBL_CMPY_CD        =    C.GLBL_CMPY_CD
	            AND SP.TRX_HDR_NUM         =    C.CPO_ORD_NUM
	            AND SP.GLBL_CMPY_CD        =    CD.GLBL_CMPY_CD  
	            AND SP.TRX_HDR_NUM         =    CD.CPO_ORD_NUM
	            AND SP.TRX_LINE_NUM        =    CD.CPO_DTL_LINE_NUM
	            AND SP.TRX_LINE_SUB_NUM    =    CD.CPO_DTL_LINE_SUB_NUM
	            AND SP.TRX_LINE_SUB_NUM   !=    #trxLineSubNum#
	            AND SP.TRX_SRC_TP_CD       =    #trxSrcTpCd#
	            AND SP.SHPG_STS_CD         =    #shpgStsCdV#
	            AND SP.INVTY_LOC_CD        IS NULL
	            AND SP.SET_MDSE_CD         IS NULL
	            AND SP.REV_RECOG_FLG       =    'N'
	            AND SP.GLBL_CMPY_CD        =    M.GLBL_CMPY_CD
	            AND SP.MDSE_CD             =    M.MDSE_CD
	            AND M.INVTY_CTRL_FLG       =    'N'
	            AND SP.EZCANCELFLAG        =    '0'
	            AND C.EZCANCELFLAG         =    '0'
	            AND CD.EZCANCELFLAG        =    '0'
	            AND M.EZCANCELFLAG         =    '0'
	            AND 
	            (   C.CPO_HLD_FLG          =    'N'
	            OR  CD.CPO_DTL_HLD_FLG     =    'N'
	            OR  SP.SHIP_PLN_HLD_FLG    =    'N'
	            )
	            
	        UNION ALL
	        SELECT
                 SP.SHPG_PLN_NUM                SHPG_PLN_NUM
	        FROM
	                SHPG_PLN    SP
	            ,   CPO         C
	            ,   CPO_DTL     CD
	            ,   MDSE        M
	        WHERE
	                SP.GLBL_CMPY_CD        =    #glblCmpyCd#
	            AND SP.GLBL_CMPY_CD        =    C.GLBL_CMPY_CD
	            AND SP.TRX_HDR_NUM         =    C.CPO_ORD_NUM
	            AND SP.GLBL_CMPY_CD        =    CD.GLBL_CMPY_CD  
	            AND SP.TRX_HDR_NUM         =    CD.CPO_ORD_NUM
	            AND SP.TRX_LINE_NUM        =    CD.CPO_DTL_LINE_NUM
	            AND SP.TRX_LINE_SUB_NUM    =    CD.CPO_DTL_LINE_SUB_NUM
	            AND SP.TRX_LINE_SUB_NUM    =    #trxLineSubNum#
	            AND SP.TRX_SRC_TP_CD       =    #trxSrcTpCd#
	            AND SP.SHPG_STS_CD         =    #shpgStsCdV#
	            AND SP.INVTY_LOC_CD        IS NULL
	            AND SP.SET_MDSE_CD         IS NULL
	            AND SP.REV_RECOG_FLG       =    'N'
	            AND SP.GLBL_CMPY_CD        =    M.GLBL_CMPY_CD
	            AND SP.MDSE_CD             =    M.MDSE_CD
	            AND M.INVTY_CTRL_FLG       =    'N'
	            AND NOT EXISTS
	            (
	                SELECT * FROM SHPG_PLN SP1
	                WHERE
	                        SP1.GLBL_CMPY_CD      =  SP.GLBL_CMPY_CD
	                    AND SP1.TRX_HDR_NUM       =  SP.TRX_HDR_NUM
	                    AND SP1.TRX_LINE_NUM      =  SP.TRX_LINE_NUM
	                    AND SP1.TRX_LINE_SUB_NUM !=  #trxLineSubNum#
	                    AND SP1.INVTY_LOC_CD      IS NOT NULL
	                    AND SP1.SET_MDSE_CD       =  SP.MDSE_CD
	                    AND SP1.EZCANCELFLAG      =  '0'
	            )
	            AND SP.EZCANCELFLAG        =    '0'
	            AND C.EZCANCELFLAG         =    '0'
	            AND CD.EZCANCELFLAG        =    '0'
	            AND M.EZCANCELFLAG         =    '0'
	            AND 
	            (   C.CPO_HLD_FLG          =    'N'
	            OR  CD.CPO_DTL_HLD_FLG     =    'N'
	            OR  SP.SHIP_PLN_HLD_FLG    =    'N'
	            )
	            
	        UNION ALL
	        SELECT
                 SP.SHPG_PLN_NUM                SHPG_PLN_NUM
	        FROM
	                SHPG_PLN    SP
	            ,   CPO         C
	            ,   CPO_DTL     CD
	            ,   MDSE        M
	        WHERE
	                SP.GLBL_CMPY_CD        =    #glblCmpyCd#
	            AND SP.GLBL_CMPY_CD        =    C.GLBL_CMPY_CD
	            AND SP.TRX_HDR_NUM         =    C.CPO_ORD_NUM
	            AND SP.GLBL_CMPY_CD        =    CD.GLBL_CMPY_CD  
	            AND SP.TRX_HDR_NUM         =    CD.CPO_ORD_NUM
	            AND SP.TRX_LINE_NUM        =    CD.CPO_DTL_LINE_NUM
	            AND SP.TRX_LINE_SUB_NUM    =    CD.CPO_DTL_LINE_SUB_NUM
	            AND SP.TRX_SRC_TP_CD       =    #trxSrcTpCd#
	            AND SP.SHPG_STS_CD         =    #shpgStsCdV#
	            AND SP.INVTY_LOC_CD        IS NULL
	            AND SP.SET_MDSE_CD         IS NOT NULL
	            AND SP.REV_RECOG_FLG       =    'N'
	            AND SP.GLBL_CMPY_CD        =    M.GLBL_CMPY_CD
	            AND SP.MDSE_CD             =    M.MDSE_CD
	            AND M.INVTY_CTRL_FLG       =    'N'
	            AND NOT EXISTS
	            (
	                SELECT * FROM SHPG_PLN SP1
	                WHERE
	                        SP1.GLBL_CMPY_CD      =  SP.GLBL_CMPY_CD
	                    AND SP1.TRX_HDR_NUM       =  SP.TRX_HDR_NUM
	                    AND SP1.TRX_LINE_NUM      =  SP.TRX_LINE_NUM
	                    AND SP1.TRX_LINE_SUB_NUM !=  SP.TRX_LINE_SUB_NUM
	                    AND SP1.INVTY_LOC_CD      IS NOT NULL
	                    AND SP1.SET_MDSE_CD       =  SP.SET_MDSE_CD
	                    AND SP1.EZCANCELFLAG      = '0'
	            )
	            AND SP.EZCANCELFLAG        =    '0'
	            AND C.EZCANCELFLAG         =    '0'
	            AND CD.EZCANCELFLAG        =    '0'
	            AND M.EZCANCELFLAG         =    '0'
	            AND 
	            (   C.CPO_HLD_FLG          =    'N'
	            OR  CD.CPO_DTL_HLD_FLG     =    'N'
	            OR  SP.SHIP_PLN_HLD_FLG    =    'N'
	            )
		)

		SELECT
			     SP.SHPG_PLN_NUM                SHPG_PLN_NUM
			,    SP.TRX_HDR_NUM                 TRX_HDR_NUM
			,    SP.TRX_LINE_NUM                TRX_LINE_NUM
			,    SP.TRX_LINE_SUB_NUM            TRX_LINE_SUB_NUM
			,    SP.ORD_QTY                     ORD_QTY
			,    SP.INVTY_LOC_CD                INVTY_LOC_CD
			,    SP.SHPG_STS_CD                 SHPG_STS_CD
			,    SP.MDSE_CD                     MDSE_CD
			,    SP.SET_MDSE_CD                 SET_MDSE_CD
			,    SP.PO_REQ_FLG                  PO_REQ_FLG
			,    SP.CR_CHK_QTY                  CR_CHK_QTY
			,    SP.SHIP_TO_CTRY_CD             SP_SHIP_TO_CTRY_CD
			,    SP.SHIP_TO_ST_CD               SP_SHIP_TO_ST_CD 
			,    SP.CR_HLD_QTY                  CR_HLD_QTY
			
			,    CD.CPO_ORD_TP_CD               CD_CPO_ORD_TP_CD
			,    CD.CPO_ORD_NUM                 CPO_ORD_NUM
			,    CD.CPO_DTL_LINE_NUM            CPO_DTL_LINE_NUM
			,    CD.CPO_DTL_LINE_SUB_NUM        CPO_DTL_LINE_SUB_NUM
			,    CD.DROP_SHIP_FLG               DROP_SHIP_FLG
			,    CD.SHIP_TO_CUST_CD             SHIP_TO_CUST_CD
			,    CD.SHIP_TO_LOC_NM              SHIP_TO_LOC_NM
			,    CD.SHIP_TO_FIRST_LINE_ADDR     SHIP_TO_FIRST_LINE_ADDR
			,    CD.SHIP_TO_SCD_LINE_ADDR       SHIP_TO_SCD_LINE_ADDR
			,    CD.SHIP_TO_THIRD_LINE_ADDR     SHIP_TO_THIRD_LINE_ADDR
			,    CD.SHIP_TO_FRTH_LINE_ADDR      SHIP_TO_FRTH_LINE_ADDR
			,    CD.SHIP_TO_CTY_ADDR            SHIP_TO_CTY_ADDR
			,    CD.SHIP_TO_ST_CD               SHIP_TO_ST_CD
			,    CD.SHIP_TO_POST_CD             SHIP_TO_POST_CD
			,    CD.SHIP_TO_CTRY_CD             SHIP_TO_CTRY_CD
			,    CD.SHIP_TO_PROV_NM             SHIP_TO_PROV_NM
			,    CD.SHIP_TO_CNTY_NM             SHIP_TO_CNTY_NM
			,    CD.SLS_REP_OR_SLS_TEAM_TOC_CD  SLS_REP_OR_SLS_TEAM_TOC_CD

			,    C.CPO_ORD_TP_CD                CPO_ORD_TP_CD
			,    C.CPO_SRC_TP_CD                CPO_SRC_TP_CD
			,    C.BILL_TO_CUST_CD              BILL_TO_CUST_CD
			,    C.SELL_TO_CUST_CD              SELL_TO_CUST_CD

<!-- START ADD S.Yamamoto [OM004] -->
			,    C.DS_ORD_TP_CD                 DS_ORD_TP_CD
<!-- END   ADD S.Yamamoto [OM004] -->


            <!-- START ADD M.Ohno [NA_QC#15097] -->
            ,    HI.HLD_RSN_CD                  HLD_RSN_CD
            ,    HI.HLD_RSN_NM                  HLD_RSN_NM
            ,    HI.HLD_LVL_CD                  HLD_LVL_CD
            ,    HI.APPLY_ORD_SRC_TP_CD         APPLY_ORD_SRC_TP_CD
            ,    HI.APPLY_ORD_TP_CD             APPLY_ORD_TP_CD
            ,    HI.EX_REQ_FLG                  EX_REQ_FLG
            ,    HI.APPLY_DS_ORD_TP_CD          APPLY_DS_ORD_TP_CD
            <!-- END ADD M.Ohno [NA_QC#15097] -->

            <!-- QC#17941 -->
            , SP.EZUPTIME                       EZUPTIME_SP
            , SP.EZUPTIMEZONE                   EZUPTIMEZONE_SP
            , CD.EZUPTIME                       EZUPTIME_CD
            , CD.EZUPTIMEZONE                   EZUPTIMEZONE_CD
            , C.EZUPTIME                        EZUPTIME_C
            , C.EZUPTIMEZONE                    EZUPTIMEZONE_C
		FROM
				SHPG_PLN  SP
			,	CPO_DTL   CD
			,	CPO       C

<!-- START ADD M.Ohno [NA_QC#15097] -->
			,(  SELECT
		                HR.HLD_RSN_CD              HLD_RSN_CD
		            ,   HR.HLD_RSN_NM              HLD_RSN_NM
		            ,   HR.HLD_LVL_CD              HLD_LVL_CD
		            ,   HOS.APPLY_ORD_SRC_TP_CD    APPLY_ORD_SRC_TP_CD
		            ,   HOT.APPLY_ORD_TP_CD        APPLY_ORD_TP_CD
		            ,   HR.EX_REQ_FLG              EX_REQ_FLG
		            ,   DHOT.APPLY_DS_ORD_TP_CD    APPLY_DS_ORD_TP_CD
		            ,   HR.GLBL_CMPY_CD            GLBL_CMPY_CD
		            ,   HR.EZCANCELFLAG            EZCANCELFLAG
		        FROM
		                HLD_RSN             HR
		            ,   HLD_CTRL_ORD_SRC    HOS
		            ,   HLD_CTRL_ORD_TP     HOT
		            ,   DS_HLD_CTRL_ORD_TP  DHOT
		        WHERE
		                HR.GLBL_CMPY_CD     = #glblCmpyCd#
		            AND HR.GLBL_CMPY_CD     = HOS.GLBL_CMPY_CD
		            AND HOS.GLBL_CMPY_CD    = HOT.GLBL_CMPY_CD
		            AND HR.HLD_RSN_CD       = HOS.HLD_RSN_CD
		            AND HOS.HLD_RSN_CD      = HOT.HLD_RSN_CD
		            AND HR.DTM_BAT_FLG      = 'Y'
		            AND HR.EZCANCELFLAG     = '0'
		            AND HOS.EZCANCELFLAG    = '0'
		            AND HOT.EZCANCELFLAG    = '0'
		            AND HR.GLBL_CMPY_CD     = DHOT.GLBL_CMPY_CD
		            AND HR.HLD_RSN_CD       = DHOT.HLD_RSN_CD
		            AND DHOT.EZCANCELFLAG    = '0'
		        ORDER BY 
		                HR.HLD_RSN_CD 
		            ,   HOS.APPLY_ORD_SRC_TP_CD
		            ,   HOT.APPLY_ORD_TP_CD
			) HI
<!-- END ADD M.Ohno [NA_QC#15097] -->
		WHERE
			-- ***** SHPG_PLN
			EXISTS (
				SELECT
				  *
				FROM
				  TRGT_SHPG_PLN_NUM TRGT
				WHERE
				  SP.SHPG_PLN_NUM = TRGT.SHPG_PLN_NUM
			)
			AND SP.GLBL_CMPY_CD     = #glblCmpyCd#
			AND SP.EZCANCELFLAG     = '0'
			
			-- ***** CPO_DTL
			AND SP.GLBL_CMPY_CD     = CD.GLBL_CMPY_CD
			AND SP.EZCANCELFLAG     = CD.EZCANCELFLAG
			AND SP.TRX_HDR_NUM      = CD.CPO_ORD_NUM
			AND SP.TRX_LINE_NUM     = CD.CPO_DTL_LINE_NUM
			AND SP.TRX_LINE_SUB_NUM = CD.CPO_DTL_LINE_SUB_NUM
			
			-- ***** CPO
			AND SP.GLBL_CMPY_CD     = C.GLBL_CMPY_CD
			AND SP.EZCANCELFLAG     = C.EZCANCELFLAG
			AND SP.TRX_HDR_NUM      = C.CPO_ORD_NUM

<!-- START ADD M.Ohno [NA_QC#15097] -->
			-- ***** Hold Info
			AND C.GLBL_CMPY_CD      = HI.GLBL_CMPY_CD
			AND C.EZCANCELFLAG      = HI.EZCANCELFLAG
            AND C.CPO_ORD_TP_CD     = HI.APPLY_ORD_TP_CD
            AND C.CPO_SRC_TP_CD     = HI.APPLY_ORD_SRC_TP_CD
            AND C.DS_ORD_TP_CD      = HI.APPLY_DS_ORD_TP_CD
<!-- END ADD M.Ohno [NA_QC#15097] -->
		ORDER BY
				SP.TRX_HDR_NUM
			,	SP.TRX_LINE_NUM
			,	SP.TRX_LINE_SUB_NUM
<!--		FOR UPDATE QC#17941 -->
    </statement>
    
    
    <statement id="getHldRsnInfoList" parameterClass="Map">
        SELECT
                HR.HLD_RSN_CD              HLD_RSN_CD
            ,   HR.HLD_RSN_NM              HLD_RSN_NM
            ,   HR.HLD_LVL_CD              HLD_LVL_CD
            ,   HOS.APPLY_ORD_SRC_TP_CD    APPLY_ORD_SRC_TP_CD
            ,   HOT.APPLY_ORD_TP_CD        APPLY_ORD_TP_CD
            ,   HR.EX_REQ_FLG              EX_REQ_FLG
<!-- START ADD S.Yamamoto [OM004] -->
            ,   DHOT.APPLY_DS_ORD_TP_CD    APPLY_DS_ORD_TP_CD
<!-- END   ADD S.Yamamoto [OM004] -->
        FROM
                HLD_RSN             HR
            ,   HLD_CTRL_ORD_SRC    HOS
            ,   HLD_CTRL_ORD_TP     HOT
<!-- START ADD S.Yamamoto [OM004] -->
            ,   DS_HLD_CTRL_ORD_TP  DHOT
<!-- END   ADD S.Yamamoto [OM004] -->
        WHERE
                HR.GLBL_CMPY_CD     = #glblCmpyCd#
            AND HR.GLBL_CMPY_CD     = HOS.GLBL_CMPY_CD
            AND HOS.GLBL_CMPY_CD    = HOT.GLBL_CMPY_CD
            AND HR.HLD_RSN_CD       = HOS.HLD_RSN_CD
            AND HOS.HLD_RSN_CD      = HOT.HLD_RSN_CD
            <isNotEqual	property="validationBatchMode" compareValue="2">
            AND HR.DTM_BAT_FLG      = 'Y'
            </isNotEqual>
            <isEqual	property="validationBatchMode" compareValue="2">
            AND HR.NIGHT_BAT_FLG    = 'Y'
            </isEqual>
            AND HR.EZCANCELFLAG     = '0'
            AND HOS.EZCANCELFLAG    = '0'
            AND HOT.EZCANCELFLAG    = '0'
<!-- START ADD S.Yamamoto [OM004] -->
            AND HR.GLBL_CMPY_CD     = DHOT.GLBL_CMPY_CD
            AND HR.HLD_RSN_CD       = DHOT.HLD_RSN_CD
            AND DHOT.EZCANCELFLAG    = '0'
<!-- END   ADD S.Yamamoto [OM004] -->
        ORDER BY 
                HR.HLD_RSN_CD 
            ,   HOS.APPLY_ORD_SRC_TP_CD
            ,   HOT.APPLY_ORD_TP_CD
    </statement>
    
    
    <statement id="getBillToSellToScreeningData" parameterClass="Map" resultClass="Map">
        WITH
        VW_BT AS (SELECT
                             BT.BILL_TO_CUST_CD         V_BILL_TO_CUST_CD
                     ,       BT.DPL_STS_CD              V_BT_DPL_STS_CD
                     ,       BT.EMBGO_FLG               V_BT_EMBGO_FLG
                     ,       BT.DPL_RSN_TXT             V_BT_DPL_RSN_TXT
                  FROM
                             BILL_TO_CUST BT
                  WHERE
                             BT.GLBL_CMPY_CD          = #glblCmpyCd#
                    AND      BT.BILL_TO_CUST_CD IN
                      <iterate property="billCdList" var="billCd[]" open="(" close=")" conjunction=",">
                        #billCd[]#
                    </iterate>    
                    AND     BT.EZCANCELFLAG     = '0'
                 ),
         VW_SE AS (SELECT
                             SE.BILL_TO_CUST_CD         V_BILL_TO_CUST_CD
                     ,       SE.SELL_TO_CUST_CD         V_SELL_TO_CUST_CD
                     ,       SE.DPL_STS_CD              V_SE_DPL_STS_CD
                     ,       SE.EMBGO_FLG               V_SE_EMBGO_FLG
                     ,       SE.DPL_RSN_TXT             V_SE_DPL_RSN_TXT
                   FROM
                             SELL_TO_CUST SE
                   WHERE
                             SE.GLBL_CMPY_CD     = #glblCmpyCd#
                        AND     SE.SELL_TO_CUST_CD IN
                    <iterate property="sellCdList" var="sellCd[]" open="(" close=")" conjunction=",">
                        #sellCd[]#
                    </iterate>    
                     AND     SE.EZCANCELFLAG     = '0'
                 )
         SELECT
                     V_BT.V_BILL_TO_CUST_CD     BILL_TO_CUST_CD
                ,    V_BT.V_BT_DPL_STS_CD       BT_DPL_STS_CD
                ,    V_BT.V_BT_EMBGO_FLG        BT_EMBGO_FLG
                ,    V_BT.V_BT_DPL_RSN_TXT      BT_DPL_RSN_TXT
                ,    V_SE.V_SELL_TO_CUST_CD     SELL_TO_CUST_CD
                ,    V_SE.V_SE_DPL_STS_CD       SE_DPL_STS_CD
                ,    V_SE.V_SE_EMBGO_FLG        SE_EMBGO_FLG
                ,    V_SE.V_SE_DPL_RSN_TXT      SE_DPL_RSN_TXT
         FROM
                    VW_BT     V_BT
               ,    VW_SE     V_SE
         WHERE
                   V_BT.V_BILL_TO_CUST_CD = V_SE.V_BILL_TO_CUST_CD(+)
    </statement>


    <statement id="getShipToScreeningData" parameterClass="Map" resultClass="Map">
        SELECT
                 SH.SHIP_TO_CUST_CD     SHIP_TO_CUST_CD
            ,    SH.DPL_STS_CD          DPL_STS_CD
            ,    SH.EMBGO_FLG           EMBGO_FLG
            ,    SH.DPL_RSN_TXT         DPL_RSN_TXT
        FROM
                 SHIP_TO_CUST     SH
        WHERE
                 GLBL_CMPY_CD      = #glblCmpyCd#
            AND  SHIP_TO_CUST_CD IN
                <iterate property="shipToCdList" var="custCd[]" open="(" close=")" conjunction=",">
                    #custCd[]#
                </iterate>
            AND  EZCANCELFLAG      = '0'
    </statement>    
    
    
    <statement id="getHldCnt" parameterClass="Map" resultClass="Integer">    
		SELECT
			    COUNT(H.HLD_PK)
		FROM
			    HLD		H
		WHERE
				H.GLBL_CMPY_CD      	=   #glblCmpyCd#
			AND H.CPO_ORD_NUM			=   #cpoOrdNum#
			AND H.CPO_DTL_LINE_NUM		=   #cpoDtlLineNum#
			AND H.CPO_DTL_LINE_SUB_NUM	=   #cpoDtlLineSubNum#
			AND H.HLD_RSN_CD            =   #hldRsnCd#
			AND H.EZCANCELFLAG      	=   '0'
    </statement>

	<statement id="getHldCtrlOrgList" parameterClass="Map" resultClass="Map">
		SELECT 
			  HCO.HLD_RSN_CD
            , HCO.FIRST_ORG_CD
            , HCO.SCD_ORG_CD
            , HCO.THIRD_ORG_CD
            , HCO.FRTH_ORG_CD
            , HCO.FIFTH_ORG_CD
            , HCO.SIXTH_ORG_CD
            , HCO.SVNTH_ORG_CD
            , HCO.EIGHTH_ORG_CD
            , HCO.TOC_CD 
        FROM
			HLD_CTRL_ORG HCO
			<!-- START ADD M.Ohno [NA_QC#15097] -->
			,HLD_RSN     HR
			<!-- END ADD M.Ohno [NA_QC#15097] -->
		WHERE
				HCO.GLBL_CMPY_CD 		= #glblCmpyCd#
			<!-- START MOD M.Ohno [NA_QC#15097] -->
			<!-- AND HCO.HLD_RSN_CD 		    IN
            <iterate property="hldRsnCdSet" var="hldRsnCd[]" open="(" close=")" conjunction=",">
                    #hldRsnCd[]#
           </iterate>-->
            AND HCO.GLBL_CMPY_CD = HR.GLBL_CMPY_CD
            AND HCO.HLD_RSN_CD   = HR.HLD_RSN_CD
            <isNotEqual	property="validationBatchMode" compareValue="2">
            AND HR.DTM_BAT_FLG      = 'Y'
            </isNotEqual>
            <isEqual	property="validationBatchMode" compareValue="2">
            AND HR.NIGHT_BAT_FLG    = 'Y'
            </isEqual>
            AND HR.EZCANCELFLAG         = '0'

            AND EXISTS(
                        SELECT '1'
                        FROM
                            HLD_CTRL_ORD_SRC HOS
                        WHERE
                                HR.GLBL_CMPY_CD = HOS.GLBL_CMPY_CD
                            AND HR.EZCANCELFLAG = HOS.EZCANCELFLAG
                            AND HR.HLD_RSN_CD   = HOS.HLD_RSN_CD
                        )
            AND EXISTS(
                        SELECT '1'
                        FROM
                            HLD_CTRL_ORD_TP  HOT
                        WHERE
                                HR.GLBL_CMPY_CD = HOT.GLBL_CMPY_CD
                            AND HR.EZCANCELFLAG = HOT.EZCANCELFLAG
                            AND HR.HLD_RSN_CD   = HOT.HLD_RSN_CD
                        )
            AND EXISTS(
                        SELECT '1'
                        FROM
                            DS_HLD_CTRL_ORD_TP DHOT
                        WHERE
                                HR.GLBL_CMPY_CD = DHOT.GLBL_CMPY_CD
                            AND HR.EZCANCELFLAG = DHOT.EZCANCELFLAG
                            AND HR.HLD_RSN_CD   = DHOT.HLD_RSN_CD
                        )
            
            <!-- END MOD M.Ohno [NA_QC#15097] -->
			AND HCO.EZCANCELFLAG       	= '0'
		ORDER BY
			 HCO.HLD_RSN_CD
           , HCO.TOC_CD  				NULLS LAST
           , HCO.EIGHTH_ORG_CD  		NULLS LAST
           , HCO.SVNTH_ORG_CD  			NULLS LAST
           , HCO.SIXTH_ORG_CD  			NULLS LAST
           , HCO.FIFTH_ORG_CD  			NULLS LAST
           , HCO.FRTH_ORG_CD  			NULLS LAST
           , HCO.THIRD_ORG_CD  			NULLS LAST
           , HCO.SCD_ORG_CD  			NULLS LAST
           , HCO.FIRST_ORG_CD  			NULLS LAST
	</statement>           
	
    <!-- QC#13323 -->
    <statement id="cntNotAllLineCredit" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(CD.CPO_ORD_NUM)
        FROM
            CPO_DTL    CD
        WHERE
            CD.GLBL_CMPY_CD             = #glblCmpyCd#
            AND CD.CPO_ORD_NUM          = #cpoOrdNum#
            AND CD.ORD_LINE_STS_CD     != #ordLineStsCancel#
            AND CD.EZCANCELFLAG         = '0'
            AND (CD.CR_REBIL_CD        != #crRebilCd# OR CD.CR_REBIL_CD IS NULL)
    </statement>
</sqlMap>
