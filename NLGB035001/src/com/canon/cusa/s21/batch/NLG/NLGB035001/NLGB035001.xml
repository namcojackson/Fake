<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NLGB035001">

    <statement id="getWmsInbdTrxPod" parameterClass="Map" resultClass="Map">
    SELECT
           WIT.WMS_INBD_TRX_PK
          ,WIT.INTFC_TRX_ID
          ,WIT.WMS_REC_ID
          ,WIT.BOL_NUM
          ,WIT.WMS_CARR_CD
          ,WIT.WMS_SHIP_DT_TM_TS
          ,WIT.WMS_PROC_QTY
          ,WIT.WH_CD
          ,WIT.OTBD_ORD_NUM
          ,WIT.OTBD_ORD_LINE_NUM
      FROM
           WMS_INBD_TRX WIT
     WHERE
           WIT.GLBL_CMPY_CD  = #glblCmpyCd#
       AND WIT.WMS_TASK_CD   = #wmsTaskCd#
       AND WIT.PROC_STS_CD   = #procStsCd#
       <iterate property="wmsTrgtWhCd" var="elem[]" open="AND WIT.WH_CD IN (" close=")" conjunction=",">
       #elem[]#
       </iterate>
       AND WIT.EZCANCELFLAG  = '0'
     ORDER BY
           WIT.BOL_NUM
    </statement>
   <!-- QC#58135 Add -->
   <statement id="getWmsInbdTrxPodforMnx" parameterClass="Map" resultClass="Map">
    SELECT
           WIT.WMS_INBD_TRX_PK
          ,WIT.INTFC_TRX_ID
          ,WIT.WMS_REC_ID
          ,WIT.PRO_NUM AS BOL_NUM
          ,WIT.WMS_CARR_CD
          ,WIT.WMS_SHIP_DT_TM_TS
          ,WIT.WMS_ORD_QTY AS WMS_PROC_QTY
          ,WIT.WH_CD
          ,SOD.SO_NUM AS OTBD_ORD_NUM
          ,SOD.SO_SLP_NUM AS OTBD_ORD_LINE_NUM
      FROM
           WMS_INBD_TRX WIT
          ,PRCH_REQ PR
          ,PRCH_REQ_DTL PRD
          ,SHPG_ORD_DTL SOD
     WHERE
           WIT.GLBL_CMPY_CD  = #glblCmpyCd#
       AND WIT.WMS_TASK_CD   = #wmsTaskCd#
       AND WIT.PROC_STS_CD   = #procStsCd#
       AND EXISTS (
            SELECT
                1
            FROM
                TPL_LOC TL
            WHERE
                TL.GLBL_CMPY_CD = WIT.GLBL_CMPY_CD
            AND TL.TPL_LOC_CD   = WIT.WH_CD
            AND TL.EZCANCELFLAG = '0'
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                     RTL_WH RW
                    ,WMS_WH WW
                WHERE
                    RW.GLBL_CMPY_CD = TL.GLBL_CMPY_CD
                AND RW.RTL_WH_CD    = TL.TPL_LOC_CD
                AND RW.EZCANCELFLAG = '0'
                AND RW.GLBL_CMPY_CD = WW.GLBL_CMPY_CD
                AND RW.WMS_WH_CD    = WW.WH_CD
                AND WW.EZCANCELFLAG = '0'
            )
       )
       AND WIT.GLBL_CMPY_CD          = PR.GLBL_CMPY_CD
       AND WIT.OTBD_ORD_NUM          = PR.TRX_REF_NUM
       <!-- START 2022/05/05 R.Azucena [QC#60002, ADD] -->
       AND WIT.WMS_MDSE_CD           = SOD.MDSE_CD
       <!-- END 2022/05/05 R.Azucena [QC#60002, ADD] -->
       AND PR.GLBL_CMPY_CD           = PRD.GLBL_CMPY_CD
       AND PR.PRCH_REQ_NUM           = PRD.PRCH_REQ_NUM
       AND PRD.PRO_NUM               = WIT.PRO_NUM
       AND PRD.SO_NUM                IS NOT NULL
       AND PRD.GLBL_CMPY_CD          = SOD.GLBL_CMPY_CD
       AND PRD.PRCH_REQ_NUM          = SOD.PRCH_REQ_NUM
       ANd PRD.PRCH_REQ_LINE_NUM     = SOD.PRCH_REQ_LINE_NUM
       AND PRD.PRCH_REQ_LINE_SUB_NUM = SOD.PRCH_REQ_LINE_SUB_NUM
       <iterate property="shpgStsCdList" var="elem[]" open="AND SOD.SHPG_STS_CD IN(" close=")" conjunction=",">
            #elem[]#
       </iterate>
       AND PR.EZCANCELFLAG           = '0'
       AND PRD.EZCANCELFLAG          = '0'
       AND SOD.EZCANCELFLAG          = '0'
       AND WIT.EZCANCELFLAG          = '0'
       UNION ALL
       SELECT
           WIT.WMS_INBD_TRX_PK
          ,WIT.INTFC_TRX_ID
          ,WIT.WMS_REC_ID
          ,WIT.PRO_NUM AS BOL_NUM
          ,WIT.WMS_CARR_CD
          ,WIT.WMS_SHIP_DT_TM_TS
          ,WIT.WMS_ORD_QTY AS WMS_PROC_QTY
          ,WIT.WH_CD
          ,SOD.SO_NUM AS OTBD_ORD_NUM
          ,SOD.SO_SLP_NUM AS OTBD_ORD_LINE_NUM
      FROM
           WMS_INBD_TRX WIT
          ,SHPG_ORD_DTL SOD
     WHERE
           WIT.GLBL_CMPY_CD  = 'ADB'
       AND WIT.WMS_TASK_CD   = 'POD'
       AND WIT.PROC_STS_CD   = '0'
       AND EXISTS (
            SELECT
                1
            FROM
                TPL_LOC TL
            WHERE
                TL.GLBL_CMPY_CD = WIT.GLBL_CMPY_CD
            AND TL.TPL_LOC_CD   = WIT.WH_CD
            AND TL.EZCANCELFLAG = '0'
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                     RTL_WH RW
                    ,WMS_WH WW
                WHERE
                    RW.GLBL_CMPY_CD = TL.GLBL_CMPY_CD
                AND RW.RTL_WH_CD    = TL.TPL_LOC_CD
                AND RW.EZCANCELFLAG = '0'
                AND RW.GLBL_CMPY_CD = WW.GLBL_CMPY_CD
                AND RW.WMS_WH_CD    = WW.WH_CD
                AND WW.EZCANCELFLAG = '0'
            )
       )
       AND WIT.GLBL_CMPY_CD          = SOD.GLBL_CMPY_CD
       AND WIT.OTBD_ORD_NUM          = SOD.SO_NUM
       <!-- START 2022/05/05 R.Azucena [QC#60002, ADD] -->
       AND WIT.WMS_MDSE_CD           = SOD.MDSE_CD
       <!-- END 2022/05/05 R.Azucena [QC#60002, ADD] -->
       <iterate property="shpgStsCdList" var="elem[]" open="AND SOD.SHPG_STS_CD IN(" close=")" conjunction=",">
            #elem[]#
       </iterate>
       AND SOD.EZCANCELFLAG          = '0'
       AND WIT.EZCANCELFLAG          = '0'
       UNION ALL
       SELECT
           WIT.WMS_INBD_TRX_PK
          ,WIT.INTFC_TRX_ID
          ,WIT.WMS_REC_ID
          ,WIT.PRO_NUM AS BOL_NUM
          ,WIT.WMS_CARR_CD
          ,WIT.WMS_SHIP_DT_TM_TS
          ,WIT.WMS_ORD_QTY AS WMS_PROC_QTY
          ,WIT.WH_CD
          ,SOD.SO_NUM AS OTBD_ORD_NUM
          ,SOD.SO_SLP_NUM AS OTBD_ORD_LINE_NUM
      FROM
           WMS_INBD_TRX WIT
          ,PRCH_REQ PR
          ,PRCH_REQ_DTL PRD
          ,SHPG_ORD_DTL SOD
     WHERE
           WIT.GLBL_CMPY_CD  = #glblCmpyCd#
       AND WIT.WMS_TASK_CD   = #wmsTaskCd#
       AND WIT.PROC_STS_CD   = #procStsCd#
       AND EXISTS (
            SELECT
                1
            FROM
                TPL_LOC TL
            WHERE
                TL.GLBL_CMPY_CD = WIT.GLBL_CMPY_CD
            AND TL.TPL_LOC_CD   = WIT.WH_CD
            AND TL.EZCANCELFLAG = '0'
            AND NOT EXISTS (
                SELECT
                    1
                FROM
                     RTL_WH RW
                    ,WMS_WH WW
                WHERE
                    RW.GLBL_CMPY_CD = TL.GLBL_CMPY_CD
                AND RW.RTL_WH_CD    = TL.TPL_LOC_CD
                AND RW.EZCANCELFLAG = '0'
                AND RW.GLBL_CMPY_CD = WW.GLBL_CMPY_CD
                AND RW.WMS_WH_CD    = WW.WH_CD
                AND WW.EZCANCELFLAG = '0'
            )
       )
       AND WIT.GLBL_CMPY_CD          = PR.GLBL_CMPY_CD
       AND WIT.OTBD_ORD_NUM          = PR.PRCH_REQ_NUM
       <!-- START 2022/05/05 R.Azucena [QC#60002, ADD] -->
       AND WIT.WMS_MDSE_CD           = SOD.MDSE_CD
       <!-- END 2022/05/05 R.Azucena [QC#60002, ADD] -->
       AND PR.GLBL_CMPY_CD           = PRD.GLBL_CMPY_CD
       AND PR.PRCH_REQ_NUM           = PRD.PRCH_REQ_NUM
       AND PRD.PRO_NUM               = WIT.PRO_NUM
       AND PRD.SO_NUM                IS NOT NULL
       AND PRD.GLBL_CMPY_CD          = SOD.GLBL_CMPY_CD
       AND PRD.PRCH_REQ_NUM          = SOD.PRCH_REQ_NUM
       ANd PRD.PRCH_REQ_LINE_NUM     = SOD.PRCH_REQ_LINE_NUM
       AND PRD.PRCH_REQ_LINE_SUB_NUM = SOD.PRCH_REQ_LINE_SUB_NUM
       <iterate property="shpgStsCdList" var="elem[]" open="AND SOD.SHPG_STS_CD IN(" close=")" conjunction=",">
            #elem[]#
       </iterate>
       AND PR.EZCANCELFLAG           = '0'
       AND PRD.EZCANCELFLAG          = '0'
       AND SOD.EZCANCELFLAG          = '0'
       AND WIT.EZCANCELFLAG          = '0'
     ORDER BY
           BOL_NUM
    </statement>

</sqlMap>
