<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NPAB136001">
    <statement id="getTargetPrNumList" parameterClass="Map" resultClass="Map">
        SELECT
            DISTINCT PR.PRCH_REQ_CRAT_DISP_DT_TM_TS
                    ,PR.PRCH_REQ_NUM
        FROM
             PRCH_REQ PR
            ,PRCH_REQ_DTL PRD
            ,PRCH_REQ_APVL_STS PRAS
            ,MDSE DMI
            ,MDSE_ITEM_STS MIS
            ,RTL_WH RW
        WHERE
                PR.GLBL_CMPY_CD = #glblCmpyCd#
            AND PR.EZCANCELFLAG = '0'
            AND PR.PRCH_REQ_STS_CD = #prchReqStsCd#
            AND PR.GLBL_CMPY_CD = PRD.GLBL_CMPY_CD
            AND PR.PRCH_REQ_NUM = PRD.PRCH_REQ_NUM
            AND PRD.EZCANCELFLAG = '0'
            AND PRD.PRCH_REQ_LINE_SUB_NUM = 0
            AND PRD.PRCH_REQ_LINE_STS_CD IN (#open#, #awaitingShipping#, #partiallyShipped#, #partiallyReceived#)
            AND PRD.PRCH_REQ_REL_STS_CD IN (#prchReqRelStsNc#, #prchReqRelStsErr#)
            AND PR.GLBL_CMPY_CD = PRAS.GLBL_CMPY_CD
            AND PR.PRCH_REQ_APVL_STS_CD = PRAS.PRCH_REQ_APVL_STS_CD
            AND PRAS.EZCANCELFLAG = '0'
            AND PRAS.PRCH_REQ_APVL_FLG = #prchReqApvlFlgYes#
            AND PRD.GLBL_CMPY_CD = DMI.GLBL_CMPY_CD
            AND PRD.MDSE_CD = DMI.MDSE_CD
            AND DMI.EZCANCELFLAG = '0'
            AND DMI.GLBL_CMPY_CD = MIS.GLBL_CMPY_CD
            AND DMI.MDSE_ITEM_STS_CD = MIS.MDSE_ITEM_STS_CD
            AND MIS.EZCANCELFLAG = '0'
            AND PRD.GLBL_CMPY_CD = RW.GLBL_CMPY_CD
            AND PRD.DEST_RTL_WH_CD = RW.RTL_WH_CD
            AND RW.EZCANCELFLAG = '0'
            AND EXISTS
                (
                    SELECT
                        1
                    FROM
                        INSRC_RULE
                    WHERE
                            GLBL_CMPY_CD = PR.GLBL_CMPY_CD
                        AND PRCH_REQ_REC_TP_CD = PR.PRCH_REQ_REC_TP_CD
                        AND PROCR_TP_CD = PRD.PROCR_TP_CD
                        AND EZCANCELFLAG = '0'
                )
        ORDER BY
             PR.PRCH_REQ_CRAT_DISP_DT_TM_TS
            ,PR.PRCH_REQ_NUM
    </statement>

    <statement id="getPRList" parameterClass="Map" resultClass="Map">
        SELECT
            PR.PRCH_REQ_NUM
            ,PR.PRCH_REQ_REC_TP_CD
            ,PR.PRCH_REQ_TP_CD
            ,PR.PRCH_REQ_STS_CD
            ,PR.PRCH_REQ_CRAT_DT
            ,PR.PRCH_REQ_CRAT_TM
            ,PR.PRCH_REQ_CRAT_TZ
            ,PR.PRCH_REQ_CRAT_DISP_DT_TM_TS
            ,PR.PRCH_REQ_CRAT_BY_PSN_CD
            ,PR.PRCH_REQ_CRAT_BY_NM
            ,PR.PRCH_REQ_RQST_BY_PSN_CD
            ,PR.PRCH_REQ_SRC_TP_CD
            ,PR.FSR_NUM
            ,PR.SVC_TASK_NUM
            ,PR.SVC_MACH_SER_NUM
            ,PR.CPO_ORD_NUM
            ,PR.CUST_ISS_PO_NUM
            ,PR.CUST_ISS_PO_DT
            ,PR.CPO_ORD_TP_CD
            ,PR.CTAC_PSN_NM
            ,PR.ADMIN_PSN_CD
            ,PR.PRCH_REQ_APVL_STS_CD
            ,PR.PRCH_REQ_APVL_DT
            ,PR.PRCH_REQ_APVL_BY_PSN_CD
            ,PR.PRCH_REQ_APVL_BY_NM
            ,PR.RQST_TECH_TOC_CD
            ,PR.SHIP_TO_CUST_CD
            ,PR.SHIP_TO_LOC_NM
            ,PR.SHIP_TO_ADDL_LOC_NM
            ,PR.SHIP_TO_FIRST_LINE_ADDR
            ,PR.SHIP_TO_SCD_LINE_ADDR
            ,PR.SHIP_TO_THIRD_LINE_ADDR
            ,PR.SHIP_TO_FRTH_LINE_ADDR
            ,PR.SHIP_TO_FIRST_REF_CMNT_TXT
            ,PR.SHIP_TO_SCD_REF_CMNT_TXT
            ,PR.SHIP_TO_CTY_ADDR
            ,PR.SHIP_TO_ST_CD
            ,PR.SHIP_TO_PROV_NM
            ,PR.SHIP_TO_CNTY_NM
            ,PR.SHIP_TO_POST_CD
            ,PR.SHIP_TO_CTRY_CD
            ,PR.BILL_TO_CUST_CD
            ,PR.SELL_TO_CUST_CD
            ,PR.ASL_SHIP_TO_CUST_CD
            ,PR.PO_QLFY_CD
            ,PR.VND_DROP_SHIP_FLG
            ,PR.PRCH_REQ_CMNT_TXT
            ,PR.SPCL_INSTN_CMNT_TXT
            ,PR.DELY_ADDL_CMNT_TXT
            ,PR.RCV_ADDL_CMNT_TXT
            ,PRD.PRCH_REQ_LINE_NUM
            ,PRD.PRCH_REQ_LINE_SUB_NUM
            ,PRD.PRCH_REQ_INTFC_PK
            ,PRD.ORIG_PRCH_REQ_LINE_NUM
            ,PRD.ORIG_PRCH_REQ_LINE_SUB_NUM
            ,PRD.PRCH_REQ_LINE_TP_CD
            ,PRD.PRCH_REQ_LINE_STS_CD
            ,PRD.RQST_RCV_DT
            ,PRD.RQST_RCV_TM
            ,PRD.RQST_RCV_TZ
            ,PRD.RQST_RCV_DISP_DT_TM_TS
            ,PRD.PO_SCHD_REL_DT
            ,PRD.PRCH_REQ_REL_STS_CD
            ,PRD.PRCH_REQ_REL_DT_TM_TS
            ,PRD.PRCH_REQ_REL_ERR_MSG_TXT
            ,PRD.PRCH_REQ_FRZ_FLG
            ,PRD.SHPG_PLN_NUM
            ,PRD.SHIP_FROM_SO_NUM
            ,PRD.PROCR_TP_CD
            ,PRD.DEST_INVTY_LOC_CD
            ,PRD.DEST_RTL_WH_CD
            ,PRD.DEST_RTL_SWH_CD
            ,PRD.SRC_INVTY_LOC_CD
            ,PRD.SRC_RTL_WH_CD
            ,PRD.SRC_RTL_SWH_CD
            ,PRD.PRNT_VND_CD
            ,PRD.VND_CD
            ,PRD.VND_INVTY_LOC_CD
            ,PRD.SHPG_SVC_LVL_CD
            ,PRD.CARR_CD
            ,PRD.CARR_ACCT_NUM
            ,PRD.CONFIG_TP_CD
            ,PRD.SVC_CONFIG_MSTR_PK
            ,PRD.MDSE_CD
            ,PRD.PO_MDSE_CMPSN_TP_CD
            ,PRD.ORIG_RQST_MDSE_CD
            ,PRD.ASL_MDSE_CD
            ,PRD.PRCH_REQ_QTY
            ,PRD.ORD_QTY
            ,PRD.CUST_UOM_CD
            ,PRD.PRCH_REQ_DISP_QTY
            ,PRD.PRCH_REQ_DSPL_UOM_CD
            ,PRD.PRCH_REQ_REL_QTY
            ,PRD.PRCH_REQ_BAL_QTY
            ,PRD.PRCH_REQ_INSRC_QTY
            ,PRD.PRCH_REQ_CANC_QTY
            ,PRD.ROP_QTY
            ,PRD.MIN_ORD_QTY
            ,PRD.INCR_ORD_QTY
            ,PRD.MAX_INVTY_QTY
            ,PRD.CUR_INVTY_QTY
            ,PRD.CUR_INVTY_AVAL_QTY
            ,PRD.SCHD_INBD_QTY
            ,PRD.SCHD_OTBD_QTY
            ,PRD.INSRC_FLG
            ,PRD.PO_CRAT_FLG
            ,PRD.REL_RQST_TO_PO_ORD_NUM
            ,PRD.PO_ORD_NUM
            ,PRD.PO_ORD_DTL_LINE_NUM
            ,PRD.INVTY_ORD_NUM
            ,PRD.INVTY_ORD_LINE_NUM
            ,PRD.WRK_ORD_NUM
            ,PRD.WRK_ORD_DTL_LINE_NUM
            ,PRD.TRX_REF_NUM
            ,PRD.TRX_REF_LINE_NUM
            ,PRD.TRX_REF_LINE_SUB_NUM
            ,PRD.PRCH_REQ_LINE_CMNT_TXT
            ,PRD.BO_EML_PROC_STS_CD
            ,PRD.SO_NUM
            ,PRD.PRO_NUM
            ,PRD.SHIP_DT_TM_TS
            ,PRD.SHIP_QTY
            ,PRD.RWS_NUM
            ,PRD.RWS_CLO_DT_TM_TS
            ,PRD.RWS_PUT_AWAY_QTY
            ,PRD.BACK_TO_TECH_QTY
            ,PRD.FROM_STK_STS_CD
            ,PRD.TO_STK_STS_CD
            ,PRD.THIS_MTH_FOB_COST_AMT
            ,PRD.ASL_DTL_PK
            ,PRD.ASL_UNIT_PRC_AMT
            ,PRD.ENT_DEAL_NET_UNIT_PRC_AMT
            ,PRD.ENT_PO_DTL_DEAL_NET_AMT
            ,PRD.ENT_FUNC_NET_UNIT_PRC_AMT
            ,PRD.ENT_PO_DTL_FUNC_NET_AMT
            ,PRD.CCY_CD
            ,PRD.EXCH_RATE
            ,PRD.FRT_CHRG_TO_CD
            ,PRD.FRT_CHRG_METH_CD
            ,PRD.FRT_COND_CD
            ,PRD.VND_PMT_TERM_CD
            ,PRD.VND_PMT_TERM_DESC_TXT
            ,PRD.COA_CMPY_CD
            ,PRD.COA_AFFL_CD
            ,PRD.COA_BR_CD
            ,PRD.COA_CH_CD
            ,PRD.COA_CC_CD
            ,PRD.COA_ACCT_CD
            ,PRD.COA_PROJ_CD
            ,PRD.COA_EXTN_CD
            ,PRD.COA_PROD_CD
            ,PRD.TECH_RQST_NTC_ML_PROC_CD
            ,PRD.TECH_RTN_NTC_ML_PROC_CD
            ,PRD.VND_RTRN_RSN_CD
            ,DMI.MDSE_ITEM_CLS_TP_CD
            ,DMI.PRCH_GRP_CD
            ,MIS.PRCH_AVAL_FLG
            ,RW.LOC_TP_CD
            ,RW.RTL_WH_CATG_CD
            ,SP.LINE_BIZ_TP_CD
            <!-- QC#57659 Add Start -->
            ,SP.EML_ADDR
            ,PRD.PRCH_REQ_CRAT_DT AS DTL_PRCH_REQ_CRAT_DT
            ,PRD.PRCH_REQ_CRAT_TM AS DTL_PRCH_REQ_CRAT_TM
            <!-- QC#57659 Add End -->
        FROM
            PRCH_REQ PR
            ,PRCH_REQ_DTL PRD
            ,PRCH_REQ_APVL_STS PRAS
            ,MDSE DMI
            ,MDSE_ITEM_STS MIS
            ,RTL_WH RW
            ,S21_PSN SP
        WHERE
                PR.GLBL_CMPY_CD = #glblCmpyCd#
            AND PR.PRCH_REQ_NUM = #prNum#
            AND PR.EZCANCELFLAG = '0'
            AND PR.PRCH_REQ_STS_CD = #prchReqStsCd#
            AND PR.GLBL_CMPY_CD = PRD.GLBL_CMPY_CD
            AND PR.PRCH_REQ_NUM = PRD.PRCH_REQ_NUM
            AND PRD.EZCANCELFLAG = '0'
            AND PRD.PRCH_REQ_LINE_SUB_NUM = 0
            AND PRD.PRCH_REQ_LINE_STS_CD IN (#open#, #awaitingShipping#, #partiallyShipped#, #partiallyReceived#)
            AND PRD.PRCH_REQ_REL_STS_CD IN (#prchReqRelStsNc#, #prchReqRelStsErr#)
            AND PR.GLBL_CMPY_CD = PRAS.GLBL_CMPY_CD
            AND PR.PRCH_REQ_APVL_STS_CD = PRAS.PRCH_REQ_APVL_STS_CD
            AND PRAS.EZCANCELFLAG = '0'
            AND PRAS.PRCH_REQ_APVL_FLG = #prchReqApvlFlgYes#
            AND PRD.GLBL_CMPY_CD = DMI.GLBL_CMPY_CD
            AND PRD.MDSE_CD = DMI.MDSE_CD
            AND DMI.EZCANCELFLAG = '0'
            AND DMI.GLBL_CMPY_CD = MIS.GLBL_CMPY_CD
            AND DMI.MDSE_ITEM_STS_CD = MIS.MDSE_ITEM_STS_CD
            AND MIS.EZCANCELFLAG = '0'
            AND PRD.GLBL_CMPY_CD = RW.GLBL_CMPY_CD
            AND PRD.DEST_RTL_WH_CD = RW.RTL_WH_CD
            AND RW.EZCANCELFLAG = '0'
            AND PR.GLBL_CMPY_CD = SP.GLBL_CMPY_CD(+)
            AND PR.RQST_TECH_TOC_CD = SP.PSN_CD(+)
            AND SP.EZCANCELFLAG(+) = '0'
            AND EXISTS
                (
                    SELECT
                        1
                    FROM
                        INSRC_RULE
                    WHERE
                            GLBL_CMPY_CD = PR.GLBL_CMPY_CD
                        AND PRCH_REQ_REC_TP_CD = PR.PRCH_REQ_REC_TP_CD
                        AND PROCR_TP_CD = PRD.PROCR_TP_CD
                        AND EZCANCELFLAG = '0'
                )
        ORDER BY
            PRD.RQST_RCV_DT
            ,PRD.RQST_RCV_TM
            ,PRD.PRCH_REQ_NUM
            ,PRD.PRCH_REQ_LINE_NUM
    </statement>
    <!-- 08/29/2017 CITS S.Endo Mod Sol#406(QC#19243) START -->
    <statement id="getInsourcingRule" parameterClass="Map" resultClass="Map">
        SELECT
            INSRC_RULE_NM
            ,INSRC_RULE_DTL_NUM
            ,PRCH_REQ_REC_TP_CD
            ,PRCH_REQ_TP_CD
            ,PROCR_TP_CD
            ,PRCH_REQ_SRC_TP_CD
            ,DEST_LOC_TP_CD
            ,DEST_RTL_WH_CATG_CD
            ,TECH_LINE_BIZ_TP_CD
            ,DEST_INVTY_LOC_CD
            ,WH_CUT_OFF_TM_APPLY_FLG
            ,INSRC_PRTY_NUM
            ,MDSE_ITEM_CLS_TP_CD
        FROM
            INSRC_RULE
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND EZCANCELFLAG = '0'
        ORDER BY
            PRCH_REQ_REC_TP_CD
           ,PRCH_REQ_TP_CD
           ,PROCR_TP_CD
           ,MDSE_ITEM_CLS_TP_CD
    </statement>

    <!-- 08/23/2018 Update. Add FRZ_REF_CMNT_TXT -->
    <statement id="getInsourcingRuleDetail" parameterClass="Map" resultClass="Map">
        SELECT
            INSRC_RULE_DTL_NUM
            ,INSRC_RULE_DTL_NM
            ,SRCH_SRC_WH_FLG
            ,SRCH_INSRC_PLN_FLG
            ,SRCH_CUSA_INVTY_FLG
            ,SRCH_CVI_INVTY_FLG
            ,SRCH_WH_OWNR_INVTY_FLG
            ,SRCH_WH_OWNR_CD
            ,WH_OWNR_DUMMY_INVTY_LOC_CD
            ,SRCH_SPEC_LOC_INVTY_FLG
            ,SRCH_SPEC_INVTY_LOC_CD
            ,CRAT_PO_FLG
            ,PRCH_REQ_APVL_STS_CD
            ,PRCH_REQ_TP_CD
            ,SRCH_ORIG_ITEM_FLG
            ,SRCH_SUPD_ITEM_FLG
            ,SRCH_MDSE_ITEM_RELN_TP_CD
            ,PROCR_TP_CD
            ,PRCH_REQ_LINE_TP_CD
            ,ORIG_LINE_FRZ_FLG
            ,BO_NTFY_REQ_FLG
            ,WH_TRNSF_BO_REQ_FLG
            ,BO_SRC_RTL_WH_CD
            ,BO_SRC_RTL_SWH_CD
            ,FRZ_REF_CMNT_TXT
            ,SRCH_STLT_INVTY_FLG
            <!-- QC#61128 Add start -->
            ,SRCH_THIRD_PTY_INVTY_FLG
            ,SRCH_ORCL_INVTY_FLG
            <!-- QC#61128 Add End -->
        FROM
            INSRC_RULE_DTL
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND EZCANCELFLAG = '0'
            AND INSRC_RULE_DTL_NUM = #insrcRuleDtlNum#
        ORDER BY
            INSRC_DTL_PRTY_NUM
    </statement>
    <!-- 08/29/2017 CITS S.Endo Mod Sol#406(QC#19243) END -->
    <statement id="getRelnMdseCd" parameterClass="Map" resultClass="Map">
        SELECT
            RELN_MDSE_CD
        FROM
            MDSE_ITEM_FLIP_SET
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND EZCANCELFLAG = '0'
            AND MDSE_CD = #mdseCd#
            AND MDSE_ITEM_RELN_TP_CD = #srchMdseItemRelnTpCd#
        ORDER BY
            RELN_MDSE_CD
    </statement>

    <statement id="getMdseCd" parameterClass="Map" resultClass="Map">
        SELECT
            MDSE_CD
        FROM
            MDSE_ITEM_FLIP_SET
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND EZCANCELFLAG = '0'
            AND RELN_MDSE_CD = #relnMdseCd#
            AND MDSE_ITEM_RELN_TP_CD = #srchMdseItemRelnTpCd#
        ORDER BY
            MDSE_CD
    </statement>

    <statement id="getAvalWhInvty" parameterClass="Map" resultClass="Map">
        SELECT
            INVTY_AVAL_QTY
        FROM
            INVTY
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND EZCANCELFLAG = '0'
            AND MDSE_CD = #mdseCd#
            AND INVTY_LOC_CD = #invtyLocCd#
            AND LOC_STS_CD = #locStsCd#
            AND STK_STS_CD = #stkStsCd#
            AND INVTY_AVAL_QTY &gt; 0
    </statement>

    <!-- QC#57659 Mod start -->
    <statement id="getAvalWhOwnerInvty" parameterClass="Map" resultClass="Map">
        SELECT
            NVL (SUM (INVTY_AVAL_QTY), 0) AS INVTY_AVAL_QTY
        FROM
        (
            SELECT
                SUM (IV.INVTY_AVAL_QTY) AS INVTY_AVAL_QTY
            FROM
                INVTY IV
                ,DS_INVTY_LOC_V DILV
                ,RTL_WH RW
            WHERE
                    IV.GLBL_CMPY_CD = #glblCmpyCd#
                AND IV.EZCANCELFLAG = '0'
                AND IV.MDSE_CD = #mdseCd#
                AND IV.LOC_STS_CD = #locStsCd#
                AND IV.STK_STS_CD = #stkStsCd#
                AND IV.LOC_TP_CD = #locTpCd#
                AND IV.GLBL_CMPY_CD = DILV.GLBL_CMPY_CD
                AND DILV.EZCANCELFLAG = '0'
                AND IV.INVTY_LOC_CD = DILV.INVTY_LOC_CD
                AND DILV.GLBL_CMPY_CD = RW.GLBL_CMPY_CD
                AND DILV.RTL_WH_CD = RW.RTL_WH_CD
                AND RW.EZCANCELFLAG = '0'
                AND RW.WH_OWNR_CD = #whOwnrCd#
            GROUP BY
                IV.MDSE_CD
                ,IV.LOC_STS_CD
                ,IV.STK_STS_CD
                ,IV.LOC_TP_CD
            HAVING
                SUM (IV.INVTY_AVAL_QTY)  &gt;= 1
        )
    </statement>
   <!-- QC#57659 Mod end -->

    <statement id="countVarcharConstTable" parameterClass="Map" resultClass="Map">
        SELECT
            COUNT(1) AS CNT
        FROM
            VAR_CHAR_CONST
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND EZCANCELFLAG = '0'
            AND VAR_CHAR_CONST_NM LIKE #varCharConstNm#
            AND VAR_CHAR_CONST_VAL = #varCharConstVal#
    </statement>

    <statement id="getInsourcingPlanning" parameterClass="Map" resultClass="Map">
        SELECT
            IZP.TO_RTL_WH_CD
            ,IZP.MDSE_ITEM_CLS_TP_CD
            ,RW.WH_CUT_OFF_TM
            ,RW.PLN_ITEM_INSRC_CD
            ,RW.POST_CD
            ,RW.CTRY_CD
            ,WO.INSRC_PRCH_REQ_LINE_TP_CD
            ,NVL(MI.ROP_QTY, 0) AS ROP_QTY
            ,NVL(MI.MAX_INVTY_QTY, 0) AS MAX_INVTY_QTY
        FROM
             INSRC_ZN_PLN IZP
            ,RTL_WH RW
            ,WH_OWNR WO
            ,MRP_INFO MI
            ,ALL_MDSE_V AMV
        WHERE
                IZP.GLBL_CMPY_CD = #glblCmpyCd#
            AND IZP.EZCANCELFLAG = '0'
            AND IZP.INSRC_ENBL_FLG = #insrcEnblFlg#
            AND IZP.FROM_RTL_WH_CD = #fromRtlWhCd#
            <isNotNull property="mdseItemClsTpCd">
                AND IZP.MDSE_ITEM_CLS_TP_CD = #mdseItemClsTpCd#
            </isNotNull>
            AND IZP.GLBL_CMPY_CD = RW.GLBL_CMPY_CD
            AND IZP.TO_RTL_WH_CD = RW.RTL_WH_CD
            AND RW.EZCANCELFLAG = '0'
            AND RW.GLBL_CMPY_CD = WO.GLBL_CMPY_CD
            AND RW.WH_OWNR_CD = WO.WH_OWNR_CD
            AND WO.EZCANCELFLAG = '0'
            AND IZP.GLBL_CMPY_CD = MI.GLBL_CMPY_CD(+)
            AND IZP.TO_RTL_WH_CD || #srcRtlSwhCd# = MI.INVTY_LOC_CD(+)
            AND MI.EZCANCELFLAG(+) = '0'
            AND MI.MDSE_CD(+) = #mdseCd#
            AND MI.MRP_ENBL_FLG(+) = #mrpEnblFlg#
            <!-- 10/03/2023 QC#61703 Start -->
            AND MI.MRP_INFO_RGTN_STS_CD(+) = #rgtnStsCd#
            <!-- 10/03/2023 QC#61703 Start -->
            AND IZP.GLBL_CMPY_CD = AMV.GLBL_CMPY_CD
            AND AMV.MDSE_CD = #mdseCd#
            AND IZP.INSRC_ITEM_PRC_THRHD_AMT &lt;= AMV.THIS_MTH_TOT_STD_COST_AMT
            <!-- QC#61128 Add start -->
            AND IZP.PRCH_REQ_TP_CD = #prchReqTpCd#
            <!-- QC#61128 Add end -->
        ORDER BY
            IZP.INSRC_RNK_SORT_NUM
    </statement>

    <statement id="getVndCcyCd" parameterClass="Map" resultClass="Map">
        SELECT
            V.DEAL_CCY_CD
        FROM
            VND V
        WHERE
                V.GLBL_CMPY_CD = #glblCmpyCd#
            AND V.VND_CD       = #vndCd#
            AND V.EZCANCELFLAG = '0'
    </statement>

    <statement id="getCurrentMaxPrchReqLineSubNum" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            NVL(MAX(P.PRCH_REQ_LINE_SUB_NUM), 0) AS PRCH_REQ_LINE_SUB_NUM
        FROM
            PRCH_REQ_DTL P
        WHERE
            P.GLBL_CMPY_CD = #glblCmpyCd#
            AND P.PRCH_REQ_NUM = #prNum#
            AND P.PRCH_REQ_LINE_NUM = #prchReqLineNum#
    </statement>
    

    <statement id="getPrtyLocCd" parameterClass="Map" resultClass="Map">
        SELECT
            INVTY_LOC_CD
        FROM
            RTL_SWH
        WHERE
                GLBL_CMPY_CD = #glblCmpyCd#
            AND EZCANCELFLAG = '0'
            AND RTL_WH_CD    = #toRtlWhCd#
            AND PRTY_LOC_FLG = #prtyLocFlg#
    </statement>

    <statement id="getVendorSystemType" parameterClass="Map" resultClass="Map">
        SELECT
            RAV.VND_SYS_TP_CD
        FROM
            RCV_ASN_VND RAV
        WHERE 1=1
        AND RAV.GLBL_CMPY_CD   = #glblCmpyCd#
        AND RAV.RCV_ASN_VND_CD = #vndCd#
        AND RAV.EZCANCELFLAG   = '0'
    </statement>

    <!-- QC#2366 Add SQL -->
    <statement id="countHazmatItem" parameterClass="Map" resultClass="Map">
        SELECT
            COUNT(*) CNT
        FROM
            MDSE_SFTY_INFO MSI
        WHERE
            MSI.GLBL_CMPY_CD = #glblCmpyCd#
        <iterate property="mdseCdList" var="mdseCdList[]" open="AND MSI.MDSE_CD IN (" close=")" conjunction=",">
            #mdseCdList[]#
        </iterate>
        AND MSI.HAZ_MAT_FLG  = #flgOnY#
        AND MSI.EZCANCELFLAG = '0'
    </statement>

    <!-- QC#2366 Add SQL -->
    <statement id="getHazmatItemSSL" parameterClass="Map" resultClass="Map">
        SELECT
              MSI.MDSE_CD
             ,MSI.HAZ_MAT_FLG
             ,HM.HAZ_MAT_CD
             ,HM.SHPG_SVC_LVL_CD
        FROM
             MDSE_SFTY_INFO MSI
            ,HAZ_MAT HM
        WHERE
            MSI.GLBL_CMPY_CD    = #glblCmpyCd#
        AND MSI.MDSE_CD         = #mdseCd#
        AND MSI.HAZ_MAT_FLG     = #flgOnY#
        AND MSI.EZCANCELFLAG    = '0'
        AND HM.GLBL_CMPY_CD(+)  = MSI.GLBL_CMPY_CD
        AND HM.HAZ_MAT_CD(+)    = MSI.HAZ_MAT_CD
        AND HM.EZCANCELFLAG(+)  = '0'
    </statement>

    <!-- QC#2366 Add SQL -->
    <statement id="getWhOwnrCd" parameterClass="Map" resultClass="Map">
        SELECt
            RW.WH_OWNR_CD
        FROM
            RTL_WH RW
        WHERE
            RW.GLBL_CMPY_CD = #glblCmpyCd#
        AND RW.RTL_WH_CD    = #rtlWhCd#
        AND RW.EZCANCELFLAG = '0'
    </statement>

    <!-- QC#2366 Add SQL -->
    <statement id="getCarrCdForWillCall" parameterClass="Map" resultClass="String">
        SELECT
             SLC.CARR_CD
        FROM
             SHPG_SVC_LVL_CARR_RELN SLC
        WHERE
            SLC.GLBL_CMPY_CD    = #glblCmpyCd#
        AND SLC.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
        AND SLC.EZCANCELFLAG    = '0'
    </statement>

    <!-- QC#2366 Add SQL -->
    <statement id="checkSpgSvcCarrReln" parameterClass="Map" resultClass="Integer">
        SELECT
             COUNT(*) CNT
        FROM
             SHPG_SVC_LVL_CARR_RELN SLC
        WHERE
            SLC.GLBL_CMPY_CD    = #glblCmpyCd#
        AND SLC.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
        AND SLC.CARR_CD         = #carrCd#
        AND SLC.EZCANCELFLAG    = '0'
    </statement>

    <!-- 2018/05/22 QC#2366 ADD SQL -->
    <statement id="getShipToCustPkForNotTech" parameterClass="Map" resultClass="BigDecimal">
        SELECT
              STC.SHIP_TO_CUST_PK
        FROM
            SHIP_TO_CUST STC
        WHERE
            STC.GLBL_CMPY_CD    = #glblCmpyCd#
        AND STC.SHIP_TO_CUST_CD = #shipToCustCd#
        AND STC.LOC_GRP_CD      != #locGrpTech#
        AND STC.RGTN_STS_CD     = #rgtnOrderTaking#
        AND STC.EZCANCELFLAG    = '0'
    </statement>

    <!-- 2018/05/22 QC#2366 ADD SQL -->
    <statement id="getPreferredCarrierFedexForWh" parameterClass="Map" resultClass="String">
        SELECT
              RW.PRF_CARR_CD
        FROM
             RTL_WH RW
            ,VND V
            ,VND_TP_RELN VTR
        WHERE
            RW.GLBL_CMPY_CD    = #glblCmpyCd#
        AND RW.RTL_WH_CD       = #techTocCd#
        AND RW.EZCANCELFLAG    = '0'
        AND V.GLBL_CMPY_CD     = RW.GLBL_CMPY_CD
        AND V.VND_CD           = RW.PRF_CARR_CD
        AND V.CARR_TP_CD       = #carrTpFedex#
        AND V.EZCANCELFLAG     = '0'
        AND VTR.GLBL_CMPY_CD   = V.GLBL_CMPY_CD
        AND VTR.VND_CD         = V.VND_CD
        AND VTR.VND_TP_CD      = #vndTpObCarrier#
        AND VTR.EZCANCELFLAG   = '0'
    </statement>

    <!-- QC#2366 Add SQL -->
    <statement id="getShipToCustAddress" parameterClass="Map" resultClass="Map">
        SELECT
             STC.SHIP_TO_CUST_CD
            ,STC.SHIP_TO_CUST_PK
            ,STC.LOC_NM
            ,STC.FIRST_LINE_ADDR
            ,STC.SCD_LINE_ADDR
            ,STC.THIRD_LINE_ADDR
            ,STC.FRTH_LINE_ADDR
            ,STC.CTY_ADDR
            ,STC.CNTY_PK
            ,CTY.CNTY_NM
            ,STC.PROV_NM
            ,STC.ST_CD
            ,STC.POST_CD
            ,STC.CTRY_CD
            ,STC.FIRST_REF_CMNT_TXT
            ,STC.SCD_REF_CMNT_TXT
        FROM
             SHIP_TO_CUST STC
            ,CNTY CTY
        WHERE
            STC.GLBL_CMPY_CD    = #glblCmpyCd#
        AND STC.SHIP_TO_CUST_CD = #shipToCustCd#
        AND STC.RGTN_STS_CD     = #rgtnStsCd#
        AND STC.EZCANCELFLAG    = '0'
        AND STC.GLBL_CMPY_CD    = CTY.GLBL_CMPY_CD(+)
        AND STC.CNTY_PK         = CTY.CNTY_PK(+)
        AND CTY.EZCANCELFLAG(+) = '0'
    </statement>

    <!-- QC#2366 Add SQL -->
    <statement id="cntCustomerWh" parameterClass="Map" resultClass="Integer">
        SELECT
             COUNT(*) CNT
        FROM
             RTL_SWH RS
        WHERE
            RS.GLBL_CMPY_CD    = #glblCmpyCd#
        AND RS.INVTY_LOC_CD    = #invtyLocCd#
        AND RS.RTL_WH_CATG_CD  = #rtlWhCatgCustomer#
        AND RS.EZCANCELFLAG    = '0'
    </statement>

    <statement id="searchAslDetails" parameterClass="Map" resultClass="Map">
        SELECT
                D.ASL_DTL_PK           AS  ASL_DTL_PK
              , D.MDSE_CD              AS  MDSE_CD
              , D.SPLY_ITEM_NUM        AS  SPLY_ITEM_NUM
              , D.VND_CD               AS  VND_CD
              , D.VND_UOM_CD           AS  VND_UOM_CD
              , D.UNIT_PRC_AMT         AS  UNIT_PRC_AMT
              , D.VND_MIN_ORD_QTY      AS  VND_MIN_ORD_QTY
              , D.VND_INCR_ORD_QTY     AS  VND_INCR_ORD_QTY
              , D.PRIM_SPLY_FLG        AS  PRIM_SPLY_FLG
              , H.PRNT_VND_CD          AS  PRNT_VND_CD
              , D.VND_LT_DAYS_NUM      AS  VND_LT_DAYS_NUM
          FROM
                ASL_HDR                H
              , ASL_DTL                D
             <isNotNull property="aslQlfyTpCd">
              , ASL_QLFY_RELN          QR
             </isNotNull>
         WHERE
            <!-- join condition. -->
                H.GLBL_CMPY_CD                     =       D.GLBL_CMPY_CD(+)
            AND H.ASL_HDR_PK                       =       D.ASL_HDR_PK(+)
            <isNotNull property="aslQlfyTpCd">
            AND H.GLBL_CMPY_CD                     =       QR.GLBL_CMPY_CD(+)
            AND H.ASL_HDR_PK                       =       QR.ASL_HDR_PK(+)
            </isNotNull>
            <!-- query condition. -->
            AND H.GLBL_CMPY_CD                     =       #glblCmpyCd#
            AND NVL(H.ASL_START_DT, '00000000')    &lt;=   #salesDate#
            AND NVL(H.ASL_END_DT, '99991231')      &gt;=   #salesDate#
            AND H.EZCANCELFLAG                     =       '0'
            AND D.MDSE_CD                          =       #mdseCd#
            AND NVL(D.EFF_FROM_DT, '00000000')     &lt;=   #salesDate#
            AND NVL(D.EFF_THRU_DT, '99991231')     &gt;=   #salesDate#
            AND D.EZCANCELFLAG(+)                  =       '0'
            AND D.VND_CD IS NOT NULL
            <isNotNull property="vndCd">
            AND D.VND_CD                           =       #vndCd#
            AND H.PRNT_VND_CD                      =       #prntVndCd#
            </isNotNull>
            <isNotNull property="primSplyFlg">
            AND D.PRIM_SPLY_FLG                    =       #primSplyFlg#
            </isNotNull>
            <isNotNull property="aslQlfyTpCd">
            AND QR.ASL_QLFY_TP_CD                  =       #aslQlfyTpCd#
            AND QR.ASL_QLFY_REF_CD                 =       #aslQlfyRefCd#
            AND QR.EZCANCELFLAG(+)                 =       '0'
            </isNotNull>
    </statement>

    <statement id="getBigDealNumber" parameterClass="Map" resultClass="String">
        SELECT
            STC.BIG_DEAL_NUM
        FROM
            SHIP_TO_CUST STC
        WHERE
                STC.GLBL_CMPY_CD     = #glblCmpyCd#
            AND STC.SHIP_TO_CUST_CD  = #shipToCustCd#
            AND STC.EZCANCELFLAG     = '0'
    </statement>

    <!-- QC#57659 Add start -->
    <statement id="getTechInfo" parameterClass="Map" resultClass="Map">
        SELECT
            TM.EML_ADDR
           ,TM.TECH_CELL_PHO_NUM
           ,TM.TEL_NUM
           ,WH.TECH_MBL_MSG_ADDR
           ,TM.TECH_NM
        FROM
            TECH_MSTR TM
            ,S21_PSN  PSN
            ,RTL_WH   WH
        WHERE
            TM.GLBL_CMPY_CD       =  #glblCmpyCd#
        AND TM.TECH_TOC_CD        =  #rqstTechTocCd#
        AND TM.GLBL_CMPY_CD       =  PSN.GLBL_CMPY_CD
        AND TM.TECH_TOC_CD        =  PSN.PSN_CD
        AND TM.GLBL_CMPY_CD       =  WH.GLBL_CMPY_CD(+)
        AND TM.TECH_TOC_CD        =  WH.RTL_WH_CD(+)
        AND TM.EZCANCELFLAG       = '0'
        AND PSN.EZCANCELFLAG      = '0'
        AND WH.EZCANCELFLAG(+)    = '0'
    </statement>

    <statement id="getSvcLvlNm" parameterClass="Map" resultClass="String">
        SELECT
            MAIN.TPL_SVC_LVL_NM
        FROM (
            SELECT
                TC.TPL_SVC_LVL_NM
            FROM
                TPL_CARR_SVC_LVL TC
            WHERE
                TC.GLBL_CMPY_CD         = #glblCmpyCd#
            AND TC.WH_OWNR_CD           = #whOwnrCd#
        <isNotNull property="carrCd">
            AND TC.CARR_CD              = #carrCd#
        </isNotNull>
        <isNull property="carrCd">
            AND TC.CARR_CD              IS NULL
        </isNull>
        <isNotNull property="shpgSvcLvlCd">
            AND TC.SHPG_SVC_LVL_CD      = #shpgSvcLvlCd#
        </isNotNull>
        <isNull property="shpgSvcLvlCd">
            AND TC.SHPG_SVC_LVL_CD      IS NULL
        </isNull>
            AND TC.EZCANCELFLAG         = '0'
            ORDER BY
                TC.TPL_CARR_SVC_LVL_SORT_NUM
        ) MAIN
        WHERE
            ROWNUM&lt;=1
    </statement>

    <statement id="getPrCustomer" parameterClass="Map" resultClass="Map">
        SELECT *
        FROM (
            SELECT
                STC.LOC_NM
               ,STC.FIRST_LINE_ADDR
               ,STC.SCD_LINE_ADDR
               ,STC.THIRD_LINE_ADDR
               ,STC.FRTH_LINE_ADDR
               ,STC.CTY_ADDR
               ,STC.ST_CD
               ,STC.POST_CD
               ,STC.CTRY_CD
               ,STC.TEL_NUM
               ,PRD.CARR_CD
               ,PRD.SHPG_SVC_LVL_CD
            FROM 
                PRCH_REQ_DTL    PRD
               ,SHIP_TO_CUST   STC
            WHERE
                PRD.GLBL_CMPY_CD      = #glblCmpyCd#
            AND PRD.PRCH_REQ_NUM      = #prchReqNum#
            AND PRD.EZCANCELFLAG      = '0'
            AND PRD.GLBL_CMPY_CD      = STC.GLBL_CMPY_CD
            <isNotNull property="shipToCustCd">
                AND STC.SHIP_TO_CUST_CD = #shipToCustCd#
            </isNotNull>
            <isNull property="shipToCustCd">
                AND PRD.DEST_INVTY_LOC_CD = STC.SHIP_TO_CUST_CD
            </isNull>
            AND STC.EZCANCELFLAG      = '0'
            ORDER BY
                PRD.GLBL_CMPY_CD       ASC 
               ,PRD.PRCH_REQ_NUM      ASC
               ,PRD.PRCH_REQ_LINE_NUM ASC
        )
        WHERE
            ROWNUM&lt;=1
    </statement>

    <statement id="getInsourcingSatellite" parameterClass="Map" resultClass="Map">
        SELECT
            FROM_RW.EMER_SRC_RTL_WH_CD AS RTL_WH_CD
           ,STL_RW.POST_CD
           ,STL_RW.CTRY_CD
           ,STL_RW.FEDEX_CUT_OFF_TM
           ,STL_RW.UPS_CUT_OFF_TM
           ,STL_RW.WH_CUT_OFF_TM
           ,WO.INSRC_PRCH_REQ_LINE_TP_CD
           ,0 AS INSRC_RNK_SORT_NUM
        FROM
            RTL_WH       FROM_RW
           ,WH_OWNR      WO
           ,RTL_WH       STL_RW
        WHERE
            FROM_RW.GLBL_CMPY_CD       = #glblCmpyCd#
        AND FROM_RW.RTL_WH_CD          = #toRtlWhCd#
        <!-- START 2022/1/26 A.Marte [QC#59533, MOD] -->
        <!-- AND FROM_RW.GLBL_CMPY_CD       = WO.GLBL_CMPY_CD -->
        <!-- AND FROM_RW.WH_OWNR_CD         = WO.WH_OWNR_CD -->
        AND STL_RW.GLBL_CMPY_CD       = WO.GLBL_CMPY_CD
        AND STL_RW.WH_OWNR_CD         = WO.WH_OWNR_CD
        <!-- END 2022/1/26 A.Marte [QC#59533, MOD] -->
        AND FROM_RW.GLBL_CMPY_CD       = STL_RW.GLBL_CMPY_CD
        AND FROM_RW.EMER_SRC_RTL_WH_CD = STL_RW.RTL_WH_CD
        AND FROM_RW.EZCANCELFLAG       = '0'
        AND WO.EZCANCELFLAG            = '0'
        AND STL_RW.EZCANCELFLAG        = '0'
        UNION ALL
        SELECT
           IZP.TO_RTL_WH_CD
           ,TO_RW.POST_CD
           ,TO_RW.CTRY_CD
           ,TO_RW.FEDEX_CUT_OFF_TM
           ,TO_RW.UPS_CUT_OFF_TM
           ,TO_RW.WH_CUT_OFF_TM
           ,WO.INSRC_PRCH_REQ_LINE_TP_CD
           ,IZP.INSRC_RNK_SORT_NUM
        FROM
            RTL_WH       FROM_RW
           ,INSRC_ZN_PLN IZP
           ,RTL_WH       TO_RW
           ,WH_OWNR      WO
        WHERE
            FROM_RW.GLBL_CMPY_CD       = #glblCmpyCd#
        AND FROM_RW.RTL_WH_CD          = #toRtlWhCd#
        AND FROM_RW.GLBL_CMPY_CD       = IZP.GLBL_CMPY_CD
        AND FROM_RW.EMER_SRC_RTL_WH_CD = IZP.FROM_RTL_WH_CD
        AND IZP.INSRC_ENBL_FLG         = #insrcEnblFlg#
        AND IZP.GLBL_CMPY_CD           = TO_RW.GLBL_CMPY_CD
        AND IZP.TO_RTL_WH_CD           = TO_RW.RTL_WH_CD
        AND TO_RW.GLBL_CMPY_CD         = WO.GLBL_CMPY_CD
        AND TO_RW.WH_OWNR_CD           = WO.WH_OWNR_CD
        AND FROM_RW.EZCANCELFLAG       = '0'
        AND IZP.EZCANCELFLAG           = '0'
        AND TO_RW.EZCANCELFLAG         = '0'
        AND WO.EZCANCELFLAG            = '0'
        ORDER BY
            INSRC_RNK_SORT_NUM
    </statement>

    <statement id="getTplCarrSvcLvl" parameterClass="Map" resultClass="Map">
        SELECT
            *
        FROM (
            SELECT
                TC.TPL_CARR_CD
                ,TC.TPL_SVC_LVL_CD
                ,TC.TPL_CARR_NM
                ,TC.TPL_SVC_LVL_NM
                ,TC.TPL_SPCL_SVC_NM
            FROM
                TPL_CARR_SVC_LVL TC
            WHERE
                TC.GLBL_CMPY_CD         = #glblCmpyCd#
            AND TC.WH_OWNR_CD           = #whOwnrCd#
        <isNotNull property="carrCd">
            AND TC.CARR_CD              = #carrCd#
        </isNotNull>
        <isNull property="carrCd">
            AND TC.CARR_CD              IS NULL
        </isNull>
        <isNotNull property="shpgSvcLvlCd">
            AND TC.SHPG_SVC_LVL_CD      = #shpgSvcLvlCd#
        </isNotNull>
        <isNull property="shpgSvcLvlCd">
            AND TC.SHPG_SVC_LVL_CD      IS NULL
        </isNull>
            AND TC.EZCANCELFLAG         = '0'
            ORDER BY
                TC.TPL_CARR_SVC_LVL_SORT_NUM
        )
        WHERE
            ROWNUM &lt;= 1
    </statement>
    <!-- QC#57659 Add end -->
    <!-- QC#61128 Add start -->
    <statement id="getThirdPartyInsourcingPlanning" parameterClass="Map" resultClass="Map">
        SELECT
             VND_CD
        FROM
             INSRC_THIRD_PTY_PLN
        WHERE
                GLBL_CMPY_CD   = #glblCmpyCd#
            AND PRCH_REQ_TP_CD = #prchReqTpCd#
            AND INSRC_ENBL_FLG = #insrcEnblFlg#
            AND EZCANCELFLAG   = '0'
        ORDER BY
            INSRC_VND_PRTY_NUM
    </statement>
    
    <statement id="getPrntVndCd" parameterClass="Map" resultClass="Map">
        SELECT
             PV.PRNT_VND_CD PRNT_VND_CD
        FROM
             PRNT_VND PV
             ,VND V
        WHERE
                PV.PRNT_VND_PK  = V.PRNT_VND_PK
            AND PV.GLBL_CMPY_CD = V.GLBL_CMPY_CD
            AND PV.EZCANCELFLAG = V.EZCANCELFLAG
            AND PV.GLBL_CMPY_CD = #glblCmpyCd#
            AND PV.EZCANCELFLAG = '0'
            AND V.VND_CD        = #vndCd#
    </statement>
    <!-- QC#61128 Add end -->

    <!-- QC#61703 Add Start -->
    <statement id="getPrPoRequestQty" parameterClass="Map" resultClass="BigDecimal">
    SELECT
        SUM(MAIN.TOT_QTY) AS TOT_QTY
    FROM(
        SELECT
            NVL(SUM(PRD.PRCH_REQ_QTY), 0) AS TOT_QTY
        FROM
            PRCH_REQ PR
           ,PRCH_REQ_DTL PRD
           ,PRCH_REQ_APVL_STS PRAS
           ,PRCH_REQ_STS PRS
           ,PRCH_REQ_LINE_STS PRLS
        WHERE
            PR.GLBL_CMPY_CD = #glblCmpyCd#
        AND PR.PRCH_REQ_REC_TP_CD = #prchReqRecTpPoReq#
        AND PR.GLBL_CMPY_CD = PRAS.GLBL_CMPY_CD
        AND PR.PRCH_REQ_APVL_STS_CD = PRAS.PRCH_REQ_APVL_STS_CD
        AND PRAS.PRCH_REQ_APVL_FLG = 'Y'
        AND PR.GLBL_CMPY_CD = PRS.GLBL_CMPY_CD
        AND PR.PRCH_REQ_STS_CD = PRS.PRCH_REQ_STS_CD
        AND PRS.OPEN_STS_FLG = 'Y'
        AND PR.PRCH_REQ_NUM = PRD.PRCH_REQ_NUM
        AND PRD.VND_CD = #vndCd#
        AND PRD.MDSE_CD = #mdseCd#
        AND PRD.ASL_MDSE_CD = #aslMdseCd#
        AND PRD.GLBL_CMPY_CD = PRLS.GLBL_CMPY_CD
        AND PRD.PRCH_REQ_LINE_STS_CD = PRLS.PRCH_REQ_LINE_STS_CD
        AND PRLS.OPEN_STS_FLG = 'Y'
        AND PR.EZCANCELFLAG = '0'
        AND PRD.EZCANCELFLAG = '0'
        AND PRAS.EZCANCELFLAG = '0'
        AND PRS.EZCANCELFLAG = '0'
        AND PRLS.EZCANCELFLAG = '0'
        UNION ALL
        SELECT
            CASE WHEN NVL(SUM(PD.PO_QTY - PD.PO_CANC_QTY - PD.PO_RCV_QTY), 0) &lt; 0 THEN 0
            ELSE NVL(SUM(PD.PO_QTY - PD.PO_CANC_QTY - PD.PO_RCV_QTY), 0)
            END AS TOT_QTY
        FROM
            PO PO
           ,PO_DTL PD
           ,PO_APVL_STS PAS
           ,PO_LINE_STS PLS
        WHERE
            PO.GLBL_CMPY_CD = #glblCmpyCd#
        AND PO.VND_CD = #vndCd#
        AND PO.PO_ORD_SRC_CD = #poSrcTpCdInsourcing#
        AND PO.GLBL_CMPY_CD = PAS.GLBL_CMPY_CD
        AND PO.PO_APVL_STS_CD = PAS.PO_APVL_STS_CD
        <iterate property="poInsourcingApvlList" var="poApvlList[]" open="AND PAS.PO_APVL_STS_CD IN (" close=")" conjunction=",">
            #poApvlList[]#
        </iterate>
        AND PO.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
        AND PO.PO_ORD_NUM = PD.PO_ORD_NUM
        AND PD.MDSE_CD = #mdseCd#
        AND PD.ASL_MDSE_CD = #aslMdseCd#
        AND PD.GLBL_CMPY_CD = PLS.GLBL_CMPY_CD
        AND PD.PO_LINE_STS_CD = PLS.PO_LINE_STS_CD
        <iterate property="poInsourcingLineStsList" var="poLineStsList[]" open="AND PLS.PO_LINE_STS_CD IN (" close=")" conjunction=",">
            #poLineStsList[]#
        </iterate>
        AND PO.EZCANCELFLAG = '0'
        AND PD.EZCANCELFLAG = '0'
        AND PAS.EZCANCELFLAG = '0'
        AND PLS.EZCANCELFLAG = '0'
        UNION ALL
        SELECT
            CASE WHEN NVL(SUM(PD.PO_QTY - PD.PO_CANC_QTY - PD.PO_RCV_QTY), 0) &lt; 0 THEN 0
            ELSE NVL(SUM(PD.PO_QTY - PD.PO_CANC_QTY - PD.PO_RCV_QTY), 0)
            END AS TOT_QTY
        FROM
            PO PO
           ,PO_DTL PD
           ,PO_APVL_STS PAS
           ,PO_LINE_STS PLS
        WHERE
            PO.GLBL_CMPY_CD = #glblCmpyCd#
        AND PO.VND_CD = #vndCd#
        AND PO.PO_ORD_SRC_CD != #poSrcTpCdInsourcing#
        AND PO.GLBL_CMPY_CD = PAS.GLBL_CMPY_CD
        AND PO.PO_APVL_STS_CD = PAS.PO_APVL_STS_CD
        <iterate property="poNotInsourcingApvlList" var="poApvlList[]" open="AND PAS.PO_APVL_STS_CD IN (" close=")" conjunction=",">
            #poApvlList[]#
        </iterate>
        AND PO.GLBL_CMPY_CD = PD.GLBL_CMPY_CD
        AND PO.PO_ORD_NUM = PD.PO_ORD_NUM
        AND PD.MDSE_CD = #mdseCd#
        AND PD.ASL_MDSE_CD = #aslMdseCd#
        AND PD.GLBL_CMPY_CD = PLS.GLBL_CMPY_CD
        AND PD.PO_LINE_STS_CD = PLS.PO_LINE_STS_CD
        <iterate property="poInsourcingLineStsList" var="poLineStsList[]" open="AND PLS.PO_LINE_STS_CD IN (" close=")" conjunction=",">
            #poLineStsList[]#
        </iterate>
        AND PO.EZCANCELFLAG = '0'
        AND PD.EZCANCELFLAG = '0'
        AND PAS.EZCANCELFLAG = '0'
        AND PLS.EZCANCELFLAG = '0'
    ) MAIN
    </statement>
    <!-- QC#61703 Add End -->
</sqlMap>
