<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSZC006001">
    <typeAlias alias="ACCT_DLY_ACTL_EXCH_RATESTMsg" type="business.db.ACCT_DLY_ACTL_EXCH_RATESTMsg"/>
    <typeAlias alias="MDL_NMTMsg"                   type="business.db.MDL_NMTMsg"/>
    <typeAlias alias="CUST_INV_REQTMsg"             type="business.db.CUST_INV_REQTMsg"/>
    <typeAlias alias="COA_PRODTMsg"                 type="business.db.COA_PRODTMsg"/>
    <statement id="getCustInvReq" parameterClass="Map" resultMap="result.CUST_INV_REQTMsg">
        SELECT
            CIR.SEND_INV_TO_ITRL_PTY_FLG
           ,CIR.SEND_INV_VIA_POST_FLG
           ,CIR.SEND_INV_VIA_EDI_FLG
           ,CIR.SEND_INV_VIA_FAX_FLG
           ,CIR.SEND_INV_VIA_EML_FLG
           ,CIR.INCL_NON_EDI_ORD_FLG
        FROM
            CUST_INV_REQ CIR
        WHERE
            CIR.GLBL_CMPY_CD = #glblCmpyCd#
        AND CIR.CUST_CD      = #custCd#
        AND CIR.BILL_TP_CD   = #billTpCd#
        AND CIR.EZCANCELFLAG = '0'
    </statement>
    <resultMap id="result.CUST_INV_REQTMsg" class="CUST_INV_REQTMsg">
        <result property="sendInvToItrlPtyFlg"   column="SEND_INV_TO_ITRL_PTY_FLG"     javaType="EZDCStringItem"/>
        <result property="sendInvViaPostFlg"     column="SEND_INV_VIA_POST_FLG"        javaType="EZDCStringItem"/>
        <result property="sendInvViaEdiFlg"      column="SEND_INV_VIA_EDI_FLG"         javaType="EZDCStringItem"/>
        <result property="sendInvViaFaxFlg"      column="SEND_INV_VIA_FAX_FLG"         javaType="EZDCStringItem"/>
        <result property="sendInvViaEmlFlg"      column="SEND_INV_VIA_EML_FLG"         javaType="EZDCStringItem"/>
        <result property="inclNonEdiOrdFlg"      column="INCL_NON_EDI_ORD_FLG"         javaType="EZDCStringItem"/>
    </resultMap>
    <statement id="getExchRate" parameterClass="EZDMsg" resultMap="result.ACCT_DLY_ACTL_EXCH_RATESTMsg">
        WITH AER AS (
            SELECT
                EX.ACTL_EXCH_RATE
            FROM
                ACCT_DLY_ACTL_EXCH_RATES EX
            WHERE
                EX.GLBL_CMPY_CD = #glblCmpyCd#
            AND EX.CCY_CD       = #dealCcyCd#
            AND EX.ACTL_EXCH_RATE_ENT_DT &lt;= #invDt#
            AND EX.ACTL_EXCH_RATE IS NOT NULL
            AND EX.EZCANCELFLAG = '0'
            ORDER BY
                EX.ACTL_EXCH_RATE_ENT_DT DESC
        )
        SELECT
            AER.ACTL_EXCH_RATE
        FROM
            AER
        WHERE
            ROWNUM &lt;= 1
    </statement>
    <resultMap id="result.ACCT_DLY_ACTL_EXCH_RATESTMsg" class="ACCT_DLY_ACTL_EXCH_RATESTMsg">
        <result property="glblCmpyCd"       column="GLBL_CMPY_CD"         javaType="EZDCStringItem"/>
        <result property="actlExchRate"     column="ACTL_EXCH_RATE"       javaType="EZDCBigDecimalItem"/>
    </resultMap>
<!-- Mod Start 09/28/2015 -->
<!--
    <statement id="getMdl" parameterClass="Map" resultMap="result.MDL_NMTMsg">
            SELECT
                MMR.MDL_ID
               ,MMR.MDL_NM
            FROM
                MDL_MDSE_RELN_V MMR
            WHERE
                MMR.GLBL_CMPY_CD = #glblCmpyCd#
            AND MMR.MDSE_CD      = #mdseCd#
            AND MMR.EZCANCELFLAG = '0'
    </statement>
    <resultMap id="result.MDL_NMTMsg" class="MDL_NMTMsg">
        <result property="t_MdlId"     column="MDL_ID"       javaType="EZDCBigDecimalItem"/>
        <result property="t_MdlNm"     column="MDL_NM"       javaType="EZDCStringItem"/>
    </resultMap>
-->
    <statement id="getMdl" parameterClass="Map" resultMap="result.MDL_NMTMsg">
            SELECT
                C.MDL_ID
               ,D.T_MDL_NM
            FROM
                SVC_MACH_MSTR   A
               ,SVC_CONFIG_MSTR B
               ,DS_MDL          C
               ,MDL_NM          D
            WHERE
                A.GLBL_CMPY_CD        = #glblCmpyCd#
            AND A.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
            AND A.EZCANCELFLAG        = '0'
            AND A.GLBL_CMPY_CD        = B.GLBL_CMPY_CD
            AND A.SVC_CONFIG_MSTR_PK  = B.SVC_CONFIG_MSTR_PK
            AND B.EZCANCELFLAG        = '0'
            AND B.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
            AND B.MDL_ID              = C.MDL_ID
            AND C.EZCANCELFLAG        = '0'
            AND C.GLBL_CMPY_CD        = D.T_GLBL_CMPY_CD
            AND C.MDL_ID              = D.T_MDL_ID
            AND D.EZCANCELFLAG        = '0'
    </statement>
    <resultMap id="result.MDL_NMTMsg" class="MDL_NMTMsg">
        <result property="t_MdlId"     column="MDL_ID"       javaType="EZDCBigDecimalItem"/>
        <result property="t_MdlNm"     column="T_MDL_NM"     javaType="EZDCStringItem"/>
    </resultMap>
<!-- Mod End 09/28/2015 -->
    <statement id="getCoaProd" parameterClass="Map" resultMap="result.COA_PRODTMsg">
        SELECT
            CPD.COA_PROD_CD
           ,CPD.COA_PROD_NM
        FROM
            COA_PROD CPD
        WHERE
            CPD.GLBL_CMPY_CD = #glblCmpyCd#
        AND    CPD.EZCANCELFLAG = '0'
        AND    EXISTS (
                SELECT
                    'X'
                FROM
                    S21_ORG O
                WHERE
                    O.GLBL_CMPY_CD = CPD.GLBL_CMPY_CD
                    AND O.COA_PROD_CD = CPD.COA_PROD_CD
                    AND O.TOC_CD = #slsRepTocCd#
                    AND O.EZCANCELFLAG = '0'
            )
    </statement>
    <statement id="getSerNum" parameterClass="Map" resultClass="String">
        SELECT
            SMM.SER_NUM
        FROM
            SVC_MACH_MSTR SMM
        WHERE
            SMM.GLBL_CMPY_CD     = #glblCmpyCd#
        AND SMM.SVC_MACH_MSTR_PK = #svcMachMstrPk#
        AND SMM.EZCANCELFLAG     = '0'
    </statement>
    <resultMap id="result.COA_PRODTMsg" class="COA_PRODTMsg">
        <result property="coaProdCd"  column="COA_PROD_CD"  javaType="EZDTStringItem"/>
        <result property="coaProdNm"  column="COA_PROD_NM"  javaType="EZDTStringItem"/>
    </resultMap>
    <statement id="getOfcAccptnce" parameterClass="Map" resultClass="Map">
        SELECT
            BR.BR_CD
           ,BR.LOC_NM
           ,BR.ADDL_LOC_NM
           ,BR.FIRST_LINE_ADDR
           ,BR.SCD_LINE_ADDR
           ,BR.THIRD_LINE_ADDR
           ,BR.FRTH_LINE_ADDR
           ,BR.CTY_ADDR
           ,BR.PROV_NM
           ,BR.ST_CD
           ,BR.POST_CD
           ,BR.CTRY_CD
           ,BR.TEL_NUM
           ,BR.FAX_NUM
           ,CCP.CR_ANLST_GRP_TOC_CD
           ,(SELECT 
               CNT.CNTY_NM 
             FROM
               CNTY CNT
             WHERE
                   BR.GLBL_CMPY_CD      = CNT.GLBL_CMPY_CD
               AND BR.CNTY_PK           = CNT.CNTY_PK
               AND CNT.EZCANCELFLAG    = '0') AS CNTY_NM
        FROM
                  BR BR
                 ,CUST_CR_PRFL CCP
        WHERE
                  BR.GLBL_CMPY_CD        = #glblCmpyCd#
        AND       CCP.GLBL_CMPY_CD       = BR.GLBL_CMPY_CD
        AND       CCP.BR_CD              = BR.BR_CD
        AND       CCP.BILL_TO_CUST_CD    = #billToCustCd#
        AND       BR.EZCANCELFLAG        = '0'
        AND       CCP.EZCANCELFLAG       = '0'
    </statement>
<!-- Add Start 09/28/2015 -->
    <statement id="getBillToCust" parameterClass="Map" resultClass="Map">
        SELECT
            A.REM_ID
           ,A.LOC_NM
           ,A.ADDL_LOC_NM
           ,A.FIRST_LINE_ADDR
           ,A.SCD_LINE_ADDR
           ,A.THIRD_LINE_ADDR
           ,A.FRTH_LINE_ADDR
           ,A.CTY_ADDR
           ,A.PROV_NM
           ,C.CNTY_NM
           ,A.ST_CD
           ,A.POST_CD
           ,A.CTRY_CD
           ,A.FIRST_REF_CMNT_TXT
           ,A.SCD_REF_CMNT_TXT
           ,A.SELL_TO_CUST_CD
           ,D.COA_AFFL_CD
           ,D.COA_CH_CD
        FROM
            BILL_TO_CUST     A
           ,CNTY             C
           ,SELL_TO_CUST     D
        WHERE
            A.GLBL_CMPY_CD        = #glblCmpyCd#
        AND A.BILL_TO_CUST_CD     = #billToCustCd#
        AND A.EZCANCELFLAG        = '0'
        AND A.GLBL_CMPY_CD        = C.GLBL_CMPY_CD (+)
        AND A.CNTY_PK             = C.CNTY_PK      (+)
        AND C.EZCANCELFLAG    (+) = '0'
        AND A.GLBL_CMPY_CD        = D.GLBL_CMPY_CD
        AND A.SELL_TO_CUST_CD     = D.SELL_TO_CUST_CD
        AND D.EZCANCELFLAG        = '0'
    </statement>
    <statement id="getProduct" parameterClass="Map" resultClass="Map">
            SELECT
                B.COA_PROD_CD
               ,B.COA_MDSE_TP_CD
            FROM
                SVC_MACH_MSTR  A
               ,MDSE           B
            WHERE
                A.GLBL_CMPY_CD     = #glblCmpyCd#
            AND A.SVC_MACH_MSTR_PK = #svcMachMstrPk#
            AND A.EZCANCELFLAG     = '0'
            AND A.GLBL_CMPY_CD     = B.GLBL_CMPY_CD
            AND A.MDSE_CD          = B.MDSE_CD
            AND B.EZCANCELFLAG     = '0'
    </statement>
<!-- Add End 09/28/2015 -->
<!-- START 2017/08/16 K.Kim [QC#19406, ADD] -->
    <statement id="getCtacPsnPk" parameterClass="Map" resultClass="BigDecimal">
        <!-- START 2018/04/02 U.Kim [QC#23559(Sol358), ADD] -->
        SELECT
            PSN.CTAC_PSN_PK
        FROM
            (
        <!-- END 2018/04/02 U.Kim [QC#23559(Sol358), ADD] -->
            SELECT
                <!-- START 2018/04/02 U.Kim [QC#23559(Sol358), ADD] -->
                CASE WHEN A.CTAC_TP_CD = #ctacTpBillSvcCall# THEN '1' ELSE '2' END AS SORT_NUM
                <!-- START 2018/04/02 U.Kim [QC#23559(Sol358), ADD] -->
               ,B.CTAC_PSN_PK
            FROM
                DS_CTAC_PSN_RELN   A
               ,CTAC_PSN           B
            WHERE
                A.GLBL_CMPY_CD                   = #glblCmpyCd#
            AND A.EZCANCELFLAG                   = '0'
            <!-- START 2018/04/02 U.Kim [QC#23559(Sol358), MOD] -->
            <!-- AND A.CTAC_TP_CD                     = #ctacTpBill# -->
            <iterate property="ctacTpList" var="ctacTpList[]" open="AND A.CTAC_TP_CD IN(" close=")" conjunction=",">
                #ctacTpList[]#
            </iterate>
            <!-- END 2018/04/02 U.Kim [QC#23559(Sol358), MOD] -->
            AND A.EFF_FROM_DT                &lt;= #invDt#
            AND NVL(A.EFF_THRU_DT, #invDt#)  &gt;= #invDt#
            AND A.GLBL_CMPY_CD                   = B.GLBL_CMPY_CD
            AND A.CTAC_PSN_PK                    = B.CTAC_PSN_PK
            AND B.EZCANCELFLAG                   = '0'
            AND B.CTAC_PSN_ACTV_FLG              = 'Y'
            AND EXISTS (
                    SELECT
                        1
                    FROM
                        BILL_TO_CUST C
                    WHERE
                        C.GLBL_CMPY_CD    = A.GLBL_CMPY_CD
                    AND C.LOC_NUM         = A.LOC_NUM
                    AND C.BILL_TO_CUST_CD = #billToCustCd#
                    AND C.EZCANCELFLAG    = '0'
                )
            ORDER BY
                 SORT_NUM
                ,A.DS_PRIM_LOC_FLG DESC
                ,A.EFF_FROM_DT     DESC
        <!-- START 2018/04/02 U.Kim [QC#23559(Sol358), ADD] -->
        ) PSN
        WHERE
        <!-- END 2018/04/02 U.Kim [QC#23559(Sol358), ADD] -->
             ROWNUM = 1
    </statement>
<!-- END 2017/08/16 K.Kim [QC#19406, ADD] -->
<!-- START 2019/04/24 [QC#31272, ADD] -->
    <statement id="getSvcTaskInfo" parameterClass="Map" resultClass="Map">
        SELECT 
             STK.SVC_ZN_CD  AS SVC_ZN_CD
            ,STK.MDL_GRP_NM AS MDL_GRP_NM
        FROM
             SVC_TASK STK
        WHERE
             STK.GLBL_CMPY_CD = #glblCmpyCd#
        AND  STK.SVC_TASK_NUM = #svcTaskNum#
        AND  STK.FSR_NUM      = #fsrNum#
        AND  STK.EZCANCELFLAG = '0'
    </statement>
    <statement id="getSvcTrvlUnitHrsAot" parameterClass="Map" resultClass="BigDecimal">
        <!-- START 2019/05/15 W.Honda [QC#50297, MOD] -->
        SELECT
             SVC_TRVL_UNIT_HRS_AOT
        FROM
            (
            SELECT
                 TRVL.SVC_TRVL_UNIT_HRS_AOT AS SVC_TRVL_UNIT_HRS_AOT
            FROM
                 SVC_TRVL_CHRG  TRVL
                ,DS_MDL_GRP     MGRP
                ,LINE_BIZ_TP    LBIZ
                ,AVAL_LINE_BIZ_TP_SRC ALB
                ,MDSE           MDSE
            WHERE
                 TRVL.GLBL_CMPY_CD        = #glblCmpyCd#
            <isNotNull property="svcZnCd">
            AND  TRVL.SVC_ZN_CD           = #svcZnCd#
            </isNotNull>
            AND  TRVL.SVC_LINE_BIZ_CD     = #svcByLineBizTpCd#
            AND  TRVL.SVC_TRVL_CHRG_TP_CD = #svcTrvlChrgTp#
            AND  TRVL.GLBL_CMPY_CD        = MGRP.GLBL_CMPY_CD
            <isNotNull property="mdlGrpNm">
            AND  MGRP.MDL_GRP_NM          = #mdlGrpNm#
            </isNotNull>
            AND  TRVL.MDL_GRP_ID          = MGRP.MDL_GRP_ID
            AND  TRVL.GLBL_CMPY_CD        = LBIZ.GLBL_CMPY_CD
            AND  TRVL.SVC_LINE_BIZ_CD     = LBIZ.LINE_BIZ_TP_CD
            AND  LBIZ.GLBL_CMPY_CD        = ALB.GLBL_CMPY_CD
            AND  LBIZ.LINE_BIZ_TP_CD      = ALB.LINE_BIZ_TP_CD
            AND  ALB.SYS_SRC_CD           = #sysSrcCd#
            AND  TRVL.GLBL_CMPY_CD        = MDSE.GLBL_CMPY_CD
            AND  TRVL.INTG_MDSE_CD        = MDSE.MDSE_CD
            AND  TRVL.EZCANCELFLAG        = '0'
            AND  MGRP.EZCANCELFLAG        = '0'
            AND  LBIZ.EZCANCELFLAG        = '0'
            AND  ALB.EZCANCELFLAG         = '0'
            AND  MDSE.EZCANCELFLAG        = '0'
            ORDER BY
                TRVL.SVC_TRVL_UNIT_AMT DESC)
        WHERE
             ROWNUM                   = 1
        <!-- END 2019/05/15 W.Honda [QC#50297, MOD] -->
   </statement>
<!-- END 2019/04/24 [QC#31272, ADD] -->
</sqlMap>
