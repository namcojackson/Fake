<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSZC043001">
    
    <statement id="getMdlNm" parameterClass="Map" resultClass="Map">
        SELECT
            MN.T_MDL_NM
           ,DMG.MDL_GRP_NM
        FROM
            SVC_CONFIG_MSTR    SCM
           ,MDL_NM             MN
           ,DS_MDL             DM
           ,DS_MDL_GRP         DMG
        WHERE
            SCM.GLBL_CMPY_CD          = #glblCmpyCd#
        AND SCM.SVC_CONFIG_MSTR_PK    = #svcConfigMstrPk#
        AND SCM.GLBL_CMPY_CD          = MN.T_GLBL_CMPY_CD
        AND SCM.MDL_ID                = MN.T_MDL_ID
        AND SCM.GLBL_CMPY_CD          = DM.GLBL_CMPY_CD
        AND SCM.MDL_ID                = DM.MDL_ID
        AND DM.GLBL_CMPY_CD           = DMG.GLBL_CMPY_CD(+)
        AND DM.MDL_GRP_ID             = DMG.MDL_GRP_ID(+)
        AND SCM.EZCANCELFLAG          = '0'
        AND MN.EZCANCELFLAG           = '0'
        AND DM.EZCANCELFLAG           = '0'
        AND DMG.EZCANCELFLAG(+)       = '0'
    </statement>
    <statement id="getMdlNmByCpo" parameterClass="Map" resultClass="Map">
        SELECT
            MN.T_MDL_NM
           ,DMG.MDL_GRP_NM
        FROM
            SVC_MACH_MSTR      MAC
           ,CPO_DTL            DCD
           ,DS_CPO_CONFIG      DCC
           ,MDL_NM             MN
           ,DS_MDL             DM
           ,DS_MDL_GRP         DMG
        WHERE
            MAC.GLBL_CMPY_CD          = #glblCmpyCd#
        AND MAC.SVC_MACH_MSTR_PK      = #svcMachMstrPk#
        AND MAC.GLBL_CMPY_CD          = DCD.GLBL_CMPY_CD
        AND MAC.TRX_HDR_NUM           = DCD.CPO_ORD_NUM
        AND MAC.TRX_LINE_NUM          = DCD.CPO_DTL_LINE_NUM
        AND MAC.TRX_LINE_SUB_NUM      = DCD.CPO_DTL_LINE_SUB_NUM
        AND DCD.GLBL_CMPY_CD          = DCC.GLBL_CMPY_CD
        AND DCD.DS_CPO_CONFIG_PK      = DCC.DS_CPO_CONFIG_PK
        AND DCC.GLBL_CMPY_CD          = MN.T_GLBL_CMPY_CD
        AND DCC.MDL_ID                = MN.T_MDL_ID
        AND DCC.GLBL_CMPY_CD          = DM.GLBL_CMPY_CD
        AND DCC.MDL_ID                = DM.MDL_ID
        AND DM.GLBL_CMPY_CD           = DMG.GLBL_CMPY_CD(+)
        AND DM.MDL_GRP_ID             = DMG.MDL_GRP_ID(+)
        AND MAC.EZCANCELFLAG          = '0'
        AND DCD.EZCANCELFLAG          = '0'
        AND DCC.EZCANCELFLAG          = '0'
        AND MN.EZCANCELFLAG           = '0'
        AND DM.EZCANCELFLAG           = '0'
        AND DMG.EZCANCELFLAG(+)       = '0'
    </statement>
    <statement id="getFsrVisit" parameterClass="Map" resultClass="Map">
        SELECT
            FV.FSR_NUM
           ,FV.FSR_VISIT_NUM
           ,F.INV_CCY_CD
           ,F.CCY_EXCH_RATE
           ,F.PMT_TERM_CASH_DISC_CD
        FROM
            FSR_VISIT    FV
           ,FSR          F
        WHERE
            FV.GLBL_CMPY_CD          = #glblCmpyCd#
        AND FV.SVC_TASK_NUM          = #svcTaskNum#
        AND FV.GLBL_CMPY_CD          = F.GLBL_CMPY_CD
        AND FV.FSR_NUM               = F.FSR_NUM
        AND FV.EZCANCELFLAG          = '0'
        AND F.EZCANCELFLAG           = '0'
    </statement>

    <statement id="getShipToInfo" parameterClass="Map" resultClass="Map">
     <isNotNull property="fsrNum">
        SELECT
              SHIP.CTRY_CD                  AS CTRY_CD
            , SHIP.POST_CD                  AS POST_CD
            <!-- START 2022/04/11 K.Kitachi [QC#59899, ADD] -->
            , FSR.SHIP_TO_UPD_CUST_CD       AS SHIP_TO_UPD_CUST_CD
            <!-- END 2022/04/11 K.Kitachi [QC#59899, ADD] -->
        FROM
              FSR
            , SHIP_TO_CUST SHIP
        WHERE FSR.GLBL_CMPY_CD    = #glblCmpyCd#
          AND FSR.FSR_NUM         = #fsrNum#
          AND FSR.EZCANCELFLAG    = '0'
          AND FSR.GLBL_CMPY_CD    = SHIP.GLBL_CMPY_CD(+)
          AND ( CASE
                     <!-- START 2022/03/11 [QC#59702, MOD] -->
                     <!-- WHEN FSR.SHIP_TO_CUST_UPD_FLG = 'Y' THEN FSR.SHIP_TO_UPD_CUST_CD -->
                     WHEN FSR.SHIP_TO_UPD_CUST_CD IS NOT NULL THEN FSR.SHIP_TO_UPD_CUST_CD
                     <!-- START 2022/03/11 [QC#59702, MOD] -->
                     ELSE FSR.SHIP_TO_CUST_CD
                 END
              ) = SHIP.SHIP_TO_CUST_CD(+)
          AND SHIP.EZCANCELFLAG(+) = '0'
     </isNotNull>
     <isNull property="fsrNum">
        SELECT
              SHIP.CTRY_CD                  AS CTRY_CD
            , SHIP.POST_CD                  AS POST_CD
        FROM
              SVC_MACH_MSTR MAC
            , SHIP_TO_CUST  SHIP
        WHERE MAC.GLBL_CMPY_CD     = #glblCmpyCd#
          AND MAC.SVC_MACH_MSTR_PK = #svcMachMstrPk#
          AND MAC.EZCANCELFLAG     = '0'
          AND MAC.GLBL_CMPY_CD     = SHIP.GLBL_CMPY_CD(+)
          AND MAC.CUR_LOC_NUM      = SHIP.SHIP_TO_CUST_CD(+)
          AND SHIP.EZCANCELFLAG(+) = '0'
     </isNull>
    </statement>
    <statement id="getFollUpTask" parameterClass="Map" resultClass="String">
        SELECT
            FL.SVC_TASK_NUM
        FROM
            FSR_VISIT    FV
           ,FSR_VISIT    FL
        WHERE
            FV.GLBL_CMPY_CD          = #glblCmpyCd#
        AND FV.SVC_TASK_NUM          = #svcTaskNum#
        AND FV.GLBL_CMPY_CD          = FL.GLBL_CMPY_CD
        AND FV.FSR_NUM               = FL.FSR_NUM
        AND FV.NEXT_FSR_VISIT_NUM    = FL.FSR_VISIT_NUM
        AND FV.EZCANCELFLAG          = '0'
        AND FL.EZCANCELFLAG          = '0'
    </statement>
    <statement id="getBillToAcct" parameterClass="Map" resultClass="String">
        SELECT
            A.SELL_TO_CUST_CD
        FROM
            BILL_TO_CUST A
        WHERE
            A.GLBL_CMPY_CD      = #glblCmpyCd#
        AND A.BILL_TO_CUST_CD   = #billToCustCd#
        AND A.EZCANCELFLAG      = '0'
    </statement>
    <statement id="getMdlNmForConfigMtrDtl" parameterClass="Map" resultClass="Map">
        SELECT
            MN.T_MDL_NM
           ,DMG.MDL_GRP_NM
        FROM
            SVC_CONFIG_MSTR_DTL    SCMD
           ,SVC_CONFIG_MSTR        SCM
           ,MDL_NM                 MN
           ,DS_MDL                 DM
           ,DS_MDL_GRP             DMG
        WHERE
            SCMD.GLBL_CMPY_CD         =  #glblCmpyCd#
        AND SCMD.SVC_MACH_MSTR_PK     =  #svcMachMstrPk#
        AND SCMD.SVC_MACH_RMV_DT      IS NULL
        AND SCMD.GLBL_CMPY_CD         =  SCM.GLBL_CMPY_CD
        AND SCMD.SVC_CONFIG_MSTR_PK   =  SCM.SVC_CONFIG_MSTR_PK
        AND SCM.GLBL_CMPY_CD          =  MN.T_GLBL_CMPY_CD
        AND SCM.MDL_ID                =  MN.T_MDL_ID
        AND SCM.GLBL_CMPY_CD          =  DM.GLBL_CMPY_CD
        AND SCM.MDL_ID                =  DM.MDL_ID
        AND DM.GLBL_CMPY_CD           =  DMG.GLBL_CMPY_CD(+)
        AND DM.MDL_GRP_ID             =  DMG.MDL_GRP_ID(+)
        AND SCMD.EZCANCELFLAG         =  '0'
        AND SCM.EZCANCELFLAG          =  '0'
        AND MN.EZCANCELFLAG           =  '0'
        AND DM.EZCANCELFLAG           =  '0'
        AND DMG.EZCANCELFLAG(+)       =  '0'
    </statement>

    <!-- START 2018/07/12 M.Naito [QC#13309,ADD] -->
    <statement id="getTempEttlInfo" parameterClass="Map" resultClass="String">
        SELECT
             TE.TEMP_ETTL_NUM   AS TEMP_ETTL_NUM
        FROM
             TEMP_ETTL_DTL           TED
            ,TEMP_ETTL               TE
            ,TEMP_ETTL_SVC_PRC_SHIFT TES
            ,SVC_PRC_SHIFT           SPS
        WHERE
                TED.GLBL_CMPY_CD               = #glblCmpyCd#
            AND TED.SVC_MACH_MSTR_PK           = #svcMachMstrPk#
            AND TED.EZCANCELFLAG               = '0'
            AND TED.GLBL_CMPY_CD               = TE.GLBL_CMPY_CD
            AND TED.TEMP_ETTL_NUM              = TE.TEMP_ETTL_NUM
            AND TE.EFF_FROM_DT                 &lt;= #startDt#
            AND NVL(TE.EFF_THRU_DT, #startDt#) &gt;= #startDt#
            AND TE.EZCANCELFLAG                = '0'
            AND TE.GLBL_CMPY_CD                = TES.GLBL_CMPY_CD
            AND TE.TEMP_ETTL_NUM               = TES.TEMP_ETTL_NUM
            AND TES.EZCANCELFLAG               = '0'
            AND TES.GLBL_CMPY_CD               = SPS.GLBL_CMPY_CD
            AND TES.SVC_PRC_SHIFT_PK           = SPS.SVC_PRC_SHIFT_PK
            <isEqual property="dayOfTheWeek" compareValue="1">
            AND SPS.SVC_PRC_SUN_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_SUN_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            <isEqual property="dayOfTheWeek" compareValue="2">
            AND SPS.SVC_PRC_MON_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_MON_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            <isEqual property="dayOfTheWeek" compareValue="3">
            AND SPS.SVC_PRC_TUE_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_TUE_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            <isEqual property="dayOfTheWeek" compareValue="4">
            AND SPS.SVC_PRC_WED_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_WED_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            <isEqual property="dayOfTheWeek" compareValue="5">
            AND SPS.SVC_PRC_THU_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_THU_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            <isEqual property="dayOfTheWeek" compareValue="6">
            AND SPS.SVC_PRC_FRI_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_FRI_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            <isEqual property="dayOfTheWeek" compareValue="7">
            AND SPS.SVC_PRC_SAT_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_SAT_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            <isEqual property="dayOfTheWeek" compareValue="0">
            AND SPS.SVC_PRC_HOL_START_VAL_TXT  &lt;= #startTm#
            AND SPS.SVC_PRC_HOL_END_VAL_TXT    &gt;= #startTm#
            </isEqual>
            AND SPS.EZCANCELFLAG               = '0'
    </statement>

    <statement id="getSvcTermAttrbMapValCd" parameterClass="Map" resultClass="Map">
        SELECT 
             NVL(DTL_COND.SVC_TERM_ATTRB_MAP_VAL_CD, CONTR_COND.SVC_TERM_ATTRB_MAP_VAL_CD)
                                                AS  SVC_TERM_ATTRB_MAP_VAL_CD
        FROM
             SVC_TERM_COND_ATTRB          TCA
            ,(SELECT
                   TCN.SVC_TERM_COND_ATTRB_PK
                  ,TCN.SVC_TERM_ATTRB_MAP_VAL_CD
              FROM
                   SVC_TERM_COND          TCN
              WHERE
                      TCN.GLBL_CMPY_CD          = #glblCmpyCd#
                  AND TCN.DS_CONTR_PK           = #dsContrPk#
                  AND TCN.DS_CONTR_DTL_PK       = #dsContrDtlPk#
                  AND TCN.EZCANCELFLAG          = '0'
             ) DTL_COND
            ,(SELECT
                   TCN.SVC_TERM_COND_ATTRB_PK
                  ,TCN.SVC_TERM_ATTRB_MAP_VAL_CD
              FROM
                   SVC_TERM_COND          TCN
              WHERE
                      TCN.GLBL_CMPY_CD          = #glblCmpyCd#
                  AND TCN.DS_CONTR_PK           = #dsContrPk#
                  AND TCN.DS_CONTR_DTL_PK       IS NULL
                  AND TCN.EZCANCELFLAG          = '0'
             ) CONTR_COND
        WHERE
                TCA.GLBL_CMPY_CD                = #glblCmpyCd#
            AND TCA.SVC_TERM_COND_ATTRB_NM      = #svcTermCondAttrbNm#
            AND TCA.EZCANCELFLAG                = '0'
            AND TCA.SVC_TERM_COND_ATTRB_PK      = DTL_COND.SVC_TERM_COND_ATTRB_PK(+)
            AND TCA.SVC_TERM_COND_ATTRB_PK      = CONTR_COND.SVC_TERM_COND_ATTRB_PK(+)
    </statement>
    <!-- END 2018/07/12 M.Naito [QC#13309,ADD] -->

    <!-- START 2018/08/30 K.Kitachi [QC#22665, ADD] -->
    <statement id="getDtyMgrEmlAddrList" parameterClass="Map" resultClass="String">
<!-- START 2023/05/26 T.Usui [QC#61069, MOD] -->
<!--
        WITH RG_TIER AS (
            SELECT
                OHSD.GLBL_CMPY_CD
                ,OHSD.ORG_TIER_CD + 1 AS ORG_TIER_CD
            FROM
                 STRU_DFN SDF
                ,ORG_HRCH_STRU_DFN OHSD
            WHERE
                    SDF.GLBL_CMPY_CD     = #glblCmpyCd#
                AND SDF.RG_FLG           = #flgY#
                AND SDF.EZCANCELFLAG     = '0'
                AND SDF.GLBL_CMPY_CD     = OHSD.GLBL_CMPY_CD
                AND SDF.STRU_DFN_CD      = OHSD.STRU_DFN_CD
                AND OHSD.BIZ_AREA_ORG_CD = #service#
                AND OHSD.EZCANCELFLAG    = '0'
                AND OHSD.EFF_FROM_DT                   &lt;= #salesDate#
                AND NVL(OHSD.EFF_THRU_DT, #salesDate#) &gt;= #salesDate#
                AND ROWNUM               = 1
        )
        ,BR_TIER AS (
            SELECT
                OHSD.GLBL_CMPY_CD
                ,OHSD.ORG_TIER_CD + 1 AS ORG_TIER_CD
            FROM
                 STRU_DFN SDF
                ,ORG_HRCH_STRU_DFN OHSD
            WHERE
                    SDF.GLBL_CMPY_CD     = #glblCmpyCd#
                AND SDF.BR_FLG           = #flgY#
                AND SDF.EZCANCELFLAG     = '0'
                AND SDF.GLBL_CMPY_CD     = OHSD.GLBL_CMPY_CD
                AND SDF.STRU_DFN_CD      = OHSD.STRU_DFN_CD
                AND OHSD.BIZ_AREA_ORG_CD = #service#
                AND OHSD.EZCANCELFLAG    = '0'
                AND OHSD.EFF_FROM_DT                   &lt;= #salesDate#
                AND NVL(OHSD.EFF_THRU_DT, #salesDate#) &gt;= #salesDate#
                AND ROWNUM               = 1
        )
        ,BR_RG_MAP AS (
            SELECT
                CASE RG.ORG_TIER_CD
                    WHEN 1 THEN STRU.FIRST_ORG_CD
                    WHEN 2 THEN STRU.SCD_ORG_CD
                    WHEN 3 THEN STRU.THIRD_ORG_CD
                    WHEN 4 THEN STRU.FRTH_ORG_CD
                    WHEN 5 THEN STRU.FIFTH_ORG_CD
                    WHEN 6 THEN STRU.SIXTH_ORG_CD
                    WHEN 7 THEN STRU.SVNTH_ORG_CD
                    WHEN 8 THEN STRU.EIGHTH_ORG_CD
                    WHEN 9 THEN STRU.NINTH_ORG_CD
                    WHEN 10 THEN STRU.TENTH_ORG_CD
                    WHEN 11 THEN STRU.ELVTH_ORG_CD
                END RG_CD
                ,CASE BR.ORG_TIER_CD
                    WHEN 1 THEN SUBSTR(STRU.FIRST_ORG_NM, 1 ,3)
                    WHEN 2 THEN SUBSTR(STRU.SCD_ORG_NM, 1 ,3)
                    WHEN 3 THEN SUBSTR(STRU.THIRD_ORG_NM, 1 ,3)
                    WHEN 4 THEN SUBSTR(STRU.FRTH_ORG_NM, 1 ,3)
                    WHEN 5 THEN SUBSTR(STRU.FIFTH_ORG_NM, 1 ,3)
                    WHEN 6 THEN SUBSTR(STRU.SIXTH_ORG_NM, 1 ,3)
                    WHEN 7 THEN SUBSTR(STRU.SVNTH_ORG_NM, 1 ,3)
                    WHEN 8 THEN SUBSTR(STRU.EIGHTH_ORG_NM, 1 ,3)
                    WHEN 9 THEN SUBSTR(STRU.NINTH_ORG_NM, 1 ,3)
                    WHEN 10 THEN SUBSTR(STRU.TENTH_ORG_NM, 1 ,3)
                    WHEN 11 THEN SUBSTR(STRU.ELVTH_ORG_NM, 1 ,3)
                END BR_CD
            FROM
                ORG_STRU STRU
                ,RG_TIER RG
                ,BR_TIER BR
            WHERE
                STRU.GLBL_CMPY_CD   = #glblCmpyCd#
            AND STRU.EZCANCELFLAG   = '0'
            AND STRU.FIRST_ORG_CD   = #service#
            AND STRU.ORG_LAYER_NUM  = BR.ORG_TIER_CD
        )
-->
    SELECT
        *
    FROM (
        SELECT
            PSN.EML_ADDR
        FROM
            SVC_MACH_MSTR  SMM
            ,SVC_RG_BR_V   SRB
            ,DTY_MGR       MGR
            ,S21_PSN       PSN
        WHERE
            SMM.GLBL_CMPY_CD                                          = #glblCmpyCd#
        AND SMM.EZCANCELFLAG                                          = '0'
        AND SMM.SVC_MACH_MSTR_PK                                      = #svcMachMstrPk#
        AND SUBSTR(SRB.BR_ORG_NM,0,3)                                 = SMM.FLD_SVC_BR_CD
        AND SMM.GLBL_CMPY_CD                                          = MGR.GLBL_CMPY_CD
        AND MGR.EZCANCELFLAG                                          = '0'
        AND (MGR.BR_ORG_CD                                            IS NULL OR
            MGR.BR_ORG_CD                                             = SRB.BR_ORG_CD)
        AND MGR.ORG_CD                                                = SRB.RG_ORG_CD
        AND ((SMM.SVC_BY_LINE_BIZ_TP_CD IN (#svcByLineBizTpCdLfs#,#svcByLineBizTpCdPps#) AND MGR.SVC_BY_LINE_BIZ_TP_CD IN (#svcByLineBizTpCdLfs#,#svcByLineBizTpCdPps#)) OR
             (SMM.SVC_BY_LINE_BIZ_TP_CD NOT IN (#svcByLineBizTpCdLfs#,#svcByLineBizTpCdPps#) AND MGR.SVC_BY_LINE_BIZ_TP_CD = SMM.SVC_BY_LINE_BIZ_TP_CD)
             )
        AND MGR.EFF_FROM_DT || MGR.EFF_FROM_TM                    &lt;= #sysTmStamp#
        AND NVL(MGR.EFF_THRU_DT || MGR.EFF_THRU_TM, #sysTmStamp#) &gt;= #sysTmStamp#
        AND MGR.SVC_AVAL_FLG                                          = #flgY#
        AND MGR.GLBL_CMPY_CD                                          = PSN.GLBL_CMPY_CD
        AND PSN.EZCANCELFLAG                                          = '0'
        AND MGR.PSN_CD                                                = PSN.PSN_CD
        AND PSN.EML_ADDR                                              IS NOT NULL
        ORDER BY
            MGR.BR_ORG_CD                                             NULLS LAST
        )
    WHERE
        ROWNUM = 1

<!-- END 2023/05/26 T.Usui [QC#61069, MOD] -->
    </statement>

    <statement id="getCltEmlAddrList" parameterClass="Map" resultClass="String">
        SELECT
            PSN.EML_ADDR
        FROM
             SELL_TO_CUST           STC
            ,ACCT_LOC               LOC
            ,BILL_TO_CUST           BTC
            ,CLT_PTFO               CLP
            ,AUTH_PSN               PSN
        WHERE
            STC.GLBL_CMPY_CD    = #glblCmpyCd#
        AND STC.EZCANCELFLAG    = '0'
        AND STC.SELL_TO_CUST_CD = #sellToCustCd#
        AND STC.GLBL_CMPY_CD    = LOC.GLBL_CMPY_CD
        AND STC.SELL_TO_CUST_CD = LOC.DS_ACCT_NUM
        AND LOC.EZCANCELFLAG    = '0'
        AND LOC.GLBL_CMPY_CD    = BTC.GLBL_CMPY_CD
        AND LOC.LOC_NUM         = BTC.LOC_NUM
        AND BTC.BILL_TO_CUST_CD = #billToCustCd#
        AND BTC.EZCANCELFLAG    = '0'
        AND BTC.GLBL_CMPY_CD    = CLP.GLBL_CMPY_CD
        AND CLP.EZCANCELFLAG    = '0'
        AND CLP.CLT_PTFO_PK     = NVL(BTC.CLT_PTFO_PK, STC.CLT_PTFO_PK)
        AND CLP.GLBL_CMPY_CD    = PSN.GLBL_CMPY_CD
        AND CLP.CLT_PSN_CD      = PSN.USR_NM
        AND PSN.EML_ADDR   IS NOT NULL
        AND PSN.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getMailInfo" parameterClass="Map" resultClass="Map">
        SELECT
             SELL.DS_ACCT_NM
            ,SHIP.FIRST_LINE_ADDR
                || DECODE(SHIP.SCD_LINE_ADDR,   NULL, '', ' ' || SHIP.SCD_LINE_ADDR)
                || DECODE(SHIP.THIRD_LINE_ADDR, NULL, '', ' ' || SHIP.THIRD_LINE_ADDR)
                || DECODE(SHIP.FRTH_LINE_ADDR,  NULL, '', ' ' || SHIP.FRTH_LINE_ADDR)
                || DECODE(SHIP.CTY_ADDR,        NULL, '', ',' || SHIP.CTY_ADDR)
                || DECODE(SHIP.ST_CD,           NULL, '', ',' || SHIP.ST_CD)
                || DECODE(SHIP.POST_CD,         NULL, '', ' ' || SHIP.POST_CD) LINE_ADDR
            ,MN.T_MDL_NM
            ,SMM.SER_NUM
        FROM
             SVC_MACH_MSTR   SMM
            ,SVC_CONFIG_MSTR SCM
            ,MDL_NM          MN
            ,SELL_TO_CUST    SELL
            ,SHIP_TO_CUST    SHIP
        WHERE
                SMM.GLBL_CMPY_CD       = #glblCmpyCd#
            AND SMM.SVC_MACH_MSTR_PK   = #svcMachMstrPk#
            AND SMM.EZCANCELFLAG       = '0'
            AND SMM.GLBL_CMPY_CD       = SCM.GLBL_CMPY_CD
            AND SMM.SVC_CONFIG_MSTR_PK = SCM.SVC_CONFIG_MSTR_PK
            AND SCM.EZCANCELFLAG       = '0'
            AND SCM.GLBL_CMPY_CD       = MN.T_GLBL_CMPY_CD
            AND SCM.MDL_ID             = MN.T_MDL_ID
            AND MN.EZCANCELFLAG        = '0'
            AND SMM.GLBL_CMPY_CD       = SELL.GLBL_CMPY_CD
            AND SMM.CUR_LOC_ACCT_NUM   = SELL.SELL_TO_CUST_CD
            AND SELL.EZCANCELFLAG      = '0'
            AND SMM.GLBL_CMPY_CD       = SHIP.GLBL_CMPY_CD
            AND SMM.CUR_LOC_NUM        = SHIP.SHIP_TO_CUST_CD
            AND SHIP.EZCANCELFLAG      = '0'
    </statement>

    <statement id="getCustInfo" parameterClass="Map" resultClass="Map">
        SELECT
             SELL.DS_ACCT_NM
            ,SHIP.FIRST_LINE_ADDR
                || DECODE(SHIP.SCD_LINE_ADDR,   NULL, '', ' ' || SHIP.SCD_LINE_ADDR)
                || DECODE(SHIP.THIRD_LINE_ADDR, NULL, '', ' ' || SHIP.THIRD_LINE_ADDR)
                || DECODE(SHIP.FRTH_LINE_ADDR,  NULL, '', ' ' || SHIP.FRTH_LINE_ADDR)
                || DECODE(SHIP.CTY_ADDR,        NULL, '', ',' || SHIP.CTY_ADDR)
                || DECODE(SHIP.ST_CD,           NULL, '', ',' || SHIP.ST_CD)
                || DECODE(SHIP.POST_CD,         NULL, '', ' ' || SHIP.POST_CD) LINE_ADDR
        FROM
             SHIP_TO_CUST SHIP
            ,SELL_TO_CUST SELL
        WHERE
                SHIP.GLBL_CMPY_CD    = #glblCmpyCd#
            AND SHIP.SHIP_TO_CUST_CD = #shipToCustCd#
            AND SHIP.EZCANCELFLAG    = '0'
            AND SHIP.GLBL_CMPY_CD    = SELL.GLBL_CMPY_CD
            AND SHIP.SELL_TO_CUST_CD = SELL.SELL_TO_CUST_CD
            AND SELL.EZCANCELFLAG    = '0'
    </statement>
    <!-- END 2018/08/30 K.Kitachi [QC#22665, ADD] -->

    <!-- START 2020/04/06 K.Kitachi [QC#56229, ADD] -->
    <statement id="getRhsDsSvcCallTpCd" parameterClass="Map" resultClass="String">
        SELECT
            A.DS_SVC_CALL_TP_CD
        FROM
            DS_SVC_CALL_TP A
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.AHS_DS_SVC_CALL_TP_CD = #ahsDsSvcCallTpCd#
            AND A.EZCANCELFLAG          = '0'
    </statement>
    <!-- END 2020/04/06 K.Kitachi [QC#56229, ADD] -->

    <!-- START 2023/07/14 K.Watanabe [QC#61310, ADD] -->
    <statement id="getShowRoomMachineCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
             SVC_MACH_MSTR SMM
            ,RTL_SWH       RS
        WHERE
                SMM.EZCANCELFLAG                = '0'
            AND SMM.GLBL_CMPY_CD                = #glblCmpyCd#
            AND SMM.SVC_MACH_TP_CD              = #svcMachTpCd#
            AND SMM.SVC_CONFIG_MSTR_PK          IS NOT NULL
            <iterate property="svcMachMstrStsCdList" var="svcMachMstrStsCd[]" open="AND SMM.SVC_MACH_MSTR_STS_CD IN (" close=")" conjunction=",">
                #svcMachMstrStsCd[]#
            </iterate>
            AND SMM.GLBL_CMPY_CD                = RS.GLBL_CMPY_CD
            AND SMM.SVC_MACH_MSTR_PK            = #svcMachMstrPk#
            AND SMM.CUR_LOC_NUM                 = RS.INVTY_LOC_CD
            AND RS.EZCANCELFLAG                 = '0'
            AND RS.RTL_WH_CATG_CD               = #rtlWhCatgCd#
            AND RS.EFF_FROM_DT                  &lt;= #startDt#
            AND NVL(RS.EFF_THRU_DT, #startDt#)  &gt;= #startDt#
    </statement>
    <!-- END 2023/07/14 K.Watanabe [QC#61310, ADD] -->

    <!-- START 2023/09/15 K.Watanabe [QC#61310, ADD] -->
    <statement id="getSellToCustCd" parameterClass="Map" resultClass="String">
        SELECT
            STC.SELL_TO_CUST_CD
        FROM
             SVC_MACH_MSTR SMM
            ,SHIP_TO_CUST  STC
        WHERE
                SMM.EZCANCELFLAG                = '0'
            AND SMM.GLBL_CMPY_CD                = #glblCmpyCd#
            AND SMM.SVC_MACH_MSTR_PK            = #svcMachMstrPk#
            AND SMM.SVC_MACH_TP_CD              = #svcMachTpCd#
            AND SMM.SVC_CONFIG_MSTR_PK          IS NOT NULL
            AND SMM.GLBL_CMPY_CD                = STC.GLBL_CMPY_CD
            AND SMM.CUR_LOC_NUM                 = STC.SHIP_TO_CUST_CD
            AND STC.EZCANCELFLAG                 = '0'
    </statement>
    <!-- END 2023/09/15 K.Watanabe [QC#61310, ADD] -->
</sqlMap>
