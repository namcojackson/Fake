<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NLCL1020Query">

    <!-- *********************************************************** -->
    <!-- ********** Bean Definition ******************************** -->
    <!-- *********************************************************** -->
    <typeAlias alias="NLCL1020CMsg"        type="business.blap.NLCL1020.NLCL1020CMsg"/>
    <typeAlias alias="NLCL1020_ACMsg"    type="business.blap.NLCL1020.NLCL1020_ACMsg"/>
    
    <statement id="getInvtyOrdDetailInfoList" parameterClass="NLCL1020CMsg" resultMap="result.getInvtyOrdDetailInfoList">
	     SELECT
	          IOD.INVTY_ORD_LINE_NUM   INVTYORDLINENUM_A1
	         ,IOD.MDSE_CD              MDSECD_A1
	         ,IOD.STK_STS_CD           STKSTSCD_AP
	         ,IOD.ORD_QTY              INVTYAVALQTY_AI
	         ,MD.MDSE_DESC_SHORT_TXT   MDSEDESCSHORTTXT_A1	
	     FROM
	          INVTY_ORD_DTL  IOD
	         ,ALL_MDSE_V     MD
	
	     WHERE
	          IOD.GLBL_CMPY_CD   =  #glblCmpyCd#
	     AND  IOD.INVTY_ORD_NUM  =  #invtyOrdNum#
	     AND  IOD.EZCANCELFLAG   =  '0' 
	     AND  IOD.GLBL_CMPY_CD   =  MD.GLBL_CMPY_CD(+) 
	     AND  IOD.MDSE_CD        =  MD.MDSE_CD(+) 
	     AND  IOD.EZCANCELFLAG   =  MD.EZCANCELFLAG(+) 
	
	     ORDER BY
	          IOD.INVTY_ORD_LINE_NUM  ASC
    </statement>
    
    <resultMap id="result.getInvtyOrdDetailInfoList" class="NLCL1020_ACMsg">
        <result property="invtyOrdLineNum_A1"        column="INVTYORDLINENUM_A1"        javaType="EZDCStringItem"/>
        <result property="mdseCd_A1"                 column="MDSECD_A1"                 javaType="EZDCStringItem"/>
        <result property="stkStsCd_AP"               column="STKSTSCD_AP"               javaType="EZDCStringItem"/>
        <result property="invtyAvalQty_AI"           column="INVTYAVALQTY_AI"           javaType="EZDCBigDecimalItem"/>
        <result property="mdseDescShortTxt_A"                 column="MDSEDESCSHORTTXT_A1"                 javaType="EZDCStringItem"/>
	</resultMap>
	
    <statement id="searchByTrxNum" parameterClass="Map" resultClass="Map">    
        SELECT
             IO.INVTY_ORD_NUM                   AS INVTY_ORD_NUM
<!-- START 2019/03/11 T.Ogura [QC#30705,DEL] -->
<!--        ,IO.INVTY_LOC_CD                    AS FROM_LOC_CD -->
<!--        ,IOD.INVTY_LOC_CD                   AS TO_LOC_CD -->
<!-- END   2019/03/11 T.Ogura [QC#30705,DEL] -->
            ,IO.LOC_STS_CD                      AS LOC_STS_CD
            ,IO.FIRST_INVTY_ORD_CMNT_TXT        AS FIRST_INVTY_ORD_CMNT_TXT
            ,IO.SCD_INVTY_ORD_CMNT_TXT          AS SCD_INVTY_ORD_CMNT_TXT
            ,IO.THIRD_INVTY_ORD_CMNT_TXT        AS THIRD_INVTY_ORD_CMNT_TXT
            ,TO_NUMBER(IOD.INVTY_ORD_LINE_NUM)  AS INVTY_ORD_LINE_NUM
            ,IOD.MDSE_CD                        AS MDSE_CD
            ,M.MDSE_DESC_SHORT_TXT              AS MDSE_DESC_SHORT_TXT
            ,IOD.STK_STS_CD                     AS STK_STS_CD
            ,IOD.ORD_QTY                        AS ORD_QTY
            ,NULL                               AS INVTY_AVAL_QTY
            ,DHVF.INVTY_LOC_NM                  AS FROM_INVTY_LOC_NM
            ,DHVT.INVTY_LOC_NM                  AS TO_INVTY_LOC_NM
            ,IOD.FROM_RTL_WH_CD                 AS FROM_RTL_WH_CD    <!-- 10/20/2015 add -->
            ,IOD.FROM_RTL_SWH_CD                AS FROM_RTL_SWH_CD  <!-- 10/20/2015 add -->
            ,IOD.TO_RTL_WH_CD                   AS TO_RTL_WH_CD     <!-- 10/20/2015 add -->
            ,IOD.TO_RTL_SWH_CD                  AS TO_RTL_SWH_CD    <!-- 10/20/2015 add -->
            <!-- START 2023/04/13 G.Quan [QC#61206, ADD] -->
            ,IOD.EZINTIME AS XX_REC_HIST_CRAT_TS
            ,IOD.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
            ,IOD.EZUPTIME AS XX_REC_HIST_UPD_TS
            ,IOD.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
            ,IOD.EZTABLEID AS XX_REC_HIST_TBL_NM
            <!-- END 2023/04/13 G.Quan [QC#61206, ADD] -->
        FROM   
             INVTY_ORD        IO
            ,INVTY_ORD_DTL    IOD
            ,ALL_MDSE_V       M
            ,DS_INVTY_LOC_V   DHVF
            ,DS_INVTY_LOC_V   DHVT
        WHERE
                 IO.INVTY_ORD_NUM       = IOD.INVTY_ORD_NUM
        AND      IOD.MDSE_CD            = M.MDSE_CD
        <!-- 10/20/2015 mod start -->
        <!--AND      IO.INVTY_LOC_CD        = DHVF.INVTY_LOC_CD -->
<!-- START 2019/03/11 T.Ogura [QC#30705,MOD] -->
<!--    AND      IOD.FROM_INVTY_LOC_CD  = DHVF.INVTY_LOC_CD -->
        AND      IOD.INVTY_LOC_CD       = DHVF.INVTY_LOC_CD
<!-- END   2019/03/11 T.Ogura [QC#30705,MOD] -->
        <!-- 10/20/2015 mod end -->
<!-- START 2019/03/11 T.Ogura [QC#30705,MOD] -->
<!--    AND      IOD.INVTY_LOC_CD       = DHVT.INVTY_LOC_CD -->
        AND      IOD.TO_INVTY_LOC_CD    = DHVT.INVTY_LOC_CD
<!-- END   2019/03/11 T.Ogura [QC#30705,MOD] -->
        AND      IO.GLBL_CMPY_CD        = #glblCmpyCd#
        AND      IOD.GLBL_CMPY_CD       = #glblCmpyCd#
        AND      M.GLBL_CMPY_CD         = #glblCmpyCd#
        AND      DHVF.GLBL_CMPY_CD      = #glblCmpyCd#
        AND      DHVT.GLBL_CMPY_CD      = #glblCmpyCd#
        AND      IO.EZCANCELFLAG        = '0'
        AND      IOD.EZCANCELFLAG       = '0'
        AND      M.EZCANCELFLAG         = '0'
        AND      DHVF.EZCANCELFLAG      = '0'
        AND      DHVT.EZCANCELFLAG      = '0'
        AND      IO.INVTY_ORD_TP_CD     = #invtyOrdTpCd#
        AND      IO.INVTY_ORD_NUM       = #invtyOrdNum#
        ORDER BY 
             IO.INVTY_ORD_NUM
            ,IOD.INVTY_ORD_LINE_NUM
    </statement>


	<statement id="getResultForCsv" parameterClass="Map" resultClass="Map">
		SELECT 
			 INV.INVTY_LOC_CD                                           AS WH_CD
			,INV.MDSE_CD                                                AS ITEM_CD
			,MDS.MDSE_DESC_SHORT_TXT                                    AS ITEM_NM
			,MDS.FIRST_PROD_CTRL_CD || ' : ' || MDS.FIRST_PROD_CTRL_NM  AS PROD_DESC
			,INV.LOC_STS_CD || ' : ' || LS.LOC_STS_NM                   AS LOC_DESC
			,INV.STK_STS_CD                                             AS STK_STS_CD
			,INVTY_AVAL_QTY                                             AS AVAL_QTY
		FROM
			 INVTY               INV
			,ALL_MDSE_V          MDS
			,DS_INVTY_LOC_V      DINV
			,LOC_STS             LS
		WHERE
		       INV.MDSE_CD            = MDS.MDSE_CD
		AND  INV.LOC_STS_CD           = LS.LOC_STS_CD
		AND  INV.GLBL_CMPY_CD         = #glblCmpyCd#
		AND  MDS.GLBL_CMPY_CD         = #glblCmpyCd#
		AND  LS.GLBL_CMPY_CD          = #glblCmpyCd#
		AND  DINV.GLBL_CMPY_CD        = #glblCmpyCd#
		AND  INV.EZCANCELFLAG         = '0'
		AND  MDS.EZCANCELFLAG         = '0'
		AND  LS.EZCANCELFLAG          = '0'
		AND  INV.LOC_STS_CD           = #dcStock#
		AND  INV.INVTY_AVAL_QTY       &gt; 0
		AND  DINV.RGTN_STS_CD         = #readyForOrderTaking#
		AND  NVL(DINV.EFF_THRU_DT, '99991231') &gt;= #salesDate#
		AND
		(
			    DINV.INVTY_LOC_CD     = #locFrom#
		    <isNotNull property="locTo">
			OR  DINV.INVTY_LOC_CD     = #locTo#
			</isNotNull>
		) 
		AND   INV.INVTY_LOC_CD      = DINV.INVTY_LOC_CD
		GROUP BY
			 INV.MDSE_CD
			,MDS.MDSE_DESC_SHORT_TXT
			,MDS.FIRST_PROD_CTRL_CD
			,MDS.FIRST_PROD_CTRL_NM
			,INV.STK_STS_CD
			,INV.INVTY_LOC_CD
			,INV.LOC_STS_CD
			,LS.LOC_STS_NM
			,INV.INVTY_AVAL_QTY
		ORDER BY 
			 PROD_DESC
			,ITEM_CD
			,STK_STS_CD
			,WH_CD
	</statement>
	
</sqlMap>
