<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NPZC132001">

<statement id="sendPoInfo" parameterClass="Map" resultClass="Map">
     SELECT 
         PO.PO_ORD_NUM
        ,PO.PO_APVL_DT
        ,PO.VND_CD
        ,PO.VND_ISS_ORD_NUM
        ,PO.VND_DROP_SHIP_FLG
        ,PO.CARR_ACCT_NUM
        ,PO.PRCH_GRP_CD
        ,PO.DS_PO_TP_CD
        ,PO.PO_QLFY_CD
        ,PO.RTRN_SHIP_TO_RTL_WH_CD
        ,PO.VND_PMT_TERM_DESC_TXT
        ,PO.DEST_RTL_WH_CD
        ,PO.PO_ORD_SRC_CD
        ,PD.CARR_CD
        ,PD.CUST_ISS_PO_NUM
        ,PD.ETA_DT
        ,PD.MDSE_CD
        ,PD.PO_ORD_DTL_LINE_NUM
        ,PD.PO_QTY
        ,PD.SHIP_TO_ADDL_LOC_NM
        ,PD.SHIP_TO_CTY_ADDR
        ,PD.SHIP_TO_FIRST_LINE_ADDR
        ,PD.SHIP_TO_FRTH_LINE_ADDR
        ,PD.SHIP_TO_LOC_NM
        ,PD.SHIP_TO_POST_CD
        ,PD.SHIP_TO_SCD_LINE_ADDR
        ,PD.SHIP_TO_ST_CD
        ,PD.SHIP_TO_THIRD_LINE_ADDR
        ,NVL(PD.SHPG_SVC_LVL_CD , DPT.SHPG_SVC_LVL_CD) SHPG_SVC_LVL_CD
        ,PD.SHIP_TO_CUST_CD
        ,PD.CTAC_PSN_NM
        ,PD.FRT_COND_CD
        ,PD.ENT_DEAL_NET_UNIT_PRC_AMT
        ,PD.INVTY_LOC_CD
        ,PD.VND_INVTY_LOC_CD
        ,PD.ASL_MDSE_CD
        ,CPO.CPO_ORD_NUM
        ,CD.CUST_MDSE_CD
        ,PM.PO_MSG_TXT
        ,TM.TECH_NM
        ,DPT.DS_PO_TP_NM
        ,RW.WH_OWNR_CD
        ,RW.FIRST_REF_CMNT_TXT || RW.RTL_WH_CD AS CSA_LOC_CD
        ,PD.SHIP_TO_CTRY_CD
        <!-- START 2023/02/17 TZ.Win [QC#60966, ADD] -->
        ,PD.RQST_SHIP_DT
        <!-- END 2023/02/17 TZ.Win [QC#60966, ADD] -->
    FROM
        PO        PO
       ,PO_MSG    PM
       ,TECH_MSTR TM
       ,PO_DTL    PD
       ,CPO       CPO
       ,CPO_DTL   CD
       ,DS_PO_TP  DPT
       ,RTL_WH    RW
    WHERE 
    1=1
    AND PO.GLBL_CMPY_CD           = #glblCmpyCd#
    AND PO.EZCANCELFLAG           = '0'
    AND PM.EZCANCELFLAG(+)        = '0'
    AND TM.EZCANCELFLAG(+)        = '0'
    AND PD.EZCANCELFLAG           = '0'
    AND CPO.EZCANCELFLAG(+)       = '0'
    AND CD.EZCANCELFLAG(+)        = '0'
    AND RW.EZCANCELFLAG(+)        = '0'
    AND DPT.EZCANCELFLAG          = '0'
    AND PO.GLBL_CMPY_CD           = TM.GLBL_CMPY_CD(+)
    AND PO.GLBL_CMPY_CD           = PM.GLBL_CMPY_CD(+)
    AND PO.GLBL_CMPY_CD           = PD.GLBL_CMPY_CD
    AND PD.GLBL_CMPY_CD           = CPO.GLBL_CMPY_CD(+)
    AND PD.GLBL_CMPY_CD           = CD.GLBL_CMPY_CD(+)
    AND PO.GLBL_CMPY_CD           = DPT.GLBL_CMPY_CD
    AND PO.GLBL_CMPY_CD           = RW.GLBL_CMPY_CD(+)
    AND PO.PO_ORD_NUM             = #poOrdNum#
    AND PO.RQST_TECH_TOC_CD       = TM.TECH_TOC_CD(+)
    AND PO.PO_ORD_NUM             = PM.PO_ORD_NUM(+)
    AND PO.DEST_RTL_WH_CD         = RW.RTL_WH_CD(+)
    AND PM.PO_MSG_TP_CD(+)        = #poMsgTpCd#
    AND PM.PO_MSG_SEG_ID(+)       = #poMsgSegId#
    AND PO.PO_ORD_NUM             = PD.PO_ORD_NUM
    AND PO.PO_STS_CD              = PD.PO_STS_CD
    AND PD.PO_STS_CD              = #poStsCd#
    AND PD.PO_SEND_TS           IS NULL
    AND PD.PO_MDSE_CMPSN_TP_CD  != #poMdseCmpsnCd#
    AND PD.CPO_ORD_NUM            = CD.CPO_ORD_NUM(+)
    AND PD.CPO_DTL_LINE_NUM       = CD.CPO_DTL_LINE_NUM(+)
    AND PD.CPO_DTL_LINE_SUB_NUM   = CD.CPO_DTL_LINE_SUB_NUM(+)
    AND PD.CPO_ORD_NUM            = CPO.CPO_ORD_NUM(+)
    AND PO.DS_PO_TP_CD            = DPT.DS_PO_TP_CD
    ORDER BY PD.PO_ORD_DTL_LINE_NUM
 </statement>
 
   <statement id="getTrdPtnrShpgCondCdInfo" parameterClass="Map" resultClass="Map">
    SELECT
         TPSC.TRD_PTNR_SHPG_COND_CD
    FROM 
         TRD_PTNR_SHPG_COND_XREF TPSC
    WHERE 
        1=1 
    AND TPSC.GLBL_CMPY_CD = #glblCmpyCd#
    <isNotNull property="shpgSvcLvlCd">
    AND TPSC.SHPG_SVC_LVL_CD = #shpgSvcLvlCd#
    </isNotNull>
        <isNull property="shpgSvcLvlCd">
    AND TPSC.SHPG_SVC_LVL_CD = '*'
    </isNull>
    <isNotNull property="dsPoTpCd">
    AND TPSC.DS_PO_TP_CD = #dsPoTpCd#
    </isNotNull>
    <isNull property="dsPoTpCd">
    AND TPSC.DS_PO_TP_CD = '*'
    </isNull>
    <isNotNull property="carrCd">
    AND TPSC.CARR_CD = #carrCd#
    </isNotNull>
    <isNull property="carrCd">
    AND TPSC.CARR_CD = '*'
    </isNull>
    AND TPSC.EZCANCELFLAG = '0'
    AND ROWNUM = 1
 </statement>
 
    <statement id="getTrdPtnrShpgXRefInfo" parameterClass="Map" resultClass="Map">
    SELECT
         TPSR.TRD_PTNR_CARR_CD
        ,TPSR.TRD_PTNR_SHPG_SVC_LVL_CD
        ,TPSR.TRD_PTNR_SHIP_VIA_CD
        ,TPSR.TRD_PTNR_FRT_CHRG_METH_CD
        ,TPSR.CARR_TP_CD
    FROM 
         TRD_PTNR_SHPG_X_REF TPSR
    WHERE 
        1=1 
    AND TPSR.GLBL_CMPY_CD    = #glblCmpyCd#
    AND TPSR.EZCANCELFLAG    = '0'
    AND TPSR.VND_CD          = #vndCd#
    AND TPSR.CARR_CD         = #carrCd#
    AND TPSR.SHPG_SVC_LCL_CD = #shpgSvcLclCd#
    AND TPSR.FRT_COND_CD     = #frtCondCd#
    AND ROWNUM               = 1
     </statement>
 
    <statement id="searchVndShipToXrefInv" parameterClass="Map" resultClass="String">
    SELECT
        VSTX.VND_LOC_CD
    FROM
        VND_SHIP_TO_XREF VSTX
    WHERE 1=1
     AND VSTX.EZCANCELFLAG    = '0'
     AND VSTX.GLBL_CMPY_CD    = #glblCmpyCd#
     AND VSTX.VND_XREF_TP_CD  = #vndXrefTpCd#
     AND TO_DATE(NVL(VSTX.EFF_FROM_DT , #eftFromDt#), 'YYYY/MM/DD')  &lt; = TO_DATE(#slsDate# , 'YYYY/MM/DD' )
     AND TO_DATE(NVL(VSTX.EFF_THRU_DT , #eftThruDt#), 'YYYY/MM/DD')  &gt; = TO_DATE(#slsDate# , 'YYYY/MM/DD' )
    <isNotNull property="prchGrpCd">
     AND VSTX.PRCH_GRP_CD     = #prchGrpCd#
    </isNotNull>
    <isNotNull property="invtyLocCd">
     AND VSTX.INVTY_LOC_CD    = #invtyLocCd#
    </isNotNull>
     AND ROWNUM = 1
    </statement>

    <statement id="searchVndShipToXrefRtl" parameterClass="Map" resultClass="String">
    SELECT
        VSTX.VND_LOC_CD
    FROM
        VND_SHIP_TO_XREF VSTX
    WHERE 1=1
     AND VSTX.EZCANCELFLAG    = '0'
     AND VSTX.GLBL_CMPY_CD    = #glblCmpyCd#
     AND VSTX.VND_XREF_TP_CD  = #vndXrefTpCd#
     AND TO_DATE(NVL(VSTX.EFF_FROM_DT , #eftFromDt#), 'YYYY/MM/DD')  &lt; = TO_DATE(#slsDate# , 'YYYY/MM/DD' )
     AND TO_DATE(NVL(VSTX.EFF_THRU_DT , #eftThruDt#), 'YYYY/MM/DD')  &gt; = TO_DATE(#slsDate# , 'YYYY/MM/DD' )
    <isNotNull property="prchGrpCd">
     AND VSTX.PRCH_GRP_CD     = #prchGrpCd#
    </isNotNull>
    <isNotNull property="rtlWhCd">
     AND VSTX.RTL_WH_CD     = #rtlWhCd#
    </isNotNull>
     AND ROWNUM = 1
    </statement>
    <!-- 08/08/2017 CITS S.Endo Mod Sol#035(QC#18108) START -->
    <statement id="getMsgs" parameterClass="Map" resultClass="Map">
    SELECT
         PM.PO_MSG_TXT
        ,PM.PO_MSG_TP_CD
        ,PM.PO_MSG_SEG_ID
    FROM
        PO_MSG PM
    WHERE
        PM.GLBL_CMPY_CD = #glblCmpyCd#
    AND PM.PO_ORD_NUM   = #poOrdNum#
    AND PM.PO_MSG_TP_CD IN (#poMsgTpCdSi#,#poMsgTpCdSn#)
    AND PM.EZCANCELFLAG = '0'
    ORDER BY PO_MSG_TP_CD DESC, PO_MSG_SEG_ID ASC
    </statement>
    <!-- 08/08/2017 CITS S.Endo Mod Sol#035(QC#18108) END -->

    <!-- QC#23356 START -->
    <statement id="getcarrTpCd" parameterClass="Map" resultClass="String">
    SELECT
         VND.CARR_TP_CD
    FROM
        VND VND
    WHERE
        VND.GLBL_CMPY_CD = #glblCmpyCd#
    AND VND.VND_CD       = #carrCd#
    AND VND.EZCANCELFLAG = '0'
    AND ROWNUM = 1
    </statement>

    <statement id="getCpoInfo" parameterClass="Map" resultClass="Map">
    SELECT
         CPO.DS_ORD_CATG_CD
        <!-- QC#58769 Start -->
        ,CPO.DS_ORD_TP_CD
        <!-- QC#58769 End -->
    FROM
        CPO CPO
    WHERE
        CPO.GLBL_CMPY_CD = #glblCmpyCd#
    AND CPO.CPO_ORD_NUM  = #cpoOrdNum#
    AND CPO.EZCANCELFLAG = '0'
    AND ROWNUM = 1
    </statement>
    
    <statement id="getCarrAcctNum" parameterClass="Map" resultClass="Map">
    SELECT
         CAX.CARR_ACCT_NUM
        ,CAX.CARR_CD
    FROM
        CARR_ACCT_XREF CAX
    WHERE
        CAX.GLBL_CMPY_CD = #glblCmpyCd#
    AND CAX.CARR_TP_CD  = #carrTpCd#
    <isNotNull property="dsOrdCatgCd">
     AND CAX.DS_ORD_CATG_CD     = #dsOrdCatgCd#
    </isNotNull>
    <isNotNull property="dsOrdTpCd">
    <!-- QC#58769 Start -->
     AND CAX.DS_ORD_TP_CD    = #dsOrdTpCd#
     <!-- QC#58769 End -->
    </isNotNull>
    <isNotNull property="prchGrpCd">
     AND CAX.PRCH_GRP_CD     = #prchGrpCd#
    </isNotNull>
    <isNotNull property="poOrdSrcCd">
     AND CAX.PO_ORD_SRC_CD     = #poOrdSrcCd#
    </isNotNull>
    AND CAX.EZCANCELFLAG = '0'
    AND ROWNUM = 1
    </statement>
    <!-- QC#23356 END -->
    <statement id="getCarrSvcLvlCd" parameterClass="Map" resultClass="Map">
        SELECT
            SSLC.CARR_SVC_LVL_CD
        FROM
            SHPG_SVC_LVL_CARR_RELN SSLC
        WHERE
            SSLC.GLBL_CMPY_CD             = #glblCmpyCd#
        AND SSLC.SHPG_SVC_LVL_CD          = #shpgSvcLvlCd#
        AND SSLC.CARR_CD                  = #carrCd#
        AND SSLC.EZCANCELFLAG             = '0'
    </statement>
</sqlMap>
