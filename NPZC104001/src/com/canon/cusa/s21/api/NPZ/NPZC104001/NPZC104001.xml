<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPZC104001">

    <!-- START 2022/03/24 A.Cullano [QC#59359, ADD] -->
    <!-- ==== Type Aliases ==== -->
    <typeAlias alias="SoInfo"             type="com.canon.cusa.s21.api.NPZ.NPZC104001.SoInfo"/>
    <!-- END 2022/03/24 A.Cullano [QC#59359, ADD] -->
    <statement id="getShipToCust" parameterClass="Map" resultClass="Map">
        SELECT
            SHIP.SHIP_TO_CUST_CD
           ,SHIP.LOC_NM
           ,SHIP.ADDL_LOC_NM
           ,SHIP.FIRST_LINE_ADDR
           ,SHIP.SCD_LINE_ADDR
           ,SHIP.THIRD_LINE_ADDR
           ,SHIP.FRTH_LINE_ADDR
           ,SHIP.FIRST_REF_CMNT_TXT
           ,SHIP.SCD_REF_CMNT_TXT
           ,SHIP.CTY_ADDR
           ,SHIP.ST_CD
           ,SHIP.PROV_NM
           ,SHIP.POST_CD
           ,SHIP.CTRY_CD
           ,CNTY.CNTY_NM
           ,ACCT.DS_ACCT_NM
        FROM
            SHIP_TO_CUST  SHIP
           ,CNTY          CNTY
           ,SELL_TO_CUST  ACCT
        WHERE
            SHIP.GLBL_CMPY_CD        = #GLBL_CMPY_CD#
        AND SHIP.SHIP_TO_CUST_CD     = #SHIP_TO_CUST_CD#
        AND SHIP.RGTN_STS_CD         = #RGTN_STS_CD#
        AND SHIP.EZCANCELFLAG        = '0'
        AND SHIP.GLBL_CMPY_CD        = CNTY.GLBL_CMPY_CD(+)
        AND SHIP.CNTY_PK             = CNTY.CNTY_PK(+)
        AND CNTY.EZCANCELFLAG(+)     = '0'
        AND SHIP.GLBL_CMPY_CD        = ACCT.GLBL_CMPY_CD(+)
        AND SHIP.SELL_TO_CUST_CD     = ACCT.SELL_TO_CUST_CD(+)
        AND ACCT.EZCANCELFLAG(+)        = '0'
        AND ROWNUM                   = '1'
        ORDER BY
            SHIP.SHIP_TO_CUST_CD ASC
    </statement>

    <statement id="getVendor" parameterClass="Map" resultClass="Map">
        SELECT
            VND.LOC_NM
           ,VND.INTL_VND_FLG
           ,VND.TRSMT_METH_TP_CD
           ,VND.FAX_NUM
           ,VND.VND_PMT_TERM_CD
           ,VND.VND_PMT_TERM_DESC_TXT
           ,VND.DEAL_CCY_CD
           ,VND.SEND_PO_EML_ADDR
           ,PRV.PRNT_VND_CD
           ,PRV.PRNT_VND_NM
           ,PRV.VND_PMT_TERM_CD
           ,PRV.VND_PMT_TERM_DESC_TXT
        FROM
            VND                    VND
           ,VND_TP_RELN            VTP
           ,PRNT_VND               PRV
        WHERE
            VND.GLBL_CMPY_CD       = #GLBL_CMPY_CD#
        AND VND.VND_CD             = #VND_CD#
        AND VND.RGTN_STS_CD        = #RGTN_STS_CD#
        AND VND.EZCANCELFLAG       = '0'
        AND VND.GLBL_CMPY_CD       = VTP.GLBL_CMPY_CD
        AND VND.VND_CD             = VTP.VND_CD
        AND VTP.VND_TP_CD          = #VND_TP_CD#
        AND VTP.EZCANCELFLAG       = '0'
        AND VND.GLBL_CMPY_CD       = PRV.GLBL_CMPY_CD
        AND VND.PRNT_VND_PK        = PRV.PRNT_VND_PK
        AND PRV.EZCANCELFLAG       = '0'
        AND ROWNUM                 = '1'
    </statement>

    <statement id="getVendorBuyBack" parameterClass="Map" resultClass="Map">
        SELECT
            VND.LOC_NM
           ,VND.INTL_VND_FLG
           ,VND.TRSMT_METH_TP_CD
           ,VND.FAX_NUM
           ,VND.VND_PMT_TERM_CD
           ,VND.VND_PMT_TERM_DESC_TXT
           ,VND.DEAL_CCY_CD
           ,VND.SEND_PO_EML_ADDR
           ,PRV.PRNT_VND_CD
           ,PRV.PRNT_VND_NM
           ,PRV.VND_PMT_TERM_CD
           ,PRV.VND_PMT_TERM_DESC_TXT
           ,GLC.STD_CCY_CD
        FROM
            VND                    VND
           ,VND_TP_RELN            VTP
           ,PRNT_VND               PRV
           ,GLBL_CMPY              GLC
        WHERE
            VND.GLBL_CMPY_CD       = #GLBL_CMPY_CD#
        AND VND.VND_CD             = #VND_CD#
        AND VND.RGTN_STS_CD        = #RGTN_STS_CD#
        AND VND.EZCANCELFLAG       = '0'
        AND VND.GLBL_CMPY_CD       = VTP.GLBL_CMPY_CD
        AND VND.VND_CD             = VTP.VND_CD
        AND VTP.VND_TP_CD          = #VND_TP_CD#
        AND VTP.EZCANCELFLAG       = '0'
        AND VND.GLBL_CMPY_CD       = PRV.GLBL_CMPY_CD
        AND VND.PRNT_VND_PK        = PRV.PRNT_VND_PK
        AND PRV.EZCANCELFLAG       = '0'
        AND VND.GLBL_CMPY_CD       = GLC.GLBL_CMPY_CD
        AND GLC.EZCANCELFLAG       = '0'
        AND ROWNUM                 = '1'
    </statement>

    <statement id="getRetailWarehouse" parameterClass="Map" resultClass="Map">
        SELECT
            RSTR.RTRN_SHIP_TO_RTL_WH_CD
        FROM
            RTRN_SHIP_TO_RTL_WH_XREF RSTR
        WHERE
            RSTR.GLBL_CMPY_CD           = #GLBL_CMPY_CD#
        AND RSTR.SHIP_TO_ST_CD          = #ST_CD#
        AND RSTR.FROM_SHIP_TO_POST_CD   &lt;= #POST_CD#
        AND RSTR.TO_SHIP_TO_POST_CD     &gt;= #POST_CD#
        AND RSTR.EZCANCELFLAG           = '0'
        AND ROWNUM                 = '1'
        ORDER BY
            RSTR.FROM_SHIP_TO_POST_CD
           ,RSTR.TO_SHIP_TO_POST_CD
    </statement>

    <statement id="getRetailWarehouseDefault" parameterClass="Map" resultClass="Map">
        SELECT
            RSTR.RTRN_SHIP_TO_RTL_WH_CD
        FROM
            RTRN_SHIP_TO_RTL_WH_XREF RSTR
        WHERE
            RSTR.GLBL_CMPY_CD           = #GLBL_CMPY_CD#
        AND RSTR.SHIP_TO_ST_CD          = #STAR#
        AND RSTR.FROM_SHIP_TO_POST_CD   = #STAR#
        AND RSTR.TO_SHIP_TO_POST_CD     = #STAR#
        AND RSTR.EZCANCELFLAG           = '0'
        AND ROWNUM                 = '1'
    </statement>

    <statement id="getRtlWhSrcDest" parameterClass="Map" resultClass="Map">
        SELECT
            SRC.GLBL_CMPY_CD
        FROM
            RTL_WH SRC
           ,RTL_WH DES
        WHERE
            SRC.GLBL_CMPY_CD       = #GLBL_CMPY_CD#
        AND SRC.RTL_WH_CD          = #SRC_RTL_WH_CD#
        AND SRC.EZCANCELFLAG       = '0'
        AND SRC.GLBL_CMPY_CD       = DES.GLBL_CMPY_CD
        AND SRC.PHYS_WH_CD         = DES.PHYS_WH_CD
        AND DES.RTL_WH_CD          = #DEST_RTL_WH_CD#
        AND DES.EZCANCELFLAG       = '0'
        AND ROWNUM                 = '1'
    </statement>

    <statement id="getMdse" parameterClass="Map" resultClass="Map">
        SELECT
            MDSE.MDSE_NM
           ,MDSE.INVTY_CTRL_FLG
           ,MDSE.RCV_SER_TAKE_FLG
           ,MDSE.DSCTN_FLG
           ,MDSE.PRNT_CMPY_SET_MDSE_FLG
           ,MDSE.MDSE_DESC_SHORT_TXT
        FROM
            MDSE         MDSE
        WHERE
            MDSE.GLBL_CMPY_CD    = #GLBL_CMPY_CD#
        AND MDSE.MDSE_CD         = #MDSE_CD#
        AND MDSE.RGTN_STS_CD     = #RGTN_STS_CD#
        AND MDSE.EZCANCELFLAG    = '0'
    </statement>

    <statement id="getConfigComponet" parameterClass="Map" resultClass="Map">
        SELECT
            MACH.SVC_CONFIG_MSTR_PK
           ,MACH.SVC_MACH_MSTR_PK
           ,MACH.SVC_MACH_MSTR_LOC_STS_CD
           ,MACH.MDSE_CD
           ,MACH.CUR_LOC_NUM
           ,MACH.SER_NUM
           ,MDSE.INSTL_BASE_CTRL_FLG
        FROM
            SVC_MACH_MSTR    MACH
           ,MDSE             MDSE
        WHERE
            MACH.GLBL_CMPY_CD               = #GLBL_CMPY_CD#
        AND MACH.SVC_CONFIG_MSTR_PK         = #SVC_CONFIG_MSTR_PK#
        AND MACH.SVC_MACH_MSTR_STS_CD       IN (#CREATED#, #REMOVED#)
        AND MACH.CUR_LOC_NUM                LIKE (#CUR_LOC_NUM#)
        AND MACH.SVC_MACH_MAINT_AVAL_FLG    = #SVC_MACH_MAINT_AVAL_FLG#
        AND MACH.EZCANCELFLAG               = '0'
        AND MACH.GLBL_CMPY_CD               = MDSE.GLBL_CMPY_CD
        AND MACH.MDSE_CD                    = MDSE.MDSE_CD
        AND MDSE.EZCANCELFLAG               = '0'
        ORDER BY
            MACH.MDSE_CD
           ,MACH.CUR_LOC_NUM
           ,MACH.SER_NUM
    </statement>

    <statement id="getCoaProjAcct" parameterClass="Map" resultClass="Map">
        SELECT
            PRAC.COA_ACCT_CD
        FROM
            MDSE             MDSE
           ,COA_PROJ         PROJ
           ,COA_PROJ_ACCT    PRAC
           ,PO_ACCT_TP       POAC
        WHERE
            MDSE.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND MDSE.EZCANCELFLAG             = '0'
        AND MDSE.MDSE_CD                  = #MDSE_CD#
        AND MDSE.GLBL_CMPY_CD             = PROJ.GLBL_CMPY_CD
        AND MDSE.COA_MDSE_TP_CD           = PROJ.COA_PROJ_CD
        AND PROJ.EZCANCELFLAG             = '0'
        AND PROJ.GLBL_CMPY_CD             = PRAC.GLBL_CMPY_CD
        AND PROJ.COA_PROJ_CD              = PRAC.COA_PROJ_CD
        AND PRAC.COA_PROJ_ACCT_TP_CD      = POAC.COA_PROJ_ACCT_TP_CD
        AND PRAC.EZCANCELFLAG             = '0'
        AND PRAC.GLBL_CMPY_CD             = POAC.GLBL_CMPY_CD
        AND POAC.PO_ACCT_TP_CD            = #PO_ACCT_TP_CD#
        AND POAC.EZCANCELFLAG             = '0'
    </statement>

    <statement id="getSetComponent" parameterClass="Map" resultClass="Map">
        SELECT
            CMPS.CHILD_MDSE_CD
           ,CMPS.CHILD_MDSE_QTY
           ,MDSE.MDSE_NM
           ,MDSE.RCV_SER_TAKE_FLG
           ,MDSE.INVTY_CTRL_FLG
           ,MDSE.MDSE_DESC_SHORT_TXT
           ,CPA.COA_ACCT_CD
        FROM
            CMPSN            CMPS
           ,MDSE             MDSE
           ,COA_PROJ         CP
           ,COA_PROJ_ACCT    CPA
           ,PO_ACCT_TP       PAT
        WHERE
            CMPS.GLBL_CMPY_CD                    = #GLBL_CMPY_CD#
        AND CMPS.PRNT_MDSE_CD                    = #PRNT_MDSE_CD#
        AND CMPS.MDSE_CMPSN_TP_CD                = #MDSE_CMPSN_TP_CD#
        AND NVL(CMPS.EFF_FROM_DT, '00000000')    &lt;= #PO_SUBMT_TS#
        AND NVL(CMPS.EFF_THRU_DT, '99991231')    &gt;= #PO_SUBMT_TS#
        AND CMPS.EZCANCELFLAG                    = '0'
        AND CMPS.GLBL_CMPY_CD                    = MDSE.GLBL_CMPY_CD
        AND CMPS.CHILD_MDSE_CD                   = MDSE.MDSE_CD
        AND MDSE.RGTN_STS_CD                     = #RGTN_STS_CD#
        AND MDSE.EZCANCELFLAG                    = '0'
        AND MDSE.GLBL_CMPY_CD                    = CP.GLBL_CMPY_CD
        AND MDSE.COA_MDSE_TP_CD                  = CP.COA_PROJ_CD
        AND CP.EZCANCELFLAG                      = '0'
        AND CP.GLBL_CMPY_CD                      = CPA.GLBL_CMPY_CD
        AND CP.COA_PROJ_CD                       = CPA.COA_PROJ_CD
        AND CPA.EZCANCELFLAG                     = '0'
        AND CPA.GLBL_CMPY_CD                     = PAT.GLBL_CMPY_CD
        AND CPA.COA_PROJ_ACCT_TP_CD              = PAT.COA_PROJ_ACCT_TP_CD
        AND PAT.PO_ACCT_TP_CD                    = #PO_ACCT_TP_CD#
        AND PAT.EZCANCELFLAG                     = '0'
        UNION ALL
        SELECT
            MDSE.MDSE_CD
           ,CMPS.CHILD_MDSE_QTY
           ,MDSE.MDSE_NM
           ,MDSE.RCV_SER_TAKE_FLG
           ,MDSE.INVTY_CTRL_FLG
           ,MDSE.MDSE_DESC_SHORT_TXT
           ,CPA.COA_ACCT_CD
        FROM
            CMPSN            CMPS
           ,ORD_TAKE_MDSE    OTM
           ,MDSE             MDSE
           ,COA_PROJ         CP
           ,COA_PROJ_ACCT    CPA
           ,PO_ACCT_TP       PAT
        WHERE
            CMPS.GLBL_CMPY_CD                    = #GLBL_CMPY_CD#
        AND CMPS.PRNT_MDSE_CD                    = #PRNT_MDSE_CD#
        AND CMPS.MDSE_CMPSN_TP_CD                = #MDSE_CMPSN_TP_CD_ORDERTAKE#
        AND NVL(CMPS.EFF_FROM_DT, '00000000')    &lt;= #PO_SUBMT_TS#
        AND NVL(CMPS.EFF_THRU_DT, '99991231')    &gt;= #PO_SUBMT_TS#
        AND CMPS.EZCANCELFLAG                    = '0'
        AND CMPS.GLBL_CMPY_CD                    = OTM.GLBL_CMPY_CD
        AND CMPS.CHILD_ORD_TAKE_MDSE_CD          = OTM.ORD_TAKE_MDSE_CD
        AND OTM.EZCANCELFLAG                     = '0'
        AND OTM.GLBL_CMPY_CD                     = MDSE.GLBL_CMPY_CD
        AND OTM.MDSE_CD                          = MDSE.MDSE_CD
        AND MDSE.RGTN_STS_CD                     = #RGTN_STS_CD#
        AND MDSE.EZCANCELFLAG                    = '0'
        AND MDSE.GLBL_CMPY_CD                    = CP.GLBL_CMPY_CD
        AND MDSE.COA_MDSE_TP_CD                  = CP.COA_PROJ_CD
        AND CP.EZCANCELFLAG                      = '0'
        AND CP.GLBL_CMPY_CD                      = CPA.GLBL_CMPY_CD
        AND CP.COA_PROJ_CD                       = CPA.COA_PROJ_CD
        AND CPA.EZCANCELFLAG                     = '0'
        AND CPA.GLBL_CMPY_CD                     = PAT.GLBL_CMPY_CD
        AND CPA.COA_PROJ_ACCT_TP_CD              = PAT.COA_PROJ_ACCT_TP_CD
        AND PAT.PO_ACCT_TP_CD                    = #PO_ACCT_TP_CD#
        AND PAT.EZCANCELFLAG                     = '0'
    </statement>

    <statement id="getRwsQty" parameterClass="Map" resultClass="BigDecimal">
        WITH PO_BAL AS (
            SELECT
                PD.GLBL_CMPY_CD 
               ,PD.PO_ORD_NUM
               ,PD.PO_ORD_DTL_LINE_NUM
               ,PD.PO_BAL_QTY
            FROM
                PO_DTL PD
            WHERE
                PD.GLBL_CMPY_CD        = #GLBL_CMPY_CD#
            AND PD.PO_ORD_NUM          = #PO_ORD_NUM#
            AND PD.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
            AND PD.EZCANCELFLAG        = '0'
        ), OPEN_RWS AS (
            SELECT
                RWSH.GLBL_CMPY_CD                              AS GLBL_CMPY_CD
               ,RWSH.PO_RCV_TRX_HDR_NUM                        AS PO_ORD_NUM
               ,RWSD.PO_RCV_TRX_LINE_NUM                       AS PO_ORD_DTL_LINE_NUM
               ,SUM(RWSD.RWS_QTY) - SUM(RWSD.RWS_PUT_AWAY_QTY) AS RWS_BAL_QTY
            FROM
                RWS_HDR  RWSH
               ,RWS_DTL  RWSD
            WHERE
                RWSH.GLBL_CMPY_CD        = #GLBL_CMPY_CD#
            AND RWSH.PO_RCV_TRX_HDR_NUM  = #PO_ORD_NUM#
            AND RWSH.RWS_STS_CD         IN (#PRINTED#, #RECEIVING#)
            AND RWSH.EZCANCELFLAG        = '0'
            AND RWSH.GLBL_CMPY_CD        = RWSD.GLBL_CMPY_CD
            AND RWSH.RWS_NUM             = RWSD.RWS_NUM
            AND RWSD.PO_RCV_TRX_LINE_NUM = #poOrdDtlLineNum#
            AND RWSD.EZCANCELFLAG        = '0'
            GROUP BY
                RWSH.GLBL_CMPY_CD
               ,RWSH.PO_RCV_TRX_HDR_NUM
               ,RWSD.PO_RCV_TRX_LINE_NUM
        )
        SELECT
            PB.PO_BAL_QTY - NVL(RWS.RWS_BAL_QTY, 0) AS RWS_QTY
        FROM
            PO_BAL   PB
           ,OPEN_RWS RWS
        WHERE
            PB.GLBL_CMPY_CD        = RWS.GLBL_CMPY_CD(+)
        AND PB.PO_ORD_NUM          = RWS.PO_ORD_NUM(+)
        AND PB.PO_ORD_DTL_LINE_NUM = RWS.PO_ORD_DTL_LINE_NUM(+)
    </statement>

    <statement id="getMaxRwsRefNum" parameterClass="Map" resultClass="Map">
        SELECT
            MAX(RH.RWS_REF_NUM) RWS_REF_NUM
        FROM
            RWS_HDR RH
        WHERE
            RH.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND RH.WH_CD                    = #DEST_RTL_WH_CD#
        AND REGEXP_LIKE(RH.RWS_REF_NUM, #RWS_REF_NUM#)
        AND RH.EZCANCELFLAG             = '0'
    </statement>

    <statement id="getSerialList" parameterClass="Map" resultClass="Map">
        SELECT
            RWSD.RWS_DTL_LINE_NUM
           ,POSE.MDSE_CD
           ,POSE.SER_NUM
        FROM
            RWS_DTL     RWSD
           ,RWS_HDR     RWSH
           ,PO_DTL      PODT
           ,PO_SER_NUM  POSE
        WHERE
            RWSD.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND RWSD.RWS_NUM                  = #RWS_NUM#
        AND RWSD.EZCANCELFLAG             = '0'
        AND RWSD.GLBL_CMPY_CD             = RWSH.GLBL_CMPY_CD
        AND RWSD.RWS_NUM                  = RWSH.RWS_NUM
        AND RWSH.EZCANCELFLAG             = '0'
        AND RWSD.GLBL_CMPY_CD             = PODT.GLBL_CMPY_CD
        AND RWSH.PO_RCV_TRX_HDR_NUM       = PODT.PO_ORD_NUM
        AND RWSD.PO_RCV_TRX_LINE_NUM      = PODT.PO_ORD_DTL_LINE_NUM
        AND PODT.EZCANCELFLAG             = '0'
        AND PODT.GLBL_CMPY_CD             = POSE.GLBL_CMPY_CD
        AND PODT.PO_ORD_NUM               = POSE.KEY_INFO_CD_04
        AND PODT.PO_ORD_DTL_LINE_NUM      = POSE.KEY_INFO_CD_05
        AND POSE.EZCANCELFLAG             = '0'
        AND  NOT EXISTS
             (
                 SELECT 1 FROM RWS_HDR    HDR
                             , RWS_DTL    DTL
                             , RWS_SER    SER
                 WHERE
                       RWSD.GLBL_CMPY_CD         = HDR.GLBL_CMPY_CD
                 AND   RWSD.RWS_NUM             != HDR.RWS_NUM
                 AND   HDR.PO_RCV_TRX_HDR_NUM    = PODT.PO_ORD_NUM
                 AND   HDR.EZCANCELFLAG          = '0'
                 AND   HDR.GLBL_CMPY_CD          = DTL.GLBL_CMPY_CD
                 AND   HDR.RWS_NUM               = DTL.RWS_NUM
                 AND   DTL.PO_RCV_TRX_LINE_NUM   = PODT.PO_ORD_DTL_LINE_NUM
                 AND   DTL.EZCANCELFLAG          = '0'
                 AND   DTL.GLBL_CMPY_CD          = SER.GLBL_CMPY_CD
                 AND   DTL.RWS_NUM               = SER.RWS_NUM
                 AND   DTL.RWS_DTL_LINE_NUM      = SER.RWS_LINE_NUM
                 <!--QC#27024 Add Start  -->
                 AND   POSE.SER_NUM              = SER.SER_NUM
                 AND   DTL.RWS_STS_CD           != #RWS_STS_CD#
                 <!--QC#27024 Add End  -->
                 AND   SER.EZCANCELFLAG          = '0'
             )

    </statement>

    <statement id="getSvcMachMstrPk" parameterClass="Map" resultClass="Map">
        SELECT
            SMM.SVC_MACH_MSTR_PK
        FROM
            SVC_MACH_MSTR SMM
        WHERE
            SMM.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND SMM.TRX_HDR_NUM              = #PO_ORD_NUM#
        AND SMM.SVC_MACH_MAINT_AVAL_FLG  = #SVC_MACH_MAINT_AVAL_FLG#
        AND SMM.EZCANCELFLAG             = '0'
    </statement>

    <!-- START 2022/03/24 A.Cullano [QC#59359, ADD] -->	
    <statement id="getSvcMachMstrBuyBack" parameterClass="Map" resultClass="Map">
        SELECT
               SVC_MACH_MSTR_PK
        FROM
               SVC_MACH_MSTR    MCH
        WHERE
               MCH.GLBL_CMPY_CD            = #glblCmpyCd#
        AND    MCH.MDSE_CD                 = #mdseCd#
        AND    MCH.SVC_MACH_MSTR_STS_CD    = 'CRAT'
        AND    MCH.CUR_LOC_NUM             = #curLocNum#
        AND    MCH.STK_STS_CD              = #stkStsCd#
        AND    MCH.SVC_MACH_MAINT_AVAL_FLG = 'Y'
        AND    MCH.SER_NUM                 IS NULL
        AND    MCH.SVC_CONFIG_MSTR_PK      IS NULL
        AND    MCH.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getSoInfoBuyBack" parameterClass="Map" resultMap="result.SoInfo">
        SELECT 
               SO.TRX_SRC_TP_CD
             , SOD.MDSE_CD
             , SOD.SO_SLP_NUM
             , SOD.TRX_HDR_NUM
             , SOD.TRX_LINE_NUM
             , SOD.TRX_LINE_SUB_NUM
        FROM   
               SHPG_ORD         SO
             , SHPG_ORD_DTL     SOD
             , SVC_MACH_MSTR    MCH
        WHERE  
               SO.GLBL_CMPY_CD      = #glblCmpyCd#
        AND    SO.SO_NUM            = #soNum#
        AND    SO.EZCANCELFLAG      = '0'
        AND    SO.GLBL_CMPY_CD      = SOD.GLBL_CMPY_CD
        AND    SO.SO_NUM            = SOD.SO_NUM
        AND    SOD.TRX_LINE_NUM     = #poOrdDtlLineNum#
        AND    SOD.EZCANCELFLAG     = '0'
        AND    MCH.GLBL_CMPY_CD     = SOD.GLBL_CMPY_CD
        AND    MCH.EZCANCELFLAG     = '0'
        AND    MCH.SVC_MACH_MSTR_PK = #svcMachMstrPk#
        AND    MCH.MDSE_CD          = SOD.MDSE_CD
    </statement>

    <statement id="getPoSerNumBuyBack" parameterClass="Map" resultClass="Map">
        SELECT 
               PSN.SER_NUM
        FROM   
               PO_SER_NUM       PSN
        WHERE  
               PSN.GLBL_CMPY_CD     = #glblCmpyCd#
        AND    PSN.MDSE_CD          = #mdseCd#
        AND    PSN.KEY_INFO_CD_04   = #poOrdNum#
    </statement>
    
    <!-- #################### Result Mapping #################### -->
    <resultMap id="result.SoInfo" class="SoInfo">
        <result property="trxSrcTpCd"                     column="TRX_SRC_TP_CD"                         javaType="String"/>
        <result property="mdseCd"                         column="MDSE_CD"                               javaType="String"/>
        <result property="soSlpNum"                       column="SO_SLP_NUM"                            javaType="String"/>
        <result property="trxHdrNum"                      column="TRX_HDR_NUM"                           javaType="String"/>
        <result property="trxLineNum"                     column="TRX_LINE_NUM"                          javaType="String"/>
        <result property="trxLineSubNum"                  column="TRX_LINE_SUB_NUM"                      javaType="String"/>
    </resultMap>
    <!-- END 2022/03/24 A.Cullano [QC#59359, ADD] -->
    <statement id="getSceOrdTp" parameterClass="Map" resultClass="Map">
        SELECT
            SOT.TRX_CD
           ,SOT.TRX_RSN_CD
        FROM
            SCE_ORD_TP SOT
        WHERE
            SOT.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND SOT.SCE_ORD_TP_CD            = #SCE_ORD_TP_CD#
        AND SOT.INBD_OTBD_CD             = #INBD_OTBD_CD#
        AND SOT.EZCANCELFLAG             = '0'
    </statement>

    <statement id="getPoMsgTxt" parameterClass="Map" resultClass="Map">
        SELECT
            PM.PO_MSG_TXT
        FROM
            PO_MSG PM
        WHERE
            PM.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND PM.PO_MSG_TP_CD             = #PO_MSG_TP_CD#
        AND PM.PO_MSG_SEG_ID            = #PO_MSG_SEG_ID#
        AND PM.PO_ORD_NUM               = #PO_ORD_NUM#
        AND PM.EZCANCELFLAG             = '0'
    </statement>

    <statement id="getCarrSvcLvlCd" parameterClass="Map" resultClass="Map">
        SELECT
            SSLC.CARR_SVC_LVL_CD
        FROM
            SHPG_SVC_LVL_CARR_RELN SSLC
        WHERE
            SSLC.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND SSLC.SHPG_SVC_LVL_CD          = #SHPG_SVC_LVL_CD#
        AND SSLC.CARR_CD                  = #CARR_CD#
        AND SSLC.EZCANCELFLAG             = '0'
    </statement>

    <statement id="getFrtCondCd" parameterClass="Map" resultClass="Map">
        SELECT
            FCSL.FRT_COND_CD
        FROM
            FRT_COND_SVC_LVL_RELN FCSL
        WHERE
            FCSL.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND FCSL.LINE_BIZ_TP_CD           = #LINE_BIZ_TP_CD#
        AND FCSL.FRT_COND_CD              = #FRT_COND_CD#
        AND FCSL.SHPG_SVC_LVL_CD          = #SHPG_SVC_LVL_CD#
        AND FCSL.EZCANCELFLAG             = '0'
    </statement>

    <statement id="getDsInvtyLocV" parameterClass="Map" resultClass="Map">
        SELECT
            DILV.TECH_TOC_CD
           ,DILV.INVTY_LOC_CD
           ,DILV.INVTY_LOC_NM
        FROM
            DS_INVTY_LOC_V DILV
        WHERE
            DILV.GLBL_CMPY_CD             = #GLBL_CMPY_CD#
        AND DILV.RTL_WH_CD                = #DEST_RTL_WH_CD#
        <isNotNull property="DEST_RTL_SWH_CD">
        AND DILV.RTL_SWH_CD               = #DEST_RTL_SWH_CD#
        </isNotNull>
        AND DILV.RGTN_STS_CD              = #RGTN_STS_CD#
        AND DILV.EZCANCELFLAG             = '0'
    </statement>

    <statement id="countPrntCmpyVndByKey" parameterClass="Map" resultClass="Integer">
        SELECT
               COUNT(*)
          FROM 
               PRNT_CMPY_VND PCV
         WHERE
               PCV.GLBL_CMPY_CD        = #GLBL_CMPY_CD#
           AND PCV.PRNT_CMPY_VND_CD    = #VND_CD#
           AND PCV.EZCANCELFLAG        = '0'
           AND ROWNUM <![CDATA[ <= ]]> 1
    </statement>

    <statement id="countRcvAsnVndByKey" parameterClass="Map" resultClass="Integer">
        SELECT
               COUNT(*)
          FROM 
               RCV_ASN_VND RAV
         WHERE
               RAV.GLBL_CMPY_CD        = #GLBL_CMPY_CD#
           AND RAV.RCV_ASN_VND_CD      = #VND_CD#
           AND RAV.EZCANCELFLAG        = '0'
           AND ROWNUM <![CDATA[ <= ]]> 1
    </statement>

    <statement id="getPoDtlMap" parameterClass="Map" resultClass="Map">
        SELECT
               PD.PO_ORD_DTL_LINE_NUM
             , PD.MDSE_CD
             , PD.MDSE_NM
             , PD.PO_QTY
             , PD.THIS_MTH_FOB_COST_AMT
             , PD.CUST_UOM_CD
             , PD.ADMIN_PSN_CD
             , PD.ORD_QTY
             , PD.CPO_ORD_NUM
             , PD.CPO_DTL_LINE_NUM
             , PD.CPO_DTL_LINE_SUB_NUM
             , PD.CUST_ISS_PO_NUM
             , PD.CUST_ISS_PO_DT
             , PD.CPO_ORD_TP_CD
             , PD.BILL_TO_CUST_CD
             , PD.SELL_TO_CUST_CD
             , PD.SHPG_PLN_NUM
             , PD.PO_ORD_DTL_CMNT_TXT
             , PD.CARR_CD
             , PD.DISP_PO_DTL_LINE_NUM
             , PD.PO_LINE_TP_CD
             , PD.PO_MDSE_CMPSN_TP_CD
             , PD.SET_PO_ORD_DTL_LINE_NUM
             , PD.MDSE_DESC_SHORT_TXT
             , PD.PO_DISP_QTY
             , PD.PO_INV_QTY
             , PD.PO_DISP_UOM_CD
             , PD.ENT_DEAL_NET_UNIT_PRC_AMT
             , PD.ENT_PO_DTL_DEAL_NET_AMT
             , PD.ENT_FUNC_NET_UNIT_PRC_AMT
             , PD.ENT_PO_DTL_FUNC_NET_AMT
             , PD.EXCH_RATE
             , PD.DEST_RTL_SWH_CD
             , PD.SRC_RTL_SWH_CD
             , PD.INVTY_LOC_CD
             , PD.RQST_RCV_DT
             , PD.RQST_RCV_TM
             <!-- START 2023/02/15 S.Dong [QC#60966, ADD] -->
             , PD.RQST_SHIP_DT
             <!-- END 2023/02/15 S.Dong [QC#60966, ADD] -->
             , PD.FRT_COND_CD
             , PD.ORIG_MDSE_CD
             , PD.FROM_STK_STS_CD
             , PD.TO_STK_STS_CD
             , PD.PO_MATCH_TP_CD
             , PD.PRCH_REQ_NUM
             , PD.PRCH_REQ_LINE_NUM
             , PD.PRCH_REQ_LINE_SUB_NUM
             , PD.TRX_REF_NUM
             , PD.TRX_REF_LINE_NUM
             , PD.TRX_REF_LINE_SUB_NUM
             , PD.ASL_DTL_PK
             , PD.ASL_MDSE_CD
             , PD.ASL_UNIT_PRC_AMT
             , PD.SHIP_FROM_SO_NUM_LIST_TXT
             , PD.VND_INVTY_LOC_CD
             , PD.VND_ISS_PO_ORD_NUM
             , PD.PRO_NUM
             , PD.VND_PO_ACK_STS_CD
             , PD.ORIG_PO_ORD_NUM
             , PD.ORIG_PO_ORD_DTL_LINE_NUM
             , PD.ORIG_DISP_PO_DTL_LINE_NUM
             , PD.SVC_CONFIG_MSTR_PK
             , PD.PO_SEND_TS
             <!-- START 2017/10/17 S.Katsuma QC#21206 ADD -->
             , PD.PO_STS_CD
             , PD.PO_LINE_STS_CD
             <!-- END 2017/10/17 S.Katsuma QC#21206 ADD -->
             <!-- QC#18420 ADD START -->
             , PD.PO_DTL_DISC_PCT
             <!-- QC#18420 ADD End -->
             <!-- QC#53392 ADD START -->
             , PD.PO_DTL_DISC_PRC_AMT
             <!-- QC#53392 ADD End -->
             <!-- QC#54667 ADD START -->
             , PD.PO_LINE_STS_CD
             <!-- QC#54667 ADD END -->
          FROM 
               PO_DTL    PD
         WHERE
               PD.GLBL_CMPY_CD        = #GLBL_CMPY_CD#
           AND PD.PO_ORD_NUM          = #PO_ORD_NUM#
         <isNotNull property="PO_ORD_DTL_LINE_NUM">
           AND PD.PO_ORD_DTL_LINE_NUM = #PO_ORD_DTL_LINE_NUM#
           AND ROWNUM                 = 1
         </isNotNull>
           AND PD.EZCANCELFLAG        = '0'
         ORDER BY
               PD.PO_ORD_NUM
             , PD.PO_ORD_DTL_LINE_NUM
    </statement>

    <statement id="getPoInfoMap" parameterClass="Map" resultClass="Map">
        SELECT
             PM.PO_MSG_PK
            ,PM.PO_ORD_NUM
            ,PM.PO_ORD_DTL_LINE_NUM
            ,PM.PO_MSG_TP_CD
            ,PM.PO_MSG_SEG_ID
            ,PM.PO_MSG_SUBMT_PSN_CD
            ,PM.PO_MSG_TXT 
        FROM 
             PO_MSG PM
        WHERE
             PM.GLBL_CMPY_CD = #GLBL_CMPY_CD#
        AND  PM.PO_ORD_NUM   = #PO_ORD_NUM# 
        AND  PM.EZCANCELFLAG = '0'
        ORDER BY
             PO_ORD_NUM
            ,PO_ORD_DTL_LINE_NUM
            ,PO_MSG_TP_CD
            ,PO_MSG_SEG_ID
    </statement>

    <statement id="getPoSerNumPkList" parameterClass="Map" resultClass="BigDecimal">
        SELECT
              PSN.PO_SER_NUM_PK PO_SER_NUM_PK
        FROM 
              PO_SER_NUM PSN
        WHERE
              PSN.GLBL_CMPY_CD   = #GLBL_CMPY_CD#
        AND   PSN.KEY_INFO_CD_04 = #PO_ORD_NUM# 
        AND   PSN.EZCANCELFLAG   = '0'
        ORDER BY
              PO_SER_NUM_PK
    </statement>

    <statement id="getVndPmtTermCd" parameterClass="Map"  resultClass="String">
        SELECT
            VND_PMT_TERM_CD
        FROM
            VND_PMT_TERM VPT
        WHERE
            VPT.GLBL_CMPY_CD            = #GLBL_CMPY_CD#
        AND VPT.VND_PMT_TERM_DESC_TXT   = #VND_PMT_TERM_DESC_TXT#
        AND VPT.EZCANCELFLAG            = '0'
    </statement>
    
    <statement id="searchPoStatus" parameterClass="Map"  resultClass="String">
        SELECT
            PO.PO_APVL_STS_CD
        FROM
            PO PO
        WHERE
            1=1
        AND PO.GLBL_CMPY_CD            = #glblCmpyCd#
        AND PO.PO_ORD_NUM              = #poOrdNum#
        AND PO.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getMdseFromSupplierItem" parameterClass="Map" resultClass="Map">
        SELECT
            DISTINCT
                AD.MDSE_CD
               ,AD.VND_CD
        FROM
            ASL_HDR AH
           ,ASL_DTL AD
           ,(
             SELECT DISTINCT
                 AD.SPLY_ITEM_NUM
                ,AD.MDSE_CD
             FROM
                 ASL_DTL AD
             WHERE
                 AD.GLBL_CMPY_CD = #glblCmpyCd#
             AND AD.MDSE_CD      = #mdseCd#
             AND AD.VND_CD       = #vndCd#
             AND AD.EZCANCELFLAG = '0'
            ) SPLM
        WHERE
            AH.GLBL_CMPY_CD                     = #glblCmpyCd#
        AND AH.GLBL_CMPY_CD                     = AD.GLBL_CMPY_CD
        AND AH.ASL_HDR_PK                       = AD.ASL_HDR_PK
        AND AD.VND_CD                           = #vndCd#
        AND AD.SPLY_ITEM_NUM                    = SPLM.SPLY_ITEM_NUM
        AND AD.EFF_FROM_DT                  &lt;= #slsDt#
        AND NVL(AD.EFF_THRU_DT,'99999999')  &gt;= #slsDt#
        AND AH.ASL_START_DT                 &lt;= #slsDt#
        AND NVL(AH.ASL_END_DT,'99999999')   &gt;= #slsDt#
        AND AD.MDSE_CD                         != #mdseCd#
        AND AH.EZCANCELFLAG                     = '0'
        AND AD.EZCANCELFLAG                     = '0'
    </statement>

    <statement id="getPoLineStatus" parameterClass="Map" resultClass="String">
        SELECT
            PD.PO_LINE_STS_CD
        FROM
            PO_DTL PD
        WHERE
            PD.GLBL_CMPY_CD        = #glblCmpyCd#
        AND PD.PO_ORD_NUM          = #poOrdNum#
        AND PD.PO_ORD_DTL_LINE_NUM = #poOrdDtlLineNum#
        AND PD.EZCANCELFLAG        = '0'
        AND ROWNUM                 = 1
    </statement>

<!-- START 03/02/2020 T.Ogura [QC#55920,ADD] -->
    <statement id="getPoSerNumPk" parameterClass="Map" resultClass="Integer">
        SELECT
            COUNT(1)
        FROM
             PO_SER_NUM PSN
            ,PO_DTL PD
        WHERE
            PSN.GLBL_CMPY_CD       = #glblCmpyCd#
        AND PSN.SER_NUM            = #serNum#
        AND PSN.MDSE_CD            = #mdseCd#
        <isNotNull property="poOrdNum">
        AND PSN.KEY_INFO_CD_04    != #poOrdNum#
        </isNotNull>
        AND PSN.GLBL_CMPY_CD       = PD.GLBL_CMPY_CD
        AND PSN.KEY_INFO_CD_04     = PD.PO_ORD_NUM
        AND PSN.KEY_INFO_CD_05     = PD.PO_ORD_DTL_LINE_NUM
        <iterate property="PO_LINE_STS_CD" var="elem[]" open="AND PD.PO_LINE_STS_CD NOT IN (" close=")" conjunction=",">
             #elem[]#
        </iterate>
        AND PSN.EZCANCELFLAG = '0'
        AND PD.EZCANCELFLAG  = '0'
    </statement>
<!-- END   03/02/2020 T.Ogura [QC#55920,ADD] -->

<!-- START 04/06/2020 T.Ogura [QC#56390,ADD] -->
    <statement id="getOpenPoFlg" parameterClass="Map" resultClass="String">
        SELECT
            PS.OPEN_PO_FLG
        FROM
             PO             PH
            ,PO_DTL         PD
            ,PO_STS         PS
        WHERE 1=1
        AND PH.GLBL_CMPY_CD             = #glblCmpyCd#
        AND PH.PO_ORD_NUM               = #poOrdNum#
        AND PH.GLBL_CMPY_CD             = PD.GLBL_CMPY_CD
        AND PH.PO_ORD_NUM               = PD.PO_ORD_NUM
        AND PD.PO_ORD_DTL_LINE_NUM      = #poOrdDtlLineNum#
        AND PH.GLBL_CMPY_CD             = PS.GLBL_CMPY_CD (+)
        AND PD.PO_STS_CD                = PS.PO_STS_CD (+)
        AND PH.EZCANCELFLAG             = '0'
        AND PD.EZCANCELFLAG             = '0'
        AND PS.EZCANCELFLAG(+)          = '0'
    </statement>
<!-- END   04/06/2020 T.Ogura [QC#56390,ADD] -->

</sqlMap>
