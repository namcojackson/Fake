<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPZC101001">

    <statement id="getStsCd" parameterClass="Map" resultClass="Map">
        SELECT
            LOC_STS_CD
           ,STK_STS_CD
        FROM
            AVAL_INVTY_APP_ID
        WHERE
            GLBL_CMPY_CD       = #GLBL_CMPY_CD#
        AND BIZ_APP_ID         = #BIZ_APP_ID#
        AND EZCANCELFLAG       = '0'
    </statement>

    <statement id="getTenDigitsItem" parameterClass="Map" resultClass="Map">
        SELECT
            MDSE.MDSE_CD
        FROM
            MDSE MDSE
            ,MDSE_ITEM_STS MT
        WHERE
            MDSE.GLBL_CMPY_CD      = #GLBL_CMPY_CD#
        AND MDSE.MDSE_CD           LIKE #MDSE_CD#
        AND MDSE.GLBL_CMPY_CD      = MT.GLBL_CMPY_CD
        AND MDSE.MDSE_ITEM_STS_CD  = MT.MDSE_ITEM_STS_CD
        AND MT.PRCH_PLN_AVAL_FLG   = #FLG_ON_Y#
        AND MDSE.EZCANCELFLAG      = '0'
        AND MT.EZCANCELFLAG        = '0'
    </statement>

    <statement id="getInvDat" parameterClass="Map" resultClass="Map">
        SELECT
            <!-- QC#18401-SOL#014 INVTY_AVAL_QTY => INVTY_QTY -->
            INVTY_QTY
           ,MDSE_CD
           ,INVTY_LOC_CD
           ,NULL AS RQST_RCV_DT
           <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
           ,INVTY.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,INVTY.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,INVTY.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,INVTY.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,INVTY.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM
            INVTY
        WHERE
            GLBL_CMPY_CD     = #GLBL_CMPY_CD#
        AND EZCANCELFLAG     = '0'
        AND MDSE_CD          IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND INVTY_LOC_CD     LIKE #INVTY_LOC_CD#
        AND LOC_STS_CD       = #LOC_STS_CD#
        AND STK_STS_CD       = #STK_STS_CD#
    </statement>

    <!-- QC#30334 Modify  2019/02/19 Update. Add PO_Line_Type -->
    <!-- QC#28729 Modify  2018/10/31 Update.START -->
    <!-- QC#18401-SOL#014 Modify  2017/12/25 Update.-->
    <!-- QC#25510 Modify  2018/06/21 Update.-->
    <statement id="getOpenPoDat" parameterClass="Map" resultClass="Map">
        SELECT 
             PD.PO_BAL_QTY                      AS VIS_QTY
            ,PD.MDSE_CD                         AS MDSE_CD
            ,PD.INVTY_LOC_CD                    AS VIS_LOC_CD
            ,PD.ETA_DT                          AS ETA_ETD_DT
            ,SUBSTR(PO.PO_SUBMT_TS, 0, 8)       AS ORD_DT
            ,PO.PO_ORD_NUM                      AS PO_ORD_NUM
            ,PD.PO_ORD_DTL_LINE_NUM             AS PO_ORD_DTL_LINE_NUM
            ,DPT.DS_PO_TP_DESC_TXT              AS DS_PO_TP_DESC_TXT
            ,PD.RQST_RCV_DT                     AS RQST_RCV_DT
            ,PO.PO_HDR_STS_CD                   AS PO_HDR_STS_CD
            ,PHS.PO_HDR_STS_NM                  AS PO_HDR_STS_NM
            ,PO.PO_APVL_STS_CD                  AS PO_APVL_STS_CD
            ,PAS.PO_APVL_STS_NM                 AS PO_APVL_STS_NM
            ,PD.DISP_PO_DTL_LINE_NUM            AS DISP_PO_DTL_LINE_NUM
            <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
            ,PD.EZINTIME                     AS XX_REC_HIST_CRAT_TS
            ,PD.EZINUSERID                   AS XX_REC_HIST_CRAT_BY_NM
            ,PD.EZUPTIME                     AS XX_REC_HIST_UPD_TS
            ,PD.EZUPUSERID                   AS XX_REC_HIST_UPD_BY_NM
            ,PD.EZTABLEID                    AS XX_REC_HIST_TBL_NM
            <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM
            PO           PO
           ,PO_DTL       PD 
           ,DS_PO_TP     DPT
           ,PO_HDR_STS   PHS
           ,PO_APVL_STS  PAS
           ,PO_STS       PS
        WHERE 1 = 1
        AND PO.EZCANCELFLAG                 = '0'
        AND PO.GLBL_CMPY_CD                 = #GLBL_CMPY_CD#
        AND PO.PO_ORD_NUM                   = PD.PO_ORD_NUM
        AND PO.GLBL_CMPY_CD                 = PD.GLBL_CMPY_CD
        AND PD.EZCANCELFLAG                 = '0'
        <iterate property="MDSE_CD" var="MDSE_CD[]" open="AND PD.MDSE_CD IN(" close=")" conjunction=",">
            #MDSE_CD[]#
        </iterate> 
        AND PO.GLBL_CMPY_CD                 = DPT.GLBL_CMPY_CD
        AND PO.DS_PO_TP_CD                  = DPT.DS_PO_TP_CD
        AND DPT.EZCANCELFLAG                = '0'
        AND PHS.EZCANCELFLAG                = '0'
        AND PO.GLBL_CMPY_CD                 = PHS.GLBL_CMPY_CD
        AND PO.PO_HDR_STS_CD                = PHS.PO_HDR_STS_CD
        AND PO.GLBL_CMPY_CD                 = PAS.GLBL_CMPY_CD
        AND PO.PO_APVL_STS_CD               = PAS.PO_APVL_STS_CD
        AND PAS.EZCANCELFLAG                = '0' 
        AND PO.PO_HDR_STS_CD                = #OPEN#
        AND PD.INVTY_LOC_CD              LIKE #INVTY_LOC_CD#
        AND PD.PO_BAL_QTY                   > 0
        AND PD.TO_STK_STS_CD                = #TO_STK_STS_CD#
        <iterate property="EXCLUSION_PO_LINE_TYPE" var="EXCLUSION_PO_LINE_TYPE[]" open="AND PD.PO_LINE_TP_CD NOT IN(" close=")" conjunction=",">
            #EXCLUSION_PO_LINE_TYPE[]#
        </iterate>
        AND PS.OPEN_PO_FLG                  = #FLG_ON_Y#
        AND PD.GLBL_CMPY_CD                 = PS.GLBL_CMPY_CD
        AND PD.PO_STS_CD                    = PS.PO_STS_CD
        AND PS.EZCANCELFLAG                 = '0'
        AND NVL(PD.ETA_DT , 99999999)   &lt;= #THRU_DT#
    <!-- QC#28729 Modify  2018/10/31 Update.END -->
    </statement>

    <!-- QC#18401-SOL#014 Modify -->
    <statement id="getOpenInbPrDat" parameterClass="Map" resultClass="Map">
        SELECT
            PRDT.PRCH_REQ_BAL_QTY
           ,PRDT.MDSE_CD
           ,PRDT.DEST_INVTY_LOC_CD
           ,PRDT.RQST_RCV_DT
           ,PRRQ.PRCH_REQ_CRAT_DT
           ,PRDT.PRCH_REQ_NUM
           ,PRDT.PRCH_REQ_LINE_NUM
           ,PRRT.PRCH_REQ_TP_DESC_TXT
           ,PRDT.PRCH_REQ_LINE_STS_CD
           ,PRLS.PRCH_REQ_LINE_STS_NM
           ,PRRQ.PRCH_REQ_APVL_STS_CD
           ,PRAS.PRCH_REQ_APVL_STS_NM
           <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
           ,PRDT.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,PRDT.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,PRDT.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,PRDT.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,PRDT.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM
            PRCH_REQ           PRRQ
           ,PRCH_REQ_DTL       PRDT
           ,PRCH_REQ_APVL_STS  PRAS
           ,PRCH_REQ_LINE_STS  PRLS
           ,PRCH_REQ_TP        PRRT
        WHERE
            PRRQ.GLBL_CMPY_CD          = #GLBL_CMPY_CD#
        AND PRRQ.EZCANCELFLAG          = '0'
        AND PRRQ.PRCH_REQ_REC_TP_CD    = #PRCH_REQ_REC_TP_CD#
<!--    AND PRRQ.PRCH_REQ_STS_CD       = #PRCH_REQ_STS_CD# -->
        <iterate property="prchReqStsCdList" var="prchReqStsCd[]" open="AND PRRQ.PRCH_REQ_STS_CD IN (" conjunction= ", " close=")">
            #prchReqStsCd[]#
        </iterate>
        <isNotNull property="batchMode">
        AND NOT (PRRQ.PRCH_REQ_APVL_STS_CD  = #PRCH_REQ_APVL_STS_CD#
            AND PRRQ.PRCH_REQ_SRC_TP_CD     = #PRCH_REQ_SRC_TP_CD#
            )
        </isNotNull>
        AND PRRQ.GLBL_CMPY_CD          = PRDT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
        AND PRDT.EZCANCELFLAG          = '0'
        AND PRDT.PRCH_REQ_BAL_QTY      > 0
        AND PRDT.MDSE_CD               IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND PRDT.DEST_INVTY_LOC_CD     LIKE #INVTY_LOC_CD#
        AND PRDT.TO_STK_STS_CD         = #TO_STK_STS_CD#
        AND PRDT.RQST_RCV_DT           &lt;= #THRU_DT#
        AND PRRQ.GLBL_CMPY_CD          = PRAS.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_APVL_STS_CD  = PRAS.PRCH_REQ_APVL_STS_CD
        AND PRAS.EZCANCELFLAG          = '0'
<!--    AND PRAS.PRCH_REQ_APVL_FLG     = #FLG_ON_Y# -->
        AND PRDT.GLBL_CMPY_CD          = PRLS.GLBL_CMPY_CD
        AND PRDT.PRCH_REQ_LINE_STS_CD  = PRLS.PRCH_REQ_LINE_STS_CD
        AND PRLS.EZCANCELFLAG          = '0'
        AND PRLS.OPEN_STS_FLG          = #FLG_ON_Y#
        AND PRRQ.GLBL_CMPY_CD          = PRRT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_TP_CD        = PRRT.PRCH_REQ_TP_CD
        AND PRRT.EZCANCELFLAG          = '0'
    </statement>

    <!-- QC#18401-SOL#014 Modify SQL -->
    <statement id="getOpenInbInvDat" parameterClass="Map" resultClass="Map">
        SELECT
            PRDT.PRCH_REQ_QTY - PRDT.SHIP_QTY SCHD_QTY
           ,PRDT.MDSE_CD
           ,PRDT.DEST_INVTY_LOC_CD
           ,PRDT.RQST_RCV_DT
           ,PRRQ.PRCH_REQ_CRAT_DT
           ,PRDT.PRCH_REQ_NUM
           ,PRDT.PRCH_REQ_LINE_NUM
           ,PRRT.PRCH_REQ_TP_DESC_TXT
           ,PRDT.PRCH_REQ_LINE_STS_CD
           ,PRLS.PRCH_REQ_LINE_STS_NM
           ,PRRQ.PRCH_REQ_APVL_STS_CD
           ,PRAS.PRCH_REQ_APVL_STS_NM
           <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
           ,PRDT.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,PRDT.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,PRDT.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,PRDT.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,PRDT.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM
            PRCH_REQ           PRRQ
           ,PRCH_REQ_DTL       PRDT
           ,PRCH_REQ_APVL_STS  PRAS
           ,PRCH_REQ_LINE_STS  PRLS
           ,PRCH_REQ_TP        PRRT
        WHERE
            PRRQ.GLBL_CMPY_CD                 = #GLBL_CMPY_CD#
        AND PRRQ.PRCH_REQ_TP_CD          NOT IN(#whTransfer#, #expenceOrder#)
        AND PRRQ.EZCANCELFLAG                 = '0'
        AND PRRQ.PRCH_REQ_REC_TP_CD           = #PRCH_REQ_REC_TP_CD#
<!--         AND PRRQ.PRCH_REQ_STS_CD              = #PRCH_REQ_STS_CD# -->
        <iterate property="prchReqStsCdList" var="prchReqStsCd[]" open="AND PRRQ.PRCH_REQ_STS_CD IN (" conjunction= ", " close=")">
            #prchReqStsCd[]#
        </iterate>
        <isNotNull property="batchMode">
        AND NOT (PRRQ.PRCH_REQ_APVL_STS_CD  = #PRCH_REQ_APVL_STS_CD#
            AND PRRQ.PRCH_REQ_SRC_TP_CD     = #PRCH_REQ_SRC_TP_CD#
            )
        </isNotNull>
        AND PRRQ.GLBL_CMPY_CD                 = PRDT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_NUM                 = PRDT.PRCH_REQ_NUM
        AND PRDT.EZCANCELFLAG                 = '0'
        AND PRDT.MDSE_CD                      IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND PRDT.DEST_INVTY_LOC_CD            LIKE #INVTY_LOC_CD#
        AND PRDT.TO_STK_STS_CD                = #TO_STK_STS_CD#
        AND PRDT.PRCH_REQ_QTY - PRDT.SHIP_QTY > 0
        AND PRDT.RQST_RCV_DT                  &lt;= #THRU_DT#
        AND PRDT.RWS_NUM                      IS NULL
        AND PRRQ.GLBL_CMPY_CD                 = PRAS.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_APVL_STS_CD         = PRAS.PRCH_REQ_APVL_STS_CD
        AND PRAS.EZCANCELFLAG                 = '0'
<!--    AND PRAS.PRCH_REQ_APVL_FLG            = #FLG_ON_Y#-->
        AND PRDT.GLBL_CMPY_CD                 = PRLS.GLBL_CMPY_CD
        AND PRDT.PRCH_REQ_LINE_STS_CD         = PRLS.PRCH_REQ_LINE_STS_CD
        AND PRLS.EZCANCELFLAG                 = '0'
        AND PRLS.OPEN_STS_FLG                 = #FLG_ON_Y#
        AND PRRQ.GLBL_CMPY_CD                 = PRRT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_TP_CD               = PRRT.PRCH_REQ_TP_CD
        AND PRRT.EZCANCELFLAG                 = '0'
        UNION ALL
        SELECT
             MAIN.SCHD_QTY
            ,MAIN.MDSE_CD
            ,MAIN.DEST_INVTY_LOC_CD
            ,MAIN.RQST_RCV_DT
            ,MAIN.PRCH_REQ_CRAT_DT
            ,MAIN.PRCH_REQ_NUM
            ,MAIN.PRCH_REQ_LINE_NUM
            ,MAIN.PRCH_REQ_TP_DESC_TXT
            ,MAIN.PRCH_REQ_LINE_STS_CD
            ,MAIN.PRCH_REQ_LINE_STS_NM
            ,MAIN.PRCH_REQ_APVL_STS_CD
            ,MAIN.PRCH_REQ_APVL_STS_NM
            <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
           ,MAIN.XX_REC_HIST_CRAT_TS
           ,MAIN.XX_REC_HIST_CRAT_BY_NM
           ,MAIN.XX_REC_HIST_UPD_TS
           ,MAIN.XX_REC_HIST_UPD_BY_NM
           ,MAIN.XX_REC_HIST_TBL_NM
           <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM(
            SELECT
                PRDT.PRCH_REQ_QTY - PRDT.SHIP_QTY - NVL((SELECT
                     SUM(CD.CANC_QTY) CANC_QTY
                 FROM
                     CPO C
                    ,CPO_DTL CD
                 WHERE
                     PRRQ.PRCH_REQ_NUM          = C.ORD_SRC_REF_NUM
                 AND C.EZCANCELFLAG             = '0'
                 AND C.CPO_ORD_NUM              = CD.CPO_ORD_NUM
                 AND PRDT.PRCH_REQ_LINE_NUM     = CD.ORD_SRC_REF_LINE_NUM
                 AND PRDT.PRCH_REQ_LINE_SUB_NUM = CD.ORD_SRC_REF_LINE_SUB_NUM
                 AND CD.EZCANCELFLAG            = '0'
                 ), 0) AS SCHD_QTY
               ,PRDT.MDSE_CD
               ,PRDT.DEST_INVTY_LOC_CD
               ,PRDT.RQST_RCV_DT
               ,PRRQ.PRCH_REQ_CRAT_DT
               ,PRDT.PRCH_REQ_NUM
               ,PRDT.PRCH_REQ_LINE_NUM
               ,PRRT.PRCH_REQ_TP_DESC_TXT
               ,PRDT.PRCH_REQ_LINE_STS_CD
               ,PRLS.PRCH_REQ_LINE_STS_NM
               ,PRRQ.PRCH_REQ_APVL_STS_CD
               ,PRAS.PRCH_REQ_APVL_STS_NM
               <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
               ,PRDT.EZINTIME AS XX_REC_HIST_CRAT_TS
               ,PRDT.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
               ,PRDT.EZUPTIME AS XX_REC_HIST_UPD_TS
               ,PRDT.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
               ,PRDT.EZTABLEID AS XX_REC_HIST_TBL_NM
               <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
            FROM
                PRCH_REQ           PRRQ
               ,PRCH_REQ_DTL       PRDT
               ,PRCH_REQ_APVL_STS  PRAS
               ,PRCH_REQ_LINE_STS  PRLS
               ,PRCH_REQ_TP        PRRT
            WHERE
                PRRQ.GLBL_CMPY_CD                 = #GLBL_CMPY_CD#
            AND PRRQ.PRCH_REQ_TP_CD               = #whTransfer#
            AND PRRQ.EZCANCELFLAG                 = '0'
            AND PRRQ.PRCH_REQ_REC_TP_CD           = #PRCH_REQ_REC_TP_CD#
            <iterate property="prchReqStsCdList" var="prchReqStsCd[]" open="AND PRRQ.PRCH_REQ_STS_CD IN (" conjunction= ", " close=")">
                #prchReqStsCd[]#
            </iterate>
            <isNotNull property="batchMode">
            AND NOT (PRRQ.PRCH_REQ_APVL_STS_CD  = #PRCH_REQ_APVL_STS_CD#
                AND PRRQ.PRCH_REQ_SRC_TP_CD     = #PRCH_REQ_SRC_TP_CD#
                )
            </isNotNull>
            AND PRRQ.GLBL_CMPY_CD                 = PRDT.GLBL_CMPY_CD
            AND PRRQ.PRCH_REQ_NUM                 = PRDT.PRCH_REQ_NUM
            AND PRDT.EZCANCELFLAG                 = '0'
            AND PRDT.MDSE_CD                      IN
                <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                    #MDSE_CD[]#
                </iterate>
            AND PRDT.DEST_INVTY_LOC_CD            LIKE #INVTY_LOC_CD#
            AND PRDT.TO_STK_STS_CD                = #TO_STK_STS_CD#
            AND PRDT.PRCH_REQ_QTY - PRDT.SHIP_QTY > 0
            AND PRDT.RQST_RCV_DT                  &lt;= #THRU_DT#
            <!-- 2020/10/06 QC#57365 MOD -->
            --AND PRDT.RWS_NUM                      IS NULL
            <!-- 2020/10/06 QC#57365 MOD -->
            AND PRRQ.GLBL_CMPY_CD                 = PRAS.GLBL_CMPY_CD
            AND PRRQ.PRCH_REQ_APVL_STS_CD         = PRAS.PRCH_REQ_APVL_STS_CD
            AND PRAS.EZCANCELFLAG                 = '0'
            AND PRDT.GLBL_CMPY_CD                 = PRLS.GLBL_CMPY_CD
            AND PRDT.PRCH_REQ_LINE_STS_CD         = PRLS.PRCH_REQ_LINE_STS_CD
            AND PRLS.EZCANCELFLAG                 = '0'
            AND PRLS.OPEN_STS_FLG                 = #FLG_ON_Y#
            AND PRRQ.GLBL_CMPY_CD                 = PRRT.GLBL_CMPY_CD
            AND PRRQ.PRCH_REQ_TP_CD               = PRRT.PRCH_REQ_TP_CD
            AND PRRT.EZCANCELFLAG                 = '0'
        ) MAIN
        WHERE
            MAIN.SCHD_QTY &gt; 0
    </statement>

    <!-- QC#18401-SOL#014 Modify SQL -->
    <statement id="getInvReqDat" parameterClass="Map" resultClass="Map">
        SELECT
            INBD.VIS_QTY
           ,INBD.MDSE_CD
           ,INBD.VIS_LOC_CD
           ,INBD.ETA_ETD_DT
           ,PRRQ.PRCH_REQ_CRAT_DT
           ,PRDT.PRCH_REQ_NUM
           ,PRDT.PRCH_REQ_LINE_NUM
           ,PRRT.PRCH_REQ_TP_DESC_TXT
           ,PRDT.RQST_RCV_DT
           ,PRDT.PRCH_REQ_LINE_STS_CD
           ,PRLS.PRCH_REQ_LINE_STS_NM
           ,SP.SHPG_STS_CD
           ,CASE
              WHEN SP.CR_HLD_QTY = 0 AND SP.CR_CHK_QTY &gt; 0 AND SP.SHPG_STS_CD = #VALIDATED# THEN 'B/O'
              ELSE SS.SHPG_STS_NM
            END SHPG_STS_NM
           ,PRRQ.PRCH_REQ_APVL_STS_CD
           ,PRAS.PRCH_REQ_APVL_STS_NM
           <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
           ,PRDT.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,PRDT.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,PRDT.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,PRDT.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,PRDT.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM
            PRCH_REQ           PRRQ
           ,PRCH_REQ_DTL       PRDT
           ,PRCH_REQ_LINE_STS  PRLS
           ,PO_RCV_DTL         PRD
           ,INBD_VIS           INBD
           ,PRCH_REQ_TP        PRRT
           ,PRCH_REQ_APVL_STS  PRAS
           ,SHPG_PLN           SP
           ,SHPG_STS           SS
           ,(SELECT
                P.GLBL_CMPY_CD
               ,P.SO_NUM
               ,P.SO_SLP_NUM
               ,P.PKT_STS_TS
             FROM
                PKT P
                ,(SELECT
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                     ,MAX(MP.PKT_SQ_NUM) MAX_PKT_SQ_NUM
                  FROM
                      PKT MP
                  WHERE
                      MP.EZCANCELFLAG = '0'
                  GROUP BY
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                 ) M
             WHERE
                 P.GLBL_CMPY_CD = M.GLBL_CMPY_CD
             AND P.SO_NUM       = M.SO_NUM
             AND P.SO_SLP_NUM   = M.SO_SLP_NUM
             AND P.PKT_SQ_NUM   = M.MAX_PKT_SQ_NUM
            ) PKT
        WHERE
            PRRQ.GLBL_CMPY_CD          = #GLBL_CMPY_CD#
        AND PRRQ.EZCANCELFLAG          = '0'
        AND PRRQ.PRCH_REQ_REC_TP_CD    = #PRCH_REQ_REC_TP_CD#
        AND PRRQ.PRCH_REQ_STS_CD       = #PRCH_REQ_STS_CD#
        AND PRRQ.GLBL_CMPY_CD          = PRDT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
        AND PRDT.EZCANCELFLAG          = '0'
        AND PRDT.MDSE_CD               IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND PRDT.DEST_INVTY_LOC_CD     LIKE #INVTY_LOC_CD#
        AND PRDT.TO_STK_STS_CD         = #TO_STK_STS_CD#
        AND PRDT.SO_NUM                IS NOT NULL
        AND PRDT.GLBL_CMPY_CD          = PRLS.GLBL_CMPY_CD
        AND PRDT.PRCH_REQ_LINE_STS_CD  = PRLS.PRCH_REQ_LINE_STS_CD
        AND PRLS.EZCANCELFLAG          = '0'
        AND PRLS.OPEN_STS_FLG          = #FLG_ON_Y#
        AND PRDT.GLBL_CMPY_CD          = PRD.GLBL_CMPY_CD
        AND PRDT.PRCH_REQ_NUM          = PRD.PRCH_REQ_NUM
        AND PRDT.PRCH_REQ_LINE_NUM     = PRD.PRCH_REQ_LINE_NUM
        AND PRDT.PRCH_REQ_LINE_SUB_NUM = PRD.PRCH_REQ_LINE_SUB_NUM
        AND PRD.EZCANCELFLAG           = '0'
        AND PRD.GLBL_CMPY_CD           = INBD.GLBL_CMPY_CD
        AND PRD.PO_RCV_NUM             = INBD.PO_RCV_NUM
        AND PRD.PO_RCV_LINE_NUM        = INBD.PO_RCV_LINE_NUM
        AND INBD.EZCANCELFLAG          = '0'
        AND INBD.INBD_LTST_REC_FLG     = #FLG_ON_Y#
        AND INBD.INBD_VIS_EVENT_CD     = #INBD_VIS_EVENT_CD#
        AND INBD.INBD_VIS_DATA_TP_CD   = #INBD_VIS_DATA_TP_CD#
        AND INBD.ETA_ETD_DT            &lt;= #THRU_DT#
        AND PRRQ.GLBL_CMPY_CD          = PRRT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_TP_CD        = PRRT.PRCH_REQ_TP_CD
        AND PRRT.EZCANCELFLAG          = '0'
        AND PRRQ.GLBL_CMPY_CD          = PRAS.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_APVL_STS_CD  = PRAS.PRCH_REQ_APVL_STS_CD
        AND PRAS.EZCANCELFLAG          = '0'
        AND PRDT.GLBL_CMPY_CD          = SP.GLBL_CMPY_CD(+)
        AND PRDT.PRCH_REQ_NUM          = SP.TRX_HDR_NUM(+)
        AND PRDT.PRCH_REQ_LINE_NUM     = SP.TRX_LINE_NUM(+)
        AND SP.EZCANCELFLAG(+)         = '0'
        AND SP.GLBL_CMPY_CD            = SS.GLBL_CMPY_CD(+)
        AND SP.SHPG_STS_CD             = SS.SHPG_STS_CD(+)
        AND SS.EZCANCELFLAG(+)         = '0'
        AND SP.GLBL_CMPY_CD            = PKT.GLBL_CMPY_CD(+)
        AND SP.SO_NUM                  = PKT.SO_NUM(+)
        AND SP.SO_SLP_NUM              = PKT.SO_SLP_NUM(+)
        UNION ALL
        SELECT
            PRDT.PRCH_REQ_QTY AS VIS_QTY
           ,PRDT.MDSE_CD
           ,PRDT.DEST_INVTY_LOC_CD AS VIS_LOC_CD
           ,PRDT.RQST_RCV_DT AS ETA_ETD_DT
           ,PRRQ.PRCH_REQ_CRAT_DT
           ,PRDT.PRCH_REQ_NUM
           ,PRDT.PRCH_REQ_LINE_NUM
           ,PRRT.PRCH_REQ_TP_DESC_TXT
           ,PRDT.RQST_RCV_DT
           ,PRDT.PRCH_REQ_LINE_STS_CD
           ,PRLS.PRCH_REQ_LINE_STS_NM
           ,SP.SHPG_STS_CD
           ,CASE
              WHEN SP.CR_HLD_QTY = 0 AND SP.CR_CHK_QTY &gt; 0 AND SP.SHPG_STS_CD = #VALIDATED# THEN 'B/O'
              ELSE SS.SHPG_STS_NM
            END SHPG_STS_NM
           ,PRRQ.PRCH_REQ_APVL_STS_CD
           ,PRAS.PRCH_REQ_APVL_STS_NM
           <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
           ,PRDT.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,PRDT.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,PRDT.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,PRDT.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,PRDT.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM
            PRCH_REQ           PRRQ
           ,PRCH_REQ_DTL       PRDT
           ,PRCH_REQ_LINE_STS  PRLS
           ,PRCH_REQ_TP        PRRT
           ,PRCH_REQ_APVL_STS  PRAS
           ,SHPG_PLN           SP
           ,SHPG_STS           SS
           ,(SELECT
                P.GLBL_CMPY_CD
               ,P.SO_NUM
               ,P.SO_SLP_NUM
               ,P.PKT_STS_TS
             FROM
                PKT P
                ,(SELECT
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                     ,MAX(MP.PKT_SQ_NUM) MAX_PKT_SQ_NUM
                  FROM
                      PKT MP
                  WHERE
                      MP.EZCANCELFLAG = '0'
                  GROUP BY
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                 ) M
             WHERE
                 P.GLBL_CMPY_CD = M.GLBL_CMPY_CD
             AND P.SO_NUM       = M.SO_NUM
             AND P.SO_SLP_NUM   = M.SO_SLP_NUM
             AND P.PKT_SQ_NUM   = M.MAX_PKT_SQ_NUM
            ) PKT
        WHERE
            PRRQ.GLBL_CMPY_CD          = #GLBL_CMPY_CD#
        AND PRRQ.EZCANCELFLAG          = '0'
        AND PRRQ.PRCH_REQ_TP_CD        = #prchReqTpCdKt#
        AND PRRQ.PRCH_REQ_REC_TP_CD    = #PRCH_REQ_REC_TP_CD#
        AND PRRQ.PRCH_REQ_STS_CD       = #PRCH_REQ_STS_CD#
        AND PRRQ.GLBL_CMPY_CD          = PRDT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
        AND PRDT.EZCANCELFLAG          = '0'
        AND PRDT.MDSE_CD               IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND PRDT.DEST_INVTY_LOC_CD     LIKE #INVTY_LOC_CD#
        AND PRDT.FROM_STK_STS_CD       = #FROM_STK_STS_CD#
        AND PRDT.WRK_ORD_NUM           IS NULL
        AND PRDT.GLBL_CMPY_CD          = PRLS.GLBL_CMPY_CD
        AND PRDT.PRCH_REQ_LINE_STS_CD  = PRLS.PRCH_REQ_LINE_STS_CD
        AND PRLS.EZCANCELFLAG          = '0'
        AND PRRQ.GLBL_CMPY_CD          = PRRT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_TP_CD        = PRRT.PRCH_REQ_TP_CD
        AND PRRT.EZCANCELFLAG          = '0'
        AND PRRQ.GLBL_CMPY_CD          = PRAS.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_APVL_STS_CD  = PRAS.PRCH_REQ_APVL_STS_CD
        <!-- QC#26533 Update -->
        AND PRAS.PRCH_REQ_APVL_FLG     = 'Y'
        AND PRAS.EZCANCELFLAG          = '0'
        AND PRDT.GLBL_CMPY_CD          = SP.GLBL_CMPY_CD(+)
        AND PRDT.PRCH_REQ_NUM          = SP.TRX_HDR_NUM(+)
        AND PRDT.PRCH_REQ_LINE_NUM     = SP.TRX_LINE_NUM(+)
        AND SP.EZCANCELFLAG(+)         = '0'
        AND SP.GLBL_CMPY_CD            = SS.GLBL_CMPY_CD(+)
        AND SP.SHPG_STS_CD             = SS.SHPG_STS_CD(+)
        AND SS.EZCANCELFLAG(+)         = '0'
        AND SP.GLBL_CMPY_CD            = PKT.GLBL_CMPY_CD(+)
        AND SP.SO_NUM                  = PKT.SO_NUM(+)
        AND SP.SO_SLP_NUM              = PKT.SO_SLP_NUM(+)
    </statement>

    <!-- QC#18401-SOL#014 Modify SQL -->
    <statement id="getOpenWkOrdKitDat" parameterClass="Map" resultClass="Map">
        SELECT
            WKOD.FNSH_GOODS_BAL_QTY
           ,WKOD.FNSH_GOODS_MDSE_CD
           ,WKOD.RTL_WH_CD || WKOD.CPLT_RTL_SWH_CD INVTY_LOC_CD
           ,WKOD.RQST_RCV_DT
           ,WKOD.WRK_ORD_DT
           ,WKOD.WRK_ORD_NUM
           ,DWOT.DS_WRK_ORD_TP_DESC_TXT
           ,WKOD.WRK_ORD_STS_CD
           ,WOS.DS_WRK_ORD_STS_NM
           <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
           ,WKOD.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,WKOD.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,WKOD.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,WKOD.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,WKOD.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM
            WRK_ORD           WKOD
           ,DS_WRK_ORD_TP     DWOT
           ,WRK_ORD_STS       WOS
        WHERE
            WKOD.GLBL_CMPY_CD                     = #GLBL_CMPY_CD#
        AND WKOD.EZCANCELFLAG                     = '0'
        AND WKOD.RCV_INVTY_LOC_CD                 LIKE #INVTY_LOC_CD#
        AND WKOD.RQST_RCV_DT                      &lt;= #THRU_DT#
        <isNotNull property="WRK_ORD_STS_CD">
            <iterate property="WRK_ORD_STS_CD" var="WRK_ORD_STS_CD[]" open="AND WKOD.WRK_ORD_STS_CD IN (" close=")" conjunction=",">
              #WRK_ORD_STS_CD[]#
            </iterate>
        </isNotNull>
        AND WKOD.FNSH_GOODS_MDSE_CD                IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND WKOD.FNSH_GOODS_BAL_QTY                &gt; 0
        AND WKOD.STK_STS_CD                        = #TO_STK_STS_CD#
        AND WKOD.DS_WRK_ORD_TP_CD                  = #DS_WRK_ORD_TP_CD#
        AND WKOD.GLBL_CMPY_CD                      = DWOT.GLBL_CMPY_CD
        AND WKOD.DS_WRK_ORD_TP_CD                  = DWOT.DS_WRK_ORD_TP_CD
        AND DWOT.EZCANCELFLAG                      = '0'
        AND WKOD.GLBL_CMPY_CD                      = WOS.GLBL_CMPY_CD
        AND WKOD.WRK_ORD_STS_CD                    = WOS.WRK_ORD_STS_CD
        AND WOS.EZCANCELFLAG                       = '0'
    </statement>

    <!-- QC#18401-SOL#014, QC#26554 Modify -->
    <statement id="getSavedCpoDat" parameterClass="Map" resultClass="Map">
        SELECT
            CPD.ORD_QTY
           ,CPD.MDSE_CD
           ,CPD.INVTY_LOC_CD
           ,CPD.RSD_DT
           ,SUBSTR(CPO.CPO_ORD_TS, 0, 8) ORD_DT
           ,CPO.CPO_ORD_NUM
           ,CPD.CPO_DTL_LINE_NUM
           ,COT.CPO_ORD_TP_DESC_TXT
           ,NULL AS RQST_RCV_DT
           ,CPO.ORD_HDR_DPLY_STS_CD
           ,HDS.ORD_HDR_DPLY_STS_DESC_TXT
           ,CONCAT (CPD.DS_ORD_POSN_NUM, '.')
               || CONCAT (CPD.DS_CPO_LINE_NUM, DECODE (CPD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
               || CPD.DS_CPO_LINE_SUB_NUM
               AS DPLY_LINE_NUM
           ,DOT.DS_ORD_TP_DESC_TXT
           <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
           ,CPD.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,CPD.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,CPD.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,CPD.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,CPD.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM
            CPO_DTL           CPD
           ,CPO               CPO
           ,CPO_ORD_TP        COT
           ,ORD_HDR_DPLY_STS  HDS
           ,DS_ORD_TP         DOT
        WHERE
            CPD.GLBL_CMPY_CD          = #GLBL_CMPY_CD#
        AND CPD.EZCANCELFLAG          = '0'
        <!-- START 2017/10/04 S.Katsuma QC#21429 ADD -->
        <isNull property="ORD_TAKE_MDSE_FLG">
        AND CPD.MDSE_CD               IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        </isNull>
        <isNotNull property="ORD_TAKE_MDSE_FLG">
        AND CPD.MDSE_CD               LIKE #MDSE_CD#
        </isNotNull>
        <!-- END 2017/10/04 S.Katsuma QC#21429 ADD -->
        AND CPD.INVTY_LOC_CD          LIKE #INVTY_LOC_CD#
        AND CPD.RSD_DT                &lt;= #THRU_DT#
        AND CPD.STK_STS_CD            = #TO_STK_STS_CD#
        AND CPD.GLBL_CMPY_CD          = CPO.GLBL_CMPY_CD
        AND CPD.CPO_ORD_NUM           = CPO.CPO_ORD_NUM
        AND CPO.ORD_HDR_DPLY_STS_CD   &lt; #ORD_HDR_DPLY_STS_BOOK#
        AND CPO.EZCANCELFLAG          = '0'
        AND CPD.GLBL_CMPY_CD          = COT.GLBL_CMPY_CD
        AND CPD.CPO_ORD_TP_CD         = COT.CPO_ORD_TP_CD
        AND COT.EZCANCELFLAG          = '0'
        AND CPO.GLBL_CMPY_CD          = HDS.GLBL_CMPY_CD
        AND CPO.ORD_HDR_DPLY_STS_CD   = HDS.ORD_HDR_DPLY_STS_CD
        AND HDS.EZCANCELFLAG          = '0'
        AND CPO.GLBL_CMPY_CD          = DOT.GLBL_CMPY_CD
        AND CPO.DS_ORD_TP_CD          = DOT.DS_ORD_TP_CD
        AND DOT.EZCANCELFLAG          = '0'
    </statement>

    <!-- QC#18401-SOL#014 Modify -->
    <statement id="getValidatedCpoDat" parameterClass="Map" resultClass="Map">
        SELECT
            SHP.ORD_QTY
           ,SHP.MDSE_CD
           ,SHP.INVTY_LOC_CD
           ,NVL(SHP.PSD_DT, SHP.RSD_DT) RSD_DT
           ,SUBSTR(CPO.CPO_ORD_TS, 0, 8) ORD_DT
           ,SHP.TRX_HDR_NUM
           ,SHP.TRX_LINE_NUM
           ,COT.CPO_ORD_TP_DESC_TXT
           ,NULL AS RQST_RCV_DT
           ,CPO.ORD_HDR_DPLY_STS_CD
           ,HDS.ORD_HDR_DPLY_STS_DESC_TXT
           ,SHP.SHPG_STS_CD
           ,CASE
              WHEN SHP.CR_HLD_QTY = 0 AND SHP.CR_CHK_QTY > 0 AND SHP.SHPG_STS_CD = #VALIDATED# THEN 'B/O'
              ELSE SS.SHPG_STS_NM
            END SHPG_STS_NM
           ,PKT.PKT_STS_TS
           ,CONCAT (CPD.DS_ORD_POSN_NUM, '.')
               || CONCAT (CPD.DS_CPO_LINE_NUM, DECODE (CPD.DS_CPO_LINE_SUB_NUM, NULL, '', '.'))
               || CPD.DS_CPO_LINE_SUB_NUM
               AS DPLY_LINE_NUM
           ,DOT.DS_ORD_TP_DESC_TXT
           <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
           ,SHP.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,SHP.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,SHP.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,SHP.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,SHP.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM
            SHPG_PLN          SHP
           ,CPO_DTL           CPD
           ,CPO               CPO
           ,CPO_ORD_TP        COT
           ,ORD_HDR_DPLY_STS  HDS
           ,SHPG_STS          SS
           ,(SELECT
                P.GLBL_CMPY_CD
               ,P.SO_NUM
               ,P.SO_SLP_NUM
               ,P.PKT_STS_TS
             FROM
                PKT P
                ,(SELECT
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                     ,MAX(MP.PKT_SQ_NUM) MAX_PKT_SQ_NUM
                  FROM
                      PKT MP
                  WHERE
                      MP.EZCANCELFLAG = '0'
                  GROUP BY
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                 ) M
             WHERE
                 P.GLBL_CMPY_CD = M.GLBL_CMPY_CD
             AND P.SO_NUM       = M.SO_NUM
             AND P.SO_SLP_NUM   = M.SO_SLP_NUM
             AND P.PKT_SQ_NUM   = M.MAX_PKT_SQ_NUM
            ) PKT
            ,DS_ORD_TP         DOT
        WHERE
            SHP.GLBL_CMPY_CD          = #GLBL_CMPY_CD#
        AND SHP.EZCANCELFLAG          = '0'
        <!-- START 2017/08/09 S.Katsuma QC#20543 ADD -->
        <isNull property="ORD_TAKE_MDSE_FLG">
        AND SHP.MDSE_CD               IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        </isNull>
        <isNotNull property="ORD_TAKE_MDSE_FLG">
        AND SHP.MDSE_CD               LIKE #MDSE_CD#
        </isNotNull>
        <!-- END 2017/08/09 S.Katsuma QC#20543 ADD -->
        AND SHP.INVTY_LOC_CD          LIKE #INVTY_LOC_CD#
        AND SHP.RSD_DT                &lt;= #THRU_DT#
        <!-- QC#18401-SOL#014 Validate <= Shpg_sts_cd < Shipped -->
        AND SHP.SHPG_STS_CD BETWEEN #VALIDATED# AND #INSHED#
        AND SHP.STK_STS_CD            = #TO_STK_STS_CD#
        AND SHP.GLBL_CMPY_CD          = CPD.GLBL_CMPY_CD
        AND SHP.TRX_HDR_NUM           = CPD.CPO_ORD_NUM
        AND SHP.TRX_LINE_NUM          = CPD.CPO_DTL_LINE_NUM
        AND SHP.TRX_LINE_SUB_NUM      = CPD.CPO_DTL_LINE_SUB_NUM
        AND CPD.EZCANCELFLAG          = '0'
        AND CPD.GLBL_CMPY_CD          = CPO.GLBL_CMPY_CD
        AND CPD.CPO_ORD_NUM           = CPO.CPO_ORD_NUM
        AND CPO.ORD_HDR_DPLY_STS_CD   &gt;= #ORD_HDR_DPLY_STS_BOOK#
        AND CPO.EZCANCELFLAG          = '0'
        AND CPD.GLBL_CMPY_CD          = COT.GLBL_CMPY_CD
        AND CPD.CPO_ORD_TP_CD         = COT.CPO_ORD_TP_CD
        AND COT.EZCANCELFLAG          = '0'
        AND CPO.GLBL_CMPY_CD          = HDS.GLBL_CMPY_CD
        AND CPO.ORD_HDR_DPLY_STS_CD   = HDS.ORD_HDR_DPLY_STS_CD
        AND HDS.EZCANCELFLAG          = '0'
        AND SHP.GLBL_CMPY_CD          = SS.GLBL_CMPY_CD
        AND SHP.SHPG_STS_CD           = SS.SHPG_STS_CD
        AND SS.EZCANCELFLAG           = '0'
        AND SHP.GLBL_CMPY_CD          = PKT.GLBL_CMPY_CD(+)
        AND SHP.SO_NUM                = PKT.SO_NUM(+)
        AND SHP.SO_SLP_NUM            = PKT.SO_SLP_NUM(+)
        AND CPO.GLBL_CMPY_CD          = DOT.GLBL_CMPY_CD
        AND CPO.DS_ORD_TP_CD          = DOT.DS_ORD_TP_CD
        AND DOT.EZCANCELFLAG          = '0'
    </statement>

    <!-- QC#18401-SOL#014 Modify -->
    <statement id="getBeforeInsPrDat" parameterClass="Map" resultClass="Map">
        SELECT
            PRDT.PRCH_REQ_BAL_QTY
           ,PRDT.MDSE_CD
           ,PRDT.SRC_INVTY_LOC_CD
           ,PRRQ.PRCH_REQ_CRAT_DT
           ,PRDT.PRCH_REQ_NUM
           ,PRDT.PRCH_REQ_LINE_NUM
           ,PRRT.PRCH_REQ_TP_DESC_TXT
           ,NULL AS RQST_RCV_DT
           ,PRDT.PRCH_REQ_LINE_STS_CD
           ,PRLS.PRCH_REQ_LINE_STS_NM
           ,PRRQ.PRCH_REQ_APVL_STS_CD
           ,PRAS.PRCH_REQ_APVL_STS_NM
           <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
           ,PRDT.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,PRDT.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,PRDT.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,PRDT.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,PRDT.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM
            PRCH_REQ           PRRQ
           ,PRCH_REQ_DTL       PRDT
           ,PRCH_REQ_APVL_STS  PRAS
           ,PRCH_REQ_LINE_STS  PRLS
           ,PRCH_REQ_TP        PRRT
        WHERE
            PRRQ.GLBL_CMPY_CD          = #GLBL_CMPY_CD#
        AND PRRQ.EZCANCELFLAG          = '0'
        AND PRRQ.PRCH_REQ_REC_TP_CD    = #PRCH_REQ_REC_TP_CD#
        AND PRRQ.PRCH_REQ_STS_CD       = #PRCH_REQ_STS_CD#
        <isNotNull property="batchMode">
        AND NOT (PRRQ.PRCH_REQ_APVL_STS_CD  = #PRCH_REQ_APVL_STS_CD#
            AND PRRQ.PRCH_REQ_SRC_TP_CD     = #PRCH_REQ_SRC_TP_CD#
            )
        </isNotNull>
        AND PRRQ.GLBL_CMPY_CD          = PRDT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
        AND PRDT.EZCANCELFLAG          = '0'
        AND PRDT.PRCH_REQ_LINE_SUB_NUM = 0
        AND PRDT.RQST_RCV_DT           &lt;= #THRU_DT#
        AND PRDT.MDSE_CD               IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND PRDT.SRC_INVTY_LOC_CD      LIKE #INVTY_LOC_CD#
        <!-- QC#27019 Update. Add NVL() and Add PRCH_REQ_FRZ_FLG -->
        AND NVL(PRDT.TO_STK_STS_CD, #STK_STS_GOOD#) = #TO_STK_STS_CD#
        AND PRDT.PRCH_REQ_FRZ_FLG      = #FLG_ON_Y#
        AND PRDT.PRCH_REQ_BAL_QTY      > 0
        AND PRRQ.GLBL_CMPY_CD          = PRAS.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_APVL_STS_CD  = PRAS.PRCH_REQ_APVL_STS_CD
        AND PRAS.EZCANCELFLAG          = '0'
  <!--  AND PRAS.PRCH_REQ_APVL_FLG     = #FLG_ON_Y#-->
        AND PRDT.GLBL_CMPY_CD          = PRLS.GLBL_CMPY_CD
        AND PRDT.PRCH_REQ_LINE_STS_CD  = PRLS.PRCH_REQ_LINE_STS_CD
        AND PRLS.EZCANCELFLAG          = '0'
        AND PRLS.OPEN_STS_FLG          = #FLG_ON_Y#
        AND PRRQ.GLBL_CMPY_CD          = PRRT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_TP_CD        = PRRT.PRCH_REQ_TP_CD
        AND PRRT.EZCANCELFLAG          = '0'
    </statement>

    <!-- QC#18401-SOL#014 Modify -->
    <statement id="getAfterInsPrDat" parameterClass="Map" resultClass="Map">
        SELECT
            SHOD.SHPG_QTY - SHOD.SHIP_QTY SCHD_QTY
           ,PRDT.MDSE_CD
           ,PRDT.SRC_INVTY_LOC_CD
           ,NVL(SHPO.PSD_DT, SHPO.RDD_DT) ETA_ETD_DT
           ,PRRQ.PRCH_REQ_CRAT_DT
           ,PRDT.PRCH_REQ_NUM
           ,PRDT.PRCH_REQ_LINE_NUM
           ,PRRT.PRCH_REQ_TP_DESC_TXT
           ,NULL AS RQST_RCV_DT
           ,PRDT.PRCH_REQ_LINE_STS_CD
           ,PRLS.PRCH_REQ_LINE_STS_NM
           ,SP.SHPG_STS_CD
           ,CASE
              WHEN SP.CR_HLD_QTY = 0 AND SP.CR_CHK_QTY > 0 AND SP.SHPG_STS_CD = #VALIDATED# THEN 'B/O'
              ELSE SS.SHPG_STS_NM
            END SHPG_STS_NM
           ,PRRQ.PRCH_REQ_APVL_STS_CD
           ,PRAS.PRCH_REQ_APVL_STS_NM
        FROM
            PRCH_REQ           PRRQ
           ,PRCH_REQ_DTL       PRDT
           ,PRCH_REQ_APVL_STS  PRAS
           ,SHPG_ORD_DTL       SHOD
           ,SHPG_ORD           SHPO
           ,PRCH_REQ_TP        PRRT
           ,PRCH_REQ_LINE_STS  PRLS
           ,SHPG_PLN           SP
           ,SHPG_STS           SS
           ,(SELECT
                P.GLBL_CMPY_CD
               ,P.SO_NUM
               ,P.SO_SLP_NUM
               ,P.PKT_STS_TS
             FROM
                PKT P
                ,(SELECT
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                     ,MAX(MP.PKT_SQ_NUM) MAX_PKT_SQ_NUM
                  FROM
                      PKT MP
                  WHERE
                      MP.EZCANCELFLAG = '0'
                  GROUP BY
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                 ) M
             WHERE
                 P.GLBL_CMPY_CD = M.GLBL_CMPY_CD
             AND P.SO_NUM       = M.SO_NUM
             AND P.SO_SLP_NUM   = M.SO_SLP_NUM
             AND P.PKT_SQ_NUM   = M.MAX_PKT_SQ_NUM
            ) PKT
        WHERE
            PRRQ.GLBL_CMPY_CD                 = #GLBL_CMPY_CD#
        AND PRRQ.EZCANCELFLAG                 = '0'
        AND PRRQ.PRCH_REQ_REC_TP_CD           = #PRCH_REQ_REC_TP_CD#
        AND PRRQ.PRCH_REQ_STS_CD              = #PRCH_REQ_STS_CD#
        AND PRRQ.GLBL_CMPY_CD                 = PRDT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_NUM                 = PRDT.PRCH_REQ_NUM
        AND PRDT.EZCANCELFLAG                 = '0'
        AND PRDT.PRCH_REQ_LINE_SUB_NUM        != 0
        AND PRDT.MDSE_CD                      IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND PRDT.SRC_INVTY_LOC_CD             LIKE #INVTY_LOC_CD#
        AND PRDT.TO_STK_STS_CD                = #TO_STK_STS_CD#
        AND PRDT.PRCH_REQ_QTY - PRDT.SHIP_QTY > 0
        AND PRRQ.GLBL_CMPY_CD                 = PRAS.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_APVL_STS_CD         = PRAS.PRCH_REQ_APVL_STS_CD
        AND PRAS.EZCANCELFLAG                 = '0'
  <!--  AND PRAS.PRCH_REQ_APVL_FLG            = #FLG_ON_Y# -->
        AND PRDT.GLBL_CMPY_CD                 = SHOD.GLBL_CMPY_CD
        AND PRDT.PRCH_REQ_NUM                 = SHOD.PRCH_REQ_NUM
        AND PRDT.PRCH_REQ_LINE_NUM            = SHOD.PRCH_REQ_LINE_NUM
        AND PRDT.PRCH_REQ_LINE_SUB_NUM        = SHOD.PRCH_REQ_LINE_SUB_NUM
        AND SHOD.EZCANCELFLAG                  = '0'
        AND SHOD.SHPG_QTY - SHOD.SHIP_QTY     > 0
        AND SHOD.GLBL_CMPY_CD                 = SHPO.GLBL_CMPY_CD
        AND SHOD.SO_NUM                       = SHPO.SO_NUM
        AND SHPO.EZCANCELFLAG                 = '0'
        AND NVL(SHPO.PSD_DT, SHPO.RDD_DT)     &lt;= #THRU_DT#
        AND PRRQ.GLBL_CMPY_CD                 = PRRT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_TP_CD               = PRRT.PRCH_REQ_TP_CD
        AND PRRT.EZCANCELFLAG                 = '0'
        AND PRDT.GLBL_CMPY_CD                 = PRLS.GLBL_CMPY_CD
        AND PRDT.PRCH_REQ_LINE_STS_CD         = PRLS.PRCH_REQ_LINE_STS_CD
        AND PRLS.OPEN_STS_FLG                 = #FLG_ON_Y#
        AND PRLS.EZCANCELFLAG                 = '0'
        AND SHOD.GLBL_CMPY_CD                 = SP.GLBL_CMPY_CD(+)
        AND SHOD.SHPG_PLN_NUM                 = SP.SHPG_PLN_NUM(+)
        AND SP.EZCANCELFLAG(+)                = '0'
        AND SP.GLBL_CMPY_CD                   = SS.GLBL_CMPY_CD(+)
        AND SP.SHPG_STS_CD                    = SS.SHPG_STS_CD(+)
        AND SS.EZCANCELFLAG(+)                = '0'
        AND SP.GLBL_CMPY_CD                   = PKT.GLBL_CMPY_CD(+)
        AND SP.SO_NUM                         = PKT.SO_NUM(+)
        AND SP.SO_SLP_NUM                     = PKT.SO_SLP_NUM(+)
    </statement>

    <!-- QC#18401-SOL#014 Modify -->
    <statement id="getOpenOutInvReqDat" parameterClass="Map" resultClass="Map">
        SELECT
            PRDT.PRCH_REQ_QTY SCHD_OTBD_QTY
           ,PRDT.MDSE_CD
           ,PRDT.SRC_INVTY_LOC_CD
           ,PRDT.RQST_RCV_DT ETA_ETD_DT
           ,PRRQ.PRCH_REQ_CRAT_DT
           ,PRDT.PRCH_REQ_NUM
           ,PRDT.PRCH_REQ_LINE_NUM
           ,CASE WHEN PRRQ.PRCH_REQ_TP_CD IN
               <iterate property="TECH_REQ" var="TECH_REQ[]" open="(" close=")" conjunction=",">
                   #TECH_REQ[]#
               </iterate>
               THEN PRRRT.PRCH_REQ_REC_TP_DESC_TXT
               ELSE PRRT.PRCH_REQ_TP_DESC_TXT
            END AS PRCH_REQ_TP_DESC_TXT
           ,NULL AS RQST_RCV_DT
           ,NULL AS RQST_RCV_DT
           ,PRDT.PRCH_REQ_LINE_STS_CD
           ,PRLS.PRCH_REQ_LINE_STS_NM
           ,SP.SHPG_STS_CD
           ,CASE
              WHEN SP.CR_HLD_QTY = 0 AND SP.CR_CHK_QTY &gt; 0 AND SP.SHPG_STS_CD = #VALIDATED# THEN 'B/O'
              ELSE SS.SHPG_STS_NM
            END SHPG_STS_NM
           ,PRRQ.PRCH_REQ_APVL_STS_CD
           ,PRAS.PRCH_REQ_APVL_STS_NM
           ,PKT.PKT_STS_TS
           ,PRRQ.PRCH_REQ_REC_TP_CD
           <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
           ,PRDT.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,PRDT.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,PRDT.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,PRDT.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,PRDT.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM
            PRCH_REQ           PRRQ
           ,PRCH_REQ_DTL       PRDT
           ,PRCH_REQ_APVL_STS  PRAS
           ,PRCH_REQ_LINE_STS  PRLS
           ,PRCH_REQ_TP        PRRT
           ,PRCH_REQ_REC_TP    PRRRT
           ,SHPG_PLN           SP
           ,SHPG_STS           SS
           ,(SELECT
                P.GLBL_CMPY_CD
               ,P.SO_NUM
               ,P.SO_SLP_NUM
               ,P.PKT_STS_TS
             FROM
                PKT P
                ,(SELECT
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                     ,MAX(MP.PKT_SQ_NUM) MAX_PKT_SQ_NUM
                  FROM
                      PKT MP
                  WHERE
                      MP.EZCANCELFLAG = '0'
                  GROUP BY
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                 ) M
             WHERE
                 P.GLBL_CMPY_CD = M.GLBL_CMPY_CD
             AND P.SO_NUM       = M.SO_NUM
             AND P.SO_SLP_NUM   = M.SO_SLP_NUM
             AND P.PKT_SQ_NUM   = M.MAX_PKT_SQ_NUM
            ) PKT
        WHERE
            PRRQ.GLBL_CMPY_CD                 = #GLBL_CMPY_CD#
        AND PRRQ.EZCANCELFLAG                 = '0'
        AND PRRQ.PRCH_REQ_TP_CD              != #prchReqTpCdKt#
        AND PRRQ.PRCH_REQ_STS_CD              = #PRCH_REQ_STS_CD#
        <isNotNull property="batchMode">
        AND NOT (PRRQ.PRCH_REQ_APVL_STS_CD  = #PRCH_REQ_APVL_STS_CD#
            <iterate property="prchReqSrcTpCdList" var="prchReqSrcTpCd[]" open="AND PRRQ.PRCH_REQ_SRC_TP_CD IN (" conjunction="," close=")">
            #prchReqSrcTpCd[]#
            </iterate>
            )
        </isNotNull>
        AND PRRQ.GLBL_CMPY_CD                 = PRRRT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_REC_TP_CD           = PRRRT.PRCH_REQ_REC_TP_CD
        AND PRRRT.EZCANCELFLAG                = '0'
        AND PRRQ.GLBL_CMPY_CD                 = PRDT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_NUM                 = PRDT.PRCH_REQ_NUM
        AND PRDT.EZCANCELFLAG                 = '0'
        AND PRDT.MDSE_CD                      IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND PRDT.SRC_INVTY_LOC_CD             LIKE #INVTY_LOC_CD#
        AND PRDT.FROM_STK_STS_CD              = #FROM_STK_STS_CD#
        AND PRRQ.GLBL_CMPY_CD                 = PRAS.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_APVL_STS_CD         = PRAS.PRCH_REQ_APVL_STS_CD
        AND PRAS.EZCANCELFLAG                 = '0'
  <!--  AND PRAS.PRCH_REQ_APVL_FLG            = #FLG_ON_Y# -->
        AND PRLS.PRCH_REQ_LINE_STS_CD         = PRDT.PRCH_REQ_LINE_STS_CD
        AND PRLS.OPEN_STS_FLG                 = #FLG_ON_Y#
        AND PRLS.GLBL_CMPY_CD                 = PRDT.GLBL_CMPY_CD
        AND PRLS.EZCANCELFLAG                 = '0'
        AND PRRQ.GLBL_CMPY_CD                 = PRRT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_TP_CD               = PRRT.PRCH_REQ_TP_CD
        <!-- QC#27020 Add condition -->
        AND PRRT.SCE_ORD_TP_CD                != #SCE_ORD_TP_TR#
        AND PRRT.EZCANCELFLAG                 = '0'
        AND PRDT.GLBL_CMPY_CD                 = SP.GLBL_CMPY_CD(+)
        AND PRDT.PRCH_REQ_NUM                 = SP.TRX_HDR_NUM(+)
        AND PRDT.PRCH_REQ_LINE_NUM            = SP.TRX_LINE_NUM(+)
        AND SP.EZCANCELFLAG(+)                = '0'
        AND SP.GLBL_CMPY_CD                   = SS.GLBL_CMPY_CD(+)
        AND SP.SHPG_STS_CD                    = SS.SHPG_STS_CD(+)
        AND SS.EZCANCELFLAG(+)                = '0'
        AND SP.GLBL_CMPY_CD                   = PKT.GLBL_CMPY_CD(+)
        AND SP.SO_NUM                         = PKT.SO_NUM(+)
        AND SP.SO_SLP_NUM                     = PKT.SO_SLP_NUM(+)
        <!-- QC#18401 -->
<!--        AND ( PRDT.PRCH_REQ_REL_STS_CD        = #PRCH_REQ_REL_STS_CD#   -->
        AND  ( NOT EXISTS (SELECT 1
                          FROM   SHPG_ORD_DTL SOD
                          WHERE  SOD.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
                          AND    SOD.PRCH_REQ_LINE_NUM     = PRDT.PRCH_REQ_LINE_NUM
                          AND    SOD.PRCH_REQ_LINE_SUB_NUM = TO_CHAR(PRDT.PRCH_REQ_LINE_SUB_NUM)
                          AND    SOD.DS_SO_LINE_STS_CD    IN
                          <iterate property="DS_SO_LINE_STS_CD" var="DS_SO_LINE_STS_CD[]" open="(" close=")" conjunction=",">
                              #DS_SO_LINE_STS_CD[]#
                          </iterate>
                          AND    SOD.GLBL_CMPY_CD          = PRDT.GLBL_CMPY_CD
                          AND    SOD.EZCANCELFLAG          = '0'
                          )
        AND   NOT EXISTS (SELECT 1
                          FROM   CPO     CPO
                                ,CPO_DTL CD
                          WHERE  CPO.ORD_SRC_REF_NUM          = PRDT.PRCH_REQ_NUM
                          AND    CPO.GLBL_CMPY_CD             = PRDT.GLBL_CMPY_CD
                          AND    CPO.EZCANCELFLAG             = '0'
                          AND    CPO.CPO_ORD_NUM              = CD.CPO_ORD_NUM
                          AND    CPO.GLBL_CMPY_CD             = CD.GLBL_CMPY_CD
                          AND    CD.ORD_SRC_REF_LINE_NUM      = PRDT.PRCH_REQ_LINE_NUM
                          AND    CD.ORD_SRC_REF_LINE_SUB_NUM  = TO_CHAR(PRDT.PRCH_REQ_LINE_SUB_NUM)
                          AND    CD.GLBL_CMPY_CD              = PRDT.GLBL_CMPY_CD
                          AND    CD.EZCANCELFLAG              = '0'
                          )
                          )
        <!-- QC#27020 Add SQL: Insourced Tech Request -->
        UNION ALL
                SELECT
            PRDT.PRCH_REQ_QTY SCHD_OTBD_QTY
           ,PRDT.MDSE_CD
           ,PRDT.SRC_INVTY_LOC_CD
           ,PRDT.RQST_RCV_DT ETA_ETD_DT
           ,PRRQ.PRCH_REQ_CRAT_DT
           ,PRDT.PRCH_REQ_NUM
           ,PRDT.PRCH_REQ_LINE_NUM
           ,CASE WHEN PRRQ.PRCH_REQ_TP_CD IN
               <iterate property="TECH_REQ" var="TECH_REQ[]" open="(" close=")" conjunction=",">
                   #TECH_REQ[]#
               </iterate>
               THEN PRRRT.PRCH_REQ_REC_TP_DESC_TXT
               ELSE PRRT.PRCH_REQ_TP_DESC_TXT
            END AS PRCH_REQ_TP_DESC_TXT
           ,NULL AS RQST_RCV_DT
           ,NULL AS RQST_RCV_DT
           ,PRDT.PRCH_REQ_LINE_STS_CD
           ,PRLS.PRCH_REQ_LINE_STS_NM
           ,SP.SHPG_STS_CD
           ,CASE
              WHEN SP.CR_HLD_QTY = 0 AND SP.CR_CHK_QTY &gt; 0 AND SP.SHPG_STS_CD = #VALIDATED# THEN 'B/O'
              ELSE SS.SHPG_STS_NM
            END SHPG_STS_NM
           ,PRRQ.PRCH_REQ_APVL_STS_CD
           ,PRAS.PRCH_REQ_APVL_STS_NM
           ,PKT.PKT_STS_TS
           ,PRRQ.PRCH_REQ_REC_TP_CD
           <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
           ,PRDT.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,PRDT.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,PRDT.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,PRDT.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,PRDT.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM
            PRCH_REQ           PRRQ
           ,PRCH_REQ_DTL       PRDT
           ,PRCH_REQ_APVL_STS  PRAS
           ,PRCH_REQ_LINE_STS  PRLS
           ,PRCH_REQ_TP        PRRT
           ,PRCH_REQ_REC_TP    PRRRT
           ,SHPG_PLN           SP
           ,SHPG_STS           SS
           ,(SELECT
                P.GLBL_CMPY_CD
               ,P.SO_NUM
               ,P.SO_SLP_NUM
               ,P.PKT_STS_TS
             FROM
                PKT P
                ,(SELECT
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                     ,MAX(MP.PKT_SQ_NUM) MAX_PKT_SQ_NUM
                  FROM
                      PKT MP
                  WHERE
                      MP.EZCANCELFLAG = '0'
                  GROUP BY
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                 ) M
             WHERE
                 P.GLBL_CMPY_CD = M.GLBL_CMPY_CD
             AND P.SO_NUM       = M.SO_NUM
             AND P.SO_SLP_NUM   = M.SO_SLP_NUM
             AND P.PKT_SQ_NUM   = M.MAX_PKT_SQ_NUM
            ) PKT
        WHERE
            PRRQ.GLBL_CMPY_CD                 = #GLBL_CMPY_CD#
        AND PRRQ.EZCANCELFLAG                 = '0'
        AND PRRQ.PRCH_REQ_TP_CD              != #prchReqTpCdKt#
        AND PRRQ.PRCH_REQ_STS_CD              = #PRCH_REQ_STS_CD#
        <isNotNull property="batchMode">
        AND NOT (PRRQ.PRCH_REQ_APVL_STS_CD  = #PRCH_REQ_APVL_STS_CD#
            <iterate property="prchReqSrcTpCdList" var="prchReqSrcTpCd[]" open="AND PRRQ.PRCH_REQ_SRC_TP_CD IN (" conjunction="," close=")">
            #prchReqSrcTpCd[]#
            </iterate>
            )
        </isNotNull>
        AND PRRQ.GLBL_CMPY_CD                 = PRRRT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_REC_TP_CD           = PRRRT.PRCH_REQ_REC_TP_CD
        AND PRRRT.EZCANCELFLAG                = '0'
        AND PRRQ.GLBL_CMPY_CD                 = PRDT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_NUM                 = PRDT.PRCH_REQ_NUM
        AND PRDT.EZCANCELFLAG                 = '0'
        AND PRDT.MDSE_CD                      IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND PRDT.SRC_INVTY_LOC_CD             LIKE #INVTY_LOC_CD#
        AND PRDT.FROM_STK_STS_CD              = #FROM_STK_STS_CD#
        AND PRDT.ORIG_PRCH_REQ_LINE_NUM       IS NOT NULL
        AND PRRQ.GLBL_CMPY_CD                 = PRAS.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_APVL_STS_CD         = PRAS.PRCH_REQ_APVL_STS_CD
        AND PRAS.EZCANCELFLAG                 = '0'
        AND PRLS.PRCH_REQ_LINE_STS_CD         = PRDT.PRCH_REQ_LINE_STS_CD
        AND PRLS.OPEN_STS_FLG                 = #FLG_ON_Y#
        AND PRLS.GLBL_CMPY_CD                 = PRDT.GLBL_CMPY_CD
        AND PRLS.EZCANCELFLAG                 = '0'
        AND PRRQ.GLBL_CMPY_CD                 = PRRT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_TP_CD               = PRRT.PRCH_REQ_TP_CD
        AND PRRT.SCE_ORD_TP_CD                = #SCE_ORD_TP_TR#
        AND PRRT.EZCANCELFLAG                 = '0'
        AND PRDT.GLBL_CMPY_CD                 = SP.GLBL_CMPY_CD(+)
        AND PRDT.PRCH_REQ_NUM                 = SP.TRX_HDR_NUM(+)
        AND PRDT.PRCH_REQ_LINE_NUM            = SP.TRX_LINE_NUM(+)
        AND SP.EZCANCELFLAG(+)                = '0'
        AND SP.GLBL_CMPY_CD                   = SS.GLBL_CMPY_CD(+)
        AND SP.SHPG_STS_CD                    = SS.SHPG_STS_CD(+)
        AND SS.EZCANCELFLAG(+)                = '0'
        AND SP.GLBL_CMPY_CD                   = PKT.GLBL_CMPY_CD(+)
        AND SP.SO_NUM                         = PKT.SO_NUM(+)
        AND SP.SO_SLP_NUM                     = PKT.SO_SLP_NUM(+)
        AND  ( NOT EXISTS (SELECT 1
                          FROM   SHPG_ORD_DTL SOD
                          WHERE  SOD.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
                          AND    SOD.PRCH_REQ_LINE_NUM     = PRDT.PRCH_REQ_LINE_NUM
                          AND    SOD.PRCH_REQ_LINE_SUB_NUM = TO_CHAR(PRDT.PRCH_REQ_LINE_SUB_NUM)
                          AND    SOD.DS_SO_LINE_STS_CD    IN
                          <iterate property="DS_SO_LINE_STS_CD" var="DS_SO_LINE_STS_CD[]" open="(" close=")" conjunction=",">
                              #DS_SO_LINE_STS_CD[]#
                          </iterate>
                          AND    SOD.GLBL_CMPY_CD          = PRDT.GLBL_CMPY_CD
                          AND    SOD.EZCANCELFLAG          = '0'
                          )
        AND   NOT EXISTS (SELECT 1
                          FROM   CPO     CPO
                                ,CPO_DTL CD
                          WHERE  CPO.ORD_SRC_REF_NUM          = PRDT.PRCH_REQ_NUM
                          AND    CPO.GLBL_CMPY_CD             = PRDT.GLBL_CMPY_CD
                          AND    CPO.EZCANCELFLAG             = '0'
                          AND    CPO.CPO_ORD_NUM              = CD.CPO_ORD_NUM
                          AND    CPO.GLBL_CMPY_CD             = CD.GLBL_CMPY_CD
                          AND    CD.ORD_SRC_REF_LINE_NUM      = PRDT.PRCH_REQ_LINE_NUM
                          AND    CD.ORD_SRC_REF_LINE_SUB_NUM  = TO_CHAR(PRDT.PRCH_REQ_LINE_SUB_NUM)
                          AND    CD.GLBL_CMPY_CD              = PRDT.GLBL_CMPY_CD
                          AND    CD.EZCANCELFLAG              = '0'
                          )
                          )
    </statement>

    <!-- QC#18401-SOL#014 Modify -->
    <statement id="getOpenWorkOrderSavedDat" parameterClass="Map" resultClass="Map">
        SELECT
            WRKD.ORIG_GOODS_BAL_QTY SCHD_OTBD_QTY
           ,WRKD.ORIG_GOODS_MDSE_CD MDSE_CD
           ,WRKO.RTL_WH_CD || WRKD.SPLY_RTL_SWH_CD INVTY_LOC_CD
           ,WRKO.WRK_ORD_DT
           ,WRKO.WRK_ORD_NUM
           ,DWKT.DS_WRK_ORD_TP_DESC_TXT
           ,NULL AS RQST_RCV_DT
           ,WRKO.WRK_ORD_STS_CD
           ,WOS.DS_WRK_ORD_STS_NM
           ,NULL AS SHPG_STS_CD
           ,'B/O' AS SHPG_STS_NM
           ,WRKD.WRK_ORD_DTL_LINE_NUM
           <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
           ,WRKD.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,WRKD.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,WRKD.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,WRKD.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,WRKD.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM
            WRK_ORD            WRKO
           ,WRK_ORD_DTL        WRKD
           ,DS_WRK_ORD_TP      DWKT
           ,WRK_ORD_STS        WOS
        WHERE
            WRKO.GLBL_CMPY_CD                           = #GLBL_CMPY_CD#
        AND WRKO.EZCANCELFLAG                           = '0'
        AND WRKO.WRK_ORD_STS_CD                         = #WRK_ORD_STS_CD#
        AND WRKO.DS_WRK_ORD_TP_CD                       = #DS_WRK_ORD_TP_CD#
        AND WRKO.GLBL_CMPY_CD                           = WRKD.GLBL_CMPY_CD
        AND WRKO.WRK_ORD_NUM                            = WRKD.WRK_ORD_NUM
        AND WRKD.STK_STS_CD                             = #TO_STK_STS_CD#
        AND WRKD.EZCANCELFLAG                           = '0'
        AND WRKD.ORIG_GOODS_MDSE_CD                     IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND WRKO.RTL_WH_CD || WRKD.SPLY_RTL_SWH_CD      LIKE #INVTY_LOC_CD#
        AND WRKO.GLBL_CMPY_CD                           = DWKT.GLBL_CMPY_CD
        AND WRKO.DS_WRK_ORD_TP_CD                       = DWKT.DS_WRK_ORD_TP_CD
        AND DWKT.EZCANCELFLAG                           = '0'
        AND WRKO.GLBL_CMPY_CD                           = WOS.GLBL_CMPY_CD
        AND WRKO.WRK_ORD_STS_CD                         = WOS.WRK_ORD_STS_CD
        AND WOS.EZCANCELFLAG                            = '0'
    </statement>

    <!-- QC#18401-SOL#014 Modify -->
    <statement id="getOpenWorkOrderDat" parameterClass="Map" resultClass="Map">
        SELECT
            SHOD.SHPG_QTY - SHOD.SHIP_QTY SCHD_OTBD_QTY
           ,WRKD.ORIG_GOODS_MDSE_CD MDSE_CD
           ,WRKO.RTL_WH_CD || WRKD.SPLY_RTL_SWH_CD INVTY_LOC_CD
           ,WRKO.WRK_ORD_DT
           ,WRKO.WRK_ORD_NUM
           ,DWKT.DS_WRK_ORD_TP_DESC_TXT
           ,NULL AS RQST_RCV_DT
           ,WRKO.WRK_ORD_STS_CD
           ,WOS.DS_WRK_ORD_STS_NM
           ,SP.SHPG_STS_CD
           ,SS.SHPG_STS_NM
           ,PKT.PKT_STS_TS
           ,WRKD.WRK_ORD_DTL_LINE_NUM
           <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
           ,WRKD.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,WRKD.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,WRKD.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,WRKD.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,WRKD.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM
            WRK_ORD            WRKO
           ,WRK_ORD_DTL        WRKD
           ,DS_WRK_ORD_TP      DWKT
           ,SHPG_ORD_DTL       SHOD
           ,SHPG_ORD           SHPO
           ,WRK_ORD_STS        WOS
           ,SHPG_PLN           SP
           ,SHPG_STS           SS
           ,(SELECT
                P.GLBL_CMPY_CD
               ,P.SO_NUM
               ,P.SO_SLP_NUM
               ,P.PKT_STS_TS
             FROM
                PKT P
                ,(SELECT
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                     ,MAX(MP.PKT_SQ_NUM) MAX_PKT_SQ_NUM
                  FROM
                      PKT MP
                  WHERE
                      MP.EZCANCELFLAG = '0'
                  GROUP BY
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                 ) M
             WHERE
                 P.GLBL_CMPY_CD = M.GLBL_CMPY_CD
             AND P.SO_NUM       = M.SO_NUM
             AND P.SO_SLP_NUM   = M.SO_SLP_NUM
             AND P.PKT_SQ_NUM   = M.MAX_PKT_SQ_NUM
            ) PKT
        WHERE
            WRKO.GLBL_CMPY_CD                           = #GLBL_CMPY_CD#
        AND WRKO.EZCANCELFLAG                           = '0'
        AND WRKO.WRK_ORD_STS_CD                         = #WRK_ORD_STS_CD#
        AND WRKO.DS_WRK_ORD_TP_CD                       = #DS_WRK_ORD_TP_CD#
        AND WRKO.GLBL_CMPY_CD                           = WRKD.GLBL_CMPY_CD
        AND WRKO.WRK_ORD_NUM                            = WRKD.WRK_ORD_NUM
        AND WRKD.STK_STS_CD                             = #TO_STK_STS_CD#
        AND WRKD.EZCANCELFLAG                           = '0'
        AND WRKD.ORIG_GOODS_MDSE_CD                     IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND WRKO.RTL_WH_CD || WRKD.SPLY_RTL_SWH_CD      LIKE #INVTY_LOC_CD#
        AND WRKO.GLBL_CMPY_CD                           = DWKT.GLBL_CMPY_CD
        AND WRKO.DS_WRK_ORD_TP_CD                       = DWKT.DS_WRK_ORD_TP_CD
        AND DWKT.EZCANCELFLAG                           = '0'
        AND WRKD.GLBL_CMPY_CD                           = SHOD.GLBL_CMPY_CD
        AND WRKD.WRK_ORD_NUM                            = SHOD.TRX_HDR_NUM
        AND WRKD.WRK_ORD_DTL_LINE_NUM                   = SHOD.TRX_LINE_NUM
        AND SHOD.EZCANCELFLAG                           = '0'
        AND SHOD.GLBL_CMPY_CD                           = SHPO.GLBL_CMPY_CD
        AND SHOD.SO_NUM                                 = SHPO.SO_NUM
        AND SHOD.SHPG_QTY - SHOD.SHIP_QTY               > 0
        AND SHPO.EZCANCELFLAG                           = '0'
  <!--  AND NVL(SHPO.PSD_DT, SHPO.RDD_DT)               &lt;= #THRU_DT#  -->
        AND WRKO.RQST_RCV_DT                            &lt;= #THRU_DT#
        AND WRKO.GLBL_CMPY_CD                           = WOS.GLBL_CMPY_CD
        AND WRKO.WRK_ORD_STS_CD                         = WOS.WRK_ORD_STS_CD
        AND WOS.EZCANCELFLAG                            = '0'
        AND SHOD.GLBL_CMPY_CD                           = SP.GLBL_CMPY_CD(+)
        AND SHOD.SHPG_PLN_NUM                           = SP.SHPG_PLN_NUM(+)
        AND SP.EZCANCELFLAG(+)                          = '0'
        AND SP.GLBL_CMPY_CD                             = SS.GLBL_CMPY_CD(+)
        AND SP.SHPG_STS_CD                              = SS.SHPG_STS_CD(+)
        AND SS.EZCANCELFLAG(+)                          = '0'
        AND SP.GLBL_CMPY_CD                             = PKT.GLBL_CMPY_CD(+)
        AND SP.SO_NUM                                   = PKT.SO_NUM(+)
        AND SP.SO_SLP_NUM                               = PKT.SO_SLP_NUM(+)
    </statement>

    <!-- QC#18401-SOL#014 Modify -->
    <statement id="getOpenRemanOrderDat" parameterClass="Map" resultClass="Map">
        SELECT 1 SCHD_INBD_QTY
              ,ROD.RMNF_TO_CMPT_MDSE_CD
              ,ROH.RMNF_RTL_WH_CD || ROH.RMNF_RTL_SWH_CD INVTY_LOC_CD
              ,RWH.WH_IN_ETA_DT
              ,ROH.RMNF_START_DT
              ,ROH.RMNF_ORD_NUM
              ,ROD.RMNF_ORD_DTL_LINE_NUM
              <!-- START 2017/07/27 S.Katsuma QC#19656 ADD -->
              ,ROT.RMNF_ORD_TP_DESC_TXT
              <!-- END 2017/07/27 S.Katsuma QC#19656 ADD -->
              ,NULL AS RQST_RCV_DT
              ,ROH.RMNF_ORD_STS_CD
              ,ROS.RMNF_ORD_STS_NM
              <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
              ,ROD.EZINTIME AS XX_REC_HIST_CRAT_TS
              ,ROD.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
              ,ROD.EZUPTIME AS XX_REC_HIST_UPD_TS
              ,ROD.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
              ,ROD.EZTABLEID AS XX_REC_HIST_TBL_NM
              <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM   RMNF_ORD     ROH
              ,RMNF_ORD_DTL ROD
              ,RMNF_ORD_STS ROS
              ,RWS_HDR      RWH
              <!-- START 2017/07/27 S.Katsuma QC#19656 ADD -->
              ,RMNF_ORD_TP  ROT
              <!-- END 2017/07/27 S.Katsuma QC#19656 ADD -->
        WHERE  ROH.GLBL_CMPY_CD           = #GLBL_CMPY_CD#
        AND    ROH.RMNF_RTL_WH_CD || ROH.RMNF_RTL_SWH_CD LIKE #INVTY_LOC_CD#
        AND    ROH.RMNF_START_DT      &lt;= #THRU_DT#
        AND    ROH.EZCANCELFLAG           = '0'
        AND    ROH.GLBL_CMPY_CD           = ROD.GLBL_CMPY_CD
   <!-- AND    ROH.RMNF_MAIN_UNIT_MDSE_CD = ROD.CMPT_MDSE_CD -->
        AND    ROH.RMNF_ORD_NUM           = ROD.RMNF_ORD_NUM
        AND    ROD.RMNF_TO_CMPT_MDSE_CD IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND    ROD.EZCANCELFLAG           = '0'
        AND    ROH.GLBL_CMPY_CD           = ROS.GLBL_CMPY_CD
        AND    ROH.RMNF_ORD_STS_CD        = ROS.RMNF_ORD_STS_CD
        AND    ROS.OPEN_STS_FLG           = #FLG_ON_Y#
        AND    ROS.EZCANCELFLAG           = '0'
        AND    ROD.GLBL_CMPY_CD           = RWH.GLBL_CMPY_CD(+)
        AND    ROD.RMNF_ORD_NUM           = RWH.PO_RCV_TRX_HDR_NUM(+)
        AND    RWH.EZCANCELFLAG(+)        = '0'
        <!-- START 2017/07/27 S.Katsuma QC#19656 ADD -->
        AND    ROH.GLBL_CMPY_CD           = ROT.GLBL_CMPY_CD
        AND    ROH.RMNF_ORD_TP_CD         = ROT.RMNF_ORD_TP_CD
        AND    ROT.EZCANCELFLAG           = '0'
        <!-- END 2017/07/27 S.Katsuma QC#19656 ADD -->
    </statement>

    <!-- QC#18401-SOL#014 Modify SQL -->
    <statement id="getOpenRemanOrderPlannedWhDat" parameterClass="Map" resultClass="Map">
    SELECT
      *
    FROM (
        SELECT RPR.PRT_RQST_QTY       AS  SCHD_OTBD_QTY
              ,RPR.MDSE_CD
              ,RPR.SRC_INVTY_LOC_CD   AS  INVTY_LOC_CD
              ,NULL                   AS  ETA_ETD_DT
              ,ROH.RMNF_CRAT_DT       AS  ORD_DT
              ,ROH.RMNF_ORD_NUM
              ,RPR.RMNF_PRT_REQ_LINE_NUM
              ,ROT.RMNF_ORD_TP_DESC_TXT
              ,NULL AS RQST_RCV_DT
              ,ROH.RMNF_ORD_STS_CD
              ,ROS.RMNF_ORD_STS_NM
              ,SOD.SHPG_STS_CD
              ,CASE WHEN RMNF_PRT_RQST_PROC_CD = #NOT_PROCESS# THEN 'B/O'
                    ELSE SS.SHPG_STS_NM
               END SHPG_STS_NM
              ,PKT.PKT_STS_TS
              <!-- START 2023/04/17 G.Quan [QC#61206, ADD] -->
              ,ROH.EZINTIME AS XX_REC_HIST_CRAT_TS
              ,ROH.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
              ,ROH.EZUPTIME AS XX_REC_HIST_UPD_TS
              ,ROH.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
              ,ROH.EZTABLEID AS XX_REC_HIST_TBL_NM
              <!-- END 2023/04/17 G.Quan [QC#61206, ADD] -->
        FROM   RMNF_ORD     ROH
              ,RMNF_PRT_REQ RPR
              ,RMNF_ORD_TP  ROT
              ,SHPG_ORD_DTL SOD
              ,RMNF_ORD_STS ROS
              ,SHPG_STS     SS
              ,(SELECT
                    P.GLBL_CMPY_CD
                   ,P.SO_NUM
                   ,P.SO_SLP_NUM
                   ,P.PKT_STS_TS
                FROM
                    PKT P
                    ,(SELECT
                          MP.GLBL_CMPY_CD
                         ,MP.SO_NUM
                         ,MP.SO_SLP_NUM
                         ,MAX(MP.PKT_SQ_NUM) MAX_PKT_SQ_NUM
                     FROM
                         PKT MP
                     WHERE
                         MP.EZCANCELFLAG = '0'
                     GROUP BY
                         MP.GLBL_CMPY_CD
                        ,MP.SO_NUM
                        ,MP.SO_SLP_NUM
                     ) M
                WHERE
                    P.GLBL_CMPY_CD = M.GLBL_CMPY_CD
                AND P.SO_NUM       = M.SO_NUM
                AND P.SO_SLP_NUM   = M.SO_SLP_NUM
                AND P.PKT_SQ_NUM   = M.MAX_PKT_SQ_NUM
               ) PKT
        WHERE  ROH.GLBL_CMPY_CD      = #GLBL_CMPY_CD#
        AND    ROH.RMNF_INVTY_LOC_CD LIKE #INVTY_LOC_CD#
        AND    ROH.EZCANCELFLAG      = '0'
        AND    ROH.GLBL_CMPY_CD      = RPR.GLBL_CMPY_CD
        AND    ROH.RMNF_ORD_NUM      = RPR.RMNF_ORD_NUM
        AND    RPR.MDSE_CD IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND    RPR.EZCANCELFLAG      = '0'
        AND    ROH.GLBL_CMPY_CD      = ROT.GLBL_CMPY_CD
        AND    ROH.RMNF_ORD_TP_CD    = ROT.RMNF_ORD_TP_CD
        AND    ROT.EZCANCELFLAG      = '0'
        AND    RPR.GLBL_CMPY_CD      = SOD.GLBL_CMPY_CD(+)
        AND    RPR.RMNF_ORD_NUM      = SOD.TRX_HDR_NUM(+)
        AND    RPR.RMNF_PRT_REQ_LINE_NUM = SOD.TRX_LINE_NUM(+)
        AND    SOD.EZCANCELFLAG(+)   = '0'
        AND    ROH.GLBL_CMPY_CD      = ROS.GLBL_CMPY_CD
        AND    ROH.RMNF_ORD_STS_CD   = ROS.RMNF_ORD_STS_CD
        AND    ROS.OPEN_STS_FLG      = #FLG_ON_Y#
        AND    ROS.EZCANCELFLAG      = '0'
        AND    SOD.GLBL_CMPY_CD      = SS.GLBL_CMPY_CD(+)
        AND    SOD.SHPG_STS_CD       = SS.SHPG_STS_CD(+)
        AND    SS.EZCANCELFLAG(+)    = '0'
        AND    SOD.GLBL_CMPY_CD      = PKT.GLBL_CMPY_CD(+)
        AND    SOD.SO_NUM            = PKT.SO_NUM(+)
        AND    SOD.SO_SLP_NUM        = PKT.SO_SLP_NUM(+)
        )
       WHERE 1=1
       AND  NVL(SHPG_STS_CD , 0)  &lt; #SHIPPED#
    </statement>

    <!-- QC#18401-SOL#014 -->
    <statement id="getBeforeInsPrDatForTec" parameterClass="Map" resultClass="Map">
        SELECT
            PRDT.PRCH_REQ_BAL_QTY
           ,PRDT.MDSE_CD
           ,PRDT.DEST_INVTY_LOC_CD
           ,PRRQ.PRCH_REQ_CRAT_DT
           ,PRDT.PRCH_REQ_NUM
           ,PRDT.PRCH_REQ_LINE_NUM
           ,PRRT.PRCH_REQ_TP_DESC_TXT
           ,NULL AS RQST_RCV_DT
           ,PRDT.PRCH_REQ_LINE_STS_CD
           ,PRLS.PRCH_REQ_LINE_STS_NM
           ,PRRQ.PRCH_REQ_APVL_STS_CD
           ,PRAS.PRCH_REQ_APVL_STS_NM
           <!-- START 2023/04/21 G.Quan [QC#61206, ADD] -->
           ,PRDT.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,PRDT.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,PRDT.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,PRDT.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,PRDT.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/21 G.Quan [QC#61206, ADD] -->
        FROM
            PRCH_REQ           PRRQ
           ,PRCH_REQ_DTL       PRDT
           ,PRCH_REQ_LINE_STS  PRLS
           ,PRCH_REQ_TP        PRRT
           ,PRCH_REQ_APVL_STS  PRAS
        WHERE
            PRRQ.GLBL_CMPY_CD          = #GLBL_CMPY_CD#
        AND PRRQ.EZCANCELFLAG          = '0'
        AND PRRQ.PRCH_REQ_REC_TP_CD    = #PRCH_REQ_REC_TP_CD#
        AND PRRQ.PRCH_REQ_STS_CD       = #PRCH_REQ_STS_CD#
        <isNotNull property="batchMode">
        AND NOT (PRRQ.PRCH_REQ_APVL_STS_CD  = #PRCH_REQ_APVL_STS_CD#
            AND PRRQ.PRCH_REQ_SRC_TP_CD     = #PRCH_REQ_SRC_TP_CD#
            )
        </isNotNull>
        AND PRRQ.GLBL_CMPY_CD          = PRDT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
        AND PRDT.EZCANCELFLAG          = '0'
        AND PRDT.PRCH_REQ_LINE_SUB_NUM = 0
        AND PRDT.RQST_RCV_DT           &lt;= #THRU_DT#
        AND PRDT.MDSE_CD               IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND PRDT.DEST_INVTY_LOC_CD     LIKE #INVTY_LOC_CD#
        <!-- QC#27019 Update. Add NVL -->
        AND NVL(PRDT.TO_STK_STS_CD, #STK_STS_GOOD#) = #TO_STK_STS_CD#
        AND PRDT.PRCH_REQ_BAL_QTY      > 0
        AND PRDT.GLBL_CMPY_CD          = PRLS.GLBL_CMPY_CD
        AND PRDT.PRCH_REQ_LINE_STS_CD  = PRLS.PRCH_REQ_LINE_STS_CD
        AND PRLS.EZCANCELFLAG          = '0'
        AND PRLS.OPEN_STS_FLG          = #FLG_ON_Y#
        AND PRRQ.GLBL_CMPY_CD          = PRRT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_TP_CD        = PRRT.PRCH_REQ_TP_CD
        AND PRRT.EZCANCELFLAG          = '0'
        AND PRRQ.GLBL_CMPY_CD          = PRAS.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_APVL_STS_CD  = PRAS.PRCH_REQ_APVL_STS_CD
 <!--   AND PRAS.PRCH_REQ_APVL_FLG     = #FLG_ON_Y# -->
        AND PRAS.EZCANCELFLAG          = '0'
    </statement>

    <statement id="getAfterInsPrDatForTec" parameterClass="Map" resultClass="Map">
        SELECT
            SHOD.SHPG_QTY - SHOD.SHIP_QTY SCHD_QTY
           ,PRDT.MDSE_CD
           ,PRDT.DEST_INVTY_LOC_CD
           ,NVL(SHPO.PSD_DT, SHPO.RDD_DT) ETA_ETD_DT
           ,PRRQ.PRCH_REQ_CRAT_DT
           ,PRDT.PRCH_REQ_NUM
           ,PRDT.PRCH_REQ_LINE_NUM
           ,PRRT.PRCH_REQ_TP_DESC_TXT
           ,NULL AS RQST_RCV_DT
           ,PRDT.PRCH_REQ_LINE_STS_CD
           ,PRLS.PRCH_REQ_LINE_STS_NM
           ,SP.SHPG_STS_CD
           ,CASE
              WHEN SP.CR_HLD_QTY = 0 AND SP.CR_CHK_QTY &gt; 0 AND SP.SHPG_STS_CD = #VALIDATED# THEN 'B/O'
              ELSE SS.SHPG_STS_NM
            END SHPG_STS_NM
           ,PRRQ.PRCH_REQ_APVL_STS_CD
           ,PRAS.PRCH_REQ_APVL_STS_NM
           ,PKT.PKT_STS_TS
           <!-- START 2023/04/21 G.Quan [QC#61206, ADD] -->
           ,PRDT.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,PRDT.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,PRDT.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,PRDT.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,PRDT.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/21 G.Quan [QC#61206, ADD] -->
        FROM
            PRCH_REQ           PRRQ
           ,PRCH_REQ_DTL       PRDT
           ,SHPG_ORD_DTL       SHOD
           ,SHPG_ORD           SHPO
           ,PRCH_REQ_TP        PRRT
           ,PRCH_REQ_APVL_STS  PRAS
           ,PRCH_REQ_LINE_STS  PRLS
           ,SHPG_PLN           SP
           ,SHPG_STS           SS
           ,(SELECT
                P.GLBL_CMPY_CD
               ,P.SO_NUM
               ,P.SO_SLP_NUM
               ,P.PKT_STS_TS
             FROM
                PKT P
                ,(SELECT
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                     ,MAX(MP.PKT_SQ_NUM) MAX_PKT_SQ_NUM
                  FROM
                      PKT MP
                  WHERE
                      MP.EZCANCELFLAG = '0'
                  GROUP BY
                      MP.GLBL_CMPY_CD
                     ,MP.SO_NUM
                     ,MP.SO_SLP_NUM
                 ) M
             WHERE
                 P.GLBL_CMPY_CD = M.GLBL_CMPY_CD
             AND P.SO_NUM       = M.SO_NUM
             AND P.SO_SLP_NUM   = M.SO_SLP_NUM
             AND P.PKT_SQ_NUM   = M.MAX_PKT_SQ_NUM
            ) PKT
        WHERE
            PRRQ.GLBL_CMPY_CD                 = #GLBL_CMPY_CD#
        AND PRRQ.EZCANCELFLAG                 = '0'
        AND PRRQ.PRCH_REQ_REC_TP_CD           = #PRCH_REQ_REC_TP_CD#
        AND PRRQ.PRCH_REQ_STS_CD              = #PRCH_REQ_STS_CD#
        AND PRRQ.GLBL_CMPY_CD                 = PRDT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_NUM                 = PRDT.PRCH_REQ_NUM
        AND PRDT.EZCANCELFLAG                 = '0'
        AND PRDT.PRCH_REQ_LINE_SUB_NUM        != 0
        AND PRDT.MDSE_CD                      IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND PRDT.DEST_INVTY_LOC_CD            LIKE #INVTY_LOC_CD#
        AND PRDT.TO_STK_STS_CD                = #TO_STK_STS_CD#
        AND PRDT.PRCH_REQ_QTY - PRDT.SHIP_QTY &gt; 0
        AND PRDT.GLBL_CMPY_CD                 = SHOD.GLBL_CMPY_CD
        AND PRDT.PRCH_REQ_NUM                 = SHOD.PRCH_REQ_NUM
        AND PRDT.PRCH_REQ_LINE_NUM            = SHOD.PRCH_REQ_LINE_NUM
        AND PRDT.PRCH_REQ_LINE_SUB_NUM        = SHOD.PRCH_REQ_LINE_SUB_NUM
        AND SHOD.EZCANCELFLAG                 = '0'
        AND SHOD.GLBL_CMPY_CD                 = SHPO.GLBL_CMPY_CD
        AND SHOD.SO_NUM                       = SHPO.SO_NUM
        AND SHPO.EZCANCELFLAG                 = '0'
        AND NVL(SHPO.PSD_DT, SHPO.RDD_DT)     &lt;= #THRU_DT#
        AND PRRQ.GLBL_CMPY_CD                 = PRRT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_TP_CD               = PRRT.PRCH_REQ_TP_CD
        AND PRRT.EZCANCELFLAG                 = '0'
        AND PRDT.GLBL_CMPY_CD                 = PRLS.GLBL_CMPY_CD
        AND PRDT.PRCH_REQ_LINE_STS_CD         = PRLS.PRCH_REQ_LINE_STS_CD
        AND PRLS.OPEN_STS_FLG                 = #FLG_ON_Y#
        AND PRLS.EZCANCELFLAG                 = '0'
        AND PRRQ.GLBL_CMPY_CD                 = PRAS.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_APVL_STS_CD         = PRAS.PRCH_REQ_APVL_STS_CD
        AND PRAS.EZCANCELFLAG                 = '0'
        AND PRDT.GLBL_CMPY_CD                 = SP.GLBL_CMPY_CD(+)
        AND PRDT.PRCH_REQ_NUM                 = SP.TRX_HDR_NUM(+)
        AND PRDT.PRCH_REQ_LINE_NUM            = SP.TRX_LINE_NUM(+)
        AND SP.EZCANCELFLAG(+)                = '0'
        AND SP.GLBL_CMPY_CD                   = SS.GLBL_CMPY_CD(+)
        AND SP.SHPG_STS_CD                    = SS.SHPG_STS_CD(+)
        AND SS.EZCANCELFLAG(+)                = '0'
        AND SP.GLBL_CMPY_CD                   = PKT.GLBL_CMPY_CD(+)
        AND SP.SO_NUM                         = PKT.SO_NUM(+)
        AND SP.SO_SLP_NUM                     = PKT.SO_SLP_NUM(+)
    </statement>

    <statement id="getInvReqDatForTec" parameterClass="Map" resultClass="Map">
        SELECT
            INBD.VIS_QTY
           ,INBD.MDSE_CD
           ,INBD.VIS_LOC_CD
           ,INBD.ETA_ETD_DT
           ,PRRQ.PRCH_REQ_CRAT_DT
           ,PRDT.PRCH_REQ_NUM
           ,PRDT.PRCH_REQ_LINE_NUM
           ,PRRT.PRCH_REQ_TP_DESC_TXT
           ,NULL AS RQST_RCV_DT
           ,PRDT.PRCH_REQ_LINE_STS_CD
           ,PRLS.PRCH_REQ_LINE_STS_NM
           ,PRRQ.PRCH_REQ_APVL_STS_CD
           ,PRAS.PRCH_REQ_APVL_STS_NM
           ,PRRQ.PRCH_REQ_REC_TP_CD
           <!-- START 2023/04/21 G.Quan [QC#61206, ADD] -->
           ,PRDT.EZINTIME AS XX_REC_HIST_CRAT_TS
           ,PRDT.EZINUSERID AS XX_REC_HIST_CRAT_BY_NM
           ,PRDT.EZUPTIME AS XX_REC_HIST_UPD_TS
           ,PRDT.EZUPUSERID AS XX_REC_HIST_UPD_BY_NM
           ,PRDT.EZTABLEID AS XX_REC_HIST_TBL_NM
           <!-- END 2023/04/21 G.Quan [QC#61206, ADD] -->
        FROM
            PRCH_REQ           PRRQ
           ,PRCH_REQ_DTL       PRDT
           ,PRCH_REQ_LINE_STS  PRLS
           ,PO_RCV_DTL         PRD
           ,INBD_VIS           INBD
           ,PRCH_REQ_TP        PRRT
           ,PRCH_REQ_APVL_STS  PRAS
        WHERE
            PRRQ.GLBL_CMPY_CD          = #GLBL_CMPY_CD#
        AND PRRQ.EZCANCELFLAG          = '0'
        AND PRRQ.PRCH_REQ_REC_TP_CD    = #PRCH_REQ_REC_TP_CD#
        AND PRRQ.PRCH_REQ_STS_CD       = #PRCH_REQ_STS_CD#
        AND PRRQ.GLBL_CMPY_CD          = PRDT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_NUM          = PRDT.PRCH_REQ_NUM
        AND PRDT.EZCANCELFLAG          = '0'
        AND PRDT.MDSE_CD               IN
            <iterate property="MDSE_CD" var="MDSE_CD[]" open="(" close=")" conjunction=",">
                #MDSE_CD[]#
            </iterate>
        AND PRDT.DEST_INVTY_LOC_CD     LIKE #INVTY_LOC_CD#
        AND PRDT.TO_STK_STS_CD         = #TO_STK_STS_CD#
        AND PRDT.SO_NUM                IS NOT NULL
        AND PRDT.GLBL_CMPY_CD          = PRLS.GLBL_CMPY_CD
        AND PRDT.PRCH_REQ_LINE_STS_CD  = PRLS.PRCH_REQ_LINE_STS_CD
        AND PRLS.EZCANCELFLAG          = '0'
        AND PRLS.OPEN_STS_FLG          = #FLG_ON_Y#
        AND PRDT.GLBL_CMPY_CD          = PRD.GLBL_CMPY_CD
        AND PRDT.PRCH_REQ_NUM          = PRD.PRCH_REQ_NUM
        AND PRDT.PRCH_REQ_LINE_NUM     = PRD.PRCH_REQ_LINE_NUM
        AND PRDT.PRCH_REQ_LINE_SUB_NUM = PRD.PRCH_REQ_LINE_SUB_NUM
        AND PRD.EZCANCELFLAG           = '0'
        AND PRD.GLBL_CMPY_CD           = INBD.GLBL_CMPY_CD
        AND PRD.PO_RCV_NUM             = INBD.PO_RCV_NUM
        AND PRD.PO_RCV_LINE_NUM        = INBD.PO_RCV_LINE_NUM
        AND INBD.EZCANCELFLAG          = '0'
        AND INBD.INBD_LTST_REC_FLG     = #FLG_ON_Y#
        AND INBD.INBD_VIS_EVENT_CD     = #INBD_VIS_EVENT_CD#
        AND INBD.INBD_VIS_DATA_TP_CD   = #INBD_VIS_DATA_TP_CD#
        AND INBD.ETA_ETD_DT            &lt;= #THRU_DT#
        AND PRRQ.GLBL_CMPY_CD          = PRRT.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_TP_CD        = PRRT.PRCH_REQ_TP_CD
        AND PRRT.EZCANCELFLAG          = '0'
        AND PRRQ.GLBL_CMPY_CD          = PRAS.GLBL_CMPY_CD
        AND PRRQ.PRCH_REQ_APVL_STS_CD  = PRAS.PRCH_REQ_APVL_STS_CD
        AND PRAS.EZCANCELFLAG          = '0'
    </statement>

    <!-- QC#18401 Sol#014 Add SQL Start-->
    <statement id="getCalcOrdProcCd" parameterClass="Map" resultClass="String">
        SELECT
            MI.CALC_ORD_PROC_CD
        FROM
            MRP_INFO MI
        WHERE
            MI.GLBL_CMPY_CD = #GLBL_CMPY_CD#
        AND MI.INVTY_LOC_CD LIKE #INVTY_LOC_CD#
        AND MI.MDSE_CD      = #MDSE_CD#
        AND MI.EZCANCELFLAG = '0'
    </statement>
    <!-- QC#18401 Sol#014 Add SQL End-->

    <!-- QC#26534 Add SQL Start-->
    <statement id="getCompatibleItem" parameterClass="Map" resultClass="String">
        SELECT
            RELN_MDSE_CD
        FROM
            MDSE_ITEM_FLIP_SET
        WHERE
                GLBL_CMPY_CD = #GLBL_CMPY_CD#
            AND MDSE_CD = #MDSE_CD#
            AND MDSE_ITEM_RELN_TP_CD IN
            <isNotNull property="MDSE_ITEM_RELN_TP_CD">
                <iterate property="MDSE_ITEM_RELN_TP_CD" var="MDSE_ITEM_RELN_TP_CD[]" open="(" close=")" conjunction=",">
                    #MDSE_ITEM_RELN_TP_CD[]#
                </iterate>
            </isNotNull>
            AND EZCANCELFLAG = '0'
        ORDER BY
            RELN_MDSE_CD
    </statement>
</sqlMap>
