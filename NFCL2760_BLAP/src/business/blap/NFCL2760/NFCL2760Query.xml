<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NFCL2760Query">

    <!-- *********************************************************** -->
    <!-- ********** Bean Definition ******************************** -->
    <!-- *********************************************************** -->
    <typeAlias alias="NFCL2760CMsg"      type="business.blap.NFCL2760.NFCL2760CMsg"/>
    <typeAlias alias="NFCL2760_ASMsg"    type="business.blap.NFCL2760.NFCL2760_ASMsg"/>
    <typeAlias alias="NFCL2760_BSMsg"    type="business.blap.NFCL2760.NFCL2760_BSMsg"/>
    <typeAlias alias="NFCL2760_CSMsg"    type="business.blap.NFCL2760.NFCL2760_CSMsg"/>
    <typeAlias alias="NFCL2760_DSMsg"    type="business.blap.NFCL2760.NFCL2760_DSMsg"/>
    
    <statement id="findRcptData" parameterClass="Map" resultMap="result.findRcptData">
     SELECT
              <!-- QC#26750 Mod Start-->
             NVL(A.RCPT_CHK_DT, A.RCPT_DT)   RCPTDT
              <!-- QC#26750 Mod End-->
            ,A.GL_DT                    GLDT_H1
            ,A.GL_DT                    GL_DT_H2
            ,A.AR_RCPT_TRX_TP_CD        ARRCPTTRXTPCD
            ,A.AR_RCPT_TP_CD            ARRCPTTPCD
            ,A.RCPT_BAT_NUM             RCPTBATNUM
            ,A.PAYER_CUST_CD            PAYERCUSTCD
            ,A.DEAL_CCY_CD              CCYCD
            ,A.DEAL_RCPT_AMT            DEALRCPTAMT
            ,A.DEAL_APPLY_AMT           DEALAPPLYAMT_H1
            ,A.DEAL_APPLY_ADJ_AMT       DEALAPPLYADJAMT_H1
            ,A.DEAL_RF_AMT              DEALRFAMT
            ,A.DEAL_RCPT_RMNG_BAL_AMT   DEALRCPTRMNGBALAMT
            ,A.VOID_FLG                 VOIDFLG_H1
            ,A.EZUPTIME                 RCPTHDRLASTUPDTS_H1
            ,A.EZUPTIMEZONE             RCPT_HD_TM_ZN_H1
            ,B.AR_TRX_BAL_PK            RCPTTRXBALPK_H1
            ,B.EZUPTIME                 RCPTTRXBALLASTUPDTS_H1
            ,B.EZUPTIMEZONE             RCPT_TRX_BAL_TM_ZN_H1
            ,A.TOC_CD                   TOC_CD
            ,A.COA_PROD_CD              COA_PROD_CD
            ,A.RCPT_BAT_SQ_NUM          RCPT_BAT_SQ_NUM
            ,A.RCPT_CHK_NUM             RCPT_CHK_NUM
            ,A.AR_BANK_ACCT_CD          AR_BANK_ACCT_CD
            ,A.CASH_APP_DT              CASH_APP_DT
            ,B.EXPT_FLG                 EXPT_FLG
            ,A.AR_BAT_RCPT_NM           AR_BAT_RCPT_NM_H1
            ,A.AR_RCPT_STS_CD           AR_RCPT_STS_CD_H1
            ,C.AR_RCPT_STS_NM           AR_RCPT_STS_NM_H1
            ,A.AR_RCPT_SRC_CD           AR_RCPT_SRC_CD_H1
            ,D.AR_RCPT_SRC_NM           AR_RCPT_SRC_NM_H1
            ,A.DEAL_APPLY_AMT           XX_TOT_AMT_H0
            ,A.FUNC_RCPT_RMNG_BAL_AMT   XX_TOT_AMT_H1
            ,CASE WHEN A.AR_CASH_APPLY_STS_CD = 'I' THEN A.FUNC_NET_RCPT_AMT
                  ELSE 0
                  END                   XX_TOT_AMT_H2
            ,A.RCPT_CHK_NUM             RCPT_CHK_NUM
            ,(
              SELECT
                         NVL(SUM(ATB.DEAL_RMNG_BAL_GRS_AMT)*-1,0)
                FROM     AR_CASH_APP APP
                        ,AR_ADJ      ADJ
                        ,AR_TRX_BAL ATB
                WHERE    APP.EZCANCELFLAG      = '0'
                AND      APP.AR_APPLY_TP_CD    = #arApplyTp_Adjustment#
                AND      APP.AR_SCR_CANC_FLG   = 'N'
                AND      ADJ.GLBL_CMPY_CD      = APP.GLBL_CMPY_CD
                AND      ADJ.EZCANCELFLAG      = '0'
                AND      ADJ.AR_ADJ_NUM        = APP.AR_ADJ_NUM
                AND      ADJ.AR_ADJ_TRX_TP_CD  = #arAdjTrxTp_OnAccount#
                AND      ADJ.EZCANCELFLAG      = '0'
                AND      ADJ.GLBL_CMPY_CD      = ATB.GLBL_CMPY_CD
                AND      ADJ.AR_ADJ_NUM        = ATB.ATT_ADJ_NUM
                AND      ATB.AR_CASH_APPLY_STS_CD IN (#arCashApplyStsCd_U#,#arCashApplyStsCd_P#)
                AND      ATB.AR_TRX_TP_CD      = #arAdjTrxTp_OnAccount#
                AND      A.RCPT_NUM = APP.RCPT_NUM
                AND      A.GLBL_CMPY_CD        = APP.GLBL_CMPY_CD
             ) ACC_AMT
            ,(
              SELECT
                         (A.DEAL_APPLY_AMT + A.DEAL_APPLY_ADJ_AMT) - NVL(SUM(ATB.DEAL_RMNG_BAL_GRS_AMT)*-1,0)
                FROM     AR_CASH_APP APP
                        ,AR_ADJ      ADJ
                        ,AR_TRX_BAL  ATB
                WHERE    APP.EZCANCELFLAG      = '0'
                AND      APP.AR_APPLY_TP_CD    = #arApplyTp_Adjustment#
                AND      APP.AR_SCR_CANC_FLG   = 'N'
                AND      ADJ.GLBL_CMPY_CD      = APP.GLBL_CMPY_CD
                AND      ADJ.EZCANCELFLAG      = '0'
                AND      ADJ.AR_ADJ_NUM        = APP.AR_ADJ_NUM
                AND      ADJ.AR_ADJ_TRX_TP_CD  = #arAdjTrxTp_OnAccount#
                AND      ADJ.EZCANCELFLAG      = '0'
                AND      ADJ.GLBL_CMPY_CD      = ATB.GLBL_CMPY_CD
                AND      ADJ.AR_ADJ_NUM        = ATB.ATT_ADJ_NUM
                AND      ATB.AR_CASH_APPLY_STS_CD IN (#arCashApplyStsCd_U#,#arCashApplyStsCd_P#)
                AND      ATB.AR_TRX_TP_CD      = #arAdjTrxTp_OnAccount#
                AND      A.RCPT_NUM            = APP.RCPT_NUM
                AND      A.GLBL_CMPY_CD        = APP.GLBL_CMPY_CD

             ) APPLY_AMT
             <!-- 2017/11/16 QC#21402 add -->
             ,A.AR_CASH_APPLY_STS_CD         AR_CASH_APPLY_STS_CD_H1
     FROM
             AR_RCPT     A
            ,AR_TRX_BAL  B
            ,AR_RCPT_STS C
            ,AR_RCPT_SRC D
     WHERE
                  A.GLBL_CMPY_CD  =  #glblCmpyCd#
             AND  A.RCPT_NUM      =  #rcptNum#
             AND  A.GLBL_CMPY_CD  =  B.GLBL_CMPY_CD
             AND  A.RCPT_NUM      =  B.AR_TRX_NUM
             AND  A.EZCANCELFLAG  =  '0'
             AND  B.EZCANCELFLAG  =  '0'
             AND  A.GLBL_CMPY_CD     = C.GLBL_CMPY_CD (+)
             AND  A.AR_RCPT_STS_CD   = C.AR_RCPT_STS_CD (+)
             AND  C.EZCANCELFLAG (+) = '0'
             AND  A.GLBL_CMPY_CD     = D.GLBL_CMPY_CD (+)
             AND  A.AR_RCPT_SRC_CD   = D.AR_RCPT_SRC_CD (+)
             AND  D.EZCANCELFLAG (+) = '0'

    </statement>

    <resultMap id="result.findRcptData" class="NFCL2760CMsg">
        <result property="rcptDt"                       column="RCPTDT"                     javaType="EZDCDateItem"/>
        <result property="glDt_H1"                      column="GLDT_H1"                    javaType="EZDCDateItem"/>
        <result property="arRcptTrxTpCd"                column="ARRCPTTRXTPCD"              javaType="EZDCStringItem"/>
        <result property="arRcptTpCd"                   column="ARRCPTTPCD"                 javaType="EZDCStringItem"/>
        <result property="rcptBatNum"                   column="RCPTBATNUM"                 javaType="EZDCStringItem"/>
        <result property="payerCustCd"                  column="PAYERCUSTCD"                javaType="EZDCStringItem"/>
        <result property="ccyCd"                        column="CCYCD"                      javaType="EZDCStringItem"/>
        <result property="dealRcptAmt"                  column="DEALRCPTAMT"                javaType="EZDCBigDecimalItem"/>
        <!--<result property="dealApplyAmt_H1"              column="DEALAPPLYAMT_H1"            javaType="EZDCBigDecimalItem"/>-->
        <result property="dealApplyAdjAmt_H1"           column="DEALAPPLYADJAMT_H1"         javaType="EZDCBigDecimalItem"/>
        <result property="dealRfAmt"                    column="DEALRFAMT"                  javaType="EZDCBigDecimalItem"/>
        <result property="dealRcptRmngBalAmt"           column="DEALRCPTRMNGBALAMT"         javaType="EZDCBigDecimalItem"/>
        <result property="voidFlg_H1"                   column="VOIDFLG_H1"                 javaType="EZDCStringItem"/>
        <result property="rcptHdrLastUpdTs_H1"          column="RCPTHDRLASTUPDTS_H1"        javaType="EZDCStringItem"/>
        <result property="rcptHdrTz_H1"                 column="RCPT_HD_TM_ZN_H1"           javaType="EZDCStringItem"/>
        <result property="rcptTrxBalPk_H1"              column="RCPTTRXBALPK_H1"            javaType="EZDCStringItem"/>
        <result property="rcptTrxBalLastUpdTs_H1"       column="RCPTTRXBALLASTUPDTS_H1"     javaType="EZDCStringItem"/>
        <result property="rcptTrxBalTz_H1"              column="RCPT_TRX_BAL_TM_ZN_H1"      javaType="EZDCStringItem"/>
        <result property="rcptBatSqNum"                 column="RCPT_BAT_SQ_NUM"            javaType="EZDCStringItem"/>
        <result property="rcptChkNum_H1"                column="RCPT_CHK_NUM"               javaType="EZDCStringItem"/>
        <result property="arBankAcctCd_H1"              column="AR_BANK_ACCT_CD"            javaType="EZDCStringItem"/>
        <result property="tocCd_H1"                     column="TOC_CD"                     javaType="EZDCStringItem"/>
        <result property="coaProdCd_H1"                 column="COA_PROD_CD"                javaType="EZDCStringItem"/>
        <result property="cashAppDt_BK"                 column="CASH_APP_DT"                javaType="EZDCDateItem"/>
        <result property="exptFlg_H1"                   column="EXPT_FLG"                   javaType="EZDCStringItem"/>
        <result property="glDt_H2"                      column="GL_DT_H2"                   javaType="EZDCDateItem"/>
        <result property="arBatRcptNm_H1"               column="AR_BAT_RCPT_NM_H1"          javaType="EZDCStringItem"/>
        <result property="arRcptStsCd_H1"               column="AR_RCPT_STS_CD_H1"          javaType="EZDCStringItem"/>
        <result property="arRcptStsNm_H1"               column="AR_RCPT_STS_NM_H1"          javaType="EZDCStringItem"/>
        <result property="arRcptSrcCd_H1"               column="AR_RCPT_SRC_CD_H1"          javaType="EZDCStringItem"/>
        <result property="arRcptSrcNm_H1"               column="AR_RCPT_SRC_NM_H1"          javaType="EZDCStringItem"/>
        <result property="xxTotAmt_H0"                  column="XX_TOT_AMT_H0"              javaType="EZDCBigDecimalItem"/>
        <result property="xxTotAmt_H1"                  column="XX_TOT_AMT_H1"              javaType="EZDCBigDecimalItem"/>
        <result property="xxTotAmt_H2"                  column="XX_TOT_AMT_H2"              javaType="EZDCBigDecimalItem"/>
        <result property="rcptChkNum"                   column="RCPT_CHK_NUM"               javaType="EZDCStringItem"/>
        <result property="xxDedctAmt_S1"                column="ACC_AMT"                    javaType="EZDCStringItem"/>
        <result property="dealApplyAmt_H1"              column="APPLY_AMT"                  javaType="EZDCStringItem"/>
        <result property="arCashApplyStsCd_H1"          column="AR_CASH_APPLY_STS_CD_H1"    javaType="EZDCStringItem"/> <!-- 2017/11/16 QC#21402 add -->
    </resultMap>

    <statement id="findInvData" parameterClass="Map" resultMap="result.findInvData">
     SELECT
             <!-- START 2022/01/06 G.Delgado [QC#59329, MOD] -->
             <!-- 'Applied'                    XX_AR_CASH_APPLY_STS_TXT -->
             CASE
                WHEN A.AR_SCR_CANC_FLG = 'N' THEN 'Applied'
                ELSE 'New'
             END                          XX_AR_CASH_APPLY_STS_TXT
             <!-- END 2022/01/06 G.Delgado [QC#59329, MOD] -->
            ,B.AR_TRX_NUM                 ARTRXNUM
            ,B.GRP_INV_NUM                GRPINVNUM
            ,B.AR_TRX_TP_CD               ARTRXTPCD
            ,B.CPO_ORD_NUM                CPOORDNUM
            ,B.INV_DUE_DT                 INVDUEDT
            ,B.GL_DT                      GLDT_A1
            ,B.CUST_ISS_PO_NUM            CUSTISSPONUM
       <!-- START 2018/07/19 Y.Matsui [QC#26871,MOD] -->
       <!-- START 2018/06/06 Y.Matsui [QC#25956,MOD] -->
       <!-- ,B.AR_CUST_REF_NUM            ARCUSTREFNUM -->
            ,CASE
                 WHEN B.AR_CUST_REF_NUM IS NULL AND B.AR_TRX_TP_CD = #arTrxTpCdAcc# THEN (
                     SELECT
                         ATT.AR_TRX_TP_NM
                     FROM
                         AR_TRX_TP ATT
                     WHERE
                         ATT.GLBL_CMPY_CD = B.GLBL_CMPY_CD
                     AND ATT.AR_TRX_TP_CD = B.AR_TRX_TP_CD
                     AND ATT.EZCANCELFLAG = '0'
                 )
                 ELSE B.AR_CUST_REF_NUM
             END                          ARCUSTREFNUM
       <!-- END   2018/06/06 Y.Matsui [QC#25956,MOD] -->
       <!-- END   2018/07/19 Y.Matsui [QC#26871,MOD] -->
            ,B.SELL_TO_CUST_CD            SELLTOCUSTCD
            ,B.BILL_TO_CUST_CD            BILLTOCUSTCD
            ,B.DEAL_ORIG_GRS_AMT          DEALORIGGRSAMT
            ,B.DEAL_APPLY_GRS_AMT         DEALAPPLYGRSAMT
            ,B.DEAL_APPLY_CR_AMT          DEALAPPLYCRAMT
            ,B.DEAL_NET_SLS_AMT           DEALNETSLSAMT
            ,B.DEAL_FRT_AMT               DEALFRTAMT
            ,B.DEAL_TAX_AMT               DEALTAXAMT
            ,B.DEAL_RMNG_BAL_GRS_AMT      DEALRMNGBALGRSAMT
            ,A.CASH_APP_DT                CASH_APP_DT_A1
            ,A.GL_DT                      CASHAPPGLDT_A1
            ,A.DEAL_APPLY_CASH_DISC_AMT   DEALCASHDISCAMT_A1
            ,B.CASH_DISC_PCT              CASHDISCPCT_A1
            ,B.AR_TRX_BAL_PK              ARTRXBALPK_BK
            ,B.AR_TRX_BAL_PK              INVTRXBALPK_BK
            ,B.EZUPTIME                   INVTRXBALLASTUPDTS_BK
            ,B.EZUPTIMEZONE               INV_TRX_BAL_TZ_BK
            ,B.AR_TRX_NUM                 CRNUM_BK
            ,B.AR_TRX_BAL_PK              CRTRXBALPK_BK
            ,B.EZUPTIME                   CRTRXBALLASTUPDTS_BK
            ,B.EZUPTIMEZONE               CR_TRX_BAL_TZ_BK
            ,B.DEAL_APPLY_ADJ_AMT         DEALAPPLYADJAMT_B3
            ,B.DEAL_APPLY_ADJ_RSVD_AMT    DEALAPPLYADJRSVDAMT_B3
            ,A.DEAL_APPLY_AMT             DEALAPPLYAMT_BK
            ,A.AR_CASH_APP_PK             ARCASHAPPPK_BK
            ,A.AR_CASH_APP_SQ_NUM         ARCASHAPPSQNUM_UP
            ,A.EZUPTIME                   EZUPTIME_UP
            ,A.EZUPTIMEZONE               EZUPTIMEZONE_UP
            <!-- START 2024/02/20 TZ.Win [QC#63450, ADD] -->
            ,A.AR_CASH_APP_SORT_NUM       ARCASHAPPSORTNUM_UP
            <!-- END 2024/02/20 TZ.Win [QC#63450, ADD] -->
            ,B.AR_TRX_DT                  ARTRXDT
            ,B.CASH_DISC_TERM_CD          CASHDISCTERMCD
            ,B.TOC_CD                     TOCCD
            ,B.COA_PROD_CD                COAPRODCD
            ,B.PMT_TERM_CD                PMTTERMCD
            ,B.PMT_TERM_CASH_DISC_CD      PMTTERMCASHDISCCD
            ,B.INV_PMT_METH_CD			  INV_PMT_METH_CD
            ,B.INV_PMT_COND_CD			  INV_PMT_COND_CD
            ,C.AR_EXP_PMT_METH_NM         AR_EXP_PMT_METH_NM
            ,D.AR_EXP_PMT_COND_NM         AR_EXP_PMT_COND_NM
            ,B.DEAL_CCY_CD				  DEAL_CCY_CD
            ,B.BILL_TO_CUST_ACCT_CD       BILL_TO_CUST_ACCT_CD
            ,(
               SELECT
                      INLINE1.DS_ACCT_NM
                 FROM
                      SELL_TO_CUST INLINE1
                WHERE
                      INLINE1.SELL_TO_CUST_CD = B.BILL_TO_CUST_ACCT_CD
                  AND INLINE1.EZCANCELFLAG    = '0'
                  AND INLINE1.GLBL_CMPY_CD    = B.GLBL_CMPY_CD
             ) DS_ACCT_NM
             <!-- START 2024/02/20 TZ.Win [QC#63450, ADD] -->
            ,(CASE 
                   WHEN B.AR_TRX_TP_CD  = #arTrxTpCdAcc# THEN '1'
                   WHEN B.AR_TRX_TP_CD  = #arTrxTpCdAdj# THEN '2'
                   WHEN B.AR_TRX_TP_CD  = #arTrxTpCdDed# THEN '99'
                   WHEN B.AR_TRX_TP_CD  = #arTrxTpCdCrm# THEN '99'
                   WHEN B.AR_TRX_TP_CD  = #arTrxTpCdDem# THEN '99'
                   WHEN B.AR_TRX_TP_CD  = #arTrxTpCdInv# THEN '99'
                   ELSE '99' END)          SORTKEY1
             <!-- END 2024/02/20 TZ.Win [QC#63450, ADD] -->
             ,(CASE 
                   WHEN B.AR_TRX_TP_CD  = #arTrxTpCdAcc# THEN '1'
                   WHEN B.AR_TRX_TP_CD  = #arTrxTpCdAdj# THEN '2'
                   WHEN B.AR_TRX_TP_CD  = #arTrxTpCdDed# THEN '3'
                   WHEN B.AR_TRX_TP_CD  = #arTrxTpCdCrm# THEN '4'
                   WHEN B.AR_TRX_TP_CD  = #arTrxTpCdDem# THEN '5'
                   WHEN B.AR_TRX_TP_CD  = #arTrxTpCdInv# THEN '6'
                    <!-- START 2024/02/20 TZ.Win [QC#63450, MOD] -->
                   ELSE '7' END)          SORTKEY2
                    <!-- END 2024/02/20 TZ.Win [QC#63450, MOD] -->
     FROM
             AR_CASH_APP           A
            ,AR_TRX_BAL            B
            ,AR_EXP_PMT_METH       C
            ,AR_EXP_PMT_COND       D
            <!-- START 2022/01/06 G.Delgado [QC#59329, ADD] -->
            ,(
                SELECT
                     APP.AR_CASH_APP_PK
                    ,APP.AR_CASH_APP_SQ_NUM
                    ,APP.RCPT_NUM
                FROM 
                    (
                        SELECT
                             APP1.AR_CASH_APP_PK
                            ,APP1.AR_CASH_APP_SQ_NUM
                            ,APP1.RCPT_NUM
                            ,1  AS RANK_APP
                        FROM
                            AR_CASH_APP APP1
                        WHERE
                                APP1.GLBL_CMPY_CD     = #glblCmpyCd#
                            AND APP1.RCPT_NUM         = #rcptNum#
                            AND APP1.AR_TRX_NUM       IS NOT NULL
                            AND APP1.AR_SCR_CANC_FLG  = #arScrCancFlgN#
                            AND APP1.EZCANCELFLAG     = '0'
                        <!-- START 2022/02/22 D.Mamaril [QC#59733, ADD] -->
                        <isNotNull property="fromSubmit">
                        <!-- END 2022/02/22 D.Mamaril [QC#59733, ADD] -->
                        UNION ALL
                        SELECT
                             APP2.AR_CASH_APP_PK
                            ,APP2.AR_CASH_APP_SQ_NUM
                            ,APP2.RCPT_NUM
                            ,RANK() OVER(PARTITION BY APP2.AR_TRX_NUM ORDER BY APP2.EZINTIME DESC)  AS RANK_APP
                        FROM
                             AR_CASH_APP APP2
                            ,AR_CASH_APP APP3
                        WHERE
                                APP2.GLBL_CMPY_CD     = #glblCmpyCd#
                            AND APP2.RCPT_NUM         = #rcptNum#
                            AND APP2.AR_TRX_NUM       IS NOT NULL
                            AND APP2.AR_SCR_CANC_FLG  = #arScrCancFlgY#
                            AND APP3.GLBL_CMPY_CD     = APP2.GLBL_CMPY_CD
                            AND APP3.RCPT_NUM         = APP2.RCPT_NUM
                            AND APP3.AR_TRX_NUM       = APP2.AR_TRX_NUM
                            AND APP3.CASH_APP_DT      = #slsdt#
                            AND APP3.AR_SCR_CANC_FLG  = #arScrCancFlgY#
                            AND APP2.DEAL_APPLY_AMT   = APP3.DEAL_APPLY_AMT * -1
                            AND APP2.EZINTIME         &lt; APP3.EZINTIME
                            <!-- START 2022/02/22 D.Mamaril [QC#59733, ADD] -->
                            AND APP2.EZUPTIME         = #rcptLstUpdDt#
                            <!-- END 2022/02/22 D.Mamaril [QC#59733, ADD] -->
                            AND NOT EXISTS (
                                SELECT
                                    1
                                FROM
                                    AR_CASH_APP APP
                                WHERE
                                        APP.GLBL_CMPY_CD      = APP2.GLBL_CMPY_CD
                                    AND APP.RCPT_NUM          = APP2.RCPT_NUM
                                    AND APP.AR_TRX_NUM        = APP2.AR_TRX_NUM
                                    AND APP.AR_SCR_CANC_FLG   = #arScrCancFlgN#
                                    AND APP.EZCANCELFLAG      = '0'
                            )
                            AND APP2.EZCANCELFLAG     = '0'
                            AND APP3.EZCANCELFLAG     = '0'
                        <!-- START 2022/02/22 D.Mamaril [QC#59733, ADD] -->
                        </isNotNull>
                        <!-- END 2022/02/22 D.Mamaril [QC#59733, MOD] -->
                    ) APP
                WHERE APP.RANK_APP = 1
            ) E
            <!-- END 2022/01/06 G.Delgado [QC#59329, ADD] -->
     WHERE
                  A.GLBL_CMPY_CD     =  #glblCmpyCd#
             <!-- START 2022/01/06 G.Delgado [QC#59329, MOD] -->
<!--             AND  A.RCPT_NUM         =  #rcptNum#-->
<!--             AND  A.AR_TRX_NUM      IS  NOT NULL-->
<!--             AND  A.AR_SCR_CANC_FLG  =  #arScrCancFlg#-->
             AND  A.AR_CASH_APP_PK     = E.AR_CASH_APP_PK
             AND  A.AR_CASH_APP_SQ_NUM = E.AR_CASH_APP_SQ_NUM
             AND  A.RCPT_NUM           = E.RCPT_NUM
             AND  (
                   A.AR_SCR_CANC_FLG = #arScrCancFlgN#
                OR B.AR_CASH_APPLY_STS_CD IN (#arCashApplyStsCd_U#,#arCashApplyStsCd_P#)
             )
             <!-- END 2022/01/06 G.Delgado [QC#59329, MOD] -->
             AND  A.GLBL_CMPY_CD     =  B.GLBL_CMPY_CD
             AND  A.AR_TRX_BAL_PK    =  B.AR_TRX_BAL_PK

             AND  B.GLBL_CMPY_CD     =  C.GLBL_CMPY_CD(+)
             AND  B.INV_PMT_METH_CD  =  C.AR_EXP_PMT_METH_CD(+)
             AND  B.GLBL_CMPY_CD     =  D.GLBL_CMPY_CD(+)
             AND  B.INV_PMT_COND_CD  =  D.AR_EXP_PMT_COND_CD(+)

             AND  A.EZCANCELFLAG     =  '0'
             AND  B.EZCANCELFLAG     =  '0'
             AND  C.EZCANCELFLAG(+)  =  '0'
             AND  D.EZCANCELFLAG(+)  =  '0'

     ORDER BY
                 <!-- START 2024/02/20 TZ.Win [QC#63450, ADD] -->
                  SORTKEY1       ASC
                 ,A.AR_CASH_APP_SORT_NUM  ASC NULLS FIRST
                 <!-- END 2024/02/20 TZ.Win [QC#63450, ADD] -->
                 <!-- START 2024/02/20 TZ.Win [QC#63450, MOD] -->
                 ,SORTKEY2       ASC
                 <!-- END 2024/02/20 TZ.Win [QC#63450, MOD] -->
                 ,B.AR_TRX_NUM  DESC
    </statement>

    <resultMap id="result.findInvData" class="NFCL2760_ASMsg">
        <result property="xxArCashApplyStsTxt"              column="XX_AR_CASH_APPLY_STS_TXT"       javaType="EZDCStringItem"/>
        <result property="arTrxNum"                         column="ARTRXNUM"                       javaType="EZDCStringItem"/>
        <result property="grpInvNum"                        column="GRPINVNUM"                      javaType="EZDCStringItem"/>
        <result property="arTrxTpCd"                        column="ARTRXTPCD"                      javaType="EZDCStringItem"/>
        <result property="cpoOrdNum"                        column="CPOORDNUM"                      javaType="EZDCStringItem"/>
        <result property="invDueDt"                         column="INVDUEDT"                       javaType="EZDCDateItem"/>
        <result property="glDt_A1"                          column="GLDT_A1"                        javaType="EZDCDateItem"/>
        <result property="custIssPoNum"                     column="CUSTISSPONUM"                   javaType="EZDCStringItem"/>
        <result property="arCustRefNum"                     column="ARCUSTREFNUM"                   javaType="EZDCStringItem"/>
        <result property="billToCustCd"                     column="BILLTOCUSTCD"                   javaType="EZDCStringItem"/>
        <result property="sellToCustCd"                     column="SELLTOCUSTCD"                   javaType="EZDCStringItem"/>
        <result property="dealOrigGrsAmt"                   column="DEALORIGGRSAMT"                 javaType="EZDCBigDecimalItem"/>
        <result property="dealApplyGrsAmt"                  column="DEALAPPLYGRSAMT"                javaType="EZDCBigDecimalItem"/>
        <result property="dealApplyCrAmt"                   column="DEALAPPLYCRAMT"                 javaType="EZDCBigDecimalItem"/>
        <result property="dealNetSlsAmt"                    column="DEALNETSLSAMT"                  javaType="EZDCBigDecimalItem"/>
        <result property="dealFrtAmt"                       column="DEALFRTAMT"                     javaType="EZDCBigDecimalItem"/>
        <result property="dealTaxAmt"                       column="DEALTAXAMT"                     javaType="EZDCBigDecimalItem"/>
        <result property="dealRmngBalGrsAmt"                column="DEALRMNGBALGRSAMT"              javaType="EZDCBigDecimalItem"/>
        <result property="cashAppDt_A1"                     column="CASH_APP_DT_A1"                 javaType="EZDCDateItem"/>
        <result property="cashAppGlDt_A1"                   column="CASHAPPGLDT_A1"                 javaType="EZDCDateItem"/>
        <result property="dealCashDiscAmt_A1"               column="DEALCASHDISCAMT_A1"             javaType="EZDCStringItem"/>
        <result property="cashDiscPct_A1"                   column="CASHDISCPCT_A1"                 javaType="EZDCBigDecimalItem"/>
        <result property="arTrxBalPk_BK"                    column="ARTRXBALPK_BK"                  javaType="EZDCBigDecimalItem"/>
        <result property="invTrxBalPk_BK"                   column="INVTRXBALPK_BK"                 javaType="EZDCStringItem"/>
        <result property="invTrxBalLastUpdTs_BK"            column="INVTRXBALLASTUPDTS_BK"          javaType="EZDCStringItem"/>
        <result property="invTrxBalTz_BK"                   column="INV_TRX_BAL_TZ_BK"              javaType="EZDCStringItem"/>
        <result property="crNum_BK"                         column="CRNUM_BK"                       javaType="EZDCStringItem"/>
        <result property="crTrxBalPk_BK"                    column="CRTRXBALPK_BK"                  javaType="EZDCStringItem"/>
        <result property="crTrxBalLastUpdTs_BK"             column="CRTRXBALLASTUPDTS_BK"           javaType="EZDCStringItem"/>
        <result property="crTrxBalTz_BK"                    column="CR_TRX_BAL_TZ_BK"               javaType="EZDCStringItem"/>
        <result property="dealApplyAdjAmt_B3"               column="DEALAPPLYADJAMT_B3"             javaType="EZDCBigDecimalItem"/>
        <result property="dealApplyAdjRsvdAmt_B3"           column="DEALAPPLYADJRSVDAMT_B3"         javaType="EZDCBigDecimalItem"/>
        <result property="dealApplyAmt_BK"                  column="DEALAPPLYAMT_BK"                javaType="EZDCBigDecimalItem"/>
        <result property="arCashAppPk_BK"                   column="ARCASHAPPPK_BK"                 javaType="EZDCBigDecimalItem"/>
        <result property="arCashAppSqNum_UP"                column="ARCASHAPPSQNUM_UP"              javaType="EZDCStringItem"/>
        <result property="ezUpTime_UP"                      column="EZUPTIME_UP"                    javaType="EZDCStringItem"/>
        <result property="ezUpTimeZone_UP"                  column="EZUPTIMEZONE_UP"                javaType="EZDCStringItem"/>
        <!-- START 2024/02/20 TZ.Win [QC#63450, ADD] -->
        <result property="arCashAppSortNum_UP"              column="ARCASHAPPSORTNUM_UP"            javaType="EZDCBigDecimalItem"/>
        <!-- END 2024/02/20 TZ.Win [QC#63450, ADD] -->
        <result property="arTrxDt"                          column="ARTRXDT"                        javaType="EZDCDateItem"/>
        <result property="cashDiscTermCd_A1"                column="CASHDISCTERMCD"                 javaType="EZDSStringItem"/>
        <result property="tocCd_A1"                         column="TOCCD"                          javaType="EZDSStringItem"/>
        <result property="coaProdCd_BK"                     column="COAPRODCD"                      javaType="EZDSStringItem"/>
        <result property="pmtTermCd_A1"                     column="PMTTERMCD"                      javaType="EZDSStringItem"/>
        <result property="pmtTermCashDiscCd_A1"             column="PMTTERMCASHDISCCD"              javaType="EZDSStringItem"/>
        <result property="invPmtMethCd_A1"                  column="INV_PMT_METH_CD"                javaType="EZDSStringItem"/>
        <result property="invPmtCondCd_A1"                  column="INV_PMT_COND_CD"                javaType="EZDSStringItem"/>
        <result property="arExpPmtMethNm_A1"                column="AR_EXP_PMT_METH_NM"             javaType="EZDSStringItem"/>
        <result property="arExpPmtCondNm_A1"                column="AR_EXP_PMT_COND_NM"             javaType="EZDSStringItem"/>
        <result property="dealCcyCd_A1"                     column="DEAL_CCY_CD"                    javaType="EZDSStringItem"/>
        <result property="billToCustAcctCd_A1"              column="BILL_TO_CUST_ACCT_CD"           javaType="EZDSStringItem"/>
        <result property="dsAcctNm_A1"                      column="DS_ACCT_NM"                     javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="findInvDataByAdj" parameterClass="Map" resultMap="result.findInvDataByAdj">
     SELECT
             A.CASH_APP_DT        CASH_APP_DT_A1
            ,B.AR_ADJ_TP_CD       ARADJTPCD_A1
            ,ADT.AR_ADJ_TP_NM     ARADJTPNM_A1
            ,B.AR_ADJ_NUM         ARADJNUM_BK
            ,B.AR_ADJ_TRX_TP_CD   ARADJTRXTPCD_BK
            ,B.AR_ADJ_TP_CD       ARADJTPCD_BK
            ,ADT.AR_ADJ_TP_NM     ARADJTPNM_BK
            ,B.DEAL_AR_ADJ_AMT    DEALAPPLYADJAMT_BK
     FROM
             AR_CASH_APP  A
            ,AR_ADJ       B
            ,AR_ADJ_TP    ADT
            
     WHERE
                  A.GLBL_CMPY_CD     =  #glblCmpyCd#
             AND  A.AR_CASH_APP_PK   =  #arCashAppPk#
             AND  A.RCPT_NUM        IS  NULL
             AND  A.AR_TRX_NUM       =  #arTrxNum#
             AND  A.AR_TRX_BAL_PK    =  #arTrxBalPk#
             AND  A.AR_SCR_CANC_FLG  =  #arScrCancFlg#
             AND  A.GLBL_CMPY_CD     =  B.GLBL_CMPY_CD
             AND  A.AR_ADJ_NUM       =  B.AR_ADJ_NUM
             AND  A.AR_TRX_BAL_PK    =  B.ORIG_AR_TRX_BAL_PK
             AND  A.EZCANCELFLAG     =  '0'
             AND  B.EZCANCELFLAG     =  '0'
             
             AND  B.GLBL_CMPY_CD     =  ADT.GLBL_CMPY_CD(+)
             AND  B.AR_ADJ_TP_CD     =  ADT.AR_ADJ_TP_CD(+)
             AND ADT.EZCANCELFLAG(+) =  '0'

    </statement>
    
    <resultMap id="result.findInvDataByAdj" class="NFCL2760_ASMsg">
        <result property="cashAppDt_A1"              column="CASH_APP_DT_A1"             javaType="EZDCDateItem"/>
        <result property="arAdjTpCd_A1"              column="ARADJTPCD_A1"               javaType="EZDCStringItem"/>
        <result property="arAdjTpNm_A1"              column="ARADJTPNM_A1"               javaType="EZDCStringItem"/>
        <result property="arAdjNum_BK"               column="ARADJNUM_BK"                javaType="EZDCStringItem"/>
        <result property="arAdjTrxTpCd_BK"           column="ARADJTRXTPCD_BK"            javaType="EZDCStringItem"/>
        <result property="arAdjTpCd_BK"              column="ARADJTPCD_BK"               javaType="EZDCStringItem"/>
        <result property="arAdjTpNm_BK"              column="ARADJTPNM_BK"               javaType="EZDCStringItem"/>
        <result property="dealApplyAdjAmt_BK"        column="DEALAPPLYADJAMT_BK"         javaType="EZDCBigDecimalItem"/>
    </resultMap>

    <statement id="findAdjAndDeduction" parameterClass="Map" resultMap="result.findAdjAndDeduction">
     SELECT
             B.AR_ADJ_TRX_TP_CD           ARTRXTPCD
            ,A.CASH_APP_DT                CASH_APP_DT_A1
            ,A.GL_DT                      CASHAPPGLDT_A1
            ,A.DEAL_APPLY_CASH_DISC_AMT   DEALCASHDISCAMT_A1
            ,B.AR_ADJ_TP_CD               ARADJTPCD_A3
            ,ADT.AR_ADJ_TP_NM             ARADJTPNM_A3
            ,B.DEAL_AR_ADJ_AMT            DEALAPPLYADJAMT_A3
            ,B.AR_ADJ_NUM                 ARADJNUM_BK
            ,B.AR_ADJ_TRX_TP_CD           ARADJTRXTPCD_BK
            ,B.AR_ADJ_TP_CD               ARADJTPCD_BK
            ,ADT.AR_ADJ_TP_NM             ARADJTPNM_BK
            ,A.DEAL_APPLY_AMT             DEALAPPLYAMT_BK
            ,A.AR_CASH_APP_PK             ARCASHAPPPK_BK
            ,A.AR_CASH_APP_SQ_NUM         ARCASHAPPSQNUM_UP
            ,A.EZUPTIME                   EZUPTIME_UP
            ,A.EZUPTIMEZONE               EZUPTIMEZONE_UP
            <!-- START 2024/02/20 TZ.Win [QC#63450, ADD] -->
            ,A.AR_CASH_APP_SORT_NUM       ARCASHAPPSORTNUM_UP
            <!-- END 2024/02/20 TZ.Win [QC#63450, ADD] -->
            ,B.TOC_CD                     TOCCD
            ,B.COA_PROD_CD                COAPRODCD
            <!-- START 2016/11/07 S.Fujita [QC#13580,ADD] -->
            ,A.GL_DT                      GLDT_A1
            <!-- END   2016/11/07 S.Fujita [QC#13580,ADD] -->
            <!-- START 2022/12/01 R.Takau [QC#57252,ADD] -->
            ,CASE WHEN C.AR_ADJ_NUM IS NOT NULL THEN
                (CONCAT(C.ADJ_COA_CMPY_CD,  '.') ||
                 CONCAT(C.ADJ_COA_BR_CD,    '.') ||
                 CONCAT(C.ADJ_COA_CC_CD,    '.') ||
                 CONCAT(C.ADJ_COA_ACCT_CD,  '.') ||
                 CONCAT(C.ADJ_COA_PROD_CD,  '.') ||
                 CONCAT(C.ADJ_COA_CH_CD,    '.') ||
                 CONCAT(C.ADJ_COA_AFFL_CD,  '.') ||
                 CONCAT(C.ADJ_COA_PROJ_CD,  '.') ||
                 C.ADJ_COA_EXTN_CD)
             ELSE NULL END AS XX_CMNT_TXT
           <!-- END   2022/12/01 R.Takau [QC#57252,ADD] -->
           <!-- START 2024/02/20 TZ.Win [QC#63450, ADD] -->
           ,(CASE 
                   WHEN B.AR_ADJ_TRX_TP_CD  = #arAdjTrxTpCdAcc# THEN '1'
                   WHEN B.AR_ADJ_TRX_TP_CD  = #arAdjTrxTpCdAdj# THEN '2'
                   ELSE '99' END)          SORTKEY
           <!-- END 2024/02/20 TZ.Win [QC#63450, ADD] -->
     FROM
             AR_CASH_APP  A
            ,AR_ADJ       B
            ,AR_ADJ_TP    ADT
            <!-- START 2022/12/01 R.Takau [QC#57252,ADD] -->
            ,AR_ADJ_COA_INFO    C
            <!-- END   2022/12/02 R.Takau [QC#57252,ADD] -->
     WHERE
                  A.GLBL_CMPY_CD     =  #glblCmpyCd#
             AND  A.RCPT_NUM         =  #rcptNum#
             AND  A.AR_TRX_NUM      IS  NULL
             AND  A.AR_SCR_CANC_FLG  =  #arScrCancFlg#
             AND  A.GLBL_CMPY_CD     =  B.GLBL_CMPY_CD
             AND  A.AR_ADJ_NUM       =  B.AR_ADJ_NUM
             AND  A.EZCANCELFLAG     =  '0'
             AND  B.EZCANCELFLAG     =  '0'         
             AND  B.GLBL_CMPY_CD     =  ADT.GLBL_CMPY_CD(+)
             AND  B.AR_ADJ_TP_CD     =  ADT.AR_ADJ_TP_CD(+)
             AND ADT.EZCANCELFLAG(+) =  '0'
             <!-- START 2022/12/01 R.Takau[QC#57252,ADD] -->
             AND A.GLBL_CMPY_CD      = C.GLBL_CMPY_CD(+)
             AND A.AR_ADJ_NUM        = C.AR_ADJ_NUM(+)
             AND C.EZCANCELFLAG(+)   = '0'
             <!-- END   2022/12/01 R.Takau [QC#57252,ADD] -->
            
     ORDER BY
                  <!-- START 2024/02/20 TZ.Win [QC#63450, ADD] -->
                   SORTKEY ASC
                  ,A.AR_CASH_APP_SORT_NUM ASC NULLS FIRST
                  <!-- END 2024/02/20 TZ.Win [QC#63450, ADD] -->
                  <!-- START 2024/02/20 TZ.Win [QC#63450, MOD] -->
                  ,B.AR_ADJ_TRX_TP_CD  ASC
                  <!-- END 2024/02/20 TZ.Win [QC#63450, MOD] -->

    </statement>

    <resultMap id="result.findAdjAndDeduction" class="NFCL2760_ASMsg">
        <result property="arTrxTpCd"                    column="ARTRXTPCD"                  javaType="EZDCStringItem"/>
        <result property="cashAppDt_A1"                 column="CASH_APP_DT_A1"             javaType="EZDCDateItem"/>
        <result property="cashAppGlDt_A1"               column="CASHAPPGLDT_A1"             javaType="EZDCDateItem"/>
        <result property="dealCashDiscAmt_A1"           column="DEALCASHDISCAMT_A1"         javaType="EZDCStringItem"/>
        <result property="arAdjTpCd_A3"                 column="ARADJTPCD_A3"               javaType="EZDCStringItem"/>
        <result property="arAdjTpNm_A3"                 column="ARADJTPNM_A3"               javaType="EZDCStringItem"/>
        <result property="dealApplyAdjAmt_A3"           column="DEALAPPLYADJAMT_A3"         javaType="EZDCStringItem"/>
        <result property="arAdjNum_BK"                  column="ARADJNUM_BK"                javaType="EZDCStringItem"/>
        <result property="arAdjTrxTpCd_BK"              column="ARADJTRXTPCD_BK"            javaType="EZDCStringItem"/>
        <result property="arAdjTpNm_BK"                 column="ARADJTPNM_BK"               javaType="EZDCStringItem"/>
        <result property="arAdjTpCd_BK"                 column="ARADJTPCD_BK"               javaType="EZDCStringItem"/>
        <result property="dealApplyAmt_BK"              column="DEALAPPLYAMT_BK"            javaType="EZDCBigDecimalItem"/>
        <result property="arCashAppPk_BK"               column="ARCASHAPPPK_BK"             javaType="EZDCBigDecimalItem"/>
        <result property="arCashAppSqNum_UP"            column="ARCASHAPPSQNUM_UP"          javaType="EZDCStringItem"/>
        <result property="ezUpTime_UP"                  column="EZUPTIME_UP"                javaType="EZDCStringItem"/>
        <result property="ezUpTimeZone_UP"              column="EZUPTIMEZONE_UP"            javaType="EZDCStringItem"/>
        <!-- START 2024/02/20 TZ.Win [QC#63450, ADD] -->
        <result property="arCashAppSortNum_UP"          column="ARCASHAPPSORTNUM_UP"        javaType="EZDCBigDecimalItem"/>
        <!-- END 2024/02/20 TZ.Win [QC#63450, ADD] -->
        <result property="tocCd_A1"                     column="TOCCD"                      javaType="EZDSStringItem"/>
        <result property="coaProdCd_BK"                 column="COAPRODCD"                  javaType="EZDSStringItem"/>
        <!-- START 2016/11/07 S.Fujita [QC#13580,ADD] -->
        <result property="glDt_A1"                      column="GLDT_A1"                    javaType="EZDCDateItem"/>
        <!-- END   2016/11/07 S.Fujita [QC#13580,ADD] -->
        <!-- START   2022/12/01 R.Takau [QC#57252,ADD] -->
        <result property="xxCmntTxt_A1"       column="XX_CMNT_TXT"          javaType="EZDSStringItem" />
        <!-- END   2022/12/01 R.Takau [QC#57252,ADD] -->
    </resultMap>

    <statement id="findDeductionData" parameterClass="Map" resultMap="result.findDeductionData">
     SELECT
             A.GLBL_CMPY_CD
            
     FROM
             AR_ADJ       A
            ,AR_TRX_BAL   B
            
     WHERE
                  A.GLBL_CMPY_CD              =  #glblCmpyCd#
             AND  A.AR_ADJ_NUM                =  #arAdjNum#
             AND  A.AR_ADJ_TRX_TP_CD          =  #arAdjTrxTpCd#
             AND  A.GLBL_CMPY_CD              =  B.GLBL_CMPY_CD
             AND  A.AR_ADJ_NUM                =  B.ATT_ADJ_NUM
             AND  B.DEAL_ORIG_GRS_AMT         =  B.DEAL_RMNG_BAL_GRS_AMT
             AND  B.DEAL_APPLY_GRS_AMT        =  #dealApplyGrsAmt#
             AND  B.DEAL_APPLY_CASH_DISC_AMT  =  #dealApplyCashDiscAmt#
             AND  B.DEAL_APPLY_CR_AMT         =  #dealApplyCrAmt#
             AND  B.DEAL_APPLY_ADJ_AMT        =  #dealApplyAdjAmt#
             AND  B.AR_CASH_APPLY_STS_CD      =  #arCashApplyStsCd01#
             AND  A.EZCANCELFLAG              =  '0'
             AND  B.EZCANCELFLAG              =  '0'
            
    </statement>
    
    <resultMap id="result.findDeductionData" class="NFCL2760CMsg">
    </resultMap>
    
    <statement id="findInvDownLoad" parameterClass="Map" resultMap="result.findInvDownLoad">
     SELECT
             B.AR_TRX_NUM                 ARTRXNUM_B2
            ,B.GRP_INV_NUM                GRPINVNUM_B2
            ,B.AR_TRX_TP_CD               ARTRXTPCD_B2
            ,B.CPO_ORD_NUM                CPOORDNUM_B2
            ,B.INV_DUE_DT                 INVDUEDT_B2
            ,B.GL_DT                      GLDT_B2
            ,B.CUST_ISS_PO_NUM            CUSTISSPONUM_B2
            ,B.AR_CUST_REF_NUM            ARCUSTREFNUM_B2
            ,B.BILL_TO_CUST_CD            BILLTOCUSTCD_B2
            ,B.SELL_TO_CUST_CD            SELLTOCUSTCD_B2
            ,B.DEAL_ORIG_GRS_AMT          DEALORIGGRSAMT_B2
            ,B.DEAL_APPLY_GRS_AMT         DEALAPPLYGRSAMT_B2
            ,B.DEAL_APPLY_CR_AMT          DEALAPPLYCRAMT_B2
            ,B.DEAL_NET_SLS_AMT           DEALNETSLSAMT_B2
            ,B.DEAL_FRT_AMT               DEALFRTAMT_B2
            ,B.DEAL_TAX_AMT               DEALTAXAMT_B2
            ,B.DEAL_RMNG_BAL_GRS_AMT      DEALRMNGBALGRSAMT_B2
            ,A.DEAL_APPLY_AMT             DEALAPPLYAMT_B2
            ,A,CASH_APP_DT                CASH_APP_DT_B2
            ,A.GL_DT                      CASHAPPGLDT_B2
            ,A.DEAL_APPLY_CASH_DISC_AMT   DEALCASHDISCAMT_B2
            ,B.CASH_DISC_PCT              CASHDISCPCT_B2
            ,A.AR_CASH_APP_PK             ARCASHAPPPK_BK
            ,B.AR_TRX_BAL_PK              ARTRXBALPK_BK
            ,B.DEAL_APPLY_ADJ_AMT         DEALAPPLYADJAMT_B3
            ,(CASE 
                   WHEN B.AR_TRX_TP_CD  =  #arTrxTpCdAdj# THEN '1'
                   WHEN B.AR_TRX_TP_CD  =  #arTrxTpCdDed# THEN '2'
                   WHEN B.AR_TRX_TP_CD  =  #arTrxTpCdCrm# THEN '3'
                   WHEN B.AR_TRX_TP_CD  =  #arTrxTpCdDem# THEN '4'
                   WHEN B.AR_TRX_TP_CD  =  #arTrxTpCdInv# THEN '5'
                   ELSE '6' END)           SORTKEY

     FROM
             AR_CASH_APP  A
            ,AR_TRX_BAL   B
            
     WHERE
                  A.GLBL_CMPY_CD     =  #glblCmpyCd#
             AND  A.RCPT_NUM         =  #rcptNum#
             AND  A.AR_TRX_NUM      IS  NOT NULL
             AND  A.AR_SCR_CANC_FLG  =  #arScrCancFlg#
             AND  A.GLBL_CMPY_CD     =  B.GLBL_CMPY_CD
             AND  A.AR_TRX_BAL_PK    =  B.AR_TRX_BAL_PK
             AND  A.EZCANCELFLAG     =  '0'
             AND  B.EZCANCELFLAG     =  '0'
            
     ORDER BY
                  SORTKEY       ASC
                 ,B.AR_TRX_NUM  DESC
                   
    </statement>

    <resultMap id="result.findInvDownLoad" class="NFCL2760_BSMsg">
        <result property="arTrxNum_B2"                  column="ARTRXNUM_B2"                javaType="EZDSStringItem"/>
        <result property="grpInvNum_B2"                 column="GRPINVNUM_B2"               javaType="EZDSStringItem"/>
        <result property="arTrxTpCd_B2"                 column="ARTRXTPCD_B2"               javaType="EZDSStringItem"/>
        <result property="cpoOrdNum_B2"                 column="CPOORDNUM_B2"               javaType="EZDSStringItem"/>
        <result property="invDueDt_B2"                  column="INVDUEDT_B2"                javaType="EZDSDateItem"/>
        <result property="glDt_B2"                      column="GLDT_B2"                    javaType="EZDSDateItem"/>
        <result property="custIssPoNum_B2"              column="CUSTISSPONUM_B2"            javaType="EZDSStringItem"/>
        <result property="arCustRefNum_B2"              column="ARCUSTREFNUM_B2"            javaType="EZDSStringItem"/>
        <result property="billToCustCd_B2"              column="BILLTOCUSTCD_B2"            javaType="EZDSStringItem"/>
        <result property="sellToCustCd_B2"              column="SELLTOCUSTCD_B2"            javaType="EZDSStringItem"/>
        <result property="dealOrigGrsAmt_B2"            column="DEALORIGGRSAMT_B2"          javaType="EZDSBigDecimalItem"/>
        <result property="dealApplyGrsAmt_B2"           column="DEALAPPLYGRSAMT_B2"         javaType="EZDSBigDecimalItem"/>
        <result property="dealApplyCrAmt_B2"            column="DEALAPPLYCRAMT_B2"          javaType="EZDSBigDecimalItem"/>
        <result property="dealNetSlsAmt_B2"             column="DEALNETSLSAMT_B2"           javaType="EZDSBigDecimalItem"/>
        <result property="dealFrtAmt_B2"                column="DEALFRTAMT_B2"              javaType="EZDSBigDecimalItem"/>
        <result property="dealTaxAmt_B2"                column="DEALTAXAMT_B2"              javaType="EZDSBigDecimalItem"/>
        <result property="dealRmngBalGrsAmt_B2"         column="DEALRMNGBALGRSAMT_B2"       javaType="EZDSBigDecimalItem"/>
        <result property="dealApplyAmt_B2"              column="DEALAPPLYAMT_B2"            javaType="EZDSBigDecimalItem"/>
        <result property="cashAppGlDt_B2"               column="CASHAPPGLDT_B2"             javaType="EZDSDateItem"/>
        <result property="dealCashDiscAmt_B2"           column="DEALCASHDISCAMT_B2"         javaType="EZDSBigDecimalItem"/>
        <result property="cashDiscPct_B2"               column="CASHDISCPCT_B2"             javaType="EZDSBigDecimalItem"/>
        <result property="arCashAppPk_BK"               column="ARCASHAPPPK_BK"             javaType="EZDCBigDecimalItem"/>
        <result property="arTrxBalPk_BK"                column="ARTRXBALPK_BK"              javaType="EZDCBigDecimalItem"/>
        <result property="dealApplyAdjAmt_B3"           column="DEALAPPLYADJAMT_B3"         javaType="EZDCBigDecimalItem"/>
    </resultMap>

    <statement id="findInvDownLoadByAdj" parameterClass="Map" resultMap="result.findInvDownLoadByAdj">
     SELECT
             B.AR_ADJ_TP_CD      ARADJTPCD_B2
            ,ADT.AR_ADJ_TP_NM    ARADJTPNM_B2
            ,B.DEAL_AR_ADJ_AMT   DEALAPPLYADJAMT_B2
            
     FROM
             AR_CASH_APP  A
            ,AR_ADJ       B
            ,AR_ADJ_TP    ADT
            
     WHERE
                  A.GLBL_CMPY_CD     =  #glblCmpyCd#
             AND  A.AR_CASH_APP_PK   =  #arCashAppPk#
             AND  A.RCPT_NUM        IS  NULL
             AND  A.AR_TRX_NUM       =  #arTrxNum#
             AND  A.AR_TRX_BAL_PK    =  #arTrxBalPk#
             AND  A.AR_SCR_CANC_FLG  =  #arScrCancFlg#
             AND  A.GLBL_CMPY_CD     =  B.GLBL_CMPY_CD
             AND  A.AR_ADJ_NUM       =  B.AR_ADJ_NUM
             AND  A.AR_TRX_BAL_PK    =  B.ORIG_AR_TRX_BAL_PK
             AND  A.EZCANCELFLAG     =  '0'
             AND  B.EZCANCELFLAG     =  '0'
             
             AND  B.GLBL_CMPY_CD     =  ADT.GLBL_CMPY_CD(+)
             AND  B.AR_ADJ_TP_CD     =  ADT.AR_ADJ_TP_CD(+)
             AND ADT.EZCANCELFLAG(+) =  '0'
            
    </statement>

    <resultMap id="result.findInvDownLoadByAdj" class="NFCL2760_BSMsg">
        <result property="arAdjTpCd_B2"              column="ARADJTPCD_B2"                javaType="EZDCStringItem"/>
        <result property="arAdjTpNm_B2"              column="ARADJTPNM_B2"                javaType="EZDCStringItem"/>
        <result property="dealApplyAdjAmt_B2"        column="DEALAPPLYADJAMT_B2"          javaType="EZDCBigDecimalItem"/>
    </resultMap>

    <statement id="findDownLoadAdjAndDeduction" parameterClass="Map" resultMap="result.findDownLoadAdjAndDeduction">
     SELECT
             B.AR_ADJ_TRX_TP_CD   ARADJTRXTPCD_B2
            ,A.DEAL_APPLY_AMT     DEALAPPLYAMT_B2
            ,A.GL_DT              CASHAPPGLDT_B2
            ,A.CASH_APP_DT        CASH_APP_DT_B2
            ,B.AR_ADJ_NUM         ARADJNUM_BK

     FROM
             AR_CASH_APP  A
            ,AR_ADJ       B
            
     WHERE
                  A.GLBL_CMPY_CD     =  #glblCmpyCd#
             AND  A.RCPT_NUM         =  #rcptNum#
             AND  A.AR_TRX_NUM      IS  NULL
             AND  A.AR_SCR_CANC_FLG  =  #arScrCancFlg#
             AND  A.GLBL_CMPY_CD     =  B.GLBL_CMPY_CD
             AND  A.AR_ADJ_NUM       =  B.AR_ADJ_NUM
             AND  A.EZCANCELFLAG     =  '0'
             AND  B.EZCANCELFLAG     =  '0'
            
     ORDER BY
                  B.AR_ADJ_TRX_TP_CD ASC

    </statement>

    <resultMap id="result.findDownLoadAdjAndDeduction" class="NFCL2760_BSMsg">
        <result property="arTrxTpCd_B2"                  column="ARADJTRXTPCD_B2"            javaType="EZDCStringItem"/>
        <result property="dealApplyAmt_B2"               column="DEALAPPLYAMT_B2"            javaType="EZDCBigDecimalItem"/>
        <result property="cashAppGlDt_B2"                column="CASHAPPGLDT_B2"             javaType="EZDSDateItem"/>
        <result property="arAdjNum_BK"                   column="ARADJNUM_BK"                javaType="EZDCStringItem"/>
    </resultMap>

    <statement id="findArTrxBal" parameterClass="Map" resultMap="result.findArTrxBal">
     SELECT
             A.AR_TRX_NUM                ARTRXNUM
            ,A.GRP_INV_NUM               GRPINVNUM
            ,A.AR_TRX_TP_CD              ARTRXTPCD
            ,A.CPO_ORD_NUM               CPOORDNUM
            ,A.INV_DUE_DT                INVDUEDT
            ,A.GL_DT                     GLDT
            ,A.CUST_ISS_PO_NUM           CUSTISSPONUM
       <!-- START 2018/07/19 Y.Matsui [QC#26871,MOD] -->
       <!-- START 2018/06/06 Y.Matsui [QC#25956,MOD] -->
       <!-- ,A.AR_CUST_REF_NUM           ARCUSTREFNUM -->
            ,CASE
                 WHEN A.AR_CUST_REF_NUM IS NULL AND A.AR_TRX_TP_CD = #arTrxTpCdAcc# THEN (
                     SELECT
                         ATT.AR_TRX_TP_NM
                     FROM
                         AR_TRX_TP ATT
                     WHERE
                         ATT.GLBL_CMPY_CD = A.GLBL_CMPY_CD
                     AND ATT.AR_TRX_TP_CD = A.AR_TRX_TP_CD
                     AND ATT.EZCANCELFLAG = '0'
                 )
                 ELSE A.AR_CUST_REF_NUM
             END                         ARCUSTREFNUM
       <!-- END 2018/06/06 Y.Matsui [QC#25956,MOD] -->
       <!-- END 2018/07/19 Y.Matsui [QC#26871,MOD] -->
            ,A.BILL_TO_CUST_CD           BILLTOCUSTCD
            ,A.SELL_TO_CUST_CD           SELLTOCUSTCD
            ,A.DEAL_ORIG_GRS_AMT         DEALORIGGRSAMT
            ,A.DEAL_APPLY_GRS_AMT        DEALAPPLYGRSAMT
            ,A.DEAL_APPLY_CR_AMT         DEALAPPLYCRAMT
            ,A.DEAL_NET_SLS_AMT          DEALNETSLSAMT
            ,A.DEAL_FRT_AMT              DEALFRTAMT
            ,A.DEAL_TAX_AMT              DEALTAXAMT
            ,A.DEAL_RMNG_BAL_GRS_AMT     DEALRMNGBALGRSAMT
            ,A.DEAL_APPLY_ADJ_AMT        DEALAPPLYADJAMT
            ,A.DEAL_APPLY_ADJ_RSVD_AMT   DEALAPPLYADJRSVDAMT
            ,A.AR_TRX_BAL_PK             ARTRXBALPK
            ,A.AR_CASH_APPLY_STS_CD      ARCASHAPPLYSTSCD
            ,A.EZUPTIME                  EZUP
            ,A.EZUPTIMEZONE              EZUPTIMEZONE
            ,B.DEAL_CASH_DISC_AMT        DEALCASHDISCAMT
            ,B.AR_CASH_DISC_SCHD_SQ_NUM  ARCASHDISCSCHDSQNUM
            ,B.CASH_DISC_PCT             CASHDISCPCT
            ,C.ACCT_YR_MTH               ACCTYRMTH
            ,C.SUB_SYS_CD                SUBSYSCD
            ,C.ONL_BAT_TP_CD             ONLBATTPCD
            ,C.ACCT_DT                   ACCTDT
            ,A.AR_TRX_DT                 ARTRXDT
            ,A.CASH_DISC_TERM_CD         CASHDISCTERMCD
            ,A.TOC_CD                    TOCCD
            ,A.COA_PROD_CD               COAPRODCD
            ,A.PMT_TERM_CD               PMTTERMCD
            ,A.PMT_TERM_CASH_DISC_CD     PMTTERMCASHDISCCD
            ,A.INV_PMT_METH_CD			 INV_PMT_METH_CD
            ,A.INV_PMT_COND_CD			 INV_PMT_COND_CD
            ,D.AR_EXP_PMT_METH_NM        AR_EXP_PMT_METH_NM
            ,E.AR_EXP_PMT_COND_NM        AR_EXP_PMT_COND_NM
            ,A.DEAL_CCY_CD				 DEAL_CCY_CD
            
            ,A.BILL_TO_CUST_ACCT_CD      BILL_TO_CUST_ACCT_CD
            ,F.DS_ACCT_NM                DS_ACCT_NM
     FROM
             AR_TRX_BAL         A
            ,AR_CASH_DISC_SCHD  B
            ,AR_ACCT_DT         C
            ,AR_EXP_PMT_METH    D
            ,AR_EXP_PMT_COND    E
            ,SELL_TO_CUST       F
     WHERE

             A.GLBL_CMPY_CD                 =  #glblCmpyCd01#
             AND  A.DEAL_RMNG_BAL_GRS_AMT  !=  #dealRmngBalGrsAmt01#
             AND  (
                  A.AR_CASH_APPLY_STS_CD    =  #arCashApplyStsCd01#
              OR  A.AR_CASH_APPLY_STS_CD    =  #arCashApplyStsCd02#
                  )
             AND  A.EZCANCELFLAG            =  '0'

             <!-- START 2018/07/20 Y.Matsui [QC#26985,MOD] -->
             <isNotNull property="arTrxBalPk01">
                  <iterate property="arTrxBalPk01" var="elem[]" open="AND (" close=")" conjunction=" OR ">
                      A.AR_TRX_BAL_PK = #elem[]#
                  </iterate>
             </isNotNull>
             <!-- END   2018/07/20 Y.Matsui [QC#26985,MOD] -->

             <isNotNull property="grpInvNum">
             AND  A.GRP_INV_NUM            =  #grpInvNum#
             </isNotNull>
             
             AND  A.GLBL_CMPY_CD                        =  B.GLBL_CMPY_CD(+)
             AND  A.AR_TRX_BAL_PK                       =  B.AR_TRX_BAL_PK(+)
             AND  A.DEAL_CCY_CD                         =  B.DEAL_CCY_CD(+)
             AND  B.EXTN_CASH_DISC_RNG_FROM_DT(+) &lt;  =  #cashDiscRngFromDt01#
             AND  B.EXTN_CASH_DISC_RNG_THRU_DT(+) &gt;  =  #cashDiscRngThruDt01#
             AND  B.EZCANCELFLAG(+)                     =  '0'
             AND  A.GLBL_CMPY_CD                        =  C.GLBL_CMPY_CD(+)
             AND  C.SUB_SYS_CD(+)                       =  #subSysCd#
             AND  C.ONL_BAT_TP_CD(+)                    =  #onlBatTpCd#

             AND  A.GLBL_CMPY_CD                        =  D.GLBL_CMPY_CD(+)
             AND  A.INV_PMT_METH_CD                     =  D.AR_EXP_PMT_METH_CD(+)
             AND  A.GLBL_CMPY_CD                        =  E.GLBL_CMPY_CD(+)
             AND  A.INV_PMT_COND_CD                     =  E.AR_EXP_PMT_COND_CD(+)
             AND  D.EZCANCELFLAG(+)                     =  '0'
             AND  E.EZCANCELFLAG(+)                     =  '0'

             AND  A.GLBL_CMPY_CD                        = F.GLBL_CMPY_CD
             AND  A.BILL_TO_CUST_ACCT_CD                = F.SELL_TO_CUST_CD
             AND  F.EZCANCELFLAG                        =  '0'

     ORDER BY
             A.AR_TRX_NUM
    </statement>
    <resultMap id="result.findArTrxBal" class="NFCL2760_BSMsg">
        <result property="arTrxNum_B2"                  column="ARTRXNUM"                javaType="EZDSStringItem"/>
        <result property="grpInvNum_B2"                 column="GRPINVNUM"               javaType="EZDSStringItem"/>
        <result property="arTrxTpCd_B2"                 column="ARTRXTPCD"               javaType="EZDSStringItem"/>
        <result property="cpoOrdNum_B2"                 column="CPOORDNUM"               javaType="EZDSStringItem"/>
        <result property="invDueDt_B2"                  column="INVDUEDT"                javaType="EZDSDateItem"/>
        <result property="glDt_B2"                      column="GLDT"                    javaType="EZDSDateItem"/>
        <result property="custIssPoNum_B2"              column="CUSTISSPONUM"            javaType="EZDSStringItem"/>
        <result property="arCustRefNum_B2"              column="ARCUSTREFNUM"            javaType="EZDSStringItem"/>
        <result property="billToCustCd_B2"              column="BILLTOCUSTCD"            javaType="EZDSStringItem"/>
        <result property="sellToCustCd_B2"              column="SELLTOCUSTCD"            javaType="EZDSStringItem"/>
        <result property="dealOrigGrsAmt_B2"            column="DEALORIGGRSAMT"          javaType="EZDSBigDecimalItem"/>
        <result property="dealApplyGrsAmt_B2"           column="DEALAPPLYGRSAMT"         javaType="EZDSBigDecimalItem"/>
        <result property="dealApplyCrAmt_B2"            column="DEALAPPLYCRAMT"          javaType="EZDSBigDecimalItem"/>
        <result property="dealNetSlsAmt_B2"             column="DEALNETSLSAMT"           javaType="EZDSBigDecimalItem"/>
        <result property="dealFrtAmt_B2"                column="DEALFRTAMT"              javaType="EZDSBigDecimalItem"/>
        <result property="dealTaxAmt_B2"                column="DEALTAXAMT"              javaType="EZDSBigDecimalItem"/>
        <result property="dealRmngBalGrsAmt_B2"         column="DEALRMNGBALGRSAMT"       javaType="EZDSBigDecimalItem"/>
        <result property="dealApplyAdjAmt_B2"           column="DEALAPPLYADJAMT"         javaType="EZDCBigDecimalItem"/>
        <result property="dealApplyAdjRsvdAmt_B2"       column="DEALAPPLYADJRSVDAMT"     javaType="EZDCBigDecimalItem"/>
        <result property="dealCashDiscAmt_B2"           column="DEALCASHDISCAMT"         javaType="EZDCBigDecimalItem"/>
        <result property="arCashDiscSchdSqNum_B2"       column="ARCASHDISCSCHDSQNUM"     javaType="EZDSStringItem"/>
        <result property="cashDiscPct_B2"               column="CASHDISCPCT"             javaType="EZDCBigDecimalItem"/>
        <result property="arTrxBalPk_BK"                column="ARTRXBALPK"              javaType="EZDCBigDecimalItem"/>
        <result property="arCashApplyStsCd_B2"          column="ARCASHAPPLYSTSCD"        javaType="EZDSStringItem"/>
        <result property="ezUpTime_B2"                  column="EZUP"                    javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_B2"              column="EZUPTIMEZONE"            javaType="EZDSStringItem"/>
        <result property="acctYrMth_B2"                 column="ACCTYRMTH"               javaType="EZDSDateItem"/>
        <result property="subSysCd_B2"                  column="SUBSYSCD"                javaType="EZDSStringItem"/>
        <result property="onlBatTpCd_B2"                column="ONLBATTPCD"              javaType="EZDSStringItem"/>
        <result property="acctDt_B2"                    column="ACCTDT"                  javaType="EZDSDateItem"/>        
        <result property="arTrxDt_B2"                   column="ARTRXDT"                 javaType="EZDCDateItem"/>
        <result property="cashDiscTermCd_B2"            column="CASHDISCTERMCD"          javaType="EZDSStringItem"/>
        <result property="tocCd_B2"                     column="TOCCD"                   javaType="EZDSStringItem"/>
        <result property="coaProdCd_B2"                 column="COAPRODCD"               javaType="EZDSStringItem"/>
        <result property="pmtTermCd_B2"                 column="PMTTERMCD"               javaType="EZDSStringItem"/>
        <result property="pmtTermCashDiscCd_B2"         column="PMTTERMCASHDISCCD"       javaType="EZDSStringItem"/>
        <result property="invPmtMethCd_B2"              column="INV_PMT_METH_CD"         javaType="EZDSStringItem"/>
        <result property="invPmtCondCd_B2"              column="INV_PMT_COND_CD"         javaType="EZDSStringItem"/>
        <result property="arExpPmtMethNm_B2"            column="AR_EXP_PMT_METH_NM"      javaType="EZDSStringItem"/>
        <result property="arExpPmtCondNm_B2"            column="AR_EXP_PMT_COND_NM"      javaType="EZDSStringItem"/>
        <result property="dealCcyCd_B2"                 column="DEAL_CCY_CD"             javaType="EZDSStringItem"/>

        <result property="billToCustAcctCd_B2"          column="BILL_TO_CUST_ACCT_CD"    javaType="EZDSStringItem"/>
        <result property="dsAcctNm_B2"                  column="DS_ACCT_NM"              javaType="EZDSStringItem"/>

    </resultMap>

    <statement id="findAddLineArTrxBal" parameterClass="Map" resultMap="result.findAddLineArTrxBal">
     SELECT
             A.AR_TRX_NUM                ARTRXNUM
            ,A.GRP_INV_NUM               GRPINVNUM
            ,A.AR_TRX_TP_CD              ARTRXTPCD
            ,A.CPO_ORD_NUM               CPOORDNUM
            ,A.INV_DUE_DT                INVDUEDT
            ,A.GL_DT                     GLDT
            ,A.CUST_ISS_PO_NUM           CUSTISSPONUM
            ,A.AR_CUST_REF_NUM           ARCUSTREFNUM
            ,A.BILL_TO_CUST_CD           BILLTOCUSTCD
            ,A.SELL_TO_CUST_CD           SELLTOCUSTCD
            ,A.DEAL_ORIG_GRS_AMT         DEALORIGGRSAMT
            ,A.DEAL_APPLY_GRS_AMT        DEALAPPLYGRSAMT
            ,A.DEAL_APPLY_CR_AMT         DEALAPPLYCRAMT
            ,A.DEAL_NET_SLS_AMT          DEALNETSLSAMT
            ,A.DEAL_FRT_AMT              DEALFRTAMT
            ,A.DEAL_TAX_AMT              DEALTAXAMT
            ,A.DEAL_RMNG_BAL_GRS_AMT     DEALRMNGBALGRSAMT
            ,A.DEAL_APPLY_ADJ_AMT        DEALAPPLYADJAMT
            ,A.AR_TRX_BAL_PK             ARTRXBALPK
            ,A.AR_CASH_APPLY_STS_CD      ARCASHAPPLYSTSCD
            ,A.EZUPTIME                  EZUP
            ,A.EZUPTIMEZONE              EZUPTIMEZONE
            ,B.DEAL_CASH_DISC_AMT        DEALCASHDISCAMT
            ,B.AR_CASH_DISC_SCHD_SQ_NUM  ARCASHDISCSCHDSQNUM
            ,B.CASH_DISC_PCT             CASHDISCPCT
            ,C.ACCT_YR_MTH               ACCTYRMTH
            ,C.SUB_SYS_CD                SUBSYSCD
            ,C.ONL_BAT_TP_CD             ONLBATTPCD
            ,C.ACCT_DT                   ACCTDT
            ,A.AR_TRX_DT                 ARTRXDT
            ,A.CASH_DISC_TERM_CD         CASHDISCTERMCD
            ,A.TOC_CD                    TOCCD
            ,A.COA_PROD_CD               COAPRODCD
            ,A.PMT_TERM_CD               PMTTERMCD
            ,A.PMT_TERM_CASH_DISC_CD     PMTTERMCASHDISCCD
            ,A.INV_PMT_METH_CD			 INV_PMT_METH_CD
            ,A.INV_PMT_COND_CD			 INV_PMT_COND_CD
            ,A.DEAL_CCY_CD				 DEAL_CCY_CD
            ,D.AR_EXP_PMT_METH_NM        AR_EXP_PMT_METH_NM
            ,E.AR_EXP_PMT_COND_NM        AR_EXP_PMT_COND_NM
            
            ,A.BILL_TO_CUST_ACCT_CD      BILL_TO_CUST_ACCT_CD
            ,F.DS_ACCT_NM                DS_ACCT_NM
            
     FROM
             AR_TRX_BAL         A
            ,AR_CASH_DISC_SCHD  B
            ,AR_ACCT_DT         C
            ,AR_EXP_PMT_METH    D
            ,AR_EXP_PMT_COND    E
            ,SELL_TO_CUST       F
     WHERE

                  A.GLBL_CMPY_CD                        =  #glblCmpyCd01#
             AND  (
                     A.AR_TRX_NUM                       =  #arTrxNum01#
                  OR A.AR_CUST_REF_NUM                  =  #arTrxNum01#
                  )
             AND  (
                  A.AR_CASH_APPLY_STS_CD                =  #arCashApplyStsCd01#
              OR  A.AR_CASH_APPLY_STS_CD                =  #arCashApplyStsCd02#
                  )
             AND  A.GLBL_CMPY_CD                        =  B.GLBL_CMPY_CD(+)
             AND  A.AR_TRX_BAL_PK                       =  B.AR_TRX_BAL_PK(+)
             AND  A.DEAL_CCY_CD                         =  B.DEAL_CCY_CD(+)
             AND  B.EXTN_CASH_DISC_RNG_FROM_DT(+) &lt;  =  #cashDiscRngFromDt01#
             AND  B.EXTN_CASH_DISC_RNG_THRU_DT(+) &gt;  =  #cashDiscRngThruDt01#
             AND  B.EZCANCELFLAG(+)                     =  '0'
             AND  A.GLBL_CMPY_CD                        =  C.GLBL_CMPY_CD(+)
             AND  C.SUB_SYS_CD(+)                       =  #subSysCd#
             AND  C.ONL_BAT_TP_CD(+)                    =  #onlBatTpCd#

             AND  A.GLBL_CMPY_CD                        =  D.GLBL_CMPY_CD(+)
             AND  A.INV_PMT_METH_CD                     =  D.AR_EXP_PMT_METH_CD(+)
             AND  A.GLBL_CMPY_CD                        =  E.GLBL_CMPY_CD(+)
             AND  A.INV_PMT_COND_CD                     =  E.AR_EXP_PMT_COND_CD(+)

             AND  A.GLBL_CMPY_CD                        = F.GLBL_CMPY_CD
             AND  A.BILL_TO_CUST_ACCT_CD                = F.SELL_TO_CUST_CD
             AND  F.EZCANCELFLAG                        =  '0'
    </statement>

    <resultMap id="result.findAddLineArTrxBal" class="NFCL2760_BSMsg">
        <result property="arTrxNum_B2"                  column="ARTRXNUM"                javaType="EZDSStringItem"/>
        <result property="grpInvNum_B2"                 column="GRPINVNUM"               javaType="EZDSStringItem"/>
        <result property="arTrxTpCd_B2"                 column="ARTRXTPCD"               javaType="EZDSStringItem"/>
        <result property="cpoOrdNum_B2"                 column="CPOORDNUM"               javaType="EZDSStringItem"/>
        <result property="invDueDt_B2"                  column="INVDUEDT"                javaType="EZDSDateItem"/>
        <result property="glDt_B2"                      column="GLDT"                    javaType="EZDSDateItem"/>
        <result property="custIssPoNum_B2"              column="CUSTISSPONUM"            javaType="EZDSStringItem"/>
        <result property="arCustRefNum_B2"              column="ARCUSTREFNUM"            javaType="EZDSStringItem"/>
        <result property="billToCustCd_B2"              column="BILLTOCUSTCD"            javaType="EZDSStringItem"/>
        <result property="sellToCustCd_B2"              column="SELLTOCUSTCD"            javaType="EZDSStringItem"/>
        <result property="dealOrigGrsAmt_B2"            column="DEALORIGGRSAMT"          javaType="EZDSBigDecimalItem"/>
        <result property="dealApplyGrsAmt_B2"           column="DEALAPPLYGRSAMT"         javaType="EZDSBigDecimalItem"/>
        <result property="dealApplyCrAmt_B2"            column="DEALAPPLYCRAMT"          javaType="EZDSBigDecimalItem"/>
        <result property="dealNetSlsAmt_B2"             column="DEALNETSLSAMT"           javaType="EZDSBigDecimalItem"/>
        <result property="dealFrtAmt_B2"                column="DEALFRTAMT"              javaType="EZDSBigDecimalItem"/>
        <result property="dealTaxAmt_B2"                column="DEALTAXAMT"              javaType="EZDSBigDecimalItem"/>
        <result property="dealRmngBalGrsAmt_B2"         column="DEALRMNGBALGRSAMT"       javaType="EZDSBigDecimalItem"/>
        <result property="dealApplyAdjAmt_B2"           column="DEALAPPLYADJAMT"         javaType="EZDCBigDecimalItem"/>
        <result property="dealCashDiscAmt_B2"           column="DEALCASHDISCAMT"         javaType="EZDCBigDecimalItem"/>
        <result property="arCashDiscSchdSqNum_B2"       column="ARCASHDISCSCHDSQNUM"     javaType="EZDSStringItem"/>
        <result property="cashDiscPct_B2"               column="CASHDISCPCT"             javaType="EZDCBigDecimalItem"/>
        <result property="arTrxBalPk_BK"                column="ARTRXBALPK"              javaType="EZDCBigDecimalItem"/>
        <result property="arCashApplyStsCd_B2"          column="ARCASHAPPLYSTSCD"        javaType="EZDSStringItem"/>
        <result property="ezUpTime_B2"                  column="EZUP"                    javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_B2"              column="EZUPTIMEZONE"            javaType="EZDSStringItem"/>
        <result property="acctYrMth_B2"                 column="ACCTYRMTH"               javaType="EZDSDateItem"/>
        <result property="subSysCd_B2"                  column="SUBSYSCD"                javaType="EZDSStringItem"/>
        <result property="onlBatTpCd_B2"                column="ONLBATTPCD"              javaType="EZDSStringItem"/>
        <result property="acctDt_B2"                    column="ACCTDT"                  javaType="EZDSDateItem"/>        
        <result property="arTrxDt_B2"                   column="ARTRXDT"                 javaType="EZDCDateItem"/>
        <result property="cashDiscTermCd_B2"            column="CASHDISCTERMCD"          javaType="EZDSStringItem"/>
        <result property="tocCd_B2"                     column="TOCCD"                   javaType="EZDSStringItem"/>
        <result property="coaProdCd_B2"                 column="COAPRODCD"               javaType="EZDSStringItem"/>
        <result property="pmtTermCd_B2"                 column="PMTTERMCD"               javaType="EZDSStringItem"/>
        <result property="pmtTermCashDiscCd_B2"         column="PMTTERMCASHDISCCD"       javaType="EZDSStringItem"/>
        <result property="invPmtMethCd_B2"              column="INV_PMT_METH_CD"         javaType="EZDSStringItem"/>
        <result property="invPmtCondCd_B2"              column="INV_PMT_COND_CD"         javaType="EZDSStringItem"/>
        <result property="arExpPmtMethNm_B2"            column="AR_EXP_PMT_METH_NM"      javaType="EZDSStringItem"/>
        <result property="arExpPmtCondNm_B2"            column="AR_EXP_PMT_COND_NM"      javaType="EZDSStringItem"/>
        <result property="dealCcyCd_B2"                 column="DEAL_CCY_CD"             javaType="EZDSStringItem"/>

        <result property="billToCustAcctCd_B2"          column="BILL_TO_CUST_ACCT_CD"    javaType="EZDSStringItem"/>
        <result property="dsAcctNm_B2"                  column="DS_ACCT_NM"              javaType="EZDSStringItem"/>
    </resultMap>

    <statement id="findAddLineArTrxBalByTrxNum" parameterClass="Map" resultMap="result.findAddLineArTrxBalByTrxNum">
     SELECT
             A.AR_TRX_NUM                ARTRXNUM
            ,A.GRP_INV_NUM               GRPINVNUM
            ,A.AR_TRX_TP_CD              ARTRXTPCD
            ,A.CPO_ORD_NUM               CPOORDNUM
            ,A.INV_DUE_DT                INVDUEDT
            ,A.GL_DT                     GLDT
            ,A.CUST_ISS_PO_NUM           CUSTISSPONUM
            ,A.AR_CUST_REF_NUM           ARCUSTREFNUM
            ,A.BILL_TO_CUST_CD           BILLTOCUSTCD
            ,A.SELL_TO_CUST_CD           SELLTOCUSTCD
            ,A.DEAL_ORIG_GRS_AMT         DEALORIGGRSAMT
            ,A.DEAL_APPLY_GRS_AMT        DEALAPPLYGRSAMT
            ,A.DEAL_APPLY_CR_AMT         DEALAPPLYCRAMT
            ,A.DEAL_NET_SLS_AMT          DEALNETSLSAMT
            ,A.DEAL_FRT_AMT              DEALFRTAMT
            ,A.DEAL_TAX_AMT              DEALTAXAMT
            ,A.DEAL_RMNG_BAL_GRS_AMT     DEALRMNGBALGRSAMT
            ,A.DEAL_APPLY_ADJ_AMT        DEALAPPLYADJAMT
            ,A.DEAL_APPLY_ADJ_RSVD_AMT   DEALAPPLYADJRSVDAMT
            ,A.AR_TRX_BAL_PK             ARTRXBALPK
            ,A.AR_CASH_APPLY_STS_CD      ARCASHAPPLYSTSCD
            ,A.EZUPTIME                  EZUP
            ,A.EZUPTIMEZONE              EZUPTIMEZONE
            ,B.DEAL_CASH_DISC_AMT        DEALCASHDISCAMT
            ,B.AR_CASH_DISC_SCHD_SQ_NUM  ARCASHDISCSCHDSQNUM
            ,B.CASH_DISC_PCT             CASHDISCPCT
            ,C.ACCT_YR_MTH               ACCTYRMTH
            ,C.SUB_SYS_CD                SUBSYSCD
            ,C.ONL_BAT_TP_CD             ONLBATTPCD
            ,C.ACCT_DT                   ACCTDT
            ,A.AR_TRX_DT                 ARTRXDT
            ,A.CASH_DISC_TERM_CD         CASHDISCTERMCD
            ,A.TOC_CD                    TOCCD
            ,A.COA_PROD_CD               COAPRODCD
            ,A.PMT_TERM_CD               PMTTERMCD
            ,A.PMT_TERM_CASH_DISC_CD     PMTTERMCASHDISCCD
            ,A.INV_PMT_METH_CD			 INV_PMT_METH_CD
            ,A.INV_PMT_COND_CD			 INV_PMT_COND_CD
            ,D.AR_EXP_PMT_METH_NM      AR_EXP_PMT_METH_NM
            ,E.AR_EXP_PMT_COND_NM      AR_EXP_PMT_COND_NM
            ,A.DEAL_CCY_CD				 DEAL_CCY_CD
            
            ,A.BILL_TO_CUST_ACCT_CD      BILL_TO_CUST_ACCT_CD
            ,F.DS_ACCT_NM                DS_ACCT_NM
     FROM
             AR_TRX_BAL         A
            ,AR_CASH_DISC_SCHD  B
            ,AR_ACCT_DT         C
            ,AR_EXP_PMT_METH    D
            ,AR_EXP_PMT_COND    E
            ,SELL_TO_CUST       F
            
     WHERE

                  A.GLBL_CMPY_CD                        =  #glblCmpyCd01#
<!--
             AND  A.BILL_TO_CUST_CD                     =  #billToCustCd#
-->
<!-- QC#22762 DEL 2018/03/12
             AND  A.SELL_TO_CUST_CD                     =  #sellToCustCd#
 -->
<!-- 2018/05/08 QC#25737 ADD START -->
             AND  A.BILL_TO_CUST_ACCT_CD IN (
                 SELECT 
                    DAR.RELN_DS_ACCT_NUM
                 FROM
                    DS_ACCT_RELN DAR
                 WHERE
                        DAR.GLBL_CMPY_CD          = #glblCmpyCd01#
                    AND DAR.DS_ACCT_NUM           = #sellToCustCd#
                    AND DAR.DS_ACCT_RELN_TP_CD    IN (#dsAcctRelnTp1#,#dsAcctRelnTp2#)
                    AND DAR.EZCANCELFLAG          = '0'
                 UNION ALL
                 SELECT #sellToCustCd# FROM DUAL
             )
<!-- 2018/05/08 QC#25737 ADD END -->
             AND  A.AR_TRX_NUM                          =  #arTrxNum01#
             AND  (
                  A.AR_CASH_APPLY_STS_CD                =  #arCashApplyStsCd01#
              OR  A.AR_CASH_APPLY_STS_CD                =  #arCashApplyStsCd02#
                  )
             AND  A.GLBL_CMPY_CD                        =  B.GLBL_CMPY_CD(+)
             AND  A.AR_TRX_BAL_PK                       =  B.AR_TRX_BAL_PK(+)
             AND  A.DEAL_CCY_CD                         =  B.DEAL_CCY_CD(+)
             AND  B.EXTN_CASH_DISC_RNG_FROM_DT(+) &lt;  =  #cashDiscRngFromDt01#
             AND  B.EXTN_CASH_DISC_RNG_THRU_DT(+) &gt;  =  #cashDiscRngThruDt01#
             AND  B.EZCANCELFLAG(+)                     =  '0'
             AND  A.GLBL_CMPY_CD                        =  C.GLBL_CMPY_CD(+)
             AND  C.SUB_SYS_CD(+)                       =  #subSysCd#
             AND  C.ONL_BAT_TP_CD(+)                    =  #onlBatTpCd#
             AND  A.AR_TRX_TP_CD              &lt; &gt; 'RCP'      
             AND  A.EXPT_FLG                            =  #exptFlg#

             AND  A.GLBL_CMPY_CD                        =  D.GLBL_CMPY_CD(+)
             AND  A.INV_PMT_METH_CD                     =  D.AR_EXP_PMT_METH_CD(+)
             AND  A.GLBL_CMPY_CD                        =  E.GLBL_CMPY_CD(+)
             AND  A.INV_PMT_COND_CD                     =  E.AR_EXP_PMT_COND_CD(+)
             AND  D.EZCANCELFLAG(+)    =  '0'
             AND  E.EZCANCELFLAG(+)    =  '0'

             AND  A.GLBL_CMPY_CD                        =  F.GLBL_CMPY_CD
             AND  A.BILL_TO_CUST_ACCT_CD                =  F.SELL_TO_CUST_CD
             AND  F.EZCANCELFLAG                        =  '0'
    </statement>
    <resultMap id="result.findAddLineArTrxBalByTrxNum" class="NFCL2760_DSMsg">
        <result property="arTrxNum_D1"                  column="ARTRXNUM"                javaType="EZDSStringItem"/>
        <result property="grpInvNum_D1"                 column="GRPINVNUM"               javaType="EZDSStringItem"/>
        <result property="arTrxTpCd_D1"                 column="ARTRXTPCD"               javaType="EZDSStringItem"/>
        <result property="cpoOrdNum_D1"                 column="CPOORDNUM"               javaType="EZDSStringItem"/>
        <result property="invDueDt_D1"                  column="INVDUEDT"                javaType="EZDSDateItem"/>
        <result property="glDt_D1"                      column="GLDT"                    javaType="EZDSDateItem"/>
        <result property="custIssPoNum_D1"              column="CUSTISSPONUM"            javaType="EZDSStringItem"/>
        <result property="arCustRefNum_D1"              column="ARCUSTREFNUM"            javaType="EZDSStringItem"/>
        <result property="billToCustCd_D1"              column="BILLTOCUSTCD"            javaType="EZDSStringItem"/>
        <result property="sellToCustCd_D1"              column="SELLTOCUSTCD"            javaType="EZDSStringItem"/>
        <result property="dealOrigGrsAmt_D1"            column="DEALORIGGRSAMT"          javaType="EZDSBigDecimalItem"/>
        <result property="dealApplyGrsAmt_D1"           column="DEALAPPLYGRSAMT"         javaType="EZDSBigDecimalItem"/>
        <result property="dealApplyCrAmt_D1"            column="DEALAPPLYCRAMT"          javaType="EZDSBigDecimalItem"/>
        <result property="dealNetSlsAmt_D1"             column="DEALNETSLSAMT"           javaType="EZDSBigDecimalItem"/>
        <result property="dealFrtAmt_D1"                column="DEALFRTAMT"              javaType="EZDSBigDecimalItem"/>
        <result property="dealTaxAmt_D1"                column="DEALTAXAMT"              javaType="EZDSBigDecimalItem"/>
        <result property="dealRmngBalGrsAmt_D1"         column="DEALRMNGBALGRSAMT"       javaType="EZDSBigDecimalItem"/>
        <result property="dealApplyAdjAmt_D1"           column="DEALAPPLYADJAMT"         javaType="EZDCBigDecimalItem"/>
        <result property="dealApplyAdjRsvdAmt_D1"       column="DEALAPPLYADJRSVDAMT"     javaType="EZDCBigDecimalItem"/>
        <result property="dealCashDiscAmt_D1"           column="DEALCASHDISCAMT"         javaType="EZDCBigDecimalItem"/>
        <result property="arCashDiscSchdSqNum_D1"       column="ARCASHDISCSCHDSQNUM"     javaType="EZDSStringItem"/>
        <result property="cashDiscPct_D1"               column="CASHDISCPCT"             javaType="EZDCBigDecimalItem"/>
        <result property="arTrxBalPk_D1"                column="ARTRXBALPK"              javaType="EZDCBigDecimalItem"/>
        <result property="arCashApplyStsCd_D1"          column="ARCASHAPPLYSTSCD"        javaType="EZDSStringItem"/>
        <result property="ezUpTime_D1"                  column="EZUP"                    javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_D1"              column="EZUPTIMEZONE"            javaType="EZDSStringItem"/>
        <result property="acctYrMth_D1"                 column="ACCTYRMTH"               javaType="EZDSDateItem"/>
        <result property="subSysCd_D1"                  column="SUBSYSCD"                javaType="EZDSStringItem"/>
        <result property="onlBatTpCd_D1"                column="ONLBATTPCD"              javaType="EZDSStringItem"/>
        <result property="acctDt_D1"                    column="ACCTDT"                  javaType="EZDSDateItem"/>
        <result property="arTrxDt_D1"                   column="ARTRXDT"                 javaType="EZDCDateItem"/>
        <result property="cashDiscTermCd_D1"            column="CASHDISCTERMCD"          javaType="EZDSStringItem"/>
        <result property="tocCd_D1"                     column="TOCCD"                   javaType="EZDSStringItem"/>
        <result property="coaProdCd_D1"                 column="COAPRODCD"               javaType="EZDSStringItem"/>
        <result property="pmtTermCd_D1"                 column="PMTTERMCD"               javaType="EZDSStringItem"/>
        <result property="pmtTermCashDiscCd_D1"         column="PMTTERMCASHDISCCD"       javaType="EZDSStringItem"/>
        <result property="invPmtMethCd_D1"              column="INV_PMT_METH_CD"         javaType="EZDSStringItem"/>
        <result property="invPmtCondCd_D1"              column="INV_PMT_COND_CD"         javaType="EZDSStringItem"/>
        <result property="arExpPmtMethNm_D1"            column="AR_EXP_PMT_METH_NM"      javaType="EZDSStringItem"/>
        <result property="arExpPmtCondNm_D1"            column="AR_EXP_PMT_COND_NM"      javaType="EZDSStringItem"/>
        <result property="dealCcyCd_D1"                 column="DEAL_CCY_CD"             javaType="EZDSStringItem"/>

        <result property="billToCustAcctCd_D1"          column="BILL_TO_CUST_ACCT_CD"    javaType="EZDSStringItem"/>
        <result property="dsAcctNm_D1"                  column="DS_ACCT_NM"              javaType="EZDSStringItem"/>

    </resultMap>

    <statement id="findAddLineArTrxBalByCustRefNum" parameterClass="Map" resultMap="result.findAddLineArTrxBalByCustRefNum">
     SELECT
             A.AR_TRX_NUM                ARTRXNUM
            ,A.GRP_INV_NUM               GRPINVNUM
            ,A.AR_TRX_TP_CD              ARTRXTPCD
            ,A.CPO_ORD_NUM               CPOORDNUM
            ,A.INV_DUE_DT                INVDUEDT
            ,A.GL_DT                     GLDT
            ,A.CUST_ISS_PO_NUM           CUSTISSPONUM
            ,A.AR_CUST_REF_NUM           ARCUSTREFNUM
            ,A.BILL_TO_CUST_CD           BILLTOCUSTCD
            ,A.SELL_TO_CUST_CD           SELLTOCUSTCD
            ,A.DEAL_ORIG_GRS_AMT         DEALORIGGRSAMT
            ,A.DEAL_APPLY_GRS_AMT        DEALAPPLYGRSAMT
            ,A.DEAL_APPLY_CR_AMT         DEALAPPLYCRAMT
            ,A.DEAL_NET_SLS_AMT          DEALNETSLSAMT
            ,A.DEAL_FRT_AMT              DEALFRTAMT
            ,A.DEAL_TAX_AMT              DEALTAXAMT
            ,A.DEAL_RMNG_BAL_GRS_AMT     DEALRMNGBALGRSAMT
            ,A.DEAL_APPLY_ADJ_AMT        DEALAPPLYADJAMT
            ,A.DEAL_APPLY_ADJ_RSVD_AMT   DEALAPPLYADJRSVDAMT
            ,A.AR_TRX_BAL_PK             ARTRXBALPK
            ,A.AR_CASH_APPLY_STS_CD      ARCASHAPPLYSTSCD
            ,A.EZUPTIME                  EZUP
            ,A.EZUPTIMEZONE              EZUPTIMEZONE
            ,B.DEAL_CASH_DISC_AMT        DEALCASHDISCAMT
            ,B.AR_CASH_DISC_SCHD_SQ_NUM  ARCASHDISCSCHDSQNUM
            ,B.CASH_DISC_PCT             CASHDISCPCT
            ,C.ACCT_YR_MTH               ACCTYRMTH
            ,C.SUB_SYS_CD                SUBSYSCD
            ,C.ONL_BAT_TP_CD             ONLBATTPCD
            ,C.ACCT_DT                   ACCTDT
            ,A.AR_TRX_DT                 ARTRXDT
            ,A.CASH_DISC_TERM_CD         CASHDISCTERMCD
            ,A.TOC_CD                    TOCCD
            ,A.COA_PROD_CD               COAPRODCD
            ,A.PMT_TERM_CD               PMTTERMCD
            ,A.PMT_TERM_CASH_DISC_CD     PMTTERMCASHDISCCD
            ,A.INV_PMT_METH_CD			 INV_PMT_METH_CD
            ,A.INV_PMT_COND_CD			 INV_PMT_COND_CD
            ,D.AR_EXP_PMT_METH_NM        AR_EXP_PMT_METH_NM
            ,E.AR_EXP_PMT_COND_NM        AR_EXP_PMT_COND_NM
            ,A.DEAL_CCY_CD				 DEAL_CCY_CD

            ,A.BILL_TO_CUST_ACCT_CD      BILL_TO_CUST_ACCT_CD
            ,F.DS_ACCT_NM                DS_ACCT_NM

     FROM
             AR_TRX_BAL         A
            ,AR_CASH_DISC_SCHD  B
            ,AR_ACCT_DT         C
            ,AR_EXP_PMT_METH    D
            ,AR_EXP_PMT_COND    E
            ,SELL_TO_CUST       F
     WHERE

                  A.GLBL_CMPY_CD                        =  #glblCmpyCd01#
<!--
             AND  A.BILL_TO_CUST_CD                     =  #billToCustCd#
-->
             AND  A.SELL_TO_CUST_CD                     =  #sellToCustCd#
             AND  A.AR_CUST_REF_NUM                     =  #arCustRefNum01#
             AND  (
                  A.AR_CASH_APPLY_STS_CD                =  #arCashApplyStsCd01#
              OR  A.AR_CASH_APPLY_STS_CD                =  #arCashApplyStsCd02#
                  )
             AND  A.GLBL_CMPY_CD                        =  B.GLBL_CMPY_CD(+)
             AND  A.AR_TRX_BAL_PK                       =  B.AR_TRX_BAL_PK(+)
             AND  A.DEAL_CCY_CD                         =  B.DEAL_CCY_CD(+)
             AND  B.EXTN_CASH_DISC_RNG_FROM_DT(+) &lt;  =  #cashDiscRngFromDt01#
             AND  B.EXTN_CASH_DISC_RNG_THRU_DT(+) &gt;  =  #cashDiscRngThruDt01#
             AND  B.EZCANCELFLAG(+)                     =  '0'
             AND  A.GLBL_CMPY_CD                        =  C.GLBL_CMPY_CD(+)
             AND  C.SUB_SYS_CD(+)                       =  #subSysCd#
             AND  C.ONL_BAT_TP_CD(+)                    =  #onlBatTpCd#
             AND  A.AR_TRX_TP_CD              &lt; &gt; 'RCP'      
             AND  A.EXPT_FLG                            =  #exptFlg#

             AND  A.GLBL_CMPY_CD       =  D.GLBL_CMPY_CD(+)
             AND  A.INV_PMT_METH_CD    =  D.AR_EXP_PMT_METH_CD(+)
             AND  A.GLBL_CMPY_CD       =  E.GLBL_CMPY_CD(+)
             AND  A.INV_PMT_COND_CD    =  E.AR_EXP_PMT_COND_CD(+)

             AND  D.EZCANCELFLAG(+)    =  '0'
             AND  E.EZCANCELFLAG(+)    =  '0'

             AND  A.GLBL_CMPY_CD                        =  F.GLBL_CMPY_CD
             AND  A.BILL_TO_CUST_ACCT_CD                =  F.SELL_TO_CUST_CD
             AND  F.EZCANCELFLAG                        =  '0'

    </statement>
    <resultMap id="result.findAddLineArTrxBalByCustRefNum" class="NFCL2760_DSMsg">
        <result property="arTrxNum_D1"                  column="ARTRXNUM"                javaType="EZDSStringItem"/>
        <result property="grpInvNum_D1"                 column="GRPINVNUM"               javaType="EZDSStringItem"/>
        <result property="arTrxTpCd_D1"                 column="ARTRXTPCD"               javaType="EZDSStringItem"/>
        <result property="cpoOrdNum_D1"                 column="CPOORDNUM"               javaType="EZDSStringItem"/>
        <result property="invDueDt_D1"                  column="INVDUEDT"                javaType="EZDSDateItem"/>
        <result property="glDt_D1"                      column="GLDT"                    javaType="EZDSDateItem"/>
        <result property="custIssPoNum_D1"              column="CUSTISSPONUM"            javaType="EZDSStringItem"/>
        <result property="arCustRefNum_D1"              column="ARCUSTREFNUM"            javaType="EZDSStringItem"/>
        <result property="billToCustCd_D1"              column="BILLTOCUSTCD"            javaType="EZDSStringItem"/>
        <result property="sellToCustCd_D1"              column="SELLTOCUSTCD"            javaType="EZDSStringItem"/>
        <result property="dealOrigGrsAmt_D1"            column="DEALORIGGRSAMT"          javaType="EZDSBigDecimalItem"/>
        <result property="dealApplyGrsAmt_D1"           column="DEALAPPLYGRSAMT"         javaType="EZDSBigDecimalItem"/>
        <result property="dealApplyCrAmt_D1"            column="DEALAPPLYCRAMT"          javaType="EZDSBigDecimalItem"/>
        <result property="dealNetSlsAmt_D1"             column="DEALNETSLSAMT"           javaType="EZDSBigDecimalItem"/>
        <result property="dealFrtAmt_D1"                column="DEALFRTAMT"              javaType="EZDSBigDecimalItem"/>
        <result property="dealTaxAmt_D1"                column="DEALTAXAMT"              javaType="EZDSBigDecimalItem"/>
        <result property="dealRmngBalGrsAmt_D1"         column="DEALRMNGBALGRSAMT"       javaType="EZDSBigDecimalItem"/>
        <result property="dealApplyAdjAmt_D1"           column="DEALAPPLYADJAMT"         javaType="EZDCBigDecimalItem"/>
        <result property="dealApplyAdjRsvdAmt_D1"       column="DEALAPPLYADJRSVDAMT"     javaType="EZDCBigDecimalItem"/>
        <result property="dealCashDiscAmt_D1"           column="DEALCASHDISCAMT"         javaType="EZDCBigDecimalItem"/>
        <result property="arCashDiscSchdSqNum_D1"       column="ARCASHDISCSCHDSQNUM"     javaType="EZDSStringItem"/>
        <result property="cashDiscPct_D1"               column="CASHDISCPCT"             javaType="EZDCBigDecimalItem"/>
        <result property="arTrxBalPk_D1"                column="ARTRXBALPK"              javaType="EZDCBigDecimalItem"/>
        <result property="arCashApplyStsCd_D1"          column="ARCASHAPPLYSTSCD"        javaType="EZDSStringItem"/>
        <result property="ezUpTime_D1"                  column="EZUP"                    javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_D1"              column="EZUPTIMEZONE"            javaType="EZDSStringItem"/>
        <result property="acctYrMth_D1"                 column="ACCTYRMTH"               javaType="EZDSDateItem"/>
        <result property="subSysCd_D1"                  column="SUBSYSCD"                javaType="EZDSStringItem"/>
        <result property="onlBatTpCd_D1"                column="ONLBATTPCD"              javaType="EZDSStringItem"/>
        <result property="acctDt_D1"                    column="ACCTDT"                  javaType="EZDSDateItem"/>
        <result property="arTrxDt_D1"                   column="ARTRXDT"                 javaType="EZDCDateItem"/>
        <result property="cashDiscTermCd_D1"            column="CASHDISCTERMCD"          javaType="EZDSStringItem"/>
        <result property="tocCd_D1"                     column="TOCCD"                   javaType="EZDSStringItem"/>
        <result property="coaProdCd_D1"                 column="COAPRODCD"               javaType="EZDSStringItem"/>
        <result property="pmtTermCd_D1"                 column="PMTTERMCD"               javaType="EZDSStringItem"/>
        <result property="pmtTermCashDiscCd_D1"         column="PMTTERMCASHDISCCD"       javaType="EZDSStringItem"/>
        <result property="invPmtMethCd_D1"              column="INV_PMT_METH_CD"         javaType="EZDSStringItem"/>
        <result property="invPmtCondCd_D1"              column="INV_PMT_COND_CD"         javaType="EZDSStringItem"/>
        <result property="arExpPmtMethNm_D1"            column="AR_EXP_PMT_METH_NM"      javaType="EZDSStringItem"/>
        <result property="arExpPmtCondNm_D1"            column="AR_EXP_PMT_COND_NM"      javaType="EZDSStringItem"/>
        <result property="dealCcyCd_D1"                 column="DEAL_CCY_CD"             javaType="EZDSStringItem"/>

        <result property="billToCustAcctCd_D1"          column="BILL_TO_CUST_ACCT_CD"    javaType="EZDSStringItem"/>
        <result property="dsAcctNm_D1"                  column="DS_ACCT_NM"              javaType="EZDSStringItem"/>

    </resultMap>

    <statement id="getDsAcctNm" parameterClass="Map" resultClass="String">
        SELECT
                ACCT.DS_ACCT_NM
        FROM
                SELL_TO_CUST ACCT
        WHERE
                ACCT.GLBL_CMPY_CD              =   #glblCmpyCd#
            AND ACCT.EZCANCELFLAG              =  '0'
            AND ACCT.SELL_TO_CUST_CD           =   #sellToCustCd#
            AND ROWNUM                     &lt;=   $rowNum$
    </statement>

    <!-- START   2023/07/03 S.Fujita [QC#60397,ADD] -->
    <statement id="getHrTtlNm" parameterClass="Map" resultClass="String">
        SELECT
             HTAL.HR_TTL_NM
        FROM
             HR_TTL_APVL_LIMIT HTAL
            ,S21_CSA_APPS.S21_PSN SP
        WHERE
            <!-- START   2023/08/02 S.Fujita [QC#60397,MOD] -->
                HTAL.GLBL_CMPY_CD        = #glblCmpyCd#
            AND HTAL.GLBL_CMPY_CD        = SP.GLBL_CMPY_CD
            AND HTAL.EZCANCELFLAG        = '0'
            AND SP.EZCANCELFLAG          = '0'
            AND HTAL.APVL_LIMIT_ACTV_FLG = 'Y'
            AND HTAL.AR_ADJ_CATG_CD      = #catgCd#
            AND SP.PSN_CD                = #usrId#
            AND HTAL.HR_TTL_NM           = SP.HR_TTL_NM
            <!-- END   2023/08/02 S.Fujita [QC#60397,MOD] -->
    </statement>

    <statement id="getHrTtlApvlLimitPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
             HTAL.HR_TTL_APVL_LIMIT_PK
        FROM
             HR_TTL_APVL_LIMIT HTAL
        WHERE
            <!-- START   2023/08/02 S.Fujita [QC#60397,MOD] -->
                HTAL.GLBL_CMPY_CD        = #glblCmpyCd#
            AND HTAL.EZCANCELFLAG        = '0'
            AND HTAL.APVL_LIMIT_ACTV_FLG = 'Y'
            AND HTAL.AR_ADJ_CATG_CD      = #catgCd#
            AND HTAL.HR_TTL_NM           = #hrTtlNm#
            <!-- END   2023/08/02 S.Fujita [QC#60397,MOD] -->
    </statement>

    <!-- START   2023/08/02 S.Fujita [QC#60397,DEL] -->
    <!-- <statement id="getAdjAmountAbs" parameterClass="Map" resultClass="BigDecimal"> -->
    <!--     SELECT ABS(#adjAmount#) FROM DUAL -->
    <!-- </statement> -->
    <!-- END   2023/08/02 S.Fujita [QC#60397,DEL] -->
    <!-- END   2023/07/03 S.Fujita [QC#60397,ADD] -->
<statement id="findDownLoadInfoData" parameterClass="Map" resultMap="result.findDownLoadInfoData">
    SELECT
           APP.XX_AR_CASH_APPLY_STS_TXT
          ,APP.ARTRXNUM
          ,APP.GRPINVNUM
          ,APP.ARTRXTPCD
          ,APP.CPOORDNUM
          ,APP.INVDUEDT
          ,APP.GLDT_A1
          ,APP.CUSTISSPONUM
          ,APP.ARCUSTREFNUM
          ,APP.SELLTOCUSTCD
          ,APP.BILLTOCUSTCD
          ,APP.DEALORIGGRSAMT
          ,APP.DEALAPPLYGRSAMT
          ,APP.DEALAPPLYCRAMT
          ,APP.DEALNETSLSAMT
          ,APP.DEALFRTAMT
          ,APP.DEALTAXAMT
          ,APP.DEALRMNGBALGRSAMT
          ,APP.ARTRXDT
          ,APP.CASHDISCTERMCD
          ,APP.TOCCD
          ,APP.COAPRODCD
          ,APP.PMTTERMCD
          ,APP.INV_PMT_METH_CD
          ,APP.INV_PMT_COND_CD
          ,APP.PMTTERMCASHDISCCD
          ,APP.CASH_APP_DT_A1
          ,APP.DEAL_APPLY_AMT
          ,APP.CASHAPPGLDT_A1
          ,APP.DEALCASHDISCAMT_A1
          ,APP.EZINTIME_UP
          ,APP.EZINTIMEZONE_UP
          ,APP.CASHDISCPCT_A1
          ,APP.ARCASHAPPPK_BK
          ,APP.ARCASHAPPSQNUM_UP
          <!-- START 2024/02/20 TZ.Win [QC#63450, ADD] -->
          ,APP.ARCASHAPPSORTNUM_UP
          <!-- END 2024/02/20 TZ.Win [QC#63450, ADD] -->
          ,APP.DEAL_CCY_CD
          ,APP.AR_EXP_PMT_METH_CD
          ,APP.AR_EXP_PMT_COND_CD
          ,APP.AR_EXP_PMT_METH_NM
          ,APP.AR_EXP_PMT_COND_NM
          ,APP.ARADJTPNM
          ,APP.ADJ_CMNT_TXT
          ,APP.DEALAPPLYADJAMT
    FROM
    (
         SELECT
                 CASE
                 WHEN A.AR_SCR_CANC_FLG  =  'N' THEN  'Applied' ELSE 'Cancelled' END  XX_AR_CASH_APPLY_STS_TXT
                ,B.AR_TRX_NUM                 ARTRXNUM
                ,B.GRP_INV_NUM                GRPINVNUM
                ,B.AR_TRX_TP_CD               ARTRXTPCD
                ,B.CPO_ORD_NUM                CPOORDNUM
                ,B.INV_DUE_DT                 INVDUEDT
                ,B.GL_DT                      GLDT_A1
                ,B.CUST_ISS_PO_NUM            CUSTISSPONUM
           <!-- START 2018/07/19 Y.Matsui [QC#26871,MOD] -->
           <!-- START 2018/06/06 Y.Matsui [QC#25956,MOD] -->
           <!-- ,B.AR_CUST_REF_NUM            ARCUSTREFNUM -->
                ,CASE
                     WHEN B.AR_CUST_REF_NUM IS NULL AND B.AR_TRX_TP_CD = #arTrxTpCdAcc# THEN (
                         SELECT
                             ATT.AR_TRX_TP_NM
                         FROM
                             AR_TRX_TP ATT
                         WHERE
                             ATT.GLBL_CMPY_CD = B.GLBL_CMPY_CD
                         AND ATT.AR_TRX_TP_CD = B.AR_TRX_TP_CD
                         AND ATT.EZCANCELFLAG = '0'
                     )
                     ELSE B.AR_CUST_REF_NUM
                 END                          ARCUSTREFNUM
           <!-- END   2018/06/06 Y.Matsui [QC#25956,MOD] -->
           <!-- END   2018/07/19 Y.Matsui [QC#26871,MOD] -->
                ,B.SELL_TO_CUST_CD            SELLTOCUSTCD
                ,B.BILL_TO_CUST_CD            BILLTOCUSTCD
                ,B.DEAL_ORIG_GRS_AMT          DEALORIGGRSAMT
                ,B.DEAL_APPLY_GRS_AMT         DEALAPPLYGRSAMT
                ,B.DEAL_APPLY_CR_AMT          DEALAPPLYCRAMT
                ,B.DEAL_NET_SLS_AMT           DEALNETSLSAMT
                ,B.DEAL_FRT_AMT               DEALFRTAMT
                ,B.DEAL_TAX_AMT               DEALTAXAMT
                ,B.DEAL_RMNG_BAL_GRS_AMT      DEALRMNGBALGRSAMT
                ,B.AR_TRX_DT                  ARTRXDT
                ,B.CASH_DISC_TERM_CD          CASHDISCTERMCD
                ,B.TOC_CD                     TOCCD
                ,B.COA_PROD_CD                COAPRODCD
                ,B.PMT_TERM_CD                PMTTERMCD
                ,B.INV_PMT_METH_CD            INV_PMT_METH_CD
                ,B.INV_PMT_COND_CD            INV_PMT_COND_CD
                ,B.PMT_TERM_CASH_DISC_CD      PMTTERMCASHDISCCD
                ,A.CASH_APP_DT                CASH_APP_DT_A1
                ,A.DEAL_APPLY_AMT             DEAL_APPLY_AMT
                ,A.GL_DT                      CASHAPPGLDT_A1
                ,A.DEAL_APPLY_CASH_DISC_AMT   DEALCASHDISCAMT_A1
                ,A.EZINTIME                   EZINTIME_UP
                ,A.EZINTIMEZONE               EZINTIMEZONE_UP
                ,B.CASH_DISC_PCT              CASHDISCPCT_A1
                ,A.AR_CASH_APP_PK             ARCASHAPPPK_BK
                ,A.AR_CASH_APP_SQ_NUM         ARCASHAPPSQNUM_UP
                <!-- START 2024/02/20 TZ.Win [QC#63450, ADD] -->
                ,A.AR_CASH_APP_SORT_NUM       ARCASHAPPSORTNUM_UP
                <!-- END 2024/02/20 TZ.Win [QC#63450, ADD] -->
                ,B.DEAL_CCY_CD                DEAL_CCY_CD
                ,C.AR_EXP_PMT_METH_CD         AR_EXP_PMT_METH_CD
                ,D.AR_EXP_PMT_COND_CD         AR_EXP_PMT_COND_CD
                ,C.AR_EXP_PMT_METH_NM         AR_EXP_PMT_METH_NM
                ,D.AR_EXP_PMT_COND_NM         AR_EXP_PMT_COND_NM
                ,NULL                         ARADJTPNM
                ,NULL                         ADJ_CMNT_TXT
                ,NULL                         DEALAPPLYADJAMT

         FROM
                 AR_CASH_APP                  A
                ,AR_TRX_BAL                   B
                ,AR_EXP_PMT_METH              C
                ,AR_EXP_PMT_COND              D
                ,(
                    <!-- START 2018/09/04 H.Ikeda [QC#28062,MOD] -->
                    SELECT APP1.GLBL_CMPY_CD, APP1.EZINTIME, APP1.AR_TRX_NUM, APP1.DEAL_APPLY_AMT FROM AR_CASH_APP APP1
                    <!-- END   2018/09/04 H.Ikeda [QC#28062,MOD] -->
                    WHERE
                         APP1.GLBL_CMPY_CD          = #glblCmpyCd#
                         AND APP1.RCPT_NUM          = #rcptNum#
                         AND APP1.AR_TRX_NUM        IS  NOT NULL
                         AND APP1.AR_SCR_CANC_FLG   = #arScrCancFlgN#
                         AND APP1.EZCANCELFLAG      =  '0'
                    UNION ALL
                    <!-- START 2018/09/04 H.Ikeda [QC#28062,MOD] -->
                    SELECT APP2.GLBL_CMPY_CD, MIN(APP2.EZINTIME) AS EZINTIME, APP2.AR_TRX_NUM, APP2.DEAL_APPLY_AMT FROM AR_CASH_APP APP2
                    <!-- END   2018/09/04 H.Ikeda [QC#28062,MOD] -->
                    WHERE
                        APP2.GLBL_CMPY_CD           = #glblCmpyCd#
                        AND APP2.RCPT_NUM           = #rcptNum#
                        AND APP2.AR_TRX_NUM         IS  NOT NULL
                        AND APP2.AR_SCR_CANC_FLG    = #arScrCancFlgY#
                        AND APP2.EZCANCELFLAG       = '0'
                        <!-- START 2018/09/04 H.Ikeda [QC#28062,MOD] -->
                        GROUP BY APP2.GLBL_CMPY_CD, APP2.AR_TRX_NUM, APP2.DEAL_APPLY_AMT
                        <!-- END   2018/09/04 H.Ikeda [QC#28062,MOD] -->
                  ) E

         WHERE
                      A.GLBL_CMPY_CD     =  #glblCmpyCd#
                 AND  A.RCPT_NUM         =  #rcptNum#
                 AND  A.AR_TRX_NUM      IS  NOT NULL
                 AND  A.GLBL_CMPY_CD     =  B.GLBL_CMPY_CD
                 AND  A.AR_TRX_BAL_PK    =  B.AR_TRX_BAL_PK
                 AND  A.GLBL_CMPY_CD     =  E.GLBL_CMPY_CD
                 AND  A.AR_TRX_NUM       =  E.AR_TRX_NUM
                 AND  A.EZINTIME         =  E.EZINTIME
                 <!-- START 2018/09/04 H.Ikeda [QC#28062,ADD] -->
                 AND  A.DEAL_APPLY_AMT   =  E.DEAL_APPLY_AMT
                 <!-- END   2018/09/04 H.Ikeda [QC#28062,ADD] -->

                 AND  B.GLBL_CMPY_CD     =  C.GLBL_CMPY_CD(+)
                 AND  B.INV_PMT_METH_CD  =  C.AR_EXP_PMT_METH_CD(+)
                 AND  B.GLBL_CMPY_CD     =  D.GLBL_CMPY_CD(+)
                 AND  B.INV_PMT_COND_CD  =  D.AR_EXP_PMT_COND_CD(+)
                 AND  A.EZCANCELFLAG     =  '0'
                 AND  B.EZCANCELFLAG     =  '0'
                 AND  C.EZCANCELFLAG(+)  =  '0'
                 AND  D.EZCANCELFLAG(+)  =  '0'
                 
         UNION ALL
         SELECT
                 CASE
                 WHEN F.AR_SCR_CANC_FLG  =  'N' THEN  'Applied' ELSE 'Cancelled' END  XX_AR_CASH_APPLY_STS_TXT
                ,F.AR_TRX_NUM                 ARTRXNUM
                ,NULL                         GRPINVNUM
                ,G.AR_ADJ_TRX_TP_CD           ARTRXTPCD
                ,NULL                         CPOORDNUM
                ,NULL                         INVDUEDT
                ,G.GL_DT                      GLDT_A1
                ,NULL                         CUSTISSPONUM
                ,NULL                         ARCUSTREFNUM
                ,NULL                         SELLTOCUSTCD
                ,NULL                         BILLTOCUSTCD
                ,NULL                         DEALORIGGRSAMT
                ,NULL                         DEALAPPLYGRSAMT
                ,NULL                         DEALAPPLYCRAMT
                ,NULL                         DEALNETSLSAMT
                ,NULL                         DEALFRTAMT
                ,NULL                         DEALTAXAMT
                ,NULL                         DEALRMNGBALGRSAMT
                ,NULL                         ARTRXDT
                ,NULL                         CASHDISCTERMCD
                ,G.TOC_CD                     TOCCD
                ,G.COA_PROD_CD                COAPRODCD
                ,NULL                         PMTTERMCD
                ,NULL                         INV_PMT_METH_CD
                ,NULL                         INV_PMT_COND_CD
                ,NULL                         PMTTERMCASHDISCCD
                ,F.CASH_APP_DT                CASH_APP_DT_A1
                ,F.DEAL_APPLY_AMT             DEAL_APPLY_AMT
                ,F.GL_DT                      CASHAPPGLDT_A1
                ,F.DEAL_APPLY_CASH_DISC_AMT   DEALCASHDISCAMT_A1
                ,F.EZINTIME                   EZINTIME_UP
                ,F.EZINTIMEZONE               EZINTIMEZONE_UP
                ,NULL                         CASHDISCPCT_A1
                ,F.AR_CASH_APP_PK             ARCASHAPPPK_BK
                ,F.AR_CASH_APP_SQ_NUM         ARCASHAPPSQNUM_UP
                <!-- START 2024/02/20 TZ.Win [QC#63450, ADD] -->
                ,F.AR_CASH_APP_SORT_NUM       ARCASHAPPSORTNUM_UP
                <!-- END 2024/02/20 TZ.Win [QC#63450, ADD] -->
                ,G.DEAL_CCY_CD                DEAL_CCY_CD
                ,NULL                         AR_EXP_PMT_METH_CD
                ,NULL                         AR_EXP_PMT_COND_CD
                ,NULL                         AR_EXP_PMT_METH_NM
                ,NULL                         AR_EXP_PMT_COND_NM
                ,ADT.AR_ADJ_TP_NM             ARADJTPNM
                ,G.ADJ_CMNT_TXT               ADJ_CMNT_TXT
                ,G.DEAL_AR_ADJ_AMT            DEALAPPLYADJAMT
         FROM
                  AR_CASH_APP                 F
                 ,AR_ADJ                      G
                 ,(
                     SELECT APP3.GLBL_CMPY_CD, APP3.EZINTIME, APP3.SET_AR_ADJ_NUM FROM AR_CASH_APP APP3
                     WHERE
                         APP3.GLBL_CMPY_CD          = #glblCmpyCd#
                         AND APP3.RCPT_NUM          = #rcptNum#
                         AND APP3.AR_TRX_NUM        IS  NULL
                         AND APP3.AR_SCR_CANC_FLG   =  #arScrCancFlgN#
                         AND APP3.EZCANCELFLAG      =  '0'
                     UNION
                     SELECT APP4.GLBL_CMPY_CD, MIN(APP4.EZINTIME) AS EZINTIME, APP4.SET_AR_ADJ_NUM FROM AR_CASH_APP APP4
                     WHERE
                        APP4.GLBL_CMPY_CD           = #glblCmpyCd#
                        AND APP4.RCPT_NUM           = #rcptNum#
                        AND APP4.AR_TRX_NUM         IS  NULL
                        AND APP4.AR_SCR_CANC_FLG    = #arScrCancFlgY#
                        AND APP4.EZCANCELFLAG       = '0'
                        GROUP BY APP4.SET_AR_ADJ_NUM, APP4.GLBL_CMPY_CD
                 ) H
                 , AR_ADJ_TP                  ADT
       WHERE
             F.GLBL_CMPY_CD                         = #glblCmpyCd#
             AND F.RCPT_NUM                         = #rcptNum#
             AND F.AR_TRX_NUM                       IS  NULL
             AND F.GLBL_CMPY_CD                     = G.GLBL_CMPY_CD
             AND F.AR_ADJ_NUM                       = G.AR_ADJ_NUM
             AND F.GLBL_CMPY_CD                     = H.GLBL_CMPY_CD
             AND F.SET_AR_ADJ_NUM                   = H.SET_AR_ADJ_NUM
             AND F.EZINTIME                         = H.EZINTIME
             AND F.EZCANCELFLAG                     = '0'
             AND G.EZCANCELFLAG                     = '0'
             
             AND G.GLBL_CMPY_CD                     = ADT.GLBL_CMPY_CD(+)
             AND G.AR_ADJ_TP_CD                     = ADT.AR_ADJ_TP_CD(+)
             AND ADT.EZCANCELFLAG(+)                = '0'
    ) APP
    ORDER BY 
          <!-- START 2024/02/20 TZ.Win [QC#63450, ADD] -->
           APP.ARCASHAPPSORTNUM_UP  ASC NULLS FIRST
          <!-- END 2024/02/20 TZ.Win [QC#63450, ADD] -->
          <!-- START 2024/02/20 TZ.Win [QC#63450, MOD] -->
          ,APP.EZINTIME_UP       ASC
          <!-- END 2024/02/20 TZ.Win [QC#63450, MOD] -->
    </statement>
    <resultMap id="result.findDownLoadInfoData" class="NFCL2760_CSMsg">
        <result property="xxArCashApplyStsTxt_C1"           column="XX_AR_CASH_APPLY_STS_TXT"       javaType="EZDCStringItem"/>
        <result property="arTrxTpCd_C1"                     column="ARTRXTPCD"                      javaType="EZDCStringItem"/>
        <result property="xxDtTxt_C2"                       column="ARTRXDT"                        javaType="EZDCDateItem"/>
        <result property="dealRmngBalGrsAmt_C1"             column="DEALRMNGBALGRSAMT"              javaType="EZDCBigDecimalItem"/>
        <result property="dealCashDiscAmt_C1"               column="DEALCASHDISCAMT_A1"             javaType="EZDCStringItem"/>
        <result property="cashDiscPct_C1"                   column="CASHDISCPCT_A1"                 javaType="EZDCBigDecimalItem"/>
        <result property="pmtTermCd_C1"                     column="PMTTERMCD"                      javaType="EZDSStringItem"/>
        <result property="cashDiscTermCd_C1"                column="CASHDISCTERMCD"                 javaType="EZDSStringItem"/>
        <result property="pmtTermCashDiscCd_C1"             column="PMTTERMCASHDISCCD"              javaType="EZDSStringItem"/>
        <result property="invPmtMethCd_C1"                  column="INV_PMT_METH_CD"                javaType="EZDSStringItem"/>
        <result property="invPmtCondCd_C1"                  column="INV_PMT_COND_CD"                javaType="EZDSStringItem"/>
        <result property="arTrxNum_C1"                      column="ARTRXNUM"                       javaType="EZDCStringItem"/>
        <result property="xxDtTxt_C5"                       column="INVDUEDT"                       javaType="EZDCDateItem"/>
        <result property="xxDtTxt_C4"                       column="GLDT_A1"                        javaType="EZDCDateItem"/>
        <result property="arCustRefNum_C1"                  column="ARCUSTREFNUM"                   javaType="EZDCStringItem"/>
        <result property="billToCustCd_C1"                  column="BILLTOCUSTCD"                   javaType="EZDCStringItem"/>
        <result property="sellToCustCd_C1"                  column="SELLTOCUSTCD"                   javaType="EZDCStringItem"/>
        <result property="dealOrigGrsAmt_C1"                column="DEALORIGGRSAMT"                 javaType="EZDCBigDecimalItem"/>
        <result property="dealApplyGrsAmt_C1"               column="DEALAPPLYGRSAMT"                javaType="EZDCBigDecimalItem"/>
        <result property="dealApplyCrAmt_C1"                column="DEALAPPLYCRAMT"                 javaType="EZDCBigDecimalItem"/>
        <result property="dealNetSlsAmt_C1"                 column="DEALNETSLSAMT"                  javaType="EZDCBigDecimalItem"/>
        <result property="dealFrtAmt_C1"                    column="DEALFRTAMT"                     javaType="EZDCBigDecimalItem"/>
        <result property="dealTaxAmt_C1"                    column="DEALTAXAMT"                     javaType="EZDCBigDecimalItem"/>
        <result property="xxDtTxt_C3"                       column="CASHAPPGLDT_A1"                 javaType="EZDCDateItem"/>
        <result property="dealCcyCd_C1"                     column="DEAL_CCY_CD"                    javaType="EZDSStringItem"/>
        <result property="tocCd_C1"                         column="TOCCD"                          javaType="EZDSStringItem"/>
        <result property="coaProdCd_C1"                     column="COAPRODCD"                      javaType="EZDSStringItem"/>
        <result property="xxDealApplyAmtNum_C1"             column="DEAL_APPLY_AMT"                 javaType="EZDCBigDecimalItem"/>
        <result property="arAdjTpNm_C1"                     column="ARADJTPNM"                      javaType="EZDSStringItem"/>
        <result property="grpInvNum_C1"                     column="GRPINVNUM"                      javaType="EZDCStringItem"/>
        <result property="cpoOrdNum_C1"                     column="CPOORDNUM"                      javaType="EZDCStringItem"/>
        <result property="custIssPoNum_C1"                  column="CUSTISSPONUM"                   javaType="EZDCStringItem"/>
        <result property="xxDtTxt_C6"                       column="CASH_APP_DT_A1"                 javaType="EZDCDateItem"/>
        <result property="adjCmntTxt_C1"                    column="ADJ_CMNT_TXT"                   javaType="EZDCStringItem"/>
        <result property="invPmtMethCd_C1"                  column="AR_EXP_PMT_METH_CD"             javaType="EZDCStringItem"/>
        <result property="arExpPmtMethNm_C1"                column="AR_EXP_PMT_METH_NM"             javaType="EZDCStringItem"/>
        <result property="invPmtCondCd_C1"                  column="AR_EXP_PMT_COND_CD"             javaType="EZDCStringItem"/>
        <result property="arExpPmtCondNm_C1"                column="AR_EXP_PMT_COND_NM"             javaType="EZDCStringItem"/>
        <result property="xxScrItem30Txt_C1"                column="AR_EXP_PMT_METH_NM"             javaType="EZDCStringItem"/>
        <result property="xxScrItem30Txt_C2"                column="AR_EXP_PMT_COND_NM"             javaType="EZDCStringItem"/>
        <result property="xxDealApplyAdjAmtNum_C1"          column="DEALAPPLYADJAMT"                javaType="EZDCBigDecimalItem"/>

    </resultMap>

    <!-- 2018/02/13 [QC#20435,ADD] -->
    <statement id="isArCachApp" parameterClass="Map" resultClass="String">
        SELECT
                'Y'
        FROM
                AR_CASH_APP ACA
               ,AR_TRX_BAL  ATB
        WHERE
                ACA.GLBL_CMPY_CD    = #glblCmpyCd#
        AND     ACA.EZCANCELFLAG    = '0'
        AND     ACA.AR_TRX_NUM      = #arTrxNum#
        AND     ACA.AR_SCR_CANC_FLG = 'N'
        AND     ACA.GLBL_CMPY_CD    = ATB.GLBL_CMPY_CD
        AND     ACA.AR_TRX_NUM      = ATB.AR_TRX_NUM
        AND     ATB.EZCANCELFLAG    = '0'
        AND     ATB.AR_TRX_TP_CD    = #onAcct#
<!-- START 2018/10/10 T.Ogura [QC#28167,ADD] -->
        AND     ACA.RCPT_NUM       != #rcptNum#
<!-- END   2018/10/10 T.Ogura [QC#28167,ADD] -->
    </statement>

<!-- START 2018/10/09 T.Ogura [QC#28166,ADD] -->
    <statement id="getApplyingRefundCount" parameterClass="Map" resultClass="BigDecimal">
        SELECT
              COUNT(1)
        FROM
            AR_TRX_BAL ATB
        WHERE
            ATB.GLBL_CMPY_CD     = #glblCmpyCd#
            AND ATB.AR_TRX_NUM   = #arTrxNum#
            AND ATB.AR_TRX_TP_CD IN (#crm#, #acc#)
            AND ATB.EZCANCELFLAG = '0'
            AND EXISTS (
                SELECT
                      1
                FROM
                    AR_RF_RQST ARR
                    , AR_RF_RQST_DTL ARRD
                WHERE
                    ARR.GLBL_CMPY_CD       = ATB.GLBL_CMPY_CD
                    AND ARR.AR_RF_STS_CD   IS NULL
                    AND ARR.EZCANCELFLAG   = '0'
                    AND ARR.GLBL_CMPY_CD   = ARRD.GLBL_CMPY_CD
<!-- START 2018/10/15 T.Ogura [QC#28166-1,MOD] -->
<!--                AND ARR.AR_RF_RQST_PK  = ARRD.AR_RF_RQST_DTL_PK -->
                    AND ARR.AR_RF_RQST_PK  = ARRD.AR_RF_RQST_PK
<!-- END   2018/10/15 T.Ogura [QC#28166-1,MOD] -->
                    AND ARRD.AR_TRX_BAL_PK = ATB.AR_TRX_BAL_PK
                    AND ARRD.EZCANCELFLAG  = '0'
                    <!-- START 2022/05/12 D.Mamaril [QC#59333, ADD] -->
                    AND ARR.AR_DS_WF_STS_CD &lt;&gt; #rejected#
                    <!-- END 2022/05/12 D.Mamaril [QC#59333, ADD] -->
            )
    </statement>
<!-- END   2018/10/09 T.Ogura [QC#28166,ADD] -->

<!-- START 2022/04/22 D.Mamaril [QC#59333,ADD] -->
    <statement id="getRefundDetails" parameterClass="Map" resultClass="BigDecimal">
        SELECT
              ARR.AR_RF_RQST_PK
         FROM
              AR_RF_RQST ARR
             ,AR_RF_RQST_DTL ARRD
             ,AR_TRX_BAL ATB
             ,AR_ADJ ADJ
         WHERE
                 ADJ.AR_ADJ_NUM          = #adjNumber#
             AND ADJ.AR_ADJ_TRX_TP_CD    = #arAdjTrxTpRfd#
             AND ADJ.ORIG_AR_TRX_BAL_PK  = ATB.AR_TRX_BAL_PK
             AND ATB.AR_TRX_TP_CD        IN (#arTrxTpOnAcct#, #arTrxTpRcpt#)
             AND ATB.AR_TRX_NUM          = ARRD.AR_TRX_NUM
             AND ARRD.AR_RF_RQST_PK      = ARR.AR_RF_RQST_PK
             AND ARR.AR_DS_WF_STS_CD     = #arDsWfStsApproved#
             AND ARR.AR_RF_STS_CD        = #arRfStsCreated#
             AND ADJ.GLBL_CMPY_CD        = #glblCmpyCd#
             AND ARR.GLBL_CMPY_CD        = ADJ.GLBL_CMPY_CD
             AND ARRD.GLBL_CMPY_CD       = ADJ.GLBL_CMPY_CD
             AND ATB.GLBL_CMPY_CD        = ADJ.GLBL_CMPY_CD
             AND ADJ.EZCANCELFLAG        = '0'
             AND ARR.EZCANCELFLAG        = '0'
             AND ARRD.EZCANCELFLAG       = '0'
             AND ATB.EZCANCELFLAG        = '0'
    </statement>
<!-- END 2022/04/22 D.Mamaril [QC#59333,ADD] -->
</sqlMap>
