<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NLAB090001">

    <statement id="findRws" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
            RH.RWS_REF_NUM
            ,RH.WH_IN_ETA_DT
            ,TL.TPL_LOC_NM
            ,(
                SELECT SUM(D.RWS_QTY) CNT
                FROM RWS_DTL D
                WHERE
                    D.GLBL_CMPY_CD=RH.GLBL_CMPY_CD
                AND D.RWS_NUM=RH.RWS_NUM
                AND D.EZCANCELFLAG='0'
            ) ORIG_ORD_QTY
            ,RH.GLBL_CMPY_CD
            ,RH.WH_CD
            ,CCC.S80_CMPY_CD
            ,RH.FROM_LOC_CD
            ,SOT.S80_ORD_TP_CD
            ,SOT.S80_TRX_CD
            ,RH.IMPT_INV_VESL_NM
            ,RH.IMPT_INV_BOL_NUM
            ,RH.RWS_NUM
            ,RH.SVC_CONFIG_MSTR_PK
            ,(
                SELECT
                    CASE
                        WHEN CNT<=0 THEN '1'
                        ELSE '2'
                    END
                FROM (
                    SELECT COUNT(*) CNT
                    FROM WMS_INBD_PO_HDR H
                    WHERE
                        H.GLBL_CMPY_CD=RH.GLBL_CMPY_CD
                    AND H.WMS_PO_ID=RH.RWS_REF_NUM
                    AND H.EZCANCELFLAG='0'
                )
            ) STAGE_ACT_CD
            ,RH.FROM_LOC_NM_01
            ,RH.FROM_LOC_NM_02
            ,RH.FROM_LOC_ADDR_01
            ,RH.FROM_LOC_ADDR_02
            ,RH.FROM_LOC_ADDR_03
            ,RH.FROM_LOC_ADDR_04
            ,RH.FROM_LOC_CTY_ADDR
            ,RH.FROM_LOC_ST_CD
            ,RH.FROM_LOC_POST_CD
            ,RH.FROM_LOC_CTRY_CD
            ,RH.FROM_LOC_PSN_NM
            ,RH.FROM_LOC_TEL_NUM
            ,DECODE(RH.RWS_CARR_CD, #otherVndCd#, #otherVndNm#, V.LOC_NM) AS LOC_NM
        FROM
            RWS_HDR            RH
           ,RWS_STS            RS
           ,RTL_WH             RW
           ,TPL_LOC            TL
           ,CMPY_CD_CONV       CCC
           ,SCE_ORD_TP         SOT
           ,VND        V
        WHERE
            RH.GLBL_CMPY_CD         = 'ADB'
        AND RH.WMS_DROP_STS_CD      = '0'
        AND RH.GLBL_CMPY_CD         = RS.GLBL_CMPY_CD
        AND RH.RWS_STS_CD           = RS.RWS_STS_CD
        AND (RS.RWS_OPEN_FLG = 'Y' OR RS.RCV_FLG = 'Y')
        AND RS.EZCANCELFLAG         = '0'
        AND RH.GLBL_CMPY_CD         = RW.GLBL_CMPY_CD
        AND RH.WH_CD                = RW.RTL_WH_CD
        AND RW.WH_OWNR_CD           = 'MNX'
        AND RH.GLBL_CMPY_CD         = TL.GLBL_CMPY_CD(+)
        AND RH.WH_CD                = TL.TPL_LOC_CD(+)
        AND RH.GLBL_CMPY_CD         = CCC.GLBL_CMPY_CD(+)
        AND RH.GLBL_CMPY_CD         = SOT.GLBL_CMPY_CD(+)
        AND RH.SCE_ORD_TP_CD        = SOT.SCE_ORD_TP_CD(+)
        AND SOT.INBD_OTBD_CD(+)     = '1'
        AND V.GLBL_CMPY_CD(+)       = RH.GLBL_CMPY_CD
        AND V.VND_CD(+)             = RH.RWS_CARR_CD
        AND V.EZCANCELFLAG(+)       = '0'
        AND RH.EZCANCELFLAG         = '0'
        AND RW.EZCANCELFLAG         = '0'
        AND TL.EZCANCELFLAG(+)      = '0'
        AND CCC.EZCANCELFLAG(+)     = '0'
        AND SOT.EZCANCELFLAG(+)     = '0'
        ORDER BY
            RH.GLBL_CMPY_CD
            ,RH.RWS_NUM
    ]]>
    </statement>
 
    <statement id="getRwsDetail" parameterClass="Map" resultClass="Map">
    <![CDATA[
        SELECT
            --[NLAI2020_02]
            RD.RWS_QTY
            ,RD.MDSE_CD
            --[WMS_INBD_PO_DTL]
            ,RD.RWS_DTL_LINE_NUM
            --,RD.MDSE_CD
            ,SSC.S80_STK_STS_CD
            --,RD.RWS_QTY
            ,RD.WH_IN_ETA_DT
            ,RD.IMPT_INV_NUM
            ,RD.IMPT_INV_DO_NUM
            ,RD.OUT_PACK_FROM_CSE_NUM
            ,RD.OUT_PACK_TO_CSE_NUM
            --,RH.WH_CD
            ,RD.RTL_SWH_CD
            ,RD.THIRD_PTY_DSP_TP_CD
            ,RD.SER_APVL_REQ_FLG
        FROM
            RWS_DTL            RD
           ,RWS_STS            RS
           ,STK_STS_CONV       SSC
        WHERE
            RD.GLBL_CMPY_CD         = #GLBL_CMPY_CD#
        AND RD.RWS_NUM              = #RWS_NUM#
        AND RD.GLBL_CMPY_CD         = RS.GLBL_CMPY_CD
        AND RD.RWS_STS_CD           = RS.RWS_STS_CD
        AND (RS.RWS_OPEN_FLG = #flgY# OR RS.RCV_FLG = #flgY#)
        AND RS.EZCANCELFLAG         = '0'
        AND RD.GLBL_CMPY_CD         = SSC.GLBL_CMPY_CD(+)
        AND RD.INVTY_STK_STS_CD     = SSC.STK_STS_CD(+)
        ORDER BY
            RD.GLBL_CMPY_CD
            ,RD.RWS_NUM
            ,RD.RWS_DTL_LINE_NUM
    ]]>
    </statement>
    
    <statement id="isExistsWmsMdse" parameterClass="Map" resultClass = "BigDecimal">
        SELECT
             COUNT(RWSD.MDSE_CD)    MDSE_CNT
        FROM
             RWS_DTL      RWSD
        WHERE
             RWSD.GLBL_CMPY_CD      = #glblCmpyCd#
         AND RWSD.RWS_NUM           = #rwsNum#
         AND RWSD.EZCANCELFLAG      = '0'
         AND NOT EXISTS (
             SELECT
                 MDSE.WMS_MDSE_CD
             FROM
                 WMS_MDSE_LIST MDSE
             WHERE
                 MDSE.GLBL_CMPY_CD = RWSD.GLBL_CMPY_CD
             AND MDSE.WMS_MDSE_CD  = RWSD.MDSE_CD
             AND MDSE.WH_CD        = 'MNX'
             AND MDSE.EZCANCELFLAG = '0' )
    </statement>

	<statement id="getNewItem" parameterClass="Map">
         SELECT
              RWSD.MDSE_CD                 AS WML_MDSE_CD
             , M.MDSE_CD                   AS M_MDSE_CD
             , M.UPC_CD
             , M.MDSE_NM
             , M.VND_CD
             , M.FRT_CLS_CD                AS M_FRT_CLS_CD
             , M.SHPG_SER_TAKE_FLG
             , M.THIS_MTH_TOT_STD_COST_AMT
             , M.NEXT_MTH_TOT_STD_COST_AMT
             , M.SCD_PROD_CTRL_CD
             , M.THIRD_PROD_CTRL_CD
             , M.FRTH_PROD_CTRL_CD
             , M.FIFTH_PROD_CTRL_CD
             , M.COA_PROD_CD
             , M.ORIG_CTRY_CD
             , M.INVTY_CTRL_FLG
             , M.MDSE_FML_NM
             , M.INTG_PROD_CATG_CD         AS M_INTG_PROD_CATG_CD
             , M.TRF_CD
             , M.EZUPTIME                  AS WML_EZUPTIME
             , M.MDSE_ITEM_ACTV_DT
             , IPC.INTG_PROD_CATG_CD       AS IPC_INTG_PROD_CATG_CD
             , IPC.INTG_PROD_CATG_NM
             , FC.FRT_CLS_CD               AS FC_FRT_CLS_CD
             , FC.NMFC_CLS_NUM
             , FC.NMFC_ITEM_NUM
             , FC.NMFC_ITEM_SUB_NUM
             , FC.NMFC_ITEM_DESC_TXT
             , NULL                        AS MSI_MDSE_CD
             , NULL                        AS CRTN_PER_LAYER_QTY
             , NULL                        AS CRTN_TIER_PER_PLT_QTY
             , M.MDSE_CD                   AS MI_MDSE_CD
             , 'N'                         AS BAT_NUM_CTRL_FLG
             , MSFI.HAZ_MAT_FLG
             , MSFI.HAZ_MAT_CD
             , HM.HAZ_CLS_NM
             , HM.HAZ_ID_NUM               AS SFTY_HAZ_ID_NUM
             , 'N'                         AS LOT_CTRL_FLG
             , #wmsWhCd#                   AS WML_WH_CD
             <!-- 
             #wmsItemDnldIntfcId#        AS WMS_ITEM_DNLD_INTFC_ID
             , #wmsDescShortNm#          AS WMS_DESC_SHORT_NM
             -->
             ,AAC.ABC_ANLS_CLS_TAG_CD
             ,AAC.CYCLE_CNT_FREQ_DAYS_AOT
       FROM
              RWS_DTL          RWSD
             , MDSE             M
             , INTG_PROD_CATG   IPC
             , FRT_CLS          FC
             , MDSE_SFTY_INFO   MSFI
             , HAZ_MAT          HM
             ,ABC_ANLS_RSLT     AAR
             ,ABC_ANLS_CLS      AAC
       WHERE
            RWSD.GLBL_CMPY_CD      = #glblCmpyCd#
        AND RWSD.RWS_NUM           = #rwsNum#
        AND NOT EXISTS (
            SELECT
                MDSE.WMS_MDSE_CD
            FROM
                WMS_MDSE_LIST MDSE
            WHERE
                MDSE.GLBL_CMPY_CD = RWSD.GLBL_CMPY_CD
            AND MDSE.WMS_MDSE_CD  = RWSD.MDSE_CD
            AND MDSE.WH_CD        = 'MNX'
            AND MDSE.EZCANCELFLAG = '0')
        AND RWSD.GLBL_CMPY_CD        = M.GLBL_CMPY_CD (+)
        AND RWSD.MDSE_CD             = M.MDSE_CD (+)
        AND M.GLBL_CMPY_CD           = IPC.GLBL_CMPY_CD (+)
        AND M.INTG_PROD_CATG_CD      = IPC.INTG_PROD_CATG_CD (+)
        AND M.GLBL_CMPY_CD           = FC.GLBL_CMPY_CD (+)
        AND M.FRT_CLS_CD             = FC.FRT_CLS_CD (+)
        AND M.GLBL_CMPY_CD           = MSFI.GLBL_CMPY_CD (+)
        AND M.MDSE_CD                = MSFI.MDSE_CD (+)
        AND MSFI.GLBL_CMPY_CD        = HM.GLBL_CMPY_CD (+)
        AND MSFI.HAZ_MAT_CD          = HM.HAZ_MAT_CD (+)
        AND RWSD.GLBL_CMPY_CD        = AAR.GLBL_CMPY_CD(+)
        AND RWSD.RTL_WH_CD           = AAR.RTL_WH_CD(+)
        AND RWSD.MDSE_CD             = AAR.MDSE_CD(+)
        AND AAR.ABC_ANLS_LTST_FLG(+) = 'Y'
        AND AAR.GLBL_CMPY_CD         = AAC.GLBL_CMPY_CD(+)
        AND AAR.ABC_ANLS_CLS_NUM     = AAC.ABC_ANLS_CLS_NUM(+)
        AND AAR.ABC_ANLS_CLS_TAG_CD  = AAC.ABC_ANLS_CLS_TAG_CD(+)
        AND RWSD.EZCANCELFLAG        = '0'
        AND M.EZCANCELFLAG (+)       = '0'
        AND IPC.EZCANCELFLAG (+)     = '0'
        AND FC.EZCANCELFLAG (+)      = '0'
        AND MSFI.EZCANCELFLAG (+)    = '0'
        AND HM.EZCANCELFLAG (+)      = '0'
        AND AAR.EZCANCELFLAG(+)      = '0'
        AND AAC.EZCANCELFLAG(+)      = '0'
    </statement>
    <statement id="getIfDataNlai2410" parameterClass="Map" resultClass="Map">
        SELECT
            H.TPL_LOC_TXT
           ,TO_CHAR(TO_DATE(SUBSTR(REQ_DT_TM_TS_TXT, 9, 4), 'HH24MI'), 'HH24:MI') AS REQ_DT_TM_TS_TXT
           ,H.RQST_SHIP_DT_TM_TS_TXT
           ,H.ORD_ID_TXT
           <!-- START 2021/01/26 A.Marte [QC#58281,ADD] -->
           ,H.SEGMENT_ID
           <!-- START 2021/01/26 A.Marte [QC#58281,ADD] -->
           ,D.QTY_ORD_TXT
           ,D.ITEM_CD_TXT
           ,D.IMPT_INV_BOL_NUM
           ,D.CARR_NM
        FROM
            NLAI2410_01 H
           ,NLAI2410_02 D
        WHERE
            H.INTERFACE_ID          = #INTERFACE_ID#
        AND H.TRANSACTION_ID        = #TRANSACTION_ID#
        AND H.TRANSACTION_ID        = D.TRANSACTION_ID
        AND H.SEGMENT_ID            = D.SEGMENT_ID
        AND H.UNIT_ID               = D.UNIT_ID
        AND H.TPL_LOC_TXT           IS NOT NULL
        AND H.EZCANCELFLAG          = '0'
        AND D.EZCANCELFLAG          = '0'
        ORDER BY
            H.ORD_ID_TXT, H.TPL_LOC_TXT
    </statement>
    
    <statement id="getIfDataNlai2430" parameterClass="Map" resultClass="Map">
        SELECT
             H.MDSE_CD
            ,H.MDSE_ITEM_ACTV_DT_TXT
            ,H.MDSE_NM
            ,H.SER_TAKE_FLG
            ,H.IN_POUND_WT
            ,H.WT_UOM_CD
            ,H.IN_INCH_LG
            ,H.IN_INCH_WDT
            ,H.IN_INCH_HGT
            ,H.DIMS_UOM_CD
            ,H.RQST_TOT_STD_COST_AMT
            ,H.MDSE_EXPR_FLG
            ,H.HAZ_MAT_FLG
            <!-- START 2023/03/23 T.Kuroda [QC#61204, ADD] -->
            ,H.HAZ_CLS_NM
            <!-- END   2023/03/23 T.Kuroda [QC#61204, ADD] -->
            ,H.TRF_CD
            ,H.MADE_IN_CTRY_CD
            <!-- START 2021/01/26 A.Marte [QC#58281,ADD] -->
            ,H.SEGMENT_ID
            <!-- END 2021/01/26 A.Marte [QC#58281,ADD] -->
            ,D.ALT_PRT_LT_TXT
        FROM
            NLAI2430_01 H
           ,NLAI2430_02 D
        WHERE
            H.INTERFACE_ID          = #INTERFACE_ID#
        AND H.TRANSACTION_ID        = #TRANSACTION_ID#
        AND H.TRANSACTION_ID        = D.TRANSACTION_ID(+)
        AND H.SEGMENT_ID            = D.SEGMENT_ID(+)
        AND H.UNIT_ID               = D.UNIT_ID(+)
        AND H.MDSE_CD               = D.MDSE_CD(+)
        AND H.EZCANCELFLAG          = '0'
        AND D.EZCANCELFLAG(+)       = '0'
    </statement>

    <statement id="getMnxErrCond" parameterClass="Map" resultClass="Map">
        SELECT
            DCC.DS_COND_CONST_VAL_TXT_01   AS ML_TP
           ,DCC.DS_COND_CONST_VAL_TXT_02   AS FL_ABEND
        FROM
            DS_COND_CONST   DCC
        WHERE
            DCC.GLBL_CMPY_CD                = #GLBL_CMPY_CD#
        AND DCC.DS_COND_CONST_GRP_ID        = #DS_COND_CONST_GRP_ID#
        AND DCC.DS_COND_CONST_CD            = #DS_COND_CONST_CD#
        AND DCC.EZCANCELFLAG                = '0'
    </statement>

</sqlMap>
