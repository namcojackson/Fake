<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<sqlMap namespace="NSZC065001">

    <statement id="getContractInfo" parameterClass="Map" resultClass="Map">
        SELECT
                 DC.DS_CONTR_PK      AS DS_CONTR_PK
                ,DCD.DS_CONTR_DTL_PK AS DS_CONTR_DTL_PK
                ,DCDT.BASE_CHRG_FLG  AS BASE_CHRG_FLG
                ,DCDT.USG_CHRG_FLG   AS USG_CHRG_FLG
<!-- START 2018/08/16 M.Naito [QC#27249, ADD] -->
                ,DCD.SVC_PGM_MDSE_CD AS SVC_PGM_MDSE_CD
<!-- END 2018/08/16 M.Naito [QC#27249, ADD] -->
        FROM
                 DS_CONTR_DTL    DCD
                ,DS_CONTR_DTL_TP DCDT
                ,DS_CONTR        DC
        WHERE
                DCD.GLBL_CMPY_CD             = #glblCmpyCd#
            AND DCD.SVC_MACH_MSTR_PK         = #svcMachMdtrPk#
            AND DCD.CONTR_EFF_FROM_DT        &lt;= #cpoOrdTsYYYYMMDD#
            AND DCD.CONTR_EFF_THRU_DT        &gt;= #cpoOrdTsYYYYMMDD#
            AND DCD.GLBL_CMPY_CD             = DCDT.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_TP_CD       = DCDT.DS_CONTR_DTL_TP_CD
            AND DCD.GLBL_CMPY_CD             = DC.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK              = DC.DS_CONTR_PK
            AND DC.CONTR_VRSN_EFF_FROM_DT    &lt;= #cpoOrdTsYYYYMMDD#
            AND DC.CONTR_VRSN_EFF_THRU_DT    &gt;= #cpoOrdTsYYYYMMDD#
            AND DC.DS_CONTR_CATG_CD          &lt;&gt; #dsContrCatgWty#
            AND DCD.EZCANCELFLAG             = '0'
            AND DCDT.EZCANCELFLAG            = '0'
            AND DC.EZCANCELFLAG              = '0'
    </statement>
    <statement id="getPriceEffectiveBase" parameterClass="Map" resultClass="Map">
        SELECT
                 DCPEV.ETTL_AVAL_FLG        AS ETTL_AVAL_FLG
                ,DCPEV.DS_CONTR_CTRL_STS_CD AS DS_CONTR_CTRL_STS_CD
        FROM
                 DS_CONTR_PRC_EFF       DCPE
                ,DS_CONTR_PRC_EFF_STS_V DCPEV
        WHERE
                DCPE.GLBL_CMPY_CD             = #glblCmpyCd#
            AND DCPE.DS_CONTR_DTL_PK          = #dsContrDtlPk#
            AND DCPE.CONTR_PRC_EFF_FROM_DT    &lt;= #cpoOrdTsYYYYMMDD#
            AND DCPE.CONTR_PRC_EFF_THRU_DT    &gt;= #cpoOrdTsYYYYMMDD#
            AND DCPE.BASE_CHRG_FLG            = 'Y'
            AND DCPE.GLBL_CMPY_CD             = DCPEV.GLBL_CMPY_CD
            AND DCPE.DS_CONTR_PRC_EFF_PK      = DCPEV.DS_CONTR_PRC_EFF_PK
            AND DCPE.EZCANCELFLAG             = '0'
            AND DCPEV.EZCANCELFLAG            = '0'
    </statement>
    <statement id="getMeter" parameterClass="Map" resultClass="Map">
        SELECT
                 DCBMV.ETTL_AVAL_FLG        AS ETTL_AVAL_FLG
                ,DCBMV.DS_CONTR_CTRL_STS_CD AS DS_CONTR_CTRL_STS_CD
        FROM
                 DS_CONTR_BLLG_MTR       DCBM
                ,DS_CONTR_BLLG_MTR_STS_V DCBMV
        WHERE
                DCBM.GLBL_CMPY_CD             = #glblCmpyCd#
            AND DCBM.DS_CONTR_DTL_PK          = #dsContrDtlPk#
            AND DCBM.GLBL_CMPY_CD             = DCBMV.GLBL_CMPY_CD
            AND DCBM.DS_CONTR_BLLG_MTR_PK     = DCBMV.DS_CONTR_BLLG_MTR_PK
            AND DCBM.EZCANCELFLAG             = '0'
            AND DCBMV.EZCANCELFLAG            = '0'
    </statement>
    <statement id="getPriceEffectiveUsage" parameterClass="Map" resultClass="Map">
        SELECT
                 DCPEV.ETTL_AVAL_FLG        AS ETTL_AVAL_FLG
                ,DCPEV.DS_CONTR_CTRL_STS_CD AS DS_CONTR_CTRL_STS_CD
        FROM
                 DS_CONTR_BLLG_MTR      DCBM
                ,DS_CONTR_PRC_EFF       DCPE
                ,DS_CONTR_PRC_EFF_STS_V DCPEV
        WHERE
                DCBM.GLBL_CMPY_CD             = #glblCmpyCd#
            AND DCBM.DS_CONTR_DTL_PK          = #dsContrDtlPk#
            AND DCBM.GLBL_CMPY_CD             = DCPE.GLBL_CMPY_CD
            AND DCBM.DS_CONTR_DTL_PK          = DCPE.DS_CONTR_DTL_PK
            AND DCBM.DS_CONTR_BLLG_MTR_PK     = DCPE.DS_CONTR_BLLG_MTR_PK
            AND DCPE.CONTR_PRC_EFF_FROM_DT    &lt;= #cpoOrdTsYYYYMMDD#
            AND DCPE.CONTR_PRC_EFF_THRU_DT    &gt;= #cpoOrdTsYYYYMMDD#
            AND DCPE.USG_CHRG_FLG             = 'Y'
            AND DCPE.GLBL_CMPY_CD             = DCPEV.GLBL_CMPY_CD
            AND DCPE.DS_CONTR_PRC_EFF_PK      = DCPEV.DS_CONTR_PRC_EFF_PK
            AND DCBM.EZCANCELFLAG             = '0'
            AND DCPE.EZCANCELFLAG             = '0'
            AND DCPEV.EZCANCELFLAG            = '0'
    </statement>
<!-- START 2016/09/28 A.Kohinata [QC#12898, ADD] -->
    <statement id="getFleetContractInfo" parameterClass="Map" resultClass="Map">
        SELECT
             DC.DS_CONTR_PK      AS DS_CONTR_PK
            ,DCD.DS_CONTR_DTL_PK AS DS_CONTR_DTL_PK
            ,DCDT.BASE_CHRG_FLG  AS BASE_CHRG_FLG
            ,DCDT.USG_CHRG_FLG   AS USG_CHRG_FLG
<!-- START 2018/08/16 M.Naito [QC#27249, ADD] -->
            ,DCD.SVC_PGM_MDSE_CD AS SVC_PGM_MDSE_CD
<!-- END 2018/08/16 M.Naito [QC#27249, ADD] -->
        FROM
             DS_CONTR        DC
            ,DS_CONTR_DTL    DCD
            ,DS_CONTR_DTL_TP DCDT
        WHERE
                DC.GLBL_CMPY_CD               = #glblCmpyCd#
            AND DC.DS_CONTR_NUM               = #dsContrNum#
            AND DC.CONTR_VRSN_EFF_FROM_DT &lt;= #cpoOrdTsYYYYMMDD#
            AND DC.CONTR_VRSN_EFF_THRU_DT &gt;= #cpoOrdTsYYYYMMDD#
            AND DC.EZCANCELFLAG               = '0'
            AND DC.GLBL_CMPY_CD               = DCD.GLBL_CMPY_CD
            AND DC.DS_CONTR_PK                = DCD.DS_CONTR_PK
            AND DCD.DS_CONTR_DTL_TP_CD        = #dsContrDtlTpCd#
            AND DCD.CONTR_EFF_FROM_DT     &lt;= #cpoOrdTsYYYYMMDD#
            AND DCD.CONTR_EFF_THRU_DT     &gt;= #cpoOrdTsYYYYMMDD#
            AND DCD.EZCANCELFLAG              = '0'
            AND DCD.GLBL_CMPY_CD              = DCDT.GLBL_CMPY_CD
            AND DCD.DS_CONTR_DTL_TP_CD        = DCDT.DS_CONTR_DTL_TP_CD
            AND DCDT.EZCANCELFLAG             = '0'
    </statement>
<!-- END 2016/09/28 A.Kohinata [QC#12898, ADD] -->
</sqlMap>
