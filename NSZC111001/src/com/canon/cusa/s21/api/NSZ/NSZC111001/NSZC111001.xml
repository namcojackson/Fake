<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NSZC111001">
    <statement id="srchContrBillWithEquip" parameterClass="Map" resultClass="Map">
        SELECT
            DC.DS_CONTR_PK                AS  DS_CONTR_PK
           ,DC.DS_CONTR_NUM               AS  DS_CONTR_NUM
           ,DC.DS_CONTR_SQ_NUM            AS  DS_CONTR_SQ_NUM
           ,DC.DS_CONTR_CATG_CD           AS  DS_CONTR_CATG_CD
           ,DCD.DS_CONTR_DTL_PK           AS  DS_CONTR_DTL_PK
           ,DCD.SVC_MACH_MSTR_PK          AS  SVC_MACH_MSTR_PK
           ,DCD.CONTR_EFF_FROM_DT         AS  CONTR_EFF_FROM_DT
           ,DCD.CONTR_EFF_THRU_DT         AS  CONTR_EFF_THRU_DT
        FROM
            DS_CONTR_DTL                      DCD
           ,DS_CONTR                          DC
        WHERE
                DCD.GLBL_CMPY_CD             =      #glblCmpyCd#
            AND DCD.CPO_ORD_NUM              =      #cpoOrdNum#
            <isNotNull property="cpoDtlLineNum">
            AND DCD.CPO_DTL_LINE_NUM         =      #cpoDtlLineNum#
            </isNotNull>
            <isNotNull property="cpoDtlLineSubNum">
            AND DCD.CPO_DTL_LINE_SUB_NUM     =      #cpoDtlLineSubNum#
            </isNotNull>
            <iterate property="stsCdList" var="contrStsCd[]" open="AND DCD.DS_CONTR_DTL_STS_CD      NOT IN (" conjunction= "," close=")">
                #contrStsCd[]#
            </iterate>
            AND DCD.BILL_WITH_EQUIP_FLG      =      #billWithEquipFlg#
            AND DCD.BILL_WITH_EQUIP_INVD_FLG =      #billWithEquipInvdFlg#
            AND DCD.EZCANCELFLAG             =      '0'
            AND DCD.GLBL_CMPY_CD             =      DC.GLBL_CMPY_CD
            AND DCD.DS_CONTR_PK              =      DC.DS_CONTR_PK
            AND DC.EZCANCELFLAG              =      '0'
            AND EXISTS (
                SELECT
                    *
                FROM
                    SVC_MACH_MSTR SMM
                WHERE
                        SMM.GLBL_CMPY_CD     =      DCD.GLBL_CMPY_CD
                    AND SMM.SVC_MACH_MSTR_PK =      DCD.SVC_MACH_MSTR_PK
                    AND SMM.EZCANCELFLAG     =      '0'
                )
        ORDER BY
            DCD.CONTR_EFF_THRU_DT
           ,DCD.DS_CONTR_DTL_PK
    </statement>

    <statement id="srchContrAscc" parameterClass="Map" resultClass="Map">
        SELECT
            DC.DS_CONTR_PK                AS  DS_CONTR_PK
           ,DC.DS_CONTR_NUM               AS  DS_CONTR_NUM
           ,DC.DS_CONTR_SQ_NUM            AS  DS_CONTR_SQ_NUM
           ,DC.DS_CONTR_CATG_CD           AS  DS_CONTR_CATG_CD
           ,DCD.DS_CONTR_DTL_PK           AS  DS_CONTR_DTL_PK
           ,DCD.SVC_MACH_MSTR_PK          AS  SVC_MACH_MSTR_PK
           ,DCD.CONTR_EFF_FROM_DT         AS  CONTR_EFF_FROM_DT
           ,DCD.CONTR_EFF_THRU_DT         AS  CONTR_EFF_THRU_DT
        FROM
            DS_CONTR                          DC
           ,DS_CONTR_DTL                      DCD
        WHERE
                DCD.GLBL_CMPY_CD                                 = #glblCmpyCd#
            AND DCD.GLBL_CMPY_CD                                 = DC.GLBL_CMPY_CD
            AND DCD.EZCANCELFLAG                                 = '0'
            AND DC.EZCANCELFLAG                                  = '0'
            AND DC.DS_CONTR_PK                                   = DCD.DS_CONTR_PK
            AND DCD.SVC_MACH_MSTR_PK                             = #svcMachMstrPk#
            AND DCD.CONTR_EFF_FROM_DT                        &lt;= #contrBaseDt#
            AND NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT) &gt;= #contrBaseDt#
            <iterate property="stsCdList" var="contrStsCd[]" open="AND DCD.DS_CONTR_DTL_STS_CD NOT IN (" conjunction= "," close=")">
                #contrStsCd[]#
            </iterate>
        ORDER BY
            DCD.CONTR_EFF_THRU_DT
           ,DCD.DS_CONTR_DTL_PK
    </statement>
</sqlMap>
