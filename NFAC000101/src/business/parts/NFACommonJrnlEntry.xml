<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NFACommonJrnlEntry">

<!-- #################### Type Alias #################### -->
<typeAlias alias="RtlWhAcct"    type="business.parts.RtlWhAcct"/>
<typeAlias alias="MdseTpAcct"    type="business.parts.MdseTpAcct"/>

<!-- #################### Statement #################### -->

   	<statement id="getAjeIntfcCtrlListNotJrnlized" parameterClass="Map" resultClass="Map">
        SELECT AIC.GLBL_CMPY_CD     AS GLBL_CMPY_CD,           
               AIC.AJE_INTFC_TP_CD  AS AJE_INTFC_TP_CD,        
               AIC.AJE_INTFC_PK     AS AJE_INTFC_PK      
          FROM AJE_INTFC_CTRL AIC
         WHERE AIC.EZCANCELFLAG    = '0'
           AND AIC.GLBL_CMPY_CD    = #glblCmpyCd#
           AND AIC.AJE_INTFC_TP_CD = #ajeIntfcTpCd#
           AND AIC.JRNL_CPLT_FLG   = #jrnlCpltFlg#
         ORDER BY AIC.AJE_INTFC_PK
    </statement>

   	<statement id="getAjePtrn" parameterClass="Map" resultClass="Map">
   	    SELECT W1.*,
   	           SS.SYS_SRC_CD                             AS JRNL_SRC_CD,
               SUBSTR(SS.SYS_SRC_NM,1, #jrnlSrcNmLen#)   AS JRNL_SRC_NM
          FROM
        (SELECT APD.GLBL_CMPY_CD,
               APD.AJE_ID,
               APD.SYS_SRC_CD,
               APD.SYS_SRC_NM,
               APD.TRX_CD,
               APD.TRX_NM,
               APD.TRX_RSN_CD,
               APD.TRX_RSN_NM,
               APD.AJE_PTRN_IND_TP_CD_01,
               APD.AJE_PTRN_IND_TP_NM_01,
               APIT_01.AJE_INTFC_COL_TXT AS AJE_INTFC_COL_TXT_01,
               APD.AJE_PTRN_ACTL_CD_01,
               APD.AJE_PTRN_ACTL_NM_01,
               APD.AJE_PTRN_IND_TP_CD_02,
               APD.AJE_PTRN_IND_TP_NM_02,
               APIT_02.AJE_INTFC_COL_TXT AS AJE_INTFC_COL_TXT_02,
               APD.AJE_PTRN_ACTL_CD_02,
               APD.AJE_PTRN_ACTL_NM_02,
			   APD.AJE_PTRN_IND_TP_CD_03,
			   APD.AJE_PTRN_IND_TP_NM_03,
               APIT_03.AJE_INTFC_COL_TXT AS AJE_INTFC_COL_TXT_03,
               APD.AJE_PTRN_ACTL_CD_03,
               APD.AJE_PTRN_ACTL_NM_03,
               APD.JRNL_CATG_CD,
               APD.JRNL_CATG_NM,
               APD.DR_CR_TP_CD,
               APD.AJE_LINK_FLG,
               APD.AJE_LINE_IDX_NUM,
               APD.AJE_LINE_IDX_DESC_TXT AS DR_AJE_LINE_IDX_DESC_TXT,
		       APD.AJE_COA_CMPY_CD       AS DR_AJE_COA_CMPY_CD,
  			   APD.AJE_COA_BR_CD         AS DR_AJE_COA_BR_CD,
    	       APD.AJE_COA_CC_CD         AS DR_AJE_COA_CC_CD,
	           APD.AJE_COA_ACCT_CD       AS DR_AJE_COA_ACCT_CD,
               APD.AJE_COA_PROD_CD       AS DR_AJE_COA_PROD_CD,
       	 	   APD.AJE_COA_CH_CD         AS DR_AJE_COA_CH_CD,
       		   APD.AJE_COA_AFFL_CD       AS DR_AJE_COA_AFFL_CD,
       		   APD.AJE_COA_PROJ_CD       AS DR_AJE_COA_PROJ_CD,
       		   APD.AJE_COA_EXTN_CD       AS DR_AJE_COA_EXTN_CD,
       		   APC.AJE_LINE_IDX_DESC_TXT AS CR_AJE_LINE_IDX_DESC_TXT,
       		   APC.AJE_LINE_IND_TP_CD    AS CR_AJE_LINE_IND_TP_CD,
       		   APC.AJE_COA_CMPY_CD       AS CR_AJE_COA_CMPY_CD,
       		   APC.AJE_COA_BR_CD         AS CR_AJE_COA_BR_CD,
       		   APC.AJE_COA_CC_CD         AS CR_AJE_COA_CC_CD,
       		   APC.AJE_COA_ACCT_CD       AS CR_AJE_COA_ACCT_CD,
       		   APC.AJE_COA_PROD_CD       AS CR_AJE_COA_PROD_CD,
       		   APC.AJE_COA_CH_CD         AS CR_AJE_COA_CH_CD,
       		   APC.AJE_COA_AFFL_CD       AS CR_AJE_COA_AFFL_CD,
       		   APC.AJE_COA_PROJ_CD       AS CR_AJE_COA_PROJ_CD,
       	       APC.AJE_COA_EXTN_CD       AS CR_AJE_COA_EXTN_CD,
               APD.AJE_LINE_IND_TP_CD,
               ALIT.AJE_LINE_IND_TP_NM,
               APD.JRNL_QTY_FLIP_FLG,
               APD.JRNL_AMT_FLIP_FLG
          FROM AJE_PTRN APD,
          	   AJE_PTRN APC,
               ( SELECT EZCANCELFLAG,
                        AJE_INTFC_COL_TXT, 
                        GLBL_CMPY_CD,
                        AJE_PTRN_IND_TP_CD,
                        AJE_PTRN_ACTL_CD
                   FROM AJE_PTRN_IND_TP
                  WHERE GLBL_CMPY_CD    = #glblCmpyCd#
                  <!-- QC#5849 remove this condition
                    AND AJE_INTFC_TP_CD = #ajeIntfcTpCd#
                    --> 
                    AND EZCANCELFLAG    = '0'
                    ) APIT_01,
               ( SELECT EZCANCELFLAG,
                        AJE_INTFC_COL_TXT, 
                        GLBL_CMPY_CD,
                        AJE_PTRN_IND_TP_CD,
                        AJE_PTRN_ACTL_CD
                   FROM AJE_PTRN_IND_TP
                  WHERE GLBL_CMPY_CD    = #glblCmpyCd#
                  <!-- QC#5849 remove this condition
                    AND AJE_INTFC_TP_CD = #ajeIntfcTpCd#
                    --> 
                    AND EZCANCELFLAG    = '0'
                    ) APIT_02,        
               ( SELECT EZCANCELFLAG,
                        AJE_INTFC_COL_TXT, 
                        GLBL_CMPY_CD,
                        AJE_PTRN_IND_TP_CD,
                        AJE_PTRN_ACTL_CD
                   FROM AJE_PTRN_IND_TP
                  WHERE GLBL_CMPY_CD    = #glblCmpyCd#
                  <!-- QC#5849 remove this condition
                    AND AJE_INTFC_TP_CD = #ajeIntfcTpCd#
                    --> 
                    AND EZCANCELFLAG    = '0'
                    ) APIT_03,
               AJE_LINE_IND_TP ALIT
         WHERE APD.EZCANCELFLAG           = '0'
           AND (ALIT.EZCANCELFLAG         = '0' OR ALIT.EZCANCELFLAG IS NULL)
           AND APD.GLBL_CMPY_CD           = #glblCmpyCd#
           AND APD.AJE_LINK_FLG           = #ajeLinkFlg#
           AND APD.DR_CR_TP_CD            = #drTpCd#
	       AND APC.DR_CR_TP_CD            = #crTpCd#
	       AND APD.GLBL_CMPY_CD           = APC.GLBL_CMPY_CD
           AND APD.AJE_LINK_FLG           = APC.AJE_LINK_FLG
		   AND APD.AJE_ID                 = APC.AJE_ID
 		   AND APD.AJE_PTRN_IND_TP_CD_01  = APC.AJE_PTRN_IND_TP_CD_01
   		   AND APD.AJE_PTRN_ACTL_CD_01    = APC.AJE_PTRN_ACTL_CD_01
   		   AND APD.AJE_PTRN_IND_TP_CD_02  = APC.AJE_PTRN_IND_TP_CD_02
   		   AND APD.AJE_PTRN_ACTL_CD_02    = APC.AJE_PTRN_ACTL_CD_02
   		   AND APD.AJE_PTRN_IND_TP_CD_03  = APC.AJE_PTRN_IND_TP_CD_03
   		   AND APD.AJE_PTRN_ACTL_CD_03    = APC.AJE_PTRN_ACTL_CD_03
   		   AND APD.AJE_LINE_IDX_NUM       = APC.AJE_LINE_IDX_NUM
           AND APD.AJE_PTRN_IND_TP_CD_01  = APIT_01.AJE_PTRN_IND_TP_CD (+)
           AND APD.AJE_PTRN_ACTL_CD_01    = APIT_01.AJE_PTRN_ACTL_CD (+)
           AND APD.AJE_PTRN_IND_TP_CD_02  = APIT_02.AJE_PTRN_IND_TP_CD (+)
           AND APD.AJE_PTRN_ACTL_CD_02    = APIT_02.AJE_PTRN_ACTL_CD (+)
           AND APD.AJE_PTRN_IND_TP_CD_03  = APIT_03.AJE_PTRN_IND_TP_CD (+)
           AND APD.AJE_PTRN_ACTL_CD_03    = APIT_03.AJE_PTRN_ACTL_CD (+)
           AND APD.GLBL_CMPY_CD           = ALIT.GLBL_CMPY_CD (+)
           AND APD.AJE_LINE_IND_TP_CD     = ALIT.AJE_LINE_IND_TP_CD (+)
           AND APD.AJE_ID IN          
           <iterate property="ajeIdList" var="ajeId[]" open="(" close=")" conjunction=",">
             #ajeId[]#
           </iterate>
          ) W1,
            SYS_SRC SS
          WHERE SS.GLBL_CMPY_CD = #glblCmpyCd#
            AND SS.EZCANCELFLAG = '0'
            AND SS.SYS_SRC_CD   = W1.SYS_SRC_CD(+)
         ORDER BY W1.TRX_CD,
                  W1.TRX_RSN_CD,
                  W1.SYS_SRC_CD,
                  W1.AJE_INTFC_COL_TXT_01,
                  W1.AJE_INTFC_COL_TXT_02,
                  W1.AJE_INTFC_COL_TXT_03,
                  W1.AJE_LINE_IDX_NUM
          
    </statement>
    
	<statement id="getCountedAjeIdByIndType" parameterClass="Map" resultClass="Map">
			SELECT 
			  AJE_ID		AS AJE_ID,
			  COUNT(AJE_ID) AS AJE_ID_COUNT
			FROM
			(
			SELECT 
				AJE_ID,
				AJE_PTRN_IND_TP_CD_01,
				AJE_PTRN_ACTL_CD_01,
				AJE_PTRN_IND_TP_CD_02,
				AJE_PTRN_ACTL_CD_02,
				AJE_PTRN_IND_TP_CD_03,
				AJE_PTRN_ACTL_CD_03
			FROM AJE_PTRN
			WHERE EZCANCELFLAG    = '0'
			AND GLBL_CMPY_CD    = #glblCmpyCd#
			AND AJE_LINK_FLG    = #ajeLinkFlg#
			AND AJE_ID          IN
           <iterate property="ajeIdList" var="ajeId[]" open="(" close=")" conjunction=",">
               #ajeId[]#
           </iterate>
			GROUP BY 
				AJE_ID,
				AJE_PTRN_IND_TP_CD_01,
				AJE_PTRN_ACTL_CD_01,
				AJE_PTRN_IND_TP_CD_02,
				AJE_PTRN_ACTL_CD_02,
				AJE_PTRN_IND_TP_CD_03,
				AJE_PTRN_ACTL_CD_03
			) 
			GROUP BY AJE_ID
			ORDER BY AJE_ID
	</statement>	

   	<statement id="getCcy" parameterClass="Map" resultClass="Map">
         SELECT GC.STD_CCY_CD       AS FUNC_CCY_CD,
                CCY.ACCT_ARTH_TP_CD AS ACCT_ARTH_TP_CD,
                CCY.ORCL_CCY_CD     AS ORCL_CCY_CD
           FROM GLBL_CMPY GC,
                CCY       CCY
          WHERE GC.EZCANCELFLAG     = '0'
            AND CCY.EZCANCELFLAG    = '0'
            AND GC.GLBL_CMPY_CD     = #glblCmpyCd#
            AND GC.GLBL_CMPY_CD     = CCY.GLBL_CMPY_CD
            AND GC.STD_CCY_CD       = CCY.CCY_CD    
    </statement>
    
    <statement id="getEssMapSysSrc" parameterClass="Map" resultClass="Map">
         SELECT SYS_SRC_CD
           FROM SYS_SRC SS
          WHERE SS.EZCANCELFLAG     = '0'
            AND SS.GLBL_CMPY_CD     = #glblCmpyCd#
            AND SS.ESS_MAP_FLG      = #flgN#
    </statement>

    <statement id="getCoaSegLkup" parameterClass="Map" resultClass="Map">
        SELECT
             A.SRC_TBL_NM
            ,A.SRC_ATTR_NM
            ,A.COA_ATTR_NM_01
            ,A.COA_ATTR_NM_02
            ,A.COA_ATTR_NM_03
            ,A.COA_ATTR_NM_04
            ,A.COA_ATTR_NM_05
            ,A.COA_ATTR_NM_06
            ,A.COA_ATTR_NM_07
            ,A.COA_ATTR_NM_08
            ,A.COA_ATTR_NM_09
        FROM
            AJE_COA_SEG_LKUP    A
        WHERE
                A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.COA_SEG_LKUP_TP_CD    = #coaSegLkupTpCd#
    </statement>

    <statement id="getCoaSegLkupAll" parameterClass="Map" resultClass="Map">
        SELECT
             A.COA_SEG_LKUP_TP_CD
            ,A.SRC_TBL_NM
            ,A.SRC_ATTRB_NM_01
            ,A.SRC_ATTRB_NM_02
            ,A.COA_ATTRB_NM_01
            ,A.COA_ATTRB_NM_02
            ,A.COA_ATTRB_NM_03
            ,A.COA_ATTRB_NM_04
            ,A.COA_ATTRB_NM_05
            ,A.COA_ATTRB_NM_06
            ,A.COA_ATTRB_NM_07
            ,A.COA_ATTRB_NM_08
            ,A.COA_ATTRB_NM_09
        FROM
            AJE_COA_SEG_LKUP    A
        WHERE
                A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = #glblCmpyCd#
        ORDER BY
            A.COA_SEG_LKUP_TP_CD
    </statement>

    <statement id="getDistData" parameterClass="Map" resultClass="Map">
        SELECT
             $distAttrNm$ AS RESULT_CD
        FROM
            $srcTblNm$    A
        WHERE
                A.EZCANCELFLAG  = '0'
            AND A.GLBL_CMPY_CD  = #glblCmpyCd#
            AND A.$srcAttrNm$   = #srcAttrCd#
    </statement>

    <statement id="getAjePtrn2" parameterClass="Map" resultClass="Map">
    SELECT W1.*
          ,SS.SYS_SRC_CD                             AS JRNL_SRC_CD
          ,SUBSTR(SS.SYS_SRC_NM,1, #jrnlSrcNmLen#)   AS JRNL_SRC_NM
      FROM 
        (SELECT
               A.GLBL_CMPY_CD,
               A.AJE_ID,
               A.SYS_SRC_CD,
               A.SYS_SRC_NM,
               A.TRX_CD,
               A.TRX_NM,
               A.TRX_RSN_CD,
               A.TRX_RSN_NM,
               A.AJE_PTRN_IND_TP_CD_01,
               A.AJE_PTRN_IND_TP_NM_01,
               APIT_01.AJE_INTFC_COL_TXT AS AJE_INTFC_COL_TXT_01,
               A.AJE_PTRN_ACTL_CD_01,
               A.AJE_PTRN_ACTL_NM_01,
               A.AJE_PTRN_IND_TP_CD_02,
               A.AJE_PTRN_IND_TP_NM_02,
               APIT_02.AJE_INTFC_COL_TXT AS AJE_INTFC_COL_TXT_02,
               A.AJE_PTRN_ACTL_CD_02,
               A.AJE_PTRN_ACTL_NM_02,
			   A.AJE_PTRN_IND_TP_CD_03,
			   A.AJE_PTRN_IND_TP_NM_03,
               APIT_03.AJE_INTFC_COL_TXT AS AJE_INTFC_COL_TXT_03,
               A.AJE_PTRN_ACTL_CD_03,
               A.AJE_PTRN_ACTL_NM_03,
               A.JRNL_CATG_CD,
               A.JRNL_CATG_NM,
               A.DR_CR_TP_CD,
               A.AJE_LINK_FLG,
               A.AJE_LINE_IDX_NUM,
               A.AJE_LINE_IDX_DESC_TXT AS DR_AJE_LINE_IDX_DESC_TXT,
		       A.AJE_COA_CMPY_CD       AS DR_AJE_COA_CMPY_CD,
  			   A.AJE_COA_BR_CD         AS DR_AJE_COA_BR_CD,
    	       A.AJE_COA_CC_CD         AS DR_AJE_COA_CC_CD,
	           A.AJE_COA_ACCT_CD       AS DR_AJE_COA_ACCT_CD,
               A.AJE_COA_PROD_CD       AS DR_AJE_COA_PROD_CD,
       	 	   A.AJE_COA_CH_CD         AS DR_AJE_COA_CH_CD,
       		   A.AJE_COA_AFFL_CD       AS DR_AJE_COA_AFFL_CD,
       		   A.AJE_COA_PROJ_CD       AS DR_AJE_COA_PROJ_CD,
       		   A.AJE_COA_EXTN_CD       AS DR_AJE_COA_EXTN_CD,
       		   A.AJE_LINE_IDX_DESC_TXT AS CR_AJE_LINE_IDX_DESC_TXT,
       		   A.AJE_LINE_IND_TP_CD    AS CR_AJE_LINE_IND_TP_CD,
       		   A.AJE_COA_CMPY_CD       AS CR_AJE_COA_CMPY_CD,
       		   A.AJE_COA_BR_CD         AS CR_AJE_COA_BR_CD,
       		   A.AJE_COA_CC_CD         AS CR_AJE_COA_CC_CD,
       		   A.AJE_COA_ACCT_CD       AS CR_AJE_COA_ACCT_CD,
       		   A.AJE_COA_PROD_CD       AS CR_AJE_COA_PROD_CD,
       		   A.AJE_COA_CH_CD         AS CR_AJE_COA_CH_CD,
       		   A.AJE_COA_AFFL_CD       AS CR_AJE_COA_AFFL_CD,
       		   A.AJE_COA_PROJ_CD       AS CR_AJE_COA_PROJ_CD,
       	       A.AJE_COA_EXTN_CD       AS CR_AJE_COA_EXTN_CD,
               A.AJE_LINE_IND_TP_CD,
               ALIT.AJE_LINE_IND_TP_NM,
               A.JRNL_QTY_FLIP_FLG,
               A.JRNL_AMT_FLIP_FLG
        FROM
            AJE_PTRN A
            , ( SELECT EZCANCELFLAG,
                        AJE_INTFC_COL_TXT, 
                        GLBL_CMPY_CD,
                        AJE_PTRN_IND_TP_CD,
                        AJE_PTRN_ACTL_CD
                   FROM AJE_PTRN_IND_TP
                  WHERE GLBL_CMPY_CD    = #glblCmpyCd#
                  <!-- QC#5849 remove this condition
                    AND AJE_INTFC_TP_CD = #ajeIntfcTpCd#
                    --> 
                    AND EZCANCELFLAG    = '0'
                    ) APIT_01,
               ( SELECT EZCANCELFLAG,
                        AJE_INTFC_COL_TXT, 
                        GLBL_CMPY_CD,
                        AJE_PTRN_IND_TP_CD,
                        AJE_PTRN_ACTL_CD
                   FROM AJE_PTRN_IND_TP
                  WHERE GLBL_CMPY_CD    = #glblCmpyCd#
                  <!-- QC#5849 remove this condition
                    AND AJE_INTFC_TP_CD = #ajeIntfcTpCd#
                    --> 
                    AND EZCANCELFLAG    = '0'
                    ) APIT_02,        
               ( SELECT EZCANCELFLAG,
                        AJE_INTFC_COL_TXT, 
                        GLBL_CMPY_CD,
                        AJE_PTRN_IND_TP_CD,
                        AJE_PTRN_ACTL_CD
                   FROM AJE_PTRN_IND_TP
                  WHERE GLBL_CMPY_CD    = #glblCmpyCd#
                  <!-- QC#5849 remove this condition
                    AND AJE_INTFC_TP_CD = #ajeIntfcTpCd#
                    --> 
                    AND EZCANCELFLAG    = '0'
                    ) APIT_03,
               AJE_LINE_IND_TP ALIT
        WHERE
                A.EZCANCELFLAG          = '0'
            AND A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.AJE_PTRN_IND_TP_CD_01  = APIT_01.AJE_PTRN_IND_TP_CD (+)
            AND A.AJE_PTRN_ACTL_CD_01    = APIT_01.AJE_PTRN_ACTL_CD (+)
            AND A.AJE_PTRN_IND_TP_CD_02  = APIT_02.AJE_PTRN_IND_TP_CD (+)
            AND A.AJE_PTRN_ACTL_CD_02    = APIT_02.AJE_PTRN_ACTL_CD (+)
            AND A.AJE_PTRN_IND_TP_CD_03  = APIT_03.AJE_PTRN_IND_TP_CD (+)
            AND A.AJE_PTRN_ACTL_CD_03    = APIT_03.AJE_PTRN_ACTL_CD (+)
            AND A.GLBL_CMPY_CD           = ALIT.GLBL_CMPY_CD (+)
            AND A.AJE_LINE_IND_TP_CD     = ALIT.AJE_LINE_IND_TP_CD (+)
            AND A.AJE_ID                IN 
           <iterate property="ajeIdList" var="ajeId[]" open="(" close=")" conjunction=",">
               #ajeId[]#
           </iterate>
            AND A.AJE_LINK_FLG          = #ajeLinkFlg#
            AND A.DR_CR_TP_CD           = #drCrTpCd#
            <isNotNull property="ajeLineIndTpDfrd">
            AND A.AJE_LINE_IND_TP_CD    = #ajeLineIndTpDfrd#
            </isNotNull>
        ) W1
        , SYS_SRC SS
        WHERE SS.GLBL_CMPY_CD           = #glblCmpyCd#
          AND SS.EZCANCELFLAG           = '0'
          AND SS.SYS_SRC_CD             = W1.SYS_SRC_CD(+)  -- this is required to get actual system source name
        ORDER BY
             W1.TRX_CD,
             W1.TRX_RSN_CD,
             W1.SYS_SRC_CD,
             W1.AJE_INTFC_COL_TXT_01,
             W1.AJE_INTFC_COL_TXT_02,
             W1.AJE_INTFC_COL_TXT_03,
             W1.AJE_LINE_IDX_NUM
    </statement>

    
    <statement id="getDistData_ITEM" parameterClass="Map" resultClass="Map">
        SELECT
             MDS.COA_PROD_CD
            ,MDS.COA_MDSE_TP_CD
        FROM
             MDSE_DLY_SNAP_SHOT           MDS
        WHERE
                MDS.GLBL_CMPY_CD        = #glblCmpyCd#
            AND MDS.MDSE_CD             = #srcAttrCd1#
            AND MDS.EZCANCELFLAG        = '0'
            AND MDS.LTST_REC_FLG        = 'Y'
    </statement>
    
    <!-- at IB will be taken care of service team. AJE will retrieve COA segments from DS_INV_SLS_CR
    <statement id="getDistData_IB" parameterClass="Map" resultClass="Map">
        SELECT
             SMM.SVC_BY_LINE_BIZ_TP_CD
            ,SMM.FIN_BR_CD
        FROM
             SVC_MACH_MSTR    SMM
            ,DS_CONTR_DTL     DCD
            ,SVC_INV_LINE     SIL
        WHERE
                SMM.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DCD.GLBL_CMPY_CD        = SMM.GLBL_CMPY_CD
            AND SIL.GLBL_CMPY_CD        = SMM.GLBL_CMPY_CD
            AND DCD.SVC_MACH_MSTR_PK    = SMM.SVC_MACH_MSTR_PK
            AND SIL.DS_CONTR_DTL_PK     = DCD.DS_CONTR_DTL_PK
            AND SIL.SVC_INV_NUM         = #srcAttrCd#
            AND SMM.EZCANCELFLAG        = '0'
            AND DCD.EZCANCELFLAG        = '0'
            AND SIL.EZCANCELFLAG        = '0'
    </statement>
    -->

    <statement id="getDistData_MACHINE" parameterClass="Map" resultClass="Map">
        SELECT
             MDS.COA_PROD_CD
            ,MDS.COA_MDSE_TP_CD
        FROM
             SVC_MACH_MSTR                SMM
            ,SVC_INV                      SI
            ,MDSE_DLY_SNAP_SHOT           MDS
        WHERE
                SMM.GLBL_CMPY_CD        = #glblCmpyCd#
            AND SI.GLBL_CMPY_CD         = SMM.GLBL_CMPY_CD
            AND MDS.GLBL_CMPY_CD        = SMM.GLBL_CMPY_CD
            AND SI.SVC_INV_NUM          = #srcAttrCd1#
            AND SI.SVC_INV_SRC_TP_CD    = #srcAttrCd2#
            AND SI.SVC_MACH_MSTR_PK     = SMM.SVC_MACH_MSTR_PK
            AND MDS.MDSE_CD             = SMM.MDSE_CD
            <!-- QC#22290 Start -->
            AND MDS.LTST_REC_FLG        = #flgY#
            <!-- QC#22290 End -->
            AND SMM.EZCANCELFLAG        = '0'
            AND SI.EZCANCELFLAG         = '0'
            AND MDS.EZCANCELFLAG        = '0'
    </statement>
    
    <statement id="getRtlWhAcct" parameterClass="Map" resultMap="result.getRtlWhAcct">
        SELECT RWA.RTL_WH_CD
              ,RWA.RTL_WH_ACCT_TP_CD
              ,RWA.COA_BR_CD
              ,RWA.COA_ACCT_CD
              ,RWAT.RTL_WH_ACCT_TP_NM
          FROM RTL_WH_ACCT RWA
              ,RTL_WH_ACCT_TP RWAT
         WHERE RWA.EZCANCELFLAG    = '0'
           AND RWA.GLBL_CMPY_CD    = #glblCmpyCd#
           AND RWA.GLBL_CMPY_CD    = RWAT.GLBL_CMPY_CD
    </statement>
    
    <resultMap id="result.getRtlWhAcct" class="RtlWhAcct">
        <result property="rtlWhCd"                      column="RTL_WH_CD"                  javaType="String"/>
        <result property="rtlWhAcctTpCd"                column="RTL_WH_ACCT_TP_CD"          javaType="String"/>
        <result property="coaBrCd"                      column="COA_BR_CD"                  javaType="String"/>
        <result property="coaAcctCd"                    column="COA_ACCT_CD"                javaType="String"/>
        <result property="rtlWhAcctTpNm"                column="RTL_WH_ACCT_TP_NM"          javaType="String"/>
    </resultMap>
    
    <statement id="getMdseTpAcct" parameterClass="Map" resultMap="result.getMdseTpAcct">
        SELECT CPA.COA_PROJ_CD
              ,CPA.COA_PROJ_ACCT_TP_CD
              ,CPA.COA_ACCT_CD
              ,CPAT.COA_PROJ_ACCT_TP_NM
          FROM COA_PROJ_ACCT CPA
              ,COA_PROJ_ACCT_TP CPAT
         WHERE CPA.EZCANCELFLAG        = '0'
           AND CPA.GLBL_CMPY_CD        = #glblCmpyCd#
           AND CPA.GLBL_CMPY_CD        = CPAT.GLBL_CMPY_CD
           AND CPA.EZCANCELFLAG        = CPAT.EZCANCELFLAG
           AND CPA.COA_PROJ_ACCT_TP_CD = CPAT.COA_PROJ_ACCT_TP_CD
         ORDER BY COA_PROJ_CD
    </statement>
    
    <resultMap id="result.getMdseTpAcct" class="MdseTpAcct">
        <result property="coaProjCd"                      column="COA_PROJ_CD"                  javaType="String"/>
        <result property="coaProjAcctTpCd"                column="COA_PROJ_ACCT_TP_CD"          javaType="String"/>
        <result property="coaAcctCd"                      column="COA_ACCT_CD"                  javaType="String"/>
        <result property="coaProjAcctTpNm"                column="COA_PROJ_ACCT_TP_NM"          javaType="String"/>
    </resultMap>
    <!-- start 2018/03/12 QC#23689 -->
    <statement id="getInvoice" parameterClass="Map" resultClass="Map">
        SELECT
             A.GLBL_CMPY_CD
            ,A.DS_INV_SLS_CR_PK
            ,A.INV_NUM
            ,A.INV_BOL_LINE_NUM
            ,A.INV_LINE_NUM
            ,A.INV_LINE_SUB_NUM
            ,A.INV_TRX_LINE_SUB_NUM
            ,A.MDSE_CD
            ,A.INV_LINE_SPL_TP_CD
            ,A.INV_LINE_SPL_PCT
            ,A.SLS_REP_TOC_CD
            ,A.SLS_REP_CR_PCT
            ,A.DEAL_SLS_CR_AMT
            ,A.FUNC_SLS_CR_AMT
            ,A.DEAL_CCY_CD
            ,A.DFRD_ACCTG_RULE_CD
            ,A.DFRD_ACCTG_RULE_DURN_AOT
            ,A.DURN_START_DT
            ,A.DEAL_ORIG_DFRD_AMT
            ,A.FUNC_ORIG_DFRD_AMT
            ,A.DEAL_DFRD_BAL_AMT
            ,A.FUNC_DFRD_BAL_AMT
            ,A.DEAL_SCHD_REV_AMT
            ,A.FUNC_SCHD_REV_AMT
            ,A.REV_RECOG_CNT
            ,A.FIRST_REV_RECOG_DT
            ,A.NEXT_REV_RECOG_DT
            ,A.REV_RECOG_PROC_STS_CD
            ,A.SLS_REP_BR_CD
            ,A.COA_CMPY_CD
            ,A.COA_AFFL_CD
            ,A.COA_BR_CD
            ,A.COA_CH_CD
            ,A.COA_CC_CD
            ,A.COA_ACCT_CD
            ,A.COA_PROD_CD
            ,A.COA_PROJ_CD
            ,A.COA_EXTN_CD
            ,A.TRX_CD
            ,A.TRX_RSN_CD
            ,A.MAN_INV_CRAT_CMNT_TXT
            ,A.DS_CPO_CONFIG_PK
            ,B.SYS_SRC_CD
            ,F.SYS_SRC_NM
            ,B.INV_TP_CD
            ,B.ACCT_DT
            ,B.INV_DT
            ,B.BILL_TO_CUST_CD
            ,B.SELL_TO_CUST_CD
            ,B.CPO_ORD_NUM
            ,C.INV_LINE_DEAL_TAX_AMT
            ,C.INV_LINE_FUNC_TAX_AMT
            <!-- start mod 2018/05/21 QC#21841 -->
            ,C.INV_LINE_CATG_CD
            ,MDSE_FRT.COA_MDSE_TP_CD
            <!-- ,D.FRT_DEAL_TAX_AMT -->
            <!-- ,D.FRT_FUNC_TAX_AMT -->
            <!-- ,D.SHIP_DEAL_FRT_AMT -->
            <!-- ,D.SHIP_FUNC_FRT_AMT -->
            <!-- end mod 2018/05/21 QC#21841 -->
            ,D.SHIP_TO_CUST_CD
            ,D.SHIP_TO_ST_CD
            ,B.DS_ORD_TP_CD
            ,B.DS_ORD_RSN_CD
            ,B.DS_INV_TP_CD
            ,B.BILL_TO_CUST_ACCT_CD
            ,B.LINE_BIZ_TP_CD                                    AS AJE_LINE_IND_TP_CD
            ,DECODE(G.DFRD_REV_FLG, #flgY#, #dfrd#, #immediate#) AS AJE_ACCTG_RULE_CD
            ,#invoice#                                           AS INV_INVTY_IND_TP_CD
            ,#dspt#                                              AS DSPT
            ,A.DFRD_ACCTG_RULE_CD                                AS DFRD_ACCTG_RULE_CD
            <!-- start add 2019/01/07 QC#29734 -->
            ,(CASE
                WHEN
                     <iterate property="varRental" var="varRental[]" open="AILA.SVC_ALLOC_TP_CD IN (" close=")" conjunction=",">
                     #varRental[]#
                     </iterate>
                     THEN #re#
                ELSE #nonRe#
             END)                                                AS SVC_ALLOC_IND_TP_CD
            <!-- end add 2019/01/07 QC#29734 -->
            ,H.AR_COA_CMPY_CD                                    AS "INVTP-AR_CMPY_CD"
            ,H.AR_COA_BR_CD                                      AS "INVTP-AR_BR_CD"
            ,H.AR_COA_CC_CD                                      AS "INVTP-AR_CC_CD"
            ,H.AR_COA_ACCT_CD                                    AS "INVTP-AR_ACCT_CD"
            ,H.AR_COA_PROD_CD                                    AS "INVTP-AR_PROD_CD"
            ,H.AR_COA_CH_CD                                      AS "INVTP-AR_CH_CD"
            ,H.AR_COA_AFFL_CD                                    AS "INVTP-AR_AFFL_CD"
            ,H.AR_COA_PROJ_CD                                    AS "INVTP-AR_PROJ_CD"
            ,H.AR_COA_EXTN_CD                                    AS "INVTP-AR_EXTN_CD"
            ,H.SLS_COA_CMPY_CD                                   AS "INVTP-REV_CMPY_CD"
            ,H.SLS_COA_BR_CD                                     AS "INVTP-REV_BR_CD"
            ,H.SLS_COA_CC_CD                                     AS "INVTP-REV_CC_CD"
            ,H.SLS_COA_ACCT_CD                                   AS "INVTP-REV_ACCT_CD"
            ,H.SLS_COA_PROD_CD                                   AS "INVTP-REV_PROD_CD"
            ,H.SLS_COA_CH_CD                                     AS "INVTP-REV_CH_CD"
            ,H.SLS_COA_AFFL_CD                                   AS "INVTP-REV_AFFL_CD"
            ,H.SLS_COA_PROJ_CD                                   AS "INVTP-REV_PROJ_CD"
            ,H.SLS_COA_EXTN_CD                                   AS "INVTP-REV_EXTN_CD"
            ,H.UN_EARN_COA_CMPY_CD                               AS "INVTP-UNEARN_CMPY_CD"
            ,H.UN_EARN_COA_BR_CD                                 AS "INVTP-UNEARN_BR_CD"
            ,H.UN_EARN_COA_CC_CD                                 AS "INVTP-UNEARN_CC_CD"
            ,H.UN_EARN_COA_ACCT_CD                               AS "INVTP-UNEARN_ACCT_CD"
            ,H.UN_EARN_COA_PROD_CD                               AS "INVTP-UNEARN_PROD_CD"
            ,H.UN_EARN_COA_CH_CD                                 AS "INVTP-UNEARN_CH_CD"
            ,H.UN_EARN_COA_AFFL_CD                               AS "INVTP-UNEARN_AFFL_CD"
            ,H.UN_EARN_COA_PROJ_CD                               AS "INVTP-UNEARN_PROJ_CD"
            ,H.UN_EARN_COA_EXTN_CD                               AS "INVTP-UNEARN_EXTN_CD"
            ,I.COA_BR_CD                                         AS "TOC_BR_CD"
            ,I.COA_CC_CD                                         AS "TOC_CC_CD"
            ,I.COA_EXTN_CD                                       AS "TOC_EXTN_CD"
            ,J.REV_COA_ACCT_CD                                   AS "ITEM-REV_ACCT_CD"
            ,J.COGS_COA_ACCT_CD                                  AS "ITEM-COS_ACCT_CD"
            ,J.EXP_COA_ACCT_CD                                   AS "ITEM-EXP_ACCT_CD"
            ,J.ACRL_COA_ACCT_CD                                  AS "ITEM-ACRL_ACCT_CD"
            ,(CASE
                 WHEN K.COA_TAX_ACCT_CD IS NULL THEN #stAcctCd#
                 ELSE K.COA_TAX_ACCT_CD END )                    AS "ST_ACCT_CD"
            ,NVL(M.COA_CH_CD, L.COA_CH_CD)                       AS "CUST-SITE_CH_CD"
            ,NVL(M.COA_AFFL_CD, L.COA_AFFL_CD)                   AS "CUST-SITE_AFFL_CD"
            ,L.COA_CH_CD                                         AS "CUST-ACCT_CH_CD"
            ,L.COA_AFFL_CD                                       AS "CUST-ACCT_AFFL_CD"
            ,NVL(MS.COA_CH_CD, LS.COA_CH_CD)                     AS "SELL-SITE_CH_CD"
            ,NVL(MS.COA_AFFL_CD, LS.COA_AFFL_CD)                 AS "SELL-SITE_AFFL_CD"
            ,LS.COA_CH_CD                                        AS "SELL-CUST_CH_CD"
            ,LS.COA_AFFL_CD                                      AS "SELL-CUST_AFFL_CD"
            ,J.COA_CC_CD                                         AS "ITEM_CC_CD"
            ,J.COA_PROD_CD                                       AS "ITEM_PROD_CD"
            ,J.COA_MDSE_TP_CD                                    AS "ITEM_PROJ_CD"
            ,A.COA_CMPY_CD                                       AS "LINK_CMPY_CD"
            ,A.COA_BR_CD                                         AS "LINK_BR_CD"
            ,A.COA_CC_CD                                         AS "LINK_CC_CD" 
            ,A.COA_ACCT_CD                                       AS "LINK_ACCT_CD"
            ,A.COA_PROD_CD                                       AS "LINK_PROD_CD"
            ,A.COA_CH_CD                                         AS "LINK_CH_CD"
            ,A.COA_AFFL_CD                                       AS "LINK_AFFL_CD"
            ,A.COA_PROJ_CD                                       AS "LINK_PROJ_CD"
            ,A.COA_EXTN_CD                                       AS "LINK_EXTN_CD"
            ,M.COA_CMPY_CD                                       AS "LOC_CMPY_CD"
            ,M.COA_BR_CD                                         AS "LOC_BR_CD"
            ,M.COA_CC_CD                                         AS "LOC_CC_CD"
            ,M.COA_ACCT_CD                                       AS "LOC_ACCT_CD"
            ,M.COA_PROD_CD                                       AS "LOC_PROD_CD"
            ,M.COA_CH_CD                                         AS "LOC_CH_CD"
            ,M.COA_AFFL_CD                                       AS "LOC_AFFL_CD"
            ,M.COA_PROJ_CD                                       AS "LOC_PROJ_CD"
            ,M.COA_EXTN_CD                                       AS "LOC_EXTN_CD"
            ,NVL(P.FIN_BR_CD, NVL(SMM.FIN_BR_CD, NVL(NVL(SBFX.FIN_BR_CD, SBPX.SVC_BR_CD), NVL(SBFX_5.FIN_BR_CD, SBPX_5.SVC_BR_CD))))
                                                                 AS "IB_BR_CD"
            ,P.FIN_BR_CD
            ,SMM.FIN_BR_CD
            ,SBFX.FIN_BR_CD
            ,SBPX.SVC_BR_CD
            ,SBFX_5.FIN_BR_CD
            ,SBPX_5.SVC_BR_CD
            ,NVL(SBFX.FIN_BR_CD, SBPX.SVC_BR_CD)                 AS "CONTR-SHIP-TO_BR_CD"
            ,LBT.COA_CC_CD                                       AS "LINE-BIZ_CC_CD"
            ,CDA.CM_COA_CMPY_CD                                  AS "AP-CSMP_CMPY_CD"
            ,CDA.CM_COA_BR_CD                                    AS "AP-CSMP_BR_CD"
            ,CDA.CM_COA_CC_CD                                    AS "AP-CSMP_CC_CD"
            ,CDA.CM_COA_ACCT_CD                                  AS "AP-CSMP_ACCT_CD"
            ,CDA.CM_COA_PROD_CD                                  AS "AP-CSMP_PROD_CD"
            ,CDA.CM_COA_CH_CD                                    AS "AP-CSMP_CH_CD"
            ,CDA.CM_COA_AFFL_CD                                  AS "AP-CSMP_AFFL_CD"
            ,CDA.CM_COA_PROJ_CD                                  AS "AP-CSMP_PROJ_CD"
            ,CDA.CM_COA_EXTN_CD                                  AS "AP-CSMP_EXTN_CD"
            ,MDSE_MACH.COA_PROD_CD                                    AS "MACH_PROD_CD"
            ,MDSE_MACH.COA_MDSE_TP_CD                                 AS "MACH_PROJ_CD"
            ,MDSE_MACH.COA_CC_CD                                      AS "MACH_CC_CD"
            ,NVL(Q.AJE_COA_PROD_MAP_TO_CD, NVL(MDSE_MACH.COA_PROD_CD, CPM.AJE_COA_PROD_MAP_TO_CD))     AS "MACH-MAP_PROD_CD"
            ,V.COA_AFFL_CD                                       AS "ORIG-CUST-ACCT_AFFL_CD"
            ,V.COA_CH_CD                                         AS "ORIG-CUST-ACCT_CH_CD"
            ,NVL(T.COA_AFFL_CD, V.COA_AFFL_CD)                   AS "ORIG-CUST-SITE_AFFL_CD"
            ,NVL(T.COA_CH_CD, V.COA_CH_CD)                       AS "ORIG-CUST-SITE_CH_CD"
            <!-- START 2019/08/26 H.Umeda [QC#52972, ADD] -->
            ,NVL(U.AJE_COA_AFFL_MAP_TO_CD, LS.COA_AFFL_CD)      AS "SELL-CUST-MAP_AFFL_CD"
            <!-- END   2019/08/26 H.Umeda [QC#52972, ADD] -->
            ,(CASE
                WHEN DCH.DS_CONTR_CATG_CD   = #dsContrCatgFLEET#
                    THEN LBT1.SPLY_COA_CC_CD
                WHEN MDS.SVC_ALLOC_TP_CD    = #svcAllocTpOPTIMA#
                    THEN LBT2.SPLY_COA_CC_CD
                ELSE
                    NVL(LBT.SPLY_COA_CC_CD, NVL(LBT3.SPLY_COA_CC_CD, LBT2.SPLY_COA_CC_CD))
             END)                                                AS "LOB-SPLY_CC_CD"
            ,(CASE
                WHEN DCH.DS_CONTR_CATG_CD   = #dsContrCatgFLEET#
                    THEN LBT1.SVC_COA_CC_CD
                WHEN MDS.SVC_ALLOC_TP_CD    = #svcAllocTpOPTIMA#
                    THEN LBT2.SVC_COA_CC_CD
                ELSE
                    NVL(LBT.SVC_COA_CC_CD, NVL(LBT3.SVC_COA_CC_CD, LBT2.SVC_COA_CC_CD))
             END)                                                AS "LOB-SVC_CC_CD"
            <!-- start add 2018/07/05 QC#26320 -->
            ,(CASE
                WHEN DCH.DS_CONTR_CATG_CD   = #dsContrCatgFLEET#
                    THEN LBT1.SPLY_COA_CC_CD
                WHEN MDS.SVC_ALLOC_TP_CD    = #svcAllocTpOPTIMA#
                    THEN LBT2.SPLY_COA_CC_CD
                ELSE
                    NVL(LBT_SLD.SPLY_COA_CC_CD, NVL(LBT3.SPLY_COA_CC_CD, LBT2.SPLY_COA_CC_CD))
             END)                                                AS "LOB-SPLY-SLD_CC_CD"
            ,(CASE
                WHEN DCH.DS_CONTR_CATG_CD   = #dsContrCatgFLEET#
                    THEN LBT1.SVC_COA_CC_CD
                WHEN MDS.SVC_ALLOC_TP_CD    = #svcAllocTpOPTIMA#
                    THEN LBT2.SVC_COA_CC_CD
                ELSE
                    NVL(LBT_SLD.SVC_COA_CC_CD, NVL(LBT3.SVC_COA_CC_CD, LBT2.SVC_COA_CC_CD))
             END)                                                AS "LOB-SVC-SLD_CC_CD"
            <!-- end add 2018/07/05 QC#26320 -->
            ,(CASE WHEN CB.COA_BR_TP_CD = #newcore# THEN I.COA_BR_CD
                   ELSE #defBrNewcore# END) AS "NEWCORE_BR_CD"
            <!-- start mod 2019/05/09 QC#50129 -->
            ,(CASE WHEN CB.COA_BR_TP_CD = #newcore# THEN I.COA_CC_CD
                   WHEN B.CPO_ORD_NUM IS NULL       THEN NVL(LBT_SLD.ASSET_COA_CC_CD, NVL(LBT3.ASSET_COA_CC_CD, LBT2.ASSET_COA_CC_CD))
                   ELSE LBT4.ASSET_COA_CC_CD END)                AS "NEWCORE_CC_CD"
            <!-- end mod 2019/05/09 QC#50129 -->
            ,DECODE(DCH2.DS_CONTR_CLS_CD, #bsd#, #fm#, #nonFm#)  AS "FM_IND_TP_CD"
            ,AOC.COA_ACCT_CD                                     AS "ORD-CATG_ACCT_CD"
            ,AOC.COA_PROJ_CD                                     AS "ORD-CATG_PROJ_CD"
            ,CLBT.FRT_COA_PROD_CD                                AS "TOC-LOB_PROD_CD"
            ,DECODE(NVL(P.MDSE_CD, SMM.MDSE_CD), NULL, #none#, #configInd#)        AS "CONFIG_IND_TP_CD"
            
            <!-- start add 2019/10/01 QC#53639 -->
            ,COALESCE(    -- "LINE-ITEM_PROD_CD"
               (SELECT COA_PROD_CD 
                  FROM (SELECT MD.COA_PROD_CD
                          FROM INV_LINE IL , MDSE MD
                         WHERE IL.GLBL_CMPY_CD    = C.GLBL_CMPY_CD
                           AND IL.INV_NUM         = C.INV_NUM
                           AND IL.DS_ORD_POSN_NUM = C.DS_ORD_POSN_NUM
                           AND IL.BASE_CMPT_FLG   = #flgY#
                           AND IL.EZCANCELFLAG    = '0'
                           AND MD.GLBL_CMPY_CD    = IL.GLBL_CMPY_CD
                           AND MD.MDSE_CD         = IL.MDSE_CD
                           AND MD.EZCANCELFLAG    = '0') W
                 WHERE ROWNUM = 1 )
              ,(SELECT COA_PROD_CD
                  FROM (SELECT MD.COA_PROD_CD 
                          FROM INV_LINE IL , MDSE MD
                         WHERE IL.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
                           AND IL.INV_NUM             = C.INV_NUM
                           AND IL.CPO_ORD_NUM         = C.CPO_ORD_NUM
                           AND IL.CPO_DTL_LINE_NUM    = C.CPO_DTL_LINE_NUM
                           AND IL.CPO_DTL_LINE_SUB_NUM    = C.CPO_DTL_LINE_SUB_NUM
                           AND IL.EZCANCELFLAG        = '0'
                           AND MD.GLBL_CMPY_CD    = IL.GLBL_CMPY_CD
                           AND MD.MDSE_CD         = IL.MDSE_CD
                           AND MD.COA_MDSE_TP_CD  &lt;&gt; #coaMdseTpAA#
                           AND MD.EZCANCELFLAG    = '0'
                           ORDER BY IL.INV_LINE_NUM, IL.INV_LINE_SUB_NUM, IL.INV_LINE_SUB_TRX_NUM) X
                  WHERE ROWNUM = 1 )
               ,(SELECT COA_PROD_CD
                   FROM (SELECT MD.COA_PROD_CD
                          FROM INV_LINE IL , MDSE MD
                          WHERE IL.GLBL_CMPY_CD     = C.GLBL_CMPY_CD
                            AND IL.INV_NUM          = C.INV_NUM
                            AND IL.CPO_ORD_NUM      = C.CPO_ORD_NUM
                            AND IL.DS_ORD_POSN_NUM  = C.DS_ORD_POSN_NUM
                            AND IL.EZCANCELFLAG     = '0'
                            AND MD.GLBL_CMPY_CD     = IL.GLBL_CMPY_CD
                            AND MD.MDSE_CD          = IL.MDSE_CD
                            AND MD.COA_MDSE_TP_CD   &lt;&gt; #coaMdseTpAA#
                            AND MD.EZCANCELFLAG     = '0'
                            ORDER BY IL.CPO_DTL_LINE_NUM, IL.CPO_DTL_LINE_SUB_NUM) Y
                   WHERE ROWNUM = 1 )
            <!-- START 2024/02/06 S.Fujita [QC#61468, ADD] -->
                ,(SELECT
                      COA_PROD_CD
                  FROM
                      (SELECT
                           MD.COA_PROD_CD
                       FROM
                           INV_LINE IL
                          ,MDSE MD
                          ,(SELECT
                                 DTL.RELN_INV_NUM
                                ,INV.GLBL_CMPY_CD
                                ,INV.CPO_ORD_NUM
                                ,INV.CPO_DTL_LINE_NUM
                                ,INV.CPO_DTL_LINE_SUB_NUM
                            FROM
                                 INV_LINE INV
                                ,SVC_INV_LINE SVIL
                                ,FRT_CHRG_REPL_DTL DTL
                                ,MDSE MD
                            WHERE
                                    SVIL.GLBL_CMPY_CD    = C.GLBL_CMPY_CD
                                AND SVIL.SVC_INV_LINE_PK = C.SVC_INV_LINE_PK
                                AND SVIL.EZCANCELFLAG    = '0'
                                AND DTL.GLBL_CMPY_CD     = SVIL.GLBL_CMPY_CD
                                AND DTL.SVC_INV_NUM      = SVIL.SVC_INV_NUM
                                AND DTL.SVC_INV_LINE_NUM = SVIL.SVC_INV_LINE_NUM
                                AND DTL.EZCANCELFLAG     = SVIL.EZCANCELFLAG
                                AND INV.GLBL_CMPY_CD     = DTL.GLBL_CMPY_CD
                                AND INV.INV_NUM          = DTL.RELN_INV_NUM
                                AND INV.INV_BOL_LINE_NUM = DTL.RELN_INV_BOL_LINE_NUM
                                AND INV.INV_LINE_NUM     = DTL.RELN_INV_LINE_NUM
                                AND INV.EZCANCELFLAG     = DTL.EZCANCELFLAG
                                AND MD.GLBL_CMPY_CD      = INV.GLBL_CMPY_CD
                                AND MD.MDSE_CD           = INV.MDSE_CD
                                AND MD.COA_MDSE_TP_CD    = #coaMdseTpAA#
                                AND MD.EZCANCELFLAG      = INV.EZCANCELFLAG
                            ) RELN
                        WHERE
                                IL.GLBL_CMPY_CD        = RELN.GLBL_CMPY_CD
                            AND IL.INV_NUM             = RELN.RELN_INV_NUM
                            AND IL.CPO_ORD_NUM         = RELN.CPO_ORD_NUM
                            AND IL.CPO_DTL_LINE_NUM    = RELN.CPO_DTL_LINE_NUM
                            AND IL.CPO_DTL_LINE_SUB_NUM= RELN.CPO_DTL_LINE_SUB_NUM
                            AND IL.EZCANCELFLAG        = '0'
                            AND MD.GLBL_CMPY_CD    = IL.GLBL_CMPY_CD
                            AND MD.MDSE_CD         = IL.MDSE_CD
                            AND MD.COA_MDSE_TP_CD  &lt;&gt; #coaMdseTpAA#
                            AND MD.EZCANCELFLAG    = IL.EZCANCELFLAG
                        ORDER BY IL.INV_LINE_NUM, IL.INV_LINE_SUB_NUM, IL.INV_LINE_SUB_TRX_NUM) RELN_INV_LINE
                  WHERE ROWNUM = 1 )
            <!-- END 2024/02/06 S.Fujita [QC#61468, ADD] -->
                     , CLBT.FRT_COA_PROD_CD)                     AS "LINE-ITEM_PROD_CD"
            <!-- End add 2019/10/01 QC#53639 -->
            <!-- START 2019/11/12 H.Umeda [QC#54357, ADD] -->
            ,COALESCE(    -- "LINE-ITEM_PROJ_CD"
               (SELECT COA_MDSE_TP_CD 
                  FROM (SELECT MD.COA_MDSE_TP_CD
                          FROM INV_LINE IL , MDSE MD
                         WHERE IL.GLBL_CMPY_CD    = C.GLBL_CMPY_CD
                           AND IL.INV_NUM         = C.INV_NUM
                           AND IL.DS_ORD_POSN_NUM = C.DS_ORD_POSN_NUM
                           AND IL.BASE_CMPT_FLG   = #flgY#
                           AND IL.EZCANCELFLAG    = '0'
                           AND MD.GLBL_CMPY_CD    = IL.GLBL_CMPY_CD
                           AND MD.MDSE_CD         = IL.MDSE_CD
                           AND MD.EZCANCELFLAG    = '0') W
                 WHERE ROWNUM = 1 )
              ,(SELECT COA_MDSE_TP_CD
                  FROM (SELECT MD.COA_MDSE_TP_CD 
                          FROM INV_LINE IL , MDSE MD
                         WHERE IL.GLBL_CMPY_CD        = C.GLBL_CMPY_CD
                           AND IL.INV_NUM             = C.INV_NUM
                           AND IL.CPO_ORD_NUM         = C.CPO_ORD_NUM
                           AND IL.CPO_DTL_LINE_NUM    = C.CPO_DTL_LINE_NUM
                           AND IL.CPO_DTL_LINE_SUB_NUM    = C.CPO_DTL_LINE_SUB_NUM
                           AND IL.EZCANCELFLAG        = '0'
                           AND MD.GLBL_CMPY_CD    = IL.GLBL_CMPY_CD
                           AND MD.MDSE_CD         = IL.MDSE_CD
                           AND MD.COA_MDSE_TP_CD  &lt;&gt; #coaMdseTpAA#
                           AND MD.EZCANCELFLAG    = '0'
                           ORDER BY IL.INV_LINE_NUM, IL.INV_LINE_SUB_NUM, IL.INV_LINE_SUB_TRX_NUM) X
                  WHERE ROWNUM = 1 )
               ,(SELECT COA_MDSE_TP_CD
                   FROM (SELECT MD.COA_MDSE_TP_CD
                          FROM INV_LINE IL , MDSE MD
                          WHERE IL.GLBL_CMPY_CD     = C.GLBL_CMPY_CD
                            AND IL.INV_NUM          = C.INV_NUM
                            AND IL.CPO_ORD_NUM      = C.CPO_ORD_NUM
                            AND IL.DS_ORD_POSN_NUM  = C.DS_ORD_POSN_NUM
                            AND IL.EZCANCELFLAG     = '0'
                            AND MD.GLBL_CMPY_CD     = IL.GLBL_CMPY_CD
                            AND MD.MDSE_CD          = IL.MDSE_CD
                            AND MD.COA_MDSE_TP_CD   &lt;&gt; #coaMdseTpAA#
                            AND MD.EZCANCELFLAG     = '0'
                            ORDER BY IL.CPO_DTL_LINE_NUM, IL.CPO_DTL_LINE_SUB_NUM) Y
                   WHERE ROWNUM = 1 )
            <!-- START 2024/02/06 S.Fujita [QC#61468, ADD] -->
                ,(SELECT
                      COA_MDSE_TP_CD
                  FROM
                      (SELECT
                           MD.COA_MDSE_TP_CD
                       FROM
                           INV_LINE IL
                          ,MDSE MD
                          ,(SELECT
                                 DTL.RELN_INV_NUM
                                ,INV.GLBL_CMPY_CD
                                ,INV.CPO_ORD_NUM
                                ,INV.CPO_DTL_LINE_NUM
                                ,INV.CPO_DTL_LINE_SUB_NUM
                            FROM
                                 INV_LINE INV
                                ,SVC_INV_LINE SVIL
                                ,FRT_CHRG_REPL_DTL DTL
                                ,MDSE MD
                            WHERE
                                    SVIL.GLBL_CMPY_CD    = C.GLBL_CMPY_CD
                                AND SVIL.SVC_INV_LINE_PK = C.SVC_INV_LINE_PK
                                AND SVIL.EZCANCELFLAG    = '0'
                                AND DTL.GLBL_CMPY_CD     = SVIL.GLBL_CMPY_CD
                                AND DTL.SVC_INV_NUM      = SVIL.SVC_INV_NUM
                                AND DTL.SVC_INV_LINE_NUM = SVIL.SVC_INV_LINE_NUM
                                AND DTL.EZCANCELFLAG     = '0'
                                AND INV.GLBL_CMPY_CD     = DTL.GLBL_CMPY_CD
                                AND INV.INV_NUM          = DTL.RELN_INV_NUM
                                AND INV.INV_BOL_LINE_NUM = DTL.RELN_INV_BOL_LINE_NUM
                                AND INV.INV_LINE_NUM     = DTL.RELN_INV_LINE_NUM
                                AND INV.EZCANCELFLAG     = '0'
                                AND MD.GLBL_CMPY_CD      = INV.GLBL_CMPY_CD
                                AND MD.MDSE_CD           = INV.MDSE_CD
                                AND MD.COA_MDSE_TP_CD    = #coaMdseTpAA#
                                AND MD.EZCANCELFLAG      = '0'
                            ) RELN
                        WHERE
                                IL.GLBL_CMPY_CD        = RELN.GLBL_CMPY_CD
                            AND IL.INV_NUM             = RELN.RELN_INV_NUM
                            AND IL.CPO_ORD_NUM         = RELN.CPO_ORD_NUM
                            AND IL.CPO_DTL_LINE_NUM    = RELN.CPO_DTL_LINE_NUM
                            AND IL.CPO_DTL_LINE_SUB_NUM= RELN.CPO_DTL_LINE_SUB_NUM
                            AND IL.EZCANCELFLAG        = '0'
                            AND MD.GLBL_CMPY_CD    = IL.GLBL_CMPY_CD
                            AND MD.MDSE_CD         = IL.MDSE_CD
                            AND MD.COA_MDSE_TP_CD  &lt;&gt; #coaMdseTpAA#
                            AND MD.EZCANCELFLAG    = IL.EZCANCELFLAG
                        ORDER BY IL.INV_LINE_NUM, IL.INV_LINE_SUB_NUM, IL.INV_LINE_SUB_TRX_NUM) RELN_INV_LINE
                  WHERE ROWNUM = 1 )
            <!-- END 2024/02/06 S.Fujita [QC#61468, ADD] -->
                     , AOC.COA_PROJ_CD)                     AS "LINE-ITEM_PROJ_CD"
            <!-- END   2019/11/12 H.Umeda [QC#54357, ADD] -->
        FROM
             DS_INV_SLS_CR      A
            ,INV                B
            ,INV_LINE           C
            ,INV_BOL            D
            ,SYS_SRC            F
            ,DFRD_ACCTG_RULE    G
            ,DS_INV_TP          H
            ,TOC                I
            ,MDSE               J
            ,COA_TAX_ST         K
            ,SELL_TO_CUST       L
            ,BILL_TO_CUST       M
            ,SELL_TO_CUST       LS
            ,BILL_TO_CUST       MS
            ,SVC_INV_LINE       O
            ,SVC_MACH_MSTR      P
            ,AJE_COA_PROD_MAP   Q
            ,LINE_BIZ_TP        LBT
            ,LINE_BIZ_TP        LBT1
            ,LINE_BIZ_TP        LBT2
            ,LINE_BIZ_TP        LBT3
            ,LINE_BIZ_TP        LBT_SLD
            ,MDSE               MDS
            ,CM_DEF_ACCT        CDA
            ,MDSE               MDSE_MACH
            ,SVC_CONFIG_MSTR    SCM
            ,SVC_MACH_MSTR      SMM
            ,INV                R
            ,BILL_TO_CUST       T
            ,SELL_TO_CUST       V
            <!-- START 2019/08/26 H.Umeda [QC#52972, ADD] -->
            ,AJE_COA_AFFL_MAP   U
            <!-- END   2019/08/26 H.Umeda [QC#52972, ADD] -->
            ,AJE_INV_LINE_ALLOC AILA
            ,SVC_INV_LINE       SIL
            ,DS_CONTR           DCH
            ,DS_CONTR_DTL       DCD
            ,SHIP_TO_CUST       STC
            ,SVC_BR_POST_XREF   SBPX
            ,SVC_BR_FIN_BR_XREF SBFX
            ,SVC_BR_POST_XREF   SBPX_5
            ,SVC_BR_FIN_BR_XREF SBFX_5
            ,AJE_COA_PROD_MAP   CPM
            ,COA_BR             CB
            ,DS_CONTR           DCH2
            ,SVC_INV            SI
            <!-- START 2018/11/09 E.Kameishi [QC#29153, DEL] -->
            <!-- 
            ,(SELECT DISTINCT
                  OCB.GLBL_CMPY_CD
                 ,OCB.EZCANCELFLAG
                 ,OCB.DS_ORD_CATG_CD
                 ,DBA.DS_BIZ_AREA_CD
              FROM
                  ORD_CATG_BIZ_CTX  OCB
                 ,DS_BIZ_AREA       DBA
              WHERE
                  OCB.GLBL_CMPY_CD             = #glblCmpyCd#
              AND OCB.EZCANCELFLAG             = '0'
              AND OCB.GLBL_CMPY_CD             = DBA.GLBL_CMPY_CD
              AND OCB.SCD_BIZ_CTX_ATTRB_TXT    = DBA.DS_BIZ_AREA_CD
              AND DBA.EZCANCELFLAG             = '0'
             ) OC
              -->
            <!-- END 2018/11/09 E.Kameishi [QC#29153, DEL] -->
            ,AJE_ORD_CATG       AOC
            ,COA_CC             CC
            ,COA_LINE_BIZ_TP    CLBT
            ,MDSE               MDSE_FRT
            ,DS_ORD_TP_PROC_DFN OTP
            ,LINE_BIZ_TP        LBT4

        WHERE
                A.GLBL_CMPY_CD                 = #glblCmpyCd#
            <isNotNull property="invNum">
            AND A.INV_NUM                      = #invNum#
            </isNotNull>
            AND B.GLBL_CMPY_CD                 = A.GLBL_CMPY_CD
            AND B.INV_NUM                      = A.INV_NUM
            <isNull property="invNum">
            AND B.FNLZ_INV_FLG                 = #flgN#
            AND B.SYS_SRC_CD                   &lt;&gt; #nfc#
            AND B.ACCT_DT                      like  #procYrMth#
            </isNull>
            <isNotNull property="divideNum">
            AND MOD(TO_NUMBER(B.SELL_TO_CUST_CD), #multiCalcCnt#) = #divideNum#
            </isNotNull>
            AND C.GLBL_CMPY_CD                 = A.GLBL_CMPY_CD
            AND C.INV_NUM                      = A.INV_NUM
            AND C.INV_BOL_LINE_NUM             = A.INV_BOL_LINE_NUM
            AND C.INV_LINE_NUM                 = A.INV_LINE_NUM
            AND C.INV_LINE_SUB_NUM             = A.INV_LINE_SUB_NUM
            AND D.GLBL_CMPY_CD                 = A.GLBL_CMPY_CD
            AND D.INV_NUM                      = A.INV_NUM
            AND D.INV_BOL_LINE_NUM             = A.INV_BOL_LINE_NUM
            AND F.GLBL_CMPY_CD(+)              = A.GLBL_CMPY_CD
            AND F.SYS_SRC_CD(+)                = B.SYS_SRC_CD
            AND B.GLBL_CMPY_CD                 = H.GLBL_CMPY_CD(+)
            AND B.DS_INV_TP_CD                 = H.DS_INV_TP_CD(+)
            AND A.GLBL_CMPY_CD                 = I.GLBL_CMPY_CD(+)
            AND A.SLS_REP_TOC_CD               = I.TOC_CD(+)
            AND I.GLBL_CMPY_CD                 = CC.GLBL_CMPY_CD(+)
            AND I.COA_CC_CD                    = CC.COA_CC_CD(+)
            AND CC.GLBL_CMPY_CD                = CLBT.GLBL_CMPY_CD(+)
            AND CC.COA_LINE_BIZ_TP_CD          = CLBT.COA_LINE_BIZ_TP_CD(+)
            AND C.GLBL_CMPY_CD                 = J.GLBL_CMPY_CD(+)
            AND (CASE WHEN A.INV_LINE_SPL_TP_CD = #dev# THEN C.MDSE_CD
                      ELSE A.MDSE_CD END)      = J.MDSE_CD(+)
            AND D.GLBL_CMPY_CD         = K.GLBL_CMPY_CD(+)
            AND NVL(D.ORIG_SHIP_TO_ST_CD, NVL(D.SHIP_TO_ST_CD, M.ST_CD))  = K.COA_TAX_ST_CD(+)
            AND K.COA_TAX_CTRY_CD(+)           = NVL(D.SHIP_TO_CTRY_CD, 'US')
            AND B.GLBL_CMPY_CD                 = L.GLBL_CMPY_CD(+)
            AND B.BILL_TO_CUST_ACCT_CD         = L.SELL_TO_CUST_CD(+)
            AND B.GLBL_CMPY_CD                 = M.GLBL_CMPY_CD(+)
            AND B.BILL_TO_CUST_CD              = M.BILL_TO_CUST_CD(+)
            AND B.GLBL_CMPY_CD                 = LS.GLBL_CMPY_CD(+)
            AND B.SELL_TO_CUST_CD              = LS.SELL_TO_CUST_CD(+)
            AND B.GLBL_CMPY_CD                 = MS.GLBL_CMPY_CD(+)
            AND B.SOLD_TO_CUST_LOC_CD          = MS.BILL_TO_CUST_CD(+)
            AND C.GLBL_CMPY_CD                 = O.GLBL_CMPY_CD(+)
            AND C.SVC_INV_LINE_PK              = O.SVC_INV_LINE_PK(+)
            AND O.GLBL_CMPY_CD                 = P.GLBL_CMPY_CD(+)
            AND O.SVC_MACH_MSTR_PK             = P.SVC_MACH_MSTR_PK(+)
            AND A.EZCANCELFLAG                 = '0'
            AND B.EZCANCELFLAG                 = '0'
            AND C.EZCANCELFLAG                 = '0'
            AND D.EZCANCELFLAG                 = '0'
            AND F.EZCANCELFLAG(+)              = '0'
            AND H.EZCANCELFLAG(+)              = '0'
            AND I.EZCANCELFLAG(+)              = '0'
            AND J.EZCANCELFLAG(+)              = '0'
            AND K.EZCANCELFLAG(+)              = '0'
            AND L.EZCANCELFLAG(+)              = '0'
            AND M.EZCANCELFLAG(+)              = '0'
            AND LS.EZCANCELFLAG(+)             = '0'
            AND MS.EZCANCELFLAG(+)             = '0'
            AND O.EZCANCELFLAG(+)              = '0'
            AND P.EZCANCELFLAG(+)              = '0'
            AND Q.EZCANCELFLAG(+)              = '0'
            AND CC.EZCANCELFLAG(+)             = '0'
            AND CLBT.EZCANCELFLAG(+)           = '0'
            AND A.GLBL_CMPY_CD                 = G.GLBL_CMPY_CD(+)
            AND A.EZCANCELFLAG                 = G.EZCANCELFLAG(+)
            AND A.DFRD_ACCTG_RULE_CD           = G.DFRD_ACCTG_RULE_CD(+)
            AND P.GLBL_CMPY_CD                 = LBT_SLD.GLBL_CMPY_CD(+)
            AND P.SLD_BY_LINE_BIZ_TP_CD        = LBT_SLD.LINE_BIZ_TP_CD(+)
            AND P.EZCANCELFLAG(+)              = '0'
            AND P.GLBL_CMPY_CD                 = LBT.GLBL_CMPY_CD(+)
            AND P.EZCANCELFLAG                 = LBT.EZCANCELFLAG(+)
            AND P.SVC_BY_LINE_BIZ_TP_CD        = LBT.LINE_BIZ_TP_CD(+)
            AND DCH.GLBL_CMPY_CD               = LBT1.GLBL_CMPY_CD(+)
            AND DCH.SVC_LINE_BIZ_CD            = LBT1.LINE_BIZ_TP_CD(+)
            AND LBT1.EZCANCELFLAG(+)           = '0'
            AND B.GLBL_CMPY_CD                 = LBT2.GLBL_CMPY_CD(+)
            AND B.LINE_BIZ_TP_CD               = LBT2.LINE_BIZ_TP_CD(+)
            AND LBT2.EZCANCELFLAG(+)           = '0'
            AND C.GLBL_CMPY_CD                 = MDS.GLBL_CMPY_CD(+)
            AND C.MDSE_CD                      = MDS.MDSE_CD(+)
            AND MDS.EZCANCELFLAG(+)            = '0'
            AND DCH2.GLBL_CMPY_CD              = LBT3.GLBL_CMPY_CD(+)
            AND DCH2.SVC_LINE_BIZ_CD           = LBT3.LINE_BIZ_TP_CD(+)
            AND LBT3.EZCANCELFLAG(+)           = '0'
            AND A.GLBL_CMPY_CD                 = CDA.GLBL_CMPY_CD(+)
            AND A.EZCANCELFLAG                 = CDA.EZCANCELFLAG(+)
            AND #csmp#                         = CDA.CM_DEF_ACCT_CD(+)
            AND C.GLBL_CMPY_CD                 = SCM.GLBL_CMPY_CD(+)
            AND C.EZCANCELFLAG                 = SCM.EZCANCELFLAG(+)
            AND C.SVC_CONFIG_MSTR_PK           = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.GLBL_CMPY_CD               = SMM.GLBL_CMPY_CD(+)
            AND SCM.EZCANCELFLAG               = SMM.EZCANCELFLAG(+)
            AND SCM.SVC_MACH_MSTR_PK           = SMM.SVC_MACH_MSTR_PK(+)
            AND MDSE_MACH.GLBL_CMPY_CD(+)      = #glblCmpyCd#
            AND MDSE_MACH.EZCANCELFLAG(+)      = '0'
            <!-- START 2019/06/20 S.Takami [QC#50870,MOD] -->
            <!-- AND NVL(P.MDSE_CD, NVL(SMM.MDSE_CD, C.MDSE_CD))    = MDSE_MACH.MDSE_CD(+) -->
            AND NVL(NVL(SMM.MDSE_CD, P.MDSE_CD), C.MDSE_CD)    = MDSE_MACH.MDSE_CD(+)
            <!-- END 2019/06/20 S.Takami [QC#50870,MOD] -->
            AND MDSE_MACH.GLBL_CMPY_CD         = Q.GLBL_CMPY_CD(+)
            AND MDSE_MACH.COA_PROD_CD          = Q.AJE_COA_PROD_MAP_CD(+)
            AND B.CSMP_ORIG_INV_NUM            = R.INV_NUM(+)
            AND B.GLBL_CMPY_CD                 = R.GLBL_CMPY_CD(+)
            AND R.EZCANCELFLAG(+)              = '0'
            AND R.SOLD_TO_CUST_LOC_CD          = T.BILL_TO_CUST_CD(+)
            AND R.GLBL_CMPY_CD                 = T.GLBL_CMPY_CD(+)
            AND T.EZCANCELFLAG(+)              = '0'
            AND R.SELL_TO_CUST_CD              = V.SELL_TO_CUST_CD(+)
            AND R.GLBL_CMPY_CD                 = V.GLBL_CMPY_CD(+)
            AND V.EZCANCELFLAG(+)              = '0'
            <!-- START 2019/08/26 H.Umeda [QC#52972,ADD] -->
            AND U.EZCANCELFLAG(+)              = '0'
            AND LS.GLBL_CMPY_CD                 = U.GLBL_CMPY_CD(+)
            AND LS.COA_AFFL_CD                  = U.AJE_COA_AFFL_MAP_CD(+)
            <!-- END   2019/08/26 H.Umeda [QC#52972,ADD] -->
            AND A.GLBL_CMPY_CD                 = AILA.GLBL_CMPY_CD(+)
            AND A.AJE_INV_LINE_ALLOC_CD        = AILA.AJE_INV_LINE_ALLOC_CD(+)
            AND AILA.EZCANCELFLAG(+)           = '0'
            AND C.GLBL_CMPY_CD                 = SIL.GLBL_CMPY_CD(+)
            AND C.SVC_INV_LINE_PK              = SIL.SVC_INV_LINE_PK(+)
            AND SIL.EZCANCELFLAG(+)            = '0'
            AND SIL.GLBL_CMPY_CD               = DCH.GLBL_CMPY_CD(+)
            AND SIL.DS_CONTR_PK                = DCH.DS_CONTR_PK(+)
            AND DCH.EZCANCELFLAG(+)            = '0'
            AND SIL.GLBL_CMPY_CD               = DCD.GLBL_CMPY_CD(+)
            AND SIL.DS_CONTR_DTL_PK            = DCD.DS_CONTR_DTL_PK(+)
            AND DCD.EZCANCELFLAG(+)            = '0'
            AND DCD.GLBL_CMPY_CD               = STC.GLBL_CMPY_CD(+)
            AND DCD.SHIP_TO_CUST_CD            = STC.SHIP_TO_CUST_CD(+)
            AND STC.EZCANCELFLAG(+)            = '0'
            AND STC.GLBL_CMPY_CD               = SBPX.GLBL_CMPY_CD(+)
            AND STC.POST_CD                    = SBPX.POST_CD(+)
            AND DCH.SVC_LINE_BIZ_CD            = SBPX.SVC_LINE_BIZ_CD(+)
            AND SBPX.EZCANCELFLAG(+)           = '0'
            AND SBPX.GLBL_CMPY_CD              = SBFX.GLBL_CMPY_CD(+)
            AND SBPX.SVC_BR_CD                 = SBFX.SVC_BR_CD(+)
            <!-- START 2018/09/10 K.Kitachi [QC#26260, MOD] -->
            <!-- AND SBPX.SVC_LINE_BIZ_CD           = SBFX.SVC_LINE_BIZ_CD(+) -->
            AND SBPX.SVC_LINE_BIZ_CD           = SBFX.SVC_BY_LINE_BIZ_TP_CD(+)
            AND SBPX.SVC_LINE_BIZ_CD           = SBFX.SLD_BY_LINE_BIZ_TP_CD(+)
            <!-- END 2018/09/10 K.Kitachi [QC#26260, MOD] -->
            AND SBFX.EZCANCELFLAG(+)           = '0'
            AND STC.GLBL_CMPY_CD               = SBPX_5.GLBL_CMPY_CD(+)
            AND SUBSTR(STC.POST_CD,1,5)        = SBPX_5.POST_CD(+)
            AND SBPX_5.EZCANCELFLAG(+)         = '0'
            AND DCH.SVC_LINE_BIZ_CD            = SBPX_5.SVC_LINE_BIZ_CD(+)
            AND SBPX_5.GLBL_CMPY_CD            = SBFX_5.GLBL_CMPY_CD(+)
            AND SBPX_5.SVC_BR_CD               = SBFX_5.SVC_BR_CD(+)
            <!-- START 2018/09/10 K.Kitachi [QC#26260, MOD] -->
            <!-- AND SBPX_5.SVC_LINE_BIZ_CD         = SBFX_5.SVC_LINE_BIZ_CD(+) -->
            AND SBPX_5.SVC_LINE_BIZ_CD         = SBFX_5.SVC_BY_LINE_BIZ_TP_CD(+)
            AND SBPX_5.SVC_LINE_BIZ_CD         = SBFX_5.SLD_BY_LINE_BIZ_TP_CD(+)
            <!-- END 2018/09/10 K.Kitachi [QC#26260, MOD] -->
            AND SBFX_5.EZCANCELFLAG(+)         = '0'
            AND #glblCmpyCd#                   = CPM.GLBL_CMPY_CD(+)
            AND 'FLT'                          = CPM.AJE_COA_PROD_MAP_CD(+)
            AND CB.EZCANCELFLAG(+)             = '0'
            AND I.GLBL_CMPY_CD                 = CB.GLBL_CMPY_CD(+)
            AND I.COA_BR_CD                    = CB.COA_BR_CD(+)
            AND NOT EXISTS (
                SELECT
                    'X'
                FROM
                    AJE_INV_ACCT_DIST    H
                WHERE
                        H.GLBL_CMPY_CD         = #glblCmpyCd#
                    AND H.DS_INV_SLS_CR_PK     = A.DS_INV_SLS_CR_PK
                    AND H.EZCANCELFLAG         = '0'
            )
            AND B.GLBL_CMPY_CD                 = SI.GLBL_CMPY_CD(+)
            AND B.SVC_INV_PK                   = SI.SVC_INV_PK(+)
            AND B.EZCANCELFLAG                 = SI.EZCANCELFLAG(+)
            AND SI.GLBL_CMPY_CD                = DCH2.GLBL_CMPY_CD(+)
            AND SI.DS_CONTR_PK                 = DCH2.DS_CONTR_PK(+)
            <!-- START 2018/11/09 E.Kameishi [QC#29153, MOD] -->
            <!-- 
            AND B.GLBL_CMPY_CD                 = OC.GLBL_CMPY_CD(+)
            AND B.DS_ORD_CATG_CD               = OC.DS_ORD_CATG_CD(+)
            AND OC.EZCANCELFLAG(+)             = '0'
            AND OC.GLBL_CMPY_CD                = AOC.GLBL_CMPY_CD(+)
            AND OC.DS_BIZ_AREA_CD              = AOC.AJE_ORD_CATG_CD(+)
            AND AOC.EZCANCELFLAG(+)            = '0'
            -->
            AND B.GLBL_CMPY_CD                = AOC.GLBL_CMPY_CD(+)
            AND B.DS_BIZ_AREA_CD              = AOC.AJE_ORD_CATG_CD(+)
            AND AOC.EZCANCELFLAG(+)            = '0'
            <!-- END 2018/11/09 E.Kameishi [QC#29153, MOD] -->
            AND A.GLBL_CMPY_CD                 = MDSE_FRT.GLBL_CMPY_CD(+)
            AND A.MDSE_CD                      = MDSE_FRT.MDSE_CD(+)
            AND MDSE_FRT.EZCANCELFLAG(+)       = '0'
            AND B.GLBL_CMPY_CD                 = OTP.GLBL_CMPY_CD(+)
            AND B.DS_ORD_TP_CD                 = OTP.DS_ORD_TP_CD(+)
            AND OTP.EZCANCELFLAG(+)            = '0'
            AND OTP.GLBL_CMPY_CD               = LBT4.GLBL_CMPY_CD(+)
            AND OTP.LINE_BIZ_TP_CD             = LBT4.LINE_BIZ_TP_CD(+)
            AND LBT4.EZCANCELFLAG(+)           = '0'
            ORDER BY
                 INV_NUM
                ,INV_BOL_LINE_NUM
                ,INV_LINE_NUM
                ,INV_LINE_SUB_NUM
                ,DS_INV_SLS_CR_PK
    </statement>
    <!-- end 2018/03/12 QC#23689 -->
    <statement id="getSegInfoForSvc" parameterClass="Map" resultClass="Map">
        SELECT
             DC.GLBL_CMPY_CD
            ,DC.DS_CONTR_NUM
            ,DC.DS_CONTR_PK
            ,DCD.DS_CONTR_DTL_PK
            ,#immediate#                                                                               AS AJE_ACCTG_RULE_CD
            ,#invoice#                                                                                 AS INV_INVTY_IND_TP_CD
            <!-- start add 2019/01/07 QC#29734 -->
            ,(CASE
                WHEN
                     <iterate property="varRental" var="varRental[]" open="MDS_2.SVC_ALLOC_TP_CD IN (" close=")" conjunction=",">
                     #varRental[]#
                     </iterate>
                     THEN #re#
                ELSE #nonRe#
             END)                                                                                      AS SVC_ALLOC_IND_TP_CD
             <!-- end add 2019/01/07 QC#29734 -->
            ,NVL(SMM.FIN_BR_CD, NVL(NVL(SBFX.FIN_BR_CD, SBPX.SVC_BR_CD), NVL(SBFX_5.FIN_BR_CD, SBPX_5.SVC_BR_CD)))
                                                                                                       AS "IB_BR_CD"
            ,(CASE WHEN CB.COA_BR_TP_CD = #newcore# THEN TOC.COA_BR_CD
                   ELSE #defBrNewcore# END)                                                            AS "NEWCORE_BR_CD"
            <!-- start mod 2019/05/09 QC#50129 -->
            ,(CASE WHEN CB.COA_BR_TP_CD = #newcore# THEN TOC.COA_CC_CD
                   ELSE NVL(LBT_SLD.ASSET_COA_CC_CD, LBT2.ASSET_COA_CC_CD) END)                        AS "NEWCORE_CC_CD"
            <!-- end mod 2019/05/09 QC#50129 -->
            ,TOC.COA_EXTN_CD                                                                           AS "TOC_EXTN_CD"
            ,NVL(BTC.COA_CH_CD, STC.COA_CH_CD)                                                         AS "SELL-SITE_CH_CD"
            ,STC.COA_AFFL_CD                                                                           AS "SELL-CUST_AFFL_CD"
            ,MDS.COA_MDSE_TP_CD                                                                        AS "ITEM_PROJ_CD"
            ,NVL(ACPM1.AJE_COA_PROD_MAP_TO_CD, NVL(MDS.COA_PROD_CD, ACPM2.AJE_COA_PROD_MAP_TO_CD))     AS "MACH-MAP_PROD_CD"
            ,(CASE
                WHEN DC.DS_CONTR_CATG_CD   =  #dsContrCatgFLEET#
                    THEN LBT2.SPLY_COA_CC_CD
                WHEN MDS.SVC_ALLOC_TP_CD    = #svcAllocTpOPTIMA#
                    THEN LBT3.SPLY_COA_CC_CD
                ELSE
                    NVL(LBT1.SPLY_COA_CC_CD, LBT2.SPLY_COA_CC_CD)
             END)                                                                                      AS "LOB-SPLY_CC_CD"
            ,(CASE
                WHEN DC.DS_CONTR_CATG_CD   = #dsContrCatgFLEET#
                    THEN LBT2.SVC_COA_CC_CD
                WHEN MDS.SVC_ALLOC_TP_CD    = #svcAllocTpOPTIMA#
                    THEN LBT3.SVC_COA_CC_CD
                ELSE
                    NVL(LBT1.SVC_COA_CC_CD, LBT2.SVC_COA_CC_CD)
             END)                                                                                      AS "LOB-SVC_CC_CD"
            <!-- start add 2018/07/05 QC#26320 -->
            ,(CASE
                WHEN DC.DS_CONTR_CATG_CD   =  #dsContrCatgFLEET#
                    THEN LBT2.SPLY_COA_CC_CD
                WHEN MDS.SVC_ALLOC_TP_CD    = #svcAllocTpOPTIMA#
                    THEN LBT3.SPLY_COA_CC_CD
                ELSE
                    NVL(LBT_SLD.SPLY_COA_CC_CD, LBT2.SPLY_COA_CC_CD)
             END)                                                                                      AS "LOB-SPLY-SLD_CC_CD"
            ,(CASE
                WHEN DC.DS_CONTR_CATG_CD   = #dsContrCatgFLEET#
                    THEN LBT2.SVC_COA_CC_CD
                WHEN MDS.SVC_ALLOC_TP_CD    = #svcAllocTpOPTIMA#
                    THEN LBT3.SVC_COA_CC_CD
                ELSE
                    NVL(LBT_SLD.SVC_COA_CC_CD, LBT2.SVC_COA_CC_CD)
             END)                                                                                      AS "LOB-SVC-SLD_CC_CD"
            <!-- END add 2018/07/05 QC#26320 -->
            <!-- START add 2018/09/18 QC#28296 -->
            ,MDS.COA_PROD_CD                                                                           AS "MACH_PROD_CD"
            ,MDS.COA_MDSE_TP_CD                                                                        AS "MACH_PROJ_CD"
            ,MDS.COA_CC_CD                                                                             AS "MACH_CC_CD"
            <!-- END   add 2018/09/18 QC#28296 -->
        FROM
             DS_CONTR             DC
            ,DS_CONTR_DTL         DCD
            ,SVC_MACH_MSTR        SMM
            ,MDSE                 MDS
            ,SELL_TO_CUST         STC
            ,BILL_TO_CUST         BTC
            ,SHIP_TO_CUST         SHC
            ,LINE_BIZ_TP          LBT1
            ,LINE_BIZ_TP          LBT2
            ,LINE_BIZ_TP          LBT3
            ,LINE_BIZ_TP          LBT_SLD
            ,SVC_BR_POST_XREF     SBPX
            ,SVC_BR_POST_XREF     SBPX_5
            ,SVC_BR_FIN_BR_XREF   SBFX
            ,SVC_BR_FIN_BR_XREF   SBFX_5
            ,COA_BR               CB
            ,TOC                  TOC
            ,AJE_COA_PROD_MAP     ACPM1
            ,AJE_COA_PROD_MAP     ACPM2
            ,CPO                  CPO
            ,DS_ORD_TP_PROC_DFN   OTPD
            ,MDSE                 MDS_2
        WHERE
             DC.GLBL_CMPY_CD           = #glblCmpyCd#
        AND  DC.EZCANCELFLAG           = '0'
        AND  DC.DS_CONTR_PK            = #dsContrPk#
        AND  DC.GLBL_CMPY_CD           = DCD.GLBL_CMPY_CD
        AND  DC.DS_CONTR_PK            = DCD.DS_CONTR_PK
        AND  DC.EZCANCELFLAG           = '0'
        AND  DCD.GLBL_CMPY_CD          = SMM.GLBL_CMPY_CD(+)
        AND  DCD.SVC_MACH_MSTR_PK      = SMM.SVC_MACH_MSTR_PK(+)
        AND  SMM.EZCANCELFLAG(+)       = '0'
        AND  DCD.GLBL_CMPY_CD          = SHC.GLBL_CMPY_CD(+)
        AND  DCD.SHIP_TO_CUST_CD       = SHC.SHIP_TO_CUST_CD(+)
        AND  SHC.EZCANCELFLAG(+)       = '0'
        AND  SHC.GLBL_CMPY_CD          = SBPX.GLBL_CMPY_CD(+)
        AND  SHC.POST_CD               = SBPX.POST_CD(+)
        AND  DC.SVC_LINE_BIZ_CD        = SBPX.SVC_LINE_BIZ_CD(+)
        AND  SBPX.EZCANCELFLAG(+)      = '0'
        AND  SBPX.GLBL_CMPY_CD         = SBFX.GLBL_CMPY_CD(+)
        AND  SBPX.SVC_BR_CD            = SBFX.SVC_BR_CD(+)
        <!-- START 2018/09/10 K.Kitachi [QC#26260, MOD] -->
        <!-- AND  SBPX.SVC_LINE_BIZ_CD      = SBFX.SVC_LINE_BIZ_CD(+) -->
        AND  SBPX.SVC_LINE_BIZ_CD      = SBFX.SVC_BY_LINE_BIZ_TP_CD(+)
        AND  SBPX.SVC_LINE_BIZ_CD      = SBFX.SLD_BY_LINE_BIZ_TP_CD(+)
        <!-- END 2018/09/10 K.Kitachi [QC#26260, MOD] -->
        AND  SBFX.EZCANCELFLAG(+)      = '0'
        AND  SHC.GLBL_CMPY_CD          = SBPX_5.GLBL_CMPY_CD(+)
        AND  SUBSTR(SHC.POST_CD,1,5)   = SBPX_5.POST_CD(+)
        AND  DC.SVC_LINE_BIZ_CD        = SBPX_5.SVC_LINE_BIZ_CD(+)
        AND  SBPX_5.EZCANCELFLAG(+)    = '0'
        AND  SBPX_5.GLBL_CMPY_CD       = SBFX_5.GLBL_CMPY_CD(+)
        AND  SBPX_5.SVC_BR_CD          = SBFX_5.SVC_BR_CD(+)
        <!-- START 2018/09/10 K.Kitachi [QC#26260, MOD] -->
        <!-- AND  SBPX_5.SVC_LINE_BIZ_CD    = SBFX_5.SVC_LINE_BIZ_CD(+) -->
        AND  SBPX_5.SVC_LINE_BIZ_CD    = SBFX_5.SVC_BY_LINE_BIZ_TP_CD(+)
        AND  SBPX_5.SVC_LINE_BIZ_CD    = SBFX_5.SLD_BY_LINE_BIZ_TP_CD(+)
        <!-- END 2018/09/10 K.Kitachi [QC#26260, MOD] -->
        AND  SBFX_5.EZCANCELFLAG(+)    = '0'
        AND  DC.GLBL_CMPY_CD           = TOC.GLBL_CMPY_CD(+)
        AND  DC.TOC_CD                 = TOC.TOC_CD(+)
        AND  TOC.EZCANCELFLAG(+)       = '0'
        AND  TOC.GLBL_CMPY_CD          = CB.GLBL_CMPY_CD(+)
        AND  TOC.COA_BR_CD             = CB.COA_BR_CD(+)
        AND  CB.EZCANCELFLAG(+)        = '0'
        AND  SMM.GLBL_CMPY_CD          = LBT1.GLBL_CMPY_CD(+)
        AND  SMM.SVC_BY_LINE_BIZ_TP_CD = LBT1.LINE_BIZ_TP_CD(+)
        AND  LBT1.EZCANCELFLAG(+)      = '0'
        AND  SMM.GLBL_CMPY_CD          = LBT_SLD.GLBL_CMPY_CD(+)
        AND  SMM.SLD_BY_LINE_BIZ_TP_CD = LBT_SLD.LINE_BIZ_TP_CD(+)
        AND  LBT_SLD.EZCANCELFLAG(+)      = '0'
        AND  DC.GLBL_CMPY_CD           = LBT2.GLBL_CMPY_CD(+)
        AND  DC.SVC_LINE_BIZ_CD        = LBT2.LINE_BIZ_TP_CD(+)
        AND  LBT2.EZCANCELFLAG(+)      = '0'
        AND  DC.GLBL_CMPY_CD           = CPO.GLBL_CMPY_CD(+)
        AND  DC.CPO_ORD_NUM            = CPO.CPO_ORD_NUM(+)
        AND  CPO.EZCANCELFLAG(+)       = '0'
        AND  CPO.GLBL_CMPY_CD          = OTPD.GLBL_CMPY_CD(+)
        AND  CPO.DS_ORD_TP_CD          = OTPD.DS_ORD_TP_CD(+)
        AND  OTPD.EZCANCELFLAG(+)      = '0'
        AND  OTPD.GLBL_CMPY_CD         = LBT3.GLBL_CMPY_CD(+)
        AND  OTPD.LINE_BIZ_TP_CD       = LBT3.LINE_BIZ_TP_CD(+)
        AND  LBT3.EZCANCELFLAG(+)      = '0'
        AND  SMM.GLBL_CMPY_CD          = MDS.GLBL_CMPY_CD(+)
        AND  SMM.MDSE_CD               = MDS.MDSE_CD(+)
        AND  MDS.EZCANCELFLAG(+)       = '0'
        AND  MDS.GLBL_CMPY_CD          = ACPM1.GLBL_CMPY_CD(+)
        AND  MDS.COA_PROD_CD           = ACPM1.AJE_COA_PROD_MAP_CD(+)
        AND  ACPM1.EZCANCELFLAG(+)     = '0'
        AND  #glblCmpyCd#              = ACPM2.GLBL_CMPY_CD(+)
        AND  #dsContrCatgFLEET#        = ACPM2.AJE_COA_PROD_MAP_CD(+)
        AND  ACPM2.EZCANCELFLAG(+)     = '0'
        AND  DCD.GLBL_CMPY_CD          = BTC.GLBL_CMPY_CD(+)
        AND  DCD.BASE_BILL_TO_CUST_CD  = BTC.BILL_TO_CUST_CD(+)
        AND  BTC.EZCANCELFLAG(+)       = '0'
        AND  DC.GLBL_CMPY_CD           = STC.GLBL_CMPY_CD(+)
        AND  DC.DS_ACCT_NUM            = STC.SELL_TO_CUST_CD(+)
        AND  STC.EZCANCELFLAG(+)       = '0'
        <!-- start add 2019/01/07 QC#29734 -->
        AND  DCD.GLBL_CMPY_CD          = MDS_2.GLBL_CMPY_CD(+)
        AND  DCD.SVC_PGM_MDSE_CD       = MDS_2.MDSE_CD(+)
        AND  MDS_2.EZCANCELFLAG(+)     = '0'
        <!-- start add 2019/01/07 QC#29734 -->
    </statement>
    
    <statement id="getBsPlTp" parameterClass="Map" resultClass="String">
        SELECT
             BS_PL_TP_CD
        FROM
             COA_ACCT       CA
            ,TRIAL_BAL_TP   TBT
        WHERE
                CA.GLBL_CMPY_CD     = #glblCmpyCd#
            AND CA.COA_ACCT_CD      = #coaAcctCd#
            AND CA.EZCANCELFLAG     = '0'
            AND CA.GLBL_CMPY_CD     = TBT.GLBL_CMPY_CD
            AND CA.TRIAL_BAL_TP_CD  = TBT.TRIAL_BAL_TP_CD
            AND TBT.EZCANCELFLAG    = '0'
    </statement>
</sqlMap>	
