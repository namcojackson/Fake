<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWAL1500QueryForAutoAdd">

    <typeAlias alias="RTL_SWHTMsg"            type="business.db.RTL_SWHTMsg"/>
    <!-- 2017/10/19 S21_NA#21843 Add Start -->
    <typeAlias alias="MDL_NMTMsg"             type="business.db.MDL_NMTMsg"/>
    <!-- 2017/10/19 S21_NA#21843 Add End -->

    <statement id="getRtlSwhRecByInvtyLocCd" parameterClass="Map" resultMap="result.getRtlSwhRecByInvtyLocCd">
        SELECT
            RSW.GLBL_CMPY_CD
            , RSW.RTL_WH_CD
            , RSW.RTL_SWH_CD
            , RSW.RTL_SWH_NM
            , RSW.RTL_SWH_DESC_TXT
            , RSW.RTL_WH_CATG_CD
            , RSW.INVTY_LOC_CD
            , RSW.PRTY_LOC_FLG
            , RSW.RTL_SWH_DSBL_FLG
            , RSW.EFF_FROM_DT
            , RSW.EFF_THRU_DT
            , RSW.MRP_ENBL_FLG
        FROM
            RTL_SWH RSW
        WHERE
            RSW.GLBL_CMPY_CD        = #glblCmpyCd#
            AND RSW.INVTY_LOC_CD    = #invtyLocCd#
            AND RSW.EZCANCELFLAG    = '0'
        ORDER BY
              RSW.RTL_WH_CD
            , RSW.RTL_SWH_CD
    </statement>
    <resultMap id="result.getRtlSwhRecByInvtyLocCd" class="RTL_SWHTMsg">
        <result property="glblCmpyCd"       column="GLBL_CMPY_CD"       javaType="EZDTStringItem"/>
        <result property="rtlWhCd"          column="RTL_WH_CD"          javaType="EZDTStringItem"/>
        <result property="rtlSwhCd"         column="RTL_SWH_CD"         javaType="EZDTStringItem"/>
        <result property="rtlSwhNm"         column="RTL_SWH_NM"         javaType="EZDTStringItem"/>
        <result property="rtlSwhDescTxt"    column="RTL_SWH_DESC_TXT"   javaType="EZDTStringItem"/>
        <result property="rtlWhCatgCd"      column="RTL_WH_CATG_CD"     javaType="EZDTStringItem"/>
        <result property="invtyLocCd"       column="INVTY_LOC_CD"       javaType="EZDTStringItem"/>
        <result property="prtyLocFlg"       column="PRTY_LOC_FLG"       javaType="EZDTStringItem"/>
        <result property="rtlSwhDsblFlg"    column="RTL_SWH_DSBL_FLG"   javaType="EZDTStringItem"/>
        <result property="effFromDt"        column="EFF_FROM_DT"        javaType="EZDTStringItem"/>
        <result property="effThruDt"        column="EFF_THRU_DT"        javaType="EZDTStringItem"/>
        <result property="mrpEnblFlg"       column="MRP_ENBL_FLG"       javaType="EZDTStringItem"/>
    </resultMap>

    <!-- 2017/10/19 S21_NA#21843 Add Start -->
    <statement id="getMdlInfoBySvcConfigMstrPk" parameterClass="Map" resultMap="result.getMdlInfoBySvcConfigMstrPk">
        SELECT
              MN.T_MDL_ID
            , MN.T_MDL_NM
        FROM
              SVC_CONFIG_MSTR SCM
            , MDL_NM          MN
        WHERE
              SCM.GLBL_CMPY_CD         = #glblCmpyCd#
          AND SCM.SVC_CONFIG_MSTR_PK   = #svcConfigMstrPk#
          AND SCM.EZCANCELFLAG         = '0'
          AND SCM.GLBL_CMPY_CD         = MN.T_GLBL_CMPY_CD(+)
          AND SCM.MDL_ID               = MN.T_MDL_ID(+)
          AND MN.EZCANCELFLAG(+)       = '0'
    </statement>
    <resultMap id="result.getMdlInfoBySvcConfigMstrPk" class="MDL_NMTMsg">
        <result property="t_MdlId"          column="T_MDL_ID"           javaType="EZDTBigDecimalItem"/>
        <result property="t_MdlNm"          column="T_MDL_NM"           javaType="EZDTStringItem"/>
    </resultMap>
    <!-- 2017/10/19 S21_NA#21843 Add End -->

    <!-- 2018/05/17 S21_NA#22988 Add Start -->
    <statement id="isAvalLineCatgForDefWh" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(1) CNT
        FROM
            ORD_LINE_VAL_SET VS 
        WHERE
            VS.GLBL_CMPY_CD                 = #glblCmpyCd#
            AND VS.ORD_LINE_CTX_TP_CD       = #forceDummyWh#
            AND VS.SCD_BIZ_CTX_ATTRB_TXT    = #rtlWhCd#
            AND VS.DS_ORD_LINE_CATG_CD      = #dsOrdLineCatgCd#
            AND VS.EZCANCELFLAG             = '0'
    </statement>
    <!-- 2018/05/17 S21_NA#22988 Add End -->
    <!-- 2018/10/16 S21_NA#28772 Add Start -->
    <statement id="getSvcConfig" parameterClass="Map" resultClass="Map">
        SELECT
             SER_NUM
           , MDSE_CD
           , CUR_LOC_NUM
           , SVC_MACH_USG_STS_CD
           , SVC_MACH_MSTR_STS_CD
           , SVC_MACH_MSTR_PK
           , SVC_MACH_TP_CD
           , RANK
        FROM (
            SELECT
                SCM.SVC_CONFIG_MSTR_PK          SVC_CONFIG_MSTR_PK
               ,SMM.SER_NUM                     SER_NUM
               ,SMM.MDSE_CD                     MDSE_CD
               ,SMM.CUR_LOC_NUM                 CUR_LOC_NUM
               ,SMM.SVC_MACH_USG_STS_CD         SVC_MACH_USG_STS_CD
               ,SMM.SVC_MACH_MSTR_STS_CD        SVC_MACH_MSTR_STS_CD
               ,SMM.SVC_MACH_MSTR_PK            SVC_MACH_MSTR_PK
               ,SMM.SVC_MACH_TP_CD              SVC_MACH_TP_CD
               ,RANK() OVER(
                   PARTITION BY DCD.SVC_MACH_MSTR_PK
                   ORDER BY 
                       NVL(DCD.CONTR_CLO_DT, DCD.CONTR_EFF_THRU_DT) DESC
                       ,DECODE(DC.DS_CONTR_CATG_CD, #warranty#, 2, 1)
                       ,DCD.DS_CONTR_PK DESC
               ) RANK
            FROM
                SVC_MACH_MSTR           SMM
               ,SVC_CONFIG_MSTR         SCM
               ,DS_CONTR_DTL            DCD
               ,DS_CONTR                DC
            WHERE
                SMM.GLBL_CMPY_CD         = #glblCmpyCd#
            AND SMM.SVC_CONFIG_MSTR_PK   = #svcConfigMstrPk#
            AND SMM.EZCANCELFLAG         = '0'
            AND SMM.GLBL_CMPY_CD         = SCM.GLBL_CMPY_CD(+)
            AND SMM.SVC_CONFIG_MSTR_PK   = SCM.SVC_CONFIG_MSTR_PK(+)
            AND SCM.EZCANCELFLAG(+)      = '0'
            AND SMM.GLBL_CMPY_CD         = DCD.GLBL_CMPY_CD(+)
            AND SMM.SVC_MACH_MSTR_PK     = DCD.SVC_MACH_MSTR_PK(+)
            AND DCD.CONTR_EFF_FROM_DT(+) &lt;= #slsDate#
            AND NVL(DCD.CONTR_CLO_DT(+), DCD.CONTR_EFF_THRU_DT(+)) &gt;= #slsDate#
            AND DCD.DS_CONTR_DTL_STS_CD(+) NOT IN (#dsContrDtlStsCanc#)
            AND DCD.EZCANCELFLAG(+)      = '0'
            AND DCD.GLBL_CMPY_CD         = DC.GLBL_CMPY_CD(+)
            AND DCD.DS_CONTR_PK          = DC.DS_CONTR_PK(+)
            AND DC.EZCANCELFLAG(+)       = '0'
            ORDER BY
                SMM.SVC_CONFIG_MSTR_PK
               ,SMM.SVC_MACH_TP_CD
               ,SMM.SVC_MACH_MSTR_PK
       ) A
       WHERE
           RANK  = 1
    </statement>
    <!-- 2018/10/16 S21_NA#28772 Add End -->
</sqlMap>