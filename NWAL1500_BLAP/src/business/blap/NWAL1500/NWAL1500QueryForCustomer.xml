<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NWAL1500QueryForCustomer">

    <statement id="getBillToCustAddr" parameterClass="Map" resultClass="Map">
        SELECT
            BILL_TO_ADDR
          , ENT_BILL_TO_ADDR
           <!-- S21_NA#1623 -->
           ,BILL_TO_FIRST_LINE_ADDR
           ,BILL_TO_SCD_LINE_ADDR
           ,BILL_TO_THIRD_LINE_ADDR
           ,BILL_TO_FRTH_LINE_ADDR
           ,BILL_TO_CTY_ADDR
           ,BILL_TO_ST_CD
           ,BILL_TO_POST_CD
           <!-- QC#26151 -->
           ,BILL_TO_ACCT_CD
           ,BILL_TO_ACCT_NM
        FROM
            (
             SELECT
                 (
                  CASE WHEN BTC.FIRST_LINE_ADDR IS NOT NULL THEN
                      BTC.FIRST_LINE_ADDR || ' ' ||
                      BTC.SCD_LINE_ADDR   || ' ' ||
                      BTC.THIRD_LINE_ADDR || ' ' ||
                      BTC.FRTH_LINE_ADDR  || ' ' ||
                      BTC.CTY_ADDR        || ',' ||
                      BTC.ST_CD           || ' ' ||
                      BTC.POST_CD
                  END) AS BILL_TO_ADDR
                  <!-- QC#1694 -->
               , (CASE WHEN BTC.FIRST_LINE_ADDR IS NOT NULL THEN
                     DECODE (BTC.FIRST_LINE_ADDR, NULL, '', CONCAT(BTC.FIRST_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (BTC.SCD_LINE_ADDR, NULL, '', CONCAT(BTC.SCD_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (BTC.THIRD_LINE_ADDR, NULL, '', CONCAT(BTC.THIRD_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (BTC.FRTH_LINE_ADDR, NULL, '', CONCAT(BTC.FRTH_LINE_ADDR, CHR(13) || CHR(10)))
                  || CONCAT (BTC.CTY_ADDR, ',')
                  || RPAD (BTC.ST_CD, LENGTH (BTC.ST_CD) + 1)
                  || BTC.POST_CD
                  END) AS ENT_BILL_TO_ADDR
                  <!-- S21_NA#1623 -->
                ,BTC.FIRST_LINE_ADDR    AS BILL_TO_FIRST_LINE_ADDR
                ,BTC.SCD_LINE_ADDR      AS BILL_TO_SCD_LINE_ADDR
                ,BTC.THIRD_LINE_ADDR    AS BILL_TO_THIRD_LINE_ADDR
                ,BTC.FRTH_LINE_ADDR     AS BILL_TO_FRTH_LINE_ADDR
                ,BTC.CTY_ADDR           AS BILL_TO_CTY_ADDR
                ,BTC.ST_CD              AS BILL_TO_ST_CD
                ,BTC.POST_CD            AS BILL_TO_POST_CD
               <!-- QC#26151 -->
                ,BTC.SELL_TO_CUST_CD    AS BILL_TO_ACCT_CD
                ,BTC.DS_ACCT_NM         AS BILL_TO_ACCT_NM
             FROM
                 BILL_TO_CUST BTC
             WHERE
                 BTC.GLBL_CMPY_CD        = #glblCmpyCd#
                 AND BTC.BILL_TO_CUST_CD = #billToCustCd#
                 AND BTC.RGTN_STS_CD     = #rgtnStsCd#
                 AND BTC.EZCANCELFLAG    = '0'
             ORDER BY
                 BTC.BILL_TO_CUST_PK DESC
            )
        WHERE
            ROWNUM = 1
    </statement>

    <statement id="getShipToCustAddr" parameterClass="Map" resultClass="Map">
        SELECT
            SHIP_TO_CUST_CD
           ,SHIP_TO_ADDR
           ,ENT_SHIP_TO_ADDR
           ,ADDL_LOC_NM
           ,FIRST_LINE_ADDR
           ,SCD_LINE_ADDR
           ,THIRD_LINE_ADDR
           ,FRTH_LINE_ADDR
           ,FIRST_REF_CMNT_TXT
           ,SCD_REF_CMNT_TXT
           ,CTY_ADDR
           ,ST_CD
           ,POST_CD
           ,PROV_NM
           ,CTRY_CD
           ,CNTY_NM
           <!-- Add Start 2019/01/31 QC# -->
           ,DS_ACCT_NUM
           ,DS_ACCT_NM
           <!-- Add End 2019/01/31 QC# -->
        FROM
            (
             SELECT
                 STC.SHIP_TO_CUST_CD    AS SHIP_TO_CUST_CD
                ,(
                  CASE WHEN STC.FIRST_LINE_ADDR IS NOT NULL THEN
                      STC.FIRST_LINE_ADDR || ' ' ||
                      STC.SCD_LINE_ADDR   || ' ' ||
                      STC.THIRD_LINE_ADDR || ' ' ||
                      STC.FRTH_LINE_ADDR  || ' ' ||
                      STC.CTY_ADDR        || ',' ||
                      STC.ST_CD           || ' ' ||
                      STC.POST_CD
                  END)                  AS SHIP_TO_ADDR
                <!-- QC#1694 -->
                ,(
                  CASE WHEN STC.FIRST_LINE_ADDR IS NOT NULL THEN
                      DECODE (STC.FIRST_LINE_ADDR, NULL, '', CONCAT(STC.FIRST_LINE_ADDR, CHR(13) || CHR(10)))
                   || DECODE (STC.SCD_LINE_ADDR, NULL, '', CONCAT(STC.SCD_LINE_ADDR, CHR(13) || CHR(10)))
                   || DECODE (STC.THIRD_LINE_ADDR, NULL, '', CONCAT(STC.THIRD_LINE_ADDR, CHR(13) || CHR(10)))
                   || DECODE (STC.FRTH_LINE_ADDR, NULL, '', CONCAT(STC.FRTH_LINE_ADDR, CHR(13) || CHR(10)))
                   || CONCAT (STC.CTY_ADDR, ',')
                   || RPAD (STC.ST_CD, LENGTH (STC.ST_CD) + 1)
                   || STC.POST_CD
                  END)                  AS ENT_SHIP_TO_ADDR
                ,STC.ADDL_LOC_NM        AS ADDL_LOC_NM
                ,STC.FIRST_LINE_ADDR    AS FIRST_LINE_ADDR
                ,STC.SCD_LINE_ADDR      AS SCD_LINE_ADDR
                ,STC.THIRD_LINE_ADDR    AS THIRD_LINE_ADDR
                ,STC.FRTH_LINE_ADDR     AS FRTH_LINE_ADDR
                ,STC.FIRST_REF_CMNT_TXT AS FIRST_REF_CMNT_TXT
                ,STC.SCD_REF_CMNT_TXT   AS SCD_REF_CMNT_TXT
                ,STC.CTY_ADDR           AS CTY_ADDR
                ,STC.ST_CD              AS ST_CD
                ,STC.POST_CD            AS POST_CD
                ,STC.PROV_NM            AS PROV_NM
                ,STC.CTRY_CD            AS CTRY_CD
                ,CNTY.CNTY_NM           AS CNTY_NM
                <!-- Add Start 2019/01/31 QC# -->
                ,STC.SELL_TO_CUST_CD    AS DS_ACCT_NUM
                ,STC.DS_ACCT_NM         AS DS_ACCT_NM
                <!-- Add End 2019/01/31 QC# -->
             FROM
                 SHIP_TO_CUST STC
                ,CNTY         CNTY
             WHERE
                 STC.GLBL_CMPY_CD        = #glblCmpyCd#
                 AND STC.SHIP_TO_CUST_CD = #shipToCustCd#
                 AND STC.RGTN_STS_CD     = #rgtnStsCd#
                 AND STC.EZCANCELFLAG    = '0'

                 AND STC.GLBL_CMPY_CD      = CNTY.GLBL_CMPY_CD (+)
                 AND STC.CNTY_PK           = CNTY.CNTY_PK (+)
                 AND CNTY.EZCANCELFLAG (+) = '0'
             ORDER BY
                 STC.SHIP_TO_CUST_PK DESC
            )
        WHERE
            ROWNUM = 1
    </statement>

    <statement id="getBillToCustInfoList" parameterClass="Map" resultClass="Map">
        SELECT
            BTC.BILL_TO_CUST_CD     AS BILL_TO_CUST_CD
            ,(
              CASE WHEN BTC.FIRST_LINE_ADDR IS NOT NULL THEN
                  BTC.FIRST_LINE_ADDR || ' ' ||
                  BTC.SCD_LINE_ADDR   || ' ' ||
                  BTC.THIRD_LINE_ADDR || ' ' ||
                  BTC.FRTH_LINE_ADDR  || ' ' ||
                  BTC.CTY_ADDR        || ',' ||
                  BTC.ST_CD           || ' ' ||
                  BTC.POST_CD
              END)                  AS BILL_TO_ADDR
            <!-- QC#1694 -->
            ,(
              CASE WHEN BTC.FIRST_LINE_ADDR IS NOT NULL THEN
                  
                     DECODE (BTC.FIRST_LINE_ADDR, NULL, '', CONCAT(BTC.FIRST_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (BTC.SCD_LINE_ADDR, NULL, '', CONCAT(BTC.SCD_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (BTC.THIRD_LINE_ADDR, NULL, '', CONCAT(BTC.THIRD_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (BTC.FRTH_LINE_ADDR, NULL, '', CONCAT(BTC.FRTH_LINE_ADDR, CHR(13) || CHR(10)))
                  || CONCAT (BTC.CTY_ADDR, ',')
                  || RPAD (BTC.ST_CD, LENGTH (BTC.ST_CD) + 1)
                  || BTC.POST_CD
              END)                  AS ENT_BILL_TO_ADDR
            ,DAC.SELL_TO_CUST_CD    AS DS_ACCT_NUM
            ,DAC.DS_ACCT_NM         AS DS_ACCT_NM
        FROM
            BILL_TO_CUST    BTC
           ,SELL_TO_CUST    DAC
        <!-- 2019/08/28 QC#53021 Add Start -->
           ,ACCT_LOC        AC
           ,PTY_LOC_WRK     PLW
        <!-- 2019/08/28 QC#53021 Add End -->
        WHERE
            BTC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND BTC.BILL_TO_CUST_CD LIKE #custCd#
            AND BTC.RGTN_STS_CD     = #rgtnStsCd#
            AND BTC.EZCANCELFLAG    = '0'

        <!-- 2019/08/28 QC#53021 Mod Start -->
            AND PLW.GLBL_CMPY_CD    = BTC.GLBL_CMPY_CD
            AND PLW.PTY_LOC_PK      = BTC.PTY_LOC_PK
            AND PLW.RGTN_STS_CD     = #rgtnStsCd#
            AND PLW.EZCANCELFLAG    = '0'
            AND AC.GLBL_CMPY_CD     = PLW.GLBL_CMPY_CD
            AND AC.LOC_NUM          = PLW.LOC_NUM
            AND AC.RGTN_STS_CD      = #rgtnStsCd#
            AND AC.EZCANCELFLAG     = '0'
            AND AC.GLBL_CMPY_CD     = DAC.GLBL_CMPY_CD
            AND AC.DS_ACCT_NUM      = DAC.SELL_TO_CUST_CD
        <!--     AND BTC.GLBL_CMPY_CD    = DAC.GLBL_CMPY_CD    -->
        <!--     AND BTC.SELL_TO_CUST_CD = DAC.SELL_TO_CUST_CD  -->
        <!-- 2019/08/28 QC#53021 Mod End -->
            AND DAC.RGTN_STS_CD     = #rgtnStsCd#
            AND DAC.EZCANCELFLAG    = '0'
            AND ROWNUM          &lt;= 2  <!-- 2018/03/12 S21_NA#24090 Add -->
    </statement>

    <statement id="getShipToCustInfoList" parameterClass="Map" resultClass="Map">
        SELECT
            STC.SHIP_TO_CUST_CD     AS SHIP_TO_CUST_CD
            ,(
              CASE WHEN STC.FIRST_LINE_ADDR IS NOT NULL THEN
                  STC.FIRST_LINE_ADDR || ' ' ||
                  STC.SCD_LINE_ADDR   || ' ' ||
                  STC.THIRD_LINE_ADDR || ' ' ||
                  STC.FRTH_LINE_ADDR  || ' ' ||
                  STC.CTY_ADDR        || ',' ||
                  STC.ST_CD           || ' ' ||
                  STC.POST_CD
              END)                  AS SHIP_TO_ADDR
            <!-- QC#1694 -->
            ,(
              CASE WHEN STC.FIRST_LINE_ADDR IS NOT NULL THEN
                     DECODE (STC.FIRST_LINE_ADDR, NULL, '', CONCAT(STC.FIRST_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (STC.SCD_LINE_ADDR, NULL, '', CONCAT(STC.SCD_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (STC.THIRD_LINE_ADDR, NULL, '', CONCAT(STC.THIRD_LINE_ADDR, CHR(13) || CHR(10)))
                  || DECODE (STC.FRTH_LINE_ADDR, NULL, '', CONCAT(STC.FRTH_LINE_ADDR, CHR(13) || CHR(10)))
                  || CONCAT (STC.CTY_ADDR, ',')
                  || RPAD (STC.ST_CD, LENGTH (STC.ST_CD) + 1)
                  || STC.POST_CD
              END)                  AS ENT_SHIP_TO_ADDR
            ,STC.ADDL_LOC_NM        AS ADDL_LOC_NM
            ,STC.FIRST_LINE_ADDR    AS FIRST_LINE_ADDR
            ,STC.SCD_LINE_ADDR      AS SCD_LINE_ADDR
            ,STC.THIRD_LINE_ADDR    AS THIRD_LINE_ADDR
            ,STC.FRTH_LINE_ADDR     AS FRTH_LINE_ADDR
            ,STC.FIRST_REF_CMNT_TXT AS FIRST_REF_CMNT_TXT
            ,STC.SCD_REF_CMNT_TXT   AS SCD_REF_CMNT_TXT
            ,STC.CTY_ADDR           AS CTY_ADDR
            ,STC.ST_CD              AS ST_CD
            ,STC.POST_CD            AS POST_CD
            ,STC.PROV_NM            AS PROV_NM
            ,STC.CTRY_CD            AS CTRY_CD
            ,DAC.SELL_TO_CUST_CD    AS DS_ACCT_NUM
            ,DAC.DS_ACCT_NM         AS DS_ACCT_NM
            ,CNTY.CNTY_NM           AS CNTY_NM
        FROM
            SHIP_TO_CUST STC
           ,SELL_TO_CUST DAC
           ,CNTY         CNTY
        <!-- 2019/08/28 QC#53021 Add Start -->
           ,ACCT_LOC     AC
           ,PTY_LOC_WRK  PLW
        <!-- 2019/08/28 QC#53021 Add End -->
        WHERE
            STC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND STC.SHIP_TO_CUST_CD LIKE #shipToCustCd#
            AND STC.RGTN_STS_CD     = #rgtnStsCd#
            AND STC.EZCANCELFLAG    = '0'
            
        <!-- 2019/08/28 QC#53021 Mod Start -->
            AND PLW.GLBL_CMPY_CD    = STC.GLBL_CMPY_CD
            AND PLW.PTY_LOC_PK      = STC.PTY_LOC_PK
            AND PLW.RGTN_STS_CD     = #rgtnStsCd#
            AND PLW.EZCANCELFLAG    = '0'
            AND AC.GLBL_CMPY_CD     = PLW.GLBL_CMPY_CD
            AND AC.LOC_NUM          = PLW.LOC_NUM
            AND AC.RGTN_STS_CD      = #rgtnStsCd#
            AND AC.EZCANCELFLAG     = '0'
            AND AC.GLBL_CMPY_CD     = DAC.GLBL_CMPY_CD
            AND AC.DS_ACCT_NUM      = DAC.SELL_TO_CUST_CD
        <!-- AND STC.GLBL_CMPY_CD    = DAC.GLBL_CMPY_CD    -->
        <!-- AND STC.SELL_TO_CUST_CD = DAC.SELL_TO_CUST_CD -->
        <!-- 2019/08/28 QC#53021 Mod End -->
            AND DAC.RGTN_STS_CD     = #rgtnStsCd#
            AND DAC.EZCANCELFLAG    = '0'
            AND STC.GLBL_CMPY_CD      = CNTY.GLBL_CMPY_CD (+)
            AND STC.CNTY_PK           = CNTY.CNTY_PK (+)
            AND CNTY.EZCANCELFLAG (+) = '0'
            AND ROWNUM          &lt;= 2  <!-- 2018/03/12 S21_NA#24090 Add -->
    </statement>

</sqlMap>
