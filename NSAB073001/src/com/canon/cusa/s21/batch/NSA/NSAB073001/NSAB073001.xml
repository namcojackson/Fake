<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NSAB073001">

    <statement id="getContractCreditCardVoid" parameterClass="Map" resultClass="Map">
        SELECT
            A.CR_CARD_TRX_PK
            ,A.CR_CARD_CUST_REF_NUM
            ,A.CR_CARD_AUTH_REF_NUM
            ,A.BILL_TO_CUST_ACCT_CD
            ,A.CR_CARD_AUTH_DT
            ,A.CR_CARD_SETL_DT
            ,A.CR_CARD_AUTH_STS_CD
            ,A.CR_CARD_AUTH_AMT
            ,A.CR_CARD_AUTH_TAX_AMT
            ,A.CR_CARD_TRX_TP_CD
            ,A.FIRST_TRX_INFO_TXT
            ,A.SCD_TRX_INFO_TXT
            ,A.THIRD_TRX_INFO_TXT
            ,A.FRTH_TRX_INFO_TXT
            ,A.FIFTH_TRX_INFO_TXT
            ,A.FIRST_TRX_INFO_NUM
            ,A.SCD_TRX_INFO_NUM
            ,A.THIRD_TRX_INFO_NUM
            ,A.FRTH_TRX_INFO_NUM
            ,A.FIFTH_TRX_INFO_NUM
            ,A.AUTH_STS_MSG_CMNT_TXT
            ,A.ORIG_CR_CARD_TRX_PK
            ,A.CR_CARD_TRX_PROC_STS_CD
            ,A.CR_CARD_TRX_APVL_STS_CD
            ,A.CR_CARD_REF_IDX_NUM
            ,A.CR_CARD_CANC_DT
        FROM
            CR_CARD_TRX A
        WHERE
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        AND A.CR_CARD_AUTH_STS_CD   = #cardAuthSaved#
        AND A.CR_CARD_TRX_TP_CD     = #cardTrxTpCntrH#
        AND A.EZCANCELFLAG          = '0'
        AND (   EXISTS (
                    SELECT
                        1
                    FROM
                        DS_CONTR B
                        ,DS_CONTR_STS_V C
                    WHERE
                        B.GLBL_CMPY_CD          = A.GLBL_CMPY_CD
                    AND B.DS_CONTR_PK           = A.FIRST_TRX_INFO_NUM
                    AND B.PMT_TERM_CASH_DISC_CD = #pmtTermCashDiscCc#
                    AND B.EZCANCELFLAG          = '0'
                    AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
                    AND B.DS_CONTR_PK           = C.DS_CONTR_PK
                    AND C.DS_CONTR_CTRL_STS_CD  = #dsContrCtrlStsCanc#
                    AND C.EZCANCELFLAG          = '0'
                )
                OR NOT EXISTS (
                    SELECT
                        1
                    FROM
                        DS_CONTR B
                    WHERE
                        B.GLBL_CMPY_CD   = A.GLBL_CMPY_CD
                    AND B.DS_CONTR_PK    = A.FIRST_TRX_INFO_NUM
                    AND B.EZCANCELFLAG   = '0'
                )
        )
        UNION ALL
        SELECT
            A.CR_CARD_TRX_PK
            ,A.CR_CARD_CUST_REF_NUM
            ,A.CR_CARD_AUTH_REF_NUM
            ,A.BILL_TO_CUST_ACCT_CD
            ,A.CR_CARD_AUTH_DT
            ,A.CR_CARD_SETL_DT
            ,A.CR_CARD_AUTH_STS_CD
            ,A.CR_CARD_AUTH_AMT
            ,A.CR_CARD_AUTH_TAX_AMT
            ,A.CR_CARD_TRX_TP_CD
            ,A.FIRST_TRX_INFO_TXT
            ,A.SCD_TRX_INFO_TXT
            ,A.THIRD_TRX_INFO_TXT
            ,A.FRTH_TRX_INFO_TXT
            ,A.FIFTH_TRX_INFO_TXT
            ,A.FIRST_TRX_INFO_NUM
            ,A.SCD_TRX_INFO_NUM
            ,A.THIRD_TRX_INFO_NUM
            ,A.FRTH_TRX_INFO_NUM
            ,A.FIFTH_TRX_INFO_NUM
            ,A.AUTH_STS_MSG_CMNT_TXT
            ,A.ORIG_CR_CARD_TRX_PK
            ,A.CR_CARD_TRX_PROC_STS_CD
            ,A.CR_CARD_TRX_APVL_STS_CD
            ,A.CR_CARD_REF_IDX_NUM
            ,A.CR_CARD_CANC_DT
        FROM
            CR_CARD_TRX A
        WHERE
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        AND A.CR_CARD_AUTH_STS_CD   = #cardAuthSaved#
        AND A.CR_CARD_TRX_TP_CD     = #cardTrxTpCntrD#
        AND A.EZCANCELFLAG          = '0'
        AND (   EXISTS (
                    SELECT
                        1
                    FROM
                        DS_CONTR_DTL B
                        ,DS_CONTR_DTL_STS_V C
                        ,DS_CONTR D
                    WHERE
                        B.GLBL_CMPY_CD          = A.GLBL_CMPY_CD
                    AND B.DS_CONTR_DTL_PK       = A.SCD_TRX_INFO_NUM
                    AND B.EZCANCELFLAG          = '0'
                    AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
                    AND B.DS_CONTR_DTL_PK       = C.DS_CONTR_DTL_PK
                    AND C.DS_CONTR_CTRL_STS_CD  = #dsContrCtrlStsCanc#
                    AND C.EZCANCELFLAG          = '0'
                    AND B.GLBL_CMPY_CD          = D.GLBL_CMPY_CD
                    AND B.DS_CONTR_PK           = D.DS_CONTR_PK
                    AND D.PMT_TERM_CASH_DISC_CD = #pmtTermCashDiscCc#
                    AND D.EZCANCELFLAG          = '0'
                )
                OR NOT EXISTS (
                    SELECT
                        1
                    FROM
                        DS_CONTR_DTL B
                    WHERE
                        B.GLBL_CMPY_CD          = A.GLBL_CMPY_CD
                    AND B.DS_CONTR_DTL_PK       = A.SCD_TRX_INFO_NUM
                    AND B.EZCANCELFLAG          = '0'
                )
        )
        UNION ALL
        SELECT
            A.CR_CARD_TRX_PK
            ,A.CR_CARD_CUST_REF_NUM
            ,A.CR_CARD_AUTH_REF_NUM
            ,A.BILL_TO_CUST_ACCT_CD
            ,A.CR_CARD_AUTH_DT
            ,A.CR_CARD_SETL_DT
            ,A.CR_CARD_AUTH_STS_CD
            ,A.CR_CARD_AUTH_AMT
            ,A.CR_CARD_AUTH_TAX_AMT
            ,A.CR_CARD_TRX_TP_CD
            ,A.FIRST_TRX_INFO_TXT
            ,A.SCD_TRX_INFO_TXT
            ,A.THIRD_TRX_INFO_TXT
            ,A.FRTH_TRX_INFO_TXT
            ,A.FIFTH_TRX_INFO_TXT
            ,A.FIRST_TRX_INFO_NUM
            ,A.SCD_TRX_INFO_NUM
            ,A.THIRD_TRX_INFO_NUM
            ,A.FRTH_TRX_INFO_NUM
            ,A.FIFTH_TRX_INFO_NUM
            ,A.AUTH_STS_MSG_CMNT_TXT
            ,A.ORIG_CR_CARD_TRX_PK
            ,A.CR_CARD_TRX_PROC_STS_CD
            ,A.CR_CARD_TRX_APVL_STS_CD
            ,A.CR_CARD_REF_IDX_NUM
            ,A.CR_CARD_CANC_DT
        FROM
            CR_CARD_TRX A
        WHERE
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        AND A.CR_CARD_AUTH_STS_CD   = #cardAuthSaved#
        AND A.CR_CARD_TRX_TP_CD     = #cardTrxTpCntrM#
        AND A.EZCANCELFLAG          = '0'
        AND (   EXISTS (
                    SELECT
                        1
                    FROM
                        DS_CONTR_BLLG_MTR B
                        ,DS_CONTR_BLLG_MTR_STS_V C
                        ,DS_CONTR_DTL D
                        ,DS_CONTR E
                    WHERE
                        B.GLBL_CMPY_CD          = A.GLBL_CMPY_CD
                    AND B.DS_CONTR_BLLG_MTR_PK  = A.THIRD_TRX_INFO_NUM
                    AND B.EZCANCELFLAG          = '0'            
                    AND B.GLBL_CMPY_CD          = C.GLBL_CMPY_CD
                    AND B.DS_CONTR_BLLG_MTR_PK  = C.DS_CONTR_BLLG_MTR_PK
                    AND C.DS_CONTR_CTRL_STS_CD  = #dsContrCtrlStsCanc#
                    AND C.EZCANCELFLAG          = '0'
                    AND B.GLBL_CMPY_CD          = D.GLBL_CMPY_CD
                    AND B.DS_CONTR_DTL_PK       = D.DS_CONTR_DTL_PK
                    AND D.EZCANCELFLAG          = '0'
                    AND D.GLBL_CMPY_CD          = E.GLBL_CMPY_CD
                    AND D.DS_CONTR_PK           = E.DS_CONTR_PK
                    AND E.PMT_TERM_CASH_DISC_CD = #pmtTermCashDiscCc#
                    AND E.EZCANCELFLAG          = '0'
                )
                OR NOT EXISTS (
                    SELECT
                        1
                    FROM
                        DS_CONTR_BLLG_MTR B
                    WHERE
                        B.GLBL_CMPY_CD          = A.GLBL_CMPY_CD
                    AND B.DS_CONTR_BLLG_MTR_PK  = A.THIRD_TRX_INFO_NUM
                    AND B.EZCANCELFLAG          = '0' 
                )
        )
        UNION ALL
        SELECT
            A.CR_CARD_TRX_PK
            ,A.CR_CARD_CUST_REF_NUM
            ,A.CR_CARD_AUTH_REF_NUM
            ,A.BILL_TO_CUST_ACCT_CD
            ,A.CR_CARD_AUTH_DT
            ,A.CR_CARD_SETL_DT
            ,A.CR_CARD_AUTH_STS_CD
            ,A.CR_CARD_AUTH_AMT
            ,A.CR_CARD_AUTH_TAX_AMT
            ,A.CR_CARD_TRX_TP_CD
            ,A.FIRST_TRX_INFO_TXT
            ,A.SCD_TRX_INFO_TXT
            ,A.THIRD_TRX_INFO_TXT
            ,A.FRTH_TRX_INFO_TXT
            ,A.FIFTH_TRX_INFO_TXT
            ,A.FIRST_TRX_INFO_NUM
            ,A.SCD_TRX_INFO_NUM
            ,A.THIRD_TRX_INFO_NUM
            ,A.FRTH_TRX_INFO_NUM
            ,A.FIFTH_TRX_INFO_NUM
            ,A.AUTH_STS_MSG_CMNT_TXT
            ,A.ORIG_CR_CARD_TRX_PK
            ,A.CR_CARD_TRX_PROC_STS_CD
            ,A.CR_CARD_TRX_APVL_STS_CD
            ,A.CR_CARD_REF_IDX_NUM
            ,A.CR_CARD_CANC_DT
        FROM
            CR_CARD_TRX A
        WHERE
            A.GLBL_CMPY_CD          = #glblCmpyCd#
        AND A.CR_CARD_AUTH_STS_CD   = #cardAuthSaved#
        AND A.CR_CARD_TRX_TP_CD     IN (#cardTrxTpCntrH#, #cardTrxTpCntrD#, #cardTrxTpCntrM#)
        AND A.EZCANCELFLAG          = '0'
        AND EXISTS (
                    SELECT
                        1
                    FROM
                        DS_CONTR B
                    WHERE
                        A.GLBL_CMPY_CD          = B.GLBL_CMPY_CD
                    AND A.FIRST_TRX_INFO_NUM    = B.DS_CONTR_PK
                    AND B.PMT_TERM_CASH_DISC_CD &lt;&gt; #pmtTermCashDiscCc#
                    AND B.EZCANCELFLAG          = '0'
                )
        ORDER BY
            CR_CARD_TRX_PK
    </statement>

    <statement id="getFsrCreditCardVoid" parameterClass="Map" resultClass="Map">
        SELECT
            A.CR_CARD_TRX_PK
            ,A.CR_CARD_CUST_REF_NUM
            ,A.CR_CARD_AUTH_REF_NUM
            ,A.BILL_TO_CUST_ACCT_CD
            ,A.CR_CARD_AUTH_DT
            ,A.CR_CARD_SETL_DT
            ,A.CR_CARD_AUTH_STS_CD
            ,A.CR_CARD_AUTH_AMT
            ,A.CR_CARD_AUTH_TAX_AMT
            ,A.CR_CARD_TRX_TP_CD
            ,A.FIRST_TRX_INFO_TXT
            ,A.SCD_TRX_INFO_TXT
            ,A.THIRD_TRX_INFO_TXT
            ,A.FRTH_TRX_INFO_TXT
            ,A.FIFTH_TRX_INFO_TXT
            ,A.FIRST_TRX_INFO_NUM
            ,A.SCD_TRX_INFO_NUM
            ,A.THIRD_TRX_INFO_NUM
            ,A.FRTH_TRX_INFO_NUM
            ,A.FIFTH_TRX_INFO_NUM
            ,A.AUTH_STS_MSG_CMNT_TXT
            ,A.ORIG_CR_CARD_TRX_PK
            ,A.CR_CARD_TRX_PROC_STS_CD
            ,A.CR_CARD_TRX_APVL_STS_CD
            ,A.CR_CARD_REF_IDX_NUM
            ,A.CR_CARD_CANC_DT
        FROM
            CR_CARD_TRX A
        WHERE
                A.GLBL_CMPY_CD          = #glblCmpyCd#
            AND A.CR_CARD_TRX_TP_CD     = #cardTrxTpSvcReq#
            AND A.CR_CARD_AUTH_STS_CD   = #cardAuthSaved#
            AND A.EZCANCELFLAG          = '0'
            AND (
                    EXISTS (
                        SELECT
                            1
                        FROM
                            FSR B
                        WHERE
                            B.GLBL_CMPY_CD          = A.GLBL_CMPY_CD
                        AND B.FSR_NUM               = A.FIRST_TRX_INFO_TXT
                        AND B.EZCANCELFLAG          = '0'
                        AND (B.PMT_TERM_CASH_DISC_CD &lt;&gt; #pmtTermCashDiscCc#
                                OR B.FSR_STS_CD         = #svcTaskStsCcl#
                            )
                    )
                    OR NOT EXISTS (
                        SELECT
                            1
                        FROM
                            FSR B
                        WHERE
                            B.GLBL_CMPY_CD          = A.GLBL_CMPY_CD
                        AND B.FSR_NUM               = A.FIRST_TRX_INFO_TXT
                        AND B.EZCANCELFLAG          = '0'
                    )
                )
        ORDER BY
            A.CR_CARD_TRX_PK
    </statement>
</sqlMap>
