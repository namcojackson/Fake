<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAL1260Query">
    <typeAlias alias="NSAL1260CMsg"    type="business.blap.NSAL1260.NSAL1260CMsg"/>
    <statement id="getHeaderInfo" parameterClass="Map" resultMap="result.getHeaderInfo">
        SELECT
             DC.DS_ACCT_NUM            AS DS_ACCT_NUM
            ,SC.DS_ACCT_NM             AS DS_ACCT_NM
            ,DC.CONTR_VRSN_EFF_FROM_DT AS CONTR_VRSN_EFF_FROM_DT
            ,DC.CONTR_VRSN_EFF_THRU_DT AS CONTR_VRSN_EFF_THRU_DT
            ,BC.BLLG_CYCLE_DESC_TXT    AS BLLG_CYCLE_DESC_TXT
            ,BC.BLLG_CYCLE_CD          AS BLLG_CYCLE_CD
        FROM
             DS_CONTR      DC
            ,SELL_TO_CUST  SC
            ,BLLG_CYCLE    BC
        WHERE
                DC.GLBL_CMPY_CD        = #glblCmpyCd#
            AND DC.DS_CONTR_PK         = #dsContrPk#
            AND DC.EZCANCELFLAG        = '0'
            AND DC.GLBL_CMPY_CD        = SC.GLBL_CMPY_CD
            AND DC.DS_ACCT_NUM         = SC.SELL_TO_CUST_CD
            AND SC.EZCANCELFLAG        = '0'
            AND DC.GLBL_CMPY_CD        = BC.GLBL_CMPY_CD
            AND DC.BASE_BLLG_CYCLE_CD  = BC.BLLG_CYCLE_CD
            AND BC.EZCANCELFLAG        = '0'
    </statement>
    <resultMap id="result.getHeaderInfo"         class="NSAL1260CMsg">
        <result property="dsAcctNum_H"           column="DS_ACCT_NUM"             javaType="EZDSStringItem" />
        <result property="dsAcctNm_H"            column="DS_ACCT_NM"              javaType="EZDSStringItem" />
        <result property="contrVrsnEffFromDt_H"  column="CONTR_VRSN_EFF_FROM_DT"  javaType="EZDCDateItem" />
        <result property="contrVrsnEffThruDt_H"  column="CONTR_VRSN_EFF_THRU_DT"  javaType="EZDCDateItem" />
        <result property="bllgCycleDescTxt_H"    column="BLLG_CYCLE_DESC_TXT"     javaType="EZDSStringItem" />
        <result property="bllgCycleCd_H"         column="BLLG_CYCLE_CD"           javaType="EZDSStringItem" />
    </resultMap>

    <statement id="getSvcMachMstr" parameterClass="Map" resultClass="Map">
        SELECT
             MM.SVC_MACH_MSTR_PK       AS SVC_MACH_MSTR_PK
            ,MM.SER_NUM                AS SER_NUM
            ,MM.SVC_CONFIG_MSTR_PK     AS SVC_CONFIG_MSTR_PK
            ,MM.SVC_MACH_MSTR_STS_CD   AS SVC_MACH_MSTR_STS_CD
            ,MM.BILL_TO_ACCT_NUM       AS BILL_TO_ACCT_NUM
            ,SC.DS_ACCT_NM             AS DS_ACCT_NM
        FROM
             SVC_MACH_MSTR  MM
            ,SELL_TO_CUST   SC
        WHERE
                MM.GLBL_CMPY_CD        = #glblCmpyCd#
            <isNotNull property="svcMachMstrPk">
            AND MM.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
            </isNotNull>
            <isNotNull property="serNum">
            AND MM.SER_NUM             = #serNum#
            </isNotNull>
            AND MM.EZCANCELFLAG        = '0'
            AND MM.GLBL_CMPY_CD        = SC.GLBL_CMPY_CD(+)
            AND MM.BILL_TO_ACCT_NUM    = SC.SELL_TO_CUST_CD(+)
            AND SC.EZCANCELFLAG(+)     = '0'
    </statement>

    <statement id="getContrCount" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)                   AS COUNT
        FROM
            DS_CONTR_DTL  CD
        WHERE
                CD.GLBL_CMPY_CD        = #glblCmpyCd#
            AND CD.DS_CONTR_PK         = #dsContrPk#
            AND CD.SVC_MACH_MSTR_PK    = #svcMachMstrPk#
            AND CD.CONTR_EFF_FROM_DT   &lt;=    #slsDt#
            AND NVL(CD.CONTR_EFF_THRU_DT, #maxDate#)
                                       &gt;=    #slsDt#
            AND (     CD.CONTR_CLO_DT IS NULL
                 OR  (    CD.CONTR_CLO_DT IS NOT NULL
                      AND CD.CONTR_CLO_DT
                                       &gt;=    #slsDt#)
                )
            AND CD.EZCANCELFLAG        = '0'
    </statement>
</sqlMap>
