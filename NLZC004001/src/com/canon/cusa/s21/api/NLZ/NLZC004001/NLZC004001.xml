<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NLZC004001">

    <statement id="getMdseInfo" parameterClass="Map" resultClass="Map">
        SELECT
            MD.MDSE_CD
           ,MD.SHPG_SER_TAKE_FLG
           ,MD.RCV_SER_TAKE_FLG
           ,MD.INSTL_BASE_CTRL_FLG
        FROM
            MDSE         MD
        WHERE
            MD.GLBL_CMPY_CD  = #glblCmpyCd#
        AND MD.MDSE_CD       = #mdseCd#
        AND MD.EZCANCELFLAG  = '0'
    </statement>

    <statement id="getSvcConfigMainMachInfo" parameterClass="Map" resultClass="Map">
        SELECT
            SMM.SVC_MACH_MSTR_PK
           ,SMM.SVC_MACH_MSTR_STS_CD
           ,SMM.TRX_HDR_NUM
           ,SMM.SVC_MACH_MAINT_AVAL_FLG
           ,SMM.CUR_LOC_NUM
           ,SMM.SVC_MACH_MSTR_LOC_STS_CD
           ,SMM.STK_STS_CD
           ,SMM.SVC_MACH_TP_CD
        FROM
            SVC_CONFIG_MSTR CON
           ,SVC_MACH_MSTR   SMM
        WHERE
            CON.GLBL_CMPY_CD       = #glblCmpyCd#
        AND CON.SVC_CONFIG_MSTR_PK = #svcConfigMstrPk#
        AND CON.EZCANCELFLAG       = '0'
        AND CON.GLBL_CMPY_CD       = SMM.GLBL_CMPY_CD
        AND CON.SVC_MACH_MSTR_PK   = SMM.SVC_MACH_MSTR_PK
        AND SMM.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getAllocMachMstrInfoList" parameterClass="Map" resultClass="Map">
        SELECT
            SVC_MACH_MSTR_PK
           ,SVC_MACH_MSTR_STS_CD
           ,TRX_HDR_NUM
           ,SVC_MACH_MAINT_AVAL_FLG
           ,SVC_CONFIG_MSTR_PK
           ,CUR_LOC_NUM
           ,SVC_MACH_MSTR_LOC_STS_CD
           ,STK_STS_CD
           ,SVC_MACH_TP_CD
        FROM
            (
             SELECT
                 SVC_MACH_MSTR_PK
                ,SVC_MACH_MSTR_STS_CD
                ,TRX_HDR_NUM
                ,SVC_MACH_MAINT_AVAL_FLG
                ,SVC_CONFIG_MSTR_PK
                ,CUR_LOC_NUM
                ,SVC_MACH_MSTR_LOC_STS_CD
                ,STK_STS_CD
                ,SVC_MACH_TP_CD
                ,ROW_NUMBER() OVER(PARTITION BY GLBL_CMPY_CD ORDER BY SVC_CONFIG_MSTR_PK NULLS FIRST, SVC_MACH_MSTR_PK) AS ROW_NUM
             FROM
                 SVC_MACH_MSTR
             WHERE
                 GLBL_CMPY_CD             = #glblCmpyCd#
             AND MDSE_CD                  = #mdseCd#
             <isNotNull property="serNum">
             AND SER_NUM                  = #serNum#
             </isNotNull>
             <isNull property="serNum">
             AND SER_NUM            IS NULL
             </isNull>
             <isNotNull property="svcConfigMstrPk">
             AND SVC_CONFIG_MSTR_PK       = #svcConfigMstrPk#
             </isNotNull>
             <isNotNull property="stkStsCd">
             AND STK_STS_CD               = #stkStsCd#
             </isNotNull>
             <isNotNull property="locStsCd">
             AND SVC_MACH_MSTR_LOC_STS_CD = #locStsCd#
             </isNotNull>
             <isNotNull property="curLocNum">
             AND CUR_LOC_NUM              = #curLocNum#
             </isNotNull>
             <isNotNull property="svcMachMstrStsTerm">
             AND SVC_MACH_MSTR_STS_CD &lt;&gt; #svcMachMstrStsTerm#
             </isNotNull>
             <iterate property="svcMachMsterStsList" var="svcMachMsterStsList[]" open="AND SVC_MACH_MSTR_STS_CD IN (" conjunction= ", " close=")">
                 #svcMachMsterStsList[]#
             </iterate>
             <isNotNull property="flgY">
             AND SVC_MACH_MAINT_AVAL_FLG  = #flgY#
             AND TRX_HDR_NUM        IS NULL
             </isNotNull>
             AND EZCANCELFLAG = '0'
             <!-- START 2018/04/12 S.Katsuma [SOL#078,160,ADD] -->
             <isNotNull property="svcMachMstrPk">
             AND SVC_MACH_MSTR_PK         = #svcMachMstrPk#
             </isNotNull>
             <!-- END 2018/04/12 S.Katsuma [SOL#078,160,ADD] -->
            )
        <isNotNull property="rownum">
        WHERE
            ROW_NUM &lt;= #rownum#
        </isNotNull>
        <!-- START 2018/08/16 S.Katsuma [QC#27470,ADD] -->
        ORDER BY
            SVC_MACH_MSTR_PK ASC
        <!-- END 2018/08/16 S.Katsuma [SOL#27470,ADD] -->
    </statement>

    <statement id="getInvtyOrdDtl" parameterClass="Map" resultClass="Map">
        SELECT
            IOD.GLBL_CMPY_CD
           ,IOD.INVTY_ORD_NUM
           ,IOD.INVTY_ORD_LINE_NUM
           ,IOD.MDSE_CD
           ,IOD.INVTY_LOC_CD
           ,IOD.LOC_STS_CD
           ,IOD.STK_STS_CD
           ,IOD.ORD_QTY
           ,IOD.COA_CMPY_CD
           ,IOD.COA_BR_CD
           ,IOD.COA_ACCT_CD
           ,IOD.COA_PROD_CD
           ,IOD.COA_CH_CD
           ,IOD.COA_CC_CD
           ,IOD.COA_AFFL_CD
           ,IOD.COA_EXTN_CD
           ,IOD.COA_PROJ_CD
           ,IO.TRX_CD
           ,IO.TRX_RSN_CD
           ,IOD.SVC_CONFIG_MSTR_PK
           ,MDS.INSTL_BASE_CTRL_FLG
           <!-- START 2018/04/12 S.Katsuma [SOL#078,160,ADD] -->
           ,IOD.FROM_RTL_WH_CD
           ,IOD.TO_INVTY_LOC_CD
           ,IOD.ADJ_CATG_CD
           ,IOD.INVTY_ORD_LINE_CMNT_TXT
           ,IOD.INVTY_ORD_LINE_COST_AMT
           ,IOD.ADJ_ACCT_ALIAS_NM
           <!-- END 2018/04/12 S.Katsuma [SOL#078,160,ADD] -->
        FROM
            INVTY_ORD        IO
           ,INVTY_ORD_DTL    IOD
           ,MDSE             MDS
        WHERE
            IO.GLBL_CMPY_CD        = #glblCmpyCd#
        AND IO.INVTY_ORD_NUM       = #invtyOrdNum#
        AND IO.EZCANCELFLAG        = '0'
        AND IO.GLBL_CMPY_CD        = IOD.GLBL_CMPY_CD
        AND IO.INVTY_ORD_NUM       = IOD.INVTY_ORD_NUM
        AND IOD.EZCANCELFLAG       = '0'
        AND IOD.GLBL_CMPY_CD       = MDS.GLBL_CMPY_CD
        AND IOD.MDSE_CD            = MDS.MDSE_CD
        AND MDS.EZCANCELFLAG       = '0'
        ORDER BY
            IOD.INVTY_ORD_NUM
           ,IOD.INVTY_ORD_LINE_NUM
    </statement>

    <statement id="getAllocSvcMachMstrList" parameterClass="Map" resultClass="Map">
        SELECT
            SMM.SVC_MACH_MSTR_PK
           ,SMM.SER_NUM
        FROM
            SVC_MACH_MSTR SMM
        WHERE
            SMM.GLBL_CMPY_CD            = #glblCmpyCd#
        AND SMM.TRX_HDR_NUM             = #invtyOrdNum#
        AND SMM.TRX_LINE_NUM            = #invtyOrdLineNum#
        AND SMM.SVC_MACH_MAINT_AVAL_FLG = #flgN#
        AND SMM.EZCANCELFLAG            = '0'
    </statement>

    <statement id="getDsAsstMstrPk" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            DAM.DS_ASSET_MSTR_PK
        FROM
            DS_ASSET_MSTR DAM
        WHERE
            DAM.GLBL_CMPY_CD     = #glblCmpyCd#
        AND DAM.SVC_MACH_MSTR_PK = #svcMachMstrPk#
        AND DAM.EZCANCELFLAG     = '0'
    </statement>

    <statement id="getInvtyOrdSer" parameterClass="Map" resultClass="String">
        SELECT
            IOS.SER_NUM
        FROM
            INVTY_ORD_SER IOS
        WHERE
            IOS.GLBL_CMPY_CD       = #glblCmpyCd#
        AND IOS.INVTY_ORD_NUM      = #invtyOrdNum#
        AND IOS.INVTY_ORD_LINE_NUM = #invtyOrdLineNum#
        AND IOS.SER_NUM IS NOT NULL
        AND IOS.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getConfigCompCnt" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            SVC_MACH_MSTR SMM
        WHERE
            SMM.GLBL_CMPY_CD                = #glblCmpyCd#
        AND SMM.SVC_CONFIG_MSTR_PK          = #svcConfigMstrPk#
        AND SMM.SVC_MACH_MSTR_STS_CD &lt;&gt; #svcMachMstrStsTerm#
        AND SMM.EZCANCELFLAG                = '0'
    </statement>

    <statement id="checkAsset" parameterClass="Map" resultClass="BigDecimal">
        SELECT
            COUNT(*)
        FROM
            RTL_WH RW
        WHERE
            RW.GLBL_CMPY_CD     = #glblCmpyCd#
        AND RW.RTL_WH_CD        = #rtlWhCd#
        AND RW.INVTY_ACCT_CD    = #invtyAcctCd#
        AND RW.EZCANCELFLAG     = '0'
    </statement>

    <!-- START 2018/04/12 S.Katsuma [SOL#078,160,ADD] -->
    <statement id="countSubWarehouseTransferControl" parameterClass="Map" resultClass="BigDecimal">
        SELECT COUNT(1) CNT
        FROM (
               SELECT 1
               FROM   SWH_TRNSF_CTRL STC
               WHERE  STC.GLBL_CMPY_CD = #glblCmpyCd#
               AND    STC.RTL_WH_CD    = #rtlWhCd#
               AND    STC.EZCANCELFLAG = '0'
               UNION
               SELECT 1
               FROM   RTL_WH RTW
                     ,SWH_TRNSF_CTRL STC
               WHERE  RTW.GLBL_CMPY_CD    = #glblCmpyCd#
               AND    RTW.RTL_WH_CD       = #rtlWhCd#
               AND    RTW.EZCANCELFLAG    = '0'
               AND    STC.GLBL_CMPY_CD    = RTW.GLBL_CMPY_CD
               AND    STC.RTL_WH_CATG_CD  = RTW.RTL_WH_CATG_CD
               AND    STC.WH_SYS_TP_CD    = RTW.WH_SYS_TP_CD
               AND    STC.EZCANCELFLAG    = '0'
              )
    </statement>

    <statement id="getMdseOrPartsCd" parameterClass="Map" resultClass="Map">
        SELECT
            MDS.COA_MDSE_TP_CD
        FROM
            ALL_MDSE_V       MDS
           ,MDSE_TP_VAL_SET  MDT
        WHERE
            MDS.GLBL_CMPY_CD       = #glblCmpyCd#
        AND MDS.MDSE_CD            = #mdseCd#
        AND MDS.EZCANCELFLAG       = '0'
        AND MDS.GLBL_CMPY_CD       = MDT.GLBL_CMPY_CD
        AND MDS.COA_MDSE_TP_CD     = MDT.COA_MDSE_TP_CD
        AND MDT.MDSE_TP_CTX_TP_CD  = #partsItem#
        AND MDT.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getDefaultCOAAccount" parameterClass="Map" resultClass="Map">
        SELECT
            COA_ACCT_CD
           ,CYCLE_CNT_MDSE_TP_CD
        FROM
            ADJ_CATG
        WHERE
            GLBL_CMPY_CD         = #glblCmpyCd#
        AND EZCANCELFLAG         = '0'
        AND CYCLE_CNT_MDSE_TP_CD = #cycleCntMdseTpCd#
    </statement>
    <!-- END 2018/04/12 S.Katsuma [SOL#078,160,ADD] -->
</sqlMap>