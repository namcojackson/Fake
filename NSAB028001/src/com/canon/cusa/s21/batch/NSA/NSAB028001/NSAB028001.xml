<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<sqlMap namespace="NSAB028001">
    <statement id="getInputData" parameterClass="Map" resultClass="Map">
        SELECT
             A.CFS_INV_INTFC_PK
            ,A.PROC_DT
            ,A.INV_NUM
            ,A.CFS_LEASE_PBL_NUM
            ,A.INV_LINE_NUM
            ,A.CSA_INV_NUM
            ,A.CSA_CONTR_NUM
            ,A.CSA_CONTR_MOD_TXT
            ,A.CFS_SER_NUM
            ,A.INV_TOT_DEAL_NET_AMT
            ,A.BLLG_PER_FROM_DT
            ,A.BLLG_PER_THRU_DT
            ,A.CFS_BLLG_TP_TXT
            ,A.CFS_LEASE_NUM
            ,A.END_CUST_NM
            ,A.DS_ACCT_DLR_CD
            ,A.INV_DT
            ,A.ORG_CD
            ,A.BLLG_MTR_LB_NM
            ,A.FTR_FLG_ORIG_TXT
            ,A.CM_FLG_ORIG_TXT
            ,A.CFS_INV_PROC_STS_CD
            ,A.INTFC_ERR_MSG_TXT
            ,A.DS_CONTR_NUM
            ,A.CSA_DS_CONTR_MOD_TXT
            ,A.DS_CONTR_PK
            ,A.USG_ITEM_CD
            ,A.SVC_ITEM_CD
            ,A.FTR_ITEM_CD
            ,A.DFRD_ACCTG_RULE_CD
            ,A.DFRD_INV_RULE_CD
            ,A.BILL_TO_CUST_ACCT_CD
            ,A.BILL_TO_LOC_NUM
            ,A.SHIP_TO_CUST_ACCT_CD
            ,A.SHIP_TO_LOC_NUM
            ,A.SVC_LINE_CONTR_DTL_PK
            ,A.USG_LINE_CONTR_DTL_PK
            ,A.UOM_CD
            ,A.BILL_TO_CUST_CD
            ,A.DS_INV_TP_CD
            ,A.CONTR_VRSN_EFF_FROM_DT
            ,A.CFS_FLEET_FLG
            ,A.CFS_INV_BAT_NUM
        FROM
            CFS_INV_INTFC   A
        WHERE
                A.GLBL_CMPY_CD       = #glblCmpyCd#
            <iterate property="cfsInvProcStsCdList" var="cfsInvProcStsCdList[]" open=" AND A.CFS_INV_PROC_STS_CD IN (" close=")" conjunction=",">
                  #cfsInvProcStsCdList[]#
            </iterate>
            AND A.EZCANCELFLAG       = '0'
        ORDER BY
            A.EZUPTIME
    </statement>

    <statement id="getInvData" parameterClass="Map" resultClass="Map">
        SELECT
             A.INV_NUM                                              AS INV_NUM
            ,F.DFRD_ACCTG_RULE_CD                                   AS DFRD_ACCTG_RULE_CD
            ,A.BILL_TO_CUST_ACCT_CD                                 AS BILL_TO_CUST_ACCT_CD
            ,A.SOLD_TO_CUST_LOC_CD                                  AS BILL_TO_LOC_NUM
            ,A.BILL_TO_CUST_CD                                      AS BILL_TO_CUST_CD
            ,BTC.LOC_NUM                                            AS LOC_NUM
            ,A.SELL_TO_CUST_CD                                      AS SELL_TO_CUST_CD
            ,C.SHIP_TO_CUST_ACCT_CD                                 AS SHIP_TO_CUST_ACCT_CD
            ,C.SHIP_TO_CUST_CD                                      AS SHIP_TO_LOC_NUM
            ,C.SHIP_TO_FIRST_LINE_ADDR || C.SHIP_TO_SCD_LINE_ADDR   AS SHIP_TO_ADDR
            ,A.PMT_TERM_CASH_DISC_CD                                AS PMT_TERM_CASH_DISC_CD
            ,A.SLS_REP_TOC_CD                                       AS SLS_REP_TOC_CD
            ,G.UOM_CD                                               AS UOM_CD
            ,G.DS_CONTR_NUM                                         AS DS_CONTR_NUM
        FROM
             INV                A
            ,INV_BOL            C
            ,DS_INV_SLS_CR      E
            ,DFRD_ACCTG_RULE    F
            ,INV_LINE           G
            ,BILL_TO_CUST       BTC
        WHERE
                A.GLBL_CMPY_CD         = #glblCmpyCd#
            AND A.INV_NUM              = #invNum#
            AND A.EZCANCELFLAG         = '0'
            AND A.GLBL_CMPY_CD         = C.GLBL_CMPY_CD
            AND A.INV_NUM              = C.INV_NUM
            AND C.INV_BOL_LINE_NUM     = #invBolLineNum#
            AND C.EZCANCELFLAG         = '0'
            AND C.GLBL_CMPY_CD         = E.GLBL_CMPY_CD
            AND C.INV_NUM              = E.INV_NUM
            AND C.INV_BOL_LINE_NUM     = E.INV_BOL_LINE_NUM
            AND E.INV_LINE_NUM         = #invLineNum#
            AND E.INV_LINE_SUB_NUM     = #invLineSubNum#
            AND E.INV_TRX_LINE_SUB_NUM = #invTrxLineSubNum#
            AND E.EZCANCELFLAG         = '0'
            AND E.GLBL_CMPY_CD         = F.GLBL_CMPY_CD (+)
            AND E.DFRD_ACCTG_RULE_CD   = F.DFRD_ACCTG_RULE_CD (+)
            AND F.EZCANCELFLAG (+)     = '0'
            AND E.GLBL_CMPY_CD         = G.GLBL_CMPY_CD
            AND E.INV_NUM              = G.INV_NUM
            AND E.INV_BOL_LINE_NUM     = G.INV_BOL_LINE_NUM
            AND E.INV_LINE_NUM         = G.INV_LINE_NUM
            AND E.INV_LINE_SUB_NUM     = G.INV_LINE_SUB_NUM
            AND E.INV_TRX_LINE_SUB_NUM = G.INV_LINE_SUB_TRX_NUM
            <isNotNull property="dsContrNum">
            AND G.DS_CONTR_NUM         = #dsContrNum#
            </isNotNull>
            AND G.EZCANCELFLAG         = '0'
            AND A.GLBL_CMPY_CD         = BTC.GLBL_CMPY_CD (+)
            AND A.BILL_TO_CUST_CD      = BTC.BILL_TO_CUST_CD (+)
            AND BTC.EZCANCELFLAG (+)   = '0'
            AND ROWNUM                 = 1
    </statement>

    <statement id="getContrData" parameterClass="Map" resultClass="Map">
<!-- START 2017/08/07 K.Kim [QC#20427, MOD] -->
        SELECT
             A.SVC_MACH_MSTR_PK     AS SVC_MACH_MSTR_PK
            ,B.DS_CONTR_DTL_PK      AS DS_CONTR_DTL_PK
            ,B.DS_CONTR_BLLG_MTR_PK AS DS_CONTR_BLLG_MTR_PK
            ,B.MTR_LB_CD            AS MTR_LB_CD
            ,B.DS_CONTR_PK          AS DS_CONTR_PK
            ,F.DS_CONTR_STS_CD      AS DS_CONTR_STS_CD
            ,F.DS_CONTR_CTRL_STS_CD AS DS_CONTR_CTRL_STS_CD
            ,G.DS_CONTR_DTL_STS_CD  AS DS_CONTR_DTL_STS_CD
            ,G.DS_CONTR_CTRL_STS_CD AS DS_CONTR_DTL_CTRL_STS_CD
            ,B.DS_CONTR_NUM         AS DS_CONTR_NUM
            ,B.INTG_MDSE_CD         AS USG_ITEM_CD
            ,B.SVC_PGM_MDSE_CD      AS SVC_ITEM_CD
            ,B.SVC_PGM_MDSE_CD      AS FTR_ITEM_CD
            ,B.CONTR_EFF_FROM_DT    AS CONTR_VRSN_EFF_FROM_DT
            ,B.DS_CONTR_DTL_PK      AS SVC_LINE_CONTR_DTL_PK
            ,B.DS_CONTR_BLLG_MTR_PK AS USG_LINE_CONTR_DTL_PK
            ,H.DFRD_ACCTG_RULE_CD   AS DFRD_ACCTG_RULE_CD
            ,H.DFRD_INV_RULE_CD     AS DFRD_INV_RULE_CD
            ,A.MDSE_CD
            ,A.ISTL_DT
            ,A.SVC_MACH_TP_CD
            ,B.DS_CONTR_DTL_TP_CD
            ,B.DS_CONTR_DTL_STS_CD
            ,B.CONTR_EFF_THRU_DT
            ,B.BLLG_MTR_LB_CD
            ,B.MTR_LB_NM
            ,B.BW_MTR_FLG
            ,B.COLOR_MTR_FLG
            ,B.TOT_MTR_FLG
            ,B.DS_CONTR_TP_CD
            ,B.DS_CONTR_CATG_CD
            ,F.BLLBL_FLG
            <!-- START 2017/12/12 K.Kojima [QC#21644, ADD] -->
            ,B.BASE_BILL_TO_CUST_CD     AS BASE_BILL_TO_CUST_CD
            ,BTCB.SELL_TO_CUST_CD       AS BASE_SELL_TO_CUST_CD
            ,BTCB.LOC_NUM               AS BASE_LOC_NUM
            ,B.BLLG_MTR_BILL_TO_CUST_CD AS BLLG_MTR_BILL_TO_CUST_CD
            ,BTCM.SELL_TO_CUST_CD       AS BLLG_MTR_SELL_TO_CUST_CD
            ,BTCM.LOC_NUM               AS BLLG_MTR_LOC_NUM
            ,A.CUR_LOC_ACCT_NUM
            ,A.CUR_LOC_NUM
            ,BCB.BLLG_CYCLE_UOM_CD      AS BASE_BLLG_CYCLE_UOM_CD
            ,BCM.BLLG_CYCLE_UOM_CD      AS BLLG_MTR_BLLG_CYCLE_UOM_CD
            <!-- END 2017/12/12 K.Kojima [QC#21644, ADD] -->
        FROM
             SVC_MACH_MSTR      A
            ,(
                SELECT
                     DC.GLBL_CMPY_CD
                    ,DC.EZCANCELFLAG
                    ,DC.DS_CONTR_PK
                    ,DC.DS_CONTR_NUM
                    ,DC.DS_CONTR_TP_CD
                    ,DC.DS_CONTR_CATG_CD
                    ,DCD.DS_CONTR_DTL_PK
                    ,DCD.SVC_MACH_MSTR_PK
                    <!-- START 2018/02/20 [QC#21872-1, MOD] -->
                    ,CASE DC.DS_CONTR_CATG_CD
                        WHEN #dsContrCatgCdIsFlt# THEN DCDF.SVC_PGM_MDSE_CD
                        ELSE DCD.SVC_PGM_MDSE_CD
                     END AS SVC_PGM_MDSE_CD
                    <!-- END   2018/02/20 [QC#21872-1, MOD] -->
                    ,DCD.CONTR_EFF_FROM_DT
                    ,DCD.DS_CONTR_DTL_TP_CD
                    ,DCD.DS_CONTR_DTL_STS_CD
                    ,DCD.CONTR_EFF_THRU_DT
                    ,DCBM.DS_CONTR_BLLG_MTR_PK
                    ,DCBM.INTG_MDSE_CD
                    ,DCBM.BLLG_MTR_LB_CD
                    ,ML.MTR_LB_CD
                    ,ML.MTR_LB_NM
                    ,ML.BW_MTR_FLG
                    ,ML.COLOR_MTR_FLG
                    ,ML.TOT_MTR_FLG
                    <!-- START 2017/12/12 K.Kojima [QC#21644, ADD] -->
                    ,DCD.BASE_BILL_TO_CUST_CD
                    ,DCBM.BLLG_MTR_BILL_TO_CUST_CD
                    ,DCD.BASE_BLLG_CYCLE_CD
                    ,DCBM.BLLG_MTR_BLLG_CYCLE_CD
                    <!-- END 2017/12/12 K.Kojima [QC#21644, ADD] -->
                FROM
                     DS_CONTR           DC
                    ,DS_CONTR_DTL       DCD
                    ,DS_CONTR_DTL       DCDF
                    ,DS_CONTR_BLLG_MTR  DCBM
                    ,MTR_LB             ML
                WHERE
                        DC.GLBL_CMPY_CD      = #glblCmpyCd#
                    AND DC.DS_CONTR_CATG_CD  &lt;&gt; #dsContrCatgCdIsWty#
                    <isNotNull property="dsContrNum">
                    AND DC.DS_CONTR_NUM      = #dsContrNum#
                    </isNotNull>
                    AND DC.EZCANCELFLAG      = '0'
                    AND DC.GLBL_CMPY_CD      = DCD.GLBL_CMPY_CD
                    AND DC.DS_CONTR_PK       = DCD.DS_CONTR_PK
                    AND DCD.EZCANCELFLAG     = '0'
                    <!-- START 2017/12/12 K.Kojima [QC#21644, MOD] -->
                    <!-- AND DCD.GLBL_CMPY_CD     = DCBM.GLBL_CMPY_CD -->
                    <!-- AND DCD.DS_CONTR_DTL_PK  = DCBM.DS_CONTR_DTL_PK -->
                    <!-- AND DCBM.EZCANCELFLAG    = '0' -->
                    <!-- AND DCBM.GLBL_CMPY_CD    = ML.GLBL_CMPY_CD -->
                    <!-- AND DCBM.BLLG_MTR_LB_CD  = ML.MTR_LB_CD -->
                    <!-- AND ML.EZCANCELFLAG      = '0' -->
                    AND DCD.GLBL_CMPY_CD     = DCBM.GLBL_CMPY_CD(+)
                    AND DCD.DS_CONTR_DTL_PK  = DCBM.DS_CONTR_DTL_PK(+)
                    AND DCBM.EZCANCELFLAG(+) = '0'
                    AND DCBM.GLBL_CMPY_CD    = ML.GLBL_CMPY_CD(+)
                    AND DCBM.BLLG_MTR_LB_CD  = ML.MTR_LB_CD(+)
                    AND ML.EZCANCELFLAG(+)   = '0'
                    <!-- END 2017/12/12 K.Kojima [QC#21644, MOD] -->
                    <!-- START 2018/02/13 [QC#21872, MOD] -->
                    <isNotNull property="bwMtrFlg">
                    AND ML.BW_MTR_FLG        = #bwMtrFlg#
                    </isNotNull>
                    <isNotNull property="bwColorFlg">
                    AND ML.COLOR_MTR_FLG     = #bwColorFlg#
                    </isNotNull>
                    <!-- END   2018/02/13 [QC#21872, MOD] -->
                    <!-- START 2018/02/20 [QC#21872-1, MOD] -->
                    AND DCD.GLBL_CMPY_CD             = DCDF.GLBL_CMPY_CD(+)
                    AND DCD.PRNT_DS_CONTR_DTL_PK     = DCDF.DS_CONTR_DTL_PK(+)
                    AND DCDF.DS_CONTR_DTL_TP_CD(+)   = #dsContrDtlTpCdIsFleet#
                    AND DCDF.EZCANCELFLAG(+)         = '0'
                    <!-- END   2018/02/20 [QC#21872-1, MOD] -->
             ) B
            ,DS_CONTR_STS_V     F
            ,DS_CONTR_DTL_STS_V G
            ,MDSE               H
            <!-- START 2017/12/12 K.Kojima [QC#21644, ADD] -->
            ,BILL_TO_CUST       BTCB
            ,BILL_TO_CUST       BTCM
            ,BLLG_CYCLE         BCB
            ,BLLG_CYCLE         BCM
            <!-- END 2017/12/12 K.Kojima [QC#21644, ADD] -->
        WHERE
                A.GLBL_CMPY_CD      = #glblCmpyCd#
            AND A.EZCANCELFLAG      = '0'
            AND A.GLBL_CMPY_CD      = B.GLBL_CMPY_CD
            <isNotNull property="serNum">
            AND A.SER_NUM           = #serNum#
            </isNotNull>
            AND A.SVC_MACH_MSTR_PK  = B.SVC_MACH_MSTR_PK
            AND B.EZCANCELFLAG      = '0'
            AND B.GLBL_CMPY_CD      = F.GLBL_CMPY_CD (+)
            AND B.DS_CONTR_PK       = F.DS_CONTR_PK  (+)
            AND F.EZCANCELFLAG  (+) = '0'
            AND B.GLBL_CMPY_CD      = G.GLBL_CMPY_CD    (+)
            AND B.DS_CONTR_DTL_PK   = G.DS_CONTR_DTL_PK (+)
            AND G.EZCANCELFLAG  (+) = '0'
            AND A.GLBL_CMPY_CD      = H.GLBL_CMPY_CD    (+)
            AND A.MDSE_CD           = H.MDSE_CD         (+)
            AND H.EZCANCELFLAG  (+) = '0'
            <!-- START 2017/12/12 K.Kojima [QC#21644, ADD] -->
            AND B.GLBL_CMPY_CD             = BTCB.GLBL_CMPY_CD(+)
            AND B.BASE_BILL_TO_CUST_CD     = BTCB.BILL_TO_CUST_CD(+)
            AND BTCB.EZCANCELFLAG(+)       = '0'
            AND B.GLBL_CMPY_CD             = BTCM.GLBL_CMPY_CD(+)
            AND B.BLLG_MTR_BILL_TO_CUST_CD = BTCM.BILL_TO_CUST_CD(+)
            AND BTCM.EZCANCELFLAG(+)       = '0'
            AND B.GLBL_CMPY_CD             = BCB.GLBL_CMPY_CD(+)
            AND B.BASE_BLLG_CYCLE_CD       = BCB.BLLG_CYCLE_CD(+)
            AND BCB.EZCANCELFLAG(+)        = '0'
            AND B.GLBL_CMPY_CD             = BCM.GLBL_CMPY_CD(+)
            AND B.BLLG_MTR_BLLG_CYCLE_CD   = BCM.BLLG_CYCLE_CD(+)
            AND BCM.EZCANCELFLAG(+)        = '0'
            <!-- END 2017/12/12 K.Kojima [QC#21644, ADD] -->
            AND ROWNUM              = 1
<!-- END 2017/08/07 K.Kim [QC#20427, MOD] -->
    </statement>

<!-- START 2018/03/09 [QC#24679, ADD] -->
    <statement id="findInvData" parameterClass="Map" resultClass="Map">
        SELECT DISTINCT
            I.INV_NUM
        FROM 
             SVC_INV        SI
            ,SVC_INV_LINE   SIL
            ,INV            I
        WHERE 
            SI.GLBL_CMPY_CD             = #glblCmpyCd#
        <isNotNull property="dsContrNum">
        AND SI.DS_CONTR_NUM             = #dsContrNum#
        </isNotNull>
        AND SI.EZCANCELFLAG             = '0'
        AND SI.GLBL_CMPY_CD             = SIL.GLBL_CMPY_CD
        AND SI.SVC_INV_NUM              = SIL.SVC_INV_NUM
        AND SIL.SVC_INV_CHRG_TP_CD      = #svcInvChrgTpCd#
        AND SIL.SER_NUM                 = #serNum#
        AND SIL.BLLG_PER_FROM_DT     LIKE #bllgPerFromYM#
        AND SIL.BLLG_PER_THRU_DT     LIKE #bllgPerThruYM#
        AND SIL.EZCANCELFLAG            = '0'
        AND SI.GLBL_CMPY_CD             = I.GLBL_CMPY_CD
        AND SI.SVC_INV_NUM              = I.INV_NUM
        AND I.EZCANCELFLAG              = '0'
    </statement>
<!-- END 2018/03/09 [QC#24679, ADD] -->
</sqlMap>
