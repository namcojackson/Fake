<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<sqlMap namespace="NPAB140001">

    <statement id="getRptPrintCtrl" parameterClass="Map" resultClass="Map">
        SELECT
             RPC.RPT_PRINT_CTRL_ID
            ,RPC.RPT_BR_ID
            ,RPC.RPT_PRINT_CTRL_NM
            ,RPC.RPT_PRINT_CTRL_VAL_TXT_01
        FROM
            RPT_PRINT_CTRL RPC
        WHERE 1=1
        AND RPC.GLBL_CMPY_CD    = #glblCmpyCd#
        AND RPC.RPT_ID          = #rptId#
        AND RPC.EZCANCELFLAG    = '0'
        ORDER BY
             RPC.RPT_PRINT_CTRL_ID
    </statement>

    <statement id="getLastUpdateTs" parameterClass="Map" resultClass="Map">
        SELECT
             DBPL.DS_BIZ_PROC_LOG_PK
            ,DBPL.DS_BIZ_LAST_UPD_TS
        FROM
            DS_BIZ_PROC_LOG DBPL
        WHERE 1=1
        AND DBPL.GLBL_CMPY_CD = #glblCmpyCd#
        AND DBPL.EZCANCELFLAG = '0'
        AND DBPL.PROC_PGM_ID  = #procPgmId#
        ORDER BY
             DBPL.DS_BIZ_PROC_TRX_NUM
            ,DBPL.DS_BIZ_PROC_TRX_DTL_NUM
            ,DBPL.DS_BIZ_PROC_TRX_SUB_DTL_NUM
    </statement>

    <statement id="getSourceWhInfo" parameterClass="Map" resultClass="Map">
        SELECT
             RWH.RTL_WH_CD
            ,RWH.RTL_WH_NM
            ,RWH.RTL_WH_DESC_TXT
            ,DAC.DS_ACCT_NM
            ,RWH.FIRST_LINE_ADDR
            ,RWH.SCD_LINE_ADDR
            ,RWH.THIRD_LINE_ADDR
            ,RWH.FRTH_LINE_ADDR
            ,RWH.CTY_ADDR
            ,RWH.ST_CD
            ,RWH.POST_CD
        FROM 
             RTL_WH RWH
            ,SHIP_TO_CUST STC
            ,ACCT_LOC AL
            ,SELL_TO_CUST DAC
        WHERE
             1 = 1
        AND  RWH.EFF_FROM_DT       &lt;= #procDt#
        AND (RWH.EFF_THRU_DT       &gt;= #procDt# OR RWH.EFF_THRU_DT IS NULL)
        AND  RWH.SHIP_TO_CUST_CD    = STC.SHIP_TO_CUST_CD
        AND  STC.LOC_NUM            = AL.LOC_NUM
        AND  AL.DS_ACCT_NUM         = DAC.SELL_TO_CUST_CD
        AND  RWH.RTL_WH_CD          = #rtlWhCd#
        AND  RWH.GLBL_CMPY_CD       = #glblCmpyCd#
        AND  RWH.GLBL_CMPY_CD       = STC.GLBL_CMPY_CD
        AND  RWH.GLBL_CMPY_CD       = AL.GLBL_CMPY_CD
        AND  RWH.GLBL_CMPY_CD       = DAC.GLBL_CMPY_CD
        AND  RWH.EZCANCELFLAG       = '0'
        AND  STC.EZCANCELFLAG       = '0'
        AND  AL.EZCANCELFLAG        = '0'
        AND  DAC.EZCANCELFLAG       = '0'
    </statement>

    <statement id="getInsourcedPartsRequest" parameterClass="Map" resultClass="Map">
        SELECT
             PRD1.SRC_RTL_WH_CD                 AS PRD1_SRC_RTL_WH_CD
            ,PRD1.SRC_RTL_SWH_CD                AS PRD1_SRC_RTL_SWH_CD
            ,PRD2.PRCH_REQ_LINE_TP_CD           AS PRD2_PRCH_REQ_LINE_TP_CD
            ,PRLT2.PRCH_REQ_LINE_TP_NM          AS PRLT2_PRCH_REQ_LINE_TP_NM
            ,PRD2.PRCH_REQ_NUM                  AS PRD2_PRCH_REQ_NUM
            ,PRD2.PRCH_REQ_LINE_NUM             AS PRD2_PRCH_REQ_LINE_NUM
            ,PRD2.PRCH_REQ_LINE_SUB_NUM         AS PRD2_PRCH_REQ_LINE_SUB_NUM
            ,PRD2.ORIG_RQST_MDSE_CD             AS PRD2_ORIG_RQST_MDSE_CD
            ,PRD2.MDSE_CD                       AS PRD2_MDSE_CD
            ,PRD1.PRCH_REQ_QTY                  AS PRD1_PRCH_REQ_QTY
            ,PRD2.PRCH_REQ_QTY                  AS PRD2_PRCH_REQ_QTY
            ,PRD1.PRCH_REQ_INSRC_QTY            AS PRD1_PRCH_REQ_INSRC_QTY
            ,PRD2.PROCR_TP_CD                   AS PRD2_PROCR_TP_CD
            ,PRD2.SRC_RTL_WH_CD                 AS PRD2_SRC_RTL_WH_CD
            ,PRD2.SRC_RTL_SWH_CD                AS PRD2_SRC_RTL_SWH_CD
            ,PRD2.PRNT_VND_CD                   AS PRD2_PRNT_VND_CD
            ,PRD2.VND_CD                        AS PRD2_VND_CD
            ,PRD2.DEST_INVTY_LOC_CD             AS PRD2_DEST_INVTY_LOC_CD
            ,PRD3.PRCH_REQ_NUM                  AS PRD3_PRCH_REQ_NUM
            ,PRD3.PO_ORD_NUM                    AS PRD3_PO_ORD_NUM
            ,PRD2.PRCH_REQ_CRAT_DT              AS PRD2_PRCH_REQ_CRAT_DT
            ,PRD2.PRCH_REQ_CRAT_TM              AS PRD2_PRCH_REQ_CRAT_TM
            ,RWH1.RTL_WH_NM                     AS RWH1_RTL_WH_NM
            ,RWH2.RTL_WH_NM                     AS RWH2_RTL_WH_NM
            ,PV1.PRNT_VND_NM                    AS PV1_PRNT_VND_NM
            ,VD1.LOC_NM                         AS VD1_LOC_NM
            ,RWH3.RTL_WH_NM                     AS RWH3_RTL_WH_NM
        FROM
             PRCH_REQ PRH2
            ,PRCH_REQ_DTL PRD2
            ,PRCH_REQ_LINE_TP PRLT2
            ,PRCH_REQ_DTL PRD1
            ,PRCH_REQ PRH3
            ,PRCH_REQ_DTL PRD3
            ,RTL_WH RWH1
            ,RTL_WH RWH2
            ,RTL_SWH SWH2
            ,RTL_WH RWH3
            ,RTL_SWH SWH3
            ,PRNT_VND PV1
            ,VND  VD1
        WHERE 
             PRH2.PRCH_REQ_REC_TP_CD          = #prchReqRecTpTechRequest#
        AND  PRD2.PRCH_REQ_LINE_SUB_NUM      &lt;&gt; '0'
        AND  PRH2.PRCH_REQ_NUM                = PRD2.PRCH_REQ_NUM
        AND  PRD2.PRCH_REQ_LINE_TP_CD         = PRLT2.PRCH_REQ_LINE_TP_CD
        AND  PRD2.PRCH_REQ_NUM                = PRD1.PRCH_REQ_NUM
        AND  PRD2.PRCH_REQ_LINE_NUM           = PRD1.PRCH_REQ_LINE_NUM
        AND  PRD1.PRCH_REQ_LINE_SUB_NUM       = '0'
        AND  PRH3.PRCH_REQ_REC_TP_CD(+)       = #prchReqRecTpPoRequisition#
        AND  PRH3.PRCH_REQ_SRC_TP_CD(+)       = #prchReqSrcTpInsourcing#
        AND  PRH3.PRCH_REQ_NUM(+)             = PRD3.PRCH_REQ_NUM
        AND  PRD2.PRCH_REQ_NUM                = PRD3.TRX_REF_NUM(+)
        AND  PRD2.PRCH_REQ_LINE_NUM           = PRD3.TRX_REF_LINE_NUM(+)
        AND  PRD2.PRCH_REQ_LINE_SUB_NUM       = PRD3.TRX_REF_LINE_SUB_NUM(+)
        AND  PRD1.SRC_RTL_WH_CD               = RWH1.RTL_WH_CD
        AND  PRD2.SRC_INVTY_LOC_CD            = SWH2.INVTY_LOC_CD(+)
        AND  SWH2.RTL_WH_CD                   = RWH2.RTL_WH_CD(+)
        AND  PRD2.PRNT_VND_CD                 = PV1.PRNT_VND_CD(+)
        AND  PRD2.VND_CD                      = VD1.VND_CD(+)
        AND  PRD2.DEST_INVTY_LOC_CD           = SWH3.INVTY_LOC_CD
        AND  SWH3.RTL_WH_CD                   = RWH3.RTL_WH_CD
        AND  PRD1.SRC_RTL_WH_CD               = #rtlWhCd#
        <isNotNull property="prchReqLineTpCdList">
        AND  PRD2.PRCH_REQ_LINE_TP_CD IN 
        <iterate property="prchReqLineTpCdList" var="prchReqLineTpCd[]" open="(" close=")" conjunction=",">
            #prchReqLineTpCd[]#
        </iterate>
        </isNotNull>
        <isNotNull property="bizLastUpdTs">
        AND  PRD2.EZINTIME                    &gt; #bizLastUpdTs#
        </isNotNull>
        <isNotNull property="prntVndCdList">
        AND  PRD2.PRNT_VND_CD NOT IN 
        <iterate property="prntVndCdList" var="prntVndCd[]" open="(" close=")" conjunction=",">
            #prntVndCd[]#
        </iterate>
        </isNotNull>
        AND  PRH2.GLBL_CMPY_CD                = #glblCmpyCd#
        AND  PRH2.EZCANCELFLAG                = '0'
        AND  PRD2.GLBL_CMPY_CD                = #glblCmpyCd#
        AND  PRD2.EZCANCELFLAG                = '0'
        AND  PRLT2.GLBL_CMPY_CD               = #glblCmpyCd#
        AND  PRLT2.EZCANCELFLAG               = '0'
        AND  PRD1.GLBL_CMPY_CD                = #glblCmpyCd#
        AND  PRD1.EZCANCELFLAG                = '0'
        AND  PRH3.GLBL_CMPY_CD(+)             = #glblCmpyCd#
        AND  PRH3.EZCANCELFLAG(+)             = '0'
        AND  PRD3.GLBL_CMPY_CD(+)             = #glblCmpyCd#
        AND  PRD3.EZCANCELFLAG(+)             = '0'
        AND  RWH1.GLBL_CMPY_CD                = #glblCmpyCd#
        AND  RWH1.EZCANCELFLAG                = '0'
        AND  RWH2.GLBL_CMPY_CD(+)             = #glblCmpyCd#
        AND  RWH2.EZCANCELFLAG(+)             = '0'
        AND  SWH2.GLBL_CMPY_CD(+)             = #glblCmpyCd#
        AND  SWH2.EZCANCELFLAG(+)             = '0'
        AND  RWH3.GLBL_CMPY_CD                = #glblCmpyCd#
        AND  RWH3.EZCANCELFLAG                = '0'
        AND  SWH3.GLBL_CMPY_CD                = #glblCmpyCd#
        AND  SWH3.EZCANCELFLAG                = '0'
        AND  PV1.GLBL_CMPY_CD(+)              = #glblCmpyCd#
        AND  PV1.EZCANCELFLAG(+)              = '0'
        AND  VD1.GLBL_CMPY_CD(+)              = #glblCmpyCd#
        AND  VD1.EZCANCELFLAG(+)              = '0'
        ORDER BY
             PRD1.SRC_RTL_WH_CD
            ,PRD2.PRCH_REQ_LINE_TP_CD
            ,PRD2.PRCH_REQ_NUM
            ,PRD2.PRCH_REQ_LINE_NUM
            ,PRD2.PRCH_REQ_LINE_SUB_NUM
    </statement>

    <statement id="getInsourcingError" parameterClass="Map" resultClass="Map">
        SELECT
             PRD2.SRC_RTL_WH_CD             AS PRD2_SRC_RTL_WH_CD
            ,PRD2.SRC_RTL_SWH_CD            AS PRD2_SRC_RTL_SWH_CD
            ,PRH2.PRCH_REQ_NUM              AS PRH2_PRCH_REQ_NUM
            ,PRD2.PRCH_REQ_LINE_NUM         AS PRD2_PRCH_REQ_LINE_NUM
            ,PRD2.PRCH_REQ_LINE_SUB_NUM     AS PRD2_PRCH_REQ_LINE_SUB_NUM
            ,PRD2.MDSE_CD                   AS PRD2_MDSE_CD
            ,PRD2.ORIG_RQST_MDSE_CD         AS PRD2_ORIG_RQST_MDSE_CD
            ,PRD2.PRCH_REQ_QTY              AS PRD2_PRCH_REQ_QTY
            ,PRD2.PRCH_REQ_INSRC_QTY        AS PRD2_PRCH_REQ_INSRC_QTY
            ,PRD2.DEST_INVTY_LOC_CD         AS PRD2_DEST_INVTY_LOC_CD
            ,PRD2.PRCH_REQ_BAL_QTY          AS PRD2_PRCH_REQ_BAL_QTY
            ,PRD2.PRCH_REQ_REL_ERR_MSG_TXT  AS PRD2_PRCH_REQ_REL_ERR_MSG_TXT
            ,RWH1.RTL_WH_NM                 AS RWH1_RTL_WH_NM
            ,RWH3.RTL_WH_NM                 AS RWH3_RTL_WH_NM
        FROM
             PRCH_REQ PRH2
            ,PRCH_REQ_DTL PRD2
            ,PRCH_REQ_LINE_TP PRLT2
            ,PRCH_REQ_LINE_STS PRLS2
            ,RTL_WH RWH1
            ,RTL_WH RWH3
            ,RTL_SWH SWH3
        WHERE
             PRH2.PRCH_REQ_REC_TP_CD         = #prchReqRecTpTechRequest#
        AND  PRD2.PRCH_REQ_LINE_SUB_NUM      = '0'
        AND  PRH2.PRCH_REQ_NUM               = PRD2.PRCH_REQ_NUM
        AND  PRD2.PRCH_REQ_LINE_TP_CD        = PRLT2.PRCH_REQ_LINE_TP_CD(+)
        AND  PRD2.PRCH_REQ_LINE_STS_CD       = PRLS2.PRCH_REQ_LINE_STS_CD
        AND  PRLS2.OPEN_STS_FLG              = 'Y'
        AND  PRD2.SRC_RTL_WH_CD              = RWH1.RTL_WH_CD
        AND  PRD2.DEST_INVTY_LOC_CD          = SWH3.INVTY_LOC_CD
        AND  SWH3.RTL_WH_CD                  = RWH3.RTL_WH_CD
        AND  PRD2.PRCH_REQ_BAL_QTY           &gt; 0
        AND  PRD2.PRCH_REQ_REL_ERR_MSG_TXT  IS NOT NULL
        AND  PRD2.SRC_RTL_WH_CD              = #rtlWhCd#
        AND  PRH2.GLBL_CMPY_CD               = #glblCmpyCd#
        AND  PRH2.EZCANCELFLAG               = '0'
        AND  PRD2.GLBL_CMPY_CD               = #glblCmpyCd#
        AND  PRD2.EZCANCELFLAG               = '0'
        AND  PRLT2.GLBL_CMPY_CD(+)           = #glblCmpyCd#
        AND  PRLT2.EZCANCELFLAG(+)           = '0'
        AND  PRLS2.GLBL_CMPY_CD              = #glblCmpyCd#
        AND  PRLS2.EZCANCELFLAG              = '0'
        AND  RWH1.GLBL_CMPY_CD               = #glblCmpyCd#
        AND  RWH1.EZCANCELFLAG               = '0'
        AND  RWH3.GLBL_CMPY_CD               = #glblCmpyCd#
        AND  RWH3.EZCANCELFLAG               = '0'
        AND  SWH3.GLBL_CMPY_CD               = #glblCmpyCd#
        AND  SWH3.EZCANCELFLAG               = '0'
        ORDER BY
             PRD2.SRC_RTL_WH_CD
            ,PRD2.PRCH_REQ_LINE_TP_CD
            ,PRH2.PRCH_REQ_NUM
            ,PRD2.PRCH_REQ_LINE_NUM
            ,PRD2.PRCH_REQ_LINE_SUB_NUM
    </statement>

    <statement id="getRemoveInsrcRptWrkData" parameterClass="Map" resultClass="Map">
        SELECT 
            IRW.INSRC_RPT_WRK_PK
        FROM
            INSRC_RPT_WRK IRW
        WHERE 
            IRW.GLBL_CMPY_CD         = #glblCmpyCd#
        AND IRW.EZINTIME             &lt; #purgeTs#
        AND IRW.EZCANCELFLAG         = '0'
    </statement>

</sqlMap>
