<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="NSBL0160Query">
    <typeAlias alias="NSBL0160_BSMsg" type="business.blap.NSBL0160.NSBL0160_BSMsg"/>

    <statement id="checkSvcMemoType" parameterClass="Map" resultClass="String">
        SELECT
                ST.SVC_MEMO_TP_NM          SVC_MEMO_TP_NM
        FROM    
                SVC_MEMO     SM
              , SVC_MEMO_TP  ST
        WHERE
                SM.SVC_MEMO_CATG_CD    = #svcMemoCatgCd#
          AND   SM.GLBL_CMPY_CD        = #glblCmpyCd#
          AND   SM.EZCANCELFLAG        = '0'
          AND   SM.SVC_MEMO_TP_CD      = #svcMemoTpCd#
        <isNotNull property="where0">
            <isNull property="condition0">
          AND   $where0$              IS NULL
            </isNull>
            <isNotNull property="condition0">
          AND   $where0$               = #condition0#
            </isNotNull>
        </isNotNull>
        <isNotNull property="where1">
            <isNull property="condition1">
          AND   $where1$              IS NULL
            </isNull>
            <isNotNull property="condition1">
          AND   $where1$               = #condition1#
            </isNotNull>
        </isNotNull>
        <isNotNull property="where2">
            <isNull property="condition2">
          AND   $where2$              IS NULL
            </isNull>
            <isNotNull property="condition2">
          AND   $where2$               = #condition2#
            </isNotNull>
        </isNotNull>
        <isNotNull property="where3">
            <isNull property="condition3">
          AND   $where3$              IS NULL
            </isNull>
            <isNotNull property="condition3">
          AND   $where3$               = #condition3#
            </isNotNull>
        </isNotNull>
        <isNotNull property="where4">
            <isNull property="condition4">
          AND   $where4$              IS NULL
            </isNull>
            <isNotNull property="condition4">
          AND   $where4$               = #condition4#
            </isNotNull>
        </isNotNull>

          AND   SM.SVC_MEMO_TP_CD      = ST.SVC_MEMO_TP_CD
          AND   SM.GLBL_CMPY_CD        = ST.GLBL_CMPY_CD
          AND   ST.EZCANCELFLAG        = '0'
          AND   ROWNUM                 = 1
    </statement>

    <statement id="searchSvcMemoList" parameterClass="Map" resultMap="result.searchSvcMemoList">
        <!-- START 2022/05/11 [QC#56411, ADD] -->
        WITH SVC_MEMO_PK_LIST AS (
            SELECT
                MIN(SVC_MEMO_PK) SVC_MEMO_PK
            FROM
                SVC_MEMO SM
            WHERE
                SM.GLBL_CMPY_CD                = #glblCmpyCd#
            AND SM.EZCANCELFLAG                = '0'
            AND SM.SVC_MEMO_CATG_CD            = #svcMemoCatgCd#
                <isNotNull property="svcMemoTpCd">
                  AND   SM.SVC_MEMO_TP_CD      = #svcMemoTpCd#
                </isNotNull>
                <isNotNull property="svcMemoRsnCd">
                  AND   SM.SVC_MEMO_RSN_CD     = #svcMemoRsnCd#
                </isNotNull>
                <isNotNull property="fromTs">
                  AND   SM.LAST_UPD_TS     &gt;= #fromTs#
                </isNotNull>
                <isNotNull property="thruTs">
                  AND   SM.LAST_UPD_TS     &lt;= #thruTs#
                </isNotNull>
                <isNotNull property="where0">
                    <isNull property="condition0">
                  AND   $where0$              IS NULL
                    </isNull>
                    <isNotNull property="condition0">
                  AND   $where0$               = #condition0#
                    </isNotNull>
                </isNotNull>
                <isNotNull property="where1">
                    <isNull property="condition1">
                  AND   $where1$              IS NULL
                    </isNull>
                    <isNotNull property="condition1">
                  AND   $where1$               = #condition1#
                    </isNotNull>
                </isNotNull>
                <isNotNull property="where2">
                    <isNull property="condition2">
                  AND   $where2$              IS NULL
                    </isNull>
                    <isNotNull property="condition2">
                  AND   $where2$               = #condition2#
                    </isNotNull>
                </isNotNull>
                <isNotNull property="where3">
                    <isNull property="condition3">
                  AND   $where3$              IS NULL
                    </isNull>
                    <isNotNull property="condition3">
                  AND   $where3$               = #condition3#
                    </isNotNull>
                </isNotNull>
                <isNotNull property="where4">
                    <isNull property="condition4">
                  AND   $where4$              IS NULL
                    </isNull>
                    <isNotNull property="condition4">
                  AND   $where4$               = #condition4#
                    </isNotNull>
                </isNotNull>
            GROUP BY
                 SM.LAST_UPD_USR_ID            -- Who Created
                ,SUBSTR(SM.LAST_UPD_TS, 1, 12) -- Date Updated
                ,SM.EZUPAPLID                  -- Manual
                ,SM.SVC_MEMO_RSN_CD            -- Reason Code
                ,SM.SVC_CMNT_TXT               -- Notes
            )
            <!-- END 2022/05/11 [QC#56411, ADD] -->
        SELECT
                A.EZUPTIME                 EZUPTIME
              , A.EZUPTIMEZONE             EZUPTIMEZONE
              , A.MANUAL                   MANUAL
              , A.SVC_MEMO_PK              SVC_MEMO_PK
              , A.SVC_MEMO_CATG_CD         SVC_MEMO_CATG_CD
              , A.SVC_MEMO_TP_CD           SVC_MEMO_TP_CD
              , A.SVC_MEMO_TP_DESC_TXT     SVC_MEMO_TP_DESC_TXT
              , A.SVC_MEMO_RSN_CD          SVC_MEMO_RSN_CD
              , A.SVC_MEMO_RSN_DESC_TXT    SVC_MEMO_RSN_DESC_TXT
              , A.LAST_UPD_USR_ID          LAST_UPD_USR_ID
              , A.FULL_PSN_NM              FULL_PSN_NM
              , A.SVC_CMNT_TXT             SVC_CMNT_TXT
              , A.SVC_CMNT_TXT             SVC_CMNT_TXT_BK
              , A.LAST_UPD_TS              LAST_UPD_TS
              , A.SVC_TASK_NUM             SVC_TASK_NUM
              , A.FSR_NUM                  FSR_NUM
              , A.SVC_MACH_MSTR_PK         SVC_MACH_MSTR_PK
              , A.DS_CONTR_PK              DS_CONTR_PK
              , A.DS_CONTR_DTL_PK          DS_CONTR_DTL_PK
              , A.SVC_INV_PK               SVC_INV_PK
              , A.SVC_CONTR_BLLG_PK        SVC_CONTR_BLLG_PK
              <!-- START 2016/12/05 K.Kojima [QC#14204, ADD] -->
              , A.XX_REC_HIST_CRAT_TS_B
              , A.XX_REC_HIST_CRAT_BY_NM_B
              , A.XX_REC_HIST_UPD_TS_B
              , A.XX_REC_HIST_UPD_BY_NM_B
              , A.XX_REC_HIST_TBL_NM_B
              <!-- END 2016/12/05 K.Kojima [QC#14204, ADD] -->
        FROM
            (
                SELECT
                        SM.EZUPTIME                EZUPTIME
                      , SM.EZUPTIMEZONE            EZUPTIMEZONE
                      , CASE WHEN
                          SM.EZUPAPLID = #ezUpAplId#
                          THEN
                              #Manual1#
                          ELSE
                              #Manual2#
                          END                      MANUAL
                      , SM.SVC_MEMO_PK             SVC_MEMO_PK
                      , SM.SVC_MEMO_CATG_CD        SVC_MEMO_CATG_CD
                      , SM.SVC_MEMO_TP_CD          SVC_MEMO_TP_CD
                      , ST.SVC_MEMO_TP_DESC_TXT    SVC_MEMO_TP_DESC_TXT
                      , SM.SVC_MEMO_RSN_CD         SVC_MEMO_RSN_CD
                      , SR.SVC_MEMO_RSN_DESC_TXT   SVC_MEMO_RSN_DESC_TXT
                      , SM.LAST_UPD_USR_ID         LAST_UPD_USR_ID
                      , TRIM (AP.FIRST_NM) || ' ' || TRIM (AP.LAST_NM) 
                                                   FULL_PSN_NM
                      , SM.SVC_CMNT_TXT            SVC_CMNT_TXT
                      , SM.SVC_CMNT_TXT            SVC_CMNT_TXT_BK
                      , SM.LAST_UPD_TS             LAST_UPD_TS
                      , SM.SVC_TASK_NUM            SVC_TASK_NUM
                      , SM.FSR_NUM                 FSR_NUM
                      , SM.SVC_MACH_MSTR_PK        SVC_MACH_MSTR_PK
                      , SM.DS_CONTR_PK             DS_CONTR_PK
                      , SM.DS_CONTR_DTL_PK         DS_CONTR_DTL_PK
                      , SM.SVC_INV_PK              SVC_INV_PK
                      , SM.SVC_CONTR_BLLG_PK       SVC_CONTR_BLLG_PK
                      <!-- START 2016/12/05 K.Kojima [QC#14204, ADD] -->
                      , SM.EZINTIME             AS XX_REC_HIST_CRAT_TS_B
                      , SM.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM_B
                      , SM.EZUPTIME             AS XX_REC_HIST_UPD_TS_B
                      , SM.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM_B
                      , SM.EZTABLEID            AS XX_REC_HIST_TBL_NM_B
                      <!-- END 2016/12/05 K.Kojima [QC#14204, ADD] -->
                FROM    
                        SVC_MEMO     SM
                      , SVC_MEMO_TP  ST
                      , SVC_MEMO_RSN SR
                      , AUTH_PSN     AP
                WHERE
                        <!-- START 2022/05/11 [QC#56411, ADD] -->
                        SM.SVC_MEMO_PK         IN (SELECT SVC_MEMO_PK FROM SVC_MEMO_PK_LIST)
                        <!-- END   2022/05/11 [QC#56411, ADD] -->
                <!-- START 2022/05/11 [QC#56411, DEL] -->
                <!--         SM.SVC_MEMO_CATG_CD    = #svcMemoCatgCd# -->
                <!--   AND   SM.GLBL_CMPY_CD        = #glblCmpyCd# -->
                <!--   AND   SM.EZCANCELFLAG        = '0' -->
                <!-- <isNotNull property="svcMemoTpCd"> -->
                <!--   AND   SM.SVC_MEMO_TP_CD      = #svcMemoTpCd# -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="svcMemoRsnCd"> -->
                <!--   AND   SM.SVC_MEMO_RSN_CD     = #svcMemoRsnCd# -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="fromTs"> -->
                <!--   AND   SM.LAST_UPD_TS     &gt;= #fromTs# -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="thruTs"> -->
                <!--   AND   SM.LAST_UPD_TS     &lt;= #thruTs# -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="where0"> -->
                <!--     <isNull property="condition0"> -->
                <!--   AND   $where0$              IS NULL -->
                <!--     </isNull> -->
                <!--     <isNotNull property="condition0"> -->
                <!--   AND   $where0$               = #condition0# -->
                <!--     </isNotNull> -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="where1"> -->
                <!--     <isNull property="condition1"> -->
                <!--   AND   $where1$              IS NULL -->
                <!--     </isNull> -->
                <!--     <isNotNull property="condition1"> -->
                <!--   AND   $where1$               = #condition1# -->
                <!--     </isNotNull> -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="where2"> -->
                <!--     <isNull property="condition2"> -->
                <!--   AND   $where2$              IS NULL -->
                <!--     </isNull> -->
                <!--     <isNotNull property="condition2"> -->
                <!--   AND   $where2$               = #condition2# -->
                <!--     </isNotNull> -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="where3"> -->
                <!--     <isNull property="condition3"> -->
                <!--   AND   $where3$              IS NULL -->
                <!--     </isNull> -->
                <!--     <isNotNull property="condition3"> -->
                <!--   AND   $where3$               = #condition3# -->
                <!--     </isNotNull> -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="where4"> -->
                <!--     <isNull property="condition4"> -->
                <!--   AND   $where4$              IS NULL -->
                <!--     </isNull> -->
                <!--     <isNotNull property="condition4"> -->
                <!--   AND   $where4$               = #condition4# -->
                <!--     </isNotNull> -->
                <!-- </isNotNull> -->
                <!-- END   2022/05/11 [QC#56411, DEL] -->

                  AND   SM.SVC_MEMO_TP_CD      = ST.SVC_MEMO_TP_CD   (+)
                  AND   SM.GLBL_CMPY_CD        = ST.GLBL_CMPY_CD     (+)
                  AND   ST.EZCANCELFLAG    (+) = '0'
                  AND   SM.SVC_MEMO_RSN_CD     = SR.SVC_MEMO_RSN_CD  (+)
                  AND   SM.GLBL_CMPY_CD        = SR.GLBL_CMPY_CD     (+)
                  AND   SR.EZCANCELFLAG    (+) = '0'
                  AND   SM.LAST_UPD_USR_ID     = AP.USR_NM           (+)
                  AND   SM.GLBL_CMPY_CD        = AP.GLBL_CMPY_CD     (+)
                  AND   AP.EZCANCELFLAG    (+) = '0'

                ORDER BY SM.LAST_UPD_TS DESC
                <iterate property="sortList" var="sortList[]" open="," close="" conjunction=",">
                      $sortList[]$
                </iterate>
                        ,SM.SVC_MEMO_PK
            ) A
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>
    <resultMap id="result.searchSvcMemoList" class="NSBL0160_BSMsg">
        <result property="ezUpTime_B"             column="EZUPTIME"                 javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_B"         column="EZUPTIMEZONE"             javaType="EZDSStringItem"/>
        <result property="xxScrItem40Txt_B"       column="MANUAL"                   javaType="EZDSStringItem"/>
        <result property="svcMemoPk_B"            column="SVC_MEMO_PK"              javaType="EZDSBigDecimalItem"/>
        <result property="svcMemoCatgCd_B"        column="SVC_MEMO_CATG_CD"         javaType="EZDSStringItem"/>
        <result property="svcMemoTpCd_B"          column="SVC_MEMO_TP_CD"           javaType="EZDSStringItem"/>
        <result property="svcMemoTpDescTxt_B"     column="SVC_MEMO_TP_DESC_TXT"     javaType="EZDSStringItem"/>
        <result property="svcMemoRsnCd_B"         column="SVC_MEMO_RSN_CD"          javaType="EZDSStringItem"/>
        <result property="svcMemoRsnDescTxt_B"    column="SVC_MEMO_RSN_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="lastUpdUsrId_B"         column="LAST_UPD_USR_ID"          javaType="EZDSStringItem"/>
        <result property="fullPsnNm_B"            column="FULL_PSN_NM"              javaType="EZDSStringItem"/>
        <result property="svcCmntTxt_B"           column="SVC_CMNT_TXT"             javaType="EZDSStringItem"/>
        <result property="svcCmntTxt_BK"          column="SVC_CMNT_TXT_BK"          javaType="EZDSStringItem"/>
        <result property="lastUpdTs_B"            column="LAST_UPD_TS"              javaType="EZDSStringItem"/>
        <!-- START 2016/12/05 K.Kojima [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_B"      column="XX_REC_HIST_CRAT_TS_B"    javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_B"    column="XX_REC_HIST_CRAT_BY_NM_B" javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_B"       column="XX_REC_HIST_UPD_TS_B"     javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_B"     column="XX_REC_HIST_UPD_BY_NM_B"  javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_B"       column="XX_REC_HIST_TBL_NM_B"     javaType="EZDSStringItem"/>
        <!-- END 2016/12/05 K.Kojima [QC#14204, ADD] -->
    </resultMap>

    <statement id="searchSvcMemoDispatchList" parameterClass="Map" resultMap="result.searchSvcMemoDispatchList">
        <!-- START 2022/05/11 [QC#56411, ADD] -->
        WITH SVC_MEMO_PK_LIST AS (
            SELECT
                MIN(SVC_MEMO_PK) SVC_MEMO_PK
            FROM
                SVC_MEMO SM
            WHERE
                SM.GLBL_CMPY_CD                = #glblCmpyCd#
            AND SM.EZCANCELFLAG                = '0'
            AND SM.SVC_MEMO_CATG_CD            = #svcMemoCatgCd#
                <isNotNull property="svcMemoTpCd">
                  AND   SM.SVC_MEMO_TP_CD      = #svcMemoTpCd#
                </isNotNull>
                <isNotNull property="svcMemoRsnCd">
                  AND   SM.SVC_MEMO_RSN_CD     = #svcMemoRsnCd#
                </isNotNull>
                <isNotNull property="fromTs">
                  AND   SM.LAST_UPD_TS     &gt;= #fromTs#
                </isNotNull>
                <isNotNull property="thruTs">
                  AND   SM.LAST_UPD_TS     &lt;= #thruTs#
                </isNotNull>
                <isNotNull property="where0">
                    <isNull property="condition0">
                  AND   $where0$              IS NULL
                    </isNull>
                    <isNotNull property="condition0">
                  AND   $where0$               = #condition0#
                    </isNotNull>
                </isNotNull>
                <isNotNull property="where1">
                    <isNull property="condition1">
                  AND   $where1$              IS NULL
                    </isNull>
                    <isNotNull property="condition1">
                  AND   $where1$               = #condition1#
                    </isNotNull>
                </isNotNull>
                <isNotNull property="where2">
                    <isNull property="condition2">
                  AND   $where2$              IS NULL
                    </isNull>
                    <isNotNull property="condition2">
                  AND   $where2$               = #condition2#
                    </isNotNull>
                </isNotNull>
                <isNotNull property="where3">
                    <isNull property="condition3">
                  AND   $where3$              IS NULL
                    </isNull>
                    <isNotNull property="condition3">
                  AND   $where3$               = #condition3#
                    </isNotNull>
                </isNotNull>
                <isNotNull property="where4">
                    <isNull property="condition4">
                  AND   $where4$              IS NULL
                    </isNull>
                    <isNotNull property="condition4">
                  AND   $where4$               = #condition4#
                    </isNotNull>
                </isNotNull>
            GROUP BY
                 SM.LAST_UPD_USR_ID            -- Who Created
                ,SUBSTR(SM.LAST_UPD_TS, 1, 12) -- Date Updated
                ,SM.EZUPAPLID                  -- Manual
                ,SM.SVC_MEMO_RSN_CD            -- Reason Code
                ,SM.SVC_CMNT_TXT               -- Notes
        )
        <isNotNull property="fsrNum">
        ,SVC_MEMO_PK_LIST_FSR AS (
            SELECT
                MIN(SVC_MEMO_PK) SVC_MEMO_PK
            FROM
                 SVC_TASK ST
                ,SVC_MEMO SM
            WHERE
                    ST.FSR_NUM             = #fsrNum#
                AND ST.GLBL_CMPY_CD        = #glblCmpyCd#
                AND ST.EZCANCELFLAG        = '0'
                AND ST.SVC_TASK_NUM        = SM.SVC_TASK_NUM
                AND ST.GLBL_CMPY_CD        = SM.GLBL_CMPY_CD
                AND SM.SVC_MEMO_CATG_CD    = #svcMemoCatgCd#
                <isNotNull property="svcMemoTpCd">
                AND SM.SVC_MEMO_TP_CD      = #svcMemoTpCd#
                </isNotNull>
                <isNotNull property="svcMemoRsnCd">
                AND SM.SVC_MEMO_RSN_CD     = #svcMemoRsnCd#
                </isNotNull>
                <isNotNull property="fromTs">
                AND SM.LAST_UPD_TS     &gt;= #fromTs#
                </isNotNull>
                <isNotNull property="thruTs">
                AND SM.LAST_UPD_TS     &lt;= #thruTs#
                </isNotNull>
                AND SM.EZCANCELFLAG        = '0'
          GROUP BY
                 SM.LAST_UPD_USR_ID            -- Who Created
                ,SUBSTR(SM.LAST_UPD_TS, 1, 12) -- Date Updated
                ,SM.EZUPAPLID                  -- Manual
                ,SM.SVC_MEMO_RSN_CD            -- Reason Code
                ,SM.SVC_CMNT_TXT               -- Notes
        )
        </isNotNull>
        <!-- END 2022/05/11 [QC#56411, ADD] -->
        SELECT
                A.EZUPTIME                 EZUPTIME
              , A.EZUPTIMEZONE             EZUPTIMEZONE
              , A.MANUAL                   MANUAL
              , A.SVC_MEMO_PK              SVC_MEMO_PK
              , A.SVC_MEMO_CATG_CD         SVC_MEMO_CATG_CD
              , A.SVC_MEMO_TP_CD           SVC_MEMO_TP_CD
              , A.SVC_MEMO_TP_DESC_TXT     SVC_MEMO_TP_DESC_TXT
              , A.SVC_MEMO_RSN_CD          SVC_MEMO_RSN_CD
              , A.SVC_MEMO_RSN_DESC_TXT    SVC_MEMO_RSN_DESC_TXT
              , A.LAST_UPD_USR_ID          LAST_UPD_USR_ID
              , A.FULL_PSN_NM              FULL_PSN_NM
              , A.SVC_CMNT_TXT             SVC_CMNT_TXT
              , A.SVC_CMNT_TXT             SVC_CMNT_TXT_BK
              , A.LAST_UPD_TS              LAST_UPD_TS
              , A.SVC_TASK_NUM             SVC_TASK_NUM
              , A.FSR_NUM                  FSR_NUM
              , A.SVC_MACH_MSTR_PK         SVC_MACH_MSTR_PK
              , A.DS_CONTR_PK              DS_CONTR_PK
              , A.DS_CONTR_DTL_PK          DS_CONTR_DTL_PK
              , A.SVC_INV_PK               SVC_INV_PK
              , A.SVC_CONTR_BLLG_PK        SVC_CONTR_BLLG_PK
              , A.SVC_MEMO_TP_SORT_NUM     SVC_MEMO_TP_SORT_NUM
              <!-- START 2016/12/05 K.Kojima [QC#14204, ADD] -->
              , A.XX_REC_HIST_CRAT_TS_B
              , A.XX_REC_HIST_CRAT_BY_NM_B
              , A.XX_REC_HIST_UPD_TS_B
              , A.XX_REC_HIST_UPD_BY_NM_B
              , A.XX_REC_HIST_TBL_NM_B
              <!-- END 2016/12/05 K.Kojima [QC#14204, ADD] -->
        FROM
            (
                SELECT
                        SM.EZUPTIME                EZUPTIME
                      , SM.EZUPTIMEZONE            EZUPTIMEZONE
                      , CASE WHEN
                          SM.EZUPAPLID = #ezUpAplId#
                          THEN
                              #Manual1#
                          ELSE
                              #Manual2#
                          END                      MANUAL
                      , SM.SVC_MEMO_PK             SVC_MEMO_PK
                      , SM.SVC_MEMO_CATG_CD        SVC_MEMO_CATG_CD
                      , SM.SVC_MEMO_TP_CD          SVC_MEMO_TP_CD
                      , ST.SVC_MEMO_TP_DESC_TXT    SVC_MEMO_TP_DESC_TXT
                      , SM.SVC_MEMO_RSN_CD         SVC_MEMO_RSN_CD
                      , SR.SVC_MEMO_RSN_DESC_TXT   SVC_MEMO_RSN_DESC_TXT
                      , SM.LAST_UPD_USR_ID         LAST_UPD_USR_ID
                      , TRIM (AP.FIRST_NM) || ' ' || TRIM (AP.LAST_NM) 
                                                   FULL_PSN_NM
                      , SM.SVC_CMNT_TXT            SVC_CMNT_TXT
                      , SM.SVC_CMNT_TXT            SVC_CMNT_TXT_BK
                      , SM.LAST_UPD_TS             LAST_UPD_TS
                      , SM.SVC_TASK_NUM            SVC_TASK_NUM
                      , SM.FSR_NUM                 FSR_NUM
                      , SM.SVC_MACH_MSTR_PK        SVC_MACH_MSTR_PK
                      , SM.DS_CONTR_PK             DS_CONTR_PK
                      , SM.DS_CONTR_DTL_PK         DS_CONTR_DTL_PK
                      , SM.SVC_INV_PK              SVC_INV_PK
                      , SM.SVC_CONTR_BLLG_PK       SVC_CONTR_BLLG_PK
                      , ST.SVC_MEMO_TP_SORT_NUM    SVC_MEMO_TP_SORT_NUM
                      <!-- START 2016/12/05 K.Kojima [QC#14204, ADD] -->
                      , SM.EZINTIME             AS XX_REC_HIST_CRAT_TS_B
                      , SM.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM_B
                      , SM.EZUPTIME             AS XX_REC_HIST_UPD_TS_B
                      , SM.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM_B
                      , SM.EZTABLEID            AS XX_REC_HIST_TBL_NM_B
                      <!-- END 2016/12/05 K.Kojima [QC#14204, ADD] -->
                FROM    
                        SVC_MEMO     SM
                      , SVC_MEMO_TP  ST
                      , SVC_MEMO_RSN SR
                      , AUTH_PSN     AP
                WHERE
                        <!-- START 2022/05/11 [QC#56411, ADD] -->
                        SM.SVC_MEMO_PK         IN (SELECT SVC_MEMO_PK FROM SVC_MEMO_PK_LIST)
                        <!-- END   2022/05/11 [QC#56411, ADD] -->
                <!-- START 2022/05/11 [QC#56411, DEL] -->
                <!--         SM.SVC_MEMO_CATG_CD    = #svcMemoCatgCd# -->
                <!--   AND   SM.GLBL_CMPY_CD        = #glblCmpyCd# -->
                <!--   AND   SM.EZCANCELFLAG        = '0' -->
                <!-- <isNotNull property="svcMemoTpCd"> -->
                <!--   AND   SM.SVC_MEMO_TP_CD      = #svcMemoTpCd# -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="svcMemoRsnCd"> -->
                <!--   AND   SM.SVC_MEMO_RSN_CD     = #svcMemoRsnCd# -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="fromTs"> -->
                <!--   AND   SM.LAST_UPD_TS     &gt;= #fromTs# -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="thruTs"> -->
                <!--   AND   SM.LAST_UPD_TS     &lt;= #thruTs# -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="where0"> -->
                <!--     <isNull property="condition0"> -->
                <!--   AND   $where0$              IS NULL -->
                <!--     </isNull> -->
                <!--     <isNotNull property="condition0"> -->
                <!--   AND   $where0$               = #condition0# -->
                <!--     </isNotNull> -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="where1"> -->
                <!--     <isNull property="condition1"> -->
                <!--   AND   $where1$              IS NULL -->
                <!--     </isNull> -->
                <!--     <isNotNull property="condition1"> -->
                <!--   AND   $where1$               = #condition1# -->
                <!--     </isNotNull> -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="where2"> -->
                <!--     <isNull property="condition2"> -->
                <!--   AND   $where2$              IS NULL -->
                <!--     </isNull> -->
                <!--     <isNotNull property="condition2"> -->
                <!--   AND   $where2$               = #condition2# -->
                <!--     </isNotNull> -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="where3"> -->
                <!--     <isNull property="condition3"> -->
                <!--   AND   $where3$              IS NULL -->
                <!--     </isNull> -->
                <!--     <isNotNull property="condition3"> -->
                <!--   AND   $where3$               = #condition3# -->
                <!--     </isNotNull> -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="where4"> -->
                <!--     <isNull property="condition4"> -->
                <!--   AND   $where4$              IS NULL -->
                <!--     </isNull> -->
                <!--     <isNotNull property="condition4"> -->
                <!--   AND   $where4$               = #condition4# -->
                <!--     </isNotNull> -->
                <!-- </isNotNull> -->
                <!-- END   2022/05/11 [QC#56411, DEL] -->
                  AND   SM.SVC_MEMO_TP_CD      = ST.SVC_MEMO_TP_CD   (+)
                  AND   SM.GLBL_CMPY_CD        = ST.GLBL_CMPY_CD     (+)
                  AND   ST.EZCANCELFLAG    (+) = '0'
                  AND   SM.SVC_MEMO_RSN_CD     = SR.SVC_MEMO_RSN_CD  (+)
                  AND   SM.GLBL_CMPY_CD        = SR.GLBL_CMPY_CD     (+)
                  AND   SR.EZCANCELFLAG    (+) = '0'
                  AND   SM.LAST_UPD_USR_ID     = AP.USR_NM           (+)
                  AND   SM.GLBL_CMPY_CD        = AP.GLBL_CMPY_CD     (+)
                  AND   AP.EZCANCELFLAG    (+) = '0'
                <isNotNull property="fsrNum">
                UNION

                SELECT
                        SM.EZUPTIME                EZUPTIME
                      , SM.EZUPTIMEZONE            EZUPTIMEZONE
                      , CASE WHEN
                          SM.EZUPAPLID = #ezUpAplId#
                          THEN
                              #Manual1#
                          ELSE
                              #Manual2#
                          END                      MANUAL
                      , SM.SVC_MEMO_PK             SVC_MEMO_PK
                      , SM.SVC_MEMO_CATG_CD        SVC_MEMO_CATG_CD
                      , SM.SVC_MEMO_TP_CD          SVC_MEMO_TP_CD
                      , TP.SVC_MEMO_TP_DESC_TXT    SVC_MEMO_TP_DESC_TXT
                      , SM.SVC_MEMO_RSN_CD         SVC_MEMO_RSN_CD
                      , SR.SVC_MEMO_RSN_DESC_TXT   SVC_MEMO_RSN_DESC_TXT
                      , SM.LAST_UPD_USR_ID         LAST_UPD_USR_ID
                      , TRIM (AP.FIRST_NM) || ' ' || TRIM (AP.LAST_NM) 
                                                   FULL_PSN_NM
                      , SM.SVC_CMNT_TXT            SVC_CMNT_TXT
                      , SM.SVC_CMNT_TXT            SVC_CMNT_TXT_BK
                      , SM.LAST_UPD_TS             LAST_UPD_TS
                      , SM.SVC_TASK_NUM            SVC_TASK_NUM
                      , SM.FSR_NUM                 FSR_NUM
                      , SM.SVC_MACH_MSTR_PK        SVC_MACH_MSTR_PK
                      , SM.DS_CONTR_PK             DS_CONTR_PK
                      , SM.DS_CONTR_DTL_PK         DS_CONTR_DTL_PK
                      , SM.SVC_INV_PK              SVC_INV_PK
                      , SM.SVC_CONTR_BLLG_PK       SVC_CONTR_BLLG_PK
                      , TP.SVC_MEMO_TP_SORT_NUM    SVC_MEMO_TP_SORT_NUM
                      <!-- START 2016/12/05 K.Kojima [QC#14204, ADD] -->
                      , SM.EZINTIME             AS XX_REC_HIST_CRAT_TS_B
                      , SM.EZINUSERID           AS XX_REC_HIST_CRAT_BY_NM_B
                      , SM.EZUPTIME             AS XX_REC_HIST_UPD_TS_B
                      , SM.EZUPUSERID           AS XX_REC_HIST_UPD_BY_NM_B
                      , SM.EZTABLEID            AS XX_REC_HIST_TBL_NM_B
                      <!-- END 2016/12/05 K.Kojima [QC#14204, ADD] -->
                FROM    
                        <!-- START 2022/05/11 [QC#56411, MOD] -->
                      <!--   SVC_TASK     ST -->
                      <!-- , SVC_MEMO     SM -->
                        SVC_MEMO     SM
                        <!-- END   2022/05/11 [QC#56411, MOD] -->
                      , SVC_MEMO_TP  TP
                      , SVC_MEMO_RSN SR
                      , AUTH_PSN     AP
                WHERE
                        <!-- START 2022/05/11 [QC#56411, ADD] -->
                        SM.SVC_MEMO_PK         IN (SELECT SVC_MEMO_PK FROM SVC_MEMO_PK_LIST_FSR)
                        <!-- END   2022/05/11 [QC#56411, ADD] -->
                <!-- START 2022/05/11 [QC#56411, DEL] -->
                <!--         ST.FSR_NUM             = #fsrNum# -->
                <!--   AND   ST.GLBL_CMPY_CD        = #glblCmpyCd# -->
                <!--   AND   ST.EZCANCELFLAG        = '0' -->

                <!--   AND   ST.SVC_TASK_NUM        = SM.SVC_TASK_NUM -->
                <!--   AND   ST.GLBL_CMPY_CD        = SM.GLBL_CMPY_CD -->
                <!--   AND   SM.SVC_MEMO_CATG_CD    = #svcMemoCatgCd# -->
                <!-- <isNotNull property="svcMemoTpCd"> -->
                <!--   AND   SM.SVC_MEMO_TP_CD      = #svcMemoTpCd# -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="svcMemoRsnCd"> -->
                <!--   AND   SM.SVC_MEMO_RSN_CD     = #svcMemoRsnCd# -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="fromTs"> -->
                <!--   AND   SM.LAST_UPD_TS     &gt;= #fromTs# -->
                <!-- </isNotNull> -->
                <!-- <isNotNull property="thruTs"> -->
                <!--   AND   SM.LAST_UPD_TS     &lt;= #thruTs# -->
                <!-- </isNotNull> -->
                <!--   AND   SM.EZCANCELFLAG        = '0' -->
                <!-- END   2022/05/11 [QC#56411, DEL] -->

                  AND   SM.SVC_MEMO_TP_CD      = TP.SVC_MEMO_TP_CD   (+)
                  AND   SM.GLBL_CMPY_CD        = TP.GLBL_CMPY_CD     (+)
                  AND   TP.EZCANCELFLAG    (+) = '0'
                  AND   SM.SVC_MEMO_RSN_CD     = SR.SVC_MEMO_RSN_CD  (+)
                  AND   SM.GLBL_CMPY_CD        = SR.GLBL_CMPY_CD     (+)
                  AND   SR.EZCANCELFLAG    (+) = '0'
                  AND   SM.LAST_UPD_USR_ID     = AP.USR_NM           (+)
                  AND   SM.GLBL_CMPY_CD        = AP.GLBL_CMPY_CD     (+)
                  AND   AP.EZCANCELFLAG    (+) = '0'
                </isNotNull>
                ORDER BY LAST_UPD_TS DESC
                <iterate property="sortList" var="sortList[]" open="," close="" conjunction=",">
                    $sortList[]$
                </iterate>
                <isNotNull property="fsrNum">
                    , SVC_TASK_NUM
                </isNotNull>
                    , SVC_MEMO_PK
            ) A
        WHERE
            ROWNUM &lt;= #rowNum#
    </statement>
    <resultMap id="result.searchSvcMemoDispatchList" class="NSBL0160_BSMsg">
        <result property="ezUpTime_B"             column="EZUPTIME"                 javaType="EZDSStringItem"/>
        <result property="ezUpTimeZone_B"         column="EZUPTIMEZONE"             javaType="EZDSStringItem"/>
        <result property="xxScrItem40Txt_B"       column="MANUAL"                   javaType="EZDSStringItem"/>
        <result property="svcMemoPk_B"            column="SVC_MEMO_PK"              javaType="EZDSBigDecimalItem"/>
        <result property="svcMemoCatgCd_B"        column="SVC_MEMO_CATG_CD"         javaType="EZDSStringItem"/>
        <result property="svcMemoTpCd_B"          column="SVC_MEMO_TP_CD"           javaType="EZDSStringItem"/>
        <result property="svcMemoTpDescTxt_B"     column="SVC_MEMO_TP_DESC_TXT"     javaType="EZDSStringItem"/>
        <result property="svcMemoRsnCd_B"         column="SVC_MEMO_RSN_CD"          javaType="EZDSStringItem"/>
        <result property="svcMemoRsnDescTxt_B"    column="SVC_MEMO_RSN_DESC_TXT"    javaType="EZDSStringItem"/>
        <result property="lastUpdUsrId_B"         column="LAST_UPD_USR_ID"          javaType="EZDSStringItem"/>
        <result property="fullPsnNm_B"            column="FULL_PSN_NM"              javaType="EZDSStringItem"/>
        <result property="svcCmntTxt_B"           column="SVC_CMNT_TXT"             javaType="EZDSStringItem"/>
        <result property="svcCmntTxt_BK"          column="SVC_CMNT_TXT_BK"          javaType="EZDSStringItem"/>
        <result property="lastUpdTs_B"            column="LAST_UPD_TS"              javaType="EZDSStringItem"/>
        <result property="svcTaskNum_B"           column="SVC_TASK_NUM"             javaType="EZDSStringItem"/>
        <!-- START 2016/12/05 K.Kojima [QC#14204, ADD] -->
        <result property="xxRecHistCratTs_B"      column="XX_REC_HIST_CRAT_TS_B"    javaType="EZDSStringItem"/>
        <result property="xxRecHistCratByNm_B"    column="XX_REC_HIST_CRAT_BY_NM_B" javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdTs_B"       column="XX_REC_HIST_UPD_TS_B"     javaType="EZDSStringItem"/>
        <result property="xxRecHistUpdByNm_B"     column="XX_REC_HIST_UPD_BY_NM_B"  javaType="EZDSStringItem"/>
        <result property="xxRecHistTblNm_B"       column="XX_REC_HIST_TBL_NM_B"     javaType="EZDSStringItem"/>
        <!-- END 2016/12/05 K.Kojima [QC#14204, ADD] -->
    </resultMap>

    <statement id="getSvcMemoRsnPullDown" parameterClass="Map" resultClass="Map">
        SELECT
             B.SVC_MEMO_RSN_CD
            ,B.SVC_MEMO_RSN_DESC_TXT
        FROM
             SVC_MEMO_TP  A
            ,SVC_MEMO_RSN B
        WHERE
            A.GLBL_CMPY_CD     = #glblCmpyCd#
        AND A.EZCANCELFLAG     = '0'
        AND A.SVC_MEMO_CATG_CD = #svcMemoCatgCd#
        AND A.GLBL_CMPY_CD     = B.GLBL_CMPY_CD
        AND A.SVC_MEMO_TP_CD   = B.SVC_MEMO_TP_CD
        AND B.EZCANCELFLAG     = '0'
        ORDER BY
            B.SVC_MEMO_RSN_SORT_NUM
    </statement>
</sqlMap>
