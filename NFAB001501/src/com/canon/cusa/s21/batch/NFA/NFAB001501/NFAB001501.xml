<?xml version="1.0" encoding="UTF-8"?>

<sqlMap namespace="NFAB001501">

<!-- #################### Type Alias #################### -->

<!-- #################### Statement #################### -->
    
    <statement id="getDataNotJrnlized" parameterClass="Map" resultClass="Map">
      SELECT DR.GLBL_CMPY_CD               AS GLBL_CMPY_CD
            ,DR.AJE_INV_ACCT_DIST_PK       AS AJE_INV_ACCT_DIST_PK
            ,DR.DS_INV_SLS_CR_PK           AS DS_INV_SLS_CR_PK
            ,DR.GL_DT                      AS GL_DT
            ,DR.SYS_SRC_CD||'-'||DR.TRX_CD||'-'||DR.TRX_RSN_CD  AS AJE_ID
            ,DR.SYS_SRC_CD                 AS SYS_SRC_CD
            ,DR.SYS_SRC_NM                 AS SYS_SRC_NM
            ,DR.TRX_CD                     AS TRX_CD
            ,DR.TRX_NM                     AS TRX_NM
            ,DR.TRX_RSN_CD                 AS TRX_RSN_CD
            ,DR.TRX_RSN_NM                 AS TRX_RSN_NM
            ,DR.AJE_PTRN_IND_TP_CD_01      AS AJE_PTRN_IND_TP_CD_01
            ,DR.AJE_PTRN_IND_TP_NM_01      AS AJE_PTRN_IND_TP_NM_01
            ,DR.AJE_PTRN_ACTL_CD_01        AS AJE_PTRN_ACTL_CD_01
            ,DR.AJE_PTRN_ACTL_NM_01        AS AJE_PTRN_ACTL_NM_01
            ,DR.AJE_PTRN_IND_TP_CD_02      AS AJE_PTRN_IND_TP_CD_02
            ,DR.AJE_PTRN_IND_TP_NM_02      AS AJE_PTRN_IND_TP_NM_02
            ,DR.AJE_PTRN_ACTL_CD_02        AS AJE_PTRN_ACTL_CD_02
            ,DR.AJE_PTRN_ACTL_NM_02        AS AJE_PTRN_ACTL_NM_02
            ,DR.AJE_PTRN_IND_TP_CD_03      AS AJE_PTRN_IND_TP_CD_03
            ,DR.AJE_PTRN_IND_TP_NM_03      AS AJE_PTRN_IND_TP_NM_03
            ,DR.AJE_PTRN_ACTL_CD_03        AS AJE_PTRN_ACTL_CD_03
            ,DR.AJE_PTRN_ACTL_NM_03        AS AJE_PTRN_ACTL_NM_03
            ,DR.JRNL_SRC_CD                AS JRNL_SRC_CD
            ,DR.JRNL_SRC_NM                AS JRNL_SRC_NM
            ,DR.JRNL_CATG_CD               AS JRNL_CATG_CD
            ,DR.JRNL_CATG_NM               AS JRNL_CATG_NM
            ,DR.AJE_LINE_IDX_NUM           AS AJE_LINE_IDX_NUM
            ,DR.MDSE_CD                    AS AJE_ITEM_CD
            ,DR.MDSE_NM                    AS AJE_ITEM_DESC_TXT
            ,DR.AJE_LINE_IDX_DESC_TXT      AS DR_AJE_LINE_IDX_DESC_TXT
            ,DR.AJE_COA_CMPY_CD            AS DR_COA_CMPY_CD
            ,DR.AJE_COA_BR_CD              AS DR_COA_BR_CD
            ,DR.AJE_COA_CC_CD              AS DR_COA_CC_CD
            ,DR.AJE_COA_ACCT_CD            AS DR_COA_ACCT_CD
            ,DR.AJE_COA_PROD_CD            AS DR_COA_PROD_CD
            ,DR.AJE_COA_CH_CD              AS DR_COA_CH_CD
            ,DR.AJE_COA_AFFL_CD            AS DR_COA_AFFL_CD
            ,DR.AJE_COA_PROJ_CD            AS DR_COA_PROJ_CD
            ,DR.AJE_COA_EXTN_CD            AS DR_COA_EXTN_CD
            ,CR.AJE_COA_CMPY_CD            AS CR_COA_CMPY_CD
            ,CR.AJE_COA_BR_CD              AS CR_COA_BR_CD
            ,CR.AJE_COA_CC_CD              AS CR_COA_CC_CD
            ,CR.AJE_COA_ACCT_CD            AS CR_COA_ACCT_CD
            ,CR.AJE_COA_PROD_CD            AS CR_COA_PROD_CD
            ,CR.AJE_COA_CH_CD              AS CR_COA_CH_CD
            ,CR.AJE_COA_AFFL_CD            AS CR_COA_AFFL_CD
            ,CR.AJE_COA_PROJ_CD            AS CR_COA_PROJ_CD
            ,CR.AJE_COA_EXTN_CD            AS CR_COA_EXTN_CD
            
            <!-- Mod QC#59024 2021/07/26 Start -->
            <!-- ,DR.SHIP_QTY                   AS JRNL_QTY -->
            ,NVL(DR.SHIP_QTY, 0)           AS JRNL_QTY
            <!-- Mod QC#59024 2021/07/26 End -->
            ,DR.JRNL_DEAL_AMT              AS JRNL_DEAL_DR_AMT
            ,DR.JRNL_DEAL_AMT              AS JRNL_DEAL_CR_AMT
            ,DR.JRNL_FUNC_AMT              AS JRNL_FUNC_DR_AMT
            ,DR.JRNL_FUNC_AMT              AS JRNL_FUNC_CR_AMT
            ,DR.DEAL_CCY_CD                AS DEAL_CCY_CD
            ,DR.FUNC_CCY_CD                AS FUNC_CCY_CD
            ,DR.ORCL_CCY_CD                AS ORCL_CCY_CD
            ,DR.EXCH_RATE                  AS EXCH_RATE
            ,DR.ACCT_ARTH_TP_CD            AS ACCT_ARTH_TP_CD
            ,DR.COA_PROD_CD                AS COA_PROD_CD
            ,DR.SLS_REP_TOC_CD             AS TOC_CD
            ,DR.BILL_TO_CUST_CD            AS BILL_TO_CUST_CD
            ,DR.SHIP_TO_CUST_CD            AS SHIP_TO_CUST_CD
            ,DR.SELL_TO_CUST_CD            AS SELL_TO_CUST_CD
            ,DR.INV_NUM                    AS AJE_INV_NUM
            ,DR.CPO_ORD_NUM                AS CPO_ORD_NUM
            ,DR.SO_NUM                     AS SO_NUM
            ,DR.DS_ORD_TP_CD               AS DS_ORD_TP_CD
            ,DR.DS_ORD_RSN_CD              AS DS_ORD_RSN_CD
            ,DR.DS_ACCT_NUM                AS DS_ACCT_NUM
            ,DR.SER_NUM                    AS SER_NUM
            ,DR.SVC_MACH_MSTR_PK           AS SVC_MACH_MSTR_PK
            ,DR.DS_CONTR_PK                AS DS_CONTR_PK
            ,DR.DS_CONTR_DTL_PK            AS DS_CONTR_DTL_PK
            ,DR.DS_CONTR_NUM               AS DS_CONTR_NUM   -- ref 1
            ,TO_CHAR(DR.AJE_INV_ACCT_DIST_PCT)   AS AJE_INV_ACCT_DIST_PCT  -- ref 2
            <!-- Start Add QC#16075 2016/12/12 -->
            ,SUBSTR(NVL(DR.AJE_INTFC_CMNT_TXT, '') || NVL(CR.AJE_INTFC_CMNT_TXT, ''),1,240) AS AJE_INTFC_CMNT_TXT
            <!-- End Add QC#16075 2016/12/12 -->
            ,DR.CUST_ISS_PO_NUM            AS CUST_ISS_PO_NUM
            ,DR.DS_ORD_POSN_NUM            AS DS_ORD_POSN_NUM
            ,DR.DS_CPO_LINE_NUM            AS DS_CPO_LINE_NUM
            ,DR.DS_CPO_LINE_SUB_NUM        AS DS_CPO_LINE_SUB_NUM
        FROM
            
        (SELECT IAD.GLBL_CMPY_CD            AS GLBL_CMPY_CD
               ,IAD.AJE_INV_ACCT_DIST_PK    AS AJE_INV_ACCT_DIST_PK
               ,IAD.DS_INV_SLS_CR_PK        AS DS_INV_SLS_CR_PK
               ,IAD.GL_DT                   AS GL_DT
               
               ,IAD.SYS_SRC_CD              AS SYS_SRC_CD
               ,IAD.SYS_SRC_NM              AS SYS_SRC_NM
               ,IAD.TRX_CD                  AS TRX_CD
               ,IAD.TRX_NM                  AS TRX_NM
               ,IAD.TRX_RSN_CD              AS TRX_RSN_CD
               ,IAD.TRX_RSN_NM              AS TRX_RSN_NM
               
               ,IAD.AJE_PTRN_IND_TP_CD_01   AS AJE_PTRN_IND_TP_CD_01
               ,IAD.AJE_PTRN_IND_TP_NM_01   AS AJE_PTRN_IND_TP_NM_01
               ,IAD.AJE_PTRN_ACTL_CD_01     AS AJE_PTRN_ACTL_CD_01
               ,IAD.AJE_PTRN_ACTL_NM_01     AS AJE_PTRN_ACTL_NM_01
               ,IAD.AJE_PTRN_IND_TP_CD_02   AS AJE_PTRN_IND_TP_CD_02
               ,IAD.AJE_PTRN_IND_TP_NM_02   AS AJE_PTRN_IND_TP_NM_02
               ,IAD.AJE_PTRN_ACTL_CD_02     AS AJE_PTRN_ACTL_CD_02
               ,IAD.AJE_PTRN_ACTL_NM_02     AS AJE_PTRN_ACTL_NM_02
               ,IAD.AJE_PTRN_IND_TP_CD_03   AS AJE_PTRN_IND_TP_CD_03
               ,IAD.AJE_PTRN_IND_TP_NM_03   AS AJE_PTRN_IND_TP_NM_03
               ,IAD.AJE_PTRN_ACTL_CD_03     AS AJE_PTRN_ACTL_CD_03
               ,IAD.AJE_PTRN_ACTL_NM_03     AS AJE_PTRN_ACTL_NM_03
               ,IAD.JRNL_SRC_CD             AS JRNL_SRC_CD
               ,IAD.JRNL_SRC_NM             AS JRNL_SRC_NM
               ,IAD.JRNL_CATG_CD            AS JRNL_CATG_CD
               ,IAD.JRNL_CATG_NM            AS JRNL_CATG_NM
               ,IAD.AJE_LINE_IDX_NUM        AS AJE_LINE_IDX_NUM
               ,IAD.AJE_LINE_IDX_DESC_TXT   AS AJE_LINE_IDX_DESC_TXT
               
               ,IAD.DR_CR_TP_CD            AS DR_CR_TP_CD
               ,IAD.AJE_COA_CMPY_CD        AS AJE_COA_CMPY_CD
               ,IAD.AJE_COA_BR_CD          AS AJE_COA_BR_CD
               ,IAD.AJE_COA_CC_CD          AS AJE_COA_CC_CD
               ,IAD.AJE_COA_ACCT_CD        AS AJE_COA_ACCT_CD
               ,IAD.AJE_COA_PROD_CD        AS AJE_COA_PROD_CD
               ,IAD.AJE_COA_CH_CD          AS AJE_COA_CH_CD
               ,IAD.AJE_COA_AFFL_CD        AS AJE_COA_AFFL_CD
               ,IAD.AJE_COA_PROJ_CD        AS AJE_COA_PROJ_CD
               ,IAD.AJE_COA_EXTN_CD        AS AJE_COA_EXTN_CD
               
                
               ,INV.BILL_TO_CUST_CD        AS BILL_TO_CUST_CD
               ,INV.SELL_TO_CUST_CD        AS SELL_TO_CUST_CD
               ,IB.SHIP_TO_CUST_CD         AS SHIP_TO_CUST_CD
               ,IB.SO_NUM                  AS SO_NUM
               ,INV.CPO_ORD_NUM            AS CPO_ORD_NUM
               <!-- Start Upd QC#21726 2017/10/26 -->
               ,CASE 
                   WHEN IAD.AJE_INV_ACCT_CLS_CD = #freight# THEN #ajeFrtMdseCd#
                   WHEN DISC.TRX_CD = #trxCd010# AND DISC.TRX_RSN_CD LIKE #trxRsnCdS# THEN DISC.MDSE_CD
                ELSE IL.MDSE_CD END AS MDSE_CD
               <!-- End Upd QC#21726 2017/10/26 -->
               ,MDSE.MDSE_NM               AS MDSE_NM
               ,MDSE.COA_PROD_CD           AS COA_PROD_CD
               ,DISC.SLS_REP_TOC_CD        AS SLS_REP_TOC_CD
               ,IL.SHIP_QTY                AS SHIP_QTY
               ,GC.STD_CCY_CD              AS FUNC_CCY_CD
               ,INV.DEAL_CCY_CD            AS DEAL_CCY_CD 
               ,CCY.ACCT_ARTH_TP_CD        AS ACCT_ARTH_TP_CD
               ,CCY.ORCL_CCY_CD            AS ORCL_CCY_CD
               ,INV.ACTL_APPLY_EXCH_RATE   AS EXCH_RATE
               ,IAD.JRNL_DEAL_AMT          AS JRNL_DEAL_AMT
               ,IAD.JRNL_FUNC_AMT          AS JRNL_FUNC_AMT
               ,IAD.INV_NUM                AS INV_NUM
               ,INV.DS_ORD_TP_CD           AS DS_ORD_TP_CD
               ,INV.DS_ORD_RSN_CD          AS DS_ORD_RSN_CD
               <!--,NVL(SIL.SVC_MACH_MSTR_PK, SMM.SVC_MACH_MSTR_PK)       AS SVC_MACH_MSTR_PK -->
               ,CASE WHEN SIL.SVC_MACH_MSTR_PK IS NOT NULL THEN SIL.SVC_MACH_MSTR_PK
                     WHEN SMM.SVC_MACH_MSTR_PK IS NOT NULL THEN SMM.SVC_MACH_MSTR_PK
                     ELSE CD.SVC_MACH_MSTR_PK END                         AS SVC_MACH_MSTR_PK
               <!-- Start Add QC#22515 2017/11/27 -->
               <!-- ,INV.BILL_TO_CUST_ACCT_CD   AS DS_ACCT_NUM -->
               ,INV.SELL_TO_CUST_CD        AS DS_ACCT_NUM
               <!-- End Add QC#22515 2017/11/27 -->
               <!-- ,NVL(SIL.SER_NUM, SMM.SER_NUM)                    AS SER_NUM -->
                ,CASE WHEN SIL.SER_NUM    IS NOT NULL THEN SIL.SER_NUM
                      WHEN SMM.SER_NUM    IS NOT NULL THEN SMM.SER_NUM
                      WHEN ISN.SER_NUM    IS NOT NULL THEN ISN.SER_NUM
                      ELSE CD.SER_NUM     END                         AS SER_NUM
               ,SI.DS_CONTR_PK             AS DS_CONTR_PK
               ,IL.DS_CONTR_DTL_PK         AS DS_CONTR_DTL_PK
               ,SI.DS_CONTR_NUM            AS DS_CONTR_NUM  
               ,IAD.AJE_INV_ACCT_DIST_PCT  AS AJE_INV_ACCT_DIST_PCT
               <!-- Start Add QC#16075 2016/12/12 -->
               ,IAD.AJE_INTFC_CMNT_TXT     AS AJE_INTFC_CMNT_TXT
               <!-- End Add QC#16075 2016/12/12 -->
               ,IB.CUST_ISS_PO_NUM         AS CUST_ISS_PO_NUM
               ,IL.DS_ORD_POSN_NUM         AS DS_ORD_POSN_NUM
               ,IL.DS_CPO_LINE_NUM         AS DS_CPO_LINE_NUM
               ,IL.DS_CPO_LINE_SUB_NUM     AS DS_CPO_LINE_SUB_NUM
                
          FROM  AJE_INV_ACCT_DIST    IAD
               ,INV                  INV
               ,SVC_INV              SI
               ,SVC_INV_LINE         SIL
               ,INV_BOL              IB
               ,INV_LINE             IL
               ,CCY                  CCY
               ,MDSE_DLY_SNAP_SHOT   MDSE
               ,GLBL_CMPY            GC
               ,DS_INV_TP            DIT
               ,DS_INV_SLS_CR        DISC
               ,CPO_DTL              CD
               <!-- Start Mod QC#23640 2018/01/23 -->
               <!-- ,SVC_MACH_MSTR        SMM -->
               ,(SELECT
                    A.GLBL_CMPY_CD
                   ,A.EZCANCELFLAG
                   ,A.CPO_ORD_NUM
                   ,A.CPO_DTL_LINE_NUM
                   ,A.CPO_DTL_LINE_SUB_NUM
                   ,A.SVC_MACH_MSTR_PK
                   ,A.SER_NUM
                   ,RANK() OVER(PARTITION BY A.CPO_ORD_NUM,A.CPO_DTL_LINE_NUM,A.CPO_DTL_LINE_SUB_NUM order by A.SVC_MACH_MSTR_PK DESC) AS RANK
                FROM
                    SVC_MACH_MSTR A
                WHERE
                    A.GLBL_CMPY_CD = #glblCmpyCd#
                AND A.EZCANCELFLAG = '0'
                ) SMM
               <!-- End   Mod QC#23640 2018/01/23 -->
               ,(
                SELECT /*+ NO_PUSH_PRED */
                     ILSN.GLBL_CMPY_CD
                    ,ILSN.EZCANCELFLAG
                    ,ILSN.INV_NUM
                    ,ILSN.INV_BOL_LINE_NUM
                    ,ILSN.INV_LINE_NUM
                    ,ILSN.INV_LINE_SUB_NUM
                    ,ILSN.INV_TRX_LINE_SUB_NUM
                    ,ILSN.SER_NUM
                    ,ILSN.MDSE_CD
                    ,ROW_NUMBER() OVER(PARTITION BY ILSN.INV_NUM, ILSN.INV_BOL_LINE_NUM, ILSN.INV_LINE_NUM, ILSN.INV_LINE_SUB_NUM, ILSN.INV_TRX_LINE_SUB_NUM, ILSN.MDSE_CD  ORDER BY ILSN.SER_NUM) AS NUM
                FROM
                    DS_INV_LINE_SER_NUM ILSN
                WHERE
                    ILSN.GLBL_CMPY_CD   = #glblCmpyCd#
                AND ILSN.EZCANCELFLAG   = '0'
               ) ISN
         WHERE IAD.EZCANCELFLAG         = '0'
           AND IAD.GLBL_CMPY_CD         = #glblCmpyCd#
           AND IAD.EZCANCELFLAG         = GC.EZCANCELFLAG
           AND IAD.GLBL_CMPY_CD         = GC.GLBL_CMPY_CD
           AND IAD.EZCANCELFLAG         = INV.EZCANCELFLAG(+)
           AND IAD.GLBL_CMPY_CD         = INV.GLBL_CMPY_CD(+)
           AND IAD.INV_NUM              = INV.INV_NUM(+)
           AND IAD.EZCANCELFLAG         = SI.EZCANCELFLAG(+)
           AND IAD.GLBL_CMPY_CD         = SI.GLBL_CMPY_CD(+)
           AND IAD.INV_NUM              = SI.SVC_INV_NUM(+)
           AND SI.EZCANCELFLAG          = SIL.EZCANCELFLAG(+)
           AND SI.GLBL_CMPY_CD          = SIL.GLBL_CMPY_CD(+)
           AND SI.SVC_INV_NUM           = SIL.SVC_INV_NUM(+)
           AND IL.SVC_INV_LINE_PK       = SIL.SVC_INV_LINE_PK(+)
           AND IAD.EZCANCELFLAG         = IB.EZCANCELFLAG(+)
           AND IAD.GLBL_CMPY_CD         = IB.GLBL_CMPY_CD(+)
           AND IAD.INV_NUM              = IB.INV_NUM(+)
           AND IAD.INV_BOL_LINE_NUM     = IB.INV_BOL_LINE_NUM(+)
           AND IAD.EZCANCELFLAG         = IL.EZCANCELFLAG(+)
           AND IAD.GLBL_CMPY_CD         = IL.GLBL_CMPY_CD(+)
           AND IAD.INV_NUM              = IL.INV_NUM(+)
           AND IAD.INV_BOL_LINE_NUM     = IL.INV_BOL_LINE_NUM(+)
           AND IAD.INV_LINE_NUM         = IL.INV_LINE_NUM(+)
           AND IAD.INV_LINE_SUB_NUM     = IL.INV_LINE_SUB_NUM(+)
           AND IAD.INV_LINE_SUB_TRX_NUM = IL.INV_LINE_SUB_TRX_NUM(+)
           AND IAD.EZCANCELFLAG         = CCY.EZCANCELFLAG(+)
           AND IAD.GLBL_CMPY_CD         = CCY.GLBL_CMPY_CD(+)
           AND IAD.DEAL_CCY_CD          = CCY.CCY_CD
           AND IAD.EZCANCELFLAG         = MDSE.EZCANCELFLAG(+)
           AND IAD.GLBL_CMPY_CD         = MDSE.GLBL_CMPY_CD(+)
           <!-- Start Upd QC#21726 2017/10/26 -->
           AND CASE 
                   WHEN IAD.AJE_INV_ACCT_CLS_CD = #freight# THEN #ajeFrtMdseCd#
                   WHEN DISC.TRX_CD = #trxCd010# AND DISC.TRX_RSN_CD LIKE #trxRsnCdS# THEN DISC.MDSE_CD 
               ELSE IL.MDSE_CD END = MDSE.MDSE_CD(+)
           <!-- End Upd QC#21726 2017/10/26 -->
           AND #flgY#                   = MDSE.LTST_REC_FLG(+)
           AND IAD.PROC_STS_CD          &lt;&gt; #errStsCd#
           AND IAD.DFRD_REV_GL_STRG_FLG = #flgN#
           AND IAD.DR_CR_TP_CD          = #debit#
           AND IAD.JRNL_CRAT_DT         IS NULL
           <!-- Add QC#5770 -->
           AND INV.FNLZ_INV_FLG         = #flgY#
           <!-- end -->
           <!-- start add QC#12048 -->
           AND INV.GLBL_CMPY_CD          = DIT.GLBL_CMPY_CD(+)
           AND INV.EZCANCELFLAG          = DIT.EZCANCELFLAG(+)
           AND INV.DS_INV_TP_CD          = DIT.DS_INV_TP_CD(+)
           AND (#flgY#                  = DIT.POST_TO_GL_FLG
            OR  DIT.POST_TO_GL_FLG      IS NULL)
           <!-- end QC#12048 -->
           AND IAD.GLBL_CMPY_CD          = DISC.GLBL_CMPY_CD
           AND IAD.DS_INV_SLS_CR_PK      = DISC.DS_INV_SLS_CR_PK
           AND IAD.EZCANCELFLAG          = DISC.EZCANCELFLAG

           AND IL.GLBL_CMPY_CD           = SMM.GLBL_CMPY_CD(+)
           AND IL.CPO_ORD_NUM            = SMM.CPO_ORD_NUM(+)
           AND IL.CPO_DTL_LINE_NUM       = SMM.CPO_DTL_LINE_NUM(+)
           AND IL.CPO_DTL_LINE_SUB_NUM   = SMM.CPO_DTL_LINE_SUB_NUM(+)
           AND SMM.EZCANCELFLAG(+)       = '0'
           <!-- Start Add QC#23640 2018/01/23 -->
           AND SMM.RANK(+)               = 1
           <!-- Start Add QC#23640 2018/01/23 -->
           AND IL.GLBL_CMPY_CD           = CD.GLBL_CMPY_CD(+)
           AND IL.CPO_ORD_NUM            = CD.CPO_ORD_NUM(+)
           AND IL.CPO_DTL_LINE_NUM       = CD.CPO_DTL_LINE_NUM(+)
           AND IL.CPO_DTL_LINE_SUB_NUM   = CD.CPO_DTL_LINE_SUB_NUM(+)
           AND IL.EZCANCELFLAG(+)        = '0'

           AND IL.GLBL_CMPY_CD           = ISN.GLBL_CMPY_CD(+)
           AND IL.INV_NUM                = ISN.INV_NUM(+)
           AND IL.INV_BOL_LINE_NUM       = ISN.INV_BOL_LINE_NUM(+)
           AND IL.INV_LINE_NUM           = ISN.INV_LINE_NUM(+)
           AND IL.INV_LINE_SUB_NUM       = ISN.INV_LINE_SUB_NUM(+)
           AND IL.INV_LINE_SUB_TRX_NUM   = ISN.INV_TRX_LINE_SUB_NUM(+)
           AND IL.MDSE_CD                = ISN.MDSE_CD(+)
           AND ISN.EZCANCELFLAG(+)       = '0'
           AND ISN.NUM(+)                =  1

       ) DR
      , (SELECT IAD.GLBL_CMPY_CD            AS GLBL_CMPY_CD
               ,IAD.AJE_INV_ACCT_DIST_PK    AS AJE_INV_ACCT_DIST_PK
               ,IAD.DS_INV_SLS_CR_PK        AS DS_INV_SLS_CR_PK
               ,IAD.AJE_LINE_IDX_NUM        AS AJE_LINE_IDX_NUM
               
               ,IAD.AJE_LINE_IDX_DESC_TXT   AS AJE_LINE_IDX_DESC_TXT
               
               ,IAD.AJE_COA_CMPY_CD         AS AJE_COA_CMPY_CD
               ,IAD.AJE_COA_BR_CD           AS AJE_COA_BR_CD
               ,IAD.AJE_COA_CC_CD           AS AJE_COA_CC_CD
               ,IAD.AJE_COA_ACCT_CD         AS AJE_COA_ACCT_CD
               ,IAD.AJE_COA_PROD_CD         AS AJE_COA_PROD_CD
               ,IAD.AJE_COA_CH_CD           AS AJE_COA_CH_CD
               ,IAD.AJE_COA_AFFL_CD         AS AJE_COA_AFFL_CD
               ,IAD.AJE_COA_PROJ_CD         AS AJE_COA_PROJ_CD
               ,IAD.AJE_COA_EXTN_CD         AS AJE_COA_EXTN_CD
               <!-- Start Add QC#16075 2016/12/12 -->
               ,IAD.AJE_INTFC_CMNT_TXT     AS AJE_INTFC_CMNT_TXT
               <!-- End Add QC#16075 2016/12/12 -->
          FROM  AJE_INV_ACCT_DIST    IAD
         WHERE IAD.EZCANCELFLAG         = '0'
           AND IAD.GLBL_CMPY_CD         = #glblCmpyCd#
           AND IAD.PROC_STS_CD          &lt;&gt; #errStsCd#
           AND IAD.DFRD_REV_GL_STRG_FLG = #flgN#
           AND IAD.DR_CR_TP_CD          = #credit#
           AND IAD.JRNL_CRAT_DT         IS NULL
           
       ) CR
       WHERE DR.DS_INV_SLS_CR_PK  = CR.DS_INV_SLS_CR_PK
         AND DR.AJE_LINE_IDX_NUM  = CR.AJE_LINE_IDX_NUM
       ORDER BY DR.DS_INV_SLS_CR_PK
       
    </statement>
    
    <statement id="getErrorPerInv" parameterClass="Map" resultClass="Map">    
        SELECT 
              IAD.AJE_INV_ACCT_DIST_PK    AS AJE_INTFC_PK
             ,JRNL_ENTRY_PK               AS JRNL_ENTRY_PK
        FROM 
             AJE_INV_ACCT_DIST IAD
           , JRNL_ENTRY JE
		   ,(SELECT
		             MAX(IAD_IN.GLBL_CMPY_CD)  AS GLBL_CMPY_CD
		            ,IAD_IN.INV_NUM            AS INV_NUM
		     FROM    AJE_INV_ACCT_DIST IAD_IN
		            ,AJE_INTFC_CTRL    AIC
		     WHERE 1=1
		     AND   IAD_IN.GLBL_CMPY_CD         = #glblCmpyCd#
		     AND   IAD_IN.EZCANCELFLAG         = '0'
		     AND   AIC.EZCANCELFLAG            = '0'
		     AND   IAD_IN.GLBL_CMPY_CD         = AIC.GLBL_CMPY_CD
		     AND   IAD_IN.AJE_INV_ACCT_DIST_PK = AIC.AJE_INTFC_PK
		     AND   AIC.AJE_INTFC_TP_CD         = #ajeIntfcTpCd#
		     AND   AIC.JRNL_CPLT_FLG           = #jrnlCpltFlg#
		     GROUP BY IAD_IN.INV_NUM
		    ) W1
        WHERE 1=1
        AND   IAD.GLBL_CMPY_CD = W1.GLBL_CMPY_CD
        AND   IAD.INV_NUM      = W1.INV_NUM
        AND   JE.GLBL_CMPY_CD  = W1.GLBL_CMPY_CD
        AND   JE.EZCANCELFLAG    = '0'
        AND   JE.AJE_INTFC_TP_CD = #ajeIntfcTpCd#
        AND   JE.AJE_INTFC_PK    = IAD.AJE_INV_ACCT_DIST_PK
      ORDER BY IAD.AJE_INV_ACCT_DIST_PK
    </statement>
    
    <statement id="getProcessedData" parameterClass="Map" resultClass="Map">
      SELECT AD.AJE_INV_ACCT_DIST_PK
        FROM
      (SELECT IAD.DS_INV_SLS_CR_PK
         FROM AJE_INV_ACCT_DIST IAD
             ,AJE_INTFC_CTRL    AIC
        WHERE IAD.EZCANCELFLAG         = '0'
          AND IAD.GLBL_CMPY_CD         = #glblCmpyCd#
          AND IAD.EZCANCELFLAG         = AIC.EZCANCELFLAG
          AND IAD.GLBL_CMPY_CD         = AIC.GLBL_CMPY_CD
          AND IAD.JRNL_CRAT_DT         IS NULL
          AND IAD.AJE_INV_ACCT_DIST_PK = AIC.AJE_INTFC_PK
          AND AIC.JRNL_CPLT_FLG        = #flgY#
          AND AIC.AJE_INTFC_TP_CD      = #ajeIntfcTpCd#
      ) DR
      , AJE_INV_ACCT_DIST AD
     WHERE AD.GLBL_CMPY_CD     = #glblCmpyCd#
       AND AD.EZCANCELFLAG     = '0'
       AND AD.DS_INV_SLS_CR_PK = DR.DS_INV_SLS_CR_PK
       AND AD.JRNL_CRAT_DT    IS NULL
    </statement>
    
</sqlMap>	
